<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>Ledger.Conway.Chain.Properties</title><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.css"><link rel="stylesheet" href="Agda.css"><script src="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.js"></script><script src="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/contrib/auto-render.min.js"></script><script src="AgdaKaTeX.js" defer=""></script></head><body><pre class="Agda"><a id="1" class="Symbol">{-#</a> <a id="5" class="Keyword">OPTIONS</a> <a id="13" class="Pragma">--safe</a> <a id="20" class="Symbol">#-}</a>

<a id="25" class="Keyword">open</a> <a id="30" class="Keyword">import</a> <a id="37" href="Ledger.Conway.Transaction.html" class="Module">Ledger.Conway.Transaction</a> <a id="63" class="Keyword">using</a> <a id="69" class="Symbol">(</a><a id="70" href="Ledger.Conway.Transaction.html#910" class="Record">TransactionStructure</a><a id="90" class="Symbol">)</a>
<a id="92" class="Keyword">open</a> <a id="97" class="Keyword">import</a> <a id="104" href="Ledger.Conway.Abstract.html" class="Module">Ledger.Conway.Abstract</a> <a id="127" class="Keyword">using</a> <a id="133" class="Symbol">(</a><a id="134" href="Ledger.Conway.Abstract.html#599" class="Record">AbstractFunctions</a><a id="151" class="Symbol">)</a>

<a id="154" class="Keyword">module</a> <a id="161" href="Ledger.Conway.Chain.Properties.html" class="Module">Ledger.Conway.Chain.Properties</a>
  <a id="194" class="Symbol">(</a><a id="195" href="Ledger.Conway.Chain.Properties.html#195" class="Bound">txs</a> <a id="199" class="Symbol">:</a> <a id="201" class="Symbol">_)</a> <a id="204" class="Symbol">(</a><a id="205" class="Keyword">open</a> <a id="210" href="Ledger.Conway.Transaction.html#910" class="Module">TransactionStructure</a> <a id="231" href="Ledger.Conway.Chain.Properties.html#195" class="Bound">txs</a><a id="234" class="Symbol">)</a>
  <a id="238" class="Symbol">(</a><a id="239" href="Ledger.Conway.Chain.Properties.html#239" class="Bound">abs</a> <a id="243" class="Symbol">:</a> <a id="245" href="Ledger.Conway.Abstract.html#599" class="Record">AbstractFunctions</a> <a id="263" href="Ledger.Conway.Chain.Properties.html#195" class="Bound">txs</a><a id="266" class="Symbol">)</a> <a id="268" class="Symbol">(</a><a id="269" class="Keyword">open</a> <a id="274" href="Ledger.Conway.Abstract.html#599" class="Module">AbstractFunctions</a> <a id="292" href="Ledger.Conway.Chain.Properties.html#239" class="Bound">abs</a><a id="295" class="Symbol">)</a>
  <a id="299" class="Keyword">where</a>
<a id="305" class="Keyword">open</a> <a id="310" class="Keyword">import</a> <a id="317" href="Ledger.Conway.Chain.html" class="Module">Ledger.Conway.Chain</a> <a id="337" href="Ledger.Conway.Chain.Properties.html#195" class="Bound">txs</a> <a id="341" href="Ledger.Conway.Chain.Properties.html#239" class="Bound">abs</a>
<a id="345" class="Keyword">open</a> <a id="350" class="Keyword">import</a> <a id="357" href="Ledger.Conway.Enact.html" class="Module">Ledger.Conway.Enact</a> <a id="377" href="Ledger.Conway.Transaction.html#1880" class="Function">govStructure</a> <a id="390" class="Keyword">using</a> <a id="396" class="Symbol">(</a><a id="397" href="Ledger.Conway.Enact.html#418" class="Record">EnactState</a><a id="407" class="Symbol">)</a>
<a id="409" class="Keyword">open</a> <a id="414" class="Keyword">import</a> <a id="421" href="Ledger.Conway.Epoch.html" class="Module">Ledger.Conway.Epoch</a> <a id="441" href="Ledger.Conway.Chain.Properties.html#195" class="Bound">txs</a> <a id="445" href="Ledger.Conway.Chain.Properties.html#239" class="Bound">abs</a>
<a id="449" class="Keyword">open</a> <a id="454" class="Keyword">import</a> <a id="461" href="Ledger.Conway.Epoch.Properties.html" class="Module">Ledger.Conway.Epoch.Properties</a> <a id="492" href="Ledger.Conway.Chain.Properties.html#195" class="Bound">txs</a> <a id="496" href="Ledger.Conway.Chain.Properties.html#239" class="Bound">abs</a>
<a id="500" class="Keyword">open</a> <a id="505" class="Keyword">import</a> <a id="512" href="Ledger.Conway.Ledger.html" class="Module">Ledger.Conway.Ledger</a> <a id="533" href="Ledger.Conway.Chain.Properties.html#195" class="Bound">txs</a> <a id="537" href="Ledger.Conway.Chain.Properties.html#239" class="Bound">abs</a>
<a id="541" class="Keyword">open</a> <a id="546" class="Keyword">import</a> <a id="553" href="Ledger.Conway.Ledger.Properties.html" class="Module">Ledger.Conway.Ledger.Properties</a> <a id="585" href="Ledger.Conway.Chain.Properties.html#195" class="Bound">txs</a> <a id="589" href="Ledger.Conway.Chain.Properties.html#239" class="Bound">abs</a>
<a id="593" class="Keyword">open</a> <a id="598" class="Keyword">import</a> <a id="605" href="Ledger.Prelude.html" class="Module">Ledger.Prelude</a>

<a id="621" class="Keyword">open</a> <a id="626" href="Interface.ComputationalRelation.html#2799" class="Module">Computational</a> <a id="640" class="Symbol">⦃...⦄</a>

<a id="647" class="Keyword">module</a> <a id="654" href="Ledger.Conway.Chain.Properties.html#654" class="Module">_</a>
  <a id="658" class="Symbol">(</a><a id="659" href="Ledger.Conway.Chain.Properties.html#659" class="Bound">nes</a> <a id="663" class="Symbol">:</a> <a id="665" href="Ledger.Conway.Epoch.html#2483" class="Record">NewEpochState</a><a id="678" class="Symbol">)</a>
  <a id="682" class="Symbol">(</a><a id="683" class="Keyword">open</a> <a id="688" href="Ledger.Conway.Epoch.html#1469" class="Module">EpochState</a> <a id="699" class="Symbol">(</a><a id="700" href="Ledger.Conway.Epoch.html#2546" class="Field">NewEpochState.epochState</a> <a id="725" href="Ledger.Conway.Chain.Properties.html#659" class="Bound">nes</a><a id="728" class="Symbol">)</a> <a id="730" class="Keyword">using</a> <a id="736" class="Symbol">(</a><a id="737" href="Ledger.Conway.Epoch.html#1586" class="Field">ls</a><a id="739" class="Symbol">)</a> <a id="741" class="Keyword">renaming</a> <a id="750" class="Symbol">(</a><a id="751" href="Ledger.Conway.Epoch.html#1610" class="Field">es</a> <a id="754" class="Symbol">to</a> <a id="757" class="Field">es&#39;</a><a id="760" class="Symbol">))</a>
  <a id="765" class="Symbol">(</a><a id="766" class="Keyword">open</a> <a id="771" href="Ledger.Conway.Enact.html#418" class="Module">EnactState</a> <a id="782" href="Ledger.Conway.Chain.Properties.html#757" class="Function">es&#39;</a> <a id="786" class="Keyword">using</a> <a id="792" class="Symbol">(</a><a id="793" href="Ledger.Conway.Enact.html#628" class="Field">pparams</a><a id="800" class="Symbol">))</a>
  <a id="805" class="Symbol">(</a><a id="806" class="Keyword">open</a> <a id="811" href="Ledger.Conway.PParams.html#1717" class="Module">PParams</a> <a id="819" href="Ledger.Prelude.html#2543" class="Function Operator">∣</a> <a id="821" href="Ledger.Conway.Enact.html#628" class="Function">pparams</a> <a id="829" href="Ledger.Prelude.html#2543" class="Function Operator">∣</a> <a id="831" class="Keyword">using</a> <a id="837" class="Symbol">(</a><a id="838" href="Ledger.Conway.PParams.html#2629" class="Field">maxRefScriptSizePerBlock</a><a id="862" class="Symbol">))</a>
  <a id="867" class="Symbol">(</a><a id="868" href="Ledger.Conway.Chain.Properties.html#868" class="Bound">ts</a> <a id="871" class="Symbol">:</a> <a id="873" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="878" href="Ledger.Conway.Transaction.html#4306" class="Record">Tx</a><a id="880" class="Symbol">)</a>
  <a id="884" class="Keyword">where</a>
  <a id="892" href="Ledger.Conway.Chain.Properties.html#892" class="Function">refScriptSize≤?Bound</a> <a id="913" class="Symbol">:</a> <a id="915" href="Relation.Nullary.Decidable.Core.html#1861" class="Record">Dec</a> <a id="919" class="Symbol">(</a><a id="920" href="Ledger.Conway.Chain.html#3688" class="Function">totalRefScriptsSize</a> <a id="940" href="Ledger.Conway.Epoch.html#1586" class="Function">ls</a> <a id="943" href="Ledger.Conway.Chain.Properties.html#868" class="Bound">ts</a> <a id="946" href="Class.HasOrder.Core.html#608" class="Field Operator">≤</a> <a id="948" href="Ledger.Conway.PParams.html#2629" class="Function">maxRefScriptSizePerBlock</a><a id="972" class="Symbol">)</a>
  <a id="976" href="Ledger.Conway.Chain.Properties.html#892" class="Function">refScriptSize≤?Bound</a> <a id="997" class="Symbol">=</a> <a id="999" href="Ledger.Conway.Chain.html#3688" class="Function">totalRefScriptsSize</a> <a id="1019" href="Ledger.Conway.Epoch.html#1586" class="Function">ls</a> <a id="1022" href="Ledger.Conway.Chain.Properties.html#868" class="Bound">ts</a> <a id="1025" href="Class.HasOrder.Core.html#1011" class="Function Operator">≤?</a> <a id="1028" href="Ledger.Conway.PParams.html#2629" class="Function">maxRefScriptSizePerBlock</a>

<a id="1054" class="Keyword">instance</a>
  <a id="Computational-CHAIN"></a><a id="1065" href="Ledger.Conway.Chain.Properties.html#1065" class="Function">Computational-CHAIN</a> <a id="1085" class="Symbol">:</a> <a id="1087" href="Interface.ComputationalRelation.html#2799" class="Record">Computational</a> <a id="1101" href="Ledger.Conway.Chain.html#3883" class="Datatype Operator">_⊢_⇀⦇_,CHAIN⦈_</a> <a id="1116" href="Agda.Builtin.String.html#335" class="Postulate">String</a>
  <a id="1125" href="Ledger.Conway.Chain.Properties.html#1065" class="Function">Computational-CHAIN</a> <a id="1145" class="Symbol">.</a><a id="1146" href="Interface.ComputationalRelation.html#2879" class="Field">computeProof</a> <a id="1159" href="Ledger.Conway.Chain.Properties.html#1159" class="Bound">Γ</a> <a id="1161" href="Ledger.Conway.Chain.Properties.html#1161" class="Bound">s</a> <a id="1163" class="Keyword">record</a> <a id="1170" class="Symbol">{</a> <a id="1172" href="Ledger.Conway.Chain.html#754" class="Field">ts</a> <a id="1175" class="Symbol">=</a> <a id="1177" href="Ledger.Conway.Chain.Properties.html#1177" class="Bound">ts</a> <a id="1180" class="Symbol">}</a> <a id="1182" class="Symbol">=</a> <a id="1184" class="Keyword">do</a>
    <a id="1191" href="Ledger.Conway.Chain.Properties.html#1191" class="Bound">nes</a> <a id="1195" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1197" href="Ledger.Conway.Chain.Properties.html#1197" class="Bound">neStep</a> <a id="1204" href="Class.Monad.Core.html#299" class="Field Operator">←</a> <a id="1206" href="Class.Bifunctor.html#1045" class="Function">map₁</a> <a id="1211" href="Data.Empty.html#1069" class="Function">⊥-elim</a> <a id="1218" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="1220" href="Interface.ComputationalRelation.html#2879" class="Field">computeProof</a> <a id="1233" class="Symbol">{</a><a id="1234" class="Argument">STS</a> <a id="1238" class="Symbol">=</a> <a id="1240" href="Ledger.Conway.Epoch.html#11416" class="Datatype Operator">_⊢_⇀⦇_,NEWEPOCH⦈_</a><a id="1257" class="Symbol">}</a> <a id="1259" class="Symbol">_</a> <a id="1261" class="Symbol">_</a> <a id="1263" class="Symbol">_</a>
    <a id="1269" class="Symbol">_</a> <a id="1271" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1273" href="Ledger.Conway.Chain.Properties.html#1273" class="Bound">lsStep</a> <a id="1280" href="Class.Monad.Core.html#299" class="Field Operator">←</a> <a id="1282" href="Interface.ComputationalRelation.html#2879" class="Field">computeProof</a> <a id="1295" class="Symbol">_</a> <a id="1297" class="Symbol">(</a><a id="1298" href="Ledger.Conway.Ledger.html#1060" class="Field">LStateOf</a> <a id="1307" href="Ledger.Conway.Chain.Properties.html#1191" class="Bound">nes</a><a id="1310" class="Symbol">)</a> <a id="1312" href="Ledger.Conway.Chain.Properties.html#1177" class="Bound">ts</a>
    <a id="1319" href="Function.Base.html#4042" class="Function Operator">case</a> <a id="1324" href="Ledger.Conway.Chain.Properties.html#892" class="Function">refScriptSize≤?Bound</a> <a id="1345" href="Ledger.Conway.Chain.Properties.html#1191" class="Bound">nes</a> <a id="1349" href="Ledger.Conway.Chain.Properties.html#1177" class="Bound">ts</a> <a id="1352" href="Function.Base.html#4042" class="Function Operator">of</a> <a id="1355" class="Symbol">λ</a> <a id="1357" class="Keyword">where</a>
      <a id="1369" class="Symbol">(</a><a id="1370" href="Relation.Nullary.Decidable.Core.html#2031" class="InductiveConstructor">no</a> <a id="1373" href="Ledger.Conway.Chain.Properties.html#1373" class="Bound">¬p</a><a id="1375" class="Symbol">)</a> <a id="1377" class="Symbol">→</a> <a id="1379" href="Interface.ComputationalRelation.html#348" class="InductiveConstructor">failure</a> <a id="1387" class="String">&quot;totalRefScriptsSize &gt; maxRefScriptSizePerBlock&quot;</a>
      <a id="1442" class="Symbol">(</a><a id="1443" href="Relation.Nullary.Decidable.Core.html#1994" class="InductiveConstructor">yes</a> <a id="1447" href="Ledger.Conway.Chain.Properties.html#1447" class="Bound">p</a><a id="1448" class="Symbol">)</a> <a id="1450" class="Symbol">→</a> <a id="1452" href="Interface.ComputationalRelation.html#308" class="InductiveConstructor">success</a> <a id="1460" class="Symbol">(_</a> <a id="1463" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1465" href="Ledger.Conway.Chain.html#3957" class="InductiveConstructor">CHAIN</a> <a id="1471" class="Symbol">(</a><a id="1472" href="Ledger.Conway.Chain.Properties.html#1447" class="Bound">p</a> <a id="1474" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1476" href="Ledger.Conway.Chain.Properties.html#1197" class="Bound">neStep</a> <a id="1483" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1485" href="Ledger.Conway.Chain.Properties.html#1273" class="Bound">lsStep</a><a id="1491" class="Symbol">))</a>

  <a id="1497" href="Ledger.Conway.Chain.Properties.html#1065" class="Function">Computational-CHAIN</a> <a id="1517" class="Symbol">.</a><a id="1518" href="Interface.ComputationalRelation.html#3096" class="Field">completeness</a> <a id="1531" class="Symbol">_</a> <a id="1533" href="Ledger.Conway.Chain.Properties.html#1533" class="Bound">s</a> <a id="1535" href="Ledger.Conway.Chain.Properties.html#1535" class="Bound">b</a> <a id="1537" class="Symbol">_</a> <a id="1539" class="Symbol">(</a><a id="1540" href="Ledger.Conway.Chain.html#3957" class="InductiveConstructor">CHAIN</a> <a id="1546" class="Symbol">{</a><a id="1547" class="Argument">nes</a> <a id="1551" class="Symbol">=</a> <a id="1553" href="Ledger.Conway.Chain.Properties.html#1553" class="Bound">nes</a><a id="1556" class="Symbol">}</a> <a id="1558" class="Symbol">(</a><a id="1559" href="Ledger.Conway.Chain.Properties.html#1559" class="Bound">p</a> <a id="1561" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1563" href="Ledger.Conway.Chain.Properties.html#1563" class="Bound">neStep</a> <a id="1570" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1572" href="Ledger.Conway.Chain.Properties.html#1572" class="Bound">lsStep</a><a id="1578" class="Symbol">))</a>
    <a id="1585" class="Keyword">with</a> <a id="1590" href="Interface.ComputationalRelation.html#4350" class="Function">recomputeProof</a> <a id="1605" href="Ledger.Conway.Chain.Properties.html#1563" class="Bound">neStep</a> <a id="1612" class="Symbol">|</a> <a id="1614" href="Interface.ComputationalRelation.html#3096" class="Field">completeness</a> <a id="1627" class="Symbol">_</a> <a id="1629" class="Symbol">_</a> <a id="1631" class="Symbol">_</a> <a id="1633" class="Symbol">_</a> <a id="1635" href="Ledger.Conway.Chain.Properties.html#1563" class="Bound">neStep</a>
  <a id="1644" class="Symbol">...</a> <a id="1648" class="Symbol">|</a> <a id="1650" class="Symbol">_</a>         <a id="1660" class="Symbol">|</a> <a id="1662" href="Agda.Builtin.Equality.html#207" class="InductiveConstructor">refl</a>
    <a id="1671" class="Keyword">with</a> <a id="1676" href="Interface.ComputationalRelation.html#4350" class="Function">recomputeProof</a> <a id="1691" class="Bound">lsStep</a> <a id="1698" class="Symbol">|</a> <a id="1700" href="Interface.ComputationalRelation.html#3096" class="Field">completeness</a> <a id="1713" class="Symbol">_</a> <a id="1715" class="Symbol">_</a> <a id="1717" class="Symbol">_</a> <a id="1719" class="Symbol">_</a> <a id="1721" class="Bound">lsStep</a>
  <a id="1730" class="Symbol">...</a> <a id="1734" class="Symbol">|</a> <a id="1736" href="Interface.ComputationalRelation.html#308" class="InductiveConstructor">success</a> <a id="1744" class="Symbol">_</a> <a id="1746" class="Symbol">|</a> <a id="1748" href="Agda.Builtin.Equality.html#207" class="InductiveConstructor">refl</a>
    <a id="1757" class="Keyword">with</a> <a id="1762" href="Ledger.Conway.Chain.Properties.html#892" class="Function">refScriptSize≤?Bound</a> <a id="1783" class="Bound">nes</a> <a id="1787" class="Symbol">(</a><a id="1788" href="Ledger.Conway.Chain.html#754" class="Field">Block.ts</a> <a id="1797" class="Bound">b</a><a id="1798" class="Symbol">)</a>
  <a id="1802" class="Symbol">...</a> <a id="1806" class="Symbol">|</a> <a id="1808" href="Relation.Nullary.Decidable.Core.html#1994" class="InductiveConstructor">yes</a> <a id="1812" href="Ledger.Conway.Chain.Properties.html#1812" class="Bound">p</a> <a id="1814" class="Symbol">=</a> <a id="1816" href="Agda.Builtin.Equality.html#207" class="InductiveConstructor">refl</a>
  <a id="1823" class="Symbol">...</a> <a id="1827" class="Symbol">|</a> <a id="1829" href="Relation.Nullary.Decidable.Core.html#2031" class="InductiveConstructor">no</a> <a id="1832" href="Ledger.Conway.Chain.Properties.html#1832" class="Bound">¬p</a> <a id="1835" class="Symbol">=</a> <a id="1837" href="Data.Empty.html#1069" class="Function">⊥-elim</a> <a id="1844" class="Symbol">(</a><a id="1845" href="Ledger.Conway.Chain.Properties.html#1832" class="Bound">¬p</a> <a id="1848" class="Bound">p</a><a id="1849" class="Symbol">)</a>
</pre></body></html>