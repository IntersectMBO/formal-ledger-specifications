<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>Ledger.NewPP</title><link rel="stylesheet" href="Agda.css"></head><body><pre class="Agda">
<a id="2" class="Symbol">{-#</a> <a id="6" class="Keyword">OPTIONS</a> <a id="14" class="Pragma">--safe</a> <a id="21" class="Symbol">#-}</a>

<a id="26" class="Keyword">open</a> <a id="31" class="Keyword">import</a> <a id="38" href="Relation.Nullary.Decidable.html" class="Module">Relation.Nullary.Decidable</a>

<a id="66" class="Keyword">open</a> <a id="71" class="Keyword">import</a> <a id="78" href="Ledger.Prelude.html" class="Module">Ledger.Prelude</a>
<a id="93" class="Keyword">open</a> <a id="98" class="Keyword">import</a> <a id="105" href="Ledger.Transaction.html" class="Module">Ledger.Transaction</a>

<a id="125" class="Keyword">module</a> <a id="132" href="Ledger.NewPP.html" class="Module">Ledger.NewPP</a> <a id="145" class="Symbol">(</a><a id="146" href="Ledger.NewPP.html#146" class="Bound">txs</a> <a id="150" class="Symbol">:</a> <a id="152" class="Symbol">_)</a> <a id="155" class="Symbol">(</a><a id="156" class="Keyword">open</a> <a id="161" href="Ledger.Transaction.html#840" class="Module">TransactionStructure</a> <a id="182" href="Ledger.NewPP.html#146" class="Bound">txs</a><a id="185" class="Symbol">)</a> <a id="187" class="Keyword">where</a>

<a id="194" class="Keyword">open</a> <a id="199" class="Keyword">import</a> <a id="206" href="Ledger.PPUp.html" class="Module">Ledger.PPUp</a> <a id="218" href="Ledger.NewPP.html#146" class="Bound">txs</a>

<a id="223" class="Keyword">record</a> <a id="NewPParamEnv"></a><a id="230" href="Ledger.NewPP.html#230" class="Record">NewPParamEnv</a> <a id="243" class="Symbol">:</a> <a id="245" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="250" class="Keyword">where</a>
<a id="256" class="Comment">--  field</a>


<a id="268" class="Keyword">record</a> <a id="NewPParamState"></a><a id="275" href="Ledger.NewPP.html#275" class="Record">NewPParamState</a> <a id="290" class="Symbol">:</a> <a id="292" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="297" class="Keyword">where</a>
  <a id="305" class="Keyword">field</a>
    <a id="NewPParamState.pparams"></a><a id="315" href="Ledger.NewPP.html#315" class="Field">pparams</a>  <a id="324" class="Symbol">:</a> <a id="326" href="Ledger.PParams.html#1570" class="Record">PParams</a>
    <a id="NewPParamState.ppup"></a><a id="338" href="Ledger.NewPP.html#338" class="Field">ppup</a>     <a id="347" class="Symbol">:</a> <a id="349" href="Ledger.PPUp.html#489" class="Record">PPUpdateState</a>

<a id="updatePPUp"></a><a id="364" href="Ledger.NewPP.html#364" class="Function">updatePPUp</a> <a id="375" class="Symbol">:</a> <a id="377" href="Ledger.PParams.html#1570" class="Record">PParams</a> <a id="385" class="Symbol">→</a> <a id="387" href="Ledger.PPUp.html#489" class="Record">PPUpdateState</a> <a id="401" class="Symbol">→</a> <a id="403" href="Ledger.PPUp.html#489" class="Record">PPUpdateState</a>
<a id="417" href="Ledger.NewPP.html#364" class="Function">updatePPUp</a> <a id="428" href="Ledger.NewPP.html#428" class="Bound">pparams</a> <a id="436" class="Keyword">record</a> <a id="443" class="Symbol">{</a> <a id="445" href="Ledger.PPUp.html#558" class="Field">fpup</a> <a id="450" class="Symbol">=</a> <a id="452" href="Ledger.NewPP.html#452" class="Bound">fpup</a> <a id="457" class="Symbol">}</a>
  <a id="461" class="Keyword">with</a> <a id="466" href="Axiom.Set.html#11220" class="Function">allᵇ</a> <a id="471" href="Class.Decidable.Core.html#966" class="Function Operator">¿</a> <a id="473" href="Ledger.PPUp.html#788" class="Function">isViableUpdate</a> <a id="488" href="Ledger.NewPP.html#428" class="Bound">pparams</a> <a id="496" href="Class.Decidable.Core.html#966" class="Function Operator">¿¹</a> <a id="499" class="Symbol">(</a><a id="500" href="Class.IsSet.html#959" class="Function">range</a> <a id="506" href="Ledger.NewPP.html#452" class="Bound">fpup</a><a id="510" class="Symbol">)</a>
<a id="512" class="Symbol">...</a> <a id="516" class="Symbol">|</a> <a id="518" href="Agda.Builtin.Bool.html#192" class="InductiveConstructor">false</a>  <a id="525" class="Symbol">=</a> <a id="527" class="Keyword">record</a> <a id="534" class="Symbol">{</a> <a id="536" href="Ledger.PPUp.html#528" class="Field">pup</a> <a id="540" class="Symbol">=</a> <a id="542" href="Axiom.Set.Map.html#2671" class="Function">∅ᵐ</a>    <a id="548" class="Symbol">;</a> <a id="550" href="Ledger.PPUp.html#558" class="Field">fpup</a> <a id="555" class="Symbol">=</a> <a id="557" href="Axiom.Set.Map.html#2671" class="Function">∅ᵐ</a> <a id="560" class="Symbol">}</a>
<a id="562" class="Symbol">...</a> <a id="566" class="Symbol">|</a> <a id="568" href="Agda.Builtin.Bool.html#198" class="InductiveConstructor">true</a>   <a id="575" class="Symbol">=</a> <a id="577" class="Keyword">record</a> <a id="584" class="Symbol">{</a> <a id="586" href="Ledger.PPUp.html#528" class="Field">pup</a> <a id="590" class="Symbol">=</a> <a id="592" class="Bound">fpup</a>  <a id="598" class="Symbol">;</a> <a id="600" href="Ledger.PPUp.html#558" class="Field">fpup</a> <a id="605" class="Symbol">=</a> <a id="607" href="Axiom.Set.Map.html#2671" class="Function">∅ᵐ</a> <a id="610" class="Symbol">}</a>

<a id="votedValue"></a><a id="613" href="Ledger.NewPP.html#613" class="Function">votedValue</a> <a id="624" class="Symbol">:</a> <a id="626" href="Ledger.Transaction.html#2438" class="Function">ProposedPPUpdates</a> <a id="644" class="Symbol">→</a> <a id="646" href="Ledger.PParams.html#1570" class="Record">PParams</a> <a id="654" class="Symbol">→</a> <a id="656" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a> <a id="658" class="Symbol">→</a> <a id="660" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="666" href="Ledger.PParams.html#14522" class="Function">PParamsUpdate</a>
<a id="680" href="Ledger.NewPP.html#613" class="Function">votedValue</a> <a id="691" href="Ledger.NewPP.html#691" class="Bound">pup</a> <a id="695" href="Ledger.NewPP.html#695" class="Bound">pparams</a> <a id="703" href="Ledger.NewPP.html#703" class="Bound">quorum</a> <a id="710" class="Symbol">=</a>
  <a id="714" href="Function.Base.html#4042" class="Function Operator">case</a> <a id="719" href="Axiom.Set.html#10895" class="Function">any?</a> <a id="724" class="Symbol">(λ</a> <a id="727" href="Ledger.NewPP.html#727" class="Bound">u</a> <a id="729" class="Symbol">→</a> <a id="731" href="abstract-set-theory.FiniteSetTheory.html#2063" class="Function">lengthˢ</a> <a id="739" class="Symbol">(</a><a id="740" href="Ledger.NewPP.html#691" class="Bound">pup</a> <a id="744" href="Axiom.Set.Map.html#14048" class="Function Operator">∣^</a> <a id="747" href="Axiom.Set.html#5718" class="Function">fromList</a> <a id="756" href="Data.List.Base.html#5205" class="Function Operator">[</a> <a id="758" href="Ledger.NewPP.html#727" class="Bound">u</a> <a id="760" href="Data.List.Base.html#5205" class="Function Operator">]</a><a id="761" class="Symbol">)</a> <a id="763" href="Data.Nat.Properties.html#6775" class="Function Operator">≥?</a> <a id="766" href="Ledger.NewPP.html#703" class="Bound">quorum</a><a id="772" class="Symbol">)</a> <a id="774" class="Symbol">(</a><a id="775" href="Class.IsSet.html#959" class="Function">range</a> <a id="781" href="Ledger.NewPP.html#691" class="Bound">pup</a><a id="784" class="Symbol">)</a> <a id="786" href="Function.Base.html#4042" class="Function Operator">of</a>


    <a id="795" class="Symbol">λ</a>  <a id="798" class="Keyword">where</a>


       <a id="813" class="Symbol">(</a><a id="814" href="Relation.Nullary.Decidable.Core.html#2031" class="InductiveConstructor">no</a>  <a id="818" class="Symbol">_)</a>        <a id="828" class="Symbol">→</a> <a id="830" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a>
       <a id="845" class="Symbol">(</a><a id="846" href="Relation.Nullary.Decidable.Core.html#1994" class="InductiveConstructor">yes</a> <a id="850" class="Symbol">(</a><a id="851" href="Ledger.NewPP.html#851" class="Bound">u</a> <a id="853" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="855" class="Symbol">_))</a>  <a id="860" class="Symbol">→</a> <a id="862" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="867" href="Ledger.NewPP.html#851" class="Bound">u</a>


<a id="871" class="Keyword">instance</a>
  <a id="882" class="Keyword">unquoteDecl</a> <a id="HasCast-NewPParamState"></a><a id="894" href="Ledger.NewPP.html#894" class="Function">HasCast-NewPParamState</a> <a id="917" class="Symbol">=</a> <a id="919" href="stdlib-classes.Class.HasCast.Derive.html#2690" class="Function">derive-HasCast</a>
    <a id="938" href="Data.List.Base.html#5205" class="Function Operator">[</a> <a id="940" class="Symbol">(</a><a id="941" class="Keyword">quote</a> <a id="947" href="Ledger.NewPP.html#275" class="Record">NewPParamState</a> <a id="962" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="964" href="Ledger.NewPP.html#894" class="Function">HasCast-NewPParamState</a><a id="986" class="Symbol">)</a> <a id="988" href="Data.List.Base.html#5205" class="Function Operator">]</a>

<a id="991" class="Keyword">private</a> <a id="999" class="Keyword">variable</a>
  <a id="1010" href="Ledger.NewPP.html#1010" class="Generalizable">Γ</a> <a id="1012" class="Symbol">:</a> <a id="1014" href="Ledger.NewPP.html#230" class="Record">NewPParamEnv</a>
  <a id="1029" href="Ledger.NewPP.html#1029" class="Generalizable">s</a> <a id="1031" href="Ledger.NewPP.html#1031" class="Generalizable">s&#39;</a> <a id="1034" class="Symbol">:</a> <a id="1036" href="Ledger.NewPP.html#275" class="Record">NewPParamState</a>
  <a id="1053" href="Ledger.NewPP.html#1053" class="Generalizable">upd</a> <a id="1057" class="Symbol">:</a> <a id="1059" href="Ledger.PParams.html#14522" class="Function">PParamsUpdate</a>

<a id="1074" class="Keyword">data</a> <a id="_⊢_⇀⦇_,NEWPP⦈_"></a><a id="1079" href="Ledger.NewPP.html#1079" class="Datatype Operator">_⊢_⇀⦇_,NEWPP⦈_</a> <a id="1094" class="Symbol">:</a> <a id="1096" href="Ledger.NewPP.html#230" class="Record">NewPParamEnv</a> <a id="1109" class="Symbol">→</a> <a id="1111" href="Ledger.NewPP.html#275" class="Record">NewPParamState</a> <a id="1126" class="Symbol">→</a> <a id="1128" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="1134" href="Ledger.PParams.html#14522" class="Function">PParamsUpdate</a> <a id="1148" class="Symbol">→</a> <a id="1150" href="Ledger.NewPP.html#275" class="Record">NewPParamState</a> <a id="1165" class="Symbol">→</a> <a id="1167" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="1172" class="Keyword">where</a>


  <a id="_⊢_⇀⦇_,NEWPP⦈_.NEWPP-Accept"></a><a id="1182" href="Ledger.NewPP.html#1182" class="InductiveConstructor">NEWPP-Accept</a> <a id="1195" class="Symbol">:</a> <a id="1197" class="Symbol">∀</a> <a id="1199" class="Symbol">{</a><a id="1200" href="Ledger.NewPP.html#1200" class="Bound">Γ</a><a id="1201" class="Symbol">}</a> <a id="1203" class="Symbol">→</a> <a id="1205" class="Keyword">let</a> <a id="1209" class="Keyword">open</a> <a id="1214" href="Ledger.NewPP.html#275" class="Module">NewPParamState</a> <a id="1229" href="Ledger.NewPP.html#1029" class="Generalizable">s</a><a id="1230" class="Symbol">;</a> <a id="1232" href="Ledger.NewPP.html#1232" class="Bound">newpp</a> <a id="1238" class="Symbol">=</a> <a id="1240" href="Ledger.PParams.html#14088" class="Function">applyUpdate</a> <a id="1252" href="Ledger.NewPP.html#315" class="Function">pparams</a> <a id="1260" href="Ledger.NewPP.html#1053" class="Generalizable">upd</a> <a id="1264" class="Keyword">in</a>
    <a id="1271" href="Ledger.PPUp.html#709" class="Function">viablePParams</a> <a id="1285" href="Ledger.NewPP.html#1232" class="Bound">newpp</a>
    <a id="1295" href="iog-prelude.Prelude.InferenceRules.html#217" class="Function Operator">────────────────────────────────</a>
    <a id="1332" href="Ledger.NewPP.html#1200" class="Bound">Γ</a> <a id="1334" href="Ledger.NewPP.html#1079" class="Datatype Operator">⊢</a> <a id="1336" href="Ledger.NewPP.html#1029" class="Generalizable">s</a> <a id="1338" href="Ledger.NewPP.html#1079" class="Datatype Operator">⇀⦇</a> <a id="1341" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="1346" href="Ledger.NewPP.html#1053" class="Generalizable">upd</a> <a id="1350" href="Ledger.NewPP.html#1079" class="Datatype Operator">,NEWPP⦈</a> <a id="1358" href="Ledger.Prelude.html#2441" class="Function Operator">⟦</a> <a id="1360" href="Ledger.NewPP.html#1232" class="Bound">newpp</a> <a id="1366" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1368" href="Ledger.NewPP.html#364" class="Function">updatePPUp</a> <a id="1379" href="Ledger.NewPP.html#1232" class="Bound">newpp</a> <a id="1385" href="Ledger.NewPP.html#338" class="Function">ppup</a> <a id="1390" href="Ledger.Prelude.html#2441" class="Function Operator">⟧</a>

  <a id="_⊢_⇀⦇_,NEWPP⦈_.NEWPP-Reject"></a><a id="1395" href="Ledger.NewPP.html#1395" class="InductiveConstructor">NEWPP-Reject</a> <a id="1408" class="Symbol">:</a> <a id="1410" class="Symbol">∀</a> <a id="1412" class="Symbol">{</a><a id="1413" href="Ledger.NewPP.html#1413" class="Bound">Γ</a><a id="1414" class="Symbol">}</a> <a id="1416" class="Symbol">→</a>
    <a id="1422" href="Ledger.NewPP.html#1413" class="Bound">Γ</a> <a id="1424" href="Ledger.NewPP.html#1079" class="Datatype Operator">⊢</a> <a id="1426" href="Ledger.NewPP.html#1029" class="Generalizable">s</a> <a id="1428" href="Ledger.NewPP.html#1079" class="Datatype Operator">⇀⦇</a> <a id="1431" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a> <a id="1439" href="Ledger.NewPP.html#1079" class="Datatype Operator">,NEWPP⦈</a> <a id="1447" href="Ledger.NewPP.html#1029" class="Generalizable">s</a>

</pre></body></html>