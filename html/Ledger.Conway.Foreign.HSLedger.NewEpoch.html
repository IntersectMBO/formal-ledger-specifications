<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>Ledger.Conway.Foreign.HSLedger.NewEpoch</title><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.css"><link rel="stylesheet" href="Agda.css"><script src="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.js"></script><script src="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/contrib/auto-render.min.js"></script><script src="AgdaKaTeX.js" defer=""></script></head><body><pre class="Agda"><a id="1" class="Keyword">module</a> <a id="8" href="Ledger.Conway.Foreign.HSLedger.NewEpoch.html" class="Module">Ledger.Conway.Foreign.HSLedger.NewEpoch</a> <a id="48" class="Keyword">where</a>

<a id="55" class="Keyword">import</a> <a id="62" href="Data.Integer.html" class="Module">Data.Integer</a> <a id="75" class="Symbol">as</a> <a id="78" class="Module">ℤ</a>

<a id="81" class="Keyword">open</a> <a id="86" class="Keyword">import</a> <a id="93" href="Ledger.Conway.Foreign.HSLedger.Address.html" class="Module">Ledger.Conway.Foreign.HSLedger.Address</a>
<a id="132" class="Keyword">open</a> <a id="137" class="Keyword">import</a> <a id="144" href="Ledger.Conway.Foreign.HSLedger.BaseTypes.html" class="Module">Ledger.Conway.Foreign.HSLedger.BaseTypes</a>
<a id="185" class="Keyword">open</a> <a id="190" class="Keyword">import</a> <a id="197" href="Ledger.Conway.Foreign.HSLedger.Epoch.html" class="Module">Ledger.Conway.Foreign.HSLedger.Epoch</a>

<a id="235" class="Keyword">open</a> <a id="240" class="Keyword">import</a> <a id="247" href="Ledger.Conway.Conformance.Epoch.html" class="Module">Ledger.Conway.Conformance.Epoch</a> <a id="279" href="Function.Base.html#4736" class="Function">it</a> <a id="282" href="Function.Base.html#4736" class="Function">it</a>
<a id="285" class="Keyword">open</a> <a id="290" class="Keyword">import</a> <a id="297" href="Ledger.Conway.Conformance.Epoch.Properties.html" class="Module">Ledger.Conway.Conformance.Epoch.Properties</a> <a id="340" href="Function.Base.html#4736" class="Function">it</a> <a id="343" href="Function.Base.html#4736" class="Function">it</a>

<a id="347" class="Keyword">open</a> <a id="352" class="Keyword">import</a> <a id="359" href="Ledger.Prelude.Foreign.HSTypes.html" class="Module">Ledger.Prelude.Foreign.HSTypes</a> <a id="390" class="Keyword">hiding</a> <a id="397" class="Symbol">(</a><a id="398" href="Ledger.Prelude.Foreign.HSTypes.html#1171" class="Datatype">ComputationResult</a><a id="415" class="Symbol">)</a>

<a id="418" class="Keyword">open</a> <a id="423" class="Keyword">import</a> <a id="430" href="Ledger.Prelude.Foreign.Util.html" class="Module">Ledger.Prelude.Foreign.Util</a>

<a id="459" class="Keyword">record</a> <a id="HsRewardUpdate"></a><a id="466" href="Ledger.Conway.Foreign.HSLedger.NewEpoch.html#466" class="Record">HsRewardUpdate</a> <a id="481" class="Symbol">:</a> <a id="483" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="488" class="Keyword">where</a>
  <a id="496" class="Keyword">field</a> <a id="HsRewardUpdate.Δt"></a><a id="502" href="Ledger.Conway.Foreign.HSLedger.NewEpoch.html#502" class="Field">Δt</a> <a id="HsRewardUpdate.Δr"></a><a id="505" href="Ledger.Conway.Foreign.HSLedger.NewEpoch.html#505" class="Field">Δr</a> <a id="HsRewardUpdate.Δf"></a><a id="508" href="Ledger.Conway.Foreign.HSLedger.NewEpoch.html#508" class="Field">Δf</a> <a id="511" class="Symbol">:</a> <a id="513" href="Agda.Builtin.Int.html#245" class="Datatype">ℤ</a>
        <a id="HsRewardUpdate.rs"></a><a id="523" href="Ledger.Conway.Foreign.HSLedger.NewEpoch.html#523" class="Field">rs</a> <a id="526" class="Symbol">:</a> <a id="528" href="Foreign.HaskellTypes.html#593" class="Function">HsType</a> <a id="535" class="Symbol">(</a><a id="536" href="Ledger.Core.Specification.Address.html#260" class="Datatype">Credential</a> <a id="547" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="549" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a><a id="553" class="Symbol">)</a>
<a id="555" class="Symbol">{-#</a> <a id="559" class="Keyword">FOREIGN</a> <a id="567" class="Pragma">GHC</a>
  <a id="573" class="Pragma">data</a> <a id="578" class="Pragma">HsRewardUpdate</a> <a id="593" class="Pragma">=</a> <a id="595" class="Pragma">MkRewardUpdate</a>
    <a id="614" class="Pragma">{</a> <a id="616" class="Pragma">deltaT</a>  <a id="624" class="Pragma">::</a> <a id="627" class="Pragma">Integer</a>
    <a id="639" class="Pragma">,</a> <a id="641" class="Pragma">deltaR</a>  <a id="649" class="Pragma">::</a> <a id="652" class="Pragma">Integer</a>
    <a id="664" class="Pragma">,</a> <a id="666" class="Pragma">deltaF</a>  <a id="674" class="Pragma">::</a> <a id="677" class="Pragma">Integer</a>
    <a id="689" class="Pragma">,</a> <a id="691" class="Pragma">rs</a>      <a id="699" class="Pragma">::</a>
        <a id="710" class="Pragma">MAlonzo.Code.Ledger.Prelude.Foreign.HSTypes.HSMap</a>
          <a id="770" class="Pragma">MAlonzo.Code.Ledger.Conway.Foreign.HSLedger.Address.Credential</a>
          <a id="843" class="Pragma">Integer</a>
    <a id="855" class="Pragma">}</a>
    <a id="861" class="Pragma">deriving</a> <a id="870" class="Pragma">(Eq,</a> <a id="875" class="Pragma">Show)</a>
<a id="881" class="Symbol">#-}</a>
<a id="885" class="Symbol">{-#</a> <a id="889" class="Keyword">COMPILE</a> <a id="897" class="Keyword">GHC</a> <a id="901" href="Ledger.Conway.Foreign.HSLedger.NewEpoch.html#466" class="Record">HsRewardUpdate</a> <a id="916" class="Pragma">=</a> <a id="918" class="Pragma">data</a> <a id="923" class="Pragma">HsRewardUpdate</a> <a id="938" class="Pragma">(MkRewardUpdate)</a> <a id="955" class="Symbol">#-}</a>

<a id="960" class="Keyword">instance</a>
  <a id="HsTy-RewardUpdate"></a><a id="971" href="Ledger.Conway.Foreign.HSLedger.NewEpoch.html#971" class="Function">HsTy-RewardUpdate</a> <a id="989" class="Symbol">:</a> <a id="991" href="Foreign.HaskellTypes.html#532" class="Record">HasHsType</a> <a id="1001" href="Ledger.Conway.Conformance.Epoch.html#806" class="Record">RewardUpdate</a>
  <a id="1016" href="Ledger.Conway.Foreign.HSLedger.NewEpoch.html#971" class="Function">HsTy-RewardUpdate</a> <a id="1034" class="Symbol">.</a><a id="1035" href="Foreign.HaskellTypes.html#579" class="Field">HasHsType.HsType</a> <a id="1052" class="Symbol">=</a> <a id="1054" href="Ledger.Conway.Foreign.HSLedger.NewEpoch.html#466" class="Record">HsRewardUpdate</a>

  <a id="1072" class="Comment">-- manual, since we want to throw an error on non-zero update</a>
  <a id="Conv-RewardUpdate"></a><a id="1136" href="Ledger.Conway.Foreign.HSLedger.NewEpoch.html#1136" class="Function">Conv-RewardUpdate</a> <a id="1154" class="Symbol">:</a> <a id="1156" href="Foreign.Convertible.html#103" class="Record">Convertible</a> <a id="1168" href="Ledger.Conway.Conformance.Epoch.html#806" class="Record">RewardUpdate</a> <a id="1181" href="Ledger.Conway.Foreign.HSLedger.NewEpoch.html#466" class="Record">HsRewardUpdate</a>
  <a id="1198" href="Ledger.Conway.Foreign.HSLedger.NewEpoch.html#1136" class="Function">Conv-RewardUpdate</a> <a id="1216" class="Symbol">.</a><a id="1217" href="Foreign.Convertible.html#149" class="Field">to</a>   <a id="1222" href="Ledger.Conway.Foreign.HSLedger.NewEpoch.html#1222" class="Bound">ru</a> <a id="1225" class="Symbol">=</a> <a id="1227" class="Keyword">record</a> <a id="1234" class="Symbol">{</a> <a id="1236" href="Ledger.Conway.Foreign.HSLedger.NewEpoch.html#1236" class="Module">RewardUpdate</a> <a id="1249" href="Ledger.Conway.Foreign.HSLedger.NewEpoch.html#1222" class="Bound">ru</a><a id="1251" class="Symbol">;</a> <a id="1253" href="Ledger.Conway.Foreign.HSLedger.NewEpoch.html#523" class="Field">rs</a> <a id="1256" class="Symbol">=</a> <a id="1258" href="Foreign.Convertible.html#149" class="Field">to</a> <a id="1261" class="Symbol">(</a><a id="1262" href="Ledger.Conway.Foreign.HSLedger.NewEpoch.html#1222" class="Bound">ru</a> <a id="1265" class="Symbol">.</a><a id="1266" href="Ledger.Conway.Conformance.Epoch.html#886" class="Field">RewardUpdate.rs</a><a id="1281" class="Symbol">)</a> <a id="1283" class="Symbol">}</a>
  <a id="1287" href="Ledger.Conway.Foreign.HSLedger.NewEpoch.html#1136" class="Function">Conv-RewardUpdate</a> <a id="1305" class="Symbol">.</a><a id="1306" href="Foreign.Convertible.html#170" class="Field">from</a> <a id="1311" href="Ledger.Conway.Foreign.HSLedger.NewEpoch.html#1311" class="Bound">ru</a> <a id="1314" class="Symbol">=</a>
    <a id="1320" href="Function.Base.html#4042" class="Function Operator">case</a> <a id="1325" class="Symbol">(</a><a id="1326" class="Keyword">let</a> <a id="1330" class="Keyword">open</a> <a id="1335" href="Ledger.Conway.Foreign.HSLedger.NewEpoch.html#466" class="Module">HsRewardUpdate</a> <a id="1350" href="Ledger.Conway.Foreign.HSLedger.NewEpoch.html#1311" class="Bound">ru</a> <a id="1353" class="Keyword">in</a> <a id="1356" href="Class.Decidable.Core.html#461" class="Function Operator">¿</a> <a id="1358" href="Ledger.Conway.Foreign.HSLedger.NewEpoch.html#502" class="Field">Δt</a> <a id="1361" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="1363" href="Ledger.Conway.Foreign.HSLedger.NewEpoch.html#505" class="Field">Δr</a> <a id="1366" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="1368" href="Ledger.Conway.Foreign.HSLedger.NewEpoch.html#508" class="Field">Δf</a> <a id="1371" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="1373" href="Agda.Builtin.Int.html#263" class="InductiveConstructor Operator">ℤ.+</a> <a id="1377" class="Symbol">(</a><a id="1378" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">indexedSumᵛ&#39;</a> <a id="1391" class="Symbol">{</a><a id="1392" class="Argument">A</a> <a id="1394" class="Symbol">=</a> <a id="1396" href="Ledger.Core.Specification.Address.html#260" class="Datatype">Credential</a><a id="1406" class="Symbol">}</a> <a id="1408" class="Symbol">(λ</a> <a id="1411" href="Ledger.Conway.Foreign.HSLedger.NewEpoch.html#1411" class="Bound">x</a> <a id="1413" class="Symbol">→</a> <a id="1415" href="Ledger.Conway.Foreign.HSLedger.NewEpoch.html#1411" class="Bound">x</a><a id="1416" class="Symbol">)</a> <a id="1418" class="Symbol">(</a><a id="1419" href="Foreign.Convertible.html#170" class="Field">from</a> <a id="1424" href="Ledger.Conway.Foreign.HSLedger.NewEpoch.html#523" class="Field">rs</a><a id="1426" class="Symbol">))</a> <a id="1429" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="1431" href="Data.Integer.Base.html#1545" class="Function">ℤ.0ℤ</a> <a id="1436" href="Class.Decidable.Core.html#461" class="Function Operator">¿</a><a id="1437" class="Symbol">)</a> <a id="1439" href="Function.Base.html#4042" class="Function Operator">of</a> <a id="1442" class="Symbol">λ</a> <a id="1444" class="Keyword">where</a>
      <a id="1456" class="Symbol">(</a><a id="1457" href="Relation.Nullary.Decidable.Core.html#1994" class="InductiveConstructor">yes</a> <a id="1461" href="Ledger.Conway.Foreign.HSLedger.NewEpoch.html#1461" class="Bound">p</a><a id="1462" class="Symbol">)</a> <a id="1464" class="Symbol">→</a> <a id="1466" class="Keyword">record</a> <a id="1473" class="Symbol">{</a> <a id="1475" href="Ledger.Conway.Foreign.HSLedger.NewEpoch.html#1475" class="Module">HsRewardUpdate</a> <a id="1490" href="Ledger.Conway.Foreign.HSLedger.NewEpoch.html#1311" class="Bound">ru</a> <a id="1493" class="Symbol">;</a> <a id="1495" href="Ledger.Conway.Conformance.Epoch.html#886" class="Field">rs</a> <a id="1498" class="Symbol">=</a> <a id="1500" href="Foreign.Convertible.html#170" class="Field">from</a> <a id="1505" class="Symbol">(</a><a id="1506" href="Ledger.Conway.Foreign.HSLedger.NewEpoch.html#1311" class="Bound">ru</a> <a id="1509" class="Symbol">.</a><a id="1510" href="Ledger.Conway.Foreign.HSLedger.NewEpoch.html#523" class="Field">HsRewardUpdate.rs</a><a id="1527" class="Symbol">)</a> <a id="1529" class="Symbol">}</a>
      <a id="1537" class="Symbol">(</a><a id="1538" href="Relation.Nullary.Decidable.Core.html#2031" class="InductiveConstructor">no</a> <a id="1541" href="Ledger.Conway.Foreign.HSLedger.NewEpoch.html#1541" class="Bound">¬p</a><a id="1543" class="Symbol">)</a> <a id="1545" class="Symbol">→</a> <a id="1547" href="Ledger.Prelude.Foreign.Util.html#83" class="Postulate">error</a> <a id="1553" class="String">&quot;Formal Spec: cannot make a non-zero reward update&quot;</a>

  <a id="HsTy-NewEpochState"></a><a id="1608" href="Ledger.Conway.Foreign.HSLedger.NewEpoch.html#1608" class="Function">HsTy-NewEpochState</a> <a id="1627" class="Symbol">=</a> <a id="1629" href="Foreign.HaskellTypes.Deriving.html#11530" class="Macro Operator">autoHsType</a> <a id="1640" href="Ledger.Conway.Conformance.Epoch.html#1363" class="Record">NewEpochState</a> <a id="1654" href="Foreign.HaskellTypes.Deriving.html#11530" class="Macro Operator">⊣</a> <a id="1656" href="Foreign.HaskellTypes.Deriving.html#3237" class="Function">withConstructor</a> <a id="1672" class="String">&quot;MkNewEpochState&quot;</a>
  <a id="Conv-NewEpochState"></a><a id="1692" href="Ledger.Conway.Foreign.HSLedger.NewEpoch.html#1692" class="Function">Conv-NewEpochState</a> <a id="1711" class="Symbol">=</a> <a id="1713" href="Foreign.Convertible.Deriving.html#6819" class="Macro">autoConvert</a> <a id="1725" href="Ledger.Conway.Conformance.Epoch.html#1363" class="Record">NewEpochState</a>

<a id="newepoch-step"></a><a id="1740" href="Ledger.Conway.Foreign.HSLedger.NewEpoch.html#1740" class="Function">newepoch-step</a> <a id="1754" class="Symbol">:</a> <a id="1756" href="Foreign.HaskellTypes.html#593" class="Function">HsType</a> <a id="1763" class="Symbol">(</a><a id="1764" href="Agda.Builtin.Unit.html#175" class="Record">⊤</a> <a id="1766" class="Symbol">→</a> <a id="1768" href="Ledger.Conway.Conformance.Epoch.html#1363" class="Record">NewEpochState</a> <a id="1782" class="Symbol">→</a> <a id="1784" href="Ledger.Core.Specification.Epoch.html#598" class="Function">Epoch</a> <a id="1790" class="Symbol">→</a> <a id="1792" href="Interface.ComputationalRelation.html#235" class="Datatype">ComputationResult</a> <a id="1810" href="Data.Empty.html#914" class="Function">⊥</a> <a id="1812" href="Ledger.Conway.Conformance.Epoch.html#1363" class="Record">NewEpochState</a><a id="1825" class="Symbol">)</a>
<a id="1827" href="Ledger.Conway.Foreign.HSLedger.NewEpoch.html#1740" class="Function">newepoch-step</a> <a id="1841" class="Symbol">=</a> <a id="1843" href="Foreign.Convertible.html#149" class="Field">to</a> <a id="1846" class="Symbol">(</a><a id="1847" href="Interface.ComputationalRelation.html#2976" class="Function">compute</a> <a id="1855" href="Ledger.Conway.Conformance.Epoch.Properties.html#3761" class="Function">Computational-NEWEPOCH</a><a id="1877" class="Symbol">)</a>

<a id="1880" class="Symbol">{-#</a> <a id="1884" class="Keyword">COMPILE</a> <a id="1892" class="Keyword">GHC</a> <a id="1896" href="Ledger.Conway.Foreign.HSLedger.NewEpoch.html#1740" class="Function">newepoch-step</a> <a id="1910" class="Pragma">as</a> <a id="1913" class="Pragma">newEpochStep</a> <a id="1926" class="Symbol">#-}</a>
</pre></body></html>