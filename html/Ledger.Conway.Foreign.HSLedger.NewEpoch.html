<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>Ledger.Conway.Foreign.HSLedger.NewEpoch</title><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.css"><link rel="stylesheet" href="Agda.css"><script src="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.js"></script><script src="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/contrib/auto-render.min.js"></script><script src="AgdaKaTeX.js" defer=""></script></head><body><pre class="Agda"><a id="1" class="Keyword">module</a> <a id="8" href="Ledger.Conway.Foreign.HSLedger.NewEpoch.html" class="Module">Ledger.Conway.Foreign.HSLedger.NewEpoch</a> <a id="48" class="Keyword">where</a>

<a id="55" class="Keyword">open</a> <a id="60" class="Keyword">import</a> <a id="67" href="Ledger.Conway.Foreign.HSLedger.BaseTypes.html" class="Module">Ledger.Conway.Foreign.HSLedger.BaseTypes</a>
<a id="108" class="Keyword">open</a> <a id="113" class="Keyword">import</a> <a id="120" href="Ledger.Conway.Foreign.HSLedger.Epoch.html" class="Module">Ledger.Conway.Foreign.HSLedger.Epoch</a>
<a id="157" class="Keyword">open</a> <a id="162" class="Keyword">import</a> <a id="169" href="Ledger.Conway.Foreign.HSLedger.Rewards.html" class="Module">Ledger.Conway.Foreign.HSLedger.Rewards</a>

<a id="209" class="Keyword">open</a> <a id="214" class="Keyword">import</a> <a id="221" href="Ledger.Conway.Conformance.Equivalence.Convert.html" class="Module">Ledger.Conway.Conformance.Equivalence.Convert</a>
<a id="267" class="Keyword">open</a> <a id="272" class="Keyword">import</a> <a id="279" href="Ledger.Conway.Conformance.Epoch.html" class="Module">Ledger.Conway.Conformance.Epoch</a> <a id="311" href="Function.Base.html#4755" class="Function">it</a> <a id="314" href="Function.Base.html#4755" class="Function">it</a>
<a id="317" class="Keyword">open</a> <a id="322" class="Keyword">import</a> <a id="329" href="Ledger.Conway.Conformance.Epoch.Properties.html" class="Module">Ledger.Conway.Conformance.Epoch.Properties</a> <a id="372" href="Function.Base.html#4755" class="Function">it</a> <a id="375" href="Function.Base.html#4755" class="Function">it</a>

<a id="379" class="Keyword">import</a> <a id="386" href="Data.String.html" class="Module">Data.String</a> <a id="398" class="Symbol">as</a> <a id="401" class="Module">S</a>

<a id="404" class="Keyword">instance</a>
  <a id="Show-NEWEPOCH"></a><a id="415" href="Ledger.Conway.Foreign.HSLedger.NewEpoch.html#415" class="Function">Show-NEWEPOCH</a> <a id="429" class="Symbol">:</a> <a id="431" class="Symbol">∀</a> <a id="433" class="Symbol">{</a><a id="434" href="Ledger.Conway.Foreign.HSLedger.NewEpoch.html#434" class="Bound">eps</a> <a id="438" href="Ledger.Conway.Foreign.HSLedger.NewEpoch.html#438" class="Bound">e</a> <a id="440" href="Ledger.Conway.Foreign.HSLedger.NewEpoch.html#440" class="Bound">eps&#39;</a><a id="444" class="Symbol">}</a> <a id="446" class="Symbol">→</a> <a id="448" href="Class.Show.Core.html#125" class="Record">Show</a> <a id="453" class="Symbol">(_</a> <a id="456" href="Ledger.Conway.Conformance.Epoch.html#7307" class="Datatype Operator">⊢</a> <a id="458" href="Ledger.Conway.Foreign.HSLedger.NewEpoch.html#434" class="Bound">eps</a> <a id="462" href="Ledger.Conway.Conformance.Epoch.html#7307" class="Datatype Operator">⇀⦇</a> <a id="465" href="Ledger.Conway.Foreign.HSLedger.NewEpoch.html#438" class="Bound">e</a> <a id="467" href="Ledger.Conway.Conformance.Epoch.html#7307" class="Datatype Operator">,NEWEPOCH⦈</a> <a id="478" href="Ledger.Conway.Foreign.HSLedger.NewEpoch.html#440" class="Bound">eps&#39;</a><a id="482" class="Symbol">)</a>
  <a id="486" href="Ledger.Conway.Foreign.HSLedger.NewEpoch.html#415" class="Function">Show-NEWEPOCH</a> <a id="500" class="Symbol">.</a><a id="501" href="Class.Show.Core.html#187" class="Field">show</a> <a id="506" class="Symbol">(</a><a id="507" href="Ledger.Conway.Conformance.Epoch.html#7385" class="InductiveConstructor">NEWEPOCH-New</a> <a id="520" class="Symbol">(_</a> <a id="523" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="525" href="Ledger.Conway.Foreign.HSLedger.NewEpoch.html#525" class="Bound">e</a><a id="526" class="Symbol">))</a>        <a id="536" class="Symbol">=</a> <a id="538" class="String">&quot;NEWEPOCH-New &quot;</a> <a id="554" href="Data.String.Base.html#2425" class="Function Operator">S.++</a> <a id="559" href="Class.Show.Core.html#187" class="Field">show</a> <a id="564" href="Ledger.Conway.Foreign.HSLedger.NewEpoch.html#525" class="Bound">e</a>
  <a id="568" href="Ledger.Conway.Foreign.HSLedger.NewEpoch.html#415" class="Function">Show-NEWEPOCH</a> <a id="582" class="Symbol">.</a><a id="583" href="Class.Show.Core.html#187" class="Field">show</a> <a id="588" class="Symbol">(</a><a id="589" href="Ledger.Conway.Conformance.Epoch.html#7829" class="InductiveConstructor">NEWEPOCH-Not-New</a> <a id="606" href="Ledger.Conway.Foreign.HSLedger.NewEpoch.html#606" class="Bound">x</a><a id="607" class="Symbol">)</a>          <a id="618" class="Symbol">=</a> <a id="620" class="String">&quot;NEWEPOCH-Not-New&quot;</a>
  <a id="641" href="Ledger.Conway.Foreign.HSLedger.NewEpoch.html#415" class="Function">Show-NEWEPOCH</a> <a id="655" class="Symbol">.</a><a id="656" href="Class.Show.Core.html#187" class="Field">show</a> <a id="661" class="Symbol">(</a><a id="662" href="Ledger.Conway.Conformance.Epoch.html#8088" class="InductiveConstructor">NEWEPOCH-No-Reward-Update</a> <a id="688" href="Ledger.Conway.Foreign.HSLedger.NewEpoch.html#688" class="Bound">x</a><a id="689" class="Symbol">)</a> <a id="691" class="Symbol">=</a> <a id="693" class="String">&quot;NEWEPOCH-No-Reward-Update&quot;</a>

  <a id="Show-SPEC-NEWEPOCH"></a><a id="724" href="Ledger.Conway.Foreign.HSLedger.NewEpoch.html#724" class="Function">Show-SPEC-NEWEPOCH</a> <a id="743" class="Symbol">:</a> <a id="745" class="Symbol">∀</a> <a id="747" class="Symbol">{</a><a id="748" href="Ledger.Conway.Foreign.HSLedger.NewEpoch.html#748" class="Bound">eps</a> <a id="752" href="Ledger.Conway.Foreign.HSLedger.NewEpoch.html#752" class="Bound">e</a> <a id="754" href="Ledger.Conway.Foreign.HSLedger.NewEpoch.html#754" class="Bound">eps&#39;</a><a id="758" class="Symbol">}</a> <a id="760" class="Symbol">→</a> <a id="762" href="Class.Show.Core.html#125" class="Record">Show</a> <a id="767" class="Symbol">(_</a> <a id="770" href="Ledger.Conway.Specification.Epoch.html#16662" class="Datatype Operator">EpochSpec.⊢</a> <a id="782" href="Ledger.Conway.Foreign.HSLedger.NewEpoch.html#748" class="Bound">eps</a> <a id="786" href="Ledger.Conway.Specification.Epoch.html#16662" class="Datatype Operator">⇀⦇</a> <a id="789" href="Ledger.Conway.Foreign.HSLedger.NewEpoch.html#752" class="Bound">e</a> <a id="791" href="Ledger.Conway.Specification.Epoch.html#16662" class="Datatype Operator">,NEWEPOCH⦈</a> <a id="802" href="Ledger.Conway.Foreign.HSLedger.NewEpoch.html#754" class="Bound">eps&#39;</a><a id="806" class="Symbol">)</a>
  <a id="810" href="Ledger.Conway.Foreign.HSLedger.NewEpoch.html#724" class="Function">Show-SPEC-NEWEPOCH</a> <a id="829" class="Symbol">.</a><a id="830" href="Class.Show.Core.html#187" class="Field">show</a> <a id="835" class="Symbol">(</a><a id="836" href="Ledger.Conway.Specification.Epoch.html#16745" class="InductiveConstructor">EpochSpec.NEWEPOCH-New</a> <a id="859" class="Symbol">(_</a> <a id="862" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="864" href="Ledger.Conway.Foreign.HSLedger.NewEpoch.html#864" class="Bound">e</a><a id="865" class="Symbol">))</a>        <a id="875" class="Symbol">=</a> <a id="877" class="String">&quot;NEWEPOCH-New &quot;</a> <a id="893" href="Data.String.Base.html#2425" class="Function Operator">S.++</a> <a id="898" href="Class.Show.Core.html#187" class="Field">show</a> <a id="903" href="Ledger.Conway.Foreign.HSLedger.NewEpoch.html#864" class="Bound">e</a>
  <a id="907" href="Ledger.Conway.Foreign.HSLedger.NewEpoch.html#724" class="Function">Show-SPEC-NEWEPOCH</a> <a id="926" class="Symbol">.</a><a id="927" href="Class.Show.Core.html#187" class="Field">show</a> <a id="932" class="Symbol">(</a><a id="933" href="Ledger.Conway.Specification.Epoch.html#17173" class="InductiveConstructor">EpochSpec.NEWEPOCH-Not-New</a> <a id="960" href="Ledger.Conway.Foreign.HSLedger.NewEpoch.html#960" class="Bound">x</a><a id="961" class="Symbol">)</a>          <a id="972" class="Symbol">=</a> <a id="974" class="String">&quot;NEWEPOCH-Not-New&quot;</a>
  <a id="995" href="Ledger.Conway.Foreign.HSLedger.NewEpoch.html#724" class="Function">Show-SPEC-NEWEPOCH</a> <a id="1014" class="Symbol">.</a><a id="1015" href="Class.Show.Core.html#187" class="Field">show</a> <a id="1020" class="Symbol">(</a><a id="1021" href="Ledger.Conway.Specification.Epoch.html#17420" class="InductiveConstructor">EpochSpec.NEWEPOCH-No-Reward-Update</a> <a id="1057" href="Ledger.Conway.Foreign.HSLedger.NewEpoch.html#1057" class="Bound">x</a><a id="1058" class="Symbol">)</a> <a id="1060" class="Symbol">=</a> <a id="1062" class="String">&quot;NEWEPOCH-No-Reward-Update&quot;</a>

<a id="1091" class="Keyword">instance</a>
  <a id="HsTy-NewEpochState"></a><a id="1102" href="Ledger.Conway.Foreign.HSLedger.NewEpoch.html#1102" class="Function">HsTy-NewEpochState</a> <a id="1121" class="Symbol">=</a> <a id="1123" href="Foreign.HaskellTypes.Deriving.html#11530" class="Macro Operator">autoHsType</a> <a id="1134" href="Ledger.Conway.Conformance.Epoch.html#1495" class="Record">NewEpochState</a> <a id="1148" href="Foreign.HaskellTypes.Deriving.html#11530" class="Macro Operator">⊣</a> <a id="1150" href="Foreign.HaskellTypes.Deriving.html#3237" class="Function">withConstructor</a> <a id="1166" class="String">&quot;MkNewEpochState&quot;</a>
  <a id="Conv-NewEpochState"></a><a id="1186" href="Ledger.Conway.Foreign.HSLedger.NewEpoch.html#1186" class="Function">Conv-NewEpochState</a> <a id="1205" class="Symbol">=</a> <a id="1207" href="Foreign.Convertible.Deriving.html#6814" class="Macro">autoConvert</a> <a id="1219" href="Ledger.Conway.Conformance.Epoch.html#1495" class="Record">NewEpochState</a>

<a id="newepoch-step"></a><a id="1234" href="Ledger.Conway.Foreign.HSLedger.NewEpoch.html#1234" class="Function">newepoch-step</a> <a id="1248" class="Symbol">:</a> <a id="1250" href="Foreign.HaskellTypes.html#593" class="Function">HsType</a> <a id="1257" class="Symbol">(</a><a id="1258" href="Agda.Builtin.Unit.html#175" class="Record">⊤</a> <a id="1260" class="Symbol">→</a> <a id="1262" href="Ledger.Conway.Conformance.Epoch.html#1495" class="Record">NewEpochState</a> <a id="1276" class="Symbol">→</a> <a id="1278" href="Ledger.Core.Specification.Epoch.html#598" class="Function">Epoch</a> <a id="1284" class="Symbol">→</a> <a id="1286" href="Interface.ComputationalRelation.html#235" class="Datatype">ComputationResult</a> <a id="1304" href="Data.Empty.html#914" class="Function">⊥</a> <a id="1306" class="Symbol">(</a><a id="1307" href="Ledger.Conway.Conformance.Epoch.html#1495" class="Record">NewEpochState</a> <a id="1321" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="1323" href="Agda.Builtin.String.html#335" class="Postulate">String</a><a id="1329" class="Symbol">))</a>
<a id="1332" href="Ledger.Conway.Foreign.HSLedger.NewEpoch.html#1234" class="Function">newepoch-step</a> <a id="1346" class="Symbol">_</a> <a id="1348" href="Ledger.Conway.Foreign.HSLedger.NewEpoch.html#1348" class="Bound">newEpochSt</a> <a id="1359" href="Ledger.Conway.Foreign.HSLedger.NewEpoch.html#1359" class="Bound">e</a> <a id="1361" class="Symbol">=</a>
  <a id="1365" class="Keyword">let</a> <a id="1369" href="Ledger.Conway.Foreign.HSLedger.NewEpoch.html#1369" class="Bound">r</a> <a id="1371" class="Symbol">=</a> <a id="1373" href="Ledger.Conway.Conformance.Epoch.Properties.html#4727" class="Function">Computational-NEWEPOCH</a> <a id="1396" class="Symbol">.</a><a id="1397" href="Interface.ComputationalRelation.html#2879" class="Field">computeProof</a> <a id="1410" class="Symbol">_</a> <a id="1412" class="Symbol">(</a><a id="1413" href="Foreign.Convertible.html#170" class="Field">from</a> <a id="1418" href="Ledger.Conway.Foreign.HSLedger.NewEpoch.html#1348" class="Bound">newEpochSt</a><a id="1428" class="Symbol">)</a> <a id="1430" href="Ledger.Conway.Foreign.HSLedger.NewEpoch.html#1359" class="Bound">e</a>
  <a id="1434" class="Keyword">in</a> <a id="1437" href="Function.Base.html#4061" class="Function Operator">case</a> <a id="1442" href="Ledger.Conway.Foreign.HSLedger.NewEpoch.html#1369" class="Bound">r</a> <a id="1444" href="Function.Base.html#4061" class="Function Operator">of</a> <a id="1447" class="Symbol">λ</a> <a id="1449" class="Keyword">where</a>
    <a id="1459" class="Symbol">(</a><a id="1460" href="Interface.ComputationalRelation.html#308" class="InductiveConstructor">success</a> <a id="1468" class="Symbol">(</a><a id="1469" href="Ledger.Conway.Foreign.HSLedger.NewEpoch.html#1469" class="Bound">s</a> <a id="1471" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1473" href="Ledger.Conway.Foreign.HSLedger.NewEpoch.html#1473" class="Bound">p</a><a id="1474" class="Symbol">))</a> <a id="1477" class="Symbol">→</a> <a id="1479" href="Foreign.Convertible.html#149" class="Field">to</a> <a id="1482" class="Symbol">(</a><a id="1483" href="Interface.ComputationalRelation.html#308" class="InductiveConstructor">success</a> <a id="1491" class="Symbol">(</a><a id="1492" href="Ledger.Conway.Foreign.HSLedger.NewEpoch.html#1469" class="Bound">s</a> <a id="1494" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1496" href="Class.Show.Core.html#187" class="Field">show</a> <a id="1501" href="Ledger.Conway.Foreign.HSLedger.NewEpoch.html#1473" class="Bound">p</a><a id="1502" class="Symbol">))</a>

<a id="1506" class="Symbol">{-#</a> <a id="1510" class="Keyword">COMPILE</a> <a id="1518" class="Keyword">GHC</a> <a id="1522" href="Ledger.Conway.Foreign.HSLedger.NewEpoch.html#1234" class="Function">newepoch-step</a> <a id="1536" class="Pragma">as</a> <a id="1539" class="Pragma">newEpochStep</a> <a id="1552" class="Symbol">#-}</a>

<a id="1557" class="Comment">-- An alternative implementation of NEWEPOCH that connects the conformance state</a>
<a id="1638" class="Comment">-- with the specification rule.</a>

<a id="spec-newepoch-step"></a><a id="1671" href="Ledger.Conway.Foreign.HSLedger.NewEpoch.html#1671" class="Function">spec-newepoch-step</a>
  <a id="1692" class="Symbol">:</a> <a id="1694" href="Foreign.HaskellTypes.html#593" class="Function">HsType</a> <a id="1701" class="Symbol">(</a><a id="1702" href="Agda.Builtin.Unit.html#175" class="Record">⊤</a> <a id="1704" class="Symbol">→</a> <a id="1706" href="Ledger.Conway.Conformance.Epoch.html#1495" class="Record">NewEpochState</a> <a id="1720" class="Symbol">→</a> <a id="1722" href="Ledger.Core.Specification.Epoch.html#598" class="Function">Epoch</a> <a id="1728" class="Symbol">→</a> <a id="1730" href="Interface.ComputationalRelation.html#235" class="Datatype">ComputationResult</a> <a id="1748" href="Data.Empty.html#914" class="Function">⊥</a> <a id="1750" class="Symbol">(</a><a id="1751" href="Ledger.Conway.Conformance.Epoch.html#1495" class="Record">NewEpochState</a> <a id="1765" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="1767" href="Agda.Builtin.String.html#335" class="Postulate">String</a><a id="1773" class="Symbol">))</a>
<a id="1776" href="Ledger.Conway.Foreign.HSLedger.NewEpoch.html#1671" class="Function">spec-newepoch-step</a> <a id="1795" class="Symbol">_</a> <a id="1797" href="Ledger.Conway.Foreign.HSLedger.NewEpoch.html#1797" class="Bound">neSt</a> <a id="1802" href="Ledger.Conway.Foreign.HSLedger.NewEpoch.html#1802" class="Bound">e</a> <a id="1804" class="Symbol">=</a>
  <a id="1808" class="Keyword">let</a> <a id="1812" href="Ledger.Conway.Foreign.HSLedger.NewEpoch.html#1812" class="Bound">r</a> <a id="1814" class="Symbol">=</a> <a id="1816" href="Ledger.Conway.Specification.Epoch.Properties.html#6252" class="Function">EpochSpec.Computational-NEWEPOCH</a> <a id="1849" class="Symbol">.</a><a id="1850" href="Interface.ComputationalRelation.html#2879" class="Field">computeProof</a> <a id="1863" class="Symbol">_</a> <a id="1865" class="Symbol">(</a><a id="1866" href="Ledger.Conway.Conformance.Equivalence.Convert.html#452" class="Function">conv</a> <a id="1871" class="Symbol">(</a><a id="1872" href="Foreign.Convertible.html#170" class="Field">from</a> <a id="1877" href="Ledger.Conway.Foreign.HSLedger.NewEpoch.html#1797" class="Bound">neSt</a><a id="1881" class="Symbol">))</a> <a id="1884" href="Ledger.Conway.Foreign.HSLedger.NewEpoch.html#1802" class="Bound">e</a>
  <a id="1888" class="Keyword">in</a> <a id="1891" href="Function.Base.html#4061" class="Function Operator">case</a> <a id="1896" href="Ledger.Conway.Foreign.HSLedger.NewEpoch.html#1812" class="Bound">r</a> <a id="1898" href="Function.Base.html#4061" class="Function Operator">of</a> <a id="1901" class="Symbol">λ</a> <a id="1903" class="Keyword">where</a>
    <a id="1913" class="Symbol">(</a><a id="1914" href="Interface.ComputationalRelation.html#308" class="InductiveConstructor">success</a> <a id="1922" class="Symbol">(</a><a id="1923" href="Ledger.Conway.Foreign.HSLedger.NewEpoch.html#1923" class="Bound">s</a> <a id="1925" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1927" href="Ledger.Conway.Foreign.HSLedger.NewEpoch.html#1927" class="Bound">p</a><a id="1928" class="Symbol">))</a> <a id="1931" class="Symbol">→</a> <a id="1933" href="Foreign.Convertible.html#149" class="Field">to</a> <a id="1936" class="Symbol">(</a><a id="1937" href="Interface.ComputationalRelation.html#308" class="InductiveConstructor">success</a> <a id="1945" class="Symbol">(</a><a id="1946" href="Ledger.Conway.Conformance.Equivalence.Convert.html#452" class="Function">conv</a> <a id="1951" href="Ledger.Conway.Foreign.HSLedger.NewEpoch.html#1923" class="Bound">s</a> <a id="1953" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1955" href="Class.Show.Core.html#187" class="Field">show</a> <a id="1960" href="Ledger.Conway.Foreign.HSLedger.NewEpoch.html#1927" class="Bound">p</a><a id="1961" class="Symbol">))</a>

<a id="1965" class="Symbol">{-#</a> <a id="1969" class="Keyword">COMPILE</a> <a id="1977" class="Keyword">GHC</a> <a id="1981" href="Ledger.Conway.Foreign.HSLedger.NewEpoch.html#1671" class="Function">spec-newepoch-step</a> <a id="2000" class="Pragma">as</a> <a id="2003" class="Pragma">specNewEpochStep</a> <a id="2020" class="Symbol">#-}</a>
</pre></body></html>