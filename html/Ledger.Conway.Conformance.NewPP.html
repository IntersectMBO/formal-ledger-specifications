<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>Ledger.Conway.Conformance.NewPP</title><link rel="stylesheet" href="Agda.css"></head><body><pre class="Agda">
<a id="2" class="Symbol">{-#</a> <a id="6" class="Keyword">OPTIONS</a> <a id="14" class="Pragma">--safe</a> <a id="21" class="Symbol">#-}</a>

<a id="26" class="Keyword">open</a> <a id="31" class="Keyword">import</a> <a id="38" href="Relation.Nullary.Decidable.html" class="Module">Relation.Nullary.Decidable</a>

<a id="66" class="Keyword">open</a> <a id="71" class="Keyword">import</a> <a id="78" href="Ledger.Prelude.html" class="Module">Ledger.Prelude</a>
<a id="93" class="Keyword">open</a> <a id="98" class="Keyword">import</a> <a id="105" href="Ledger.Transaction.html" class="Module">Ledger.Transaction</a>

<a id="125" class="Keyword">module</a> <a id="132" href="Ledger.Conway.Conformance.NewPP.html" class="Module">Ledger.Conway.Conformance.NewPP</a> <a id="164" class="Symbol">(</a><a id="165" href="Ledger.Conway.Conformance.NewPP.html#165" class="Bound">txs</a> <a id="169" class="Symbol">:</a> <a id="171" class="Symbol">_)</a> <a id="174" class="Symbol">(</a><a id="175" class="Keyword">open</a> <a id="180" href="Ledger.Transaction.html#867" class="Module">TransactionStructure</a> <a id="201" href="Ledger.Conway.Conformance.NewPP.html#165" class="Bound">txs</a><a id="204" class="Symbol">)</a> <a id="206" class="Keyword">where</a>

<a id="213" class="Keyword">open</a> <a id="218" class="Keyword">import</a> <a id="225" href="Ledger.Conway.Conformance.PPUp.html" class="Module">Ledger.Conway.Conformance.PPUp</a> <a id="256" href="Ledger.Conway.Conformance.NewPP.html#165" class="Bound">txs</a>

<a id="261" class="Keyword">record</a> <a id="NewPParamEnv"></a><a id="268" href="Ledger.Conway.Conformance.NewPP.html#268" class="Record">NewPParamEnv</a> <a id="281" class="Symbol">:</a> <a id="283" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="288" class="Keyword">where</a>
<a id="294" class="Comment">--  field</a>

<a id="305" class="Keyword">record</a> <a id="NewPParamState"></a><a id="312" href="Ledger.Conway.Conformance.NewPP.html#312" class="Record">NewPParamState</a> <a id="327" class="Symbol">:</a> <a id="329" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="334" class="Keyword">where</a>
  <a id="342" class="Keyword">field</a>
    <a id="NewPParamState.pparams"></a><a id="352" href="Ledger.Conway.Conformance.NewPP.html#352" class="Field">pparams</a>  <a id="361" class="Symbol">:</a> <a id="363" href="Ledger.PParams.html#1570" class="Record">PParams</a>
    <a id="NewPParamState.ppup"></a><a id="375" href="Ledger.Conway.Conformance.NewPP.html#375" class="Field">ppup</a>     <a id="384" class="Symbol">:</a> <a id="386" href="Ledger.Conway.Conformance.PPUp.html#500" class="Record">PPUpdateState</a>

<a id="401" class="Keyword">instance</a>
  <a id="412" class="Keyword">unquoteDecl</a> <a id="HasCast-NewPParamState"></a><a id="424" href="Ledger.Conway.Conformance.NewPP.html#424" class="Function">HasCast-NewPParamState</a> <a id="447" class="Symbol">=</a> <a id="449" href="Class.HasCast.Derive.html#2660" class="Function">derive-HasCast</a>
    <a id="468" href="Data.List.Base.html#5205" class="Function Operator">[</a> <a id="470" class="Symbol">(</a><a id="471" class="Keyword">quote</a> <a id="477" href="Ledger.Conway.Conformance.NewPP.html#312" class="Record">NewPParamState</a> <a id="492" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="494" href="Ledger.Conway.Conformance.NewPP.html#424" class="Function">HasCast-NewPParamState</a><a id="516" class="Symbol">)</a> <a id="518" href="Data.List.Base.html#5205" class="Function Operator">]</a>

<a id="updatePPUp"></a><a id="521" href="Ledger.Conway.Conformance.NewPP.html#521" class="Function">updatePPUp</a> <a id="532" class="Symbol">:</a> <a id="534" href="Ledger.PParams.html#1570" class="Record">PParams</a> <a id="542" class="Symbol">→</a> <a id="544" href="Ledger.Conway.Conformance.PPUp.html#500" class="Record">PPUpdateState</a> <a id="558" class="Symbol">→</a> <a id="560" href="Ledger.Conway.Conformance.PPUp.html#500" class="Record">PPUpdateState</a>
<a id="574" href="Ledger.Conway.Conformance.NewPP.html#521" class="Function">updatePPUp</a> <a id="585" href="Ledger.Conway.Conformance.NewPP.html#585" class="Bound">pparams</a> <a id="593" class="Keyword">record</a> <a id="600" class="Symbol">{</a> <a id="602" href="Ledger.Conway.Conformance.PPUp.html#571" class="Field">fpup</a> <a id="607" class="Symbol">=</a> <a id="609" href="Ledger.Conway.Conformance.NewPP.html#609" class="Bound">fpup</a> <a id="614" class="Symbol">}</a>
  <a id="618" class="Keyword">with</a> <a id="623" href="Axiom.Set.html#11220" class="Function">allᵇ</a> <a id="628" href="Class.Decidable.Core.html#966" class="Function Operator">¿</a> <a id="630" href="Ledger.Conway.Conformance.PPUp.html#802" class="Function">isViableUpdate</a> <a id="645" href="Ledger.Conway.Conformance.NewPP.html#585" class="Bound">pparams</a> <a id="653" href="Class.Decidable.Core.html#966" class="Function Operator">¿¹</a> <a id="656" class="Symbol">(</a><a id="657" href="Class.IsSet.html#959" class="Function">range</a> <a id="663" href="Ledger.Conway.Conformance.NewPP.html#609" class="Bound">fpup</a><a id="667" class="Symbol">)</a>
<a id="669" class="Symbol">...</a> <a id="673" class="Symbol">|</a> <a id="675" href="Agda.Builtin.Bool.html#192" class="InductiveConstructor">false</a>  <a id="682" class="Symbol">=</a> <a id="684" class="Keyword">record</a> <a id="691" class="Symbol">{</a> <a id="693" href="Ledger.Conway.Conformance.PPUp.html#541" class="Field">pup</a> <a id="697" class="Symbol">=</a> <a id="699" href="Axiom.Set.Map.html#2671" class="Function">∅ᵐ</a>    <a id="705" class="Symbol">;</a> <a id="707" href="Ledger.Conway.Conformance.PPUp.html#571" class="Field">fpup</a> <a id="712" class="Symbol">=</a> <a id="714" href="Axiom.Set.Map.html#2671" class="Function">∅ᵐ</a> <a id="717" class="Symbol">}</a>
<a id="719" class="Symbol">...</a> <a id="723" class="Symbol">|</a> <a id="725" href="Agda.Builtin.Bool.html#198" class="InductiveConstructor">true</a>   <a id="732" class="Symbol">=</a> <a id="734" class="Keyword">record</a> <a id="741" class="Symbol">{</a> <a id="743" href="Ledger.Conway.Conformance.PPUp.html#541" class="Field">pup</a> <a id="747" class="Symbol">=</a> <a id="749" class="Bound">fpup</a>  <a id="755" class="Symbol">;</a> <a id="757" href="Ledger.Conway.Conformance.PPUp.html#571" class="Field">fpup</a> <a id="762" class="Symbol">=</a> <a id="764" href="Axiom.Set.Map.html#2671" class="Function">∅ᵐ</a> <a id="767" class="Symbol">}</a>

<a id="votedValue"></a><a id="770" href="Ledger.Conway.Conformance.NewPP.html#770" class="Function">votedValue</a> <a id="781" class="Symbol">:</a> <a id="783" href="Ledger.Transaction.html#2479" class="Function">ProposedPPUpdates</a> <a id="801" class="Symbol">→</a> <a id="803" href="Ledger.PParams.html#1570" class="Record">PParams</a> <a id="811" class="Symbol">→</a> <a id="813" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a> <a id="815" class="Symbol">→</a> <a id="817" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="823" href="Ledger.PParams.html#14240" class="Function">PParamsUpdate</a>
<a id="837" href="Ledger.Conway.Conformance.NewPP.html#770" class="Function">votedValue</a> <a id="848" href="Ledger.Conway.Conformance.NewPP.html#848" class="Bound">pup</a> <a id="852" href="Ledger.Conway.Conformance.NewPP.html#852" class="Bound">pparams</a> <a id="860" href="Ledger.Conway.Conformance.NewPP.html#860" class="Bound">quorum</a> <a id="867" class="Symbol">=</a>
  <a id="871" href="Function.Base.html#4042" class="Function Operator">case</a> <a id="876" href="Axiom.Set.html#10895" class="Function">any?</a> <a id="881" class="Symbol">(λ</a> <a id="884" href="Ledger.Conway.Conformance.NewPP.html#884" class="Bound">u</a> <a id="886" class="Symbol">→</a> <a id="888" href="abstract-set-theory.FiniteSetTheory.html#2063" class="Function">lengthˢ</a> <a id="896" class="Symbol">(</a><a id="897" href="Ledger.Conway.Conformance.NewPP.html#848" class="Bound">pup</a> <a id="901" href="Axiom.Set.Map.html#14048" class="Function Operator">∣^</a> <a id="904" href="Axiom.Set.html#5718" class="Function">fromList</a> <a id="913" href="Data.List.Base.html#5205" class="Function Operator">[</a> <a id="915" href="Ledger.Conway.Conformance.NewPP.html#884" class="Bound">u</a> <a id="917" href="Data.List.Base.html#5205" class="Function Operator">]</a><a id="918" class="Symbol">)</a> <a id="920" href="Data.Nat.Properties.html#6775" class="Function Operator">≥?</a> <a id="923" href="Ledger.Conway.Conformance.NewPP.html#860" class="Bound">quorum</a><a id="929" class="Symbol">)</a> <a id="931" class="Symbol">(</a><a id="932" href="Class.IsSet.html#959" class="Function">range</a> <a id="938" href="Ledger.Conway.Conformance.NewPP.html#848" class="Bound">pup</a><a id="941" class="Symbol">)</a> <a id="943" href="Function.Base.html#4042" class="Function Operator">of</a>
    <a id="950" class="Symbol">λ</a>  <a id="953" class="Keyword">where</a>
       <a id="966" class="Symbol">(</a><a id="967" href="Relation.Nullary.Decidable.Core.html#2031" class="InductiveConstructor">no</a>  <a id="971" class="Symbol">_)</a>        <a id="981" class="Symbol">→</a> <a id="983" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a>
       <a id="998" class="Symbol">(</a><a id="999" href="Relation.Nullary.Decidable.Core.html#1994" class="InductiveConstructor">yes</a> <a id="1003" class="Symbol">(</a><a id="1004" href="Ledger.Conway.Conformance.NewPP.html#1004" class="Bound">u</a> <a id="1006" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1008" class="Symbol">_))</a>  <a id="1013" class="Symbol">→</a> <a id="1015" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="1020" href="Ledger.Conway.Conformance.NewPP.html#1004" class="Bound">u</a>

<a id="1023" class="Keyword">private</a> <a id="1031" class="Keyword">variable</a>
  <a id="1042" href="Ledger.Conway.Conformance.NewPP.html#1042" class="Generalizable">Γ</a> <a id="1044" class="Symbol">:</a> <a id="1046" href="Ledger.Conway.Conformance.NewPP.html#268" class="Record">NewPParamEnv</a>
  <a id="1061" href="Ledger.Conway.Conformance.NewPP.html#1061" class="Generalizable">s</a> <a id="1063" href="Ledger.Conway.Conformance.NewPP.html#1063" class="Generalizable">s&#39;</a> <a id="1066" class="Symbol">:</a> <a id="1068" href="Ledger.Conway.Conformance.NewPP.html#312" class="Record">NewPParamState</a>
  <a id="1085" href="Ledger.Conway.Conformance.NewPP.html#1085" class="Generalizable">upd</a> <a id="1089" class="Symbol">:</a> <a id="1091" href="Ledger.PParams.html#14240" class="Function">PParamsUpdate</a>

<a id="1106" class="Keyword">data</a> <a id="_⊢_⇀⦇_,NEWPP⦈_"></a><a id="1111" href="Ledger.Conway.Conformance.NewPP.html#1111" class="Datatype Operator">_⊢_⇀⦇_,NEWPP⦈_</a> <a id="1126" class="Symbol">:</a> <a id="1128" href="Ledger.Conway.Conformance.NewPP.html#268" class="Record">NewPParamEnv</a> <a id="1141" class="Symbol">→</a> <a id="1143" href="Ledger.Conway.Conformance.NewPP.html#312" class="Record">NewPParamState</a> <a id="1158" class="Symbol">→</a> <a id="1160" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="1166" href="Ledger.PParams.html#14240" class="Function">PParamsUpdate</a> <a id="1180" class="Symbol">→</a> <a id="1182" href="Ledger.Conway.Conformance.NewPP.html#312" class="Record">NewPParamState</a> <a id="1197" class="Symbol">→</a> <a id="1199" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="1204" class="Keyword">where</a>

  <a id="_⊢_⇀⦇_,NEWPP⦈_.NEWPP-Accept"></a><a id="1213" href="Ledger.Conway.Conformance.NewPP.html#1213" class="InductiveConstructor">NEWPP-Accept</a> <a id="1226" class="Symbol">:</a> <a id="1228" class="Symbol">∀</a> <a id="1230" class="Symbol">{</a><a id="1231" href="Ledger.Conway.Conformance.NewPP.html#1231" class="Bound">Γ</a><a id="1232" class="Symbol">}</a> <a id="1234" class="Symbol">→</a> <a id="1236" class="Keyword">let</a> <a id="1240" class="Keyword">open</a> <a id="1245" href="Ledger.Conway.Conformance.NewPP.html#312" class="Module">NewPParamState</a> <a id="1260" href="Ledger.Conway.Conformance.NewPP.html#1061" class="Generalizable">s</a><a id="1261" class="Symbol">;</a> <a id="1263" href="Ledger.Conway.Conformance.NewPP.html#1263" class="Bound">newpp</a> <a id="1269" class="Symbol">=</a> <a id="1271" href="Ledger.PParams.html#13806" class="Function">applyUpdate</a> <a id="1283" href="Ledger.Conway.Conformance.NewPP.html#352" class="Function">pparams</a> <a id="1291" href="Ledger.Conway.Conformance.NewPP.html#1085" class="Generalizable">upd</a> <a id="1295" class="Keyword">in</a>
    <a id="1302" href="Ledger.Conway.Conformance.PPUp.html#723" class="Function">viablePParams</a> <a id="1316" href="Ledger.Conway.Conformance.NewPP.html#1263" class="Bound">newpp</a>
    <a id="1326" href="Interface.STS.html#350" class="Function Operator">────────────────────────────────</a>
    <a id="1363" href="Ledger.Conway.Conformance.NewPP.html#1231" class="Bound">Γ</a> <a id="1365" href="Ledger.Conway.Conformance.NewPP.html#1111" class="Datatype Operator">⊢</a> <a id="1367" href="Ledger.Conway.Conformance.NewPP.html#1061" class="Generalizable">s</a> <a id="1369" href="Ledger.Conway.Conformance.NewPP.html#1111" class="Datatype Operator">⇀⦇</a> <a id="1372" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="1377" href="Ledger.Conway.Conformance.NewPP.html#1085" class="Generalizable">upd</a> <a id="1381" href="Ledger.Conway.Conformance.NewPP.html#1111" class="Datatype Operator">,NEWPP⦈</a> <a id="1389" href="Ledger.Prelude.html#2291" class="Function Operator">⟦</a> <a id="1391" href="Ledger.Conway.Conformance.NewPP.html#1263" class="Bound">newpp</a> <a id="1397" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1399" href="Ledger.Conway.Conformance.NewPP.html#521" class="Function">updatePPUp</a> <a id="1410" href="Ledger.Conway.Conformance.NewPP.html#1263" class="Bound">newpp</a> <a id="1416" href="Ledger.Conway.Conformance.NewPP.html#375" class="Function">ppup</a> <a id="1421" href="Ledger.Prelude.html#2291" class="Function Operator">⟧</a>

  <a id="_⊢_⇀⦇_,NEWPP⦈_.NEWPP-Reject"></a><a id="1426" href="Ledger.Conway.Conformance.NewPP.html#1426" class="InductiveConstructor">NEWPP-Reject</a> <a id="1439" class="Symbol">:</a> <a id="1441" class="Symbol">∀</a> <a id="1443" class="Symbol">{</a><a id="1444" href="Ledger.Conway.Conformance.NewPP.html#1444" class="Bound">Γ</a><a id="1445" class="Symbol">}</a> <a id="1447" class="Symbol">→</a>
    <a id="1453" href="Ledger.Conway.Conformance.NewPP.html#1444" class="Bound">Γ</a> <a id="1455" href="Ledger.Conway.Conformance.NewPP.html#1111" class="Datatype Operator">⊢</a> <a id="1457" href="Ledger.Conway.Conformance.NewPP.html#1061" class="Generalizable">s</a> <a id="1459" href="Ledger.Conway.Conformance.NewPP.html#1111" class="Datatype Operator">⇀⦇</a> <a id="1462" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a> <a id="1470" href="Ledger.Conway.Conformance.NewPP.html#1111" class="Datatype Operator">,NEWPP⦈</a> <a id="1478" href="Ledger.Conway.Conformance.NewPP.html#1061" class="Generalizable">s</a>

</pre></body></html>