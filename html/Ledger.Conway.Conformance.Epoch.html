<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>Ledger.Conway.Conformance.Epoch</title><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.css"><link rel="stylesheet" href="Agda.css"><script src="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.js"></script><script src="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/contrib/auto-render.min.js"></script><script src="AgdaKaTeX.js" defer=""></script></head><body><pre class="Agda"><a id="1" class="Symbol">{-#</a> <a id="5" class="Keyword">OPTIONS</a> <a id="13" class="Pragma">--safe</a> <a id="20" class="Symbol">#-}</a>

<a id="25" class="Keyword">open</a> <a id="30" class="Keyword">import</a> <a id="37" href="Ledger.Conway.Specification.Abstract.html" class="Module">Ledger.Conway.Specification.Abstract</a>
<a id="74" class="Keyword">open</a> <a id="79" class="Keyword">import</a> <a id="86" href="Ledger.Conway.Specification.Transaction.html" class="Module">Ledger.Conway.Specification.Transaction</a>

<a id="127" class="Keyword">module</a> <a id="134" href="Ledger.Conway.Conformance.Epoch.html" class="Module">Ledger.Conway.Conformance.Epoch</a>
  <a id="168" class="Symbol">(</a><a id="169" href="Ledger.Conway.Conformance.Epoch.html#169" class="Bound">txs</a> <a id="173" class="Symbol">:</a> <a id="175" class="Symbol">_)</a> <a id="178" class="Symbol">(</a><a id="179" class="Keyword">open</a> <a id="184" href="Ledger.Conway.Specification.Transaction.html#999" class="Module">TransactionStructure</a> <a id="205" href="Ledger.Conway.Conformance.Epoch.html#169" class="Bound">txs</a><a id="208" class="Symbol">)</a>
  <a id="212" class="Symbol">(</a><a id="213" href="Ledger.Conway.Conformance.Epoch.html#213" class="Bound">abs</a> <a id="217" class="Symbol">:</a> <a id="219" href="Ledger.Conway.Specification.Abstract.html#830" class="Record">AbstractFunctions</a> <a id="237" href="Ledger.Conway.Conformance.Epoch.html#169" class="Bound">txs</a><a id="240" class="Symbol">)</a> <a id="242" class="Symbol">(</a><a id="243" class="Keyword">open</a> <a id="248" href="Ledger.Conway.Specification.Abstract.html#830" class="Module">AbstractFunctions</a> <a id="266" href="Ledger.Conway.Conformance.Epoch.html#213" class="Bound">abs</a><a id="269" class="Symbol">)</a>
  <a id="273" class="Keyword">where</a>

<a id="280" class="Keyword">open</a> <a id="285" class="Keyword">import</a> <a id="292" href="Ledger.Prelude.html" class="Module">Ledger.Prelude</a>
<a id="307" class="Keyword">open</a> <a id="312" class="Keyword">import</a> <a id="319" href="Data.Integer.html" class="Module">Data.Integer</a> <a id="332" class="Keyword">using</a> <a id="338" class="Symbol">()</a> <a id="341" class="Keyword">renaming</a> <a id="350" class="Symbol">(</a><a id="351" href="Agda.Builtin.Int.html#263" class="InductiveConstructor">+_</a> <a id="354" class="Symbol">to</a> <a id="357" class="InductiveConstructor">pos</a><a id="360" class="Symbol">)</a>
<a id="362" class="Keyword">import</a> <a id="369" href="Data.Integer.html" class="Module">Data.Integer</a> <a id="382" class="Symbol">as</a> <a id="385" class="Module">ℤ</a>

<a id="388" class="Keyword">open</a> <a id="393" class="Keyword">import</a> <a id="400" href="Data.Nat.Properties.html" class="Module">Data.Nat.Properties</a> <a id="420" class="Keyword">using</a> <a id="426" class="Symbol">(</a><a id="427" href="Data.Nat.Properties.html#17566" class="Function">+-0-monoid</a><a id="437" class="Symbol">;</a> <a id="439" href="Data.Nat.Properties.html#17645" class="Function">+-0-commutativeMonoid</a><a id="460" class="Symbol">)</a>
<a id="462" class="Keyword">open</a> <a id="467" class="Keyword">import</a> <a id="474" href="Data.List.html" class="Module">Data.List</a> <a id="484" class="Keyword">using</a> <a id="490" class="Symbol">(</a><a id="491" href="Data.List.Base.html#10389" class="Function">filter</a><a id="497" class="Symbol">)</a>

<a id="500" class="Keyword">open</a> <a id="505" class="Keyword">import</a> <a id="512" href="Agda.Builtin.FromNat.html" class="Module">Agda.Builtin.FromNat</a>

<a id="534" class="Keyword">open</a> <a id="539" class="Keyword">import</a> <a id="546" href="Ledger.Conway.Specification.Enact.html" class="Module">Ledger.Conway.Specification.Enact</a> <a id="580" href="Ledger.Conway.Specification.Transaction.html#2260" class="Function">govStructure</a>
<a id="593" class="Keyword">open</a> <a id="598" class="Keyword">import</a> <a id="605" href="Ledger.Conway.Conformance.Equivalence.html" class="Module">Ledger.Conway.Conformance.Equivalence</a> <a id="643" href="Ledger.Conway.Conformance.Epoch.html#169" class="Bound">txs</a> <a id="647" href="Ledger.Conway.Conformance.Epoch.html#213" class="Bound">abs</a>
<a id="651" class="Keyword">open</a> <a id="656" class="Keyword">import</a> <a id="663" href="Ledger.Conway.Conformance.Equivalence.Convert.html" class="Module">Ledger.Conway.Conformance.Equivalence.Convert</a>
<a id="709" class="Keyword">open</a> <a id="714" class="Keyword">import</a> <a id="721" href="Ledger.Conway.Conformance.Equivalence.Deposits.html" class="Module">Ledger.Conway.Conformance.Equivalence.Deposits</a> <a id="768" href="Ledger.Conway.Conformance.Epoch.html#169" class="Bound">txs</a> <a id="772" href="Ledger.Conway.Conformance.Epoch.html#213" class="Bound">abs</a>
<a id="776" class="Keyword">open</a> <a id="781" class="Keyword">import</a> <a id="788" href="Ledger.Conway.Conformance.Ledger.html" class="Module">Ledger.Conway.Conformance.Ledger</a> <a id="821" href="Ledger.Conway.Conformance.Epoch.html#169" class="Bound">txs</a> <a id="825" href="Ledger.Conway.Conformance.Epoch.html#213" class="Bound">abs</a>
<a id="829" class="Keyword">open</a> <a id="834" class="Keyword">import</a> <a id="841" href="Ledger.Conway.Specification.Ratify.html" class="Module">Ledger.Conway.Specification.Ratify</a> <a id="876" href="Ledger.Conway.Specification.Transaction.html#2260" class="Function">govStructure</a>
<a id="889" class="Keyword">open</a> <a id="894" class="Keyword">import</a> <a id="901" href="Ledger.Conway.Conformance.Utxo.html" class="Module">Ledger.Conway.Conformance.Utxo</a> <a id="932" href="Ledger.Conway.Conformance.Epoch.html#169" class="Bound">txs</a> <a id="936" href="Ledger.Conway.Conformance.Epoch.html#213" class="Bound">abs</a>
<a id="940" class="Keyword">open</a> <a id="945" class="Keyword">import</a> <a id="952" href="Ledger.Conway.Conformance.Certs.html" class="Module">Ledger.Conway.Conformance.Certs</a> <a id="984" href="Ledger.Conway.Specification.Transaction.html#2260" class="Function">govStructure</a>
<a id="997" class="Keyword">open</a> <a id="1002" class="Keyword">import</a> <a id="1009" href="Ledger.Conway.Conformance.Rewards.html" class="Module">Ledger.Conway.Conformance.Rewards</a> <a id="1043" href="Ledger.Conway.Conformance.Epoch.html#169" class="Bound">txs</a> <a id="1047" href="Ledger.Conway.Conformance.Epoch.html#213" class="Bound">abs</a>
<a id="1051" class="Keyword">open</a> <a id="1056" class="Keyword">import</a> <a id="1063" href="Ledger.Conway.Specification.Epoch.html" class="Module">Ledger.Conway.Specification.Epoch</a> <a id="1097" href="Ledger.Conway.Conformance.Epoch.html#169" class="Bound">txs</a> <a id="1101" href="Ledger.Conway.Conformance.Epoch.html#213" class="Bound">abs</a>
  <a id="1107" class="Keyword">using</a> <a id="1113" class="Symbol">(</a><a id="1114" href="Ledger.Conway.Specification.Epoch.html#5612" class="Function">getStakeCred</a><a id="1126" class="Symbol">;</a> <a id="1128" href="Ledger.Conway.Specification.Epoch.html#13228" class="Function">getOrphans</a><a id="1138" class="Symbol">;</a> <a id="1140" href="Ledger.Conway.Specification.Epoch.html#12537" class="Function">mkStakeDistrs</a><a id="1153" class="Symbol">;</a> <a id="1155" href="Ledger.Conway.Specification.Epoch.html#5507" class="Function">toRewardAddress</a><a id="1170" class="Symbol">)</a> <a id="1172" class="Keyword">public</a>
<a id="1179" class="Keyword">import</a> <a id="1186" href="Ledger.Conway.Specification.Epoch.html" class="Module">Ledger.Conway.Specification.Epoch</a> <a id="1220" href="Ledger.Conway.Conformance.Epoch.html#169" class="Bound">txs</a> <a id="1224" href="Ledger.Conway.Conformance.Epoch.html#213" class="Bound">abs</a> <a id="1228" class="Symbol">as</a> <a id="EpochSpec"></a><a id="1231" href="Ledger.Conway.Conformance.Epoch.html#1231" class="Module">EpochSpec</a>

<a id="1242" class="Keyword">record</a> <a id="EpochState"></a><a id="1249" href="Ledger.Conway.Conformance.Epoch.html#1249" class="Record">EpochState</a> <a id="1260" class="Symbol">:</a> <a id="1262" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="1267" class="Keyword">where</a>
  <a id="1275" class="Keyword">constructor</a> <a id="⟦_,_,_,_,_⟧ᵉ&#39;"></a><a id="1287" href="Ledger.Conway.Conformance.Epoch.html#1287" class="InductiveConstructor Operator">⟦_,_,_,_,_⟧ᵉ&#39;</a>
  <a id="1303" class="Keyword">field</a>
    <a id="EpochState.acnt"></a><a id="1313" href="Ledger.Conway.Conformance.Epoch.html#1313" class="Field">acnt</a>       <a id="1324" class="Symbol">:</a> <a id="1326" href="Ledger.Conway.Specification.PParams.html#760" class="Record">Acnt</a>
    <a id="EpochState.ss"></a><a id="1335" href="Ledger.Conway.Conformance.Epoch.html#1335" class="Field">ss</a>         <a id="1346" class="Symbol">:</a> <a id="1348" href="Ledger.Conway.Specification.Rewards.html#7719" class="Record">Snapshots</a>
    <a id="EpochState.ls"></a><a id="1362" href="Ledger.Conway.Conformance.Epoch.html#1362" class="Field">ls</a>         <a id="1373" class="Symbol">:</a> <a id="1375" href="Ledger.Conway.Conformance.Ledger.html#779" class="Record">LState</a>
    <a id="EpochState.es"></a><a id="1386" href="Ledger.Conway.Conformance.Epoch.html#1386" class="Field">es</a>         <a id="1397" class="Symbol">:</a> <a id="1399" href="Ledger.Conway.Specification.Enact.html#448" class="Record">EnactState</a>
    <a id="EpochState.fut"></a><a id="1414" href="Ledger.Conway.Conformance.Epoch.html#1414" class="Field">fut</a>        <a id="1425" class="Symbol">:</a> <a id="1427" href="Ledger.Conway.Specification.Ratify.html#3537" class="Record">RatifyState</a>

<a id="PoolDelegatedStake"></a><a id="1440" href="Ledger.Conway.Conformance.Epoch.html#1440" class="Function">PoolDelegatedStake</a> <a id="1459" class="Symbol">:</a> <a id="1461" href="Agda.Primitive.html#388" class="Primitive">Type</a>
<a id="1466" href="Ledger.Conway.Conformance.Epoch.html#1440" class="Function">PoolDelegatedStake</a> <a id="1485" class="Symbol">=</a> <a id="1487" href="Ledger.Core.Specification.Crypto.html#1386" class="Function">KeyHash</a> <a id="1495" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="1497" href="Ledger.Prelude.Base.html#154" class="Function">Coin</a>

<a id="1503" class="Keyword">record</a> <a id="NewEpochState"></a><a id="1510" href="Ledger.Conway.Conformance.Epoch.html#1510" class="Record">NewEpochState</a> <a id="1524" class="Symbol">:</a> <a id="1526" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="1531" class="Keyword">where</a>
  <a id="1539" class="Keyword">field</a>
    <a id="NewEpochState.lastEpoch"></a><a id="1549" href="Ledger.Conway.Conformance.Epoch.html#1549" class="Field">lastEpoch</a>   <a id="1561" class="Symbol">:</a> <a id="1563" href="Ledger.Core.Specification.Epoch.html#646" class="Function">Epoch</a>
    <a id="NewEpochState.bprev"></a><a id="1573" href="Ledger.Conway.Conformance.Epoch.html#1573" class="Field">bprev</a>       <a id="1585" class="Symbol">:</a> <a id="1587" href="Ledger.Conway.Specification.Rewards.html#4906" class="Function">BlocksMade</a>
    <a id="NewEpochState.bcur"></a><a id="1602" href="Ledger.Conway.Conformance.Epoch.html#1602" class="Field">bcur</a>        <a id="1614" class="Symbol">:</a> <a id="1616" href="Ledger.Conway.Specification.Rewards.html#4906" class="Function">BlocksMade</a>
    <a id="NewEpochState.epochState"></a><a id="1631" href="Ledger.Conway.Conformance.Epoch.html#1631" class="Field">epochState</a>  <a id="1643" class="Symbol">:</a> <a id="1645" href="Ledger.Conway.Conformance.Epoch.html#1249" class="Record">EpochState</a>
    <a id="NewEpochState.ru"></a><a id="1660" href="Ledger.Conway.Conformance.Epoch.html#1660" class="Field">ru</a>          <a id="1672" class="Symbol">:</a> <a id="1674" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="1680" href="Ledger.Conway.Specification.Rewards.html#6249" class="Record">RewardUpdate</a>
    <a id="NewEpochState.pd"></a><a id="1697" href="Ledger.Conway.Conformance.Epoch.html#1697" class="Field">pd</a>          <a id="1709" class="Symbol">:</a> <a id="1711" href="Ledger.Conway.Conformance.Epoch.html#1440" class="Function">PoolDelegatedStake</a>

<a id="1731" class="Keyword">instance</a>
  <a id="1742" class="Keyword">unquoteDecl</a> <a id="HasCast-EpochState"></a><a id="1754" href="Ledger.Conway.Conformance.Epoch.html#1754" class="Function">HasCast-EpochState</a> <a id="HasCast-NewEpochState"></a><a id="1773" href="Ledger.Conway.Conformance.Epoch.html#1773" class="Function">HasCast-NewEpochState</a> <a id="1795" class="Symbol">=</a> <a id="1797" href="stdlib-classes.Class.HasCast.Derive.html#2690" class="Function">derive-HasCast</a>
    <a id="1816" class="Symbol">(</a> <a id="1818" class="Symbol">(</a><a id="1819" class="Keyword">quote</a> <a id="1825" href="Ledger.Conway.Conformance.Epoch.html#1249" class="Record">EpochState</a>     <a id="1840" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1842" href="Ledger.Conway.Conformance.Epoch.html#1754" class="Function">HasCast-EpochState</a><a id="1860" class="Symbol">)</a>
    <a id="1866" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="1868" href="Data.List.Base.html#4907" class="Function Operator">[</a> <a id="1870" class="Symbol">(</a><a id="1871" class="Keyword">quote</a> <a id="1877" href="Ledger.Conway.Conformance.Epoch.html#1510" class="Record">NewEpochState</a>  <a id="1892" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1894" href="Ledger.Conway.Conformance.Epoch.html#1773" class="Function">HasCast-NewEpochState</a><a id="1915" class="Symbol">)</a><a id="1916" href="Data.List.Base.html#4907" class="Function Operator">]</a><a id="1917" class="Symbol">)</a>

  <a id="EpochStateFromConf"></a><a id="1922" href="Ledger.Conway.Conformance.Epoch.html#1922" class="Function">EpochStateFromConf</a> <a id="1941" class="Symbol">:</a> <a id="1943" href="Ledger.Conway.Conformance.Epoch.html#1249" class="Record">EpochState</a> <a id="1954" href="Ledger.Conway.Conformance.Equivalence.Convert.html#409" class="Function Operator">⭆</a> <a id="1956" href="Ledger.Conway.Specification.Epoch.html#1855" class="Record">EpochSpec.EpochState</a>
  <a id="1979" href="Ledger.Conway.Conformance.Epoch.html#1922" class="Function">EpochStateFromConf</a> <a id="1998" class="Symbol">.</a><a id="1999" href="Ledger.Conway.Conformance.Equivalence.Convert.html#217" class="Field">convⁱ</a> <a id="2005" class="Symbol">_</a> <a id="2007" href="Ledger.Conway.Conformance.Epoch.html#2007" class="Bound">epochState</a> <a id="2018" class="Symbol">=</a>
    <a id="2024" class="Keyword">let</a> <a id="2028" class="Keyword">open</a> <a id="2033" href="Ledger.Conway.Conformance.Epoch.html#1249" class="Module">EpochState</a> <a id="2044" href="Ledger.Conway.Conformance.Epoch.html#2007" class="Bound">epochState</a> <a id="2055" class="Keyword">in</a>
    <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.Conway.Conformance.Epoch.html#1313}{\htmlId{2064}{\htmlClass{Field}{\text{acnt}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#1335}{\htmlId{2071}{\htmlClass{Field}{\text{ss}}}}\, \\ \,\href{Ledger.Conway.Conformance.Equivalence.Convert.html#452}{\htmlId{2076}{\htmlClass{Function}{\text{conv}}}}\, \,\href{Ledger.Conway.Conformance.Epoch.html#1362}{\htmlId{2081}{\htmlClass{Field}{\text{ls}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#1386}{\htmlId{2086}{\htmlClass{Field}{\text{es}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#1414}{\htmlId{2091}{\htmlClass{Field}{\text{fut}}}}\, \end{pmatrix}$</a>

  <a id="EpochStateToConf"></a><a id="2100" href="Ledger.Conway.Conformance.Epoch.html#2100" class="Function">EpochStateToConf</a> <a id="2117" class="Symbol">:</a> <a id="2119" href="Ledger.Conway.Specification.Epoch.html#1855" class="Record">EpochSpec.EpochState</a> <a id="2140" href="Ledger.Conway.Conformance.Equivalence.Convert.html#409" class="Function Operator">⭆</a> <a id="2142" href="Ledger.Conway.Conformance.Epoch.html#1249" class="Record">EpochState</a>
  <a id="2155" href="Ledger.Conway.Conformance.Epoch.html#2100" class="Function">EpochStateToConf</a> <a id="2172" class="Symbol">.</a><a id="2173" href="Ledger.Conway.Conformance.Equivalence.Convert.html#217" class="Field">convⁱ</a> <a id="2179" href="Ledger.Conway.Conformance.Epoch.html#2179" class="Bound">deposits</a> <a id="2188" href="Ledger.Conway.Conformance.Epoch.html#2188" class="Bound">epochSt</a> <a id="2196" class="Symbol">=</a>
    <a id="2202" class="Keyword">let</a> <a id="2206" class="Keyword">open</a> <a id="2211" href="Ledger.Conway.Specification.Epoch.html#1855" class="Module">EpochSpec.EpochState</a> <a id="2232" href="Ledger.Conway.Conformance.Epoch.html#2188" class="Bound">epochSt</a> <a id="2240" class="Keyword">in</a>
    <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.Conway.Specification.Epoch.html#1923}{\htmlId{2249}{\htmlClass{Field}{\text{acnt}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#1945}{\htmlId{2256}{\htmlClass{Field}{\text{ss}}}}\, \\ \,\href{Ledger.Conway.Conformance.Equivalence.Deposits.html#12794}{\htmlId{2261}{\htmlClass{Function}{\text{certDeposits}}}}\, \,\href{Ledger.Conway.Specification.Epoch.html#1972}{\htmlId{2274}{\htmlClass{Field}{\text{ls}}}}\, \,\href{Ledger.Conway.Conformance.Equivalence.Convert.html#270}{\htmlId{2277}{\htmlClass{Function Operator}{\text{⊢conv}}}}\, \,\href{Ledger.Conway.Specification.Epoch.html#1972}{\htmlId{2283}{\htmlClass{Field}{\text{ls}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#1996}{\htmlId{2288}{\htmlClass{Field}{\text{es}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#2024}{\htmlId{2293}{\htmlClass{Field}{\text{fut}}}}\, \end{pmatrix}$</a>

  <a id="NewEpochStateFromConf"></a><a id="2304" href="Ledger.Conway.Conformance.Epoch.html#2304" class="Function">NewEpochStateFromConf</a> <a id="2326" class="Symbol">:</a> <a id="2328" href="Ledger.Conway.Conformance.Epoch.html#1510" class="Record">NewEpochState</a> <a id="2342" href="Ledger.Conway.Conformance.Equivalence.Convert.html#409" class="Function Operator">⭆</a> <a id="2344" href="Ledger.Conway.Specification.Epoch.html#3606" class="Record">EpochSpec.NewEpochState</a>
  <a id="2370" href="Ledger.Conway.Conformance.Epoch.html#2304" class="Function">NewEpochStateFromConf</a> <a id="2392" class="Symbol">.</a><a id="2393" href="Ledger.Conway.Conformance.Equivalence.Convert.html#217" class="Field">convⁱ</a> <a id="2399" class="Symbol">_</a> <a id="2401" href="Ledger.Conway.Conformance.Epoch.html#2401" class="Bound">newEpochState</a> <a id="2415" class="Symbol">=</a>
    <a id="2421" class="Keyword">let</a> <a id="2425" class="Keyword">open</a> <a id="2430" href="Ledger.Conway.Conformance.Epoch.html#1510" class="Module">NewEpochState</a> <a id="2444" href="Ledger.Conway.Conformance.Epoch.html#2401" class="Bound">newEpochState</a> <a id="2458" class="Keyword">in</a>
    <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.Conway.Conformance.Epoch.html#1549}{\htmlId{2467}{\htmlClass{Field}{\text{lastEpoch}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#1573}{\htmlId{2479}{\htmlClass{Field}{\text{bprev}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#1602}{\htmlId{2487}{\htmlClass{Field}{\text{bcur}}}}\, \\ \,\href{Ledger.Conway.Conformance.Equivalence.Convert.html#452}{\htmlId{2494}{\htmlClass{Function}{\text{conv}}}}\, \,\href{Ledger.Conway.Conformance.Epoch.html#1631}{\htmlId{2499}{\htmlClass{Field}{\text{epochState}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#1660}{\htmlId{2512}{\htmlClass{Field}{\text{ru}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#1697}{\htmlId{2517}{\htmlClass{Field}{\text{pd}}}}\, \end{pmatrix}$</a>

  <a id="NewEpochStateToConf"></a><a id="2525" href="Ledger.Conway.Conformance.Epoch.html#2525" class="Function">NewEpochStateToConf</a> <a id="2545" class="Symbol">:</a> <a id="2547" href="Ledger.Conway.Specification.Epoch.html#3606" class="Record">EpochSpec.NewEpochState</a> <a id="2571" href="Ledger.Conway.Conformance.Equivalence.Convert.html#409" class="Function Operator">⭆</a> <a id="2573" href="Ledger.Conway.Conformance.Epoch.html#1510" class="Record">NewEpochState</a>
  <a id="2589" href="Ledger.Conway.Conformance.Epoch.html#2525" class="Function">NewEpochStateToConf</a> <a id="2609" class="Symbol">.</a><a id="2610" href="Ledger.Conway.Conformance.Equivalence.Convert.html#217" class="Field">convⁱ</a> <a id="2616" href="Ledger.Conway.Conformance.Epoch.html#2616" class="Bound">deposits</a> <a id="2625" href="Ledger.Conway.Conformance.Epoch.html#2625" class="Bound">newEpochSt</a> <a id="2636" class="Symbol">=</a>
    <a id="2642" class="Keyword">let</a> <a id="2646" class="Keyword">open</a> <a id="2651" href="Ledger.Conway.Specification.Epoch.html#3606" class="Module">EpochSpec.NewEpochState</a> <a id="2675" href="Ledger.Conway.Conformance.Epoch.html#2625" class="Bound">newEpochSt</a> <a id="2686" class="Keyword">in</a>
    <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.Conway.Specification.Epoch.html#3645}{\htmlId{2695}{\htmlClass{Field}{\text{lastEpoch}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#3698}{\htmlId{2707}{\htmlClass{Field}{\text{bcur}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#3669}{\htmlId{2714}{\htmlClass{Field}{\text{bprev}}}}\, \\ \,\href{Ledger.Conway.Conformance.Equivalence.Convert.html#452}{\htmlId{2722}{\htmlClass{Function}{\text{conv}}}}\, \,\href{Ledger.Conway.Specification.Epoch.html#3727}{\htmlId{2727}{\htmlClass{Field}{\text{epochState}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#3756}{\htmlId{2740}{\htmlClass{Field}{\text{ru}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#3793}{\htmlId{2745}{\htmlClass{Field}{\text{pd}}}}\, \end{pmatrix}$</a>


<a id="applyRUpd"></a><a id="2752" href="Ledger.Conway.Conformance.Epoch.html#2752" class="Function">applyRUpd</a> <a id="2762" class="Symbol">:</a> <a id="2764" href="Ledger.Conway.Specification.Rewards.html#6249" class="Record">RewardUpdate</a> <a id="2777" class="Symbol">→</a> <a id="2779" href="Ledger.Conway.Conformance.Epoch.html#1249" class="Record">EpochState</a> <a id="2790" class="Symbol">→</a> <a id="2792" href="Ledger.Conway.Conformance.Epoch.html#1249" class="Record">EpochState</a>
<a id="2803" href="Ledger.Conway.Conformance.Epoch.html#2752" class="Function">applyRUpd</a> <a id="2813" href="Ledger.Conway.Conformance.Epoch.html#2813" class="Bound">rewardUpdate</a>
  <a class="AgdaKaTeX">$\begin{pmatrix} \begin{pmatrix} \,\href{Ledger.Conway.Conformance.Epoch.html#2832}{\htmlId{2832}{\htmlClass{Bound}{\text{treasury}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#2843}{\htmlId{2843}{\htmlClass{Bound}{\text{reserves}}}}\, \end{pmatrix}
  \\ \,\href{Ledger.Conway.Conformance.Epoch.html#2859}{\htmlId{2859}{\htmlClass{Bound}{\text{ss}}}}\,
  \\ \begin{pmatrix} \begin{pmatrix} \,\href{Ledger.Conway.Conformance.Epoch.html#2870}{\htmlId{2870}{\htmlClass{Bound}{\text{utxo}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#2877}{\htmlId{2877}{\htmlClass{Bound}{\text{fees}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#2884}{\htmlId{2884}{\htmlClass{Bound}{\text{deposits}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#2895}{\htmlId{2895}{\htmlClass{Bound}{\text{donations}}}}\, \end{pmatrix}
    \\ \,\href{Ledger.Conway.Conformance.Epoch.html#2914}{\htmlId{2914}{\htmlClass{Bound}{\text{govSt}}}}\,
    \\ \begin{pmatrix} \begin{pmatrix} \,\href{Ledger.Conway.Conformance.Epoch.html#2930}{\htmlId{2930}{\htmlClass{Bound}{\text{voteDelegs}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#2943}{\htmlId{2943}{\htmlClass{Bound}{\text{stakeDelegs}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#2957}{\htmlId{2957}{\htmlClass{Bound}{\text{rewards}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#2967}{\htmlId{2967}{\htmlClass{Bound}{\text{deposits&#39;}}}}\, \end{pmatrix} \\ \,\href{Ledger.Conway.Conformance.Epoch.html#2982}{\htmlId{2982}{\htmlClass{Bound}{\text{pState}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#2991}{\htmlId{2991}{\htmlClass{Bound}{\text{gState}}}}\, \end{pmatrix} \end{pmatrix}
  \\ \,\href{Ledger.Conway.Conformance.Epoch.html#3009}{\htmlId{3009}{\htmlClass{Bound}{\text{es}}}}\,
  \\ \,\href{Ledger.Conway.Conformance.Epoch.html#3016}{\htmlId{3016}{\htmlClass{Bound}{\text{fut}}}}\,
  \end{pmatrix}$</a> <a id="3026" class="Symbol">=</a>
  <a class="AgdaKaTeX">$\begin{pmatrix} \begin{pmatrix} \,\href{Prelude.html#3332}{\htmlId{3034}{\htmlClass{Function}{\text{posPart}}}}\, \,\htmlId{3042}{\htmlClass{Symbol}{\text{(}}}\,\,\href{Ledger.Conway.Conformance.Epoch.html#357}{\htmlId{3043}{\htmlClass{InductiveConstructor}{\text{pos}}}}\, \,\href{Ledger.Conway.Conformance.Epoch.html#2832}{\htmlId{3047}{\htmlClass{Bound}{\text{treasury}}}}\, \,\href{Class.HasAdd.Core.html#162}{\htmlId{3056}{\htmlClass{Field Operator}{\text{+}}}}\, \,\href{Ledger.Conway.Specification.Rewards.html#6286}{\htmlId{3058}{\htmlClass{Function}{\text{Δt}}}}\, \,\href{Class.HasAdd.Core.html#162}{\htmlId{3061}{\htmlClass{Field Operator}{\text{+}}}}\, \,\href{Ledger.Conway.Conformance.Epoch.html#357}{\htmlId{3063}{\htmlClass{InductiveConstructor}{\text{pos}}}}\, \,\href{Ledger.Conway.Conformance.Epoch.html#3441}{\htmlId{3067}{\htmlClass{Function}{\text{unregRU&#39;}}}}\,\,\htmlId{3075}{\htmlClass{Symbol}{\text{)}}}\,
    \\ \,\href{Prelude.html#3332}{\htmlId{3083}{\htmlClass{Function}{\text{posPart}}}}\, \,\htmlId{3091}{\htmlClass{Symbol}{\text{(}}}\,\,\href{Ledger.Conway.Conformance.Epoch.html#357}{\htmlId{3092}{\htmlClass{InductiveConstructor}{\text{pos}}}}\, \,\href{Ledger.Conway.Conformance.Epoch.html#2843}{\htmlId{3096}{\htmlClass{Bound}{\text{reserves}}}}\, \,\href{Class.HasAdd.Core.html#162}{\htmlId{3105}{\htmlClass{Field Operator}{\text{+}}}}\, \,\href{Ledger.Conway.Specification.Rewards.html#6289}{\htmlId{3107}{\htmlClass{Function}{\text{Δr}}}}\,\,\htmlId{3109}{\htmlClass{Symbol}{\text{)}}}\, \end{pmatrix}
  \\ \,\href{Ledger.Conway.Conformance.Epoch.html#2859}{\htmlId{3117}{\htmlClass{Bound}{\text{ss}}}}\,
  \\ \begin{pmatrix} \begin{pmatrix} \,\href{Ledger.Conway.Conformance.Epoch.html#2870}{\htmlId{3128}{\htmlClass{Bound}{\text{utxo}}}}\, \\ \,\href{Prelude.html#3332}{\htmlId{3135}{\htmlClass{Function}{\text{posPart}}}}\, \,\htmlId{3143}{\htmlClass{Symbol}{\text{(}}}\,\,\href{Ledger.Conway.Conformance.Epoch.html#357}{\htmlId{3144}{\htmlClass{InductiveConstructor}{\text{pos}}}}\, \,\href{Ledger.Conway.Conformance.Epoch.html#2877}{\htmlId{3148}{\htmlClass{Bound}{\text{fees}}}}\, \,\href{Class.HasAdd.Core.html#162}{\htmlId{3153}{\htmlClass{Field Operator}{\text{+}}}}\, \,\href{Ledger.Conway.Specification.Rewards.html#6292}{\htmlId{3155}{\htmlClass{Function}{\text{Δf}}}}\,\,\htmlId{3157}{\htmlClass{Symbol}{\text{)}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#2884}{\htmlId{3161}{\htmlClass{Bound}{\text{deposits}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#2895}{\htmlId{3172}{\htmlClass{Bound}{\text{donations}}}}\, \end{pmatrix}
    \\ \,\href{Ledger.Conway.Conformance.Epoch.html#2914}{\htmlId{3190}{\htmlClass{Bound}{\text{govSt}}}}\,
    \\ \begin{pmatrix} \begin{pmatrix} \,\href{Ledger.Conway.Conformance.Epoch.html#2930}{\htmlId{3206}{\htmlClass{Bound}{\text{voteDelegs}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#2943}{\htmlId{3219}{\htmlClass{Bound}{\text{stakeDelegs}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#2957}{\htmlId{3233}{\htmlClass{Bound}{\text{rewards}}}}\, \,\href{Axiom.Set.Map.Dec.html#2149}{\htmlId{3241}{\htmlClass{Function Operator}{\text{∪⁺}}}}\, \,\href{Ledger.Conway.Conformance.Epoch.html#3373}{\htmlId{3244}{\htmlClass{Function}{\text{regRU}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#2967}{\htmlId{3252}{\htmlClass{Bound}{\text{deposits&#39;}}}}\, \end{pmatrix} \\ \,\href{Ledger.Conway.Conformance.Epoch.html#2982}{\htmlId{3266}{\htmlClass{Bound}{\text{pState}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#2991}{\htmlId{3275}{\htmlClass{Bound}{\text{gState}}}}\, \end{pmatrix} \end{pmatrix}
  \\ \,\href{Ledger.Conway.Conformance.Epoch.html#3009}{\htmlId{3290}{\htmlClass{Bound}{\text{es}}}}\,
  \\ \,\href{Ledger.Conway.Conformance.Epoch.html#3016}{\htmlId{3297}{\htmlClass{Bound}{\text{fut}}}}\, \end{pmatrix}$</a>
  <a id="3305" class="Keyword">where</a>
    <a id="3315" class="Keyword">open</a> <a id="3320" href="Ledger.Conway.Specification.Rewards.html#6249" class="Module">RewardUpdate</a> <a id="3333" href="Ledger.Conway.Conformance.Epoch.html#2813" class="Bound">rewardUpdate</a> <a id="3346" class="Keyword">using</a> <a id="3352" class="Symbol">(</a><a id="3353" href="Ledger.Conway.Specification.Rewards.html#6286" class="Field">Δt</a><a id="3355" class="Symbol">;</a> <a id="3357" href="Ledger.Conway.Specification.Rewards.html#6289" class="Field">Δr</a><a id="3359" class="Symbol">;</a> <a id="3361" href="Ledger.Conway.Specification.Rewards.html#6292" class="Field">Δf</a><a id="3363" class="Symbol">;</a> <a id="3365" href="Ledger.Conway.Specification.Rewards.html#6312" class="Field">rs</a><a id="3367" class="Symbol">)</a>
    <a id="3373" href="Ledger.Conway.Conformance.Epoch.html#3373" class="Function">regRU</a>     <a id="3383" class="Symbol">=</a> <a id="3385" href="Ledger.Conway.Specification.Rewards.html#6312" class="Function">rs</a> <a id="3388" href="Axiom.Set.Map.html#13536" class="Function Operator">∣</a> <a id="3390" href="Class.IsSet.html#916" class="Function">dom</a> <a id="3394" href="Ledger.Conway.Conformance.Epoch.html#2957" class="Bound">rewards</a>
    <a id="3406" href="Ledger.Conway.Conformance.Epoch.html#3406" class="Function">unregRU</a>   <a id="3416" class="Symbol">=</a> <a id="3418" href="Ledger.Conway.Specification.Rewards.html#6312" class="Function">rs</a> <a id="3421" href="Axiom.Set.Map.html#13606" class="Function Operator">∣</a> <a id="3423" href="Class.IsSet.html#916" class="Function">dom</a> <a id="3427" href="Ledger.Conway.Conformance.Epoch.html#2957" class="Bound">rewards</a> <a id="3435" href="Axiom.Set.Map.html#13606" class="Function Operator">ᶜ</a>
    <a id="3441" href="Ledger.Conway.Conformance.Epoch.html#3441" class="Function">unregRU&#39;</a>  <a id="3451" class="Symbol">=</a> <a id="3453" href="abstract-set-theory.FiniteSetTheory.html#4373" class="Function">∑[</a> <a id="3456" href="Ledger.Conway.Conformance.Epoch.html#3456" class="Bound">x</a> <a id="3458" href="abstract-set-theory.FiniteSetTheory.html#4373" class="Function">←</a> <a id="3460" href="Ledger.Conway.Conformance.Epoch.html#3406" class="Function">unregRU</a> <a id="3468" href="abstract-set-theory.FiniteSetTheory.html#4373" class="Function">]</a> <a id="3470" href="Ledger.Conway.Conformance.Epoch.html#3456" class="Bound">x</a>

<a id="3473" class="Keyword">opaque</a>
  <a id="calculatePoolDelegatedStake"></a><a id="3482" href="Ledger.Conway.Conformance.Epoch.html#3482" class="Function">calculatePoolDelegatedStake</a> <a id="3510" class="Symbol">:</a> <a id="3512" href="Ledger.Conway.Specification.Rewards.html#6472" class="Record">Snapshot</a> <a id="3521" class="Symbol">→</a> <a id="3523" href="Ledger.Conway.Conformance.Epoch.html#1440" class="Function">PoolDelegatedStake</a>
  <a id="3544" href="Ledger.Conway.Conformance.Epoch.html#3482" class="Function">calculatePoolDelegatedStake</a> <a id="3572" href="Ledger.Conway.Conformance.Epoch.html#3572" class="Bound">ss</a> <a id="3575" class="Symbol">=</a>
      <a id="3583" class="Comment">-- Shelley spec: the output map must contain keys appearing in both</a>
      <a id="3657" class="Comment">-- sd and the pool parameters.</a>
      <a id="3694" href="Ledger.Conway.Conformance.Epoch.html#3950" class="Function">sd</a> <a id="3697" href="Axiom.Set.Map.html#13536" class="Function Operator">∣</a> <a id="3699" href="Class.IsSet.html#916" class="Function">dom</a> <a id="3703" class="Symbol">(</a><a id="3704" href="Ledger.Conway.Conformance.Epoch.html#3572" class="Bound">ss</a> <a id="3707" class="Symbol">.</a><a id="3708" href="Ledger.Conway.Specification.Rewards.html#6561" class="Field">pools</a><a id="3713" class="Symbol">)</a>
    <a id="3719" class="Keyword">where</a>
      <a id="3731" class="Keyword">open</a> <a id="3736" href="Ledger.Conway.Specification.Rewards.html#6472" class="Module">Snapshot</a>

      <a id="3752" class="Comment">-- stake credentials delegating to each pool</a>
      <a id="3803" href="Ledger.Conway.Conformance.Epoch.html#3803" class="Function">stakeCredentialsPerPool</a> <a id="3827" class="Symbol">:</a> <a id="3829" href="Axiom.Set.Rel.html#1312" class="Function">Rel</a> <a id="3833" href="Ledger.Core.Specification.Crypto.html#1386" class="Function">KeyHash</a> <a id="3841" href="Ledger.Core.Specification.Address.html#259" class="Datatype">Credential</a>
      <a id="3858" href="Ledger.Conway.Conformance.Epoch.html#3803" class="Function">stakeCredentialsPerPool</a> <a id="3882" class="Symbol">=</a> <a id="3884" class="Symbol">(</a><a id="3885" href="Ledger.Conway.Specification.Certs.html#1898" class="Field">StakeDelegsOf</a> <a id="3899" href="Ledger.Conway.Conformance.Epoch.html#3572" class="Bound">ss</a> <a id="3902" href="Axiom.Set.Map.html#2293" class="Function Operator">ˢ</a><a id="3903" class="Symbol">)</a> <a id="3905" href="Axiom.Set.Rel.html#1608" class="Function Operator">⁻¹ʳ</a>

      <a id="3916" class="Comment">-- delegated stake per pool</a>
      <a id="3950" href="Ledger.Conway.Conformance.Epoch.html#3950" class="Function">sd</a> <a id="3953" class="Symbol">:</a> <a id="3955" href="Ledger.Core.Specification.Crypto.html#1386" class="Function">KeyHash</a> <a id="3963" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="3965" href="Ledger.Prelude.Base.html#154" class="Function">Coin</a>
      <a id="3976" href="Ledger.Conway.Conformance.Epoch.html#3950" class="Function">sd</a> <a id="3979" class="Symbol">=</a> <a id="3981" href="Axiom.Set.Map.Dec.html#2227" class="Function">aggregate₊</a> <a id="3992" class="Symbol">((</a><a id="3994" href="Ledger.Conway.Conformance.Epoch.html#3803" class="Function">stakeCredentialsPerPool</a> <a id="4018" href="abstract-set-theory.FiniteSetTheory.html#3111" class="Function Operator">∘ʳ</a> <a id="4021" class="Symbol">(</a><a id="4022" href="Ledger.Conway.Specification.Certs.html#1814" class="Field">StakeOf</a> <a id="4030" href="Ledger.Conway.Conformance.Epoch.html#3572" class="Bound">ss</a> <a id="4033" href="Axiom.Set.Map.html#2293" class="Function Operator">ˢ</a><a id="4034" class="Symbol">))</a> <a id="4037" href="abstract-set-theory.FiniteSetTheory.html#2921" class="Function Operator">ᶠˢ</a><a id="4039" class="Symbol">)</a>


<a id="4043" class="Keyword">private</a> <a id="4051" class="Keyword">variable</a>
  <a id="4062" href="Ledger.Conway.Conformance.Epoch.html#4062" class="Generalizable">nes</a> <a id="4066" href="Ledger.Conway.Conformance.Epoch.html#4066" class="Generalizable">nes&#39;</a> <a id="4071" class="Symbol">:</a> <a id="4073" href="Ledger.Conway.Conformance.Epoch.html#1510" class="Record">NewEpochState</a>
  <a id="4089" href="Ledger.Conway.Conformance.Epoch.html#4089" class="Generalizable">e</a> <a id="4091" href="Ledger.Conway.Conformance.Epoch.html#4091" class="Generalizable">lastEpoch</a> <a id="4101" class="Symbol">:</a> <a id="4103" href="Ledger.Core.Specification.Epoch.html#646" class="Function">Epoch</a>
  <a id="4111" href="Ledger.Conway.Conformance.Epoch.html#4111" class="Generalizable">fut</a> <a id="4115" href="Ledger.Conway.Conformance.Epoch.html#4115" class="Generalizable">fut&#39;</a> <a id="4120" class="Symbol">:</a> <a id="4122" href="Ledger.Conway.Specification.Ratify.html#3537" class="Record">RatifyState</a>
  <a id="4136" href="Ledger.Conway.Conformance.Epoch.html#4136" class="Generalizable">eps</a> <a id="4140" href="Ledger.Conway.Conformance.Epoch.html#4140" class="Generalizable">eps&#39;</a> <a id="4145" href="Ledger.Conway.Conformance.Epoch.html#4145" class="Generalizable">eps&#39;&#39;</a> <a id="4151" class="Symbol">:</a> <a id="4153" href="Ledger.Conway.Conformance.Epoch.html#1249" class="Record">EpochState</a>
  <a id="4166" href="Ledger.Conway.Conformance.Epoch.html#4166" class="Generalizable">ls</a> <a id="4169" class="Symbol">:</a> <a id="4171" href="Ledger.Conway.Conformance.Ledger.html#779" class="Record">LState</a>
  <a id="4180" href="Ledger.Conway.Conformance.Epoch.html#4180" class="Generalizable">acnt</a> <a id="4185" class="Symbol">:</a> <a id="4187" href="Ledger.Conway.Specification.PParams.html#760" class="Record">Acnt</a>
  <a id="4194" href="Ledger.Conway.Conformance.Epoch.html#4194" class="Generalizable">es₀</a> <a id="4198" class="Symbol">:</a> <a id="4200" href="Ledger.Conway.Specification.Enact.html#448" class="Record">EnactState</a>
  <a id="4213" href="Ledger.Conway.Conformance.Epoch.html#4213" class="Generalizable">mark</a> <a id="4218" href="Ledger.Conway.Conformance.Epoch.html#4218" class="Generalizable">set</a> <a id="4222" href="Ledger.Conway.Conformance.Epoch.html#4222" class="Generalizable">go</a> <a id="4225" class="Symbol">:</a> <a id="4227" href="Ledger.Conway.Specification.Rewards.html#6472" class="Record">Snapshot</a>
  <a id="4238" href="Ledger.Conway.Conformance.Epoch.html#4238" class="Generalizable">feeSS</a> <a id="4244" class="Symbol">:</a> <a id="4246" href="Ledger.Prelude.Base.html#154" class="Function">Coin</a>
  <a id="4253" href="Ledger.Conway.Conformance.Epoch.html#4253" class="Generalizable">lstate</a> <a id="4260" class="Symbol">:</a> <a id="4262" href="Ledger.Conway.Conformance.Ledger.html#779" class="Record">LState</a>
  <a id="4271" href="Ledger.Conway.Conformance.Epoch.html#4271" class="Generalizable">ss</a> <a id="4274" href="Ledger.Conway.Conformance.Epoch.html#4274" class="Generalizable">ss&#39;</a> <a id="4278" class="Symbol">:</a> <a id="4280" href="Ledger.Conway.Specification.Rewards.html#7719" class="Record">Snapshots</a>
  <a id="4292" href="Ledger.Conway.Conformance.Epoch.html#4292" class="Generalizable">ru</a> <a id="4295" class="Symbol">:</a> <a id="4297" href="Ledger.Conway.Specification.Rewards.html#6249" class="Record">RewardUpdate</a>
  <a id="4312" href="Ledger.Conway.Conformance.Epoch.html#4312" class="Generalizable">mru</a> <a id="4316" class="Symbol">:</a> <a id="4318" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="4324" href="Ledger.Conway.Specification.Rewards.html#6249" class="Record">RewardUpdate</a>
  <a id="4339" href="Ledger.Conway.Conformance.Epoch.html#4339" class="Generalizable">certState&#39;</a> <a id="4350" class="Symbol">:</a> <a id="4352" href="Ledger.Conway.Conformance.Certs.html#962" class="Record">CertState</a>

<a id="4363" class="Keyword">data</a> <a id="_⊢_⇀⦇_,EPOCH⦈_"></a><a id="4368" href="Ledger.Conway.Conformance.Epoch.html#4368" class="Datatype Operator">_⊢_⇀⦇_,EPOCH⦈_</a> <a id="4383" class="Symbol">:</a> <a id="4385" href="Agda.Builtin.Unit.html#175" class="Record">⊤</a> <a id="4387" class="Symbol">→</a> <a id="4389" href="Ledger.Conway.Conformance.Epoch.html#1249" class="Record">EpochState</a> <a id="4400" class="Symbol">→</a> <a id="4402" href="Ledger.Core.Specification.Epoch.html#646" class="Function">Epoch</a> <a id="4408" class="Symbol">→</a> <a id="4410" href="Ledger.Conway.Conformance.Epoch.html#1249" class="Record">EpochState</a> <a id="4421" class="Symbol">→</a> <a id="4423" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="4428" class="Keyword">where</a>

  <a id="_⊢_⇀⦇_,EPOCH⦈_.EPOCH"></a><a id="4437" href="Ledger.Conway.Conformance.Epoch.html#4437" class="InductiveConstructor">EPOCH</a> <a id="4443" class="Symbol">:</a> <a id="4445" class="Keyword">let</a>
      <a id="4455" class="Keyword">open</a> <a id="4460" href="Ledger.Conway.Conformance.Ledger.html#779" class="Module">LState</a> <a id="4467" href="Ledger.Conway.Conformance.Epoch.html#4166" class="Generalizable">ls</a>
      <a id="4476" class="Keyword">open</a> <a id="4481" href="Ledger.Conway.Conformance.Certs.html#962" class="Module">CertState</a> <a id="4491" href="Ledger.Conway.Conformance.Ledger.html#887" class="Function">certState</a>
      <a id="4507" class="Keyword">open</a> <a id="4512" href="Ledger.Conway.Specification.Ratify.html#3537" class="Module">RatifyState</a> <a id="4524" href="Ledger.Conway.Conformance.Epoch.html#4111" class="Generalizable">fut</a> <a id="4528" class="Keyword">renaming</a> <a id="4537" class="Symbol">(</a><a id="4538" href="Ledger.Conway.Specification.Ratify.html#3574" class="Field">es</a> <a id="4541" class="Symbol">to</a> <a id="4544" class="Field">esW</a><a id="4547" class="Symbol">)</a>
      <a id="4555" class="Keyword">open</a> <a id="4560" href="Ledger.Conway.Specification.Utxo.html#1226" class="Module">UTxOState</a>
      <a id="4576" class="Keyword">open</a> <a id="4581" href="Ledger.Conway.Specification.Certs.html#3909" class="Module">PState</a><a id="4587" class="Symbol">;</a> <a id="4589" class="Keyword">open</a> <a id="4594" href="Ledger.Conway.Conformance.Certs.html#608" class="Module">DState</a><a id="4600" class="Symbol">;</a> <a id="4602" class="Keyword">open</a> <a id="4607" href="Ledger.Conway.Conformance.Certs.html#794" class="Module">GState</a>
      <a id="4620" class="Keyword">open</a> <a id="4625" href="Ledger.Conway.Specification.PParams.html#760" class="Module">Acnt</a><a id="4629" class="Symbol">;</a> <a id="4631" class="Keyword">open</a> <a id="4636" href="Ledger.Conway.Specification.Enact.html#448" class="Module">EnactState</a><a id="4646" class="Symbol">;</a> <a id="4648" class="Keyword">open</a> <a id="4653" href="Ledger.Conway.Specification.Gov.Actions.html#3822" class="Module">GovActionState</a>

      <a id="4675" href="Ledger.Conway.Conformance.Epoch.html#4675" class="Bound">es</a> <a id="4678" class="Symbol">:</a> <a id="4680" href="Ledger.Conway.Specification.Enact.html#448" class="Record">EnactState</a>
      <a id="4697" href="Ledger.Conway.Conformance.Epoch.html#4675" class="Bound">es</a> <a id="4700" class="Symbol">=</a> <a id="4702" class="Keyword">record</a> <a id="4709" href="Ledger.Conway.Conformance.Epoch.html#4544" class="Function">esW</a> <a id="4713" class="Symbol">{</a> <a id="4715" href="Ledger.Conway.Specification.Enact.html#700" class="Field">withdrawals</a> <a id="4727" class="Symbol">=</a> <a id="4729" href="Class.HasEmptySet.html#287" class="Field">∅</a> <a id="4731" class="Symbol">}</a>

      <a id="4740" href="Ledger.Conway.Conformance.Epoch.html#4740" class="Bound">tmpGovSt</a> <a id="4749" class="Symbol">=</a> <a id="4751" href="Data.List.Base.html#10389" class="Function">filter</a> <a id="4758" class="Symbol">(λ</a> <a id="4761" href="Ledger.Conway.Conformance.Epoch.html#4761" class="Bound">x</a> <a id="4763" class="Symbol">→</a> <a id="4765" href="Class.Decidable.Core.html#470" class="Function Operator">¿</a> <a id="4767" href="Data.Product.Base.html#636" class="Field">proj₁</a> <a id="4773" href="Ledger.Conway.Conformance.Epoch.html#4761" class="Bound">x</a> <a id="4775" href="Class.IsSet.html#462" class="Function Operator">∉</a> <a id="4777" href="abstract-set-theory.FiniteSetTheory.html#519" class="Function">mapˢ</a> <a id="4782" href="Data.Product.Base.html#636" class="Field">proj₁</a> <a id="4788" href="Ledger.Conway.Specification.Ratify.html#3600" class="Function">removed</a> <a id="4796" href="Class.Decidable.Core.html#470" class="Function Operator">¿</a><a id="4797" class="Symbol">)</a> <a id="4799" href="Ledger.Conway.Conformance.Ledger.html#861" class="Function">govSt</a>

      <a id="4812" href="Ledger.Conway.Conformance.Epoch.html#4812" class="Bound">orphans</a> <a id="4820" class="Symbol">:</a> <a id="4822" href="abstract-set-theory.FiniteSetTheory.html#488" class="Function Operator">ℙ</a> <a id="4824" class="Symbol">(</a><a id="4825" href="Ledger.Conway.Specification.Gov.Actions.html#1980" class="Function">GovActionID</a> <a id="4837" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="4839" href="Ledger.Conway.Specification.Gov.Actions.html#3822" class="Record">GovActionState</a><a id="4853" class="Symbol">)</a>
      <a id="4861" href="Ledger.Conway.Conformance.Epoch.html#4812" class="Bound">orphans</a>  <a id="4870" class="Symbol">=</a> <a id="4872" href="Axiom.Set.html#5903" class="Function">fromList</a> <a id="4881" class="Symbol">(</a><a id="4882" href="Ledger.Conway.Specification.Epoch.html#13228" class="Function">getOrphans</a> <a id="4893" href="Ledger.Conway.Conformance.Epoch.html#4675" class="Bound">es</a> <a id="4896" href="Ledger.Conway.Conformance.Epoch.html#4740" class="Bound">tmpGovSt</a><a id="4904" class="Symbol">)</a>

      <a id="4913" href="Ledger.Conway.Conformance.Epoch.html#4913" class="Bound">removed&#39;</a> <a id="4922" class="Symbol">:</a> <a id="4924" href="abstract-set-theory.FiniteSetTheory.html#488" class="Function Operator">ℙ</a> <a id="4926" class="Symbol">(</a><a id="4927" href="Ledger.Conway.Specification.Gov.Actions.html#1980" class="Function">GovActionID</a> <a id="4939" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="4941" href="Ledger.Conway.Specification.Gov.Actions.html#3822" class="Record">GovActionState</a><a id="4955" class="Symbol">)</a>
      <a id="4963" href="Ledger.Conway.Conformance.Epoch.html#4913" class="Bound">removed&#39;</a> <a id="4972" class="Symbol">=</a> <a id="4974" href="Ledger.Conway.Specification.Ratify.html#3600" class="Function">removed</a> <a id="4982" href="Axiom.Set.html#9137" class="Function Operator">∪</a> <a id="4984" href="Ledger.Conway.Conformance.Epoch.html#4812" class="Bound">orphans</a>

      <a id="4999" href="Ledger.Conway.Conformance.Epoch.html#4999" class="Bound">govSt&#39;</a> <a id="5006" class="Symbol">=</a> <a id="5008" href="Data.List.Base.html#10389" class="Function">filter</a> <a id="5015" class="Symbol">(λ</a> <a id="5018" href="Ledger.Conway.Conformance.Epoch.html#5018" class="Bound">x</a> <a id="5020" class="Symbol">→</a> <a id="5022" href="Class.Decidable.Core.html#470" class="Function Operator">¿</a> <a id="5024" href="Data.Product.Base.html#636" class="Field">proj₁</a> <a id="5030" href="Ledger.Conway.Conformance.Epoch.html#5018" class="Bound">x</a> <a id="5032" href="Class.IsSet.html#462" class="Function Operator">∉</a> <a id="5034" href="abstract-set-theory.FiniteSetTheory.html#519" class="Function">mapˢ</a> <a id="5039" href="Data.Product.Base.html#636" class="Field">proj₁</a> <a id="5045" href="Ledger.Conway.Conformance.Epoch.html#4913" class="Bound">removed&#39;</a> <a id="5054" href="Class.Decidable.Core.html#470" class="Function Operator">¿</a><a id="5055" class="Symbol">)</a> <a id="5057" href="Ledger.Conway.Conformance.Ledger.html#861" class="Function">govSt</a>

      <a id="5070" href="Ledger.Conway.Conformance.Epoch.html#5070" class="Bound">removedGovActions</a> <a id="5088" class="Symbol">:</a> <a id="5090" href="abstract-set-theory.FiniteSetTheory.html#488" class="Function Operator">ℙ</a> <a id="5092" class="Symbol">(</a><a id="5093" href="Ledger.Core.Specification.Address.html#1313" class="Record">RewardAddress</a> <a id="5107" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="5109" href="Ledger.Conway.Specification.Certs.html#571" class="Datatype">DepositPurpose</a> <a id="5124" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="5126" href="Ledger.Prelude.Base.html#154" class="Function">Coin</a><a id="5130" class="Symbol">)</a>
      <a id="5138" href="Ledger.Conway.Conformance.Epoch.html#5070" class="Bound">removedGovActions</a> <a id="5156" class="Symbol">=</a>
        <a id="5166" href="Function.Base.html#1657" class="Function">flip</a> <a id="5171" href="Axiom.Set.html#7207" class="Function">concatMapˢ</a> <a id="5182" href="Ledger.Conway.Conformance.Epoch.html#4913" class="Bound">removed&#39;</a> <a id="5191" class="Symbol">λ</a> <a id="5193" class="Symbol">(</a><a id="5194" href="Ledger.Conway.Conformance.Epoch.html#5194" class="Bound">gaid</a> <a id="5199" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5201" href="Ledger.Conway.Conformance.Epoch.html#5201" class="Bound">gaSt</a><a id="5205" class="Symbol">)</a> <a id="5207" class="Symbol">→</a>
          <a id="5219" href="abstract-set-theory.FiniteSetTheory.html#519" class="Function">mapˢ</a>
            <a id="5236" class="Symbol">(</a><a id="5237" href="Ledger.Conway.Specification.Gov.Actions.html#3889" class="Field">returnAddr</a> <a id="5248" href="Ledger.Conway.Conformance.Epoch.html#5201" class="Bound">gaSt</a> <a id="5253" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,_</a><a id="5255" class="Symbol">)</a>
            <a id="5269" class="Symbol">((</a><a id="5271" href="Ledger.Conway.Conformance.Ledger.html#834" class="Function">utxoSt</a> <a id="5278" class="Symbol">.</a><a id="5279" href="Ledger.Conway.Specification.Utxo.html#1334" class="Field">deposits</a> <a id="5288" href="Axiom.Set.Map.html#13536" class="Function Operator">∣</a> <a id="5290" href="Class.HasSingleton.html#288" class="Field Operator">❴</a> <a id="5292" href="Ledger.Conway.Specification.Certs.html#760" class="InductiveConstructor">GovActionDeposit</a> <a id="5309" href="Ledger.Conway.Conformance.Epoch.html#5194" class="Bound">gaid</a> <a id="5314" href="Class.HasSingleton.html#288" class="Field Operator">❵</a><a id="5315" class="Symbol">)</a> <a id="5317" href="Axiom.Set.Map.html#2293" class="Function Operator">ˢ</a><a id="5318" class="Symbol">)</a>

      <a id="5327" href="Ledger.Conway.Conformance.Epoch.html#5327" class="Bound">govActionReturns</a> <a id="5344" class="Symbol">:</a> <a id="5346" href="Ledger.Core.Specification.Address.html#1313" class="Record">RewardAddress</a> <a id="5360" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="5362" href="Ledger.Prelude.Base.html#154" class="Function">Coin</a>
      <a id="5373" href="Ledger.Conway.Conformance.Epoch.html#5327" class="Bound">govActionReturns</a> <a id="5390" class="Symbol">=</a>
        <a id="5400" href="Axiom.Set.Map.Dec.html#2227" class="Function">aggregate₊</a> <a id="5411" class="Symbol">(</a><a id="5412" href="abstract-set-theory.FiniteSetTheory.html#519" class="Function">mapˢ</a> <a id="5417" class="Symbol">(λ</a> <a id="5420" class="Symbol">(</a><a id="5421" href="Ledger.Conway.Conformance.Epoch.html#5421" class="Bound">a</a> <a id="5423" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5425" class="Symbol">_</a> <a id="5427" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5429" href="Ledger.Conway.Conformance.Epoch.html#5429" class="Bound">d</a><a id="5430" class="Symbol">)</a> <a id="5432" class="Symbol">→</a> <a id="5434" href="Ledger.Conway.Conformance.Epoch.html#5421" class="Bound">a</a> <a id="5436" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5438" href="Ledger.Conway.Conformance.Epoch.html#5429" class="Bound">d</a><a id="5439" class="Symbol">)</a> <a id="5441" href="Ledger.Conway.Conformance.Epoch.html#5070" class="Bound">removedGovActions</a> <a id="5459" href="abstract-set-theory.FiniteSetTheory.html#2921" class="Function Operator">ᶠˢ</a><a id="5461" class="Symbol">)</a>

      <a id="5470" href="Ledger.Conway.Conformance.Epoch.html#5470" class="Bound">trWithdrawals</a>   <a id="5486" class="Symbol">=</a> <a id="5488" href="Ledger.Conway.Conformance.Epoch.html#4544" class="Function">esW</a> <a id="5492" class="Symbol">.</a><a id="5493" href="Ledger.Conway.Specification.Enact.html#700" class="Field">withdrawals</a>
      <a id="5511" href="Ledger.Conway.Conformance.Epoch.html#5511" class="Bound">totWithdrawals</a>  <a id="5527" class="Symbol">=</a> <a id="5529" href="abstract-set-theory.FiniteSetTheory.html#4373" class="Function">∑[</a> <a id="5532" href="Ledger.Conway.Conformance.Epoch.html#5532" class="Bound">x</a> <a id="5534" href="abstract-set-theory.FiniteSetTheory.html#4373" class="Function">←</a> <a id="5536" href="Ledger.Conway.Conformance.Epoch.html#5470" class="Bound">trWithdrawals</a> <a id="5550" href="abstract-set-theory.FiniteSetTheory.html#4373" class="Function">]</a> <a id="5552" href="Ledger.Conway.Conformance.Epoch.html#5532" class="Bound">x</a>

      <a id="5561" href="Ledger.Conway.Conformance.Epoch.html#5561" class="Bound">retired</a>    <a id="5572" class="Symbol">=</a> <a id="5574" class="Symbol">(</a><a id="5575" href="Ledger.Conway.Conformance.Certs.html#1041" class="Function">pState</a> <a id="5582" class="Symbol">.</a><a id="5583" href="Ledger.Conway.Specification.Certs.html#3985" class="Field">retiring</a><a id="5591" class="Symbol">)</a> <a id="5593" href="Axiom.Set.Map.html#17957" class="Function Operator">⁻¹</a> <a id="5596" href="Ledger.Conway.Conformance.Epoch.html#4089" class="Generalizable">e</a>
      <a id="5604" href="Ledger.Conway.Conformance.Epoch.html#5604" class="Bound">payout</a>     <a id="5615" class="Symbol">=</a> <a id="5617" href="Ledger.Conway.Conformance.Epoch.html#5327" class="Bound">govActionReturns</a> <a id="5634" href="Axiom.Set.Map.Dec.html#2149" class="Function Operator">∪⁺</a> <a id="5637" href="Ledger.Conway.Conformance.Epoch.html#5470" class="Bound">trWithdrawals</a>
      <a id="5657" href="Ledger.Conway.Conformance.Epoch.html#5657" class="Bound">refunds</a>    <a id="5668" class="Symbol">=</a> <a id="5670" href="Axiom.Set.Map.html#17518" class="Function">pullbackMap</a> <a id="5682" href="Ledger.Conway.Conformance.Epoch.html#5604" class="Bound">payout</a> <a id="5689" href="Ledger.Conway.Specification.Epoch.html#5507" class="Function">toRewardAddress</a> <a id="5705" class="Symbol">(</a><a id="5706" href="Class.IsSet.html#916" class="Function">dom</a> <a id="5710" class="Symbol">(</a><a id="5711" href="Ledger.Conway.Conformance.Certs.html#1021" class="Function">dState</a> <a id="5718" class="Symbol">.</a><a id="5719" href="Ledger.Conway.Conformance.Certs.html#735" class="Field">rewards</a><a id="5726" class="Symbol">))</a>
      <a id="5735" href="Ledger.Conway.Conformance.Epoch.html#5735" class="Bound">unclaimed</a>  <a id="5746" class="Symbol">=</a> <a id="5748" href="Ledger.Prelude.HasCoin.html#171" class="Field">getCoin</a> <a id="5756" href="Ledger.Conway.Conformance.Epoch.html#5604" class="Bound">payout</a> <a id="5763" href="Interface.TypeClasses.HasSubtract.html#223" class="Field Operator">-</a> <a id="5765" href="Ledger.Prelude.HasCoin.html#171" class="Field">getCoin</a> <a id="5773" href="Ledger.Conway.Conformance.Epoch.html#5657" class="Bound">refunds</a>
      <a id="5787" href="Ledger.Conway.Conformance.Epoch.html#5787" class="Bound">vDeposits</a>  <a id="5798" class="Symbol">=</a> <a id="5800" href="Ledger.Conway.Conformance.Certs.html#1061" class="Function">gState</a> <a id="5807" class="Symbol">.</a><a id="5808" href="Ledger.Conway.Conformance.Certs.html#932" class="Field">deposits</a>

      <a id="5824" href="Ledger.Conway.Conformance.Epoch.html#5824" class="Bound">dState&#39;</a> <a id="5832" class="Symbol">:</a> <a id="5834" href="Ledger.Conway.Conformance.Certs.html#608" class="Record">DState</a>
      <a id="5847" href="Ledger.Conway.Conformance.Epoch.html#5824" class="Bound">dState&#39;</a> <a id="5855" class="Symbol">=</a> <a id="5857" class="Keyword">record</a> <a id="5864" href="Ledger.Conway.Conformance.Certs.html#1021" class="Function">dState</a> <a id="5871" class="Symbol">{</a> <a id="5873" href="Ledger.Conway.Conformance.Certs.html#735" class="Field">rewards</a> <a id="5881" class="Symbol">=</a> <a id="5883" href="Ledger.Conway.Conformance.Certs.html#1021" class="Function">dState</a> <a id="5890" class="Symbol">.</a><a id="5891" href="Ledger.Conway.Conformance.Certs.html#735" class="Field">rewards</a> <a id="5899" href="Axiom.Set.Map.Dec.html#2149" class="Function Operator">∪⁺</a> <a id="5902" href="Ledger.Conway.Conformance.Epoch.html#5657" class="Bound">refunds</a> <a id="5910" class="Symbol">}</a>

      <a id="5919" href="Ledger.Conway.Conformance.Epoch.html#5919" class="Bound">pState&#39;</a> <a id="5927" class="Symbol">:</a> <a id="5929" href="Ledger.Conway.Specification.Certs.html#3909" class="Record">PState</a>
      <a id="5942" href="Ledger.Conway.Conformance.Epoch.html#5919" class="Bound">pState&#39;</a> <a id="5950" class="Symbol">=</a> <a class="AgdaKaTeX">$\begin{pmatrix} \,\htmlId{5954}{\htmlClass{Symbol}{\text{(}}}\,\,\href{Ledger.Conway.Conformance.Certs.html#1041}{\htmlId{5955}{\htmlClass{Function}{\text{pState}}}}\, \,\htmlId{5962}{\htmlClass{Symbol}{\text{.}}}\,\,\href{Ledger.Conway.Specification.Certs.html#3941}{\htmlId{5963}{\htmlClass{Field}{\text{pools}}}}\,\,\htmlId{5968}{\htmlClass{Symbol}{\text{)}}}\, \,\href{Axiom.Set.Map.html#13606}{\htmlId{5970}{\htmlClass{Function Operator}{\text{∣}}}}\, \,\href{Ledger.Conway.Conformance.Epoch.html#5561}{\htmlId{5972}{\htmlClass{Bound}{\text{retired}}}}\, \,\href{Axiom.Set.Map.html#13606}{\htmlId{5980}{\htmlClass{Function Operator}{\text{ᶜ}}}}\,
                \\ \,\htmlId{6000}{\htmlClass{Symbol}{\text{(}}}\,\,\href{Ledger.Conway.Conformance.Certs.html#1041}{\htmlId{6001}{\htmlClass{Function}{\text{pState}}}}\, \,\htmlId{6008}{\htmlClass{Symbol}{\text{.}}}\,\,\href{Ledger.Conway.Specification.Certs.html#3963}{\htmlId{6009}{\htmlClass{Field}{\text{fPools}}}}\,\,\htmlId{6015}{\htmlClass{Symbol}{\text{)}}}\, \,\href{Axiom.Set.Map.html#13606}{\htmlId{6017}{\htmlClass{Function Operator}{\text{∣}}}}\, \,\href{Ledger.Conway.Conformance.Epoch.html#5561}{\htmlId{6019}{\htmlClass{Bound}{\text{retired}}}}\, \,\href{Axiom.Set.Map.html#13606}{\htmlId{6027}{\htmlClass{Function Operator}{\text{ᶜ}}}}\,
                \\ \,\htmlId{6047}{\htmlClass{Symbol}{\text{(}}}\,\,\href{Ledger.Conway.Conformance.Certs.html#1041}{\htmlId{6048}{\htmlClass{Function}{\text{pState}}}}\, \,\htmlId{6055}{\htmlClass{Symbol}{\text{.}}}\,\,\href{Ledger.Conway.Specification.Certs.html#3985}{\htmlId{6056}{\htmlClass{Field}{\text{retiring}}}}\,\,\htmlId{6064}{\htmlClass{Symbol}{\text{)}}}\, \,\href{Axiom.Set.Map.html#13606}{\htmlId{6066}{\htmlClass{Function Operator}{\text{∣}}}}\, \,\href{Ledger.Conway.Conformance.Epoch.html#5561}{\htmlId{6068}{\htmlClass{Bound}{\text{retired}}}}\, \,\href{Axiom.Set.Map.html#13606}{\htmlId{6076}{\htmlClass{Function Operator}{\text{ᶜ}}}}\,
                \end{pmatrix}$</a>

      <a id="6103" href="Ledger.Conway.Conformance.Epoch.html#6103" class="Bound">gState&#39;</a> <a id="6111" class="Symbol">:</a> <a id="6113" href="Ledger.Conway.Conformance.Certs.html#794" class="Record">GState</a>
      <a id="6126" href="Ledger.Conway.Conformance.Epoch.html#6103" class="Bound">gState&#39;</a> <a id="6134" class="Symbol">=</a> <a class="AgdaKaTeX">$\begin{pmatrix} \,\htmlId{6138}{\htmlClass{Symbol}{\text{(}}}\,\,\href{Class.ToBool.html#342}{\htmlId{6139}{\htmlClass{Function Operator}{\text{if}}}}\, \,\href{Data.List.Base.html#4681}{\htmlId{6142}{\htmlClass{Function}{\text{null}}}}\, \,\href{Ledger.Conway.Conformance.Epoch.html#4999}{\htmlId{6147}{\htmlClass{Bound}{\text{govSt&#39;}}}}\, \,\href{Class.ToBool.html#342}{\htmlId{6154}{\htmlClass{Function Operator}{\text{then}}}}\, \,\href{Axiom.Set.Map.html#7108}{\htmlId{6159}{\htmlClass{Function}{\text{mapValues}}}}\, \,\htmlId{6169}{\htmlClass{Symbol}{\text{(}}}\,\,\htmlId{6170}{\htmlClass{Number}{\text{1}}}\, \,\href{Class.HasAdd.Core.html#162}{\htmlId{6172}{\htmlClass{Field Operator}{\text{+\_}}}}\,\,\htmlId{6174}{\htmlClass{Symbol}{\text{)}}}\, \,\htmlId{6176}{\htmlClass{Symbol}{\text{(}}}\,\,\href{Ledger.Conway.Conformance.Certs.html#1061}{\htmlId{6177}{\htmlClass{Function}{\text{gState}}}}\, \,\htmlId{6184}{\htmlClass{Symbol}{\text{.}}}\,\,\href{Ledger.Conway.Conformance.Certs.html#849}{\htmlId{6185}{\htmlClass{Field}{\text{dreps}}}}\,\,\htmlId{6190}{\htmlClass{Symbol}{\text{)}}}\, \,\href{Class.ToBool.html#342}{\htmlId{6192}{\htmlClass{Function Operator}{\text{else}}}}\, \,\htmlId{6197}{\htmlClass{Symbol}{\text{(}}}\,\,\href{Ledger.Conway.Conformance.Certs.html#1061}{\htmlId{6198}{\htmlClass{Function}{\text{gState}}}}\, \,\htmlId{6205}{\htmlClass{Symbol}{\text{.}}}\,\,\href{Ledger.Conway.Conformance.Certs.html#849}{\htmlId{6206}{\htmlClass{Field}{\text{dreps}}}}\,\,\htmlId{6211}{\htmlClass{Symbol}{\text{))}}}\,
                , \,\htmlId{6232}{\htmlClass{Symbol}{\text{(}}}\,\,\href{Ledger.Conway.Conformance.Certs.html#1061}{\htmlId{6233}{\htmlClass{Function}{\text{gState}}}}\, \,\htmlId{6240}{\htmlClass{Symbol}{\text{.}}}\,\,\href{Ledger.Conway.Conformance.Certs.html#885}{\htmlId{6241}{\htmlClass{Field}{\text{ccHotKeys}}}}\,\,\htmlId{6250}{\htmlClass{Symbol}{\text{)}}}\, \,\href{Axiom.Set.Map.html#13536}{\htmlId{6252}{\htmlClass{Function Operator}{\text{∣}}}}\, \,\href{Ledger.Conway.Specification.Enact.html#1366}{\htmlId{6254}{\htmlClass{Function}{\text{ccCreds}}}}\, \,\htmlId{6262}{\htmlClass{Symbol}{\text{(}}}\,\,\href{Ledger.Conway.Conformance.Epoch.html#4675}{\htmlId{6263}{\htmlClass{Bound}{\text{es}}}}\, \,\htmlId{6266}{\htmlClass{Symbol}{\text{.}}}\,\,\href{Ledger.Conway.Specification.Enact.html#484}{\htmlId{6267}{\htmlClass{Field}{\text{cc}}}}\,\,\htmlId{6269}{\htmlClass{Symbol}{\text{)}}}\,
                , \,\href{Ledger.Conway.Conformance.Epoch.html#5787}{\htmlId{6289}{\htmlClass{Bound}{\text{vDeposits}}}}\,
                \end{pmatrix}$</a>

      <a id="6324" href="Ledger.Conway.Conformance.Epoch.html#6324" class="Bound">certState&#39;</a> <a id="6335" class="Symbol">:</a> <a id="6337" href="Ledger.Conway.Conformance.Certs.html#962" class="Record">CertState</a>
      <a id="6353" href="Ledger.Conway.Conformance.Epoch.html#6324" class="Bound">certState&#39;</a> <a id="6364" class="Symbol">=</a> <a id="6366" class="Keyword">record</a> <a id="6373" class="Symbol">{</a> <a id="6375" href="Ledger.Conway.Conformance.Certs.html#1021" class="Field">dState</a> <a id="6382" class="Symbol">=</a> <a id="6384" href="Ledger.Conway.Conformance.Epoch.html#5824" class="Bound">dState&#39;</a> <a id="6392" class="Symbol">;</a> <a id="6394" href="Ledger.Conway.Conformance.Certs.html#1041" class="Field">pState</a> <a id="6401" class="Symbol">=</a> <a id="6403" href="Ledger.Conway.Conformance.Epoch.html#5919" class="Bound">pState&#39;</a> <a id="6411" class="Symbol">;</a> <a id="6413" href="Ledger.Conway.Conformance.Certs.html#1061" class="Field">gState</a> <a id="6420" class="Symbol">=</a> <a id="6422" href="Ledger.Conway.Conformance.Epoch.html#6103" class="Bound">gState&#39;</a> <a id="6430" class="Symbol">}</a>

      <a id="6439" href="Ledger.Conway.Conformance.Epoch.html#6439" class="Bound">utxoSt&#39;</a> <a id="6447" class="Symbol">=</a> <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.Conway.Conformance.Ledger.html#834}{\htmlId{6451}{\htmlClass{Function}{\text{utxoSt}}}}\, \,\htmlId{6458}{\htmlClass{Symbol}{\text{.}}}\,\,\href{Ledger.Conway.Specification.Utxo.html#1290}{\htmlId{6459}{\htmlClass{Field}{\text{utxo}}}}\, \\ \,\href{Ledger.Conway.Conformance.Ledger.html#834}{\htmlId{6466}{\htmlClass{Function}{\text{utxoSt}}}}\, \,\htmlId{6473}{\htmlClass{Symbol}{\text{.}}}\,\,\href{Ledger.Conway.Specification.Utxo.html#1312}{\htmlId{6474}{\htmlClass{Field}{\text{fees}}}}\, \\ \,\href{Ledger.Conway.Conformance.Ledger.html#834}{\htmlId{6481}{\htmlClass{Function}{\text{utxoSt}}}}\, \,\htmlId{6488}{\htmlClass{Symbol}{\text{.}}}\,\,\href{Ledger.Conway.Specification.Utxo.html#1334}{\htmlId{6489}{\htmlClass{Field}{\text{deposits}}}}\, \,\href{Axiom.Set.Map.html#13606}{\htmlId{6498}{\htmlClass{Function Operator}{\text{∣}}}}\, \,\href{abstract-set-theory.FiniteSetTheory.html#519}{\htmlId{6500}{\htmlClass{Function}{\text{mapˢ}}}}\, \,\htmlId{6505}{\htmlClass{Symbol}{\text{(}}}\,\,\href{Data.Product.Base.html#636}{\htmlId{6506}{\htmlClass{Field}{\text{proj₁}}}}\, \,\href{Function.Base.html#1134}{\htmlId{6512}{\htmlClass{Function Operator}{\text{∘}}}}\, \,\href{Data.Product.Base.html#650}{\htmlId{6514}{\htmlClass{Field}{\text{proj₂}}}}\,\,\htmlId{6519}{\htmlClass{Symbol}{\text{)}}}\, \,\href{Ledger.Conway.Conformance.Epoch.html#5070}{\htmlId{6521}{\htmlClass{Bound}{\text{removedGovActions}}}}\, \,\href{Axiom.Set.Map.html#13606}{\htmlId{6539}{\htmlClass{Function Operator}{\text{ᶜ}}}}\, \\ \,\htmlId{6543}{\htmlClass{Number}{\text{0}}}\, \end{pmatrix}$</a>

      <a id="6554" href="Ledger.Conway.Conformance.Epoch.html#6554" class="Bound">acnt&#39;</a> <a id="6560" class="Symbol">=</a> <a id="6562" class="Keyword">record</a> <a id="6569" href="Ledger.Conway.Conformance.Epoch.html#4180" class="Generalizable">acnt</a>
        <a id="6582" class="Symbol">{</a> <a id="6584" href="Ledger.Conway.Specification.PParams.html#815" class="Field">treasury</a>  <a id="6594" class="Symbol">=</a> <a id="6596" href="Ledger.Conway.Conformance.Epoch.html#4180" class="Generalizable">acnt</a> <a id="6601" class="Symbol">.</a><a id="6602" href="Ledger.Conway.Specification.PParams.html#815" class="Field">treasury</a> <a id="6611" href="Data.Nat.Base.html#4462" class="Primitive Operator">∸</a> <a id="6613" href="Ledger.Conway.Conformance.Epoch.html#5511" class="Bound">totWithdrawals</a> <a id="6628" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="6630" href="Ledger.Conway.Conformance.Ledger.html#834" class="Function">utxoSt</a> <a id="6637" class="Symbol">.</a><a id="6638" href="Ledger.Conway.Specification.Utxo.html#1360" class="Field">donations</a> <a id="6648" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="6650" href="Ledger.Conway.Conformance.Epoch.html#5735" class="Bound">unclaimed</a> <a id="6660" class="Symbol">}</a>

      <a id="6669" href="Ledger.Conway.Conformance.Epoch.html#6669" class="Bound">stakeDistrs</a> <a id="6681" class="Symbol">:</a> <a id="6683" href="Ledger.Conway.Specification.Ratify.html#3126" class="Record">StakeDistrs</a>
      <a id="6701" href="Ledger.Conway.Conformance.Epoch.html#6669" class="Bound">stakeDistrs</a> <a id="6713" class="Symbol">=</a> <a id="6715" href="Ledger.Conway.Specification.Epoch.html#12537" class="Function">mkStakeDistrs</a> <a id="6729" class="Symbol">(</a><a id="6730" href="Ledger.Conway.Specification.Rewards.html#7753" class="Field">Snapshots.mark</a> <a id="6745" href="Ledger.Conway.Conformance.Epoch.html#4274" class="Generalizable">ss&#39;</a><a id="6748" class="Symbol">)</a> <a id="6750" href="Ledger.Conway.Conformance.Epoch.html#4089" class="Generalizable">e</a> <a id="6752" href="Ledger.Conway.Conformance.Epoch.html#6439" class="Bound">utxoSt&#39;</a> <a id="6760" href="Ledger.Conway.Conformance.Epoch.html#4999" class="Bound">govSt&#39;</a> <a id="6767" class="Symbol">(</a><a id="6768" class="Keyword">record</a> <a id="6775" class="Symbol">{</a> <a id="6777" href="Ledger.Conway.Conformance.Epoch.html#6777" class="Module">GState</a> <a id="6784" class="Symbol">(</a><a id="6785" href="Ledger.Conway.Conformance.Certs.html#1061" class="Field">CertState.gState</a> <a id="6802" class="Symbol">(</a><a id="6803" href="Ledger.Conway.Conformance.Ledger.html#887" class="Field">LState.certState</a> <a id="6820" href="Ledger.Conway.Conformance.Epoch.html#4166" class="Generalizable">ls</a><a id="6822" class="Symbol">))</a> <a id="6825" class="Symbol">})</a>
                                                                        <a id="6900" class="Symbol">(</a><a id="6901" class="Keyword">record</a> <a id="6908" class="Symbol">{</a> <a id="6910" href="Ledger.Conway.Conformance.Epoch.html#6910" class="Module">DState</a> <a id="6917" class="Symbol">(</a><a id="6918" href="Ledger.Conway.Conformance.Certs.html#1021" class="Field">CertState.dState</a> <a id="6935" class="Symbol">(</a><a id="6936" href="Ledger.Conway.Conformance.Ledger.html#887" class="Field">LState.certState</a> <a id="6953" href="Ledger.Conway.Conformance.Epoch.html#4166" class="Generalizable">ls</a><a id="6955" class="Symbol">))</a> <a id="6958" class="Symbol">})</a>

    <a id="6966" class="Keyword">in</a>
    <a id="6973" class="Keyword">record</a> <a id="6980" class="Symbol">{</a> <a id="6982" href="Ledger.Conway.Specification.Ratify.html#3312" class="Field">currentEpoch</a> <a id="6995" class="Symbol">=</a> <a id="6997" href="Ledger.Conway.Conformance.Epoch.html#4089" class="Generalizable">e</a>
           <a id="7010" class="Symbol">;</a> <a id="7012" href="Ledger.Conway.Specification.Ratify.html#3280" class="Field">stakeDistrs</a> <a id="7024" class="Symbol">=</a> <a id="7026" href="Ledger.Conway.Conformance.Epoch.html#6669" class="Bound">stakeDistrs</a>
           <a id="7049" class="Symbol">;</a> <a id="7051" href="Ledger.Conway.Specification.Ratify.html#3427" class="Field">treasury</a> <a id="7060" class="Symbol">=</a> <a id="7062" href="Ledger.Conway.Conformance.Epoch.html#4180" class="Generalizable">acnt</a> <a id="7067" class="Symbol">.</a><a id="7068" href="Ledger.Conway.Specification.PParams.html#815" class="Field">treasury</a> <a id="7077" class="Symbol">;</a> <a id="7079" href="Ledger.Conway.Conformance.Epoch.html#7079" class="Module">GState</a> <a id="7086" href="Ledger.Conway.Conformance.Certs.html#1061" class="Function">gState</a>
           <a id="7104" class="Symbol">;</a> <a id="7106" href="Ledger.Conway.Specification.Ratify.html#3456" class="Field">pools</a> <a id="7112" class="Symbol">=</a> <a id="7114" href="Ledger.Conway.Conformance.Certs.html#1041" class="Function">pState</a> <a id="7121" class="Symbol">.</a><a id="7122" href="Ledger.Conway.Specification.Certs.html#3941" class="Field">pools</a> <a id="7128" class="Symbol">;</a> <a id="7130" href="Ledger.Conway.Specification.Ratify.html#3502" class="Field">delegatees</a> <a id="7141" class="Symbol">=</a> <a id="7143" href="Ledger.Conway.Conformance.Certs.html#1021" class="Function">dState</a> <a id="7150" class="Symbol">.</a><a id="7151" href="Ledger.Conway.Conformance.Certs.html#665" class="Field">voteDelegs</a> <a id="7162" class="Symbol">}</a>
        <a id="7172" href="Ledger.Conway.Specification.Ratify.html#13648" class="Function Operator">⊢</a> <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.Conway.Conformance.Epoch.html#4675}{\htmlId{7176}{\htmlClass{Bound}{\text{es}}}}\, \\ \,\href{Class.HasEmptySet.html#287}{\htmlId{7181}{\htmlClass{Field}{\text{∅}}}}\, \\ \,\href{Agda.Builtin.Bool.html#192}{\htmlId{7185}{\htmlClass{InductiveConstructor}{\text{false}}}}\, \end{pmatrix}$</a> <a id="7193" href="Ledger.Conway.Specification.Ratify.html#13648" class="Function Operator">⇀⦇</a> <a id="7196" href="Ledger.Conway.Conformance.Epoch.html#4999" class="Bound">govSt&#39;</a> <a id="7203" href="Ledger.Conway.Specification.Ratify.html#13648" class="Function Operator">,RATIFIES⦈</a> <a id="7214" href="Ledger.Conway.Conformance.Epoch.html#4115" class="Generalizable">fut&#39;</a>
      <a id="7225" class="Symbol">→</a> <a id="7227" href="Ledger.Conway.Conformance.Epoch.html#4166" class="Generalizable">ls</a> <a id="7230" href="Ledger.Conway.Conformance.Rewards.html#613" class="Datatype Operator">⊢</a> <a id="7232" href="Ledger.Conway.Conformance.Epoch.html#4271" class="Generalizable">ss</a> <a id="7235" href="Ledger.Conway.Conformance.Rewards.html#613" class="Datatype Operator">⇀⦇</a> <a id="7238" href="Agda.Builtin.Unit.html#212" class="InductiveConstructor">tt</a> <a id="7241" href="Ledger.Conway.Conformance.Rewards.html#613" class="Datatype Operator">,SNAP⦈</a> <a id="7248" href="Ledger.Conway.Conformance.Epoch.html#4274" class="Generalizable">ss&#39;</a>
    <a id="7256" href="Prelude.InferenceRules.html#13694" class="Function Operator">────────────────────────────────</a>
    <a id="7293" class="Symbol">_</a> <a id="7295" href="Ledger.Conway.Conformance.Epoch.html#4368" class="Datatype Operator">⊢</a> <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.Conway.Conformance.Epoch.html#4180}{\htmlId{7299}{\htmlClass{Generalizable}{\text{acnt}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#4271}{\htmlId{7306}{\htmlClass{Generalizable}{\text{ss}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#4166}{\htmlId{7311}{\htmlClass{Generalizable}{\text{ls}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#4194}{\htmlId{7316}{\htmlClass{Generalizable}{\text{es₀}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#4111}{\htmlId{7322}{\htmlClass{Generalizable}{\text{fut}}}}\, \end{pmatrix}$</a> <a id="7328" href="Ledger.Conway.Conformance.Epoch.html#4368" class="Datatype Operator">⇀⦇</a> <a id="7331" href="Ledger.Conway.Conformance.Epoch.html#4089" class="Generalizable">e</a> <a id="7333" href="Ledger.Conway.Conformance.Epoch.html#4368" class="Datatype Operator">,EPOCH⦈</a>
        <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.Conway.Conformance.Epoch.html#6554}{\htmlId{7351}{\htmlClass{Bound}{\text{acnt&#39;}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#4274}{\htmlId{7359}{\htmlClass{Generalizable}{\text{ss&#39;}}}}\, \\ \begin{pmatrix} \,\href{Ledger.Conway.Conformance.Epoch.html#6439}{\htmlId{7367}{\htmlClass{Bound}{\text{utxoSt&#39;}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#4999}{\htmlId{7377}{\htmlClass{Bound}{\text{govSt&#39;}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#6324}{\htmlId{7386}{\htmlClass{Bound}{\text{certState&#39;}}}}\, \end{pmatrix} \\ \,\href{Ledger.Conway.Conformance.Epoch.html#4675}{\htmlId{7401}{\htmlClass{Bound}{\text{es}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#4115}{\htmlId{7406}{\htmlClass{Generalizable}{\text{fut&#39;}}}}\, \end{pmatrix}$</a>

<a id="7414" class="Keyword">data</a> <a id="_⊢_⇀⦇_,NEWEPOCH⦈_"></a><a id="7419" href="Ledger.Conway.Conformance.Epoch.html#7419" class="Datatype Operator">_⊢_⇀⦇_,NEWEPOCH⦈_</a> <a id="7437" class="Symbol">:</a> <a id="7439" href="Agda.Builtin.Unit.html#175" class="Record">⊤</a> <a id="7441" class="Symbol">→</a> <a id="7443" href="Ledger.Conway.Conformance.Epoch.html#1510" class="Record">NewEpochState</a> <a id="7457" class="Symbol">→</a> <a id="7459" href="Ledger.Core.Specification.Epoch.html#646" class="Function">Epoch</a> <a id="7465" class="Symbol">→</a> <a id="7467" href="Ledger.Conway.Conformance.Epoch.html#1510" class="Record">NewEpochState</a> <a id="7481" class="Symbol">→</a> <a id="7483" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="7488" class="Keyword">where</a>

  <a id="_⊢_⇀⦇_,NEWEPOCH⦈_.NEWEPOCH-New"></a><a id="7497" href="Ledger.Conway.Conformance.Epoch.html#7497" class="InductiveConstructor">NEWEPOCH-New</a> <a id="7510" class="Symbol">:</a>
    <a id="7516" class="Symbol">∀</a> <a id="7518" class="Symbol">{</a><a id="7519" href="Ledger.Conway.Conformance.Epoch.html#7519" class="Bound">bprev</a> <a id="7525" href="Ledger.Conway.Conformance.Epoch.html#7525" class="Bound">bcur</a> <a id="7530" class="Symbol">:</a> <a id="7532" href="Ledger.Conway.Specification.Rewards.html#4906" class="Function">BlocksMade</a><a id="7542" class="Symbol">}</a> <a id="7544" class="Symbol">{</a><a id="7545" href="Ledger.Conway.Conformance.Epoch.html#7545" class="Bound">pd</a> <a id="7548" class="Symbol">:</a> <a id="7550" href="Ledger.Conway.Conformance.Epoch.html#1440" class="Function">PoolDelegatedStake</a><a id="7568" class="Symbol">}</a> <a id="7570" class="Symbol">→</a>
    <a id="7576" class="Keyword">let</a>
       <a id="7587" href="Ledger.Conway.Conformance.Epoch.html#7587" class="Bound">eps&#39;</a> <a id="7592" class="Symbol">=</a> <a id="7594" href="Ledger.Conway.Conformance.Epoch.html#2752" class="Function">applyRUpd</a> <a id="7604" href="Ledger.Conway.Conformance.Epoch.html#4292" class="Generalizable">ru</a> <a id="7607" href="Ledger.Conway.Conformance.Epoch.html#4136" class="Generalizable">eps</a>
       <a id="7618" href="Ledger.Conway.Conformance.Epoch.html#7618" class="Bound">ss</a>   <a id="7623" class="Symbol">=</a> <a id="7625" href="Ledger.Conway.Conformance.Epoch.html#1335" class="Field">EpochState.ss</a> <a id="7639" href="Ledger.Conway.Conformance.Epoch.html#4145" class="Generalizable">eps&#39;&#39;</a>
       <a id="7652" href="Ledger.Conway.Conformance.Epoch.html#7652" class="Bound">pd&#39;</a>  <a id="7657" class="Symbol">=</a> <a id="7659" href="Ledger.Conway.Conformance.Epoch.html#3482" class="Function">calculatePoolDelegatedStake</a> <a id="7687" class="Symbol">(</a><a id="7688" href="Ledger.Conway.Specification.Rewards.html#7758" class="Field">Snapshots.set</a> <a id="7702" href="Ledger.Conway.Conformance.Epoch.html#7618" class="Bound">ss</a><a id="7704" class="Symbol">)</a>
     <a id="7711" class="Keyword">in</a>
       <a id="7721" href="Prelude.InferenceRules.html#56075" class="Function Operator">∙</a> <a id="7723" href="Ledger.Conway.Conformance.Epoch.html#4089" class="Generalizable">e</a> <a id="7725" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="7727" href="Ledger.Conway.Conformance.Epoch.html#4091" class="Generalizable">lastEpoch</a> <a id="7737" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="7739" class="Number">1</a>
       <a id="7748" href="Prelude.InferenceRules.html#56006" class="Function Operator">∙</a> <a id="7750" class="Symbol">_</a> <a id="7752" href="Ledger.Conway.Conformance.Epoch.html#4368" class="Datatype Operator">⊢</a> <a id="7754" href="Ledger.Conway.Conformance.Epoch.html#7587" class="Bound">eps&#39;</a> <a id="7759" href="Ledger.Conway.Conformance.Epoch.html#4368" class="Datatype Operator">⇀⦇</a> <a id="7762" href="Ledger.Conway.Conformance.Epoch.html#4089" class="Generalizable">e</a> <a id="7764" href="Ledger.Conway.Conformance.Epoch.html#4368" class="Datatype Operator">,EPOCH⦈</a> <a id="7772" href="Ledger.Conway.Conformance.Epoch.html#4145" class="Generalizable">eps&#39;&#39;</a>
       <a id="7785" href="Prelude.InferenceRules.html#13694" class="Function Operator">────────────────────────────────</a>
       <a id="7825" class="Symbol">_</a> <a id="7827" href="Ledger.Conway.Conformance.Epoch.html#7419" class="Datatype Operator">⊢</a> <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.Conway.Conformance.Epoch.html#4091}{\htmlId{7831}{\htmlClass{Generalizable}{\text{lastEpoch}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#7519}{\htmlId{7843}{\htmlClass{Bound}{\text{bprev}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#7525}{\htmlId{7851}{\htmlClass{Bound}{\text{bcur}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#4136}{\htmlId{7858}{\htmlClass{Generalizable}{\text{eps}}}}\, \\ \,\href{Agda.Builtin.Maybe.html#173}{\htmlId{7864}{\htmlClass{InductiveConstructor}{\text{just}}}}\, \,\href{Ledger.Conway.Conformance.Epoch.html#4292}{\htmlId{7869}{\htmlClass{Generalizable}{\text{ru}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#7545}{\htmlId{7874}{\htmlClass{Bound}{\text{pd}}}}\, \end{pmatrix}$</a> <a id="7879" href="Ledger.Conway.Conformance.Epoch.html#7419" class="Datatype Operator">⇀⦇</a> <a id="7882" href="Ledger.Conway.Conformance.Epoch.html#4089" class="Generalizable">e</a> <a id="7884" href="Ledger.Conway.Conformance.Epoch.html#7419" class="Datatype Operator">,NEWEPOCH⦈</a> <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.Conway.Conformance.Epoch.html#4089}{\htmlId{7897}{\htmlClass{Generalizable}{\text{e}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#7525}{\htmlId{7901}{\htmlClass{Bound}{\text{bcur}}}}\, \\ \,\href{Axiom.Set.Map.html#2671}{\htmlId{7908}{\htmlClass{Function}{\text{∅ᵐ}}}}\,  \\ \,\href{Ledger.Conway.Conformance.Epoch.html#4145}{\htmlId{7914}{\htmlClass{Generalizable}{\text{eps&#39;&#39;}}}}\, \\ \,\href{Agda.Builtin.Maybe.html#194}{\htmlId{7922}{\htmlClass{InductiveConstructor}{\text{nothing}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#7652}{\htmlId{7932}{\htmlClass{Bound}{\text{pd&#39;}}}}\, \end{pmatrix}$</a>

  <a id="_⊢_⇀⦇_,NEWEPOCH⦈_.NEWEPOCH-Not-New"></a><a id="7941" href="Ledger.Conway.Conformance.Epoch.html#7941" class="InductiveConstructor">NEWEPOCH-Not-New</a> <a id="7958" class="Symbol">:</a> <a id="7960" class="Symbol">∀</a> <a id="7962" class="Symbol">{</a><a id="7963" href="Ledger.Conway.Conformance.Epoch.html#7963" class="Bound">bprev</a> <a id="7969" href="Ledger.Conway.Conformance.Epoch.html#7969" class="Bound">bcur</a> <a id="7974" class="Symbol">:</a> <a id="7976" href="Ledger.Conway.Specification.Rewards.html#4906" class="Function">BlocksMade</a><a id="7986" class="Symbol">}</a> <a id="7988" class="Symbol">{</a><a id="7989" href="Ledger.Conway.Conformance.Epoch.html#7989" class="Bound">pd</a> <a id="7992" class="Symbol">:</a> <a id="7994" href="Ledger.Conway.Conformance.Epoch.html#1440" class="Function">PoolDelegatedStake</a><a id="8012" class="Symbol">}</a> <a id="8014" class="Symbol">→</a>
    <a id="8020" href="Prelude.InferenceRules.html#56075" class="Function Operator">∙</a> <a id="8022" href="Ledger.Conway.Conformance.Epoch.html#4089" class="Generalizable">e</a> <a id="8024" href="Relation.Binary.PropositionalEquality.Core.html#1000" class="Function Operator">≢</a> <a id="8026" href="Ledger.Conway.Conformance.Epoch.html#4091" class="Generalizable">lastEpoch</a> <a id="8036" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="8038" class="Number">1</a>
      <a id="8046" href="Prelude.InferenceRules.html#13694" class="Function Operator">────────────────────────────────</a>
      <a id="8085" class="Symbol">_</a> <a id="8087" href="Ledger.Conway.Conformance.Epoch.html#7419" class="Datatype Operator">⊢</a> <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.Conway.Conformance.Epoch.html#4091}{\htmlId{8091}{\htmlClass{Generalizable}{\text{lastEpoch}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#7963}{\htmlId{8103}{\htmlClass{Bound}{\text{bprev}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#7969}{\htmlId{8111}{\htmlClass{Bound}{\text{bcur}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#4136}{\htmlId{8118}{\htmlClass{Generalizable}{\text{eps}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#4312}{\htmlId{8124}{\htmlClass{Generalizable}{\text{mru}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#7989}{\htmlId{8130}{\htmlClass{Bound}{\text{pd}}}}\, \end{pmatrix}$</a> <a id="8135" href="Ledger.Conway.Conformance.Epoch.html#7419" class="Datatype Operator">⇀⦇</a> <a id="8138" href="Ledger.Conway.Conformance.Epoch.html#4089" class="Generalizable">e</a> <a id="8140" href="Ledger.Conway.Conformance.Epoch.html#7419" class="Datatype Operator">,NEWEPOCH⦈</a> <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.Conway.Conformance.Epoch.html#4091}{\htmlId{8153}{\htmlClass{Generalizable}{\text{lastEpoch}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#7963}{\htmlId{8165}{\htmlClass{Bound}{\text{bprev}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#7969}{\htmlId{8173}{\htmlClass{Bound}{\text{bcur}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#4136}{\htmlId{8180}{\htmlClass{Generalizable}{\text{eps}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#4312}{\htmlId{8186}{\htmlClass{Generalizable}{\text{mru}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#7989}{\htmlId{8192}{\htmlClass{Bound}{\text{pd}}}}\, \end{pmatrix}$</a>

  <a id="_⊢_⇀⦇_,NEWEPOCH⦈_.NEWEPOCH-No-Reward-Update"></a><a id="8200" href="Ledger.Conway.Conformance.Epoch.html#8200" class="InductiveConstructor">NEWEPOCH-No-Reward-Update</a> <a id="8226" class="Symbol">:</a>
    <a id="8232" class="Symbol">∀</a> <a id="8234" class="Symbol">{</a><a id="8235" href="Ledger.Conway.Conformance.Epoch.html#8235" class="Bound">bprev</a> <a id="8241" href="Ledger.Conway.Conformance.Epoch.html#8241" class="Bound">bcur</a> <a id="8246" class="Symbol">:</a> <a id="8248" href="Ledger.Conway.Specification.Rewards.html#4906" class="Function">BlocksMade</a><a id="8258" class="Symbol">}</a> <a id="8260" class="Symbol">{</a><a id="8261" href="Ledger.Conway.Conformance.Epoch.html#8261" class="Bound">pd</a> <a id="8264" class="Symbol">:</a> <a id="8266" href="Ledger.Conway.Conformance.Epoch.html#1440" class="Function">PoolDelegatedStake</a><a id="8284" class="Symbol">}</a> <a id="8286" class="Symbol">→</a>
    <a id="8292" class="Keyword">let</a>
      <a id="8302" href="Ledger.Conway.Conformance.Epoch.html#8302" class="Bound">ss</a>  <a id="8306" class="Symbol">=</a> <a id="8308" href="Ledger.Conway.Conformance.Epoch.html#1335" class="Field">EpochState.ss</a> <a id="8322" href="Ledger.Conway.Conformance.Epoch.html#4140" class="Generalizable">eps&#39;</a>
      <a id="8333" href="Ledger.Conway.Conformance.Epoch.html#8333" class="Bound">pd&#39;</a> <a id="8337" class="Symbol">=</a> <a id="8339" href="Ledger.Conway.Conformance.Epoch.html#3482" class="Function">calculatePoolDelegatedStake</a> <a id="8367" class="Symbol">(</a><a id="8368" href="Ledger.Conway.Specification.Rewards.html#7758" class="Field">Snapshots.set</a> <a id="8382" href="Ledger.Conway.Conformance.Epoch.html#8302" class="Bound">ss</a><a id="8384" class="Symbol">)</a>
    <a id="8390" class="Keyword">in</a>
      <a id="8399" href="Prelude.InferenceRules.html#56075" class="Function Operator">∙</a> <a id="8401" href="Ledger.Conway.Conformance.Epoch.html#4089" class="Generalizable">e</a> <a id="8403" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="8405" href="Ledger.Conway.Conformance.Epoch.html#4091" class="Generalizable">lastEpoch</a> <a id="8415" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="8417" class="Number">1</a>
      <a id="8425" href="Prelude.InferenceRules.html#56006" class="Function Operator">∙</a> <a id="8427" class="Symbol">_</a> <a id="8429" href="Ledger.Conway.Conformance.Epoch.html#4368" class="Datatype Operator">⊢</a> <a id="8431" href="Ledger.Conway.Conformance.Epoch.html#4136" class="Generalizable">eps</a> <a id="8435" href="Ledger.Conway.Conformance.Epoch.html#4368" class="Datatype Operator">⇀⦇</a> <a id="8438" href="Ledger.Conway.Conformance.Epoch.html#4089" class="Generalizable">e</a> <a id="8440" href="Ledger.Conway.Conformance.Epoch.html#4368" class="Datatype Operator">,EPOCH⦈</a> <a id="8448" href="Ledger.Conway.Conformance.Epoch.html#4140" class="Generalizable">eps&#39;</a>
      <a id="8459" href="Prelude.InferenceRules.html#13694" class="Function Operator">────────────────────────────────</a>
      <a id="8498" class="Symbol">_</a> <a id="8500" href="Ledger.Conway.Conformance.Epoch.html#7419" class="Datatype Operator">⊢</a> <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.Conway.Conformance.Epoch.html#4091}{\htmlId{8504}{\htmlClass{Generalizable}{\text{lastEpoch}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#8235}{\htmlId{8516}{\htmlClass{Bound}{\text{bprev}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#8241}{\htmlId{8524}{\htmlClass{Bound}{\text{bcur}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#4136}{\htmlId{8531}{\htmlClass{Generalizable}{\text{eps}}}}\, \\ \,\href{Agda.Builtin.Maybe.html#194}{\htmlId{8537}{\htmlClass{InductiveConstructor}{\text{nothing}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#8261}{\htmlId{8547}{\htmlClass{Bound}{\text{pd}}}}\, \end{pmatrix}$</a> <a id="8552" href="Ledger.Conway.Conformance.Epoch.html#7419" class="Datatype Operator">⇀⦇</a> <a id="8555" href="Ledger.Conway.Conformance.Epoch.html#4089" class="Generalizable">e</a> <a id="8557" href="Ledger.Conway.Conformance.Epoch.html#7419" class="Datatype Operator">,NEWEPOCH⦈</a> <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.Conway.Conformance.Epoch.html#4089}{\htmlId{8570}{\htmlClass{Generalizable}{\text{e}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#8241}{\htmlId{8574}{\htmlClass{Bound}{\text{bcur}}}}\, \\ \,\href{Axiom.Set.Map.html#2671}{\htmlId{8581}{\htmlClass{Function}{\text{∅ᵐ}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#4140}{\htmlId{8586}{\htmlClass{Generalizable}{\text{eps&#39;}}}}\, \\ \,\href{Agda.Builtin.Maybe.html#194}{\htmlId{8593}{\htmlClass{InductiveConstructor}{\text{nothing}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#8333}{\htmlId{8603}{\htmlClass{Bound}{\text{pd&#39;}}}}\, \end{pmatrix}$</a>
</pre></body></html>