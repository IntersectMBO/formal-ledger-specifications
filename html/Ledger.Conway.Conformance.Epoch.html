<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>Ledger.Conway.Conformance.Epoch</title><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.css"><link rel="stylesheet" href="Agda.css"><script src="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.js"></script><script src="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/contrib/auto-render.min.js"></script><script src="AgdaKaTeX.js" defer=""></script></head><body><pre class="Agda"><a id="1" class="Symbol">{-#</a> <a id="5" class="Keyword">OPTIONS</a> <a id="13" class="Pragma">--safe</a> <a id="20" class="Symbol">#-}</a>

<a id="25" class="Keyword">open</a> <a id="30" class="Keyword">import</a> <a id="37" href="Ledger.Conway.Specification.Abstract.html" class="Module">Ledger.Conway.Specification.Abstract</a>
<a id="74" class="Keyword">open</a> <a id="79" class="Keyword">import</a> <a id="86" href="Ledger.Conway.Specification.Transaction.html" class="Module">Ledger.Conway.Specification.Transaction</a>

<a id="127" class="Keyword">module</a> <a id="134" href="Ledger.Conway.Conformance.Epoch.html" class="Module">Ledger.Conway.Conformance.Epoch</a>
  <a id="168" class="Symbol">(</a><a id="169" href="Ledger.Conway.Conformance.Epoch.html#169" class="Bound">txs</a> <a id="173" class="Symbol">:</a> <a id="175" class="Symbol">_)</a> <a id="178" class="Symbol">(</a><a id="179" class="Keyword">open</a> <a id="184" href="Ledger.Conway.Specification.Transaction.html#1000" class="Module">TransactionStructure</a> <a id="205" href="Ledger.Conway.Conformance.Epoch.html#169" class="Bound">txs</a><a id="208" class="Symbol">)</a>
  <a id="212" class="Symbol">(</a><a id="213" href="Ledger.Conway.Conformance.Epoch.html#213" class="Bound">abs</a> <a id="217" class="Symbol">:</a> <a id="219" href="Ledger.Conway.Specification.Abstract.html#654" class="Record">AbstractFunctions</a> <a id="237" href="Ledger.Conway.Conformance.Epoch.html#169" class="Bound">txs</a><a id="240" class="Symbol">)</a> <a id="242" class="Symbol">(</a><a id="243" class="Keyword">open</a> <a id="248" href="Ledger.Conway.Specification.Abstract.html#654" class="Module">AbstractFunctions</a> <a id="266" href="Ledger.Conway.Conformance.Epoch.html#213" class="Bound">abs</a><a id="269" class="Symbol">)</a>
  <a id="273" class="Keyword">where</a>

<a id="280" class="Keyword">open</a> <a id="285" class="Keyword">import</a> <a id="292" href="Ledger.Prelude.html" class="Module">Ledger.Prelude</a>
<a id="307" class="Keyword">open</a> <a id="312" class="Keyword">import</a> <a id="319" href="Data.Integer.html" class="Module">Data.Integer</a> <a id="332" class="Keyword">using</a> <a id="338" class="Symbol">()</a> <a id="341" class="Keyword">renaming</a> <a id="350" class="Symbol">(</a><a id="351" href="Agda.Builtin.Int.html#263" class="InductiveConstructor">+_</a> <a id="354" class="Symbol">to</a> <a id="357" class="InductiveConstructor">pos</a><a id="360" class="Symbol">)</a>
<a id="362" class="Keyword">import</a> <a id="369" href="Data.Integer.html" class="Module">Data.Integer</a> <a id="382" class="Symbol">as</a> <a id="385" class="Module">ℤ</a>

<a id="388" class="Keyword">open</a> <a id="393" class="Keyword">import</a> <a id="400" href="Data.Nat.Properties.html" class="Module">Data.Nat.Properties</a> <a id="420" class="Keyword">using</a> <a id="426" class="Symbol">(</a><a id="427" href="Data.Nat.Properties.html#17566" class="Function">+-0-monoid</a><a id="437" class="Symbol">;</a> <a id="439" href="Data.Nat.Properties.html#17645" class="Function">+-0-commutativeMonoid</a><a id="460" class="Symbol">)</a>
<a id="462" class="Keyword">open</a> <a id="467" class="Keyword">import</a> <a id="474" href="Data.List.html" class="Module">Data.List</a> <a id="484" class="Keyword">using</a> <a id="490" class="Symbol">(</a><a id="491" href="Data.List.Base.html#10389" class="Function">filter</a><a id="497" class="Symbol">)</a>

<a id="500" class="Keyword">open</a> <a id="505" class="Keyword">import</a> <a id="512" href="Agda.Builtin.FromNat.html" class="Module">Agda.Builtin.FromNat</a>

<a id="534" class="Keyword">open</a> <a id="539" class="Keyword">import</a> <a id="546" href="Ledger.Conway.Specification.Enact.html" class="Module">Ledger.Conway.Specification.Enact</a> <a id="580" href="Ledger.Conway.Specification.Transaction.html#2079" class="Function">govStructure</a>
<a id="593" class="Keyword">open</a> <a id="598" class="Keyword">import</a> <a id="605" href="Ledger.Conway.Conformance.Equivalence.html" class="Module">Ledger.Conway.Conformance.Equivalence</a> <a id="643" href="Ledger.Conway.Conformance.Epoch.html#169" class="Bound">txs</a> <a id="647" href="Ledger.Conway.Conformance.Epoch.html#213" class="Bound">abs</a>
<a id="651" class="Keyword">open</a> <a id="656" class="Keyword">import</a> <a id="663" href="Ledger.Conway.Conformance.Equivalence.Convert.html" class="Module">Ledger.Conway.Conformance.Equivalence.Convert</a>
<a id="709" class="Keyword">open</a> <a id="714" class="Keyword">import</a> <a id="721" href="Ledger.Conway.Conformance.Equivalence.Deposits.html" class="Module">Ledger.Conway.Conformance.Equivalence.Deposits</a> <a id="768" href="Ledger.Conway.Conformance.Epoch.html#169" class="Bound">txs</a> <a id="772" href="Ledger.Conway.Conformance.Epoch.html#213" class="Bound">abs</a>
<a id="776" class="Keyword">open</a> <a id="781" class="Keyword">import</a> <a id="788" href="Ledger.Conway.Conformance.Ledger.html" class="Module">Ledger.Conway.Conformance.Ledger</a> <a id="821" href="Ledger.Conway.Conformance.Epoch.html#169" class="Bound">txs</a> <a id="825" href="Ledger.Conway.Conformance.Epoch.html#213" class="Bound">abs</a>
<a id="829" class="Keyword">open</a> <a id="834" class="Keyword">import</a> <a id="841" href="Ledger.Conway.Specification.Ratify.html" class="Module">Ledger.Conway.Specification.Ratify</a> <a id="876" href="Ledger.Conway.Conformance.Epoch.html#169" class="Bound">txs</a>
<a id="880" class="Keyword">open</a> <a id="885" class="Keyword">import</a> <a id="892" href="Ledger.Conway.Conformance.Utxo.html" class="Module">Ledger.Conway.Conformance.Utxo</a> <a id="923" href="Ledger.Conway.Conformance.Epoch.html#169" class="Bound">txs</a> <a id="927" href="Ledger.Conway.Conformance.Epoch.html#213" class="Bound">abs</a>
<a id="931" class="Keyword">open</a> <a id="936" class="Keyword">import</a> <a id="943" href="Ledger.Conway.Conformance.Certs.html" class="Module">Ledger.Conway.Conformance.Certs</a> <a id="975" href="Ledger.Conway.Specification.Transaction.html#2079" class="Function">govStructure</a>
<a id="988" class="Keyword">open</a> <a id="993" class="Keyword">import</a> <a id="1000" href="Ledger.Conway.Conformance.Rewards.html" class="Module">Ledger.Conway.Conformance.Rewards</a> <a id="1034" href="Ledger.Conway.Conformance.Epoch.html#169" class="Bound">txs</a> <a id="1038" href="Ledger.Conway.Conformance.Epoch.html#213" class="Bound">abs</a>
<a id="1042" class="Keyword">open</a> <a id="1047" class="Keyword">import</a> <a id="1054" href="Ledger.Conway.Specification.Epoch.html" class="Module">Ledger.Conway.Specification.Epoch</a> <a id="1088" href="Ledger.Conway.Conformance.Epoch.html#169" class="Bound">txs</a> <a id="1092" href="Ledger.Conway.Conformance.Epoch.html#213" class="Bound">abs</a>
  <a id="1098" class="Keyword">using</a> <a id="1104" class="Symbol">(</a><a id="1105" href="Ledger.Conway.Specification.Epoch.html#5107" class="Function">getStakeCred</a><a id="1117" class="Symbol">;</a> <a id="1119" href="Ledger.Conway.Specification.Epoch.html#12443" class="Function">getOrphans</a><a id="1129" class="Symbol">;</a> <a id="1131" href="Ledger.Conway.Specification.Epoch.html#11626" class="Function">mkStakeDistrs</a><a id="1144" class="Symbol">;</a> <a id="1146" href="Ledger.Conway.Specification.Epoch.html#5020" class="Function">toRwdAddr</a><a id="1155" class="Symbol">)</a> <a id="1157" class="Keyword">public</a>
<a id="1164" class="Keyword">import</a> <a id="1171" href="Ledger.Conway.Specification.Epoch.html" class="Module">Ledger.Conway.Specification.Epoch</a> <a id="1205" href="Ledger.Conway.Conformance.Epoch.html#169" class="Bound">txs</a> <a id="1209" href="Ledger.Conway.Conformance.Epoch.html#213" class="Bound">abs</a> <a id="1213" class="Symbol">as</a> <a id="EpochSpec"></a><a id="1216" href="Ledger.Conway.Conformance.Epoch.html#1216" class="Module">EpochSpec</a>

<a id="1227" class="Keyword">record</a> <a id="EpochState"></a><a id="1234" href="Ledger.Conway.Conformance.Epoch.html#1234" class="Record">EpochState</a> <a id="1245" class="Symbol">:</a> <a id="1247" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="1252" class="Keyword">where</a>
  <a id="1260" class="Keyword">constructor</a> <a id="⟦_,_,_,_,_⟧ᵉ&#39;"></a><a id="1272" href="Ledger.Conway.Conformance.Epoch.html#1272" class="InductiveConstructor Operator">⟦_,_,_,_,_⟧ᵉ&#39;</a>
  <a id="1288" class="Keyword">field</a>
    <a id="EpochState.acnt"></a><a id="1298" href="Ledger.Conway.Conformance.Epoch.html#1298" class="Field">acnt</a>       <a id="1309" class="Symbol">:</a> <a id="1311" href="Ledger.Conway.Specification.PParams.html#720" class="Record">Acnt</a>
    <a id="EpochState.ss"></a><a id="1320" href="Ledger.Conway.Conformance.Epoch.html#1320" class="Field">ss</a>         <a id="1331" class="Symbol">:</a> <a id="1333" href="Ledger.Conway.Specification.Rewards.html#7745" class="Record">Snapshots</a>
    <a id="EpochState.ls"></a><a id="1347" href="Ledger.Conway.Conformance.Epoch.html#1347" class="Field">ls</a>         <a id="1358" class="Symbol">:</a> <a id="1360" href="Ledger.Conway.Conformance.Ledger.html#779" class="Record">LState</a>
    <a id="EpochState.es"></a><a id="1371" href="Ledger.Conway.Conformance.Epoch.html#1371" class="Field">es</a>         <a id="1382" class="Symbol">:</a> <a id="1384" href="Ledger.Conway.Specification.Enact.html#448" class="Record">EnactState</a>
    <a id="EpochState.fut"></a><a id="1399" href="Ledger.Conway.Conformance.Epoch.html#1399" class="Field">fut</a>        <a id="1410" class="Symbol">:</a> <a id="1412" href="Ledger.Conway.Specification.Ratify.html#3374" class="Record">RatifyState</a>

<a id="1425" class="Keyword">instance</a>
  <a id="EpochStateFromConf"></a><a id="1436" href="Ledger.Conway.Conformance.Epoch.html#1436" class="Function">EpochStateFromConf</a> <a id="1455" class="Symbol">:</a> <a id="1457" href="Ledger.Conway.Conformance.Epoch.html#1234" class="Record">EpochState</a> <a id="1468" href="Ledger.Conway.Conformance.Equivalence.Convert.html#409" class="Function Operator">⭆</a> <a id="1470" href="Ledger.Conway.Specification.Epoch.html#1703" class="Record">EpochSpec.EpochState</a>
  <a id="1493" href="Ledger.Conway.Conformance.Epoch.html#1436" class="Function">EpochStateFromConf</a> <a id="1512" class="Symbol">.</a><a id="1513" href="Ledger.Conway.Conformance.Equivalence.Convert.html#217" class="Field">convⁱ</a> <a id="1519" class="Symbol">_</a> <a id="1521" href="Ledger.Conway.Conformance.Epoch.html#1521" class="Bound">epochState</a> <a id="1532" class="Symbol">=</a>
    <a id="1538" class="Keyword">let</a> <a id="1542" class="Keyword">open</a> <a id="1547" href="Ledger.Conway.Conformance.Epoch.html#1234" class="Module">EpochState</a> <a id="1558" href="Ledger.Conway.Conformance.Epoch.html#1521" class="Bound">epochState</a> <a id="1569" class="Keyword">in</a>
    <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.Conway.Conformance.Epoch.html#1298}{\htmlId{1578}{\htmlClass{Field}{\text{acnt}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#1320}{\htmlId{1585}{\htmlClass{Field}{\text{ss}}}}\, \\ \,\href{Ledger.Conway.Conformance.Equivalence.Convert.html#452}{\htmlId{1590}{\htmlClass{Function}{\text{conv}}}}\, \,\href{Ledger.Conway.Conformance.Epoch.html#1347}{\htmlId{1595}{\htmlClass{Field}{\text{ls}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#1371}{\htmlId{1600}{\htmlClass{Field}{\text{es}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#1399}{\htmlId{1605}{\htmlClass{Field}{\text{fut}}}}\, \end{pmatrix}$</a>

  <a id="EpochStateToConf"></a><a id="1614" href="Ledger.Conway.Conformance.Epoch.html#1614" class="Function">EpochStateToConf</a> <a id="1631" class="Symbol">:</a> <a id="1633" href="Ledger.Conway.Specification.Epoch.html#1703" class="Record">EpochSpec.EpochState</a> <a id="1654" href="Ledger.Conway.Conformance.Equivalence.Convert.html#409" class="Function Operator">⭆</a> <a id="1656" href="Ledger.Conway.Conformance.Epoch.html#1234" class="Record">EpochState</a>
  <a id="1669" href="Ledger.Conway.Conformance.Epoch.html#1614" class="Function">EpochStateToConf</a> <a id="1686" class="Symbol">.</a><a id="1687" href="Ledger.Conway.Conformance.Equivalence.Convert.html#217" class="Field">convⁱ</a> <a id="1693" href="Ledger.Conway.Conformance.Epoch.html#1693" class="Bound">deposits</a> <a id="1702" href="Ledger.Conway.Conformance.Epoch.html#1702" class="Bound">epochSt</a> <a id="1710" class="Symbol">=</a>
    <a id="1716" class="Keyword">let</a> <a id="1720" class="Keyword">open</a> <a id="1725" href="Ledger.Conway.Specification.Epoch.html#1703" class="Module">EpochSpec.EpochState</a> <a id="1746" href="Ledger.Conway.Conformance.Epoch.html#1702" class="Bound">epochSt</a> <a id="1754" class="Keyword">in</a>
    <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.Conway.Specification.Epoch.html#1771}{\htmlId{1763}{\htmlClass{Field}{\text{acnt}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#1793}{\htmlId{1770}{\htmlClass{Field}{\text{ss}}}}\, \\ \,\href{Ledger.Conway.Conformance.Equivalence.Deposits.html#12799}{\htmlId{1775}{\htmlClass{Function}{\text{certDeposits}}}}\, \,\href{Ledger.Conway.Specification.Epoch.html#1820}{\htmlId{1788}{\htmlClass{Field}{\text{ls}}}}\, \,\href{Ledger.Conway.Conformance.Equivalence.Convert.html#270}{\htmlId{1791}{\htmlClass{Function Operator}{\text{⊢conv}}}}\, \,\href{Ledger.Conway.Specification.Epoch.html#1820}{\htmlId{1797}{\htmlClass{Field}{\text{ls}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#1844}{\htmlId{1802}{\htmlClass{Field}{\text{es}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#1872}{\htmlId{1807}{\htmlClass{Field}{\text{fut}}}}\, \end{pmatrix}$</a>

<a id="1816" class="Keyword">record</a> <a id="NewEpochState"></a><a id="1823" href="Ledger.Conway.Conformance.Epoch.html#1823" class="Record">NewEpochState</a> <a id="1837" class="Symbol">:</a> <a id="1839" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="1844" class="Keyword">where</a>
  <a id="1852" class="Keyword">field</a>
    <a id="NewEpochState.lastEpoch"></a><a id="1862" href="Ledger.Conway.Conformance.Epoch.html#1862" class="Field">lastEpoch</a>   <a id="1874" class="Symbol">:</a> <a id="1876" href="Ledger.Core.Specification.Epoch.html#598" class="Function">Epoch</a>
    <a id="NewEpochState.epochState"></a><a id="1886" href="Ledger.Conway.Conformance.Epoch.html#1886" class="Field">epochState</a>  <a id="1898" class="Symbol">:</a> <a id="1900" href="Ledger.Conway.Conformance.Epoch.html#1234" class="Record">EpochState</a>
    <a id="NewEpochState.ru"></a><a id="1915" href="Ledger.Conway.Conformance.Epoch.html#1915" class="Field">ru</a>          <a id="1927" class="Symbol">:</a> <a id="1929" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="1935" href="Ledger.Conway.Specification.Rewards.html#6210" class="Record">RewardUpdate</a>

<a id="1949" class="Keyword">instance</a>
  <a id="1960" class="Keyword">unquoteDecl</a> <a id="HasCast-EpochState"></a><a id="1972" href="Ledger.Conway.Conformance.Epoch.html#1972" class="Function">HasCast-EpochState</a> <a id="HasCast-NewEpochState"></a><a id="1991" href="Ledger.Conway.Conformance.Epoch.html#1991" class="Function">HasCast-NewEpochState</a> <a id="2013" class="Symbol">=</a> <a id="2015" href="stdlib-classes.Class.HasCast.Derive.html#2690" class="Function">derive-HasCast</a>
    <a id="2034" class="Symbol">(</a> <a id="2036" class="Symbol">(</a><a id="2037" class="Keyword">quote</a> <a id="2043" href="Ledger.Conway.Conformance.Epoch.html#1234" class="Record">EpochState</a>     <a id="2058" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="2060" href="Ledger.Conway.Conformance.Epoch.html#1972" class="Function">HasCast-EpochState</a><a id="2078" class="Symbol">)</a>
    <a id="2084" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="2086" href="Data.List.Base.html#4907" class="Function Operator">[</a> <a id="2088" class="Symbol">(</a><a id="2089" class="Keyword">quote</a> <a id="2095" href="Ledger.Conway.Conformance.Epoch.html#1823" class="Record">NewEpochState</a>  <a id="2110" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="2112" href="Ledger.Conway.Conformance.Epoch.html#1991" class="Function">HasCast-NewEpochState</a><a id="2133" class="Symbol">)</a><a id="2134" href="Data.List.Base.html#4907" class="Function Operator">]</a><a id="2135" class="Symbol">)</a>

<a id="applyRUpd"></a><a id="2138" href="Ledger.Conway.Conformance.Epoch.html#2138" class="Function">applyRUpd</a> <a id="2148" class="Symbol">:</a> <a id="2150" href="Ledger.Conway.Specification.Rewards.html#6210" class="Record">RewardUpdate</a> <a id="2163" class="Symbol">→</a> <a id="2165" href="Ledger.Conway.Conformance.Epoch.html#1234" class="Record">EpochState</a> <a id="2176" class="Symbol">→</a> <a id="2178" href="Ledger.Conway.Conformance.Epoch.html#1234" class="Record">EpochState</a>
<a id="2189" href="Ledger.Conway.Conformance.Epoch.html#2138" class="Function">applyRUpd</a> <a id="2199" href="Ledger.Conway.Conformance.Epoch.html#2199" class="Bound">rewardUpdate</a>
  <a class="AgdaKaTeX">$\begin{pmatrix} \begin{pmatrix} \,\href{Ledger.Conway.Conformance.Epoch.html#2218}{\htmlId{2218}{\htmlClass{Bound}{\text{treasury}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#2229}{\htmlId{2229}{\htmlClass{Bound}{\text{reserves}}}}\, \end{pmatrix}
  \\ \,\href{Ledger.Conway.Conformance.Epoch.html#2245}{\htmlId{2245}{\htmlClass{Bound}{\text{ss}}}}\,
  \\ \begin{pmatrix} \begin{pmatrix} \,\href{Ledger.Conway.Conformance.Epoch.html#2256}{\htmlId{2256}{\htmlClass{Bound}{\text{utxo}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#2263}{\htmlId{2263}{\htmlClass{Bound}{\text{fees}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#2270}{\htmlId{2270}{\htmlClass{Bound}{\text{deposits}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#2281}{\htmlId{2281}{\htmlClass{Bound}{\text{donations}}}}\, \end{pmatrix}
    \\ \,\href{Ledger.Conway.Conformance.Epoch.html#2300}{\htmlId{2300}{\htmlClass{Bound}{\text{govSt}}}}\,
    \\ \begin{pmatrix} \begin{pmatrix} \,\href{Ledger.Conway.Conformance.Epoch.html#2316}{\htmlId{2316}{\htmlClass{Bound}{\text{voteDelegs}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#2329}{\htmlId{2329}{\htmlClass{Bound}{\text{stakeDelegs}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#2343}{\htmlId{2343}{\htmlClass{Bound}{\text{rewards}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#2353}{\htmlId{2353}{\htmlClass{Bound}{\text{deposits&#39;}}}}\, \end{pmatrix} \\ \,\href{Ledger.Conway.Conformance.Epoch.html#2368}{\htmlId{2368}{\htmlClass{Bound}{\text{pState}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#2377}{\htmlId{2377}{\htmlClass{Bound}{\text{gState}}}}\, \end{pmatrix} \end{pmatrix}
  \\ \,\href{Ledger.Conway.Conformance.Epoch.html#2395}{\htmlId{2395}{\htmlClass{Bound}{\text{es}}}}\,
  \\ \,\href{Ledger.Conway.Conformance.Epoch.html#2402}{\htmlId{2402}{\htmlClass{Bound}{\text{fut}}}}\,
  \end{pmatrix}$</a> <a id="2412" class="Symbol">=</a>
  <a class="AgdaKaTeX">$\begin{pmatrix} \begin{pmatrix} \,\href{Prelude.html#3279}{\htmlId{2420}{\htmlClass{Function}{\text{posPart}}}}\, \,\htmlId{2428}{\htmlClass{Symbol}{\text{(}}}\,\,\href{Ledger.Conway.Conformance.Epoch.html#357}{\htmlId{2429}{\htmlClass{InductiveConstructor}{\text{pos}}}}\, \,\href{Ledger.Conway.Conformance.Epoch.html#2218}{\htmlId{2433}{\htmlClass{Bound}{\text{treasury}}}}\, \,\href{Class.HasAdd.Core.html#162}{\htmlId{2442}{\htmlClass{Field Operator}{\text{+}}}}\, \,\href{Ledger.Conway.Specification.Rewards.html#6247}{\htmlId{2444}{\htmlClass{Function}{\text{Δt}}}}\, \,\href{Class.HasAdd.Core.html#162}{\htmlId{2447}{\htmlClass{Field Operator}{\text{+}}}}\, \,\href{Ledger.Conway.Conformance.Epoch.html#357}{\htmlId{2449}{\htmlClass{InductiveConstructor}{\text{pos}}}}\, \,\href{Ledger.Conway.Conformance.Epoch.html#2827}{\htmlId{2453}{\htmlClass{Function}{\text{unregRU&#39;}}}}\,\,\htmlId{2461}{\htmlClass{Symbol}{\text{)}}}\,
    \\ \,\href{Prelude.html#3279}{\htmlId{2469}{\htmlClass{Function}{\text{posPart}}}}\, \,\htmlId{2477}{\htmlClass{Symbol}{\text{(}}}\,\,\href{Ledger.Conway.Conformance.Epoch.html#357}{\htmlId{2478}{\htmlClass{InductiveConstructor}{\text{pos}}}}\, \,\href{Ledger.Conway.Conformance.Epoch.html#2229}{\htmlId{2482}{\htmlClass{Bound}{\text{reserves}}}}\, \,\href{Class.HasAdd.Core.html#162}{\htmlId{2491}{\htmlClass{Field Operator}{\text{+}}}}\, \,\href{Ledger.Conway.Specification.Rewards.html#6250}{\htmlId{2493}{\htmlClass{Function}{\text{Δr}}}}\,\,\htmlId{2495}{\htmlClass{Symbol}{\text{)}}}\, \end{pmatrix}
  \\ \,\href{Ledger.Conway.Conformance.Epoch.html#2245}{\htmlId{2503}{\htmlClass{Bound}{\text{ss}}}}\,
  \\ \begin{pmatrix} \begin{pmatrix} \,\href{Ledger.Conway.Conformance.Epoch.html#2256}{\htmlId{2514}{\htmlClass{Bound}{\text{utxo}}}}\, \\ \,\href{Prelude.html#3279}{\htmlId{2521}{\htmlClass{Function}{\text{posPart}}}}\, \,\htmlId{2529}{\htmlClass{Symbol}{\text{(}}}\,\,\href{Ledger.Conway.Conformance.Epoch.html#357}{\htmlId{2530}{\htmlClass{InductiveConstructor}{\text{pos}}}}\, \,\href{Ledger.Conway.Conformance.Epoch.html#2263}{\htmlId{2534}{\htmlClass{Bound}{\text{fees}}}}\, \,\href{Class.HasAdd.Core.html#162}{\htmlId{2539}{\htmlClass{Field Operator}{\text{+}}}}\, \,\href{Ledger.Conway.Specification.Rewards.html#6253}{\htmlId{2541}{\htmlClass{Function}{\text{Δf}}}}\,\,\htmlId{2543}{\htmlClass{Symbol}{\text{)}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#2270}{\htmlId{2547}{\htmlClass{Bound}{\text{deposits}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#2281}{\htmlId{2558}{\htmlClass{Bound}{\text{donations}}}}\, \end{pmatrix}
    \\ \,\href{Ledger.Conway.Conformance.Epoch.html#2300}{\htmlId{2576}{\htmlClass{Bound}{\text{govSt}}}}\,
    \\ \begin{pmatrix} \begin{pmatrix} \,\href{Ledger.Conway.Conformance.Epoch.html#2316}{\htmlId{2592}{\htmlClass{Bound}{\text{voteDelegs}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#2329}{\htmlId{2605}{\htmlClass{Bound}{\text{stakeDelegs}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#2343}{\htmlId{2619}{\htmlClass{Bound}{\text{rewards}}}}\, \,\href{Axiom.Set.Map.Dec.html#2046}{\htmlId{2627}{\htmlClass{Function Operator}{\text{∪⁺}}}}\, \,\href{Ledger.Conway.Conformance.Epoch.html#2759}{\htmlId{2630}{\htmlClass{Function}{\text{regRU}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#2353}{\htmlId{2638}{\htmlClass{Bound}{\text{deposits&#39;}}}}\, \end{pmatrix} \\ \,\href{Ledger.Conway.Conformance.Epoch.html#2368}{\htmlId{2652}{\htmlClass{Bound}{\text{pState}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#2377}{\htmlId{2661}{\htmlClass{Bound}{\text{gState}}}}\, \end{pmatrix} \end{pmatrix}
  \\ \,\href{Ledger.Conway.Conformance.Epoch.html#2395}{\htmlId{2676}{\htmlClass{Bound}{\text{es}}}}\,
  \\ \,\href{Ledger.Conway.Conformance.Epoch.html#2402}{\htmlId{2683}{\htmlClass{Bound}{\text{fut}}}}\, \end{pmatrix}$</a>
  <a id="2691" class="Keyword">where</a>
    <a id="2701" class="Keyword">open</a> <a id="2706" href="Ledger.Conway.Specification.Rewards.html#6210" class="Module">RewardUpdate</a> <a id="2719" href="Ledger.Conway.Conformance.Epoch.html#2199" class="Bound">rewardUpdate</a> <a id="2732" class="Keyword">using</a> <a id="2738" class="Symbol">(</a><a id="2739" href="Ledger.Conway.Specification.Rewards.html#6247" class="Field">Δt</a><a id="2741" class="Symbol">;</a> <a id="2743" href="Ledger.Conway.Specification.Rewards.html#6250" class="Field">Δr</a><a id="2745" class="Symbol">;</a> <a id="2747" href="Ledger.Conway.Specification.Rewards.html#6253" class="Field">Δf</a><a id="2749" class="Symbol">;</a> <a id="2751" href="Ledger.Conway.Specification.Rewards.html#6273" class="Field">rs</a><a id="2753" class="Symbol">)</a>
    <a id="2759" href="Ledger.Conway.Conformance.Epoch.html#2759" class="Function">regRU</a>     <a id="2769" class="Symbol">=</a> <a id="2771" href="Ledger.Conway.Specification.Rewards.html#6273" class="Function">rs</a> <a id="2774" href="Axiom.Set.Map.html#10678" class="Function Operator">∣</a> <a id="2776" href="Class.IsSet.html#916" class="Function">dom</a> <a id="2780" href="Ledger.Conway.Conformance.Epoch.html#2343" class="Bound">rewards</a>
    <a id="2792" href="Ledger.Conway.Conformance.Epoch.html#2792" class="Function">unregRU</a>   <a id="2802" class="Symbol">=</a> <a id="2804" href="Ledger.Conway.Specification.Rewards.html#6273" class="Function">rs</a> <a id="2807" href="Axiom.Set.Map.html#10748" class="Function Operator">∣</a> <a id="2809" href="Class.IsSet.html#916" class="Function">dom</a> <a id="2813" href="Ledger.Conway.Conformance.Epoch.html#2343" class="Bound">rewards</a> <a id="2821" href="Axiom.Set.Map.html#10748" class="Function Operator">ᶜ</a>
    <a id="2827" href="Ledger.Conway.Conformance.Epoch.html#2827" class="Function">unregRU&#39;</a>  <a id="2837" class="Symbol">=</a> <a id="2839" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">∑[</a> <a id="2842" href="Ledger.Conway.Conformance.Epoch.html#2842" class="Bound">x</a> <a id="2844" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">←</a> <a id="2846" href="Ledger.Conway.Conformance.Epoch.html#2792" class="Function">unregRU</a> <a id="2854" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">]</a> <a id="2856" href="Ledger.Conway.Conformance.Epoch.html#2842" class="Bound">x</a>

<a id="2859" class="Keyword">private</a> <a id="2867" class="Keyword">variable</a>
  <a id="2878" href="Ledger.Conway.Conformance.Epoch.html#2878" class="Generalizable">nes</a> <a id="2882" href="Ledger.Conway.Conformance.Epoch.html#2882" class="Generalizable">nes&#39;</a> <a id="2887" class="Symbol">:</a> <a id="2889" href="Ledger.Conway.Conformance.Epoch.html#1823" class="Record">NewEpochState</a>
  <a id="2905" href="Ledger.Conway.Conformance.Epoch.html#2905" class="Generalizable">e</a> <a id="2907" href="Ledger.Conway.Conformance.Epoch.html#2907" class="Generalizable">lastEpoch</a> <a id="2917" class="Symbol">:</a> <a id="2919" href="Ledger.Core.Specification.Epoch.html#598" class="Function">Epoch</a>
  <a id="2927" href="Ledger.Conway.Conformance.Epoch.html#2927" class="Generalizable">fut</a> <a id="2931" href="Ledger.Conway.Conformance.Epoch.html#2931" class="Generalizable">fut&#39;</a> <a id="2936" class="Symbol">:</a> <a id="2938" href="Ledger.Conway.Specification.Ratify.html#3374" class="Record">RatifyState</a>
  <a id="2952" href="Ledger.Conway.Conformance.Epoch.html#2952" class="Generalizable">eps</a> <a id="2956" href="Ledger.Conway.Conformance.Epoch.html#2956" class="Generalizable">eps&#39;</a> <a id="2961" href="Ledger.Conway.Conformance.Epoch.html#2961" class="Generalizable">eps&#39;&#39;</a> <a id="2967" class="Symbol">:</a> <a id="2969" href="Ledger.Conway.Conformance.Epoch.html#1234" class="Record">EpochState</a>
  <a id="2982" href="Ledger.Conway.Conformance.Epoch.html#2982" class="Generalizable">ls</a> <a id="2985" class="Symbol">:</a> <a id="2987" href="Ledger.Conway.Conformance.Ledger.html#779" class="Record">LState</a>
  <a id="2996" href="Ledger.Conway.Conformance.Epoch.html#2996" class="Generalizable">acnt</a> <a id="3001" class="Symbol">:</a> <a id="3003" href="Ledger.Conway.Specification.PParams.html#720" class="Record">Acnt</a>
  <a id="3010" href="Ledger.Conway.Conformance.Epoch.html#3010" class="Generalizable">es₀</a> <a id="3014" class="Symbol">:</a> <a id="3016" href="Ledger.Conway.Specification.Enact.html#448" class="Record">EnactState</a>
  <a id="3029" href="Ledger.Conway.Conformance.Epoch.html#3029" class="Generalizable">mark</a> <a id="3034" href="Ledger.Conway.Conformance.Epoch.html#3034" class="Generalizable">set</a> <a id="3038" href="Ledger.Conway.Conformance.Epoch.html#3038" class="Generalizable">go</a> <a id="3041" class="Symbol">:</a> <a id="3043" href="Ledger.Conway.Specification.Rewards.html#6433" class="Record">Snapshot</a>
  <a id="3054" href="Ledger.Conway.Conformance.Epoch.html#3054" class="Generalizable">feeSS</a> <a id="3060" class="Symbol">:</a> <a id="3062" href="Ledger.Prelude.Base.html#154" class="Function">Coin</a>
  <a id="3069" href="Ledger.Conway.Conformance.Epoch.html#3069" class="Generalizable">lstate</a> <a id="3076" class="Symbol">:</a> <a id="3078" href="Ledger.Conway.Conformance.Ledger.html#779" class="Record">LState</a>
  <a id="3087" href="Ledger.Conway.Conformance.Epoch.html#3087" class="Generalizable">ss</a> <a id="3090" href="Ledger.Conway.Conformance.Epoch.html#3090" class="Generalizable">ss&#39;</a> <a id="3094" class="Symbol">:</a> <a id="3096" href="Ledger.Conway.Specification.Rewards.html#7745" class="Record">Snapshots</a>
  <a id="3108" href="Ledger.Conway.Conformance.Epoch.html#3108" class="Generalizable">ru</a> <a id="3111" class="Symbol">:</a> <a id="3113" href="Ledger.Conway.Specification.Rewards.html#6210" class="Record">RewardUpdate</a>
  <a id="3128" href="Ledger.Conway.Conformance.Epoch.html#3128" class="Generalizable">mru</a> <a id="3132" class="Symbol">:</a> <a id="3134" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="3140" href="Ledger.Conway.Specification.Rewards.html#6210" class="Record">RewardUpdate</a>
  <a id="3155" href="Ledger.Conway.Conformance.Epoch.html#3155" class="Generalizable">certState&#39;</a> <a id="3166" class="Symbol">:</a> <a id="3168" href="Ledger.Conway.Conformance.Certs.html#951" class="Record">CertState</a>

<a id="3179" class="Keyword">data</a> <a id="_⊢_⇀⦇_,EPOCH⦈_"></a><a id="3184" href="Ledger.Conway.Conformance.Epoch.html#3184" class="Datatype Operator">_⊢_⇀⦇_,EPOCH⦈_</a> <a id="3199" class="Symbol">:</a> <a id="3201" href="Agda.Builtin.Unit.html#175" class="Record">⊤</a> <a id="3203" class="Symbol">→</a> <a id="3205" href="Ledger.Conway.Conformance.Epoch.html#1234" class="Record">EpochState</a> <a id="3216" class="Symbol">→</a> <a id="3218" href="Ledger.Core.Specification.Epoch.html#598" class="Function">Epoch</a> <a id="3224" class="Symbol">→</a> <a id="3226" href="Ledger.Conway.Conformance.Epoch.html#1234" class="Record">EpochState</a> <a id="3237" class="Symbol">→</a> <a id="3239" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="3244" class="Keyword">where</a>

  <a id="_⊢_⇀⦇_,EPOCH⦈_.EPOCH"></a><a id="3253" href="Ledger.Conway.Conformance.Epoch.html#3253" class="InductiveConstructor">EPOCH</a> <a id="3259" class="Symbol">:</a> <a id="3261" class="Keyword">let</a>
      <a id="3271" class="Keyword">open</a> <a id="3276" href="Ledger.Conway.Conformance.Ledger.html#779" class="Module">LState</a> <a id="3283" href="Ledger.Conway.Conformance.Epoch.html#2982" class="Generalizable">ls</a>
      <a id="3292" class="Keyword">open</a> <a id="3297" href="Ledger.Conway.Conformance.Certs.html#951" class="Module">CertState</a> <a id="3307" href="Ledger.Conway.Conformance.Ledger.html#887" class="Function">certState</a>
      <a id="3323" class="Keyword">open</a> <a id="3328" href="Ledger.Conway.Specification.Ratify.html#3374" class="Module">RatifyState</a> <a id="3340" href="Ledger.Conway.Conformance.Epoch.html#2927" class="Generalizable">fut</a> <a id="3344" class="Keyword">renaming</a> <a id="3353" class="Symbol">(</a><a id="3354" href="Ledger.Conway.Specification.Ratify.html#3411" class="Field">es</a> <a id="3357" class="Symbol">to</a> <a id="3360" class="Field">esW</a><a id="3363" class="Symbol">)</a>
      <a id="3371" class="Keyword">open</a> <a id="3376" href="Ledger.Conway.Specification.Utxo.html#1230" class="Module">UTxOState</a>
      <a id="3392" class="Keyword">open</a> <a id="3397" href="Ledger.Conway.Specification.Certs.html#4013" class="Module">PState</a><a id="3403" class="Symbol">;</a> <a id="3405" class="Keyword">open</a> <a id="3410" href="Ledger.Conway.Conformance.Certs.html#597" class="Module">DState</a><a id="3416" class="Symbol">;</a> <a id="3418" class="Keyword">open</a> <a id="3423" href="Ledger.Conway.Conformance.Certs.html#783" class="Module">GState</a>
      <a id="3436" class="Keyword">open</a> <a id="3441" href="Ledger.Conway.Specification.PParams.html#720" class="Module">Acnt</a><a id="3445" class="Symbol">;</a> <a id="3447" class="Keyword">open</a> <a id="3452" href="Ledger.Conway.Specification.Enact.html#448" class="Module">EnactState</a><a id="3462" class="Symbol">;</a> <a id="3464" class="Keyword">open</a> <a id="3469" href="Ledger.Conway.Specification.Gov.Actions.html#3768" class="Module">GovActionState</a>

      <a id="3491" href="Ledger.Conway.Conformance.Epoch.html#3491" class="Bound">es</a> <a id="3494" class="Symbol">:</a> <a id="3496" href="Ledger.Conway.Specification.Enact.html#448" class="Record">EnactState</a>
      <a id="3513" href="Ledger.Conway.Conformance.Epoch.html#3491" class="Bound">es</a> <a id="3516" class="Symbol">=</a> <a id="3518" class="Keyword">record</a> <a id="3525" href="Ledger.Conway.Conformance.Epoch.html#3360" class="Function">esW</a> <a id="3529" class="Symbol">{</a> <a id="3531" href="Ledger.Conway.Specification.Enact.html#700" class="Field">withdrawals</a> <a id="3543" class="Symbol">=</a> <a id="3545" href="Class.HasEmptySet.html#287" class="Field">∅</a> <a id="3547" class="Symbol">}</a>

      <a id="3556" href="Ledger.Conway.Conformance.Epoch.html#3556" class="Bound">tmpGovSt</a> <a id="3565" class="Symbol">=</a> <a id="3567" href="Data.List.Base.html#10389" class="Function">filter</a> <a id="3574" class="Symbol">(λ</a> <a id="3577" href="Ledger.Conway.Conformance.Epoch.html#3577" class="Bound">x</a> <a id="3579" class="Symbol">→</a> <a id="3581" href="Class.Decidable.Core.html#470" class="Function Operator">¿</a> <a id="3583" href="Data.Product.Base.html#636" class="Field">proj₁</a> <a id="3589" href="Ledger.Conway.Conformance.Epoch.html#3577" class="Bound">x</a> <a id="3591" href="Class.IsSet.html#462" class="Function Operator">∉</a> <a id="3593" href="abstract-set-theory.FiniteSetTheory.html#519" class="Function">mapˢ</a> <a id="3598" href="Data.Product.Base.html#636" class="Field">proj₁</a> <a id="3604" href="Ledger.Conway.Specification.Ratify.html#3444" class="Function">removed</a> <a id="3612" href="Class.Decidable.Core.html#470" class="Function Operator">¿</a><a id="3613" class="Symbol">)</a> <a id="3615" href="Ledger.Conway.Conformance.Ledger.html#861" class="Function">govSt</a>

      <a id="3628" href="Ledger.Conway.Conformance.Epoch.html#3628" class="Bound">orphans</a> <a id="3636" class="Symbol">:</a> <a id="3638" href="abstract-set-theory.FiniteSetTheory.html#488" class="Function Operator">ℙ</a> <a id="3640" class="Symbol">(</a><a id="3641" href="Ledger.Conway.Specification.Gov.Actions.html#798" class="Function">GovActionID</a> <a id="3653" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="3655" href="Ledger.Conway.Specification.Gov.Actions.html#3768" class="Record">GovActionState</a><a id="3669" class="Symbol">)</a>
      <a id="3677" href="Ledger.Conway.Conformance.Epoch.html#3628" class="Bound">orphans</a>  <a id="3686" class="Symbol">=</a> <a id="3688" href="Axiom.Set.html#5718" class="Function">fromList</a> <a id="3697" class="Symbol">(</a><a id="3698" href="Ledger.Conway.Specification.Epoch.html#12443" class="Function">getOrphans</a> <a id="3709" href="Ledger.Conway.Conformance.Epoch.html#3491" class="Bound">es</a> <a id="3712" href="Ledger.Conway.Conformance.Epoch.html#3556" class="Bound">tmpGovSt</a><a id="3720" class="Symbol">)</a>

      <a id="3729" href="Ledger.Conway.Conformance.Epoch.html#3729" class="Bound">removed&#39;</a> <a id="3738" class="Symbol">:</a> <a id="3740" href="abstract-set-theory.FiniteSetTheory.html#488" class="Function Operator">ℙ</a> <a id="3742" class="Symbol">(</a><a id="3743" href="Ledger.Conway.Specification.Gov.Actions.html#798" class="Function">GovActionID</a> <a id="3755" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="3757" href="Ledger.Conway.Specification.Gov.Actions.html#3768" class="Record">GovActionState</a><a id="3771" class="Symbol">)</a>
      <a id="3779" href="Ledger.Conway.Conformance.Epoch.html#3729" class="Bound">removed&#39;</a> <a id="3788" class="Symbol">=</a> <a id="3790" href="Ledger.Conway.Specification.Ratify.html#3444" class="Function">removed</a> <a id="3798" href="Axiom.Set.html#8952" class="Function Operator">∪</a> <a id="3800" href="Ledger.Conway.Conformance.Epoch.html#3628" class="Bound">orphans</a>

      <a id="3815" href="Ledger.Conway.Conformance.Epoch.html#3815" class="Bound">govSt&#39;</a> <a id="3822" class="Symbol">=</a> <a id="3824" href="Data.List.Base.html#10389" class="Function">filter</a> <a id="3831" class="Symbol">(λ</a> <a id="3834" href="Ledger.Conway.Conformance.Epoch.html#3834" class="Bound">x</a> <a id="3836" class="Symbol">→</a> <a id="3838" href="Class.Decidable.Core.html#470" class="Function Operator">¿</a> <a id="3840" href="Data.Product.Base.html#636" class="Field">proj₁</a> <a id="3846" href="Ledger.Conway.Conformance.Epoch.html#3834" class="Bound">x</a> <a id="3848" href="Class.IsSet.html#462" class="Function Operator">∉</a> <a id="3850" href="abstract-set-theory.FiniteSetTheory.html#519" class="Function">mapˢ</a> <a id="3855" href="Data.Product.Base.html#636" class="Field">proj₁</a> <a id="3861" href="Ledger.Conway.Conformance.Epoch.html#3729" class="Bound">removed&#39;</a> <a id="3870" href="Class.Decidable.Core.html#470" class="Function Operator">¿</a><a id="3871" class="Symbol">)</a> <a id="3873" href="Ledger.Conway.Conformance.Ledger.html#861" class="Function">govSt</a>

      <a id="3886" href="Ledger.Conway.Conformance.Epoch.html#3886" class="Bound">removedGovActions</a> <a id="3904" class="Symbol">:</a> <a id="3906" href="abstract-set-theory.FiniteSetTheory.html#488" class="Function Operator">ℙ</a> <a id="3908" class="Symbol">(</a><a id="3909" href="Ledger.Core.Specification.Address.html#1324" class="Record">RwdAddr</a> <a id="3917" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="3919" href="Ledger.Conway.Specification.Certs.html#548" class="Datatype">DepositPurpose</a> <a id="3934" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="3936" href="Ledger.Prelude.Base.html#154" class="Function">Coin</a><a id="3940" class="Symbol">)</a>
      <a id="3948" href="Ledger.Conway.Conformance.Epoch.html#3886" class="Bound">removedGovActions</a> <a id="3966" class="Symbol">=</a>
        <a id="3976" href="Function.Base.html#1657" class="Function">flip</a> <a id="3981" href="Axiom.Set.html#7022" class="Function">concatMapˢ</a> <a id="3992" href="Ledger.Conway.Conformance.Epoch.html#3729" class="Bound">removed&#39;</a> <a id="4001" class="Symbol">λ</a> <a id="4003" class="Symbol">(</a><a id="4004" href="Ledger.Conway.Conformance.Epoch.html#4004" class="Bound">gaid</a> <a id="4009" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="4011" href="Ledger.Conway.Conformance.Epoch.html#4011" class="Bound">gaSt</a><a id="4015" class="Symbol">)</a> <a id="4017" class="Symbol">→</a>
          <a id="4029" href="abstract-set-theory.FiniteSetTheory.html#519" class="Function">mapˢ</a>
            <a id="4046" class="Symbol">(</a><a id="4047" href="Ledger.Conway.Specification.Gov.Actions.html#3835" class="Field">returnAddr</a> <a id="4058" href="Ledger.Conway.Conformance.Epoch.html#4011" class="Bound">gaSt</a> <a id="4063" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,_</a><a id="4065" class="Symbol">)</a>
            <a id="4079" class="Symbol">((</a><a id="4081" href="Ledger.Conway.Conformance.Ledger.html#834" class="Function">utxoSt</a> <a id="4088" class="Symbol">.</a><a id="4089" href="Ledger.Conway.Specification.Utxo.html#1338" class="Field">deposits</a> <a id="4098" href="Axiom.Set.Map.html#10678" class="Function Operator">∣</a> <a id="4100" href="Class.HasSingleton.html#288" class="Field Operator">❴</a> <a id="4102" href="Ledger.Conway.Specification.Certs.html#737" class="InductiveConstructor">GovActionDeposit</a> <a id="4119" href="Ledger.Conway.Conformance.Epoch.html#4004" class="Bound">gaid</a> <a id="4124" href="Class.HasSingleton.html#288" class="Field Operator">❵</a><a id="4125" class="Symbol">)</a> <a id="4127" href="Axiom.Set.Map.html#2293" class="Function Operator">ˢ</a><a id="4128" class="Symbol">)</a>

      <a id="4137" href="Ledger.Conway.Conformance.Epoch.html#4137" class="Bound">govActionReturns</a> <a id="4154" class="Symbol">:</a> <a id="4156" href="Ledger.Core.Specification.Address.html#1324" class="Record">RwdAddr</a> <a id="4164" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="4166" href="Ledger.Prelude.Base.html#154" class="Function">Coin</a>
      <a id="4177" href="Ledger.Conway.Conformance.Epoch.html#4137" class="Bound">govActionReturns</a> <a id="4194" class="Symbol">=</a>
        <a id="4204" href="Axiom.Set.Map.Dec.html#2124" class="Function">aggregate₊</a> <a id="4215" class="Symbol">(</a><a id="4216" href="abstract-set-theory.FiniteSetTheory.html#519" class="Function">mapˢ</a> <a id="4221" class="Symbol">(λ</a> <a id="4224" class="Symbol">(</a><a id="4225" href="Ledger.Conway.Conformance.Epoch.html#4225" class="Bound">a</a> <a id="4227" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="4229" class="Symbol">_</a> <a id="4231" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="4233" href="Ledger.Conway.Conformance.Epoch.html#4233" class="Bound">d</a><a id="4234" class="Symbol">)</a> <a id="4236" class="Symbol">→</a> <a id="4238" href="Ledger.Conway.Conformance.Epoch.html#4225" class="Bound">a</a> <a id="4240" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="4242" href="Ledger.Conway.Conformance.Epoch.html#4233" class="Bound">d</a><a id="4243" class="Symbol">)</a> <a id="4245" href="Ledger.Conway.Conformance.Epoch.html#3886" class="Bound">removedGovActions</a> <a id="4263" href="abstract-set-theory.FiniteSetTheory.html#2767" class="Function Operator">ᶠˢ</a><a id="4265" class="Symbol">)</a>

      <a id="4274" href="Ledger.Conway.Conformance.Epoch.html#4274" class="Bound">trWithdrawals</a>   <a id="4290" class="Symbol">=</a> <a id="4292" href="Ledger.Conway.Conformance.Epoch.html#3360" class="Function">esW</a> <a id="4296" class="Symbol">.</a><a id="4297" href="Ledger.Conway.Specification.Enact.html#700" class="Field">withdrawals</a>
      <a id="4315" href="Ledger.Conway.Conformance.Epoch.html#4315" class="Bound">totWithdrawals</a>  <a id="4331" class="Symbol">=</a> <a id="4333" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">∑[</a> <a id="4336" href="Ledger.Conway.Conformance.Epoch.html#4336" class="Bound">x</a> <a id="4338" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">←</a> <a id="4340" href="Ledger.Conway.Conformance.Epoch.html#4274" class="Bound">trWithdrawals</a> <a id="4354" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">]</a> <a id="4356" href="Ledger.Conway.Conformance.Epoch.html#4336" class="Bound">x</a>

      <a id="4365" href="Ledger.Conway.Conformance.Epoch.html#4365" class="Bound">retired</a>    <a id="4376" class="Symbol">=</a> <a id="4378" class="Symbol">(</a><a id="4379" href="Ledger.Conway.Conformance.Certs.html#1030" class="Function">pState</a> <a id="4386" class="Symbol">.</a><a id="4387" href="Ledger.Conway.Specification.Certs.html#4067" class="Field">retiring</a><a id="4395" class="Symbol">)</a> <a id="4397" href="Axiom.Set.Map.html#14616" class="Function Operator">⁻¹</a> <a id="4400" href="Ledger.Conway.Conformance.Epoch.html#2905" class="Generalizable">e</a>
      <a id="4408" href="Ledger.Conway.Conformance.Epoch.html#4408" class="Bound">payout</a>     <a id="4419" class="Symbol">=</a> <a id="4421" href="Ledger.Conway.Conformance.Epoch.html#4137" class="Bound">govActionReturns</a> <a id="4438" href="Axiom.Set.Map.Dec.html#2046" class="Function Operator">∪⁺</a> <a id="4441" href="Ledger.Conway.Conformance.Epoch.html#4274" class="Bound">trWithdrawals</a>
      <a id="4461" href="Ledger.Conway.Conformance.Epoch.html#4461" class="Bound">refunds</a>    <a id="4472" class="Symbol">=</a> <a id="4474" href="Axiom.Set.Map.html#14177" class="Function">pullbackMap</a> <a id="4486" href="Ledger.Conway.Conformance.Epoch.html#4408" class="Bound">payout</a> <a id="4493" href="Ledger.Conway.Specification.Epoch.html#5020" class="Function">toRwdAddr</a> <a id="4503" class="Symbol">(</a><a id="4504" href="Class.IsSet.html#916" class="Function">dom</a> <a id="4508" class="Symbol">(</a><a id="4509" href="Ledger.Conway.Conformance.Certs.html#1010" class="Function">dState</a> <a id="4516" class="Symbol">.</a><a id="4517" href="Ledger.Conway.Conformance.Certs.html#724" class="Field">rewards</a><a id="4524" class="Symbol">))</a>
      <a id="4533" href="Ledger.Conway.Conformance.Epoch.html#4533" class="Bound">unclaimed</a>  <a id="4544" class="Symbol">=</a> <a id="4546" href="Ledger.Prelude.HasCoin.html#170" class="Field">getCoin</a> <a id="4554" href="Ledger.Conway.Conformance.Epoch.html#4408" class="Bound">payout</a> <a id="4561" href="Interface.HasSubtract.html#209" class="Field Operator">-</a> <a id="4563" href="Ledger.Prelude.HasCoin.html#170" class="Field">getCoin</a> <a id="4571" href="Ledger.Conway.Conformance.Epoch.html#4461" class="Bound">refunds</a>
      <a id="4585" href="Ledger.Conway.Conformance.Epoch.html#4585" class="Bound">vDeposits</a>  <a id="4596" class="Symbol">=</a> <a id="4598" href="Ledger.Conway.Conformance.Certs.html#1050" class="Function">gState</a> <a id="4605" class="Symbol">.</a><a id="4606" href="Ledger.Conway.Conformance.Certs.html#921" class="Field">deposits</a>

      <a id="4622" href="Ledger.Conway.Conformance.Epoch.html#4622" class="Bound">dState&#39;</a> <a id="4630" class="Symbol">:</a> <a id="4632" href="Ledger.Conway.Conformance.Certs.html#597" class="Record">DState</a>
      <a id="4645" href="Ledger.Conway.Conformance.Epoch.html#4622" class="Bound">dState&#39;</a> <a id="4653" class="Symbol">=</a> <a id="4655" class="Keyword">record</a> <a id="4662" href="Ledger.Conway.Conformance.Certs.html#1010" class="Function">dState</a> <a id="4669" class="Symbol">{</a> <a id="4671" href="Ledger.Conway.Conformance.Certs.html#724" class="Field">rewards</a> <a id="4679" class="Symbol">=</a> <a id="4681" href="Ledger.Conway.Conformance.Certs.html#1010" class="Function">dState</a> <a id="4688" class="Symbol">.</a><a id="4689" href="Ledger.Conway.Conformance.Certs.html#724" class="Field">rewards</a> <a id="4697" href="Axiom.Set.Map.Dec.html#2046" class="Function Operator">∪⁺</a> <a id="4700" href="Ledger.Conway.Conformance.Epoch.html#4461" class="Bound">refunds</a> <a id="4708" class="Symbol">}</a>

      <a id="4717" href="Ledger.Conway.Conformance.Epoch.html#4717" class="Bound">pState&#39;</a> <a id="4725" class="Symbol">:</a> <a id="4727" href="Ledger.Conway.Specification.Certs.html#4013" class="Record">PState</a>
      <a id="4740" href="Ledger.Conway.Conformance.Epoch.html#4717" class="Bound">pState&#39;</a> <a id="4748" class="Symbol">=</a> <a class="AgdaKaTeX">$\begin{pmatrix} \,\htmlId{4752}{\htmlClass{Symbol}{\text{(}}}\,\,\href{Ledger.Conway.Conformance.Certs.html#1030}{\htmlId{4753}{\htmlClass{Function}{\text{pState}}}}\, \,\htmlId{4760}{\htmlClass{Symbol}{\text{.}}}\,\,\href{Ledger.Conway.Specification.Certs.html#4045}{\htmlId{4761}{\htmlClass{Field}{\text{pools}}}}\,\,\htmlId{4766}{\htmlClass{Symbol}{\text{)}}}\, \,\href{Axiom.Set.Map.html#10748}{\htmlId{4768}{\htmlClass{Function Operator}{\text{∣}}}}\, \,\href{Ledger.Conway.Conformance.Epoch.html#4365}{\htmlId{4770}{\htmlClass{Bound}{\text{retired}}}}\, \,\href{Axiom.Set.Map.html#10748}{\htmlId{4778}{\htmlClass{Function Operator}{\text{ᶜ}}}}\, \\ \,\htmlId{4782}{\htmlClass{Symbol}{\text{(}}}\,\,\href{Ledger.Conway.Conformance.Certs.html#1030}{\htmlId{4783}{\htmlClass{Function}{\text{pState}}}}\, \,\htmlId{4790}{\htmlClass{Symbol}{\text{.}}}\,\,\href{Ledger.Conway.Specification.Certs.html#4067}{\htmlId{4791}{\htmlClass{Field}{\text{retiring}}}}\,\,\htmlId{4799}{\htmlClass{Symbol}{\text{)}}}\, \,\href{Axiom.Set.Map.html#10748}{\htmlId{4801}{\htmlClass{Function Operator}{\text{∣}}}}\, \,\href{Ledger.Conway.Conformance.Epoch.html#4365}{\htmlId{4803}{\htmlClass{Bound}{\text{retired}}}}\, \,\href{Axiom.Set.Map.html#10748}{\htmlId{4811}{\htmlClass{Function Operator}{\text{ᶜ}}}}\, \end{pmatrix}$</a>

      <a id="4822" href="Ledger.Conway.Conformance.Epoch.html#4822" class="Bound">gState&#39;</a> <a id="4830" class="Symbol">:</a> <a id="4832" href="Ledger.Conway.Conformance.Certs.html#783" class="Record">GState</a>
      <a id="4845" href="Ledger.Conway.Conformance.Epoch.html#4822" class="Bound">gState&#39;</a> <a id="4853" class="Symbol">=</a> <a class="AgdaKaTeX">$\begin{pmatrix} \,\htmlId{4857}{\htmlClass{Symbol}{\text{(}}}\,\,\href{Class.ToBool.html#342}{\htmlId{4858}{\htmlClass{Function Operator}{\text{if}}}}\, \,\href{Data.List.Base.html#4681}{\htmlId{4861}{\htmlClass{Function}{\text{null}}}}\, \,\href{Ledger.Conway.Conformance.Epoch.html#3815}{\htmlId{4866}{\htmlClass{Bound}{\text{govSt&#39;}}}}\, \,\href{Class.ToBool.html#342}{\htmlId{4873}{\htmlClass{Function Operator}{\text{then}}}}\, \,\href{Axiom.Set.Map.html#6068}{\htmlId{4878}{\htmlClass{Function}{\text{mapValues}}}}\, \,\htmlId{4888}{\htmlClass{Symbol}{\text{(}}}\,\,\htmlId{4889}{\htmlClass{Number}{\text{1}}}\, \,\href{Class.HasAdd.Core.html#162}{\htmlId{4891}{\htmlClass{Field Operator}{\text{+\_}}}}\,\,\htmlId{4893}{\htmlClass{Symbol}{\text{)}}}\, \,\htmlId{4895}{\htmlClass{Symbol}{\text{(}}}\,\,\href{Ledger.Conway.Conformance.Certs.html#1050}{\htmlId{4896}{\htmlClass{Function}{\text{gState}}}}\, \,\htmlId{4903}{\htmlClass{Symbol}{\text{.}}}\,\,\href{Ledger.Conway.Conformance.Certs.html#838}{\htmlId{4904}{\htmlClass{Field}{\text{dreps}}}}\,\,\htmlId{4909}{\htmlClass{Symbol}{\text{)}}}\, \,\href{Class.ToBool.html#342}{\htmlId{4911}{\htmlClass{Function Operator}{\text{else}}}}\, \,\htmlId{4916}{\htmlClass{Symbol}{\text{(}}}\,\,\href{Ledger.Conway.Conformance.Certs.html#1050}{\htmlId{4917}{\htmlClass{Function}{\text{gState}}}}\, \,\htmlId{4924}{\htmlClass{Symbol}{\text{.}}}\,\,\href{Ledger.Conway.Conformance.Certs.html#838}{\htmlId{4925}{\htmlClass{Field}{\text{dreps}}}}\,\,\htmlId{4930}{\htmlClass{Symbol}{\text{))}}}\,
                , \,\htmlId{4951}{\htmlClass{Symbol}{\text{(}}}\,\,\href{Ledger.Conway.Conformance.Certs.html#1050}{\htmlId{4952}{\htmlClass{Function}{\text{gState}}}}\, \,\htmlId{4959}{\htmlClass{Symbol}{\text{.}}}\,\,\href{Ledger.Conway.Conformance.Certs.html#874}{\htmlId{4960}{\htmlClass{Field}{\text{ccHotKeys}}}}\,\,\htmlId{4969}{\htmlClass{Symbol}{\text{)}}}\, \,\href{Axiom.Set.Map.html#10678}{\htmlId{4971}{\htmlClass{Function Operator}{\text{∣}}}}\, \,\href{Ledger.Conway.Specification.Enact.html#1367}{\htmlId{4973}{\htmlClass{Function}{\text{ccCreds}}}}\, \,\htmlId{4981}{\htmlClass{Symbol}{\text{(}}}\,\,\href{Ledger.Conway.Conformance.Epoch.html#3491}{\htmlId{4982}{\htmlClass{Bound}{\text{es}}}}\, \,\htmlId{4985}{\htmlClass{Symbol}{\text{.}}}\,\,\href{Ledger.Conway.Specification.Enact.html#484}{\htmlId{4986}{\htmlClass{Field}{\text{cc}}}}\,\,\htmlId{4988}{\htmlClass{Symbol}{\text{)}}}\,
                , \,\href{Ledger.Conway.Conformance.Epoch.html#4585}{\htmlId{5008}{\htmlClass{Bound}{\text{vDeposits}}}}\,
                \end{pmatrix}$</a>

      <a id="5043" href="Ledger.Conway.Conformance.Epoch.html#5043" class="Bound">certState&#39;</a> <a id="5054" class="Symbol">:</a> <a id="5056" href="Ledger.Conway.Conformance.Certs.html#951" class="Record">CertState</a>
      <a id="5072" href="Ledger.Conway.Conformance.Epoch.html#5043" class="Bound">certState&#39;</a> <a id="5083" class="Symbol">=</a> <a id="5085" class="Keyword">record</a> <a id="5092" class="Symbol">{</a> <a id="5094" href="Ledger.Conway.Conformance.Certs.html#1010" class="Field">dState</a> <a id="5101" class="Symbol">=</a> <a id="5103" href="Ledger.Conway.Conformance.Epoch.html#4622" class="Bound">dState&#39;</a> <a id="5111" class="Symbol">;</a> <a id="5113" href="Ledger.Conway.Conformance.Certs.html#1030" class="Field">pState</a> <a id="5120" class="Symbol">=</a> <a id="5122" href="Ledger.Conway.Conformance.Epoch.html#4717" class="Bound">pState&#39;</a> <a id="5130" class="Symbol">;</a> <a id="5132" href="Ledger.Conway.Conformance.Certs.html#1050" class="Field">gState</a> <a id="5139" class="Symbol">=</a> <a id="5141" href="Ledger.Conway.Conformance.Epoch.html#4822" class="Bound">gState&#39;</a> <a id="5149" class="Symbol">}</a>

      <a id="5158" href="Ledger.Conway.Conformance.Epoch.html#5158" class="Bound">utxoSt&#39;</a> <a id="5166" class="Symbol">=</a> <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.Conway.Conformance.Ledger.html#834}{\htmlId{5170}{\htmlClass{Function}{\text{utxoSt}}}}\, \,\htmlId{5177}{\htmlClass{Symbol}{\text{.}}}\,\,\href{Ledger.Conway.Specification.Utxo.html#1294}{\htmlId{5178}{\htmlClass{Field}{\text{utxo}}}}\, \\ \,\href{Ledger.Conway.Conformance.Ledger.html#834}{\htmlId{5185}{\htmlClass{Function}{\text{utxoSt}}}}\, \,\htmlId{5192}{\htmlClass{Symbol}{\text{.}}}\,\,\href{Ledger.Conway.Specification.Utxo.html#1316}{\htmlId{5193}{\htmlClass{Field}{\text{fees}}}}\, \\ \,\href{Ledger.Conway.Conformance.Ledger.html#834}{\htmlId{5200}{\htmlClass{Function}{\text{utxoSt}}}}\, \,\htmlId{5207}{\htmlClass{Symbol}{\text{.}}}\,\,\href{Ledger.Conway.Specification.Utxo.html#1338}{\htmlId{5208}{\htmlClass{Field}{\text{deposits}}}}\, \,\href{Axiom.Set.Map.html#10748}{\htmlId{5217}{\htmlClass{Function Operator}{\text{∣}}}}\, \,\href{abstract-set-theory.FiniteSetTheory.html#519}{\htmlId{5219}{\htmlClass{Function}{\text{mapˢ}}}}\, \,\htmlId{5224}{\htmlClass{Symbol}{\text{(}}}\,\,\href{Data.Product.Base.html#636}{\htmlId{5225}{\htmlClass{Field}{\text{proj₁}}}}\, \,\href{Function.Base.html#1134}{\htmlId{5231}{\htmlClass{Function Operator}{\text{∘}}}}\, \,\href{Data.Product.Base.html#650}{\htmlId{5233}{\htmlClass{Field}{\text{proj₂}}}}\,\,\htmlId{5238}{\htmlClass{Symbol}{\text{)}}}\, \,\href{Ledger.Conway.Conformance.Epoch.html#3886}{\htmlId{5240}{\htmlClass{Bound}{\text{removedGovActions}}}}\, \,\href{Axiom.Set.Map.html#10748}{\htmlId{5258}{\htmlClass{Function Operator}{\text{ᶜ}}}}\, \\ \,\htmlId{5262}{\htmlClass{Number}{\text{0}}}\, \end{pmatrix}$</a>

      <a id="5273" href="Ledger.Conway.Conformance.Epoch.html#5273" class="Bound">acnt&#39;</a> <a id="5279" class="Symbol">=</a> <a id="5281" class="Keyword">record</a> <a id="5288" href="Ledger.Conway.Conformance.Epoch.html#2996" class="Generalizable">acnt</a>
        <a id="5301" class="Symbol">{</a> <a id="5303" href="Ledger.Conway.Specification.PParams.html#775" class="Field">treasury</a>  <a id="5313" class="Symbol">=</a> <a id="5315" href="Ledger.Conway.Conformance.Epoch.html#2996" class="Generalizable">acnt</a> <a id="5320" class="Symbol">.</a><a id="5321" href="Ledger.Conway.Specification.PParams.html#775" class="Field">treasury</a> <a id="5330" href="Data.Nat.Base.html#4462" class="Primitive Operator">∸</a> <a id="5332" href="Ledger.Conway.Conformance.Epoch.html#4315" class="Bound">totWithdrawals</a> <a id="5347" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="5349" href="Ledger.Conway.Conformance.Ledger.html#834" class="Function">utxoSt</a> <a id="5356" class="Symbol">.</a><a id="5357" href="Ledger.Conway.Specification.Utxo.html#1364" class="Field">donations</a> <a id="5367" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="5369" href="Ledger.Conway.Conformance.Epoch.html#4533" class="Bound">unclaimed</a> <a id="5379" class="Symbol">}</a>

      <a id="5388" href="Ledger.Conway.Conformance.Epoch.html#5388" class="Bound">stakeDistrs</a> <a id="5400" class="Symbol">:</a> <a id="5402" href="Ledger.Conway.Specification.Ratify.html#2963" class="Record">StakeDistrs</a>
      <a id="5420" href="Ledger.Conway.Conformance.Epoch.html#5388" class="Bound">stakeDistrs</a> <a id="5432" class="Symbol">=</a> <a id="5434" href="Ledger.Conway.Specification.Epoch.html#11626" class="Function">mkStakeDistrs</a> <a id="5448" class="Symbol">(</a><a id="5449" href="Ledger.Conway.Specification.Rewards.html#7779" class="Field">Snapshots.mark</a> <a id="5464" href="Ledger.Conway.Conformance.Epoch.html#3090" class="Generalizable">ss&#39;</a><a id="5467" class="Symbol">)</a> <a id="5469" href="Ledger.Conway.Conformance.Epoch.html#2905" class="Generalizable">e</a> <a id="5471" href="Ledger.Conway.Conformance.Epoch.html#5158" class="Bound">utxoSt&#39;</a> <a id="5479" href="Ledger.Conway.Conformance.Epoch.html#3815" class="Bound">govSt&#39;</a> <a id="5486" class="Symbol">(</a><a id="5487" class="Keyword">record</a> <a id="5494" class="Symbol">{</a> <a id="5496" href="Ledger.Conway.Conformance.Epoch.html#5496" class="Module">GState</a> <a id="5503" class="Symbol">(</a><a id="5504" href="Ledger.Conway.Conformance.Certs.html#1050" class="Field">CertState.gState</a> <a id="5521" class="Symbol">(</a><a id="5522" href="Ledger.Conway.Conformance.Ledger.html#887" class="Field">LState.certState</a> <a id="5539" href="Ledger.Conway.Conformance.Epoch.html#2982" class="Generalizable">ls</a><a id="5541" class="Symbol">))</a> <a id="5544" class="Symbol">})</a>
                                                                        <a id="5619" class="Symbol">(</a><a id="5620" class="Keyword">record</a> <a id="5627" class="Symbol">{</a> <a id="5629" href="Ledger.Conway.Conformance.Epoch.html#5629" class="Module">DState</a> <a id="5636" class="Symbol">(</a><a id="5637" href="Ledger.Conway.Conformance.Certs.html#1010" class="Field">CertState.dState</a> <a id="5654" class="Symbol">(</a><a id="5655" href="Ledger.Conway.Conformance.Ledger.html#887" class="Field">LState.certState</a> <a id="5672" href="Ledger.Conway.Conformance.Epoch.html#2982" class="Generalizable">ls</a><a id="5674" class="Symbol">))</a> <a id="5677" class="Symbol">})</a>

    <a id="5685" class="Keyword">in</a>
    <a id="5692" class="Keyword">record</a> <a id="5699" class="Symbol">{</a> <a id="5701" href="Ledger.Conway.Specification.Ratify.html#3149" class="Field">currentEpoch</a> <a id="5714" class="Symbol">=</a> <a id="5716" href="Ledger.Conway.Conformance.Epoch.html#2905" class="Generalizable">e</a>
           <a id="5729" class="Symbol">;</a> <a id="5731" href="Ledger.Conway.Specification.Ratify.html#3117" class="Field">stakeDistrs</a> <a id="5743" class="Symbol">=</a> <a id="5745" href="Ledger.Conway.Conformance.Epoch.html#5388" class="Bound">stakeDistrs</a>
           <a id="5768" class="Symbol">;</a> <a id="5770" href="Ledger.Conway.Specification.Ratify.html#3264" class="Field">treasury</a> <a id="5779" class="Symbol">=</a> <a id="5781" href="Ledger.Conway.Conformance.Epoch.html#2996" class="Generalizable">acnt</a> <a id="5786" class="Symbol">.</a><a id="5787" href="Ledger.Conway.Specification.PParams.html#775" class="Field">treasury</a> <a id="5796" class="Symbol">;</a> <a id="5798" href="Ledger.Conway.Conformance.Epoch.html#5798" class="Module">GState</a> <a id="5805" href="Ledger.Conway.Conformance.Certs.html#1050" class="Function">gState</a>
           <a id="5823" class="Symbol">;</a> <a id="5825" href="Ledger.Conway.Specification.Ratify.html#3293" class="Field">pools</a> <a id="5831" class="Symbol">=</a> <a id="5833" href="Ledger.Conway.Conformance.Certs.html#1030" class="Function">pState</a> <a id="5840" class="Symbol">.</a><a id="5841" href="Ledger.Conway.Specification.Certs.html#4045" class="Field">pools</a> <a id="5847" class="Symbol">;</a> <a id="5849" href="Ledger.Conway.Specification.Ratify.html#3339" class="Field">delegatees</a> <a id="5860" class="Symbol">=</a> <a id="5862" href="Ledger.Conway.Conformance.Certs.html#1010" class="Function">dState</a> <a id="5869" class="Symbol">.</a><a id="5870" href="Ledger.Conway.Conformance.Certs.html#654" class="Field">voteDelegs</a> <a id="5881" class="Symbol">}</a>
        <a id="5891" href="Ledger.Conway.Specification.Ratify.html#11729" class="Function Operator">⊢</a> <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.Conway.Conformance.Epoch.html#3491}{\htmlId{5895}{\htmlClass{Bound}{\text{es}}}}\, \\ \,\href{Class.HasEmptySet.html#287}{\htmlId{5900}{\htmlClass{Field}{\text{∅}}}}\, \\ \,\href{Agda.Builtin.Bool.html#192}{\htmlId{5904}{\htmlClass{InductiveConstructor}{\text{false}}}}\, \end{pmatrix}$</a> <a id="5912" href="Ledger.Conway.Specification.Ratify.html#11729" class="Function Operator">⇀⦇</a> <a id="5915" href="Ledger.Conway.Conformance.Epoch.html#3815" class="Bound">govSt&#39;</a> <a id="5922" href="Ledger.Conway.Specification.Ratify.html#11729" class="Function Operator">,RATIFIES⦈</a> <a id="5933" href="Ledger.Conway.Conformance.Epoch.html#2931" class="Generalizable">fut&#39;</a>
      <a id="5944" class="Symbol">→</a> <a id="5946" href="Ledger.Conway.Conformance.Epoch.html#2982" class="Generalizable">ls</a> <a id="5949" href="Ledger.Conway.Conformance.Rewards.html#613" class="Datatype Operator">⊢</a> <a id="5951" href="Ledger.Conway.Conformance.Epoch.html#3087" class="Generalizable">ss</a> <a id="5954" href="Ledger.Conway.Conformance.Rewards.html#613" class="Datatype Operator">⇀⦇</a> <a id="5957" href="Agda.Builtin.Unit.html#212" class="InductiveConstructor">tt</a> <a id="5960" href="Ledger.Conway.Conformance.Rewards.html#613" class="Datatype Operator">,SNAP⦈</a> <a id="5967" href="Ledger.Conway.Conformance.Epoch.html#3090" class="Generalizable">ss&#39;</a>
    <a id="5975" href="Prelude.InferenceRules.html#13694" class="Function Operator">────────────────────────────────</a>
    <a id="6012" class="Symbol">_</a> <a id="6014" href="Ledger.Conway.Conformance.Epoch.html#3184" class="Datatype Operator">⊢</a> <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.Conway.Conformance.Epoch.html#2996}{\htmlId{6018}{\htmlClass{Generalizable}{\text{acnt}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#3087}{\htmlId{6025}{\htmlClass{Generalizable}{\text{ss}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#2982}{\htmlId{6030}{\htmlClass{Generalizable}{\text{ls}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#3010}{\htmlId{6035}{\htmlClass{Generalizable}{\text{es₀}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#2927}{\htmlId{6041}{\htmlClass{Generalizable}{\text{fut}}}}\, \end{pmatrix}$</a> <a id="6047" href="Ledger.Conway.Conformance.Epoch.html#3184" class="Datatype Operator">⇀⦇</a> <a id="6050" href="Ledger.Conway.Conformance.Epoch.html#2905" class="Generalizable">e</a> <a id="6052" href="Ledger.Conway.Conformance.Epoch.html#3184" class="Datatype Operator">,EPOCH⦈</a>
        <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.Conway.Conformance.Epoch.html#5273}{\htmlId{6070}{\htmlClass{Bound}{\text{acnt&#39;}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#3090}{\htmlId{6078}{\htmlClass{Generalizable}{\text{ss&#39;}}}}\, \\ \begin{pmatrix} \,\href{Ledger.Conway.Conformance.Epoch.html#5158}{\htmlId{6086}{\htmlClass{Bound}{\text{utxoSt&#39;}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#3815}{\htmlId{6096}{\htmlClass{Bound}{\text{govSt&#39;}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#5043}{\htmlId{6105}{\htmlClass{Bound}{\text{certState&#39;}}}}\, \end{pmatrix} \\ \,\href{Ledger.Conway.Conformance.Epoch.html#3491}{\htmlId{6120}{\htmlClass{Bound}{\text{es}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#2931}{\htmlId{6125}{\htmlClass{Generalizable}{\text{fut&#39;}}}}\, \end{pmatrix}$</a>

<a id="6133" class="Keyword">data</a> <a id="_⊢_⇀⦇_,NEWEPOCH⦈_"></a><a id="6138" href="Ledger.Conway.Conformance.Epoch.html#6138" class="Datatype Operator">_⊢_⇀⦇_,NEWEPOCH⦈_</a> <a id="6156" class="Symbol">:</a> <a id="6158" href="Agda.Builtin.Unit.html#175" class="Record">⊤</a> <a id="6160" class="Symbol">→</a> <a id="6162" href="Ledger.Conway.Conformance.Epoch.html#1823" class="Record">NewEpochState</a> <a id="6176" class="Symbol">→</a> <a id="6178" href="Ledger.Core.Specification.Epoch.html#598" class="Function">Epoch</a> <a id="6184" class="Symbol">→</a> <a id="6186" href="Ledger.Conway.Conformance.Epoch.html#1823" class="Record">NewEpochState</a> <a id="6200" class="Symbol">→</a> <a id="6202" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="6207" class="Keyword">where</a>

  <a id="_⊢_⇀⦇_,NEWEPOCH⦈_.NEWEPOCH-New"></a><a id="6216" href="Ledger.Conway.Conformance.Epoch.html#6216" class="InductiveConstructor">NEWEPOCH-New</a> <a id="6229" class="Symbol">:</a> <a id="6231" class="Keyword">let</a>
      <a id="6241" href="Ledger.Conway.Conformance.Epoch.html#6241" class="Bound">eps&#39;</a> <a id="6246" class="Symbol">=</a> <a id="6248" href="Ledger.Conway.Conformance.Epoch.html#2138" class="Function">applyRUpd</a> <a id="6258" href="Ledger.Conway.Conformance.Epoch.html#3108" class="Generalizable">ru</a> <a id="6261" href="Ledger.Conway.Conformance.Epoch.html#2952" class="Generalizable">eps</a>
    <a id="6269" class="Keyword">in</a>
    <a id="6276" href="Prelude.InferenceRules.html#56075" class="Function Operator">∙</a> <a id="6278" href="Ledger.Conway.Conformance.Epoch.html#2905" class="Generalizable">e</a> <a id="6280" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="6282" href="Ledger.Conway.Conformance.Epoch.html#2907" class="Generalizable">lastEpoch</a> <a id="6292" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="6294" class="Number">1</a>
    <a id="6300" href="Prelude.InferenceRules.html#56006" class="Function Operator">∙</a> <a id="6302" class="Symbol">_</a> <a id="6304" href="Ledger.Conway.Conformance.Epoch.html#3184" class="Datatype Operator">⊢</a> <a id="6306" href="Ledger.Conway.Conformance.Epoch.html#6241" class="Bound">eps&#39;</a> <a id="6311" href="Ledger.Conway.Conformance.Epoch.html#3184" class="Datatype Operator">⇀⦇</a> <a id="6314" href="Ledger.Conway.Conformance.Epoch.html#2905" class="Generalizable">e</a> <a id="6316" href="Ledger.Conway.Conformance.Epoch.html#3184" class="Datatype Operator">,EPOCH⦈</a> <a id="6324" href="Ledger.Conway.Conformance.Epoch.html#2961" class="Generalizable">eps&#39;&#39;</a>
      <a id="6336" href="Prelude.InferenceRules.html#13694" class="Function Operator">────────────────────────────────</a>
      <a id="6375" class="Symbol">_</a> <a id="6377" href="Ledger.Conway.Conformance.Epoch.html#6138" class="Datatype Operator">⊢</a> <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.Conway.Conformance.Epoch.html#2907}{\htmlId{6381}{\htmlClass{Generalizable}{\text{lastEpoch}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#2952}{\htmlId{6393}{\htmlClass{Generalizable}{\text{eps}}}}\, \\ \,\href{Agda.Builtin.Maybe.html#173}{\htmlId{6399}{\htmlClass{InductiveConstructor}{\text{just}}}}\, \,\href{Ledger.Conway.Conformance.Epoch.html#3108}{\htmlId{6404}{\htmlClass{Generalizable}{\text{ru}}}}\, \end{pmatrix}$</a> <a id="6409" href="Ledger.Conway.Conformance.Epoch.html#6138" class="Datatype Operator">⇀⦇</a> <a id="6412" href="Ledger.Conway.Conformance.Epoch.html#2905" class="Generalizable">e</a> <a id="6414" href="Ledger.Conway.Conformance.Epoch.html#6138" class="Datatype Operator">,NEWEPOCH⦈</a> <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.Conway.Conformance.Epoch.html#2905}{\htmlId{6427}{\htmlClass{Generalizable}{\text{e}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#2961}{\htmlId{6431}{\htmlClass{Generalizable}{\text{eps&#39;&#39;}}}}\, \\ \,\href{Agda.Builtin.Maybe.html#194}{\htmlId{6439}{\htmlClass{InductiveConstructor}{\text{nothing}}}}\, \end{pmatrix}$</a>

  <a id="_⊢_⇀⦇_,NEWEPOCH⦈_.NEWEPOCH-Not-New"></a><a id="6452" href="Ledger.Conway.Conformance.Epoch.html#6452" class="InductiveConstructor">NEWEPOCH-Not-New</a> <a id="6469" class="Symbol">:</a>
    <a id="6475" href="Prelude.InferenceRules.html#56075" class="Function Operator">∙</a> <a id="6477" href="Ledger.Conway.Conformance.Epoch.html#2905" class="Generalizable">e</a> <a id="6479" href="Relation.Binary.PropositionalEquality.Core.html#1000" class="Function Operator">≢</a> <a id="6481" href="Ledger.Conway.Conformance.Epoch.html#2907" class="Generalizable">lastEpoch</a> <a id="6491" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="6493" class="Number">1</a>
      <a id="6501" href="Prelude.InferenceRules.html#13694" class="Function Operator">────────────────────────────────</a>
      <a id="6540" class="Symbol">_</a> <a id="6542" href="Ledger.Conway.Conformance.Epoch.html#6138" class="Datatype Operator">⊢</a> <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.Conway.Conformance.Epoch.html#2907}{\htmlId{6546}{\htmlClass{Generalizable}{\text{lastEpoch}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#2952}{\htmlId{6558}{\htmlClass{Generalizable}{\text{eps}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#3128}{\htmlId{6564}{\htmlClass{Generalizable}{\text{mru}}}}\, \end{pmatrix}$</a> <a id="6570" href="Ledger.Conway.Conformance.Epoch.html#6138" class="Datatype Operator">⇀⦇</a> <a id="6573" href="Ledger.Conway.Conformance.Epoch.html#2905" class="Generalizable">e</a> <a id="6575" href="Ledger.Conway.Conformance.Epoch.html#6138" class="Datatype Operator">,NEWEPOCH⦈</a> <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.Conway.Conformance.Epoch.html#2907}{\htmlId{6588}{\htmlClass{Generalizable}{\text{lastEpoch}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#2952}{\htmlId{6600}{\htmlClass{Generalizable}{\text{eps}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#3128}{\htmlId{6606}{\htmlClass{Generalizable}{\text{mru}}}}\, \end{pmatrix}$</a>

  <a id="_⊢_⇀⦇_,NEWEPOCH⦈_.NEWEPOCH-No-Reward-Update"></a><a id="6615" href="Ledger.Conway.Conformance.Epoch.html#6615" class="InductiveConstructor">NEWEPOCH-No-Reward-Update</a> <a id="6641" class="Symbol">:</a>
    <a id="6647" href="Prelude.InferenceRules.html#56075" class="Function Operator">∙</a> <a id="6649" href="Ledger.Conway.Conformance.Epoch.html#2905" class="Generalizable">e</a> <a id="6651" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="6653" href="Ledger.Conway.Conformance.Epoch.html#2907" class="Generalizable">lastEpoch</a> <a id="6663" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="6665" class="Number">1</a>
    <a id="6671" href="Prelude.InferenceRules.html#56006" class="Function Operator">∙</a> <a id="6673" class="Symbol">_</a> <a id="6675" href="Ledger.Conway.Conformance.Epoch.html#3184" class="Datatype Operator">⊢</a> <a id="6677" href="Ledger.Conway.Conformance.Epoch.html#2952" class="Generalizable">eps</a> <a id="6681" href="Ledger.Conway.Conformance.Epoch.html#3184" class="Datatype Operator">⇀⦇</a> <a id="6684" href="Ledger.Conway.Conformance.Epoch.html#2905" class="Generalizable">e</a> <a id="6686" href="Ledger.Conway.Conformance.Epoch.html#3184" class="Datatype Operator">,EPOCH⦈</a> <a id="6694" href="Ledger.Conway.Conformance.Epoch.html#2956" class="Generalizable">eps&#39;</a>
      <a id="6705" href="Prelude.InferenceRules.html#13694" class="Function Operator">────────────────────────────────</a>
      <a id="6744" class="Symbol">_</a> <a id="6746" href="Ledger.Conway.Conformance.Epoch.html#6138" class="Datatype Operator">⊢</a> <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.Conway.Conformance.Epoch.html#2907}{\htmlId{6750}{\htmlClass{Generalizable}{\text{lastEpoch}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#2952}{\htmlId{6762}{\htmlClass{Generalizable}{\text{eps}}}}\, \\ \,\href{Agda.Builtin.Maybe.html#194}{\htmlId{6768}{\htmlClass{InductiveConstructor}{\text{nothing}}}}\, \end{pmatrix}$</a> <a id="6778" href="Ledger.Conway.Conformance.Epoch.html#6138" class="Datatype Operator">⇀⦇</a> <a id="6781" href="Ledger.Conway.Conformance.Epoch.html#2905" class="Generalizable">e</a> <a id="6783" href="Ledger.Conway.Conformance.Epoch.html#6138" class="Datatype Operator">,NEWEPOCH⦈</a> <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.Conway.Conformance.Epoch.html#2905}{\htmlId{6796}{\htmlClass{Generalizable}{\text{e}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#2956}{\htmlId{6800}{\htmlClass{Generalizable}{\text{eps&#39;}}}}\, \\ \,\href{Agda.Builtin.Maybe.html#194}{\htmlId{6807}{\htmlClass{InductiveConstructor}{\text{nothing}}}}\, \end{pmatrix}$</a>
</pre></body></html>