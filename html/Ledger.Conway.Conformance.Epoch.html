<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>Ledger.Conway.Conformance.Epoch</title><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.css"><link rel="stylesheet" href="Agda.css"><script src="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.js"></script><script src="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/contrib/auto-render.min.js"></script><script src="AgdaKaTeX.js" defer=""></script></head><body><pre class="Agda"><a id="1" class="Symbol">{-#</a> <a id="5" class="Keyword">OPTIONS</a> <a id="13" class="Pragma">--safe</a> <a id="20" class="Symbol">#-}</a>

<a id="25" class="Keyword">open</a> <a id="30" class="Keyword">import</a> <a id="37" href="Ledger.Conway.Specification.Abstract.html" class="Module">Ledger.Conway.Specification.Abstract</a>
<a id="74" class="Keyword">open</a> <a id="79" class="Keyword">import</a> <a id="86" href="Ledger.Conway.Specification.Transaction.html" class="Module">Ledger.Conway.Specification.Transaction</a>

<a id="127" class="Keyword">module</a> <a id="134" href="Ledger.Conway.Conformance.Epoch.html" class="Module">Ledger.Conway.Conformance.Epoch</a>
  <a id="168" class="Symbol">(</a><a id="169" href="Ledger.Conway.Conformance.Epoch.html#169" class="Bound">txs</a> <a id="173" class="Symbol">:</a> <a id="175" class="Symbol">_)</a> <a id="178" class="Symbol">(</a><a id="179" class="Keyword">open</a> <a id="184" href="Ledger.Conway.Specification.Transaction.html#999" class="Module">TransactionStructure</a> <a id="205" href="Ledger.Conway.Conformance.Epoch.html#169" class="Bound">txs</a><a id="208" class="Symbol">)</a>
  <a id="212" class="Symbol">(</a><a id="213" href="Ledger.Conway.Conformance.Epoch.html#213" class="Bound">abs</a> <a id="217" class="Symbol">:</a> <a id="219" href="Ledger.Conway.Specification.Abstract.html#829" class="Record">AbstractFunctions</a> <a id="237" href="Ledger.Conway.Conformance.Epoch.html#169" class="Bound">txs</a><a id="240" class="Symbol">)</a> <a id="242" class="Symbol">(</a><a id="243" class="Keyword">open</a> <a id="248" href="Ledger.Conway.Specification.Abstract.html#829" class="Module">AbstractFunctions</a> <a id="266" href="Ledger.Conway.Conformance.Epoch.html#213" class="Bound">abs</a><a id="269" class="Symbol">)</a>
  <a id="273" class="Keyword">where</a>

<a id="280" class="Keyword">open</a> <a id="285" class="Keyword">import</a> <a id="292" href="Ledger.Prelude.html" class="Module">Ledger.Prelude</a>
<a id="307" class="Keyword">open</a> <a id="312" class="Keyword">import</a> <a id="319" href="Data.Integer.html" class="Module">Data.Integer</a> <a id="332" class="Keyword">using</a> <a id="338" class="Symbol">()</a> <a id="341" class="Keyword">renaming</a> <a id="350" class="Symbol">(</a><a id="351" href="Agda.Builtin.Int.html#263" class="InductiveConstructor">+_</a> <a id="354" class="Symbol">to</a> <a id="357" class="InductiveConstructor">pos</a><a id="360" class="Symbol">)</a>
<a id="362" class="Keyword">import</a> <a id="369" href="Data.Integer.html" class="Module">Data.Integer</a> <a id="382" class="Symbol">as</a> <a id="385" class="Module">ℤ</a>

<a id="388" class="Keyword">open</a> <a id="393" class="Keyword">import</a> <a id="400" href="Data.Nat.Properties.html" class="Module">Data.Nat.Properties</a> <a id="420" class="Keyword">using</a> <a id="426" class="Symbol">(</a><a id="427" href="Data.Nat.Properties.html#17566" class="Function">+-0-monoid</a><a id="437" class="Symbol">;</a> <a id="439" href="Data.Nat.Properties.html#17645" class="Function">+-0-commutativeMonoid</a><a id="460" class="Symbol">)</a>
<a id="462" class="Keyword">open</a> <a id="467" class="Keyword">import</a> <a id="474" href="Data.List.html" class="Module">Data.List</a> <a id="484" class="Keyword">using</a> <a id="490" class="Symbol">(</a><a id="491" href="Data.List.Base.html#10389" class="Function">filter</a><a id="497" class="Symbol">)</a>

<a id="500" class="Keyword">open</a> <a id="505" class="Keyword">import</a> <a id="512" href="Agda.Builtin.FromNat.html" class="Module">Agda.Builtin.FromNat</a>

<a id="534" class="Keyword">open</a> <a id="539" class="Keyword">import</a> <a id="546" href="Ledger.Conway.Specification.Enact.html" class="Module">Ledger.Conway.Specification.Enact</a> <a id="580" href="Ledger.Conway.Specification.Transaction.html#2077" class="Function">govStructure</a>
<a id="593" class="Keyword">open</a> <a id="598" class="Keyword">import</a> <a id="605" href="Ledger.Conway.Conformance.Equivalence.html" class="Module">Ledger.Conway.Conformance.Equivalence</a> <a id="643" href="Ledger.Conway.Conformance.Epoch.html#169" class="Bound">txs</a> <a id="647" href="Ledger.Conway.Conformance.Epoch.html#213" class="Bound">abs</a>
<a id="651" class="Keyword">open</a> <a id="656" class="Keyword">import</a> <a id="663" href="Ledger.Conway.Conformance.Equivalence.Convert.html" class="Module">Ledger.Conway.Conformance.Equivalence.Convert</a>
<a id="709" class="Keyword">open</a> <a id="714" class="Keyword">import</a> <a id="721" href="Ledger.Conway.Conformance.Equivalence.Deposits.html" class="Module">Ledger.Conway.Conformance.Equivalence.Deposits</a> <a id="768" href="Ledger.Conway.Conformance.Epoch.html#169" class="Bound">txs</a> <a id="772" href="Ledger.Conway.Conformance.Epoch.html#213" class="Bound">abs</a>
<a id="776" class="Keyword">open</a> <a id="781" class="Keyword">import</a> <a id="788" href="Ledger.Conway.Conformance.Ledger.html" class="Module">Ledger.Conway.Conformance.Ledger</a> <a id="821" href="Ledger.Conway.Conformance.Epoch.html#169" class="Bound">txs</a> <a id="825" href="Ledger.Conway.Conformance.Epoch.html#213" class="Bound">abs</a>
<a id="829" class="Keyword">open</a> <a id="834" class="Keyword">import</a> <a id="841" href="Ledger.Conway.Specification.Ratify.html" class="Module">Ledger.Conway.Specification.Ratify</a> <a id="876" href="Ledger.Conway.Conformance.Epoch.html#169" class="Bound">txs</a>
<a id="880" class="Keyword">open</a> <a id="885" class="Keyword">import</a> <a id="892" href="Ledger.Conway.Conformance.Utxo.html" class="Module">Ledger.Conway.Conformance.Utxo</a> <a id="923" href="Ledger.Conway.Conformance.Epoch.html#169" class="Bound">txs</a> <a id="927" href="Ledger.Conway.Conformance.Epoch.html#213" class="Bound">abs</a>
<a id="931" class="Keyword">open</a> <a id="936" class="Keyword">import</a> <a id="943" href="Ledger.Conway.Conformance.Certs.html" class="Module">Ledger.Conway.Conformance.Certs</a> <a id="975" href="Ledger.Conway.Specification.Transaction.html#2077" class="Function">govStructure</a>
<a id="988" class="Keyword">open</a> <a id="993" class="Keyword">import</a> <a id="1000" href="Ledger.Conway.Conformance.Rewards.html" class="Module">Ledger.Conway.Conformance.Rewards</a> <a id="1034" href="Ledger.Conway.Conformance.Epoch.html#169" class="Bound">txs</a> <a id="1038" href="Ledger.Conway.Conformance.Epoch.html#213" class="Bound">abs</a>
<a id="1042" class="Keyword">open</a> <a id="1047" class="Keyword">import</a> <a id="1054" href="Ledger.Conway.Specification.Epoch.html" class="Module">Ledger.Conway.Specification.Epoch</a> <a id="1088" href="Ledger.Conway.Conformance.Epoch.html#169" class="Bound">txs</a> <a id="1092" href="Ledger.Conway.Conformance.Epoch.html#213" class="Bound">abs</a>
  <a id="1098" class="Keyword">using</a> <a id="1104" class="Symbol">(</a><a id="1105" href="Ledger.Conway.Specification.Epoch.html#5594" class="Function">getStakeCred</a><a id="1117" class="Symbol">;</a> <a id="1119" href="Ledger.Conway.Specification.Epoch.html#13210" class="Function">getOrphans</a><a id="1129" class="Symbol">;</a> <a id="1131" href="Ledger.Conway.Specification.Epoch.html#12519" class="Function">mkStakeDistrs</a><a id="1144" class="Symbol">;</a> <a id="1146" href="Ledger.Conway.Specification.Epoch.html#5489" class="Function">toRewardAddress</a><a id="1161" class="Symbol">)</a> <a id="1163" class="Keyword">public</a>
<a id="1170" class="Keyword">import</a> <a id="1177" href="Ledger.Conway.Specification.Epoch.html" class="Module">Ledger.Conway.Specification.Epoch</a> <a id="1211" href="Ledger.Conway.Conformance.Epoch.html#169" class="Bound">txs</a> <a id="1215" href="Ledger.Conway.Conformance.Epoch.html#213" class="Bound">abs</a> <a id="1219" class="Symbol">as</a> <a id="EpochSpec"></a><a id="1222" href="Ledger.Conway.Conformance.Epoch.html#1222" class="Module">EpochSpec</a>

<a id="1233" class="Keyword">record</a> <a id="EpochState"></a><a id="1240" href="Ledger.Conway.Conformance.Epoch.html#1240" class="Record">EpochState</a> <a id="1251" class="Symbol">:</a> <a id="1253" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="1258" class="Keyword">where</a>
  <a id="1266" class="Keyword">constructor</a> <a id="⟦_,_,_,_,_⟧ᵉ&#39;"></a><a id="1278" href="Ledger.Conway.Conformance.Epoch.html#1278" class="InductiveConstructor Operator">⟦_,_,_,_,_⟧ᵉ&#39;</a>
  <a id="1294" class="Keyword">field</a>
    <a id="EpochState.acnt"></a><a id="1304" href="Ledger.Conway.Conformance.Epoch.html#1304" class="Field">acnt</a>       <a id="1315" class="Symbol">:</a> <a id="1317" href="Ledger.Conway.Specification.PParams.html#720" class="Record">Acnt</a>
    <a id="EpochState.ss"></a><a id="1326" href="Ledger.Conway.Conformance.Epoch.html#1326" class="Field">ss</a>         <a id="1337" class="Symbol">:</a> <a id="1339" href="Ledger.Conway.Specification.Rewards.html#7719" class="Record">Snapshots</a>
    <a id="EpochState.ls"></a><a id="1353" href="Ledger.Conway.Conformance.Epoch.html#1353" class="Field">ls</a>         <a id="1364" class="Symbol">:</a> <a id="1366" href="Ledger.Conway.Conformance.Ledger.html#779" class="Record">LState</a>
    <a id="EpochState.es"></a><a id="1377" href="Ledger.Conway.Conformance.Epoch.html#1377" class="Field">es</a>         <a id="1388" class="Symbol">:</a> <a id="1390" href="Ledger.Conway.Specification.Enact.html#448" class="Record">EnactState</a>
    <a id="EpochState.fut"></a><a id="1405" href="Ledger.Conway.Conformance.Epoch.html#1405" class="Field">fut</a>        <a id="1416" class="Symbol">:</a> <a id="1418" href="Ledger.Conway.Specification.Ratify.html#3531" class="Record">RatifyState</a>

<a id="PoolDelegatedStake"></a><a id="1431" href="Ledger.Conway.Conformance.Epoch.html#1431" class="Function">PoolDelegatedStake</a> <a id="1450" class="Symbol">:</a> <a id="1452" href="Agda.Primitive.html#388" class="Primitive">Type</a>
<a id="1457" href="Ledger.Conway.Conformance.Epoch.html#1431" class="Function">PoolDelegatedStake</a> <a id="1476" class="Symbol">=</a> <a id="1478" href="Ledger.Core.Specification.Crypto.html#1386" class="Function">KeyHash</a> <a id="1486" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="1488" href="Ledger.Prelude.Base.html#154" class="Function">Coin</a>

<a id="1494" class="Keyword">record</a> <a id="NewEpochState"></a><a id="1501" href="Ledger.Conway.Conformance.Epoch.html#1501" class="Record">NewEpochState</a> <a id="1515" class="Symbol">:</a> <a id="1517" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="1522" class="Keyword">where</a>
  <a id="1530" class="Keyword">field</a>
    <a id="NewEpochState.lastEpoch"></a><a id="1540" href="Ledger.Conway.Conformance.Epoch.html#1540" class="Field">lastEpoch</a>   <a id="1552" class="Symbol">:</a> <a id="1554" href="Ledger.Core.Specification.Epoch.html#646" class="Function">Epoch</a>
    <a id="NewEpochState.bprev"></a><a id="1564" href="Ledger.Conway.Conformance.Epoch.html#1564" class="Field">bprev</a>       <a id="1576" class="Symbol">:</a> <a id="1578" href="Ledger.Conway.Specification.Rewards.html#4906" class="Function">BlocksMade</a>
    <a id="NewEpochState.bcur"></a><a id="1593" href="Ledger.Conway.Conformance.Epoch.html#1593" class="Field">bcur</a>        <a id="1605" class="Symbol">:</a> <a id="1607" href="Ledger.Conway.Specification.Rewards.html#4906" class="Function">BlocksMade</a>
    <a id="NewEpochState.epochState"></a><a id="1622" href="Ledger.Conway.Conformance.Epoch.html#1622" class="Field">epochState</a>  <a id="1634" class="Symbol">:</a> <a id="1636" href="Ledger.Conway.Conformance.Epoch.html#1240" class="Record">EpochState</a>
    <a id="NewEpochState.ru"></a><a id="1651" href="Ledger.Conway.Conformance.Epoch.html#1651" class="Field">ru</a>          <a id="1663" class="Symbol">:</a> <a id="1665" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="1671" href="Ledger.Conway.Specification.Rewards.html#6249" class="Record">RewardUpdate</a>
    <a id="NewEpochState.pd"></a><a id="1688" href="Ledger.Conway.Conformance.Epoch.html#1688" class="Field">pd</a>          <a id="1700" class="Symbol">:</a> <a id="1702" href="Ledger.Conway.Conformance.Epoch.html#1431" class="Function">PoolDelegatedStake</a>

<a id="1722" class="Keyword">instance</a>
  <a id="1733" class="Keyword">unquoteDecl</a> <a id="HasCast-EpochState"></a><a id="1745" href="Ledger.Conway.Conformance.Epoch.html#1745" class="Function">HasCast-EpochState</a> <a id="HasCast-NewEpochState"></a><a id="1764" href="Ledger.Conway.Conformance.Epoch.html#1764" class="Function">HasCast-NewEpochState</a> <a id="1786" class="Symbol">=</a> <a id="1788" href="stdlib-classes.Class.HasCast.Derive.html#2690" class="Function">derive-HasCast</a>
    <a id="1807" class="Symbol">(</a> <a id="1809" class="Symbol">(</a><a id="1810" class="Keyword">quote</a> <a id="1816" href="Ledger.Conway.Conformance.Epoch.html#1240" class="Record">EpochState</a>     <a id="1831" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1833" href="Ledger.Conway.Conformance.Epoch.html#1745" class="Function">HasCast-EpochState</a><a id="1851" class="Symbol">)</a>
    <a id="1857" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="1859" href="Data.List.Base.html#4907" class="Function Operator">[</a> <a id="1861" class="Symbol">(</a><a id="1862" class="Keyword">quote</a> <a id="1868" href="Ledger.Conway.Conformance.Epoch.html#1501" class="Record">NewEpochState</a>  <a id="1883" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1885" href="Ledger.Conway.Conformance.Epoch.html#1764" class="Function">HasCast-NewEpochState</a><a id="1906" class="Symbol">)</a><a id="1907" href="Data.List.Base.html#4907" class="Function Operator">]</a><a id="1908" class="Symbol">)</a>

  <a id="EpochStateFromConf"></a><a id="1913" href="Ledger.Conway.Conformance.Epoch.html#1913" class="Function">EpochStateFromConf</a> <a id="1932" class="Symbol">:</a> <a id="1934" href="Ledger.Conway.Conformance.Epoch.html#1240" class="Record">EpochState</a> <a id="1945" href="Ledger.Conway.Conformance.Equivalence.Convert.html#409" class="Function Operator">⭆</a> <a id="1947" href="Ledger.Conway.Specification.Epoch.html#1837" class="Record">EpochSpec.EpochState</a>
  <a id="1970" href="Ledger.Conway.Conformance.Epoch.html#1913" class="Function">EpochStateFromConf</a> <a id="1989" class="Symbol">.</a><a id="1990" href="Ledger.Conway.Conformance.Equivalence.Convert.html#217" class="Field">convⁱ</a> <a id="1996" class="Symbol">_</a> <a id="1998" href="Ledger.Conway.Conformance.Epoch.html#1998" class="Bound">epochState</a> <a id="2009" class="Symbol">=</a>
    <a id="2015" class="Keyword">let</a> <a id="2019" class="Keyword">open</a> <a id="2024" href="Ledger.Conway.Conformance.Epoch.html#1240" class="Module">EpochState</a> <a id="2035" href="Ledger.Conway.Conformance.Epoch.html#1998" class="Bound">epochState</a> <a id="2046" class="Keyword">in</a>
    <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.Conway.Conformance.Epoch.html#1304}{\htmlId{2055}{\htmlClass{Field}{\text{acnt}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#1326}{\htmlId{2062}{\htmlClass{Field}{\text{ss}}}}\, \\ \,\href{Ledger.Conway.Conformance.Equivalence.Convert.html#452}{\htmlId{2067}{\htmlClass{Function}{\text{conv}}}}\, \,\href{Ledger.Conway.Conformance.Epoch.html#1353}{\htmlId{2072}{\htmlClass{Field}{\text{ls}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#1377}{\htmlId{2077}{\htmlClass{Field}{\text{es}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#1405}{\htmlId{2082}{\htmlClass{Field}{\text{fut}}}}\, \end{pmatrix}$</a>

  <a id="EpochStateToConf"></a><a id="2091" href="Ledger.Conway.Conformance.Epoch.html#2091" class="Function">EpochStateToConf</a> <a id="2108" class="Symbol">:</a> <a id="2110" href="Ledger.Conway.Specification.Epoch.html#1837" class="Record">EpochSpec.EpochState</a> <a id="2131" href="Ledger.Conway.Conformance.Equivalence.Convert.html#409" class="Function Operator">⭆</a> <a id="2133" href="Ledger.Conway.Conformance.Epoch.html#1240" class="Record">EpochState</a>
  <a id="2146" href="Ledger.Conway.Conformance.Epoch.html#2091" class="Function">EpochStateToConf</a> <a id="2163" class="Symbol">.</a><a id="2164" href="Ledger.Conway.Conformance.Equivalence.Convert.html#217" class="Field">convⁱ</a> <a id="2170" href="Ledger.Conway.Conformance.Epoch.html#2170" class="Bound">deposits</a> <a id="2179" href="Ledger.Conway.Conformance.Epoch.html#2179" class="Bound">epochSt</a> <a id="2187" class="Symbol">=</a>
    <a id="2193" class="Keyword">let</a> <a id="2197" class="Keyword">open</a> <a id="2202" href="Ledger.Conway.Specification.Epoch.html#1837" class="Module">EpochSpec.EpochState</a> <a id="2223" href="Ledger.Conway.Conformance.Epoch.html#2179" class="Bound">epochSt</a> <a id="2231" class="Keyword">in</a>
    <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.Conway.Specification.Epoch.html#1905}{\htmlId{2240}{\htmlClass{Field}{\text{acnt}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#1927}{\htmlId{2247}{\htmlClass{Field}{\text{ss}}}}\, \\ \,\href{Ledger.Conway.Conformance.Equivalence.Deposits.html#12794}{\htmlId{2252}{\htmlClass{Function}{\text{certDeposits}}}}\, \,\href{Ledger.Conway.Specification.Epoch.html#1954}{\htmlId{2265}{\htmlClass{Field}{\text{ls}}}}\, \,\href{Ledger.Conway.Conformance.Equivalence.Convert.html#270}{\htmlId{2268}{\htmlClass{Function Operator}{\text{⊢conv}}}}\, \,\href{Ledger.Conway.Specification.Epoch.html#1954}{\htmlId{2274}{\htmlClass{Field}{\text{ls}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#1978}{\htmlId{2279}{\htmlClass{Field}{\text{es}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#2006}{\htmlId{2284}{\htmlClass{Field}{\text{fut}}}}\, \end{pmatrix}$</a>

  <a id="NewEpochStateFromConf"></a><a id="2295" href="Ledger.Conway.Conformance.Epoch.html#2295" class="Function">NewEpochStateFromConf</a> <a id="2317" class="Symbol">:</a> <a id="2319" href="Ledger.Conway.Conformance.Epoch.html#1501" class="Record">NewEpochState</a> <a id="2333" href="Ledger.Conway.Conformance.Equivalence.Convert.html#409" class="Function Operator">⭆</a> <a id="2335" href="Ledger.Conway.Specification.Epoch.html#3588" class="Record">EpochSpec.NewEpochState</a>
  <a id="2361" href="Ledger.Conway.Conformance.Epoch.html#2295" class="Function">NewEpochStateFromConf</a> <a id="2383" class="Symbol">.</a><a id="2384" href="Ledger.Conway.Conformance.Equivalence.Convert.html#217" class="Field">convⁱ</a> <a id="2390" class="Symbol">_</a> <a id="2392" href="Ledger.Conway.Conformance.Epoch.html#2392" class="Bound">newEpochState</a> <a id="2406" class="Symbol">=</a>
    <a id="2412" class="Keyword">let</a> <a id="2416" class="Keyword">open</a> <a id="2421" href="Ledger.Conway.Conformance.Epoch.html#1501" class="Module">NewEpochState</a> <a id="2435" href="Ledger.Conway.Conformance.Epoch.html#2392" class="Bound">newEpochState</a> <a id="2449" class="Keyword">in</a>
    <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.Conway.Conformance.Epoch.html#1540}{\htmlId{2458}{\htmlClass{Field}{\text{lastEpoch}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#1564}{\htmlId{2470}{\htmlClass{Field}{\text{bprev}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#1593}{\htmlId{2478}{\htmlClass{Field}{\text{bcur}}}}\, \\ \,\href{Ledger.Conway.Conformance.Equivalence.Convert.html#452}{\htmlId{2485}{\htmlClass{Function}{\text{conv}}}}\, \,\href{Ledger.Conway.Conformance.Epoch.html#1622}{\htmlId{2490}{\htmlClass{Field}{\text{epochState}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#1651}{\htmlId{2503}{\htmlClass{Field}{\text{ru}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#1688}{\htmlId{2508}{\htmlClass{Field}{\text{pd}}}}\, \end{pmatrix}$</a>

  <a id="NewEpochStateToConf"></a><a id="2516" href="Ledger.Conway.Conformance.Epoch.html#2516" class="Function">NewEpochStateToConf</a> <a id="2536" class="Symbol">:</a> <a id="2538" href="Ledger.Conway.Specification.Epoch.html#3588" class="Record">EpochSpec.NewEpochState</a> <a id="2562" href="Ledger.Conway.Conformance.Equivalence.Convert.html#409" class="Function Operator">⭆</a> <a id="2564" href="Ledger.Conway.Conformance.Epoch.html#1501" class="Record">NewEpochState</a>
  <a id="2580" href="Ledger.Conway.Conformance.Epoch.html#2516" class="Function">NewEpochStateToConf</a> <a id="2600" class="Symbol">.</a><a id="2601" href="Ledger.Conway.Conformance.Equivalence.Convert.html#217" class="Field">convⁱ</a> <a id="2607" href="Ledger.Conway.Conformance.Epoch.html#2607" class="Bound">deposits</a> <a id="2616" href="Ledger.Conway.Conformance.Epoch.html#2616" class="Bound">newEpochSt</a> <a id="2627" class="Symbol">=</a>
    <a id="2633" class="Keyword">let</a> <a id="2637" class="Keyword">open</a> <a id="2642" href="Ledger.Conway.Specification.Epoch.html#3588" class="Module">EpochSpec.NewEpochState</a> <a id="2666" href="Ledger.Conway.Conformance.Epoch.html#2616" class="Bound">newEpochSt</a> <a id="2677" class="Keyword">in</a>
    <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.Conway.Specification.Epoch.html#3627}{\htmlId{2686}{\htmlClass{Field}{\text{lastEpoch}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#3680}{\htmlId{2698}{\htmlClass{Field}{\text{bcur}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#3651}{\htmlId{2705}{\htmlClass{Field}{\text{bprev}}}}\, \\ \,\href{Ledger.Conway.Conformance.Equivalence.Convert.html#452}{\htmlId{2713}{\htmlClass{Function}{\text{conv}}}}\, \,\href{Ledger.Conway.Specification.Epoch.html#3709}{\htmlId{2718}{\htmlClass{Field}{\text{epochState}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#3738}{\htmlId{2731}{\htmlClass{Field}{\text{ru}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#3775}{\htmlId{2736}{\htmlClass{Field}{\text{pd}}}}\, \end{pmatrix}$</a>


<a id="applyRUpd"></a><a id="2743" href="Ledger.Conway.Conformance.Epoch.html#2743" class="Function">applyRUpd</a> <a id="2753" class="Symbol">:</a> <a id="2755" href="Ledger.Conway.Specification.Rewards.html#6249" class="Record">RewardUpdate</a> <a id="2768" class="Symbol">→</a> <a id="2770" href="Ledger.Conway.Conformance.Epoch.html#1240" class="Record">EpochState</a> <a id="2781" class="Symbol">→</a> <a id="2783" href="Ledger.Conway.Conformance.Epoch.html#1240" class="Record">EpochState</a>
<a id="2794" href="Ledger.Conway.Conformance.Epoch.html#2743" class="Function">applyRUpd</a> <a id="2804" href="Ledger.Conway.Conformance.Epoch.html#2804" class="Bound">rewardUpdate</a>
  <a class="AgdaKaTeX">$\begin{pmatrix} \begin{pmatrix} \,\href{Ledger.Conway.Conformance.Epoch.html#2823}{\htmlId{2823}{\htmlClass{Bound}{\text{treasury}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#2834}{\htmlId{2834}{\htmlClass{Bound}{\text{reserves}}}}\, \end{pmatrix}
  \\ \,\href{Ledger.Conway.Conformance.Epoch.html#2850}{\htmlId{2850}{\htmlClass{Bound}{\text{ss}}}}\,
  \\ \begin{pmatrix} \begin{pmatrix} \,\href{Ledger.Conway.Conformance.Epoch.html#2861}{\htmlId{2861}{\htmlClass{Bound}{\text{utxo}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#2868}{\htmlId{2868}{\htmlClass{Bound}{\text{fees}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#2875}{\htmlId{2875}{\htmlClass{Bound}{\text{deposits}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#2886}{\htmlId{2886}{\htmlClass{Bound}{\text{donations}}}}\, \end{pmatrix}
    \\ \,\href{Ledger.Conway.Conformance.Epoch.html#2905}{\htmlId{2905}{\htmlClass{Bound}{\text{govSt}}}}\,
    \\ \begin{pmatrix} \begin{pmatrix} \,\href{Ledger.Conway.Conformance.Epoch.html#2921}{\htmlId{2921}{\htmlClass{Bound}{\text{voteDelegs}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#2934}{\htmlId{2934}{\htmlClass{Bound}{\text{stakeDelegs}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#2948}{\htmlId{2948}{\htmlClass{Bound}{\text{rewards}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#2958}{\htmlId{2958}{\htmlClass{Bound}{\text{deposits&#39;}}}}\, \end{pmatrix} \\ \,\href{Ledger.Conway.Conformance.Epoch.html#2973}{\htmlId{2973}{\htmlClass{Bound}{\text{pState}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#2982}{\htmlId{2982}{\htmlClass{Bound}{\text{gState}}}}\, \end{pmatrix} \end{pmatrix}
  \\ \,\href{Ledger.Conway.Conformance.Epoch.html#3000}{\htmlId{3000}{\htmlClass{Bound}{\text{es}}}}\,
  \\ \,\href{Ledger.Conway.Conformance.Epoch.html#3007}{\htmlId{3007}{\htmlClass{Bound}{\text{fut}}}}\,
  \end{pmatrix}$</a> <a id="3017" class="Symbol">=</a>
  <a class="AgdaKaTeX">$\begin{pmatrix} \begin{pmatrix} \,\href{Prelude.html#3280}{\htmlId{3025}{\htmlClass{Function}{\text{posPart}}}}\, \,\htmlId{3033}{\htmlClass{Symbol}{\text{(}}}\,\,\href{Ledger.Conway.Conformance.Epoch.html#357}{\htmlId{3034}{\htmlClass{InductiveConstructor}{\text{pos}}}}\, \,\href{Ledger.Conway.Conformance.Epoch.html#2823}{\htmlId{3038}{\htmlClass{Bound}{\text{treasury}}}}\, \,\href{Class.HasAdd.Core.html#162}{\htmlId{3047}{\htmlClass{Field Operator}{\text{+}}}}\, \,\href{Ledger.Conway.Specification.Rewards.html#6286}{\htmlId{3049}{\htmlClass{Function}{\text{Δt}}}}\, \,\href{Class.HasAdd.Core.html#162}{\htmlId{3052}{\htmlClass{Field Operator}{\text{+}}}}\, \,\href{Ledger.Conway.Conformance.Epoch.html#357}{\htmlId{3054}{\htmlClass{InductiveConstructor}{\text{pos}}}}\, \,\href{Ledger.Conway.Conformance.Epoch.html#3432}{\htmlId{3058}{\htmlClass{Function}{\text{unregRU&#39;}}}}\,\,\htmlId{3066}{\htmlClass{Symbol}{\text{)}}}\,
    \\ \,\href{Prelude.html#3280}{\htmlId{3074}{\htmlClass{Function}{\text{posPart}}}}\, \,\htmlId{3082}{\htmlClass{Symbol}{\text{(}}}\,\,\href{Ledger.Conway.Conformance.Epoch.html#357}{\htmlId{3083}{\htmlClass{InductiveConstructor}{\text{pos}}}}\, \,\href{Ledger.Conway.Conformance.Epoch.html#2834}{\htmlId{3087}{\htmlClass{Bound}{\text{reserves}}}}\, \,\href{Class.HasAdd.Core.html#162}{\htmlId{3096}{\htmlClass{Field Operator}{\text{+}}}}\, \,\href{Ledger.Conway.Specification.Rewards.html#6289}{\htmlId{3098}{\htmlClass{Function}{\text{Δr}}}}\,\,\htmlId{3100}{\htmlClass{Symbol}{\text{)}}}\, \end{pmatrix}
  \\ \,\href{Ledger.Conway.Conformance.Epoch.html#2850}{\htmlId{3108}{\htmlClass{Bound}{\text{ss}}}}\,
  \\ \begin{pmatrix} \begin{pmatrix} \,\href{Ledger.Conway.Conformance.Epoch.html#2861}{\htmlId{3119}{\htmlClass{Bound}{\text{utxo}}}}\, \\ \,\href{Prelude.html#3280}{\htmlId{3126}{\htmlClass{Function}{\text{posPart}}}}\, \,\htmlId{3134}{\htmlClass{Symbol}{\text{(}}}\,\,\href{Ledger.Conway.Conformance.Epoch.html#357}{\htmlId{3135}{\htmlClass{InductiveConstructor}{\text{pos}}}}\, \,\href{Ledger.Conway.Conformance.Epoch.html#2868}{\htmlId{3139}{\htmlClass{Bound}{\text{fees}}}}\, \,\href{Class.HasAdd.Core.html#162}{\htmlId{3144}{\htmlClass{Field Operator}{\text{+}}}}\, \,\href{Ledger.Conway.Specification.Rewards.html#6292}{\htmlId{3146}{\htmlClass{Function}{\text{Δf}}}}\,\,\htmlId{3148}{\htmlClass{Symbol}{\text{)}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#2875}{\htmlId{3152}{\htmlClass{Bound}{\text{deposits}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#2886}{\htmlId{3163}{\htmlClass{Bound}{\text{donations}}}}\, \end{pmatrix}
    \\ \,\href{Ledger.Conway.Conformance.Epoch.html#2905}{\htmlId{3181}{\htmlClass{Bound}{\text{govSt}}}}\,
    \\ \begin{pmatrix} \begin{pmatrix} \,\href{Ledger.Conway.Conformance.Epoch.html#2921}{\htmlId{3197}{\htmlClass{Bound}{\text{voteDelegs}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#2934}{\htmlId{3210}{\htmlClass{Bound}{\text{stakeDelegs}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#2948}{\htmlId{3224}{\htmlClass{Bound}{\text{rewards}}}}\, \,\href{Axiom.Set.Map.Dec.html#2149}{\htmlId{3232}{\htmlClass{Function Operator}{\text{∪⁺}}}}\, \,\href{Ledger.Conway.Conformance.Epoch.html#3364}{\htmlId{3235}{\htmlClass{Function}{\text{regRU}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#2958}{\htmlId{3243}{\htmlClass{Bound}{\text{deposits&#39;}}}}\, \end{pmatrix} \\ \,\href{Ledger.Conway.Conformance.Epoch.html#2973}{\htmlId{3257}{\htmlClass{Bound}{\text{pState}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#2982}{\htmlId{3266}{\htmlClass{Bound}{\text{gState}}}}\, \end{pmatrix} \end{pmatrix}
  \\ \,\href{Ledger.Conway.Conformance.Epoch.html#3000}{\htmlId{3281}{\htmlClass{Bound}{\text{es}}}}\,
  \\ \,\href{Ledger.Conway.Conformance.Epoch.html#3007}{\htmlId{3288}{\htmlClass{Bound}{\text{fut}}}}\, \end{pmatrix}$</a>
  <a id="3296" class="Keyword">where</a>
    <a id="3306" class="Keyword">open</a> <a id="3311" href="Ledger.Conway.Specification.Rewards.html#6249" class="Module">RewardUpdate</a> <a id="3324" href="Ledger.Conway.Conformance.Epoch.html#2804" class="Bound">rewardUpdate</a> <a id="3337" class="Keyword">using</a> <a id="3343" class="Symbol">(</a><a id="3344" href="Ledger.Conway.Specification.Rewards.html#6286" class="Field">Δt</a><a id="3346" class="Symbol">;</a> <a id="3348" href="Ledger.Conway.Specification.Rewards.html#6289" class="Field">Δr</a><a id="3350" class="Symbol">;</a> <a id="3352" href="Ledger.Conway.Specification.Rewards.html#6292" class="Field">Δf</a><a id="3354" class="Symbol">;</a> <a id="3356" href="Ledger.Conway.Specification.Rewards.html#6312" class="Field">rs</a><a id="3358" class="Symbol">)</a>
    <a id="3364" href="Ledger.Conway.Conformance.Epoch.html#3364" class="Function">regRU</a>     <a id="3374" class="Symbol">=</a> <a id="3376" href="Ledger.Conway.Specification.Rewards.html#6312" class="Function">rs</a> <a id="3379" href="Axiom.Set.Map.html#13536" class="Function Operator">∣</a> <a id="3381" href="Class.IsSet.html#916" class="Function">dom</a> <a id="3385" href="Ledger.Conway.Conformance.Epoch.html#2948" class="Bound">rewards</a>
    <a id="3397" href="Ledger.Conway.Conformance.Epoch.html#3397" class="Function">unregRU</a>   <a id="3407" class="Symbol">=</a> <a id="3409" href="Ledger.Conway.Specification.Rewards.html#6312" class="Function">rs</a> <a id="3412" href="Axiom.Set.Map.html#13606" class="Function Operator">∣</a> <a id="3414" href="Class.IsSet.html#916" class="Function">dom</a> <a id="3418" href="Ledger.Conway.Conformance.Epoch.html#2948" class="Bound">rewards</a> <a id="3426" href="Axiom.Set.Map.html#13606" class="Function Operator">ᶜ</a>
    <a id="3432" href="Ledger.Conway.Conformance.Epoch.html#3432" class="Function">unregRU&#39;</a>  <a id="3442" class="Symbol">=</a> <a id="3444" href="abstract-set-theory.FiniteSetTheory.html#4373" class="Function">∑[</a> <a id="3447" href="Ledger.Conway.Conformance.Epoch.html#3447" class="Bound">x</a> <a id="3449" href="abstract-set-theory.FiniteSetTheory.html#4373" class="Function">←</a> <a id="3451" href="Ledger.Conway.Conformance.Epoch.html#3397" class="Function">unregRU</a> <a id="3459" href="abstract-set-theory.FiniteSetTheory.html#4373" class="Function">]</a> <a id="3461" href="Ledger.Conway.Conformance.Epoch.html#3447" class="Bound">x</a>

<a id="3464" class="Keyword">opaque</a>
  <a id="calculatePoolDelegatedStake"></a><a id="3473" href="Ledger.Conway.Conformance.Epoch.html#3473" class="Function">calculatePoolDelegatedStake</a> <a id="3501" class="Symbol">:</a> <a id="3503" href="Ledger.Conway.Specification.Rewards.html#6472" class="Record">Snapshot</a> <a id="3512" class="Symbol">→</a> <a id="3514" href="Ledger.Conway.Conformance.Epoch.html#1431" class="Function">PoolDelegatedStake</a>
  <a id="3535" href="Ledger.Conway.Conformance.Epoch.html#3473" class="Function">calculatePoolDelegatedStake</a> <a id="3563" href="Ledger.Conway.Conformance.Epoch.html#3563" class="Bound">ss</a> <a id="3566" class="Symbol">=</a>
      <a id="3574" class="Comment">-- Shelley spec: the output map must contain keys appearing in both</a>
      <a id="3648" class="Comment">-- sd and the pool parameters.</a>
      <a id="3685" href="Ledger.Conway.Conformance.Epoch.html#3941" class="Function">sd</a> <a id="3688" href="Axiom.Set.Map.html#13536" class="Function Operator">∣</a> <a id="3690" href="Class.IsSet.html#916" class="Function">dom</a> <a id="3694" class="Symbol">(</a><a id="3695" href="Ledger.Conway.Conformance.Epoch.html#3563" class="Bound">ss</a> <a id="3698" class="Symbol">.</a><a id="3699" href="Ledger.Conway.Specification.Rewards.html#6561" class="Field">pools</a><a id="3704" class="Symbol">)</a>
    <a id="3710" class="Keyword">where</a>
      <a id="3722" class="Keyword">open</a> <a id="3727" href="Ledger.Conway.Specification.Rewards.html#6472" class="Module">Snapshot</a>

      <a id="3743" class="Comment">-- stake credentials delegating to each pool</a>
      <a id="3794" href="Ledger.Conway.Conformance.Epoch.html#3794" class="Function">stakeCredentialsPerPool</a> <a id="3818" class="Symbol">:</a> <a id="3820" href="Axiom.Set.Rel.html#1312" class="Function">Rel</a> <a id="3824" href="Ledger.Core.Specification.Crypto.html#1386" class="Function">KeyHash</a> <a id="3832" href="Ledger.Core.Specification.Address.html#259" class="Datatype">Credential</a>
      <a id="3849" href="Ledger.Conway.Conformance.Epoch.html#3794" class="Function">stakeCredentialsPerPool</a> <a id="3873" class="Symbol">=</a> <a id="3875" class="Symbol">(</a><a id="3876" href="Ledger.Conway.Specification.Certs.html#1898" class="Field">StakeDelegsOf</a> <a id="3890" href="Ledger.Conway.Conformance.Epoch.html#3563" class="Bound">ss</a> <a id="3893" href="Axiom.Set.Map.html#2293" class="Function Operator">ˢ</a><a id="3894" class="Symbol">)</a> <a id="3896" href="Axiom.Set.Rel.html#1608" class="Function Operator">⁻¹ʳ</a>

      <a id="3907" class="Comment">-- delegated stake per pool</a>
      <a id="3941" href="Ledger.Conway.Conformance.Epoch.html#3941" class="Function">sd</a> <a id="3944" class="Symbol">:</a> <a id="3946" href="Ledger.Core.Specification.Crypto.html#1386" class="Function">KeyHash</a> <a id="3954" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="3956" href="Ledger.Prelude.Base.html#154" class="Function">Coin</a>
      <a id="3967" href="Ledger.Conway.Conformance.Epoch.html#3941" class="Function">sd</a> <a id="3970" class="Symbol">=</a> <a id="3972" href="Axiom.Set.Map.Dec.html#2227" class="Function">aggregate₊</a> <a id="3983" class="Symbol">((</a><a id="3985" href="Ledger.Conway.Conformance.Epoch.html#3794" class="Function">stakeCredentialsPerPool</a> <a id="4009" href="abstract-set-theory.FiniteSetTheory.html#3111" class="Function Operator">∘ʳ</a> <a id="4012" class="Symbol">(</a><a id="4013" href="Ledger.Conway.Specification.Certs.html#1814" class="Field">StakeOf</a> <a id="4021" href="Ledger.Conway.Conformance.Epoch.html#3563" class="Bound">ss</a> <a id="4024" href="Axiom.Set.Map.html#2293" class="Function Operator">ˢ</a><a id="4025" class="Symbol">))</a> <a id="4028" href="abstract-set-theory.FiniteSetTheory.html#2921" class="Function Operator">ᶠˢ</a><a id="4030" class="Symbol">)</a>


<a id="4034" class="Keyword">private</a> <a id="4042" class="Keyword">variable</a>
  <a id="4053" href="Ledger.Conway.Conformance.Epoch.html#4053" class="Generalizable">nes</a> <a id="4057" href="Ledger.Conway.Conformance.Epoch.html#4057" class="Generalizable">nes&#39;</a> <a id="4062" class="Symbol">:</a> <a id="4064" href="Ledger.Conway.Conformance.Epoch.html#1501" class="Record">NewEpochState</a>
  <a id="4080" href="Ledger.Conway.Conformance.Epoch.html#4080" class="Generalizable">e</a> <a id="4082" href="Ledger.Conway.Conformance.Epoch.html#4082" class="Generalizable">lastEpoch</a> <a id="4092" class="Symbol">:</a> <a id="4094" href="Ledger.Core.Specification.Epoch.html#646" class="Function">Epoch</a>
  <a id="4102" href="Ledger.Conway.Conformance.Epoch.html#4102" class="Generalizable">fut</a> <a id="4106" href="Ledger.Conway.Conformance.Epoch.html#4106" class="Generalizable">fut&#39;</a> <a id="4111" class="Symbol">:</a> <a id="4113" href="Ledger.Conway.Specification.Ratify.html#3531" class="Record">RatifyState</a>
  <a id="4127" href="Ledger.Conway.Conformance.Epoch.html#4127" class="Generalizable">eps</a> <a id="4131" href="Ledger.Conway.Conformance.Epoch.html#4131" class="Generalizable">eps&#39;</a> <a id="4136" href="Ledger.Conway.Conformance.Epoch.html#4136" class="Generalizable">eps&#39;&#39;</a> <a id="4142" class="Symbol">:</a> <a id="4144" href="Ledger.Conway.Conformance.Epoch.html#1240" class="Record">EpochState</a>
  <a id="4157" href="Ledger.Conway.Conformance.Epoch.html#4157" class="Generalizable">ls</a> <a id="4160" class="Symbol">:</a> <a id="4162" href="Ledger.Conway.Conformance.Ledger.html#779" class="Record">LState</a>
  <a id="4171" href="Ledger.Conway.Conformance.Epoch.html#4171" class="Generalizable">acnt</a> <a id="4176" class="Symbol">:</a> <a id="4178" href="Ledger.Conway.Specification.PParams.html#720" class="Record">Acnt</a>
  <a id="4185" href="Ledger.Conway.Conformance.Epoch.html#4185" class="Generalizable">es₀</a> <a id="4189" class="Symbol">:</a> <a id="4191" href="Ledger.Conway.Specification.Enact.html#448" class="Record">EnactState</a>
  <a id="4204" href="Ledger.Conway.Conformance.Epoch.html#4204" class="Generalizable">mark</a> <a id="4209" href="Ledger.Conway.Conformance.Epoch.html#4209" class="Generalizable">set</a> <a id="4213" href="Ledger.Conway.Conformance.Epoch.html#4213" class="Generalizable">go</a> <a id="4216" class="Symbol">:</a> <a id="4218" href="Ledger.Conway.Specification.Rewards.html#6472" class="Record">Snapshot</a>
  <a id="4229" href="Ledger.Conway.Conformance.Epoch.html#4229" class="Generalizable">feeSS</a> <a id="4235" class="Symbol">:</a> <a id="4237" href="Ledger.Prelude.Base.html#154" class="Function">Coin</a>
  <a id="4244" href="Ledger.Conway.Conformance.Epoch.html#4244" class="Generalizable">lstate</a> <a id="4251" class="Symbol">:</a> <a id="4253" href="Ledger.Conway.Conformance.Ledger.html#779" class="Record">LState</a>
  <a id="4262" href="Ledger.Conway.Conformance.Epoch.html#4262" class="Generalizable">ss</a> <a id="4265" href="Ledger.Conway.Conformance.Epoch.html#4265" class="Generalizable">ss&#39;</a> <a id="4269" class="Symbol">:</a> <a id="4271" href="Ledger.Conway.Specification.Rewards.html#7719" class="Record">Snapshots</a>
  <a id="4283" href="Ledger.Conway.Conformance.Epoch.html#4283" class="Generalizable">ru</a> <a id="4286" class="Symbol">:</a> <a id="4288" href="Ledger.Conway.Specification.Rewards.html#6249" class="Record">RewardUpdate</a>
  <a id="4303" href="Ledger.Conway.Conformance.Epoch.html#4303" class="Generalizable">mru</a> <a id="4307" class="Symbol">:</a> <a id="4309" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="4315" href="Ledger.Conway.Specification.Rewards.html#6249" class="Record">RewardUpdate</a>
  <a id="4330" href="Ledger.Conway.Conformance.Epoch.html#4330" class="Generalizable">certState&#39;</a> <a id="4341" class="Symbol">:</a> <a id="4343" href="Ledger.Conway.Conformance.Certs.html#962" class="Record">CertState</a>

<a id="4354" class="Keyword">data</a> <a id="_⊢_⇀⦇_,EPOCH⦈_"></a><a id="4359" href="Ledger.Conway.Conformance.Epoch.html#4359" class="Datatype Operator">_⊢_⇀⦇_,EPOCH⦈_</a> <a id="4374" class="Symbol">:</a> <a id="4376" href="Agda.Builtin.Unit.html#175" class="Record">⊤</a> <a id="4378" class="Symbol">→</a> <a id="4380" href="Ledger.Conway.Conformance.Epoch.html#1240" class="Record">EpochState</a> <a id="4391" class="Symbol">→</a> <a id="4393" href="Ledger.Core.Specification.Epoch.html#646" class="Function">Epoch</a> <a id="4399" class="Symbol">→</a> <a id="4401" href="Ledger.Conway.Conformance.Epoch.html#1240" class="Record">EpochState</a> <a id="4412" class="Symbol">→</a> <a id="4414" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="4419" class="Keyword">where</a>

  <a id="_⊢_⇀⦇_,EPOCH⦈_.EPOCH"></a><a id="4428" href="Ledger.Conway.Conformance.Epoch.html#4428" class="InductiveConstructor">EPOCH</a> <a id="4434" class="Symbol">:</a> <a id="4436" class="Keyword">let</a>
      <a id="4446" class="Keyword">open</a> <a id="4451" href="Ledger.Conway.Conformance.Ledger.html#779" class="Module">LState</a> <a id="4458" href="Ledger.Conway.Conformance.Epoch.html#4157" class="Generalizable">ls</a>
      <a id="4467" class="Keyword">open</a> <a id="4472" href="Ledger.Conway.Conformance.Certs.html#962" class="Module">CertState</a> <a id="4482" href="Ledger.Conway.Conformance.Ledger.html#887" class="Function">certState</a>
      <a id="4498" class="Keyword">open</a> <a id="4503" href="Ledger.Conway.Specification.Ratify.html#3531" class="Module">RatifyState</a> <a id="4515" href="Ledger.Conway.Conformance.Epoch.html#4102" class="Generalizable">fut</a> <a id="4519" class="Keyword">renaming</a> <a id="4528" class="Symbol">(</a><a id="4529" href="Ledger.Conway.Specification.Ratify.html#3568" class="Field">es</a> <a id="4532" class="Symbol">to</a> <a id="4535" class="Field">esW</a><a id="4538" class="Symbol">)</a>
      <a id="4546" class="Keyword">open</a> <a id="4551" href="Ledger.Conway.Specification.Utxo.html#1230" class="Module">UTxOState</a>
      <a id="4567" class="Keyword">open</a> <a id="4572" href="Ledger.Conway.Specification.Certs.html#3909" class="Module">PState</a><a id="4578" class="Symbol">;</a> <a id="4580" class="Keyword">open</a> <a id="4585" href="Ledger.Conway.Conformance.Certs.html#608" class="Module">DState</a><a id="4591" class="Symbol">;</a> <a id="4593" class="Keyword">open</a> <a id="4598" href="Ledger.Conway.Conformance.Certs.html#794" class="Module">GState</a>
      <a id="4611" class="Keyword">open</a> <a id="4616" href="Ledger.Conway.Specification.PParams.html#720" class="Module">Acnt</a><a id="4620" class="Symbol">;</a> <a id="4622" class="Keyword">open</a> <a id="4627" href="Ledger.Conway.Specification.Enact.html#448" class="Module">EnactState</a><a id="4637" class="Symbol">;</a> <a id="4639" class="Keyword">open</a> <a id="4644" href="Ledger.Conway.Specification.Gov.Actions.html#3822" class="Module">GovActionState</a>

      <a id="4666" href="Ledger.Conway.Conformance.Epoch.html#4666" class="Bound">es</a> <a id="4669" class="Symbol">:</a> <a id="4671" href="Ledger.Conway.Specification.Enact.html#448" class="Record">EnactState</a>
      <a id="4688" href="Ledger.Conway.Conformance.Epoch.html#4666" class="Bound">es</a> <a id="4691" class="Symbol">=</a> <a id="4693" class="Keyword">record</a> <a id="4700" href="Ledger.Conway.Conformance.Epoch.html#4535" class="Function">esW</a> <a id="4704" class="Symbol">{</a> <a id="4706" href="Ledger.Conway.Specification.Enact.html#700" class="Field">withdrawals</a> <a id="4718" class="Symbol">=</a> <a id="4720" href="Class.HasEmptySet.html#287" class="Field">∅</a> <a id="4722" class="Symbol">}</a>

      <a id="4731" href="Ledger.Conway.Conformance.Epoch.html#4731" class="Bound">tmpGovSt</a> <a id="4740" class="Symbol">=</a> <a id="4742" href="Data.List.Base.html#10389" class="Function">filter</a> <a id="4749" class="Symbol">(λ</a> <a id="4752" href="Ledger.Conway.Conformance.Epoch.html#4752" class="Bound">x</a> <a id="4754" class="Symbol">→</a> <a id="4756" href="Class.Decidable.Core.html#470" class="Function Operator">¿</a> <a id="4758" href="Data.Product.Base.html#636" class="Field">proj₁</a> <a id="4764" href="Ledger.Conway.Conformance.Epoch.html#4752" class="Bound">x</a> <a id="4766" href="Class.IsSet.html#462" class="Function Operator">∉</a> <a id="4768" href="abstract-set-theory.FiniteSetTheory.html#519" class="Function">mapˢ</a> <a id="4773" href="Data.Product.Base.html#636" class="Field">proj₁</a> <a id="4779" href="Ledger.Conway.Specification.Ratify.html#3594" class="Function">removed</a> <a id="4787" href="Class.Decidable.Core.html#470" class="Function Operator">¿</a><a id="4788" class="Symbol">)</a> <a id="4790" href="Ledger.Conway.Conformance.Ledger.html#861" class="Function">govSt</a>

      <a id="4803" href="Ledger.Conway.Conformance.Epoch.html#4803" class="Bound">orphans</a> <a id="4811" class="Symbol">:</a> <a id="4813" href="abstract-set-theory.FiniteSetTheory.html#488" class="Function Operator">ℙ</a> <a id="4815" class="Symbol">(</a><a id="4816" href="Ledger.Conway.Specification.Gov.Actions.html#1980" class="Function">GovActionID</a> <a id="4828" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="4830" href="Ledger.Conway.Specification.Gov.Actions.html#3822" class="Record">GovActionState</a><a id="4844" class="Symbol">)</a>
      <a id="4852" href="Ledger.Conway.Conformance.Epoch.html#4803" class="Bound">orphans</a>  <a id="4861" class="Symbol">=</a> <a id="4863" href="Axiom.Set.html#5903" class="Function">fromList</a> <a id="4872" class="Symbol">(</a><a id="4873" href="Ledger.Conway.Specification.Epoch.html#13210" class="Function">getOrphans</a> <a id="4884" href="Ledger.Conway.Conformance.Epoch.html#4666" class="Bound">es</a> <a id="4887" href="Ledger.Conway.Conformance.Epoch.html#4731" class="Bound">tmpGovSt</a><a id="4895" class="Symbol">)</a>

      <a id="4904" href="Ledger.Conway.Conformance.Epoch.html#4904" class="Bound">removed&#39;</a> <a id="4913" class="Symbol">:</a> <a id="4915" href="abstract-set-theory.FiniteSetTheory.html#488" class="Function Operator">ℙ</a> <a id="4917" class="Symbol">(</a><a id="4918" href="Ledger.Conway.Specification.Gov.Actions.html#1980" class="Function">GovActionID</a> <a id="4930" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="4932" href="Ledger.Conway.Specification.Gov.Actions.html#3822" class="Record">GovActionState</a><a id="4946" class="Symbol">)</a>
      <a id="4954" href="Ledger.Conway.Conformance.Epoch.html#4904" class="Bound">removed&#39;</a> <a id="4963" class="Symbol">=</a> <a id="4965" href="Ledger.Conway.Specification.Ratify.html#3594" class="Function">removed</a> <a id="4973" href="Axiom.Set.html#9137" class="Function Operator">∪</a> <a id="4975" href="Ledger.Conway.Conformance.Epoch.html#4803" class="Bound">orphans</a>

      <a id="4990" href="Ledger.Conway.Conformance.Epoch.html#4990" class="Bound">govSt&#39;</a> <a id="4997" class="Symbol">=</a> <a id="4999" href="Data.List.Base.html#10389" class="Function">filter</a> <a id="5006" class="Symbol">(λ</a> <a id="5009" href="Ledger.Conway.Conformance.Epoch.html#5009" class="Bound">x</a> <a id="5011" class="Symbol">→</a> <a id="5013" href="Class.Decidable.Core.html#470" class="Function Operator">¿</a> <a id="5015" href="Data.Product.Base.html#636" class="Field">proj₁</a> <a id="5021" href="Ledger.Conway.Conformance.Epoch.html#5009" class="Bound">x</a> <a id="5023" href="Class.IsSet.html#462" class="Function Operator">∉</a> <a id="5025" href="abstract-set-theory.FiniteSetTheory.html#519" class="Function">mapˢ</a> <a id="5030" href="Data.Product.Base.html#636" class="Field">proj₁</a> <a id="5036" href="Ledger.Conway.Conformance.Epoch.html#4904" class="Bound">removed&#39;</a> <a id="5045" href="Class.Decidable.Core.html#470" class="Function Operator">¿</a><a id="5046" class="Symbol">)</a> <a id="5048" href="Ledger.Conway.Conformance.Ledger.html#861" class="Function">govSt</a>

      <a id="5061" href="Ledger.Conway.Conformance.Epoch.html#5061" class="Bound">removedGovActions</a> <a id="5079" class="Symbol">:</a> <a id="5081" href="abstract-set-theory.FiniteSetTheory.html#488" class="Function Operator">ℙ</a> <a id="5083" class="Symbol">(</a><a id="5084" href="Ledger.Core.Specification.Address.html#1313" class="Record">RewardAddress</a> <a id="5098" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="5100" href="Ledger.Conway.Specification.Certs.html#571" class="Datatype">DepositPurpose</a> <a id="5115" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="5117" href="Ledger.Prelude.Base.html#154" class="Function">Coin</a><a id="5121" class="Symbol">)</a>
      <a id="5129" href="Ledger.Conway.Conformance.Epoch.html#5061" class="Bound">removedGovActions</a> <a id="5147" class="Symbol">=</a>
        <a id="5157" href="Function.Base.html#1657" class="Function">flip</a> <a id="5162" href="Axiom.Set.html#7207" class="Function">concatMapˢ</a> <a id="5173" href="Ledger.Conway.Conformance.Epoch.html#4904" class="Bound">removed&#39;</a> <a id="5182" class="Symbol">λ</a> <a id="5184" class="Symbol">(</a><a id="5185" href="Ledger.Conway.Conformance.Epoch.html#5185" class="Bound">gaid</a> <a id="5190" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5192" href="Ledger.Conway.Conformance.Epoch.html#5192" class="Bound">gaSt</a><a id="5196" class="Symbol">)</a> <a id="5198" class="Symbol">→</a>
          <a id="5210" href="abstract-set-theory.FiniteSetTheory.html#519" class="Function">mapˢ</a>
            <a id="5227" class="Symbol">(</a><a id="5228" href="Ledger.Conway.Specification.Gov.Actions.html#3889" class="Field">returnAddr</a> <a id="5239" href="Ledger.Conway.Conformance.Epoch.html#5192" class="Bound">gaSt</a> <a id="5244" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,_</a><a id="5246" class="Symbol">)</a>
            <a id="5260" class="Symbol">((</a><a id="5262" href="Ledger.Conway.Conformance.Ledger.html#834" class="Function">utxoSt</a> <a id="5269" class="Symbol">.</a><a id="5270" href="Ledger.Conway.Specification.Utxo.html#1338" class="Field">deposits</a> <a id="5279" href="Axiom.Set.Map.html#13536" class="Function Operator">∣</a> <a id="5281" href="Class.HasSingleton.html#288" class="Field Operator">❴</a> <a id="5283" href="Ledger.Conway.Specification.Certs.html#760" class="InductiveConstructor">GovActionDeposit</a> <a id="5300" href="Ledger.Conway.Conformance.Epoch.html#5185" class="Bound">gaid</a> <a id="5305" href="Class.HasSingleton.html#288" class="Field Operator">❵</a><a id="5306" class="Symbol">)</a> <a id="5308" href="Axiom.Set.Map.html#2293" class="Function Operator">ˢ</a><a id="5309" class="Symbol">)</a>

      <a id="5318" href="Ledger.Conway.Conformance.Epoch.html#5318" class="Bound">govActionReturns</a> <a id="5335" class="Symbol">:</a> <a id="5337" href="Ledger.Core.Specification.Address.html#1313" class="Record">RewardAddress</a> <a id="5351" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="5353" href="Ledger.Prelude.Base.html#154" class="Function">Coin</a>
      <a id="5364" href="Ledger.Conway.Conformance.Epoch.html#5318" class="Bound">govActionReturns</a> <a id="5381" class="Symbol">=</a>
        <a id="5391" href="Axiom.Set.Map.Dec.html#2227" class="Function">aggregate₊</a> <a id="5402" class="Symbol">(</a><a id="5403" href="abstract-set-theory.FiniteSetTheory.html#519" class="Function">mapˢ</a> <a id="5408" class="Symbol">(λ</a> <a id="5411" class="Symbol">(</a><a id="5412" href="Ledger.Conway.Conformance.Epoch.html#5412" class="Bound">a</a> <a id="5414" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5416" class="Symbol">_</a> <a id="5418" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5420" href="Ledger.Conway.Conformance.Epoch.html#5420" class="Bound">d</a><a id="5421" class="Symbol">)</a> <a id="5423" class="Symbol">→</a> <a id="5425" href="Ledger.Conway.Conformance.Epoch.html#5412" class="Bound">a</a> <a id="5427" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5429" href="Ledger.Conway.Conformance.Epoch.html#5420" class="Bound">d</a><a id="5430" class="Symbol">)</a> <a id="5432" href="Ledger.Conway.Conformance.Epoch.html#5061" class="Bound">removedGovActions</a> <a id="5450" href="abstract-set-theory.FiniteSetTheory.html#2921" class="Function Operator">ᶠˢ</a><a id="5452" class="Symbol">)</a>

      <a id="5461" href="Ledger.Conway.Conformance.Epoch.html#5461" class="Bound">trWithdrawals</a>   <a id="5477" class="Symbol">=</a> <a id="5479" href="Ledger.Conway.Conformance.Epoch.html#4535" class="Function">esW</a> <a id="5483" class="Symbol">.</a><a id="5484" href="Ledger.Conway.Specification.Enact.html#700" class="Field">withdrawals</a>
      <a id="5502" href="Ledger.Conway.Conformance.Epoch.html#5502" class="Bound">totWithdrawals</a>  <a id="5518" class="Symbol">=</a> <a id="5520" href="abstract-set-theory.FiniteSetTheory.html#4373" class="Function">∑[</a> <a id="5523" href="Ledger.Conway.Conformance.Epoch.html#5523" class="Bound">x</a> <a id="5525" href="abstract-set-theory.FiniteSetTheory.html#4373" class="Function">←</a> <a id="5527" href="Ledger.Conway.Conformance.Epoch.html#5461" class="Bound">trWithdrawals</a> <a id="5541" href="abstract-set-theory.FiniteSetTheory.html#4373" class="Function">]</a> <a id="5543" href="Ledger.Conway.Conformance.Epoch.html#5523" class="Bound">x</a>

      <a id="5552" href="Ledger.Conway.Conformance.Epoch.html#5552" class="Bound">retired</a>    <a id="5563" class="Symbol">=</a> <a id="5565" class="Symbol">(</a><a id="5566" href="Ledger.Conway.Conformance.Certs.html#1041" class="Function">pState</a> <a id="5573" class="Symbol">.</a><a id="5574" href="Ledger.Conway.Specification.Certs.html#3985" class="Field">retiring</a><a id="5582" class="Symbol">)</a> <a id="5584" href="Axiom.Set.Map.html#17957" class="Function Operator">⁻¹</a> <a id="5587" href="Ledger.Conway.Conformance.Epoch.html#4080" class="Generalizable">e</a>
      <a id="5595" href="Ledger.Conway.Conformance.Epoch.html#5595" class="Bound">payout</a>     <a id="5606" class="Symbol">=</a> <a id="5608" href="Ledger.Conway.Conformance.Epoch.html#5318" class="Bound">govActionReturns</a> <a id="5625" href="Axiom.Set.Map.Dec.html#2149" class="Function Operator">∪⁺</a> <a id="5628" href="Ledger.Conway.Conformance.Epoch.html#5461" class="Bound">trWithdrawals</a>
      <a id="5648" href="Ledger.Conway.Conformance.Epoch.html#5648" class="Bound">refunds</a>    <a id="5659" class="Symbol">=</a> <a id="5661" href="Axiom.Set.Map.html#17518" class="Function">pullbackMap</a> <a id="5673" href="Ledger.Conway.Conformance.Epoch.html#5595" class="Bound">payout</a> <a id="5680" href="Ledger.Conway.Specification.Epoch.html#5489" class="Function">toRewardAddress</a> <a id="5696" class="Symbol">(</a><a id="5697" href="Class.IsSet.html#916" class="Function">dom</a> <a id="5701" class="Symbol">(</a><a id="5702" href="Ledger.Conway.Conformance.Certs.html#1021" class="Function">dState</a> <a id="5709" class="Symbol">.</a><a id="5710" href="Ledger.Conway.Conformance.Certs.html#735" class="Field">rewards</a><a id="5717" class="Symbol">))</a>
      <a id="5726" href="Ledger.Conway.Conformance.Epoch.html#5726" class="Bound">unclaimed</a>  <a id="5737" class="Symbol">=</a> <a id="5739" href="Ledger.Prelude.HasCoin.html#171" class="Field">getCoin</a> <a id="5747" href="Ledger.Conway.Conformance.Epoch.html#5595" class="Bound">payout</a> <a id="5754" href="Interface.TypeClasses.HasSubtract.html#223" class="Field Operator">-</a> <a id="5756" href="Ledger.Prelude.HasCoin.html#171" class="Field">getCoin</a> <a id="5764" href="Ledger.Conway.Conformance.Epoch.html#5648" class="Bound">refunds</a>
      <a id="5778" href="Ledger.Conway.Conformance.Epoch.html#5778" class="Bound">vDeposits</a>  <a id="5789" class="Symbol">=</a> <a id="5791" href="Ledger.Conway.Conformance.Certs.html#1061" class="Function">gState</a> <a id="5798" class="Symbol">.</a><a id="5799" href="Ledger.Conway.Conformance.Certs.html#932" class="Field">deposits</a>

      <a id="5815" href="Ledger.Conway.Conformance.Epoch.html#5815" class="Bound">dState&#39;</a> <a id="5823" class="Symbol">:</a> <a id="5825" href="Ledger.Conway.Conformance.Certs.html#608" class="Record">DState</a>
      <a id="5838" href="Ledger.Conway.Conformance.Epoch.html#5815" class="Bound">dState&#39;</a> <a id="5846" class="Symbol">=</a> <a id="5848" class="Keyword">record</a> <a id="5855" href="Ledger.Conway.Conformance.Certs.html#1021" class="Function">dState</a> <a id="5862" class="Symbol">{</a> <a id="5864" href="Ledger.Conway.Conformance.Certs.html#735" class="Field">rewards</a> <a id="5872" class="Symbol">=</a> <a id="5874" href="Ledger.Conway.Conformance.Certs.html#1021" class="Function">dState</a> <a id="5881" class="Symbol">.</a><a id="5882" href="Ledger.Conway.Conformance.Certs.html#735" class="Field">rewards</a> <a id="5890" href="Axiom.Set.Map.Dec.html#2149" class="Function Operator">∪⁺</a> <a id="5893" href="Ledger.Conway.Conformance.Epoch.html#5648" class="Bound">refunds</a> <a id="5901" class="Symbol">}</a>

      <a id="5910" href="Ledger.Conway.Conformance.Epoch.html#5910" class="Bound">pState&#39;</a> <a id="5918" class="Symbol">:</a> <a id="5920" href="Ledger.Conway.Specification.Certs.html#3909" class="Record">PState</a>
      <a id="5933" href="Ledger.Conway.Conformance.Epoch.html#5910" class="Bound">pState&#39;</a> <a id="5941" class="Symbol">=</a> <a class="AgdaKaTeX">$\begin{pmatrix} \,\htmlId{5945}{\htmlClass{Symbol}{\text{(}}}\,\,\href{Ledger.Conway.Conformance.Certs.html#1041}{\htmlId{5946}{\htmlClass{Function}{\text{pState}}}}\, \,\htmlId{5953}{\htmlClass{Symbol}{\text{.}}}\,\,\href{Ledger.Conway.Specification.Certs.html#3941}{\htmlId{5954}{\htmlClass{Field}{\text{pools}}}}\,\,\htmlId{5959}{\htmlClass{Symbol}{\text{)}}}\, \,\href{Axiom.Set.Map.html#13606}{\htmlId{5961}{\htmlClass{Function Operator}{\text{∣}}}}\, \,\href{Ledger.Conway.Conformance.Epoch.html#5552}{\htmlId{5963}{\htmlClass{Bound}{\text{retired}}}}\, \,\href{Axiom.Set.Map.html#13606}{\htmlId{5971}{\htmlClass{Function Operator}{\text{ᶜ}}}}\,
                \\ \,\htmlId{5991}{\htmlClass{Symbol}{\text{(}}}\,\,\href{Ledger.Conway.Conformance.Certs.html#1041}{\htmlId{5992}{\htmlClass{Function}{\text{pState}}}}\, \,\htmlId{5999}{\htmlClass{Symbol}{\text{.}}}\,\,\href{Ledger.Conway.Specification.Certs.html#3963}{\htmlId{6000}{\htmlClass{Field}{\text{fPools}}}}\,\,\htmlId{6006}{\htmlClass{Symbol}{\text{)}}}\, \,\href{Axiom.Set.Map.html#13606}{\htmlId{6008}{\htmlClass{Function Operator}{\text{∣}}}}\, \,\href{Ledger.Conway.Conformance.Epoch.html#5552}{\htmlId{6010}{\htmlClass{Bound}{\text{retired}}}}\, \,\href{Axiom.Set.Map.html#13606}{\htmlId{6018}{\htmlClass{Function Operator}{\text{ᶜ}}}}\,
                \\ \,\htmlId{6038}{\htmlClass{Symbol}{\text{(}}}\,\,\href{Ledger.Conway.Conformance.Certs.html#1041}{\htmlId{6039}{\htmlClass{Function}{\text{pState}}}}\, \,\htmlId{6046}{\htmlClass{Symbol}{\text{.}}}\,\,\href{Ledger.Conway.Specification.Certs.html#3985}{\htmlId{6047}{\htmlClass{Field}{\text{retiring}}}}\,\,\htmlId{6055}{\htmlClass{Symbol}{\text{)}}}\, \,\href{Axiom.Set.Map.html#13606}{\htmlId{6057}{\htmlClass{Function Operator}{\text{∣}}}}\, \,\href{Ledger.Conway.Conformance.Epoch.html#5552}{\htmlId{6059}{\htmlClass{Bound}{\text{retired}}}}\, \,\href{Axiom.Set.Map.html#13606}{\htmlId{6067}{\htmlClass{Function Operator}{\text{ᶜ}}}}\,
                \end{pmatrix}$</a>

      <a id="6094" href="Ledger.Conway.Conformance.Epoch.html#6094" class="Bound">gState&#39;</a> <a id="6102" class="Symbol">:</a> <a id="6104" href="Ledger.Conway.Conformance.Certs.html#794" class="Record">GState</a>
      <a id="6117" href="Ledger.Conway.Conformance.Epoch.html#6094" class="Bound">gState&#39;</a> <a id="6125" class="Symbol">=</a> <a class="AgdaKaTeX">$\begin{pmatrix} \,\htmlId{6129}{\htmlClass{Symbol}{\text{(}}}\,\,\href{Class.ToBool.html#342}{\htmlId{6130}{\htmlClass{Function Operator}{\text{if}}}}\, \,\href{Data.List.Base.html#4681}{\htmlId{6133}{\htmlClass{Function}{\text{null}}}}\, \,\href{Ledger.Conway.Conformance.Epoch.html#4990}{\htmlId{6138}{\htmlClass{Bound}{\text{govSt&#39;}}}}\, \,\href{Class.ToBool.html#342}{\htmlId{6145}{\htmlClass{Function Operator}{\text{then}}}}\, \,\href{Axiom.Set.Map.html#7108}{\htmlId{6150}{\htmlClass{Function}{\text{mapValues}}}}\, \,\htmlId{6160}{\htmlClass{Symbol}{\text{(}}}\,\,\htmlId{6161}{\htmlClass{Number}{\text{1}}}\, \,\href{Class.HasAdd.Core.html#162}{\htmlId{6163}{\htmlClass{Field Operator}{\text{+\_}}}}\,\,\htmlId{6165}{\htmlClass{Symbol}{\text{)}}}\, \,\htmlId{6167}{\htmlClass{Symbol}{\text{(}}}\,\,\href{Ledger.Conway.Conformance.Certs.html#1061}{\htmlId{6168}{\htmlClass{Function}{\text{gState}}}}\, \,\htmlId{6175}{\htmlClass{Symbol}{\text{.}}}\,\,\href{Ledger.Conway.Conformance.Certs.html#849}{\htmlId{6176}{\htmlClass{Field}{\text{dreps}}}}\,\,\htmlId{6181}{\htmlClass{Symbol}{\text{)}}}\, \,\href{Class.ToBool.html#342}{\htmlId{6183}{\htmlClass{Function Operator}{\text{else}}}}\, \,\htmlId{6188}{\htmlClass{Symbol}{\text{(}}}\,\,\href{Ledger.Conway.Conformance.Certs.html#1061}{\htmlId{6189}{\htmlClass{Function}{\text{gState}}}}\, \,\htmlId{6196}{\htmlClass{Symbol}{\text{.}}}\,\,\href{Ledger.Conway.Conformance.Certs.html#849}{\htmlId{6197}{\htmlClass{Field}{\text{dreps}}}}\,\,\htmlId{6202}{\htmlClass{Symbol}{\text{))}}}\,
                , \,\htmlId{6223}{\htmlClass{Symbol}{\text{(}}}\,\,\href{Ledger.Conway.Conformance.Certs.html#1061}{\htmlId{6224}{\htmlClass{Function}{\text{gState}}}}\, \,\htmlId{6231}{\htmlClass{Symbol}{\text{.}}}\,\,\href{Ledger.Conway.Conformance.Certs.html#885}{\htmlId{6232}{\htmlClass{Field}{\text{ccHotKeys}}}}\,\,\htmlId{6241}{\htmlClass{Symbol}{\text{)}}}\, \,\href{Axiom.Set.Map.html#13536}{\htmlId{6243}{\htmlClass{Function Operator}{\text{∣}}}}\, \,\href{Ledger.Conway.Specification.Enact.html#1366}{\htmlId{6245}{\htmlClass{Function}{\text{ccCreds}}}}\, \,\htmlId{6253}{\htmlClass{Symbol}{\text{(}}}\,\,\href{Ledger.Conway.Conformance.Epoch.html#4666}{\htmlId{6254}{\htmlClass{Bound}{\text{es}}}}\, \,\htmlId{6257}{\htmlClass{Symbol}{\text{.}}}\,\,\href{Ledger.Conway.Specification.Enact.html#484}{\htmlId{6258}{\htmlClass{Field}{\text{cc}}}}\,\,\htmlId{6260}{\htmlClass{Symbol}{\text{)}}}\,
                , \,\href{Ledger.Conway.Conformance.Epoch.html#5778}{\htmlId{6280}{\htmlClass{Bound}{\text{vDeposits}}}}\,
                \end{pmatrix}$</a>

      <a id="6315" href="Ledger.Conway.Conformance.Epoch.html#6315" class="Bound">certState&#39;</a> <a id="6326" class="Symbol">:</a> <a id="6328" href="Ledger.Conway.Conformance.Certs.html#962" class="Record">CertState</a>
      <a id="6344" href="Ledger.Conway.Conformance.Epoch.html#6315" class="Bound">certState&#39;</a> <a id="6355" class="Symbol">=</a> <a id="6357" class="Keyword">record</a> <a id="6364" class="Symbol">{</a> <a id="6366" href="Ledger.Conway.Conformance.Certs.html#1021" class="Field">dState</a> <a id="6373" class="Symbol">=</a> <a id="6375" href="Ledger.Conway.Conformance.Epoch.html#5815" class="Bound">dState&#39;</a> <a id="6383" class="Symbol">;</a> <a id="6385" href="Ledger.Conway.Conformance.Certs.html#1041" class="Field">pState</a> <a id="6392" class="Symbol">=</a> <a id="6394" href="Ledger.Conway.Conformance.Epoch.html#5910" class="Bound">pState&#39;</a> <a id="6402" class="Symbol">;</a> <a id="6404" href="Ledger.Conway.Conformance.Certs.html#1061" class="Field">gState</a> <a id="6411" class="Symbol">=</a> <a id="6413" href="Ledger.Conway.Conformance.Epoch.html#6094" class="Bound">gState&#39;</a> <a id="6421" class="Symbol">}</a>

      <a id="6430" href="Ledger.Conway.Conformance.Epoch.html#6430" class="Bound">utxoSt&#39;</a> <a id="6438" class="Symbol">=</a> <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.Conway.Conformance.Ledger.html#834}{\htmlId{6442}{\htmlClass{Function}{\text{utxoSt}}}}\, \,\htmlId{6449}{\htmlClass{Symbol}{\text{.}}}\,\,\href{Ledger.Conway.Specification.Utxo.html#1294}{\htmlId{6450}{\htmlClass{Field}{\text{utxo}}}}\, \\ \,\href{Ledger.Conway.Conformance.Ledger.html#834}{\htmlId{6457}{\htmlClass{Function}{\text{utxoSt}}}}\, \,\htmlId{6464}{\htmlClass{Symbol}{\text{.}}}\,\,\href{Ledger.Conway.Specification.Utxo.html#1316}{\htmlId{6465}{\htmlClass{Field}{\text{fees}}}}\, \\ \,\href{Ledger.Conway.Conformance.Ledger.html#834}{\htmlId{6472}{\htmlClass{Function}{\text{utxoSt}}}}\, \,\htmlId{6479}{\htmlClass{Symbol}{\text{.}}}\,\,\href{Ledger.Conway.Specification.Utxo.html#1338}{\htmlId{6480}{\htmlClass{Field}{\text{deposits}}}}\, \,\href{Axiom.Set.Map.html#13606}{\htmlId{6489}{\htmlClass{Function Operator}{\text{∣}}}}\, \,\href{abstract-set-theory.FiniteSetTheory.html#519}{\htmlId{6491}{\htmlClass{Function}{\text{mapˢ}}}}\, \,\htmlId{6496}{\htmlClass{Symbol}{\text{(}}}\,\,\href{Data.Product.Base.html#636}{\htmlId{6497}{\htmlClass{Field}{\text{proj₁}}}}\, \,\href{Function.Base.html#1134}{\htmlId{6503}{\htmlClass{Function Operator}{\text{∘}}}}\, \,\href{Data.Product.Base.html#650}{\htmlId{6505}{\htmlClass{Field}{\text{proj₂}}}}\,\,\htmlId{6510}{\htmlClass{Symbol}{\text{)}}}\, \,\href{Ledger.Conway.Conformance.Epoch.html#5061}{\htmlId{6512}{\htmlClass{Bound}{\text{removedGovActions}}}}\, \,\href{Axiom.Set.Map.html#13606}{\htmlId{6530}{\htmlClass{Function Operator}{\text{ᶜ}}}}\, \\ \,\htmlId{6534}{\htmlClass{Number}{\text{0}}}\, \end{pmatrix}$</a>

      <a id="6545" href="Ledger.Conway.Conformance.Epoch.html#6545" class="Bound">acnt&#39;</a> <a id="6551" class="Symbol">=</a> <a id="6553" class="Keyword">record</a> <a id="6560" href="Ledger.Conway.Conformance.Epoch.html#4171" class="Generalizable">acnt</a>
        <a id="6573" class="Symbol">{</a> <a id="6575" href="Ledger.Conway.Specification.PParams.html#775" class="Field">treasury</a>  <a id="6585" class="Symbol">=</a> <a id="6587" href="Ledger.Conway.Conformance.Epoch.html#4171" class="Generalizable">acnt</a> <a id="6592" class="Symbol">.</a><a id="6593" href="Ledger.Conway.Specification.PParams.html#775" class="Field">treasury</a> <a id="6602" href="Data.Nat.Base.html#4462" class="Primitive Operator">∸</a> <a id="6604" href="Ledger.Conway.Conformance.Epoch.html#5502" class="Bound">totWithdrawals</a> <a id="6619" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="6621" href="Ledger.Conway.Conformance.Ledger.html#834" class="Function">utxoSt</a> <a id="6628" class="Symbol">.</a><a id="6629" href="Ledger.Conway.Specification.Utxo.html#1364" class="Field">donations</a> <a id="6639" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="6641" href="Ledger.Conway.Conformance.Epoch.html#5726" class="Bound">unclaimed</a> <a id="6651" class="Symbol">}</a>

      <a id="6660" href="Ledger.Conway.Conformance.Epoch.html#6660" class="Bound">stakeDistrs</a> <a id="6672" class="Symbol">:</a> <a id="6674" href="Ledger.Conway.Specification.Ratify.html#3120" class="Record">StakeDistrs</a>
      <a id="6692" href="Ledger.Conway.Conformance.Epoch.html#6660" class="Bound">stakeDistrs</a> <a id="6704" class="Symbol">=</a> <a id="6706" href="Ledger.Conway.Specification.Epoch.html#12519" class="Function">mkStakeDistrs</a> <a id="6720" class="Symbol">(</a><a id="6721" href="Ledger.Conway.Specification.Rewards.html#7753" class="Field">Snapshots.mark</a> <a id="6736" href="Ledger.Conway.Conformance.Epoch.html#4265" class="Generalizable">ss&#39;</a><a id="6739" class="Symbol">)</a> <a id="6741" href="Ledger.Conway.Conformance.Epoch.html#4080" class="Generalizable">e</a> <a id="6743" href="Ledger.Conway.Conformance.Epoch.html#6430" class="Bound">utxoSt&#39;</a> <a id="6751" href="Ledger.Conway.Conformance.Epoch.html#4990" class="Bound">govSt&#39;</a> <a id="6758" class="Symbol">(</a><a id="6759" class="Keyword">record</a> <a id="6766" class="Symbol">{</a> <a id="6768" href="Ledger.Conway.Conformance.Epoch.html#6768" class="Module">GState</a> <a id="6775" class="Symbol">(</a><a id="6776" href="Ledger.Conway.Conformance.Certs.html#1061" class="Field">CertState.gState</a> <a id="6793" class="Symbol">(</a><a id="6794" href="Ledger.Conway.Conformance.Ledger.html#887" class="Field">LState.certState</a> <a id="6811" href="Ledger.Conway.Conformance.Epoch.html#4157" class="Generalizable">ls</a><a id="6813" class="Symbol">))</a> <a id="6816" class="Symbol">})</a>
                                                                        <a id="6891" class="Symbol">(</a><a id="6892" class="Keyword">record</a> <a id="6899" class="Symbol">{</a> <a id="6901" href="Ledger.Conway.Conformance.Epoch.html#6901" class="Module">DState</a> <a id="6908" class="Symbol">(</a><a id="6909" href="Ledger.Conway.Conformance.Certs.html#1021" class="Field">CertState.dState</a> <a id="6926" class="Symbol">(</a><a id="6927" href="Ledger.Conway.Conformance.Ledger.html#887" class="Field">LState.certState</a> <a id="6944" href="Ledger.Conway.Conformance.Epoch.html#4157" class="Generalizable">ls</a><a id="6946" class="Symbol">))</a> <a id="6949" class="Symbol">})</a>

    <a id="6957" class="Keyword">in</a>
    <a id="6964" class="Keyword">record</a> <a id="6971" class="Symbol">{</a> <a id="6973" href="Ledger.Conway.Specification.Ratify.html#3306" class="Field">currentEpoch</a> <a id="6986" class="Symbol">=</a> <a id="6988" href="Ledger.Conway.Conformance.Epoch.html#4080" class="Generalizable">e</a>
           <a id="7001" class="Symbol">;</a> <a id="7003" href="Ledger.Conway.Specification.Ratify.html#3274" class="Field">stakeDistrs</a> <a id="7015" class="Symbol">=</a> <a id="7017" href="Ledger.Conway.Conformance.Epoch.html#6660" class="Bound">stakeDistrs</a>
           <a id="7040" class="Symbol">;</a> <a id="7042" href="Ledger.Conway.Specification.Ratify.html#3421" class="Field">treasury</a> <a id="7051" class="Symbol">=</a> <a id="7053" href="Ledger.Conway.Conformance.Epoch.html#4171" class="Generalizable">acnt</a> <a id="7058" class="Symbol">.</a><a id="7059" href="Ledger.Conway.Specification.PParams.html#775" class="Field">treasury</a> <a id="7068" class="Symbol">;</a> <a id="7070" href="Ledger.Conway.Conformance.Epoch.html#7070" class="Module">GState</a> <a id="7077" href="Ledger.Conway.Conformance.Certs.html#1061" class="Function">gState</a>
           <a id="7095" class="Symbol">;</a> <a id="7097" href="Ledger.Conway.Specification.Ratify.html#3450" class="Field">pools</a> <a id="7103" class="Symbol">=</a> <a id="7105" href="Ledger.Conway.Conformance.Certs.html#1041" class="Function">pState</a> <a id="7112" class="Symbol">.</a><a id="7113" href="Ledger.Conway.Specification.Certs.html#3941" class="Field">pools</a> <a id="7119" class="Symbol">;</a> <a id="7121" href="Ledger.Conway.Specification.Ratify.html#3496" class="Field">delegatees</a> <a id="7132" class="Symbol">=</a> <a id="7134" href="Ledger.Conway.Conformance.Certs.html#1021" class="Function">dState</a> <a id="7141" class="Symbol">.</a><a id="7142" href="Ledger.Conway.Conformance.Certs.html#665" class="Field">voteDelegs</a> <a id="7153" class="Symbol">}</a>
        <a id="7163" href="Ledger.Conway.Specification.Ratify.html#13642" class="Function Operator">⊢</a> <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.Conway.Conformance.Epoch.html#4666}{\htmlId{7167}{\htmlClass{Bound}{\text{es}}}}\, \\ \,\href{Class.HasEmptySet.html#287}{\htmlId{7172}{\htmlClass{Field}{\text{∅}}}}\, \\ \,\href{Agda.Builtin.Bool.html#192}{\htmlId{7176}{\htmlClass{InductiveConstructor}{\text{false}}}}\, \end{pmatrix}$</a> <a id="7184" href="Ledger.Conway.Specification.Ratify.html#13642" class="Function Operator">⇀⦇</a> <a id="7187" href="Ledger.Conway.Conformance.Epoch.html#4990" class="Bound">govSt&#39;</a> <a id="7194" href="Ledger.Conway.Specification.Ratify.html#13642" class="Function Operator">,RATIFIES⦈</a> <a id="7205" href="Ledger.Conway.Conformance.Epoch.html#4106" class="Generalizable">fut&#39;</a>
      <a id="7216" class="Symbol">→</a> <a id="7218" href="Ledger.Conway.Conformance.Epoch.html#4157" class="Generalizable">ls</a> <a id="7221" href="Ledger.Conway.Conformance.Rewards.html#613" class="Datatype Operator">⊢</a> <a id="7223" href="Ledger.Conway.Conformance.Epoch.html#4262" class="Generalizable">ss</a> <a id="7226" href="Ledger.Conway.Conformance.Rewards.html#613" class="Datatype Operator">⇀⦇</a> <a id="7229" href="Agda.Builtin.Unit.html#212" class="InductiveConstructor">tt</a> <a id="7232" href="Ledger.Conway.Conformance.Rewards.html#613" class="Datatype Operator">,SNAP⦈</a> <a id="7239" href="Ledger.Conway.Conformance.Epoch.html#4265" class="Generalizable">ss&#39;</a>
    <a id="7247" href="Prelude.InferenceRules.html#13694" class="Function Operator">────────────────────────────────</a>
    <a id="7284" class="Symbol">_</a> <a id="7286" href="Ledger.Conway.Conformance.Epoch.html#4359" class="Datatype Operator">⊢</a> <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.Conway.Conformance.Epoch.html#4171}{\htmlId{7290}{\htmlClass{Generalizable}{\text{acnt}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#4262}{\htmlId{7297}{\htmlClass{Generalizable}{\text{ss}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#4157}{\htmlId{7302}{\htmlClass{Generalizable}{\text{ls}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#4185}{\htmlId{7307}{\htmlClass{Generalizable}{\text{es₀}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#4102}{\htmlId{7313}{\htmlClass{Generalizable}{\text{fut}}}}\, \end{pmatrix}$</a> <a id="7319" href="Ledger.Conway.Conformance.Epoch.html#4359" class="Datatype Operator">⇀⦇</a> <a id="7322" href="Ledger.Conway.Conformance.Epoch.html#4080" class="Generalizable">e</a> <a id="7324" href="Ledger.Conway.Conformance.Epoch.html#4359" class="Datatype Operator">,EPOCH⦈</a>
        <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.Conway.Conformance.Epoch.html#6545}{\htmlId{7342}{\htmlClass{Bound}{\text{acnt&#39;}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#4265}{\htmlId{7350}{\htmlClass{Generalizable}{\text{ss&#39;}}}}\, \\ \begin{pmatrix} \,\href{Ledger.Conway.Conformance.Epoch.html#6430}{\htmlId{7358}{\htmlClass{Bound}{\text{utxoSt&#39;}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#4990}{\htmlId{7368}{\htmlClass{Bound}{\text{govSt&#39;}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#6315}{\htmlId{7377}{\htmlClass{Bound}{\text{certState&#39;}}}}\, \end{pmatrix} \\ \,\href{Ledger.Conway.Conformance.Epoch.html#4666}{\htmlId{7392}{\htmlClass{Bound}{\text{es}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#4106}{\htmlId{7397}{\htmlClass{Generalizable}{\text{fut&#39;}}}}\, \end{pmatrix}$</a>

<a id="7405" class="Keyword">data</a> <a id="_⊢_⇀⦇_,NEWEPOCH⦈_"></a><a id="7410" href="Ledger.Conway.Conformance.Epoch.html#7410" class="Datatype Operator">_⊢_⇀⦇_,NEWEPOCH⦈_</a> <a id="7428" class="Symbol">:</a> <a id="7430" href="Agda.Builtin.Unit.html#175" class="Record">⊤</a> <a id="7432" class="Symbol">→</a> <a id="7434" href="Ledger.Conway.Conformance.Epoch.html#1501" class="Record">NewEpochState</a> <a id="7448" class="Symbol">→</a> <a id="7450" href="Ledger.Core.Specification.Epoch.html#646" class="Function">Epoch</a> <a id="7456" class="Symbol">→</a> <a id="7458" href="Ledger.Conway.Conformance.Epoch.html#1501" class="Record">NewEpochState</a> <a id="7472" class="Symbol">→</a> <a id="7474" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="7479" class="Keyword">where</a>

  <a id="_⊢_⇀⦇_,NEWEPOCH⦈_.NEWEPOCH-New"></a><a id="7488" href="Ledger.Conway.Conformance.Epoch.html#7488" class="InductiveConstructor">NEWEPOCH-New</a> <a id="7501" class="Symbol">:</a>
    <a id="7507" class="Symbol">∀</a> <a id="7509" class="Symbol">{</a><a id="7510" href="Ledger.Conway.Conformance.Epoch.html#7510" class="Bound">bprev</a> <a id="7516" href="Ledger.Conway.Conformance.Epoch.html#7516" class="Bound">bcur</a> <a id="7521" class="Symbol">:</a> <a id="7523" href="Ledger.Conway.Specification.Rewards.html#4906" class="Function">BlocksMade</a><a id="7533" class="Symbol">}</a> <a id="7535" class="Symbol">{</a><a id="7536" href="Ledger.Conway.Conformance.Epoch.html#7536" class="Bound">pd</a> <a id="7539" class="Symbol">:</a> <a id="7541" href="Ledger.Conway.Conformance.Epoch.html#1431" class="Function">PoolDelegatedStake</a><a id="7559" class="Symbol">}</a> <a id="7561" class="Symbol">→</a>
    <a id="7567" class="Keyword">let</a>
       <a id="7578" href="Ledger.Conway.Conformance.Epoch.html#7578" class="Bound">eps&#39;</a> <a id="7583" class="Symbol">=</a> <a id="7585" href="Ledger.Conway.Conformance.Epoch.html#2743" class="Function">applyRUpd</a> <a id="7595" href="Ledger.Conway.Conformance.Epoch.html#4283" class="Generalizable">ru</a> <a id="7598" href="Ledger.Conway.Conformance.Epoch.html#4127" class="Generalizable">eps</a>
       <a id="7609" href="Ledger.Conway.Conformance.Epoch.html#7609" class="Bound">ss</a>   <a id="7614" class="Symbol">=</a> <a id="7616" href="Ledger.Conway.Conformance.Epoch.html#1326" class="Field">EpochState.ss</a> <a id="7630" href="Ledger.Conway.Conformance.Epoch.html#4136" class="Generalizable">eps&#39;&#39;</a>
       <a id="7643" href="Ledger.Conway.Conformance.Epoch.html#7643" class="Bound">pd&#39;</a>  <a id="7648" class="Symbol">=</a> <a id="7650" href="Ledger.Conway.Conformance.Epoch.html#3473" class="Function">calculatePoolDelegatedStake</a> <a id="7678" class="Symbol">(</a><a id="7679" href="Ledger.Conway.Specification.Rewards.html#7758" class="Field">Snapshots.set</a> <a id="7693" href="Ledger.Conway.Conformance.Epoch.html#7609" class="Bound">ss</a><a id="7695" class="Symbol">)</a>
     <a id="7702" class="Keyword">in</a>
       <a id="7712" href="Prelude.InferenceRules.html#56075" class="Function Operator">∙</a> <a id="7714" href="Ledger.Conway.Conformance.Epoch.html#4080" class="Generalizable">e</a> <a id="7716" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="7718" href="Ledger.Conway.Conformance.Epoch.html#4082" class="Generalizable">lastEpoch</a> <a id="7728" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="7730" class="Number">1</a>
       <a id="7739" href="Prelude.InferenceRules.html#56006" class="Function Operator">∙</a> <a id="7741" class="Symbol">_</a> <a id="7743" href="Ledger.Conway.Conformance.Epoch.html#4359" class="Datatype Operator">⊢</a> <a id="7745" href="Ledger.Conway.Conformance.Epoch.html#7578" class="Bound">eps&#39;</a> <a id="7750" href="Ledger.Conway.Conformance.Epoch.html#4359" class="Datatype Operator">⇀⦇</a> <a id="7753" href="Ledger.Conway.Conformance.Epoch.html#4080" class="Generalizable">e</a> <a id="7755" href="Ledger.Conway.Conformance.Epoch.html#4359" class="Datatype Operator">,EPOCH⦈</a> <a id="7763" href="Ledger.Conway.Conformance.Epoch.html#4136" class="Generalizable">eps&#39;&#39;</a>
       <a id="7776" href="Prelude.InferenceRules.html#13694" class="Function Operator">────────────────────────────────</a>
       <a id="7816" class="Symbol">_</a> <a id="7818" href="Ledger.Conway.Conformance.Epoch.html#7410" class="Datatype Operator">⊢</a> <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.Conway.Conformance.Epoch.html#4082}{\htmlId{7822}{\htmlClass{Generalizable}{\text{lastEpoch}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#7510}{\htmlId{7834}{\htmlClass{Bound}{\text{bprev}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#7516}{\htmlId{7842}{\htmlClass{Bound}{\text{bcur}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#4127}{\htmlId{7849}{\htmlClass{Generalizable}{\text{eps}}}}\, \\ \,\href{Agda.Builtin.Maybe.html#173}{\htmlId{7855}{\htmlClass{InductiveConstructor}{\text{just}}}}\, \,\href{Ledger.Conway.Conformance.Epoch.html#4283}{\htmlId{7860}{\htmlClass{Generalizable}{\text{ru}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#7536}{\htmlId{7865}{\htmlClass{Bound}{\text{pd}}}}\, \end{pmatrix}$</a> <a id="7870" href="Ledger.Conway.Conformance.Epoch.html#7410" class="Datatype Operator">⇀⦇</a> <a id="7873" href="Ledger.Conway.Conformance.Epoch.html#4080" class="Generalizable">e</a> <a id="7875" href="Ledger.Conway.Conformance.Epoch.html#7410" class="Datatype Operator">,NEWEPOCH⦈</a> <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.Conway.Conformance.Epoch.html#4080}{\htmlId{7888}{\htmlClass{Generalizable}{\text{e}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#7516}{\htmlId{7892}{\htmlClass{Bound}{\text{bcur}}}}\, \\ \,\href{Axiom.Set.Map.html#2671}{\htmlId{7899}{\htmlClass{Function}{\text{∅ᵐ}}}}\,  \\ \,\href{Ledger.Conway.Conformance.Epoch.html#4136}{\htmlId{7905}{\htmlClass{Generalizable}{\text{eps&#39;&#39;}}}}\, \\ \,\href{Agda.Builtin.Maybe.html#194}{\htmlId{7913}{\htmlClass{InductiveConstructor}{\text{nothing}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#7643}{\htmlId{7923}{\htmlClass{Bound}{\text{pd&#39;}}}}\, \end{pmatrix}$</a>

  <a id="_⊢_⇀⦇_,NEWEPOCH⦈_.NEWEPOCH-Not-New"></a><a id="7932" href="Ledger.Conway.Conformance.Epoch.html#7932" class="InductiveConstructor">NEWEPOCH-Not-New</a> <a id="7949" class="Symbol">:</a> <a id="7951" class="Symbol">∀</a> <a id="7953" class="Symbol">{</a><a id="7954" href="Ledger.Conway.Conformance.Epoch.html#7954" class="Bound">bprev</a> <a id="7960" href="Ledger.Conway.Conformance.Epoch.html#7960" class="Bound">bcur</a> <a id="7965" class="Symbol">:</a> <a id="7967" href="Ledger.Conway.Specification.Rewards.html#4906" class="Function">BlocksMade</a><a id="7977" class="Symbol">}</a> <a id="7979" class="Symbol">{</a><a id="7980" href="Ledger.Conway.Conformance.Epoch.html#7980" class="Bound">pd</a> <a id="7983" class="Symbol">:</a> <a id="7985" href="Ledger.Conway.Conformance.Epoch.html#1431" class="Function">PoolDelegatedStake</a><a id="8003" class="Symbol">}</a> <a id="8005" class="Symbol">→</a>
    <a id="8011" href="Prelude.InferenceRules.html#56075" class="Function Operator">∙</a> <a id="8013" href="Ledger.Conway.Conformance.Epoch.html#4080" class="Generalizable">e</a> <a id="8015" href="Relation.Binary.PropositionalEquality.Core.html#1000" class="Function Operator">≢</a> <a id="8017" href="Ledger.Conway.Conformance.Epoch.html#4082" class="Generalizable">lastEpoch</a> <a id="8027" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="8029" class="Number">1</a>
      <a id="8037" href="Prelude.InferenceRules.html#13694" class="Function Operator">────────────────────────────────</a>
      <a id="8076" class="Symbol">_</a> <a id="8078" href="Ledger.Conway.Conformance.Epoch.html#7410" class="Datatype Operator">⊢</a> <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.Conway.Conformance.Epoch.html#4082}{\htmlId{8082}{\htmlClass{Generalizable}{\text{lastEpoch}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#7954}{\htmlId{8094}{\htmlClass{Bound}{\text{bprev}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#7960}{\htmlId{8102}{\htmlClass{Bound}{\text{bcur}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#4127}{\htmlId{8109}{\htmlClass{Generalizable}{\text{eps}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#4303}{\htmlId{8115}{\htmlClass{Generalizable}{\text{mru}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#7980}{\htmlId{8121}{\htmlClass{Bound}{\text{pd}}}}\, \end{pmatrix}$</a> <a id="8126" href="Ledger.Conway.Conformance.Epoch.html#7410" class="Datatype Operator">⇀⦇</a> <a id="8129" href="Ledger.Conway.Conformance.Epoch.html#4080" class="Generalizable">e</a> <a id="8131" href="Ledger.Conway.Conformance.Epoch.html#7410" class="Datatype Operator">,NEWEPOCH⦈</a> <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.Conway.Conformance.Epoch.html#4082}{\htmlId{8144}{\htmlClass{Generalizable}{\text{lastEpoch}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#7954}{\htmlId{8156}{\htmlClass{Bound}{\text{bprev}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#7960}{\htmlId{8164}{\htmlClass{Bound}{\text{bcur}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#4127}{\htmlId{8171}{\htmlClass{Generalizable}{\text{eps}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#4303}{\htmlId{8177}{\htmlClass{Generalizable}{\text{mru}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#7980}{\htmlId{8183}{\htmlClass{Bound}{\text{pd}}}}\, \end{pmatrix}$</a>

  <a id="_⊢_⇀⦇_,NEWEPOCH⦈_.NEWEPOCH-No-Reward-Update"></a><a id="8191" href="Ledger.Conway.Conformance.Epoch.html#8191" class="InductiveConstructor">NEWEPOCH-No-Reward-Update</a> <a id="8217" class="Symbol">:</a>
    <a id="8223" class="Symbol">∀</a> <a id="8225" class="Symbol">{</a><a id="8226" href="Ledger.Conway.Conformance.Epoch.html#8226" class="Bound">bprev</a> <a id="8232" href="Ledger.Conway.Conformance.Epoch.html#8232" class="Bound">bcur</a> <a id="8237" class="Symbol">:</a> <a id="8239" href="Ledger.Conway.Specification.Rewards.html#4906" class="Function">BlocksMade</a><a id="8249" class="Symbol">}</a> <a id="8251" class="Symbol">{</a><a id="8252" href="Ledger.Conway.Conformance.Epoch.html#8252" class="Bound">pd</a> <a id="8255" class="Symbol">:</a> <a id="8257" href="Ledger.Conway.Conformance.Epoch.html#1431" class="Function">PoolDelegatedStake</a><a id="8275" class="Symbol">}</a> <a id="8277" class="Symbol">→</a>
    <a id="8283" class="Keyword">let</a>
      <a id="8293" href="Ledger.Conway.Conformance.Epoch.html#8293" class="Bound">ss</a>  <a id="8297" class="Symbol">=</a> <a id="8299" href="Ledger.Conway.Conformance.Epoch.html#1326" class="Field">EpochState.ss</a> <a id="8313" href="Ledger.Conway.Conformance.Epoch.html#4131" class="Generalizable">eps&#39;</a>
      <a id="8324" href="Ledger.Conway.Conformance.Epoch.html#8324" class="Bound">pd&#39;</a> <a id="8328" class="Symbol">=</a> <a id="8330" href="Ledger.Conway.Conformance.Epoch.html#3473" class="Function">calculatePoolDelegatedStake</a> <a id="8358" class="Symbol">(</a><a id="8359" href="Ledger.Conway.Specification.Rewards.html#7758" class="Field">Snapshots.set</a> <a id="8373" href="Ledger.Conway.Conformance.Epoch.html#8293" class="Bound">ss</a><a id="8375" class="Symbol">)</a>
    <a id="8381" class="Keyword">in</a>
      <a id="8390" href="Prelude.InferenceRules.html#56075" class="Function Operator">∙</a> <a id="8392" href="Ledger.Conway.Conformance.Epoch.html#4080" class="Generalizable">e</a> <a id="8394" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="8396" href="Ledger.Conway.Conformance.Epoch.html#4082" class="Generalizable">lastEpoch</a> <a id="8406" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="8408" class="Number">1</a>
      <a id="8416" href="Prelude.InferenceRules.html#56006" class="Function Operator">∙</a> <a id="8418" class="Symbol">_</a> <a id="8420" href="Ledger.Conway.Conformance.Epoch.html#4359" class="Datatype Operator">⊢</a> <a id="8422" href="Ledger.Conway.Conformance.Epoch.html#4127" class="Generalizable">eps</a> <a id="8426" href="Ledger.Conway.Conformance.Epoch.html#4359" class="Datatype Operator">⇀⦇</a> <a id="8429" href="Ledger.Conway.Conformance.Epoch.html#4080" class="Generalizable">e</a> <a id="8431" href="Ledger.Conway.Conformance.Epoch.html#4359" class="Datatype Operator">,EPOCH⦈</a> <a id="8439" href="Ledger.Conway.Conformance.Epoch.html#4131" class="Generalizable">eps&#39;</a>
      <a id="8450" href="Prelude.InferenceRules.html#13694" class="Function Operator">────────────────────────────────</a>
      <a id="8489" class="Symbol">_</a> <a id="8491" href="Ledger.Conway.Conformance.Epoch.html#7410" class="Datatype Operator">⊢</a> <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.Conway.Conformance.Epoch.html#4082}{\htmlId{8495}{\htmlClass{Generalizable}{\text{lastEpoch}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#8226}{\htmlId{8507}{\htmlClass{Bound}{\text{bprev}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#8232}{\htmlId{8515}{\htmlClass{Bound}{\text{bcur}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#4127}{\htmlId{8522}{\htmlClass{Generalizable}{\text{eps}}}}\, \\ \,\href{Agda.Builtin.Maybe.html#194}{\htmlId{8528}{\htmlClass{InductiveConstructor}{\text{nothing}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#8252}{\htmlId{8538}{\htmlClass{Bound}{\text{pd}}}}\, \end{pmatrix}$</a> <a id="8543" href="Ledger.Conway.Conformance.Epoch.html#7410" class="Datatype Operator">⇀⦇</a> <a id="8546" href="Ledger.Conway.Conformance.Epoch.html#4080" class="Generalizable">e</a> <a id="8548" href="Ledger.Conway.Conformance.Epoch.html#7410" class="Datatype Operator">,NEWEPOCH⦈</a> <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.Conway.Conformance.Epoch.html#4080}{\htmlId{8561}{\htmlClass{Generalizable}{\text{e}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#8232}{\htmlId{8565}{\htmlClass{Bound}{\text{bcur}}}}\, \\ \,\href{Axiom.Set.Map.html#2671}{\htmlId{8572}{\htmlClass{Function}{\text{∅ᵐ}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#4131}{\htmlId{8577}{\htmlClass{Generalizable}{\text{eps&#39;}}}}\, \\ \,\href{Agda.Builtin.Maybe.html#194}{\htmlId{8584}{\htmlClass{InductiveConstructor}{\text{nothing}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#8324}{\htmlId{8594}{\htmlClass{Bound}{\text{pd&#39;}}}}\, \end{pmatrix}$</a>
</pre></body></html>