<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>Ledger.Conway.Conformance.Epoch</title><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.css"><link rel="stylesheet" href="Agda.css"><script src="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.js"></script><script src="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/contrib/auto-render.min.js"></script><script src="AgdaKaTeX.js" defer=""></script></head><body><pre class="Agda"><a id="1" class="Symbol">{-#</a> <a id="5" class="Keyword">OPTIONS</a> <a id="13" class="Pragma">--safe</a> <a id="20" class="Symbol">#-}</a>

<a id="25" class="Keyword">open</a> <a id="30" class="Keyword">import</a> <a id="37" href="Ledger.Conway.Specification.Abstract.html" class="Module">Ledger.Conway.Specification.Abstract</a>
<a id="74" class="Keyword">open</a> <a id="79" class="Keyword">import</a> <a id="86" href="Ledger.Conway.Specification.Transaction.html" class="Module">Ledger.Conway.Specification.Transaction</a>

<a id="127" class="Keyword">module</a> <a id="134" href="Ledger.Conway.Conformance.Epoch.html" class="Module">Ledger.Conway.Conformance.Epoch</a>
  <a id="168" class="Symbol">(</a><a id="169" href="Ledger.Conway.Conformance.Epoch.html#169" class="Bound">txs</a> <a id="173" class="Symbol">:</a> <a id="175" class="Symbol">_)</a> <a id="178" class="Symbol">(</a><a id="179" class="Keyword">open</a> <a id="184" href="Ledger.Conway.Specification.Transaction.html#999" class="Module">TransactionStructure</a> <a id="205" href="Ledger.Conway.Conformance.Epoch.html#169" class="Bound">txs</a><a id="208" class="Symbol">)</a>
  <a id="212" class="Symbol">(</a><a id="213" href="Ledger.Conway.Conformance.Epoch.html#213" class="Bound">abs</a> <a id="217" class="Symbol">:</a> <a id="219" href="Ledger.Conway.Specification.Abstract.html#720" class="Record">AbstractFunctions</a> <a id="237" href="Ledger.Conway.Conformance.Epoch.html#169" class="Bound">txs</a><a id="240" class="Symbol">)</a> <a id="242" class="Symbol">(</a><a id="243" class="Keyword">open</a> <a id="248" href="Ledger.Conway.Specification.Abstract.html#720" class="Module">AbstractFunctions</a> <a id="266" href="Ledger.Conway.Conformance.Epoch.html#213" class="Bound">abs</a><a id="269" class="Symbol">)</a>
  <a id="273" class="Keyword">where</a>

<a id="280" class="Keyword">open</a> <a id="285" class="Keyword">import</a> <a id="292" href="Ledger.Prelude.html" class="Module">Ledger.Prelude</a>
<a id="307" class="Keyword">open</a> <a id="312" class="Keyword">import</a> <a id="319" href="Data.Integer.html" class="Module">Data.Integer</a> <a id="332" class="Keyword">using</a> <a id="338" class="Symbol">()</a> <a id="341" class="Keyword">renaming</a> <a id="350" class="Symbol">(</a><a id="351" href="Agda.Builtin.Int.html#263" class="InductiveConstructor">+_</a> <a id="354" class="Symbol">to</a> <a id="357" class="InductiveConstructor">pos</a><a id="360" class="Symbol">)</a>
<a id="362" class="Keyword">import</a> <a id="369" href="Data.Integer.html" class="Module">Data.Integer</a> <a id="382" class="Symbol">as</a> <a id="385" class="Module">ℤ</a>

<a id="388" class="Keyword">open</a> <a id="393" class="Keyword">import</a> <a id="400" href="Data.Nat.Properties.html" class="Module">Data.Nat.Properties</a> <a id="420" class="Keyword">using</a> <a id="426" class="Symbol">(</a><a id="427" href="Data.Nat.Properties.html#17566" class="Function">+-0-monoid</a><a id="437" class="Symbol">;</a> <a id="439" href="Data.Nat.Properties.html#17645" class="Function">+-0-commutativeMonoid</a><a id="460" class="Symbol">)</a>
<a id="462" class="Keyword">open</a> <a id="467" class="Keyword">import</a> <a id="474" href="Data.List.html" class="Module">Data.List</a> <a id="484" class="Keyword">using</a> <a id="490" class="Symbol">(</a><a id="491" href="Data.List.Base.html#10389" class="Function">filter</a><a id="497" class="Symbol">)</a>

<a id="500" class="Keyword">open</a> <a id="505" class="Keyword">import</a> <a id="512" href="Agda.Builtin.FromNat.html" class="Module">Agda.Builtin.FromNat</a>

<a id="534" class="Keyword">open</a> <a id="539" class="Keyword">import</a> <a id="546" href="Ledger.Conway.Specification.Enact.html" class="Module">Ledger.Conway.Specification.Enact</a> <a id="580" href="Ledger.Conway.Specification.Transaction.html#2077" class="Function">govStructure</a>
<a id="593" class="Keyword">open</a> <a id="598" class="Keyword">import</a> <a id="605" href="Ledger.Conway.Conformance.Equivalence.html" class="Module">Ledger.Conway.Conformance.Equivalence</a> <a id="643" href="Ledger.Conway.Conformance.Epoch.html#169" class="Bound">txs</a> <a id="647" href="Ledger.Conway.Conformance.Epoch.html#213" class="Bound">abs</a>
<a id="651" class="Keyword">open</a> <a id="656" class="Keyword">import</a> <a id="663" href="Ledger.Conway.Conformance.Equivalence.Convert.html" class="Module">Ledger.Conway.Conformance.Equivalence.Convert</a>
<a id="709" class="Keyword">open</a> <a id="714" class="Keyword">import</a> <a id="721" href="Ledger.Conway.Conformance.Equivalence.Deposits.html" class="Module">Ledger.Conway.Conformance.Equivalence.Deposits</a> <a id="768" href="Ledger.Conway.Conformance.Epoch.html#169" class="Bound">txs</a> <a id="772" href="Ledger.Conway.Conformance.Epoch.html#213" class="Bound">abs</a>
<a id="776" class="Keyword">open</a> <a id="781" class="Keyword">import</a> <a id="788" href="Ledger.Conway.Conformance.Ledger.html" class="Module">Ledger.Conway.Conformance.Ledger</a> <a id="821" href="Ledger.Conway.Conformance.Epoch.html#169" class="Bound">txs</a> <a id="825" href="Ledger.Conway.Conformance.Epoch.html#213" class="Bound">abs</a>
<a id="829" class="Keyword">open</a> <a id="834" class="Keyword">import</a> <a id="841" href="Ledger.Conway.Specification.Ratify.html" class="Module">Ledger.Conway.Specification.Ratify</a> <a id="876" href="Ledger.Conway.Conformance.Epoch.html#169" class="Bound">txs</a>
<a id="880" class="Keyword">open</a> <a id="885" class="Keyword">import</a> <a id="892" href="Ledger.Conway.Conformance.Utxo.html" class="Module">Ledger.Conway.Conformance.Utxo</a> <a id="923" href="Ledger.Conway.Conformance.Epoch.html#169" class="Bound">txs</a> <a id="927" href="Ledger.Conway.Conformance.Epoch.html#213" class="Bound">abs</a>
<a id="931" class="Keyword">open</a> <a id="936" class="Keyword">import</a> <a id="943" href="Ledger.Conway.Conformance.Certs.html" class="Module">Ledger.Conway.Conformance.Certs</a> <a id="975" href="Ledger.Conway.Specification.Transaction.html#2077" class="Function">govStructure</a>
<a id="988" class="Keyword">open</a> <a id="993" class="Keyword">import</a> <a id="1000" href="Ledger.Conway.Conformance.Rewards.html" class="Module">Ledger.Conway.Conformance.Rewards</a> <a id="1034" href="Ledger.Conway.Conformance.Epoch.html#169" class="Bound">txs</a> <a id="1038" href="Ledger.Conway.Conformance.Epoch.html#213" class="Bound">abs</a>
<a id="1042" class="Keyword">open</a> <a id="1047" class="Keyword">import</a> <a id="1054" href="Ledger.Conway.Specification.Epoch.html" class="Module">Ledger.Conway.Specification.Epoch</a> <a id="1088" href="Ledger.Conway.Conformance.Epoch.html#169" class="Bound">txs</a> <a id="1092" href="Ledger.Conway.Conformance.Epoch.html#213" class="Bound">abs</a>
  <a id="1098" class="Keyword">using</a> <a id="1104" class="Symbol">(</a><a id="1105" href="Ledger.Conway.Specification.Epoch.html#5352" class="Function">getStakeCred</a><a id="1117" class="Symbol">;</a> <a id="1119" href="Ledger.Conway.Specification.Epoch.html#13061" class="Function">getOrphans</a><a id="1129" class="Symbol">;</a> <a id="1131" href="Ledger.Conway.Specification.Epoch.html#12370" class="Function">mkStakeDistrs</a><a id="1144" class="Symbol">;</a> <a id="1146" href="Ledger.Conway.Specification.Epoch.html#5265" class="Function">toRwdAddr</a><a id="1155" class="Symbol">)</a> <a id="1157" class="Keyword">public</a>
<a id="1164" class="Keyword">import</a> <a id="1171" href="Ledger.Conway.Specification.Epoch.html" class="Module">Ledger.Conway.Specification.Epoch</a> <a id="1205" href="Ledger.Conway.Conformance.Epoch.html#169" class="Bound">txs</a> <a id="1209" href="Ledger.Conway.Conformance.Epoch.html#213" class="Bound">abs</a> <a id="1213" class="Symbol">as</a> <a id="EpochSpec"></a><a id="1216" href="Ledger.Conway.Conformance.Epoch.html#1216" class="Module">EpochSpec</a>

<a id="1227" class="Keyword">record</a> <a id="EpochState"></a><a id="1234" href="Ledger.Conway.Conformance.Epoch.html#1234" class="Record">EpochState</a> <a id="1245" class="Symbol">:</a> <a id="1247" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="1252" class="Keyword">where</a>
  <a id="1260" class="Keyword">constructor</a> <a id="⟦_,_,_,_,_⟧ᵉ&#39;"></a><a id="1272" href="Ledger.Conway.Conformance.Epoch.html#1272" class="InductiveConstructor Operator">⟦_,_,_,_,_⟧ᵉ&#39;</a>
  <a id="1288" class="Keyword">field</a>
    <a id="EpochState.acnt"></a><a id="1298" href="Ledger.Conway.Conformance.Epoch.html#1298" class="Field">acnt</a>       <a id="1309" class="Symbol">:</a> <a id="1311" href="Ledger.Conway.Specification.PParams.html#720" class="Record">Acnt</a>
    <a id="EpochState.ss"></a><a id="1320" href="Ledger.Conway.Conformance.Epoch.html#1320" class="Field">ss</a>         <a id="1331" class="Symbol">:</a> <a id="1333" href="Ledger.Conway.Specification.Rewards.html#7719" class="Record">Snapshots</a>
    <a id="EpochState.ls"></a><a id="1347" href="Ledger.Conway.Conformance.Epoch.html#1347" class="Field">ls</a>         <a id="1358" class="Symbol">:</a> <a id="1360" href="Ledger.Conway.Conformance.Ledger.html#779" class="Record">LState</a>
    <a id="EpochState.es"></a><a id="1371" href="Ledger.Conway.Conformance.Epoch.html#1371" class="Field">es</a>         <a id="1382" class="Symbol">:</a> <a id="1384" href="Ledger.Conway.Specification.Enact.html#448" class="Record">EnactState</a>
    <a id="EpochState.fut"></a><a id="1399" href="Ledger.Conway.Conformance.Epoch.html#1399" class="Field">fut</a>        <a id="1410" class="Symbol">:</a> <a id="1412" href="Ledger.Conway.Specification.Ratify.html#3530" class="Record">RatifyState</a>

<a id="PoolDelegatedStake"></a><a id="1425" href="Ledger.Conway.Conformance.Epoch.html#1425" class="Function">PoolDelegatedStake</a> <a id="1444" class="Symbol">:</a> <a id="1446" href="Agda.Primitive.html#388" class="Primitive">Type</a>
<a id="1451" href="Ledger.Conway.Conformance.Epoch.html#1425" class="Function">PoolDelegatedStake</a> <a id="1470" class="Symbol">=</a> <a id="1472" href="Ledger.Core.Specification.Crypto.html#1386" class="Function">KeyHash</a> <a id="1480" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="1482" href="Ledger.Prelude.Base.html#154" class="Function">Coin</a>

<a id="1488" class="Keyword">record</a> <a id="NewEpochState"></a><a id="1495" href="Ledger.Conway.Conformance.Epoch.html#1495" class="Record">NewEpochState</a> <a id="1509" class="Symbol">:</a> <a id="1511" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="1516" class="Keyword">where</a>
  <a id="1524" class="Keyword">field</a>
    <a id="NewEpochState.lastEpoch"></a><a id="1534" href="Ledger.Conway.Conformance.Epoch.html#1534" class="Field">lastEpoch</a>   <a id="1546" class="Symbol">:</a> <a id="1548" href="Ledger.Core.Specification.Epoch.html#646" class="Function">Epoch</a>
    <a id="NewEpochState.bprev"></a><a id="1558" href="Ledger.Conway.Conformance.Epoch.html#1558" class="Field">bprev</a>       <a id="1570" class="Symbol">:</a> <a id="1572" href="Ledger.Conway.Specification.Rewards.html#4906" class="Function">BlocksMade</a>
    <a id="NewEpochState.bcur"></a><a id="1587" href="Ledger.Conway.Conformance.Epoch.html#1587" class="Field">bcur</a>        <a id="1599" class="Symbol">:</a> <a id="1601" href="Ledger.Conway.Specification.Rewards.html#4906" class="Function">BlocksMade</a>
    <a id="NewEpochState.epochState"></a><a id="1616" href="Ledger.Conway.Conformance.Epoch.html#1616" class="Field">epochState</a>  <a id="1628" class="Symbol">:</a> <a id="1630" href="Ledger.Conway.Conformance.Epoch.html#1234" class="Record">EpochState</a>
    <a id="NewEpochState.ru"></a><a id="1645" href="Ledger.Conway.Conformance.Epoch.html#1645" class="Field">ru</a>          <a id="1657" class="Symbol">:</a> <a id="1659" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="1665" href="Ledger.Conway.Specification.Rewards.html#6249" class="Record">RewardUpdate</a>
    <a id="NewEpochState.pd"></a><a id="1682" href="Ledger.Conway.Conformance.Epoch.html#1682" class="Field">pd</a>          <a id="1694" class="Symbol">:</a> <a id="1696" href="Ledger.Conway.Conformance.Epoch.html#1425" class="Function">PoolDelegatedStake</a>

<a id="1716" class="Keyword">instance</a>
  <a id="1727" class="Keyword">unquoteDecl</a> <a id="HasCast-EpochState"></a><a id="1739" href="Ledger.Conway.Conformance.Epoch.html#1739" class="Function">HasCast-EpochState</a> <a id="HasCast-NewEpochState"></a><a id="1758" href="Ledger.Conway.Conformance.Epoch.html#1758" class="Function">HasCast-NewEpochState</a> <a id="1780" class="Symbol">=</a> <a id="1782" href="stdlib-classes.Class.HasCast.Derive.html#2690" class="Function">derive-HasCast</a>
    <a id="1801" class="Symbol">(</a> <a id="1803" class="Symbol">(</a><a id="1804" class="Keyword">quote</a> <a id="1810" href="Ledger.Conway.Conformance.Epoch.html#1234" class="Record">EpochState</a>     <a id="1825" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1827" href="Ledger.Conway.Conformance.Epoch.html#1739" class="Function">HasCast-EpochState</a><a id="1845" class="Symbol">)</a>
    <a id="1851" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="1853" href="Data.List.Base.html#4907" class="Function Operator">[</a> <a id="1855" class="Symbol">(</a><a id="1856" class="Keyword">quote</a> <a id="1862" href="Ledger.Conway.Conformance.Epoch.html#1495" class="Record">NewEpochState</a>  <a id="1877" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1879" href="Ledger.Conway.Conformance.Epoch.html#1758" class="Function">HasCast-NewEpochState</a><a id="1900" class="Symbol">)</a><a id="1901" href="Data.List.Base.html#4907" class="Function Operator">]</a><a id="1902" class="Symbol">)</a>

  <a id="EpochStateFromConf"></a><a id="1907" href="Ledger.Conway.Conformance.Epoch.html#1907" class="Function">EpochStateFromConf</a> <a id="1926" class="Symbol">:</a> <a id="1928" href="Ledger.Conway.Conformance.Epoch.html#1234" class="Record">EpochState</a> <a id="1939" href="Ledger.Conway.Conformance.Equivalence.Convert.html#409" class="Function Operator">⭆</a> <a id="1941" href="Ledger.Conway.Specification.Epoch.html#1837" class="Record">EpochSpec.EpochState</a>
  <a id="1964" href="Ledger.Conway.Conformance.Epoch.html#1907" class="Function">EpochStateFromConf</a> <a id="1983" class="Symbol">.</a><a id="1984" href="Ledger.Conway.Conformance.Equivalence.Convert.html#217" class="Field">convⁱ</a> <a id="1990" class="Symbol">_</a> <a id="1992" href="Ledger.Conway.Conformance.Epoch.html#1992" class="Bound">epochState</a> <a id="2003" class="Symbol">=</a>
    <a id="2009" class="Keyword">let</a> <a id="2013" class="Keyword">open</a> <a id="2018" href="Ledger.Conway.Conformance.Epoch.html#1234" class="Module">EpochState</a> <a id="2029" href="Ledger.Conway.Conformance.Epoch.html#1992" class="Bound">epochState</a> <a id="2040" class="Keyword">in</a>
    <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.Conway.Conformance.Epoch.html#1298}{\htmlId{2049}{\htmlClass{Field}{\text{acnt}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#1320}{\htmlId{2056}{\htmlClass{Field}{\text{ss}}}}\, \\ \,\href{Ledger.Conway.Conformance.Equivalence.Convert.html#452}{\htmlId{2061}{\htmlClass{Function}{\text{conv}}}}\, \,\href{Ledger.Conway.Conformance.Epoch.html#1347}{\htmlId{2066}{\htmlClass{Field}{\text{ls}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#1371}{\htmlId{2071}{\htmlClass{Field}{\text{es}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#1399}{\htmlId{2076}{\htmlClass{Field}{\text{fut}}}}\, \end{pmatrix}$</a>

  <a id="EpochStateToConf"></a><a id="2085" href="Ledger.Conway.Conformance.Epoch.html#2085" class="Function">EpochStateToConf</a> <a id="2102" class="Symbol">:</a> <a id="2104" href="Ledger.Conway.Specification.Epoch.html#1837" class="Record">EpochSpec.EpochState</a> <a id="2125" href="Ledger.Conway.Conformance.Equivalence.Convert.html#409" class="Function Operator">⭆</a> <a id="2127" href="Ledger.Conway.Conformance.Epoch.html#1234" class="Record">EpochState</a>
  <a id="2140" href="Ledger.Conway.Conformance.Epoch.html#2085" class="Function">EpochStateToConf</a> <a id="2157" class="Symbol">.</a><a id="2158" href="Ledger.Conway.Conformance.Equivalence.Convert.html#217" class="Field">convⁱ</a> <a id="2164" href="Ledger.Conway.Conformance.Epoch.html#2164" class="Bound">deposits</a> <a id="2173" href="Ledger.Conway.Conformance.Epoch.html#2173" class="Bound">epochSt</a> <a id="2181" class="Symbol">=</a>
    <a id="2187" class="Keyword">let</a> <a id="2191" class="Keyword">open</a> <a id="2196" href="Ledger.Conway.Specification.Epoch.html#1837" class="Module">EpochSpec.EpochState</a> <a id="2217" href="Ledger.Conway.Conformance.Epoch.html#2173" class="Bound">epochSt</a> <a id="2225" class="Keyword">in</a>
    <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.Conway.Specification.Epoch.html#1905}{\htmlId{2234}{\htmlClass{Field}{\text{acnt}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#1927}{\htmlId{2241}{\htmlClass{Field}{\text{ss}}}}\, \\ \,\href{Ledger.Conway.Conformance.Equivalence.Deposits.html#12794}{\htmlId{2246}{\htmlClass{Function}{\text{certDeposits}}}}\, \,\href{Ledger.Conway.Specification.Epoch.html#1954}{\htmlId{2259}{\htmlClass{Field}{\text{ls}}}}\, \,\href{Ledger.Conway.Conformance.Equivalence.Convert.html#270}{\htmlId{2262}{\htmlClass{Function Operator}{\text{⊢conv}}}}\, \,\href{Ledger.Conway.Specification.Epoch.html#1954}{\htmlId{2268}{\htmlClass{Field}{\text{ls}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#1978}{\htmlId{2273}{\htmlClass{Field}{\text{es}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#2006}{\htmlId{2278}{\htmlClass{Field}{\text{fut}}}}\, \end{pmatrix}$</a>

  <a id="NewEpochStateFromConf"></a><a id="2289" href="Ledger.Conway.Conformance.Epoch.html#2289" class="Function">NewEpochStateFromConf</a> <a id="2311" class="Symbol">:</a> <a id="2313" href="Ledger.Conway.Conformance.Epoch.html#1495" class="Record">NewEpochState</a> <a id="2327" href="Ledger.Conway.Conformance.Equivalence.Convert.html#409" class="Function Operator">⭆</a> <a id="2329" href="Ledger.Conway.Specification.Epoch.html#3364" class="Record">EpochSpec.NewEpochState</a>
  <a id="2355" href="Ledger.Conway.Conformance.Epoch.html#2289" class="Function">NewEpochStateFromConf</a> <a id="2377" class="Symbol">.</a><a id="2378" href="Ledger.Conway.Conformance.Equivalence.Convert.html#217" class="Field">convⁱ</a> <a id="2384" class="Symbol">_</a> <a id="2386" href="Ledger.Conway.Conformance.Epoch.html#2386" class="Bound">newEpochState</a> <a id="2400" class="Symbol">=</a>
    <a id="2406" class="Keyword">let</a> <a id="2410" class="Keyword">open</a> <a id="2415" href="Ledger.Conway.Conformance.Epoch.html#1495" class="Module">NewEpochState</a> <a id="2429" href="Ledger.Conway.Conformance.Epoch.html#2386" class="Bound">newEpochState</a> <a id="2443" class="Keyword">in</a>
    <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.Conway.Conformance.Epoch.html#1534}{\htmlId{2452}{\htmlClass{Field}{\text{lastEpoch}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#1558}{\htmlId{2464}{\htmlClass{Field}{\text{bprev}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#1587}{\htmlId{2472}{\htmlClass{Field}{\text{bcur}}}}\, \\ \,\href{Ledger.Conway.Conformance.Equivalence.Convert.html#452}{\htmlId{2479}{\htmlClass{Function}{\text{conv}}}}\, \,\href{Ledger.Conway.Conformance.Epoch.html#1616}{\htmlId{2484}{\htmlClass{Field}{\text{epochState}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#1645}{\htmlId{2497}{\htmlClass{Field}{\text{ru}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#1682}{\htmlId{2502}{\htmlClass{Field}{\text{pd}}}}\, \end{pmatrix}$</a>

  <a id="NewEpochStateToConf"></a><a id="2510" href="Ledger.Conway.Conformance.Epoch.html#2510" class="Function">NewEpochStateToConf</a> <a id="2530" class="Symbol">:</a> <a id="2532" href="Ledger.Conway.Specification.Epoch.html#3364" class="Record">EpochSpec.NewEpochState</a> <a id="2556" href="Ledger.Conway.Conformance.Equivalence.Convert.html#409" class="Function Operator">⭆</a> <a id="2558" href="Ledger.Conway.Conformance.Epoch.html#1495" class="Record">NewEpochState</a>
  <a id="2574" href="Ledger.Conway.Conformance.Epoch.html#2510" class="Function">NewEpochStateToConf</a> <a id="2594" class="Symbol">.</a><a id="2595" href="Ledger.Conway.Conformance.Equivalence.Convert.html#217" class="Field">convⁱ</a> <a id="2601" href="Ledger.Conway.Conformance.Epoch.html#2601" class="Bound">deposits</a> <a id="2610" href="Ledger.Conway.Conformance.Epoch.html#2610" class="Bound">newEpochSt</a> <a id="2621" class="Symbol">=</a>
    <a id="2627" class="Keyword">let</a> <a id="2631" class="Keyword">open</a> <a id="2636" href="Ledger.Conway.Specification.Epoch.html#3364" class="Module">EpochSpec.NewEpochState</a> <a id="2660" href="Ledger.Conway.Conformance.Epoch.html#2610" class="Bound">newEpochSt</a> <a id="2671" class="Keyword">in</a>
    <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.Conway.Specification.Epoch.html#3403}{\htmlId{2680}{\htmlClass{Field}{\text{lastEpoch}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#3456}{\htmlId{2692}{\htmlClass{Field}{\text{bcur}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#3427}{\htmlId{2699}{\htmlClass{Field}{\text{bprev}}}}\, \\ \,\href{Ledger.Conway.Conformance.Equivalence.Convert.html#452}{\htmlId{2707}{\htmlClass{Function}{\text{conv}}}}\, \,\href{Ledger.Conway.Specification.Epoch.html#3485}{\htmlId{2712}{\htmlClass{Field}{\text{epochState}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#3514}{\htmlId{2725}{\htmlClass{Field}{\text{ru}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#3551}{\htmlId{2730}{\htmlClass{Field}{\text{pd}}}}\, \end{pmatrix}$</a>


<a id="applyRUpd"></a><a id="2737" href="Ledger.Conway.Conformance.Epoch.html#2737" class="Function">applyRUpd</a> <a id="2747" class="Symbol">:</a> <a id="2749" href="Ledger.Conway.Specification.Rewards.html#6249" class="Record">RewardUpdate</a> <a id="2762" class="Symbol">→</a> <a id="2764" href="Ledger.Conway.Conformance.Epoch.html#1234" class="Record">EpochState</a> <a id="2775" class="Symbol">→</a> <a id="2777" href="Ledger.Conway.Conformance.Epoch.html#1234" class="Record">EpochState</a>
<a id="2788" href="Ledger.Conway.Conformance.Epoch.html#2737" class="Function">applyRUpd</a> <a id="2798" href="Ledger.Conway.Conformance.Epoch.html#2798" class="Bound">rewardUpdate</a>
  <a class="AgdaKaTeX">$\begin{pmatrix} \begin{pmatrix} \,\href{Ledger.Conway.Conformance.Epoch.html#2817}{\htmlId{2817}{\htmlClass{Bound}{\text{treasury}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#2828}{\htmlId{2828}{\htmlClass{Bound}{\text{reserves}}}}\, \end{pmatrix}
  \\ \,\href{Ledger.Conway.Conformance.Epoch.html#2844}{\htmlId{2844}{\htmlClass{Bound}{\text{ss}}}}\,
  \\ \begin{pmatrix} \begin{pmatrix} \,\href{Ledger.Conway.Conformance.Epoch.html#2855}{\htmlId{2855}{\htmlClass{Bound}{\text{utxo}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#2862}{\htmlId{2862}{\htmlClass{Bound}{\text{fees}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#2869}{\htmlId{2869}{\htmlClass{Bound}{\text{deposits}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#2880}{\htmlId{2880}{\htmlClass{Bound}{\text{donations}}}}\, \end{pmatrix}
    \\ \,\href{Ledger.Conway.Conformance.Epoch.html#2899}{\htmlId{2899}{\htmlClass{Bound}{\text{govSt}}}}\,
    \\ \begin{pmatrix} \begin{pmatrix} \,\href{Ledger.Conway.Conformance.Epoch.html#2915}{\htmlId{2915}{\htmlClass{Bound}{\text{voteDelegs}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#2928}{\htmlId{2928}{\htmlClass{Bound}{\text{stakeDelegs}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#2942}{\htmlId{2942}{\htmlClass{Bound}{\text{rewards}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#2952}{\htmlId{2952}{\htmlClass{Bound}{\text{deposits&#39;}}}}\, \end{pmatrix} \\ \,\href{Ledger.Conway.Conformance.Epoch.html#2967}{\htmlId{2967}{\htmlClass{Bound}{\text{pState}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#2976}{\htmlId{2976}{\htmlClass{Bound}{\text{gState}}}}\, \end{pmatrix} \end{pmatrix}
  \\ \,\href{Ledger.Conway.Conformance.Epoch.html#2994}{\htmlId{2994}{\htmlClass{Bound}{\text{es}}}}\,
  \\ \,\href{Ledger.Conway.Conformance.Epoch.html#3001}{\htmlId{3001}{\htmlClass{Bound}{\text{fut}}}}\,
  \end{pmatrix}$</a> <a id="3011" class="Symbol">=</a>
  <a class="AgdaKaTeX">$\begin{pmatrix} \begin{pmatrix} \,\href{Prelude.html#3280}{\htmlId{3019}{\htmlClass{Function}{\text{posPart}}}}\, \,\htmlId{3027}{\htmlClass{Symbol}{\text{(}}}\,\,\href{Ledger.Conway.Conformance.Epoch.html#357}{\htmlId{3028}{\htmlClass{InductiveConstructor}{\text{pos}}}}\, \,\href{Ledger.Conway.Conformance.Epoch.html#2817}{\htmlId{3032}{\htmlClass{Bound}{\text{treasury}}}}\, \,\href{Class.HasAdd.Core.html#162}{\htmlId{3041}{\htmlClass{Field Operator}{\text{+}}}}\, \,\href{Ledger.Conway.Specification.Rewards.html#6286}{\htmlId{3043}{\htmlClass{Function}{\text{Δt}}}}\, \,\href{Class.HasAdd.Core.html#162}{\htmlId{3046}{\htmlClass{Field Operator}{\text{+}}}}\, \,\href{Ledger.Conway.Conformance.Epoch.html#357}{\htmlId{3048}{\htmlClass{InductiveConstructor}{\text{pos}}}}\, \,\href{Ledger.Conway.Conformance.Epoch.html#3426}{\htmlId{3052}{\htmlClass{Function}{\text{unregRU&#39;}}}}\,\,\htmlId{3060}{\htmlClass{Symbol}{\text{)}}}\,
    \\ \,\href{Prelude.html#3280}{\htmlId{3068}{\htmlClass{Function}{\text{posPart}}}}\, \,\htmlId{3076}{\htmlClass{Symbol}{\text{(}}}\,\,\href{Ledger.Conway.Conformance.Epoch.html#357}{\htmlId{3077}{\htmlClass{InductiveConstructor}{\text{pos}}}}\, \,\href{Ledger.Conway.Conformance.Epoch.html#2828}{\htmlId{3081}{\htmlClass{Bound}{\text{reserves}}}}\, \,\href{Class.HasAdd.Core.html#162}{\htmlId{3090}{\htmlClass{Field Operator}{\text{+}}}}\, \,\href{Ledger.Conway.Specification.Rewards.html#6289}{\htmlId{3092}{\htmlClass{Function}{\text{Δr}}}}\,\,\htmlId{3094}{\htmlClass{Symbol}{\text{)}}}\, \end{pmatrix}
  \\ \,\href{Ledger.Conway.Conformance.Epoch.html#2844}{\htmlId{3102}{\htmlClass{Bound}{\text{ss}}}}\,
  \\ \begin{pmatrix} \begin{pmatrix} \,\href{Ledger.Conway.Conformance.Epoch.html#2855}{\htmlId{3113}{\htmlClass{Bound}{\text{utxo}}}}\, \\ \,\href{Prelude.html#3280}{\htmlId{3120}{\htmlClass{Function}{\text{posPart}}}}\, \,\htmlId{3128}{\htmlClass{Symbol}{\text{(}}}\,\,\href{Ledger.Conway.Conformance.Epoch.html#357}{\htmlId{3129}{\htmlClass{InductiveConstructor}{\text{pos}}}}\, \,\href{Ledger.Conway.Conformance.Epoch.html#2862}{\htmlId{3133}{\htmlClass{Bound}{\text{fees}}}}\, \,\href{Class.HasAdd.Core.html#162}{\htmlId{3138}{\htmlClass{Field Operator}{\text{+}}}}\, \,\href{Ledger.Conway.Specification.Rewards.html#6292}{\htmlId{3140}{\htmlClass{Function}{\text{Δf}}}}\,\,\htmlId{3142}{\htmlClass{Symbol}{\text{)}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#2869}{\htmlId{3146}{\htmlClass{Bound}{\text{deposits}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#2880}{\htmlId{3157}{\htmlClass{Bound}{\text{donations}}}}\, \end{pmatrix}
    \\ \,\href{Ledger.Conway.Conformance.Epoch.html#2899}{\htmlId{3175}{\htmlClass{Bound}{\text{govSt}}}}\,
    \\ \begin{pmatrix} \begin{pmatrix} \,\href{Ledger.Conway.Conformance.Epoch.html#2915}{\htmlId{3191}{\htmlClass{Bound}{\text{voteDelegs}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#2928}{\htmlId{3204}{\htmlClass{Bound}{\text{stakeDelegs}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#2942}{\htmlId{3218}{\htmlClass{Bound}{\text{rewards}}}}\, \,\href{Axiom.Set.Map.Dec.html#2149}{\htmlId{3226}{\htmlClass{Function Operator}{\text{∪⁺}}}}\, \,\href{Ledger.Conway.Conformance.Epoch.html#3358}{\htmlId{3229}{\htmlClass{Function}{\text{regRU}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#2952}{\htmlId{3237}{\htmlClass{Bound}{\text{deposits&#39;}}}}\, \end{pmatrix} \\ \,\href{Ledger.Conway.Conformance.Epoch.html#2967}{\htmlId{3251}{\htmlClass{Bound}{\text{pState}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#2976}{\htmlId{3260}{\htmlClass{Bound}{\text{gState}}}}\, \end{pmatrix} \end{pmatrix}
  \\ \,\href{Ledger.Conway.Conformance.Epoch.html#2994}{\htmlId{3275}{\htmlClass{Bound}{\text{es}}}}\,
  \\ \,\href{Ledger.Conway.Conformance.Epoch.html#3001}{\htmlId{3282}{\htmlClass{Bound}{\text{fut}}}}\, \end{pmatrix}$</a>
  <a id="3290" class="Keyword">where</a>
    <a id="3300" class="Keyword">open</a> <a id="3305" href="Ledger.Conway.Specification.Rewards.html#6249" class="Module">RewardUpdate</a> <a id="3318" href="Ledger.Conway.Conformance.Epoch.html#2798" class="Bound">rewardUpdate</a> <a id="3331" class="Keyword">using</a> <a id="3337" class="Symbol">(</a><a id="3338" href="Ledger.Conway.Specification.Rewards.html#6286" class="Field">Δt</a><a id="3340" class="Symbol">;</a> <a id="3342" href="Ledger.Conway.Specification.Rewards.html#6289" class="Field">Δr</a><a id="3344" class="Symbol">;</a> <a id="3346" href="Ledger.Conway.Specification.Rewards.html#6292" class="Field">Δf</a><a id="3348" class="Symbol">;</a> <a id="3350" href="Ledger.Conway.Specification.Rewards.html#6312" class="Field">rs</a><a id="3352" class="Symbol">)</a>
    <a id="3358" href="Ledger.Conway.Conformance.Epoch.html#3358" class="Function">regRU</a>     <a id="3368" class="Symbol">=</a> <a id="3370" href="Ledger.Conway.Specification.Rewards.html#6312" class="Function">rs</a> <a id="3373" href="Axiom.Set.Map.html#13534" class="Function Operator">∣</a> <a id="3375" href="Class.IsSet.html#916" class="Function">dom</a> <a id="3379" href="Ledger.Conway.Conformance.Epoch.html#2942" class="Bound">rewards</a>
    <a id="3391" href="Ledger.Conway.Conformance.Epoch.html#3391" class="Function">unregRU</a>   <a id="3401" class="Symbol">=</a> <a id="3403" href="Ledger.Conway.Specification.Rewards.html#6312" class="Function">rs</a> <a id="3406" href="Axiom.Set.Map.html#13604" class="Function Operator">∣</a> <a id="3408" href="Class.IsSet.html#916" class="Function">dom</a> <a id="3412" href="Ledger.Conway.Conformance.Epoch.html#2942" class="Bound">rewards</a> <a id="3420" href="Axiom.Set.Map.html#13604" class="Function Operator">ᶜ</a>
    <a id="3426" href="Ledger.Conway.Conformance.Epoch.html#3426" class="Function">unregRU&#39;</a>  <a id="3436" class="Symbol">=</a> <a id="3438" href="abstract-set-theory.FiniteSetTheory.html#4373" class="Function">∑[</a> <a id="3441" href="Ledger.Conway.Conformance.Epoch.html#3441" class="Bound">x</a> <a id="3443" href="abstract-set-theory.FiniteSetTheory.html#4373" class="Function">←</a> <a id="3445" href="Ledger.Conway.Conformance.Epoch.html#3391" class="Function">unregRU</a> <a id="3453" href="abstract-set-theory.FiniteSetTheory.html#4373" class="Function">]</a> <a id="3455" href="Ledger.Conway.Conformance.Epoch.html#3441" class="Bound">x</a>

<a id="3458" class="Keyword">opaque</a>
  <a id="calculatePoolDelegatedStake"></a><a id="3467" href="Ledger.Conway.Conformance.Epoch.html#3467" class="Function">calculatePoolDelegatedStake</a> <a id="3495" class="Symbol">:</a> <a id="3497" href="Ledger.Conway.Specification.Rewards.html#6472" class="Record">Snapshot</a> <a id="3506" class="Symbol">→</a> <a id="3508" href="Ledger.Conway.Conformance.Epoch.html#1425" class="Function">PoolDelegatedStake</a>
  <a id="3529" href="Ledger.Conway.Conformance.Epoch.html#3467" class="Function">calculatePoolDelegatedStake</a> <a id="3557" href="Ledger.Conway.Conformance.Epoch.html#3557" class="Bound">ss</a> <a id="3560" class="Symbol">=</a>
      <a id="3568" class="Comment">-- Shelley spec: the output map must contain keys appearing in both</a>
      <a id="3642" class="Comment">-- sd and the pool parameters.</a>
      <a id="3679" href="Ledger.Conway.Conformance.Epoch.html#3935" class="Function">sd</a> <a id="3682" href="Axiom.Set.Map.html#13534" class="Function Operator">∣</a> <a id="3684" href="Class.IsSet.html#916" class="Function">dom</a> <a id="3688" class="Symbol">(</a><a id="3689" href="Ledger.Conway.Conformance.Epoch.html#3557" class="Bound">ss</a> <a id="3692" class="Symbol">.</a><a id="3693" href="Ledger.Conway.Specification.Rewards.html#6561" class="Field">pools</a><a id="3698" class="Symbol">)</a>
    <a id="3704" class="Keyword">where</a>
      <a id="3716" class="Keyword">open</a> <a id="3721" href="Ledger.Conway.Specification.Rewards.html#6472" class="Module">Snapshot</a>

      <a id="3737" class="Comment">-- stake credentials delegating to each pool</a>
      <a id="3788" href="Ledger.Conway.Conformance.Epoch.html#3788" class="Function">stakeCredentialsPerPool</a> <a id="3812" class="Symbol">:</a> <a id="3814" href="Axiom.Set.Rel.html#1312" class="Function">Rel</a> <a id="3818" href="Ledger.Core.Specification.Crypto.html#1386" class="Function">KeyHash</a> <a id="3826" href="Ledger.Core.Specification.Address.html#259" class="Datatype">Credential</a>
      <a id="3843" href="Ledger.Conway.Conformance.Epoch.html#3788" class="Function">stakeCredentialsPerPool</a> <a id="3867" class="Symbol">=</a> <a id="3869" class="Symbol">(</a><a id="3870" href="Ledger.Conway.Specification.Certs.html#2010" class="Field">StakeDelegsOf</a> <a id="3884" href="Ledger.Conway.Conformance.Epoch.html#3557" class="Bound">ss</a> <a id="3887" href="Axiom.Set.Map.html#2293" class="Function Operator">ˢ</a><a id="3888" class="Symbol">)</a> <a id="3890" href="Axiom.Set.Rel.html#1608" class="Function Operator">⁻¹ʳ</a>

      <a id="3901" class="Comment">-- delegated stake per pool</a>
      <a id="3935" href="Ledger.Conway.Conformance.Epoch.html#3935" class="Function">sd</a> <a id="3938" class="Symbol">:</a> <a id="3940" href="Ledger.Core.Specification.Crypto.html#1386" class="Function">KeyHash</a> <a id="3948" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="3950" href="Ledger.Prelude.Base.html#154" class="Function">Coin</a>
      <a id="3961" href="Ledger.Conway.Conformance.Epoch.html#3935" class="Function">sd</a> <a id="3964" class="Symbol">=</a> <a id="3966" href="Axiom.Set.Map.Dec.html#2227" class="Function">aggregate₊</a> <a id="3977" class="Symbol">((</a><a id="3979" href="Ledger.Conway.Conformance.Epoch.html#3788" class="Function">stakeCredentialsPerPool</a> <a id="4003" href="abstract-set-theory.FiniteSetTheory.html#3111" class="Function Operator">∘ʳ</a> <a id="4006" class="Symbol">(</a><a id="4007" href="Ledger.Conway.Specification.Certs.html#1926" class="Field">StakeOf</a> <a id="4015" href="Ledger.Conway.Conformance.Epoch.html#3557" class="Bound">ss</a> <a id="4018" href="Axiom.Set.Map.html#2293" class="Function Operator">ˢ</a><a id="4019" class="Symbol">))</a> <a id="4022" href="abstract-set-theory.FiniteSetTheory.html#2921" class="Function Operator">ᶠˢ</a><a id="4024" class="Symbol">)</a>


<a id="4028" class="Keyword">private</a> <a id="4036" class="Keyword">variable</a>
  <a id="4047" href="Ledger.Conway.Conformance.Epoch.html#4047" class="Generalizable">nes</a> <a id="4051" href="Ledger.Conway.Conformance.Epoch.html#4051" class="Generalizable">nes&#39;</a> <a id="4056" class="Symbol">:</a> <a id="4058" href="Ledger.Conway.Conformance.Epoch.html#1495" class="Record">NewEpochState</a>
  <a id="4074" href="Ledger.Conway.Conformance.Epoch.html#4074" class="Generalizable">e</a> <a id="4076" href="Ledger.Conway.Conformance.Epoch.html#4076" class="Generalizable">lastEpoch</a> <a id="4086" class="Symbol">:</a> <a id="4088" href="Ledger.Core.Specification.Epoch.html#646" class="Function">Epoch</a>
  <a id="4096" href="Ledger.Conway.Conformance.Epoch.html#4096" class="Generalizable">fut</a> <a id="4100" href="Ledger.Conway.Conformance.Epoch.html#4100" class="Generalizable">fut&#39;</a> <a id="4105" class="Symbol">:</a> <a id="4107" href="Ledger.Conway.Specification.Ratify.html#3530" class="Record">RatifyState</a>
  <a id="4121" href="Ledger.Conway.Conformance.Epoch.html#4121" class="Generalizable">eps</a> <a id="4125" href="Ledger.Conway.Conformance.Epoch.html#4125" class="Generalizable">eps&#39;</a> <a id="4130" href="Ledger.Conway.Conformance.Epoch.html#4130" class="Generalizable">eps&#39;&#39;</a> <a id="4136" class="Symbol">:</a> <a id="4138" href="Ledger.Conway.Conformance.Epoch.html#1234" class="Record">EpochState</a>
  <a id="4151" href="Ledger.Conway.Conformance.Epoch.html#4151" class="Generalizable">ls</a> <a id="4154" class="Symbol">:</a> <a id="4156" href="Ledger.Conway.Conformance.Ledger.html#779" class="Record">LState</a>
  <a id="4165" href="Ledger.Conway.Conformance.Epoch.html#4165" class="Generalizable">acnt</a> <a id="4170" class="Symbol">:</a> <a id="4172" href="Ledger.Conway.Specification.PParams.html#720" class="Record">Acnt</a>
  <a id="4179" href="Ledger.Conway.Conformance.Epoch.html#4179" class="Generalizable">es₀</a> <a id="4183" class="Symbol">:</a> <a id="4185" href="Ledger.Conway.Specification.Enact.html#448" class="Record">EnactState</a>
  <a id="4198" href="Ledger.Conway.Conformance.Epoch.html#4198" class="Generalizable">mark</a> <a id="4203" href="Ledger.Conway.Conformance.Epoch.html#4203" class="Generalizable">set</a> <a id="4207" href="Ledger.Conway.Conformance.Epoch.html#4207" class="Generalizable">go</a> <a id="4210" class="Symbol">:</a> <a id="4212" href="Ledger.Conway.Specification.Rewards.html#6472" class="Record">Snapshot</a>
  <a id="4223" href="Ledger.Conway.Conformance.Epoch.html#4223" class="Generalizable">feeSS</a> <a id="4229" class="Symbol">:</a> <a id="4231" href="Ledger.Prelude.Base.html#154" class="Function">Coin</a>
  <a id="4238" href="Ledger.Conway.Conformance.Epoch.html#4238" class="Generalizable">lstate</a> <a id="4245" class="Symbol">:</a> <a id="4247" href="Ledger.Conway.Conformance.Ledger.html#779" class="Record">LState</a>
  <a id="4256" href="Ledger.Conway.Conformance.Epoch.html#4256" class="Generalizable">ss</a> <a id="4259" href="Ledger.Conway.Conformance.Epoch.html#4259" class="Generalizable">ss&#39;</a> <a id="4263" class="Symbol">:</a> <a id="4265" href="Ledger.Conway.Specification.Rewards.html#7719" class="Record">Snapshots</a>
  <a id="4277" href="Ledger.Conway.Conformance.Epoch.html#4277" class="Generalizable">ru</a> <a id="4280" class="Symbol">:</a> <a id="4282" href="Ledger.Conway.Specification.Rewards.html#6249" class="Record">RewardUpdate</a>
  <a id="4297" href="Ledger.Conway.Conformance.Epoch.html#4297" class="Generalizable">mru</a> <a id="4301" class="Symbol">:</a> <a id="4303" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="4309" href="Ledger.Conway.Specification.Rewards.html#6249" class="Record">RewardUpdate</a>
  <a id="4324" href="Ledger.Conway.Conformance.Epoch.html#4324" class="Generalizable">certState&#39;</a> <a id="4335" class="Symbol">:</a> <a id="4337" href="Ledger.Conway.Conformance.Certs.html#956" class="Record">CertState</a>

<a id="4348" class="Keyword">data</a> <a id="_⊢_⇀⦇_,EPOCH⦈_"></a><a id="4353" href="Ledger.Conway.Conformance.Epoch.html#4353" class="Datatype Operator">_⊢_⇀⦇_,EPOCH⦈_</a> <a id="4368" class="Symbol">:</a> <a id="4370" href="Agda.Builtin.Unit.html#175" class="Record">⊤</a> <a id="4372" class="Symbol">→</a> <a id="4374" href="Ledger.Conway.Conformance.Epoch.html#1234" class="Record">EpochState</a> <a id="4385" class="Symbol">→</a> <a id="4387" href="Ledger.Core.Specification.Epoch.html#646" class="Function">Epoch</a> <a id="4393" class="Symbol">→</a> <a id="4395" href="Ledger.Conway.Conformance.Epoch.html#1234" class="Record">EpochState</a> <a id="4406" class="Symbol">→</a> <a id="4408" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="4413" class="Keyword">where</a>

  <a id="_⊢_⇀⦇_,EPOCH⦈_.EPOCH"></a><a id="4422" href="Ledger.Conway.Conformance.Epoch.html#4422" class="InductiveConstructor">EPOCH</a> <a id="4428" class="Symbol">:</a> <a id="4430" class="Keyword">let</a>
      <a id="4440" class="Keyword">open</a> <a id="4445" href="Ledger.Conway.Conformance.Ledger.html#779" class="Module">LState</a> <a id="4452" href="Ledger.Conway.Conformance.Epoch.html#4151" class="Generalizable">ls</a>
      <a id="4461" class="Keyword">open</a> <a id="4466" href="Ledger.Conway.Conformance.Certs.html#956" class="Module">CertState</a> <a id="4476" href="Ledger.Conway.Conformance.Ledger.html#887" class="Function">certState</a>
      <a id="4492" class="Keyword">open</a> <a id="4497" href="Ledger.Conway.Specification.Ratify.html#3530" class="Module">RatifyState</a> <a id="4509" href="Ledger.Conway.Conformance.Epoch.html#4096" class="Generalizable">fut</a> <a id="4513" class="Keyword">renaming</a> <a id="4522" class="Symbol">(</a><a id="4523" href="Ledger.Conway.Specification.Ratify.html#3567" class="Field">es</a> <a id="4526" class="Symbol">to</a> <a id="4529" class="Field">esW</a><a id="4532" class="Symbol">)</a>
      <a id="4540" class="Keyword">open</a> <a id="4545" href="Ledger.Conway.Specification.Utxo.html#1230" class="Module">UTxOState</a>
      <a id="4561" class="Keyword">open</a> <a id="4566" href="Ledger.Conway.Specification.Certs.html#4048" class="Module">PState</a><a id="4572" class="Symbol">;</a> <a id="4574" class="Keyword">open</a> <a id="4579" href="Ledger.Conway.Conformance.Certs.html#602" class="Module">DState</a><a id="4585" class="Symbol">;</a> <a id="4587" class="Keyword">open</a> <a id="4592" href="Ledger.Conway.Conformance.Certs.html#788" class="Module">GState</a>
      <a id="4605" class="Keyword">open</a> <a id="4610" href="Ledger.Conway.Specification.PParams.html#720" class="Module">Acnt</a><a id="4614" class="Symbol">;</a> <a id="4616" class="Keyword">open</a> <a id="4621" href="Ledger.Conway.Specification.Enact.html#448" class="Module">EnactState</a><a id="4631" class="Symbol">;</a> <a id="4633" class="Keyword">open</a> <a id="4638" href="Ledger.Conway.Specification.Gov.Actions.html#3815" class="Module">GovActionState</a>

      <a id="4660" href="Ledger.Conway.Conformance.Epoch.html#4660" class="Bound">es</a> <a id="4663" class="Symbol">:</a> <a id="4665" href="Ledger.Conway.Specification.Enact.html#448" class="Record">EnactState</a>
      <a id="4682" href="Ledger.Conway.Conformance.Epoch.html#4660" class="Bound">es</a> <a id="4685" class="Symbol">=</a> <a id="4687" class="Keyword">record</a> <a id="4694" href="Ledger.Conway.Conformance.Epoch.html#4529" class="Function">esW</a> <a id="4698" class="Symbol">{</a> <a id="4700" href="Ledger.Conway.Specification.Enact.html#700" class="Field">withdrawals</a> <a id="4712" class="Symbol">=</a> <a id="4714" href="Class.HasEmptySet.html#287" class="Field">∅</a> <a id="4716" class="Symbol">}</a>

      <a id="4725" href="Ledger.Conway.Conformance.Epoch.html#4725" class="Bound">tmpGovSt</a> <a id="4734" class="Symbol">=</a> <a id="4736" href="Data.List.Base.html#10389" class="Function">filter</a> <a id="4743" class="Symbol">(λ</a> <a id="4746" href="Ledger.Conway.Conformance.Epoch.html#4746" class="Bound">x</a> <a id="4748" class="Symbol">→</a> <a id="4750" href="Class.Decidable.Core.html#470" class="Function Operator">¿</a> <a id="4752" href="Data.Product.Base.html#636" class="Field">proj₁</a> <a id="4758" href="Ledger.Conway.Conformance.Epoch.html#4746" class="Bound">x</a> <a id="4760" href="Class.IsSet.html#462" class="Function Operator">∉</a> <a id="4762" href="abstract-set-theory.FiniteSetTheory.html#519" class="Function">mapˢ</a> <a id="4767" href="Data.Product.Base.html#636" class="Field">proj₁</a> <a id="4773" href="Ledger.Conway.Specification.Ratify.html#3593" class="Function">removed</a> <a id="4781" href="Class.Decidable.Core.html#470" class="Function Operator">¿</a><a id="4782" class="Symbol">)</a> <a id="4784" href="Ledger.Conway.Conformance.Ledger.html#861" class="Function">govSt</a>

      <a id="4797" href="Ledger.Conway.Conformance.Epoch.html#4797" class="Bound">orphans</a> <a id="4805" class="Symbol">:</a> <a id="4807" href="abstract-set-theory.FiniteSetTheory.html#488" class="Function Operator">ℙ</a> <a id="4809" class="Symbol">(</a><a id="4810" href="Ledger.Conway.Specification.Gov.Actions.html#1979" class="Function">GovActionID</a> <a id="4822" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="4824" href="Ledger.Conway.Specification.Gov.Actions.html#3815" class="Record">GovActionState</a><a id="4838" class="Symbol">)</a>
      <a id="4846" href="Ledger.Conway.Conformance.Epoch.html#4797" class="Bound">orphans</a>  <a id="4855" class="Symbol">=</a> <a id="4857" href="Axiom.Set.html#5903" class="Function">fromList</a> <a id="4866" class="Symbol">(</a><a id="4867" href="Ledger.Conway.Specification.Epoch.html#13061" class="Function">getOrphans</a> <a id="4878" href="Ledger.Conway.Conformance.Epoch.html#4660" class="Bound">es</a> <a id="4881" href="Ledger.Conway.Conformance.Epoch.html#4725" class="Bound">tmpGovSt</a><a id="4889" class="Symbol">)</a>

      <a id="4898" href="Ledger.Conway.Conformance.Epoch.html#4898" class="Bound">removed&#39;</a> <a id="4907" class="Symbol">:</a> <a id="4909" href="abstract-set-theory.FiniteSetTheory.html#488" class="Function Operator">ℙ</a> <a id="4911" class="Symbol">(</a><a id="4912" href="Ledger.Conway.Specification.Gov.Actions.html#1979" class="Function">GovActionID</a> <a id="4924" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="4926" href="Ledger.Conway.Specification.Gov.Actions.html#3815" class="Record">GovActionState</a><a id="4940" class="Symbol">)</a>
      <a id="4948" href="Ledger.Conway.Conformance.Epoch.html#4898" class="Bound">removed&#39;</a> <a id="4957" class="Symbol">=</a> <a id="4959" href="Ledger.Conway.Specification.Ratify.html#3593" class="Function">removed</a> <a id="4967" href="Axiom.Set.html#9137" class="Function Operator">∪</a> <a id="4969" href="Ledger.Conway.Conformance.Epoch.html#4797" class="Bound">orphans</a>

      <a id="4984" href="Ledger.Conway.Conformance.Epoch.html#4984" class="Bound">govSt&#39;</a> <a id="4991" class="Symbol">=</a> <a id="4993" href="Data.List.Base.html#10389" class="Function">filter</a> <a id="5000" class="Symbol">(λ</a> <a id="5003" href="Ledger.Conway.Conformance.Epoch.html#5003" class="Bound">x</a> <a id="5005" class="Symbol">→</a> <a id="5007" href="Class.Decidable.Core.html#470" class="Function Operator">¿</a> <a id="5009" href="Data.Product.Base.html#636" class="Field">proj₁</a> <a id="5015" href="Ledger.Conway.Conformance.Epoch.html#5003" class="Bound">x</a> <a id="5017" href="Class.IsSet.html#462" class="Function Operator">∉</a> <a id="5019" href="abstract-set-theory.FiniteSetTheory.html#519" class="Function">mapˢ</a> <a id="5024" href="Data.Product.Base.html#636" class="Field">proj₁</a> <a id="5030" href="Ledger.Conway.Conformance.Epoch.html#4898" class="Bound">removed&#39;</a> <a id="5039" href="Class.Decidable.Core.html#470" class="Function Operator">¿</a><a id="5040" class="Symbol">)</a> <a id="5042" href="Ledger.Conway.Conformance.Ledger.html#861" class="Function">govSt</a>

      <a id="5055" href="Ledger.Conway.Conformance.Epoch.html#5055" class="Bound">removedGovActions</a> <a id="5073" class="Symbol">:</a> <a id="5075" href="abstract-set-theory.FiniteSetTheory.html#488" class="Function Operator">ℙ</a> <a id="5077" class="Symbol">(</a><a id="5078" href="Ledger.Core.Specification.Address.html#1313" class="Record">RwdAddr</a> <a id="5086" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="5088" href="Ledger.Conway.Specification.Certs.html#565" class="Datatype">DepositPurpose</a> <a id="5103" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="5105" href="Ledger.Prelude.Base.html#154" class="Function">Coin</a><a id="5109" class="Symbol">)</a>
      <a id="5117" href="Ledger.Conway.Conformance.Epoch.html#5055" class="Bound">removedGovActions</a> <a id="5135" class="Symbol">=</a>
        <a id="5145" href="Function.Base.html#1657" class="Function">flip</a> <a id="5150" href="Axiom.Set.html#7207" class="Function">concatMapˢ</a> <a id="5161" href="Ledger.Conway.Conformance.Epoch.html#4898" class="Bound">removed&#39;</a> <a id="5170" class="Symbol">λ</a> <a id="5172" class="Symbol">(</a><a id="5173" href="Ledger.Conway.Conformance.Epoch.html#5173" class="Bound">gaid</a> <a id="5178" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5180" href="Ledger.Conway.Conformance.Epoch.html#5180" class="Bound">gaSt</a><a id="5184" class="Symbol">)</a> <a id="5186" class="Symbol">→</a>
          <a id="5198" href="abstract-set-theory.FiniteSetTheory.html#519" class="Function">mapˢ</a>
            <a id="5215" class="Symbol">(</a><a id="5216" href="Ledger.Conway.Specification.Gov.Actions.html#3882" class="Field">returnAddr</a> <a id="5227" href="Ledger.Conway.Conformance.Epoch.html#5180" class="Bound">gaSt</a> <a id="5232" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,_</a><a id="5234" class="Symbol">)</a>
            <a id="5248" class="Symbol">((</a><a id="5250" href="Ledger.Conway.Conformance.Ledger.html#834" class="Function">utxoSt</a> <a id="5257" class="Symbol">.</a><a id="5258" href="Ledger.Conway.Specification.Utxo.html#1338" class="Field">deposits</a> <a id="5267" href="Axiom.Set.Map.html#13534" class="Function Operator">∣</a> <a id="5269" href="Class.HasSingleton.html#288" class="Field Operator">❴</a> <a id="5271" href="Ledger.Conway.Specification.Certs.html#754" class="InductiveConstructor">GovActionDeposit</a> <a id="5288" href="Ledger.Conway.Conformance.Epoch.html#5173" class="Bound">gaid</a> <a id="5293" href="Class.HasSingleton.html#288" class="Field Operator">❵</a><a id="5294" class="Symbol">)</a> <a id="5296" href="Axiom.Set.Map.html#2293" class="Function Operator">ˢ</a><a id="5297" class="Symbol">)</a>

      <a id="5306" href="Ledger.Conway.Conformance.Epoch.html#5306" class="Bound">govActionReturns</a> <a id="5323" class="Symbol">:</a> <a id="5325" href="Ledger.Core.Specification.Address.html#1313" class="Record">RwdAddr</a> <a id="5333" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="5335" href="Ledger.Prelude.Base.html#154" class="Function">Coin</a>
      <a id="5346" href="Ledger.Conway.Conformance.Epoch.html#5306" class="Bound">govActionReturns</a> <a id="5363" class="Symbol">=</a>
        <a id="5373" href="Axiom.Set.Map.Dec.html#2227" class="Function">aggregate₊</a> <a id="5384" class="Symbol">(</a><a id="5385" href="abstract-set-theory.FiniteSetTheory.html#519" class="Function">mapˢ</a> <a id="5390" class="Symbol">(λ</a> <a id="5393" class="Symbol">(</a><a id="5394" href="Ledger.Conway.Conformance.Epoch.html#5394" class="Bound">a</a> <a id="5396" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5398" class="Symbol">_</a> <a id="5400" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5402" href="Ledger.Conway.Conformance.Epoch.html#5402" class="Bound">d</a><a id="5403" class="Symbol">)</a> <a id="5405" class="Symbol">→</a> <a id="5407" href="Ledger.Conway.Conformance.Epoch.html#5394" class="Bound">a</a> <a id="5409" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5411" href="Ledger.Conway.Conformance.Epoch.html#5402" class="Bound">d</a><a id="5412" class="Symbol">)</a> <a id="5414" href="Ledger.Conway.Conformance.Epoch.html#5055" class="Bound">removedGovActions</a> <a id="5432" href="abstract-set-theory.FiniteSetTheory.html#2921" class="Function Operator">ᶠˢ</a><a id="5434" class="Symbol">)</a>

      <a id="5443" href="Ledger.Conway.Conformance.Epoch.html#5443" class="Bound">trWithdrawals</a>   <a id="5459" class="Symbol">=</a> <a id="5461" href="Ledger.Conway.Conformance.Epoch.html#4529" class="Function">esW</a> <a id="5465" class="Symbol">.</a><a id="5466" href="Ledger.Conway.Specification.Enact.html#700" class="Field">withdrawals</a>
      <a id="5484" href="Ledger.Conway.Conformance.Epoch.html#5484" class="Bound">totWithdrawals</a>  <a id="5500" class="Symbol">=</a> <a id="5502" href="abstract-set-theory.FiniteSetTheory.html#4373" class="Function">∑[</a> <a id="5505" href="Ledger.Conway.Conformance.Epoch.html#5505" class="Bound">x</a> <a id="5507" href="abstract-set-theory.FiniteSetTheory.html#4373" class="Function">←</a> <a id="5509" href="Ledger.Conway.Conformance.Epoch.html#5443" class="Bound">trWithdrawals</a> <a id="5523" href="abstract-set-theory.FiniteSetTheory.html#4373" class="Function">]</a> <a id="5525" href="Ledger.Conway.Conformance.Epoch.html#5505" class="Bound">x</a>

      <a id="5534" href="Ledger.Conway.Conformance.Epoch.html#5534" class="Bound">retired</a>    <a id="5545" class="Symbol">=</a> <a id="5547" class="Symbol">(</a><a id="5548" href="Ledger.Conway.Conformance.Certs.html#1035" class="Function">pState</a> <a id="5555" class="Symbol">.</a><a id="5556" href="Ledger.Conway.Specification.Certs.html#4124" class="Field">retiring</a><a id="5564" class="Symbol">)</a> <a id="5566" href="Axiom.Set.Map.html#17955" class="Function Operator">⁻¹</a> <a id="5569" href="Ledger.Conway.Conformance.Epoch.html#4074" class="Generalizable">e</a>
      <a id="5577" href="Ledger.Conway.Conformance.Epoch.html#5577" class="Bound">payout</a>     <a id="5588" class="Symbol">=</a> <a id="5590" href="Ledger.Conway.Conformance.Epoch.html#5306" class="Bound">govActionReturns</a> <a id="5607" href="Axiom.Set.Map.Dec.html#2149" class="Function Operator">∪⁺</a> <a id="5610" href="Ledger.Conway.Conformance.Epoch.html#5443" class="Bound">trWithdrawals</a>
      <a id="5630" href="Ledger.Conway.Conformance.Epoch.html#5630" class="Bound">refunds</a>    <a id="5641" class="Symbol">=</a> <a id="5643" href="Axiom.Set.Map.html#17516" class="Function">pullbackMap</a> <a id="5655" href="Ledger.Conway.Conformance.Epoch.html#5577" class="Bound">payout</a> <a id="5662" href="Ledger.Conway.Specification.Epoch.html#5265" class="Function">toRwdAddr</a> <a id="5672" class="Symbol">(</a><a id="5673" href="Class.IsSet.html#916" class="Function">dom</a> <a id="5677" class="Symbol">(</a><a id="5678" href="Ledger.Conway.Conformance.Certs.html#1015" class="Function">dState</a> <a id="5685" class="Symbol">.</a><a id="5686" href="Ledger.Conway.Conformance.Certs.html#729" class="Field">rewards</a><a id="5693" class="Symbol">))</a>
      <a id="5702" href="Ledger.Conway.Conformance.Epoch.html#5702" class="Bound">unclaimed</a>  <a id="5713" class="Symbol">=</a> <a id="5715" href="Ledger.Prelude.HasCoin.html#171" class="Field">getCoin</a> <a id="5723" href="Ledger.Conway.Conformance.Epoch.html#5577" class="Bound">payout</a> <a id="5730" href="Interface.TypeClasses.HasSubtract.html#223" class="Field Operator">-</a> <a id="5732" href="Ledger.Prelude.HasCoin.html#171" class="Field">getCoin</a> <a id="5740" href="Ledger.Conway.Conformance.Epoch.html#5630" class="Bound">refunds</a>
      <a id="5754" href="Ledger.Conway.Conformance.Epoch.html#5754" class="Bound">vDeposits</a>  <a id="5765" class="Symbol">=</a> <a id="5767" href="Ledger.Conway.Conformance.Certs.html#1055" class="Function">gState</a> <a id="5774" class="Symbol">.</a><a id="5775" href="Ledger.Conway.Conformance.Certs.html#926" class="Field">deposits</a>

      <a id="5791" href="Ledger.Conway.Conformance.Epoch.html#5791" class="Bound">dState&#39;</a> <a id="5799" class="Symbol">:</a> <a id="5801" href="Ledger.Conway.Conformance.Certs.html#602" class="Record">DState</a>
      <a id="5814" href="Ledger.Conway.Conformance.Epoch.html#5791" class="Bound">dState&#39;</a> <a id="5822" class="Symbol">=</a> <a id="5824" class="Keyword">record</a> <a id="5831" href="Ledger.Conway.Conformance.Certs.html#1015" class="Function">dState</a> <a id="5838" class="Symbol">{</a> <a id="5840" href="Ledger.Conway.Conformance.Certs.html#729" class="Field">rewards</a> <a id="5848" class="Symbol">=</a> <a id="5850" href="Ledger.Conway.Conformance.Certs.html#1015" class="Function">dState</a> <a id="5857" class="Symbol">.</a><a id="5858" href="Ledger.Conway.Conformance.Certs.html#729" class="Field">rewards</a> <a id="5866" href="Axiom.Set.Map.Dec.html#2149" class="Function Operator">∪⁺</a> <a id="5869" href="Ledger.Conway.Conformance.Epoch.html#5630" class="Bound">refunds</a> <a id="5877" class="Symbol">}</a>

      <a id="5886" href="Ledger.Conway.Conformance.Epoch.html#5886" class="Bound">pState&#39;</a> <a id="5894" class="Symbol">:</a> <a id="5896" href="Ledger.Conway.Specification.Certs.html#4048" class="Record">PState</a>
      <a id="5909" href="Ledger.Conway.Conformance.Epoch.html#5886" class="Bound">pState&#39;</a> <a id="5917" class="Symbol">=</a> <a class="AgdaKaTeX">$\begin{pmatrix} \,\htmlId{5921}{\htmlClass{Symbol}{\text{(}}}\,\,\href{Ledger.Conway.Conformance.Certs.html#1035}{\htmlId{5922}{\htmlClass{Function}{\text{pState}}}}\, \,\htmlId{5929}{\htmlClass{Symbol}{\text{.}}}\,\,\href{Ledger.Conway.Specification.Certs.html#4080}{\htmlId{5930}{\htmlClass{Field}{\text{pools}}}}\,\,\htmlId{5935}{\htmlClass{Symbol}{\text{)}}}\, \,\href{Axiom.Set.Map.html#13604}{\htmlId{5937}{\htmlClass{Function Operator}{\text{∣}}}}\, \,\href{Ledger.Conway.Conformance.Epoch.html#5534}{\htmlId{5939}{\htmlClass{Bound}{\text{retired}}}}\, \,\href{Axiom.Set.Map.html#13604}{\htmlId{5947}{\htmlClass{Function Operator}{\text{ᶜ}}}}\,
                \\ \,\htmlId{5967}{\htmlClass{Symbol}{\text{(}}}\,\,\href{Ledger.Conway.Conformance.Certs.html#1035}{\htmlId{5968}{\htmlClass{Function}{\text{pState}}}}\, \,\htmlId{5975}{\htmlClass{Symbol}{\text{.}}}\,\,\href{Ledger.Conway.Specification.Certs.html#4102}{\htmlId{5976}{\htmlClass{Field}{\text{fPools}}}}\,\,\htmlId{5982}{\htmlClass{Symbol}{\text{)}}}\, \,\href{Axiom.Set.Map.html#13604}{\htmlId{5984}{\htmlClass{Function Operator}{\text{∣}}}}\, \,\href{Ledger.Conway.Conformance.Epoch.html#5534}{\htmlId{5986}{\htmlClass{Bound}{\text{retired}}}}\, \,\href{Axiom.Set.Map.html#13604}{\htmlId{5994}{\htmlClass{Function Operator}{\text{ᶜ}}}}\,
                \\ \,\htmlId{6014}{\htmlClass{Symbol}{\text{(}}}\,\,\href{Ledger.Conway.Conformance.Certs.html#1035}{\htmlId{6015}{\htmlClass{Function}{\text{pState}}}}\, \,\htmlId{6022}{\htmlClass{Symbol}{\text{.}}}\,\,\href{Ledger.Conway.Specification.Certs.html#4124}{\htmlId{6023}{\htmlClass{Field}{\text{retiring}}}}\,\,\htmlId{6031}{\htmlClass{Symbol}{\text{)}}}\, \,\href{Axiom.Set.Map.html#13604}{\htmlId{6033}{\htmlClass{Function Operator}{\text{∣}}}}\, \,\href{Ledger.Conway.Conformance.Epoch.html#5534}{\htmlId{6035}{\htmlClass{Bound}{\text{retired}}}}\, \,\href{Axiom.Set.Map.html#13604}{\htmlId{6043}{\htmlClass{Function Operator}{\text{ᶜ}}}}\,
                \end{pmatrix}$</a>

      <a id="6070" href="Ledger.Conway.Conformance.Epoch.html#6070" class="Bound">gState&#39;</a> <a id="6078" class="Symbol">:</a> <a id="6080" href="Ledger.Conway.Conformance.Certs.html#788" class="Record">GState</a>
      <a id="6093" href="Ledger.Conway.Conformance.Epoch.html#6070" class="Bound">gState&#39;</a> <a id="6101" class="Symbol">=</a> <a class="AgdaKaTeX">$\begin{pmatrix} \,\htmlId{6105}{\htmlClass{Symbol}{\text{(}}}\,\,\href{Class.ToBool.html#342}{\htmlId{6106}{\htmlClass{Function Operator}{\text{if}}}}\, \,\href{Data.List.Base.html#4681}{\htmlId{6109}{\htmlClass{Function}{\text{null}}}}\, \,\href{Ledger.Conway.Conformance.Epoch.html#4984}{\htmlId{6114}{\htmlClass{Bound}{\text{govSt&#39;}}}}\, \,\href{Class.ToBool.html#342}{\htmlId{6121}{\htmlClass{Function Operator}{\text{then}}}}\, \,\href{Axiom.Set.Map.html#7106}{\htmlId{6126}{\htmlClass{Function}{\text{mapValues}}}}\, \,\htmlId{6136}{\htmlClass{Symbol}{\text{(}}}\,\,\htmlId{6137}{\htmlClass{Number}{\text{1}}}\, \,\href{Class.HasAdd.Core.html#162}{\htmlId{6139}{\htmlClass{Field Operator}{\text{+\_}}}}\,\,\htmlId{6141}{\htmlClass{Symbol}{\text{)}}}\, \,\htmlId{6143}{\htmlClass{Symbol}{\text{(}}}\,\,\href{Ledger.Conway.Conformance.Certs.html#1055}{\htmlId{6144}{\htmlClass{Function}{\text{gState}}}}\, \,\htmlId{6151}{\htmlClass{Symbol}{\text{.}}}\,\,\href{Ledger.Conway.Conformance.Certs.html#843}{\htmlId{6152}{\htmlClass{Field}{\text{dreps}}}}\,\,\htmlId{6157}{\htmlClass{Symbol}{\text{)}}}\, \,\href{Class.ToBool.html#342}{\htmlId{6159}{\htmlClass{Function Operator}{\text{else}}}}\, \,\htmlId{6164}{\htmlClass{Symbol}{\text{(}}}\,\,\href{Ledger.Conway.Conformance.Certs.html#1055}{\htmlId{6165}{\htmlClass{Function}{\text{gState}}}}\, \,\htmlId{6172}{\htmlClass{Symbol}{\text{.}}}\,\,\href{Ledger.Conway.Conformance.Certs.html#843}{\htmlId{6173}{\htmlClass{Field}{\text{dreps}}}}\,\,\htmlId{6178}{\htmlClass{Symbol}{\text{))}}}\,
                , \,\htmlId{6199}{\htmlClass{Symbol}{\text{(}}}\,\,\href{Ledger.Conway.Conformance.Certs.html#1055}{\htmlId{6200}{\htmlClass{Function}{\text{gState}}}}\, \,\htmlId{6207}{\htmlClass{Symbol}{\text{.}}}\,\,\href{Ledger.Conway.Conformance.Certs.html#879}{\htmlId{6208}{\htmlClass{Field}{\text{ccHotKeys}}}}\,\,\htmlId{6217}{\htmlClass{Symbol}{\text{)}}}\, \,\href{Axiom.Set.Map.html#13534}{\htmlId{6219}{\htmlClass{Function Operator}{\text{∣}}}}\, \,\href{Ledger.Conway.Specification.Enact.html#1366}{\htmlId{6221}{\htmlClass{Function}{\text{ccCreds}}}}\, \,\htmlId{6229}{\htmlClass{Symbol}{\text{(}}}\,\,\href{Ledger.Conway.Conformance.Epoch.html#4660}{\htmlId{6230}{\htmlClass{Bound}{\text{es}}}}\, \,\htmlId{6233}{\htmlClass{Symbol}{\text{.}}}\,\,\href{Ledger.Conway.Specification.Enact.html#484}{\htmlId{6234}{\htmlClass{Field}{\text{cc}}}}\,\,\htmlId{6236}{\htmlClass{Symbol}{\text{)}}}\,
                , \,\href{Ledger.Conway.Conformance.Epoch.html#5754}{\htmlId{6256}{\htmlClass{Bound}{\text{vDeposits}}}}\,
                \end{pmatrix}$</a>

      <a id="6291" href="Ledger.Conway.Conformance.Epoch.html#6291" class="Bound">certState&#39;</a> <a id="6302" class="Symbol">:</a> <a id="6304" href="Ledger.Conway.Conformance.Certs.html#956" class="Record">CertState</a>
      <a id="6320" href="Ledger.Conway.Conformance.Epoch.html#6291" class="Bound">certState&#39;</a> <a id="6331" class="Symbol">=</a> <a id="6333" class="Keyword">record</a> <a id="6340" class="Symbol">{</a> <a id="6342" href="Ledger.Conway.Conformance.Certs.html#1015" class="Field">dState</a> <a id="6349" class="Symbol">=</a> <a id="6351" href="Ledger.Conway.Conformance.Epoch.html#5791" class="Bound">dState&#39;</a> <a id="6359" class="Symbol">;</a> <a id="6361" href="Ledger.Conway.Conformance.Certs.html#1035" class="Field">pState</a> <a id="6368" class="Symbol">=</a> <a id="6370" href="Ledger.Conway.Conformance.Epoch.html#5886" class="Bound">pState&#39;</a> <a id="6378" class="Symbol">;</a> <a id="6380" href="Ledger.Conway.Conformance.Certs.html#1055" class="Field">gState</a> <a id="6387" class="Symbol">=</a> <a id="6389" href="Ledger.Conway.Conformance.Epoch.html#6070" class="Bound">gState&#39;</a> <a id="6397" class="Symbol">}</a>

      <a id="6406" href="Ledger.Conway.Conformance.Epoch.html#6406" class="Bound">utxoSt&#39;</a> <a id="6414" class="Symbol">=</a> <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.Conway.Conformance.Ledger.html#834}{\htmlId{6418}{\htmlClass{Function}{\text{utxoSt}}}}\, \,\htmlId{6425}{\htmlClass{Symbol}{\text{.}}}\,\,\href{Ledger.Conway.Specification.Utxo.html#1294}{\htmlId{6426}{\htmlClass{Field}{\text{utxo}}}}\, \\ \,\href{Ledger.Conway.Conformance.Ledger.html#834}{\htmlId{6433}{\htmlClass{Function}{\text{utxoSt}}}}\, \,\htmlId{6440}{\htmlClass{Symbol}{\text{.}}}\,\,\href{Ledger.Conway.Specification.Utxo.html#1316}{\htmlId{6441}{\htmlClass{Field}{\text{fees}}}}\, \\ \,\href{Ledger.Conway.Conformance.Ledger.html#834}{\htmlId{6448}{\htmlClass{Function}{\text{utxoSt}}}}\, \,\htmlId{6455}{\htmlClass{Symbol}{\text{.}}}\,\,\href{Ledger.Conway.Specification.Utxo.html#1338}{\htmlId{6456}{\htmlClass{Field}{\text{deposits}}}}\, \,\href{Axiom.Set.Map.html#13604}{\htmlId{6465}{\htmlClass{Function Operator}{\text{∣}}}}\, \,\href{abstract-set-theory.FiniteSetTheory.html#519}{\htmlId{6467}{\htmlClass{Function}{\text{mapˢ}}}}\, \,\htmlId{6472}{\htmlClass{Symbol}{\text{(}}}\,\,\href{Data.Product.Base.html#636}{\htmlId{6473}{\htmlClass{Field}{\text{proj₁}}}}\, \,\href{Function.Base.html#1134}{\htmlId{6479}{\htmlClass{Function Operator}{\text{∘}}}}\, \,\href{Data.Product.Base.html#650}{\htmlId{6481}{\htmlClass{Field}{\text{proj₂}}}}\,\,\htmlId{6486}{\htmlClass{Symbol}{\text{)}}}\, \,\href{Ledger.Conway.Conformance.Epoch.html#5055}{\htmlId{6488}{\htmlClass{Bound}{\text{removedGovActions}}}}\, \,\href{Axiom.Set.Map.html#13604}{\htmlId{6506}{\htmlClass{Function Operator}{\text{ᶜ}}}}\, \\ \,\htmlId{6510}{\htmlClass{Number}{\text{0}}}\, \end{pmatrix}$</a>

      <a id="6521" href="Ledger.Conway.Conformance.Epoch.html#6521" class="Bound">acnt&#39;</a> <a id="6527" class="Symbol">=</a> <a id="6529" class="Keyword">record</a> <a id="6536" href="Ledger.Conway.Conformance.Epoch.html#4165" class="Generalizable">acnt</a>
        <a id="6549" class="Symbol">{</a> <a id="6551" href="Ledger.Conway.Specification.PParams.html#775" class="Field">treasury</a>  <a id="6561" class="Symbol">=</a> <a id="6563" href="Ledger.Conway.Conformance.Epoch.html#4165" class="Generalizable">acnt</a> <a id="6568" class="Symbol">.</a><a id="6569" href="Ledger.Conway.Specification.PParams.html#775" class="Field">treasury</a> <a id="6578" href="Data.Nat.Base.html#4462" class="Primitive Operator">∸</a> <a id="6580" href="Ledger.Conway.Conformance.Epoch.html#5484" class="Bound">totWithdrawals</a> <a id="6595" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="6597" href="Ledger.Conway.Conformance.Ledger.html#834" class="Function">utxoSt</a> <a id="6604" class="Symbol">.</a><a id="6605" href="Ledger.Conway.Specification.Utxo.html#1364" class="Field">donations</a> <a id="6615" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="6617" href="Ledger.Conway.Conformance.Epoch.html#5702" class="Bound">unclaimed</a> <a id="6627" class="Symbol">}</a>

      <a id="6636" href="Ledger.Conway.Conformance.Epoch.html#6636" class="Bound">stakeDistrs</a> <a id="6648" class="Symbol">:</a> <a id="6650" href="Ledger.Conway.Specification.Ratify.html#3119" class="Record">StakeDistrs</a>
      <a id="6668" href="Ledger.Conway.Conformance.Epoch.html#6636" class="Bound">stakeDistrs</a> <a id="6680" class="Symbol">=</a> <a id="6682" href="Ledger.Conway.Specification.Epoch.html#12370" class="Function">mkStakeDistrs</a> <a id="6696" class="Symbol">(</a><a id="6697" href="Ledger.Conway.Specification.Rewards.html#7753" class="Field">Snapshots.mark</a> <a id="6712" href="Ledger.Conway.Conformance.Epoch.html#4259" class="Generalizable">ss&#39;</a><a id="6715" class="Symbol">)</a> <a id="6717" href="Ledger.Conway.Conformance.Epoch.html#4074" class="Generalizable">e</a> <a id="6719" href="Ledger.Conway.Conformance.Epoch.html#6406" class="Bound">utxoSt&#39;</a> <a id="6727" href="Ledger.Conway.Conformance.Epoch.html#4984" class="Bound">govSt&#39;</a> <a id="6734" class="Symbol">(</a><a id="6735" class="Keyword">record</a> <a id="6742" class="Symbol">{</a> <a id="6744" href="Ledger.Conway.Conformance.Epoch.html#6744" class="Module">GState</a> <a id="6751" class="Symbol">(</a><a id="6752" href="Ledger.Conway.Conformance.Certs.html#1055" class="Field">CertState.gState</a> <a id="6769" class="Symbol">(</a><a id="6770" href="Ledger.Conway.Conformance.Ledger.html#887" class="Field">LState.certState</a> <a id="6787" href="Ledger.Conway.Conformance.Epoch.html#4151" class="Generalizable">ls</a><a id="6789" class="Symbol">))</a> <a id="6792" class="Symbol">})</a>
                                                                        <a id="6867" class="Symbol">(</a><a id="6868" class="Keyword">record</a> <a id="6875" class="Symbol">{</a> <a id="6877" href="Ledger.Conway.Conformance.Epoch.html#6877" class="Module">DState</a> <a id="6884" class="Symbol">(</a><a id="6885" href="Ledger.Conway.Conformance.Certs.html#1015" class="Field">CertState.dState</a> <a id="6902" class="Symbol">(</a><a id="6903" href="Ledger.Conway.Conformance.Ledger.html#887" class="Field">LState.certState</a> <a id="6920" href="Ledger.Conway.Conformance.Epoch.html#4151" class="Generalizable">ls</a><a id="6922" class="Symbol">))</a> <a id="6925" class="Symbol">})</a>

    <a id="6933" class="Keyword">in</a>
    <a id="6940" class="Keyword">record</a> <a id="6947" class="Symbol">{</a> <a id="6949" href="Ledger.Conway.Specification.Ratify.html#3305" class="Field">currentEpoch</a> <a id="6962" class="Symbol">=</a> <a id="6964" href="Ledger.Conway.Conformance.Epoch.html#4074" class="Generalizable">e</a>
           <a id="6977" class="Symbol">;</a> <a id="6979" href="Ledger.Conway.Specification.Ratify.html#3273" class="Field">stakeDistrs</a> <a id="6991" class="Symbol">=</a> <a id="6993" href="Ledger.Conway.Conformance.Epoch.html#6636" class="Bound">stakeDistrs</a>
           <a id="7016" class="Symbol">;</a> <a id="7018" href="Ledger.Conway.Specification.Ratify.html#3420" class="Field">treasury</a> <a id="7027" class="Symbol">=</a> <a id="7029" href="Ledger.Conway.Conformance.Epoch.html#4165" class="Generalizable">acnt</a> <a id="7034" class="Symbol">.</a><a id="7035" href="Ledger.Conway.Specification.PParams.html#775" class="Field">treasury</a> <a id="7044" class="Symbol">;</a> <a id="7046" href="Ledger.Conway.Conformance.Epoch.html#7046" class="Module">GState</a> <a id="7053" href="Ledger.Conway.Conformance.Certs.html#1055" class="Function">gState</a>
           <a id="7071" class="Symbol">;</a> <a id="7073" href="Ledger.Conway.Specification.Ratify.html#3449" class="Field">pools</a> <a id="7079" class="Symbol">=</a> <a id="7081" href="Ledger.Conway.Conformance.Certs.html#1035" class="Function">pState</a> <a id="7088" class="Symbol">.</a><a id="7089" href="Ledger.Conway.Specification.Certs.html#4080" class="Field">pools</a> <a id="7095" class="Symbol">;</a> <a id="7097" href="Ledger.Conway.Specification.Ratify.html#3495" class="Field">delegatees</a> <a id="7108" class="Symbol">=</a> <a id="7110" href="Ledger.Conway.Conformance.Certs.html#1015" class="Function">dState</a> <a id="7117" class="Symbol">.</a><a id="7118" href="Ledger.Conway.Conformance.Certs.html#659" class="Field">voteDelegs</a> <a id="7129" class="Symbol">}</a>
        <a id="7139" href="Ledger.Conway.Specification.Ratify.html#13621" class="Function Operator">⊢</a> <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.Conway.Conformance.Epoch.html#4660}{\htmlId{7143}{\htmlClass{Bound}{\text{es}}}}\, \\ \,\href{Class.HasEmptySet.html#287}{\htmlId{7148}{\htmlClass{Field}{\text{∅}}}}\, \\ \,\href{Agda.Builtin.Bool.html#192}{\htmlId{7152}{\htmlClass{InductiveConstructor}{\text{false}}}}\, \end{pmatrix}$</a> <a id="7160" href="Ledger.Conway.Specification.Ratify.html#13621" class="Function Operator">⇀⦇</a> <a id="7163" href="Ledger.Conway.Conformance.Epoch.html#4984" class="Bound">govSt&#39;</a> <a id="7170" href="Ledger.Conway.Specification.Ratify.html#13621" class="Function Operator">,RATIFIES⦈</a> <a id="7181" href="Ledger.Conway.Conformance.Epoch.html#4100" class="Generalizable">fut&#39;</a>
      <a id="7192" class="Symbol">→</a> <a id="7194" href="Ledger.Conway.Conformance.Epoch.html#4151" class="Generalizable">ls</a> <a id="7197" href="Ledger.Conway.Conformance.Rewards.html#613" class="Datatype Operator">⊢</a> <a id="7199" href="Ledger.Conway.Conformance.Epoch.html#4256" class="Generalizable">ss</a> <a id="7202" href="Ledger.Conway.Conformance.Rewards.html#613" class="Datatype Operator">⇀⦇</a> <a id="7205" href="Agda.Builtin.Unit.html#212" class="InductiveConstructor">tt</a> <a id="7208" href="Ledger.Conway.Conformance.Rewards.html#613" class="Datatype Operator">,SNAP⦈</a> <a id="7215" href="Ledger.Conway.Conformance.Epoch.html#4259" class="Generalizable">ss&#39;</a>
    <a id="7223" href="Prelude.InferenceRules.html#13694" class="Function Operator">────────────────────────────────</a>
    <a id="7260" class="Symbol">_</a> <a id="7262" href="Ledger.Conway.Conformance.Epoch.html#4353" class="Datatype Operator">⊢</a> <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.Conway.Conformance.Epoch.html#4165}{\htmlId{7266}{\htmlClass{Generalizable}{\text{acnt}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#4256}{\htmlId{7273}{\htmlClass{Generalizable}{\text{ss}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#4151}{\htmlId{7278}{\htmlClass{Generalizable}{\text{ls}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#4179}{\htmlId{7283}{\htmlClass{Generalizable}{\text{es₀}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#4096}{\htmlId{7289}{\htmlClass{Generalizable}{\text{fut}}}}\, \end{pmatrix}$</a> <a id="7295" href="Ledger.Conway.Conformance.Epoch.html#4353" class="Datatype Operator">⇀⦇</a> <a id="7298" href="Ledger.Conway.Conformance.Epoch.html#4074" class="Generalizable">e</a> <a id="7300" href="Ledger.Conway.Conformance.Epoch.html#4353" class="Datatype Operator">,EPOCH⦈</a>
        <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.Conway.Conformance.Epoch.html#6521}{\htmlId{7318}{\htmlClass{Bound}{\text{acnt&#39;}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#4259}{\htmlId{7326}{\htmlClass{Generalizable}{\text{ss&#39;}}}}\, \\ \begin{pmatrix} \,\href{Ledger.Conway.Conformance.Epoch.html#6406}{\htmlId{7334}{\htmlClass{Bound}{\text{utxoSt&#39;}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#4984}{\htmlId{7344}{\htmlClass{Bound}{\text{govSt&#39;}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#6291}{\htmlId{7353}{\htmlClass{Bound}{\text{certState&#39;}}}}\, \end{pmatrix} \\ \,\href{Ledger.Conway.Conformance.Epoch.html#4660}{\htmlId{7368}{\htmlClass{Bound}{\text{es}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#4100}{\htmlId{7373}{\htmlClass{Generalizable}{\text{fut&#39;}}}}\, \end{pmatrix}$</a>

<a id="7381" class="Keyword">data</a> <a id="_⊢_⇀⦇_,NEWEPOCH⦈_"></a><a id="7386" href="Ledger.Conway.Conformance.Epoch.html#7386" class="Datatype Operator">_⊢_⇀⦇_,NEWEPOCH⦈_</a> <a id="7404" class="Symbol">:</a> <a id="7406" href="Agda.Builtin.Unit.html#175" class="Record">⊤</a> <a id="7408" class="Symbol">→</a> <a id="7410" href="Ledger.Conway.Conformance.Epoch.html#1495" class="Record">NewEpochState</a> <a id="7424" class="Symbol">→</a> <a id="7426" href="Ledger.Core.Specification.Epoch.html#646" class="Function">Epoch</a> <a id="7432" class="Symbol">→</a> <a id="7434" href="Ledger.Conway.Conformance.Epoch.html#1495" class="Record">NewEpochState</a> <a id="7448" class="Symbol">→</a> <a id="7450" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="7455" class="Keyword">where</a>

  <a id="_⊢_⇀⦇_,NEWEPOCH⦈_.NEWEPOCH-New"></a><a id="7464" href="Ledger.Conway.Conformance.Epoch.html#7464" class="InductiveConstructor">NEWEPOCH-New</a> <a id="7477" class="Symbol">:</a>
    <a id="7483" class="Symbol">∀</a> <a id="7485" class="Symbol">{</a><a id="7486" href="Ledger.Conway.Conformance.Epoch.html#7486" class="Bound">bprev</a> <a id="7492" href="Ledger.Conway.Conformance.Epoch.html#7492" class="Bound">bcur</a> <a id="7497" class="Symbol">:</a> <a id="7499" href="Ledger.Conway.Specification.Rewards.html#4906" class="Function">BlocksMade</a><a id="7509" class="Symbol">}</a> <a id="7511" class="Symbol">{</a><a id="7512" href="Ledger.Conway.Conformance.Epoch.html#7512" class="Bound">pd</a> <a id="7515" class="Symbol">:</a> <a id="7517" href="Ledger.Conway.Conformance.Epoch.html#1425" class="Function">PoolDelegatedStake</a><a id="7535" class="Symbol">}</a> <a id="7537" class="Symbol">→</a>
    <a id="7543" class="Keyword">let</a>
       <a id="7554" href="Ledger.Conway.Conformance.Epoch.html#7554" class="Bound">eps&#39;</a> <a id="7559" class="Symbol">=</a> <a id="7561" href="Ledger.Conway.Conformance.Epoch.html#2737" class="Function">applyRUpd</a> <a id="7571" href="Ledger.Conway.Conformance.Epoch.html#4277" class="Generalizable">ru</a> <a id="7574" href="Ledger.Conway.Conformance.Epoch.html#4121" class="Generalizable">eps</a>
       <a id="7585" href="Ledger.Conway.Conformance.Epoch.html#7585" class="Bound">ss</a>   <a id="7590" class="Symbol">=</a> <a id="7592" href="Ledger.Conway.Conformance.Epoch.html#1320" class="Field">EpochState.ss</a> <a id="7606" href="Ledger.Conway.Conformance.Epoch.html#4130" class="Generalizable">eps&#39;&#39;</a>
       <a id="7619" href="Ledger.Conway.Conformance.Epoch.html#7619" class="Bound">pd&#39;</a>  <a id="7624" class="Symbol">=</a> <a id="7626" href="Ledger.Conway.Conformance.Epoch.html#3467" class="Function">calculatePoolDelegatedStake</a> <a id="7654" class="Symbol">(</a><a id="7655" href="Ledger.Conway.Specification.Rewards.html#7758" class="Field">Snapshots.set</a> <a id="7669" href="Ledger.Conway.Conformance.Epoch.html#7585" class="Bound">ss</a><a id="7671" class="Symbol">)</a>
     <a id="7678" class="Keyword">in</a>
       <a id="7688" href="Prelude.InferenceRules.html#56075" class="Function Operator">∙</a> <a id="7690" href="Ledger.Conway.Conformance.Epoch.html#4074" class="Generalizable">e</a> <a id="7692" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="7694" href="Ledger.Conway.Conformance.Epoch.html#4076" class="Generalizable">lastEpoch</a> <a id="7704" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="7706" class="Number">1</a>
       <a id="7715" href="Prelude.InferenceRules.html#56006" class="Function Operator">∙</a> <a id="7717" class="Symbol">_</a> <a id="7719" href="Ledger.Conway.Conformance.Epoch.html#4353" class="Datatype Operator">⊢</a> <a id="7721" href="Ledger.Conway.Conformance.Epoch.html#7554" class="Bound">eps&#39;</a> <a id="7726" href="Ledger.Conway.Conformance.Epoch.html#4353" class="Datatype Operator">⇀⦇</a> <a id="7729" href="Ledger.Conway.Conformance.Epoch.html#4074" class="Generalizable">e</a> <a id="7731" href="Ledger.Conway.Conformance.Epoch.html#4353" class="Datatype Operator">,EPOCH⦈</a> <a id="7739" href="Ledger.Conway.Conformance.Epoch.html#4130" class="Generalizable">eps&#39;&#39;</a>
       <a id="7752" href="Prelude.InferenceRules.html#13694" class="Function Operator">────────────────────────────────</a>
       <a id="7792" class="Symbol">_</a> <a id="7794" href="Ledger.Conway.Conformance.Epoch.html#7386" class="Datatype Operator">⊢</a> <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.Conway.Conformance.Epoch.html#4076}{\htmlId{7798}{\htmlClass{Generalizable}{\text{lastEpoch}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#7486}{\htmlId{7810}{\htmlClass{Bound}{\text{bprev}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#7492}{\htmlId{7818}{\htmlClass{Bound}{\text{bcur}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#4121}{\htmlId{7825}{\htmlClass{Generalizable}{\text{eps}}}}\, \\ \,\href{Agda.Builtin.Maybe.html#173}{\htmlId{7831}{\htmlClass{InductiveConstructor}{\text{just}}}}\, \,\href{Ledger.Conway.Conformance.Epoch.html#4277}{\htmlId{7836}{\htmlClass{Generalizable}{\text{ru}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#7512}{\htmlId{7841}{\htmlClass{Bound}{\text{pd}}}}\, \end{pmatrix}$</a> <a id="7846" href="Ledger.Conway.Conformance.Epoch.html#7386" class="Datatype Operator">⇀⦇</a> <a id="7849" href="Ledger.Conway.Conformance.Epoch.html#4074" class="Generalizable">e</a> <a id="7851" href="Ledger.Conway.Conformance.Epoch.html#7386" class="Datatype Operator">,NEWEPOCH⦈</a> <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.Conway.Conformance.Epoch.html#4074}{\htmlId{7864}{\htmlClass{Generalizable}{\text{e}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#7492}{\htmlId{7868}{\htmlClass{Bound}{\text{bcur}}}}\, \\ \,\href{Axiom.Set.Map.html#2671}{\htmlId{7875}{\htmlClass{Function}{\text{∅ᵐ}}}}\,  \\ \,\href{Ledger.Conway.Conformance.Epoch.html#4130}{\htmlId{7881}{\htmlClass{Generalizable}{\text{eps&#39;&#39;}}}}\, \\ \,\href{Agda.Builtin.Maybe.html#194}{\htmlId{7889}{\htmlClass{InductiveConstructor}{\text{nothing}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#7619}{\htmlId{7899}{\htmlClass{Bound}{\text{pd&#39;}}}}\, \end{pmatrix}$</a>

  <a id="_⊢_⇀⦇_,NEWEPOCH⦈_.NEWEPOCH-Not-New"></a><a id="7908" href="Ledger.Conway.Conformance.Epoch.html#7908" class="InductiveConstructor">NEWEPOCH-Not-New</a> <a id="7925" class="Symbol">:</a> <a id="7927" class="Symbol">∀</a> <a id="7929" class="Symbol">{</a><a id="7930" href="Ledger.Conway.Conformance.Epoch.html#7930" class="Bound">bprev</a> <a id="7936" href="Ledger.Conway.Conformance.Epoch.html#7936" class="Bound">bcur</a> <a id="7941" class="Symbol">:</a> <a id="7943" href="Ledger.Conway.Specification.Rewards.html#4906" class="Function">BlocksMade</a><a id="7953" class="Symbol">}</a> <a id="7955" class="Symbol">{</a><a id="7956" href="Ledger.Conway.Conformance.Epoch.html#7956" class="Bound">pd</a> <a id="7959" class="Symbol">:</a> <a id="7961" href="Ledger.Conway.Conformance.Epoch.html#1425" class="Function">PoolDelegatedStake</a><a id="7979" class="Symbol">}</a> <a id="7981" class="Symbol">→</a>
    <a id="7987" href="Prelude.InferenceRules.html#56075" class="Function Operator">∙</a> <a id="7989" href="Ledger.Conway.Conformance.Epoch.html#4074" class="Generalizable">e</a> <a id="7991" href="Relation.Binary.PropositionalEquality.Core.html#1000" class="Function Operator">≢</a> <a id="7993" href="Ledger.Conway.Conformance.Epoch.html#4076" class="Generalizable">lastEpoch</a> <a id="8003" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="8005" class="Number">1</a>
      <a id="8013" href="Prelude.InferenceRules.html#13694" class="Function Operator">────────────────────────────────</a>
      <a id="8052" class="Symbol">_</a> <a id="8054" href="Ledger.Conway.Conformance.Epoch.html#7386" class="Datatype Operator">⊢</a> <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.Conway.Conformance.Epoch.html#4076}{\htmlId{8058}{\htmlClass{Generalizable}{\text{lastEpoch}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#7930}{\htmlId{8070}{\htmlClass{Bound}{\text{bprev}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#7936}{\htmlId{8078}{\htmlClass{Bound}{\text{bcur}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#4121}{\htmlId{8085}{\htmlClass{Generalizable}{\text{eps}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#4297}{\htmlId{8091}{\htmlClass{Generalizable}{\text{mru}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#7956}{\htmlId{8097}{\htmlClass{Bound}{\text{pd}}}}\, \end{pmatrix}$</a> <a id="8102" href="Ledger.Conway.Conformance.Epoch.html#7386" class="Datatype Operator">⇀⦇</a> <a id="8105" href="Ledger.Conway.Conformance.Epoch.html#4074" class="Generalizable">e</a> <a id="8107" href="Ledger.Conway.Conformance.Epoch.html#7386" class="Datatype Operator">,NEWEPOCH⦈</a> <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.Conway.Conformance.Epoch.html#4076}{\htmlId{8120}{\htmlClass{Generalizable}{\text{lastEpoch}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#7930}{\htmlId{8132}{\htmlClass{Bound}{\text{bprev}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#7936}{\htmlId{8140}{\htmlClass{Bound}{\text{bcur}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#4121}{\htmlId{8147}{\htmlClass{Generalizable}{\text{eps}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#4297}{\htmlId{8153}{\htmlClass{Generalizable}{\text{mru}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#7956}{\htmlId{8159}{\htmlClass{Bound}{\text{pd}}}}\, \end{pmatrix}$</a>

  <a id="_⊢_⇀⦇_,NEWEPOCH⦈_.NEWEPOCH-No-Reward-Update"></a><a id="8167" href="Ledger.Conway.Conformance.Epoch.html#8167" class="InductiveConstructor">NEWEPOCH-No-Reward-Update</a> <a id="8193" class="Symbol">:</a>
    <a id="8199" class="Symbol">∀</a> <a id="8201" class="Symbol">{</a><a id="8202" href="Ledger.Conway.Conformance.Epoch.html#8202" class="Bound">bprev</a> <a id="8208" href="Ledger.Conway.Conformance.Epoch.html#8208" class="Bound">bcur</a> <a id="8213" class="Symbol">:</a> <a id="8215" href="Ledger.Conway.Specification.Rewards.html#4906" class="Function">BlocksMade</a><a id="8225" class="Symbol">}</a> <a id="8227" class="Symbol">{</a><a id="8228" href="Ledger.Conway.Conformance.Epoch.html#8228" class="Bound">pd</a> <a id="8231" class="Symbol">:</a> <a id="8233" href="Ledger.Conway.Conformance.Epoch.html#1425" class="Function">PoolDelegatedStake</a><a id="8251" class="Symbol">}</a> <a id="8253" class="Symbol">→</a>
    <a id="8259" class="Keyword">let</a>
      <a id="8269" href="Ledger.Conway.Conformance.Epoch.html#8269" class="Bound">ss</a>  <a id="8273" class="Symbol">=</a> <a id="8275" href="Ledger.Conway.Conformance.Epoch.html#1320" class="Field">EpochState.ss</a> <a id="8289" href="Ledger.Conway.Conformance.Epoch.html#4125" class="Generalizable">eps&#39;</a>
      <a id="8300" href="Ledger.Conway.Conformance.Epoch.html#8300" class="Bound">pd&#39;</a> <a id="8304" class="Symbol">=</a> <a id="8306" href="Ledger.Conway.Conformance.Epoch.html#3467" class="Function">calculatePoolDelegatedStake</a> <a id="8334" class="Symbol">(</a><a id="8335" href="Ledger.Conway.Specification.Rewards.html#7758" class="Field">Snapshots.set</a> <a id="8349" href="Ledger.Conway.Conformance.Epoch.html#8269" class="Bound">ss</a><a id="8351" class="Symbol">)</a>
    <a id="8357" class="Keyword">in</a>
      <a id="8366" href="Prelude.InferenceRules.html#56075" class="Function Operator">∙</a> <a id="8368" href="Ledger.Conway.Conformance.Epoch.html#4074" class="Generalizable">e</a> <a id="8370" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="8372" href="Ledger.Conway.Conformance.Epoch.html#4076" class="Generalizable">lastEpoch</a> <a id="8382" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="8384" class="Number">1</a>
      <a id="8392" href="Prelude.InferenceRules.html#56006" class="Function Operator">∙</a> <a id="8394" class="Symbol">_</a> <a id="8396" href="Ledger.Conway.Conformance.Epoch.html#4353" class="Datatype Operator">⊢</a> <a id="8398" href="Ledger.Conway.Conformance.Epoch.html#4121" class="Generalizable">eps</a> <a id="8402" href="Ledger.Conway.Conformance.Epoch.html#4353" class="Datatype Operator">⇀⦇</a> <a id="8405" href="Ledger.Conway.Conformance.Epoch.html#4074" class="Generalizable">e</a> <a id="8407" href="Ledger.Conway.Conformance.Epoch.html#4353" class="Datatype Operator">,EPOCH⦈</a> <a id="8415" href="Ledger.Conway.Conformance.Epoch.html#4125" class="Generalizable">eps&#39;</a>
      <a id="8426" href="Prelude.InferenceRules.html#13694" class="Function Operator">────────────────────────────────</a>
      <a id="8465" class="Symbol">_</a> <a id="8467" href="Ledger.Conway.Conformance.Epoch.html#7386" class="Datatype Operator">⊢</a> <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.Conway.Conformance.Epoch.html#4076}{\htmlId{8471}{\htmlClass{Generalizable}{\text{lastEpoch}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#8202}{\htmlId{8483}{\htmlClass{Bound}{\text{bprev}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#8208}{\htmlId{8491}{\htmlClass{Bound}{\text{bcur}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#4121}{\htmlId{8498}{\htmlClass{Generalizable}{\text{eps}}}}\, \\ \,\href{Agda.Builtin.Maybe.html#194}{\htmlId{8504}{\htmlClass{InductiveConstructor}{\text{nothing}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#8228}{\htmlId{8514}{\htmlClass{Bound}{\text{pd}}}}\, \end{pmatrix}$</a> <a id="8519" href="Ledger.Conway.Conformance.Epoch.html#7386" class="Datatype Operator">⇀⦇</a> <a id="8522" href="Ledger.Conway.Conformance.Epoch.html#4074" class="Generalizable">e</a> <a id="8524" href="Ledger.Conway.Conformance.Epoch.html#7386" class="Datatype Operator">,NEWEPOCH⦈</a> <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.Conway.Conformance.Epoch.html#4074}{\htmlId{8537}{\htmlClass{Generalizable}{\text{e}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#8208}{\htmlId{8541}{\htmlClass{Bound}{\text{bcur}}}}\, \\ \,\href{Axiom.Set.Map.html#2671}{\htmlId{8548}{\htmlClass{Function}{\text{∅ᵐ}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#4125}{\htmlId{8553}{\htmlClass{Generalizable}{\text{eps&#39;}}}}\, \\ \,\href{Agda.Builtin.Maybe.html#194}{\htmlId{8560}{\htmlClass{InductiveConstructor}{\text{nothing}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#8300}{\htmlId{8570}{\htmlClass{Bound}{\text{pd&#39;}}}}\, \end{pmatrix}$</a>
</pre></body></html>