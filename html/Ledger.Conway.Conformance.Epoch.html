<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>Ledger.Conway.Conformance.Epoch</title><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.css"><link rel="stylesheet" href="Agda.css"><script src="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.js"></script><script src="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/contrib/auto-render.min.js"></script><script src="AgdaKaTeX.js" defer=""></script></head><body><pre class="Agda"><a id="1" class="Symbol">{-#</a> <a id="5" class="Keyword">OPTIONS</a> <a id="13" class="Pragma">--safe</a> <a id="20" class="Symbol">#-}</a>

<a id="25" class="Keyword">open</a> <a id="30" class="Keyword">import</a> <a id="37" href="Ledger.Core.Specification.Abstract.html" class="Module">Ledger.Core.Specification.Abstract</a>
<a id="72" class="Keyword">open</a> <a id="77" class="Keyword">import</a> <a id="84" href="Ledger.Conway.Specification.Transaction.html" class="Module">Ledger.Conway.Specification.Transaction</a>

<a id="125" class="Keyword">module</a> <a id="132" href="Ledger.Conway.Conformance.Epoch.html" class="Module">Ledger.Conway.Conformance.Epoch</a>
  <a id="166" class="Symbol">(</a><a id="167" href="Ledger.Conway.Conformance.Epoch.html#167" class="Bound">txs</a> <a id="171" class="Symbol">:</a> <a id="173" href="Ledger.Conway.Specification.Transaction.html#991" class="Record">TransactionStructure</a><a id="193" class="Symbol">)</a> <a id="195" class="Symbol">(</a><a id="196" class="Keyword">open</a> <a id="201" href="Ledger.Conway.Specification.Transaction.html#991" class="Module">TransactionStructure</a> <a id="222" href="Ledger.Conway.Conformance.Epoch.html#167" class="Bound">txs</a><a id="225" class="Symbol">)</a>
  <a id="229" class="Symbol">(</a><a id="230" href="Ledger.Conway.Conformance.Epoch.html#230" class="Bound">abs</a> <a id="234" class="Symbol">:</a> <a id="236" href="Ledger.Core.Specification.Abstract.html#828" class="Record">AbstractFunctions</a> <a id="254" href="Ledger.Conway.Conformance.Epoch.html#167" class="Bound">txs</a><a id="257" class="Symbol">)</a>
  <a id="261" class="Keyword">where</a>

<a id="268" class="Keyword">open</a> <a id="273" class="Keyword">import</a> <a id="280" href="Agda.Builtin.FromNat.html" class="Module">Agda.Builtin.FromNat</a>
<a id="301" class="Keyword">open</a> <a id="306" class="Keyword">import</a> <a id="313" href="Data.Integer.html" class="Module">Data.Integer</a> <a id="326" class="Keyword">using</a> <a id="332" class="Symbol">()</a> <a id="335" class="Keyword">renaming</a> <a id="344" class="Symbol">(</a><a id="345" href="Agda.Builtin.Int.html#263" class="InductiveConstructor">+_</a> <a id="348" class="Symbol">to</a> <a id="351" class="InductiveConstructor">pos</a><a id="354" class="Symbol">)</a>
<a id="356" class="Keyword">open</a> <a id="361" class="Keyword">import</a> <a id="368" href="Data.List.html" class="Module">Data.List</a> <a id="378" class="Keyword">using</a> <a id="384" class="Symbol">(</a><a id="385" href="Data.List.Base.html#10389" class="Function">filter</a><a id="391" class="Symbol">)</a>

<a id="394" class="Keyword">open</a> <a id="399" class="Keyword">import</a> <a id="406" href="Ledger.Prelude.html" class="Module">Ledger.Prelude</a>

<a id="422" class="Keyword">open</a> <a id="427" class="Keyword">import</a> <a id="434" href="Ledger.Conway.Conformance.Certs.html" class="Module">Ledger.Conway.Conformance.Certs</a> <a id="466" href="Ledger.Conway.Specification.Transaction.html#2065" class="Function">govStructure</a>
<a id="479" class="Keyword">open</a> <a id="484" class="Keyword">import</a> <a id="491" href="Ledger.Conway.Conformance.Equivalence.html" class="Module">Ledger.Conway.Conformance.Equivalence</a> <a id="529" href="Ledger.Conway.Conformance.Epoch.html#167" class="Bound">txs</a> <a id="533" href="Ledger.Conway.Conformance.Epoch.html#230" class="Bound">abs</a>
<a id="537" class="Keyword">open</a> <a id="542" class="Keyword">import</a> <a id="549" href="Ledger.Conway.Conformance.Equivalence.Convert.html" class="Module">Ledger.Conway.Conformance.Equivalence.Convert</a>
<a id="595" class="Keyword">open</a> <a id="600" class="Keyword">import</a> <a id="607" href="Ledger.Conway.Conformance.Equivalence.Deposits.html" class="Module">Ledger.Conway.Conformance.Equivalence.Deposits</a> <a id="654" href="Ledger.Conway.Conformance.Epoch.html#167" class="Bound">txs</a> <a id="658" href="Ledger.Conway.Conformance.Epoch.html#230" class="Bound">abs</a>
<a id="662" class="Keyword">open</a> <a id="667" class="Keyword">import</a> <a id="674" href="Ledger.Conway.Conformance.Ledger.html" class="Module">Ledger.Conway.Conformance.Ledger</a> <a id="707" href="Ledger.Conway.Conformance.Epoch.html#167" class="Bound">txs</a> <a id="711" href="Ledger.Conway.Conformance.Epoch.html#230" class="Bound">abs</a>
<a id="715" class="Keyword">open</a> <a id="720" class="Keyword">import</a> <a id="727" href="Ledger.Conway.Conformance.Rewards.html" class="Module">Ledger.Conway.Conformance.Rewards</a> <a id="761" href="Ledger.Conway.Conformance.Epoch.html#167" class="Bound">txs</a> <a id="765" href="Ledger.Conway.Conformance.Epoch.html#230" class="Bound">abs</a>
<a id="769" class="Keyword">open</a> <a id="774" class="Keyword">import</a> <a id="781" href="Ledger.Conway.Conformance.Utxo.html" class="Module">Ledger.Conway.Conformance.Utxo</a> <a id="812" href="Ledger.Conway.Conformance.Epoch.html#167" class="Bound">txs</a> <a id="816" href="Ledger.Conway.Conformance.Epoch.html#230" class="Bound">abs</a>

<a id="821" class="Keyword">open</a> <a id="826" class="Keyword">import</a> <a id="833" href="Ledger.Conway.Specification.Enact.html" class="Module">Ledger.Conway.Specification.Enact</a> <a id="867" href="Ledger.Conway.Specification.Transaction.html#2065" class="Function">govStructure</a>
<a id="880" class="Keyword">open</a> <a id="885" class="Keyword">import</a> <a id="892" href="Ledger.Conway.Specification.Epoch.html" class="Module">Ledger.Conway.Specification.Epoch</a> <a id="926" href="Ledger.Conway.Conformance.Epoch.html#167" class="Bound">txs</a> <a id="930" href="Ledger.Conway.Conformance.Epoch.html#230" class="Bound">abs</a>
  <a id="936" class="Keyword">using</a> <a id="942" class="Symbol">(</a><a id="943" href="Ledger.Conway.Specification.Epoch.html#5592" class="Function">getStakeCred</a><a id="955" class="Symbol">;</a> <a id="957" href="Ledger.Conway.Specification.Epoch.html#13208" class="Function">getOrphans</a><a id="967" class="Symbol">;</a> <a id="969" href="Ledger.Conway.Specification.Epoch.html#12517" class="Function">mkStakeDistrs</a><a id="982" class="Symbol">;</a> <a id="984" href="Ledger.Conway.Specification.Epoch.html#5487" class="Function">toRewardAddress</a><a id="999" class="Symbol">)</a> <a id="1001" class="Keyword">public</a>
<a id="1008" class="Keyword">import</a> <a id="1015" href="Ledger.Conway.Specification.Epoch.html" class="Module">Ledger.Conway.Specification.Epoch</a> <a id="1049" href="Ledger.Conway.Conformance.Epoch.html#167" class="Bound">txs</a> <a id="1053" href="Ledger.Conway.Conformance.Epoch.html#230" class="Bound">abs</a> <a id="1057" class="Symbol">as</a> <a id="EpochSpec"></a><a id="1060" href="Ledger.Conway.Conformance.Epoch.html#1060" class="Module">EpochSpec</a>
<a id="1070" class="Keyword">open</a> <a id="1075" class="Keyword">import</a> <a id="1082" href="Ledger.Conway.Specification.Ratify.html" class="Module">Ledger.Conway.Specification.Ratify</a> <a id="1117" href="Ledger.Conway.Conformance.Epoch.html#167" class="Bound">txs</a>

<a id="1122" class="Keyword">record</a> <a id="EpochState"></a><a id="1129" href="Ledger.Conway.Conformance.Epoch.html#1129" class="Record">EpochState</a> <a id="1140" class="Symbol">:</a> <a id="1142" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="1147" class="Keyword">where</a>
  <a id="1155" class="Keyword">constructor</a> <a id="⟦_,_,_,_,_⟧ᵉ&#39;"></a><a id="1167" href="Ledger.Conway.Conformance.Epoch.html#1167" class="InductiveConstructor Operator">⟦_,_,_,_,_⟧ᵉ&#39;</a>
  <a id="1183" class="Keyword">field</a>
    <a id="EpochState.acnt"></a><a id="1193" href="Ledger.Conway.Conformance.Epoch.html#1193" class="Field">acnt</a>       <a id="1204" class="Symbol">:</a> <a id="1206" href="Ledger.Conway.Specification.PParams.html#718" class="Record">Acnt</a>
    <a id="EpochState.ss"></a><a id="1215" href="Ledger.Conway.Conformance.Epoch.html#1215" class="Field">ss</a>         <a id="1226" class="Symbol">:</a> <a id="1228" href="Ledger.Conway.Specification.Rewards.html#7736" class="Record">Snapshots</a>
    <a id="EpochState.ls"></a><a id="1242" href="Ledger.Conway.Conformance.Epoch.html#1242" class="Field">ls</a>         <a id="1253" class="Symbol">:</a> <a id="1255" href="Ledger.Conway.Conformance.Ledger.html#732" class="Record">LState</a>
    <a id="EpochState.es"></a><a id="1266" href="Ledger.Conway.Conformance.Epoch.html#1266" class="Field">es</a>         <a id="1277" class="Symbol">:</a> <a id="1279" href="Ledger.Conway.Specification.Enact.html#444" class="Record">EnactState</a>
    <a id="EpochState.fut"></a><a id="1294" href="Ledger.Conway.Conformance.Epoch.html#1294" class="Field">fut</a>        <a id="1305" class="Symbol">:</a> <a id="1307" href="Ledger.Conway.Specification.Ratify.html#3529" class="Record">RatifyState</a>

<a id="PoolDelegatedStake"></a><a id="1320" href="Ledger.Conway.Conformance.Epoch.html#1320" class="Function">PoolDelegatedStake</a> <a id="1339" class="Symbol">:</a> <a id="1341" href="Agda.Primitive.html#388" class="Primitive">Type</a>
<a id="1346" href="Ledger.Conway.Conformance.Epoch.html#1320" class="Function">PoolDelegatedStake</a> <a id="1365" class="Symbol">=</a> <a id="1367" href="Ledger.Core.Specification.Crypto.html#1386" class="Function">KeyHash</a> <a id="1375" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="1377" href="Ledger.Prelude.Base.html#154" class="Function">Coin</a>

<a id="1383" class="Keyword">record</a> <a id="NewEpochState"></a><a id="1390" href="Ledger.Conway.Conformance.Epoch.html#1390" class="Record">NewEpochState</a> <a id="1404" class="Symbol">:</a> <a id="1406" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="1411" class="Keyword">where</a>
  <a id="1419" class="Keyword">field</a>
    <a id="NewEpochState.lastEpoch"></a><a id="1429" href="Ledger.Conway.Conformance.Epoch.html#1429" class="Field">lastEpoch</a>   <a id="1441" class="Symbol">:</a> <a id="1443" href="Ledger.Core.Specification.Epoch.html#646" class="Function">Epoch</a>
    <a id="NewEpochState.bprev"></a><a id="1453" href="Ledger.Conway.Conformance.Epoch.html#1453" class="Field">bprev</a>       <a id="1465" class="Symbol">:</a> <a id="1467" href="Ledger.Conway.Specification.Rewards.html#4923" class="Function">BlocksMade</a>
    <a id="NewEpochState.bcur"></a><a id="1482" href="Ledger.Conway.Conformance.Epoch.html#1482" class="Field">bcur</a>        <a id="1494" class="Symbol">:</a> <a id="1496" href="Ledger.Conway.Specification.Rewards.html#4923" class="Function">BlocksMade</a>
    <a id="NewEpochState.epochState"></a><a id="1511" href="Ledger.Conway.Conformance.Epoch.html#1511" class="Field">epochState</a>  <a id="1523" class="Symbol">:</a> <a id="1525" href="Ledger.Conway.Conformance.Epoch.html#1129" class="Record">EpochState</a>
    <a id="NewEpochState.ru"></a><a id="1540" href="Ledger.Conway.Conformance.Epoch.html#1540" class="Field">ru</a>          <a id="1552" class="Symbol">:</a> <a id="1554" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="1560" href="Ledger.Conway.Specification.Rewards.html#6266" class="Record">RewardUpdate</a>
    <a id="NewEpochState.pd"></a><a id="1577" href="Ledger.Conway.Conformance.Epoch.html#1577" class="Field">pd</a>          <a id="1589" class="Symbol">:</a> <a id="1591" href="Ledger.Conway.Conformance.Epoch.html#1320" class="Function">PoolDelegatedStake</a>

<a id="1611" class="Keyword">instance</a>
  <a id="1622" class="Keyword">unquoteDecl</a> <a id="HasCast-EpochState"></a><a id="1634" href="Ledger.Conway.Conformance.Epoch.html#1634" class="Function">HasCast-EpochState</a> <a id="HasCast-NewEpochState"></a><a id="1653" href="Ledger.Conway.Conformance.Epoch.html#1653" class="Function">HasCast-NewEpochState</a> <a id="1675" class="Symbol">=</a> <a id="1677" href="stdlib-classes.Class.HasCast.Derive.html#2690" class="Function">derive-HasCast</a>
    <a id="1696" class="Symbol">(</a> <a id="1698" class="Symbol">(</a><a id="1699" class="Keyword">quote</a> <a id="1705" href="Ledger.Conway.Conformance.Epoch.html#1129" class="Record">EpochState</a>     <a id="1720" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1722" href="Ledger.Conway.Conformance.Epoch.html#1634" class="Function">HasCast-EpochState</a><a id="1740" class="Symbol">)</a>
    <a id="1746" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="1748" href="Data.List.Base.html#4907" class="Function Operator">[</a> <a id="1750" class="Symbol">(</a><a id="1751" class="Keyword">quote</a> <a id="1757" href="Ledger.Conway.Conformance.Epoch.html#1390" class="Record">NewEpochState</a>  <a id="1772" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1774" href="Ledger.Conway.Conformance.Epoch.html#1653" class="Function">HasCast-NewEpochState</a><a id="1795" class="Symbol">)</a><a id="1796" href="Data.List.Base.html#4907" class="Function Operator">]</a><a id="1797" class="Symbol">)</a>

  <a id="EpochStateFromConf"></a><a id="1802" href="Ledger.Conway.Conformance.Epoch.html#1802" class="Function">EpochStateFromConf</a> <a id="1821" class="Symbol">:</a> <a id="1823" href="Ledger.Conway.Conformance.Epoch.html#1129" class="Record">EpochState</a> <a id="1834" href="Ledger.Conway.Conformance.Equivalence.Convert.html#409" class="Function Operator">⭆</a> <a id="1836" href="Ledger.Conway.Specification.Epoch.html#1835" class="Record">EpochSpec.EpochState</a>
  <a id="1859" href="Ledger.Conway.Conformance.Epoch.html#1802" class="Function">EpochStateFromConf</a> <a id="1878" class="Symbol">.</a><a id="1879" href="Ledger.Conway.Conformance.Equivalence.Convert.html#217" class="Field">convⁱ</a> <a id="1885" class="Symbol">_</a> <a id="1887" href="Ledger.Conway.Conformance.Epoch.html#1887" class="Bound">epochState</a> <a id="1898" class="Symbol">=</a>
    <a id="1904" class="Keyword">let</a> <a id="1908" class="Keyword">open</a> <a id="1913" href="Ledger.Conway.Conformance.Epoch.html#1129" class="Module">EpochState</a> <a id="1924" href="Ledger.Conway.Conformance.Epoch.html#1887" class="Bound">epochState</a> <a id="1935" class="Keyword">in</a>
    <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.Conway.Conformance.Epoch.html#1193}{\htmlId{1944}{\htmlClass{Field}{\text{acnt}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#1215}{\htmlId{1951}{\htmlClass{Field}{\text{ss}}}}\, \\ \,\href{Ledger.Conway.Conformance.Equivalence.Convert.html#452}{\htmlId{1956}{\htmlClass{Function}{\text{conv}}}}\, \,\href{Ledger.Conway.Conformance.Epoch.html#1242}{\htmlId{1961}{\htmlClass{Field}{\text{ls}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#1266}{\htmlId{1966}{\htmlClass{Field}{\text{es}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#1294}{\htmlId{1971}{\htmlClass{Field}{\text{fut}}}}\, \end{pmatrix}$</a>

  <a id="EpochStateToConf"></a><a id="1980" href="Ledger.Conway.Conformance.Epoch.html#1980" class="Function">EpochStateToConf</a> <a id="1997" class="Symbol">:</a> <a id="1999" href="Ledger.Conway.Specification.Epoch.html#1835" class="Record">EpochSpec.EpochState</a> <a id="2020" href="Ledger.Conway.Conformance.Equivalence.Convert.html#409" class="Function Operator">⭆</a> <a id="2022" href="Ledger.Conway.Conformance.Epoch.html#1129" class="Record">EpochState</a>
  <a id="2035" href="Ledger.Conway.Conformance.Epoch.html#1980" class="Function">EpochStateToConf</a> <a id="2052" class="Symbol">.</a><a id="2053" href="Ledger.Conway.Conformance.Equivalence.Convert.html#217" class="Field">convⁱ</a> <a id="2059" href="Ledger.Conway.Conformance.Epoch.html#2059" class="Bound">deposits</a> <a id="2068" href="Ledger.Conway.Conformance.Epoch.html#2068" class="Bound">epochSt</a> <a id="2076" class="Symbol">=</a>
    <a id="2082" class="Keyword">let</a> <a id="2086" class="Keyword">open</a> <a id="2091" href="Ledger.Conway.Specification.Epoch.html#1835" class="Module">EpochSpec.EpochState</a> <a id="2112" href="Ledger.Conway.Conformance.Epoch.html#2068" class="Bound">epochSt</a> <a id="2120" class="Keyword">in</a>
    <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.Conway.Specification.Epoch.html#1903}{\htmlId{2129}{\htmlClass{Field}{\text{acnt}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#1925}{\htmlId{2136}{\htmlClass{Field}{\text{ss}}}}\, \\ \,\href{Ledger.Conway.Conformance.Equivalence.Deposits.html#12684}{\htmlId{2141}{\htmlClass{Function}{\text{certDeposits}}}}\, \,\href{Ledger.Conway.Specification.Epoch.html#1952}{\htmlId{2154}{\htmlClass{Field}{\text{ls}}}}\, \,\href{Ledger.Conway.Conformance.Equivalence.Convert.html#270}{\htmlId{2157}{\htmlClass{Function Operator}{\text{⊢conv}}}}\, \,\href{Ledger.Conway.Specification.Epoch.html#1952}{\htmlId{2163}{\htmlClass{Field}{\text{ls}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#1976}{\htmlId{2168}{\htmlClass{Field}{\text{es}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#2004}{\htmlId{2173}{\htmlClass{Field}{\text{fut}}}}\, \end{pmatrix}$</a>

  <a id="NewEpochStateFromConf"></a><a id="2184" href="Ledger.Conway.Conformance.Epoch.html#2184" class="Function">NewEpochStateFromConf</a> <a id="2206" class="Symbol">:</a> <a id="2208" href="Ledger.Conway.Conformance.Epoch.html#1390" class="Record">NewEpochState</a> <a id="2222" href="Ledger.Conway.Conformance.Equivalence.Convert.html#409" class="Function Operator">⭆</a> <a id="2224" href="Ledger.Conway.Specification.Epoch.html#3586" class="Record">EpochSpec.NewEpochState</a>
  <a id="2250" href="Ledger.Conway.Conformance.Epoch.html#2184" class="Function">NewEpochStateFromConf</a> <a id="2272" class="Symbol">.</a><a id="2273" href="Ledger.Conway.Conformance.Equivalence.Convert.html#217" class="Field">convⁱ</a> <a id="2279" class="Symbol">_</a> <a id="2281" href="Ledger.Conway.Conformance.Epoch.html#2281" class="Bound">newEpochState</a> <a id="2295" class="Symbol">=</a>
    <a id="2301" class="Keyword">let</a> <a id="2305" class="Keyword">open</a> <a id="2310" href="Ledger.Conway.Conformance.Epoch.html#1390" class="Module">NewEpochState</a> <a id="2324" href="Ledger.Conway.Conformance.Epoch.html#2281" class="Bound">newEpochState</a> <a id="2338" class="Keyword">in</a>
    <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.Conway.Conformance.Epoch.html#1429}{\htmlId{2347}{\htmlClass{Field}{\text{lastEpoch}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#1453}{\htmlId{2359}{\htmlClass{Field}{\text{bprev}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#1482}{\htmlId{2367}{\htmlClass{Field}{\text{bcur}}}}\, \\ \,\href{Ledger.Conway.Conformance.Equivalence.Convert.html#452}{\htmlId{2374}{\htmlClass{Function}{\text{conv}}}}\, \,\href{Ledger.Conway.Conformance.Epoch.html#1511}{\htmlId{2379}{\htmlClass{Field}{\text{epochState}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#1540}{\htmlId{2392}{\htmlClass{Field}{\text{ru}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#1577}{\htmlId{2397}{\htmlClass{Field}{\text{pd}}}}\, \end{pmatrix}$</a>

  <a id="NewEpochStateToConf"></a><a id="2405" href="Ledger.Conway.Conformance.Epoch.html#2405" class="Function">NewEpochStateToConf</a> <a id="2425" class="Symbol">:</a> <a id="2427" href="Ledger.Conway.Specification.Epoch.html#3586" class="Record">EpochSpec.NewEpochState</a> <a id="2451" href="Ledger.Conway.Conformance.Equivalence.Convert.html#409" class="Function Operator">⭆</a> <a id="2453" href="Ledger.Conway.Conformance.Epoch.html#1390" class="Record">NewEpochState</a>
  <a id="2469" href="Ledger.Conway.Conformance.Epoch.html#2405" class="Function">NewEpochStateToConf</a> <a id="2489" class="Symbol">.</a><a id="2490" href="Ledger.Conway.Conformance.Equivalence.Convert.html#217" class="Field">convⁱ</a> <a id="2496" href="Ledger.Conway.Conformance.Epoch.html#2496" class="Bound">deposits</a> <a id="2505" href="Ledger.Conway.Conformance.Epoch.html#2505" class="Bound">newEpochSt</a> <a id="2516" class="Symbol">=</a>
    <a id="2522" class="Keyword">let</a> <a id="2526" class="Keyword">open</a> <a id="2531" href="Ledger.Conway.Specification.Epoch.html#3586" class="Module">EpochSpec.NewEpochState</a> <a id="2555" href="Ledger.Conway.Conformance.Epoch.html#2505" class="Bound">newEpochSt</a> <a id="2566" class="Keyword">in</a>
    <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.Conway.Specification.Epoch.html#3625}{\htmlId{2575}{\htmlClass{Field}{\text{lastEpoch}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#3678}{\htmlId{2587}{\htmlClass{Field}{\text{bcur}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#3649}{\htmlId{2594}{\htmlClass{Field}{\text{bprev}}}}\, \\ \,\href{Ledger.Conway.Conformance.Equivalence.Convert.html#452}{\htmlId{2602}{\htmlClass{Function}{\text{conv}}}}\, \,\href{Ledger.Conway.Specification.Epoch.html#3707}{\htmlId{2607}{\htmlClass{Field}{\text{epochState}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#3736}{\htmlId{2620}{\htmlClass{Field}{\text{ru}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#3773}{\htmlId{2625}{\htmlClass{Field}{\text{pd}}}}\, \end{pmatrix}$</a>


<a id="applyRUpd"></a><a id="2632" href="Ledger.Conway.Conformance.Epoch.html#2632" class="Function">applyRUpd</a> <a id="2642" class="Symbol">:</a> <a id="2644" href="Ledger.Conway.Specification.Rewards.html#6266" class="Record">RewardUpdate</a> <a id="2657" class="Symbol">→</a> <a id="2659" href="Ledger.Conway.Conformance.Epoch.html#1129" class="Record">EpochState</a> <a id="2670" class="Symbol">→</a> <a id="2672" href="Ledger.Conway.Conformance.Epoch.html#1129" class="Record">EpochState</a>
<a id="2683" href="Ledger.Conway.Conformance.Epoch.html#2632" class="Function">applyRUpd</a> <a id="2693" href="Ledger.Conway.Conformance.Epoch.html#2693" class="Bound">rewardUpdate</a>
  <a class="AgdaKaTeX">$\begin{pmatrix} \begin{pmatrix} \,\href{Ledger.Conway.Conformance.Epoch.html#2712}{\htmlId{2712}{\htmlClass{Bound}{\text{treasury}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#2723}{\htmlId{2723}{\htmlClass{Bound}{\text{reserves}}}}\, \end{pmatrix}
  \\ \,\href{Ledger.Conway.Conformance.Epoch.html#2739}{\htmlId{2739}{\htmlClass{Bound}{\text{ss}}}}\,
  \\ \begin{pmatrix} \begin{pmatrix} \,\href{Ledger.Conway.Conformance.Epoch.html#2750}{\htmlId{2750}{\htmlClass{Bound}{\text{utxo}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#2757}{\htmlId{2757}{\htmlClass{Bound}{\text{fees}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#2764}{\htmlId{2764}{\htmlClass{Bound}{\text{deposits}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#2775}{\htmlId{2775}{\htmlClass{Bound}{\text{donations}}}}\, \end{pmatrix}
    \\ \,\href{Ledger.Conway.Conformance.Epoch.html#2794}{\htmlId{2794}{\htmlClass{Bound}{\text{govSt}}}}\,
    \\ \begin{pmatrix} \begin{pmatrix} \,\href{Ledger.Conway.Conformance.Epoch.html#2810}{\htmlId{2810}{\htmlClass{Bound}{\text{voteDelegs}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#2823}{\htmlId{2823}{\htmlClass{Bound}{\text{stakeDelegs}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#2837}{\htmlId{2837}{\htmlClass{Bound}{\text{rewards}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#2847}{\htmlId{2847}{\htmlClass{Bound}{\text{deposits&#39;}}}}\, \end{pmatrix} \\ \,\href{Ledger.Conway.Conformance.Epoch.html#2862}{\htmlId{2862}{\htmlClass{Bound}{\text{pState}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#2871}{\htmlId{2871}{\htmlClass{Bound}{\text{gState}}}}\, \end{pmatrix} \end{pmatrix}
  \\ \,\href{Ledger.Conway.Conformance.Epoch.html#2889}{\htmlId{2889}{\htmlClass{Bound}{\text{es}}}}\,
  \\ \,\href{Ledger.Conway.Conformance.Epoch.html#2896}{\htmlId{2896}{\htmlClass{Bound}{\text{fut}}}}\,
  \end{pmatrix}$</a> <a id="2906" class="Symbol">=</a>
  <a class="AgdaKaTeX">$\begin{pmatrix} \begin{pmatrix} \,\href{Prelude.html#3280}{\htmlId{2914}{\htmlClass{Function}{\text{posPart}}}}\, \,\htmlId{2922}{\htmlClass{Symbol}{\text{(}}}\,\,\href{Ledger.Conway.Conformance.Epoch.html#351}{\htmlId{2923}{\htmlClass{InductiveConstructor}{\text{pos}}}}\, \,\href{Ledger.Conway.Conformance.Epoch.html#2712}{\htmlId{2927}{\htmlClass{Bound}{\text{treasury}}}}\, \,\href{Class.HasAdd.Core.html#162}{\htmlId{2936}{\htmlClass{Field Operator}{\text{+}}}}\, \,\href{Ledger.Conway.Specification.Rewards.html#6303}{\htmlId{2938}{\htmlClass{Function}{\text{Δt}}}}\, \,\href{Class.HasAdd.Core.html#162}{\htmlId{2941}{\htmlClass{Field Operator}{\text{+}}}}\, \,\href{Ledger.Conway.Conformance.Epoch.html#351}{\htmlId{2943}{\htmlClass{InductiveConstructor}{\text{pos}}}}\, \,\href{Ledger.Conway.Conformance.Epoch.html#3321}{\htmlId{2947}{\htmlClass{Function}{\text{unregRU&#39;}}}}\,\,\htmlId{2955}{\htmlClass{Symbol}{\text{)}}}\,
    \\ \,\href{Prelude.html#3280}{\htmlId{2963}{\htmlClass{Function}{\text{posPart}}}}\, \,\htmlId{2971}{\htmlClass{Symbol}{\text{(}}}\,\,\href{Ledger.Conway.Conformance.Epoch.html#351}{\htmlId{2972}{\htmlClass{InductiveConstructor}{\text{pos}}}}\, \,\href{Ledger.Conway.Conformance.Epoch.html#2723}{\htmlId{2976}{\htmlClass{Bound}{\text{reserves}}}}\, \,\href{Class.HasAdd.Core.html#162}{\htmlId{2985}{\htmlClass{Field Operator}{\text{+}}}}\, \,\href{Ledger.Conway.Specification.Rewards.html#6306}{\htmlId{2987}{\htmlClass{Function}{\text{Δr}}}}\,\,\htmlId{2989}{\htmlClass{Symbol}{\text{)}}}\, \end{pmatrix}
  \\ \,\href{Ledger.Conway.Conformance.Epoch.html#2739}{\htmlId{2997}{\htmlClass{Bound}{\text{ss}}}}\,
  \\ \begin{pmatrix} \begin{pmatrix} \,\href{Ledger.Conway.Conformance.Epoch.html#2750}{\htmlId{3008}{\htmlClass{Bound}{\text{utxo}}}}\, \\ \,\href{Prelude.html#3280}{\htmlId{3015}{\htmlClass{Function}{\text{posPart}}}}\, \,\htmlId{3023}{\htmlClass{Symbol}{\text{(}}}\,\,\href{Ledger.Conway.Conformance.Epoch.html#351}{\htmlId{3024}{\htmlClass{InductiveConstructor}{\text{pos}}}}\, \,\href{Ledger.Conway.Conformance.Epoch.html#2757}{\htmlId{3028}{\htmlClass{Bound}{\text{fees}}}}\, \,\href{Class.HasAdd.Core.html#162}{\htmlId{3033}{\htmlClass{Field Operator}{\text{+}}}}\, \,\href{Ledger.Conway.Specification.Rewards.html#6309}{\htmlId{3035}{\htmlClass{Function}{\text{Δf}}}}\,\,\htmlId{3037}{\htmlClass{Symbol}{\text{)}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#2764}{\htmlId{3041}{\htmlClass{Bound}{\text{deposits}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#2775}{\htmlId{3052}{\htmlClass{Bound}{\text{donations}}}}\, \end{pmatrix}
    \\ \,\href{Ledger.Conway.Conformance.Epoch.html#2794}{\htmlId{3070}{\htmlClass{Bound}{\text{govSt}}}}\,
    \\ \begin{pmatrix} \begin{pmatrix} \,\href{Ledger.Conway.Conformance.Epoch.html#2810}{\htmlId{3086}{\htmlClass{Bound}{\text{voteDelegs}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#2823}{\htmlId{3099}{\htmlClass{Bound}{\text{stakeDelegs}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#2837}{\htmlId{3113}{\htmlClass{Bound}{\text{rewards}}}}\, \,\href{Axiom.Set.Map.Dec.html#2149}{\htmlId{3121}{\htmlClass{Function Operator}{\text{∪⁺}}}}\, \,\href{Ledger.Conway.Conformance.Epoch.html#3253}{\htmlId{3124}{\htmlClass{Function}{\text{regRU}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#2847}{\htmlId{3132}{\htmlClass{Bound}{\text{deposits&#39;}}}}\, \end{pmatrix} \\ \,\href{Ledger.Conway.Conformance.Epoch.html#2862}{\htmlId{3146}{\htmlClass{Bound}{\text{pState}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#2871}{\htmlId{3155}{\htmlClass{Bound}{\text{gState}}}}\, \end{pmatrix} \end{pmatrix}
  \\ \,\href{Ledger.Conway.Conformance.Epoch.html#2889}{\htmlId{3170}{\htmlClass{Bound}{\text{es}}}}\,
  \\ \,\href{Ledger.Conway.Conformance.Epoch.html#2896}{\htmlId{3177}{\htmlClass{Bound}{\text{fut}}}}\, \end{pmatrix}$</a>
  <a id="3185" class="Keyword">where</a>
    <a id="3195" class="Keyword">open</a> <a id="3200" href="Ledger.Conway.Specification.Rewards.html#6266" class="Module">RewardUpdate</a> <a id="3213" href="Ledger.Conway.Conformance.Epoch.html#2693" class="Bound">rewardUpdate</a> <a id="3226" class="Keyword">using</a> <a id="3232" class="Symbol">(</a><a id="3233" href="Ledger.Conway.Specification.Rewards.html#6303" class="Field">Δt</a><a id="3235" class="Symbol">;</a> <a id="3237" href="Ledger.Conway.Specification.Rewards.html#6306" class="Field">Δr</a><a id="3239" class="Symbol">;</a> <a id="3241" href="Ledger.Conway.Specification.Rewards.html#6309" class="Field">Δf</a><a id="3243" class="Symbol">;</a> <a id="3245" href="Ledger.Conway.Specification.Rewards.html#6329" class="Field">rs</a><a id="3247" class="Symbol">)</a>
    <a id="3253" href="Ledger.Conway.Conformance.Epoch.html#3253" class="Function">regRU</a>     <a id="3263" class="Symbol">=</a> <a id="3265" href="Ledger.Conway.Specification.Rewards.html#6329" class="Function">rs</a> <a id="3268" href="Axiom.Set.Map.html#13536" class="Function Operator">∣</a> <a id="3270" href="Class.IsSet.html#916" class="Function">dom</a> <a id="3274" href="Ledger.Conway.Conformance.Epoch.html#2837" class="Bound">rewards</a>
    <a id="3286" href="Ledger.Conway.Conformance.Epoch.html#3286" class="Function">unregRU</a>   <a id="3296" class="Symbol">=</a> <a id="3298" href="Ledger.Conway.Specification.Rewards.html#6329" class="Function">rs</a> <a id="3301" href="Axiom.Set.Map.html#13606" class="Function Operator">∣</a> <a id="3303" href="Class.IsSet.html#916" class="Function">dom</a> <a id="3307" href="Ledger.Conway.Conformance.Epoch.html#2837" class="Bound">rewards</a> <a id="3315" href="Axiom.Set.Map.html#13606" class="Function Operator">ᶜ</a>
    <a id="3321" href="Ledger.Conway.Conformance.Epoch.html#3321" class="Function">unregRU&#39;</a>  <a id="3331" class="Symbol">=</a> <a id="3333" href="abstract-set-theory.FiniteSetTheory.html#4373" class="Function">∑[</a> <a id="3336" href="Ledger.Conway.Conformance.Epoch.html#3336" class="Bound">x</a> <a id="3338" href="abstract-set-theory.FiniteSetTheory.html#4373" class="Function">←</a> <a id="3340" href="Ledger.Conway.Conformance.Epoch.html#3286" class="Function">unregRU</a> <a id="3348" href="abstract-set-theory.FiniteSetTheory.html#4373" class="Function">]</a> <a id="3350" href="Ledger.Conway.Conformance.Epoch.html#3336" class="Bound">x</a>

<a id="3353" class="Keyword">opaque</a>
  <a id="calculatePoolDelegatedStake"></a><a id="3362" href="Ledger.Conway.Conformance.Epoch.html#3362" class="Function">calculatePoolDelegatedStake</a> <a id="3390" class="Symbol">:</a> <a id="3392" href="Ledger.Conway.Specification.Rewards.html#6489" class="Record">Snapshot</a> <a id="3401" class="Symbol">→</a> <a id="3403" href="Ledger.Conway.Conformance.Epoch.html#1320" class="Function">PoolDelegatedStake</a>
  <a id="3424" href="Ledger.Conway.Conformance.Epoch.html#3362" class="Function">calculatePoolDelegatedStake</a> <a id="3452" href="Ledger.Conway.Conformance.Epoch.html#3452" class="Bound">ss</a> <a id="3455" class="Symbol">=</a>
      <a id="3463" class="Comment">-- Shelley spec: the output map must contain keys appearing in both</a>
      <a id="3537" class="Comment">-- sd and the pool parameters.</a>
      <a id="3574" href="Ledger.Conway.Conformance.Epoch.html#3830" class="Function">sd</a> <a id="3577" href="Axiom.Set.Map.html#13536" class="Function Operator">∣</a> <a id="3579" href="Class.IsSet.html#916" class="Function">dom</a> <a id="3583" class="Symbol">(</a><a id="3584" href="Ledger.Conway.Conformance.Epoch.html#3452" class="Bound">ss</a> <a id="3587" class="Symbol">.</a><a id="3588" href="Ledger.Conway.Specification.Rewards.html#6578" class="Field">pools</a><a id="3593" class="Symbol">)</a>
    <a id="3599" class="Keyword">where</a>
      <a id="3611" class="Keyword">open</a> <a id="3616" href="Ledger.Conway.Specification.Rewards.html#6489" class="Module">Snapshot</a>

      <a id="3632" class="Comment">-- stake credentials delegating to each pool</a>
      <a id="3683" href="Ledger.Conway.Conformance.Epoch.html#3683" class="Function">stakeCredentialsPerPool</a> <a id="3707" class="Symbol">:</a> <a id="3709" href="Axiom.Set.Rel.html#1312" class="Function">Rel</a> <a id="3713" href="Ledger.Core.Specification.Crypto.html#1386" class="Function">KeyHash</a> <a id="3721" href="Ledger.Core.Specification.Address.html#259" class="Datatype">Credential</a>
      <a id="3738" href="Ledger.Conway.Conformance.Epoch.html#3683" class="Function">stakeCredentialsPerPool</a> <a id="3762" class="Symbol">=</a> <a id="3764" class="Symbol">(</a><a id="3765" href="Ledger.Core.Specification.Certs.html#1861" class="Field">StakeDelegsOf</a> <a id="3779" href="Ledger.Conway.Conformance.Epoch.html#3452" class="Bound">ss</a> <a id="3782" href="Axiom.Set.Map.html#2293" class="Function Operator">ˢ</a><a id="3783" class="Symbol">)</a> <a id="3785" href="Axiom.Set.Rel.html#1608" class="Function Operator">⁻¹ʳ</a>

      <a id="3796" class="Comment">-- delegated stake per pool</a>
      <a id="3830" href="Ledger.Conway.Conformance.Epoch.html#3830" class="Function">sd</a> <a id="3833" class="Symbol">:</a> <a id="3835" href="Ledger.Core.Specification.Crypto.html#1386" class="Function">KeyHash</a> <a id="3843" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="3845" href="Ledger.Prelude.Base.html#154" class="Function">Coin</a>
      <a id="3856" href="Ledger.Conway.Conformance.Epoch.html#3830" class="Function">sd</a> <a id="3859" class="Symbol">=</a> <a id="3861" href="Axiom.Set.Map.Dec.html#2227" class="Function">aggregate₊</a> <a id="3872" class="Symbol">((</a><a id="3874" href="Ledger.Conway.Conformance.Epoch.html#3683" class="Function">stakeCredentialsPerPool</a> <a id="3898" href="abstract-set-theory.FiniteSetTheory.html#3111" class="Function Operator">∘ʳ</a> <a id="3901" class="Symbol">(</a><a id="3902" href="Ledger.Core.Specification.Certs.html#1777" class="Field">StakeOf</a> <a id="3910" href="Ledger.Conway.Conformance.Epoch.html#3452" class="Bound">ss</a> <a id="3913" href="Axiom.Set.Map.html#2293" class="Function Operator">ˢ</a><a id="3914" class="Symbol">))</a> <a id="3917" href="abstract-set-theory.FiniteSetTheory.html#2921" class="Function Operator">ᶠˢ</a><a id="3919" class="Symbol">)</a>


<a id="3923" class="Keyword">private</a> <a id="3931" class="Keyword">variable</a>
  <a id="3942" href="Ledger.Conway.Conformance.Epoch.html#3942" class="Generalizable">nes</a> <a id="3946" href="Ledger.Conway.Conformance.Epoch.html#3946" class="Generalizable">nes&#39;</a> <a id="3951" class="Symbol">:</a> <a id="3953" href="Ledger.Conway.Conformance.Epoch.html#1390" class="Record">NewEpochState</a>
  <a id="3969" href="Ledger.Conway.Conformance.Epoch.html#3969" class="Generalizable">e</a> <a id="3971" href="Ledger.Conway.Conformance.Epoch.html#3971" class="Generalizable">lastEpoch</a> <a id="3981" class="Symbol">:</a> <a id="3983" href="Ledger.Core.Specification.Epoch.html#646" class="Function">Epoch</a>
  <a id="3991" href="Ledger.Conway.Conformance.Epoch.html#3991" class="Generalizable">fut</a> <a id="3995" href="Ledger.Conway.Conformance.Epoch.html#3995" class="Generalizable">fut&#39;</a> <a id="4000" class="Symbol">:</a> <a id="4002" href="Ledger.Conway.Specification.Ratify.html#3529" class="Record">RatifyState</a>
  <a id="4016" href="Ledger.Conway.Conformance.Epoch.html#4016" class="Generalizable">eps</a> <a id="4020" href="Ledger.Conway.Conformance.Epoch.html#4020" class="Generalizable">eps&#39;</a> <a id="4025" href="Ledger.Conway.Conformance.Epoch.html#4025" class="Generalizable">eps&#39;&#39;</a> <a id="4031" class="Symbol">:</a> <a id="4033" href="Ledger.Conway.Conformance.Epoch.html#1129" class="Record">EpochState</a>
  <a id="4046" href="Ledger.Conway.Conformance.Epoch.html#4046" class="Generalizable">ls</a> <a id="4049" class="Symbol">:</a> <a id="4051" href="Ledger.Conway.Conformance.Ledger.html#732" class="Record">LState</a>
  <a id="4060" href="Ledger.Conway.Conformance.Epoch.html#4060" class="Generalizable">acnt</a> <a id="4065" class="Symbol">:</a> <a id="4067" href="Ledger.Conway.Specification.PParams.html#718" class="Record">Acnt</a>
  <a id="4074" href="Ledger.Conway.Conformance.Epoch.html#4074" class="Generalizable">es₀</a> <a id="4078" class="Symbol">:</a> <a id="4080" href="Ledger.Conway.Specification.Enact.html#444" class="Record">EnactState</a>
  <a id="4093" href="Ledger.Conway.Conformance.Epoch.html#4093" class="Generalizable">mark</a> <a id="4098" href="Ledger.Conway.Conformance.Epoch.html#4098" class="Generalizable">set</a> <a id="4102" href="Ledger.Conway.Conformance.Epoch.html#4102" class="Generalizable">go</a> <a id="4105" class="Symbol">:</a> <a id="4107" href="Ledger.Conway.Specification.Rewards.html#6489" class="Record">Snapshot</a>
  <a id="4118" href="Ledger.Conway.Conformance.Epoch.html#4118" class="Generalizable">feeSS</a> <a id="4124" class="Symbol">:</a> <a id="4126" href="Ledger.Prelude.Base.html#154" class="Function">Coin</a>
  <a id="4133" href="Ledger.Conway.Conformance.Epoch.html#4133" class="Generalizable">lstate</a> <a id="4140" class="Symbol">:</a> <a id="4142" href="Ledger.Conway.Conformance.Ledger.html#732" class="Record">LState</a>
  <a id="4151" href="Ledger.Conway.Conformance.Epoch.html#4151" class="Generalizable">ss</a> <a id="4154" href="Ledger.Conway.Conformance.Epoch.html#4154" class="Generalizable">ss&#39;</a> <a id="4158" class="Symbol">:</a> <a id="4160" href="Ledger.Conway.Specification.Rewards.html#7736" class="Record">Snapshots</a>
  <a id="4172" href="Ledger.Conway.Conformance.Epoch.html#4172" class="Generalizable">ru</a> <a id="4175" class="Symbol">:</a> <a id="4177" href="Ledger.Conway.Specification.Rewards.html#6266" class="Record">RewardUpdate</a>
  <a id="4192" href="Ledger.Conway.Conformance.Epoch.html#4192" class="Generalizable">mru</a> <a id="4196" class="Symbol">:</a> <a id="4198" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="4204" href="Ledger.Conway.Specification.Rewards.html#6266" class="Record">RewardUpdate</a>
  <a id="4219" href="Ledger.Conway.Conformance.Epoch.html#4219" class="Generalizable">certState&#39;</a> <a id="4230" class="Symbol">:</a> <a id="4232" href="Ledger.Conway.Conformance.Certs.html#958" class="Record">CertState</a>

<a id="4243" class="Keyword">data</a> <a id="_⊢_⇀⦇_,EPOCH⦈_"></a><a id="4248" href="Ledger.Conway.Conformance.Epoch.html#4248" class="Datatype Operator">_⊢_⇀⦇_,EPOCH⦈_</a> <a id="4263" class="Symbol">:</a> <a id="4265" href="Agda.Builtin.Unit.html#175" class="Record">⊤</a> <a id="4267" class="Symbol">→</a> <a id="4269" href="Ledger.Conway.Conformance.Epoch.html#1129" class="Record">EpochState</a> <a id="4280" class="Symbol">→</a> <a id="4282" href="Ledger.Core.Specification.Epoch.html#646" class="Function">Epoch</a> <a id="4288" class="Symbol">→</a> <a id="4290" href="Ledger.Conway.Conformance.Epoch.html#1129" class="Record">EpochState</a> <a id="4301" class="Symbol">→</a> <a id="4303" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="4308" class="Keyword">where</a>

  <a id="_⊢_⇀⦇_,EPOCH⦈_.EPOCH"></a><a id="4317" href="Ledger.Conway.Conformance.Epoch.html#4317" class="InductiveConstructor">EPOCH</a> <a id="4323" class="Symbol">:</a> <a id="4325" class="Keyword">let</a>
      <a id="4335" class="Keyword">open</a> <a id="4340" href="Ledger.Conway.Conformance.Ledger.html#732" class="Module">LState</a> <a id="4347" href="Ledger.Conway.Conformance.Epoch.html#4046" class="Generalizable">ls</a>
      <a id="4356" class="Keyword">open</a> <a id="4361" href="Ledger.Conway.Conformance.Certs.html#958" class="Module">CertState</a> <a id="4371" href="Ledger.Conway.Conformance.Ledger.html#840" class="Function">certState</a>
      <a id="4387" class="Keyword">open</a> <a id="4392" href="Ledger.Conway.Specification.Ratify.html#3529" class="Module">RatifyState</a> <a id="4404" href="Ledger.Conway.Conformance.Epoch.html#3991" class="Generalizable">fut</a> <a id="4408" class="Keyword">renaming</a> <a id="4417" class="Symbol">(</a><a id="4418" href="Ledger.Conway.Specification.Ratify.html#3566" class="Field">es</a> <a id="4421" class="Symbol">to</a> <a id="4424" class="Field">esW</a><a id="4427" class="Symbol">)</a>
      <a id="4435" class="Keyword">open</a> <a id="4440" href="Ledger.Conway.Specification.Utxo.html#1300" class="Module">UTxOState</a>
      <a id="4456" class="Keyword">open</a> <a id="4461" href="Ledger.Core.Specification.Certs.html#3872" class="Module">PState</a><a id="4467" class="Symbol">;</a> <a id="4469" class="Keyword">open</a> <a id="4474" href="Ledger.Conway.Conformance.Certs.html#604" class="Module">DState</a><a id="4480" class="Symbol">;</a> <a id="4482" class="Keyword">open</a> <a id="4487" href="Ledger.Conway.Conformance.Certs.html#790" class="Module">GState</a>
      <a id="4500" class="Keyword">open</a> <a id="4505" href="Ledger.Conway.Specification.PParams.html#718" class="Module">Acnt</a><a id="4509" class="Symbol">;</a> <a id="4511" class="Keyword">open</a> <a id="4516" href="Ledger.Conway.Specification.Enact.html#444" class="Module">EnactState</a><a id="4526" class="Symbol">;</a> <a id="4528" class="Keyword">open</a> <a id="4533" href="Ledger.Core.Specification.Gov.Actions.html#3818" class="Module">GovActionState</a>

      <a id="4555" href="Ledger.Conway.Conformance.Epoch.html#4555" class="Bound">es</a> <a id="4558" class="Symbol">:</a> <a id="4560" href="Ledger.Conway.Specification.Enact.html#444" class="Record">EnactState</a>
      <a id="4577" href="Ledger.Conway.Conformance.Epoch.html#4555" class="Bound">es</a> <a id="4580" class="Symbol">=</a> <a id="4582" class="Keyword">record</a> <a id="4589" href="Ledger.Conway.Conformance.Epoch.html#4424" class="Function">esW</a> <a id="4593" class="Symbol">{</a> <a id="4595" href="Ledger.Conway.Specification.Enact.html#696" class="Field">withdrawals</a> <a id="4607" class="Symbol">=</a> <a id="4609" href="Class.HasEmptySet.html#287" class="Field">∅</a> <a id="4611" class="Symbol">}</a>

      <a id="4620" href="Ledger.Conway.Conformance.Epoch.html#4620" class="Bound">tmpGovSt</a> <a id="4629" class="Symbol">=</a> <a id="4631" href="Data.List.Base.html#10389" class="Function">filter</a> <a id="4638" class="Symbol">(λ</a> <a id="4641" href="Ledger.Conway.Conformance.Epoch.html#4641" class="Bound">x</a> <a id="4643" class="Symbol">→</a> <a id="4645" href="Class.Decidable.Core.html#470" class="Function Operator">¿</a> <a id="4647" href="Data.Product.Base.html#636" class="Field">proj₁</a> <a id="4653" href="Ledger.Conway.Conformance.Epoch.html#4641" class="Bound">x</a> <a id="4655" href="Class.IsSet.html#462" class="Function Operator">∉</a> <a id="4657" href="abstract-set-theory.FiniteSetTheory.html#519" class="Function">mapˢ</a> <a id="4662" href="Data.Product.Base.html#636" class="Field">proj₁</a> <a id="4668" href="Ledger.Conway.Specification.Ratify.html#3592" class="Function">removed</a> <a id="4676" href="Class.Decidable.Core.html#470" class="Function Operator">¿</a><a id="4677" class="Symbol">)</a> <a id="4679" href="Ledger.Conway.Conformance.Ledger.html#814" class="Function">govSt</a>

      <a id="4692" href="Ledger.Conway.Conformance.Epoch.html#4692" class="Bound">orphans</a> <a id="4700" class="Symbol">:</a> <a id="4702" href="abstract-set-theory.FiniteSetTheory.html#488" class="Function Operator">ℙ</a> <a id="4704" class="Symbol">(</a><a id="4705" href="Ledger.Core.Specification.Gov.Actions.html#1976" class="Function">GovActionID</a> <a id="4717" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="4719" href="Ledger.Core.Specification.Gov.Actions.html#3818" class="Record">GovActionState</a><a id="4733" class="Symbol">)</a>
      <a id="4741" href="Ledger.Conway.Conformance.Epoch.html#4692" class="Bound">orphans</a>  <a id="4750" class="Symbol">=</a> <a id="4752" href="Axiom.Set.html#5903" class="Function">fromList</a> <a id="4761" class="Symbol">(</a><a id="4762" href="Ledger.Conway.Specification.Epoch.html#13208" class="Function">getOrphans</a> <a id="4773" href="Ledger.Conway.Conformance.Epoch.html#4555" class="Bound">es</a> <a id="4776" href="Ledger.Conway.Conformance.Epoch.html#4620" class="Bound">tmpGovSt</a><a id="4784" class="Symbol">)</a>

      <a id="4793" href="Ledger.Conway.Conformance.Epoch.html#4793" class="Bound">removed&#39;</a> <a id="4802" class="Symbol">:</a> <a id="4804" href="abstract-set-theory.FiniteSetTheory.html#488" class="Function Operator">ℙ</a> <a id="4806" class="Symbol">(</a><a id="4807" href="Ledger.Core.Specification.Gov.Actions.html#1976" class="Function">GovActionID</a> <a id="4819" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="4821" href="Ledger.Core.Specification.Gov.Actions.html#3818" class="Record">GovActionState</a><a id="4835" class="Symbol">)</a>
      <a id="4843" href="Ledger.Conway.Conformance.Epoch.html#4793" class="Bound">removed&#39;</a> <a id="4852" class="Symbol">=</a> <a id="4854" href="Ledger.Conway.Specification.Ratify.html#3592" class="Function">removed</a> <a id="4862" href="Axiom.Set.html#9137" class="Function Operator">∪</a> <a id="4864" href="Ledger.Conway.Conformance.Epoch.html#4692" class="Bound">orphans</a>

      <a id="4879" href="Ledger.Conway.Conformance.Epoch.html#4879" class="Bound">govSt&#39;</a> <a id="4886" class="Symbol">=</a> <a id="4888" href="Data.List.Base.html#10389" class="Function">filter</a> <a id="4895" class="Symbol">(λ</a> <a id="4898" href="Ledger.Conway.Conformance.Epoch.html#4898" class="Bound">x</a> <a id="4900" class="Symbol">→</a> <a id="4902" href="Class.Decidable.Core.html#470" class="Function Operator">¿</a> <a id="4904" href="Data.Product.Base.html#636" class="Field">proj₁</a> <a id="4910" href="Ledger.Conway.Conformance.Epoch.html#4898" class="Bound">x</a> <a id="4912" href="Class.IsSet.html#462" class="Function Operator">∉</a> <a id="4914" href="abstract-set-theory.FiniteSetTheory.html#519" class="Function">mapˢ</a> <a id="4919" href="Data.Product.Base.html#636" class="Field">proj₁</a> <a id="4925" href="Ledger.Conway.Conformance.Epoch.html#4793" class="Bound">removed&#39;</a> <a id="4934" href="Class.Decidable.Core.html#470" class="Function Operator">¿</a><a id="4935" class="Symbol">)</a> <a id="4937" href="Ledger.Conway.Conformance.Ledger.html#814" class="Function">govSt</a>

      <a id="4950" href="Ledger.Conway.Conformance.Epoch.html#4950" class="Bound">removedGovActions</a> <a id="4968" class="Symbol">:</a> <a id="4970" href="abstract-set-theory.FiniteSetTheory.html#488" class="Function Operator">ℙ</a> <a id="4972" class="Symbol">(</a><a id="4973" href="Ledger.Core.Specification.Address.html#1313" class="Record">RewardAddress</a> <a id="4987" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="4989" href="Ledger.Core.Specification.Certs.html#534" class="Datatype">DepositPurpose</a> <a id="5004" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="5006" href="Ledger.Prelude.Base.html#154" class="Function">Coin</a><a id="5010" class="Symbol">)</a>
      <a id="5018" href="Ledger.Conway.Conformance.Epoch.html#4950" class="Bound">removedGovActions</a> <a id="5036" class="Symbol">=</a>
        <a id="5046" href="Function.Base.html#1657" class="Function">flip</a> <a id="5051" href="Axiom.Set.html#7207" class="Function">concatMapˢ</a> <a id="5062" href="Ledger.Conway.Conformance.Epoch.html#4793" class="Bound">removed&#39;</a> <a id="5071" class="Symbol">λ</a> <a id="5073" class="Symbol">(</a><a id="5074" href="Ledger.Conway.Conformance.Epoch.html#5074" class="Bound">gaid</a> <a id="5079" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5081" href="Ledger.Conway.Conformance.Epoch.html#5081" class="Bound">gaSt</a><a id="5085" class="Symbol">)</a> <a id="5087" class="Symbol">→</a>
          <a id="5099" href="abstract-set-theory.FiniteSetTheory.html#519" class="Function">mapˢ</a>
            <a id="5116" class="Symbol">(</a><a id="5117" href="Ledger.Core.Specification.Gov.Actions.html#3885" class="Field">returnAddr</a> <a id="5128" href="Ledger.Conway.Conformance.Epoch.html#5081" class="Bound">gaSt</a> <a id="5133" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,_</a><a id="5135" class="Symbol">)</a>
            <a id="5149" class="Symbol">((</a><a id="5151" href="Ledger.Conway.Conformance.Ledger.html#787" class="Function">utxoSt</a> <a id="5158" class="Symbol">.</a><a id="5159" href="Ledger.Conway.Specification.Utxo.html#1408" class="Field">deposits</a> <a id="5168" href="Axiom.Set.Map.html#13536" class="Function Operator">∣</a> <a id="5170" href="Class.HasSingleton.html#288" class="Field Operator">❴</a> <a id="5172" href="Ledger.Core.Specification.Certs.html#723" class="InductiveConstructor">GovActionDeposit</a> <a id="5189" href="Ledger.Conway.Conformance.Epoch.html#5074" class="Bound">gaid</a> <a id="5194" href="Class.HasSingleton.html#288" class="Field Operator">❵</a><a id="5195" class="Symbol">)</a> <a id="5197" href="Axiom.Set.Map.html#2293" class="Function Operator">ˢ</a><a id="5198" class="Symbol">)</a>

      <a id="5207" href="Ledger.Conway.Conformance.Epoch.html#5207" class="Bound">govActionReturns</a> <a id="5224" class="Symbol">:</a> <a id="5226" href="Ledger.Core.Specification.Address.html#1313" class="Record">RewardAddress</a> <a id="5240" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="5242" href="Ledger.Prelude.Base.html#154" class="Function">Coin</a>
      <a id="5253" href="Ledger.Conway.Conformance.Epoch.html#5207" class="Bound">govActionReturns</a> <a id="5270" class="Symbol">=</a>
        <a id="5280" href="Axiom.Set.Map.Dec.html#2227" class="Function">aggregate₊</a> <a id="5291" class="Symbol">(</a><a id="5292" href="abstract-set-theory.FiniteSetTheory.html#519" class="Function">mapˢ</a> <a id="5297" class="Symbol">(λ</a> <a id="5300" class="Symbol">(</a><a id="5301" href="Ledger.Conway.Conformance.Epoch.html#5301" class="Bound">a</a> <a id="5303" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5305" class="Symbol">_</a> <a id="5307" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5309" href="Ledger.Conway.Conformance.Epoch.html#5309" class="Bound">d</a><a id="5310" class="Symbol">)</a> <a id="5312" class="Symbol">→</a> <a id="5314" href="Ledger.Conway.Conformance.Epoch.html#5301" class="Bound">a</a> <a id="5316" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5318" href="Ledger.Conway.Conformance.Epoch.html#5309" class="Bound">d</a><a id="5319" class="Symbol">)</a> <a id="5321" href="Ledger.Conway.Conformance.Epoch.html#4950" class="Bound">removedGovActions</a> <a id="5339" href="abstract-set-theory.FiniteSetTheory.html#2921" class="Function Operator">ᶠˢ</a><a id="5341" class="Symbol">)</a>

      <a id="5350" href="Ledger.Conway.Conformance.Epoch.html#5350" class="Bound">trWithdrawals</a>   <a id="5366" class="Symbol">=</a> <a id="5368" href="Ledger.Conway.Conformance.Epoch.html#4424" class="Function">esW</a> <a id="5372" class="Symbol">.</a><a id="5373" href="Ledger.Conway.Specification.Enact.html#696" class="Field">withdrawals</a>
      <a id="5391" href="Ledger.Conway.Conformance.Epoch.html#5391" class="Bound">totWithdrawals</a>  <a id="5407" class="Symbol">=</a> <a id="5409" href="abstract-set-theory.FiniteSetTheory.html#4373" class="Function">∑[</a> <a id="5412" href="Ledger.Conway.Conformance.Epoch.html#5412" class="Bound">x</a> <a id="5414" href="abstract-set-theory.FiniteSetTheory.html#4373" class="Function">←</a> <a id="5416" href="Ledger.Conway.Conformance.Epoch.html#5350" class="Bound">trWithdrawals</a> <a id="5430" href="abstract-set-theory.FiniteSetTheory.html#4373" class="Function">]</a> <a id="5432" href="Ledger.Conway.Conformance.Epoch.html#5412" class="Bound">x</a>

      <a id="5441" href="Ledger.Conway.Conformance.Epoch.html#5441" class="Bound">retired</a>    <a id="5452" class="Symbol">=</a> <a id="5454" class="Symbol">(</a><a id="5455" href="Ledger.Conway.Conformance.Certs.html#1037" class="Function">pState</a> <a id="5462" class="Symbol">.</a><a id="5463" href="Ledger.Core.Specification.Certs.html#3948" class="Field">retiring</a><a id="5471" class="Symbol">)</a> <a id="5473" href="Axiom.Set.Map.html#17957" class="Function Operator">⁻¹</a> <a id="5476" href="Ledger.Conway.Conformance.Epoch.html#3969" class="Generalizable">e</a>
      <a id="5484" href="Ledger.Conway.Conformance.Epoch.html#5484" class="Bound">payout</a>     <a id="5495" class="Symbol">=</a> <a id="5497" href="Ledger.Conway.Conformance.Epoch.html#5207" class="Bound">govActionReturns</a> <a id="5514" href="Axiom.Set.Map.Dec.html#2149" class="Function Operator">∪⁺</a> <a id="5517" href="Ledger.Conway.Conformance.Epoch.html#5350" class="Bound">trWithdrawals</a>
      <a id="5537" href="Ledger.Conway.Conformance.Epoch.html#5537" class="Bound">refunds</a>    <a id="5548" class="Symbol">=</a> <a id="5550" href="Axiom.Set.Map.html#17518" class="Function">pullbackMap</a> <a id="5562" href="Ledger.Conway.Conformance.Epoch.html#5484" class="Bound">payout</a> <a id="5569" href="Ledger.Conway.Specification.Epoch.html#5487" class="Function">toRewardAddress</a> <a id="5585" class="Symbol">(</a><a id="5586" href="Class.IsSet.html#916" class="Function">dom</a> <a id="5590" class="Symbol">(</a><a id="5591" href="Ledger.Conway.Conformance.Certs.html#1017" class="Function">dState</a> <a id="5598" class="Symbol">.</a><a id="5599" href="Ledger.Conway.Conformance.Certs.html#731" class="Field">rewards</a><a id="5606" class="Symbol">))</a>
      <a id="5615" href="Ledger.Conway.Conformance.Epoch.html#5615" class="Bound">unclaimed</a>  <a id="5626" class="Symbol">=</a> <a id="5628" href="Ledger.Prelude.HasCoin.html#171" class="Field">getCoin</a> <a id="5636" href="Ledger.Conway.Conformance.Epoch.html#5484" class="Bound">payout</a> <a id="5643" href="Interface.TypeClasses.HasSubtract.html#223" class="Field Operator">-</a> <a id="5645" href="Ledger.Prelude.HasCoin.html#171" class="Field">getCoin</a> <a id="5653" href="Ledger.Conway.Conformance.Epoch.html#5537" class="Bound">refunds</a>
      <a id="5667" href="Ledger.Conway.Conformance.Epoch.html#5667" class="Bound">vDeposits</a>  <a id="5678" class="Symbol">=</a> <a id="5680" href="Ledger.Conway.Conformance.Certs.html#1057" class="Function">gState</a> <a id="5687" class="Symbol">.</a><a id="5688" href="Ledger.Conway.Conformance.Certs.html#928" class="Field">deposits</a>

      <a id="5704" href="Ledger.Conway.Conformance.Epoch.html#5704" class="Bound">dState&#39;</a> <a id="5712" class="Symbol">:</a> <a id="5714" href="Ledger.Conway.Conformance.Certs.html#604" class="Record">DState</a>
      <a id="5727" href="Ledger.Conway.Conformance.Epoch.html#5704" class="Bound">dState&#39;</a> <a id="5735" class="Symbol">=</a> <a id="5737" class="Keyword">record</a> <a id="5744" href="Ledger.Conway.Conformance.Certs.html#1017" class="Function">dState</a> <a id="5751" class="Symbol">{</a> <a id="5753" href="Ledger.Conway.Conformance.Certs.html#731" class="Field">rewards</a> <a id="5761" class="Symbol">=</a> <a id="5763" href="Ledger.Conway.Conformance.Certs.html#1017" class="Function">dState</a> <a id="5770" class="Symbol">.</a><a id="5771" href="Ledger.Conway.Conformance.Certs.html#731" class="Field">rewards</a> <a id="5779" href="Axiom.Set.Map.Dec.html#2149" class="Function Operator">∪⁺</a> <a id="5782" href="Ledger.Conway.Conformance.Epoch.html#5537" class="Bound">refunds</a> <a id="5790" class="Symbol">}</a>

      <a id="5799" href="Ledger.Conway.Conformance.Epoch.html#5799" class="Bound">pState&#39;</a> <a id="5807" class="Symbol">:</a> <a id="5809" href="Ledger.Core.Specification.Certs.html#3872" class="Record">PState</a>
      <a id="5822" href="Ledger.Conway.Conformance.Epoch.html#5799" class="Bound">pState&#39;</a> <a id="5830" class="Symbol">=</a> <a class="AgdaKaTeX">$\begin{pmatrix} \,\htmlId{5834}{\htmlClass{Symbol}{\text{(}}}\,\,\href{Ledger.Conway.Conformance.Certs.html#1037}{\htmlId{5835}{\htmlClass{Function}{\text{pState}}}}\, \,\htmlId{5842}{\htmlClass{Symbol}{\text{.}}}\,\,\href{Ledger.Core.Specification.Certs.html#3904}{\htmlId{5843}{\htmlClass{Field}{\text{pools}}}}\,\,\htmlId{5848}{\htmlClass{Symbol}{\text{)}}}\, \,\href{Axiom.Set.Map.html#13606}{\htmlId{5850}{\htmlClass{Function Operator}{\text{∣}}}}\, \,\href{Ledger.Conway.Conformance.Epoch.html#5441}{\htmlId{5852}{\htmlClass{Bound}{\text{retired}}}}\, \,\href{Axiom.Set.Map.html#13606}{\htmlId{5860}{\htmlClass{Function Operator}{\text{ᶜ}}}}\,
                \\ \,\htmlId{5880}{\htmlClass{Symbol}{\text{(}}}\,\,\href{Ledger.Conway.Conformance.Certs.html#1037}{\htmlId{5881}{\htmlClass{Function}{\text{pState}}}}\, \,\htmlId{5888}{\htmlClass{Symbol}{\text{.}}}\,\,\href{Ledger.Core.Specification.Certs.html#3926}{\htmlId{5889}{\htmlClass{Field}{\text{fPools}}}}\,\,\htmlId{5895}{\htmlClass{Symbol}{\text{)}}}\, \,\href{Axiom.Set.Map.html#13606}{\htmlId{5897}{\htmlClass{Function Operator}{\text{∣}}}}\, \,\href{Ledger.Conway.Conformance.Epoch.html#5441}{\htmlId{5899}{\htmlClass{Bound}{\text{retired}}}}\, \,\href{Axiom.Set.Map.html#13606}{\htmlId{5907}{\htmlClass{Function Operator}{\text{ᶜ}}}}\,
                \\ \,\htmlId{5927}{\htmlClass{Symbol}{\text{(}}}\,\,\href{Ledger.Conway.Conformance.Certs.html#1037}{\htmlId{5928}{\htmlClass{Function}{\text{pState}}}}\, \,\htmlId{5935}{\htmlClass{Symbol}{\text{.}}}\,\,\href{Ledger.Core.Specification.Certs.html#3948}{\htmlId{5936}{\htmlClass{Field}{\text{retiring}}}}\,\,\htmlId{5944}{\htmlClass{Symbol}{\text{)}}}\, \,\href{Axiom.Set.Map.html#13606}{\htmlId{5946}{\htmlClass{Function Operator}{\text{∣}}}}\, \,\href{Ledger.Conway.Conformance.Epoch.html#5441}{\htmlId{5948}{\htmlClass{Bound}{\text{retired}}}}\, \,\href{Axiom.Set.Map.html#13606}{\htmlId{5956}{\htmlClass{Function Operator}{\text{ᶜ}}}}\,
                \end{pmatrix}$</a>

      <a id="5983" href="Ledger.Conway.Conformance.Epoch.html#5983" class="Bound">gState&#39;</a> <a id="5991" class="Symbol">:</a> <a id="5993" href="Ledger.Conway.Conformance.Certs.html#790" class="Record">GState</a>
      <a id="6006" href="Ledger.Conway.Conformance.Epoch.html#5983" class="Bound">gState&#39;</a> <a id="6014" class="Symbol">=</a> <a class="AgdaKaTeX">$\begin{pmatrix} \,\htmlId{6018}{\htmlClass{Symbol}{\text{(}}}\,\,\href{Class.ToBool.html#342}{\htmlId{6019}{\htmlClass{Function Operator}{\text{if}}}}\, \,\href{Data.List.Base.html#4681}{\htmlId{6022}{\htmlClass{Function}{\text{null}}}}\, \,\href{Ledger.Conway.Conformance.Epoch.html#4879}{\htmlId{6027}{\htmlClass{Bound}{\text{govSt&#39;}}}}\, \,\href{Class.ToBool.html#342}{\htmlId{6034}{\htmlClass{Function Operator}{\text{then}}}}\, \,\href{Axiom.Set.Map.html#7108}{\htmlId{6039}{\htmlClass{Function}{\text{mapValues}}}}\, \,\htmlId{6049}{\htmlClass{Symbol}{\text{(}}}\,\,\htmlId{6050}{\htmlClass{Number}{\text{1}}}\, \,\href{Class.HasAdd.Core.html#162}{\htmlId{6052}{\htmlClass{Field Operator}{\text{+\_}}}}\,\,\htmlId{6054}{\htmlClass{Symbol}{\text{)}}}\, \,\htmlId{6056}{\htmlClass{Symbol}{\text{(}}}\,\,\href{Ledger.Conway.Conformance.Certs.html#1057}{\htmlId{6057}{\htmlClass{Function}{\text{gState}}}}\, \,\htmlId{6064}{\htmlClass{Symbol}{\text{.}}}\,\,\href{Ledger.Conway.Conformance.Certs.html#845}{\htmlId{6065}{\htmlClass{Field}{\text{dreps}}}}\,\,\htmlId{6070}{\htmlClass{Symbol}{\text{)}}}\, \,\href{Class.ToBool.html#342}{\htmlId{6072}{\htmlClass{Function Operator}{\text{else}}}}\, \,\htmlId{6077}{\htmlClass{Symbol}{\text{(}}}\,\,\href{Ledger.Conway.Conformance.Certs.html#1057}{\htmlId{6078}{\htmlClass{Function}{\text{gState}}}}\, \,\htmlId{6085}{\htmlClass{Symbol}{\text{.}}}\,\,\href{Ledger.Conway.Conformance.Certs.html#845}{\htmlId{6086}{\htmlClass{Field}{\text{dreps}}}}\,\,\htmlId{6091}{\htmlClass{Symbol}{\text{))}}}\,
                , \,\htmlId{6112}{\htmlClass{Symbol}{\text{(}}}\,\,\href{Ledger.Conway.Conformance.Certs.html#1057}{\htmlId{6113}{\htmlClass{Function}{\text{gState}}}}\, \,\htmlId{6120}{\htmlClass{Symbol}{\text{.}}}\,\,\href{Ledger.Conway.Conformance.Certs.html#881}{\htmlId{6121}{\htmlClass{Field}{\text{ccHotKeys}}}}\,\,\htmlId{6130}{\htmlClass{Symbol}{\text{)}}}\, \,\href{Axiom.Set.Map.html#13536}{\htmlId{6132}{\htmlClass{Function Operator}{\text{∣}}}}\, \,\href{Ledger.Conway.Specification.Enact.html#1362}{\htmlId{6134}{\htmlClass{Function}{\text{ccCreds}}}}\, \,\htmlId{6142}{\htmlClass{Symbol}{\text{(}}}\,\,\href{Ledger.Conway.Conformance.Epoch.html#4555}{\htmlId{6143}{\htmlClass{Bound}{\text{es}}}}\, \,\htmlId{6146}{\htmlClass{Symbol}{\text{.}}}\,\,\href{Ledger.Conway.Specification.Enact.html#480}{\htmlId{6147}{\htmlClass{Field}{\text{cc}}}}\,\,\htmlId{6149}{\htmlClass{Symbol}{\text{)}}}\,
                , \,\href{Ledger.Conway.Conformance.Epoch.html#5667}{\htmlId{6169}{\htmlClass{Bound}{\text{vDeposits}}}}\,
                \end{pmatrix}$</a>

      <a id="6204" href="Ledger.Conway.Conformance.Epoch.html#6204" class="Bound">certState&#39;</a> <a id="6215" class="Symbol">:</a> <a id="6217" href="Ledger.Conway.Conformance.Certs.html#958" class="Record">CertState</a>
      <a id="6233" href="Ledger.Conway.Conformance.Epoch.html#6204" class="Bound">certState&#39;</a> <a id="6244" class="Symbol">=</a> <a id="6246" class="Keyword">record</a> <a id="6253" class="Symbol">{</a> <a id="6255" href="Ledger.Conway.Conformance.Certs.html#1017" class="Field">dState</a> <a id="6262" class="Symbol">=</a> <a id="6264" href="Ledger.Conway.Conformance.Epoch.html#5704" class="Bound">dState&#39;</a> <a id="6272" class="Symbol">;</a> <a id="6274" href="Ledger.Conway.Conformance.Certs.html#1037" class="Field">pState</a> <a id="6281" class="Symbol">=</a> <a id="6283" href="Ledger.Conway.Conformance.Epoch.html#5799" class="Bound">pState&#39;</a> <a id="6291" class="Symbol">;</a> <a id="6293" href="Ledger.Conway.Conformance.Certs.html#1057" class="Field">gState</a> <a id="6300" class="Symbol">=</a> <a id="6302" href="Ledger.Conway.Conformance.Epoch.html#5983" class="Bound">gState&#39;</a> <a id="6310" class="Symbol">}</a>

      <a id="6319" href="Ledger.Conway.Conformance.Epoch.html#6319" class="Bound">utxoSt&#39;</a> <a id="6327" class="Symbol">=</a> <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.Conway.Conformance.Ledger.html#787}{\htmlId{6331}{\htmlClass{Function}{\text{utxoSt}}}}\, \,\htmlId{6338}{\htmlClass{Symbol}{\text{.}}}\,\,\href{Ledger.Conway.Specification.Utxo.html#1364}{\htmlId{6339}{\htmlClass{Field}{\text{utxo}}}}\, \\ \,\href{Ledger.Conway.Conformance.Ledger.html#787}{\htmlId{6346}{\htmlClass{Function}{\text{utxoSt}}}}\, \,\htmlId{6353}{\htmlClass{Symbol}{\text{.}}}\,\,\href{Ledger.Conway.Specification.Utxo.html#1386}{\htmlId{6354}{\htmlClass{Field}{\text{fees}}}}\, \\ \,\href{Ledger.Conway.Conformance.Ledger.html#787}{\htmlId{6361}{\htmlClass{Function}{\text{utxoSt}}}}\, \,\htmlId{6368}{\htmlClass{Symbol}{\text{.}}}\,\,\href{Ledger.Conway.Specification.Utxo.html#1408}{\htmlId{6369}{\htmlClass{Field}{\text{deposits}}}}\, \,\href{Axiom.Set.Map.html#13606}{\htmlId{6378}{\htmlClass{Function Operator}{\text{∣}}}}\, \,\href{abstract-set-theory.FiniteSetTheory.html#519}{\htmlId{6380}{\htmlClass{Function}{\text{mapˢ}}}}\, \,\htmlId{6385}{\htmlClass{Symbol}{\text{(}}}\,\,\href{Data.Product.Base.html#636}{\htmlId{6386}{\htmlClass{Field}{\text{proj₁}}}}\, \,\href{Function.Base.html#1134}{\htmlId{6392}{\htmlClass{Function Operator}{\text{∘}}}}\, \,\href{Data.Product.Base.html#650}{\htmlId{6394}{\htmlClass{Field}{\text{proj₂}}}}\,\,\htmlId{6399}{\htmlClass{Symbol}{\text{)}}}\, \,\href{Ledger.Conway.Conformance.Epoch.html#4950}{\htmlId{6401}{\htmlClass{Bound}{\text{removedGovActions}}}}\, \,\href{Axiom.Set.Map.html#13606}{\htmlId{6419}{\htmlClass{Function Operator}{\text{ᶜ}}}}\, \\ \,\htmlId{6423}{\htmlClass{Number}{\text{0}}}\, \end{pmatrix}$</a>

      <a id="6434" href="Ledger.Conway.Conformance.Epoch.html#6434" class="Bound">acnt&#39;</a> <a id="6440" class="Symbol">=</a> <a id="6442" class="Keyword">record</a> <a id="6449" href="Ledger.Conway.Conformance.Epoch.html#4060" class="Generalizable">acnt</a>
        <a id="6462" class="Symbol">{</a> <a id="6464" href="Ledger.Conway.Specification.PParams.html#773" class="Field">treasury</a>  <a id="6474" class="Symbol">=</a> <a id="6476" href="Ledger.Conway.Conformance.Epoch.html#4060" class="Generalizable">acnt</a> <a id="6481" class="Symbol">.</a><a id="6482" href="Ledger.Conway.Specification.PParams.html#773" class="Field">treasury</a> <a id="6491" href="Data.Nat.Base.html#4462" class="Primitive Operator">∸</a> <a id="6493" href="Ledger.Conway.Conformance.Epoch.html#5391" class="Bound">totWithdrawals</a> <a id="6508" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="6510" href="Ledger.Conway.Conformance.Ledger.html#787" class="Function">utxoSt</a> <a id="6517" class="Symbol">.</a><a id="6518" href="Ledger.Conway.Specification.Utxo.html#1434" class="Field">donations</a> <a id="6528" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="6530" href="Ledger.Conway.Conformance.Epoch.html#5615" class="Bound">unclaimed</a> <a id="6540" class="Symbol">}</a>

      <a id="6549" href="Ledger.Conway.Conformance.Epoch.html#6549" class="Bound">stakeDistrs</a> <a id="6561" class="Symbol">:</a> <a id="6563" href="Ledger.Conway.Specification.Ratify.html#3118" class="Record">StakeDistrs</a>
      <a id="6581" href="Ledger.Conway.Conformance.Epoch.html#6549" class="Bound">stakeDistrs</a> <a id="6593" class="Symbol">=</a> <a id="6595" href="Ledger.Conway.Specification.Epoch.html#12517" class="Function">mkStakeDistrs</a> <a id="6609" class="Symbol">(</a><a id="6610" href="Ledger.Conway.Specification.Rewards.html#7770" class="Field">Snapshots.mark</a> <a id="6625" href="Ledger.Conway.Conformance.Epoch.html#4154" class="Generalizable">ss&#39;</a><a id="6628" class="Symbol">)</a> <a id="6630" href="Ledger.Conway.Conformance.Epoch.html#3969" class="Generalizable">e</a> <a id="6632" href="Ledger.Conway.Conformance.Epoch.html#6319" class="Bound">utxoSt&#39;</a> <a id="6640" href="Ledger.Conway.Conformance.Epoch.html#4879" class="Bound">govSt&#39;</a> <a id="6647" class="Symbol">(</a><a id="6648" class="Keyword">record</a> <a id="6655" class="Symbol">{</a> <a id="6657" href="Ledger.Conway.Conformance.Epoch.html#6657" class="Module">GState</a> <a id="6664" class="Symbol">(</a><a id="6665" href="Ledger.Conway.Conformance.Certs.html#1057" class="Field">CertState.gState</a> <a id="6682" class="Symbol">(</a><a id="6683" href="Ledger.Conway.Conformance.Ledger.html#840" class="Field">LState.certState</a> <a id="6700" href="Ledger.Conway.Conformance.Epoch.html#4046" class="Generalizable">ls</a><a id="6702" class="Symbol">))</a> <a id="6705" class="Symbol">})</a>
                                                                        <a id="6780" class="Symbol">(</a><a id="6781" class="Keyword">record</a> <a id="6788" class="Symbol">{</a> <a id="6790" href="Ledger.Conway.Conformance.Epoch.html#6790" class="Module">DState</a> <a id="6797" class="Symbol">(</a><a id="6798" href="Ledger.Conway.Conformance.Certs.html#1017" class="Field">CertState.dState</a> <a id="6815" class="Symbol">(</a><a id="6816" href="Ledger.Conway.Conformance.Ledger.html#840" class="Field">LState.certState</a> <a id="6833" href="Ledger.Conway.Conformance.Epoch.html#4046" class="Generalizable">ls</a><a id="6835" class="Symbol">))</a> <a id="6838" class="Symbol">})</a>

    <a id="6846" class="Keyword">in</a>
    <a id="6853" class="Keyword">record</a> <a id="6860" class="Symbol">{</a> <a id="6862" href="Ledger.Conway.Specification.Ratify.html#3304" class="Field">currentEpoch</a> <a id="6875" class="Symbol">=</a> <a id="6877" href="Ledger.Conway.Conformance.Epoch.html#3969" class="Generalizable">e</a>
           <a id="6890" class="Symbol">;</a> <a id="6892" href="Ledger.Conway.Specification.Ratify.html#3272" class="Field">stakeDistrs</a> <a id="6904" class="Symbol">=</a> <a id="6906" href="Ledger.Conway.Conformance.Epoch.html#6549" class="Bound">stakeDistrs</a>
           <a id="6929" class="Symbol">;</a> <a id="6931" href="Ledger.Conway.Specification.Ratify.html#3419" class="Field">treasury</a> <a id="6940" class="Symbol">=</a> <a id="6942" href="Ledger.Conway.Conformance.Epoch.html#4060" class="Generalizable">acnt</a> <a id="6947" class="Symbol">.</a><a id="6948" href="Ledger.Conway.Specification.PParams.html#773" class="Field">treasury</a> <a id="6957" class="Symbol">;</a> <a id="6959" href="Ledger.Conway.Conformance.Epoch.html#6959" class="Module">GState</a> <a id="6966" href="Ledger.Conway.Conformance.Certs.html#1057" class="Function">gState</a>
           <a id="6984" class="Symbol">;</a> <a id="6986" href="Ledger.Conway.Specification.Ratify.html#3448" class="Field">pools</a> <a id="6992" class="Symbol">=</a> <a id="6994" href="Ledger.Conway.Conformance.Certs.html#1037" class="Function">pState</a> <a id="7001" class="Symbol">.</a><a id="7002" href="Ledger.Core.Specification.Certs.html#3904" class="Field">pools</a> <a id="7008" class="Symbol">;</a> <a id="7010" href="Ledger.Conway.Specification.Ratify.html#3494" class="Field">delegatees</a> <a id="7021" class="Symbol">=</a> <a id="7023" href="Ledger.Conway.Conformance.Certs.html#1017" class="Function">dState</a> <a id="7030" class="Symbol">.</a><a id="7031" href="Ledger.Conway.Conformance.Certs.html#661" class="Field">voteDelegs</a> <a id="7042" class="Symbol">}</a>
        <a id="7052" href="Ledger.Conway.Specification.Ratify.html#13640" class="Function Operator">⊢</a> <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.Conway.Conformance.Epoch.html#4555}{\htmlId{7056}{\htmlClass{Bound}{\text{es}}}}\, \\ \,\href{Class.HasEmptySet.html#287}{\htmlId{7061}{\htmlClass{Field}{\text{∅}}}}\, \\ \,\href{Agda.Builtin.Bool.html#192}{\htmlId{7065}{\htmlClass{InductiveConstructor}{\text{false}}}}\, \end{pmatrix}$</a> <a id="7073" href="Ledger.Conway.Specification.Ratify.html#13640" class="Function Operator">⇀⦇</a> <a id="7076" href="Ledger.Conway.Conformance.Epoch.html#4879" class="Bound">govSt&#39;</a> <a id="7083" href="Ledger.Conway.Specification.Ratify.html#13640" class="Function Operator">,RATIFIES⦈</a> <a id="7094" href="Ledger.Conway.Conformance.Epoch.html#3995" class="Generalizable">fut&#39;</a>
      <a id="7105" class="Symbol">→</a> <a id="7107" href="Ledger.Conway.Conformance.Epoch.html#4046" class="Generalizable">ls</a> <a id="7110" href="Ledger.Conway.Conformance.Rewards.html#630" class="Datatype Operator">⊢</a> <a id="7112" href="Ledger.Conway.Conformance.Epoch.html#4151" class="Generalizable">ss</a> <a id="7115" href="Ledger.Conway.Conformance.Rewards.html#630" class="Datatype Operator">⇀⦇</a> <a id="7118" href="Agda.Builtin.Unit.html#212" class="InductiveConstructor">tt</a> <a id="7121" href="Ledger.Conway.Conformance.Rewards.html#630" class="Datatype Operator">,SNAP⦈</a> <a id="7128" href="Ledger.Conway.Conformance.Epoch.html#4154" class="Generalizable">ss&#39;</a>
    <a id="7136" href="Prelude.InferenceRules.html#13694" class="Function Operator">────────────────────────────────</a>
    <a id="7173" class="Symbol">_</a> <a id="7175" href="Ledger.Conway.Conformance.Epoch.html#4248" class="Datatype Operator">⊢</a> <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.Conway.Conformance.Epoch.html#4060}{\htmlId{7179}{\htmlClass{Generalizable}{\text{acnt}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#4151}{\htmlId{7186}{\htmlClass{Generalizable}{\text{ss}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#4046}{\htmlId{7191}{\htmlClass{Generalizable}{\text{ls}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#4074}{\htmlId{7196}{\htmlClass{Generalizable}{\text{es₀}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#3991}{\htmlId{7202}{\htmlClass{Generalizable}{\text{fut}}}}\, \end{pmatrix}$</a> <a id="7208" href="Ledger.Conway.Conformance.Epoch.html#4248" class="Datatype Operator">⇀⦇</a> <a id="7211" href="Ledger.Conway.Conformance.Epoch.html#3969" class="Generalizable">e</a> <a id="7213" href="Ledger.Conway.Conformance.Epoch.html#4248" class="Datatype Operator">,EPOCH⦈</a>
        <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.Conway.Conformance.Epoch.html#6434}{\htmlId{7231}{\htmlClass{Bound}{\text{acnt&#39;}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#4154}{\htmlId{7239}{\htmlClass{Generalizable}{\text{ss&#39;}}}}\, \\ \begin{pmatrix} \,\href{Ledger.Conway.Conformance.Epoch.html#6319}{\htmlId{7247}{\htmlClass{Bound}{\text{utxoSt&#39;}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#4879}{\htmlId{7257}{\htmlClass{Bound}{\text{govSt&#39;}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#6204}{\htmlId{7266}{\htmlClass{Bound}{\text{certState&#39;}}}}\, \end{pmatrix} \\ \,\href{Ledger.Conway.Conformance.Epoch.html#4555}{\htmlId{7281}{\htmlClass{Bound}{\text{es}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#3995}{\htmlId{7286}{\htmlClass{Generalizable}{\text{fut&#39;}}}}\, \end{pmatrix}$</a>

<a id="7294" class="Keyword">data</a> <a id="_⊢_⇀⦇_,NEWEPOCH⦈_"></a><a id="7299" href="Ledger.Conway.Conformance.Epoch.html#7299" class="Datatype Operator">_⊢_⇀⦇_,NEWEPOCH⦈_</a> <a id="7317" class="Symbol">:</a> <a id="7319" href="Agda.Builtin.Unit.html#175" class="Record">⊤</a> <a id="7321" class="Symbol">→</a> <a id="7323" href="Ledger.Conway.Conformance.Epoch.html#1390" class="Record">NewEpochState</a> <a id="7337" class="Symbol">→</a> <a id="7339" href="Ledger.Core.Specification.Epoch.html#646" class="Function">Epoch</a> <a id="7345" class="Symbol">→</a> <a id="7347" href="Ledger.Conway.Conformance.Epoch.html#1390" class="Record">NewEpochState</a> <a id="7361" class="Symbol">→</a> <a id="7363" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="7368" class="Keyword">where</a>

  <a id="_⊢_⇀⦇_,NEWEPOCH⦈_.NEWEPOCH-New"></a><a id="7377" href="Ledger.Conway.Conformance.Epoch.html#7377" class="InductiveConstructor">NEWEPOCH-New</a> <a id="7390" class="Symbol">:</a>
    <a id="7396" class="Symbol">∀</a> <a id="7398" class="Symbol">{</a><a id="7399" href="Ledger.Conway.Conformance.Epoch.html#7399" class="Bound">bprev</a> <a id="7405" href="Ledger.Conway.Conformance.Epoch.html#7405" class="Bound">bcur</a> <a id="7410" class="Symbol">:</a> <a id="7412" href="Ledger.Conway.Specification.Rewards.html#4923" class="Function">BlocksMade</a><a id="7422" class="Symbol">}</a> <a id="7424" class="Symbol">{</a><a id="7425" href="Ledger.Conway.Conformance.Epoch.html#7425" class="Bound">pd</a> <a id="7428" class="Symbol">:</a> <a id="7430" href="Ledger.Conway.Conformance.Epoch.html#1320" class="Function">PoolDelegatedStake</a><a id="7448" class="Symbol">}</a> <a id="7450" class="Symbol">→</a>
    <a id="7456" class="Keyword">let</a>
       <a id="7467" href="Ledger.Conway.Conformance.Epoch.html#7467" class="Bound">eps&#39;</a> <a id="7472" class="Symbol">=</a> <a id="7474" href="Ledger.Conway.Conformance.Epoch.html#2632" class="Function">applyRUpd</a> <a id="7484" href="Ledger.Conway.Conformance.Epoch.html#4172" class="Generalizable">ru</a> <a id="7487" href="Ledger.Conway.Conformance.Epoch.html#4016" class="Generalizable">eps</a>
       <a id="7498" href="Ledger.Conway.Conformance.Epoch.html#7498" class="Bound">ss</a>   <a id="7503" class="Symbol">=</a> <a id="7505" href="Ledger.Conway.Conformance.Epoch.html#1215" class="Field">EpochState.ss</a> <a id="7519" href="Ledger.Conway.Conformance.Epoch.html#4025" class="Generalizable">eps&#39;&#39;</a>
       <a id="7532" href="Ledger.Conway.Conformance.Epoch.html#7532" class="Bound">pd&#39;</a>  <a id="7537" class="Symbol">=</a> <a id="7539" href="Ledger.Conway.Conformance.Epoch.html#3362" class="Function">calculatePoolDelegatedStake</a> <a id="7567" class="Symbol">(</a><a id="7568" href="Ledger.Conway.Specification.Rewards.html#7775" class="Field">Snapshots.set</a> <a id="7582" href="Ledger.Conway.Conformance.Epoch.html#7498" class="Bound">ss</a><a id="7584" class="Symbol">)</a>
     <a id="7591" class="Keyword">in</a>
       <a id="7601" href="Prelude.InferenceRules.html#56075" class="Function Operator">∙</a> <a id="7603" href="Ledger.Conway.Conformance.Epoch.html#3969" class="Generalizable">e</a> <a id="7605" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="7607" href="Ledger.Conway.Conformance.Epoch.html#3971" class="Generalizable">lastEpoch</a> <a id="7617" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="7619" class="Number">1</a>
       <a id="7628" href="Prelude.InferenceRules.html#56006" class="Function Operator">∙</a> <a id="7630" class="Symbol">_</a> <a id="7632" href="Ledger.Conway.Conformance.Epoch.html#4248" class="Datatype Operator">⊢</a> <a id="7634" href="Ledger.Conway.Conformance.Epoch.html#7467" class="Bound">eps&#39;</a> <a id="7639" href="Ledger.Conway.Conformance.Epoch.html#4248" class="Datatype Operator">⇀⦇</a> <a id="7642" href="Ledger.Conway.Conformance.Epoch.html#3969" class="Generalizable">e</a> <a id="7644" href="Ledger.Conway.Conformance.Epoch.html#4248" class="Datatype Operator">,EPOCH⦈</a> <a id="7652" href="Ledger.Conway.Conformance.Epoch.html#4025" class="Generalizable">eps&#39;&#39;</a>
       <a id="7665" href="Prelude.InferenceRules.html#13694" class="Function Operator">────────────────────────────────</a>
       <a id="7705" class="Symbol">_</a> <a id="7707" href="Ledger.Conway.Conformance.Epoch.html#7299" class="Datatype Operator">⊢</a> <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.Conway.Conformance.Epoch.html#3971}{\htmlId{7711}{\htmlClass{Generalizable}{\text{lastEpoch}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#7399}{\htmlId{7723}{\htmlClass{Bound}{\text{bprev}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#7405}{\htmlId{7731}{\htmlClass{Bound}{\text{bcur}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#4016}{\htmlId{7738}{\htmlClass{Generalizable}{\text{eps}}}}\, \\ \,\href{Agda.Builtin.Maybe.html#173}{\htmlId{7744}{\htmlClass{InductiveConstructor}{\text{just}}}}\, \,\href{Ledger.Conway.Conformance.Epoch.html#4172}{\htmlId{7749}{\htmlClass{Generalizable}{\text{ru}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#7425}{\htmlId{7754}{\htmlClass{Bound}{\text{pd}}}}\, \end{pmatrix}$</a> <a id="7759" href="Ledger.Conway.Conformance.Epoch.html#7299" class="Datatype Operator">⇀⦇</a> <a id="7762" href="Ledger.Conway.Conformance.Epoch.html#3969" class="Generalizable">e</a> <a id="7764" href="Ledger.Conway.Conformance.Epoch.html#7299" class="Datatype Operator">,NEWEPOCH⦈</a> <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.Conway.Conformance.Epoch.html#3969}{\htmlId{7777}{\htmlClass{Generalizable}{\text{e}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#7405}{\htmlId{7781}{\htmlClass{Bound}{\text{bcur}}}}\, \\ \,\href{Axiom.Set.Map.html#2671}{\htmlId{7788}{\htmlClass{Function}{\text{∅ᵐ}}}}\,  \\ \,\href{Ledger.Conway.Conformance.Epoch.html#4025}{\htmlId{7794}{\htmlClass{Generalizable}{\text{eps&#39;&#39;}}}}\, \\ \,\href{Agda.Builtin.Maybe.html#194}{\htmlId{7802}{\htmlClass{InductiveConstructor}{\text{nothing}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#7532}{\htmlId{7812}{\htmlClass{Bound}{\text{pd&#39;}}}}\, \end{pmatrix}$</a>

  <a id="_⊢_⇀⦇_,NEWEPOCH⦈_.NEWEPOCH-Not-New"></a><a id="7821" href="Ledger.Conway.Conformance.Epoch.html#7821" class="InductiveConstructor">NEWEPOCH-Not-New</a> <a id="7838" class="Symbol">:</a> <a id="7840" class="Symbol">∀</a> <a id="7842" class="Symbol">{</a><a id="7843" href="Ledger.Conway.Conformance.Epoch.html#7843" class="Bound">bprev</a> <a id="7849" href="Ledger.Conway.Conformance.Epoch.html#7849" class="Bound">bcur</a> <a id="7854" class="Symbol">:</a> <a id="7856" href="Ledger.Conway.Specification.Rewards.html#4923" class="Function">BlocksMade</a><a id="7866" class="Symbol">}</a> <a id="7868" class="Symbol">{</a><a id="7869" href="Ledger.Conway.Conformance.Epoch.html#7869" class="Bound">pd</a> <a id="7872" class="Symbol">:</a> <a id="7874" href="Ledger.Conway.Conformance.Epoch.html#1320" class="Function">PoolDelegatedStake</a><a id="7892" class="Symbol">}</a> <a id="7894" class="Symbol">→</a>
    <a id="7900" href="Prelude.InferenceRules.html#56075" class="Function Operator">∙</a> <a id="7902" href="Ledger.Conway.Conformance.Epoch.html#3969" class="Generalizable">e</a> <a id="7904" href="Relation.Binary.PropositionalEquality.Core.html#1000" class="Function Operator">≢</a> <a id="7906" href="Ledger.Conway.Conformance.Epoch.html#3971" class="Generalizable">lastEpoch</a> <a id="7916" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="7918" class="Number">1</a>
      <a id="7926" href="Prelude.InferenceRules.html#13694" class="Function Operator">────────────────────────────────</a>
      <a id="7965" class="Symbol">_</a> <a id="7967" href="Ledger.Conway.Conformance.Epoch.html#7299" class="Datatype Operator">⊢</a> <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.Conway.Conformance.Epoch.html#3971}{\htmlId{7971}{\htmlClass{Generalizable}{\text{lastEpoch}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#7843}{\htmlId{7983}{\htmlClass{Bound}{\text{bprev}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#7849}{\htmlId{7991}{\htmlClass{Bound}{\text{bcur}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#4016}{\htmlId{7998}{\htmlClass{Generalizable}{\text{eps}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#4192}{\htmlId{8004}{\htmlClass{Generalizable}{\text{mru}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#7869}{\htmlId{8010}{\htmlClass{Bound}{\text{pd}}}}\, \end{pmatrix}$</a> <a id="8015" href="Ledger.Conway.Conformance.Epoch.html#7299" class="Datatype Operator">⇀⦇</a> <a id="8018" href="Ledger.Conway.Conformance.Epoch.html#3969" class="Generalizable">e</a> <a id="8020" href="Ledger.Conway.Conformance.Epoch.html#7299" class="Datatype Operator">,NEWEPOCH⦈</a> <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.Conway.Conformance.Epoch.html#3971}{\htmlId{8033}{\htmlClass{Generalizable}{\text{lastEpoch}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#7843}{\htmlId{8045}{\htmlClass{Bound}{\text{bprev}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#7849}{\htmlId{8053}{\htmlClass{Bound}{\text{bcur}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#4016}{\htmlId{8060}{\htmlClass{Generalizable}{\text{eps}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#4192}{\htmlId{8066}{\htmlClass{Generalizable}{\text{mru}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#7869}{\htmlId{8072}{\htmlClass{Bound}{\text{pd}}}}\, \end{pmatrix}$</a>

  <a id="_⊢_⇀⦇_,NEWEPOCH⦈_.NEWEPOCH-No-Reward-Update"></a><a id="8080" href="Ledger.Conway.Conformance.Epoch.html#8080" class="InductiveConstructor">NEWEPOCH-No-Reward-Update</a> <a id="8106" class="Symbol">:</a>
    <a id="8112" class="Symbol">∀</a> <a id="8114" class="Symbol">{</a><a id="8115" href="Ledger.Conway.Conformance.Epoch.html#8115" class="Bound">bprev</a> <a id="8121" href="Ledger.Conway.Conformance.Epoch.html#8121" class="Bound">bcur</a> <a id="8126" class="Symbol">:</a> <a id="8128" href="Ledger.Conway.Specification.Rewards.html#4923" class="Function">BlocksMade</a><a id="8138" class="Symbol">}</a> <a id="8140" class="Symbol">{</a><a id="8141" href="Ledger.Conway.Conformance.Epoch.html#8141" class="Bound">pd</a> <a id="8144" class="Symbol">:</a> <a id="8146" href="Ledger.Conway.Conformance.Epoch.html#1320" class="Function">PoolDelegatedStake</a><a id="8164" class="Symbol">}</a> <a id="8166" class="Symbol">→</a>
    <a id="8172" class="Keyword">let</a>
      <a id="8182" href="Ledger.Conway.Conformance.Epoch.html#8182" class="Bound">ss</a>  <a id="8186" class="Symbol">=</a> <a id="8188" href="Ledger.Conway.Conformance.Epoch.html#1215" class="Field">EpochState.ss</a> <a id="8202" href="Ledger.Conway.Conformance.Epoch.html#4020" class="Generalizable">eps&#39;</a>
      <a id="8213" href="Ledger.Conway.Conformance.Epoch.html#8213" class="Bound">pd&#39;</a> <a id="8217" class="Symbol">=</a> <a id="8219" href="Ledger.Conway.Conformance.Epoch.html#3362" class="Function">calculatePoolDelegatedStake</a> <a id="8247" class="Symbol">(</a><a id="8248" href="Ledger.Conway.Specification.Rewards.html#7775" class="Field">Snapshots.set</a> <a id="8262" href="Ledger.Conway.Conformance.Epoch.html#8182" class="Bound">ss</a><a id="8264" class="Symbol">)</a>
    <a id="8270" class="Keyword">in</a>
      <a id="8279" href="Prelude.InferenceRules.html#56075" class="Function Operator">∙</a> <a id="8281" href="Ledger.Conway.Conformance.Epoch.html#3969" class="Generalizable">e</a> <a id="8283" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="8285" href="Ledger.Conway.Conformance.Epoch.html#3971" class="Generalizable">lastEpoch</a> <a id="8295" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="8297" class="Number">1</a>
      <a id="8305" href="Prelude.InferenceRules.html#56006" class="Function Operator">∙</a> <a id="8307" class="Symbol">_</a> <a id="8309" href="Ledger.Conway.Conformance.Epoch.html#4248" class="Datatype Operator">⊢</a> <a id="8311" href="Ledger.Conway.Conformance.Epoch.html#4016" class="Generalizable">eps</a> <a id="8315" href="Ledger.Conway.Conformance.Epoch.html#4248" class="Datatype Operator">⇀⦇</a> <a id="8318" href="Ledger.Conway.Conformance.Epoch.html#3969" class="Generalizable">e</a> <a id="8320" href="Ledger.Conway.Conformance.Epoch.html#4248" class="Datatype Operator">,EPOCH⦈</a> <a id="8328" href="Ledger.Conway.Conformance.Epoch.html#4020" class="Generalizable">eps&#39;</a>
      <a id="8339" href="Prelude.InferenceRules.html#13694" class="Function Operator">────────────────────────────────</a>
      <a id="8378" class="Symbol">_</a> <a id="8380" href="Ledger.Conway.Conformance.Epoch.html#7299" class="Datatype Operator">⊢</a> <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.Conway.Conformance.Epoch.html#3971}{\htmlId{8384}{\htmlClass{Generalizable}{\text{lastEpoch}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#8115}{\htmlId{8396}{\htmlClass{Bound}{\text{bprev}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#8121}{\htmlId{8404}{\htmlClass{Bound}{\text{bcur}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#4016}{\htmlId{8411}{\htmlClass{Generalizable}{\text{eps}}}}\, \\ \,\href{Agda.Builtin.Maybe.html#194}{\htmlId{8417}{\htmlClass{InductiveConstructor}{\text{nothing}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#8141}{\htmlId{8427}{\htmlClass{Bound}{\text{pd}}}}\, \end{pmatrix}$</a> <a id="8432" href="Ledger.Conway.Conformance.Epoch.html#7299" class="Datatype Operator">⇀⦇</a> <a id="8435" href="Ledger.Conway.Conformance.Epoch.html#3969" class="Generalizable">e</a> <a id="8437" href="Ledger.Conway.Conformance.Epoch.html#7299" class="Datatype Operator">,NEWEPOCH⦈</a> <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.Conway.Conformance.Epoch.html#3969}{\htmlId{8450}{\htmlClass{Generalizable}{\text{e}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#8121}{\htmlId{8454}{\htmlClass{Bound}{\text{bcur}}}}\, \\ \,\href{Axiom.Set.Map.html#2671}{\htmlId{8461}{\htmlClass{Function}{\text{∅ᵐ}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#4020}{\htmlId{8466}{\htmlClass{Generalizable}{\text{eps&#39;}}}}\, \\ \,\href{Agda.Builtin.Maybe.html#194}{\htmlId{8473}{\htmlClass{InductiveConstructor}{\text{nothing}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#8213}{\htmlId{8483}{\htmlClass{Bound}{\text{pd&#39;}}}}\, \end{pmatrix}$</a>
</pre></body></html>