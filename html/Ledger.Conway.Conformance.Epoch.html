<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>Ledger.Conway.Conformance.Epoch</title><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.css"><link rel="stylesheet" href="Agda.css"><script src="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.js"></script><script src="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/contrib/auto-render.min.js"></script><script src="AgdaKaTeX.js" defer=""></script></head><body><pre class="Agda"><a id="1" class="Symbol">{-#</a> <a id="5" class="Keyword">OPTIONS</a> <a id="13" class="Pragma">--safe</a> <a id="20" class="Symbol">#-}</a>

<a id="25" class="Keyword">open</a> <a id="30" class="Keyword">import</a> <a id="37" href="Ledger.Core.Specification.Abstract.html" class="Module">Ledger.Core.Specification.Abstract</a>
<a id="72" class="Keyword">open</a> <a id="77" class="Keyword">import</a> <a id="84" href="Ledger.Core.Specification.Transaction.html" class="Module">Ledger.Core.Specification.Transaction</a>

<a id="123" class="Keyword">module</a> <a id="130" href="Ledger.Conway.Conformance.Epoch.html" class="Module">Ledger.Conway.Conformance.Epoch</a>
  <a id="164" class="Symbol">(</a><a id="165" href="Ledger.Conway.Conformance.Epoch.html#165" class="Bound">txs</a> <a id="169" class="Symbol">:</a> <a id="171" href="Ledger.Core.Specification.Transaction.html#896" class="Record">TransactionStructure</a><a id="191" class="Symbol">)</a> <a id="193" class="Symbol">(</a><a id="194" class="Keyword">open</a> <a id="199" href="Ledger.Core.Specification.Transaction.html#896" class="Module">TransactionStructure</a> <a id="220" href="Ledger.Conway.Conformance.Epoch.html#165" class="Bound">txs</a><a id="223" class="Symbol">)</a>
  <a id="227" class="Symbol">(</a><a id="228" href="Ledger.Conway.Conformance.Epoch.html#228" class="Bound">abs</a> <a id="232" class="Symbol">:</a> <a id="234" href="Ledger.Core.Specification.Abstract.html#826" class="Record">AbstractFunctions</a> <a id="252" href="Ledger.Conway.Conformance.Epoch.html#165" class="Bound">txs</a><a id="255" class="Symbol">)</a>
  <a id="259" class="Keyword">where</a>

<a id="266" class="Keyword">open</a> <a id="271" class="Keyword">import</a> <a id="278" href="Agda.Builtin.FromNat.html" class="Module">Agda.Builtin.FromNat</a>
<a id="299" class="Keyword">open</a> <a id="304" class="Keyword">import</a> <a id="311" href="Data.Integer.html" class="Module">Data.Integer</a> <a id="324" class="Keyword">using</a> <a id="330" class="Symbol">()</a> <a id="333" class="Keyword">renaming</a> <a id="342" class="Symbol">(</a><a id="343" href="Agda.Builtin.Int.html#263" class="InductiveConstructor">+_</a> <a id="346" class="Symbol">to</a> <a id="349" class="InductiveConstructor">pos</a><a id="352" class="Symbol">)</a>
<a id="354" class="Keyword">open</a> <a id="359" class="Keyword">import</a> <a id="366" href="Data.List.html" class="Module">Data.List</a> <a id="376" class="Keyword">using</a> <a id="382" class="Symbol">(</a><a id="383" href="Data.List.Base.html#10389" class="Function">filter</a><a id="389" class="Symbol">)</a>

<a id="392" class="Keyword">open</a> <a id="397" class="Keyword">import</a> <a id="404" href="Ledger.Prelude.html" class="Module">Ledger.Prelude</a>

<a id="420" class="Keyword">open</a> <a id="425" class="Keyword">import</a> <a id="432" href="Ledger.Conway.Conformance.Certs.html" class="Module">Ledger.Conway.Conformance.Certs</a> <a id="464" href="Ledger.Core.Specification.Transaction.html#1970" class="Function">govStructure</a>
<a id="477" class="Keyword">open</a> <a id="482" class="Keyword">import</a> <a id="489" href="Ledger.Conway.Conformance.Equivalence.html" class="Module">Ledger.Conway.Conformance.Equivalence</a> <a id="527" href="Ledger.Conway.Conformance.Epoch.html#165" class="Bound">txs</a> <a id="531" href="Ledger.Conway.Conformance.Epoch.html#228" class="Bound">abs</a>
<a id="535" class="Keyword">open</a> <a id="540" class="Keyword">import</a> <a id="547" href="Ledger.Conway.Conformance.Equivalence.Convert.html" class="Module">Ledger.Conway.Conformance.Equivalence.Convert</a>
<a id="593" class="Keyword">open</a> <a id="598" class="Keyword">import</a> <a id="605" href="Ledger.Conway.Conformance.Equivalence.Deposits.html" class="Module">Ledger.Conway.Conformance.Equivalence.Deposits</a> <a id="652" href="Ledger.Conway.Conformance.Epoch.html#165" class="Bound">txs</a> <a id="656" href="Ledger.Conway.Conformance.Epoch.html#228" class="Bound">abs</a>
<a id="660" class="Keyword">open</a> <a id="665" class="Keyword">import</a> <a id="672" href="Ledger.Conway.Conformance.Ledger.html" class="Module">Ledger.Conway.Conformance.Ledger</a> <a id="705" href="Ledger.Conway.Conformance.Epoch.html#165" class="Bound">txs</a> <a id="709" href="Ledger.Conway.Conformance.Epoch.html#228" class="Bound">abs</a>
<a id="713" class="Keyword">open</a> <a id="718" class="Keyword">import</a> <a id="725" href="Ledger.Conway.Conformance.Rewards.html" class="Module">Ledger.Conway.Conformance.Rewards</a> <a id="759" href="Ledger.Conway.Conformance.Epoch.html#165" class="Bound">txs</a> <a id="763" href="Ledger.Conway.Conformance.Epoch.html#228" class="Bound">abs</a>
<a id="767" class="Keyword">open</a> <a id="772" class="Keyword">import</a> <a id="779" href="Ledger.Conway.Conformance.Utxo.html" class="Module">Ledger.Conway.Conformance.Utxo</a> <a id="810" href="Ledger.Conway.Conformance.Epoch.html#165" class="Bound">txs</a> <a id="814" href="Ledger.Conway.Conformance.Epoch.html#228" class="Bound">abs</a>

<a id="819" class="Keyword">open</a> <a id="824" class="Keyword">import</a> <a id="831" href="Ledger.Conway.Specification.Enact.html" class="Module">Ledger.Conway.Specification.Enact</a> <a id="865" href="Ledger.Core.Specification.Transaction.html#1970" class="Function">govStructure</a>
<a id="878" class="Keyword">open</a> <a id="883" class="Keyword">import</a> <a id="890" href="Ledger.Conway.Specification.Epoch.html" class="Module">Ledger.Conway.Specification.Epoch</a> <a id="924" href="Ledger.Conway.Conformance.Epoch.html#165" class="Bound">txs</a> <a id="928" href="Ledger.Conway.Conformance.Epoch.html#228" class="Bound">abs</a>
  <a id="934" class="Keyword">using</a> <a id="940" class="Symbol">(</a><a id="941" href="Ledger.Conway.Specification.Epoch.html#5590" class="Function">getStakeCred</a><a id="953" class="Symbol">;</a> <a id="955" href="Ledger.Conway.Specification.Epoch.html#13206" class="Function">getOrphans</a><a id="965" class="Symbol">;</a> <a id="967" href="Ledger.Conway.Specification.Epoch.html#12515" class="Function">mkStakeDistrs</a><a id="980" class="Symbol">;</a> <a id="982" href="Ledger.Conway.Specification.Epoch.html#5485" class="Function">toRewardAddress</a><a id="997" class="Symbol">)</a> <a id="999" class="Keyword">public</a>
<a id="1006" class="Keyword">import</a> <a id="1013" href="Ledger.Conway.Specification.Epoch.html" class="Module">Ledger.Conway.Specification.Epoch</a> <a id="1047" href="Ledger.Conway.Conformance.Epoch.html#165" class="Bound">txs</a> <a id="1051" href="Ledger.Conway.Conformance.Epoch.html#228" class="Bound">abs</a> <a id="1055" class="Symbol">as</a> <a id="EpochSpec"></a><a id="1058" href="Ledger.Conway.Conformance.Epoch.html#1058" class="Module">EpochSpec</a>
<a id="1068" class="Keyword">open</a> <a id="1073" class="Keyword">import</a> <a id="1080" href="Ledger.Conway.Specification.Ratify.html" class="Module">Ledger.Conway.Specification.Ratify</a> <a id="1115" href="Ledger.Conway.Conformance.Epoch.html#165" class="Bound">txs</a>

<a id="1120" class="Keyword">record</a> <a id="EpochState"></a><a id="1127" href="Ledger.Conway.Conformance.Epoch.html#1127" class="Record">EpochState</a> <a id="1138" class="Symbol">:</a> <a id="1140" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="1145" class="Keyword">where</a>
  <a id="1153" class="Keyword">constructor</a> <a id="⟦_,_,_,_,_⟧ᵉ&#39;"></a><a id="1165" href="Ledger.Conway.Conformance.Epoch.html#1165" class="InductiveConstructor Operator">⟦_,_,_,_,_⟧ᵉ&#39;</a>
  <a id="1181" class="Keyword">field</a>
    <a id="EpochState.acnt"></a><a id="1191" href="Ledger.Conway.Conformance.Epoch.html#1191" class="Field">acnt</a>       <a id="1202" class="Symbol">:</a> <a id="1204" href="Ledger.Conway.Specification.PParams.html#718" class="Record">Acnt</a>
    <a id="EpochState.ss"></a><a id="1213" href="Ledger.Conway.Conformance.Epoch.html#1213" class="Field">ss</a>         <a id="1224" class="Symbol">:</a> <a id="1226" href="Ledger.Conway.Specification.Rewards.html#7734" class="Record">Snapshots</a>
    <a id="EpochState.ls"></a><a id="1240" href="Ledger.Conway.Conformance.Epoch.html#1240" class="Field">ls</a>         <a id="1251" class="Symbol">:</a> <a id="1253" href="Ledger.Conway.Conformance.Ledger.html#738" class="Record">LState</a>
    <a id="EpochState.es"></a><a id="1264" href="Ledger.Conway.Conformance.Epoch.html#1264" class="Field">es</a>         <a id="1275" class="Symbol">:</a> <a id="1277" href="Ledger.Conway.Specification.Enact.html#444" class="Record">EnactState</a>
    <a id="EpochState.fut"></a><a id="1292" href="Ledger.Conway.Conformance.Epoch.html#1292" class="Field">fut</a>        <a id="1303" class="Symbol">:</a> <a id="1305" href="Ledger.Conway.Specification.Ratify.html#3527" class="Record">RatifyState</a>

<a id="PoolDelegatedStake"></a><a id="1318" href="Ledger.Conway.Conformance.Epoch.html#1318" class="Function">PoolDelegatedStake</a> <a id="1337" class="Symbol">:</a> <a id="1339" href="Agda.Primitive.html#388" class="Primitive">Type</a>
<a id="1344" href="Ledger.Conway.Conformance.Epoch.html#1318" class="Function">PoolDelegatedStake</a> <a id="1363" class="Symbol">=</a> <a id="1365" href="Ledger.Core.Specification.Crypto.html#1386" class="Function">KeyHash</a> <a id="1373" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="1375" href="Ledger.Prelude.Base.html#154" class="Function">Coin</a>

<a id="1381" class="Keyword">record</a> <a id="NewEpochState"></a><a id="1388" href="Ledger.Conway.Conformance.Epoch.html#1388" class="Record">NewEpochState</a> <a id="1402" class="Symbol">:</a> <a id="1404" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="1409" class="Keyword">where</a>
  <a id="1417" class="Keyword">field</a>
    <a id="NewEpochState.lastEpoch"></a><a id="1427" href="Ledger.Conway.Conformance.Epoch.html#1427" class="Field">lastEpoch</a>   <a id="1439" class="Symbol">:</a> <a id="1441" href="Ledger.Core.Specification.Epoch.html#646" class="Function">Epoch</a>
    <a id="NewEpochState.bprev"></a><a id="1451" href="Ledger.Conway.Conformance.Epoch.html#1451" class="Field">bprev</a>       <a id="1463" class="Symbol">:</a> <a id="1465" href="Ledger.Conway.Specification.Rewards.html#4921" class="Function">BlocksMade</a>
    <a id="NewEpochState.bcur"></a><a id="1480" href="Ledger.Conway.Conformance.Epoch.html#1480" class="Field">bcur</a>        <a id="1492" class="Symbol">:</a> <a id="1494" href="Ledger.Conway.Specification.Rewards.html#4921" class="Function">BlocksMade</a>
    <a id="NewEpochState.epochState"></a><a id="1509" href="Ledger.Conway.Conformance.Epoch.html#1509" class="Field">epochState</a>  <a id="1521" class="Symbol">:</a> <a id="1523" href="Ledger.Conway.Conformance.Epoch.html#1127" class="Record">EpochState</a>
    <a id="NewEpochState.ru"></a><a id="1538" href="Ledger.Conway.Conformance.Epoch.html#1538" class="Field">ru</a>          <a id="1550" class="Symbol">:</a> <a id="1552" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="1558" href="Ledger.Conway.Specification.Rewards.html#6264" class="Record">RewardUpdate</a>
    <a id="NewEpochState.pd"></a><a id="1575" href="Ledger.Conway.Conformance.Epoch.html#1575" class="Field">pd</a>          <a id="1587" class="Symbol">:</a> <a id="1589" href="Ledger.Conway.Conformance.Epoch.html#1318" class="Function">PoolDelegatedStake</a>

<a id="1609" class="Keyword">instance</a>
  <a id="1620" class="Keyword">unquoteDecl</a> <a id="HasCast-EpochState"></a><a id="1632" href="Ledger.Conway.Conformance.Epoch.html#1632" class="Function">HasCast-EpochState</a> <a id="HasCast-NewEpochState"></a><a id="1651" href="Ledger.Conway.Conformance.Epoch.html#1651" class="Function">HasCast-NewEpochState</a> <a id="1673" class="Symbol">=</a> <a id="1675" href="stdlib-classes.Class.HasCast.Derive.html#2690" class="Function">derive-HasCast</a>
    <a id="1694" class="Symbol">(</a> <a id="1696" class="Symbol">(</a><a id="1697" class="Keyword">quote</a> <a id="1703" href="Ledger.Conway.Conformance.Epoch.html#1127" class="Record">EpochState</a>     <a id="1718" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1720" href="Ledger.Conway.Conformance.Epoch.html#1632" class="Function">HasCast-EpochState</a><a id="1738" class="Symbol">)</a>
    <a id="1744" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="1746" href="Data.List.Base.html#4907" class="Function Operator">[</a> <a id="1748" class="Symbol">(</a><a id="1749" class="Keyword">quote</a> <a id="1755" href="Ledger.Conway.Conformance.Epoch.html#1388" class="Record">NewEpochState</a>  <a id="1770" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1772" href="Ledger.Conway.Conformance.Epoch.html#1651" class="Function">HasCast-NewEpochState</a><a id="1793" class="Symbol">)</a><a id="1794" href="Data.List.Base.html#4907" class="Function Operator">]</a><a id="1795" class="Symbol">)</a>

  <a id="EpochStateFromConf"></a><a id="1800" href="Ledger.Conway.Conformance.Epoch.html#1800" class="Function">EpochStateFromConf</a> <a id="1819" class="Symbol">:</a> <a id="1821" href="Ledger.Conway.Conformance.Epoch.html#1127" class="Record">EpochState</a> <a id="1832" href="Ledger.Conway.Conformance.Equivalence.Convert.html#409" class="Function Operator">⭆</a> <a id="1834" href="Ledger.Conway.Specification.Epoch.html#1833" class="Record">EpochSpec.EpochState</a>
  <a id="1857" href="Ledger.Conway.Conformance.Epoch.html#1800" class="Function">EpochStateFromConf</a> <a id="1876" class="Symbol">.</a><a id="1877" href="Ledger.Conway.Conformance.Equivalence.Convert.html#217" class="Field">convⁱ</a> <a id="1883" class="Symbol">_</a> <a id="1885" href="Ledger.Conway.Conformance.Epoch.html#1885" class="Bound">epochState</a> <a id="1896" class="Symbol">=</a>
    <a id="1902" class="Keyword">let</a> <a id="1906" class="Keyword">open</a> <a id="1911" href="Ledger.Conway.Conformance.Epoch.html#1127" class="Module">EpochState</a> <a id="1922" href="Ledger.Conway.Conformance.Epoch.html#1885" class="Bound">epochState</a> <a id="1933" class="Keyword">in</a>
    <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.Conway.Conformance.Epoch.html#1191}{\htmlId{1942}{\htmlClass{Field}{\text{acnt}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#1213}{\htmlId{1949}{\htmlClass{Field}{\text{ss}}}}\, \\ \,\href{Ledger.Conway.Conformance.Equivalence.Convert.html#452}{\htmlId{1954}{\htmlClass{Function}{\text{conv}}}}\, \,\href{Ledger.Conway.Conformance.Epoch.html#1240}{\htmlId{1959}{\htmlClass{Field}{\text{ls}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#1264}{\htmlId{1964}{\htmlClass{Field}{\text{es}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#1292}{\htmlId{1969}{\htmlClass{Field}{\text{fut}}}}\, \end{pmatrix}$</a>

  <a id="EpochStateToConf"></a><a id="1978" href="Ledger.Conway.Conformance.Epoch.html#1978" class="Function">EpochStateToConf</a> <a id="1995" class="Symbol">:</a> <a id="1997" href="Ledger.Conway.Specification.Epoch.html#1833" class="Record">EpochSpec.EpochState</a> <a id="2018" href="Ledger.Conway.Conformance.Equivalence.Convert.html#409" class="Function Operator">⭆</a> <a id="2020" href="Ledger.Conway.Conformance.Epoch.html#1127" class="Record">EpochState</a>
  <a id="2033" href="Ledger.Conway.Conformance.Epoch.html#1978" class="Function">EpochStateToConf</a> <a id="2050" class="Symbol">.</a><a id="2051" href="Ledger.Conway.Conformance.Equivalence.Convert.html#217" class="Field">convⁱ</a> <a id="2057" href="Ledger.Conway.Conformance.Epoch.html#2057" class="Bound">deposits</a> <a id="2066" href="Ledger.Conway.Conformance.Epoch.html#2066" class="Bound">epochSt</a> <a id="2074" class="Symbol">=</a>
    <a id="2080" class="Keyword">let</a> <a id="2084" class="Keyword">open</a> <a id="2089" href="Ledger.Conway.Specification.Epoch.html#1833" class="Module">EpochSpec.EpochState</a> <a id="2110" href="Ledger.Conway.Conformance.Epoch.html#2066" class="Bound">epochSt</a> <a id="2118" class="Keyword">in</a>
    <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.Conway.Specification.Epoch.html#1901}{\htmlId{2127}{\htmlClass{Field}{\text{acnt}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#1923}{\htmlId{2134}{\htmlClass{Field}{\text{ss}}}}\, \\ \,\href{Ledger.Conway.Conformance.Equivalence.Deposits.html#12690}{\htmlId{2139}{\htmlClass{Function}{\text{certDeposits}}}}\, \,\href{Ledger.Conway.Specification.Epoch.html#1950}{\htmlId{2152}{\htmlClass{Field}{\text{ls}}}}\, \,\href{Ledger.Conway.Conformance.Equivalence.Convert.html#270}{\htmlId{2155}{\htmlClass{Function Operator}{\text{⊢conv}}}}\, \,\href{Ledger.Conway.Specification.Epoch.html#1950}{\htmlId{2161}{\htmlClass{Field}{\text{ls}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#1974}{\htmlId{2166}{\htmlClass{Field}{\text{es}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#2002}{\htmlId{2171}{\htmlClass{Field}{\text{fut}}}}\, \end{pmatrix}$</a>

  <a id="NewEpochStateFromConf"></a><a id="2182" href="Ledger.Conway.Conformance.Epoch.html#2182" class="Function">NewEpochStateFromConf</a> <a id="2204" class="Symbol">:</a> <a id="2206" href="Ledger.Conway.Conformance.Epoch.html#1388" class="Record">NewEpochState</a> <a id="2220" href="Ledger.Conway.Conformance.Equivalence.Convert.html#409" class="Function Operator">⭆</a> <a id="2222" href="Ledger.Conway.Specification.Epoch.html#3584" class="Record">EpochSpec.NewEpochState</a>
  <a id="2248" href="Ledger.Conway.Conformance.Epoch.html#2182" class="Function">NewEpochStateFromConf</a> <a id="2270" class="Symbol">.</a><a id="2271" href="Ledger.Conway.Conformance.Equivalence.Convert.html#217" class="Field">convⁱ</a> <a id="2277" class="Symbol">_</a> <a id="2279" href="Ledger.Conway.Conformance.Epoch.html#2279" class="Bound">newEpochState</a> <a id="2293" class="Symbol">=</a>
    <a id="2299" class="Keyword">let</a> <a id="2303" class="Keyword">open</a> <a id="2308" href="Ledger.Conway.Conformance.Epoch.html#1388" class="Module">NewEpochState</a> <a id="2322" href="Ledger.Conway.Conformance.Epoch.html#2279" class="Bound">newEpochState</a> <a id="2336" class="Keyword">in</a>
    <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.Conway.Conformance.Epoch.html#1427}{\htmlId{2345}{\htmlClass{Field}{\text{lastEpoch}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#1451}{\htmlId{2357}{\htmlClass{Field}{\text{bprev}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#1480}{\htmlId{2365}{\htmlClass{Field}{\text{bcur}}}}\, \\ \,\href{Ledger.Conway.Conformance.Equivalence.Convert.html#452}{\htmlId{2372}{\htmlClass{Function}{\text{conv}}}}\, \,\href{Ledger.Conway.Conformance.Epoch.html#1509}{\htmlId{2377}{\htmlClass{Field}{\text{epochState}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#1538}{\htmlId{2390}{\htmlClass{Field}{\text{ru}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#1575}{\htmlId{2395}{\htmlClass{Field}{\text{pd}}}}\, \end{pmatrix}$</a>

  <a id="NewEpochStateToConf"></a><a id="2403" href="Ledger.Conway.Conformance.Epoch.html#2403" class="Function">NewEpochStateToConf</a> <a id="2423" class="Symbol">:</a> <a id="2425" href="Ledger.Conway.Specification.Epoch.html#3584" class="Record">EpochSpec.NewEpochState</a> <a id="2449" href="Ledger.Conway.Conformance.Equivalence.Convert.html#409" class="Function Operator">⭆</a> <a id="2451" href="Ledger.Conway.Conformance.Epoch.html#1388" class="Record">NewEpochState</a>
  <a id="2467" href="Ledger.Conway.Conformance.Epoch.html#2403" class="Function">NewEpochStateToConf</a> <a id="2487" class="Symbol">.</a><a id="2488" href="Ledger.Conway.Conformance.Equivalence.Convert.html#217" class="Field">convⁱ</a> <a id="2494" href="Ledger.Conway.Conformance.Epoch.html#2494" class="Bound">deposits</a> <a id="2503" href="Ledger.Conway.Conformance.Epoch.html#2503" class="Bound">newEpochSt</a> <a id="2514" class="Symbol">=</a>
    <a id="2520" class="Keyword">let</a> <a id="2524" class="Keyword">open</a> <a id="2529" href="Ledger.Conway.Specification.Epoch.html#3584" class="Module">EpochSpec.NewEpochState</a> <a id="2553" href="Ledger.Conway.Conformance.Epoch.html#2503" class="Bound">newEpochSt</a> <a id="2564" class="Keyword">in</a>
    <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.Conway.Specification.Epoch.html#3623}{\htmlId{2573}{\htmlClass{Field}{\text{lastEpoch}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#3676}{\htmlId{2585}{\htmlClass{Field}{\text{bcur}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#3647}{\htmlId{2592}{\htmlClass{Field}{\text{bprev}}}}\, \\ \,\href{Ledger.Conway.Conformance.Equivalence.Convert.html#452}{\htmlId{2600}{\htmlClass{Function}{\text{conv}}}}\, \,\href{Ledger.Conway.Specification.Epoch.html#3705}{\htmlId{2605}{\htmlClass{Field}{\text{epochState}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#3734}{\htmlId{2618}{\htmlClass{Field}{\text{ru}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#3771}{\htmlId{2623}{\htmlClass{Field}{\text{pd}}}}\, \end{pmatrix}$</a>


<a id="applyRUpd"></a><a id="2630" href="Ledger.Conway.Conformance.Epoch.html#2630" class="Function">applyRUpd</a> <a id="2640" class="Symbol">:</a> <a id="2642" href="Ledger.Conway.Specification.Rewards.html#6264" class="Record">RewardUpdate</a> <a id="2655" class="Symbol">→</a> <a id="2657" href="Ledger.Conway.Conformance.Epoch.html#1127" class="Record">EpochState</a> <a id="2668" class="Symbol">→</a> <a id="2670" href="Ledger.Conway.Conformance.Epoch.html#1127" class="Record">EpochState</a>
<a id="2681" href="Ledger.Conway.Conformance.Epoch.html#2630" class="Function">applyRUpd</a> <a id="2691" href="Ledger.Conway.Conformance.Epoch.html#2691" class="Bound">rewardUpdate</a>
  <a class="AgdaKaTeX">$\begin{pmatrix} \begin{pmatrix} \,\href{Ledger.Conway.Conformance.Epoch.html#2710}{\htmlId{2710}{\htmlClass{Bound}{\text{treasury}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#2721}{\htmlId{2721}{\htmlClass{Bound}{\text{reserves}}}}\, \end{pmatrix}
  \\ \,\href{Ledger.Conway.Conformance.Epoch.html#2737}{\htmlId{2737}{\htmlClass{Bound}{\text{ss}}}}\,
  \\ \begin{pmatrix} \begin{pmatrix} \,\href{Ledger.Conway.Conformance.Epoch.html#2748}{\htmlId{2748}{\htmlClass{Bound}{\text{utxo}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#2755}{\htmlId{2755}{\htmlClass{Bound}{\text{fees}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#2762}{\htmlId{2762}{\htmlClass{Bound}{\text{deposits}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#2773}{\htmlId{2773}{\htmlClass{Bound}{\text{donations}}}}\, \end{pmatrix}
    \\ \,\href{Ledger.Conway.Conformance.Epoch.html#2792}{\htmlId{2792}{\htmlClass{Bound}{\text{govSt}}}}\,
    \\ \begin{pmatrix} \begin{pmatrix} \,\href{Ledger.Conway.Conformance.Epoch.html#2808}{\htmlId{2808}{\htmlClass{Bound}{\text{voteDelegs}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#2821}{\htmlId{2821}{\htmlClass{Bound}{\text{stakeDelegs}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#2835}{\htmlId{2835}{\htmlClass{Bound}{\text{rewards}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#2845}{\htmlId{2845}{\htmlClass{Bound}{\text{deposits&#39;}}}}\, \end{pmatrix} \\ \,\href{Ledger.Conway.Conformance.Epoch.html#2860}{\htmlId{2860}{\htmlClass{Bound}{\text{pState}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#2869}{\htmlId{2869}{\htmlClass{Bound}{\text{gState}}}}\, \end{pmatrix} \end{pmatrix}
  \\ \,\href{Ledger.Conway.Conformance.Epoch.html#2887}{\htmlId{2887}{\htmlClass{Bound}{\text{es}}}}\,
  \\ \,\href{Ledger.Conway.Conformance.Epoch.html#2894}{\htmlId{2894}{\htmlClass{Bound}{\text{fut}}}}\,
  \end{pmatrix}$</a> <a id="2904" class="Symbol">=</a>
  <a class="AgdaKaTeX">$\begin{pmatrix} \begin{pmatrix} \,\href{Prelude.html#3280}{\htmlId{2912}{\htmlClass{Function}{\text{posPart}}}}\, \,\htmlId{2920}{\htmlClass{Symbol}{\text{(}}}\,\,\href{Ledger.Conway.Conformance.Epoch.html#349}{\htmlId{2921}{\htmlClass{InductiveConstructor}{\text{pos}}}}\, \,\href{Ledger.Conway.Conformance.Epoch.html#2710}{\htmlId{2925}{\htmlClass{Bound}{\text{treasury}}}}\, \,\href{Class.HasAdd.Core.html#162}{\htmlId{2934}{\htmlClass{Field Operator}{\text{+}}}}\, \,\href{Ledger.Conway.Specification.Rewards.html#6301}{\htmlId{2936}{\htmlClass{Function}{\text{Δt}}}}\, \,\href{Class.HasAdd.Core.html#162}{\htmlId{2939}{\htmlClass{Field Operator}{\text{+}}}}\, \,\href{Ledger.Conway.Conformance.Epoch.html#349}{\htmlId{2941}{\htmlClass{InductiveConstructor}{\text{pos}}}}\, \,\href{Ledger.Conway.Conformance.Epoch.html#3319}{\htmlId{2945}{\htmlClass{Function}{\text{unregRU&#39;}}}}\,\,\htmlId{2953}{\htmlClass{Symbol}{\text{)}}}\,
    \\ \,\href{Prelude.html#3280}{\htmlId{2961}{\htmlClass{Function}{\text{posPart}}}}\, \,\htmlId{2969}{\htmlClass{Symbol}{\text{(}}}\,\,\href{Ledger.Conway.Conformance.Epoch.html#349}{\htmlId{2970}{\htmlClass{InductiveConstructor}{\text{pos}}}}\, \,\href{Ledger.Conway.Conformance.Epoch.html#2721}{\htmlId{2974}{\htmlClass{Bound}{\text{reserves}}}}\, \,\href{Class.HasAdd.Core.html#162}{\htmlId{2983}{\htmlClass{Field Operator}{\text{+}}}}\, \,\href{Ledger.Conway.Specification.Rewards.html#6304}{\htmlId{2985}{\htmlClass{Function}{\text{Δr}}}}\,\,\htmlId{2987}{\htmlClass{Symbol}{\text{)}}}\, \end{pmatrix}
  \\ \,\href{Ledger.Conway.Conformance.Epoch.html#2737}{\htmlId{2995}{\htmlClass{Bound}{\text{ss}}}}\,
  \\ \begin{pmatrix} \begin{pmatrix} \,\href{Ledger.Conway.Conformance.Epoch.html#2748}{\htmlId{3006}{\htmlClass{Bound}{\text{utxo}}}}\, \\ \,\href{Prelude.html#3280}{\htmlId{3013}{\htmlClass{Function}{\text{posPart}}}}\, \,\htmlId{3021}{\htmlClass{Symbol}{\text{(}}}\,\,\href{Ledger.Conway.Conformance.Epoch.html#349}{\htmlId{3022}{\htmlClass{InductiveConstructor}{\text{pos}}}}\, \,\href{Ledger.Conway.Conformance.Epoch.html#2755}{\htmlId{3026}{\htmlClass{Bound}{\text{fees}}}}\, \,\href{Class.HasAdd.Core.html#162}{\htmlId{3031}{\htmlClass{Field Operator}{\text{+}}}}\, \,\href{Ledger.Conway.Specification.Rewards.html#6307}{\htmlId{3033}{\htmlClass{Function}{\text{Δf}}}}\,\,\htmlId{3035}{\htmlClass{Symbol}{\text{)}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#2762}{\htmlId{3039}{\htmlClass{Bound}{\text{deposits}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#2773}{\htmlId{3050}{\htmlClass{Bound}{\text{donations}}}}\, \end{pmatrix}
    \\ \,\href{Ledger.Conway.Conformance.Epoch.html#2792}{\htmlId{3068}{\htmlClass{Bound}{\text{govSt}}}}\,
    \\ \begin{pmatrix} \begin{pmatrix} \,\href{Ledger.Conway.Conformance.Epoch.html#2808}{\htmlId{3084}{\htmlClass{Bound}{\text{voteDelegs}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#2821}{\htmlId{3097}{\htmlClass{Bound}{\text{stakeDelegs}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#2835}{\htmlId{3111}{\htmlClass{Bound}{\text{rewards}}}}\, \,\href{Axiom.Set.Map.Dec.html#2149}{\htmlId{3119}{\htmlClass{Function Operator}{\text{∪⁺}}}}\, \,\href{Ledger.Conway.Conformance.Epoch.html#3251}{\htmlId{3122}{\htmlClass{Function}{\text{regRU}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#2845}{\htmlId{3130}{\htmlClass{Bound}{\text{deposits&#39;}}}}\, \end{pmatrix} \\ \,\href{Ledger.Conway.Conformance.Epoch.html#2860}{\htmlId{3144}{\htmlClass{Bound}{\text{pState}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#2869}{\htmlId{3153}{\htmlClass{Bound}{\text{gState}}}}\, \end{pmatrix} \end{pmatrix}
  \\ \,\href{Ledger.Conway.Conformance.Epoch.html#2887}{\htmlId{3168}{\htmlClass{Bound}{\text{es}}}}\,
  \\ \,\href{Ledger.Conway.Conformance.Epoch.html#2894}{\htmlId{3175}{\htmlClass{Bound}{\text{fut}}}}\, \end{pmatrix}$</a>
  <a id="3183" class="Keyword">where</a>
    <a id="3193" class="Keyword">open</a> <a id="3198" href="Ledger.Conway.Specification.Rewards.html#6264" class="Module">RewardUpdate</a> <a id="3211" href="Ledger.Conway.Conformance.Epoch.html#2691" class="Bound">rewardUpdate</a> <a id="3224" class="Keyword">using</a> <a id="3230" class="Symbol">(</a><a id="3231" href="Ledger.Conway.Specification.Rewards.html#6301" class="Field">Δt</a><a id="3233" class="Symbol">;</a> <a id="3235" href="Ledger.Conway.Specification.Rewards.html#6304" class="Field">Δr</a><a id="3237" class="Symbol">;</a> <a id="3239" href="Ledger.Conway.Specification.Rewards.html#6307" class="Field">Δf</a><a id="3241" class="Symbol">;</a> <a id="3243" href="Ledger.Conway.Specification.Rewards.html#6327" class="Field">rs</a><a id="3245" class="Symbol">)</a>
    <a id="3251" href="Ledger.Conway.Conformance.Epoch.html#3251" class="Function">regRU</a>     <a id="3261" class="Symbol">=</a> <a id="3263" href="Ledger.Conway.Specification.Rewards.html#6327" class="Function">rs</a> <a id="3266" href="Axiom.Set.Map.html#13536" class="Function Operator">∣</a> <a id="3268" href="Class.IsSet.html#916" class="Function">dom</a> <a id="3272" href="Ledger.Conway.Conformance.Epoch.html#2835" class="Bound">rewards</a>
    <a id="3284" href="Ledger.Conway.Conformance.Epoch.html#3284" class="Function">unregRU</a>   <a id="3294" class="Symbol">=</a> <a id="3296" href="Ledger.Conway.Specification.Rewards.html#6327" class="Function">rs</a> <a id="3299" href="Axiom.Set.Map.html#13606" class="Function Operator">∣</a> <a id="3301" href="Class.IsSet.html#916" class="Function">dom</a> <a id="3305" href="Ledger.Conway.Conformance.Epoch.html#2835" class="Bound">rewards</a> <a id="3313" href="Axiom.Set.Map.html#13606" class="Function Operator">ᶜ</a>
    <a id="3319" href="Ledger.Conway.Conformance.Epoch.html#3319" class="Function">unregRU&#39;</a>  <a id="3329" class="Symbol">=</a> <a id="3331" href="abstract-set-theory.FiniteSetTheory.html#4373" class="Function">∑[</a> <a id="3334" href="Ledger.Conway.Conformance.Epoch.html#3334" class="Bound">x</a> <a id="3336" href="abstract-set-theory.FiniteSetTheory.html#4373" class="Function">←</a> <a id="3338" href="Ledger.Conway.Conformance.Epoch.html#3284" class="Function">unregRU</a> <a id="3346" href="abstract-set-theory.FiniteSetTheory.html#4373" class="Function">]</a> <a id="3348" href="Ledger.Conway.Conformance.Epoch.html#3334" class="Bound">x</a>

<a id="3351" class="Keyword">opaque</a>
  <a id="calculatePoolDelegatedStake"></a><a id="3360" href="Ledger.Conway.Conformance.Epoch.html#3360" class="Function">calculatePoolDelegatedStake</a> <a id="3388" class="Symbol">:</a> <a id="3390" href="Ledger.Conway.Specification.Rewards.html#6487" class="Record">Snapshot</a> <a id="3399" class="Symbol">→</a> <a id="3401" href="Ledger.Conway.Conformance.Epoch.html#1318" class="Function">PoolDelegatedStake</a>
  <a id="3422" href="Ledger.Conway.Conformance.Epoch.html#3360" class="Function">calculatePoolDelegatedStake</a> <a id="3450" href="Ledger.Conway.Conformance.Epoch.html#3450" class="Bound">ss</a> <a id="3453" class="Symbol">=</a>
      <a id="3461" class="Comment">-- Shelley spec: the output map must contain keys appearing in both</a>
      <a id="3535" class="Comment">-- sd and the pool parameters.</a>
      <a id="3572" href="Ledger.Conway.Conformance.Epoch.html#3828" class="Function">sd</a> <a id="3575" href="Axiom.Set.Map.html#13536" class="Function Operator">∣</a> <a id="3577" href="Class.IsSet.html#916" class="Function">dom</a> <a id="3581" class="Symbol">(</a><a id="3582" href="Ledger.Conway.Conformance.Epoch.html#3450" class="Bound">ss</a> <a id="3585" class="Symbol">.</a><a id="3586" href="Ledger.Conway.Specification.Rewards.html#6576" class="Field">pools</a><a id="3591" class="Symbol">)</a>
    <a id="3597" class="Keyword">where</a>
      <a id="3609" class="Keyword">open</a> <a id="3614" href="Ledger.Conway.Specification.Rewards.html#6487" class="Module">Snapshot</a>

      <a id="3630" class="Comment">-- stake credentials delegating to each pool</a>
      <a id="3681" href="Ledger.Conway.Conformance.Epoch.html#3681" class="Function">stakeCredentialsPerPool</a> <a id="3705" class="Symbol">:</a> <a id="3707" href="Axiom.Set.Rel.html#1312" class="Function">Rel</a> <a id="3711" href="Ledger.Core.Specification.Crypto.html#1386" class="Function">KeyHash</a> <a id="3719" href="Ledger.Core.Specification.Address.html#259" class="Datatype">Credential</a>
      <a id="3736" href="Ledger.Conway.Conformance.Epoch.html#3681" class="Function">stakeCredentialsPerPool</a> <a id="3760" class="Symbol">=</a> <a id="3762" class="Symbol">(</a><a id="3763" href="Ledger.Core.Specification.Certs.html#1861" class="Field">StakeDelegsOf</a> <a id="3777" href="Ledger.Conway.Conformance.Epoch.html#3450" class="Bound">ss</a> <a id="3780" href="Axiom.Set.Map.html#2293" class="Function Operator">ˢ</a><a id="3781" class="Symbol">)</a> <a id="3783" href="Axiom.Set.Rel.html#1608" class="Function Operator">⁻¹ʳ</a>

      <a id="3794" class="Comment">-- delegated stake per pool</a>
      <a id="3828" href="Ledger.Conway.Conformance.Epoch.html#3828" class="Function">sd</a> <a id="3831" class="Symbol">:</a> <a id="3833" href="Ledger.Core.Specification.Crypto.html#1386" class="Function">KeyHash</a> <a id="3841" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="3843" href="Ledger.Prelude.Base.html#154" class="Function">Coin</a>
      <a id="3854" href="Ledger.Conway.Conformance.Epoch.html#3828" class="Function">sd</a> <a id="3857" class="Symbol">=</a> <a id="3859" href="Axiom.Set.Map.Dec.html#2227" class="Function">aggregate₊</a> <a id="3870" class="Symbol">((</a><a id="3872" href="Ledger.Conway.Conformance.Epoch.html#3681" class="Function">stakeCredentialsPerPool</a> <a id="3896" href="abstract-set-theory.FiniteSetTheory.html#3111" class="Function Operator">∘ʳ</a> <a id="3899" class="Symbol">(</a><a id="3900" href="Ledger.Core.Specification.Certs.html#1777" class="Field">StakeOf</a> <a id="3908" href="Ledger.Conway.Conformance.Epoch.html#3450" class="Bound">ss</a> <a id="3911" href="Axiom.Set.Map.html#2293" class="Function Operator">ˢ</a><a id="3912" class="Symbol">))</a> <a id="3915" href="abstract-set-theory.FiniteSetTheory.html#2921" class="Function Operator">ᶠˢ</a><a id="3917" class="Symbol">)</a>


<a id="3921" class="Keyword">private</a> <a id="3929" class="Keyword">variable</a>
  <a id="3940" href="Ledger.Conway.Conformance.Epoch.html#3940" class="Generalizable">nes</a> <a id="3944" href="Ledger.Conway.Conformance.Epoch.html#3944" class="Generalizable">nes&#39;</a> <a id="3949" class="Symbol">:</a> <a id="3951" href="Ledger.Conway.Conformance.Epoch.html#1388" class="Record">NewEpochState</a>
  <a id="3967" href="Ledger.Conway.Conformance.Epoch.html#3967" class="Generalizable">e</a> <a id="3969" href="Ledger.Conway.Conformance.Epoch.html#3969" class="Generalizable">lastEpoch</a> <a id="3979" class="Symbol">:</a> <a id="3981" href="Ledger.Core.Specification.Epoch.html#646" class="Function">Epoch</a>
  <a id="3989" href="Ledger.Conway.Conformance.Epoch.html#3989" class="Generalizable">fut</a> <a id="3993" href="Ledger.Conway.Conformance.Epoch.html#3993" class="Generalizable">fut&#39;</a> <a id="3998" class="Symbol">:</a> <a id="4000" href="Ledger.Conway.Specification.Ratify.html#3527" class="Record">RatifyState</a>
  <a id="4014" href="Ledger.Conway.Conformance.Epoch.html#4014" class="Generalizable">eps</a> <a id="4018" href="Ledger.Conway.Conformance.Epoch.html#4018" class="Generalizable">eps&#39;</a> <a id="4023" href="Ledger.Conway.Conformance.Epoch.html#4023" class="Generalizable">eps&#39;&#39;</a> <a id="4029" class="Symbol">:</a> <a id="4031" href="Ledger.Conway.Conformance.Epoch.html#1127" class="Record">EpochState</a>
  <a id="4044" href="Ledger.Conway.Conformance.Epoch.html#4044" class="Generalizable">ls</a> <a id="4047" class="Symbol">:</a> <a id="4049" href="Ledger.Conway.Conformance.Ledger.html#738" class="Record">LState</a>
  <a id="4058" href="Ledger.Conway.Conformance.Epoch.html#4058" class="Generalizable">acnt</a> <a id="4063" class="Symbol">:</a> <a id="4065" href="Ledger.Conway.Specification.PParams.html#718" class="Record">Acnt</a>
  <a id="4072" href="Ledger.Conway.Conformance.Epoch.html#4072" class="Generalizable">es₀</a> <a id="4076" class="Symbol">:</a> <a id="4078" href="Ledger.Conway.Specification.Enact.html#444" class="Record">EnactState</a>
  <a id="4091" href="Ledger.Conway.Conformance.Epoch.html#4091" class="Generalizable">mark</a> <a id="4096" href="Ledger.Conway.Conformance.Epoch.html#4096" class="Generalizable">set</a> <a id="4100" href="Ledger.Conway.Conformance.Epoch.html#4100" class="Generalizable">go</a> <a id="4103" class="Symbol">:</a> <a id="4105" href="Ledger.Conway.Specification.Rewards.html#6487" class="Record">Snapshot</a>
  <a id="4116" href="Ledger.Conway.Conformance.Epoch.html#4116" class="Generalizable">feeSS</a> <a id="4122" class="Symbol">:</a> <a id="4124" href="Ledger.Prelude.Base.html#154" class="Function">Coin</a>
  <a id="4131" href="Ledger.Conway.Conformance.Epoch.html#4131" class="Generalizable">lstate</a> <a id="4138" class="Symbol">:</a> <a id="4140" href="Ledger.Conway.Conformance.Ledger.html#738" class="Record">LState</a>
  <a id="4149" href="Ledger.Conway.Conformance.Epoch.html#4149" class="Generalizable">ss</a> <a id="4152" href="Ledger.Conway.Conformance.Epoch.html#4152" class="Generalizable">ss&#39;</a> <a id="4156" class="Symbol">:</a> <a id="4158" href="Ledger.Conway.Specification.Rewards.html#7734" class="Record">Snapshots</a>
  <a id="4170" href="Ledger.Conway.Conformance.Epoch.html#4170" class="Generalizable">ru</a> <a id="4173" class="Symbol">:</a> <a id="4175" href="Ledger.Conway.Specification.Rewards.html#6264" class="Record">RewardUpdate</a>
  <a id="4190" href="Ledger.Conway.Conformance.Epoch.html#4190" class="Generalizable">mru</a> <a id="4194" class="Symbol">:</a> <a id="4196" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="4202" href="Ledger.Conway.Specification.Rewards.html#6264" class="Record">RewardUpdate</a>
  <a id="4217" href="Ledger.Conway.Conformance.Epoch.html#4217" class="Generalizable">certState&#39;</a> <a id="4228" class="Symbol">:</a> <a id="4230" href="Ledger.Conway.Conformance.Certs.html#958" class="Record">CertState</a>

<a id="4241" class="Keyword">data</a> <a id="_⊢_⇀⦇_,EPOCH⦈_"></a><a id="4246" href="Ledger.Conway.Conformance.Epoch.html#4246" class="Datatype Operator">_⊢_⇀⦇_,EPOCH⦈_</a> <a id="4261" class="Symbol">:</a> <a id="4263" href="Agda.Builtin.Unit.html#175" class="Record">⊤</a> <a id="4265" class="Symbol">→</a> <a id="4267" href="Ledger.Conway.Conformance.Epoch.html#1127" class="Record">EpochState</a> <a id="4278" class="Symbol">→</a> <a id="4280" href="Ledger.Core.Specification.Epoch.html#646" class="Function">Epoch</a> <a id="4286" class="Symbol">→</a> <a id="4288" href="Ledger.Conway.Conformance.Epoch.html#1127" class="Record">EpochState</a> <a id="4299" class="Symbol">→</a> <a id="4301" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="4306" class="Keyword">where</a>

  <a id="_⊢_⇀⦇_,EPOCH⦈_.EPOCH"></a><a id="4315" href="Ledger.Conway.Conformance.Epoch.html#4315" class="InductiveConstructor">EPOCH</a> <a id="4321" class="Symbol">:</a> <a id="4323" class="Keyword">let</a>
      <a id="4333" class="Keyword">open</a> <a id="4338" href="Ledger.Conway.Conformance.Ledger.html#738" class="Module">LState</a> <a id="4345" href="Ledger.Conway.Conformance.Epoch.html#4044" class="Generalizable">ls</a>
      <a id="4354" class="Keyword">open</a> <a id="4359" href="Ledger.Conway.Conformance.Certs.html#958" class="Module">CertState</a> <a id="4369" href="Ledger.Conway.Conformance.Ledger.html#846" class="Function">certState</a>
      <a id="4385" class="Keyword">open</a> <a id="4390" href="Ledger.Conway.Specification.Ratify.html#3527" class="Module">RatifyState</a> <a id="4402" href="Ledger.Conway.Conformance.Epoch.html#3989" class="Generalizable">fut</a> <a id="4406" class="Keyword">renaming</a> <a id="4415" class="Symbol">(</a><a id="4416" href="Ledger.Conway.Specification.Ratify.html#3564" class="Field">es</a> <a id="4419" class="Symbol">to</a> <a id="4422" class="Field">esW</a><a id="4425" class="Symbol">)</a>
      <a id="4433" class="Keyword">open</a> <a id="4438" href="Ledger.Conway.Specification.Utxo.html#1306" class="Module">UTxOState</a>
      <a id="4454" class="Keyword">open</a> <a id="4459" href="Ledger.Core.Specification.Certs.html#3872" class="Module">PState</a><a id="4465" class="Symbol">;</a> <a id="4467" class="Keyword">open</a> <a id="4472" href="Ledger.Conway.Conformance.Certs.html#604" class="Module">DState</a><a id="4478" class="Symbol">;</a> <a id="4480" class="Keyword">open</a> <a id="4485" href="Ledger.Conway.Conformance.Certs.html#790" class="Module">GState</a>
      <a id="4498" class="Keyword">open</a> <a id="4503" href="Ledger.Conway.Specification.PParams.html#718" class="Module">Acnt</a><a id="4507" class="Symbol">;</a> <a id="4509" class="Keyword">open</a> <a id="4514" href="Ledger.Conway.Specification.Enact.html#444" class="Module">EnactState</a><a id="4524" class="Symbol">;</a> <a id="4526" class="Keyword">open</a> <a id="4531" href="Ledger.Core.Specification.Gov.Actions.html#3818" class="Module">GovActionState</a>

      <a id="4553" href="Ledger.Conway.Conformance.Epoch.html#4553" class="Bound">es</a> <a id="4556" class="Symbol">:</a> <a id="4558" href="Ledger.Conway.Specification.Enact.html#444" class="Record">EnactState</a>
      <a id="4575" href="Ledger.Conway.Conformance.Epoch.html#4553" class="Bound">es</a> <a id="4578" class="Symbol">=</a> <a id="4580" class="Keyword">record</a> <a id="4587" href="Ledger.Conway.Conformance.Epoch.html#4422" class="Function">esW</a> <a id="4591" class="Symbol">{</a> <a id="4593" href="Ledger.Conway.Specification.Enact.html#696" class="Field">withdrawals</a> <a id="4605" class="Symbol">=</a> <a id="4607" href="Class.HasEmptySet.html#287" class="Field">∅</a> <a id="4609" class="Symbol">}</a>

      <a id="4618" href="Ledger.Conway.Conformance.Epoch.html#4618" class="Bound">tmpGovSt</a> <a id="4627" class="Symbol">=</a> <a id="4629" href="Data.List.Base.html#10389" class="Function">filter</a> <a id="4636" class="Symbol">(λ</a> <a id="4639" href="Ledger.Conway.Conformance.Epoch.html#4639" class="Bound">x</a> <a id="4641" class="Symbol">→</a> <a id="4643" href="Class.Decidable.Core.html#470" class="Function Operator">¿</a> <a id="4645" href="Data.Product.Base.html#636" class="Field">proj₁</a> <a id="4651" href="Ledger.Conway.Conformance.Epoch.html#4639" class="Bound">x</a> <a id="4653" href="Class.IsSet.html#462" class="Function Operator">∉</a> <a id="4655" href="abstract-set-theory.FiniteSetTheory.html#519" class="Function">mapˢ</a> <a id="4660" href="Data.Product.Base.html#636" class="Field">proj₁</a> <a id="4666" href="Ledger.Conway.Specification.Ratify.html#3590" class="Function">removed</a> <a id="4674" href="Class.Decidable.Core.html#470" class="Function Operator">¿</a><a id="4675" class="Symbol">)</a> <a id="4677" href="Ledger.Conway.Conformance.Ledger.html#820" class="Function">govSt</a>

      <a id="4690" href="Ledger.Conway.Conformance.Epoch.html#4690" class="Bound">orphans</a> <a id="4698" class="Symbol">:</a> <a id="4700" href="abstract-set-theory.FiniteSetTheory.html#488" class="Function Operator">ℙ</a> <a id="4702" class="Symbol">(</a><a id="4703" href="Ledger.Core.Specification.Gov.Actions.html#1976" class="Function">GovActionID</a> <a id="4715" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="4717" href="Ledger.Core.Specification.Gov.Actions.html#3818" class="Record">GovActionState</a><a id="4731" class="Symbol">)</a>
      <a id="4739" href="Ledger.Conway.Conformance.Epoch.html#4690" class="Bound">orphans</a>  <a id="4748" class="Symbol">=</a> <a id="4750" href="Axiom.Set.html#5903" class="Function">fromList</a> <a id="4759" class="Symbol">(</a><a id="4760" href="Ledger.Conway.Specification.Epoch.html#13206" class="Function">getOrphans</a> <a id="4771" href="Ledger.Conway.Conformance.Epoch.html#4553" class="Bound">es</a> <a id="4774" href="Ledger.Conway.Conformance.Epoch.html#4618" class="Bound">tmpGovSt</a><a id="4782" class="Symbol">)</a>

      <a id="4791" href="Ledger.Conway.Conformance.Epoch.html#4791" class="Bound">removed&#39;</a> <a id="4800" class="Symbol">:</a> <a id="4802" href="abstract-set-theory.FiniteSetTheory.html#488" class="Function Operator">ℙ</a> <a id="4804" class="Symbol">(</a><a id="4805" href="Ledger.Core.Specification.Gov.Actions.html#1976" class="Function">GovActionID</a> <a id="4817" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="4819" href="Ledger.Core.Specification.Gov.Actions.html#3818" class="Record">GovActionState</a><a id="4833" class="Symbol">)</a>
      <a id="4841" href="Ledger.Conway.Conformance.Epoch.html#4791" class="Bound">removed&#39;</a> <a id="4850" class="Symbol">=</a> <a id="4852" href="Ledger.Conway.Specification.Ratify.html#3590" class="Function">removed</a> <a id="4860" href="Axiom.Set.html#9137" class="Function Operator">∪</a> <a id="4862" href="Ledger.Conway.Conformance.Epoch.html#4690" class="Bound">orphans</a>

      <a id="4877" href="Ledger.Conway.Conformance.Epoch.html#4877" class="Bound">govSt&#39;</a> <a id="4884" class="Symbol">=</a> <a id="4886" href="Data.List.Base.html#10389" class="Function">filter</a> <a id="4893" class="Symbol">(λ</a> <a id="4896" href="Ledger.Conway.Conformance.Epoch.html#4896" class="Bound">x</a> <a id="4898" class="Symbol">→</a> <a id="4900" href="Class.Decidable.Core.html#470" class="Function Operator">¿</a> <a id="4902" href="Data.Product.Base.html#636" class="Field">proj₁</a> <a id="4908" href="Ledger.Conway.Conformance.Epoch.html#4896" class="Bound">x</a> <a id="4910" href="Class.IsSet.html#462" class="Function Operator">∉</a> <a id="4912" href="abstract-set-theory.FiniteSetTheory.html#519" class="Function">mapˢ</a> <a id="4917" href="Data.Product.Base.html#636" class="Field">proj₁</a> <a id="4923" href="Ledger.Conway.Conformance.Epoch.html#4791" class="Bound">removed&#39;</a> <a id="4932" href="Class.Decidable.Core.html#470" class="Function Operator">¿</a><a id="4933" class="Symbol">)</a> <a id="4935" href="Ledger.Conway.Conformance.Ledger.html#820" class="Function">govSt</a>

      <a id="4948" href="Ledger.Conway.Conformance.Epoch.html#4948" class="Bound">removedGovActions</a> <a id="4966" class="Symbol">:</a> <a id="4968" href="abstract-set-theory.FiniteSetTheory.html#488" class="Function Operator">ℙ</a> <a id="4970" class="Symbol">(</a><a id="4971" href="Ledger.Core.Specification.Address.html#1313" class="Record">RewardAddress</a> <a id="4985" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="4987" href="Ledger.Core.Specification.Certs.html#534" class="Datatype">DepositPurpose</a> <a id="5002" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="5004" href="Ledger.Prelude.Base.html#154" class="Function">Coin</a><a id="5008" class="Symbol">)</a>
      <a id="5016" href="Ledger.Conway.Conformance.Epoch.html#4948" class="Bound">removedGovActions</a> <a id="5034" class="Symbol">=</a>
        <a id="5044" href="Function.Base.html#1657" class="Function">flip</a> <a id="5049" href="Axiom.Set.html#7207" class="Function">concatMapˢ</a> <a id="5060" href="Ledger.Conway.Conformance.Epoch.html#4791" class="Bound">removed&#39;</a> <a id="5069" class="Symbol">λ</a> <a id="5071" class="Symbol">(</a><a id="5072" href="Ledger.Conway.Conformance.Epoch.html#5072" class="Bound">gaid</a> <a id="5077" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5079" href="Ledger.Conway.Conformance.Epoch.html#5079" class="Bound">gaSt</a><a id="5083" class="Symbol">)</a> <a id="5085" class="Symbol">→</a>
          <a id="5097" href="abstract-set-theory.FiniteSetTheory.html#519" class="Function">mapˢ</a>
            <a id="5114" class="Symbol">(</a><a id="5115" href="Ledger.Core.Specification.Gov.Actions.html#3885" class="Field">returnAddr</a> <a id="5126" href="Ledger.Conway.Conformance.Epoch.html#5079" class="Bound">gaSt</a> <a id="5131" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,_</a><a id="5133" class="Symbol">)</a>
            <a id="5147" class="Symbol">((</a><a id="5149" href="Ledger.Conway.Conformance.Ledger.html#793" class="Function">utxoSt</a> <a id="5156" class="Symbol">.</a><a id="5157" href="Ledger.Conway.Specification.Utxo.html#1414" class="Field">deposits</a> <a id="5166" href="Axiom.Set.Map.html#13536" class="Function Operator">∣</a> <a id="5168" href="Class.HasSingleton.html#288" class="Field Operator">❴</a> <a id="5170" href="Ledger.Core.Specification.Certs.html#723" class="InductiveConstructor">GovActionDeposit</a> <a id="5187" href="Ledger.Conway.Conformance.Epoch.html#5072" class="Bound">gaid</a> <a id="5192" href="Class.HasSingleton.html#288" class="Field Operator">❵</a><a id="5193" class="Symbol">)</a> <a id="5195" href="Axiom.Set.Map.html#2293" class="Function Operator">ˢ</a><a id="5196" class="Symbol">)</a>

      <a id="5205" href="Ledger.Conway.Conformance.Epoch.html#5205" class="Bound">govActionReturns</a> <a id="5222" class="Symbol">:</a> <a id="5224" href="Ledger.Core.Specification.Address.html#1313" class="Record">RewardAddress</a> <a id="5238" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="5240" href="Ledger.Prelude.Base.html#154" class="Function">Coin</a>
      <a id="5251" href="Ledger.Conway.Conformance.Epoch.html#5205" class="Bound">govActionReturns</a> <a id="5268" class="Symbol">=</a>
        <a id="5278" href="Axiom.Set.Map.Dec.html#2227" class="Function">aggregate₊</a> <a id="5289" class="Symbol">(</a><a id="5290" href="abstract-set-theory.FiniteSetTheory.html#519" class="Function">mapˢ</a> <a id="5295" class="Symbol">(λ</a> <a id="5298" class="Symbol">(</a><a id="5299" href="Ledger.Conway.Conformance.Epoch.html#5299" class="Bound">a</a> <a id="5301" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5303" class="Symbol">_</a> <a id="5305" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5307" href="Ledger.Conway.Conformance.Epoch.html#5307" class="Bound">d</a><a id="5308" class="Symbol">)</a> <a id="5310" class="Symbol">→</a> <a id="5312" href="Ledger.Conway.Conformance.Epoch.html#5299" class="Bound">a</a> <a id="5314" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5316" href="Ledger.Conway.Conformance.Epoch.html#5307" class="Bound">d</a><a id="5317" class="Symbol">)</a> <a id="5319" href="Ledger.Conway.Conformance.Epoch.html#4948" class="Bound">removedGovActions</a> <a id="5337" href="abstract-set-theory.FiniteSetTheory.html#2921" class="Function Operator">ᶠˢ</a><a id="5339" class="Symbol">)</a>

      <a id="5348" href="Ledger.Conway.Conformance.Epoch.html#5348" class="Bound">trWithdrawals</a>   <a id="5364" class="Symbol">=</a> <a id="5366" href="Ledger.Conway.Conformance.Epoch.html#4422" class="Function">esW</a> <a id="5370" class="Symbol">.</a><a id="5371" href="Ledger.Conway.Specification.Enact.html#696" class="Field">withdrawals</a>
      <a id="5389" href="Ledger.Conway.Conformance.Epoch.html#5389" class="Bound">totWithdrawals</a>  <a id="5405" class="Symbol">=</a> <a id="5407" href="abstract-set-theory.FiniteSetTheory.html#4373" class="Function">∑[</a> <a id="5410" href="Ledger.Conway.Conformance.Epoch.html#5410" class="Bound">x</a> <a id="5412" href="abstract-set-theory.FiniteSetTheory.html#4373" class="Function">←</a> <a id="5414" href="Ledger.Conway.Conformance.Epoch.html#5348" class="Bound">trWithdrawals</a> <a id="5428" href="abstract-set-theory.FiniteSetTheory.html#4373" class="Function">]</a> <a id="5430" href="Ledger.Conway.Conformance.Epoch.html#5410" class="Bound">x</a>

      <a id="5439" href="Ledger.Conway.Conformance.Epoch.html#5439" class="Bound">retired</a>    <a id="5450" class="Symbol">=</a> <a id="5452" class="Symbol">(</a><a id="5453" href="Ledger.Conway.Conformance.Certs.html#1037" class="Function">pState</a> <a id="5460" class="Symbol">.</a><a id="5461" href="Ledger.Core.Specification.Certs.html#3948" class="Field">retiring</a><a id="5469" class="Symbol">)</a> <a id="5471" href="Axiom.Set.Map.html#17957" class="Function Operator">⁻¹</a> <a id="5474" href="Ledger.Conway.Conformance.Epoch.html#3967" class="Generalizable">e</a>
      <a id="5482" href="Ledger.Conway.Conformance.Epoch.html#5482" class="Bound">payout</a>     <a id="5493" class="Symbol">=</a> <a id="5495" href="Ledger.Conway.Conformance.Epoch.html#5205" class="Bound">govActionReturns</a> <a id="5512" href="Axiom.Set.Map.Dec.html#2149" class="Function Operator">∪⁺</a> <a id="5515" href="Ledger.Conway.Conformance.Epoch.html#5348" class="Bound">trWithdrawals</a>
      <a id="5535" href="Ledger.Conway.Conformance.Epoch.html#5535" class="Bound">refunds</a>    <a id="5546" class="Symbol">=</a> <a id="5548" href="Axiom.Set.Map.html#17518" class="Function">pullbackMap</a> <a id="5560" href="Ledger.Conway.Conformance.Epoch.html#5482" class="Bound">payout</a> <a id="5567" href="Ledger.Conway.Specification.Epoch.html#5485" class="Function">toRewardAddress</a> <a id="5583" class="Symbol">(</a><a id="5584" href="Class.IsSet.html#916" class="Function">dom</a> <a id="5588" class="Symbol">(</a><a id="5589" href="Ledger.Conway.Conformance.Certs.html#1017" class="Function">dState</a> <a id="5596" class="Symbol">.</a><a id="5597" href="Ledger.Conway.Conformance.Certs.html#731" class="Field">rewards</a><a id="5604" class="Symbol">))</a>
      <a id="5613" href="Ledger.Conway.Conformance.Epoch.html#5613" class="Bound">unclaimed</a>  <a id="5624" class="Symbol">=</a> <a id="5626" href="Ledger.Prelude.HasCoin.html#171" class="Field">getCoin</a> <a id="5634" href="Ledger.Conway.Conformance.Epoch.html#5482" class="Bound">payout</a> <a id="5641" href="Interface.TypeClasses.HasSubtract.html#223" class="Field Operator">-</a> <a id="5643" href="Ledger.Prelude.HasCoin.html#171" class="Field">getCoin</a> <a id="5651" href="Ledger.Conway.Conformance.Epoch.html#5535" class="Bound">refunds</a>
      <a id="5665" href="Ledger.Conway.Conformance.Epoch.html#5665" class="Bound">vDeposits</a>  <a id="5676" class="Symbol">=</a> <a id="5678" href="Ledger.Conway.Conformance.Certs.html#1057" class="Function">gState</a> <a id="5685" class="Symbol">.</a><a id="5686" href="Ledger.Conway.Conformance.Certs.html#928" class="Field">deposits</a>

      <a id="5702" href="Ledger.Conway.Conformance.Epoch.html#5702" class="Bound">dState&#39;</a> <a id="5710" class="Symbol">:</a> <a id="5712" href="Ledger.Conway.Conformance.Certs.html#604" class="Record">DState</a>
      <a id="5725" href="Ledger.Conway.Conformance.Epoch.html#5702" class="Bound">dState&#39;</a> <a id="5733" class="Symbol">=</a> <a id="5735" class="Keyword">record</a> <a id="5742" href="Ledger.Conway.Conformance.Certs.html#1017" class="Function">dState</a> <a id="5749" class="Symbol">{</a> <a id="5751" href="Ledger.Conway.Conformance.Certs.html#731" class="Field">rewards</a> <a id="5759" class="Symbol">=</a> <a id="5761" href="Ledger.Conway.Conformance.Certs.html#1017" class="Function">dState</a> <a id="5768" class="Symbol">.</a><a id="5769" href="Ledger.Conway.Conformance.Certs.html#731" class="Field">rewards</a> <a id="5777" href="Axiom.Set.Map.Dec.html#2149" class="Function Operator">∪⁺</a> <a id="5780" href="Ledger.Conway.Conformance.Epoch.html#5535" class="Bound">refunds</a> <a id="5788" class="Symbol">}</a>

      <a id="5797" href="Ledger.Conway.Conformance.Epoch.html#5797" class="Bound">pState&#39;</a> <a id="5805" class="Symbol">:</a> <a id="5807" href="Ledger.Core.Specification.Certs.html#3872" class="Record">PState</a>
      <a id="5820" href="Ledger.Conway.Conformance.Epoch.html#5797" class="Bound">pState&#39;</a> <a id="5828" class="Symbol">=</a> <a class="AgdaKaTeX">$\begin{pmatrix} \,\htmlId{5832}{\htmlClass{Symbol}{\text{(}}}\,\,\href{Ledger.Conway.Conformance.Certs.html#1037}{\htmlId{5833}{\htmlClass{Function}{\text{pState}}}}\, \,\htmlId{5840}{\htmlClass{Symbol}{\text{.}}}\,\,\href{Ledger.Core.Specification.Certs.html#3904}{\htmlId{5841}{\htmlClass{Field}{\text{pools}}}}\,\,\htmlId{5846}{\htmlClass{Symbol}{\text{)}}}\, \,\href{Axiom.Set.Map.html#13606}{\htmlId{5848}{\htmlClass{Function Operator}{\text{∣}}}}\, \,\href{Ledger.Conway.Conformance.Epoch.html#5439}{\htmlId{5850}{\htmlClass{Bound}{\text{retired}}}}\, \,\href{Axiom.Set.Map.html#13606}{\htmlId{5858}{\htmlClass{Function Operator}{\text{ᶜ}}}}\,
                \\ \,\htmlId{5878}{\htmlClass{Symbol}{\text{(}}}\,\,\href{Ledger.Conway.Conformance.Certs.html#1037}{\htmlId{5879}{\htmlClass{Function}{\text{pState}}}}\, \,\htmlId{5886}{\htmlClass{Symbol}{\text{.}}}\,\,\href{Ledger.Core.Specification.Certs.html#3926}{\htmlId{5887}{\htmlClass{Field}{\text{fPools}}}}\,\,\htmlId{5893}{\htmlClass{Symbol}{\text{)}}}\, \,\href{Axiom.Set.Map.html#13606}{\htmlId{5895}{\htmlClass{Function Operator}{\text{∣}}}}\, \,\href{Ledger.Conway.Conformance.Epoch.html#5439}{\htmlId{5897}{\htmlClass{Bound}{\text{retired}}}}\, \,\href{Axiom.Set.Map.html#13606}{\htmlId{5905}{\htmlClass{Function Operator}{\text{ᶜ}}}}\,
                \\ \,\htmlId{5925}{\htmlClass{Symbol}{\text{(}}}\,\,\href{Ledger.Conway.Conformance.Certs.html#1037}{\htmlId{5926}{\htmlClass{Function}{\text{pState}}}}\, \,\htmlId{5933}{\htmlClass{Symbol}{\text{.}}}\,\,\href{Ledger.Core.Specification.Certs.html#3948}{\htmlId{5934}{\htmlClass{Field}{\text{retiring}}}}\,\,\htmlId{5942}{\htmlClass{Symbol}{\text{)}}}\, \,\href{Axiom.Set.Map.html#13606}{\htmlId{5944}{\htmlClass{Function Operator}{\text{∣}}}}\, \,\href{Ledger.Conway.Conformance.Epoch.html#5439}{\htmlId{5946}{\htmlClass{Bound}{\text{retired}}}}\, \,\href{Axiom.Set.Map.html#13606}{\htmlId{5954}{\htmlClass{Function Operator}{\text{ᶜ}}}}\,
                \end{pmatrix}$</a>

      <a id="5981" href="Ledger.Conway.Conformance.Epoch.html#5981" class="Bound">gState&#39;</a> <a id="5989" class="Symbol">:</a> <a id="5991" href="Ledger.Conway.Conformance.Certs.html#790" class="Record">GState</a>
      <a id="6004" href="Ledger.Conway.Conformance.Epoch.html#5981" class="Bound">gState&#39;</a> <a id="6012" class="Symbol">=</a> <a class="AgdaKaTeX">$\begin{pmatrix} \,\htmlId{6016}{\htmlClass{Symbol}{\text{(}}}\,\,\href{Class.ToBool.html#342}{\htmlId{6017}{\htmlClass{Function Operator}{\text{if}}}}\, \,\href{Data.List.Base.html#4681}{\htmlId{6020}{\htmlClass{Function}{\text{null}}}}\, \,\href{Ledger.Conway.Conformance.Epoch.html#4877}{\htmlId{6025}{\htmlClass{Bound}{\text{govSt&#39;}}}}\, \,\href{Class.ToBool.html#342}{\htmlId{6032}{\htmlClass{Function Operator}{\text{then}}}}\, \,\href{Axiom.Set.Map.html#7108}{\htmlId{6037}{\htmlClass{Function}{\text{mapValues}}}}\, \,\htmlId{6047}{\htmlClass{Symbol}{\text{(}}}\,\,\htmlId{6048}{\htmlClass{Number}{\text{1}}}\, \,\href{Class.HasAdd.Core.html#162}{\htmlId{6050}{\htmlClass{Field Operator}{\text{+\_}}}}\,\,\htmlId{6052}{\htmlClass{Symbol}{\text{)}}}\, \,\htmlId{6054}{\htmlClass{Symbol}{\text{(}}}\,\,\href{Ledger.Conway.Conformance.Certs.html#1057}{\htmlId{6055}{\htmlClass{Function}{\text{gState}}}}\, \,\htmlId{6062}{\htmlClass{Symbol}{\text{.}}}\,\,\href{Ledger.Conway.Conformance.Certs.html#845}{\htmlId{6063}{\htmlClass{Field}{\text{dreps}}}}\,\,\htmlId{6068}{\htmlClass{Symbol}{\text{)}}}\, \,\href{Class.ToBool.html#342}{\htmlId{6070}{\htmlClass{Function Operator}{\text{else}}}}\, \,\htmlId{6075}{\htmlClass{Symbol}{\text{(}}}\,\,\href{Ledger.Conway.Conformance.Certs.html#1057}{\htmlId{6076}{\htmlClass{Function}{\text{gState}}}}\, \,\htmlId{6083}{\htmlClass{Symbol}{\text{.}}}\,\,\href{Ledger.Conway.Conformance.Certs.html#845}{\htmlId{6084}{\htmlClass{Field}{\text{dreps}}}}\,\,\htmlId{6089}{\htmlClass{Symbol}{\text{))}}}\,
                , \,\htmlId{6110}{\htmlClass{Symbol}{\text{(}}}\,\,\href{Ledger.Conway.Conformance.Certs.html#1057}{\htmlId{6111}{\htmlClass{Function}{\text{gState}}}}\, \,\htmlId{6118}{\htmlClass{Symbol}{\text{.}}}\,\,\href{Ledger.Conway.Conformance.Certs.html#881}{\htmlId{6119}{\htmlClass{Field}{\text{ccHotKeys}}}}\,\,\htmlId{6128}{\htmlClass{Symbol}{\text{)}}}\, \,\href{Axiom.Set.Map.html#13536}{\htmlId{6130}{\htmlClass{Function Operator}{\text{∣}}}}\, \,\href{Ledger.Conway.Specification.Enact.html#1362}{\htmlId{6132}{\htmlClass{Function}{\text{ccCreds}}}}\, \,\htmlId{6140}{\htmlClass{Symbol}{\text{(}}}\,\,\href{Ledger.Conway.Conformance.Epoch.html#4553}{\htmlId{6141}{\htmlClass{Bound}{\text{es}}}}\, \,\htmlId{6144}{\htmlClass{Symbol}{\text{.}}}\,\,\href{Ledger.Conway.Specification.Enact.html#480}{\htmlId{6145}{\htmlClass{Field}{\text{cc}}}}\,\,\htmlId{6147}{\htmlClass{Symbol}{\text{)}}}\,
                , \,\href{Ledger.Conway.Conformance.Epoch.html#5665}{\htmlId{6167}{\htmlClass{Bound}{\text{vDeposits}}}}\,
                \end{pmatrix}$</a>

      <a id="6202" href="Ledger.Conway.Conformance.Epoch.html#6202" class="Bound">certState&#39;</a> <a id="6213" class="Symbol">:</a> <a id="6215" href="Ledger.Conway.Conformance.Certs.html#958" class="Record">CertState</a>
      <a id="6231" href="Ledger.Conway.Conformance.Epoch.html#6202" class="Bound">certState&#39;</a> <a id="6242" class="Symbol">=</a> <a id="6244" class="Keyword">record</a> <a id="6251" class="Symbol">{</a> <a id="6253" href="Ledger.Conway.Conformance.Certs.html#1017" class="Field">dState</a> <a id="6260" class="Symbol">=</a> <a id="6262" href="Ledger.Conway.Conformance.Epoch.html#5702" class="Bound">dState&#39;</a> <a id="6270" class="Symbol">;</a> <a id="6272" href="Ledger.Conway.Conformance.Certs.html#1037" class="Field">pState</a> <a id="6279" class="Symbol">=</a> <a id="6281" href="Ledger.Conway.Conformance.Epoch.html#5797" class="Bound">pState&#39;</a> <a id="6289" class="Symbol">;</a> <a id="6291" href="Ledger.Conway.Conformance.Certs.html#1057" class="Field">gState</a> <a id="6298" class="Symbol">=</a> <a id="6300" href="Ledger.Conway.Conformance.Epoch.html#5981" class="Bound">gState&#39;</a> <a id="6308" class="Symbol">}</a>

      <a id="6317" href="Ledger.Conway.Conformance.Epoch.html#6317" class="Bound">utxoSt&#39;</a> <a id="6325" class="Symbol">=</a> <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.Conway.Conformance.Ledger.html#793}{\htmlId{6329}{\htmlClass{Function}{\text{utxoSt}}}}\, \,\htmlId{6336}{\htmlClass{Symbol}{\text{.}}}\,\,\href{Ledger.Conway.Specification.Utxo.html#1370}{\htmlId{6337}{\htmlClass{Field}{\text{utxo}}}}\, \\ \,\href{Ledger.Conway.Conformance.Ledger.html#793}{\htmlId{6344}{\htmlClass{Function}{\text{utxoSt}}}}\, \,\htmlId{6351}{\htmlClass{Symbol}{\text{.}}}\,\,\href{Ledger.Conway.Specification.Utxo.html#1392}{\htmlId{6352}{\htmlClass{Field}{\text{fees}}}}\, \\ \,\href{Ledger.Conway.Conformance.Ledger.html#793}{\htmlId{6359}{\htmlClass{Function}{\text{utxoSt}}}}\, \,\htmlId{6366}{\htmlClass{Symbol}{\text{.}}}\,\,\href{Ledger.Conway.Specification.Utxo.html#1414}{\htmlId{6367}{\htmlClass{Field}{\text{deposits}}}}\, \,\href{Axiom.Set.Map.html#13606}{\htmlId{6376}{\htmlClass{Function Operator}{\text{∣}}}}\, \,\href{abstract-set-theory.FiniteSetTheory.html#519}{\htmlId{6378}{\htmlClass{Function}{\text{mapˢ}}}}\, \,\htmlId{6383}{\htmlClass{Symbol}{\text{(}}}\,\,\href{Data.Product.Base.html#636}{\htmlId{6384}{\htmlClass{Field}{\text{proj₁}}}}\, \,\href{Function.Base.html#1134}{\htmlId{6390}{\htmlClass{Function Operator}{\text{∘}}}}\, \,\href{Data.Product.Base.html#650}{\htmlId{6392}{\htmlClass{Field}{\text{proj₂}}}}\,\,\htmlId{6397}{\htmlClass{Symbol}{\text{)}}}\, \,\href{Ledger.Conway.Conformance.Epoch.html#4948}{\htmlId{6399}{\htmlClass{Bound}{\text{removedGovActions}}}}\, \,\href{Axiom.Set.Map.html#13606}{\htmlId{6417}{\htmlClass{Function Operator}{\text{ᶜ}}}}\, \\ \,\htmlId{6421}{\htmlClass{Number}{\text{0}}}\, \end{pmatrix}$</a>

      <a id="6432" href="Ledger.Conway.Conformance.Epoch.html#6432" class="Bound">acnt&#39;</a> <a id="6438" class="Symbol">=</a> <a id="6440" class="Keyword">record</a> <a id="6447" href="Ledger.Conway.Conformance.Epoch.html#4058" class="Generalizable">acnt</a>
        <a id="6460" class="Symbol">{</a> <a id="6462" href="Ledger.Conway.Specification.PParams.html#773" class="Field">treasury</a>  <a id="6472" class="Symbol">=</a> <a id="6474" href="Ledger.Conway.Conformance.Epoch.html#4058" class="Generalizable">acnt</a> <a id="6479" class="Symbol">.</a><a id="6480" href="Ledger.Conway.Specification.PParams.html#773" class="Field">treasury</a> <a id="6489" href="Data.Nat.Base.html#4462" class="Primitive Operator">∸</a> <a id="6491" href="Ledger.Conway.Conformance.Epoch.html#5389" class="Bound">totWithdrawals</a> <a id="6506" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="6508" href="Ledger.Conway.Conformance.Ledger.html#793" class="Function">utxoSt</a> <a id="6515" class="Symbol">.</a><a id="6516" href="Ledger.Conway.Specification.Utxo.html#1440" class="Field">donations</a> <a id="6526" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="6528" href="Ledger.Conway.Conformance.Epoch.html#5613" class="Bound">unclaimed</a> <a id="6538" class="Symbol">}</a>

      <a id="6547" href="Ledger.Conway.Conformance.Epoch.html#6547" class="Bound">stakeDistrs</a> <a id="6559" class="Symbol">:</a> <a id="6561" href="Ledger.Conway.Specification.Ratify.html#3116" class="Record">StakeDistrs</a>
      <a id="6579" href="Ledger.Conway.Conformance.Epoch.html#6547" class="Bound">stakeDistrs</a> <a id="6591" class="Symbol">=</a> <a id="6593" href="Ledger.Conway.Specification.Epoch.html#12515" class="Function">mkStakeDistrs</a> <a id="6607" class="Symbol">(</a><a id="6608" href="Ledger.Conway.Specification.Rewards.html#7768" class="Field">Snapshots.mark</a> <a id="6623" href="Ledger.Conway.Conformance.Epoch.html#4152" class="Generalizable">ss&#39;</a><a id="6626" class="Symbol">)</a> <a id="6628" href="Ledger.Conway.Conformance.Epoch.html#3967" class="Generalizable">e</a> <a id="6630" href="Ledger.Conway.Conformance.Epoch.html#6317" class="Bound">utxoSt&#39;</a> <a id="6638" href="Ledger.Conway.Conformance.Epoch.html#4877" class="Bound">govSt&#39;</a> <a id="6645" class="Symbol">(</a><a id="6646" class="Keyword">record</a> <a id="6653" class="Symbol">{</a> <a id="6655" href="Ledger.Conway.Conformance.Epoch.html#6655" class="Module">GState</a> <a id="6662" class="Symbol">(</a><a id="6663" href="Ledger.Conway.Conformance.Certs.html#1057" class="Field">CertState.gState</a> <a id="6680" class="Symbol">(</a><a id="6681" href="Ledger.Conway.Conformance.Ledger.html#846" class="Field">LState.certState</a> <a id="6698" href="Ledger.Conway.Conformance.Epoch.html#4044" class="Generalizable">ls</a><a id="6700" class="Symbol">))</a> <a id="6703" class="Symbol">})</a>
                                                                        <a id="6778" class="Symbol">(</a><a id="6779" class="Keyword">record</a> <a id="6786" class="Symbol">{</a> <a id="6788" href="Ledger.Conway.Conformance.Epoch.html#6788" class="Module">DState</a> <a id="6795" class="Symbol">(</a><a id="6796" href="Ledger.Conway.Conformance.Certs.html#1017" class="Field">CertState.dState</a> <a id="6813" class="Symbol">(</a><a id="6814" href="Ledger.Conway.Conformance.Ledger.html#846" class="Field">LState.certState</a> <a id="6831" href="Ledger.Conway.Conformance.Epoch.html#4044" class="Generalizable">ls</a><a id="6833" class="Symbol">))</a> <a id="6836" class="Symbol">})</a>

    <a id="6844" class="Keyword">in</a>
    <a id="6851" class="Keyword">record</a> <a id="6858" class="Symbol">{</a> <a id="6860" href="Ledger.Conway.Specification.Ratify.html#3302" class="Field">currentEpoch</a> <a id="6873" class="Symbol">=</a> <a id="6875" href="Ledger.Conway.Conformance.Epoch.html#3967" class="Generalizable">e</a>
           <a id="6888" class="Symbol">;</a> <a id="6890" href="Ledger.Conway.Specification.Ratify.html#3270" class="Field">stakeDistrs</a> <a id="6902" class="Symbol">=</a> <a id="6904" href="Ledger.Conway.Conformance.Epoch.html#6547" class="Bound">stakeDistrs</a>
           <a id="6927" class="Symbol">;</a> <a id="6929" href="Ledger.Conway.Specification.Ratify.html#3417" class="Field">treasury</a> <a id="6938" class="Symbol">=</a> <a id="6940" href="Ledger.Conway.Conformance.Epoch.html#4058" class="Generalizable">acnt</a> <a id="6945" class="Symbol">.</a><a id="6946" href="Ledger.Conway.Specification.PParams.html#773" class="Field">treasury</a> <a id="6955" class="Symbol">;</a> <a id="6957" href="Ledger.Conway.Conformance.Epoch.html#6957" class="Module">GState</a> <a id="6964" href="Ledger.Conway.Conformance.Certs.html#1057" class="Function">gState</a>
           <a id="6982" class="Symbol">;</a> <a id="6984" href="Ledger.Conway.Specification.Ratify.html#3446" class="Field">pools</a> <a id="6990" class="Symbol">=</a> <a id="6992" href="Ledger.Conway.Conformance.Certs.html#1037" class="Function">pState</a> <a id="6999" class="Symbol">.</a><a id="7000" href="Ledger.Core.Specification.Certs.html#3904" class="Field">pools</a> <a id="7006" class="Symbol">;</a> <a id="7008" href="Ledger.Conway.Specification.Ratify.html#3492" class="Field">delegatees</a> <a id="7019" class="Symbol">=</a> <a id="7021" href="Ledger.Conway.Conformance.Certs.html#1017" class="Function">dState</a> <a id="7028" class="Symbol">.</a><a id="7029" href="Ledger.Conway.Conformance.Certs.html#661" class="Field">voteDelegs</a> <a id="7040" class="Symbol">}</a>
        <a id="7050" href="Ledger.Conway.Specification.Ratify.html#13638" class="Function Operator">⊢</a> <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.Conway.Conformance.Epoch.html#4553}{\htmlId{7054}{\htmlClass{Bound}{\text{es}}}}\, \\ \,\href{Class.HasEmptySet.html#287}{\htmlId{7059}{\htmlClass{Field}{\text{∅}}}}\, \\ \,\href{Agda.Builtin.Bool.html#192}{\htmlId{7063}{\htmlClass{InductiveConstructor}{\text{false}}}}\, \end{pmatrix}$</a> <a id="7071" href="Ledger.Conway.Specification.Ratify.html#13638" class="Function Operator">⇀⦇</a> <a id="7074" href="Ledger.Conway.Conformance.Epoch.html#4877" class="Bound">govSt&#39;</a> <a id="7081" href="Ledger.Conway.Specification.Ratify.html#13638" class="Function Operator">,RATIFIES⦈</a> <a id="7092" href="Ledger.Conway.Conformance.Epoch.html#3993" class="Generalizable">fut&#39;</a>
      <a id="7103" class="Symbol">→</a> <a id="7105" href="Ledger.Conway.Conformance.Epoch.html#4044" class="Generalizable">ls</a> <a id="7108" href="Ledger.Conway.Conformance.Rewards.html#628" class="Datatype Operator">⊢</a> <a id="7110" href="Ledger.Conway.Conformance.Epoch.html#4149" class="Generalizable">ss</a> <a id="7113" href="Ledger.Conway.Conformance.Rewards.html#628" class="Datatype Operator">⇀⦇</a> <a id="7116" href="Agda.Builtin.Unit.html#212" class="InductiveConstructor">tt</a> <a id="7119" href="Ledger.Conway.Conformance.Rewards.html#628" class="Datatype Operator">,SNAP⦈</a> <a id="7126" href="Ledger.Conway.Conformance.Epoch.html#4152" class="Generalizable">ss&#39;</a>
    <a id="7134" href="Prelude.InferenceRules.html#13694" class="Function Operator">────────────────────────────────</a>
    <a id="7171" class="Symbol">_</a> <a id="7173" href="Ledger.Conway.Conformance.Epoch.html#4246" class="Datatype Operator">⊢</a> <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.Conway.Conformance.Epoch.html#4058}{\htmlId{7177}{\htmlClass{Generalizable}{\text{acnt}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#4149}{\htmlId{7184}{\htmlClass{Generalizable}{\text{ss}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#4044}{\htmlId{7189}{\htmlClass{Generalizable}{\text{ls}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#4072}{\htmlId{7194}{\htmlClass{Generalizable}{\text{es₀}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#3989}{\htmlId{7200}{\htmlClass{Generalizable}{\text{fut}}}}\, \end{pmatrix}$</a> <a id="7206" href="Ledger.Conway.Conformance.Epoch.html#4246" class="Datatype Operator">⇀⦇</a> <a id="7209" href="Ledger.Conway.Conformance.Epoch.html#3967" class="Generalizable">e</a> <a id="7211" href="Ledger.Conway.Conformance.Epoch.html#4246" class="Datatype Operator">,EPOCH⦈</a>
        <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.Conway.Conformance.Epoch.html#6432}{\htmlId{7229}{\htmlClass{Bound}{\text{acnt&#39;}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#4152}{\htmlId{7237}{\htmlClass{Generalizable}{\text{ss&#39;}}}}\, \\ \begin{pmatrix} \,\href{Ledger.Conway.Conformance.Epoch.html#6317}{\htmlId{7245}{\htmlClass{Bound}{\text{utxoSt&#39;}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#4877}{\htmlId{7255}{\htmlClass{Bound}{\text{govSt&#39;}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#6202}{\htmlId{7264}{\htmlClass{Bound}{\text{certState&#39;}}}}\, \end{pmatrix} \\ \,\href{Ledger.Conway.Conformance.Epoch.html#4553}{\htmlId{7279}{\htmlClass{Bound}{\text{es}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#3993}{\htmlId{7284}{\htmlClass{Generalizable}{\text{fut&#39;}}}}\, \end{pmatrix}$</a>

<a id="7292" class="Keyword">data</a> <a id="_⊢_⇀⦇_,NEWEPOCH⦈_"></a><a id="7297" href="Ledger.Conway.Conformance.Epoch.html#7297" class="Datatype Operator">_⊢_⇀⦇_,NEWEPOCH⦈_</a> <a id="7315" class="Symbol">:</a> <a id="7317" href="Agda.Builtin.Unit.html#175" class="Record">⊤</a> <a id="7319" class="Symbol">→</a> <a id="7321" href="Ledger.Conway.Conformance.Epoch.html#1388" class="Record">NewEpochState</a> <a id="7335" class="Symbol">→</a> <a id="7337" href="Ledger.Core.Specification.Epoch.html#646" class="Function">Epoch</a> <a id="7343" class="Symbol">→</a> <a id="7345" href="Ledger.Conway.Conformance.Epoch.html#1388" class="Record">NewEpochState</a> <a id="7359" class="Symbol">→</a> <a id="7361" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="7366" class="Keyword">where</a>

  <a id="_⊢_⇀⦇_,NEWEPOCH⦈_.NEWEPOCH-New"></a><a id="7375" href="Ledger.Conway.Conformance.Epoch.html#7375" class="InductiveConstructor">NEWEPOCH-New</a> <a id="7388" class="Symbol">:</a>
    <a id="7394" class="Symbol">∀</a> <a id="7396" class="Symbol">{</a><a id="7397" href="Ledger.Conway.Conformance.Epoch.html#7397" class="Bound">bprev</a> <a id="7403" href="Ledger.Conway.Conformance.Epoch.html#7403" class="Bound">bcur</a> <a id="7408" class="Symbol">:</a> <a id="7410" href="Ledger.Conway.Specification.Rewards.html#4921" class="Function">BlocksMade</a><a id="7420" class="Symbol">}</a> <a id="7422" class="Symbol">{</a><a id="7423" href="Ledger.Conway.Conformance.Epoch.html#7423" class="Bound">pd</a> <a id="7426" class="Symbol">:</a> <a id="7428" href="Ledger.Conway.Conformance.Epoch.html#1318" class="Function">PoolDelegatedStake</a><a id="7446" class="Symbol">}</a> <a id="7448" class="Symbol">→</a>
    <a id="7454" class="Keyword">let</a>
       <a id="7465" href="Ledger.Conway.Conformance.Epoch.html#7465" class="Bound">eps&#39;</a> <a id="7470" class="Symbol">=</a> <a id="7472" href="Ledger.Conway.Conformance.Epoch.html#2630" class="Function">applyRUpd</a> <a id="7482" href="Ledger.Conway.Conformance.Epoch.html#4170" class="Generalizable">ru</a> <a id="7485" href="Ledger.Conway.Conformance.Epoch.html#4014" class="Generalizable">eps</a>
       <a id="7496" href="Ledger.Conway.Conformance.Epoch.html#7496" class="Bound">ss</a>   <a id="7501" class="Symbol">=</a> <a id="7503" href="Ledger.Conway.Conformance.Epoch.html#1213" class="Field">EpochState.ss</a> <a id="7517" href="Ledger.Conway.Conformance.Epoch.html#4023" class="Generalizable">eps&#39;&#39;</a>
       <a id="7530" href="Ledger.Conway.Conformance.Epoch.html#7530" class="Bound">pd&#39;</a>  <a id="7535" class="Symbol">=</a> <a id="7537" href="Ledger.Conway.Conformance.Epoch.html#3360" class="Function">calculatePoolDelegatedStake</a> <a id="7565" class="Symbol">(</a><a id="7566" href="Ledger.Conway.Specification.Rewards.html#7773" class="Field">Snapshots.set</a> <a id="7580" href="Ledger.Conway.Conformance.Epoch.html#7496" class="Bound">ss</a><a id="7582" class="Symbol">)</a>
     <a id="7589" class="Keyword">in</a>
       <a id="7599" href="Prelude.InferenceRules.html#56075" class="Function Operator">∙</a> <a id="7601" href="Ledger.Conway.Conformance.Epoch.html#3967" class="Generalizable">e</a> <a id="7603" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="7605" href="Ledger.Conway.Conformance.Epoch.html#3969" class="Generalizable">lastEpoch</a> <a id="7615" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="7617" class="Number">1</a>
       <a id="7626" href="Prelude.InferenceRules.html#56006" class="Function Operator">∙</a> <a id="7628" class="Symbol">_</a> <a id="7630" href="Ledger.Conway.Conformance.Epoch.html#4246" class="Datatype Operator">⊢</a> <a id="7632" href="Ledger.Conway.Conformance.Epoch.html#7465" class="Bound">eps&#39;</a> <a id="7637" href="Ledger.Conway.Conformance.Epoch.html#4246" class="Datatype Operator">⇀⦇</a> <a id="7640" href="Ledger.Conway.Conformance.Epoch.html#3967" class="Generalizable">e</a> <a id="7642" href="Ledger.Conway.Conformance.Epoch.html#4246" class="Datatype Operator">,EPOCH⦈</a> <a id="7650" href="Ledger.Conway.Conformance.Epoch.html#4023" class="Generalizable">eps&#39;&#39;</a>
       <a id="7663" href="Prelude.InferenceRules.html#13694" class="Function Operator">────────────────────────────────</a>
       <a id="7703" class="Symbol">_</a> <a id="7705" href="Ledger.Conway.Conformance.Epoch.html#7297" class="Datatype Operator">⊢</a> <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.Conway.Conformance.Epoch.html#3969}{\htmlId{7709}{\htmlClass{Generalizable}{\text{lastEpoch}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#7397}{\htmlId{7721}{\htmlClass{Bound}{\text{bprev}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#7403}{\htmlId{7729}{\htmlClass{Bound}{\text{bcur}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#4014}{\htmlId{7736}{\htmlClass{Generalizable}{\text{eps}}}}\, \\ \,\href{Agda.Builtin.Maybe.html#173}{\htmlId{7742}{\htmlClass{InductiveConstructor}{\text{just}}}}\, \,\href{Ledger.Conway.Conformance.Epoch.html#4170}{\htmlId{7747}{\htmlClass{Generalizable}{\text{ru}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#7423}{\htmlId{7752}{\htmlClass{Bound}{\text{pd}}}}\, \end{pmatrix}$</a> <a id="7757" href="Ledger.Conway.Conformance.Epoch.html#7297" class="Datatype Operator">⇀⦇</a> <a id="7760" href="Ledger.Conway.Conformance.Epoch.html#3967" class="Generalizable">e</a> <a id="7762" href="Ledger.Conway.Conformance.Epoch.html#7297" class="Datatype Operator">,NEWEPOCH⦈</a> <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.Conway.Conformance.Epoch.html#3967}{\htmlId{7775}{\htmlClass{Generalizable}{\text{e}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#7403}{\htmlId{7779}{\htmlClass{Bound}{\text{bcur}}}}\, \\ \,\href{Axiom.Set.Map.html#2671}{\htmlId{7786}{\htmlClass{Function}{\text{∅ᵐ}}}}\,  \\ \,\href{Ledger.Conway.Conformance.Epoch.html#4023}{\htmlId{7792}{\htmlClass{Generalizable}{\text{eps&#39;&#39;}}}}\, \\ \,\href{Agda.Builtin.Maybe.html#194}{\htmlId{7800}{\htmlClass{InductiveConstructor}{\text{nothing}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#7530}{\htmlId{7810}{\htmlClass{Bound}{\text{pd&#39;}}}}\, \end{pmatrix}$</a>

  <a id="_⊢_⇀⦇_,NEWEPOCH⦈_.NEWEPOCH-Not-New"></a><a id="7819" href="Ledger.Conway.Conformance.Epoch.html#7819" class="InductiveConstructor">NEWEPOCH-Not-New</a> <a id="7836" class="Symbol">:</a> <a id="7838" class="Symbol">∀</a> <a id="7840" class="Symbol">{</a><a id="7841" href="Ledger.Conway.Conformance.Epoch.html#7841" class="Bound">bprev</a> <a id="7847" href="Ledger.Conway.Conformance.Epoch.html#7847" class="Bound">bcur</a> <a id="7852" class="Symbol">:</a> <a id="7854" href="Ledger.Conway.Specification.Rewards.html#4921" class="Function">BlocksMade</a><a id="7864" class="Symbol">}</a> <a id="7866" class="Symbol">{</a><a id="7867" href="Ledger.Conway.Conformance.Epoch.html#7867" class="Bound">pd</a> <a id="7870" class="Symbol">:</a> <a id="7872" href="Ledger.Conway.Conformance.Epoch.html#1318" class="Function">PoolDelegatedStake</a><a id="7890" class="Symbol">}</a> <a id="7892" class="Symbol">→</a>
    <a id="7898" href="Prelude.InferenceRules.html#56075" class="Function Operator">∙</a> <a id="7900" href="Ledger.Conway.Conformance.Epoch.html#3967" class="Generalizable">e</a> <a id="7902" href="Relation.Binary.PropositionalEquality.Core.html#1000" class="Function Operator">≢</a> <a id="7904" href="Ledger.Conway.Conformance.Epoch.html#3969" class="Generalizable">lastEpoch</a> <a id="7914" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="7916" class="Number">1</a>
      <a id="7924" href="Prelude.InferenceRules.html#13694" class="Function Operator">────────────────────────────────</a>
      <a id="7963" class="Symbol">_</a> <a id="7965" href="Ledger.Conway.Conformance.Epoch.html#7297" class="Datatype Operator">⊢</a> <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.Conway.Conformance.Epoch.html#3969}{\htmlId{7969}{\htmlClass{Generalizable}{\text{lastEpoch}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#7841}{\htmlId{7981}{\htmlClass{Bound}{\text{bprev}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#7847}{\htmlId{7989}{\htmlClass{Bound}{\text{bcur}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#4014}{\htmlId{7996}{\htmlClass{Generalizable}{\text{eps}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#4190}{\htmlId{8002}{\htmlClass{Generalizable}{\text{mru}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#7867}{\htmlId{8008}{\htmlClass{Bound}{\text{pd}}}}\, \end{pmatrix}$</a> <a id="8013" href="Ledger.Conway.Conformance.Epoch.html#7297" class="Datatype Operator">⇀⦇</a> <a id="8016" href="Ledger.Conway.Conformance.Epoch.html#3967" class="Generalizable">e</a> <a id="8018" href="Ledger.Conway.Conformance.Epoch.html#7297" class="Datatype Operator">,NEWEPOCH⦈</a> <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.Conway.Conformance.Epoch.html#3969}{\htmlId{8031}{\htmlClass{Generalizable}{\text{lastEpoch}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#7841}{\htmlId{8043}{\htmlClass{Bound}{\text{bprev}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#7847}{\htmlId{8051}{\htmlClass{Bound}{\text{bcur}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#4014}{\htmlId{8058}{\htmlClass{Generalizable}{\text{eps}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#4190}{\htmlId{8064}{\htmlClass{Generalizable}{\text{mru}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#7867}{\htmlId{8070}{\htmlClass{Bound}{\text{pd}}}}\, \end{pmatrix}$</a>

  <a id="_⊢_⇀⦇_,NEWEPOCH⦈_.NEWEPOCH-No-Reward-Update"></a><a id="8078" href="Ledger.Conway.Conformance.Epoch.html#8078" class="InductiveConstructor">NEWEPOCH-No-Reward-Update</a> <a id="8104" class="Symbol">:</a>
    <a id="8110" class="Symbol">∀</a> <a id="8112" class="Symbol">{</a><a id="8113" href="Ledger.Conway.Conformance.Epoch.html#8113" class="Bound">bprev</a> <a id="8119" href="Ledger.Conway.Conformance.Epoch.html#8119" class="Bound">bcur</a> <a id="8124" class="Symbol">:</a> <a id="8126" href="Ledger.Conway.Specification.Rewards.html#4921" class="Function">BlocksMade</a><a id="8136" class="Symbol">}</a> <a id="8138" class="Symbol">{</a><a id="8139" href="Ledger.Conway.Conformance.Epoch.html#8139" class="Bound">pd</a> <a id="8142" class="Symbol">:</a> <a id="8144" href="Ledger.Conway.Conformance.Epoch.html#1318" class="Function">PoolDelegatedStake</a><a id="8162" class="Symbol">}</a> <a id="8164" class="Symbol">→</a>
    <a id="8170" class="Keyword">let</a>
      <a id="8180" href="Ledger.Conway.Conformance.Epoch.html#8180" class="Bound">ss</a>  <a id="8184" class="Symbol">=</a> <a id="8186" href="Ledger.Conway.Conformance.Epoch.html#1213" class="Field">EpochState.ss</a> <a id="8200" href="Ledger.Conway.Conformance.Epoch.html#4018" class="Generalizable">eps&#39;</a>
      <a id="8211" href="Ledger.Conway.Conformance.Epoch.html#8211" class="Bound">pd&#39;</a> <a id="8215" class="Symbol">=</a> <a id="8217" href="Ledger.Conway.Conformance.Epoch.html#3360" class="Function">calculatePoolDelegatedStake</a> <a id="8245" class="Symbol">(</a><a id="8246" href="Ledger.Conway.Specification.Rewards.html#7773" class="Field">Snapshots.set</a> <a id="8260" href="Ledger.Conway.Conformance.Epoch.html#8180" class="Bound">ss</a><a id="8262" class="Symbol">)</a>
    <a id="8268" class="Keyword">in</a>
      <a id="8277" href="Prelude.InferenceRules.html#56075" class="Function Operator">∙</a> <a id="8279" href="Ledger.Conway.Conformance.Epoch.html#3967" class="Generalizable">e</a> <a id="8281" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="8283" href="Ledger.Conway.Conformance.Epoch.html#3969" class="Generalizable">lastEpoch</a> <a id="8293" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="8295" class="Number">1</a>
      <a id="8303" href="Prelude.InferenceRules.html#56006" class="Function Operator">∙</a> <a id="8305" class="Symbol">_</a> <a id="8307" href="Ledger.Conway.Conformance.Epoch.html#4246" class="Datatype Operator">⊢</a> <a id="8309" href="Ledger.Conway.Conformance.Epoch.html#4014" class="Generalizable">eps</a> <a id="8313" href="Ledger.Conway.Conformance.Epoch.html#4246" class="Datatype Operator">⇀⦇</a> <a id="8316" href="Ledger.Conway.Conformance.Epoch.html#3967" class="Generalizable">e</a> <a id="8318" href="Ledger.Conway.Conformance.Epoch.html#4246" class="Datatype Operator">,EPOCH⦈</a> <a id="8326" href="Ledger.Conway.Conformance.Epoch.html#4018" class="Generalizable">eps&#39;</a>
      <a id="8337" href="Prelude.InferenceRules.html#13694" class="Function Operator">────────────────────────────────</a>
      <a id="8376" class="Symbol">_</a> <a id="8378" href="Ledger.Conway.Conformance.Epoch.html#7297" class="Datatype Operator">⊢</a> <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.Conway.Conformance.Epoch.html#3969}{\htmlId{8382}{\htmlClass{Generalizable}{\text{lastEpoch}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#8113}{\htmlId{8394}{\htmlClass{Bound}{\text{bprev}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#8119}{\htmlId{8402}{\htmlClass{Bound}{\text{bcur}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#4014}{\htmlId{8409}{\htmlClass{Generalizable}{\text{eps}}}}\, \\ \,\href{Agda.Builtin.Maybe.html#194}{\htmlId{8415}{\htmlClass{InductiveConstructor}{\text{nothing}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#8139}{\htmlId{8425}{\htmlClass{Bound}{\text{pd}}}}\, \end{pmatrix}$</a> <a id="8430" href="Ledger.Conway.Conformance.Epoch.html#7297" class="Datatype Operator">⇀⦇</a> <a id="8433" href="Ledger.Conway.Conformance.Epoch.html#3967" class="Generalizable">e</a> <a id="8435" href="Ledger.Conway.Conformance.Epoch.html#7297" class="Datatype Operator">,NEWEPOCH⦈</a> <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.Conway.Conformance.Epoch.html#3967}{\htmlId{8448}{\htmlClass{Generalizable}{\text{e}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#8119}{\htmlId{8452}{\htmlClass{Bound}{\text{bcur}}}}\, \\ \,\href{Axiom.Set.Map.html#2671}{\htmlId{8459}{\htmlClass{Function}{\text{∅ᵐ}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#4018}{\htmlId{8464}{\htmlClass{Generalizable}{\text{eps&#39;}}}}\, \\ \,\href{Agda.Builtin.Maybe.html#194}{\htmlId{8471}{\htmlClass{InductiveConstructor}{\text{nothing}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#8211}{\htmlId{8481}{\htmlClass{Bound}{\text{pd&#39;}}}}\, \end{pmatrix}$</a>
</pre></body></html>