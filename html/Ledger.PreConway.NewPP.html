<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>Ledger.PreConway.NewPP</title><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.css"><link rel="stylesheet" href="Agda.css"><script src="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.js"></script><script src="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/contrib/auto-render.min.js"></script><script src="AgdaKaTeX.js" defer=""></script></head><body><pre class="Agda">
<a id="2" class="Symbol">{-#</a> <a id="6" class="Keyword">OPTIONS</a> <a id="14" class="Pragma">--safe</a> <a id="21" class="Symbol">#-}</a>

<a id="26" class="Keyword">open</a> <a id="31" class="Keyword">import</a> <a id="38" href="Relation.Nullary.Decidable.html" class="Module">Relation.Nullary.Decidable</a>

<a id="66" class="Keyword">open</a> <a id="71" class="Keyword">import</a> <a id="78" href="Ledger.Prelude.html" class="Module">Ledger.Prelude</a>
<a id="93" class="Keyword">open</a> <a id="98" class="Keyword">import</a> <a id="105" href="Ledger.Conway.Specification.Transaction.html" class="Module">Ledger.Conway.Specification.Transaction</a>

<a id="146" class="Keyword">module</a> <a id="153" href="Ledger.PreConway.NewPP.html" class="Module">Ledger.PreConway.NewPP</a> <a id="176" class="Symbol">(</a><a id="177" href="Ledger.PreConway.NewPP.html#177" class="Bound">txs</a> <a id="181" class="Symbol">:</a> <a id="183" class="Symbol">_)</a> <a id="186" class="Symbol">(</a><a id="187" class="Keyword">open</a> <a id="192" href="Ledger.Conway.Specification.Transaction.html#999" class="Module">TransactionStructure</a> <a id="213" href="Ledger.PreConway.NewPP.html#177" class="Bound">txs</a><a id="216" class="Symbol">)</a> <a id="218" class="Keyword">where</a>

<a id="225" class="Keyword">open</a> <a id="230" class="Keyword">import</a> <a id="237" href="Ledger.PreConway.PPUp.html" class="Module">Ledger.PreConway.PPUp</a> <a id="259" href="Ledger.PreConway.NewPP.html#177" class="Bound">txs</a>

<a id="264" class="Keyword">record</a> <a id="NewPParamEnv"></a><a id="271" href="Ledger.PreConway.NewPP.html#271" class="Record">NewPParamEnv</a> <a id="284" class="Symbol">:</a> <a id="286" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="291" class="Keyword">where</a>
<a id="297" class="Comment">--  field</a>


<a id="309" class="Keyword">record</a> <a id="NewPParamState"></a><a id="316" href="Ledger.PreConway.NewPP.html#316" class="Record">NewPParamState</a> <a id="331" class="Symbol">:</a> <a id="333" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="338" class="Keyword">where</a>
  <a id="346" class="Keyword">field</a>
    <a id="NewPParamState.pparams"></a><a id="356" href="Ledger.PreConway.NewPP.html#356" class="Field">pparams</a>  <a id="365" class="Symbol">:</a> <a id="367" href="Ledger.Conway.Specification.PParams.html#1685" class="Record">PParams</a>
    <a id="NewPParamState.ppup"></a><a id="379" href="Ledger.PreConway.NewPP.html#379" class="Field">ppup</a>     <a id="388" class="Symbol">:</a> <a id="390" href="Ledger.PreConway.PPUp.html#520" class="Record">PPUpdateState</a>

<a id="updatePPUp"></a><a id="405" href="Ledger.PreConway.NewPP.html#405" class="Function">updatePPUp</a> <a id="416" class="Symbol">:</a> <a id="418" href="Ledger.Conway.Specification.PParams.html#1685" class="Record">PParams</a> <a id="426" class="Symbol">→</a> <a id="428" href="Ledger.PreConway.PPUp.html#520" class="Record">PPUpdateState</a> <a id="442" class="Symbol">→</a> <a id="444" href="Ledger.PreConway.PPUp.html#520" class="Record">PPUpdateState</a>
<a id="458" href="Ledger.PreConway.NewPP.html#405" class="Function">updatePPUp</a> <a id="469" href="Ledger.PreConway.NewPP.html#469" class="Bound">pparams</a> <a id="477" class="Keyword">record</a> <a id="484" class="Symbol">{</a> <a id="486" href="Ledger.PreConway.PPUp.html#589" class="Field">fpup</a> <a id="491" class="Symbol">=</a> <a id="493" href="Ledger.PreConway.NewPP.html#493" class="Bound">fpup</a> <a id="498" class="Symbol">}</a>
  <a id="502" class="Keyword">with</a> <a id="507" href="Axiom.Set.html#11302" class="Function">allᵇ</a> <a id="512" href="Class.Decidable.Core.html#783" class="Function Operator">¿</a> <a id="514" href="Ledger.PreConway.PPUp.html#819" class="Function">isViableUpdate</a> <a id="529" href="Ledger.PreConway.NewPP.html#469" class="Bound">pparams</a> <a id="537" href="Class.Decidable.Core.html#783" class="Function Operator">¿¹</a> <a id="540" class="Symbol">(</a><a id="541" href="Class.IsSet.html#959" class="Function">range</a> <a id="547" href="Ledger.PreConway.NewPP.html#493" class="Bound">fpup</a><a id="551" class="Symbol">)</a>
<a id="553" class="Symbol">...</a> <a id="557" class="Symbol">|</a> <a id="559" href="Agda.Builtin.Bool.html#192" class="InductiveConstructor">false</a>  <a id="566" class="Symbol">=</a> <a id="568" class="Keyword">record</a> <a id="575" class="Symbol">{</a> <a id="577" href="Ledger.PreConway.PPUp.html#559" class="Field">pup</a> <a id="581" class="Symbol">=</a> <a id="583" href="Axiom.Set.Map.html#2671" class="Function">∅ᵐ</a>    <a id="589" class="Symbol">;</a> <a id="591" href="Ledger.PreConway.PPUp.html#589" class="Field">fpup</a> <a id="596" class="Symbol">=</a> <a id="598" href="Axiom.Set.Map.html#2671" class="Function">∅ᵐ</a> <a id="601" class="Symbol">}</a>
<a id="603" class="Symbol">...</a> <a id="607" class="Symbol">|</a> <a id="609" href="Agda.Builtin.Bool.html#198" class="InductiveConstructor">true</a>   <a id="616" class="Symbol">=</a> <a id="618" class="Keyword">record</a> <a id="625" class="Symbol">{</a> <a id="627" href="Ledger.PreConway.PPUp.html#559" class="Field">pup</a> <a id="631" class="Symbol">=</a> <a id="633" class="Bound">fpup</a>  <a id="639" class="Symbol">;</a> <a id="641" href="Ledger.PreConway.PPUp.html#589" class="Field">fpup</a> <a id="646" class="Symbol">=</a> <a id="648" href="Axiom.Set.Map.html#2671" class="Function">∅ᵐ</a> <a id="651" class="Symbol">}</a>

<a id="votedValue"></a><a id="654" href="Ledger.PreConway.NewPP.html#654" class="Function">votedValue</a> <a id="665" class="Symbol">:</a> <a id="667" href="Ledger.Conway.Specification.Transaction.html#2784" class="Function">ProposedPPUpdates</a> <a id="685" class="Symbol">→</a> <a id="687" href="Ledger.Conway.Specification.PParams.html#1685" class="Record">PParams</a> <a id="695" class="Symbol">→</a> <a id="697" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a> <a id="699" class="Symbol">→</a> <a id="701" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="707" href="Ledger.Conway.Specification.PParams.html#14107" class="Function">PParamsUpdate</a>
<a id="721" href="Ledger.PreConway.NewPP.html#654" class="Function">votedValue</a> <a id="732" href="Ledger.PreConway.NewPP.html#732" class="Bound">pup</a> <a id="736" href="Ledger.PreConway.NewPP.html#736" class="Bound">pparams</a> <a id="744" href="Ledger.PreConway.NewPP.html#744" class="Bound">quorum</a> <a id="751" class="Symbol">=</a>
  <a id="755" href="Function.Base.html#4061" class="Function Operator">case</a> <a id="760" href="Axiom.Set.html#10977" class="Function">any?</a> <a id="765" class="Symbol">(λ</a> <a id="768" href="Ledger.PreConway.NewPP.html#768" class="Bound">u</a> <a id="770" class="Symbol">→</a> <a id="772" href="abstract-set-theory.FiniteSetTheory.html#2156" class="Function">lengthˢ</a> <a id="780" class="Symbol">(</a><a id="781" href="Ledger.PreConway.NewPP.html#732" class="Bound">pup</a> <a id="785" href="Axiom.Set.Map.html#17009" class="Function Operator">∣^</a> <a id="788" href="Axiom.Set.html#5718" class="Function">fromList</a> <a id="797" href="Data.List.Base.html#4907" class="Function Operator">[</a> <a id="799" href="Ledger.PreConway.NewPP.html#768" class="Bound">u</a> <a id="801" href="Data.List.Base.html#4907" class="Function Operator">]</a><a id="802" class="Symbol">)</a> <a id="804" href="Data.Nat.Properties.html#6984" class="Function Operator">≥?</a> <a id="807" href="Ledger.PreConway.NewPP.html#744" class="Bound">quorum</a><a id="813" class="Symbol">)</a> <a id="815" class="Symbol">(</a><a id="816" href="Class.IsSet.html#959" class="Function">range</a> <a id="822" href="Ledger.PreConway.NewPP.html#732" class="Bound">pup</a><a id="825" class="Symbol">)</a> <a id="827" href="Function.Base.html#4061" class="Function Operator">of</a>


    <a id="836" class="Symbol">λ</a>  <a id="839" class="Keyword">where</a>


       <a id="854" class="Symbol">(</a><a id="855" href="Relation.Nullary.Decidable.Core.html#2136" class="InductiveConstructor">no</a>  <a id="859" class="Symbol">_)</a>        <a id="869" class="Symbol">→</a> <a id="871" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a>
       <a id="886" class="Symbol">(</a><a id="887" href="Relation.Nullary.Decidable.Core.html#2099" class="InductiveConstructor">yes</a> <a id="891" class="Symbol">(</a><a id="892" href="Ledger.PreConway.NewPP.html#892" class="Bound">u</a> <a id="894" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="896" class="Symbol">_))</a>  <a id="901" class="Symbol">→</a> <a id="903" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="908" href="Ledger.PreConway.NewPP.html#892" class="Bound">u</a>


<a id="912" class="Keyword">instance</a>
  <a id="923" class="Keyword">unquoteDecl</a> <a id="HasCast-NewPParamState"></a><a id="935" href="Ledger.PreConway.NewPP.html#935" class="Function">HasCast-NewPParamState</a> <a id="958" class="Symbol">=</a> <a id="960" href="stdlib-classes.Class.HasCast.Derive.html#2690" class="Function">derive-HasCast</a>
    <a id="979" href="Data.List.Base.html#4907" class="Function Operator">[</a> <a id="981" class="Symbol">(</a><a id="982" class="Keyword">quote</a> <a id="988" href="Ledger.PreConway.NewPP.html#316" class="Record">NewPParamState</a> <a id="1003" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1005" href="Ledger.PreConway.NewPP.html#935" class="Function">HasCast-NewPParamState</a><a id="1027" class="Symbol">)</a> <a id="1029" href="Data.List.Base.html#4907" class="Function Operator">]</a>

<a id="1032" class="Keyword">private</a> <a id="1040" class="Keyword">variable</a>
  <a id="1051" href="Ledger.PreConway.NewPP.html#1051" class="Generalizable">Γ</a> <a id="1053" class="Symbol">:</a> <a id="1055" href="Ledger.PreConway.NewPP.html#271" class="Record">NewPParamEnv</a>
  <a id="1070" href="Ledger.PreConway.NewPP.html#1070" class="Generalizable">s</a> <a id="1072" href="Ledger.PreConway.NewPP.html#1072" class="Generalizable">s&#39;</a> <a id="1075" class="Symbol">:</a> <a id="1077" href="Ledger.PreConway.NewPP.html#316" class="Record">NewPParamState</a>
  <a id="1094" href="Ledger.PreConway.NewPP.html#1094" class="Generalizable">upd</a> <a id="1098" class="Symbol">:</a> <a id="1100" href="Ledger.Conway.Specification.PParams.html#14107" class="Function">PParamsUpdate</a>

<a id="1115" class="Keyword">data</a> <a id="_⊢_⇀⦇_,NEWPP⦈_"></a><a id="1120" href="Ledger.PreConway.NewPP.html#1120" class="Datatype Operator">_⊢_⇀⦇_,NEWPP⦈_</a> <a id="1135" class="Symbol">:</a> <a id="1137" href="Ledger.PreConway.NewPP.html#271" class="Record">NewPParamEnv</a> <a id="1150" class="Symbol">→</a> <a id="1152" href="Ledger.PreConway.NewPP.html#316" class="Record">NewPParamState</a> <a id="1167" class="Symbol">→</a> <a id="1169" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="1175" href="Ledger.Conway.Specification.PParams.html#14107" class="Function">PParamsUpdate</a> <a id="1189" class="Symbol">→</a> <a id="1191" href="Ledger.PreConway.NewPP.html#316" class="Record">NewPParamState</a> <a id="1206" class="Symbol">→</a> <a id="1208" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="1213" class="Keyword">where</a>


  <a id="_⊢_⇀⦇_,NEWPP⦈_.NEWPP-Accept"></a><a id="1223" href="Ledger.PreConway.NewPP.html#1223" class="InductiveConstructor">NEWPP-Accept</a> <a id="1236" class="Symbol">:</a> <a id="1238" class="Symbol">∀</a> <a id="1240" class="Symbol">{</a><a id="1241" href="Ledger.PreConway.NewPP.html#1241" class="Bound">Γ</a><a id="1242" class="Symbol">}</a> <a id="1244" class="Symbol">→</a> <a id="1246" class="Keyword">let</a> <a id="1250" class="Keyword">open</a> <a id="1255" href="Ledger.PreConway.NewPP.html#316" class="Module">NewPParamState</a> <a id="1270" href="Ledger.PreConway.NewPP.html#1070" class="Generalizable">s</a><a id="1271" class="Symbol">;</a> <a id="1273" href="Ledger.PreConway.NewPP.html#1273" class="Bound">newpp</a> <a id="1279" class="Symbol">=</a> <a id="1281" href="Ledger.Conway.Specification.PParams.html#13673" class="Function">applyUpdate</a> <a id="1293" href="Ledger.PreConway.NewPP.html#356" class="Function">pparams</a> <a id="1301" href="Ledger.PreConway.NewPP.html#1094" class="Generalizable">upd</a> <a id="1305" class="Keyword">in</a>
    <a id="1312" href="Ledger.PreConway.PPUp.html#740" class="Function">viablePParams</a> <a id="1326" href="Ledger.PreConway.NewPP.html#1273" class="Bound">newpp</a>
    <a id="1336" href="Prelude.InferenceRules.html#13694" class="Function Operator">────────────────────────────────</a>
    <a id="1373" href="Ledger.PreConway.NewPP.html#1241" class="Bound">Γ</a> <a id="1375" href="Ledger.PreConway.NewPP.html#1120" class="Datatype Operator">⊢</a> <a id="1377" href="Ledger.PreConway.NewPP.html#1070" class="Generalizable">s</a> <a id="1379" href="Ledger.PreConway.NewPP.html#1120" class="Datatype Operator">⇀⦇</a> <a id="1382" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="1387" href="Ledger.PreConway.NewPP.html#1094" class="Generalizable">upd</a> <a id="1391" href="Ledger.PreConway.NewPP.html#1120" class="Datatype Operator">,NEWPP⦈</a> <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.PreConway.NewPP.html#1273}{\htmlId{1401}{\htmlClass{Bound}{\text{newpp}}}}\, \\ \,\href{Ledger.PreConway.NewPP.html#405}{\htmlId{1409}{\htmlClass{Function}{\text{updatePPUp}}}}\, \,\href{Ledger.PreConway.NewPP.html#1273}{\htmlId{1420}{\htmlClass{Bound}{\text{newpp}}}}\, \,\href{Ledger.PreConway.NewPP.html#379}{\htmlId{1426}{\htmlClass{Function}{\text{ppup}}}}\, \end{pmatrix}$</a>

  <a id="_⊢_⇀⦇_,NEWPP⦈_.NEWPP-Reject"></a><a id="1436" href="Ledger.PreConway.NewPP.html#1436" class="InductiveConstructor">NEWPP-Reject</a> <a id="1449" class="Symbol">:</a> <a id="1451" class="Symbol">∀</a> <a id="1453" class="Symbol">{</a><a id="1454" href="Ledger.PreConway.NewPP.html#1454" class="Bound">Γ</a><a id="1455" class="Symbol">}</a> <a id="1457" class="Symbol">→</a>
    <a id="1463" href="Ledger.PreConway.NewPP.html#1454" class="Bound">Γ</a> <a id="1465" href="Ledger.PreConway.NewPP.html#1120" class="Datatype Operator">⊢</a> <a id="1467" href="Ledger.PreConway.NewPP.html#1070" class="Generalizable">s</a> <a id="1469" href="Ledger.PreConway.NewPP.html#1120" class="Datatype Operator">⇀⦇</a> <a id="1472" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a> <a id="1480" href="Ledger.PreConway.NewPP.html#1120" class="Datatype Operator">,NEWPP⦈</a> <a id="1488" href="Ledger.PreConway.NewPP.html#1070" class="Generalizable">s</a>

</pre></body></html>