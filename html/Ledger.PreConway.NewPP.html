<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>Ledger.PreConway.NewPP</title><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.css"><link rel="stylesheet" href="Agda.css"><script src="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.js"></script><script src="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/contrib/auto-render.min.js"></script><script src="AgdaKaTeX.js" defer=""></script></head><body><pre class="Agda">
<a id="2" class="Symbol">{-#</a> <a id="6" class="Keyword">OPTIONS</a> <a id="14" class="Pragma">--safe</a> <a id="21" class="Symbol">#-}</a>

<a id="26" class="Keyword">open</a> <a id="31" class="Keyword">import</a> <a id="38" href="Relation.Nullary.Decidable.html" class="Module">Relation.Nullary.Decidable</a>

<a id="66" class="Keyword">open</a> <a id="71" class="Keyword">import</a> <a id="78" href="Ledger.Prelude.html" class="Module">Ledger.Prelude</a>
<a id="93" class="Keyword">open</a> <a id="98" class="Keyword">import</a> <a id="105" href="Ledger.Core.Specification.Transaction.html" class="Module">Ledger.Core.Specification.Transaction</a>

<a id="144" class="Keyword">module</a> <a id="151" href="Ledger.PreConway.NewPP.html" class="Module">Ledger.PreConway.NewPP</a> <a id="174" class="Symbol">(</a><a id="175" href="Ledger.PreConway.NewPP.html#175" class="Bound">txs</a> <a id="179" class="Symbol">:</a> <a id="181" class="Symbol">_)</a> <a id="184" class="Symbol">(</a><a id="185" class="Keyword">open</a> <a id="190" href="Ledger.Core.Specification.Transaction.html#896" class="Module">TransactionStructure</a> <a id="211" href="Ledger.PreConway.NewPP.html#175" class="Bound">txs</a><a id="214" class="Symbol">)</a> <a id="216" class="Keyword">where</a>

<a id="223" class="Keyword">open</a> <a id="228" class="Keyword">import</a> <a id="235" href="Ledger.PreConway.PPUp.html" class="Module">Ledger.PreConway.PPUp</a> <a id="257" href="Ledger.PreConway.NewPP.html#175" class="Bound">txs</a>

<a id="262" class="Keyword">record</a> <a id="NewPParamEnv"></a><a id="269" href="Ledger.PreConway.NewPP.html#269" class="Record">NewPParamEnv</a> <a id="282" class="Symbol">:</a> <a id="284" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="289" class="Keyword">where</a>
<a id="295" class="Comment">--  field</a>


<a id="307" class="Keyword">record</a> <a id="NewPParamState"></a><a id="314" href="Ledger.PreConway.NewPP.html#314" class="Record">NewPParamState</a> <a id="329" class="Symbol">:</a> <a id="331" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="336" class="Keyword">where</a>
  <a id="344" class="Keyword">field</a>
    <a id="NewPParamState.pparams"></a><a id="354" href="Ledger.PreConway.NewPP.html#354" class="Field">pparams</a>  <a id="363" class="Symbol">:</a> <a id="365" href="Ledger.Conway.Specification.PParams.html#1687" class="Record">PParams</a>
    <a id="NewPParamState.ppup"></a><a id="377" href="Ledger.PreConway.NewPP.html#377" class="Field">ppup</a>     <a id="386" class="Symbol">:</a> <a id="388" href="Ledger.PreConway.PPUp.html#518" class="Record">PPUpdateState</a>

<a id="updatePPUp"></a><a id="403" href="Ledger.PreConway.NewPP.html#403" class="Function">updatePPUp</a> <a id="414" class="Symbol">:</a> <a id="416" href="Ledger.Conway.Specification.PParams.html#1687" class="Record">PParams</a> <a id="424" class="Symbol">→</a> <a id="426" href="Ledger.PreConway.PPUp.html#518" class="Record">PPUpdateState</a> <a id="440" class="Symbol">→</a> <a id="442" href="Ledger.PreConway.PPUp.html#518" class="Record">PPUpdateState</a>
<a id="456" href="Ledger.PreConway.NewPP.html#403" class="Function">updatePPUp</a> <a id="467" href="Ledger.PreConway.NewPP.html#467" class="Bound">pparams</a> <a id="475" class="Keyword">record</a> <a id="482" class="Symbol">{</a> <a id="484" href="Ledger.PreConway.PPUp.html#587" class="Field">fpup</a> <a id="489" class="Symbol">=</a> <a id="491" href="Ledger.PreConway.NewPP.html#491" class="Bound">fpup</a> <a id="496" class="Symbol">}</a>
  <a id="500" class="Keyword">with</a> <a id="505" href="Axiom.Set.html#11487" class="Function">allᵇ</a> <a id="510" href="Class.Decidable.Core.html#783" class="Function Operator">¿</a> <a id="512" href="Ledger.PreConway.PPUp.html#817" class="Function">isViableUpdate</a> <a id="527" href="Ledger.PreConway.NewPP.html#467" class="Bound">pparams</a> <a id="535" href="Class.Decidable.Core.html#783" class="Function Operator">¿¹</a> <a id="538" class="Symbol">(</a><a id="539" href="Class.IsSet.html#959" class="Function">range</a> <a id="545" href="Ledger.PreConway.NewPP.html#491" class="Bound">fpup</a><a id="549" class="Symbol">)</a>
<a id="551" class="Symbol">...</a> <a id="555" class="Symbol">|</a> <a id="557" href="Agda.Builtin.Bool.html#192" class="InductiveConstructor">false</a>  <a id="564" class="Symbol">=</a> <a id="566" class="Keyword">record</a> <a id="573" class="Symbol">{</a> <a id="575" href="Ledger.PreConway.PPUp.html#557" class="Field">pup</a> <a id="579" class="Symbol">=</a> <a id="581" href="Axiom.Set.Map.html#2671" class="Function">∅ᵐ</a>    <a id="587" class="Symbol">;</a> <a id="589" href="Ledger.PreConway.PPUp.html#587" class="Field">fpup</a> <a id="594" class="Symbol">=</a> <a id="596" href="Axiom.Set.Map.html#2671" class="Function">∅ᵐ</a> <a id="599" class="Symbol">}</a>
<a id="601" class="Symbol">...</a> <a id="605" class="Symbol">|</a> <a id="607" href="Agda.Builtin.Bool.html#198" class="InductiveConstructor">true</a>   <a id="614" class="Symbol">=</a> <a id="616" class="Keyword">record</a> <a id="623" class="Symbol">{</a> <a id="625" href="Ledger.PreConway.PPUp.html#557" class="Field">pup</a> <a id="629" class="Symbol">=</a> <a id="631" class="Bound">fpup</a>  <a id="637" class="Symbol">;</a> <a id="639" href="Ledger.PreConway.PPUp.html#587" class="Field">fpup</a> <a id="644" class="Symbol">=</a> <a id="646" href="Axiom.Set.Map.html#2671" class="Function">∅ᵐ</a> <a id="649" class="Symbol">}</a>

<a id="votedValue"></a><a id="652" href="Ledger.PreConway.NewPP.html#652" class="Function">votedValue</a> <a id="663" class="Symbol">:</a> <a id="665" href="Ledger.Core.Specification.Transaction.html#2675" class="Function">ProposedPPUpdates</a> <a id="683" class="Symbol">→</a> <a id="685" href="Ledger.Conway.Specification.PParams.html#1687" class="Record">PParams</a> <a id="693" class="Symbol">→</a> <a id="695" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a> <a id="697" class="Symbol">→</a> <a id="699" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="705" href="Ledger.Conway.Specification.PParams.html#14093" class="Function">PParamsUpdate</a>
<a id="719" href="Ledger.PreConway.NewPP.html#652" class="Function">votedValue</a> <a id="730" href="Ledger.PreConway.NewPP.html#730" class="Bound">pup</a> <a id="734" href="Ledger.PreConway.NewPP.html#734" class="Bound">pparams</a> <a id="742" href="Ledger.PreConway.NewPP.html#742" class="Bound">quorum</a> <a id="749" class="Symbol">=</a>
  <a id="753" href="Function.Base.html#4061" class="Function Operator">case</a> <a id="758" href="Axiom.Set.html#11162" class="Function">any?</a> <a id="763" class="Symbol">(λ</a> <a id="766" href="Ledger.PreConway.NewPP.html#766" class="Bound">u</a> <a id="768" class="Symbol">→</a> <a id="770" href="abstract-set-theory.FiniteSetTheory.html#2156" class="Function">lengthˢ</a> <a id="778" class="Symbol">(</a><a id="779" href="Ledger.PreConway.NewPP.html#730" class="Bound">pup</a> <a id="783" href="Axiom.Set.Map.html#17773" class="Function Operator">∣^</a> <a id="786" href="Axiom.Set.html#5903" class="Function">fromList</a> <a id="795" href="Data.List.Base.html#4907" class="Function Operator">[</a> <a id="797" href="Ledger.PreConway.NewPP.html#766" class="Bound">u</a> <a id="799" href="Data.List.Base.html#4907" class="Function Operator">]</a><a id="800" class="Symbol">)</a> <a id="802" href="Data.Nat.Properties.html#6984" class="Function Operator">≥?</a> <a id="805" href="Ledger.PreConway.NewPP.html#742" class="Bound">quorum</a><a id="811" class="Symbol">)</a> <a id="813" class="Symbol">(</a><a id="814" href="Class.IsSet.html#959" class="Function">range</a> <a id="820" href="Ledger.PreConway.NewPP.html#730" class="Bound">pup</a><a id="823" class="Symbol">)</a> <a id="825" href="Function.Base.html#4061" class="Function Operator">of</a> <a id="828" class="Symbol">λ</a> <a id="830" class="Keyword">where</a>
    <a id="840" class="Symbol">(</a><a id="841" href="Relation.Nullary.Decidable.Core.html#2136" class="InductiveConstructor">no</a>  <a id="845" class="Symbol">_)</a>        <a id="855" class="Symbol">→</a> <a id="857" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a>
    <a id="869" class="Symbol">(</a><a id="870" href="Relation.Nullary.Decidable.Core.html#2099" class="InductiveConstructor">yes</a> <a id="874" class="Symbol">(</a><a id="875" href="Ledger.PreConway.NewPP.html#875" class="Bound">u</a> <a id="877" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="879" class="Symbol">_))</a>  <a id="884" class="Symbol">→</a> <a id="886" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="891" href="Ledger.PreConway.NewPP.html#875" class="Bound">u</a>


<a id="895" class="Keyword">instance</a>
  <a id="906" class="Keyword">unquoteDecl</a> <a id="HasCast-NewPParamState"></a><a id="918" href="Ledger.PreConway.NewPP.html#918" class="Function">HasCast-NewPParamState</a> <a id="941" class="Symbol">=</a> <a id="943" href="stdlib-classes.Class.HasCast.Derive.html#2690" class="Function">derive-HasCast</a>
    <a id="962" href="Data.List.Base.html#4907" class="Function Operator">[</a> <a id="964" class="Symbol">(</a><a id="965" class="Keyword">quote</a> <a id="971" href="Ledger.PreConway.NewPP.html#314" class="Record">NewPParamState</a> <a id="986" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="988" href="Ledger.PreConway.NewPP.html#918" class="Function">HasCast-NewPParamState</a><a id="1010" class="Symbol">)</a> <a id="1012" href="Data.List.Base.html#4907" class="Function Operator">]</a>

<a id="1015" class="Keyword">private</a> <a id="1023" class="Keyword">variable</a>
  <a id="1034" href="Ledger.PreConway.NewPP.html#1034" class="Generalizable">Γ</a> <a id="1036" class="Symbol">:</a> <a id="1038" href="Ledger.PreConway.NewPP.html#269" class="Record">NewPParamEnv</a>
  <a id="1053" href="Ledger.PreConway.NewPP.html#1053" class="Generalizable">s</a> <a id="1055" href="Ledger.PreConway.NewPP.html#1055" class="Generalizable">s&#39;</a> <a id="1058" class="Symbol">:</a> <a id="1060" href="Ledger.PreConway.NewPP.html#314" class="Record">NewPParamState</a>
  <a id="1077" href="Ledger.PreConway.NewPP.html#1077" class="Generalizable">upd</a> <a id="1081" class="Symbol">:</a> <a id="1083" href="Ledger.Conway.Specification.PParams.html#14093" class="Function">PParamsUpdate</a>


<a id="1099" class="Keyword">data</a> <a id="_⊢_⇀⦇_,NEWPP⦈_"></a><a id="1104" href="Ledger.PreConway.NewPP.html#1104" class="Datatype Operator">_⊢_⇀⦇_,NEWPP⦈_</a> <a id="1119" class="Symbol">:</a> <a id="1121" href="Ledger.PreConway.NewPP.html#269" class="Record">NewPParamEnv</a> <a id="1134" class="Symbol">→</a> <a id="1136" href="Ledger.PreConway.NewPP.html#314" class="Record">NewPParamState</a> <a id="1151" class="Symbol">→</a> <a id="1153" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="1159" href="Ledger.Conway.Specification.PParams.html#14093" class="Function">PParamsUpdate</a> <a id="1173" class="Symbol">→</a> <a id="1175" href="Ledger.PreConway.NewPP.html#314" class="Record">NewPParamState</a> <a id="1190" class="Symbol">→</a> <a id="1192" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="1197" class="Keyword">where</a>

  <a id="_⊢_⇀⦇_,NEWPP⦈_.NEWPP-Accept"></a><a id="1206" href="Ledger.PreConway.NewPP.html#1206" class="InductiveConstructor">NEWPP-Accept</a> <a id="1219" class="Symbol">:</a> <a id="1221" class="Symbol">∀</a> <a id="1223" class="Symbol">{</a><a id="1224" href="Ledger.PreConway.NewPP.html#1224" class="Bound">Γ</a><a id="1225" class="Symbol">}</a> <a id="1227" class="Symbol">→</a> <a id="1229" class="Keyword">let</a> <a id="1233" class="Keyword">open</a> <a id="1238" href="Ledger.PreConway.NewPP.html#314" class="Module">NewPParamState</a> <a id="1253" href="Ledger.PreConway.NewPP.html#1053" class="Generalizable">s</a><a id="1254" class="Symbol">;</a> <a id="1256" href="Ledger.PreConway.NewPP.html#1256" class="Bound">newpp</a> <a id="1262" class="Symbol">=</a> <a id="1264" href="Ledger.Conway.Specification.PParams.html#13654" class="Function">applyUpdate</a> <a id="1276" href="Ledger.PreConway.NewPP.html#354" class="Function">pparams</a> <a id="1284" href="Ledger.PreConway.NewPP.html#1077" class="Generalizable">upd</a> <a id="1288" class="Keyword">in</a>
    <a id="1295" href="Ledger.PreConway.PPUp.html#738" class="Function">viablePParams</a> <a id="1309" href="Ledger.PreConway.NewPP.html#1256" class="Bound">newpp</a>
    <a id="1319" href="Prelude.InferenceRules.html#13694" class="Function Operator">────────────────────────────────</a>
    <a id="1356" href="Ledger.PreConway.NewPP.html#1224" class="Bound">Γ</a> <a id="1358" href="Ledger.PreConway.NewPP.html#1104" class="Datatype Operator">⊢</a> <a id="1360" href="Ledger.PreConway.NewPP.html#1053" class="Generalizable">s</a> <a id="1362" href="Ledger.PreConway.NewPP.html#1104" class="Datatype Operator">⇀⦇</a> <a id="1365" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="1370" href="Ledger.PreConway.NewPP.html#1077" class="Generalizable">upd</a> <a id="1374" href="Ledger.PreConway.NewPP.html#1104" class="Datatype Operator">,NEWPP⦈</a> <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.PreConway.NewPP.html#1256}{\htmlId{1384}{\htmlClass{Bound}{\text{newpp}}}}\, \\ \,\href{Ledger.PreConway.NewPP.html#403}{\htmlId{1392}{\htmlClass{Function}{\text{updatePPUp}}}}\, \,\href{Ledger.PreConway.NewPP.html#1256}{\htmlId{1403}{\htmlClass{Bound}{\text{newpp}}}}\, \,\href{Ledger.PreConway.NewPP.html#377}{\htmlId{1409}{\htmlClass{Function}{\text{ppup}}}}\, \end{pmatrix}$</a>

  <a id="_⊢_⇀⦇_,NEWPP⦈_.NEWPP-Reject"></a><a id="1419" href="Ledger.PreConway.NewPP.html#1419" class="InductiveConstructor">NEWPP-Reject</a> <a id="1432" class="Symbol">:</a> <a id="1434" class="Symbol">∀</a> <a id="1436" class="Symbol">{</a><a id="1437" href="Ledger.PreConway.NewPP.html#1437" class="Bound">Γ</a><a id="1438" class="Symbol">}</a> <a id="1440" class="Symbol">→</a>
    <a id="1446" href="Ledger.PreConway.NewPP.html#1437" class="Bound">Γ</a> <a id="1448" href="Ledger.PreConway.NewPP.html#1104" class="Datatype Operator">⊢</a> <a id="1450" href="Ledger.PreConway.NewPP.html#1053" class="Generalizable">s</a> <a id="1452" href="Ledger.PreConway.NewPP.html#1104" class="Datatype Operator">⇀⦇</a> <a id="1455" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a> <a id="1463" href="Ledger.PreConway.NewPP.html#1104" class="Datatype Operator">,NEWPP⦈</a> <a id="1471" href="Ledger.PreConway.NewPP.html#1053" class="Generalizable">s</a>

</pre></body></html>