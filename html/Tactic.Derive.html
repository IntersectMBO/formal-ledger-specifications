<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>Tactic.Derive</title><link rel="stylesheet" href="Agda.css"></head><body><pre class="Agda"><a id="1" class="Comment">-- Generic type class dervations. Works with mutually recursive types</a>
<a id="71" class="Comment">-- and can use mutual recursion to satisfy the termination</a>
<a id="130" class="Comment">-- checker. Writing an actual derivation strategy then does not</a>
<a id="194" class="Comment">-- require dealing with any mutual recursion, it is all handled here.</a>
<a id="264" class="Comment">--</a>
<a id="267" class="Comment">-- TODO: This breaks with:</a>
<a id="294" class="Comment">-- - mutual recursion that nests too deep (i.e. deeper than 1, e.g. Term)</a>
<a id="368" class="Comment">-- - indexed datatypes that require absurd clauses (e.g. Vec)</a>
<a id="430" class="Comment">--</a>
<a id="433" class="Comment">-- TODO: support type classes with more than one field</a>
<a id="488" class="Comment">--</a>
<a id="491" class="Comment">-- TODO: enable using existing code for instance when mutually recursing</a>
<a id="564" class="Comment">--</a>
<a id="567" class="Comment">-- TODO: Requires K to pass the termination checker. Maybe we can do without somehow.</a>

<a id="654" class="Symbol">{-#</a> <a id="658" class="Keyword">OPTIONS</a> <a id="666" class="Pragma">-v</a> <a id="669" class="Pragma">allTactics:100</a> <a id="684" class="Symbol">#-}</a>
<a id="688" class="Symbol">{-#</a> <a id="692" class="Keyword">OPTIONS</a> <a id="700" class="Pragma">--safe</a> <a id="707" class="Pragma">--without-K</a> <a id="719" class="Symbol">#-}</a>
<a id="723" class="Keyword">open</a> <a id="728" class="Keyword">import</a> <a id="735" href="Meta.Init.html" class="Module">Meta.Init</a>

<a id="746" class="Keyword">module</a> <a id="753" href="Tactic.Derive.html" class="Module">Tactic.Derive</a> <a id="767" class="Symbol">(</a><a id="768" href="Tactic.Derive.html#768" class="Bound">className</a> <a id="778" class="Symbol">:</a> <a id="780" href="Agda.Builtin.Reflection.html#488" class="Postulate">Name</a><a id="784" class="Symbol">)</a> <a id="786" class="Symbol">(</a><a id="787" href="Tactic.Derive.html#787" class="Bound">projName</a> <a id="796" class="Symbol">:</a> <a id="798" href="Agda.Builtin.Reflection.html#488" class="Postulate">Name</a><a id="802" class="Symbol">)</a> <a id="804" class="Keyword">where</a>

<a id="811" class="Keyword">open</a> <a id="816" class="Keyword">import</a> <a id="823" href="Meta.Prelude.html" class="Module">Meta.Prelude</a>

<a id="837" class="Keyword">open</a> <a id="842" class="Keyword">import</a> <a id="849" href="Agda.Builtin.Reflection.html" class="Module">Agda.Builtin.Reflection</a> <a id="873" class="Keyword">using</a> <a id="879" class="Symbol">()</a> <a id="882" class="Keyword">renaming</a> <a id="891" class="Symbol">(</a><a id="892" href="Agda.Builtin.Reflection.html#621" class="Primitive">primShowQName</a> <a id="906" class="Symbol">to</a> <a id="909" class="Primitive">showName</a><a id="917" class="Symbol">)</a>

<a id="920" class="Keyword">import</a> <a id="927" href="Data.List.html" class="Module">Data.List</a> <a id="937" class="Symbol">as</a> <a id="940" class="Module">L</a>
<a id="942" class="Keyword">import</a> <a id="949" href="Data.List.NonEmpty.html" class="Module">Data.List.NonEmpty</a> <a id="968" class="Symbol">as</a> <a id="971" class="Module">NE</a>
<a id="974" class="Keyword">import</a> <a id="981" href="Data.String.html" class="Module">Data.String</a> <a id="993" class="Symbol">as</a> <a id="996" class="Module">S</a>
<a id="998" class="Keyword">open</a> <a id="1003" class="Keyword">import</a> <a id="1010" href="Data.Maybe.html" class="Module">Data.Maybe</a> <a id="1021" class="Keyword">using</a> <a id="1027" class="Symbol">(</a><a id="1028" href="Data.Maybe.Base.html#1546" class="Function">fromMaybe</a><a id="1037" class="Symbol">)</a>
<a id="1039" class="Keyword">open</a> <a id="1044" class="Keyword">import</a> <a id="1051" href="Reflection.Tactic.html" class="Module">Reflection.Tactic</a>
<a id="1069" class="Keyword">open</a> <a id="1074" class="Keyword">import</a> <a id="1081" href="Reflection.Utils.html" class="Module">Reflection.Utils</a>
<a id="1098" class="Keyword">open</a> <a id="1103" class="Keyword">import</a> <a id="1110" href="Reflection.Utils.TCI.html" class="Module">Reflection.Utils.TCI</a>
<a id="1131" class="Keyword">open</a> <a id="1136" class="Keyword">import</a> <a id="1143" href="Relation.Nullary.Decidable.html" class="Module">Relation.Nullary.Decidable</a>
<a id="1170" class="Keyword">open</a> <a id="1175" class="Keyword">import</a> <a id="1182" href="Tactic.ClauseBuilder.html" class="Module">Tactic.ClauseBuilder</a>

<a id="1204" class="Keyword">open</a> <a id="1209" class="Keyword">import</a> <a id="1216" href="Class.DecEq.html" class="Module">Class.DecEq</a>
<a id="1228" class="Keyword">open</a> <a id="1233" class="Keyword">import</a> <a id="1240" href="Class.Functor.html" class="Module">Class.Functor</a>
<a id="1254" class="Keyword">open</a> <a id="1259" class="Keyword">import</a> <a id="1266" href="Class.Monad.html" class="Module">Class.Monad</a>
<a id="1278" class="Keyword">open</a> <a id="1283" class="Keyword">import</a> <a id="1290" href="Class.MonadReader.Instances.html" class="Module">Class.MonadReader.Instances</a>
<a id="1318" class="Keyword">open</a> <a id="1323" class="Keyword">import</a> <a id="1330" href="Class.MonadTC.Instances.html" class="Module">Class.MonadTC.Instances</a>
<a id="1354" class="Keyword">open</a> <a id="1359" class="Keyword">import</a> <a id="1366" href="Class.Show.html" class="Module">Class.Show</a>
<a id="1377" class="Keyword">open</a> <a id="1382" class="Keyword">import</a> <a id="1389" href="Class.Traversable.html" class="Module">Class.Traversable</a>

<a id="1408" class="Keyword">instance</a>
  <a id="1419" href="Tactic.Derive.html#1419" class="Function">_</a> <a id="1421" class="Symbol">=</a> <a id="1423" href="Tactic.ClauseBuilder.html#10645" class="Function">ContextMonad-MonadTC</a>
  <a id="1446" href="Tactic.Derive.html#1446" class="Function">_</a> <a id="1448" class="Symbol">=</a> <a id="1450" href="Class.Monad.Core.html#619" class="Function">Functor-M</a>
  <a id="1462" href="Tactic.Derive.html#1462" class="Function">_</a> <a id="1464" class="Symbol">=</a> <a id="1466" href="Class.Show.Instances.html#460" class="Function">Show-List</a>

<a id="1477" class="Keyword">open</a> <a id="1482" href="Tactic.ClauseBuilder.html#10889" class="Module">ClauseExprM</a>

<a id="1495" class="Comment">-- generate the type of the `className dName` instance</a>
<a id="genClassType"></a><a id="1550" href="Tactic.Derive.html#1550" class="Function">genClassType</a> <a id="1563" class="Symbol">:</a> <a id="1565" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a> <a id="1567" class="Symbol">→</a> <a id="1569" href="Agda.Builtin.Reflection.html#488" class="Postulate">Name</a> <a id="1574" class="Symbol">→</a> <a id="1576" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="1582" href="Agda.Builtin.Reflection.html#488" class="Postulate">Name</a> <a id="1587" class="Symbol">→</a> <a id="1589" href="Reflection.TCI.html#554" class="Function">TC</a> <a id="1592" href="Agda.Builtin.Reflection.html#5064" class="Function">Type</a>
<a id="1597" href="Tactic.Derive.html#1550" class="Function">genClassType</a> <a id="1610" href="Tactic.Derive.html#1610" class="Bound">arity</a> <a id="1616" href="Tactic.Derive.html#1616" class="Bound">dName</a> <a id="1622" href="Tactic.Derive.html#1622" class="Bound">wName</a> <a id="1628" class="Symbol">=</a> <a id="1630" class="Keyword">do</a>
  <a id="1635" href="Tactic.Derive.html#1635" class="Bound">params</a> <a id="1642" href="Class.Monad.Core.html#299" class="Field Operator">←</a> <a id="1644" href="Reflection.Utils.TCI.html#7802" class="Function">getParamsAndIndices</a> <a id="1664" href="Tactic.Derive.html#1616" class="Bound">dName</a>
  <a id="1672" class="Keyword">let</a> <a id="1676" href="Tactic.Derive.html#1676" class="Bound">params&#39;</a> <a id="1684" class="Symbol">=</a> <a id="1686" href="Data.List.Base.html#1634" class="Function">L.map</a> <a id="1692" class="Symbol">(λ</a> <a id="1695" class="Keyword">where</a> <a id="1701" class="Symbol">(</a><a id="1702" href="Agda.Builtin.Reflection.html#4285" class="InductiveConstructor">abs</a> <a id="1706" href="Tactic.Derive.html#1706" class="Bound">x</a> <a id="1708" href="Tactic.Derive.html#1708" class="Bound">y</a><a id="1709" class="Symbol">)</a> <a id="1711" class="Symbol">→</a> <a id="1713" href="Agda.Builtin.Reflection.html#4285" class="InductiveConstructor">abs</a> <a id="1717" href="Tactic.Derive.html#1706" class="Bound">x</a> <a id="1719" class="Symbol">(</a><a id="1720" href="Reflection.Utils.Args.html#1306" class="Function">hide</a> <a id="1725" href="Tactic.Derive.html#1708" class="Bound">y</a><a id="1726" class="Symbol">))</a> <a id="1729" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="1731" href="Data.List.Base.html#8687" class="Function">take</a> <a id="1736" class="Symbol">(</a><a id="1737" href="Data.List.Base.html#5044" class="Function">length</a> <a id="1744" href="Tactic.Derive.html#1635" class="Bound">params</a> <a id="1751" href="Data.Nat.Base.html#4462" class="Primitive Operator">∸</a> <a id="1753" href="Tactic.Derive.html#1610" class="Bound">arity</a><a id="1758" class="Symbol">)</a> <a id="1760" href="Tactic.Derive.html#1635" class="Bound">params</a>
  <a id="1769" href="Tactic.Derive.html#1769" class="Bound">sorts</a> <a id="1775" href="Class.Monad.Core.html#299" class="Field Operator">←</a> <a id="1777" href="Tactic.Derive.html#2447" class="Function">collectRelevantSorts</a> <a id="1798" href="Tactic.Derive.html#1676" class="Bound">params&#39;</a>
  <a id="1808" href="Class.MonadTC.html#11266" class="Function">debugLog1</a> <a id="1818" class="Symbol">(</a><a id="1819" class="String">&quot;Generate required instances at indices: &quot;</a> <a id="1862" href="Data.String.Base.html#2425" class="Function Operator">S.++</a> <a id="1867" href="Class.Show.Core.html#187" class="Field">show</a> <a id="1872" class="Symbol">(</a><a id="1873" href="Data.List.Base.html#1634" class="Function">L.map</a> <a id="1879" href="Data.Product.Base.html#636" class="Field">proj₁</a> <a id="1885" href="Tactic.Derive.html#1769" class="Bound">sorts</a><a id="1890" class="Symbol">))</a>
  <a id="1895" class="Keyword">let</a> <a id="1899" href="Tactic.Derive.html#1899" class="Bound">adjustedDBs</a> <a id="1911" class="Symbol">=</a> <a id="1913" href="Data.List.Base.html#2734" class="Function">L.zipWith</a> <a id="1923" class="Symbol">(λ</a> <a id="1926" class="Symbol">(</a><a id="1927" href="Tactic.Derive.html#1927" class="Bound">i</a> <a id="1929" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1931" href="Tactic.Derive.html#1931" class="Bound">tel</a><a id="1934" class="Symbol">)</a> <a id="1936" href="Tactic.Derive.html#1936" class="Bound">a</a> <a id="1938" class="Symbol">→</a> <a id="1940" class="Symbol">(</a><a id="1941" href="Tactic.Derive.html#1927" class="Bound">i</a> <a id="1943" href="Agda.Builtin.Nat.html#336" class="Primitive Operator">+</a> <a id="1945" href="Tactic.Derive.html#1936" class="Bound">a</a> <a id="1947" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1949" href="Tactic.Derive.html#1931" class="Bound">tel</a><a id="1952" class="Symbol">))</a> <a id="1955" href="Tactic.Derive.html#1769" class="Bound">sorts</a> <a id="1961" class="Symbol">(</a><a id="1962" href="Data.List.Base.html#6689" class="Function">upTo</a> <a id="1967" class="Symbol">(</a><a id="1968" href="Data.List.Base.html#5044" class="Function">length</a> <a id="1975" href="Tactic.Derive.html#1769" class="Bound">sorts</a><a id="1980" class="Symbol">))</a>
  <a id="1985" href="Tactic.Derive.html#1985" class="Bound">adjustedDBs&#39;</a> <a id="1998" href="Class.Monad.Core.html#299" class="Field Operator">←</a> <a id="2000" href="Class.MonadTC.html#10879" class="Function">extendContext&#39;</a> <a id="2015" class="Symbol">(</a><a id="2016" href="Reflection.Utils.Core.html#1595" class="Function">toTelescope</a> <a id="2028" href="Tactic.Derive.html#1635" class="Bound">params</a><a id="2034" class="Symbol">)</a> <a id="2036" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="2038" href="Tactic.Derive.html#3090" class="Function">genSortInstanceWithCtx</a> <a id="2061" href="Tactic.Derive.html#1899" class="Bound">adjustedDBs</a>
  <a id="2075" class="Keyword">let</a> <a id="2079" href="Tactic.Derive.html#2079" class="Bound">adjParams</a> <a id="2089" class="Symbol">=</a> <a id="2091" href="Tactic.Derive.html#1676" class="Bound">params&#39;</a> <a id="2099" href="Data.List.Base.html#1734" class="Function Operator">++</a> <a id="2102" href="Tactic.Derive.html#1985" class="Bound">adjustedDBs&#39;</a>
  <a id="2117" href="Class.MonadTC.html#11266" class="Function">debugLog1</a> <a id="2127" class="String">&quot;AdjustedParams: &quot;</a>
  <a id="2148" href="Reflection.Utils.TCI.html#4595" class="Function">logTelescope</a> <a id="2161" class="Symbol">(</a><a id="2162" href="Data.List.Base.html#1634" class="Function">L.map</a> <a id="2168" class="Symbol">((λ</a> <a id="2172" class="Keyword">where</a> <a id="2178" class="Symbol">(</a><a id="2179" href="Agda.Builtin.Reflection.html#4285" class="InductiveConstructor">abs</a> <a id="2183" href="Tactic.Derive.html#2183" class="Bound">s</a> <a id="2185" href="Tactic.Derive.html#2185" class="Bound">x</a><a id="2186" class="Symbol">)</a> <a id="2188" class="Symbol">→</a> <a id="2190" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="2195" href="Tactic.Derive.html#2183" class="Bound">s</a> <a id="2197" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="2199" href="Tactic.Derive.html#2185" class="Bound">x</a><a id="2200" class="Symbol">))</a> <a id="2203" href="Tactic.Derive.html#2079" class="Bound">adjParams</a><a id="2212" class="Symbol">)</a>
  <a id="2216" href="Tactic.Derive.html#2216" class="Bound">ty</a> <a id="2219" href="Class.Monad.Core.html#299" class="Field Operator">←</a> <a id="2221" href="Reflection.Utils.TCI.html#9148" class="Function">applyWithVisibility</a> <a id="2241" href="Tactic.Derive.html#1616" class="Bound">dName</a> <a id="2247" class="Symbol">(</a><a id="2248" href="Data.List.Base.html#1634" class="Function">L.map</a> <a id="2254" class="Symbol">(</a><a id="2255" href="Reflection.Syntax.html#1453" class="InductiveConstructor">♯</a> <a id="2257" href="Function.Base.html#1115" class="Function Operator">∘</a> <a id="2259" class="Symbol">(</a><a id="2260" href="Agda.Builtin.Nat.html#336" class="Primitive Operator">_+</a> <a id="2263" href="Data.List.Base.html#5044" class="Function">length</a> <a id="2270" href="Tactic.Derive.html#1769" class="Bound">sorts</a><a id="2275" class="Symbol">))</a> <a id="2278" class="Symbol">(</a><a id="2279" href="Data.List.Base.html#6728" class="Function">downFrom</a> <a id="2288" class="Symbol">(</a><a id="2289" href="Data.List.Base.html#5044" class="Function">length</a> <a id="2296" href="Tactic.Derive.html#1635" class="Bound">params</a><a id="2302" class="Symbol">)))</a>
  <a id="2308" href="Class.Monad.Core.html#278" class="Field">return</a> <a id="2315" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="2317" href="Tactic.Derive.html#3388" class="Function">modifyClassType</a> <a id="2333" href="Tactic.Derive.html#1622" class="Bound">wName</a> <a id="2339" class="Symbol">(</a><a id="2340" href="Tactic.Derive.html#2079" class="Bound">adjParams</a> <a id="2350" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="2352" href="Tactic.Derive.html#2216" class="Bound">ty</a><a id="2354" class="Symbol">)</a>
  <a id="2358" class="Keyword">where</a>
    <a id="2368" class="Comment">-- returns list of DB indices (at the end) and telescope of argument types</a>
    <a id="2447" href="Tactic.Derive.html#2447" class="Function">collectRelevantSorts</a> <a id="2468" class="Symbol">:</a> <a id="2470" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="2475" class="Symbol">(</a><a id="2476" href="Agda.Builtin.Reflection.html#4249" class="Datatype">Abs</a> <a id="2480" class="Symbol">(</a><a id="2481" href="Agda.Builtin.Reflection.html#3696" class="Datatype">Arg</a> <a id="2485" href="Agda.Builtin.Reflection.html#5064" class="Function">Type</a><a id="2489" class="Symbol">))</a> <a id="2492" class="Symbol">→</a> <a id="2494" href="Reflection.TCI.html#554" class="Function">TC</a> <a id="2497" class="Symbol">(</a><a id="2498" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="2503" class="Symbol">(</a><a id="2504" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a> <a id="2506" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="2508" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a><a id="2509" class="Symbol">))</a>
    <a id="2516" href="Tactic.Derive.html#2447" class="Function">collectRelevantSorts</a> <a id="2537" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a> <a id="2540" class="Symbol">=</a> <a id="2542" href="Class.Monad.Core.html#278" class="Field">return</a> <a id="2549" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a>
    <a id="2556" href="Tactic.Derive.html#2447" class="Function">collectRelevantSorts</a> <a id="2577" class="Symbol">(</a><a id="2578" href="Agda.Builtin.Reflection.html#4285" class="InductiveConstructor">abs</a> <a id="2582" href="Tactic.Derive.html#2582" class="Bound">x</a> <a id="2584" class="Symbol">(</a><a id="2585" href="Agda.Builtin.Reflection.html#3732" class="InductiveConstructor">arg</a> <a id="2589" class="Symbol">_</a> <a id="2591" href="Tactic.Derive.html#2591" class="Bound">t</a><a id="2592" class="Symbol">)</a> <a id="2594" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="2596" href="Tactic.Derive.html#2596" class="Bound">l</a><a id="2597" class="Symbol">)</a> <a id="2599" class="Symbol">=</a> <a id="2601" class="Keyword">do</a>
      <a id="2610" href="Tactic.Derive.html#2610" class="Bound">rec</a> <a id="2614" href="Class.Monad.Core.html#299" class="Field Operator">←</a> <a id="2616" href="Class.MonadTC.html#10352" class="Function">extendContext</a> <a id="2630" class="Symbol">(</a><a id="2631" href="Tactic.Derive.html#2582" class="Bound">x</a> <a id="2633" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="2635" href="Reflection.AST.Argument.html#1391" class="InductiveConstructor">hArg</a> <a id="2640" href="Tactic.Derive.html#2591" class="Bound">t</a><a id="2641" class="Symbol">)</a> <a id="2643" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="2645" href="Tactic.Derive.html#2447" class="Function">collectRelevantSorts</a> <a id="2666" href="Tactic.Derive.html#2596" class="Bound">l</a>
      <a id="2674" class="Symbol">(</a><a id="2675" href="Tactic.Derive.html#2675" class="Bound">b</a> <a id="2677" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="2679" href="Tactic.Derive.html#2679" class="Bound">k</a><a id="2680" class="Symbol">)</a> <a id="2682" href="Class.Monad.Core.html#299" class="Field Operator">←</a> <a id="2684" href="Reflection.Utils.TCI.html#8361" class="Function">isNArySort</a> <a id="2695" href="Tactic.Derive.html#2591" class="Bound">t</a>
      <a id="2703" href="Class.Monad.Core.html#278" class="Field">return</a> <a id="2710" class="Symbol">(</a><a id="2711" href="Data.Bool.Base.html#1505" class="Function Operator">if</a> <a id="2714" href="Tactic.Derive.html#2675" class="Bound">b</a> <a id="2716" href="Data.Bool.Base.html#1505" class="Function Operator">then</a> <a id="2721" class="Symbol">(</a><a id="2722" href="Data.List.Base.html#5044" class="Function">length</a> <a id="2729" href="Tactic.Derive.html#2596" class="Bound">l</a> <a id="2731" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="2733" href="Tactic.Derive.html#2679" class="Bound">k</a><a id="2734" class="Symbol">)</a> <a id="2736" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="2738" href="Tactic.Derive.html#2610" class="Bound">rec</a> <a id="2742" href="Data.Bool.Base.html#1505" class="Function Operator">else</a> <a id="2747" href="Tactic.Derive.html#2610" class="Bound">rec</a><a id="2750" class="Symbol">)</a>

    <a id="2757" href="Tactic.Derive.html#2757" class="Function">genSortInstance</a> <a id="2773" class="Symbol">:</a> <a id="2775" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a> <a id="2777" class="Symbol">→</a> <a id="2779" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a> <a id="2781" class="Symbol">→</a> <a id="2783" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a> <a id="2785" class="Symbol">→</a> <a id="2787" href="Reflection.TCI.html#554" class="Function">TC</a> <a id="2790" href="Agda.Builtin.Reflection.html#4993" class="Datatype">Term</a>
    <a id="2799" href="Tactic.Derive.html#2757" class="Function">genSortInstance</a> <a id="2815" href="Tactic.Derive.html#2815" class="Bound">k</a> <a id="2817" class="Number">0</a> <a id="2819" href="Tactic.Derive.html#2819" class="Bound">i</a>       <a id="2827" class="Symbol">=</a> <a id="2829" class="Keyword">do</a>
      <a id="2838" href="Tactic.Derive.html#2838" class="Bound">res</a> <a id="2842" href="Class.Monad.Core.html#299" class="Field Operator">←</a> <a id="2844" href="Reflection.Utils.TCI.html#9324" class="Function">applyWithVisibilityDB</a> <a id="2866" class="Symbol">(</a><a id="2867" href="Tactic.Derive.html#2819" class="Bound">i</a> <a id="2869" href="Agda.Builtin.Nat.html#336" class="Primitive Operator">+</a> <a id="2871" href="Tactic.Derive.html#2815" class="Bound">k</a><a id="2872" class="Symbol">)</a> <a id="2874" class="Symbol">(</a><a id="2875" href="Data.List.Base.html#1634" class="Function">L.map</a> <a id="2881" href="Reflection.Syntax.html#1453" class="InductiveConstructor">♯</a> <a id="2883" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="2885" href="Data.List.Base.html#6728" class="Function">downFrom</a> <a id="2894" href="Tactic.Derive.html#2815" class="Bound">k</a><a id="2895" class="Symbol">)</a>
      <a id="2903" href="Class.Monad.Core.html#278" class="Field">return</a> <a id="2910" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="2912" href="Tactic.Derive.html#768" class="Bound">className</a> <a id="2922" href="Reflection.Syntax.html#2924" class="InductiveConstructor Operator">∙⟦</a> <a id="2925" href="Tactic.Derive.html#2838" class="Bound">res</a> <a id="2929" href="Reflection.Syntax.html#2924" class="InductiveConstructor Operator">⟧</a>
    <a id="2935" href="Tactic.Derive.html#2757" class="Function">genSortInstance</a> <a id="2951" href="Tactic.Derive.html#2951" class="Bound">k</a> <a id="2953" class="Symbol">(</a><a id="2954" href="Agda.Builtin.Nat.html#234" class="InductiveConstructor">suc</a> <a id="2958" href="Tactic.Derive.html#2958" class="Bound">a</a><a id="2959" class="Symbol">)</a> <a id="2961" href="Tactic.Derive.html#2961" class="Bound">i</a> <a id="2963" class="Symbol">=</a> <a id="2965" class="Keyword">do</a>
      <a id="2974" href="Tactic.Derive.html#2974" class="Bound">res</a> <a id="2978" href="Class.Monad.Core.html#299" class="Field Operator">←</a> <a id="2980" href="Class.MonadTC.html#10352" class="Function">extendContext</a> <a id="2994" class="Symbol">(</a><a id="2995" class="String">&quot;&quot;</a> <a id="2998" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="3000" href="Reflection.AST.Argument.html#1391" class="InductiveConstructor">hArg</a> <a id="3005" href="Agda.Builtin.Reflection.html#5594" class="InductiveConstructor">unknown</a><a id="3012" class="Symbol">)</a> <a id="3014" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="3016" href="Tactic.Derive.html#2757" class="Function">genSortInstance</a> <a id="3032" href="Tactic.Derive.html#2951" class="Bound">k</a> <a id="3034" href="Tactic.Derive.html#2958" class="Bound">a</a> <a id="3036" href="Tactic.Derive.html#2961" class="Bound">i</a>
      <a id="3044" href="Class.Monad.Core.html#278" class="Field">return</a> <a id="3051" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="3053" href="Agda.Builtin.Reflection.html#5426" class="InductiveConstructor">pi</a> <a id="3056" class="Symbol">(</a><a id="3057" href="Reflection.AST.Argument.html#1391" class="InductiveConstructor">hArg</a> <a id="3062" href="Agda.Builtin.Reflection.html#5594" class="InductiveConstructor">unknown</a><a id="3069" class="Symbol">)</a> <a id="3071" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="3073" href="Agda.Builtin.Reflection.html#4285" class="InductiveConstructor">abs</a> <a id="3077" class="String">&quot;_&quot;</a> <a id="3081" href="Tactic.Derive.html#2974" class="Bound">res</a>

    <a id="3090" href="Tactic.Derive.html#3090" class="Function">genSortInstanceWithCtx</a> <a id="3113" class="Symbol">:</a> <a id="3115" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="3120" class="Symbol">(</a><a id="3121" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a> <a id="3123" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="3125" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a><a id="3126" class="Symbol">)</a> <a id="3128" class="Symbol">→</a> <a id="3130" href="Reflection.TCI.html#554" class="Function">TC</a> <a id="3133" class="Symbol">(</a><a id="3134" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="3139" class="Symbol">(</a><a id="3140" href="Agda.Builtin.Reflection.html#4249" class="Datatype">Abs</a> <a id="3144" class="Symbol">(</a><a id="3145" href="Agda.Builtin.Reflection.html#3696" class="Datatype">Arg</a> <a id="3149" href="Agda.Builtin.Reflection.html#4993" class="Datatype">Term</a><a id="3153" class="Symbol">)))</a>
    <a id="3161" href="Tactic.Derive.html#3090" class="Function">genSortInstanceWithCtx</a> <a id="3184" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a> <a id="3187" class="Symbol">=</a> <a id="3189" href="Class.Monad.Core.html#278" class="Field">return</a> <a id="3196" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a>
    <a id="3203" href="Tactic.Derive.html#3090" class="Function">genSortInstanceWithCtx</a> <a id="3226" class="Symbol">((</a><a id="3228" href="Tactic.Derive.html#3228" class="Bound">i</a> <a id="3230" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="3232" href="Tactic.Derive.html#3232" class="Bound">k</a><a id="3233" class="Symbol">)</a> <a id="3235" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="3237" href="Tactic.Derive.html#3237" class="Bound">xs</a><a id="3239" class="Symbol">)</a> <a id="3241" class="Symbol">=</a> <a id="3243" class="Keyword">do</a>
      <a id="3252" href="Tactic.Derive.html#3252" class="Bound">x&#39;</a> <a id="3255" href="Class.Monad.Core.html#299" class="Field Operator">←</a> <a id="3257" class="Symbol">(</a><a id="3258" href="Agda.Builtin.Reflection.html#4285" class="InductiveConstructor">abs</a> <a id="3262" class="String">&quot;_&quot;</a> <a id="3266" href="Function.Base.html#1115" class="Function Operator">∘</a> <a id="3268" href="Reflection.AST.Argument.html#1453" class="InductiveConstructor">iArg</a><a id="3272" class="Symbol">)</a> <a id="3274" href="Class.Functor.Core.html#242" class="Field Operator">&lt;$&gt;</a> <a id="3278" class="Symbol">(</a><a id="3279" href="Tactic.Derive.html#2757" class="Function">genSortInstance</a> <a id="3295" href="Tactic.Derive.html#3232" class="Bound">k</a> <a id="3297" href="Tactic.Derive.html#3232" class="Bound">k</a> <a id="3299" href="Tactic.Derive.html#3228" class="Bound">i</a><a id="3300" class="Symbol">)</a>
      <a id="3308" class="Symbol">(</a><a id="3309" href="Tactic.Derive.html#3252" class="Bound">x&#39;</a> <a id="3312" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷_</a><a id="3314" class="Symbol">)</a> <a id="3316" href="Class.Functor.Core.html#242" class="Field Operator">&lt;$&gt;</a> <a id="3320" class="Symbol">(</a><a id="3321" href="Class.MonadTC.html#10352" class="Function">extendContext</a> <a id="3335" class="Symbol">(</a><a id="3336" class="String">&quot;&quot;</a><a id="3338" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="3340" href="Reflection.AST.Argument.html#1391" class="InductiveConstructor">hArg</a> <a id="3345" href="Agda.Builtin.Reflection.html#5594" class="InductiveConstructor">unknown</a><a id="3352" class="Symbol">)</a> <a id="3354" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="3356" href="Tactic.Derive.html#3090" class="Function">genSortInstanceWithCtx</a> <a id="3379" href="Tactic.Derive.html#3237" class="Bound">xs</a><a id="3381" class="Symbol">)</a>

    <a id="3388" href="Tactic.Derive.html#3388" class="Function">modifyClassType</a> <a id="3404" class="Symbol">:</a> <a id="3406" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="3412" href="Agda.Builtin.Reflection.html#488" class="Postulate">Name</a> <a id="3417" class="Symbol">→</a> <a id="3419" href="Reflection.Utils.Core.html#536" class="Function">TypeView</a> <a id="3428" class="Symbol">→</a> <a id="3430" href="Agda.Builtin.Reflection.html#5064" class="Function">Type</a>
    <a id="3439" href="Tactic.Derive.html#3388" class="Function">modifyClassType</a> <a id="3455" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a>  <a id="3464" class="Symbol">(</a><a id="3465" href="Tactic.Derive.html#3465" class="Bound">tel</a> <a id="3469" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="3471" href="Tactic.Derive.html#3471" class="Bound">ty</a><a id="3473" class="Symbol">)</a> <a id="3475" class="Symbol">=</a> <a id="3477" href="Reflection.Utils.Core.html#693" class="Function">tyView</a> <a id="3484" class="Symbol">(</a><a id="3485" href="Tactic.Derive.html#3465" class="Bound">tel</a> <a id="3489" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="3491" href="Tactic.Derive.html#768" class="Bound">className</a> <a id="3501" href="Reflection.Syntax.html#2924" class="InductiveConstructor Operator">∙⟦</a> <a id="3504" href="Tactic.Derive.html#3471" class="Bound">ty</a> <a id="3507" href="Reflection.Syntax.html#2924" class="InductiveConstructor Operator">⟧</a><a id="3508" class="Symbol">)</a>
    <a id="3514" href="Tactic.Derive.html#3388" class="Function">modifyClassType</a> <a id="3530" class="Symbol">(</a><a id="3531" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="3536" href="Tactic.Derive.html#3536" class="Bound">n</a><a id="3537" class="Symbol">)</a> <a id="3539" class="Symbol">(</a><a id="3540" href="Tactic.Derive.html#3540" class="Bound">tel</a> <a id="3544" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="3546" href="Tactic.Derive.html#3546" class="Bound">ty</a><a id="3548" class="Symbol">)</a> <a id="3550" class="Symbol">=</a> <a id="3552" href="Reflection.Utils.Core.html#693" class="Function">tyView</a> <a id="3559" class="Symbol">(</a><a id="3560" href="Tactic.Derive.html#3540" class="Bound">tel</a> <a id="3564" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="3566" href="Tactic.Derive.html#768" class="Bound">className</a> <a id="3576" href="Reflection.Syntax.html#2924" class="InductiveConstructor Operator">∙⟦</a> <a id="3579" href="Tactic.Derive.html#3536" class="Bound">n</a> <a id="3581" href="Reflection.Syntax.html#2924" class="InductiveConstructor Operator">∙⟦</a> <a id="3584" href="Tactic.Derive.html#3546" class="Bound">ty</a> <a id="3587" href="Reflection.Syntax.html#2924" class="InductiveConstructor Operator">⟧</a> <a id="3589" href="Reflection.Syntax.html#2924" class="InductiveConstructor Operator">⟧</a><a id="3590" class="Symbol">)</a>

<a id="lookupName"></a><a id="3593" href="Tactic.Derive.html#3593" class="Function">lookupName</a> <a id="3604" class="Symbol">:</a> <a id="3606" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="3611" class="Symbol">(</a><a id="3612" href="Agda.Builtin.Reflection.html#488" class="Postulate">Name</a> <a id="3617" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="3619" href="Agda.Builtin.Reflection.html#488" class="Postulate">Name</a><a id="3623" class="Symbol">)</a> <a id="3625" class="Symbol">→</a> <a id="3627" href="Agda.Builtin.Reflection.html#488" class="Postulate">Name</a> <a id="3632" class="Symbol">→</a> <a id="3634" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="3640" href="Agda.Builtin.Reflection.html#488" class="Postulate">Name</a>
<a id="3645" href="Tactic.Derive.html#3593" class="Function">lookupName</a> <a id="3656" class="Symbol">=</a> <a id="3658" href="Meta.Prelude.html#1078" class="Function">lookupᵇ</a> <a id="3666" class="Symbol">(λ</a> <a id="3669" href="Tactic.Derive.html#3669" class="Bound">n</a> <a id="3671" href="Tactic.Derive.html#3671" class="Bound">n&#39;</a> <a id="3674" class="Symbol">→</a> <a id="3676" href="Relation.Nullary.Decidable.Core.html#4636" class="Function Operator">⌊</a> <a id="3678" href="Tactic.Derive.html#3669" class="Bound">n</a> <a id="3680" href="Class.DecEq.Core.html#159" class="Field Operator">≟</a> <a id="3682" href="Tactic.Derive.html#3671" class="Bound">n&#39;</a> <a id="3685" href="Relation.Nullary.Decidable.Core.html#4636" class="Function Operator">⌋</a><a id="3686" class="Symbol">)</a>

<a id="3689" class="Comment">-- Look at the constructors of the argument and return all types that</a>
<a id="3759" class="Comment">-- recursively contain it. This isn&#39;t very clever right now.</a>
<a id="genMutualHelpers"></a><a id="3820" href="Tactic.Derive.html#3820" class="Function">genMutualHelpers</a> <a id="3837" class="Symbol">:</a> <a id="3839" href="Agda.Builtin.Reflection.html#488" class="Postulate">Name</a> <a id="3844" class="Symbol">→</a> <a id="3846" href="Reflection.TCI.html#554" class="Function">TC</a> <a id="3849" class="Symbol">(</a><a id="3850" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="3855" href="Agda.Builtin.Reflection.html#488" class="Postulate">Name</a><a id="3859" class="Symbol">)</a>
<a id="3861" href="Tactic.Derive.html#3820" class="Function">genMutualHelpers</a> <a id="3878" href="Tactic.Derive.html#3878" class="Bound">n</a> <a id="3880" class="Symbol">=</a> <a id="3882" class="Keyword">do</a>
  <a id="3887" href="Tactic.Derive.html#3887" class="Bound">tys</a> <a id="3891" href="Class.Monad.Core.html#299" class="Field Operator">←</a> <a id="3893" href="Data.List.Base.html#1634" class="Function">L.map</a> <a id="3899" class="Symbol">(</a><a id="3900" href="Reflection.AST.Argument.html#2658" class="Function">unArg</a> <a id="3906" href="Function.Base.html#1115" class="Function Operator">∘</a> <a id="3908" href="Reflection.AST.Abstraction.html#1816" class="Function">unAbs</a><a id="3913" class="Symbol">)</a> <a id="3915" href="Class.Functor.Core.html#242" class="Field Operator">&lt;$&gt;</a> <a id="3919" class="Symbol">(</a><a id="3920" href="Data.List.Base.html#4406" class="Function">L.concatMap</a> <a id="3932" class="Symbol">(</a><a id="3933" href="Data.Product.Base.html#636" class="Field">proj₁</a> <a id="3939" href="Function.Base.html#1115" class="Function Operator">∘</a> <a id="3941" href="Reflection.Utils.Core.html#577" class="Function">viewTy</a> <a id="3948" href="Function.Base.html#1115" class="Function Operator">∘</a> <a id="3950" href="Data.Product.Base.html#650" class="Field">proj₂</a><a id="3955" class="Symbol">)</a> <a id="3957" href="Class.Functor.Core.html#242" class="Field Operator">&lt;$&gt;</a> <a id="3961" href="Class.MonadTC.html#12066" class="Function">getConstrs</a> <a id="3972" href="Tactic.Derive.html#3878" class="Bound">n</a><a id="3973" class="Symbol">)</a>
  <a id="3977" href="Class.Monad.Core.html#278" class="Field">return</a> <a id="3984" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="3986" href="Data.List.Base.html#13320" class="Function">deduplicate</a> <a id="3998" href="Class.DecEq.Core.html#159" class="Field Operator">_≟_</a> <a id="4002" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="4004" href="Data.List.Base.html#4628" class="Function">L.mapMaybe</a> <a id="4015" href="Tactic.Derive.html#4038" class="Function">helper</a> <a id="4022" href="Tactic.Derive.html#3887" class="Bound">tys</a>
  <a id="4028" class="Keyword">where</a>
    <a id="4038" href="Tactic.Derive.html#4038" class="Function">helper</a> <a id="4045" class="Symbol">:</a> <a id="4047" href="Agda.Builtin.Reflection.html#5064" class="Function">Type</a> <a id="4052" class="Symbol">→</a> <a id="4054" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="4060" href="Agda.Builtin.Reflection.html#488" class="Postulate">Name</a>
    <a id="4069" href="Tactic.Derive.html#4038" class="Function">helper</a> <a id="4076" class="Symbol">(</a><a id="4077" href="Agda.Builtin.Reflection.html#5251" class="InductiveConstructor">def</a> <a id="4081" href="Tactic.Derive.html#4081" class="Bound">n&#39;</a> <a id="4084" href="Tactic.Derive.html#4084" class="Bound">args</a><a id="4088" class="Symbol">)</a> <a id="4090" class="Symbol">=</a>
      <a id="4098" href="Data.Bool.Base.html#1505" class="Function Operator">if</a> <a id="4101" href="Data.List.Base.html#4857" class="Function">L.any</a> <a id="4107" class="Symbol">(λ</a> <a id="4110" class="Keyword">where</a> <a id="4116" class="Symbol">(</a><a id="4117" href="Agda.Builtin.Reflection.html#3732" class="InductiveConstructor">arg</a> <a id="4121" class="Symbol">_</a> <a id="4123" class="Symbol">(</a><a id="4124" href="Agda.Builtin.Reflection.html#5251" class="InductiveConstructor">def</a> <a id="4128" href="Tactic.Derive.html#4128" class="Bound">n&#39;&#39;</a> <a id="4132" class="Symbol">_))</a> <a id="4136" class="Symbol">→</a> <a id="4138" href="Relation.Nullary.Decidable.Core.html#4636" class="Function Operator">⌊</a> <a id="4140" href="Tactic.Derive.html#3878" class="Bound">n</a> <a id="4142" href="Class.DecEq.Core.html#159" class="Field Operator">≟</a> <a id="4144" href="Tactic.Derive.html#4128" class="Bound">n&#39;&#39;</a> <a id="4148" href="Relation.Nullary.Decidable.Core.html#4636" class="Function Operator">⌋</a> <a id="4150" class="Symbol">;</a> <a id="4152" class="CatchallClause Symbol">_</a> <a id="4154" class="Symbol">→</a> <a id="4156" href="Agda.Builtin.Bool.html#192" class="InductiveConstructor">false</a><a id="4161" class="Symbol">)</a> <a id="4163" href="Tactic.Derive.html#4084" class="Bound">args</a>
      <a id="4174" href="Data.Bool.Base.html#1505" class="Function Operator">then</a> <a id="4179" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="4184" href="Tactic.Derive.html#4081" class="Bound">n&#39;</a> <a id="4187" href="Data.Bool.Base.html#1505" class="Function Operator">else</a> <a id="4192" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a>
    <a id="4204" href="Tactic.Derive.html#4038" class="CatchallClause Function">helper</a><a id="4210" class="CatchallClause"> </a><a id="4211" class="CatchallClause Symbol">_</a> <a id="4213" class="Symbol">=</a> <a id="4215" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a>

<a id="4224" class="Keyword">module</a> <a id="4231" href="Tactic.Derive.html#4231" class="Module">_</a> <a id="4233" class="Symbol">(</a><a id="4234" href="Tactic.Derive.html#4234" class="Bound">arity</a> <a id="4240" class="Symbol">:</a> <a id="4242" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a><a id="4243" class="Symbol">)</a> <a id="4245" class="Symbol">(</a><a id="4246" href="Tactic.Derive.html#4246" class="Bound">genCe</a> <a id="4252" class="Symbol">:</a> <a id="4254" class="Symbol">(</a><a id="4255" href="Agda.Builtin.Reflection.html#488" class="Postulate">Name</a> <a id="4260" class="Symbol">→</a> <a id="4262" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="4268" href="Agda.Builtin.Reflection.html#488" class="Postulate">Name</a><a id="4272" class="Symbol">)</a> <a id="4274" class="Symbol">→</a> <a id="4276" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="4281" href="Tactic.ClauseBuilder.html#1262" class="Function">SinglePattern</a> <a id="4295" class="Symbol">→</a> <a id="4297" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="4302" class="Symbol">(</a><a id="4303" href="Data.List.NonEmpty.Base.html#1229" class="Record">NE.List⁺</a> <a id="4312" href="Tactic.ClauseBuilder.html#1262" class="Function">SinglePattern</a> <a id="4326" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="4328" href="Reflection.TCI.html#554" class="Function">TC</a> <a id="4331" class="Symbol">(</a><a id="4332" href="Tactic.ClauseBuilder.html#5754" class="Datatype">ClauseExpr</a> <a id="4343" href="Data.Sum.Base.html#625" class="Datatype Operator">⊎</a> <a id="4345" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="4351" href="Agda.Builtin.Reflection.html#4993" class="Datatype">Term</a><a id="4355" class="Symbol">)))</a> <a id="4359" class="Keyword">where</a>
  <a id="4367" class="Comment">-- Generate the declaration &amp; definition of a particular derivation.</a>
  <a id="4438" class="Comment">--</a>
  <a id="4443" class="Comment">-- Takes a dictionary (for mutual recursion), a wrapper (also for</a>
  <a id="4511" class="Comment">-- mutual recursion), the name of the original type we want to derive</a>
  <a id="4583" class="Comment">-- Show for and the name we want to define Show originally at.</a>
  <a id="4648" href="Tactic.Derive.html#4648" class="Function">deriveSingle</a> <a id="4661" class="Symbol">:</a> <a id="4663" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="4668" class="Symbol">(</a><a id="4669" href="Agda.Builtin.Reflection.html#488" class="Postulate">Name</a> <a id="4674" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="4676" href="Agda.Builtin.Reflection.html#488" class="Postulate">Name</a><a id="4680" class="Symbol">)</a> <a id="4682" class="Symbol">→</a> <a id="4684" href="Agda.Builtin.Reflection.html#488" class="Postulate">Name</a> <a id="4689" class="Symbol">→</a> <a id="4691" href="Agda.Builtin.Reflection.html#488" class="Postulate">Name</a> <a id="4696" class="Symbol">→</a> <a id="4698" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="4704" href="Agda.Builtin.Reflection.html#488" class="Postulate">Name</a> <a id="4709" class="Symbol">→</a> <a id="4711" href="Reflection.TCI.html#554" class="Function">TC</a> <a id="4714" class="Symbol">(</a><a id="4715" href="Agda.Builtin.Reflection.html#3696" class="Datatype">Arg</a> <a id="4719" href="Agda.Builtin.Reflection.html#488" class="Postulate">Name</a> <a id="4724" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="4726" href="Agda.Builtin.Reflection.html#5064" class="Function">Type</a> <a id="4731" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="4733" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="4738" href="Agda.Builtin.Reflection.html#5050" class="Datatype">Clause</a><a id="4744" class="Symbol">)</a>
  <a id="4748" href="Tactic.Derive.html#4648" class="Function">deriveSingle</a> <a id="4761" href="Tactic.Derive.html#4761" class="Bound">transName</a> <a id="4771" href="Tactic.Derive.html#4771" class="Bound">dName</a> <a id="4777" href="Tactic.Derive.html#4777" class="Bound">iName</a> <a id="4783" href="Tactic.Derive.html#4783" class="Bound">wName</a> <a id="4789" class="Symbol">=</a> <a id="4791" href="Reflection.Utils.TCI.html#5895" class="Function">inDebugPath</a> <a id="4803" class="String">&quot;DeriveSingle&quot;</a> <a id="4818" class="Keyword">do</a>
    <a id="4825" href="Class.MonadTC.html#8199" class="Function">debugLog</a> <a id="4834" class="Symbol">(</a><a id="4835" class="String">&quot;For: &quot;</a> <a id="4843" href="Reflection.Debug.html#1067" class="Function Operator">∷ᵈ</a> <a id="4846" href="Tactic.Derive.html#4771" class="Bound">dName</a> <a id="4852" href="Reflection.Debug.html#1067" class="Function Operator">∷ᵈ</a> <a id="4855" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a><a id="4857" class="Symbol">)</a>
    <a id="4863" href="Tactic.Derive.html#4863" class="Bound">goalTy</a> <a id="4870" href="Class.Monad.Core.html#299" class="Field Operator">←</a> <a id="4872" href="Tactic.Derive.html#1550" class="Function">genClassType</a> <a id="4885" href="Tactic.Derive.html#4234" class="Bound">arity</a> <a id="4891" href="Tactic.Derive.html#4771" class="Bound">dName</a> <a id="4897" href="Tactic.Derive.html#4783" class="Bound">wName</a>
    <a id="4907" href="Tactic.Derive.html#4907" class="Bound">ps</a> <a id="4910" href="Class.Monad.Core.html#299" class="Field Operator">←</a> <a id="4912" href="Tactic.ClauseBuilder.html#5268" class="Function">constructorPatterns&#39;</a> <a id="4933" class="Symbol">(</a><a id="4934" href="Data.Maybe.Base.html#1546" class="Function">fromMaybe</a> <a id="4944" href="Tactic.Derive.html#4771" class="Bound">dName</a> <a id="4950" href="Tactic.Derive.html#4783" class="Bound">wName</a> <a id="4956" href="Reflection.Syntax.html#2900" class="InductiveConstructor Operator">∙</a><a id="4957" class="Symbol">)</a>
    <a id="4963" class="Comment">-- TODO: find a good way of printing this</a>
    <a id="5009" class="Comment">--debugLogᵐ (&quot;Constrs: &quot; ∷ᵈᵐ ps ᵛⁿ ∷ᵈᵐ []ᵐ)</a>
    <a id="5057" href="Tactic.Derive.html#5057" class="Bound">cs</a> <a id="5060" href="Class.Monad.Core.html#299" class="Field Operator">←</a> <a id="5062" href="Class.MonadReader.html#312" class="Field">local</a> <a id="5068" class="Symbol">(λ</a> <a id="5071" href="Tactic.Derive.html#5071" class="Bound">c</a> <a id="5073" class="Symbol">→</a> <a id="5075" class="Keyword">record</a> <a id="5082" href="Tactic.Derive.html#5071" class="Bound">c</a> <a id="5084" class="Symbol">{</a> <a id="5086" href="Class.MonadTC.html#1026" class="Field">goal</a> <a id="5091" class="Symbol">=</a> <a id="5093" href="Data.Sum.Base.html#700" class="InductiveConstructor">inj₂</a> <a id="5098" href="Tactic.Derive.html#4863" class="Bound">goalTy</a> <a id="5105" class="Symbol">})</a> <a id="5108" href="Function.Base.html#1974" class="Function Operator">$</a>
      <a id="5116" href="Tactic.ClauseBuilder.html#11783" class="Function">singleMatchExpr</a> <a id="5132" class="Symbol">(</a><a id="5133" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a> <a id="5136" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5138" href="Reflection.AST.Argument.html#1453" class="InductiveConstructor">iArg</a> <a id="5143" class="Symbol">(</a><a id="5144" href="Agda.Builtin.Reflection.html#5977" class="InductiveConstructor">Pattern.proj</a> <a id="5157" href="Tactic.Derive.html#787" class="Bound">projName</a><a id="5165" class="Symbol">))</a> <a id="5168" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="5170" href="Tactic.ClauseBuilder.html#12740" class="Function">contMatch</a> <a id="5180" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="5182" href="Tactic.ClauseBuilder.html#11248" class="Function">multiMatchExprM</a> <a id="5198" href="Function.Base.html#1974" class="Function Operator">$</a>
        <a id="5208" href="Tactic.Derive.html#4246" class="Bound">genCe</a> <a id="5214" class="Symbol">(</a><a id="5215" href="Tactic.Derive.html#3593" class="Function">lookupName</a> <a id="5226" href="Tactic.Derive.html#4761" class="Bound">transName</a><a id="5235" class="Symbol">)</a> <a id="5237" href="Tactic.Derive.html#4907" class="Bound">ps</a>
    <a id="5244" class="Keyword">let</a> <a id="5248" href="Tactic.Derive.html#5248" class="Bound">defName</a> <a id="5256" class="Symbol">=</a> <a id="5258" href="Data.Maybe.Base.html#1276" class="Function">maybe</a> <a id="5264" class="Symbol">(</a><a id="5265" href="Data.Maybe.Base.html#1276" class="Function">maybe</a> <a id="5271" href="Reflection.AST.Argument.html#1329" class="InductiveConstructor">vArg</a> <a id="5276" class="Symbol">(</a><a id="5277" href="Reflection.AST.Argument.html#1453" class="InductiveConstructor">iArg</a> <a id="5282" href="Tactic.Derive.html#4777" class="Bound">iName</a><a id="5287" class="Symbol">)</a> <a id="5289" href="Function.Base.html#1115" class="Function Operator">∘</a> <a id="5291" href="Tactic.Derive.html#3593" class="Function">lookupName</a> <a id="5302" href="Tactic.Derive.html#4761" class="Bound">transName</a><a id="5311" class="Symbol">)</a> <a id="5313" class="Symbol">(</a><a id="5314" href="Reflection.AST.Argument.html#1453" class="InductiveConstructor">iArg</a> <a id="5319" href="Tactic.Derive.html#4777" class="Bound">iName</a><a id="5324" class="Symbol">)</a> <a id="5326" href="Tactic.Derive.html#4783" class="Bound">wName</a>
    <a id="5336" href="Class.Monad.Core.html#278" class="Field">return</a> <a id="5343" class="Symbol">(</a><a id="5344" href="Tactic.Derive.html#5248" class="Bound">defName</a> <a id="5352" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5354" href="Tactic.Derive.html#4863" class="Bound">goalTy</a> <a id="5361" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5363" href="Tactic.ClauseBuilder.html#7373" class="Function">clauseExprToClauses</a> <a id="5383" href="Tactic.Derive.html#5057" class="Bound">cs</a><a id="5385" class="Symbol">)</a>

  <a id="5390" href="Tactic.Derive.html#5390" class="Function">deriveMulti</a> <a id="5402" class="Symbol">:</a> <a id="5404" href="Agda.Builtin.Reflection.html#488" class="Postulate">Name</a> <a id="5409" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="5411" href="Agda.Builtin.Reflection.html#488" class="Postulate">Name</a> <a id="5416" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="5418" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="5423" href="Agda.Builtin.Reflection.html#488" class="Postulate">Name</a> <a id="5428" class="Symbol">→</a> <a id="5430" href="Reflection.TCI.html#554" class="Function">TC</a> <a id="5433" class="Symbol">(</a><a id="5434" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="5439" class="Symbol">(</a><a id="5440" href="Agda.Builtin.Reflection.html#3696" class="Datatype">Arg</a> <a id="5444" href="Agda.Builtin.Reflection.html#488" class="Postulate">Name</a> <a id="5449" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="5451" href="Agda.Builtin.Reflection.html#5064" class="Function">Type</a> <a id="5456" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="5458" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="5463" href="Agda.Builtin.Reflection.html#5050" class="Datatype">Clause</a><a id="5469" class="Symbol">))</a>
  <a id="5474" href="Tactic.Derive.html#5390" class="Function">deriveMulti</a> <a id="5486" class="Symbol">(</a><a id="5487" href="Tactic.Derive.html#5487" class="Bound">dName</a> <a id="5493" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5495" href="Tactic.Derive.html#5495" class="Bound">iName</a> <a id="5501" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5503" href="Tactic.Derive.html#5503" class="Bound">hClasses</a><a id="5511" class="Symbol">)</a> <a id="5513" class="Symbol">=</a> <a id="5515" class="Keyword">do</a>
    <a id="5522" href="Tactic.Derive.html#5522" class="Bound">hClassNames</a> <a id="5534" href="Class.Monad.Core.html#299" class="Field Operator">←</a> <a id="5536" href="Class.Traversable.Core.html#297" class="Function">traverse</a> <a id="5545" class="Symbol">⦃</a> <a id="5547" href="Class.Functor.Instances.html#445" class="Function">Functor-List</a> <a id="5560" class="Symbol">⦄</a>
      <a id="5568" class="Symbol">(λ</a> <a id="5571" href="Tactic.Derive.html#5571" class="Bound">cn</a> <a id="5574" class="Symbol">→</a> <a id="5576" href="Class.MonadTC.html#2008" class="Field">freshName</a> <a id="5586" class="Symbol">(</a><a id="5587" href="Tactic.Derive.html#909" class="Primitive">showName</a> <a id="5596" href="Tactic.Derive.html#768" class="Bound">className</a> <a id="5606" href="Data.String.Base.html#2425" class="Function Operator">S.++</a> <a id="5611" class="String">&quot;-&quot;</a> <a id="5615" href="Data.String.Base.html#2425" class="Function Operator">S.++</a> <a id="5620" href="Tactic.Derive.html#909" class="Primitive">showName</a> <a id="5629" href="Tactic.Derive.html#5571" class="Bound">cn</a> <a id="5632" href="Data.String.Base.html#2425" class="Function Operator">S.++</a> <a id="5637" href="Tactic.Derive.html#909" class="Primitive">showName</a> <a id="5646" href="Tactic.Derive.html#5487" class="Bound">dName</a><a id="5651" class="Symbol">))</a> <a id="5654" href="Tactic.Derive.html#5503" class="Bound">hClasses</a>
    <a id="5667" href="Class.Traversable.Core.html#297" class="Function">traverse</a> <a id="5676" class="Symbol">⦃</a> <a id="5678" href="Class.Functor.Instances.html#445" class="Function">Functor-List</a> <a id="5691" class="Symbol">⦄</a> <a id="5693" class="Symbol">(</a><a id="5694" href="Tactic.Derive.html#4648" class="Function">deriveSingle</a> <a id="5707" class="Symbol">(</a><a id="5708" href="Data.List.Base.html#3506" class="Function">L.zip</a> <a id="5714" href="Tactic.Derive.html#5503" class="Bound">hClasses</a> <a id="5723" href="Tactic.Derive.html#5522" class="Bound">hClassNames</a><a id="5734" class="Symbol">)</a> <a id="5736" href="Tactic.Derive.html#5487" class="Bound">dName</a> <a id="5742" href="Tactic.Derive.html#5495" class="Bound">iName</a><a id="5747" class="Symbol">)</a> <a id="5749" class="Symbol">(</a><a id="5750" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a> <a id="5758" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="5760" href="Data.List.Base.html#1634" class="Function">L.map</a> <a id="5766" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="5771" href="Tactic.Derive.html#5503" class="Bound">hClasses</a><a id="5779" class="Symbol">)</a>

  <a id="5784" href="Tactic.Derive.html#5784" class="Function">derive-Class</a> <a id="5797" class="Symbol">:</a> <a id="5799" class="Symbol">⦃</a> <a id="5801" href="Class.MonadTC.html#620" class="Record">TCOptions</a> <a id="5811" class="Symbol">⦄</a> <a id="5813" class="Symbol">→</a> <a id="5815" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="5820" class="Symbol">(</a><a id="5821" href="Agda.Builtin.Reflection.html#488" class="Postulate">Name</a> <a id="5826" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="5828" href="Agda.Builtin.Reflection.html#488" class="Postulate">Name</a><a id="5832" class="Symbol">)</a> <a id="5834" class="Symbol">→</a> <a id="5836" href="Reflection.Tactic.html#476" class="Function">UnquoteDecl</a>
  <a id="5850" href="Tactic.Derive.html#5784" class="Function">derive-Class</a> <a id="5863" href="Tactic.Derive.html#5863" class="Bound">l</a> <a id="5865" class="Symbol">=</a> <a id="5867" href="Reflection.Tactic.html#868" class="Function">initUnquoteWithGoal</a> <a id="5887" class="Symbol">(</a><a id="5888" href="Tactic.Derive.html#768" class="Bound">className</a> <a id="5898" href="Reflection.Syntax.html#2900" class="InductiveConstructor Operator">∙</a><a id="5899" class="Symbol">)</a> <a id="5901" href="Function.Base.html#1974" class="Function Operator">$</a>
    <a id="5907" href="Class.MonadTC.html#5659" class="Function">declareAndDefineFuns</a> <a id="5928" href="Class.Monad.Core.html#388" class="Function Operator">=&lt;&lt;</a> <a id="5932" href="Class.MonadTC.html#2560" class="Function">runAndReset</a> <a id="5944" class="Symbol">(</a><a id="5945" href="Data.List.Base.html#4350" class="Function">concat</a> <a id="5952" href="Class.Functor.Core.html#242" class="Field Operator">&lt;$&gt;</a> <a id="5956" href="Class.Traversable.Core.html#297" class="Function">traverse</a> <a id="5965" class="Symbol">⦃</a> <a id="5967" href="Class.Functor.Instances.html#445" class="Function">Functor-List</a> <a id="5980" class="Symbol">⦄</a> <a id="5982" href="Tactic.Derive.html#6008" class="Function">helper</a> <a id="5989" href="Tactic.Derive.html#5863" class="Bound">l</a><a id="5990" class="Symbol">)</a>
    <a id="5996" class="Keyword">where</a>
      <a id="6008" href="Tactic.Derive.html#6008" class="Function">helper</a> <a id="6015" class="Symbol">:</a> <a id="6017" href="Agda.Builtin.Reflection.html#488" class="Postulate">Name</a> <a id="6022" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="6024" href="Agda.Builtin.Reflection.html#488" class="Postulate">Name</a> <a id="6029" class="Symbol">→</a> <a id="6031" href="Reflection.TCI.html#554" class="Function">TC</a> <a id="6034" class="Symbol">(</a><a id="6035" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="6040" class="Symbol">(</a><a id="6041" href="Agda.Builtin.Reflection.html#3696" class="Datatype">Arg</a> <a id="6045" href="Agda.Builtin.Reflection.html#488" class="Postulate">Name</a> <a id="6050" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="6052" href="Agda.Builtin.Reflection.html#5064" class="Function">Type</a> <a id="6057" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="6059" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="6064" href="Agda.Builtin.Reflection.html#5050" class="Datatype">Clause</a><a id="6070" class="Symbol">))</a>
      <a id="6079" href="Tactic.Derive.html#6008" class="Function">helper</a> <a id="6086" class="Symbol">(</a><a id="6087" href="Tactic.Derive.html#6087" class="Bound">a</a> <a id="6089" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="6091" href="Tactic.Derive.html#6091" class="Bound">b</a><a id="6092" class="Symbol">)</a> <a id="6094" class="Symbol">=</a> <a id="6096" class="Keyword">do</a> <a id="6099" href="Tactic.Derive.html#6099" class="Bound">hs</a> <a id="6102" href="Class.Monad.Core.html#299" class="Field Operator">←</a> <a id="6104" href="Tactic.Derive.html#3820" class="Function">genMutualHelpers</a> <a id="6121" href="Tactic.Derive.html#6087" class="Bound">a</a> <a id="6123" class="Symbol">;</a> <a id="6125" href="Tactic.Derive.html#5390" class="Function">deriveMulti</a> <a id="6137" class="Symbol">(</a><a id="6138" href="Tactic.Derive.html#6087" class="Bound">a</a> <a id="6140" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="6142" href="Tactic.Derive.html#6091" class="Bound">b</a> <a id="6144" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="6146" href="Tactic.Derive.html#6099" class="Bound">hs</a><a id="6148" class="Symbol">)</a>
</pre></body></html>