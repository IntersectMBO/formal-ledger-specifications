<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>Test.StructuredContracts</title><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.css"><link rel="stylesheet" href="Agda.css"><script src="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.js"></script><script src="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/contrib/auto-render.min.js"></script><script src="AgdaKaTeX.js" defer=""></script></head><body><pre class="Agda">
<a id="2" class="Symbol">{-#</a> <a id="6" class="Keyword">OPTIONS</a> <a id="14" class="Pragma">--safe</a> <a id="21" class="Symbol">#-}</a>

<a id="26" class="Keyword">open</a> <a id="31" class="Keyword">import</a> <a id="38" href="Algebra.html" class="Module">Algebra</a>
<a id="46" class="Keyword">open</a> <a id="51" class="Keyword">import</a> <a id="58" href="Data.Nat.Properties.html" class="Module">Data.Nat.Properties</a> <a id="78" class="Keyword">using</a> <a id="84" class="Symbol">(</a><a id="85" href="Data.Nat.Properties.html#17566" class="Function">+-0-monoid</a><a id="95" class="Symbol">)</a>

<a id="98" class="Keyword">open</a> <a id="103" class="Keyword">import</a> <a id="110" href="Ledger.Prelude.html" class="Module">Ledger.Prelude</a><a id="124" class="Symbol">;</a> <a id="126" class="Keyword">open</a> <a id="131" href="Function.Bundles.html#4750" class="Module">Equivalence</a>
<a id="143" class="Keyword">open</a> <a id="148" class="Keyword">import</a> <a id="155" href="Ledger.Conway.Specification.Transaction.html" class="Module">Ledger.Conway.Specification.Transaction</a>
<a id="195" class="Keyword">open</a> <a id="200" class="Keyword">import</a> <a id="207" href="Ledger.Conway.Specification.Abstract.html" class="Module">Ledger.Conway.Specification.Abstract</a>
<a id="244" class="Keyword">open</a> <a id="249" class="Keyword">import</a> <a id="256" href="Ledger.Conway.Specification.TokenAlgebra.Base.html" class="Module">Ledger.Conway.Specification.TokenAlgebra.Base</a>
<a id="302" class="Keyword">open</a> <a id="307" class="Keyword">import</a> <a id="314" href="Ledger.Conway.Specification.TokenAlgebra.ValueSet.html" class="Module">Ledger.Conway.Specification.TokenAlgebra.ValueSet</a>


<a id="366" class="Keyword">module</a> <a id="373" href="Test.StructuredContracts.html" class="Module">Test.StructuredContracts</a>
  <a id="400" class="Symbol">(</a><a id="401" href="Test.StructuredContracts.html#401" class="Bound">txs</a> <a id="405" class="Symbol">:</a> <a id="407" class="Symbol">_)</a> <a id="410" class="Symbol">(</a><a id="411" class="Keyword">open</a> <a id="416" href="Ledger.Conway.Specification.Transaction.html#999" class="Module">TransactionStructure</a> <a id="437" href="Test.StructuredContracts.html#401" class="Bound">txs</a><a id="440" class="Symbol">)</a>
  <a id="444" class="Symbol">(</a><a id="445" href="Test.StructuredContracts.html#445" class="Bound">abs</a> <a id="449" class="Symbol">:</a> <a id="451" href="Ledger.Conway.Specification.Abstract.html#720" class="Record">AbstractFunctions</a> <a id="469" href="Test.StructuredContracts.html#401" class="Bound">txs</a><a id="472" class="Symbol">)</a> <a id="474" class="Symbol">(</a><a id="475" class="Keyword">open</a> <a id="480" href="Ledger.Conway.Specification.Abstract.html#720" class="Module">AbstractFunctions</a> <a id="498" href="Test.StructuredContracts.html#445" class="Bound">abs</a><a id="501" class="Symbol">)</a>
  <a id="505" class="Keyword">where</a>

<a id="512" class="Keyword">open</a> <a id="517" class="Keyword">import</a> <a id="524" href="Ledger.Conway.Specification.Ledger.html" class="Module">Ledger.Conway.Specification.Ledger</a> <a id="559" href="Test.StructuredContracts.html#401" class="Bound">txs</a> <a id="563" href="Test.StructuredContracts.html#445" class="Bound">abs</a>
<a id="567" class="Keyword">open</a> <a id="572" class="Keyword">import</a> <a id="579" href="Ledger.Conway.Specification.Script.ScriptPurpose.html" class="Module">Ledger.Conway.Specification.Script.ScriptPurpose</a> <a id="628" href="Test.StructuredContracts.html#401" class="Bound">txs</a>
<a id="632" class="Keyword">open</a> <a id="637" class="Keyword">import</a> <a id="644" href="Ledger.Conway.Specification.Script.Validation.html" class="Module">Ledger.Conway.Specification.Script.Validation</a> <a id="690" href="Test.StructuredContracts.html#401" class="Bound">txs</a> <a id="694" href="Test.StructuredContracts.html#445" class="Bound">abs</a>
<a id="698" class="Keyword">open</a> <a id="703" class="Keyword">import</a> <a id="710" href="Ledger.Conway.Specification.Utxo.html" class="Module">Ledger.Conway.Specification.Utxo</a> <a id="743" href="Test.StructuredContracts.html#401" class="Bound">txs</a> <a id="747" href="Test.StructuredContracts.html#445" class="Bound">abs</a>


<a id="SSRel"></a><a id="753" href="Test.StructuredContracts.html#753" class="Function">SSRel</a> <a id="759" class="Symbol">:</a> <a id="761" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="766" class="Symbol">→</a> <a id="768" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="773" class="Symbol">→</a> <a id="775" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="780" class="Symbol">→</a> <a id="782" href="Agda.Primitive.html#388" class="Primitive">Type₁</a>
<a id="788" href="Test.StructuredContracts.html#753" class="Function">SSRel</a> <a id="794" href="Test.StructuredContracts.html#794" class="Bound">Env</a> <a id="798" href="Test.StructuredContracts.html#798" class="Bound">State</a> <a id="804" href="Test.StructuredContracts.html#804" class="Bound">Input</a> <a id="810" class="Symbol">=</a> <a id="812" href="Test.StructuredContracts.html#794" class="Bound">Env</a> <a id="816" class="Symbol">→</a> <a id="818" href="Test.StructuredContracts.html#798" class="Bound">State</a> <a id="824" class="Symbol">→</a> <a id="826" href="Test.StructuredContracts.html#804" class="Bound">Input</a> <a id="832" class="Symbol">→</a> <a id="834" href="Test.StructuredContracts.html#798" class="Bound">State</a> <a id="840" class="Symbol">→</a> <a id="842" href="Agda.Primitive.html#388" class="Primitive">Type</a>

<a id="848" class="Keyword">record</a> <a id="StrucSimulation"></a><a id="855" href="Test.StructuredContracts.html#855" class="Record">StrucSimulation</a> <a id="871" href="Test.StructuredContracts.html#871" class="Bound">S</a> <a id="873" href="Test.StructuredContracts.html#873" class="Bound">I</a> <a id="875" class="Symbol">(</a><a id="876" href="Test.StructuredContracts.html#876" class="Bound Operator">_⊢_⇀⦇_,STRUC⦈_</a> <a id="891" class="Symbol">:</a> <a id="893" href="Test.StructuredContracts.html#753" class="Function">SSRel</a> <a id="899" href="Agda.Builtin.Unit.html#175" class="Record">⊤</a> <a id="901" href="Test.StructuredContracts.html#871" class="Bound">S</a> <a id="903" href="Test.StructuredContracts.html#873" class="Bound">I</a><a id="904" class="Symbol">)</a> <a id="906" class="Symbol">:</a> <a id="908" href="Agda.Primitive.html#388" class="Primitive">Type₁</a> <a id="914" class="Keyword">where</a>
  <a id="922" class="Keyword">field</a>
    <a id="StrucSimulation.πˢ"></a><a id="932" href="Test.StructuredContracts.html#932" class="Field">πˢ</a> <a id="935" class="Symbol">:</a> <a id="937" href="Ledger.Conway.Specification.Ledger.html#979" class="Record">LState</a> <a id="944" class="Symbol">→</a> <a id="946" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="952" href="Test.StructuredContracts.html#871" class="Bound">S</a>
    <a id="StrucSimulation.πⁱ"></a><a id="958" href="Test.StructuredContracts.html#958" class="Field">πⁱ</a> <a id="961" class="Symbol">:</a> <a id="963" href="Ledger.Conway.Specification.Script.ScriptPurpose.html#581" class="Record">TxInfo</a> <a id="970" class="Symbol">→</a> <a id="972" href="Test.StructuredContracts.html#873" class="Bound">I</a>
    <a id="978" class="Comment">-- here, add optional extra assumptions about ledger state, env, and</a>
    <a id="1051" class="Comment">-- transaction that may be too difficult to prove without reasoning about</a>
    <a id="1129" class="Comment">-- complete ledger traces; e.g.,</a>
    <a id="1166" class="Comment">-- * transaction does not re-add a UTxO entry it spends;</a>
    <a id="1227" class="Comment">-- * current Slot is after the validity interval of some previous transaction</a>
    <a id="StrucSimulation.extraAssmp"></a><a id="1309" href="Test.StructuredContracts.html#1309" class="Field">extraAssmp</a> <a id="1320" class="Symbol">:</a> <a id="1322" href="Ledger.Conway.Specification.Ledger.html#713" class="Record">LEnv</a> <a id="1327" class="Symbol">→</a> <a id="1329" href="Ledger.Conway.Specification.Ledger.html#979" class="Record">LState</a> <a id="1336" class="Symbol">→</a> <a id="1338" href="Ledger.Conway.Specification.Transaction.html#4682" class="Record">Tx</a> <a id="1341" class="Symbol">→</a> <a id="1343" href="Agda.Primitive.html#388" class="Primitive">Type</a>

  <a id="StrucSimulation._~ˢ_"></a><a id="1351" href="Test.StructuredContracts.html#1351" class="Function Operator">_~ˢ_</a> <a id="1356" class="Symbol">:</a> <a id="1358" href="Ledger.Conway.Specification.Ledger.html#979" class="Record">LState</a> <a id="1365" class="Symbol">→</a> <a id="1367" href="Test.StructuredContracts.html#871" class="Bound">S</a> <a id="1369" class="Symbol">→</a> <a id="1371" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="1376" class="Comment">-- R</a>
  <a id="1383" href="Test.StructuredContracts.html#1383" class="Bound">u</a> <a id="1385" href="Test.StructuredContracts.html#1351" class="Function Operator">~ˢ</a> <a id="1388" href="Test.StructuredContracts.html#1388" class="Bound">s</a> <a id="1390" class="Symbol">=</a> <a id="1392" href="Test.StructuredContracts.html#932" class="Field">πˢ</a> <a id="1395" href="Test.StructuredContracts.html#1383" class="Bound">u</a> <a id="1397" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="1399" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="1404" href="Test.StructuredContracts.html#1388" class="Bound">s</a>

  <a id="1409" class="Comment">-- only for PlutusV3</a>
  <a id="StrucSimulation._~ᵉ_"></a><a id="1432" href="Test.StructuredContracts.html#1432" class="Function Operator">_~ᵉ_</a> <a id="1437" class="Symbol">:</a> <a id="1439" href="Ledger.Conway.Specification.Ledger.html#713" class="Record">LEnv</a> <a id="1444" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="1446" href="Ledger.Conway.Specification.Transaction.html#4682" class="Record">Tx</a> <a id="1449" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="1451" href="Ledger.Conway.Specification.Ledger.html#979" class="Record">LState</a> <a id="1458" class="Symbol">→</a> <a id="1460" href="Agda.Builtin.Unit.html#175" class="Record">⊤</a> <a id="1462" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="1464" href="Test.StructuredContracts.html#873" class="Bound">I</a> <a id="1466" class="Symbol">→</a> <a id="1468" href="Agda.Primitive.html#388" class="Primitive">Type</a>
  <a id="1475" href="Test.StructuredContracts.html#1432" class="Function Operator">_~ᵉ_</a> <a id="1480" class="Symbol">=</a> <a id="1482" class="Symbol">λ</a> <a id="1484" class="Symbol">(</a><a id="1485" href="Test.StructuredContracts.html#1485" class="Bound">le</a> <a id="1488" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1490" href="Test.StructuredContracts.html#1490" class="Bound">tx</a> <a id="1493" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1495" href="Test.StructuredContracts.html#1495" class="Bound">u</a><a id="1496" class="Symbol">)</a> <a id="1498" class="Symbol">(</a><a id="1499" href="Agda.Builtin.Unit.html#212" class="InductiveConstructor">tt</a> <a id="1502" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1504" href="Test.StructuredContracts.html#1504" class="Bound">i</a><a id="1505" class="Symbol">)</a> <a id="1507" class="Symbol">→</a> <a id="1509" href="Test.StructuredContracts.html#958" class="Field">πⁱ</a> <a id="1512" class="Symbol">(</a><a id="1513" href="Ledger.Conway.Specification.Script.Validation.html#1635" class="Function">txInfo</a> <a id="1520" href="Ledger.Conway.Specification.Script.Base.html#1059" class="Function">PlutusV3</a> <a id="1529" class="Symbol">(</a><a id="1530" href="Ledger.Conway.Specification.PParams.html#3544" class="Field">PParamsOf</a> <a id="1540" href="Test.StructuredContracts.html#1485" class="Bound">le</a><a id="1542" class="Symbol">)</a> <a id="1544" class="Symbol">(</a><a id="1545" href="Ledger.Conway.Specification.Transaction.html#2939" class="Field">UTxOOf</a> <a id="1552" href="Test.StructuredContracts.html#1495" class="Bound">u</a><a id="1553" class="Symbol">)</a> <a id="1555" href="Test.StructuredContracts.html#1490" class="Bound">tx</a><a id="1557" class="Symbol">)</a> <a id="1559" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="1561" href="Test.StructuredContracts.html#1504" class="Bound">i</a>

  <a id="1566" class="Keyword">field</a>
    <a id="StrucSimulation.simulates"></a><a id="1576" href="Test.StructuredContracts.html#1576" class="Field">simulates</a> <a id="1586" class="Symbol">:</a> <a id="1588" class="Symbol">∀</a> <a id="1590" href="Test.StructuredContracts.html#1590" class="Bound">Γ</a> <a id="1592" href="Test.StructuredContracts.html#1592" class="Bound">s</a> <a id="1594" href="Test.StructuredContracts.html#1594" class="Bound">u</a> <a id="1596" href="Test.StructuredContracts.html#1596" class="Bound">tx</a> <a id="1599" href="Test.StructuredContracts.html#1599" class="Bound">i′</a> <a id="1602" href="Test.StructuredContracts.html#1602" class="Bound">u′</a> <a id="1605" class="Symbol">→</a> <a id="1607" href="Test.StructuredContracts.html#1309" class="Field">extraAssmp</a> <a id="1618" href="Test.StructuredContracts.html#1590" class="Bound">Γ</a> <a id="1620" href="Test.StructuredContracts.html#1594" class="Bound">u</a> <a id="1622" href="Test.StructuredContracts.html#1596" class="Bound">tx</a> <a id="1625" class="Symbol">→</a>
      <a id="1633" href="Prelude.InferenceRules.html#56075" class="Function Operator">∙</a> <a id="1635" href="Test.StructuredContracts.html#1590" class="Bound">Γ</a> <a id="1637" href="Ledger.Conway.Specification.Ledger.html#3824" class="Datatype Operator">⊢</a> <a id="1639" href="Test.StructuredContracts.html#1594" class="Bound">u</a> <a id="1641" href="Ledger.Conway.Specification.Ledger.html#3824" class="Datatype Operator">⇀⦇</a> <a id="1644" href="Test.StructuredContracts.html#1596" class="Bound">tx</a> <a id="1647" href="Ledger.Conway.Specification.Ledger.html#3824" class="Datatype Operator">,LEDGER⦈</a> <a id="1656" href="Test.StructuredContracts.html#1602" class="Bound">u′</a>
      <a id="1665" href="Prelude.InferenceRules.html#56006" class="Function Operator">∙</a> <a id="1667" class="Symbol">(</a><a id="1668" href="Test.StructuredContracts.html#1590" class="Bound">Γ</a> <a id="1670" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1672" href="Test.StructuredContracts.html#1596" class="Bound">tx</a> <a id="1675" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1677" href="Test.StructuredContracts.html#1594" class="Bound">u</a><a id="1678" class="Symbol">)</a> <a id="1680" href="Test.StructuredContracts.html#1432" class="Function Operator">~ᵉ</a> <a id="1683" class="Symbol">(</a><a id="1684" href="Agda.Builtin.Unit.html#212" class="InductiveConstructor">tt</a> <a id="1687" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1689" href="Test.StructuredContracts.html#1599" class="Bound">i′</a><a id="1691" class="Symbol">)</a>
      <a id="1699" href="Prelude.InferenceRules.html#56006" class="Function Operator">∙</a> <a id="1701" href="Test.StructuredContracts.html#1594" class="Bound">u</a> <a id="1703" href="Test.StructuredContracts.html#1351" class="Function Operator">~ˢ</a> <a id="1706" href="Test.StructuredContracts.html#1592" class="Bound">s</a>
      <a id="1714" href="Prelude.InferenceRules.html#13694" class="Function Operator">────────────────────────────────</a>
        <a id="1755" href="Data.Product.Base.html#1371" class="Function">∃[</a> <a id="1758" href="Test.StructuredContracts.html#1758" class="Bound">s′</a> <a id="1761" href="Data.Product.Base.html#1371" class="Function">]</a> <a id="1763" href="Test.StructuredContracts.html#1602" class="Bound">u′</a> <a id="1766" href="Test.StructuredContracts.html#1351" class="Function Operator">~ˢ</a> <a id="1769" href="Test.StructuredContracts.html#1758" class="Bound">s′</a>
               <a id="1787" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="1789" href="Agda.Builtin.Unit.html#212" class="InductiveConstructor">tt</a> <a id="1792" href="Test.StructuredContracts.html#876" class="Bound Operator">⊢</a> <a id="1794" href="Test.StructuredContracts.html#1592" class="Bound">s</a> <a id="1796" href="Test.StructuredContracts.html#876" class="Bound Operator">⇀⦇</a> <a id="1799" href="Test.StructuredContracts.html#1599" class="Bound">i′</a> <a id="1802" href="Test.StructuredContracts.html#876" class="Bound Operator">,STRUC⦈</a> <a id="1810" href="Test.StructuredContracts.html#1758" class="Bound">s′</a>

</pre></body></html>