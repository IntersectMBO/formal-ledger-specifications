<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>Test.StructuredContracts</title><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.css"><link rel="stylesheet" href="Agda.css"><script src="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.js"></script><script src="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/contrib/auto-render.min.js"></script><script src="AgdaKaTeX.js" defer=""></script></head><body><pre class="Agda">
<a id="2" class="Symbol">{-#</a> <a id="6" class="Keyword">OPTIONS</a> <a id="14" class="Pragma">--safe</a> <a id="21" class="Symbol">#-}</a>

<a id="26" class="Keyword">open</a> <a id="31" class="Keyword">import</a> <a id="38" href="Ledger.Core.Specification.Abstract.html" class="Module">Ledger.Core.Specification.Abstract</a>
<a id="73" class="Keyword">open</a> <a id="78" class="Keyword">import</a> <a id="85" href="Ledger.Conway.Specification.Transaction.html" class="Module">Ledger.Conway.Specification.Transaction</a>


<a id="127" class="Keyword">module</a> <a id="134" href="Test.StructuredContracts.html" class="Module">Test.StructuredContracts</a>
  <a id="161" class="Symbol">(</a><a id="162" href="Test.StructuredContracts.html#162" class="Bound">txs</a> <a id="166" class="Symbol">:</a> <a id="168" href="Ledger.Conway.Specification.Transaction.html#991" class="Record">TransactionStructure</a><a id="188" class="Symbol">)</a> <a id="190" class="Symbol">(</a><a id="191" class="Keyword">open</a> <a id="196" href="Ledger.Conway.Specification.Transaction.html#991" class="Module">TransactionStructure</a> <a id="217" href="Test.StructuredContracts.html#162" class="Bound">txs</a><a id="220" class="Symbol">)</a>
  <a id="224" class="Symbol">(</a><a id="225" href="Test.StructuredContracts.html#225" class="Bound">abs</a> <a id="229" class="Symbol">:</a> <a id="231" href="Ledger.Core.Specification.Abstract.html#828" class="Record">AbstractFunctions</a> <a id="249" href="Test.StructuredContracts.html#162" class="Bound">txs</a><a id="252" class="Symbol">)</a>
  <a id="256" class="Keyword">where</a>

<a id="263" class="Keyword">open</a> <a id="268" class="Keyword">import</a> <a id="275" href="Ledger.Prelude.html" class="Module">Ledger.Prelude</a>

<a id="291" class="Keyword">open</a> <a id="296" class="Keyword">import</a> <a id="303" href="Ledger.Conway.Specification.Ledger.html" class="Module">Ledger.Conway.Specification.Ledger</a> <a id="338" href="Test.StructuredContracts.html#162" class="Bound">txs</a> <a id="342" href="Test.StructuredContracts.html#225" class="Bound">abs</a>
<a id="346" class="Keyword">open</a> <a id="351" class="Keyword">import</a> <a id="358" href="Ledger.Conway.Specification.Script.ScriptPurpose.html" class="Module">Ledger.Conway.Specification.Script.ScriptPurpose</a> <a id="407" href="Test.StructuredContracts.html#162" class="Bound">txs</a>
<a id="411" class="Keyword">open</a> <a id="416" class="Keyword">import</a> <a id="423" href="Ledger.Conway.Specification.Script.Validation.html" class="Module">Ledger.Conway.Specification.Script.Validation</a> <a id="469" href="Test.StructuredContracts.html#162" class="Bound">txs</a> <a id="473" href="Test.StructuredContracts.html#225" class="Bound">abs</a>
<a id="477" class="Keyword">open</a> <a id="482" class="Keyword">import</a> <a id="489" href="Ledger.Conway.Specification.Utxo.html" class="Module">Ledger.Conway.Specification.Utxo</a> <a id="522" href="Test.StructuredContracts.html#162" class="Bound">txs</a> <a id="526" href="Test.StructuredContracts.html#225" class="Bound">abs</a>
<a id="530" class="Keyword">open</a> <a id="535" class="Keyword">import</a> <a id="542" href="Ledger.Conway.Specification.Transaction.html" class="Module">Ledger.Conway.Specification.Transaction</a>

<a id="583" class="Keyword">open</a> <a id="588" class="Keyword">import</a> <a id="595" href="Ledger.Core.Specification.TokenAlgebra.Base.html" class="Module">Ledger.Core.Specification.TokenAlgebra.Base</a>
<a id="639" class="Keyword">open</a> <a id="644" class="Keyword">import</a> <a id="651" href="Ledger.Core.Specification.TokenAlgebra.ValueSet.html" class="Module">Ledger.Core.Specification.TokenAlgebra.ValueSet</a>

<a id="700" class="Keyword">open</a> <a id="705" href="Function.Bundles.html#4750" class="Module">Equivalence</a>


<a id="SSRel"></a><a id="719" href="Test.StructuredContracts.html#719" class="Function">SSRel</a> <a id="725" class="Symbol">:</a> <a id="727" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="732" class="Symbol">→</a> <a id="734" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="739" class="Symbol">→</a> <a id="741" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="746" class="Symbol">→</a> <a id="748" href="Agda.Primitive.html#388" class="Primitive">Type₁</a>
<a id="754" href="Test.StructuredContracts.html#719" class="Function">SSRel</a> <a id="760" href="Test.StructuredContracts.html#760" class="Bound">Env</a> <a id="764" href="Test.StructuredContracts.html#764" class="Bound">State</a> <a id="770" href="Test.StructuredContracts.html#770" class="Bound">Input</a> <a id="776" class="Symbol">=</a> <a id="778" href="Test.StructuredContracts.html#760" class="Bound">Env</a> <a id="782" class="Symbol">→</a> <a id="784" href="Test.StructuredContracts.html#764" class="Bound">State</a> <a id="790" class="Symbol">→</a> <a id="792" href="Test.StructuredContracts.html#770" class="Bound">Input</a> <a id="798" class="Symbol">→</a> <a id="800" href="Test.StructuredContracts.html#764" class="Bound">State</a> <a id="806" class="Symbol">→</a> <a id="808" href="Agda.Primitive.html#388" class="Primitive">Type</a>

<a id="814" class="Keyword">record</a> <a id="StrucSimulation"></a><a id="821" href="Test.StructuredContracts.html#821" class="Record">StrucSimulation</a> <a id="837" href="Test.StructuredContracts.html#837" class="Bound">S</a> <a id="839" href="Test.StructuredContracts.html#839" class="Bound">I</a> <a id="841" class="Symbol">(</a><a id="842" href="Test.StructuredContracts.html#842" class="Bound Operator">_⊢_⇀⦇_,STRUC⦈_</a> <a id="857" class="Symbol">:</a> <a id="859" href="Test.StructuredContracts.html#719" class="Function">SSRel</a> <a id="865" href="Agda.Builtin.Unit.html#175" class="Record">⊤</a> <a id="867" href="Test.StructuredContracts.html#837" class="Bound">S</a> <a id="869" href="Test.StructuredContracts.html#839" class="Bound">I</a><a id="870" class="Symbol">)</a> <a id="872" class="Symbol">:</a> <a id="874" href="Agda.Primitive.html#388" class="Primitive">Type₁</a> <a id="880" class="Keyword">where</a>
  <a id="888" class="Keyword">field</a>
    <a id="StrucSimulation.πˢ"></a><a id="898" href="Test.StructuredContracts.html#898" class="Field">πˢ</a> <a id="901" class="Symbol">:</a> <a id="903" href="Ledger.Conway.Specification.Ledger.html#991" class="Record">LState</a> <a id="910" class="Symbol">→</a> <a id="912" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="918" href="Test.StructuredContracts.html#837" class="Bound">S</a>
    <a id="StrucSimulation.πⁱ"></a><a id="924" href="Test.StructuredContracts.html#924" class="Field">πⁱ</a> <a id="927" class="Symbol">:</a> <a id="929" href="Ledger.Conway.Specification.Script.ScriptPurpose.html#593" class="Record">TxInfo</a> <a id="936" class="Symbol">→</a> <a id="938" href="Test.StructuredContracts.html#839" class="Bound">I</a>
    <a id="944" class="Comment">-- here, add optional extra assumptions about ledger state, env, and</a>
    <a id="1017" class="Comment">-- transaction that may be too difficult to prove without reasoning about</a>
    <a id="1095" class="Comment">-- complete ledger traces; e.g.,</a>
    <a id="1132" class="Comment">-- * transaction does not re-add a UTxO entry it spends;</a>
    <a id="1193" class="Comment">-- * current Slot is after the validity interval of some previous transaction</a>
    <a id="StrucSimulation.extraAssmp"></a><a id="1275" href="Test.StructuredContracts.html#1275" class="Field">extraAssmp</a> <a id="1286" class="Symbol">:</a> <a id="1288" href="Ledger.Conway.Specification.Ledger.html#725" class="Record">LEnv</a> <a id="1293" class="Symbol">→</a> <a id="1295" href="Ledger.Conway.Specification.Ledger.html#991" class="Record">LState</a> <a id="1302" class="Symbol">→</a> <a id="1304" href="Ledger.Conway.Specification.Transaction.html#4668" class="Record">Tx</a> <a id="1307" class="Symbol">→</a> <a id="1309" href="Agda.Primitive.html#388" class="Primitive">Type</a>

  <a id="StrucSimulation._~ˢ_"></a><a id="1317" href="Test.StructuredContracts.html#1317" class="Function Operator">_~ˢ_</a> <a id="1322" class="Symbol">:</a> <a id="1324" href="Ledger.Conway.Specification.Ledger.html#991" class="Record">LState</a> <a id="1331" class="Symbol">→</a> <a id="1333" href="Test.StructuredContracts.html#837" class="Bound">S</a> <a id="1335" class="Symbol">→</a> <a id="1337" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="1342" class="Comment">-- R</a>
  <a id="1349" href="Test.StructuredContracts.html#1349" class="Bound">u</a> <a id="1351" href="Test.StructuredContracts.html#1317" class="Function Operator">~ˢ</a> <a id="1354" href="Test.StructuredContracts.html#1354" class="Bound">s</a> <a id="1356" class="Symbol">=</a> <a id="1358" href="Test.StructuredContracts.html#898" class="Field">πˢ</a> <a id="1361" href="Test.StructuredContracts.html#1349" class="Bound">u</a> <a id="1363" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="1365" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="1370" href="Test.StructuredContracts.html#1354" class="Bound">s</a>

  <a id="1375" class="Comment">-- only for PlutusV3</a>
  <a id="StrucSimulation._~ᵉ_"></a><a id="1398" href="Test.StructuredContracts.html#1398" class="Function Operator">_~ᵉ_</a> <a id="1403" class="Symbol">:</a> <a id="1405" href="Ledger.Conway.Specification.Ledger.html#725" class="Record">LEnv</a> <a id="1410" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="1412" href="Ledger.Conway.Specification.Transaction.html#4668" class="Record">Tx</a> <a id="1415" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="1417" href="Ledger.Conway.Specification.Ledger.html#991" class="Record">LState</a> <a id="1424" class="Symbol">→</a> <a id="1426" href="Agda.Builtin.Unit.html#175" class="Record">⊤</a> <a id="1428" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="1430" href="Test.StructuredContracts.html#839" class="Bound">I</a> <a id="1432" class="Symbol">→</a> <a id="1434" href="Agda.Primitive.html#388" class="Primitive">Type</a>
  <a id="1441" href="Test.StructuredContracts.html#1398" class="Function Operator">_~ᵉ_</a> <a id="1446" class="Symbol">=</a> <a id="1448" class="Symbol">λ</a> <a id="1450" class="Symbol">(</a><a id="1451" href="Test.StructuredContracts.html#1451" class="Bound">le</a> <a id="1454" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1456" href="Test.StructuredContracts.html#1456" class="Bound">tx</a> <a id="1459" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1461" href="Test.StructuredContracts.html#1461" class="Bound">u</a><a id="1462" class="Symbol">)</a> <a id="1464" class="Symbol">(</a><a id="1465" href="Agda.Builtin.Unit.html#212" class="InductiveConstructor">tt</a> <a id="1468" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1470" href="Test.StructuredContracts.html#1470" class="Bound">i</a><a id="1471" class="Symbol">)</a> <a id="1473" class="Symbol">→</a> <a id="1475" href="Test.StructuredContracts.html#924" class="Field">πⁱ</a> <a id="1478" class="Symbol">(</a><a id="1479" href="Ledger.Conway.Specification.Script.Validation.html#1684" class="Function">txInfo</a> <a id="1486" href="Ledger.Core.Specification.Script.Base.html#1057" class="Function">PlutusV3</a> <a id="1495" class="Symbol">(</a><a id="1496" href="Ledger.Conway.Specification.PParams.html#3542" class="Field">PParamsOf</a> <a id="1506" href="Test.StructuredContracts.html#1451" class="Bound">le</a><a id="1508" class="Symbol">)</a> <a id="1510" class="Symbol">(</a><a id="1511" href="Ledger.Conway.Specification.Transaction.html#2925" class="Field">UTxOOf</a> <a id="1518" href="Test.StructuredContracts.html#1461" class="Bound">u</a><a id="1519" class="Symbol">)</a> <a id="1521" href="Test.StructuredContracts.html#1456" class="Bound">tx</a><a id="1523" class="Symbol">)</a> <a id="1525" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="1527" href="Test.StructuredContracts.html#1470" class="Bound">i</a>

  <a id="1532" class="Keyword">field</a>
    <a id="StrucSimulation.simulates"></a><a id="1542" href="Test.StructuredContracts.html#1542" class="Field">simulates</a> <a id="1552" class="Symbol">:</a> <a id="1554" class="Symbol">∀</a> <a id="1556" href="Test.StructuredContracts.html#1556" class="Bound">Γ</a> <a id="1558" href="Test.StructuredContracts.html#1558" class="Bound">s</a> <a id="1560" href="Test.StructuredContracts.html#1560" class="Bound">u</a> <a id="1562" href="Test.StructuredContracts.html#1562" class="Bound">tx</a> <a id="1565" href="Test.StructuredContracts.html#1565" class="Bound">i′</a> <a id="1568" href="Test.StructuredContracts.html#1568" class="Bound">u′</a> <a id="1571" class="Symbol">→</a> <a id="1573" href="Test.StructuredContracts.html#1275" class="Field">extraAssmp</a> <a id="1584" href="Test.StructuredContracts.html#1556" class="Bound">Γ</a> <a id="1586" href="Test.StructuredContracts.html#1560" class="Bound">u</a> <a id="1588" href="Test.StructuredContracts.html#1562" class="Bound">tx</a> <a id="1591" class="Symbol">→</a>
      <a id="1599" href="Prelude.InferenceRules.html#56075" class="Function Operator">∙</a> <a id="1601" href="Test.StructuredContracts.html#1556" class="Bound">Γ</a> <a id="1603" href="Ledger.Conway.Specification.Ledger.html#3836" class="Datatype Operator">⊢</a> <a id="1605" href="Test.StructuredContracts.html#1560" class="Bound">u</a> <a id="1607" href="Ledger.Conway.Specification.Ledger.html#3836" class="Datatype Operator">⇀⦇</a> <a id="1610" href="Test.StructuredContracts.html#1562" class="Bound">tx</a> <a id="1613" href="Ledger.Conway.Specification.Ledger.html#3836" class="Datatype Operator">,LEDGER⦈</a> <a id="1622" href="Test.StructuredContracts.html#1568" class="Bound">u′</a>
      <a id="1631" href="Prelude.InferenceRules.html#56006" class="Function Operator">∙</a> <a id="1633" class="Symbol">(</a><a id="1634" href="Test.StructuredContracts.html#1556" class="Bound">Γ</a> <a id="1636" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1638" href="Test.StructuredContracts.html#1562" class="Bound">tx</a> <a id="1641" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1643" href="Test.StructuredContracts.html#1560" class="Bound">u</a><a id="1644" class="Symbol">)</a> <a id="1646" href="Test.StructuredContracts.html#1398" class="Function Operator">~ᵉ</a> <a id="1649" class="Symbol">(</a><a id="1650" href="Agda.Builtin.Unit.html#212" class="InductiveConstructor">tt</a> <a id="1653" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1655" href="Test.StructuredContracts.html#1565" class="Bound">i′</a><a id="1657" class="Symbol">)</a>
      <a id="1665" href="Prelude.InferenceRules.html#56006" class="Function Operator">∙</a> <a id="1667" href="Test.StructuredContracts.html#1560" class="Bound">u</a> <a id="1669" href="Test.StructuredContracts.html#1317" class="Function Operator">~ˢ</a> <a id="1672" href="Test.StructuredContracts.html#1558" class="Bound">s</a>
      <a id="1680" href="Prelude.InferenceRules.html#13694" class="Function Operator">────────────────────────────────</a>
        <a id="1721" href="Data.Product.Base.html#1371" class="Function">∃[</a> <a id="1724" href="Test.StructuredContracts.html#1724" class="Bound">s′</a> <a id="1727" href="Data.Product.Base.html#1371" class="Function">]</a> <a id="1729" href="Test.StructuredContracts.html#1568" class="Bound">u′</a> <a id="1732" href="Test.StructuredContracts.html#1317" class="Function Operator">~ˢ</a> <a id="1735" href="Test.StructuredContracts.html#1724" class="Bound">s′</a>
               <a id="1753" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="1755" href="Agda.Builtin.Unit.html#212" class="InductiveConstructor">tt</a> <a id="1758" href="Test.StructuredContracts.html#842" class="Bound Operator">⊢</a> <a id="1760" href="Test.StructuredContracts.html#1558" class="Bound">s</a> <a id="1762" href="Test.StructuredContracts.html#842" class="Bound Operator">⇀⦇</a> <a id="1765" href="Test.StructuredContracts.html#1565" class="Bound">i′</a> <a id="1768" href="Test.StructuredContracts.html#842" class="Bound Operator">,STRUC⦈</a> <a id="1776" href="Test.StructuredContracts.html#1724" class="Bound">s′</a>

</pre></body></html>