<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>Test.StructuredContracts</title><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.css"><link rel="stylesheet" href="Agda.css"><script src="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.js"></script><script src="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/contrib/auto-render.min.js"></script><script src="AgdaKaTeX.js" defer=""></script></head><body><pre class="Agda">
<a id="2" class="Symbol">{-#</a> <a id="6" class="Keyword">OPTIONS</a> <a id="14" class="Pragma">--safe</a> <a id="21" class="Symbol">#-}</a>

<a id="26" class="Keyword">open</a> <a id="31" class="Keyword">import</a> <a id="38" href="Ledger.Core.Specification.Abstract.html" class="Module">Ledger.Core.Specification.Abstract</a>
<a id="73" class="Keyword">open</a> <a id="78" class="Keyword">import</a> <a id="85" href="Ledger.Core.Specification.Transaction.html" class="Module">Ledger.Core.Specification.Transaction</a>


<a id="125" class="Keyword">module</a> <a id="132" href="Test.StructuredContracts.html" class="Module">Test.StructuredContracts</a>
  <a id="159" class="Symbol">(</a><a id="160" href="Test.StructuredContracts.html#160" class="Bound">txs</a> <a id="164" class="Symbol">:</a> <a id="166" href="Ledger.Core.Specification.Transaction.html#896" class="Record">TransactionStructure</a><a id="186" class="Symbol">)</a> <a id="188" class="Symbol">(</a><a id="189" class="Keyword">open</a> <a id="194" href="Ledger.Core.Specification.Transaction.html#896" class="Module">TransactionStructure</a> <a id="215" href="Test.StructuredContracts.html#160" class="Bound">txs</a><a id="218" class="Symbol">)</a>
  <a id="222" class="Symbol">(</a><a id="223" href="Test.StructuredContracts.html#223" class="Bound">abs</a> <a id="227" class="Symbol">:</a> <a id="229" href="Ledger.Core.Specification.Abstract.html#826" class="Record">AbstractFunctions</a> <a id="247" href="Test.StructuredContracts.html#160" class="Bound">txs</a><a id="250" class="Symbol">)</a>
  <a id="254" class="Keyword">where</a>

<a id="261" class="Keyword">open</a> <a id="266" class="Keyword">import</a> <a id="273" href="Ledger.Prelude.html" class="Module">Ledger.Prelude</a>

<a id="289" class="Keyword">open</a> <a id="294" class="Keyword">import</a> <a id="301" href="Ledger.Conway.Specification.Ledger.html" class="Module">Ledger.Conway.Specification.Ledger</a> <a id="336" href="Test.StructuredContracts.html#160" class="Bound">txs</a> <a id="340" href="Test.StructuredContracts.html#223" class="Bound">abs</a>
<a id="344" class="Keyword">open</a> <a id="349" class="Keyword">import</a> <a id="356" href="Ledger.Conway.Specification.Script.ScriptPurpose.html" class="Module">Ledger.Conway.Specification.Script.ScriptPurpose</a> <a id="405" href="Test.StructuredContracts.html#160" class="Bound">txs</a>
<a id="409" class="Keyword">open</a> <a id="414" class="Keyword">import</a> <a id="421" href="Ledger.Conway.Specification.Script.Validation.html" class="Module">Ledger.Conway.Specification.Script.Validation</a> <a id="467" href="Test.StructuredContracts.html#160" class="Bound">txs</a> <a id="471" href="Test.StructuredContracts.html#223" class="Bound">abs</a>
<a id="475" class="Keyword">open</a> <a id="480" class="Keyword">import</a> <a id="487" href="Ledger.Conway.Specification.Utxo.html" class="Module">Ledger.Conway.Specification.Utxo</a> <a id="520" href="Test.StructuredContracts.html#160" class="Bound">txs</a> <a id="524" href="Test.StructuredContracts.html#223" class="Bound">abs</a>
<a id="528" class="Keyword">open</a> <a id="533" class="Keyword">import</a> <a id="540" href="Ledger.Conway.Specification.Transaction.html" class="Module">Ledger.Conway.Specification.Transaction</a> <a id="580" href="Test.StructuredContracts.html#160" class="Bound">txs</a> <a id="584" href="Test.StructuredContracts.html#223" class="Bound">abs</a>

<a id="589" class="Keyword">open</a> <a id="594" class="Keyword">import</a> <a id="601" href="Ledger.Core.Specification.TokenAlgebra.Base.html" class="Module">Ledger.Core.Specification.TokenAlgebra.Base</a>
<a id="645" class="Keyword">open</a> <a id="650" class="Keyword">import</a> <a id="657" href="Ledger.Core.Specification.TokenAlgebra.ValueSet.html" class="Module">Ledger.Core.Specification.TokenAlgebra.ValueSet</a>

<a id="706" class="Keyword">open</a> <a id="711" href="Function.Bundles.html#4750" class="Module">Equivalence</a>


<a id="SSRel"></a><a id="725" href="Test.StructuredContracts.html#725" class="Function">SSRel</a> <a id="731" class="Symbol">:</a> <a id="733" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="738" class="Symbol">→</a> <a id="740" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="745" class="Symbol">→</a> <a id="747" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="752" class="Symbol">→</a> <a id="754" href="Agda.Primitive.html#388" class="Primitive">Type₁</a>
<a id="760" href="Test.StructuredContracts.html#725" class="Function">SSRel</a> <a id="766" href="Test.StructuredContracts.html#766" class="Bound">Env</a> <a id="770" href="Test.StructuredContracts.html#770" class="Bound">State</a> <a id="776" href="Test.StructuredContracts.html#776" class="Bound">Input</a> <a id="782" class="Symbol">=</a> <a id="784" href="Test.StructuredContracts.html#766" class="Bound">Env</a> <a id="788" class="Symbol">→</a> <a id="790" href="Test.StructuredContracts.html#770" class="Bound">State</a> <a id="796" class="Symbol">→</a> <a id="798" href="Test.StructuredContracts.html#776" class="Bound">Input</a> <a id="804" class="Symbol">→</a> <a id="806" href="Test.StructuredContracts.html#770" class="Bound">State</a> <a id="812" class="Symbol">→</a> <a id="814" href="Agda.Primitive.html#388" class="Primitive">Type</a>

<a id="820" class="Keyword">record</a> <a id="StrucSimulation"></a><a id="827" href="Test.StructuredContracts.html#827" class="Record">StrucSimulation</a> <a id="843" href="Test.StructuredContracts.html#843" class="Bound">S</a> <a id="845" href="Test.StructuredContracts.html#845" class="Bound">I</a> <a id="847" class="Symbol">(</a><a id="848" href="Test.StructuredContracts.html#848" class="Bound Operator">_⊢_⇀⦇_,STRUC⦈_</a> <a id="863" class="Symbol">:</a> <a id="865" href="Test.StructuredContracts.html#725" class="Function">SSRel</a> <a id="871" href="Agda.Builtin.Unit.html#175" class="Record">⊤</a> <a id="873" href="Test.StructuredContracts.html#843" class="Bound">S</a> <a id="875" href="Test.StructuredContracts.html#845" class="Bound">I</a><a id="876" class="Symbol">)</a> <a id="878" class="Symbol">:</a> <a id="880" href="Agda.Primitive.html#388" class="Primitive">Type₁</a> <a id="886" class="Keyword">where</a>
  <a id="894" class="Keyword">field</a>
    <a id="StrucSimulation.πˢ"></a><a id="904" href="Test.StructuredContracts.html#904" class="Field">πˢ</a> <a id="907" class="Symbol">:</a> <a id="909" href="Ledger.Conway.Specification.Ledger.html#997" class="Record">LState</a> <a id="916" class="Symbol">→</a> <a id="918" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="924" href="Test.StructuredContracts.html#843" class="Bound">S</a>
    <a id="StrucSimulation.πⁱ"></a><a id="930" href="Test.StructuredContracts.html#930" class="Field">πⁱ</a> <a id="933" class="Symbol">:</a> <a id="935" href="Ledger.Conway.Specification.Script.ScriptPurpose.html#591" class="Record">TxInfo</a> <a id="942" class="Symbol">→</a> <a id="944" href="Test.StructuredContracts.html#845" class="Bound">I</a>
    <a id="950" class="Comment">-- here, add optional extra assumptions about ledger state, env, and</a>
    <a id="1023" class="Comment">-- transaction that may be too difficult to prove without reasoning about</a>
    <a id="1101" class="Comment">-- complete ledger traces; e.g.,</a>
    <a id="1138" class="Comment">-- * transaction does not re-add a UTxO entry it spends;</a>
    <a id="1199" class="Comment">-- * current Slot is after the validity interval of some previous transaction</a>
    <a id="StrucSimulation.extraAssmp"></a><a id="1281" href="Test.StructuredContracts.html#1281" class="Field">extraAssmp</a> <a id="1292" class="Symbol">:</a> <a id="1294" href="Ledger.Conway.Specification.Ledger.html#731" class="Record">LEnv</a> <a id="1299" class="Symbol">→</a> <a id="1301" href="Ledger.Conway.Specification.Ledger.html#997" class="Record">LState</a> <a id="1308" class="Symbol">→</a> <a id="1310" href="Ledger.Conway.Specification.Transaction.html#1719" class="Record">Tx</a> <a id="1313" class="Symbol">→</a> <a id="1315" href="Agda.Primitive.html#388" class="Primitive">Type</a>

  <a id="StrucSimulation._~ˢ_"></a><a id="1323" href="Test.StructuredContracts.html#1323" class="Function Operator">_~ˢ_</a> <a id="1328" class="Symbol">:</a> <a id="1330" href="Ledger.Conway.Specification.Ledger.html#997" class="Record">LState</a> <a id="1337" class="Symbol">→</a> <a id="1339" href="Test.StructuredContracts.html#843" class="Bound">S</a> <a id="1341" class="Symbol">→</a> <a id="1343" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="1348" class="Comment">-- R</a>
  <a id="1355" href="Test.StructuredContracts.html#1355" class="Bound">u</a> <a id="1357" href="Test.StructuredContracts.html#1323" class="Function Operator">~ˢ</a> <a id="1360" href="Test.StructuredContracts.html#1360" class="Bound">s</a> <a id="1362" class="Symbol">=</a> <a id="1364" href="Test.StructuredContracts.html#904" class="Field">πˢ</a> <a id="1367" href="Test.StructuredContracts.html#1355" class="Bound">u</a> <a id="1369" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="1371" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="1376" href="Test.StructuredContracts.html#1360" class="Bound">s</a>

  <a id="1381" class="Comment">-- only for PlutusV3</a>
  <a id="StrucSimulation._~ᵉ_"></a><a id="1404" href="Test.StructuredContracts.html#1404" class="Function Operator">_~ᵉ_</a> <a id="1409" class="Symbol">:</a> <a id="1411" href="Ledger.Conway.Specification.Ledger.html#731" class="Record">LEnv</a> <a id="1416" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="1418" href="Ledger.Conway.Specification.Transaction.html#1719" class="Record">Tx</a> <a id="1421" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="1423" href="Ledger.Conway.Specification.Ledger.html#997" class="Record">LState</a> <a id="1430" class="Symbol">→</a> <a id="1432" href="Agda.Builtin.Unit.html#175" class="Record">⊤</a> <a id="1434" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="1436" href="Test.StructuredContracts.html#845" class="Bound">I</a> <a id="1438" class="Symbol">→</a> <a id="1440" href="Agda.Primitive.html#388" class="Primitive">Type</a>
  <a id="1447" href="Test.StructuredContracts.html#1404" class="Function Operator">_~ᵉ_</a> <a id="1452" class="Symbol">=</a> <a id="1454" class="Symbol">λ</a> <a id="1456" class="Symbol">(</a><a id="1457" href="Test.StructuredContracts.html#1457" class="Bound">le</a> <a id="1460" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1462" href="Test.StructuredContracts.html#1462" class="Bound">tx</a> <a id="1465" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1467" href="Test.StructuredContracts.html#1467" class="Bound">u</a><a id="1468" class="Symbol">)</a> <a id="1470" class="Symbol">(</a><a id="1471" href="Agda.Builtin.Unit.html#212" class="InductiveConstructor">tt</a> <a id="1474" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1476" href="Test.StructuredContracts.html#1476" class="Bound">i</a><a id="1477" class="Symbol">)</a> <a id="1479" class="Symbol">→</a> <a id="1481" href="Test.StructuredContracts.html#930" class="Field">πⁱ</a> <a id="1484" class="Symbol">(</a><a id="1485" href="Ledger.Conway.Specification.Script.Validation.html#1690" class="Function">txInfo</a> <a id="1492" href="Ledger.Core.Specification.Script.Base.html#1057" class="Function">PlutusV3</a> <a id="1501" class="Symbol">(</a><a id="1502" href="Ledger.Conway.Specification.PParams.html#3542" class="Field">PParamsOf</a> <a id="1512" href="Test.StructuredContracts.html#1457" class="Bound">le</a><a id="1514" class="Symbol">)</a> <a id="1516" class="Symbol">(</a><a id="1517" href="Ledger.Core.Specification.Transaction.html#2830" class="Field">UTxOOf</a> <a id="1524" href="Test.StructuredContracts.html#1467" class="Bound">u</a><a id="1525" class="Symbol">)</a> <a id="1527" href="Test.StructuredContracts.html#1462" class="Bound">tx</a><a id="1529" class="Symbol">)</a> <a id="1531" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="1533" href="Test.StructuredContracts.html#1476" class="Bound">i</a>

  <a id="1538" class="Keyword">field</a>
    <a id="StrucSimulation.simulates"></a><a id="1548" href="Test.StructuredContracts.html#1548" class="Field">simulates</a> <a id="1558" class="Symbol">:</a> <a id="1560" class="Symbol">∀</a> <a id="1562" href="Test.StructuredContracts.html#1562" class="Bound">Γ</a> <a id="1564" href="Test.StructuredContracts.html#1564" class="Bound">s</a> <a id="1566" href="Test.StructuredContracts.html#1566" class="Bound">u</a> <a id="1568" href="Test.StructuredContracts.html#1568" class="Bound">tx</a> <a id="1571" href="Test.StructuredContracts.html#1571" class="Bound">i′</a> <a id="1574" href="Test.StructuredContracts.html#1574" class="Bound">u′</a> <a id="1577" class="Symbol">→</a> <a id="1579" href="Test.StructuredContracts.html#1281" class="Field">extraAssmp</a> <a id="1590" href="Test.StructuredContracts.html#1562" class="Bound">Γ</a> <a id="1592" href="Test.StructuredContracts.html#1566" class="Bound">u</a> <a id="1594" href="Test.StructuredContracts.html#1568" class="Bound">tx</a> <a id="1597" class="Symbol">→</a>
      <a id="1605" href="Prelude.InferenceRules.html#56075" class="Function Operator">∙</a> <a id="1607" href="Test.StructuredContracts.html#1562" class="Bound">Γ</a> <a id="1609" href="Ledger.Conway.Specification.Ledger.html#3842" class="Datatype Operator">⊢</a> <a id="1611" href="Test.StructuredContracts.html#1566" class="Bound">u</a> <a id="1613" href="Ledger.Conway.Specification.Ledger.html#3842" class="Datatype Operator">⇀⦇</a> <a id="1616" href="Test.StructuredContracts.html#1568" class="Bound">tx</a> <a id="1619" href="Ledger.Conway.Specification.Ledger.html#3842" class="Datatype Operator">,LEDGER⦈</a> <a id="1628" href="Test.StructuredContracts.html#1574" class="Bound">u′</a>
      <a id="1637" href="Prelude.InferenceRules.html#56006" class="Function Operator">∙</a> <a id="1639" class="Symbol">(</a><a id="1640" href="Test.StructuredContracts.html#1562" class="Bound">Γ</a> <a id="1642" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1644" href="Test.StructuredContracts.html#1568" class="Bound">tx</a> <a id="1647" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1649" href="Test.StructuredContracts.html#1566" class="Bound">u</a><a id="1650" class="Symbol">)</a> <a id="1652" href="Test.StructuredContracts.html#1404" class="Function Operator">~ᵉ</a> <a id="1655" class="Symbol">(</a><a id="1656" href="Agda.Builtin.Unit.html#212" class="InductiveConstructor">tt</a> <a id="1659" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1661" href="Test.StructuredContracts.html#1571" class="Bound">i′</a><a id="1663" class="Symbol">)</a>
      <a id="1671" href="Prelude.InferenceRules.html#56006" class="Function Operator">∙</a> <a id="1673" href="Test.StructuredContracts.html#1566" class="Bound">u</a> <a id="1675" href="Test.StructuredContracts.html#1323" class="Function Operator">~ˢ</a> <a id="1678" href="Test.StructuredContracts.html#1564" class="Bound">s</a>
      <a id="1686" href="Prelude.InferenceRules.html#13694" class="Function Operator">────────────────────────────────</a>
        <a id="1727" href="Data.Product.Base.html#1371" class="Function">∃[</a> <a id="1730" href="Test.StructuredContracts.html#1730" class="Bound">s′</a> <a id="1733" href="Data.Product.Base.html#1371" class="Function">]</a> <a id="1735" href="Test.StructuredContracts.html#1574" class="Bound">u′</a> <a id="1738" href="Test.StructuredContracts.html#1323" class="Function Operator">~ˢ</a> <a id="1741" href="Test.StructuredContracts.html#1730" class="Bound">s′</a>
               <a id="1759" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="1761" href="Agda.Builtin.Unit.html#212" class="InductiveConstructor">tt</a> <a id="1764" href="Test.StructuredContracts.html#848" class="Bound Operator">⊢</a> <a id="1766" href="Test.StructuredContracts.html#1564" class="Bound">s</a> <a id="1768" href="Test.StructuredContracts.html#848" class="Bound Operator">⇀⦇</a> <a id="1771" href="Test.StructuredContracts.html#1571" class="Bound">i′</a> <a id="1774" href="Test.StructuredContracts.html#848" class="Bound Operator">,STRUC⦈</a> <a id="1782" href="Test.StructuredContracts.html#1730" class="Bound">s′</a>

</pre></body></html>