<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>Ledger.Conway.Foreign.HSLedger.Ratify</title><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.css"><link rel="stylesheet" href="Agda.css"><script src="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.js"></script><script src="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/contrib/auto-render.min.js"></script><script src="AgdaKaTeX.js" defer=""></script></head><body><pre class="Agda"><a id="1" class="Keyword">module</a> <a id="8" href="Ledger.Conway.Foreign.HSLedger.Ratify.html" class="Module">Ledger.Conway.Foreign.HSLedger.Ratify</a> <a id="46" class="Keyword">where</a>

<a id="53" class="Keyword">open</a> <a id="58" class="Keyword">import</a> <a id="65" href="Ledger.Conway.Foreign.HSLedger.Address.html" class="Module">Ledger.Conway.Foreign.HSLedger.Address</a>
<a id="104" class="Keyword">open</a> <a id="109" class="Keyword">import</a> <a id="116" href="Ledger.Conway.Foreign.HSLedger.BaseTypes.html" class="Module">Ledger.Conway.Foreign.HSLedger.BaseTypes</a>
<a id="157" class="Keyword">open</a> <a id="162" class="Keyword">import</a> <a id="169" href="Ledger.Conway.Foreign.HSLedger.Certs.html" class="Module">Ledger.Conway.Foreign.HSLedger.Certs</a>
<a id="206" class="Keyword">open</a> <a id="211" class="Keyword">import</a> <a id="218" href="Ledger.Conway.Foreign.HSLedger.Enact.html" class="Module">Ledger.Conway.Foreign.HSLedger.Enact</a>
<a id="255" class="Keyword">open</a> <a id="260" class="Keyword">import</a> <a id="267" href="Ledger.Conway.Foreign.HSLedger.Gov.Core.html" class="Module">Ledger.Conway.Foreign.HSLedger.Gov.Core</a>
<a id="307" class="Keyword">open</a> <a id="312" class="Keyword">import</a> <a id="319" href="Ledger.Conway.Foreign.HSLedger.Gov.html" class="Module">Ledger.Conway.Foreign.HSLedger.Gov</a>

<a id="355" class="Keyword">open</a> <a id="360" class="Keyword">import</a> <a id="367" href="Ledger.Conway.Specification.Enact.html" class="Module">Ledger.Conway.Specification.Enact</a> <a id="401" href="Ledger.Conway.Specification.Transaction.html#2077" class="Function">govStructure</a>

<a id="415" class="Keyword">open</a> <a id="420" class="Keyword">import</a> <a id="427" href="Data.String.Base.html" class="Module">Data.String.Base</a> <a id="444" class="Keyword">renaming</a> <a id="453" class="Symbol">(</a><a id="454" href="Data.String.Base.html#2425" class="Function Operator">_++_</a> <a id="459" class="Symbol">to</a> <a id="462" class="Function Operator">_+ˢ_</a><a id="466" class="Symbol">)</a> <a id="468" class="Keyword">hiding</a> <a id="475" class="Symbol">(</a><a id="476" href="Data.String.Base.html#1626" class="Primitive">show</a><a id="480" class="Symbol">;</a> <a id="482" href="Data.String.Base.html#2489" class="Function">length</a><a id="488" class="Symbol">)</a>
<a id="490" class="Keyword">import</a> <a id="497" href="Data.Rational.Show.html" class="Module">Data.Rational.Show</a> <a id="516" class="Symbol">as</a> <a id="519" class="Module">Rational</a>

<a id="529" class="Keyword">import</a> <a id="536" href="Foreign.Haskell.Pair.html" class="Module">Foreign.Haskell.Pair</a> <a id="557" class="Symbol">as</a> <a id="560" class="Module">F</a>
<a id="562" class="Keyword">open</a> <a id="567" class="Keyword">import</a> <a id="574" href="Ledger.Conway.Specification.Ratify.html" class="Module">Ledger.Conway.Specification.Ratify</a> <a id="609" href="Function.Base.html#4755" class="Function">it</a>
<a id="612" class="Keyword">open</a> <a id="617" class="Keyword">import</a> <a id="624" href="Ledger.Conway.Specification.Ratify.Properties.Computational.html" class="Module">Ledger.Conway.Specification.Ratify.Properties.Computational</a> <a id="684" href="Function.Base.html#4755" class="Function">it</a>

<a id="688" class="Keyword">instance</a>
  <a id="HsTy-StakeDistrs"></a><a id="699" href="Ledger.Conway.Foreign.HSLedger.Ratify.html#699" class="Function">HsTy-StakeDistrs</a> <a id="716" class="Symbol">=</a> <a id="718" href="Foreign.HaskellTypes.Deriving.html#11415" class="Macro">autoHsType</a> <a id="729" href="Ledger.Conway.Specification.Ratify.html#2963" class="Record">StakeDistrs</a>
  <a id="Conv-StakeDistrs"></a><a id="743" href="Ledger.Conway.Foreign.HSLedger.Ratify.html#743" class="Function">Conv-StakeDistrs</a> <a id="760" class="Symbol">=</a> <a id="762" href="Foreign.Convertible.Deriving.html#6814" class="Macro">autoConvert</a> <a id="774" href="Ledger.Conway.Specification.Ratify.html#2963" class="Record">StakeDistrs</a>

  <a id="HsTy-RatifyEnv"></a><a id="789" href="Ledger.Conway.Foreign.HSLedger.Ratify.html#789" class="Function">HsTy-RatifyEnv</a> <a id="804" class="Symbol">=</a> <a id="806" href="Foreign.HaskellTypes.Deriving.html#11530" class="Macro Operator">autoHsType</a> <a id="817" href="Ledger.Conway.Specification.Ratify.html#3082" class="Record">RatifyEnv</a> <a id="827" href="Foreign.HaskellTypes.Deriving.html#11530" class="Macro Operator">⊣</a> <a id="829" href="Foreign.HaskellTypes.Deriving.html#3237" class="Function">withConstructor</a> <a id="845" class="String">&quot;MkRatifyEnv&quot;</a>
                                        <a id="899" href="Foreign.HaskellTypes.Deriving.html#3523" class="Function Operator">•</a> <a id="901" href="Foreign.HaskellTypes.Deriving.html#3419" class="Function">fieldPrefix</a> <a id="913" class="String">&quot;re&quot;</a>
  <a id="Conv-RatifyEnv"></a><a id="920" href="Ledger.Conway.Foreign.HSLedger.Ratify.html#920" class="Function">Conv-RatifyEnv</a> <a id="935" class="Symbol">=</a> <a id="937" href="Foreign.Convertible.Deriving.html#6814" class="Macro">autoConvert</a> <a id="949" href="Ledger.Conway.Specification.Ratify.html#3082" class="Record">RatifyEnv</a>

  <a id="HsTy-RatifyState"></a><a id="962" href="Ledger.Conway.Foreign.HSLedger.Ratify.html#962" class="Function">HsTy-RatifyState</a> <a id="979" class="Symbol">=</a> <a id="981" href="Foreign.HaskellTypes.Deriving.html#11530" class="Macro Operator">autoHsType</a> <a id="992" href="Ledger.Conway.Specification.Ratify.html#3374" class="Record">RatifyState</a> <a id="1004" href="Foreign.HaskellTypes.Deriving.html#11530" class="Macro Operator">⊣</a> <a id="1006" href="Foreign.HaskellTypes.Deriving.html#3237" class="Function">withConstructor</a> <a id="1022" class="String">&quot;MkRatifyState&quot;</a>
                                            <a id="1082" href="Foreign.HaskellTypes.Deriving.html#3523" class="Function Operator">•</a> <a id="1084" href="Foreign.HaskellTypes.Deriving.html#3419" class="Function">fieldPrefix</a> <a id="1096" class="String">&quot;rs&quot;</a>
                                            <a id="1145" href="Foreign.HaskellTypes.Deriving.html#3523" class="Function Operator">•</a> <a id="1147" href="Ledger.Conway.Specification.Ratify.html#3411" class="Field">RatifyState.es</a> <a id="1162" href="Foreign.HaskellTypes.Deriving.html#11650" class="Macro Operator">↦</a> <a id="1164" class="String">&quot;rsEnactState&quot;</a>
  <a id="Conv-RatifyState"></a><a id="1181" href="Ledger.Conway.Foreign.HSLedger.Ratify.html#1181" class="Function">Conv-RatifyState</a> <a id="1198" class="Symbol">=</a> <a id="1200" href="Foreign.Convertible.Deriving.html#6814" class="Macro">autoConvert</a> <a id="1212" href="Ledger.Conway.Specification.Ratify.html#3374" class="Record">RatifyState</a>

<a id="1225" class="Comment">-- ratify-debug : HsType (RatifyEnv → RatifyState → List (GovActionID × GovActionState) → String)</a>
<a id="1323" class="Comment">-- ratify-debug env st sig =</a>
<a id="1352" class="Comment">--   &quot;Number of govactions: &quot; +ˢ show (length sig) +ˢ &quot;\n&quot; +ˢ</a>
<a id="1414" class="Comment">--   foldr (λ x s → s +ˢ govActionInfo x) &quot;&quot; sig</a>
<a id="1463" class="Comment">--   where</a>
<a id="1474" class="Comment">--     open RatifyEnv (from env)</a>
<a id="1507" class="Comment">--     govActionInfo : HsType (GovActionID × GovActionState) → String</a>
<a id="1577" class="Comment">--     govActionInfo (gaId F., gas) =</a>
<a id="1615" class="Comment">--       let</a>
<a id="1628" class="Comment">--         open GovActionState (from gas)</a>
<a id="1670" class="Comment">--         open RatifyState (from st)</a>
<a id="1708" class="Comment">--         open EnactState es</a>
<a id="1738" class="Comment">--         votes&#39;  = actualVotes (from env) (proj₁ pparams) (proj₁ cc) (action .gaType) votes</a>
<a id="1832" class="Comment">--         showAcceptedStakeRatio role = Rational.show (acceptedStakeRatio role (dom votes&#39;) stakeDistrs votes&#39;)</a>
<a id="1945" class="Comment">--         showIsAccepted role = case acceptedBy? (from env) es (from gas) role of λ where</a>
<a id="2036" class="Comment">--           (yes _) → &quot;✓&quot;</a>
<a id="2063" class="Comment">--           (no  _) → &quot;×&quot;</a>
<a id="2090" class="Comment">--       in</a>
<a id="2102" class="Comment">--         &quot;SPO: \t&quot;  +ˢ showAcceptedStakeRatio SPO  +ˢ &quot;\t&quot; +ˢ showIsAccepted SPO  +ˢ &quot;\n&quot; +ˢ</a>
<a id="2197" class="Comment">--         &quot;DRep: \t&quot; +ˢ showAcceptedStakeRatio DRep +ˢ &quot;\t&quot; +ˢ showIsAccepted DRep +ˢ &quot;\n&quot; +ˢ</a>
<a id="2292" class="Comment">--         &quot;CC: \t&quot;   +ˢ showAcceptedStakeRatio CC   +ˢ &quot;\t&quot; +ˢ showIsAccepted CC   +ˢ &quot;\n&quot;</a>

<a id="2385" class="Comment">-- {-# COMPILE GHC ratify-debug as ratifyDebug #-}</a>

<a id="ratify-step"></a><a id="2437" href="Ledger.Conway.Foreign.HSLedger.Ratify.html#2437" class="Function">ratify-step</a> <a id="2449" class="Symbol">:</a> <a id="2451" href="Foreign.HaskellTypes.html#593" class="Function">HsType</a> <a id="2458" class="Symbol">(</a><a id="2459" href="Ledger.Conway.Specification.Ratify.html#3082" class="Record">RatifyEnv</a> <a id="2469" class="Symbol">→</a> <a id="2471" href="Ledger.Conway.Specification.Ratify.html#3374" class="Record">RatifyState</a> <a id="2483" class="Symbol">→</a> <a id="2485" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="2490" class="Symbol">(</a><a id="2491" href="Ledger.Conway.Specification.Gov.Actions.html#798" class="Function">GovActionID</a> <a id="2503" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="2505" href="Ledger.Conway.Specification.Gov.Actions.html#3768" class="Record">GovActionState</a><a id="2519" class="Symbol">)</a> <a id="2521" class="Symbol">→</a> <a id="2523" href="Interface.ComputationalRelation.html#237" class="Datatype">ComputationResult</a> <a id="2541" href="Data.Empty.html#914" class="Function">⊥</a> <a id="2543" href="Ledger.Conway.Specification.Ratify.html#3374" class="Record">RatifyState</a><a id="2554" class="Symbol">)</a>
<a id="2556" href="Ledger.Conway.Foreign.HSLedger.Ratify.html#2437" class="Function">ratify-step</a> <a id="2568" class="Symbol">=</a> <a id="2570" href="Foreign.Convertible.html#149" class="Field">to</a> <a id="2573" class="Symbol">(</a><a id="2574" href="Interface.ComputationalRelation.html#2981" class="Function">compute</a> <a id="2582" href="Ledger.Conway.Specification.Ratify.Properties.Computational.html#2155" class="Function">Computational-RATIFIES</a><a id="2604" class="Symbol">)</a>

<a id="2607" class="Symbol">{-#</a> <a id="2611" class="Keyword">COMPILE</a> <a id="2619" class="Keyword">GHC</a> <a id="2623" href="Ledger.Conway.Foreign.HSLedger.Ratify.html#2437" class="Function">ratify-step</a> <a id="2635" class="Pragma">as</a> <a id="2638" class="Pragma">ratifyStep</a> <a id="2649" class="Symbol">#-}</a>

<a id="2654" class="Keyword">instance</a>
  <a id="Show-RATIFIES"></a><a id="2665" href="Ledger.Conway.Foreign.HSLedger.Ratify.html#2665" class="Function">Show-RATIFIES</a> <a id="2679" class="Symbol">:</a> <a id="2681" class="Symbol">∀</a> <a id="2683" class="Symbol">{</a><a id="2684" href="Ledger.Conway.Foreign.HSLedger.Ratify.html#2684" class="Bound">Γ</a> <a id="2686" href="Ledger.Conway.Foreign.HSLedger.Ratify.html#2686" class="Bound">s</a> <a id="2688" href="Ledger.Conway.Foreign.HSLedger.Ratify.html#2688" class="Bound">sig</a> <a id="2692" href="Ledger.Conway.Foreign.HSLedger.Ratify.html#2692" class="Bound">s&#39;</a><a id="2694" class="Symbol">}</a>
    <a id="2700" class="Symbol">→</a> <a id="2702" href="Class.Show.Core.html#125" class="Record">Show</a> <a id="2707" class="Symbol">(</a><a id="2708" href="Ledger.Conway.Foreign.HSLedger.Ratify.html#2684" class="Bound">Γ</a> <a id="2710" href="Ledger.Conway.Specification.Ratify.html#11729" class="Function Operator">⊢</a> <a id="2712" href="Ledger.Conway.Foreign.HSLedger.Ratify.html#2686" class="Bound">s</a> <a id="2714" href="Ledger.Conway.Specification.Ratify.html#11729" class="Function Operator">⇀⦇</a> <a id="2717" href="Ledger.Conway.Foreign.HSLedger.Ratify.html#2688" class="Bound">sig</a>  <a id="2722" href="Ledger.Conway.Specification.Ratify.html#11729" class="Function Operator">,RATIFIES⦈</a> <a id="2733" href="Ledger.Conway.Foreign.HSLedger.Ratify.html#2692" class="Bound">s&#39;</a><a id="2735" class="Symbol">)</a>
  <a id="2739" href="Ledger.Conway.Foreign.HSLedger.Ratify.html#2665" class="Function">Show-RATIFIES</a> <a id="2753" class="Symbol">{</a><a id="2754" href="Ledger.Conway.Foreign.HSLedger.Ratify.html#2754" class="Bound">Γ</a><a id="2755" class="Symbol">}</a> <a id="2757" class="Symbol">{</a><a id="2758" href="Ledger.Conway.Foreign.HSLedger.Ratify.html#2758" class="Bound">s</a><a id="2759" class="Symbol">}</a> <a id="2761" class="Symbol">{</a><a id="2762" href="Ledger.Conway.Foreign.HSLedger.Ratify.html#2762" class="Bound">sig</a><a id="2765" class="Symbol">}</a> <a id="2767" class="Symbol">.</a><a id="2768" href="Class.Show.Core.html#187" class="Field">show</a> <a id="2773" href="Ledger.Conway.Foreign.HSLedger.Ratify.html#2773" class="Bound">r</a> <a id="2775" class="Symbol">=</a> <a id="2777" class="String">&quot;&quot;</a> <a id="2780" class="Comment">-- ratify-debug (to Γ) (to s) (to sig)</a>
</pre></body></html>