<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>Ledger.PreConway.Conformance.NewPP</title><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.css"><link rel="stylesheet" href="Agda.css"><script src="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.js"></script><script src="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/contrib/auto-render.min.js"></script><script src="AgdaKaTeX.js" defer=""></script></head><body><pre class="Agda">
<a id="2" class="Symbol">{-#</a> <a id="6" class="Keyword">OPTIONS</a> <a id="14" class="Pragma">--safe</a> <a id="21" class="Symbol">#-}</a>

<a id="26" class="Keyword">open</a> <a id="31" class="Keyword">import</a> <a id="38" href="Relation.Nullary.Decidable.html" class="Module">Relation.Nullary.Decidable</a>

<a id="66" class="Keyword">open</a> <a id="71" class="Keyword">import</a> <a id="78" href="Ledger.Prelude.html" class="Module">Ledger.Prelude</a>
<a id="93" class="Keyword">open</a> <a id="98" class="Keyword">import</a> <a id="105" href="Ledger.Core.Specification.Transaction.html" class="Module">Ledger.Core.Specification.Transaction</a>

<a id="144" class="Keyword">module</a> <a id="151" href="Ledger.PreConway.Conformance.NewPP.html" class="Module">Ledger.PreConway.Conformance.NewPP</a> <a id="186" class="Symbol">(</a><a id="187" href="Ledger.PreConway.Conformance.NewPP.html#187" class="Bound">txs</a> <a id="191" class="Symbol">:</a> <a id="193" class="Symbol">_)</a> <a id="196" class="Symbol">(</a><a id="197" class="Keyword">open</a> <a id="202" href="Ledger.Core.Specification.Transaction.html#896" class="Module">TransactionStructure</a> <a id="223" href="Ledger.PreConway.Conformance.NewPP.html#187" class="Bound">txs</a><a id="226" class="Symbol">)</a> <a id="228" class="Keyword">where</a>

<a id="235" class="Keyword">open</a> <a id="240" class="Keyword">import</a> <a id="247" href="Ledger.PreConway.Conformance.PPUp.html" class="Module">Ledger.PreConway.Conformance.PPUp</a> <a id="281" href="Ledger.PreConway.Conformance.NewPP.html#187" class="Bound">txs</a>

<a id="286" class="Keyword">record</a> <a id="NewPParamEnv"></a><a id="293" href="Ledger.PreConway.Conformance.NewPP.html#293" class="Record">NewPParamEnv</a> <a id="306" class="Symbol">:</a> <a id="308" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="313" class="Keyword">where</a>
<a id="319" class="Comment">--  field</a>

<a id="330" class="Keyword">record</a> <a id="NewPParamState"></a><a id="337" href="Ledger.PreConway.Conformance.NewPP.html#337" class="Record">NewPParamState</a> <a id="352" class="Symbol">:</a> <a id="354" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="359" class="Keyword">where</a>
  <a id="367" class="Keyword">field</a>
    <a id="NewPParamState.pparams"></a><a id="377" href="Ledger.PreConway.Conformance.NewPP.html#377" class="Field">pparams</a>  <a id="386" class="Symbol">:</a> <a id="388" href="Ledger.Conway.Specification.PParams.html#1687" class="Record">PParams</a>
    <a id="NewPParamState.ppup"></a><a id="400" href="Ledger.PreConway.Conformance.NewPP.html#400" class="Field">ppup</a>     <a id="409" class="Symbol">:</a> <a id="411" href="Ledger.PreConway.Conformance.PPUp.html#529" class="Record">PPUpdateState</a>

<a id="426" class="Keyword">instance</a>
  <a id="437" class="Keyword">unquoteDecl</a> <a id="HasCast-NewPParamState"></a><a id="449" href="Ledger.PreConway.Conformance.NewPP.html#449" class="Function">HasCast-NewPParamState</a> <a id="472" class="Symbol">=</a> <a id="474" href="stdlib-classes.Class.HasCast.Derive.html#2690" class="Function">derive-HasCast</a>
    <a id="493" href="Data.List.Base.html#4907" class="Function Operator">[</a> <a id="495" class="Symbol">(</a><a id="496" class="Keyword">quote</a> <a id="502" href="Ledger.PreConway.Conformance.NewPP.html#337" class="Record">NewPParamState</a> <a id="517" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="519" href="Ledger.PreConway.Conformance.NewPP.html#449" class="Function">HasCast-NewPParamState</a><a id="541" class="Symbol">)</a> <a id="543" href="Data.List.Base.html#4907" class="Function Operator">]</a>

<a id="updatePPUp"></a><a id="546" href="Ledger.PreConway.Conformance.NewPP.html#546" class="Function">updatePPUp</a> <a id="557" class="Symbol">:</a> <a id="559" href="Ledger.Conway.Specification.PParams.html#1687" class="Record">PParams</a> <a id="567" class="Symbol">→</a> <a id="569" href="Ledger.PreConway.Conformance.PPUp.html#529" class="Record">PPUpdateState</a> <a id="583" class="Symbol">→</a> <a id="585" href="Ledger.PreConway.Conformance.PPUp.html#529" class="Record">PPUpdateState</a>
<a id="599" href="Ledger.PreConway.Conformance.NewPP.html#546" class="Function">updatePPUp</a> <a id="610" href="Ledger.PreConway.Conformance.NewPP.html#610" class="Bound">pparams</a> <a id="618" class="Keyword">record</a> <a id="625" class="Symbol">{</a> <a id="627" href="Ledger.PreConway.Conformance.PPUp.html#600" class="Field">fpup</a> <a id="632" class="Symbol">=</a> <a id="634" href="Ledger.PreConway.Conformance.NewPP.html#634" class="Bound">fpup</a> <a id="639" class="Symbol">}</a>
  <a id="643" class="Keyword">with</a> <a id="648" href="Axiom.Set.html#11487" class="Function">allᵇ</a> <a id="653" href="Class.Decidable.Core.html#783" class="Function Operator">¿</a> <a id="655" href="Ledger.PreConway.Conformance.PPUp.html#831" class="Function">isViableUpdate</a> <a id="670" href="Ledger.PreConway.Conformance.NewPP.html#610" class="Bound">pparams</a> <a id="678" href="Class.Decidable.Core.html#783" class="Function Operator">¿¹</a> <a id="681" class="Symbol">(</a><a id="682" href="Class.IsSet.html#959" class="Function">range</a> <a id="688" href="Ledger.PreConway.Conformance.NewPP.html#634" class="Bound">fpup</a><a id="692" class="Symbol">)</a>
<a id="694" class="Symbol">...</a> <a id="698" class="Symbol">|</a> <a id="700" href="Agda.Builtin.Bool.html#192" class="InductiveConstructor">false</a>  <a id="707" class="Symbol">=</a> <a id="709" class="Keyword">record</a> <a id="716" class="Symbol">{</a> <a id="718" href="Ledger.PreConway.Conformance.PPUp.html#570" class="Field">pup</a> <a id="722" class="Symbol">=</a> <a id="724" href="Axiom.Set.Map.html#2671" class="Function">∅ᵐ</a>    <a id="730" class="Symbol">;</a> <a id="732" href="Ledger.PreConway.Conformance.PPUp.html#600" class="Field">fpup</a> <a id="737" class="Symbol">=</a> <a id="739" href="Axiom.Set.Map.html#2671" class="Function">∅ᵐ</a> <a id="742" class="Symbol">}</a>
<a id="744" class="Symbol">...</a> <a id="748" class="Symbol">|</a> <a id="750" href="Agda.Builtin.Bool.html#198" class="InductiveConstructor">true</a>   <a id="757" class="Symbol">=</a> <a id="759" class="Keyword">record</a> <a id="766" class="Symbol">{</a> <a id="768" href="Ledger.PreConway.Conformance.PPUp.html#570" class="Field">pup</a> <a id="772" class="Symbol">=</a> <a id="774" class="Bound">fpup</a>  <a id="780" class="Symbol">;</a> <a id="782" href="Ledger.PreConway.Conformance.PPUp.html#600" class="Field">fpup</a> <a id="787" class="Symbol">=</a> <a id="789" href="Axiom.Set.Map.html#2671" class="Function">∅ᵐ</a> <a id="792" class="Symbol">}</a>

<a id="votedValue"></a><a id="795" href="Ledger.PreConway.Conformance.NewPP.html#795" class="Function">votedValue</a> <a id="806" class="Symbol">:</a> <a id="808" href="Ledger.Core.Specification.Transaction.html#2675" class="Function">ProposedPPUpdates</a> <a id="826" class="Symbol">→</a> <a id="828" href="Ledger.Conway.Specification.PParams.html#1687" class="Record">PParams</a> <a id="836" class="Symbol">→</a> <a id="838" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a> <a id="840" class="Symbol">→</a> <a id="842" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="848" href="Ledger.Conway.Specification.PParams.html#14093" class="Function">PParamsUpdate</a>
<a id="862" href="Ledger.PreConway.Conformance.NewPP.html#795" class="Function">votedValue</a> <a id="873" href="Ledger.PreConway.Conformance.NewPP.html#873" class="Bound">pup</a> <a id="877" href="Ledger.PreConway.Conformance.NewPP.html#877" class="Bound">pparams</a> <a id="885" href="Ledger.PreConway.Conformance.NewPP.html#885" class="Bound">quorum</a> <a id="892" class="Symbol">=</a>
  <a id="896" href="Function.Base.html#4061" class="Function Operator">case</a> <a id="901" href="Axiom.Set.html#11162" class="Function">any?</a> <a id="906" class="Symbol">(λ</a> <a id="909" href="Ledger.PreConway.Conformance.NewPP.html#909" class="Bound">u</a> <a id="911" class="Symbol">→</a> <a id="913" href="abstract-set-theory.FiniteSetTheory.html#2156" class="Function">lengthˢ</a> <a id="921" class="Symbol">(</a><a id="922" href="Ledger.PreConway.Conformance.NewPP.html#873" class="Bound">pup</a> <a id="926" href="Axiom.Set.Map.html#17773" class="Function Operator">∣^</a> <a id="929" href="Axiom.Set.html#5903" class="Function">fromList</a> <a id="938" href="Data.List.Base.html#4907" class="Function Operator">[</a> <a id="940" href="Ledger.PreConway.Conformance.NewPP.html#909" class="Bound">u</a> <a id="942" href="Data.List.Base.html#4907" class="Function Operator">]</a><a id="943" class="Symbol">)</a> <a id="945" href="Data.Nat.Properties.html#6984" class="Function Operator">≥?</a> <a id="948" href="Ledger.PreConway.Conformance.NewPP.html#885" class="Bound">quorum</a><a id="954" class="Symbol">)</a> <a id="956" class="Symbol">(</a><a id="957" href="Class.IsSet.html#959" class="Function">range</a> <a id="963" href="Ledger.PreConway.Conformance.NewPP.html#873" class="Bound">pup</a><a id="966" class="Symbol">)</a> <a id="968" href="Function.Base.html#4061" class="Function Operator">of</a>
    <a id="975" class="Symbol">λ</a>  <a id="978" class="Keyword">where</a>
       <a id="991" class="Symbol">(</a><a id="992" href="Relation.Nullary.Decidable.Core.html#2136" class="InductiveConstructor">no</a>  <a id="996" class="Symbol">_)</a>        <a id="1006" class="Symbol">→</a> <a id="1008" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a>
       <a id="1023" class="Symbol">(</a><a id="1024" href="Relation.Nullary.Decidable.Core.html#2099" class="InductiveConstructor">yes</a> <a id="1028" class="Symbol">(</a><a id="1029" href="Ledger.PreConway.Conformance.NewPP.html#1029" class="Bound">u</a> <a id="1031" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1033" class="Symbol">_))</a>  <a id="1038" class="Symbol">→</a> <a id="1040" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="1045" href="Ledger.PreConway.Conformance.NewPP.html#1029" class="Bound">u</a>

<a id="1048" class="Keyword">private</a> <a id="1056" class="Keyword">variable</a>
  <a id="1067" href="Ledger.PreConway.Conformance.NewPP.html#1067" class="Generalizable">Γ</a> <a id="1069" class="Symbol">:</a> <a id="1071" href="Ledger.PreConway.Conformance.NewPP.html#293" class="Record">NewPParamEnv</a>
  <a id="1086" href="Ledger.PreConway.Conformance.NewPP.html#1086" class="Generalizable">s</a> <a id="1088" href="Ledger.PreConway.Conformance.NewPP.html#1088" class="Generalizable">s&#39;</a> <a id="1091" class="Symbol">:</a> <a id="1093" href="Ledger.PreConway.Conformance.NewPP.html#337" class="Record">NewPParamState</a>
  <a id="1110" href="Ledger.PreConway.Conformance.NewPP.html#1110" class="Generalizable">upd</a> <a id="1114" class="Symbol">:</a> <a id="1116" href="Ledger.Conway.Specification.PParams.html#14093" class="Function">PParamsUpdate</a>

<a id="1131" class="Keyword">data</a> <a id="_⊢_⇀⦇_,NEWPP⦈_"></a><a id="1136" href="Ledger.PreConway.Conformance.NewPP.html#1136" class="Datatype Operator">_⊢_⇀⦇_,NEWPP⦈_</a> <a id="1151" class="Symbol">:</a> <a id="1153" href="Ledger.PreConway.Conformance.NewPP.html#293" class="Record">NewPParamEnv</a> <a id="1166" class="Symbol">→</a> <a id="1168" href="Ledger.PreConway.Conformance.NewPP.html#337" class="Record">NewPParamState</a> <a id="1183" class="Symbol">→</a> <a id="1185" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="1191" href="Ledger.Conway.Specification.PParams.html#14093" class="Function">PParamsUpdate</a> <a id="1205" class="Symbol">→</a> <a id="1207" href="Ledger.PreConway.Conformance.NewPP.html#337" class="Record">NewPParamState</a> <a id="1222" class="Symbol">→</a> <a id="1224" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="1229" class="Keyword">where</a>

  <a id="_⊢_⇀⦇_,NEWPP⦈_.NEWPP-Accept"></a><a id="1238" href="Ledger.PreConway.Conformance.NewPP.html#1238" class="InductiveConstructor">NEWPP-Accept</a> <a id="1251" class="Symbol">:</a> <a id="1253" class="Symbol">∀</a> <a id="1255" class="Symbol">{</a><a id="1256" href="Ledger.PreConway.Conformance.NewPP.html#1256" class="Bound">Γ</a><a id="1257" class="Symbol">}</a> <a id="1259" class="Symbol">→</a> <a id="1261" class="Keyword">let</a> <a id="1265" class="Keyword">open</a> <a id="1270" href="Ledger.PreConway.Conformance.NewPP.html#337" class="Module">NewPParamState</a> <a id="1285" href="Ledger.PreConway.Conformance.NewPP.html#1086" class="Generalizable">s</a><a id="1286" class="Symbol">;</a> <a id="1288" href="Ledger.PreConway.Conformance.NewPP.html#1288" class="Bound">newpp</a> <a id="1294" class="Symbol">=</a> <a id="1296" href="Ledger.Conway.Specification.PParams.html#13654" class="Function">applyUpdate</a> <a id="1308" href="Ledger.PreConway.Conformance.NewPP.html#377" class="Function">pparams</a> <a id="1316" href="Ledger.PreConway.Conformance.NewPP.html#1110" class="Generalizable">upd</a> <a id="1320" class="Keyword">in</a>
    <a id="1327" href="Ledger.PreConway.Conformance.PPUp.html#752" class="Function">viablePParams</a> <a id="1341" href="Ledger.PreConway.Conformance.NewPP.html#1288" class="Bound">newpp</a>
    <a id="1351" href="Prelude.InferenceRules.html#13694" class="Function Operator">────────────────────────────────</a>
    <a id="1388" href="Ledger.PreConway.Conformance.NewPP.html#1256" class="Bound">Γ</a> <a id="1390" href="Ledger.PreConway.Conformance.NewPP.html#1136" class="Datatype Operator">⊢</a> <a id="1392" href="Ledger.PreConway.Conformance.NewPP.html#1086" class="Generalizable">s</a> <a id="1394" href="Ledger.PreConway.Conformance.NewPP.html#1136" class="Datatype Operator">⇀⦇</a> <a id="1397" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="1402" href="Ledger.PreConway.Conformance.NewPP.html#1110" class="Generalizable">upd</a> <a id="1406" href="Ledger.PreConway.Conformance.NewPP.html#1136" class="Datatype Operator">,NEWPP⦈</a> <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.PreConway.Conformance.NewPP.html#1288}{\htmlId{1416}{\htmlClass{Bound}{\text{newpp}}}}\, \\ \,\href{Ledger.PreConway.Conformance.NewPP.html#546}{\htmlId{1424}{\htmlClass{Function}{\text{updatePPUp}}}}\, \,\href{Ledger.PreConway.Conformance.NewPP.html#1288}{\htmlId{1435}{\htmlClass{Bound}{\text{newpp}}}}\, \,\href{Ledger.PreConway.Conformance.NewPP.html#400}{\htmlId{1441}{\htmlClass{Function}{\text{ppup}}}}\, \end{pmatrix}$</a>

  <a id="_⊢_⇀⦇_,NEWPP⦈_.NEWPP-Reject"></a><a id="1451" href="Ledger.PreConway.Conformance.NewPP.html#1451" class="InductiveConstructor">NEWPP-Reject</a> <a id="1464" class="Symbol">:</a> <a id="1466" class="Symbol">∀</a> <a id="1468" class="Symbol">{</a><a id="1469" href="Ledger.PreConway.Conformance.NewPP.html#1469" class="Bound">Γ</a><a id="1470" class="Symbol">}</a> <a id="1472" class="Symbol">→</a>
    <a id="1478" href="Ledger.PreConway.Conformance.NewPP.html#1469" class="Bound">Γ</a> <a id="1480" href="Ledger.PreConway.Conformance.NewPP.html#1136" class="Datatype Operator">⊢</a> <a id="1482" href="Ledger.PreConway.Conformance.NewPP.html#1086" class="Generalizable">s</a> <a id="1484" href="Ledger.PreConway.Conformance.NewPP.html#1136" class="Datatype Operator">⇀⦇</a> <a id="1487" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a> <a id="1495" href="Ledger.PreConway.Conformance.NewPP.html#1136" class="Datatype Operator">,NEWPP⦈</a> <a id="1503" href="Ledger.PreConway.Conformance.NewPP.html#1086" class="Generalizable">s</a>

</pre></body></html>