<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>Ledger.PreConway.Conformance.NewPP</title><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.css"><link rel="stylesheet" href="Agda.css"><script src="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.js"></script><script src="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/contrib/auto-render.min.js"></script><script src="AgdaKaTeX.js" defer=""></script></head><body><pre class="Agda">
<a id="2" class="Symbol">{-#</a> <a id="6" class="Keyword">OPTIONS</a> <a id="14" class="Pragma">--safe</a> <a id="21" class="Symbol">#-}</a>

<a id="26" class="Keyword">open</a> <a id="31" class="Keyword">import</a> <a id="38" href="Relation.Nullary.Decidable.html" class="Module">Relation.Nullary.Decidable</a>

<a id="66" class="Keyword">open</a> <a id="71" class="Keyword">import</a> <a id="78" href="Ledger.Prelude.html" class="Module">Ledger.Prelude</a>
<a id="93" class="Keyword">open</a> <a id="98" class="Keyword">import</a> <a id="105" href="Ledger.Conway.Specification.Transaction.html" class="Module">Ledger.Conway.Specification.Transaction</a>

<a id="146" class="Keyword">module</a> <a id="153" href="Ledger.PreConway.Conformance.NewPP.html" class="Module">Ledger.PreConway.Conformance.NewPP</a> <a id="188" class="Symbol">(</a><a id="189" href="Ledger.PreConway.Conformance.NewPP.html#189" class="Bound">txs</a> <a id="193" class="Symbol">:</a> <a id="195" class="Symbol">_)</a> <a id="198" class="Symbol">(</a><a id="199" class="Keyword">open</a> <a id="204" href="Ledger.Conway.Specification.Transaction.html#999" class="Module">TransactionStructure</a> <a id="225" href="Ledger.PreConway.Conformance.NewPP.html#189" class="Bound">txs</a><a id="228" class="Symbol">)</a> <a id="230" class="Keyword">where</a>

<a id="237" class="Keyword">open</a> <a id="242" class="Keyword">import</a> <a id="249" href="Ledger.PreConway.Conformance.PPUp.html" class="Module">Ledger.PreConway.Conformance.PPUp</a> <a id="283" href="Ledger.PreConway.Conformance.NewPP.html#189" class="Bound">txs</a>

<a id="288" class="Keyword">record</a> <a id="NewPParamEnv"></a><a id="295" href="Ledger.PreConway.Conformance.NewPP.html#295" class="Record">NewPParamEnv</a> <a id="308" class="Symbol">:</a> <a id="310" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="315" class="Keyword">where</a>
<a id="321" class="Comment">--  field</a>

<a id="332" class="Keyword">record</a> <a id="NewPParamState"></a><a id="339" href="Ledger.PreConway.Conformance.NewPP.html#339" class="Record">NewPParamState</a> <a id="354" class="Symbol">:</a> <a id="356" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="361" class="Keyword">where</a>
  <a id="369" class="Keyword">field</a>
    <a id="NewPParamState.pparams"></a><a id="379" href="Ledger.PreConway.Conformance.NewPP.html#379" class="Field">pparams</a>  <a id="388" class="Symbol">:</a> <a id="390" href="Ledger.Conway.Specification.PParams.html#1685" class="Record">PParams</a>
    <a id="NewPParamState.ppup"></a><a id="402" href="Ledger.PreConway.Conformance.NewPP.html#402" class="Field">ppup</a>     <a id="411" class="Symbol">:</a> <a id="413" href="Ledger.PreConway.Conformance.PPUp.html#531" class="Record">PPUpdateState</a>

<a id="428" class="Keyword">instance</a>
  <a id="439" class="Keyword">unquoteDecl</a> <a id="HasCast-NewPParamState"></a><a id="451" href="Ledger.PreConway.Conformance.NewPP.html#451" class="Function">HasCast-NewPParamState</a> <a id="474" class="Symbol">=</a> <a id="476" href="stdlib-classes.Class.HasCast.Derive.html#2690" class="Function">derive-HasCast</a>
    <a id="495" href="Data.List.Base.html#4907" class="Function Operator">[</a> <a id="497" class="Symbol">(</a><a id="498" class="Keyword">quote</a> <a id="504" href="Ledger.PreConway.Conformance.NewPP.html#339" class="Record">NewPParamState</a> <a id="519" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="521" href="Ledger.PreConway.Conformance.NewPP.html#451" class="Function">HasCast-NewPParamState</a><a id="543" class="Symbol">)</a> <a id="545" href="Data.List.Base.html#4907" class="Function Operator">]</a>

<a id="updatePPUp"></a><a id="548" href="Ledger.PreConway.Conformance.NewPP.html#548" class="Function">updatePPUp</a> <a id="559" class="Symbol">:</a> <a id="561" href="Ledger.Conway.Specification.PParams.html#1685" class="Record">PParams</a> <a id="569" class="Symbol">→</a> <a id="571" href="Ledger.PreConway.Conformance.PPUp.html#531" class="Record">PPUpdateState</a> <a id="585" class="Symbol">→</a> <a id="587" href="Ledger.PreConway.Conformance.PPUp.html#531" class="Record">PPUpdateState</a>
<a id="601" href="Ledger.PreConway.Conformance.NewPP.html#548" class="Function">updatePPUp</a> <a id="612" href="Ledger.PreConway.Conformance.NewPP.html#612" class="Bound">pparams</a> <a id="620" class="Keyword">record</a> <a id="627" class="Symbol">{</a> <a id="629" href="Ledger.PreConway.Conformance.PPUp.html#602" class="Field">fpup</a> <a id="634" class="Symbol">=</a> <a id="636" href="Ledger.PreConway.Conformance.NewPP.html#636" class="Bound">fpup</a> <a id="641" class="Symbol">}</a>
  <a id="645" class="Keyword">with</a> <a id="650" href="Axiom.Set.html#11302" class="Function">allᵇ</a> <a id="655" href="Class.Decidable.Core.html#783" class="Function Operator">¿</a> <a id="657" href="Ledger.PreConway.Conformance.PPUp.html#833" class="Function">isViableUpdate</a> <a id="672" href="Ledger.PreConway.Conformance.NewPP.html#612" class="Bound">pparams</a> <a id="680" href="Class.Decidable.Core.html#783" class="Function Operator">¿¹</a> <a id="683" class="Symbol">(</a><a id="684" href="Class.IsSet.html#959" class="Function">range</a> <a id="690" href="Ledger.PreConway.Conformance.NewPP.html#636" class="Bound">fpup</a><a id="694" class="Symbol">)</a>
<a id="696" class="Symbol">...</a> <a id="700" class="Symbol">|</a> <a id="702" href="Agda.Builtin.Bool.html#192" class="InductiveConstructor">false</a>  <a id="709" class="Symbol">=</a> <a id="711" class="Keyword">record</a> <a id="718" class="Symbol">{</a> <a id="720" href="Ledger.PreConway.Conformance.PPUp.html#572" class="Field">pup</a> <a id="724" class="Symbol">=</a> <a id="726" href="Axiom.Set.Map.html#2671" class="Function">∅ᵐ</a>    <a id="732" class="Symbol">;</a> <a id="734" href="Ledger.PreConway.Conformance.PPUp.html#602" class="Field">fpup</a> <a id="739" class="Symbol">=</a> <a id="741" href="Axiom.Set.Map.html#2671" class="Function">∅ᵐ</a> <a id="744" class="Symbol">}</a>
<a id="746" class="Symbol">...</a> <a id="750" class="Symbol">|</a> <a id="752" href="Agda.Builtin.Bool.html#198" class="InductiveConstructor">true</a>   <a id="759" class="Symbol">=</a> <a id="761" class="Keyword">record</a> <a id="768" class="Symbol">{</a> <a id="770" href="Ledger.PreConway.Conformance.PPUp.html#572" class="Field">pup</a> <a id="774" class="Symbol">=</a> <a id="776" class="Bound">fpup</a>  <a id="782" class="Symbol">;</a> <a id="784" href="Ledger.PreConway.Conformance.PPUp.html#602" class="Field">fpup</a> <a id="789" class="Symbol">=</a> <a id="791" href="Axiom.Set.Map.html#2671" class="Function">∅ᵐ</a> <a id="794" class="Symbol">}</a>

<a id="votedValue"></a><a id="797" href="Ledger.PreConway.Conformance.NewPP.html#797" class="Function">votedValue</a> <a id="808" class="Symbol">:</a> <a id="810" href="Ledger.Conway.Specification.Transaction.html#2784" class="Function">ProposedPPUpdates</a> <a id="828" class="Symbol">→</a> <a id="830" href="Ledger.Conway.Specification.PParams.html#1685" class="Record">PParams</a> <a id="838" class="Symbol">→</a> <a id="840" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a> <a id="842" class="Symbol">→</a> <a id="844" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="850" href="Ledger.Conway.Specification.PParams.html#14107" class="Function">PParamsUpdate</a>
<a id="864" href="Ledger.PreConway.Conformance.NewPP.html#797" class="Function">votedValue</a> <a id="875" href="Ledger.PreConway.Conformance.NewPP.html#875" class="Bound">pup</a> <a id="879" href="Ledger.PreConway.Conformance.NewPP.html#879" class="Bound">pparams</a> <a id="887" href="Ledger.PreConway.Conformance.NewPP.html#887" class="Bound">quorum</a> <a id="894" class="Symbol">=</a>
  <a id="898" href="Function.Base.html#4061" class="Function Operator">case</a> <a id="903" href="Axiom.Set.html#10977" class="Function">any?</a> <a id="908" class="Symbol">(λ</a> <a id="911" href="Ledger.PreConway.Conformance.NewPP.html#911" class="Bound">u</a> <a id="913" class="Symbol">→</a> <a id="915" href="abstract-set-theory.FiniteSetTheory.html#2063" class="Function">lengthˢ</a> <a id="923" class="Symbol">(</a><a id="924" href="Ledger.PreConway.Conformance.NewPP.html#875" class="Bound">pup</a> <a id="928" href="Axiom.Set.Map.html#14434" class="Function Operator">∣^</a> <a id="931" href="Axiom.Set.html#5718" class="Function">fromList</a> <a id="940" href="Data.List.Base.html#4907" class="Function Operator">[</a> <a id="942" href="Ledger.PreConway.Conformance.NewPP.html#911" class="Bound">u</a> <a id="944" href="Data.List.Base.html#4907" class="Function Operator">]</a><a id="945" class="Symbol">)</a> <a id="947" href="Data.Nat.Properties.html#6984" class="Function Operator">≥?</a> <a id="950" href="Ledger.PreConway.Conformance.NewPP.html#887" class="Bound">quorum</a><a id="956" class="Symbol">)</a> <a id="958" class="Symbol">(</a><a id="959" href="Class.IsSet.html#959" class="Function">range</a> <a id="965" href="Ledger.PreConway.Conformance.NewPP.html#875" class="Bound">pup</a><a id="968" class="Symbol">)</a> <a id="970" href="Function.Base.html#4061" class="Function Operator">of</a>
    <a id="977" class="Symbol">λ</a>  <a id="980" class="Keyword">where</a>
       <a id="993" class="Symbol">(</a><a id="994" href="Relation.Nullary.Decidable.Core.html#2136" class="InductiveConstructor">no</a>  <a id="998" class="Symbol">_)</a>        <a id="1008" class="Symbol">→</a> <a id="1010" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a>
       <a id="1025" class="Symbol">(</a><a id="1026" href="Relation.Nullary.Decidable.Core.html#2099" class="InductiveConstructor">yes</a> <a id="1030" class="Symbol">(</a><a id="1031" href="Ledger.PreConway.Conformance.NewPP.html#1031" class="Bound">u</a> <a id="1033" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1035" class="Symbol">_))</a>  <a id="1040" class="Symbol">→</a> <a id="1042" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="1047" href="Ledger.PreConway.Conformance.NewPP.html#1031" class="Bound">u</a>

<a id="1050" class="Keyword">private</a> <a id="1058" class="Keyword">variable</a>
  <a id="1069" href="Ledger.PreConway.Conformance.NewPP.html#1069" class="Generalizable">Γ</a> <a id="1071" class="Symbol">:</a> <a id="1073" href="Ledger.PreConway.Conformance.NewPP.html#295" class="Record">NewPParamEnv</a>
  <a id="1088" href="Ledger.PreConway.Conformance.NewPP.html#1088" class="Generalizable">s</a> <a id="1090" href="Ledger.PreConway.Conformance.NewPP.html#1090" class="Generalizable">s&#39;</a> <a id="1093" class="Symbol">:</a> <a id="1095" href="Ledger.PreConway.Conformance.NewPP.html#339" class="Record">NewPParamState</a>
  <a id="1112" href="Ledger.PreConway.Conformance.NewPP.html#1112" class="Generalizable">upd</a> <a id="1116" class="Symbol">:</a> <a id="1118" href="Ledger.Conway.Specification.PParams.html#14107" class="Function">PParamsUpdate</a>

<a id="1133" class="Keyword">data</a> <a id="_⊢_⇀⦇_,NEWPP⦈_"></a><a id="1138" href="Ledger.PreConway.Conformance.NewPP.html#1138" class="Datatype Operator">_⊢_⇀⦇_,NEWPP⦈_</a> <a id="1153" class="Symbol">:</a> <a id="1155" href="Ledger.PreConway.Conformance.NewPP.html#295" class="Record">NewPParamEnv</a> <a id="1168" class="Symbol">→</a> <a id="1170" href="Ledger.PreConway.Conformance.NewPP.html#339" class="Record">NewPParamState</a> <a id="1185" class="Symbol">→</a> <a id="1187" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="1193" href="Ledger.Conway.Specification.PParams.html#14107" class="Function">PParamsUpdate</a> <a id="1207" class="Symbol">→</a> <a id="1209" href="Ledger.PreConway.Conformance.NewPP.html#339" class="Record">NewPParamState</a> <a id="1224" class="Symbol">→</a> <a id="1226" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="1231" class="Keyword">where</a>

  <a id="_⊢_⇀⦇_,NEWPP⦈_.NEWPP-Accept"></a><a id="1240" href="Ledger.PreConway.Conformance.NewPP.html#1240" class="InductiveConstructor">NEWPP-Accept</a> <a id="1253" class="Symbol">:</a> <a id="1255" class="Symbol">∀</a> <a id="1257" class="Symbol">{</a><a id="1258" href="Ledger.PreConway.Conformance.NewPP.html#1258" class="Bound">Γ</a><a id="1259" class="Symbol">}</a> <a id="1261" class="Symbol">→</a> <a id="1263" class="Keyword">let</a> <a id="1267" class="Keyword">open</a> <a id="1272" href="Ledger.PreConway.Conformance.NewPP.html#339" class="Module">NewPParamState</a> <a id="1287" href="Ledger.PreConway.Conformance.NewPP.html#1088" class="Generalizable">s</a><a id="1288" class="Symbol">;</a> <a id="1290" href="Ledger.PreConway.Conformance.NewPP.html#1290" class="Bound">newpp</a> <a id="1296" class="Symbol">=</a> <a id="1298" href="Ledger.Conway.Specification.PParams.html#13673" class="Function">applyUpdate</a> <a id="1310" href="Ledger.PreConway.Conformance.NewPP.html#379" class="Function">pparams</a> <a id="1318" href="Ledger.PreConway.Conformance.NewPP.html#1112" class="Generalizable">upd</a> <a id="1322" class="Keyword">in</a>
    <a id="1329" href="Ledger.PreConway.Conformance.PPUp.html#754" class="Function">viablePParams</a> <a id="1343" href="Ledger.PreConway.Conformance.NewPP.html#1290" class="Bound">newpp</a>
    <a id="1353" href="Prelude.InferenceRules.html#13694" class="Function Operator">────────────────────────────────</a>
    <a id="1390" href="Ledger.PreConway.Conformance.NewPP.html#1258" class="Bound">Γ</a> <a id="1392" href="Ledger.PreConway.Conformance.NewPP.html#1138" class="Datatype Operator">⊢</a> <a id="1394" href="Ledger.PreConway.Conformance.NewPP.html#1088" class="Generalizable">s</a> <a id="1396" href="Ledger.PreConway.Conformance.NewPP.html#1138" class="Datatype Operator">⇀⦇</a> <a id="1399" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="1404" href="Ledger.PreConway.Conformance.NewPP.html#1112" class="Generalizable">upd</a> <a id="1408" href="Ledger.PreConway.Conformance.NewPP.html#1138" class="Datatype Operator">,NEWPP⦈</a> <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.PreConway.Conformance.NewPP.html#1290}{\htmlId{1418}{\htmlClass{Bound}{\text{newpp}}}}\, \\ \,\href{Ledger.PreConway.Conformance.NewPP.html#548}{\htmlId{1426}{\htmlClass{Function}{\text{updatePPUp}}}}\, \,\href{Ledger.PreConway.Conformance.NewPP.html#1290}{\htmlId{1437}{\htmlClass{Bound}{\text{newpp}}}}\, \,\href{Ledger.PreConway.Conformance.NewPP.html#402}{\htmlId{1443}{\htmlClass{Function}{\text{ppup}}}}\, \end{pmatrix}$</a>

  <a id="_⊢_⇀⦇_,NEWPP⦈_.NEWPP-Reject"></a><a id="1453" href="Ledger.PreConway.Conformance.NewPP.html#1453" class="InductiveConstructor">NEWPP-Reject</a> <a id="1466" class="Symbol">:</a> <a id="1468" class="Symbol">∀</a> <a id="1470" class="Symbol">{</a><a id="1471" href="Ledger.PreConway.Conformance.NewPP.html#1471" class="Bound">Γ</a><a id="1472" class="Symbol">}</a> <a id="1474" class="Symbol">→</a>
    <a id="1480" href="Ledger.PreConway.Conformance.NewPP.html#1471" class="Bound">Γ</a> <a id="1482" href="Ledger.PreConway.Conformance.NewPP.html#1138" class="Datatype Operator">⊢</a> <a id="1484" href="Ledger.PreConway.Conformance.NewPP.html#1088" class="Generalizable">s</a> <a id="1486" href="Ledger.PreConway.Conformance.NewPP.html#1138" class="Datatype Operator">⇀⦇</a> <a id="1489" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a> <a id="1497" href="Ledger.PreConway.Conformance.NewPP.html#1138" class="Datatype Operator">,NEWPP⦈</a> <a id="1505" href="Ledger.PreConway.Conformance.NewPP.html#1088" class="Generalizable">s</a>

</pre></body></html>