<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>Ledger.PreConway.Conformance.NewPP</title><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.css"><link rel="stylesheet" href="Agda.css"><script src="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.js"></script><script src="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/contrib/auto-render.min.js"></script><script src="AgdaKaTeX.js" defer=""></script></head><body><pre class="Agda">
<a id="2" class="Symbol">{-#</a> <a id="6" class="Keyword">OPTIONS</a> <a id="14" class="Pragma">--safe</a> <a id="21" class="Symbol">#-}</a>

<a id="26" class="Keyword">open</a> <a id="31" class="Keyword">import</a> <a id="38" href="Relation.Nullary.Decidable.html" class="Module">Relation.Nullary.Decidable</a>

<a id="66" class="Keyword">open</a> <a id="71" class="Keyword">import</a> <a id="78" href="Ledger.Prelude.html" class="Module">Ledger.Prelude</a>
<a id="93" class="Keyword">open</a> <a id="98" class="Keyword">import</a> <a id="105" href="Ledger.Conway.Transaction.html" class="Module">Ledger.Conway.Transaction</a>

<a id="132" class="Keyword">module</a> <a id="139" href="Ledger.PreConway.Conformance.NewPP.html" class="Module">Ledger.PreConway.Conformance.NewPP</a> <a id="174" class="Symbol">(</a><a id="175" href="Ledger.PreConway.Conformance.NewPP.html#175" class="Bound">txs</a> <a id="179" class="Symbol">:</a> <a id="181" class="Symbol">_)</a> <a id="184" class="Symbol">(</a><a id="185" class="Keyword">open</a> <a id="190" href="Ledger.Conway.Transaction.html#910" class="Module">TransactionStructure</a> <a id="211" href="Ledger.PreConway.Conformance.NewPP.html#175" class="Bound">txs</a><a id="214" class="Symbol">)</a> <a id="216" class="Keyword">where</a>

<a id="223" class="Keyword">open</a> <a id="228" class="Keyword">import</a> <a id="235" href="Ledger.PreConway.Conformance.PPUp.html" class="Module">Ledger.PreConway.Conformance.PPUp</a> <a id="269" href="Ledger.PreConway.Conformance.NewPP.html#175" class="Bound">txs</a>

<a id="274" class="Keyword">record</a> <a id="NewPParamEnv"></a><a id="281" href="Ledger.PreConway.Conformance.NewPP.html#281" class="Record">NewPParamEnv</a> <a id="294" class="Symbol">:</a> <a id="296" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="301" class="Keyword">where</a>
<a id="307" class="Comment">--  field</a>

<a id="318" class="Keyword">record</a> <a id="NewPParamState"></a><a id="325" href="Ledger.PreConway.Conformance.NewPP.html#325" class="Record">NewPParamState</a> <a id="340" class="Symbol">:</a> <a id="342" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="347" class="Keyword">where</a>
  <a id="355" class="Keyword">field</a>
    <a id="NewPParamState.pparams"></a><a id="365" href="Ledger.PreConway.Conformance.NewPP.html#365" class="Field">pparams</a>  <a id="374" class="Symbol">:</a> <a id="376" href="Ledger.Conway.PParams.html#1717" class="Record">PParams</a>
    <a id="NewPParamState.ppup"></a><a id="388" href="Ledger.PreConway.Conformance.NewPP.html#388" class="Field">ppup</a>     <a id="397" class="Symbol">:</a> <a id="399" href="Ledger.PreConway.Conformance.PPUp.html#517" class="Record">PPUpdateState</a>

<a id="414" class="Keyword">instance</a>
  <a id="425" class="Keyword">unquoteDecl</a> <a id="HasCast-NewPParamState"></a><a id="437" href="Ledger.PreConway.Conformance.NewPP.html#437" class="Function">HasCast-NewPParamState</a> <a id="460" class="Symbol">=</a> <a id="462" href="stdlib-classes.Class.HasCast.Derive.html#2690" class="Function">derive-HasCast</a>
    <a id="481" href="Data.List.Base.html#5205" class="Function Operator">[</a> <a id="483" class="Symbol">(</a><a id="484" class="Keyword">quote</a> <a id="490" href="Ledger.PreConway.Conformance.NewPP.html#325" class="Record">NewPParamState</a> <a id="505" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="507" href="Ledger.PreConway.Conformance.NewPP.html#437" class="Function">HasCast-NewPParamState</a><a id="529" class="Symbol">)</a> <a id="531" href="Data.List.Base.html#5205" class="Function Operator">]</a>

<a id="updatePPUp"></a><a id="534" href="Ledger.PreConway.Conformance.NewPP.html#534" class="Function">updatePPUp</a> <a id="545" class="Symbol">:</a> <a id="547" href="Ledger.Conway.PParams.html#1717" class="Record">PParams</a> <a id="555" class="Symbol">→</a> <a id="557" href="Ledger.PreConway.Conformance.PPUp.html#517" class="Record">PPUpdateState</a> <a id="571" class="Symbol">→</a> <a id="573" href="Ledger.PreConway.Conformance.PPUp.html#517" class="Record">PPUpdateState</a>
<a id="587" href="Ledger.PreConway.Conformance.NewPP.html#534" class="Function">updatePPUp</a> <a id="598" href="Ledger.PreConway.Conformance.NewPP.html#598" class="Bound">pparams</a> <a id="606" class="Keyword">record</a> <a id="613" class="Symbol">{</a> <a id="615" href="Ledger.PreConway.Conformance.PPUp.html#588" class="Field">fpup</a> <a id="620" class="Symbol">=</a> <a id="622" href="Ledger.PreConway.Conformance.NewPP.html#622" class="Bound">fpup</a> <a id="627" class="Symbol">}</a>
  <a id="631" class="Keyword">with</a> <a id="636" href="Axiom.Set.html#11220" class="Function">allᵇ</a> <a id="641" href="Class.Decidable.Core.html#966" class="Function Operator">¿</a> <a id="643" href="Ledger.PreConway.Conformance.PPUp.html#819" class="Function">isViableUpdate</a> <a id="658" href="Ledger.PreConway.Conformance.NewPP.html#598" class="Bound">pparams</a> <a id="666" href="Class.Decidable.Core.html#966" class="Function Operator">¿¹</a> <a id="669" class="Symbol">(</a><a id="670" href="Class.IsSet.html#959" class="Function">range</a> <a id="676" href="Ledger.PreConway.Conformance.NewPP.html#622" class="Bound">fpup</a><a id="680" class="Symbol">)</a>
<a id="682" class="Symbol">...</a> <a id="686" class="Symbol">|</a> <a id="688" href="Agda.Builtin.Bool.html#192" class="InductiveConstructor">false</a>  <a id="695" class="Symbol">=</a> <a id="697" class="Keyword">record</a> <a id="704" class="Symbol">{</a> <a id="706" href="Ledger.PreConway.Conformance.PPUp.html#558" class="Field">pup</a> <a id="710" class="Symbol">=</a> <a id="712" href="Axiom.Set.Map.html#2671" class="Function">∅ᵐ</a>    <a id="718" class="Symbol">;</a> <a id="720" href="Ledger.PreConway.Conformance.PPUp.html#588" class="Field">fpup</a> <a id="725" class="Symbol">=</a> <a id="727" href="Axiom.Set.Map.html#2671" class="Function">∅ᵐ</a> <a id="730" class="Symbol">}</a>
<a id="732" class="Symbol">...</a> <a id="736" class="Symbol">|</a> <a id="738" href="Agda.Builtin.Bool.html#198" class="InductiveConstructor">true</a>   <a id="745" class="Symbol">=</a> <a id="747" class="Keyword">record</a> <a id="754" class="Symbol">{</a> <a id="756" href="Ledger.PreConway.Conformance.PPUp.html#558" class="Field">pup</a> <a id="760" class="Symbol">=</a> <a id="762" class="Bound">fpup</a>  <a id="768" class="Symbol">;</a> <a id="770" href="Ledger.PreConway.Conformance.PPUp.html#588" class="Field">fpup</a> <a id="775" class="Symbol">=</a> <a id="777" href="Axiom.Set.Map.html#2671" class="Function">∅ᵐ</a> <a id="780" class="Symbol">}</a>

<a id="votedValue"></a><a id="783" href="Ledger.PreConway.Conformance.NewPP.html#783" class="Function">votedValue</a> <a id="794" class="Symbol">:</a> <a id="796" href="Ledger.Conway.Transaction.html#2550" class="Function">ProposedPPUpdates</a> <a id="814" class="Symbol">→</a> <a id="816" href="Ledger.Conway.PParams.html#1717" class="Record">PParams</a> <a id="824" class="Symbol">→</a> <a id="826" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a> <a id="828" class="Symbol">→</a> <a id="830" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="836" href="Ledger.Conway.PParams.html#14669" class="Function">PParamsUpdate</a>
<a id="850" href="Ledger.PreConway.Conformance.NewPP.html#783" class="Function">votedValue</a> <a id="861" href="Ledger.PreConway.Conformance.NewPP.html#861" class="Bound">pup</a> <a id="865" href="Ledger.PreConway.Conformance.NewPP.html#865" class="Bound">pparams</a> <a id="873" href="Ledger.PreConway.Conformance.NewPP.html#873" class="Bound">quorum</a> <a id="880" class="Symbol">=</a>
  <a id="884" href="Function.Base.html#4042" class="Function Operator">case</a> <a id="889" href="Axiom.Set.html#10895" class="Function">any?</a> <a id="894" class="Symbol">(λ</a> <a id="897" href="Ledger.PreConway.Conformance.NewPP.html#897" class="Bound">u</a> <a id="899" class="Symbol">→</a> <a id="901" href="abstract-set-theory.FiniteSetTheory.html#2063" class="Function">lengthˢ</a> <a id="909" class="Symbol">(</a><a id="910" href="Ledger.PreConway.Conformance.NewPP.html#861" class="Bound">pup</a> <a id="914" href="Axiom.Set.Map.html#14048" class="Function Operator">∣^</a> <a id="917" href="Axiom.Set.html#5718" class="Function">fromList</a> <a id="926" href="Data.List.Base.html#5205" class="Function Operator">[</a> <a id="928" href="Ledger.PreConway.Conformance.NewPP.html#897" class="Bound">u</a> <a id="930" href="Data.List.Base.html#5205" class="Function Operator">]</a><a id="931" class="Symbol">)</a> <a id="933" href="Data.Nat.Properties.html#6775" class="Function Operator">≥?</a> <a id="936" href="Ledger.PreConway.Conformance.NewPP.html#873" class="Bound">quorum</a><a id="942" class="Symbol">)</a> <a id="944" class="Symbol">(</a><a id="945" href="Class.IsSet.html#959" class="Function">range</a> <a id="951" href="Ledger.PreConway.Conformance.NewPP.html#861" class="Bound">pup</a><a id="954" class="Symbol">)</a> <a id="956" href="Function.Base.html#4042" class="Function Operator">of</a>
    <a id="963" class="Symbol">λ</a>  <a id="966" class="Keyword">where</a>
       <a id="979" class="Symbol">(</a><a id="980" href="Relation.Nullary.Decidable.Core.html#2031" class="InductiveConstructor">no</a>  <a id="984" class="Symbol">_)</a>        <a id="994" class="Symbol">→</a> <a id="996" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a>
       <a id="1011" class="Symbol">(</a><a id="1012" href="Relation.Nullary.Decidable.Core.html#1994" class="InductiveConstructor">yes</a> <a id="1016" class="Symbol">(</a><a id="1017" href="Ledger.PreConway.Conformance.NewPP.html#1017" class="Bound">u</a> <a id="1019" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1021" class="Symbol">_))</a>  <a id="1026" class="Symbol">→</a> <a id="1028" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="1033" href="Ledger.PreConway.Conformance.NewPP.html#1017" class="Bound">u</a>

<a id="1036" class="Keyword">private</a> <a id="1044" class="Keyword">variable</a>
  <a id="1055" href="Ledger.PreConway.Conformance.NewPP.html#1055" class="Generalizable">Γ</a> <a id="1057" class="Symbol">:</a> <a id="1059" href="Ledger.PreConway.Conformance.NewPP.html#281" class="Record">NewPParamEnv</a>
  <a id="1074" href="Ledger.PreConway.Conformance.NewPP.html#1074" class="Generalizable">s</a> <a id="1076" href="Ledger.PreConway.Conformance.NewPP.html#1076" class="Generalizable">s&#39;</a> <a id="1079" class="Symbol">:</a> <a id="1081" href="Ledger.PreConway.Conformance.NewPP.html#325" class="Record">NewPParamState</a>
  <a id="1098" href="Ledger.PreConway.Conformance.NewPP.html#1098" class="Generalizable">upd</a> <a id="1102" class="Symbol">:</a> <a id="1104" href="Ledger.Conway.PParams.html#14669" class="Function">PParamsUpdate</a>

<a id="1119" class="Keyword">data</a> <a id="_⊢_⇀⦇_,NEWPP⦈_"></a><a id="1124" href="Ledger.PreConway.Conformance.NewPP.html#1124" class="Datatype Operator">_⊢_⇀⦇_,NEWPP⦈_</a> <a id="1139" class="Symbol">:</a> <a id="1141" href="Ledger.PreConway.Conformance.NewPP.html#281" class="Record">NewPParamEnv</a> <a id="1154" class="Symbol">→</a> <a id="1156" href="Ledger.PreConway.Conformance.NewPP.html#325" class="Record">NewPParamState</a> <a id="1171" class="Symbol">→</a> <a id="1173" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="1179" href="Ledger.Conway.PParams.html#14669" class="Function">PParamsUpdate</a> <a id="1193" class="Symbol">→</a> <a id="1195" href="Ledger.PreConway.Conformance.NewPP.html#325" class="Record">NewPParamState</a> <a id="1210" class="Symbol">→</a> <a id="1212" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="1217" class="Keyword">where</a>

  <a id="_⊢_⇀⦇_,NEWPP⦈_.NEWPP-Accept"></a><a id="1226" href="Ledger.PreConway.Conformance.NewPP.html#1226" class="InductiveConstructor">NEWPP-Accept</a> <a id="1239" class="Symbol">:</a> <a id="1241" class="Symbol">∀</a> <a id="1243" class="Symbol">{</a><a id="1244" href="Ledger.PreConway.Conformance.NewPP.html#1244" class="Bound">Γ</a><a id="1245" class="Symbol">}</a> <a id="1247" class="Symbol">→</a> <a id="1249" class="Keyword">let</a> <a id="1253" class="Keyword">open</a> <a id="1258" href="Ledger.PreConway.Conformance.NewPP.html#325" class="Module">NewPParamState</a> <a id="1273" href="Ledger.PreConway.Conformance.NewPP.html#1074" class="Generalizable">s</a><a id="1274" class="Symbol">;</a> <a id="1276" href="Ledger.PreConway.Conformance.NewPP.html#1276" class="Bound">newpp</a> <a id="1282" class="Symbol">=</a> <a id="1284" href="Ledger.Conway.PParams.html#14235" class="Function">applyUpdate</a> <a id="1296" href="Ledger.PreConway.Conformance.NewPP.html#365" class="Function">pparams</a> <a id="1304" href="Ledger.PreConway.Conformance.NewPP.html#1098" class="Generalizable">upd</a> <a id="1308" class="Keyword">in</a>
    <a id="1315" href="Ledger.PreConway.Conformance.PPUp.html#740" class="Function">viablePParams</a> <a id="1329" href="Ledger.PreConway.Conformance.NewPP.html#1276" class="Bound">newpp</a>
    <a id="1339" href="iog-prelude.Prelude.InferenceRules.html#217" class="Function Operator">────────────────────────────────</a>
    <a id="1376" href="Ledger.PreConway.Conformance.NewPP.html#1244" class="Bound">Γ</a> <a id="1378" href="Ledger.PreConway.Conformance.NewPP.html#1124" class="Datatype Operator">⊢</a> <a id="1380" href="Ledger.PreConway.Conformance.NewPP.html#1074" class="Generalizable">s</a> <a id="1382" href="Ledger.PreConway.Conformance.NewPP.html#1124" class="Datatype Operator">⇀⦇</a> <a id="1385" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="1390" href="Ledger.PreConway.Conformance.NewPP.html#1098" class="Generalizable">upd</a> <a id="1394" href="Ledger.PreConway.Conformance.NewPP.html#1124" class="Datatype Operator">,NEWPP⦈</a> <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.PreConway.Conformance.NewPP.html#1276}{\htmlId{1404}{\htmlClass{Bound}{\text{newpp}}}}\, \\ \,\href{Ledger.PreConway.Conformance.NewPP.html#534}{\htmlId{1412}{\htmlClass{Function}{\text{updatePPUp}}}}\, \,\href{Ledger.PreConway.Conformance.NewPP.html#1276}{\htmlId{1423}{\htmlClass{Bound}{\text{newpp}}}}\, \,\href{Ledger.PreConway.Conformance.NewPP.html#388}{\htmlId{1429}{\htmlClass{Function}{\text{ppup}}}}\, \end{pmatrix}$</a>

  <a id="_⊢_⇀⦇_,NEWPP⦈_.NEWPP-Reject"></a><a id="1439" href="Ledger.PreConway.Conformance.NewPP.html#1439" class="InductiveConstructor">NEWPP-Reject</a> <a id="1452" class="Symbol">:</a> <a id="1454" class="Symbol">∀</a> <a id="1456" class="Symbol">{</a><a id="1457" href="Ledger.PreConway.Conformance.NewPP.html#1457" class="Bound">Γ</a><a id="1458" class="Symbol">}</a> <a id="1460" class="Symbol">→</a>
    <a id="1466" href="Ledger.PreConway.Conformance.NewPP.html#1457" class="Bound">Γ</a> <a id="1468" href="Ledger.PreConway.Conformance.NewPP.html#1124" class="Datatype Operator">⊢</a> <a id="1470" href="Ledger.PreConway.Conformance.NewPP.html#1074" class="Generalizable">s</a> <a id="1472" href="Ledger.PreConway.Conformance.NewPP.html#1124" class="Datatype Operator">⇀⦇</a> <a id="1475" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a> <a id="1483" href="Ledger.PreConway.Conformance.NewPP.html#1124" class="Datatype Operator">,NEWPP⦈</a> <a id="1491" href="Ledger.PreConway.Conformance.NewPP.html#1074" class="Generalizable">s</a>

</pre></body></html>