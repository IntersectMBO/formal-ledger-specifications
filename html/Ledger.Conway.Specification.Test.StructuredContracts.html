<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>Ledger.Conway.Specification.Test.StructuredContracts</title><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.css"><link rel="stylesheet" href="Agda.css"><script src="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.js"></script><script src="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/contrib/auto-render.min.js"></script><script src="AgdaKaTeX.js" defer=""></script></head><body><pre class="Agda">
<a id="2" class="Symbol">{-#</a> <a id="6" class="Keyword">OPTIONS</a> <a id="14" class="Pragma">--safe</a> <a id="21" class="Symbol">#-}</a>

<a id="26" class="Keyword">open</a> <a id="31" class="Keyword">import</a> <a id="38" href="Ledger.Conway.Specification.Abstract.html" class="Module">Ledger.Conway.Specification.Abstract</a>
<a id="75" class="Keyword">open</a> <a id="80" class="Keyword">import</a> <a id="87" href="Ledger.Core.Specification.Transaction.html" class="Module">Ledger.Core.Specification.Transaction</a>

<a id="126" class="Keyword">module</a> <a id="133" href="Ledger.Conway.Specification.Test.StructuredContracts.html" class="Module">Ledger.Conway.Specification.Test.StructuredContracts</a>
  <a id="188" class="Symbol">(</a><a id="189" href="Ledger.Conway.Specification.Test.StructuredContracts.html#189" class="Bound">txs</a> <a id="193" class="Symbol">:</a> <a id="195" class="Symbol">_)</a> <a id="198" class="Symbol">(</a><a id="199" class="Keyword">open</a> <a id="204" href="Ledger.Core.Specification.Transaction.html#896" class="Module">TransactionStructure</a> <a id="225" href="Ledger.Conway.Specification.Test.StructuredContracts.html#189" class="Bound">txs</a><a id="228" class="Symbol">)</a>
  <a id="232" class="Symbol">(</a><a id="233" href="Ledger.Conway.Specification.Test.StructuredContracts.html#233" class="Bound">abs</a> <a id="237" class="Symbol">:</a> <a id="239" href="Ledger.Conway.Specification.Abstract.html#653" class="Record">AbstractFunctions</a> <a id="257" href="Ledger.Conway.Specification.Test.StructuredContracts.html#189" class="Bound">txs</a><a id="260" class="Symbol">)</a> <a id="262" class="Symbol">(</a><a id="263" class="Keyword">open</a> <a id="268" href="Ledger.Conway.Specification.Abstract.html#653" class="Module">AbstractFunctions</a> <a id="286" href="Ledger.Conway.Specification.Test.StructuredContracts.html#233" class="Bound">abs</a><a id="289" class="Symbol">)</a>
  <a id="293" class="Keyword">where</a>

<a id="300" class="Keyword">open</a> <a id="305" class="Keyword">import</a> <a id="312" href="Algebra.html" class="Module">Algebra</a>
<a id="320" class="Keyword">open</a> <a id="325" class="Keyword">import</a> <a id="332" href="Data.Nat.Properties.html" class="Module">Data.Nat.Properties</a> <a id="352" class="Keyword">using</a> <a id="358" class="Symbol">(</a><a id="359" href="Data.Nat.Properties.html#17566" class="Function">+-0-monoid</a><a id="369" class="Symbol">)</a>

<a id="372" class="Keyword">open</a> <a id="377" class="Keyword">import</a> <a id="384" href="Ledger.Prelude.html" class="Module">Ledger.Prelude</a>

<a id="400" class="Keyword">open</a> <a id="405" class="Keyword">import</a> <a id="412" href="Ledger.Conway.Specification.Ledger.html" class="Module">Ledger.Conway.Specification.Ledger</a> <a id="447" href="Ledger.Conway.Specification.Test.StructuredContracts.html#189" class="Bound">txs</a> <a id="451" href="Ledger.Conway.Specification.Test.StructuredContracts.html#233" class="Bound">abs</a>
<a id="455" class="Keyword">open</a> <a id="460" class="Keyword">import</a> <a id="467" href="Ledger.Conway.Specification.Script.Validation.html" class="Module">Ledger.Conway.Specification.Script.Validation</a> <a id="513" href="Ledger.Conway.Specification.Test.StructuredContracts.html#189" class="Bound">txs</a> <a id="517" href="Ledger.Conway.Specification.Test.StructuredContracts.html#233" class="Bound">abs</a>
<a id="521" class="Keyword">open</a> <a id="526" class="Keyword">import</a> <a id="533" href="Ledger.Conway.Specification.Utxo.html" class="Module">Ledger.Conway.Specification.Utxo</a> <a id="566" href="Ledger.Conway.Specification.Test.StructuredContracts.html#189" class="Bound">txs</a> <a id="570" href="Ledger.Conway.Specification.Test.StructuredContracts.html#233" class="Bound">abs</a>
<a id="574" class="Keyword">open</a> <a id="579" class="Keyword">import</a> <a id="586" href="Ledger.Conway.Specification.Transaction.html" class="Module">Ledger.Conway.Specification.Transaction</a> <a id="626" href="Ledger.Conway.Specification.Test.StructuredContracts.html#189" class="Bound">txs</a> <a id="630" href="Ledger.Conway.Specification.Test.StructuredContracts.html#233" class="Bound">abs</a>

<a id="635" class="Keyword">open</a> <a id="640" class="Keyword">import</a> <a id="647" href="Ledger.Core.Specification.TokenAlgebra.Base.html" class="Module">Ledger.Core.Specification.TokenAlgebra.Base</a>
<a id="691" class="Keyword">open</a> <a id="696" class="Keyword">import</a> <a id="703" href="Ledger.Core.Specification.TokenAlgebra.ValueSet.html" class="Module">Ledger.Core.Specification.TokenAlgebra.ValueSet</a>

<a id="752" class="Keyword">open</a> <a id="757" href="Function.Bundles.html#4750" class="Module">Equivalence</a>


<a id="SSRel"></a><a id="771" href="Ledger.Conway.Specification.Test.StructuredContracts.html#771" class="Function">SSRel</a> <a id="777" class="Symbol">:</a> <a id="779" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="784" class="Symbol">→</a> <a id="786" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="791" class="Symbol">→</a> <a id="793" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="798" class="Symbol">→</a> <a id="800" href="Agda.Primitive.html#388" class="Primitive">Type₁</a>
<a id="806" href="Ledger.Conway.Specification.Test.StructuredContracts.html#771" class="Function">SSRel</a> <a id="812" href="Ledger.Conway.Specification.Test.StructuredContracts.html#812" class="Bound">Env</a> <a id="816" href="Ledger.Conway.Specification.Test.StructuredContracts.html#816" class="Bound">State</a> <a id="822" href="Ledger.Conway.Specification.Test.StructuredContracts.html#822" class="Bound">Input</a> <a id="828" class="Symbol">=</a> <a id="830" href="Ledger.Conway.Specification.Test.StructuredContracts.html#812" class="Bound">Env</a> <a id="834" class="Symbol">→</a> <a id="836" href="Ledger.Conway.Specification.Test.StructuredContracts.html#816" class="Bound">State</a> <a id="842" class="Symbol">→</a> <a id="844" href="Ledger.Conway.Specification.Test.StructuredContracts.html#822" class="Bound">Input</a> <a id="850" class="Symbol">→</a> <a id="852" href="Ledger.Conway.Specification.Test.StructuredContracts.html#816" class="Bound">State</a> <a id="858" class="Symbol">→</a> <a id="860" href="Agda.Primitive.html#388" class="Primitive">Type</a>

<a id="866" class="Keyword">record</a> <a id="StrucSimulation"></a><a id="873" href="Ledger.Conway.Specification.Test.StructuredContracts.html#873" class="Record">StrucSimulation</a> <a id="889" href="Ledger.Conway.Specification.Test.StructuredContracts.html#889" class="Bound">S</a> <a id="891" href="Ledger.Conway.Specification.Test.StructuredContracts.html#891" class="Bound">I</a> <a id="893" class="Symbol">(</a><a id="894" href="Ledger.Conway.Specification.Test.StructuredContracts.html#894" class="Bound Operator">_⊢_⇀⦇_,STRUC⦈_</a> <a id="909" class="Symbol">:</a> <a id="911" href="Ledger.Conway.Specification.Test.StructuredContracts.html#771" class="Function">SSRel</a> <a id="917" href="Agda.Builtin.Unit.html#175" class="Record">⊤</a> <a id="919" href="Ledger.Conway.Specification.Test.StructuredContracts.html#889" class="Bound">S</a> <a id="921" href="Ledger.Conway.Specification.Test.StructuredContracts.html#891" class="Bound">I</a><a id="922" class="Symbol">)</a> <a id="924" class="Symbol">:</a> <a id="926" href="Agda.Primitive.html#388" class="Primitive">Type₁</a> <a id="932" class="Keyword">where</a>
  <a id="940" class="Keyword">field</a>
    <a id="StrucSimulation.πˢ"></a><a id="950" href="Ledger.Conway.Specification.Test.StructuredContracts.html#950" class="Field">πˢ</a> <a id="953" class="Symbol">:</a> <a id="955" href="Ledger.Conway.Specification.Ledger.html#999" class="Record">LState</a> <a id="962" class="Symbol">→</a> <a id="964" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="970" href="Ledger.Conway.Specification.Test.StructuredContracts.html#889" class="Bound">S</a>
    <a id="StrucSimulation.πⁱ"></a><a id="976" href="Ledger.Conway.Specification.Test.StructuredContracts.html#976" class="Field">πⁱ</a> <a id="979" class="Symbol">:</a> <a id="981" href="Ledger.Conway.Specification.Script.Validation.html#1883" class="Record">TxInfo</a> <a id="988" class="Symbol">→</a> <a id="990" href="Ledger.Conway.Specification.Test.StructuredContracts.html#891" class="Bound">I</a>
    <a id="996" class="Comment">-- here, add optional extra assumptions about ledger state, env, and</a>
    <a id="1069" class="Comment">-- transaction that may be too difficult to prove without reasoning about</a>
    <a id="1147" class="Comment">-- complete ledger traces; e.g.,</a>
    <a id="1184" class="Comment">-- * transaction does not re-add a UTxO entry it spends;</a>
    <a id="1245" class="Comment">-- * current Slot is after the validity interval of some previous transaction</a>
    <a id="StrucSimulation.extraAssmp"></a><a id="1327" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1327" class="Field">extraAssmp</a> <a id="1338" class="Symbol">:</a> <a id="1340" href="Ledger.Conway.Specification.Ledger.html#733" class="Record">LEnv</a> <a id="1345" class="Symbol">→</a> <a id="1347" href="Ledger.Conway.Specification.Ledger.html#999" class="Record">LState</a> <a id="1354" class="Symbol">→</a> <a id="1356" href="Ledger.Conway.Specification.Transaction.html#1721" class="Record">Tx</a> <a id="1359" class="Symbol">→</a> <a id="1361" href="Agda.Primitive.html#388" class="Primitive">Type</a>

  <a id="StrucSimulation._~ˢ_"></a><a id="1369" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1369" class="Function Operator">_~ˢ_</a> <a id="1374" class="Symbol">:</a> <a id="1376" href="Ledger.Conway.Specification.Ledger.html#999" class="Record">LState</a> <a id="1383" class="Symbol">→</a> <a id="1385" href="Ledger.Conway.Specification.Test.StructuredContracts.html#889" class="Bound">S</a> <a id="1387" class="Symbol">→</a> <a id="1389" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="1394" class="Comment">-- R</a>
  <a id="1401" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1401" class="Bound">u</a> <a id="1403" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1369" class="Function Operator">~ˢ</a> <a id="1406" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1406" class="Bound">s</a> <a id="1408" class="Symbol">=</a> <a id="1410" href="Ledger.Conway.Specification.Test.StructuredContracts.html#950" class="Field">πˢ</a> <a id="1413" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1401" class="Bound">u</a> <a id="1415" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="1417" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="1422" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1406" class="Bound">s</a>

  <a id="1427" class="Comment">-- only for PlutusV3</a>
  <a id="StrucSimulation._~ᵉ_"></a><a id="1450" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1450" class="Function Operator">_~ᵉ_</a> <a id="1455" class="Symbol">:</a> <a id="1457" href="Ledger.Conway.Specification.Ledger.html#733" class="Record">LEnv</a> <a id="1462" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="1464" href="Ledger.Conway.Specification.Transaction.html#1721" class="Record">Tx</a> <a id="1467" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="1469" href="Ledger.Conway.Specification.Ledger.html#999" class="Record">LState</a> <a id="1476" class="Symbol">→</a> <a id="1478" href="Agda.Builtin.Unit.html#175" class="Record">⊤</a> <a id="1480" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="1482" href="Ledger.Conway.Specification.Test.StructuredContracts.html#891" class="Bound">I</a> <a id="1484" class="Symbol">→</a> <a id="1486" href="Agda.Primitive.html#388" class="Primitive">Type</a>
  <a id="1493" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1450" class="Function Operator">_~ᵉ_</a> <a id="1498" class="Symbol">=</a> <a id="1500" class="Symbol">λ</a> <a id="1502" class="Symbol">(</a><a id="1503" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1503" class="Bound">le</a> <a id="1506" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1508" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1508" class="Bound">tx</a> <a id="1511" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1513" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1513" class="Bound">u</a><a id="1514" class="Symbol">)</a> <a id="1516" class="Symbol">(</a><a id="1517" href="Agda.Builtin.Unit.html#212" class="InductiveConstructor">tt</a> <a id="1520" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1522" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1522" class="Bound">i</a><a id="1523" class="Symbol">)</a> <a id="1525" class="Symbol">→</a> <a id="1527" href="Ledger.Conway.Specification.Test.StructuredContracts.html#976" class="Field">πⁱ</a> <a id="1530" class="Symbol">(</a><a id="1531" href="Ledger.Conway.Specification.Script.Validation.html#2252" class="Function">txInfo</a> <a id="1538" href="Ledger.Core.Specification.Script.Base.html#1057" class="Function">PlutusV3</a> <a id="1547" class="Symbol">(</a><a id="1548" href="Ledger.Conway.Specification.PParams.html#3542" class="Field">PParamsOf</a> <a id="1558" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1503" class="Bound">le</a><a id="1560" class="Symbol">)</a> <a id="1562" class="Symbol">(</a><a id="1563" href="Ledger.Core.Specification.Transaction.html#2830" class="Field">UTxOOf</a> <a id="1570" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1513" class="Bound">u</a><a id="1571" class="Symbol">)</a> <a id="1573" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1508" class="Bound">tx</a><a id="1575" class="Symbol">)</a> <a id="1577" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="1579" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1522" class="Bound">i</a>

  <a id="1584" class="Keyword">field</a>
    <a id="StrucSimulation.simulates"></a><a id="1594" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1594" class="Field">simulates</a> <a id="1604" class="Symbol">:</a> <a id="1606" class="Symbol">∀</a> <a id="1608" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1608" class="Bound">Γ</a> <a id="1610" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1610" class="Bound">s</a> <a id="1612" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1612" class="Bound">u</a> <a id="1614" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1614" class="Bound">tx</a> <a id="1617" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1617" class="Bound">i′</a> <a id="1620" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1620" class="Bound">u′</a> <a id="1623" class="Symbol">→</a> <a id="1625" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1327" class="Field">extraAssmp</a> <a id="1636" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1608" class="Bound">Γ</a> <a id="1638" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1612" class="Bound">u</a> <a id="1640" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1614" class="Bound">tx</a> <a id="1643" class="Symbol">→</a>
      <a id="1651" href="Prelude.InferenceRules.html#56075" class="Function Operator">∙</a> <a id="1653" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1608" class="Bound">Γ</a> <a id="1655" href="Ledger.Conway.Specification.Ledger.html#3844" class="Datatype Operator">⊢</a> <a id="1657" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1612" class="Bound">u</a> <a id="1659" href="Ledger.Conway.Specification.Ledger.html#3844" class="Datatype Operator">⇀⦇</a> <a id="1662" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1614" class="Bound">tx</a> <a id="1665" href="Ledger.Conway.Specification.Ledger.html#3844" class="Datatype Operator">,LEDGER⦈</a> <a id="1674" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1620" class="Bound">u′</a>
      <a id="1683" href="Prelude.InferenceRules.html#56006" class="Function Operator">∙</a> <a id="1685" class="Symbol">(</a><a id="1686" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1608" class="Bound">Γ</a> <a id="1688" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1690" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1614" class="Bound">tx</a> <a id="1693" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1695" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1612" class="Bound">u</a><a id="1696" class="Symbol">)</a> <a id="1698" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1450" class="Function Operator">~ᵉ</a> <a id="1701" class="Symbol">(</a><a id="1702" href="Agda.Builtin.Unit.html#212" class="InductiveConstructor">tt</a> <a id="1705" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1707" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1617" class="Bound">i′</a><a id="1709" class="Symbol">)</a>
      <a id="1717" href="Prelude.InferenceRules.html#56006" class="Function Operator">∙</a> <a id="1719" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1612" class="Bound">u</a> <a id="1721" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1369" class="Function Operator">~ˢ</a> <a id="1724" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1610" class="Bound">s</a>
      <a id="1732" href="Prelude.InferenceRules.html#13694" class="Function Operator">────────────────────────────────</a>
        <a id="1773" href="Data.Product.Base.html#1371" class="Function">∃[</a> <a id="1776" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1776" class="Bound">s′</a> <a id="1779" href="Data.Product.Base.html#1371" class="Function">]</a> <a id="1781" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1620" class="Bound">u′</a> <a id="1784" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1369" class="Function Operator">~ˢ</a> <a id="1787" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1776" class="Bound">s′</a>
               <a id="1805" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="1807" href="Agda.Builtin.Unit.html#212" class="InductiveConstructor">tt</a> <a id="1810" href="Ledger.Conway.Specification.Test.StructuredContracts.html#894" class="Bound Operator">⊢</a> <a id="1812" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1610" class="Bound">s</a> <a id="1814" href="Ledger.Conway.Specification.Test.StructuredContracts.html#894" class="Bound Operator">⇀⦇</a> <a id="1817" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1617" class="Bound">i′</a> <a id="1820" href="Ledger.Conway.Specification.Test.StructuredContracts.html#894" class="Bound Operator">,STRUC⦈</a> <a id="1828" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1776" class="Bound">s′</a>

</pre></body></html>