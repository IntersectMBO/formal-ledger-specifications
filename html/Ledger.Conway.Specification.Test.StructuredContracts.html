<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>Ledger.Conway.Specification.Test.StructuredContracts</title><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.css"><link rel="stylesheet" href="Agda.css"><script src="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.js"></script><script src="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/contrib/auto-render.min.js"></script><script src="AgdaKaTeX.js" defer=""></script></head><body><pre class="Agda">
<a id="2" class="Symbol">{-#</a> <a id="6" class="Keyword">OPTIONS</a> <a id="14" class="Pragma">--safe</a> <a id="21" class="Symbol">#-}</a>

<a id="26" class="Keyword">open</a> <a id="31" class="Keyword">import</a> <a id="38" href="Ledger.Core.Specification.Abstract.html" class="Module">Ledger.Core.Specification.Abstract</a>
<a id="73" class="Keyword">open</a> <a id="78" class="Keyword">import</a> <a id="85" href="Ledger.Core.Specification.Transaction.html" class="Module">Ledger.Core.Specification.Transaction</a>

<a id="124" class="Keyword">module</a> <a id="131" href="Ledger.Conway.Specification.Test.StructuredContracts.html" class="Module">Ledger.Conway.Specification.Test.StructuredContracts</a>
  <a id="186" class="Symbol">(</a><a id="187" href="Ledger.Conway.Specification.Test.StructuredContracts.html#187" class="Bound">txs</a> <a id="191" class="Symbol">:</a> <a id="193" href="Ledger.Core.Specification.Transaction.html#896" class="Record">TransactionStructure</a><a id="213" class="Symbol">)</a> <a id="215" class="Symbol">(</a><a id="216" class="Keyword">open</a> <a id="221" href="Ledger.Core.Specification.Transaction.html#896" class="Module">TransactionStructure</a> <a id="242" href="Ledger.Conway.Specification.Test.StructuredContracts.html#187" class="Bound">txs</a><a id="245" class="Symbol">)</a>
  <a id="249" class="Symbol">(</a><a id="250" href="Ledger.Conway.Specification.Test.StructuredContracts.html#250" class="Bound">abs</a> <a id="254" class="Symbol">:</a> <a id="256" href="Ledger.Core.Specification.Abstract.html#651" class="Record">AbstractFunctions</a> <a id="274" href="Ledger.Conway.Specification.Test.StructuredContracts.html#187" class="Bound">txs</a><a id="277" class="Symbol">)</a>
  <a id="281" class="Keyword">where</a>

<a id="288" class="Keyword">open</a> <a id="293" class="Keyword">import</a> <a id="300" href="Ledger.Prelude.html" class="Module">Ledger.Prelude</a>

<a id="316" class="Keyword">open</a> <a id="321" class="Keyword">import</a> <a id="328" href="Ledger.Conway.Specification.Ledger.html" class="Module">Ledger.Conway.Specification.Ledger</a> <a id="363" href="Ledger.Conway.Specification.Test.StructuredContracts.html#187" class="Bound">txs</a> <a id="367" href="Ledger.Conway.Specification.Test.StructuredContracts.html#250" class="Bound">abs</a>
<a id="371" class="Keyword">open</a> <a id="376" class="Keyword">import</a> <a id="383" href="Ledger.Conway.Specification.Script.Validation.html" class="Module">Ledger.Conway.Specification.Script.Validation</a> <a id="429" href="Ledger.Conway.Specification.Test.StructuredContracts.html#187" class="Bound">txs</a> <a id="433" href="Ledger.Conway.Specification.Test.StructuredContracts.html#250" class="Bound">abs</a>
<a id="437" class="Keyword">open</a> <a id="442" class="Keyword">import</a> <a id="449" href="Ledger.Conway.Specification.Utxo.html" class="Module">Ledger.Conway.Specification.Utxo</a> <a id="482" href="Ledger.Conway.Specification.Test.StructuredContracts.html#187" class="Bound">txs</a> <a id="486" href="Ledger.Conway.Specification.Test.StructuredContracts.html#250" class="Bound">abs</a>
<a id="490" class="Keyword">open</a> <a id="495" class="Keyword">import</a> <a id="502" href="Ledger.Conway.Specification.Transaction.html" class="Module">Ledger.Conway.Specification.Transaction</a> <a id="542" href="Ledger.Conway.Specification.Test.StructuredContracts.html#187" class="Bound">txs</a> <a id="546" href="Ledger.Conway.Specification.Test.StructuredContracts.html#250" class="Bound">abs</a>

<a id="551" class="Keyword">open</a> <a id="556" class="Keyword">import</a> <a id="563" href="Ledger.Core.Specification.TokenAlgebra.Base.html" class="Module">Ledger.Core.Specification.TokenAlgebra.Base</a>
<a id="607" class="Keyword">open</a> <a id="612" class="Keyword">import</a> <a id="619" href="Ledger.Core.Specification.TokenAlgebra.ValueSet.html" class="Module">Ledger.Core.Specification.TokenAlgebra.ValueSet</a>

<a id="668" class="Keyword">open</a> <a id="673" href="Function.Bundles.html#4750" class="Module">Equivalence</a>


<a id="SSRel"></a><a id="687" href="Ledger.Conway.Specification.Test.StructuredContracts.html#687" class="Function">SSRel</a> <a id="693" class="Symbol">:</a> <a id="695" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="700" class="Symbol">→</a> <a id="702" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="707" class="Symbol">→</a> <a id="709" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="714" class="Symbol">→</a> <a id="716" href="Agda.Primitive.html#388" class="Primitive">Type₁</a>
<a id="722" href="Ledger.Conway.Specification.Test.StructuredContracts.html#687" class="Function">SSRel</a> <a id="728" href="Ledger.Conway.Specification.Test.StructuredContracts.html#728" class="Bound">Env</a> <a id="732" href="Ledger.Conway.Specification.Test.StructuredContracts.html#732" class="Bound">State</a> <a id="738" href="Ledger.Conway.Specification.Test.StructuredContracts.html#738" class="Bound">Input</a> <a id="744" class="Symbol">=</a> <a id="746" href="Ledger.Conway.Specification.Test.StructuredContracts.html#728" class="Bound">Env</a> <a id="750" class="Symbol">→</a> <a id="752" href="Ledger.Conway.Specification.Test.StructuredContracts.html#732" class="Bound">State</a> <a id="758" class="Symbol">→</a> <a id="760" href="Ledger.Conway.Specification.Test.StructuredContracts.html#738" class="Bound">Input</a> <a id="766" class="Symbol">→</a> <a id="768" href="Ledger.Conway.Specification.Test.StructuredContracts.html#732" class="Bound">State</a> <a id="774" class="Symbol">→</a> <a id="776" href="Agda.Primitive.html#388" class="Primitive">Type</a>

<a id="782" class="Keyword">record</a> <a id="StrucSimulation"></a><a id="789" href="Ledger.Conway.Specification.Test.StructuredContracts.html#789" class="Record">StrucSimulation</a> <a id="805" href="Ledger.Conway.Specification.Test.StructuredContracts.html#805" class="Bound">S</a> <a id="807" href="Ledger.Conway.Specification.Test.StructuredContracts.html#807" class="Bound">I</a> <a id="809" class="Symbol">(</a><a id="810" href="Ledger.Conway.Specification.Test.StructuredContracts.html#810" class="Bound Operator">_⊢_⇀⦇_,STRUC⦈_</a> <a id="825" class="Symbol">:</a> <a id="827" href="Ledger.Conway.Specification.Test.StructuredContracts.html#687" class="Function">SSRel</a> <a id="833" href="Agda.Builtin.Unit.html#175" class="Record">⊤</a> <a id="835" href="Ledger.Conway.Specification.Test.StructuredContracts.html#805" class="Bound">S</a> <a id="837" href="Ledger.Conway.Specification.Test.StructuredContracts.html#807" class="Bound">I</a><a id="838" class="Symbol">)</a> <a id="840" class="Symbol">:</a> <a id="842" href="Agda.Primitive.html#388" class="Primitive">Type₁</a> <a id="848" class="Keyword">where</a>
  <a id="856" class="Keyword">field</a>
    <a id="StrucSimulation.πˢ"></a><a id="866" href="Ledger.Conway.Specification.Test.StructuredContracts.html#866" class="Field">πˢ</a> <a id="869" class="Symbol">:</a> <a id="871" href="Ledger.Conway.Specification.Ledger.html#997" class="Record">LState</a> <a id="878" class="Symbol">→</a> <a id="880" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="886" href="Ledger.Conway.Specification.Test.StructuredContracts.html#805" class="Bound">S</a>
    <a id="StrucSimulation.πⁱ"></a><a id="892" href="Ledger.Conway.Specification.Test.StructuredContracts.html#892" class="Field">πⁱ</a> <a id="895" class="Symbol">:</a> <a id="897" href="Ledger.Conway.Specification.Script.Validation.html#1881" class="Record">TxInfo</a> <a id="904" class="Symbol">→</a> <a id="906" href="Ledger.Conway.Specification.Test.StructuredContracts.html#807" class="Bound">I</a>
    <a id="912" class="Comment">-- here, add optional extra assumptions about ledger state, env, and</a>
    <a id="985" class="Comment">-- transaction that may be too difficult to prove without reasoning about</a>
    <a id="1063" class="Comment">-- complete ledger traces; e.g.,</a>
    <a id="1100" class="Comment">-- * transaction does not re-add a UTxO entry it spends;</a>
    <a id="1161" class="Comment">-- * current Slot is after the validity interval of some previous transaction</a>
    <a id="StrucSimulation.extraAssmp"></a><a id="1243" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1243" class="Field">extraAssmp</a> <a id="1254" class="Symbol">:</a> <a id="1256" href="Ledger.Conway.Specification.Ledger.html#731" class="Record">LEnv</a> <a id="1261" class="Symbol">→</a> <a id="1263" href="Ledger.Conway.Specification.Ledger.html#997" class="Record">LState</a> <a id="1270" class="Symbol">→</a> <a id="1272" href="Ledger.Conway.Specification.Transaction.html#1719" class="Record">Tx</a> <a id="1275" class="Symbol">→</a> <a id="1277" href="Agda.Primitive.html#388" class="Primitive">Type</a>

  <a id="StrucSimulation._~ˢ_"></a><a id="1285" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1285" class="Function Operator">_~ˢ_</a> <a id="1290" class="Symbol">:</a> <a id="1292" href="Ledger.Conway.Specification.Ledger.html#997" class="Record">LState</a> <a id="1299" class="Symbol">→</a> <a id="1301" href="Ledger.Conway.Specification.Test.StructuredContracts.html#805" class="Bound">S</a> <a id="1303" class="Symbol">→</a> <a id="1305" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="1310" class="Comment">-- R</a>
  <a id="1317" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1317" class="Bound">u</a> <a id="1319" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1285" class="Function Operator">~ˢ</a> <a id="1322" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1322" class="Bound">s</a> <a id="1324" class="Symbol">=</a> <a id="1326" href="Ledger.Conway.Specification.Test.StructuredContracts.html#866" class="Field">πˢ</a> <a id="1329" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1317" class="Bound">u</a> <a id="1331" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="1333" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="1338" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1322" class="Bound">s</a>

  <a id="1343" class="Comment">-- only for PlutusV3</a>
  <a id="StrucSimulation._~ᵉ_"></a><a id="1366" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1366" class="Function Operator">_~ᵉ_</a> <a id="1371" class="Symbol">:</a> <a id="1373" href="Ledger.Conway.Specification.Ledger.html#731" class="Record">LEnv</a> <a id="1378" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="1380" href="Ledger.Conway.Specification.Transaction.html#1719" class="Record">Tx</a> <a id="1383" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="1385" href="Ledger.Conway.Specification.Ledger.html#997" class="Record">LState</a> <a id="1392" class="Symbol">→</a> <a id="1394" href="Agda.Builtin.Unit.html#175" class="Record">⊤</a> <a id="1396" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="1398" href="Ledger.Conway.Specification.Test.StructuredContracts.html#807" class="Bound">I</a> <a id="1400" class="Symbol">→</a> <a id="1402" href="Agda.Primitive.html#388" class="Primitive">Type</a>
  <a id="1409" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1366" class="Function Operator">_~ᵉ_</a> <a id="1414" class="Symbol">=</a> <a id="1416" class="Symbol">λ</a> <a id="1418" class="Symbol">(</a><a id="1419" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1419" class="Bound">le</a> <a id="1422" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1424" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1424" class="Bound">tx</a> <a id="1427" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1429" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1429" class="Bound">u</a><a id="1430" class="Symbol">)</a> <a id="1432" class="Symbol">(</a><a id="1433" href="Agda.Builtin.Unit.html#212" class="InductiveConstructor">tt</a> <a id="1436" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1438" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1438" class="Bound">i</a><a id="1439" class="Symbol">)</a> <a id="1441" class="Symbol">→</a> <a id="1443" href="Ledger.Conway.Specification.Test.StructuredContracts.html#892" class="Field">πⁱ</a> <a id="1446" class="Symbol">(</a><a id="1447" href="Ledger.Conway.Specification.Script.Validation.html#2250" class="Function">txInfo</a> <a id="1454" href="Ledger.Core.Specification.Script.Base.html#1057" class="Function">PlutusV3</a> <a id="1463" class="Symbol">(</a><a id="1464" href="Ledger.Conway.Specification.PParams.html#3542" class="Field">PParamsOf</a> <a id="1474" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1419" class="Bound">le</a><a id="1476" class="Symbol">)</a> <a id="1478" class="Symbol">(</a><a id="1479" href="Ledger.Core.Specification.Transaction.html#2830" class="Field">UTxOOf</a> <a id="1486" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1429" class="Bound">u</a><a id="1487" class="Symbol">)</a> <a id="1489" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1424" class="Bound">tx</a><a id="1491" class="Symbol">)</a> <a id="1493" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="1495" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1438" class="Bound">i</a>

  <a id="1500" class="Keyword">field</a>
    <a id="StrucSimulation.simulates"></a><a id="1510" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1510" class="Field">simulates</a> <a id="1520" class="Symbol">:</a> <a id="1522" class="Symbol">∀</a> <a id="1524" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1524" class="Bound">Γ</a> <a id="1526" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1526" class="Bound">s</a> <a id="1528" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1528" class="Bound">u</a> <a id="1530" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1530" class="Bound">tx</a> <a id="1533" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1533" class="Bound">i′</a> <a id="1536" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1536" class="Bound">u′</a> <a id="1539" class="Symbol">→</a> <a id="1541" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1243" class="Field">extraAssmp</a> <a id="1552" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1524" class="Bound">Γ</a> <a id="1554" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1528" class="Bound">u</a> <a id="1556" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1530" class="Bound">tx</a> <a id="1559" class="Symbol">→</a>
      <a id="1567" href="Prelude.InferenceRules.html#56075" class="Function Operator">∙</a> <a id="1569" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1524" class="Bound">Γ</a> <a id="1571" href="Ledger.Conway.Specification.Ledger.html#3842" class="Datatype Operator">⊢</a> <a id="1573" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1528" class="Bound">u</a> <a id="1575" href="Ledger.Conway.Specification.Ledger.html#3842" class="Datatype Operator">⇀⦇</a> <a id="1578" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1530" class="Bound">tx</a> <a id="1581" href="Ledger.Conway.Specification.Ledger.html#3842" class="Datatype Operator">,LEDGER⦈</a> <a id="1590" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1536" class="Bound">u′</a>
      <a id="1599" href="Prelude.InferenceRules.html#56006" class="Function Operator">∙</a> <a id="1601" class="Symbol">(</a><a id="1602" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1524" class="Bound">Γ</a> <a id="1604" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1606" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1530" class="Bound">tx</a> <a id="1609" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1611" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1528" class="Bound">u</a><a id="1612" class="Symbol">)</a> <a id="1614" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1366" class="Function Operator">~ᵉ</a> <a id="1617" class="Symbol">(</a><a id="1618" href="Agda.Builtin.Unit.html#212" class="InductiveConstructor">tt</a> <a id="1621" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1623" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1533" class="Bound">i′</a><a id="1625" class="Symbol">)</a>
      <a id="1633" href="Prelude.InferenceRules.html#56006" class="Function Operator">∙</a> <a id="1635" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1528" class="Bound">u</a> <a id="1637" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1285" class="Function Operator">~ˢ</a> <a id="1640" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1526" class="Bound">s</a>
      <a id="1648" href="Prelude.InferenceRules.html#13694" class="Function Operator">────────────────────────────────</a>
        <a id="1689" href="Data.Product.Base.html#1371" class="Function">∃[</a> <a id="1692" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1692" class="Bound">s′</a> <a id="1695" href="Data.Product.Base.html#1371" class="Function">]</a> <a id="1697" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1536" class="Bound">u′</a> <a id="1700" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1285" class="Function Operator">~ˢ</a> <a id="1703" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1692" class="Bound">s′</a>
               <a id="1721" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="1723" href="Agda.Builtin.Unit.html#212" class="InductiveConstructor">tt</a> <a id="1726" href="Ledger.Conway.Specification.Test.StructuredContracts.html#810" class="Bound Operator">⊢</a> <a id="1728" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1526" class="Bound">s</a> <a id="1730" href="Ledger.Conway.Specification.Test.StructuredContracts.html#810" class="Bound Operator">⇀⦇</a> <a id="1733" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1533" class="Bound">i′</a> <a id="1736" href="Ledger.Conway.Specification.Test.StructuredContracts.html#810" class="Bound Operator">,STRUC⦈</a> <a id="1744" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1692" class="Bound">s′</a>

</pre></body></html>