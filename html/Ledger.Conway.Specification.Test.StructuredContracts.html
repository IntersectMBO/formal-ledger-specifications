<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>Ledger.Conway.Specification.Test.StructuredContracts</title><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.css"><link rel="stylesheet" href="Agda.css"><script src="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.js"></script><script src="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/contrib/auto-render.min.js"></script><script src="AgdaKaTeX.js" defer=""></script></head><body><pre class="Agda">
<a id="2" class="Symbol">{-#</a> <a id="6" class="Keyword">OPTIONS</a> <a id="14" class="Pragma">--safe</a> <a id="21" class="Symbol">#-}</a>

<a id="26" class="Keyword">open</a> <a id="31" class="Keyword">import</a> <a id="38" href="Algebra.html" class="Module">Algebra</a>
<a id="46" class="Keyword">open</a> <a id="51" class="Keyword">import</a> <a id="58" href="Data.Nat.Properties.html" class="Module">Data.Nat.Properties</a> <a id="78" class="Keyword">using</a> <a id="84" class="Symbol">(</a><a id="85" href="Data.Nat.Properties.html#17566" class="Function">+-0-monoid</a><a id="95" class="Symbol">)</a>

<a id="98" class="Keyword">open</a> <a id="103" class="Keyword">import</a> <a id="110" href="Ledger.Prelude.html" class="Module">Ledger.Prelude</a><a id="124" class="Symbol">;</a> <a id="126" class="Keyword">open</a> <a id="131" href="Function.Bundles.html#4750" class="Module">Equivalence</a>
<a id="143" class="Keyword">open</a> <a id="148" class="Keyword">import</a> <a id="155" href="Ledger.Conway.Specification.Transaction.html" class="Module">Ledger.Conway.Specification.Transaction</a>
<a id="195" class="Keyword">open</a> <a id="200" class="Keyword">import</a> <a id="207" href="Ledger.Conway.Specification.Abstract.html" class="Module">Ledger.Conway.Specification.Abstract</a>
<a id="244" class="Keyword">open</a> <a id="249" class="Keyword">import</a> <a id="256" href="Ledger.Core.Specification.TokenAlgebra.Base.html" class="Module">Ledger.Core.Specification.TokenAlgebra.Base</a>
<a id="300" class="Keyword">open</a> <a id="305" class="Keyword">import</a> <a id="312" href="Ledger.Core.Specification.TokenAlgebra.ValueSet.html" class="Module">Ledger.Core.Specification.TokenAlgebra.ValueSet</a>

<a id="361" class="Keyword">module</a> <a id="368" href="Ledger.Conway.Specification.Test.StructuredContracts.html" class="Module">Ledger.Conway.Specification.Test.StructuredContracts</a>
  <a id="423" class="Symbol">(</a><a id="424" href="Ledger.Conway.Specification.Test.StructuredContracts.html#424" class="Bound">txs</a> <a id="428" class="Symbol">:</a> <a id="430" class="Symbol">_)</a> <a id="433" class="Symbol">(</a><a id="434" class="Keyword">open</a> <a id="439" href="Ledger.Conway.Specification.Transaction.html#991" class="Module">TransactionStructure</a> <a id="460" href="Ledger.Conway.Specification.Test.StructuredContracts.html#424" class="Bound">txs</a><a id="463" class="Symbol">)</a>
  <a id="467" class="Symbol">(</a><a id="468" href="Ledger.Conway.Specification.Test.StructuredContracts.html#468" class="Bound">abs</a> <a id="472" class="Symbol">:</a> <a id="474" href="Ledger.Conway.Specification.Abstract.html#655" class="Record">AbstractFunctions</a> <a id="492" href="Ledger.Conway.Specification.Test.StructuredContracts.html#424" class="Bound">txs</a><a id="495" class="Symbol">)</a> <a id="497" class="Symbol">(</a><a id="498" class="Keyword">open</a> <a id="503" href="Ledger.Conway.Specification.Abstract.html#655" class="Module">AbstractFunctions</a> <a id="521" href="Ledger.Conway.Specification.Test.StructuredContracts.html#468" class="Bound">abs</a><a id="524" class="Symbol">)</a>
  <a id="528" class="Keyword">where</a>

<a id="535" class="Keyword">open</a> <a id="540" class="Keyword">import</a> <a id="547" href="Ledger.Conway.Specification.Ledger.html" class="Module">Ledger.Conway.Specification.Ledger</a> <a id="582" href="Ledger.Conway.Specification.Test.StructuredContracts.html#424" class="Bound">txs</a> <a id="586" href="Ledger.Conway.Specification.Test.StructuredContracts.html#468" class="Bound">abs</a>
<a id="590" class="Keyword">open</a> <a id="595" class="Keyword">import</a> <a id="602" href="Ledger.Conway.Specification.Script.Validation.html" class="Module">Ledger.Conway.Specification.Script.Validation</a> <a id="648" href="Ledger.Conway.Specification.Test.StructuredContracts.html#424" class="Bound">txs</a> <a id="652" href="Ledger.Conway.Specification.Test.StructuredContracts.html#468" class="Bound">abs</a>
<a id="656" class="Keyword">open</a> <a id="661" class="Keyword">import</a> <a id="668" href="Ledger.Conway.Specification.Utxo.html" class="Module">Ledger.Conway.Specification.Utxo</a> <a id="701" href="Ledger.Conway.Specification.Test.StructuredContracts.html#424" class="Bound">txs</a> <a id="705" href="Ledger.Conway.Specification.Test.StructuredContracts.html#468" class="Bound">abs</a>


<a id="SSRel"></a><a id="711" href="Ledger.Conway.Specification.Test.StructuredContracts.html#711" class="Function">SSRel</a> <a id="717" class="Symbol">:</a> <a id="719" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="724" class="Symbol">→</a> <a id="726" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="731" class="Symbol">→</a> <a id="733" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="738" class="Symbol">→</a> <a id="740" href="Agda.Primitive.html#388" class="Primitive">Type₁</a>
<a id="746" href="Ledger.Conway.Specification.Test.StructuredContracts.html#711" class="Function">SSRel</a> <a id="752" href="Ledger.Conway.Specification.Test.StructuredContracts.html#752" class="Bound">Env</a> <a id="756" href="Ledger.Conway.Specification.Test.StructuredContracts.html#756" class="Bound">State</a> <a id="762" href="Ledger.Conway.Specification.Test.StructuredContracts.html#762" class="Bound">Input</a> <a id="768" class="Symbol">=</a> <a id="770" href="Ledger.Conway.Specification.Test.StructuredContracts.html#752" class="Bound">Env</a> <a id="774" class="Symbol">→</a> <a id="776" href="Ledger.Conway.Specification.Test.StructuredContracts.html#756" class="Bound">State</a> <a id="782" class="Symbol">→</a> <a id="784" href="Ledger.Conway.Specification.Test.StructuredContracts.html#762" class="Bound">Input</a> <a id="790" class="Symbol">→</a> <a id="792" href="Ledger.Conway.Specification.Test.StructuredContracts.html#756" class="Bound">State</a> <a id="798" class="Symbol">→</a> <a id="800" href="Agda.Primitive.html#388" class="Primitive">Type</a>

<a id="806" class="Keyword">record</a> <a id="StrucSimulation"></a><a id="813" href="Ledger.Conway.Specification.Test.StructuredContracts.html#813" class="Record">StrucSimulation</a> <a id="829" href="Ledger.Conway.Specification.Test.StructuredContracts.html#829" class="Bound">S</a> <a id="831" href="Ledger.Conway.Specification.Test.StructuredContracts.html#831" class="Bound">I</a> <a id="833" class="Symbol">(</a><a id="834" href="Ledger.Conway.Specification.Test.StructuredContracts.html#834" class="Bound Operator">_⊢_⇀⦇_,STRUC⦈_</a> <a id="849" class="Symbol">:</a> <a id="851" href="Ledger.Conway.Specification.Test.StructuredContracts.html#711" class="Function">SSRel</a> <a id="857" href="Agda.Builtin.Unit.html#175" class="Record">⊤</a> <a id="859" href="Ledger.Conway.Specification.Test.StructuredContracts.html#829" class="Bound">S</a> <a id="861" href="Ledger.Conway.Specification.Test.StructuredContracts.html#831" class="Bound">I</a><a id="862" class="Symbol">)</a> <a id="864" class="Symbol">:</a> <a id="866" href="Agda.Primitive.html#388" class="Primitive">Type₁</a> <a id="872" class="Keyword">where</a>
  <a id="880" class="Keyword">field</a>
    <a id="StrucSimulation.πˢ"></a><a id="890" href="Ledger.Conway.Specification.Test.StructuredContracts.html#890" class="Field">πˢ</a> <a id="893" class="Symbol">:</a> <a id="895" href="Ledger.Conway.Specification.Ledger.html#979" class="Record">LState</a> <a id="902" class="Symbol">→</a> <a id="904" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="910" href="Ledger.Conway.Specification.Test.StructuredContracts.html#829" class="Bound">S</a>
    <a id="StrucSimulation.πⁱ"></a><a id="916" href="Ledger.Conway.Specification.Test.StructuredContracts.html#916" class="Field">πⁱ</a> <a id="919" class="Symbol">:</a> <a id="921" href="Ledger.Conway.Specification.Script.Validation.html#1809" class="Record">TxInfo</a> <a id="928" class="Symbol">→</a> <a id="930" href="Ledger.Conway.Specification.Test.StructuredContracts.html#831" class="Bound">I</a>
    <a id="936" class="Comment">-- here, add optional extra assumptions about ledger state, env, and</a>
    <a id="1009" class="Comment">-- transaction that may be too difficult to prove without reasoning about</a>
    <a id="1087" class="Comment">-- complete ledger traces; e.g.,</a>
    <a id="1124" class="Comment">-- * transaction does not re-add a UTxO entry it spends;</a>
    <a id="1185" class="Comment">-- * current Slot is after the validity interval of some previous transaction</a>
    <a id="StrucSimulation.extraAssmp"></a><a id="1267" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1267" class="Field">extraAssmp</a> <a id="1278" class="Symbol">:</a> <a id="1280" href="Ledger.Conway.Specification.Ledger.html#713" class="Record">LEnv</a> <a id="1285" class="Symbol">→</a> <a id="1287" href="Ledger.Conway.Specification.Ledger.html#979" class="Record">LState</a> <a id="1294" class="Symbol">→</a> <a id="1296" href="Ledger.Conway.Specification.Transaction.html#4668" class="Record">Tx</a> <a id="1299" class="Symbol">→</a> <a id="1301" href="Agda.Primitive.html#388" class="Primitive">Type</a>

  <a id="StrucSimulation._~ˢ_"></a><a id="1309" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1309" class="Function Operator">_~ˢ_</a> <a id="1314" class="Symbol">:</a> <a id="1316" href="Ledger.Conway.Specification.Ledger.html#979" class="Record">LState</a> <a id="1323" class="Symbol">→</a> <a id="1325" href="Ledger.Conway.Specification.Test.StructuredContracts.html#829" class="Bound">S</a> <a id="1327" class="Symbol">→</a> <a id="1329" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="1334" class="Comment">-- R</a>
  <a id="1341" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1341" class="Bound">u</a> <a id="1343" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1309" class="Function Operator">~ˢ</a> <a id="1346" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1346" class="Bound">s</a> <a id="1348" class="Symbol">=</a> <a id="1350" href="Ledger.Conway.Specification.Test.StructuredContracts.html#890" class="Field">πˢ</a> <a id="1353" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1341" class="Bound">u</a> <a id="1355" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="1357" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="1362" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1346" class="Bound">s</a>

  <a id="1367" class="Comment">-- only for PlutusV3</a>
  <a id="StrucSimulation._~ᵉ_"></a><a id="1390" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1390" class="Function Operator">_~ᵉ_</a> <a id="1395" class="Symbol">:</a> <a id="1397" href="Ledger.Conway.Specification.Ledger.html#713" class="Record">LEnv</a> <a id="1402" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="1404" href="Ledger.Conway.Specification.Transaction.html#4668" class="Record">Tx</a> <a id="1407" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="1409" href="Ledger.Conway.Specification.Ledger.html#979" class="Record">LState</a> <a id="1416" class="Symbol">→</a> <a id="1418" href="Agda.Builtin.Unit.html#175" class="Record">⊤</a> <a id="1420" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="1422" href="Ledger.Conway.Specification.Test.StructuredContracts.html#831" class="Bound">I</a> <a id="1424" class="Symbol">→</a> <a id="1426" href="Agda.Primitive.html#388" class="Primitive">Type</a>
  <a id="1433" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1390" class="Function Operator">_~ᵉ_</a> <a id="1438" class="Symbol">=</a> <a id="1440" class="Symbol">λ</a> <a id="1442" class="Symbol">(</a><a id="1443" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1443" class="Bound">le</a> <a id="1446" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1448" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1448" class="Bound">tx</a> <a id="1451" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1453" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1453" class="Bound">u</a><a id="1454" class="Symbol">)</a> <a id="1456" class="Symbol">(</a><a id="1457" href="Agda.Builtin.Unit.html#212" class="InductiveConstructor">tt</a> <a id="1460" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1462" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1462" class="Bound">i</a><a id="1463" class="Symbol">)</a> <a id="1465" class="Symbol">→</a> <a id="1467" href="Ledger.Conway.Specification.Test.StructuredContracts.html#916" class="Field">πⁱ</a> <a id="1470" class="Symbol">(</a><a id="1471" href="Ledger.Conway.Specification.Script.Validation.html#2178" class="Function">txInfo</a> <a id="1478" href="Ledger.Core.Specification.Script.Base.html#1057" class="Function">PlutusV3</a> <a id="1487" class="Symbol">(</a><a id="1488" href="Ledger.Conway.Specification.PParams.html#3542" class="Field">PParamsOf</a> <a id="1498" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1443" class="Bound">le</a><a id="1500" class="Symbol">)</a> <a id="1502" class="Symbol">(</a><a id="1503" href="Ledger.Conway.Specification.Transaction.html#2925" class="Field">UTxOOf</a> <a id="1510" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1453" class="Bound">u</a><a id="1511" class="Symbol">)</a> <a id="1513" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1448" class="Bound">tx</a><a id="1515" class="Symbol">)</a> <a id="1517" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="1519" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1462" class="Bound">i</a>

  <a id="1524" class="Keyword">field</a>
    <a id="StrucSimulation.simulates"></a><a id="1534" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1534" class="Field">simulates</a> <a id="1544" class="Symbol">:</a> <a id="1546" class="Symbol">∀</a> <a id="1548" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1548" class="Bound">Γ</a> <a id="1550" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1550" class="Bound">s</a> <a id="1552" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1552" class="Bound">u</a> <a id="1554" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1554" class="Bound">tx</a> <a id="1557" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1557" class="Bound">i′</a> <a id="1560" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1560" class="Bound">u′</a> <a id="1563" class="Symbol">→</a> <a id="1565" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1267" class="Field">extraAssmp</a> <a id="1576" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1548" class="Bound">Γ</a> <a id="1578" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1552" class="Bound">u</a> <a id="1580" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1554" class="Bound">tx</a> <a id="1583" class="Symbol">→</a>
      <a id="1591" href="Prelude.InferenceRules.html#56075" class="Function Operator">∙</a> <a id="1593" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1548" class="Bound">Γ</a> <a id="1595" href="Ledger.Conway.Specification.Ledger.html#3824" class="Datatype Operator">⊢</a> <a id="1597" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1552" class="Bound">u</a> <a id="1599" href="Ledger.Conway.Specification.Ledger.html#3824" class="Datatype Operator">⇀⦇</a> <a id="1602" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1554" class="Bound">tx</a> <a id="1605" href="Ledger.Conway.Specification.Ledger.html#3824" class="Datatype Operator">,LEDGER⦈</a> <a id="1614" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1560" class="Bound">u′</a>
      <a id="1623" href="Prelude.InferenceRules.html#56006" class="Function Operator">∙</a> <a id="1625" class="Symbol">(</a><a id="1626" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1548" class="Bound">Γ</a> <a id="1628" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1630" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1554" class="Bound">tx</a> <a id="1633" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1635" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1552" class="Bound">u</a><a id="1636" class="Symbol">)</a> <a id="1638" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1390" class="Function Operator">~ᵉ</a> <a id="1641" class="Symbol">(</a><a id="1642" href="Agda.Builtin.Unit.html#212" class="InductiveConstructor">tt</a> <a id="1645" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1647" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1557" class="Bound">i′</a><a id="1649" class="Symbol">)</a>
      <a id="1657" href="Prelude.InferenceRules.html#56006" class="Function Operator">∙</a> <a id="1659" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1552" class="Bound">u</a> <a id="1661" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1309" class="Function Operator">~ˢ</a> <a id="1664" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1550" class="Bound">s</a>
      <a id="1672" href="Prelude.InferenceRules.html#13694" class="Function Operator">────────────────────────────────</a>
        <a id="1713" href="Data.Product.Base.html#1371" class="Function">∃[</a> <a id="1716" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1716" class="Bound">s′</a> <a id="1719" href="Data.Product.Base.html#1371" class="Function">]</a> <a id="1721" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1560" class="Bound">u′</a> <a id="1724" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1309" class="Function Operator">~ˢ</a> <a id="1727" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1716" class="Bound">s′</a>
               <a id="1745" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="1747" href="Agda.Builtin.Unit.html#212" class="InductiveConstructor">tt</a> <a id="1750" href="Ledger.Conway.Specification.Test.StructuredContracts.html#834" class="Bound Operator">⊢</a> <a id="1752" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1550" class="Bound">s</a> <a id="1754" href="Ledger.Conway.Specification.Test.StructuredContracts.html#834" class="Bound Operator">⇀⦇</a> <a id="1757" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1557" class="Bound">i′</a> <a id="1760" href="Ledger.Conway.Specification.Test.StructuredContracts.html#834" class="Bound Operator">,STRUC⦈</a> <a id="1768" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1716" class="Bound">s′</a>

</pre></body></html>