<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>Ledger.Conway.Specification.Test.StructuredContracts</title><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.css"><link rel="stylesheet" href="Agda.css"><script src="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.js"></script><script src="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/contrib/auto-render.min.js"></script><script src="AgdaKaTeX.js" defer=""></script></head><body><pre class="Agda">
<a id="2" class="Symbol">{-#</a> <a id="6" class="Keyword">OPTIONS</a> <a id="14" class="Pragma">--safe</a> <a id="21" class="Symbol">#-}</a>

<a id="26" class="Keyword">open</a> <a id="31" class="Keyword">import</a> <a id="38" href="Algebra.html" class="Module">Algebra</a>
<a id="46" class="Keyword">open</a> <a id="51" class="Keyword">import</a> <a id="58" href="Data.Nat.Properties.html" class="Module">Data.Nat.Properties</a> <a id="78" class="Keyword">using</a> <a id="84" class="Symbol">(</a><a id="85" href="Data.Nat.Properties.html#17252" class="Function">+-0-monoid</a><a id="95" class="Symbol">)</a>

<a id="98" class="Keyword">open</a> <a id="103" class="Keyword">import</a> <a id="110" href="Ledger.Prelude.html" class="Module">Ledger.Prelude</a><a id="124" class="Symbol">;</a> <a id="126" class="Keyword">open</a> <a id="131" href="Function.Bundles.html#4752" class="Module">Equivalence</a>
<a id="143" class="Keyword">open</a> <a id="148" class="Keyword">import</a> <a id="155" href="Ledger.Conway.Specification.Transaction.html" class="Module">Ledger.Conway.Specification.Transaction</a>
<a id="195" class="Keyword">open</a> <a id="200" class="Keyword">import</a> <a id="207" href="Ledger.Conway.Specification.Abstract.html" class="Module">Ledger.Conway.Specification.Abstract</a>
<a id="244" class="Keyword">open</a> <a id="249" class="Keyword">import</a> <a id="256" href="Ledger.Conway.Specification.TokenAlgebra.Base.html" class="Module">Ledger.Conway.Specification.TokenAlgebra.Base</a>
<a id="302" class="Keyword">open</a> <a id="307" class="Keyword">import</a> <a id="314" href="Ledger.Conway.Specification.TokenAlgebra.ValueSet.html" class="Module">Ledger.Conway.Specification.TokenAlgebra.ValueSet</a>


<a id="366" class="Keyword">module</a> <a id="373" href="Ledger.Conway.Specification.Test.StructuredContracts.html" class="Module">Ledger.Conway.Specification.Test.StructuredContracts</a>
  <a id="428" class="Symbol">(</a><a id="429" href="Ledger.Conway.Specification.Test.StructuredContracts.html#429" class="Bound">txs</a> <a id="433" class="Symbol">:</a> <a id="435" class="Symbol">_)</a> <a id="438" class="Symbol">(</a><a id="439" class="Keyword">open</a> <a id="444" href="Ledger.Conway.Specification.Transaction.html#1000" class="Module">TransactionStructure</a> <a id="465" href="Ledger.Conway.Specification.Test.StructuredContracts.html#429" class="Bound">txs</a><a id="468" class="Symbol">)</a>
  <a id="472" class="Symbol">(</a><a id="473" href="Ledger.Conway.Specification.Test.StructuredContracts.html#473" class="Bound">abs</a> <a id="477" class="Symbol">:</a> <a id="479" href="Ledger.Conway.Specification.Abstract.html#641" class="Record">AbstractFunctions</a> <a id="497" href="Ledger.Conway.Specification.Test.StructuredContracts.html#429" class="Bound">txs</a><a id="500" class="Symbol">)</a> <a id="502" class="Symbol">(</a><a id="503" class="Keyword">open</a> <a id="508" href="Ledger.Conway.Specification.Abstract.html#641" class="Module">AbstractFunctions</a> <a id="526" href="Ledger.Conway.Specification.Test.StructuredContracts.html#473" class="Bound">abs</a><a id="529" class="Symbol">)</a>
  <a id="533" class="Keyword">where</a>

<a id="540" class="Keyword">open</a> <a id="545" class="Keyword">import</a> <a id="552" href="Ledger.Conway.Specification.Ledger.html" class="Module">Ledger.Conway.Specification.Ledger</a> <a id="587" href="Ledger.Conway.Specification.Test.StructuredContracts.html#429" class="Bound">txs</a> <a id="591" href="Ledger.Conway.Specification.Test.StructuredContracts.html#473" class="Bound">abs</a>
<a id="595" class="Keyword">open</a> <a id="600" class="Keyword">import</a> <a id="607" href="Ledger.Conway.Specification.Script.Validation.html" class="Module">Ledger.Conway.Specification.Script.Validation</a> <a id="653" href="Ledger.Conway.Specification.Test.StructuredContracts.html#429" class="Bound">txs</a> <a id="657" href="Ledger.Conway.Specification.Test.StructuredContracts.html#473" class="Bound">abs</a>
<a id="661" class="Keyword">open</a> <a id="666" class="Keyword">import</a> <a id="673" href="Ledger.Conway.Specification.Utxo.html" class="Module">Ledger.Conway.Specification.Utxo</a> <a id="706" href="Ledger.Conway.Specification.Test.StructuredContracts.html#429" class="Bound">txs</a> <a id="710" href="Ledger.Conway.Specification.Test.StructuredContracts.html#473" class="Bound">abs</a>


<a id="SSRel"></a><a id="716" href="Ledger.Conway.Specification.Test.StructuredContracts.html#716" class="Function">SSRel</a> <a id="722" class="Symbol">:</a> <a id="724" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="729" class="Symbol">→</a> <a id="731" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="736" class="Symbol">→</a> <a id="738" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="743" class="Symbol">→</a> <a id="745" href="Agda.Primitive.html#388" class="Primitive">Type₁</a>
<a id="751" href="Ledger.Conway.Specification.Test.StructuredContracts.html#716" class="Function">SSRel</a> <a id="757" href="Ledger.Conway.Specification.Test.StructuredContracts.html#757" class="Bound">Env</a> <a id="761" href="Ledger.Conway.Specification.Test.StructuredContracts.html#761" class="Bound">State</a> <a id="767" href="Ledger.Conway.Specification.Test.StructuredContracts.html#767" class="Bound">Input</a> <a id="773" class="Symbol">=</a> <a id="775" href="Ledger.Conway.Specification.Test.StructuredContracts.html#757" class="Bound">Env</a> <a id="779" class="Symbol">→</a> <a id="781" href="Ledger.Conway.Specification.Test.StructuredContracts.html#761" class="Bound">State</a> <a id="787" class="Symbol">→</a> <a id="789" href="Ledger.Conway.Specification.Test.StructuredContracts.html#767" class="Bound">Input</a> <a id="795" class="Symbol">→</a> <a id="797" href="Ledger.Conway.Specification.Test.StructuredContracts.html#761" class="Bound">State</a> <a id="803" class="Symbol">→</a> <a id="805" href="Agda.Primitive.html#388" class="Primitive">Type</a>

<a id="811" class="Keyword">record</a> <a id="StrucSimulation"></a><a id="818" href="Ledger.Conway.Specification.Test.StructuredContracts.html#818" class="Record">StrucSimulation</a> <a id="834" href="Ledger.Conway.Specification.Test.StructuredContracts.html#834" class="Bound">S</a> <a id="836" href="Ledger.Conway.Specification.Test.StructuredContracts.html#836" class="Bound">I</a> <a id="838" class="Symbol">(</a><a id="839" href="Ledger.Conway.Specification.Test.StructuredContracts.html#839" class="Bound Operator">_⊢_⇀⦇_,STRUC⦈_</a> <a id="854" class="Symbol">:</a> <a id="856" href="Ledger.Conway.Specification.Test.StructuredContracts.html#716" class="Function">SSRel</a> <a id="862" href="Agda.Builtin.Unit.html#175" class="Record">⊤</a> <a id="864" href="Ledger.Conway.Specification.Test.StructuredContracts.html#834" class="Bound">S</a> <a id="866" href="Ledger.Conway.Specification.Test.StructuredContracts.html#836" class="Bound">I</a><a id="867" class="Symbol">)</a> <a id="869" class="Symbol">:</a> <a id="871" href="Agda.Primitive.html#388" class="Primitive">Type₁</a> <a id="877" class="Keyword">where</a>
  <a id="885" class="Keyword">field</a>
    <a id="StrucSimulation.πˢ"></a><a id="895" href="Ledger.Conway.Specification.Test.StructuredContracts.html#895" class="Field">πˢ</a> <a id="898" class="Symbol">:</a> <a id="900" href="Ledger.Conway.Specification.Ledger.html#977" class="Record">LState</a> <a id="907" class="Symbol">→</a> <a id="909" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="915" href="Ledger.Conway.Specification.Test.StructuredContracts.html#834" class="Bound">S</a>
    <a id="StrucSimulation.πⁱ"></a><a id="921" href="Ledger.Conway.Specification.Test.StructuredContracts.html#921" class="Field">πⁱ</a> <a id="924" class="Symbol">:</a> <a id="926" href="Ledger.Conway.Specification.Script.Validation.html#1787" class="Record">TxInfo</a> <a id="933" class="Symbol">→</a> <a id="935" href="Ledger.Conway.Specification.Test.StructuredContracts.html#836" class="Bound">I</a>
    <a id="941" class="Comment">-- here, add optional extra assumptions about ledger state, env, and transaction that may be too difficult to prove without reasoning about complete ledger traces</a>
    <a id="1108" class="Comment">-- e.g. transaction does not re-add a UTxO entry it spends</a>
    <a id="1171" class="Comment">-- e.g. current Slot is after the validity interval of some previous transaction</a>
    <a id="StrucSimulation.extraAssmp"></a><a id="1256" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1256" class="Field">extraAssmp</a> <a id="1267" class="Symbol">:</a> <a id="1269" href="Ledger.Conway.Specification.Ledger.html#713" class="Record">LEnv</a> <a id="1274" class="Symbol">→</a> <a id="1276" href="Ledger.Conway.Specification.Ledger.html#977" class="Record">LState</a> <a id="1283" class="Symbol">→</a> <a id="1285" href="Ledger.Conway.Specification.Transaction.html#4500" class="Record">Tx</a> <a id="1288" class="Symbol">→</a> <a id="1290" href="Agda.Primitive.html#388" class="Primitive">Type</a> 

  <a id="StrucSimulation._~ˢ_"></a><a id="1299" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1299" class="Function Operator">_~ˢ_</a> <a id="1304" class="Symbol">:</a> <a id="1306" href="Ledger.Conway.Specification.Ledger.html#977" class="Record">LState</a> <a id="1313" class="Symbol">→</a> <a id="1315" href="Ledger.Conway.Specification.Test.StructuredContracts.html#834" class="Bound">S</a> <a id="1317" class="Symbol">→</a> <a id="1319" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="1324" class="Comment">-- R</a>
  <a id="1331" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1331" class="Bound">u</a> <a id="1333" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1299" class="Function Operator">~ˢ</a> <a id="1336" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1336" class="Bound">s</a> <a id="1338" class="Symbol">=</a> <a id="1340" href="Ledger.Conway.Specification.Test.StructuredContracts.html#895" class="Field">πˢ</a> <a id="1343" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1331" class="Bound">u</a> <a id="1345" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="1347" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="1352" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1336" class="Bound">s</a>

    <a id="1359" class="Comment">-- only for PlutusV3</a>
  <a id="StrucSimulation._~ᵉ_"></a><a id="1382" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1382" class="Function Operator">_~ᵉ_</a> <a id="1387" class="Symbol">:</a> <a id="1389" href="Ledger.Conway.Specification.Ledger.html#713" class="Record">LEnv</a> <a id="1394" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="1396" href="Ledger.Conway.Specification.Transaction.html#4500" class="Record">Tx</a> <a id="1399" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="1401" href="Ledger.Conway.Specification.Ledger.html#977" class="Record">LState</a> <a id="1408" class="Symbol">→</a> <a id="1410" href="Agda.Builtin.Unit.html#175" class="Record">⊤</a> <a id="1412" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="1414" href="Ledger.Conway.Specification.Test.StructuredContracts.html#836" class="Bound">I</a> <a id="1416" class="Symbol">→</a> <a id="1418" href="Agda.Primitive.html#388" class="Primitive">Type</a>
  <a id="1425" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1382" class="Function Operator">_~ᵉ_</a> <a id="1430" class="Symbol">=</a> <a id="1432" class="Symbol">λ</a> <a id="1434" class="Symbol">(</a><a id="1435" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1435" class="Bound">le</a> <a id="1438" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1440" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1440" class="Bound">tx</a> <a id="1443" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1445" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1445" class="Bound">u</a><a id="1446" class="Symbol">)</a> <a id="1448" class="Symbol">(</a><a id="1449" href="Agda.Builtin.Unit.html#212" class="InductiveConstructor">tt</a> <a id="1452" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1454" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1454" class="Bound">i</a><a id="1455" class="Symbol">)</a> <a id="1457" class="Symbol">→</a> <a id="1459" href="Ledger.Conway.Specification.Test.StructuredContracts.html#921" class="Field">πⁱ</a> <a id="1462" class="Symbol">(</a><a id="1463" href="Ledger.Conway.Specification.Script.Validation.html#2086" class="Function">txInfo</a> <a id="1470" href="Ledger.Conway.Specification.Script.Base.html#1058" class="Function">PlutusV3</a> <a id="1479" class="Symbol">(</a><a id="1480" href="Ledger.Conway.Specification.PParams.html#3583" class="Field">PParamsOf</a> <a id="1490" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1435" class="Bound">le</a><a id="1492" class="Symbol">)</a> <a id="1494" class="Symbol">(</a><a id="1495" href="Ledger.Conway.Specification.Transaction.html#2930" class="Field">UTxOOf</a> <a id="1502" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1445" class="Bound">u</a><a id="1503" class="Symbol">)</a> <a id="1505" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1440" class="Bound">tx</a><a id="1507" class="Symbol">)</a> <a id="1509" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="1511" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1454" class="Bound">i</a>

  <a id="1516" class="Keyword">field</a>
    <a id="StrucSimulation.simulates"></a><a id="1526" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1526" class="Field">simulates</a> <a id="1536" class="Symbol">:</a> <a id="1538" class="Symbol">∀</a> <a id="1540" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1540" class="Bound">Γ</a> <a id="1542" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1542" class="Bound">s</a> <a id="1544" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1544" class="Bound">u</a> <a id="1546" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1546" class="Bound">tx</a> <a id="1549" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1549" class="Bound">i′</a> <a id="1552" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1552" class="Bound">u′</a> <a id="1555" class="Symbol">→</a> <a id="1557" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1256" class="Field">extraAssmp</a> <a id="1568" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1540" class="Bound">Γ</a> <a id="1570" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1544" class="Bound">u</a> <a id="1572" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1546" class="Bound">tx</a> <a id="1575" class="Symbol">→</a>
      <a id="1583" href="Prelude.InferenceRules.html#56074" class="Function Operator">∙</a> <a id="1585" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1540" class="Bound">Γ</a> <a id="1587" href="Ledger.Conway.Specification.Ledger.html#2749" class="Datatype Operator">⊢</a> <a id="1589" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1544" class="Bound">u</a> <a id="1591" href="Ledger.Conway.Specification.Ledger.html#2749" class="Datatype Operator">⇀⦇</a> <a id="1594" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1546" class="Bound">tx</a> <a id="1597" href="Ledger.Conway.Specification.Ledger.html#2749" class="Datatype Operator">,LEDGER⦈</a> <a id="1606" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1552" class="Bound">u′</a>
      <a id="1615" href="iog-prelude.Prelude.InferenceRules.html#583" class="Function Operator">∙</a> <a id="1617" class="Symbol">(</a><a id="1618" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1540" class="Bound">Γ</a> <a id="1620" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1622" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1546" class="Bound">tx</a> <a id="1625" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1627" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1544" class="Bound">u</a><a id="1628" class="Symbol">)</a> <a id="1630" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1382" class="Function Operator">~ᵉ</a> <a id="1633" class="Symbol">(</a><a id="1634" href="Agda.Builtin.Unit.html#212" class="InductiveConstructor">tt</a> <a id="1637" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1639" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1549" class="Bound">i′</a><a id="1641" class="Symbol">)</a>
      <a id="1649" href="iog-prelude.Prelude.InferenceRules.html#583" class="Function Operator">∙</a> <a id="1651" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1544" class="Bound">u</a> <a id="1653" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1299" class="Function Operator">~ˢ</a> <a id="1656" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1542" class="Bound">s</a>
      <a id="1664" href="iog-prelude.Prelude.InferenceRules.html#217" class="Function Operator">────────────────────────────────</a>
        <a id="1705" href="Data.Product.Base.html#1371" class="Function">∃[</a> <a id="1708" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1708" class="Bound">s′</a> <a id="1711" href="Data.Product.Base.html#1371" class="Function">]</a> <a id="1713" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1552" class="Bound">u′</a> <a id="1716" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1299" class="Function Operator">~ˢ</a> <a id="1719" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1708" class="Bound">s′</a>
               <a id="1737" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="1739" href="Agda.Builtin.Unit.html#212" class="InductiveConstructor">tt</a> <a id="1742" href="Ledger.Conway.Specification.Test.StructuredContracts.html#839" class="Bound Operator">⊢</a> <a id="1744" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1542" class="Bound">s</a> <a id="1746" href="Ledger.Conway.Specification.Test.StructuredContracts.html#839" class="Bound Operator">⇀⦇</a> <a id="1749" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1549" class="Bound">i′</a> <a id="1752" href="Ledger.Conway.Specification.Test.StructuredContracts.html#839" class="Bound Operator">,STRUC⦈</a> <a id="1760" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1708" class="Bound">s′</a>

</pre></body></html>