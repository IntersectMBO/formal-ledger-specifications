<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>Ledger.Conway.Specification.Test.StructuredContracts</title><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.css"><link rel="stylesheet" href="Agda.css"><script src="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.js"></script><script src="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/contrib/auto-render.min.js"></script><script src="AgdaKaTeX.js" defer=""></script></head><body><pre class="Agda">
<a id="2" class="Symbol">{-#</a> <a id="6" class="Keyword">OPTIONS</a> <a id="14" class="Pragma">--safe</a> <a id="21" class="Symbol">#-}</a>

<a id="26" class="Keyword">open</a> <a id="31" class="Keyword">import</a> <a id="38" href="Algebra.html" class="Module">Algebra</a>
<a id="46" class="Keyword">open</a> <a id="51" class="Keyword">import</a> <a id="58" href="Data.Nat.Properties.html" class="Module">Data.Nat.Properties</a> <a id="78" class="Keyword">using</a> <a id="84" class="Symbol">(</a><a id="85" href="Data.Nat.Properties.html#17566" class="Function">+-0-monoid</a><a id="95" class="Symbol">)</a>

<a id="98" class="Keyword">open</a> <a id="103" class="Keyword">import</a> <a id="110" href="Ledger.Prelude.html" class="Module">Ledger.Prelude</a><a id="124" class="Symbol">;</a> <a id="126" class="Keyword">open</a> <a id="131" href="Function.Bundles.html#4750" class="Module">Equivalence</a>
<a id="143" class="Keyword">open</a> <a id="148" class="Keyword">import</a> <a id="155" href="Ledger.Conway.Specification.Transaction.html" class="Module">Ledger.Conway.Specification.Transaction</a>
<a id="195" class="Keyword">open</a> <a id="200" class="Keyword">import</a> <a id="207" href="Ledger.Conway.Specification.Abstract.html" class="Module">Ledger.Conway.Specification.Abstract</a>
<a id="244" class="Keyword">open</a> <a id="249" class="Keyword">import</a> <a id="256" href="Ledger.Conway.Specification.TokenAlgebra.Base.html" class="Module">Ledger.Conway.Specification.TokenAlgebra.Base</a>
<a id="302" class="Keyword">open</a> <a id="307" class="Keyword">import</a> <a id="314" href="Ledger.Conway.Specification.TokenAlgebra.ValueSet.html" class="Module">Ledger.Conway.Specification.TokenAlgebra.ValueSet</a>

<a id="365" class="Keyword">module</a> <a id="372" href="Ledger.Conway.Specification.Test.StructuredContracts.html" class="Module">Ledger.Conway.Specification.Test.StructuredContracts</a>
  <a id="427" class="Symbol">(</a><a id="428" href="Ledger.Conway.Specification.Test.StructuredContracts.html#428" class="Bound">txs</a> <a id="432" class="Symbol">:</a> <a id="434" class="Symbol">_)</a> <a id="437" class="Symbol">(</a><a id="438" class="Keyword">open</a> <a id="443" href="Ledger.Conway.Specification.Transaction.html#999" class="Module">TransactionStructure</a> <a id="464" href="Ledger.Conway.Specification.Test.StructuredContracts.html#428" class="Bound">txs</a><a id="467" class="Symbol">)</a>
  <a id="471" class="Symbol">(</a><a id="472" href="Ledger.Conway.Specification.Test.StructuredContracts.html#472" class="Bound">abs</a> <a id="476" class="Symbol">:</a> <a id="478" href="Ledger.Conway.Specification.Abstract.html#655" class="Record">AbstractFunctions</a> <a id="496" href="Ledger.Conway.Specification.Test.StructuredContracts.html#428" class="Bound">txs</a><a id="499" class="Symbol">)</a> <a id="501" class="Symbol">(</a><a id="502" class="Keyword">open</a> <a id="507" href="Ledger.Conway.Specification.Abstract.html#655" class="Module">AbstractFunctions</a> <a id="525" href="Ledger.Conway.Specification.Test.StructuredContracts.html#472" class="Bound">abs</a><a id="528" class="Symbol">)</a>
  <a id="532" class="Keyword">where</a>

<a id="539" class="Keyword">open</a> <a id="544" class="Keyword">import</a> <a id="551" href="Ledger.Conway.Specification.Ledger.html" class="Module">Ledger.Conway.Specification.Ledger</a> <a id="586" href="Ledger.Conway.Specification.Test.StructuredContracts.html#428" class="Bound">txs</a> <a id="590" href="Ledger.Conway.Specification.Test.StructuredContracts.html#472" class="Bound">abs</a>
<a id="594" class="Keyword">open</a> <a id="599" class="Keyword">import</a> <a id="606" href="Ledger.Conway.Specification.Script.Validation.html" class="Module">Ledger.Conway.Specification.Script.Validation</a> <a id="652" href="Ledger.Conway.Specification.Test.StructuredContracts.html#428" class="Bound">txs</a> <a id="656" href="Ledger.Conway.Specification.Test.StructuredContracts.html#472" class="Bound">abs</a>
<a id="660" class="Keyword">open</a> <a id="665" class="Keyword">import</a> <a id="672" href="Ledger.Conway.Specification.Utxo.html" class="Module">Ledger.Conway.Specification.Utxo</a> <a id="705" href="Ledger.Conway.Specification.Test.StructuredContracts.html#428" class="Bound">txs</a> <a id="709" href="Ledger.Conway.Specification.Test.StructuredContracts.html#472" class="Bound">abs</a>


<a id="SSRel"></a><a id="715" href="Ledger.Conway.Specification.Test.StructuredContracts.html#715" class="Function">SSRel</a> <a id="721" class="Symbol">:</a> <a id="723" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="728" class="Symbol">→</a> <a id="730" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="735" class="Symbol">→</a> <a id="737" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="742" class="Symbol">→</a> <a id="744" href="Agda.Primitive.html#388" class="Primitive">Type₁</a>
<a id="750" href="Ledger.Conway.Specification.Test.StructuredContracts.html#715" class="Function">SSRel</a> <a id="756" href="Ledger.Conway.Specification.Test.StructuredContracts.html#756" class="Bound">Env</a> <a id="760" href="Ledger.Conway.Specification.Test.StructuredContracts.html#760" class="Bound">State</a> <a id="766" href="Ledger.Conway.Specification.Test.StructuredContracts.html#766" class="Bound">Input</a> <a id="772" class="Symbol">=</a> <a id="774" href="Ledger.Conway.Specification.Test.StructuredContracts.html#756" class="Bound">Env</a> <a id="778" class="Symbol">→</a> <a id="780" href="Ledger.Conway.Specification.Test.StructuredContracts.html#760" class="Bound">State</a> <a id="786" class="Symbol">→</a> <a id="788" href="Ledger.Conway.Specification.Test.StructuredContracts.html#766" class="Bound">Input</a> <a id="794" class="Symbol">→</a> <a id="796" href="Ledger.Conway.Specification.Test.StructuredContracts.html#760" class="Bound">State</a> <a id="802" class="Symbol">→</a> <a id="804" href="Agda.Primitive.html#388" class="Primitive">Type</a>

<a id="810" class="Keyword">record</a> <a id="StrucSimulation"></a><a id="817" href="Ledger.Conway.Specification.Test.StructuredContracts.html#817" class="Record">StrucSimulation</a> <a id="833" href="Ledger.Conway.Specification.Test.StructuredContracts.html#833" class="Bound">S</a> <a id="835" href="Ledger.Conway.Specification.Test.StructuredContracts.html#835" class="Bound">I</a> <a id="837" class="Symbol">(</a><a id="838" href="Ledger.Conway.Specification.Test.StructuredContracts.html#838" class="Bound Operator">_⊢_⇀⦇_,STRUC⦈_</a> <a id="853" class="Symbol">:</a> <a id="855" href="Ledger.Conway.Specification.Test.StructuredContracts.html#715" class="Function">SSRel</a> <a id="861" href="Agda.Builtin.Unit.html#175" class="Record">⊤</a> <a id="863" href="Ledger.Conway.Specification.Test.StructuredContracts.html#833" class="Bound">S</a> <a id="865" href="Ledger.Conway.Specification.Test.StructuredContracts.html#835" class="Bound">I</a><a id="866" class="Symbol">)</a> <a id="868" class="Symbol">:</a> <a id="870" href="Agda.Primitive.html#388" class="Primitive">Type₁</a> <a id="876" class="Keyword">where</a>
  <a id="884" class="Keyword">field</a>
    <a id="StrucSimulation.πˢ"></a><a id="894" href="Ledger.Conway.Specification.Test.StructuredContracts.html#894" class="Field">πˢ</a> <a id="897" class="Symbol">:</a> <a id="899" href="Ledger.Conway.Specification.Ledger.html#979" class="Record">LState</a> <a id="906" class="Symbol">→</a> <a id="908" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="914" href="Ledger.Conway.Specification.Test.StructuredContracts.html#833" class="Bound">S</a>
    <a id="StrucSimulation.πⁱ"></a><a id="920" href="Ledger.Conway.Specification.Test.StructuredContracts.html#920" class="Field">πⁱ</a> <a id="923" class="Symbol">:</a> <a id="925" href="Ledger.Conway.Specification.Script.Validation.html#1809" class="Record">TxInfo</a> <a id="932" class="Symbol">→</a> <a id="934" href="Ledger.Conway.Specification.Test.StructuredContracts.html#835" class="Bound">I</a>
    <a id="940" class="Comment">-- here, add optional extra assumptions about ledger state, env, and</a>
    <a id="1013" class="Comment">-- transaction that may be too difficult to prove without reasoning about</a>
    <a id="1091" class="Comment">-- complete ledger traces; e.g.,</a>
    <a id="1128" class="Comment">-- * transaction does not re-add a UTxO entry it spends;</a>
    <a id="1189" class="Comment">-- * current Slot is after the validity interval of some previous transaction</a>
    <a id="StrucSimulation.extraAssmp"></a><a id="1271" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1271" class="Field">extraAssmp</a> <a id="1282" class="Symbol">:</a> <a id="1284" href="Ledger.Conway.Specification.Ledger.html#713" class="Record">LEnv</a> <a id="1289" class="Symbol">→</a> <a id="1291" href="Ledger.Conway.Specification.Ledger.html#979" class="Record">LState</a> <a id="1298" class="Symbol">→</a> <a id="1300" href="Ledger.Conway.Specification.Transaction.html#4682" class="Record">Tx</a> <a id="1303" class="Symbol">→</a> <a id="1305" href="Agda.Primitive.html#388" class="Primitive">Type</a>

  <a id="StrucSimulation._~ˢ_"></a><a id="1313" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1313" class="Function Operator">_~ˢ_</a> <a id="1318" class="Symbol">:</a> <a id="1320" href="Ledger.Conway.Specification.Ledger.html#979" class="Record">LState</a> <a id="1327" class="Symbol">→</a> <a id="1329" href="Ledger.Conway.Specification.Test.StructuredContracts.html#833" class="Bound">S</a> <a id="1331" class="Symbol">→</a> <a id="1333" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="1338" class="Comment">-- R</a>
  <a id="1345" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1345" class="Bound">u</a> <a id="1347" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1313" class="Function Operator">~ˢ</a> <a id="1350" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1350" class="Bound">s</a> <a id="1352" class="Symbol">=</a> <a id="1354" href="Ledger.Conway.Specification.Test.StructuredContracts.html#894" class="Field">πˢ</a> <a id="1357" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1345" class="Bound">u</a> <a id="1359" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="1361" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="1366" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1350" class="Bound">s</a>

  <a id="1371" class="Comment">-- only for PlutusV3</a>
  <a id="StrucSimulation._~ᵉ_"></a><a id="1394" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1394" class="Function Operator">_~ᵉ_</a> <a id="1399" class="Symbol">:</a> <a id="1401" href="Ledger.Conway.Specification.Ledger.html#713" class="Record">LEnv</a> <a id="1406" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="1408" href="Ledger.Conway.Specification.Transaction.html#4682" class="Record">Tx</a> <a id="1411" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="1413" href="Ledger.Conway.Specification.Ledger.html#979" class="Record">LState</a> <a id="1420" class="Symbol">→</a> <a id="1422" href="Agda.Builtin.Unit.html#175" class="Record">⊤</a> <a id="1424" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="1426" href="Ledger.Conway.Specification.Test.StructuredContracts.html#835" class="Bound">I</a> <a id="1428" class="Symbol">→</a> <a id="1430" href="Agda.Primitive.html#388" class="Primitive">Type</a>
  <a id="1437" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1394" class="Function Operator">_~ᵉ_</a> <a id="1442" class="Symbol">=</a> <a id="1444" class="Symbol">λ</a> <a id="1446" class="Symbol">(</a><a id="1447" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1447" class="Bound">le</a> <a id="1450" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1452" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1452" class="Bound">tx</a> <a id="1455" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1457" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1457" class="Bound">u</a><a id="1458" class="Symbol">)</a> <a id="1460" class="Symbol">(</a><a id="1461" href="Agda.Builtin.Unit.html#212" class="InductiveConstructor">tt</a> <a id="1464" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1466" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1466" class="Bound">i</a><a id="1467" class="Symbol">)</a> <a id="1469" class="Symbol">→</a> <a id="1471" href="Ledger.Conway.Specification.Test.StructuredContracts.html#920" class="Field">πⁱ</a> <a id="1474" class="Symbol">(</a><a id="1475" href="Ledger.Conway.Specification.Script.Validation.html#2178" class="Function">txInfo</a> <a id="1482" href="Ledger.Conway.Specification.Script.Base.html#1059" class="Function">PlutusV3</a> <a id="1491" class="Symbol">(</a><a id="1492" href="Ledger.Conway.Specification.PParams.html#3544" class="Field">PParamsOf</a> <a id="1502" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1447" class="Bound">le</a><a id="1504" class="Symbol">)</a> <a id="1506" class="Symbol">(</a><a id="1507" href="Ledger.Conway.Specification.Transaction.html#2939" class="Field">UTxOOf</a> <a id="1514" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1457" class="Bound">u</a><a id="1515" class="Symbol">)</a> <a id="1517" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1452" class="Bound">tx</a><a id="1519" class="Symbol">)</a> <a id="1521" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="1523" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1466" class="Bound">i</a>

  <a id="1528" class="Keyword">field</a>
    <a id="StrucSimulation.simulates"></a><a id="1538" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1538" class="Field">simulates</a> <a id="1548" class="Symbol">:</a> <a id="1550" class="Symbol">∀</a> <a id="1552" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1552" class="Bound">Γ</a> <a id="1554" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1554" class="Bound">s</a> <a id="1556" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1556" class="Bound">u</a> <a id="1558" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1558" class="Bound">tx</a> <a id="1561" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1561" class="Bound">i′</a> <a id="1564" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1564" class="Bound">u′</a> <a id="1567" class="Symbol">→</a> <a id="1569" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1271" class="Field">extraAssmp</a> <a id="1580" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1552" class="Bound">Γ</a> <a id="1582" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1556" class="Bound">u</a> <a id="1584" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1558" class="Bound">tx</a> <a id="1587" class="Symbol">→</a>
      <a id="1595" href="Prelude.InferenceRules.html#56075" class="Function Operator">∙</a> <a id="1597" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1552" class="Bound">Γ</a> <a id="1599" href="Ledger.Conway.Specification.Ledger.html#3824" class="Datatype Operator">⊢</a> <a id="1601" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1556" class="Bound">u</a> <a id="1603" href="Ledger.Conway.Specification.Ledger.html#3824" class="Datatype Operator">⇀⦇</a> <a id="1606" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1558" class="Bound">tx</a> <a id="1609" href="Ledger.Conway.Specification.Ledger.html#3824" class="Datatype Operator">,LEDGER⦈</a> <a id="1618" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1564" class="Bound">u′</a>
      <a id="1627" href="Prelude.InferenceRules.html#56006" class="Function Operator">∙</a> <a id="1629" class="Symbol">(</a><a id="1630" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1552" class="Bound">Γ</a> <a id="1632" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1634" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1558" class="Bound">tx</a> <a id="1637" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1639" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1556" class="Bound">u</a><a id="1640" class="Symbol">)</a> <a id="1642" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1394" class="Function Operator">~ᵉ</a> <a id="1645" class="Symbol">(</a><a id="1646" href="Agda.Builtin.Unit.html#212" class="InductiveConstructor">tt</a> <a id="1649" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1651" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1561" class="Bound">i′</a><a id="1653" class="Symbol">)</a>
      <a id="1661" href="Prelude.InferenceRules.html#56006" class="Function Operator">∙</a> <a id="1663" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1556" class="Bound">u</a> <a id="1665" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1313" class="Function Operator">~ˢ</a> <a id="1668" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1554" class="Bound">s</a>
      <a id="1676" href="Prelude.InferenceRules.html#13694" class="Function Operator">────────────────────────────────</a>
        <a id="1717" href="Data.Product.Base.html#1371" class="Function">∃[</a> <a id="1720" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1720" class="Bound">s′</a> <a id="1723" href="Data.Product.Base.html#1371" class="Function">]</a> <a id="1725" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1564" class="Bound">u′</a> <a id="1728" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1313" class="Function Operator">~ˢ</a> <a id="1731" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1720" class="Bound">s′</a>
               <a id="1749" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="1751" href="Agda.Builtin.Unit.html#212" class="InductiveConstructor">tt</a> <a id="1754" href="Ledger.Conway.Specification.Test.StructuredContracts.html#838" class="Bound Operator">⊢</a> <a id="1756" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1554" class="Bound">s</a> <a id="1758" href="Ledger.Conway.Specification.Test.StructuredContracts.html#838" class="Bound Operator">⇀⦇</a> <a id="1761" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1561" class="Bound">i′</a> <a id="1764" href="Ledger.Conway.Specification.Test.StructuredContracts.html#838" class="Bound Operator">,STRUC⦈</a> <a id="1772" href="Ledger.Conway.Specification.Test.StructuredContracts.html#1720" class="Bound">s′</a>

</pre></body></html>