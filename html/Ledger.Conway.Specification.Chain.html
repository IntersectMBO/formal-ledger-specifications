<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>Ledger.Conway.Specification.Chain</title><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.css"><link rel="stylesheet" href="Agda.css"><script src="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.js"></script><script src="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/contrib/auto-render.min.js"></script><script src="AgdaKaTeX.js" defer=""></script></head><body><pre class="Agda">
<a id="2" class="Symbol">{-#</a> <a id="6" class="Keyword">OPTIONS</a> <a id="14" class="Pragma">--safe</a> <a id="21" class="Symbol">#-}</a>

<a id="26" class="Keyword">open</a> <a id="31" class="Keyword">import</a> <a id="38" href="Ledger.Conway.Specification.Transaction.html" class="Module">Ledger.Conway.Specification.Transaction</a>
<a id="78" class="Keyword">open</a> <a id="83" class="Keyword">import</a> <a id="90" href="Ledger.Conway.Specification.Abstract.html" class="Module">Ledger.Conway.Specification.Abstract</a>

<a id="128" class="Keyword">module</a> <a id="135" href="Ledger.Conway.Specification.Chain.html" class="Module">Ledger.Conway.Specification.Chain</a>
  <a id="171" class="Symbol">(</a><a id="172" href="Ledger.Conway.Specification.Chain.html#172" class="Bound">txs</a> <a id="176" class="Symbol">:</a> <a id="178" class="Symbol">_)</a> <a id="181" class="Symbol">(</a><a id="182" class="Keyword">open</a> <a id="187" href="Ledger.Conway.Specification.Transaction.html#1000" class="Module">TransactionStructure</a> <a id="208" href="Ledger.Conway.Specification.Chain.html#172" class="Bound">txs</a><a id="211" class="Symbol">)</a>
  <a id="215" class="Symbol">(</a><a id="216" href="Ledger.Conway.Specification.Chain.html#216" class="Bound">abs</a> <a id="220" class="Symbol">:</a> <a id="222" href="Ledger.Conway.Specification.Abstract.html#641" class="Record">AbstractFunctions</a> <a id="240" href="Ledger.Conway.Specification.Chain.html#172" class="Bound">txs</a><a id="243" class="Symbol">)</a> <a id="245" class="Symbol">(</a><a id="246" class="Keyword">open</a> <a id="251" href="Ledger.Conway.Specification.Abstract.html#641" class="Module">AbstractFunctions</a> <a id="269" href="Ledger.Conway.Specification.Chain.html#216" class="Bound">abs</a><a id="272" class="Symbol">)</a>
  <a id="276" class="Keyword">where</a>

<a id="283" class="Keyword">open</a> <a id="288" class="Keyword">import</a> <a id="295" href="Ledger.Conway.Specification.Certs.html" class="Module">Ledger.Conway.Specification.Certs</a> <a id="329" href="Ledger.Conway.Specification.Transaction.html#2079" class="Function">govStructure</a>
<a id="342" class="Keyword">open</a> <a id="347" class="Keyword">import</a> <a id="354" href="Ledger.Conway.Specification.Enact.html" class="Module">Ledger.Conway.Specification.Enact</a> <a id="388" href="Ledger.Conway.Specification.Transaction.html#2079" class="Function">govStructure</a>
<a id="401" class="Keyword">open</a> <a id="406" class="Keyword">import</a> <a id="413" href="Ledger.Conway.Specification.Epoch.html" class="Module">Ledger.Conway.Specification.Epoch</a> <a id="447" href="Ledger.Conway.Specification.Chain.html#172" class="Bound">txs</a> <a id="451" href="Ledger.Conway.Specification.Chain.html#216" class="Bound">abs</a>
<a id="455" class="Keyword">open</a> <a id="460" class="Keyword">import</a> <a id="467" href="Ledger.Conway.Specification.Gov.html" class="Module">Ledger.Conway.Specification.Gov</a> <a id="499" href="Ledger.Conway.Specification.Chain.html#172" class="Bound">txs</a>
<a id="503" class="Keyword">open</a> <a id="508" class="Keyword">import</a> <a id="515" href="Ledger.Conway.Specification.Ledger.html" class="Module">Ledger.Conway.Specification.Ledger</a> <a id="550" href="Ledger.Conway.Specification.Chain.html#172" class="Bound">txs</a> <a id="554" href="Ledger.Conway.Specification.Chain.html#216" class="Bound">abs</a>
<a id="558" class="Keyword">open</a> <a id="563" class="Keyword">import</a> <a id="570" href="Ledger.Prelude.html" class="Module">Ledger.Prelude</a><a id="584" class="Symbol">;</a> <a id="586" class="Keyword">open</a> <a id="591" href="Function.Bundles.html#4752" class="Module">Equivalence</a>
<a id="603" class="Keyword">open</a> <a id="608" class="Keyword">import</a> <a id="615" href="Ledger.Conway.Specification.Ratify.html" class="Module">Ledger.Conway.Specification.Ratify</a> <a id="650" href="Ledger.Conway.Specification.Chain.html#172" class="Bound">txs</a>
<a id="654" class="Keyword">open</a> <a id="659" class="Keyword">import</a> <a id="666" href="Ledger.Conway.Specification.Utxo.html" class="Module">Ledger.Conway.Specification.Utxo</a> <a id="699" href="Ledger.Conway.Specification.Chain.html#172" class="Bound">txs</a> <a id="703" href="Ledger.Conway.Specification.Chain.html#216" class="Bound">abs</a>

<a id="708" class="Keyword">open</a> <a id="713" class="Keyword">import</a> <a id="720" href="Algebra.html" class="Module">Algebra</a>
<a id="728" class="Keyword">open</a> <a id="733" class="Keyword">import</a> <a id="740" href="Data.Nat.Properties.html" class="Module">Data.Nat.Properties</a> <a id="760" class="Keyword">using</a> <a id="766" class="Symbol">(</a><a id="767" href="Data.Nat.Properties.html#17252" class="Function">+-0-monoid</a><a id="777" class="Symbol">)</a>


<a id="781" class="Keyword">record</a> <a id="ChainState"></a><a id="788" href="Ledger.Conway.Specification.Chain.html#788" class="Record">ChainState</a> <a id="799" class="Symbol">:</a> <a id="801" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="806" class="Keyword">where</a>
  <a id="814" class="Keyword">field</a>
    <a id="ChainState.newEpochState"></a><a id="824" href="Ledger.Conway.Specification.Chain.html#824" class="Field">newEpochState</a>  <a id="839" class="Symbol">:</a> <a id="841" href="Ledger.Conway.Specification.Epoch.html#2618" class="Record">NewEpochState</a>

<a id="856" class="Keyword">record</a> <a id="Block"></a><a id="863" href="Ledger.Conway.Specification.Chain.html#863" class="Record">Block</a> <a id="869" class="Symbol">:</a> <a id="871" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="876" class="Keyword">where</a>
  <a id="884" class="Keyword">field</a>
    <a id="Block.ts"></a><a id="894" href="Ledger.Conway.Specification.Chain.html#894" class="Field">ts</a>    <a id="900" class="Symbol">:</a> <a id="902" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="907" href="Ledger.Conway.Specification.Transaction.html#4500" class="Record">Tx</a>
    <a id="Block.slot"></a><a id="914" href="Ledger.Conway.Specification.Chain.html#914" class="Field">slot</a>  <a id="920" class="Symbol">:</a> <a id="922" href="Ledger.Core.Specification.Epoch.html#674" class="Function">Slot</a>


<a id="929" class="Keyword">instance</a>
  <a id="HasNewEpochState-ChainState"></a><a id="940" href="Ledger.Conway.Specification.Chain.html#940" class="Function">HasNewEpochState-ChainState</a> <a id="968" class="Symbol">:</a> <a id="970" href="Ledger.Conway.Specification.Epoch.html#2752" class="Record">HasNewEpochState</a> <a id="987" href="Ledger.Conway.Specification.Chain.html#788" class="Record">ChainState</a>
  <a id="1000" href="Ledger.Conway.Specification.Chain.html#940" class="Function">HasNewEpochState-ChainState</a> <a id="1028" class="Symbol">.</a><a id="1029" href="Ledger.Conway.Specification.Epoch.html#2809" class="Field">NewEpochStateOf</a> <a id="1045" class="Symbol">=</a> <a id="1047" href="Ledger.Conway.Specification.Chain.html#824" class="Field">ChainState.newEpochState</a>

  <a id="HasLastEpoch-ChainState"></a><a id="1075" href="Ledger.Conway.Specification.Chain.html#1075" class="Function">HasLastEpoch-ChainState</a> <a id="1099" class="Symbol">:</a> <a id="1101" href="Ledger.Conway.Specification.Epoch.html#2887" class="Record">HasLastEpoch</a> <a id="1114" href="Ledger.Conway.Specification.Chain.html#788" class="Record">ChainState</a>
  <a id="1127" href="Ledger.Conway.Specification.Chain.html#1075" class="Function">HasLastEpoch-ChainState</a> <a id="1151" class="Symbol">.</a><a id="1152" href="Ledger.Conway.Specification.Epoch.html#2942" class="Field">LastEpochOf</a> <a id="1164" class="Symbol">=</a> <a id="1166" href="Ledger.Conway.Specification.Epoch.html#2942" class="Field">LastEpochOf</a> <a id="1178" href="Function.Base.html#1115" class="Function Operator">∘</a> <a id="1180" href="Ledger.Conway.Specification.Epoch.html#2809" class="Field">NewEpochStateOf</a>

  <a id="HasEpochState-ChainState"></a><a id="1199" href="Ledger.Conway.Specification.Chain.html#1199" class="Function">HasEpochState-ChainState</a> <a id="1224" class="Symbol">:</a> <a id="1226" href="Ledger.Conway.Specification.Epoch.html#1808" class="Record">HasEpochState</a> <a id="1240" href="Ledger.Conway.Specification.Chain.html#788" class="Record">ChainState</a> 
  <a id="1254" href="Ledger.Conway.Specification.Chain.html#1199" class="Function">HasEpochState-ChainState</a> <a id="1279" class="Symbol">.</a><a id="1280" href="Ledger.Conway.Specification.Epoch.html#1862" class="Field">EpochStateOf</a> <a id="1293" class="Symbol">=</a> <a id="1295" href="Ledger.Conway.Specification.Epoch.html#1862" class="Field">EpochStateOf</a> <a id="1308" href="Function.Base.html#1115" class="Function Operator">∘</a> <a id="1310" href="Ledger.Conway.Specification.Epoch.html#2809" class="Field">NewEpochStateOf</a>

  <a id="HasEnactState-ChainState"></a><a id="1329" href="Ledger.Conway.Specification.Chain.html#1329" class="Function">HasEnactState-ChainState</a> <a id="1354" class="Symbol">:</a> <a id="1356" href="Ledger.Conway.Specification.Enact.html#736" class="Record">HasEnactState</a> <a id="1370" href="Ledger.Conway.Specification.Chain.html#788" class="Record">ChainState</a> 
  <a id="1384" href="Ledger.Conway.Specification.Chain.html#1329" class="Function">HasEnactState-ChainState</a> <a id="1409" class="Symbol">.</a><a id="1410" href="Ledger.Conway.Specification.Enact.html#790" class="Field">EnactStateOf</a> <a id="1423" class="Symbol">=</a> <a id="1425" href="Ledger.Conway.Specification.Enact.html#790" class="Field">EnactStateOf</a> <a id="1438" href="Function.Base.html#1115" class="Function Operator">∘</a> <a id="1440" href="Ledger.Conway.Specification.Epoch.html#1862" class="Field">EpochStateOf</a>

  <a id="HasLState-ChainState"></a><a id="1456" href="Ledger.Conway.Specification.Chain.html#1456" class="Function">HasLState-ChainState</a> <a id="1477" class="Symbol">:</a> <a id="1479" href="Ledger.Conway.Specification.Ledger.html#1122" class="Record">HasLState</a> <a id="1489" href="Ledger.Conway.Specification.Chain.html#788" class="Record">ChainState</a>
  <a id="1502" href="Ledger.Conway.Specification.Chain.html#1456" class="Function">HasLState-ChainState</a> <a id="1523" class="Symbol">.</a><a id="1524" href="Ledger.Conway.Specification.Ledger.html#1172" class="Field">LStateOf</a> <a id="1533" class="Symbol">=</a> <a id="1535" href="Ledger.Conway.Specification.Ledger.html#1172" class="Field">LStateOf</a> <a id="1544" href="Function.Base.html#1115" class="Function Operator">∘</a> <a id="1546" href="Ledger.Conway.Specification.Epoch.html#1862" class="Field">EpochStateOf</a>

  <a id="HasUTxOState-ChainState"></a><a id="1562" href="Ledger.Conway.Specification.Chain.html#1562" class="Function">HasUTxOState-ChainState</a> <a id="1586" class="Symbol">:</a> <a id="1588" href="Ledger.Conway.Specification.Utxo.html#1636" class="Record">HasUTxOState</a> <a id="1601" href="Ledger.Conway.Specification.Chain.html#788" class="Record">ChainState</a>
  <a id="1614" href="Ledger.Conway.Specification.Chain.html#1562" class="Function">HasUTxOState-ChainState</a> <a id="1638" class="Symbol">.</a><a id="1639" href="Ledger.Conway.Specification.Utxo.html#1689" class="Field">UTxOStateOf</a> <a id="1651" class="Symbol">=</a> <a id="1653" href="Ledger.Conway.Specification.Utxo.html#1689" class="Field">UTxOStateOf</a> <a id="1665" href="Function.Base.html#1115" class="Function Operator">∘</a> <a id="1667" href="Ledger.Conway.Specification.Ledger.html#1172" class="Field">LStateOf</a>

  <a id="HasCertState-ChainState"></a><a id="1679" href="Ledger.Conway.Specification.Chain.html#1679" class="Function">HasCertState-ChainState</a> <a id="1703" class="Symbol">:</a> <a id="1705" href="Ledger.Conway.Specification.Certs.html#4472" class="Record">HasCertState</a> <a id="1718" href="Ledger.Conway.Specification.Chain.html#788" class="Record">ChainState</a>
  <a id="1731" href="Ledger.Conway.Specification.Chain.html#1679" class="Function">HasCertState-ChainState</a> <a id="1755" class="Symbol">.</a><a id="1756" href="Ledger.Conway.Specification.Certs.html#4525" class="Field">CertStateOf</a> <a id="1768" class="Symbol">=</a> <a id="1770" href="Ledger.Conway.Specification.Certs.html#4525" class="Field">CertStateOf</a> <a id="1782" href="Function.Base.html#1115" class="Function Operator">∘</a> <a id="1784" href="Ledger.Conway.Specification.Ledger.html#1172" class="Field">LStateOf</a>

  <a id="HasDeposits-ChainState"></a><a id="1796" href="Ledger.Conway.Specification.Chain.html#1796" class="Function">HasDeposits-ChainState</a> <a id="1819" class="Symbol">:</a> <a id="1821" href="Ledger.Conway.Specification.Certs.html#694" class="Record">HasDeposits</a> <a id="1833" href="Ledger.Conway.Specification.Chain.html#788" class="Record">ChainState</a>
  <a id="1846" href="Ledger.Conway.Specification.Chain.html#1796" class="Function">HasDeposits-ChainState</a> <a id="1869" class="Symbol">.</a><a id="1870" href="Ledger.Conway.Specification.Certs.html#746" class="Field">DepositsOf</a> <a id="1881" class="Symbol">=</a> <a id="1883" href="Ledger.Conway.Specification.Certs.html#746" class="Field">DepositsOf</a> <a id="1894" href="Function.Base.html#1115" class="Function Operator">∘</a> <a id="1896" href="Ledger.Conway.Specification.Utxo.html#1689" class="Field">UTxOStateOf</a>

  <a id="HasRewards-ChainState"></a><a id="1911" href="Ledger.Conway.Specification.Chain.html#1911" class="Function">HasRewards-ChainState</a> <a id="1933" class="Symbol">:</a> <a id="1935" href="Ledger.Conway.Specification.Certs.html#810" class="Record">HasRewards</a> <a id="1946" href="Ledger.Conway.Specification.Chain.html#788" class="Record">ChainState</a>
  <a id="1959" href="Ledger.Conway.Specification.Chain.html#1911" class="Function">HasRewards-ChainState</a> <a id="1981" class="Symbol">.</a><a id="1982" href="Ledger.Conway.Specification.Certs.html#861" class="Field">RewardsOf</a> <a id="1992" class="Symbol">=</a> <a id="1994" href="Ledger.Conway.Specification.Certs.html#861" class="Field">RewardsOf</a> <a id="2004" href="Function.Base.html#1115" class="Function Operator">∘</a> <a id="2006" href="Ledger.Conway.Specification.Certs.html#4525" class="Field">CertStateOf</a>

  <a id="HasPParams-ChainState"></a><a id="2021" href="Ledger.Conway.Specification.Chain.html#2021" class="Function">HasPParams-ChainState</a> <a id="2043" class="Symbol">:</a> <a id="2045" href="Ledger.Conway.Specification.PParams.html#3532" class="Record">HasPParams</a> <a id="2056" href="Ledger.Conway.Specification.Chain.html#788" class="Record">ChainState</a>
  <a id="2069" href="Ledger.Conway.Specification.Chain.html#2021" class="Function">HasPParams-ChainState</a> <a id="2091" class="Symbol">.</a><a id="2092" href="Ledger.Conway.Specification.PParams.html#3583" class="Field">PParamsOf</a> <a id="2102" class="Symbol">=</a> <a id="2104" href="Ledger.Conway.Specification.PParams.html#3583" class="Field">PParamsOf</a> <a id="2114" href="Function.Base.html#1115" class="Function Operator">∘</a> <a id="2116" href="Ledger.Conway.Specification.Enact.html#790" class="Field">EnactStateOf</a>

<a id="2130" class="Keyword">instance</a> <a id="2139" href="Ledger.Conway.Specification.Chain.html#2139" class="Function">_</a> <a id="2141" class="Symbol">=</a> <a id="2143" href="Data.Nat.Properties.html#17252" class="Function">+-0-monoid</a>

<a id="2155" class="Comment">-- TODO: do we still need this for anything?</a>
<a id="maybePurpose"></a><a id="2200" href="Ledger.Conway.Specification.Chain.html#2200" class="Function">maybePurpose</a> <a id="2213" class="Symbol">:</a> <a id="2215" href="Ledger.Conway.Specification.Certs.html#349" class="Datatype">DepositPurpose</a> <a id="2230" class="Symbol">→</a> <a id="2232" class="Symbol">(</a><a id="2233" href="Ledger.Conway.Specification.Certs.html#349" class="Datatype">DepositPurpose</a> <a id="2248" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="2250" href="Ledger.Core.Specification.Address.html#260" class="Datatype">Credential</a><a id="2260" class="Symbol">)</a> <a id="2262" class="Symbol">→</a> <a id="2264" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a> <a id="2269" class="Symbol">→</a> <a id="2271" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="2277" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a>
<a id="2282" href="Ledger.Conway.Specification.Chain.html#2200" class="Function">maybePurpose</a> <a id="2295" href="Ledger.Conway.Specification.Chain.html#2295" class="Bound">prps</a> <a id="2300" class="Symbol">(</a><a id="2301" href="Ledger.Conway.Specification.Chain.html#2301" class="Bound">prps&#39;</a> <a id="2307" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="2309" class="Symbol">_)</a> <a id="2312" href="Ledger.Conway.Specification.Chain.html#2312" class="Bound">c</a> <a id="2314" class="Keyword">with</a> <a id="2319" href="Ledger.Conway.Specification.Chain.html#2295" class="Bound">prps</a> <a id="2324" href="Class.DecEq.Core.html#159" class="Field Operator">≟</a> <a id="2326" href="Ledger.Conway.Specification.Chain.html#2301" class="Bound">prps&#39;</a>
<a id="2332" class="Symbol">...</a> <a id="2336" class="Symbol">|</a> <a id="2338" href="Relation.Nullary.Decidable.Core.html#1994" class="InductiveConstructor">yes</a> <a id="2342" class="Symbol">_</a> <a id="2344" class="Symbol">=</a> <a id="2346" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="2351" class="Bound">c</a>
<a id="2353" class="Symbol">...</a> <a id="2357" class="Symbol">|</a> <a id="2359" href="Relation.Nullary.Decidable.Core.html#2031" class="InductiveConstructor">no</a> <a id="2362" class="Symbol">_</a> <a id="2364" class="Symbol">=</a> <a id="2366" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a>

<a id="maybePurpose-prop"></a><a id="2375" href="Ledger.Conway.Specification.Chain.html#2375" class="Function">maybePurpose-prop</a> <a id="2393" class="Symbol">:</a> <a id="2395" class="Symbol">∀</a> <a id="2397" class="Symbol">{</a><a id="2398" href="Ledger.Conway.Specification.Chain.html#2398" class="Bound">prps</a><a id="2402" class="Symbol">}</a> <a id="2404" class="Symbol">{</a><a id="2405" href="Ledger.Conway.Specification.Chain.html#2405" class="Bound">x</a><a id="2406" class="Symbol">}</a> <a id="2408" class="Symbol">{</a><a id="2409" href="Ledger.Conway.Specification.Chain.html#2409" class="Bound">y</a><a id="2410" class="Symbol">}</a>
  <a id="2414" class="Symbol">→</a> <a id="2416" class="Symbol">(</a><a id="2417" href="Ledger.Conway.Specification.Chain.html#2417" class="Bound">m</a> <a id="2419" class="Symbol">:</a> <a id="2421" class="Symbol">(</a><a id="2422" href="Ledger.Conway.Specification.Certs.html#349" class="Datatype">DepositPurpose</a> <a id="2437" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="2439" href="Ledger.Core.Specification.Address.html#260" class="Datatype">Credential</a><a id="2449" class="Symbol">)</a> <a id="2451" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="2453" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a><a id="2457" class="Symbol">)</a>
  <a id="2461" class="Symbol">→</a> <a id="2463" class="Symbol">(</a><a id="2464" href="Ledger.Conway.Specification.Chain.html#2405" class="Bound">x</a> <a id="2466" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="2468" href="Ledger.Conway.Specification.Chain.html#2409" class="Bound">y</a><a id="2469" class="Symbol">)</a> <a id="2471" href="Class.IsSet.html#458" class="Function Operator">∈</a> <a id="2473" href="Class.IsSet.html#916" class="Function">dom</a> <a id="2477" class="Symbol">((</a><a id="2479" href="Axiom.Set.Map.html#10313" class="Function">mapMaybeWithKeyᵐ</a> <a id="2496" class="Symbol">(</a><a id="2497" href="Ledger.Conway.Specification.Chain.html#2200" class="Function">maybePurpose</a> <a id="2510" href="Ledger.Conway.Specification.Chain.html#2398" class="Bound">prps</a><a id="2514" class="Symbol">)</a> <a id="2516" href="Ledger.Conway.Specification.Chain.html#2417" class="Bound">m</a><a id="2517" class="Symbol">)</a> <a id="2519" href="Axiom.Set.Map.html#2293" class="Function Operator">ˢ</a><a id="2520" class="Symbol">)</a>
  <a id="2524" class="Symbol">→</a> <a id="2526" href="Ledger.Conway.Specification.Chain.html#2405" class="Bound">x</a> <a id="2528" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="2530" href="Ledger.Conway.Specification.Chain.html#2398" class="Bound">prps</a>
<a id="2535" href="Ledger.Conway.Specification.Chain.html#2375" class="Function">maybePurpose-prop</a> <a id="2553" class="Symbol">{</a><a id="2554" class="Argument">prps</a> <a id="2559" class="Symbol">=</a> <a id="2561" href="Ledger.Conway.Specification.Chain.html#2561" class="Bound">prps</a><a id="2565" class="Symbol">}</a> <a id="2567" class="Symbol">{</a><a id="2568" href="Ledger.Conway.Specification.Chain.html#2568" class="Bound">x</a><a id="2569" class="Symbol">}</a> <a id="2571" class="Symbol">{</a><a id="2572" href="Ledger.Conway.Specification.Chain.html#2572" class="Bound">y</a><a id="2573" class="Symbol">}</a> <a id="2575" class="Symbol">_</a> <a id="2577" href="Ledger.Conway.Specification.Chain.html#2577" class="Bound">xy∈dom</a> <a id="2584" class="Keyword">with</a> <a id="2589" href="Function.Bundles.html#4834" class="Field">from</a> <a id="2594" href="Axiom.Set.Rel.html#2472" class="Function">dom∈</a> <a id="2599" href="Ledger.Conway.Specification.Chain.html#2577" class="Bound">xy∈dom</a>
<a id="2606" class="Symbol">...</a> <a id="2610" class="Symbol">|</a> <a id="2612" href="Ledger.Conway.Specification.Chain.html#2612" class="Bound">z</a> <a id="2614" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="2616" href="Ledger.Conway.Specification.Chain.html#2616" class="Bound">∈mmwk</a> <a id="2622" class="Keyword">with</a> <a id="2627" class="Bound">prps</a> <a id="2632" href="Class.DecEq.Core.html#159" class="Field Operator">≟</a> <a id="2634" class="Bound">x</a> <a id="2636" class="Symbol">|</a> <a id="2638" href="Axiom.Set.Rel.html#5977" class="Function">∈-mapMaybeWithKey</a> <a id="2656" class="Symbol">{</a><a id="2657" class="Argument">f</a> <a id="2659" class="Symbol">=</a> <a id="2661" href="Ledger.Conway.Specification.Chain.html#2200" class="Function">maybePurpose</a> <a id="2674" class="Bound">prps</a><a id="2678" class="Symbol">}</a> <a id="2680" href="Ledger.Conway.Specification.Chain.html#2616" class="Bound">∈mmwk</a>
<a id="2686" class="Symbol">...</a> <a id="2690" class="Symbol">|</a> <a id="2692" href="Relation.Nullary.Decidable.Core.html#1994" class="InductiveConstructor">yes</a> <a id="2696" href="Agda.Builtin.Equality.html#207" class="InductiveConstructor">refl</a> <a id="2701" class="Symbol">|</a> <a id="2703" class="Symbol">_</a> <a id="2705" class="Symbol">=</a> <a id="2707" href="Agda.Builtin.Equality.html#207" class="InductiveConstructor">refl</a>

<a id="filterPurpose"></a><a id="2713" href="Ledger.Conway.Specification.Chain.html#2713" class="Function">filterPurpose</a> <a id="2727" class="Symbol">:</a> <a id="2729" href="Ledger.Conway.Specification.Certs.html#349" class="Datatype">DepositPurpose</a> <a id="2744" class="Symbol">→</a> <a id="2746" class="Symbol">(</a><a id="2747" href="Ledger.Conway.Specification.Certs.html#349" class="Datatype">DepositPurpose</a> <a id="2762" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="2764" href="Ledger.Core.Specification.Address.html#260" class="Datatype">Credential</a><a id="2774" class="Symbol">)</a> <a id="2776" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="2778" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a> <a id="2783" class="Symbol">→</a> <a id="2785" href="Ledger.Core.Specification.Address.html#260" class="Datatype">Credential</a> <a id="2796" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="2798" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a>
<a id="2803" href="Ledger.Conway.Specification.Chain.html#2713" class="Function">filterPurpose</a> <a id="2817" href="Ledger.Conway.Specification.Chain.html#2817" class="Bound">prps</a> <a id="2822" href="Ledger.Conway.Specification.Chain.html#2822" class="Bound">m</a> <a id="2824" class="Symbol">=</a> <a id="2826" href="Axiom.Set.Map.html#5896" class="Function">mapKeys</a> <a id="2834" href="Data.Product.Base.html#650" class="Field">proj₂</a> <a id="2840" class="Symbol">(</a><a id="2841" href="Axiom.Set.Map.html#10313" class="Function">mapMaybeWithKeyᵐ</a> <a id="2858" class="Symbol">(</a><a id="2859" href="Ledger.Conway.Specification.Chain.html#2200" class="Function">maybePurpose</a> <a id="2872" href="Ledger.Conway.Specification.Chain.html#2817" class="Bound">prps</a><a id="2876" class="Symbol">)</a> <a id="2878" href="Ledger.Conway.Specification.Chain.html#2822" class="Bound">m</a><a id="2879" class="Symbol">)</a>
  <a id="2883" class="Symbol">{λ</a> <a id="2886" class="Keyword">where</a> <a id="2892" href="Ledger.Conway.Specification.Chain.html#2892" class="Bound">x∈dom</a> <a id="2898" href="Ledger.Conway.Specification.Chain.html#2898" class="Bound">y∈dom</a> <a id="2904" href="Agda.Builtin.Equality.html#207" class="InductiveConstructor">refl</a> <a id="2909" class="Symbol">→</a> <a id="2911" href="Relation.Binary.PropositionalEquality.Core.html#1339" class="Function">cong</a> <a id="2916" class="Symbol">(</a><a id="2917" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">_,</a> <a id="2920" class="Symbol">_)</a>
                            <a id="2951" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="2953" href="Relation.Binary.PropositionalEquality.Core.html#1938" class="Function">trans</a> <a id="2959" class="Symbol">(</a><a id="2960" href="Ledger.Conway.Specification.Chain.html#2375" class="Function">maybePurpose-prop</a> <a id="2978" class="Symbol">{</a><a id="2979" class="Argument">prps</a> <a id="2984" class="Symbol">=</a> <a id="2986" href="Ledger.Conway.Specification.Chain.html#2817" class="Bound">prps</a><a id="2990" class="Symbol">}</a> <a id="2992" href="Ledger.Conway.Specification.Chain.html#2822" class="Bound">m</a> <a id="2994" href="Ledger.Conway.Specification.Chain.html#2892" class="Bound">x∈dom</a><a id="2999" class="Symbol">)</a>
                            <a id="3029" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="3031" href="Relation.Binary.PropositionalEquality.Core.html#1893" class="Function">sym</a>   <a id="3037" class="Symbol">(</a><a id="3038" href="Ledger.Conway.Specification.Chain.html#2375" class="Function">maybePurpose-prop</a> <a id="3056" class="Symbol">{</a><a id="3057" class="Argument">prps</a> <a id="3062" class="Symbol">=</a> <a id="3064" href="Ledger.Conway.Specification.Chain.html#2817" class="Bound">prps</a><a id="3068" class="Symbol">}</a> <a id="3070" href="Ledger.Conway.Specification.Chain.html#2822" class="Bound">m</a> <a id="3072" href="Ledger.Conway.Specification.Chain.html#2898" class="Bound">y∈dom</a><a id="3077" class="Symbol">)}</a>

<a id="govActionDeposits"></a><a id="3081" href="Ledger.Conway.Specification.Chain.html#3081" class="Function">govActionDeposits</a> <a id="3099" class="Symbol">:</a> <a id="3101" href="Ledger.Conway.Specification.Ledger.html#977" class="Record">LState</a> <a id="3108" class="Symbol">→</a> <a id="3110" href="Ledger.Conway.Specification.Gov.Actions.html#452" class="Datatype">VDeleg</a> <a id="3117" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="3119" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a>
<a id="3124" href="Ledger.Conway.Specification.Chain.html#3081" class="Function">govActionDeposits</a> <a id="3142" href="Ledger.Conway.Specification.Chain.html#3142" class="Bound">ls</a> <a id="3145" class="Symbol">=</a>
  <a id="3149" class="Keyword">let</a> <a id="3153" class="Keyword">open</a> <a id="3158" href="Ledger.Conway.Specification.Ledger.html#977" class="Module">LState</a> <a id="3165" href="Ledger.Conway.Specification.Chain.html#3142" class="Bound">ls</a><a id="3167" class="Symbol">;</a> <a id="3169" class="Keyword">open</a> <a id="3174" href="Ledger.Conway.Specification.Certs.html#4344" class="Module">CertState</a> <a id="3184" href="Ledger.Conway.Specification.Ledger.html#1089" class="Field">certState</a><a id="3193" class="Symbol">;</a> <a id="3195" class="Keyword">open</a> <a id="3200" href="Ledger.Conway.Specification.Certs.html#3798" class="Module">PState</a> <a id="3207" href="Ledger.Conway.Specification.Certs.html#4427" class="Function">pState</a>
      <a id="3220" class="Keyword">open</a> <a id="3225" href="Ledger.Conway.Specification.Utxo.html#1474" class="Module">UTxOState</a> <a id="3235" href="Ledger.Conway.Specification.Ledger.html#1036" class="Field">utxoSt</a><a id="3241" class="Symbol">;</a> <a id="3243" class="Keyword">open</a> <a id="3248" href="Ledger.Conway.Specification.Certs.html#3188" class="Module">DState</a> <a id="3255" href="Ledger.Conway.Specification.Certs.html#4407" class="Function">dState</a>
   <a id="3265" class="Keyword">in</a> <a id="3268" href="Data.List.Base.html#4249" class="Function">foldl</a> <a id="3274" href="Axiom.Set.Map.Dec.html#1854" class="Function Operator">_∪⁺_</a> <a id="3279" href="Class.HasEmptySet.html#287" class="Field">∅</a> <a id="3281" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="3283" href="abstract-set-theory.FiniteSetTheory.html#2463" class="Function">setToList</a> <a id="3293" href="Function.Base.html#1974" class="Function Operator">$</a>
    <a id="3299" href="Axiom.Set.html#7805" class="Function">mapPartial</a>
      <a id="3316" class="Symbol">(λ</a> <a id="3319" class="Keyword">where</a> <a id="3325" class="Symbol">(</a><a id="3326" href="Ledger.Conway.Specification.Chain.html#3326" class="Bound">gaid</a> <a id="3331" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="3333" class="Keyword">record</a> <a id="3340" class="Symbol">{</a> <a id="3342" href="Ledger.Conway.Specification.Gov.Actions.html#2811" class="Field">returnAddr</a> <a id="3353" class="Symbol">=</a> <a id="3355" class="Keyword">record</a> <a id="3362" class="Symbol">{</a><a id="3363" href="Ledger.Core.Specification.Address.html#1378" class="Field">stake</a> <a id="3369" class="Symbol">=</a> <a id="3371" href="Ledger.Conway.Specification.Chain.html#3371" class="Bound">c</a><a id="3372" class="Symbol">}</a> <a id="3374" class="Symbol">})</a> <a id="3377" class="Symbol">→</a> <a id="3379" class="Keyword">do</a>
        <a id="3390" href="Ledger.Conway.Specification.Chain.html#3390" class="Bound">vd</a> <a id="3393" href="Class.Monad.Core.html#299" class="Field Operator">←</a> <a id="3395" href="Axiom.Set.Map.html#13670" class="Function">lookupᵐ?</a> <a id="3404" href="Ledger.Conway.Specification.Certs.html#3247" class="Function">voteDelegs</a> <a id="3415" href="Ledger.Conway.Specification.Chain.html#3371" class="Bound">c</a>
        <a id="3425" href="Ledger.Conway.Specification.Chain.html#3425" class="Bound">dep</a> <a id="3429" href="Class.Monad.Core.html#299" class="Field Operator">←</a> <a id="3431" href="Axiom.Set.Map.html#13670" class="Function">lookupᵐ?</a> <a id="3440" href="Ledger.Conway.Specification.Utxo.html#1582" class="Function">deposits</a> <a id="3449" class="Symbol">(</a><a id="3450" href="Ledger.Conway.Specification.Certs.html#538" class="InductiveConstructor">GovActionDeposit</a> <a id="3467" href="Ledger.Conway.Specification.Chain.html#3326" class="Bound">gaid</a><a id="3471" class="Symbol">)</a>
        <a id="3481" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="3486" href="Class.HasSingleton.html#288" class="Field Operator">❴</a> <a id="3488" href="Ledger.Conway.Specification.Chain.html#3390" class="Bound">vd</a> <a id="3491" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="3493" href="Ledger.Conway.Specification.Chain.html#3425" class="Bound">dep</a> <a id="3497" href="Class.HasSingleton.html#288" class="Field Operator">❵</a> <a id="3499" class="Symbol">)</a>
      <a id="3507" class="Symbol">(</a><a id="3508" href="Axiom.Set.html#5718" class="Function">fromList</a> <a id="3517" href="Ledger.Conway.Specification.Ledger.html#1063" class="Field">govSt</a><a id="3522" class="Symbol">)</a>

<a id="calculateStakeDistrs"></a><a id="3525" href="Ledger.Conway.Specification.Chain.html#3525" class="Function">calculateStakeDistrs</a> <a id="3546" class="Symbol">:</a> <a id="3548" href="Ledger.Conway.Specification.Ledger.html#977" class="Record">LState</a> <a id="3555" class="Symbol">→</a> <a id="3557" href="Ledger.Conway.Specification.Ratify.html#3013" class="Record">StakeDistrs</a>
<a id="3569" href="Ledger.Conway.Specification.Chain.html#3525" class="Function">calculateStakeDistrs</a> <a id="3590" href="Ledger.Conway.Specification.Chain.html#3590" class="Bound">ls</a> <a id="3593" class="Symbol">=</a>
  <a id="3597" class="Keyword">let</a> <a id="3601" class="Keyword">open</a> <a id="3606" href="Ledger.Conway.Specification.Ledger.html#977" class="Module">LState</a> <a id="3613" href="Ledger.Conway.Specification.Chain.html#3590" class="Bound">ls</a><a id="3615" class="Symbol">;</a> <a id="3617" class="Keyword">open</a> <a id="3622" href="Ledger.Conway.Specification.Certs.html#4344" class="Module">CertState</a> <a id="3632" href="Ledger.Conway.Specification.Ledger.html#1089" class="Field">certState</a><a id="3641" class="Symbol">;</a> <a id="3643" class="Keyword">open</a> <a id="3648" href="Ledger.Conway.Specification.Certs.html#3798" class="Module">PState</a> <a id="3655" href="Ledger.Conway.Specification.Certs.html#4427" class="Function">pState</a>
      <a id="3668" class="Keyword">open</a> <a id="3673" href="Ledger.Conway.Specification.Utxo.html#1474" class="Module">UTxOState</a> <a id="3683" href="Ledger.Conway.Specification.Ledger.html#1036" class="Field">utxoSt</a><a id="3689" class="Symbol">;</a> <a id="3691" class="Keyword">open</a> <a id="3696" href="Ledger.Conway.Specification.Certs.html#3188" class="Module">DState</a> <a id="3703" href="Ledger.Conway.Specification.Certs.html#4407" class="Function">dState</a>
      <a id="3716" href="Ledger.Conway.Specification.Chain.html#3716" class="Bound">spoDelegs</a> <a id="3726" class="Symbol">=</a> <a id="3728" href="Class.HasEmptySet.html#287" class="Field">∅</a> <a id="3730" class="Comment">-- TODO</a>
      <a id="3744" href="Ledger.Conway.Specification.Chain.html#3744" class="Bound">drepDelegs</a> <a id="3755" class="Symbol">=</a> <a id="3757" href="Class.HasEmptySet.html#287" class="Field">∅</a> <a id="3759" class="Comment">-- TODO</a>
  <a id="3769" class="Keyword">in</a>
  <a id="3774" class="Keyword">record</a>
    <a id="3785" class="Symbol">{</a> <a id="3787" href="Ledger.Conway.Specification.Ratify.html#3050" class="Field">stakeDistr</a> <a id="3798" class="Symbol">=</a> <a id="3800" href="Ledger.Conway.Specification.Chain.html#3081" class="Function">govActionDeposits</a> <a id="3818" href="Ledger.Conway.Specification.Chain.html#3590" class="Bound">ls</a>
    <a id="3825" class="Symbol">}</a>

<a id="totalRefScriptsSize"></a><a id="3828" href="Ledger.Conway.Specification.Chain.html#3828" class="Function">totalRefScriptsSize</a> <a id="3848" class="Symbol">:</a> <a id="3850" href="Ledger.Conway.Specification.Ledger.html#977" class="Record">LState</a> <a id="3857" class="Symbol">→</a> <a id="3859" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="3864" href="Ledger.Conway.Specification.Transaction.html#4500" class="Record">Tx</a> <a id="3867" class="Symbol">→</a> <a id="3869" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a>
<a id="3871" href="Ledger.Conway.Specification.Chain.html#3828" class="Function">totalRefScriptsSize</a> <a id="3891" href="Ledger.Conway.Specification.Chain.html#3891" class="Bound">lst</a> <a id="3895" href="Ledger.Conway.Specification.Chain.html#3895" class="Bound">txs</a> <a id="3899" class="Symbol">=</a> <a id="3901" href="Data.List.Base.html#4964" class="Function">sum</a> <a id="3905" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="3907" href="Class.Functor.Core.html#272" class="Function">map</a> <a id="3911" class="Symbol">(</a><a id="3912" href="Ledger.Conway.Specification.Utxo.html#2478" class="Function">refScriptsSize</a> <a id="3927" href="Ledger.Conway.Specification.Utxo.html#1538" class="Function">utxo</a><a id="3931" class="Symbol">)</a> <a id="3933" href="Ledger.Conway.Specification.Chain.html#3895" class="Bound">txs</a>
  <a id="3939" class="Keyword">where</a> <a id="3945" class="Keyword">open</a> <a id="3950" href="Ledger.Conway.Specification.Utxo.html#1474" class="Module">UTxOState</a> <a id="3960" class="Symbol">(</a><a id="3961" href="Ledger.Conway.Specification.Ledger.html#1036" class="Field">LState.utxoSt</a> <a id="3975" href="Ledger.Conway.Specification.Chain.html#3891" class="Bound">lst</a><a id="3978" class="Symbol">)</a>

<a id="3981" class="Keyword">private</a> <a id="3989" class="Keyword">variable</a>
  <a id="4000" href="Ledger.Conway.Specification.Chain.html#4000" class="Generalizable">ls&#39;</a> <a id="4004" class="Symbol">:</a> <a id="4006" href="Ledger.Conway.Specification.Ledger.html#977" class="Record">LState</a> 
<a id="4014" class="Keyword">data</a>


  <a id="_⊢_⇀⦇_,CHAIN⦈_"></a><a id="4023" href="Ledger.Conway.Specification.Chain.html#4023" class="Datatype Operator">_⊢_⇀⦇_,CHAIN⦈_</a> <a id="4038" class="Symbol">:</a> <a id="4040" href="Agda.Builtin.Unit.html#175" class="Record">⊤</a> <a id="4042" class="Symbol">→</a> <a id="4044" href="Ledger.Conway.Specification.Chain.html#788" class="Record">ChainState</a> <a id="4055" class="Symbol">→</a> <a id="4057" href="Ledger.Conway.Specification.Chain.html#863" class="Record">Block</a> <a id="4063" class="Symbol">→</a> <a id="4065" href="Ledger.Conway.Specification.Chain.html#788" class="Record">ChainState</a> <a id="4076" class="Symbol">→</a> <a id="4078" href="Agda.Primitive.html#388" class="Primitive">Type</a>


  <a id="4087" class="Keyword">where</a>


  <a id="_⊢_⇀⦇_,CHAIN⦈_.CHAIN"></a><a id="4097" href="Ledger.Conway.Specification.Chain.html#4097" class="InductiveConstructor">CHAIN</a> <a id="4103" class="Symbol">:</a> <a id="4105" class="Symbol">{</a><a id="4106" href="Ledger.Conway.Specification.Chain.html#4106" class="Bound">b</a> <a id="4108" class="Symbol">:</a> <a id="4110" href="Ledger.Conway.Specification.Chain.html#863" class="Record">Block</a><a id="4115" class="Symbol">}</a> <a id="4117" class="Symbol">{</a><a id="4118" href="Ledger.Conway.Specification.Chain.html#4118" class="Bound">nes</a> <a id="4122" class="Symbol">:</a> <a id="4124" href="Ledger.Conway.Specification.Epoch.html#2618" class="Record">NewEpochState</a><a id="4137" class="Symbol">}</a> <a id="4139" class="Symbol">{</a><a id="4140" href="Ledger.Conway.Specification.Chain.html#4140" class="Bound">cs</a> <a id="4143" class="Symbol">:</a> <a id="4145" href="Ledger.Conway.Specification.Chain.html#788" class="Record">ChainState</a><a id="4155" class="Symbol">}</a>


    <a id="4163" class="Symbol">→</a> <a id="4165" class="Keyword">let</a> <a id="4169" class="Keyword">open</a> <a id="4174" href="Ledger.Conway.Specification.Chain.html#788" class="Module">ChainState</a> <a id="4185" href="Ledger.Conway.Specification.Chain.html#4140" class="Bound">cs</a><a id="4187" class="Symbol">;</a> <a id="4189" class="Keyword">open</a> <a id="4194" href="Ledger.Conway.Specification.Chain.html#863" class="Module">Block</a> <a id="4200" href="Ledger.Conway.Specification.Chain.html#4106" class="Bound">b</a><a id="4201" class="Symbol">;</a> <a id="4203" class="Keyword">open</a> <a id="4208" href="Ledger.Conway.Specification.Epoch.html#2618" class="Module">NewEpochState</a> <a id="4222" href="Ledger.Conway.Specification.Chain.html#4118" class="Bound">nes</a>
          <a id="4236" class="Keyword">open</a> <a id="4241" href="Ledger.Conway.Specification.Epoch.html#1604" class="Module">EpochState</a> <a id="4252" href="Ledger.Conway.Specification.Epoch.html#2681" class="Function">epochState</a><a id="4262" class="Symbol">;</a> <a id="4264" class="Keyword">open</a> <a id="4269" href="Ledger.Conway.Specification.Enact.html#444" class="Module">EnactState</a> <a id="4280" href="Ledger.Conway.Specification.Epoch.html#1745" class="Function">es</a> <a id="4283" class="Keyword">renaming</a> <a id="4292" class="Symbol">(</a><a id="4293" href="Ledger.Conway.Specification.Enact.html#654" class="Field">pparams</a> <a id="4301" class="Symbol">to</a> <a id="4304" class="Field">pp</a><a id="4306" class="Symbol">)</a>
          <a id="4318" class="Keyword">open</a> <a id="4323" href="Ledger.Conway.Specification.PParams.html#1728" class="Module">PParams</a> <a id="4331" href="Ledger.Prelude.html#2302" class="Function Operator">∣</a> <a id="4333" href="Ledger.Conway.Specification.Chain.html#4304" class="Function">pp</a> <a id="4336" href="Ledger.Prelude.html#2302" class="Function Operator">∣</a> <a id="4338" class="Keyword">using</a> <a id="4344" class="Symbol">(</a><a id="4345" href="Ledger.Conway.Specification.PParams.html#2640" class="Field">maxRefScriptSizePerBlock</a><a id="4369" class="Symbol">)</a> <a id="4371" class="Keyword">in</a>


    <a id="4380" class="Keyword">let</a>  <a id="4385" href="Ledger.Conway.Specification.Chain.html#4385" class="Bound">cs&#39;</a>  <a id="4390" class="Symbol">=</a> <a id="4392" class="Keyword">record</a> <a id="4399" href="Ledger.Conway.Specification.Chain.html#4140" class="Bound">cs</a> <a id="4402" class="Symbol">{</a>  <a id="4405" href="Ledger.Conway.Specification.Chain.html#824" class="Field">newEpochState</a>
                             <a id="4448" class="Symbol">=</a> <a id="4450" class="Keyword">record</a> <a id="4457" href="Ledger.Conway.Specification.Chain.html#4118" class="Bound">nes</a> <a id="4461" class="Symbol">{</a>  <a id="4464" href="Ledger.Conway.Specification.Epoch.html#2681" class="Field">epochState</a>
                                             <a id="4520" class="Symbol">=</a> <a id="4522" class="Keyword">record</a> <a id="4529" href="Ledger.Conway.Specification.Epoch.html#2681" class="Function">epochState</a> <a id="4540" class="Symbol">{</a><a id="4541" href="Ledger.Conway.Specification.Epoch.html#1721" class="Field">ls</a> <a id="4544" class="Symbol">=</a> <a id="4546" href="Ledger.Conway.Specification.Chain.html#4000" class="Generalizable">ls&#39;</a><a id="4549" class="Symbol">}</a> <a id="4551" class="Symbol">}</a> <a id="4553" class="Symbol">}</a>
         <a id="4564" href="Ledger.Conway.Specification.Chain.html#4564" class="Bound">Γ</a>    <a id="4569" class="Symbol">=</a> <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.Conway.Specification.Chain.html#914}{\htmlId{4573}{\htmlClass{Function}{\text{slot}}}}\, \\ \,\href{Ledger.Prelude.html#2302}{\htmlId{4580}{\htmlClass{Function Operator}{\text{∣}}}}\, \,\href{Ledger.Conway.Specification.Enact.html#549}{\htmlId{4582}{\htmlClass{Function}{\text{constitution}}}}\, \,\href{Ledger.Prelude.html#2302}{\htmlId{4595}{\htmlClass{Function Operator}{\text{∣}}}}\, \\ \,\href{Ledger.Prelude.html#2302}{\htmlId{4599}{\htmlClass{Function Operator}{\text{∣}}}}\, \,\href{Ledger.Conway.Specification.Chain.html#4304}{\htmlId{4601}{\htmlClass{Function}{\text{pp}}}}\, \,\href{Ledger.Prelude.html#2302}{\htmlId{4604}{\htmlClass{Function Operator}{\text{∣}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#1745}{\htmlId{4608}{\htmlClass{Function}{\text{es}}}}\, \\ \,\href{Ledger.Conway.Specification.PParams.html#860}{\htmlId{4613}{\htmlClass{Field}{\text{treasuryOf}}}}\, \,\href{Ledger.Conway.Specification.Chain.html#4118}{\htmlId{4624}{\htmlClass{Bound}{\text{nes}}}}\, \end{pmatrix}$</a>
    <a id="4634" class="Keyword">in</a>
    <a id="4641" href="Prelude.InferenceRules.html#56074" class="Function Operator">∙</a> <a id="4643" href="Ledger.Conway.Specification.Chain.html#3828" class="Function">totalRefScriptsSize</a> <a id="4663" href="Ledger.Conway.Specification.Epoch.html#1721" class="Function">ls</a> <a id="4666" href="Ledger.Conway.Specification.Chain.html#894" class="Function">ts</a> <a id="4669" href="Class.HasOrder.Core.html#608" class="Field Operator">≤</a> <a id="4671" href="Ledger.Conway.Specification.PParams.html#2640" class="Function">maxRefScriptSizePerBlock</a>
    <a id="4700" href="iog-prelude.Prelude.InferenceRules.html#583" class="Function Operator">∙</a> <a id="4702" class="Symbol">_</a> <a id="4704" href="Ledger.Conway.Specification.Epoch.html#11551" class="Datatype Operator">⊢</a> <a id="4706" href="Ledger.Conway.Specification.Chain.html#824" class="Field">newEpochState</a> <a id="4720" href="Ledger.Conway.Specification.Epoch.html#11551" class="Datatype Operator">⇀⦇</a> <a id="4723" href="Ledger.Core.Specification.Epoch.html#810" class="Function">epoch</a> <a id="4729" href="Ledger.Conway.Specification.Chain.html#914" class="Function">slot</a> <a id="4734" href="Ledger.Conway.Specification.Epoch.html#11551" class="Datatype Operator">,NEWEPOCH⦈</a> <a id="4745" href="Ledger.Conway.Specification.Chain.html#4118" class="Bound">nes</a>
    <a id="4753" href="iog-prelude.Prelude.InferenceRules.html#583" class="Function Operator">∙</a> <a id="4755" href="Ledger.Conway.Specification.Chain.html#4564" class="Bound">Γ</a> <a id="4757" href="Ledger.Conway.Specification.Ledger.html#3844" class="Function Operator">⊢</a> <a id="4759" href="Ledger.Conway.Specification.Epoch.html#1721" class="Function">ls</a> <a id="4762" href="Ledger.Conway.Specification.Ledger.html#3844" class="Function Operator">⇀⦇</a> <a id="4765" href="Ledger.Conway.Specification.Chain.html#894" class="Function">ts</a> <a id="4768" href="Ledger.Conway.Specification.Ledger.html#3844" class="Function Operator">,LEDGERS⦈</a> <a id="4778" href="Ledger.Conway.Specification.Chain.html#4000" class="Generalizable">ls&#39;</a>
      <a id="4788" href="iog-prelude.Prelude.InferenceRules.html#217" class="Function Operator">────────────────────────────────</a>
      <a id="4827" class="Symbol">_</a> <a id="4829" href="Ledger.Conway.Specification.Chain.html#4023" class="Datatype Operator">⊢</a> <a id="4831" href="Ledger.Conway.Specification.Chain.html#4140" class="Bound">cs</a> <a id="4834" href="Ledger.Conway.Specification.Chain.html#4023" class="Datatype Operator">⇀⦇</a> <a id="4837" href="Ledger.Conway.Specification.Chain.html#4106" class="Bound">b</a> <a id="4839" href="Ledger.Conway.Specification.Chain.html#4023" class="Datatype Operator">,CHAIN⦈</a> <a id="4847" href="Ledger.Conway.Specification.Chain.html#4385" class="Bound">cs&#39;</a>

</pre></body></html>