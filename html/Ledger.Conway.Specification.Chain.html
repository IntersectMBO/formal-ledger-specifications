<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>Ledger.Conway.Specification.Chain</title><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.css"><link rel="stylesheet" href="Agda.css"><script src="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.js"></script><script src="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/contrib/auto-render.min.js"></script><script src="AgdaKaTeX.js" defer=""></script></head><body><pre class="Agda">
<a id="2" class="Symbol">{-#</a> <a id="6" class="Keyword">OPTIONS</a> <a id="14" class="Pragma">--safe</a> <a id="21" class="Symbol">#-}</a>

<a id="26" class="Keyword">open</a> <a id="31" class="Keyword">import</a> <a id="38" href="Ledger.Conway.Specification.Transaction.html" class="Module">Ledger.Conway.Specification.Transaction</a>
<a id="78" class="Keyword">open</a> <a id="83" class="Keyword">import</a> <a id="90" href="Ledger.Conway.Specification.Abstract.html" class="Module">Ledger.Conway.Specification.Abstract</a>

<a id="128" class="Keyword">module</a> <a id="135" href="Ledger.Conway.Specification.Chain.html" class="Module">Ledger.Conway.Specification.Chain</a>
  <a id="171" class="Symbol">(</a><a id="172" href="Ledger.Conway.Specification.Chain.html#172" class="Bound">txs</a> <a id="176" class="Symbol">:</a> <a id="178" class="Symbol">_)</a> <a id="181" class="Symbol">(</a><a id="182" class="Keyword">open</a> <a id="187" href="Ledger.Conway.Specification.Transaction.html#1000" class="Module">TransactionStructure</a> <a id="208" href="Ledger.Conway.Specification.Chain.html#172" class="Bound">txs</a><a id="211" class="Symbol">)</a>
  <a id="215" class="Symbol">(</a><a id="216" href="Ledger.Conway.Specification.Chain.html#216" class="Bound">abs</a> <a id="220" class="Symbol">:</a> <a id="222" href="Ledger.Conway.Specification.Abstract.html#648" class="Record">AbstractFunctions</a> <a id="240" href="Ledger.Conway.Specification.Chain.html#172" class="Bound">txs</a><a id="243" class="Symbol">)</a> <a id="245" class="Symbol">(</a><a id="246" class="Keyword">open</a> <a id="251" href="Ledger.Conway.Specification.Abstract.html#648" class="Module">AbstractFunctions</a> <a id="269" href="Ledger.Conway.Specification.Chain.html#216" class="Bound">abs</a><a id="272" class="Symbol">)</a>
  <a id="276" class="Keyword">where</a>

<a id="283" class="Keyword">open</a> <a id="288" class="Keyword">import</a> <a id="295" href="Ledger.Conway.Specification.Certs.html" class="Module">Ledger.Conway.Specification.Certs</a> <a id="329" href="Ledger.Conway.Specification.Transaction.html#2079" class="Function">govStructure</a>
<a id="342" class="Keyword">open</a> <a id="347" class="Keyword">import</a> <a id="354" href="Ledger.Conway.Specification.Enact.html" class="Module">Ledger.Conway.Specification.Enact</a> <a id="388" href="Ledger.Conway.Specification.Transaction.html#2079" class="Function">govStructure</a>
<a id="401" class="Keyword">open</a> <a id="406" class="Keyword">import</a> <a id="413" href="Ledger.Conway.Specification.Epoch.html" class="Module">Ledger.Conway.Specification.Epoch</a> <a id="447" href="Ledger.Conway.Specification.Chain.html#172" class="Bound">txs</a> <a id="451" href="Ledger.Conway.Specification.Chain.html#216" class="Bound">abs</a>
<a id="455" class="Keyword">open</a> <a id="460" class="Keyword">import</a> <a id="467" href="Ledger.Conway.Specification.Gov.html" class="Module">Ledger.Conway.Specification.Gov</a> <a id="499" href="Ledger.Conway.Specification.Chain.html#172" class="Bound">txs</a>
<a id="503" class="Keyword">open</a> <a id="508" class="Keyword">import</a> <a id="515" href="Ledger.Conway.Specification.Ledger.html" class="Module">Ledger.Conway.Specification.Ledger</a> <a id="550" href="Ledger.Conway.Specification.Chain.html#172" class="Bound">txs</a> <a id="554" href="Ledger.Conway.Specification.Chain.html#216" class="Bound">abs</a>
<a id="558" class="Keyword">open</a> <a id="563" class="Keyword">import</a> <a id="570" href="Ledger.Prelude.html" class="Module">Ledger.Prelude</a><a id="584" class="Symbol">;</a> <a id="586" class="Keyword">open</a> <a id="591" href="Function.Bundles.html#4750" class="Module">Equivalence</a>
<a id="603" class="Keyword">open</a> <a id="608" class="Keyword">import</a> <a id="615" href="Ledger.Conway.Specification.Ratify.html" class="Module">Ledger.Conway.Specification.Ratify</a> <a id="650" href="Ledger.Conway.Specification.Chain.html#172" class="Bound">txs</a>
<a id="654" class="Keyword">open</a> <a id="659" class="Keyword">import</a> <a id="666" href="Ledger.Conway.Specification.Utxo.html" class="Module">Ledger.Conway.Specification.Utxo</a> <a id="699" href="Ledger.Conway.Specification.Chain.html#172" class="Bound">txs</a> <a id="703" href="Ledger.Conway.Specification.Chain.html#216" class="Bound">abs</a>

<a id="708" class="Keyword">open</a> <a id="713" class="Keyword">import</a> <a id="720" href="Algebra.html" class="Module">Algebra</a>
<a id="728" class="Keyword">open</a> <a id="733" class="Keyword">import</a> <a id="740" href="Data.Nat.Properties.html" class="Module">Data.Nat.Properties</a> <a id="760" class="Keyword">using</a> <a id="766" class="Symbol">(</a><a id="767" href="Data.Nat.Properties.html#17566" class="Function">+-0-monoid</a><a id="777" class="Symbol">)</a>


<a id="781" class="Keyword">record</a> <a id="ChainState"></a><a id="788" href="Ledger.Conway.Specification.Chain.html#788" class="Record">ChainState</a> <a id="799" class="Symbol">:</a> <a id="801" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="806" class="Keyword">where</a>
  <a id="814" class="Keyword">field</a>
    <a id="ChainState.newEpochState"></a><a id="824" href="Ledger.Conway.Specification.Chain.html#824" class="Field">newEpochState</a>  <a id="839" class="Symbol">:</a> <a id="841" href="Ledger.Conway.Specification.Epoch.html#3014" class="Record">NewEpochState</a>

<a id="856" class="Keyword">record</a> <a id="Block"></a><a id="863" href="Ledger.Conway.Specification.Chain.html#863" class="Record">Block</a> <a id="869" class="Symbol">:</a> <a id="871" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="876" class="Keyword">where</a>
  <a id="884" class="Keyword">field</a>
    <a id="Block.ts"></a><a id="894" href="Ledger.Conway.Specification.Chain.html#894" class="Field">ts</a>    <a id="900" class="Symbol">:</a> <a id="902" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="907" href="Ledger.Conway.Specification.Transaction.html#4684" class="Record">Tx</a>
    <a id="Block.slot"></a><a id="914" href="Ledger.Conway.Specification.Chain.html#914" class="Field">slot</a>  <a id="920" class="Symbol">:</a> <a id="922" href="Ledger.Core.Specification.Epoch.html#674" class="Function">Slot</a>


<a id="929" class="Keyword">instance</a>
  <a id="HasNewEpochState-ChainState"></a><a id="940" href="Ledger.Conway.Specification.Chain.html#940" class="Function">HasNewEpochState-ChainState</a> <a id="968" class="Symbol">:</a> <a id="970" href="Ledger.Conway.Specification.Epoch.html#3185" class="Record">HasNewEpochState</a> <a id="987" href="Ledger.Conway.Specification.Chain.html#788" class="Record">ChainState</a>
  <a id="1000" href="Ledger.Conway.Specification.Chain.html#940" class="Function">HasNewEpochState-ChainState</a> <a id="1028" class="Symbol">.</a><a id="1029" href="Ledger.Conway.Specification.Epoch.html#3242" class="Field">NewEpochStateOf</a> <a id="1045" class="Symbol">=</a> <a id="1047" href="Ledger.Conway.Specification.Chain.html#824" class="Field">ChainState.newEpochState</a>

  <a id="HasLastEpoch-ChainState"></a><a id="1075" href="Ledger.Conway.Specification.Chain.html#1075" class="Function">HasLastEpoch-ChainState</a> <a id="1099" class="Symbol">:</a> <a id="1101" href="Ledger.Conway.Specification.Epoch.html#3320" class="Record">HasLastEpoch</a> <a id="1114" href="Ledger.Conway.Specification.Chain.html#788" class="Record">ChainState</a>
  <a id="1127" href="Ledger.Conway.Specification.Chain.html#1075" class="Function">HasLastEpoch-ChainState</a> <a id="1151" class="Symbol">.</a><a id="1152" href="Ledger.Conway.Specification.Epoch.html#3375" class="Field">LastEpochOf</a> <a id="1164" class="Symbol">=</a> <a id="1166" href="Ledger.Conway.Specification.Epoch.html#3375" class="Field">LastEpochOf</a> <a id="1178" href="Function.Base.html#1134" class="Function Operator">∘</a> <a id="1180" href="Ledger.Conway.Specification.Epoch.html#3242" class="Field">NewEpochStateOf</a>

  <a id="HasEpochState-ChainState"></a><a id="1199" href="Ledger.Conway.Specification.Chain.html#1199" class="Function">HasEpochState-ChainState</a> <a id="1224" class="Symbol">:</a> <a id="1226" href="Ledger.Conway.Specification.Epoch.html#1909" class="Record">HasEpochState</a> <a id="1240" href="Ledger.Conway.Specification.Chain.html#788" class="Record">ChainState</a>
  <a id="1253" href="Ledger.Conway.Specification.Chain.html#1199" class="Function">HasEpochState-ChainState</a> <a id="1278" class="Symbol">.</a><a id="1279" href="Ledger.Conway.Specification.Epoch.html#1963" class="Field">EpochStateOf</a> <a id="1292" class="Symbol">=</a> <a id="1294" href="Ledger.Conway.Specification.Epoch.html#1963" class="Field">EpochStateOf</a> <a id="1307" href="Function.Base.html#1134" class="Function Operator">∘</a> <a id="1309" href="Ledger.Conway.Specification.Epoch.html#3242" class="Field">NewEpochStateOf</a>

  <a id="HasEnactState-ChainState"></a><a id="1328" href="Ledger.Conway.Specification.Chain.html#1328" class="Function">HasEnactState-ChainState</a> <a id="1353" class="Symbol">:</a> <a id="1355" href="Ledger.Conway.Specification.Enact.html#737" class="Record">HasEnactState</a> <a id="1369" href="Ledger.Conway.Specification.Chain.html#788" class="Record">ChainState</a>
  <a id="1382" href="Ledger.Conway.Specification.Chain.html#1328" class="Function">HasEnactState-ChainState</a> <a id="1407" class="Symbol">.</a><a id="1408" href="Ledger.Conway.Specification.Enact.html#791" class="Field">EnactStateOf</a> <a id="1421" class="Symbol">=</a> <a id="1423" href="Ledger.Conway.Specification.Enact.html#791" class="Field">EnactStateOf</a> <a id="1436" href="Function.Base.html#1134" class="Function Operator">∘</a> <a id="1438" href="Ledger.Conway.Specification.Epoch.html#1963" class="Field">EpochStateOf</a>

  <a id="HasLState-ChainState"></a><a id="1454" href="Ledger.Conway.Specification.Chain.html#1454" class="Function">HasLState-ChainState</a> <a id="1475" class="Symbol">:</a> <a id="1477" href="Ledger.Conway.Specification.Ledger.html#1126" class="Record">HasLState</a> <a id="1487" href="Ledger.Conway.Specification.Chain.html#788" class="Record">ChainState</a>
  <a id="1500" href="Ledger.Conway.Specification.Chain.html#1454" class="Function">HasLState-ChainState</a> <a id="1521" class="Symbol">.</a><a id="1522" href="Ledger.Conway.Specification.Ledger.html#1176" class="Field">LStateOf</a> <a id="1531" class="Symbol">=</a> <a id="1533" href="Ledger.Conway.Specification.Ledger.html#1176" class="Field">LStateOf</a> <a id="1542" href="Function.Base.html#1134" class="Function Operator">∘</a> <a id="1544" href="Ledger.Conway.Specification.Epoch.html#1963" class="Field">EpochStateOf</a>

  <a id="HasUTxOState-ChainState"></a><a id="1560" href="Ledger.Conway.Specification.Chain.html#1560" class="Function">HasUTxOState-ChainState</a> <a id="1584" class="Symbol">:</a> <a id="1586" href="Ledger.Conway.Specification.Utxo.html#1396" class="Record">HasUTxOState</a> <a id="1599" href="Ledger.Conway.Specification.Chain.html#788" class="Record">ChainState</a>
  <a id="1612" href="Ledger.Conway.Specification.Chain.html#1560" class="Function">HasUTxOState-ChainState</a> <a id="1636" class="Symbol">.</a><a id="1637" href="Ledger.Conway.Specification.Utxo.html#1449" class="Field">UTxOStateOf</a> <a id="1649" class="Symbol">=</a> <a id="1651" href="Ledger.Conway.Specification.Utxo.html#1449" class="Field">UTxOStateOf</a> <a id="1663" href="Function.Base.html#1134" class="Function Operator">∘</a> <a id="1665" href="Ledger.Conway.Specification.Ledger.html#1176" class="Field">LStateOf</a>

  <a id="HasCertState-ChainState"></a><a id="1677" href="Ledger.Conway.Specification.Chain.html#1677" class="Function">HasCertState-ChainState</a> <a id="1701" class="Symbol">:</a> <a id="1703" href="Ledger.Conway.Specification.Certs.html#4667" class="Record">HasCertState</a> <a id="1716" href="Ledger.Conway.Specification.Chain.html#788" class="Record">ChainState</a>
  <a id="1729" href="Ledger.Conway.Specification.Chain.html#1677" class="Function">HasCertState-ChainState</a> <a id="1753" class="Symbol">.</a><a id="1754" href="Ledger.Conway.Specification.Certs.html#4720" class="Field">CertStateOf</a> <a id="1766" class="Symbol">=</a> <a id="1768" href="Ledger.Conway.Specification.Certs.html#4720" class="Field">CertStateOf</a> <a id="1780" href="Function.Base.html#1134" class="Function Operator">∘</a> <a id="1782" href="Ledger.Conway.Specification.Ledger.html#1176" class="Field">LStateOf</a>

  <a id="HasDeposits-ChainState"></a><a id="1794" href="Ledger.Conway.Specification.Chain.html#1794" class="Function">HasDeposits-ChainState</a> <a id="1817" class="Symbol">:</a> <a id="1819" href="Ledger.Conway.Specification.Certs.html#847" class="Record">HasDeposits</a> <a id="1831" href="Ledger.Conway.Specification.Chain.html#788" class="Record">ChainState</a>
  <a id="1844" href="Ledger.Conway.Specification.Chain.html#1794" class="Function">HasDeposits-ChainState</a> <a id="1867" class="Symbol">.</a><a id="1868" href="Ledger.Conway.Specification.Certs.html#899" class="Field">DepositsOf</a> <a id="1879" class="Symbol">=</a> <a id="1881" href="Ledger.Conway.Specification.Certs.html#899" class="Field">DepositsOf</a> <a id="1892" href="Function.Base.html#1134" class="Function Operator">∘</a> <a id="1894" href="Ledger.Conway.Specification.Utxo.html#1449" class="Field">UTxOStateOf</a>

  <a id="HasRewards-ChainState"></a><a id="1909" href="Ledger.Conway.Specification.Chain.html#1909" class="Function">HasRewards-ChainState</a> <a id="1931" class="Symbol">:</a> <a id="1933" href="Ledger.Conway.Specification.Certs.html#1721" class="Record">HasRewards</a> <a id="1944" href="Ledger.Conway.Specification.Chain.html#788" class="Record">ChainState</a>
  <a id="1957" href="Ledger.Conway.Specification.Chain.html#1909" class="Function">HasRewards-ChainState</a> <a id="1979" class="Symbol">.</a><a id="1980" href="Ledger.Conway.Specification.Certs.html#1772" class="Field">RewardsOf</a> <a id="1990" class="Symbol">=</a> <a id="1992" href="Ledger.Conway.Specification.Certs.html#1772" class="Field">RewardsOf</a> <a id="2002" href="Function.Base.html#1134" class="Function Operator">∘</a> <a id="2004" href="Ledger.Conway.Specification.Certs.html#4720" class="Field">CertStateOf</a>

  <a id="HasPParams-ChainState"></a><a id="2019" href="Ledger.Conway.Specification.Chain.html#2019" class="Function">HasPParams-ChainState</a> <a id="2041" class="Symbol">:</a> <a id="2043" href="Ledger.Conway.Specification.PParams.html#3489" class="Record">HasPParams</a> <a id="2054" href="Ledger.Conway.Specification.Chain.html#788" class="Record">ChainState</a>
  <a id="2067" href="Ledger.Conway.Specification.Chain.html#2019" class="Function">HasPParams-ChainState</a> <a id="2089" class="Symbol">.</a><a id="2090" href="Ledger.Conway.Specification.PParams.html#3540" class="Field">PParamsOf</a> <a id="2100" class="Symbol">=</a> <a id="2102" href="Ledger.Conway.Specification.PParams.html#3540" class="Field">PParamsOf</a> <a id="2112" href="Function.Base.html#1134" class="Function Operator">∘</a> <a id="2114" href="Ledger.Conway.Specification.Enact.html#791" class="Field">EnactStateOf</a>

<a id="2128" class="Keyword">instance</a> <a id="2137" href="Ledger.Conway.Specification.Chain.html#2137" class="Function">_</a> <a id="2139" class="Symbol">=</a> <a id="2141" href="Data.Nat.Properties.html#17566" class="Function">+-0-monoid</a>

<a id="2153" class="Comment">-- TODO: do we still need this for anything?</a>
<a id="maybePurpose"></a><a id="2198" href="Ledger.Conway.Specification.Chain.html#2198" class="Function">maybePurpose</a> <a id="2211" class="Symbol">:</a> <a id="2213" href="Ledger.Conway.Specification.Certs.html#548" class="Datatype">DepositPurpose</a> <a id="2228" class="Symbol">→</a> <a id="2230" class="Symbol">(</a><a id="2231" href="Ledger.Conway.Specification.Certs.html#548" class="Datatype">DepositPurpose</a> <a id="2246" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="2248" href="Ledger.Core.Specification.Address.html#260" class="Datatype">Credential</a><a id="2258" class="Symbol">)</a> <a id="2260" class="Symbol">→</a> <a id="2262" href="Ledger.Prelude.Base.html#154" class="Function">Coin</a> <a id="2267" class="Symbol">→</a> <a id="2269" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="2275" href="Ledger.Prelude.Base.html#154" class="Function">Coin</a>
<a id="2280" href="Ledger.Conway.Specification.Chain.html#2198" class="Function">maybePurpose</a> <a id="2293" href="Ledger.Conway.Specification.Chain.html#2293" class="Bound">prps</a> <a id="2298" class="Symbol">(</a><a id="2299" href="Ledger.Conway.Specification.Chain.html#2299" class="Bound">prps&#39;</a> <a id="2305" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="2307" class="Symbol">_)</a> <a id="2310" href="Ledger.Conway.Specification.Chain.html#2310" class="Bound">c</a> <a id="2312" class="Keyword">with</a> <a id="2317" href="Ledger.Conway.Specification.Chain.html#2293" class="Bound">prps</a> <a id="2322" href="Class.DecEq.Core.html#168" class="Field Operator">≟</a> <a id="2324" href="Ledger.Conway.Specification.Chain.html#2299" class="Bound">prps&#39;</a>
<a id="2330" class="Symbol">...</a> <a id="2334" class="Symbol">|</a> <a id="2336" href="Relation.Nullary.Decidable.Core.html#2099" class="InductiveConstructor">yes</a> <a id="2340" class="Symbol">_</a> <a id="2342" class="Symbol">=</a> <a id="2344" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="2349" class="Bound">c</a>
<a id="2351" class="Symbol">...</a> <a id="2355" class="Symbol">|</a> <a id="2357" href="Relation.Nullary.Decidable.Core.html#2136" class="InductiveConstructor">no</a> <a id="2360" class="Symbol">_</a> <a id="2362" class="Symbol">=</a> <a id="2364" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a>

<a id="maybePurpose-prop"></a><a id="2373" href="Ledger.Conway.Specification.Chain.html#2373" class="Function">maybePurpose-prop</a> <a id="2391" class="Symbol">:</a> <a id="2393" class="Symbol">∀</a> <a id="2395" class="Symbol">{</a><a id="2396" href="Ledger.Conway.Specification.Chain.html#2396" class="Bound">prps</a><a id="2400" class="Symbol">}</a> <a id="2402" class="Symbol">{</a><a id="2403" href="Ledger.Conway.Specification.Chain.html#2403" class="Bound">x</a><a id="2404" class="Symbol">}</a> <a id="2406" class="Symbol">{</a><a id="2407" href="Ledger.Conway.Specification.Chain.html#2407" class="Bound">y</a><a id="2408" class="Symbol">}</a>
  <a id="2412" class="Symbol">→</a> <a id="2414" class="Symbol">(</a><a id="2415" href="Ledger.Conway.Specification.Chain.html#2415" class="Bound">m</a> <a id="2417" class="Symbol">:</a> <a id="2419" class="Symbol">(</a><a id="2420" href="Ledger.Conway.Specification.Certs.html#548" class="Datatype">DepositPurpose</a> <a id="2435" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="2437" href="Ledger.Core.Specification.Address.html#260" class="Datatype">Credential</a><a id="2447" class="Symbol">)</a> <a id="2449" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="2451" href="Ledger.Prelude.Base.html#154" class="Function">Coin</a><a id="2455" class="Symbol">)</a>
  <a id="2459" class="Symbol">→</a> <a id="2461" class="Symbol">(</a><a id="2462" href="Ledger.Conway.Specification.Chain.html#2403" class="Bound">x</a> <a id="2464" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="2466" href="Ledger.Conway.Specification.Chain.html#2407" class="Bound">y</a><a id="2467" class="Symbol">)</a> <a id="2469" href="Class.IsSet.html#458" class="Function Operator">∈</a> <a id="2471" href="Class.IsSet.html#916" class="Function">dom</a> <a id="2475" class="Symbol">((</a><a id="2477" href="Axiom.Set.Map.html#10313" class="Function">mapMaybeWithKeyᵐ</a> <a id="2494" class="Symbol">(</a><a id="2495" href="Ledger.Conway.Specification.Chain.html#2198" class="Function">maybePurpose</a> <a id="2508" href="Ledger.Conway.Specification.Chain.html#2396" class="Bound">prps</a><a id="2512" class="Symbol">)</a> <a id="2514" href="Ledger.Conway.Specification.Chain.html#2415" class="Bound">m</a><a id="2515" class="Symbol">)</a> <a id="2517" href="Axiom.Set.Map.html#2293" class="Function Operator">ˢ</a><a id="2518" class="Symbol">)</a>
  <a id="2522" class="Symbol">→</a> <a id="2524" href="Ledger.Conway.Specification.Chain.html#2403" class="Bound">x</a> <a id="2526" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="2528" href="Ledger.Conway.Specification.Chain.html#2396" class="Bound">prps</a>
<a id="2533" href="Ledger.Conway.Specification.Chain.html#2373" class="Function">maybePurpose-prop</a> <a id="2551" class="Symbol">{</a><a id="2552" class="Argument">prps</a> <a id="2557" class="Symbol">=</a> <a id="2559" href="Ledger.Conway.Specification.Chain.html#2559" class="Bound">prps</a><a id="2563" class="Symbol">}</a> <a id="2565" class="Symbol">{</a><a id="2566" href="Ledger.Conway.Specification.Chain.html#2566" class="Bound">x</a><a id="2567" class="Symbol">}</a> <a id="2569" class="Symbol">{</a><a id="2570" href="Ledger.Conway.Specification.Chain.html#2570" class="Bound">y</a><a id="2571" class="Symbol">}</a> <a id="2573" class="Symbol">_</a> <a id="2575" href="Ledger.Conway.Specification.Chain.html#2575" class="Bound">xy∈dom</a> <a id="2582" class="Keyword">with</a> <a id="2587" href="Function.Bundles.html#4832" class="Field">from</a> <a id="2592" href="Axiom.Set.Rel.html#2472" class="Function">dom∈</a> <a id="2597" href="Ledger.Conway.Specification.Chain.html#2575" class="Bound">xy∈dom</a>
<a id="2604" class="Symbol">...</a> <a id="2608" class="Symbol">|</a> <a id="2610" href="Ledger.Conway.Specification.Chain.html#2610" class="Bound">z</a> <a id="2612" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="2614" href="Ledger.Conway.Specification.Chain.html#2614" class="Bound">∈mmwk</a> <a id="2620" class="Keyword">with</a> <a id="2625" class="Bound">prps</a> <a id="2630" href="Class.DecEq.Core.html#168" class="Field Operator">≟</a> <a id="2632" class="Bound">x</a> <a id="2634" class="Symbol">|</a> <a id="2636" href="Axiom.Set.Rel.html#5977" class="Function">∈-mapMaybeWithKey</a> <a id="2654" class="Symbol">{</a><a id="2655" class="Argument">f</a> <a id="2657" class="Symbol">=</a> <a id="2659" href="Ledger.Conway.Specification.Chain.html#2198" class="Function">maybePurpose</a> <a id="2672" class="Bound">prps</a><a id="2676" class="Symbol">}</a> <a id="2678" href="Ledger.Conway.Specification.Chain.html#2614" class="Bound">∈mmwk</a>
<a id="2684" class="Symbol">...</a> <a id="2688" class="Symbol">|</a> <a id="2690" href="Relation.Nullary.Decidable.Core.html#2099" class="InductiveConstructor">yes</a> <a id="2694" href="Agda.Builtin.Equality.html#207" class="InductiveConstructor">refl</a> <a id="2699" class="Symbol">|</a> <a id="2701" class="Symbol">_</a> <a id="2703" class="Symbol">=</a> <a id="2705" href="Agda.Builtin.Equality.html#207" class="InductiveConstructor">refl</a>

<a id="filterPurpose"></a><a id="2711" href="Ledger.Conway.Specification.Chain.html#2711" class="Function">filterPurpose</a> <a id="2725" class="Symbol">:</a> <a id="2727" href="Ledger.Conway.Specification.Certs.html#548" class="Datatype">DepositPurpose</a> <a id="2742" class="Symbol">→</a> <a id="2744" class="Symbol">(</a><a id="2745" href="Ledger.Conway.Specification.Certs.html#548" class="Datatype">DepositPurpose</a> <a id="2760" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="2762" href="Ledger.Core.Specification.Address.html#260" class="Datatype">Credential</a><a id="2772" class="Symbol">)</a> <a id="2774" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="2776" href="Ledger.Prelude.Base.html#154" class="Function">Coin</a> <a id="2781" class="Symbol">→</a> <a id="2783" href="Ledger.Core.Specification.Address.html#260" class="Datatype">Credential</a> <a id="2794" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="2796" href="Ledger.Prelude.Base.html#154" class="Function">Coin</a>
<a id="2801" href="Ledger.Conway.Specification.Chain.html#2711" class="Function">filterPurpose</a> <a id="2815" href="Ledger.Conway.Specification.Chain.html#2815" class="Bound">prps</a> <a id="2820" href="Ledger.Conway.Specification.Chain.html#2820" class="Bound">m</a> <a id="2822" class="Symbol">=</a> <a id="2824" href="Axiom.Set.Map.html#5896" class="Function">mapKeys</a> <a id="2832" href="Data.Product.Base.html#650" class="Field">proj₂</a> <a id="2838" class="Symbol">(</a><a id="2839" href="Axiom.Set.Map.html#10313" class="Function">mapMaybeWithKeyᵐ</a> <a id="2856" class="Symbol">(</a><a id="2857" href="Ledger.Conway.Specification.Chain.html#2198" class="Function">maybePurpose</a> <a id="2870" href="Ledger.Conway.Specification.Chain.html#2815" class="Bound">prps</a><a id="2874" class="Symbol">)</a> <a id="2876" href="Ledger.Conway.Specification.Chain.html#2820" class="Bound">m</a><a id="2877" class="Symbol">)</a>
  <a id="2881" class="Symbol">{λ</a> <a id="2884" class="Keyword">where</a> <a id="2890" href="Ledger.Conway.Specification.Chain.html#2890" class="Bound">x∈dom</a> <a id="2896" href="Ledger.Conway.Specification.Chain.html#2896" class="Bound">y∈dom</a> <a id="2902" href="Agda.Builtin.Equality.html#207" class="InductiveConstructor">refl</a> <a id="2907" class="Symbol">→</a> <a id="2909" href="Relation.Binary.PropositionalEquality.Core.html#1481" class="Function">cong</a> <a id="2914" class="Symbol">(</a><a id="2915" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">_,</a> <a id="2918" class="Symbol">_)</a>
                            <a id="2949" href="Function.Base.html#1993" class="Function Operator">$</a> <a id="2951" href="Relation.Binary.PropositionalEquality.Core.html#2080" class="Function">trans</a> <a id="2957" class="Symbol">(</a><a id="2958" href="Ledger.Conway.Specification.Chain.html#2373" class="Function">maybePurpose-prop</a> <a id="2976" class="Symbol">{</a><a id="2977" class="Argument">prps</a> <a id="2982" class="Symbol">=</a> <a id="2984" href="Ledger.Conway.Specification.Chain.html#2815" class="Bound">prps</a><a id="2988" class="Symbol">}</a> <a id="2990" href="Ledger.Conway.Specification.Chain.html#2820" class="Bound">m</a> <a id="2992" href="Ledger.Conway.Specification.Chain.html#2890" class="Bound">x∈dom</a><a id="2997" class="Symbol">)</a>
                            <a id="3027" href="Function.Base.html#1993" class="Function Operator">$</a> <a id="3029" href="Relation.Binary.PropositionalEquality.Core.html#2035" class="Function">sym</a>   <a id="3035" class="Symbol">(</a><a id="3036" href="Ledger.Conway.Specification.Chain.html#2373" class="Function">maybePurpose-prop</a> <a id="3054" class="Symbol">{</a><a id="3055" class="Argument">prps</a> <a id="3060" class="Symbol">=</a> <a id="3062" href="Ledger.Conway.Specification.Chain.html#2815" class="Bound">prps</a><a id="3066" class="Symbol">}</a> <a id="3068" href="Ledger.Conway.Specification.Chain.html#2820" class="Bound">m</a> <a id="3070" href="Ledger.Conway.Specification.Chain.html#2896" class="Bound">y∈dom</a><a id="3075" class="Symbol">)}</a>

<a id="govActionDeposits"></a><a id="3079" href="Ledger.Conway.Specification.Chain.html#3079" class="Function">govActionDeposits</a> <a id="3097" class="Symbol">:</a> <a id="3099" href="Ledger.Conway.Specification.Ledger.html#981" class="Record">LState</a> <a id="3106" class="Symbol">→</a> <a id="3108" href="Ledger.Conway.Specification.Gov.Actions.html#391" class="Datatype">VDeleg</a> <a id="3115" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="3117" href="Ledger.Prelude.Base.html#154" class="Function">Coin</a>
<a id="3122" href="Ledger.Conway.Specification.Chain.html#3079" class="Function">govActionDeposits</a> <a id="3140" href="Ledger.Conway.Specification.Chain.html#3140" class="Bound">ls</a> <a id="3143" class="Symbol">=</a>
  <a id="3147" class="Keyword">let</a> <a id="3151" class="Keyword">open</a> <a id="3156" href="Ledger.Conway.Specification.Ledger.html#981" class="Module">LState</a> <a id="3163" href="Ledger.Conway.Specification.Chain.html#3140" class="Bound">ls</a><a id="3165" class="Symbol">;</a> <a id="3167" class="Keyword">open</a> <a id="3172" href="Ledger.Conway.Specification.Certs.html#4090" class="Module">CertState</a> <a id="3182" href="Ledger.Conway.Specification.Ledger.html#1093" class="Field">certState</a><a id="3191" class="Symbol">;</a> <a id="3193" class="Keyword">open</a> <a id="3198" href="Ledger.Conway.Specification.Certs.html#3869" class="Module">PState</a> <a id="3205" href="Ledger.Conway.Specification.Certs.html#4173" class="Function">pState</a>
      <a id="3218" class="Keyword">open</a> <a id="3223" href="Ledger.Conway.Specification.Utxo.html#1230" class="Module">UTxOState</a> <a id="3233" href="Ledger.Conway.Specification.Ledger.html#1040" class="Field">utxoSt</a><a id="3239" class="Symbol">;</a> <a id="3241" class="Keyword">open</a> <a id="3246" href="Ledger.Conway.Specification.Certs.html#3718" class="Module">DState</a> <a id="3253" href="Ledger.Conway.Specification.Certs.html#4153" class="Function">dState</a>
   <a id="3263" class="Keyword">in</a> <a id="3266" href="Data.List.Base.html#4227" class="Function">foldl</a> <a id="3272" href="Axiom.Set.Map.Dec.html#2046" class="Function Operator">_∪⁺_</a> <a id="3277" href="Class.HasEmptySet.html#287" class="Field">∅</a> <a id="3279" href="Function.Base.html#1993" class="Function Operator">$</a> <a id="3281" href="abstract-set-theory.FiniteSetTheory.html#2463" class="Function">setToList</a> <a id="3291" href="Function.Base.html#1993" class="Function Operator">$</a>
    <a id="3297" href="Axiom.Set.html#7805" class="Function">mapPartial</a>
      <a id="3314" class="Symbol">(λ</a> <a id="3317" class="Keyword">where</a> <a id="3323" class="Symbol">(</a><a id="3324" href="Ledger.Conway.Specification.Chain.html#3324" class="Bound">gaid</a> <a id="3329" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="3331" class="Keyword">record</a> <a id="3338" class="Symbol">{</a> <a id="3340" href="Ledger.Conway.Specification.Gov.Actions.html#3443" class="Field">returnAddr</a> <a id="3351" class="Symbol">=</a> <a id="3353" class="Keyword">record</a> <a id="3360" class="Symbol">{</a><a id="3361" href="Ledger.Core.Specification.Address.html#1378" class="Field">stake</a> <a id="3367" class="Symbol">=</a> <a id="3369" href="Ledger.Conway.Specification.Chain.html#3369" class="Bound">c</a><a id="3370" class="Symbol">}</a> <a id="3372" class="Symbol">})</a> <a id="3375" class="Symbol">→</a> <a id="3377" class="Keyword">do</a>
        <a id="3388" href="Ledger.Conway.Specification.Chain.html#3388" class="Bound">vd</a> <a id="3391" href="Class.Monad.Core.html#337" class="Field Operator">←</a> <a id="3393" href="Axiom.Set.Map.html#13828" class="Function">lookupᵐ?</a> <a id="3402" href="Ledger.Conway.Specification.Certs.html#3777" class="Function">voteDelegs</a> <a id="3413" href="Ledger.Conway.Specification.Chain.html#3369" class="Bound">c</a>
        <a id="3423" href="Ledger.Conway.Specification.Chain.html#3423" class="Bound">dep</a> <a id="3427" href="Class.Monad.Core.html#337" class="Field Operator">←</a> <a id="3429" href="Axiom.Set.Map.html#13828" class="Function">lookupᵐ?</a> <a id="3438" href="Ledger.Conway.Specification.Utxo.html#1338" class="Function">deposits</a> <a id="3447" class="Symbol">(</a><a id="3448" href="Ledger.Conway.Specification.Certs.html#737" class="InductiveConstructor">GovActionDeposit</a> <a id="3465" href="Ledger.Conway.Specification.Chain.html#3324" class="Bound">gaid</a><a id="3469" class="Symbol">)</a>
        <a id="3479" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="3484" href="Class.HasSingleton.html#288" class="Field Operator">❴</a> <a id="3486" href="Ledger.Conway.Specification.Chain.html#3388" class="Bound">vd</a> <a id="3489" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="3491" href="Ledger.Conway.Specification.Chain.html#3423" class="Bound">dep</a> <a id="3495" href="Class.HasSingleton.html#288" class="Field Operator">❵</a> <a id="3497" class="Symbol">)</a>
      <a id="3505" class="Symbol">(</a><a id="3506" href="Axiom.Set.html#5718" class="Function">fromList</a> <a id="3515" href="Ledger.Conway.Specification.Ledger.html#1067" class="Field">govSt</a><a id="3520" class="Symbol">)</a>

<a id="calculateStakeDistrs"></a><a id="3523" href="Ledger.Conway.Specification.Chain.html#3523" class="Function">calculateStakeDistrs</a> <a id="3544" class="Symbol">:</a> <a id="3546" href="Ledger.Conway.Specification.Ledger.html#981" class="Record">LState</a> <a id="3553" class="Symbol">→</a> <a id="3555" href="Ledger.Conway.Specification.Ratify.html#3025" class="Record">StakeDistrs</a>
<a id="3567" href="Ledger.Conway.Specification.Chain.html#3523" class="Function">calculateStakeDistrs</a> <a id="3588" href="Ledger.Conway.Specification.Chain.html#3588" class="Bound">ls</a> <a id="3591" class="Symbol">=</a>
  <a id="3595" class="Keyword">let</a> <a id="3599" class="Keyword">open</a> <a id="3604" href="Ledger.Conway.Specification.Ledger.html#981" class="Module">LState</a> <a id="3611" href="Ledger.Conway.Specification.Chain.html#3588" class="Bound">ls</a><a id="3613" class="Symbol">;</a> <a id="3615" class="Keyword">open</a> <a id="3620" href="Ledger.Conway.Specification.Certs.html#4090" class="Module">CertState</a> <a id="3630" href="Ledger.Conway.Specification.Ledger.html#1093" class="Field">certState</a><a id="3639" class="Symbol">;</a> <a id="3641" class="Keyword">open</a> <a id="3646" href="Ledger.Conway.Specification.Certs.html#3869" class="Module">PState</a> <a id="3653" href="Ledger.Conway.Specification.Certs.html#4173" class="Function">pState</a>
      <a id="3666" class="Keyword">open</a> <a id="3671" href="Ledger.Conway.Specification.Utxo.html#1230" class="Module">UTxOState</a> <a id="3681" href="Ledger.Conway.Specification.Ledger.html#1040" class="Field">utxoSt</a><a id="3687" class="Symbol">;</a> <a id="3689" class="Keyword">open</a> <a id="3694" href="Ledger.Conway.Specification.Certs.html#3718" class="Module">DState</a> <a id="3701" href="Ledger.Conway.Specification.Certs.html#4153" class="Function">dState</a>
      <a id="3714" href="Ledger.Conway.Specification.Chain.html#3714" class="Bound">spoDelegs</a> <a id="3724" class="Symbol">=</a> <a id="3726" href="Class.HasEmptySet.html#287" class="Field">∅</a> <a id="3728" class="Comment">-- TODO</a>
      <a id="3742" href="Ledger.Conway.Specification.Chain.html#3742" class="Bound">drepDelegs</a> <a id="3753" class="Symbol">=</a> <a id="3755" href="Class.HasEmptySet.html#287" class="Field">∅</a> <a id="3757" class="Comment">-- TODO</a>
  <a id="3767" class="Keyword">in</a>
  <a id="3772" class="Keyword">record</a>
    <a id="3783" class="Symbol">{</a> <a id="3785" href="Ledger.Conway.Specification.Ratify.html#3062" class="Field">stakeDistr</a> <a id="3796" class="Symbol">=</a> <a id="3798" href="Ledger.Conway.Specification.Chain.html#3079" class="Function">govActionDeposits</a> <a id="3816" href="Ledger.Conway.Specification.Chain.html#3588" class="Bound">ls</a>
    <a id="3823" class="Symbol">}</a>

<a id="totalRefScriptsSize"></a><a id="3826" href="Ledger.Conway.Specification.Chain.html#3826" class="Function">totalRefScriptsSize</a> <a id="3846" class="Symbol">:</a> <a id="3848" href="Ledger.Conway.Specification.Ledger.html#981" class="Record">LState</a> <a id="3855" class="Symbol">→</a> <a id="3857" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="3862" href="Ledger.Conway.Specification.Transaction.html#4684" class="Record">Tx</a> <a id="3865" class="Symbol">→</a> <a id="3867" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a>
<a id="3869" href="Ledger.Conway.Specification.Chain.html#3826" class="Function">totalRefScriptsSize</a> <a id="3889" href="Ledger.Conway.Specification.Chain.html#3889" class="Bound">lst</a> <a id="3893" href="Ledger.Conway.Specification.Chain.html#3893" class="Bound">txs</a> <a id="3897" class="Symbol">=</a> <a id="3899" href="Data.Nat.ListAction.html#612" class="Function">sum</a> <a id="3903" href="Function.Base.html#1993" class="Function Operator">$</a> <a id="3905" href="Class.Functor.Core.html#272" class="Function">map</a> <a id="3909" class="Symbol">(</a><a id="3910" href="Ledger.Conway.Specification.Utxo.html#2520" class="Function">refScriptsSize</a> <a id="3925" href="Ledger.Conway.Specification.Utxo.html#1294" class="Function">utxo</a><a id="3929" class="Symbol">)</a> <a id="3931" href="Ledger.Conway.Specification.Chain.html#3893" class="Bound">txs</a>
  <a id="3937" class="Keyword">where</a> <a id="3943" class="Keyword">open</a> <a id="3948" href="Ledger.Conway.Specification.Utxo.html#1230" class="Module">UTxOState</a> <a id="3958" class="Symbol">(</a><a id="3959" href="Ledger.Conway.Specification.Ledger.html#1040" class="Field">LState.utxoSt</a> <a id="3973" href="Ledger.Conway.Specification.Chain.html#3889" class="Bound">lst</a><a id="3976" class="Symbol">)</a>

<a id="3979" class="Keyword">private</a> <a id="3987" class="Keyword">variable</a>
  <a id="3998" href="Ledger.Conway.Specification.Chain.html#3998" class="Generalizable">ls&#39;</a> <a id="4002" class="Symbol">:</a> <a id="4004" href="Ledger.Conway.Specification.Ledger.html#981" class="Record">LState</a> 
<a id="4012" class="Keyword">data</a>


  <a id="_⊢_⇀⦇_,CHAIN⦈_"></a><a id="4021" href="Ledger.Conway.Specification.Chain.html#4021" class="Datatype Operator">_⊢_⇀⦇_,CHAIN⦈_</a> <a id="4036" class="Symbol">:</a> <a id="4038" href="Agda.Builtin.Unit.html#175" class="Record">⊤</a> <a id="4040" class="Symbol">→</a> <a id="4042" href="Ledger.Conway.Specification.Chain.html#788" class="Record">ChainState</a> <a id="4053" class="Symbol">→</a> <a id="4055" href="Ledger.Conway.Specification.Chain.html#863" class="Record">Block</a> <a id="4061" class="Symbol">→</a> <a id="4063" href="Ledger.Conway.Specification.Chain.html#788" class="Record">ChainState</a> <a id="4074" class="Symbol">→</a> <a id="4076" href="Agda.Primitive.html#388" class="Primitive">Type</a>


  <a id="4085" class="Keyword">where</a>


  <a id="_⊢_⇀⦇_,CHAIN⦈_.CHAIN"></a><a id="4095" href="Ledger.Conway.Specification.Chain.html#4095" class="InductiveConstructor">CHAIN</a> <a id="4101" class="Symbol">:</a> <a id="4103" class="Symbol">{</a><a id="4104" href="Ledger.Conway.Specification.Chain.html#4104" class="Bound">b</a> <a id="4106" class="Symbol">:</a> <a id="4108" href="Ledger.Conway.Specification.Chain.html#863" class="Record">Block</a><a id="4113" class="Symbol">}</a> <a id="4115" class="Symbol">{</a><a id="4116" href="Ledger.Conway.Specification.Chain.html#4116" class="Bound">nes</a> <a id="4120" class="Symbol">:</a> <a id="4122" href="Ledger.Conway.Specification.Epoch.html#3014" class="Record">NewEpochState</a><a id="4135" class="Symbol">}</a> <a id="4137" class="Symbol">{</a><a id="4138" href="Ledger.Conway.Specification.Chain.html#4138" class="Bound">cs</a> <a id="4141" class="Symbol">:</a> <a id="4143" href="Ledger.Conway.Specification.Chain.html#788" class="Record">ChainState</a><a id="4153" class="Symbol">}</a>


    <a id="4161" class="Symbol">→</a> <a id="4163" class="Keyword">let</a> <a id="4167" class="Keyword">open</a> <a id="4172" href="Ledger.Conway.Specification.Chain.html#788" class="Module">ChainState</a> <a id="4183" href="Ledger.Conway.Specification.Chain.html#4138" class="Bound">cs</a><a id="4185" class="Symbol">;</a> <a id="4187" class="Keyword">open</a> <a id="4192" href="Ledger.Conway.Specification.Chain.html#863" class="Module">Block</a> <a id="4198" href="Ledger.Conway.Specification.Chain.html#4104" class="Bound">b</a><a id="4199" class="Symbol">;</a> <a id="4201" class="Keyword">open</a> <a id="4206" href="Ledger.Conway.Specification.Epoch.html#3014" class="Module">NewEpochState</a> <a id="4220" href="Ledger.Conway.Specification.Chain.html#4116" class="Bound">nes</a>
          <a id="4234" class="Keyword">open</a> <a id="4239" href="Ledger.Conway.Specification.Epoch.html#1705" class="Module">EpochState</a> <a id="4250" href="Ledger.Conway.Specification.Epoch.html#3077" class="Function">epochState</a><a id="4260" class="Symbol">;</a> <a id="4262" class="Keyword">open</a> <a id="4267" href="Ledger.Conway.Specification.Enact.html#448" class="Module">EnactState</a> <a id="4278" href="Ledger.Conway.Specification.Epoch.html#1846" class="Function">es</a> <a id="4281" class="Keyword">renaming</a> <a id="4290" class="Symbol">(</a><a id="4291" href="Ledger.Conway.Specification.Enact.html#658" class="Field">pparams</a> <a id="4299" class="Symbol">to</a> <a id="4302" class="Field">pp</a><a id="4304" class="Symbol">)</a>
          <a id="4316" class="Keyword">open</a> <a id="4321" href="Ledger.Conway.Specification.PParams.html#1685" class="Module">PParams</a> <a id="4329" href="Ledger.Prelude.html#2253" class="Function Operator">∣</a> <a id="4331" href="Ledger.Conway.Specification.Chain.html#4302" class="Function">pp</a> <a id="4334" href="Ledger.Prelude.html#2253" class="Function Operator">∣</a> <a id="4336" class="Keyword">using</a> <a id="4342" class="Symbol">(</a><a id="4343" href="Ledger.Conway.Specification.PParams.html#2597" class="Field">maxRefScriptSizePerBlock</a><a id="4367" class="Symbol">)</a> <a id="4369" class="Keyword">in</a>


    <a id="4378" class="Keyword">let</a>  <a id="4383" href="Ledger.Conway.Specification.Chain.html#4383" class="Bound">cs&#39;</a>  <a id="4388" class="Symbol">=</a> <a id="4390" class="Keyword">record</a> <a id="4397" href="Ledger.Conway.Specification.Chain.html#4138" class="Bound">cs</a> <a id="4400" class="Symbol">{</a>  <a id="4403" href="Ledger.Conway.Specification.Chain.html#824" class="Field">newEpochState</a>
                             <a id="4446" class="Symbol">=</a> <a id="4448" class="Keyword">record</a> <a id="4455" href="Ledger.Conway.Specification.Chain.html#4116" class="Bound">nes</a> <a id="4459" class="Symbol">{</a>  <a id="4462" href="Ledger.Conway.Specification.Epoch.html#3077" class="Field">epochState</a>
                                             <a id="4518" class="Symbol">=</a> <a id="4520" class="Keyword">record</a> <a id="4527" href="Ledger.Conway.Specification.Epoch.html#3077" class="Function">epochState</a> <a id="4538" class="Symbol">{</a><a id="4539" href="Ledger.Conway.Specification.Epoch.html#1822" class="Field">ls</a> <a id="4542" class="Symbol">=</a> <a id="4544" href="Ledger.Conway.Specification.Chain.html#3998" class="Generalizable">ls&#39;</a><a id="4547" class="Symbol">}</a> <a id="4549" class="Symbol">}</a> <a id="4551" class="Symbol">}</a>
         <a id="4562" href="Ledger.Conway.Specification.Chain.html#4562" class="Bound">Γ</a>    <a id="4567" class="Symbol">=</a> <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.Conway.Specification.Chain.html#914}{\htmlId{4571}{\htmlClass{Function}{\text{slot}}}}\, \\ \,\href{Ledger.Prelude.html#2253}{\htmlId{4578}{\htmlClass{Function Operator}{\text{∣}}}}\, \,\href{Ledger.Conway.Specification.Enact.html#553}{\htmlId{4580}{\htmlClass{Function}{\text{constitution}}}}\, \,\href{Ledger.Prelude.html#2253}{\htmlId{4593}{\htmlClass{Function Operator}{\text{∣}}}}\, \\ \,\href{Ledger.Prelude.html#2253}{\htmlId{4597}{\htmlClass{Function Operator}{\text{∣}}}}\, \,\href{Ledger.Conway.Specification.Chain.html#4302}{\htmlId{4599}{\htmlClass{Function}{\text{pp}}}}\, \,\href{Ledger.Prelude.html#2253}{\htmlId{4602}{\htmlClass{Function Operator}{\text{∣}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#1846}{\htmlId{4606}{\htmlClass{Function}{\text{es}}}}\, \\ \,\href{Ledger.Prelude.Base.html#889}{\htmlId{4611}{\htmlClass{Field}{\text{TreasuryOf}}}}\, \,\href{Ledger.Conway.Specification.Chain.html#4116}{\htmlId{4622}{\htmlClass{Bound}{\text{nes}}}}\, \end{pmatrix}$</a>
    <a id="4632" class="Keyword">in</a>
    <a id="4639" href="Prelude.InferenceRules.html#56075" class="Function Operator">∙</a> <a id="4641" href="Ledger.Conway.Specification.Chain.html#3826" class="Function">totalRefScriptsSize</a> <a id="4661" href="Ledger.Conway.Specification.Epoch.html#1822" class="Function">ls</a> <a id="4664" href="Ledger.Conway.Specification.Chain.html#894" class="Function">ts</a> <a id="4667" href="Class.HasOrder.Core.html#613" class="Field Operator">≤</a> <a id="4669" href="Ledger.Conway.Specification.PParams.html#2597" class="Function">maxRefScriptSizePerBlock</a>
    <a id="4698" href="Prelude.InferenceRules.html#56006" class="Function Operator">∙</a> <a id="4700" class="Symbol">_</a> <a id="4702" href="Ledger.Conway.Specification.Epoch.html#14763" class="Datatype Operator">⊢</a> <a id="4704" href="Ledger.Conway.Specification.Chain.html#824" class="Field">newEpochState</a> <a id="4718" href="Ledger.Conway.Specification.Epoch.html#14763" class="Datatype Operator">⇀⦇</a> <a id="4721" href="Ledger.Core.Specification.Epoch.html#810" class="Function">epoch</a> <a id="4727" href="Ledger.Conway.Specification.Chain.html#914" class="Function">slot</a> <a id="4732" href="Ledger.Conway.Specification.Epoch.html#14763" class="Datatype Operator">,NEWEPOCH⦈</a> <a id="4743" href="Ledger.Conway.Specification.Chain.html#4116" class="Bound">nes</a>
    <a id="4751" href="Prelude.InferenceRules.html#56006" class="Function Operator">∙</a> <a id="4753" href="Ledger.Conway.Specification.Chain.html#4562" class="Bound">Γ</a> <a id="4755" href="Ledger.Conway.Specification.Ledger.html#4434" class="Function Operator">⊢</a> <a id="4757" href="Ledger.Conway.Specification.Epoch.html#1822" class="Function">ls</a> <a id="4760" href="Ledger.Conway.Specification.Ledger.html#4434" class="Function Operator">⇀⦇</a> <a id="4763" href="Ledger.Conway.Specification.Chain.html#894" class="Function">ts</a> <a id="4766" href="Ledger.Conway.Specification.Ledger.html#4434" class="Function Operator">,LEDGERS⦈</a> <a id="4776" href="Ledger.Conway.Specification.Chain.html#3998" class="Generalizable">ls&#39;</a>
      <a id="4786" href="Prelude.InferenceRules.html#13694" class="Function Operator">────────────────────────────────</a>
      <a id="4825" class="Symbol">_</a> <a id="4827" href="Ledger.Conway.Specification.Chain.html#4021" class="Datatype Operator">⊢</a> <a id="4829" href="Ledger.Conway.Specification.Chain.html#4138" class="Bound">cs</a> <a id="4832" href="Ledger.Conway.Specification.Chain.html#4021" class="Datatype Operator">⇀⦇</a> <a id="4835" href="Ledger.Conway.Specification.Chain.html#4104" class="Bound">b</a> <a id="4837" href="Ledger.Conway.Specification.Chain.html#4021" class="Datatype Operator">,CHAIN⦈</a> <a id="4845" href="Ledger.Conway.Specification.Chain.html#4383" class="Bound">cs&#39;</a>

</pre></body></html>