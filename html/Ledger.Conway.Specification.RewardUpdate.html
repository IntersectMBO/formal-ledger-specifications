<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>Ledger.Conway.Specification.RewardUpdate</title><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.css"><link rel="stylesheet" href="Agda.css"><script src="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.js"></script><script src="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/contrib/auto-render.min.js"></script><script src="AgdaKaTeX.js" defer=""></script></head><body><pre class="Agda">
<a id="2" class="Symbol">{-#</a> <a id="6" class="Keyword">OPTIONS</a> <a id="14" class="Pragma">--safe</a> <a id="21" class="Symbol">#-}</a>
<a id="25" class="Keyword">open</a> <a id="30" class="Keyword">import</a> <a id="37" href="Ledger.Prelude.html" class="Module">Ledger.Prelude</a>
<a id="52" class="Keyword">open</a> <a id="57" class="Keyword">import</a> <a id="64" href="Ledger.Conway.Specification.Abstract.html" class="Module">Ledger.Conway.Specification.Abstract</a>
<a id="101" class="Keyword">open</a> <a id="106" class="Keyword">import</a> <a id="113" href="Ledger.Core.Specification.Transaction.html" class="Module">Ledger.Core.Specification.Transaction</a> <a id="151" class="Keyword">using</a> <a id="157" class="Symbol">(</a><a id="158" href="Ledger.Core.Specification.Transaction.html#896" class="Record">TransactionStructure</a><a id="178" class="Symbol">)</a>

<a id="181" class="Keyword">module</a> <a id="188" href="Ledger.Conway.Specification.RewardUpdate.html" class="Module">Ledger.Conway.Specification.RewardUpdate</a>
  <a id="231" class="Symbol">(</a><a id="232" href="Ledger.Conway.Specification.RewardUpdate.html#232" class="Bound">txs</a> <a id="236" class="Symbol">:</a> <a id="238" class="Symbol">_)</a> <a id="241" class="Symbol">(</a><a id="242" class="Keyword">open</a> <a id="247" href="Ledger.Core.Specification.Transaction.html#896" class="Module">TransactionStructure</a> <a id="268" href="Ledger.Conway.Specification.RewardUpdate.html#232" class="Bound">txs</a><a id="271" class="Symbol">)</a>
  <a id="275" class="Symbol">(</a><a id="276" href="Ledger.Conway.Specification.RewardUpdate.html#276" class="Bound">abs</a> <a id="280" class="Symbol">:</a> <a id="282" href="Ledger.Conway.Specification.Abstract.html#653" class="Record">AbstractFunctions</a> <a id="300" href="Ledger.Conway.Specification.RewardUpdate.html#232" class="Bound">txs</a><a id="303" class="Symbol">)</a> <a id="305" class="Symbol">(</a><a id="306" class="Keyword">open</a> <a id="311" href="Ledger.Conway.Specification.Abstract.html#653" class="Module">AbstractFunctions</a> <a id="329" href="Ledger.Conway.Specification.RewardUpdate.html#276" class="Bound">abs</a><a id="332" class="Symbol">)</a>
  <a id="336" class="Keyword">where</a>

<a id="343" class="Keyword">open</a> <a id="348" class="Keyword">import</a> <a id="355" href="Ledger.Conway.Specification.Epoch.html" class="Module">Ledger.Conway.Specification.Epoch</a> <a id="389" href="Ledger.Conway.Specification.RewardUpdate.html#232" class="Bound">txs</a> <a id="393" href="Ledger.Conway.Specification.RewardUpdate.html#276" class="Bound">abs</a>
<a id="397" class="Keyword">open</a> <a id="402" class="Keyword">import</a> <a id="409" href="Ledger.Conway.Specification.Rewards.html" class="Module">Ledger.Conway.Specification.Rewards</a> <a id="445" href="Ledger.Conway.Specification.RewardUpdate.html#232" class="Bound">txs</a> <a id="449" href="Ledger.Conway.Specification.RewardUpdate.html#276" class="Bound">abs</a>


<a id="RUpdEnv"></a><a id="455" href="Ledger.Conway.Specification.RewardUpdate.html#455" class="Function">RUpdEnv</a> <a id="463" class="Symbol">:</a> <a id="465" href="Agda.Primitive.html#388" class="Primitive">Type</a>
<a id="470" href="Ledger.Conway.Specification.RewardUpdate.html#455" class="Function">RUpdEnv</a> <a id="478" class="Symbol">=</a> <a id="480" href="Ledger.Conway.Specification.Rewards.html#4933" class="Function">BlocksMade</a> <a id="491" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="493" href="Ledger.Conway.Specification.Epoch.html#1835" class="Record">EpochState</a>


<a id="506" class="Keyword">data</a> <a id="_⊢_⇀⦇_,RUPD⦈_"></a><a id="511" href="Ledger.Conway.Specification.RewardUpdate.html#511" class="Datatype Operator">_⊢_⇀⦇_,RUPD⦈_</a>
  <a id="527" class="Symbol">:</a> <a id="529" href="Ledger.Conway.Specification.RewardUpdate.html#455" class="Function">RUpdEnv</a> <a id="537" class="Symbol">→</a> <a id="539" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="545" href="Ledger.Conway.Specification.Rewards.html#6276" class="Record">RewardUpdate</a> <a id="558" class="Symbol">→</a> <a id="560" href="Ledger.Core.Specification.Epoch.html#722" class="Function">Slot</a> <a id="565" class="Symbol">→</a> <a id="567" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="573" href="Ledger.Conway.Specification.Rewards.html#6276" class="Record">RewardUpdate</a> <a id="586" class="Symbol">→</a> <a id="588" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="593" class="Keyword">where</a>

  <a id="_⊢_⇀⦇_,RUPD⦈_.RUPD-Create-Reward-Update"></a><a id="602" href="Ledger.Conway.Specification.RewardUpdate.html#602" class="InductiveConstructor">RUPD-Create-Reward-Update</a> <a id="628" class="Symbol">:</a> <a id="630" class="Symbol">∀</a> <a id="632" class="Symbol">{</a><a id="633" href="Ledger.Conway.Specification.RewardUpdate.html#633" class="Bound">b</a> <a id="635" href="Ledger.Conway.Specification.RewardUpdate.html#635" class="Bound">es</a> <a id="638" href="Ledger.Conway.Specification.RewardUpdate.html#638" class="Bound">s</a><a id="639" class="Symbol">}</a> <a id="641" class="Symbol">{</a><a id="642" href="Ledger.Conway.Specification.RewardUpdate.html#642" class="Bound">ru&#39;</a> <a id="646" class="Symbol">:</a> <a id="648" href="Ledger.Conway.Specification.Rewards.html#6276" class="Record">RewardUpdate</a><a id="660" class="Symbol">}</a> <a id="662" class="Symbol">→</a>
    <a id="668" class="Keyword">let</a>
      <a id="678" href="Ledger.Conway.Specification.RewardUpdate.html#678" class="Bound">ru&#39;</a> <a id="682" class="Symbol">=</a> <a id="684" href="Ledger.Conway.Specification.Epoch.html#5485" class="Function">createRUpd</a> <a id="695" href="Ledger.Core.Specification.Epoch.html#2402" class="Function">SlotsPerEpochᶜ</a> <a id="710" href="Ledger.Conway.Specification.RewardUpdate.html#633" class="Bound">b</a> <a id="712" href="Ledger.Conway.Specification.RewardUpdate.html#635" class="Bound">es</a> <a id="715" href="Ledger.Core.Specification.Epoch.html#2648" class="Function">MaxLovelaceSupplyᶜ</a>
    <a id="738" class="Keyword">in</a>
    <a id="745" href="Prelude.InferenceRules.html#56075" class="Function Operator">∙</a> <a id="747" href="Ledger.Conway.Specification.RewardUpdate.html#638" class="Bound">s</a> <a id="749" href="Class.HasOrder.Core.html#848" class="Function Operator">&gt;</a> <a id="751" href="Ledger.Core.Specification.Epoch.html#911" class="Function">firstSlot</a> <a id="761" class="Symbol">(</a><a id="762" href="Ledger.Core.Specification.Epoch.html#858" class="Function">epoch</a> <a id="768" href="Ledger.Conway.Specification.RewardUpdate.html#638" class="Bound">s</a><a id="769" class="Symbol">)</a> <a id="771" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="773" href="Ledger.Core.Specification.Epoch.html#964" class="Function">RandomnessStabilisationWindow</a>
    <a id="807" href="Prelude.InferenceRules.html#13694" class="Function Operator">────────────────────────────────</a>
    <a id="844" class="Symbol">(</a><a id="845" href="Ledger.Conway.Specification.RewardUpdate.html#633" class="Bound">b</a> <a id="847" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="849" href="Ledger.Conway.Specification.RewardUpdate.html#635" class="Bound">es</a><a id="851" class="Symbol">)</a> <a id="853" href="Ledger.Conway.Specification.RewardUpdate.html#511" class="Datatype Operator">⊢</a> <a id="855" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a> <a id="863" href="Ledger.Conway.Specification.RewardUpdate.html#511" class="Datatype Operator">⇀⦇</a> <a id="866" href="Ledger.Conway.Specification.RewardUpdate.html#638" class="Bound">s</a> <a id="868" href="Ledger.Conway.Specification.RewardUpdate.html#511" class="Datatype Operator">,RUPD⦈</a> <a id="875" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="880" href="Ledger.Conway.Specification.RewardUpdate.html#678" class="Bound">ru&#39;</a>

  <a id="_⊢_⇀⦇_,RUPD⦈_.RUPD-Reward-Update-Exists"></a><a id="887" href="Ledger.Conway.Specification.RewardUpdate.html#887" class="InductiveConstructor">RUPD-Reward-Update-Exists</a> <a id="913" class="Symbol">:</a> <a id="915" class="Symbol">∀</a> <a id="917" class="Symbol">{</a><a id="918" href="Ledger.Conway.Specification.RewardUpdate.html#918" class="Bound">b</a> <a id="920" href="Ledger.Conway.Specification.RewardUpdate.html#920" class="Bound">es</a> <a id="923" href="Ledger.Conway.Specification.RewardUpdate.html#923" class="Bound">s</a> <a id="925" href="Ledger.Conway.Specification.RewardUpdate.html#925" class="Bound">ru</a><a id="927" class="Symbol">}</a> <a id="929" class="Symbol">→</a>
    <a id="935" href="Prelude.InferenceRules.html#45235" class="Function Operator">────────────────────────────────</a>
    <a id="972" class="Symbol">(</a><a id="973" href="Ledger.Conway.Specification.RewardUpdate.html#918" class="Bound">b</a> <a id="975" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="977" href="Ledger.Conway.Specification.RewardUpdate.html#920" class="Bound">es</a><a id="979" class="Symbol">)</a> <a id="981" href="Ledger.Conway.Specification.RewardUpdate.html#511" class="Datatype Operator">⊢</a> <a id="983" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="988" href="Ledger.Conway.Specification.RewardUpdate.html#925" class="Bound">ru</a> <a id="991" href="Ledger.Conway.Specification.RewardUpdate.html#511" class="Datatype Operator">⇀⦇</a> <a id="994" href="Ledger.Conway.Specification.RewardUpdate.html#923" class="Bound">s</a> <a id="996" href="Ledger.Conway.Specification.RewardUpdate.html#511" class="Datatype Operator">,RUPD⦈</a> <a id="1003" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="1008" href="Ledger.Conway.Specification.RewardUpdate.html#925" class="Bound">ru</a>

  <a id="_⊢_⇀⦇_,RUPD⦈_.RUPD-Reward-Too-Early"></a><a id="1014" href="Ledger.Conway.Specification.RewardUpdate.html#1014" class="InductiveConstructor">RUPD-Reward-Too-Early</a> <a id="1036" class="Symbol">:</a> <a id="1038" class="Symbol">∀</a> <a id="1040" class="Symbol">{</a><a id="1041" href="Ledger.Conway.Specification.RewardUpdate.html#1041" class="Bound">b</a> <a id="1043" href="Ledger.Conway.Specification.RewardUpdate.html#1043" class="Bound">es</a> <a id="1046" href="Ledger.Conway.Specification.RewardUpdate.html#1046" class="Bound">s</a><a id="1047" class="Symbol">}</a> <a id="1049" class="Symbol">→</a>
    <a id="1055" href="Prelude.InferenceRules.html#56075" class="Function Operator">∙</a> <a id="1057" href="Relation.Nullary.Negation.Core.html#677" class="Function Operator">¬</a> <a id="1059" href="Ledger.Conway.Specification.RewardUpdate.html#1046" class="Bound">s</a> <a id="1061" href="Class.HasOrder.Core.html#848" class="Function Operator">&gt;</a> <a id="1063" href="Ledger.Core.Specification.Epoch.html#911" class="Function">firstSlot</a> <a id="1073" class="Symbol">(</a><a id="1074" href="Ledger.Core.Specification.Epoch.html#858" class="Function">epoch</a> <a id="1080" href="Ledger.Conway.Specification.RewardUpdate.html#1046" class="Bound">s</a><a id="1081" class="Symbol">)</a> <a id="1083" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="1085" href="Ledger.Core.Specification.Epoch.html#964" class="Function">RandomnessStabilisationWindow</a>
    <a id="1119" href="Prelude.InferenceRules.html#13694" class="Function Operator">────────────────────────────────</a>
    <a id="1156" class="Symbol">(</a><a id="1157" href="Ledger.Conway.Specification.RewardUpdate.html#1041" class="Bound">b</a> <a id="1159" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1161" href="Ledger.Conway.Specification.RewardUpdate.html#1043" class="Bound">es</a><a id="1163" class="Symbol">)</a> <a id="1165" href="Ledger.Conway.Specification.RewardUpdate.html#511" class="Datatype Operator">⊢</a> <a id="1167" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a> <a id="1175" href="Ledger.Conway.Specification.RewardUpdate.html#511" class="Datatype Operator">⇀⦇</a> <a id="1178" href="Ledger.Conway.Specification.RewardUpdate.html#1046" class="Bound">s</a> <a id="1180" href="Ledger.Conway.Specification.RewardUpdate.html#511" class="Datatype Operator">,RUPD⦈</a> <a id="1187" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a>


<a id="1197" class="Keyword">data</a> <a id="_⊢_⇀⦇_,TICK⦈_"></a><a id="1202" href="Ledger.Conway.Specification.RewardUpdate.html#1202" class="Datatype Operator">_⊢_⇀⦇_,TICK⦈_</a>
  <a id="1218" class="Symbol">:</a> <a id="1220" href="Agda.Builtin.Unit.html#175" class="Record">⊤</a> <a id="1222" class="Symbol">→</a> <a id="1224" href="Ledger.Conway.Specification.Epoch.html#3362" class="Record">NewEpochState</a> <a id="1238" class="Symbol">→</a> <a id="1240" href="Ledger.Core.Specification.Epoch.html#722" class="Function">Slot</a> <a id="1245" class="Symbol">→</a> <a id="1247" href="Ledger.Conway.Specification.Epoch.html#3362" class="Record">NewEpochState</a> <a id="1261" class="Symbol">→</a> <a id="1263" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="1268" class="Keyword">where</a>

  <a id="_⊢_⇀⦇_,TICK⦈_.TICK"></a><a id="1277" href="Ledger.Conway.Specification.RewardUpdate.html#1277" class="InductiveConstructor">TICK</a> <a id="1282" class="Symbol">:</a> <a id="1284" class="Symbol">∀</a> <a id="1286" class="Symbol">{</a><a id="1287" href="Ledger.Conway.Specification.RewardUpdate.html#1287" class="Bound">slot</a> <a id="1292" href="Ledger.Conway.Specification.RewardUpdate.html#1292" class="Bound">nes</a> <a id="1296" href="Ledger.Conway.Specification.RewardUpdate.html#1296" class="Bound">nes&#39;</a> <a id="1301" href="Ledger.Conway.Specification.RewardUpdate.html#1301" class="Bound">ru&#39;&#39;</a><a id="1305" class="Symbol">}</a> <a id="1307" class="Symbol">→</a>
    <a id="1313" class="Keyword">let</a> <a id="1317" class="Keyword">open</a> <a id="1322" href="Ledger.Conway.Specification.Epoch.html#3362" class="Module">NewEpochState</a> <a id="1336" class="Keyword">in</a>
    <a id="1343" class="Comment">-- TODO: Is this really how it should be?</a>
    <a id="1389" class="Comment">-- We are skipping adoptGenesisDelegs here.</a>
    <a id="1437" href="Prelude.InferenceRules.html#56075" class="Function Operator">∙</a> <a id="1439" href="Agda.Builtin.Unit.html#212" class="InductiveConstructor">tt</a> <a id="1442" href="Ledger.Conway.Specification.Epoch.html#17911" class="Datatype Operator">⊢</a> <a id="1444" href="Ledger.Conway.Specification.RewardUpdate.html#1292" class="Bound">nes</a> <a id="1448" href="Ledger.Conway.Specification.Epoch.html#17911" class="Datatype Operator">⇀⦇</a> <a id="1451" href="Ledger.Core.Specification.Epoch.html#858" class="Function">epoch</a> <a id="1457" href="Ledger.Conway.Specification.RewardUpdate.html#1287" class="Bound">slot</a> <a id="1462" href="Ledger.Conway.Specification.Epoch.html#17911" class="Datatype Operator">,NEWEPOCH⦈</a> <a id="1473" href="Ledger.Conway.Specification.RewardUpdate.html#1296" class="Bound">nes&#39;</a>
    <a id="1482" href="Prelude.InferenceRules.html#56006" class="Function Operator">∙</a> <a id="1484" class="Symbol">(</a><a id="1485" href="Ledger.Conway.Specification.RewardUpdate.html#1292" class="Bound">nes</a> <a id="1489" class="Symbol">.</a><a id="1490" href="Ledger.Conway.Specification.Epoch.html#3425" class="Field">bprev</a> <a id="1496" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1498" href="Ledger.Conway.Specification.RewardUpdate.html#1292" class="Bound">nes</a> <a id="1502" class="Symbol">.</a><a id="1503" href="Ledger.Conway.Specification.Epoch.html#3483" class="Field">epochState</a><a id="1513" class="Symbol">)</a> <a id="1515" href="Ledger.Conway.Specification.RewardUpdate.html#511" class="Datatype Operator">⊢</a> <a id="1517" class="Symbol">(</a><a id="1518" href="Ledger.Conway.Specification.RewardUpdate.html#1296" class="Bound">nes&#39;</a> <a id="1523" class="Symbol">.</a><a id="1524" href="Ledger.Conway.Specification.Epoch.html#3512" class="Field">ru</a><a id="1526" class="Symbol">)</a> <a id="1528" href="Ledger.Conway.Specification.RewardUpdate.html#511" class="Datatype Operator">⇀⦇</a> <a id="1531" href="Ledger.Conway.Specification.RewardUpdate.html#1287" class="Bound">slot</a> <a id="1536" href="Ledger.Conway.Specification.RewardUpdate.html#511" class="Datatype Operator">,RUPD⦈</a> <a id="1543" href="Ledger.Conway.Specification.RewardUpdate.html#1301" class="Bound">ru&#39;&#39;</a>
      <a id="1554" href="Prelude.InferenceRules.html#13694" class="Function Operator">────────────────────────────────</a>
      <a id="1593" href="Agda.Builtin.Unit.html#212" class="InductiveConstructor">tt</a> <a id="1596" href="Ledger.Conway.Specification.RewardUpdate.html#1202" class="Datatype Operator">⊢</a> <a id="1598" href="Ledger.Conway.Specification.RewardUpdate.html#1292" class="Bound">nes</a> <a id="1602" href="Ledger.Conway.Specification.RewardUpdate.html#1202" class="Datatype Operator">⇀⦇</a> <a id="1605" href="Ledger.Conway.Specification.RewardUpdate.html#1287" class="Bound">slot</a> <a id="1610" href="Ledger.Conway.Specification.RewardUpdate.html#1202" class="Datatype Operator">,TICK⦈</a> <a id="1617" class="Keyword">record</a> <a id="1624" href="Ledger.Conway.Specification.RewardUpdate.html#1296" class="Bound">nes&#39;</a> <a id="1629" class="Symbol">{</a> <a id="1631" href="Ledger.Conway.Specification.Epoch.html#3512" class="Field">ru</a> <a id="1634" class="Symbol">=</a> <a id="1636" href="Ledger.Conway.Specification.RewardUpdate.html#1301" class="Bound">ru&#39;&#39;</a> <a id="1641" class="Symbol">}</a>

</pre></body></html>