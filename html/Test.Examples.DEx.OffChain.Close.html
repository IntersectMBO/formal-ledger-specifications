<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>Test.Examples.DEx.OffChain.Close</title><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.css"><link rel="stylesheet" href="Agda.css"><script src="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.js"></script><script src="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/contrib/auto-render.min.js"></script><script src="AgdaKaTeX.js" defer=""></script></head><body><pre class="Agda"><a id="1" class="Symbol">{-#</a> <a id="5" class="Keyword">OPTIONS</a> <a id="13" class="Pragma">--safe</a> <a id="20" class="Symbol">#-}</a>

<a id="25" class="Keyword">module</a> <a id="32" href="Test.Examples.DEx.OffChain.Close.html" class="Module">Test.Examples.DEx.OffChain.Close</a> <a id="65" class="Keyword">where</a>

<a id="72" class="Keyword">open</a> <a id="77" class="Keyword">import</a> <a id="84" href="Ledger.Prelude.html" class="Module">Ledger.Prelude</a>
<a id="99" class="Keyword">open</a> <a id="104" class="Keyword">import</a> <a id="111" href="Ledger.Conway.Specification.Transaction.html" class="Module">Ledger.Conway.Specification.Transaction</a>

<a id="152" class="Keyword">open</a> <a id="157" class="Keyword">import</a> <a id="164" href="Test.Examples.DEx.Datum.html" class="Module">Test.Examples.DEx.Datum</a>
<a id="188" class="Keyword">open</a> <a id="193" class="Keyword">import</a> <a id="200" href="Test.Examples.DEx.Validator.html" class="Module">Test.Examples.DEx.Validator</a>
<a id="228" class="Keyword">open</a> <a id="233" class="Keyword">import</a> <a id="240" href="Test.Examples.DEx.OffChain.Lib.html" class="Module">Test.Examples.DEx.OffChain.Lib</a>
<a id="271" class="Keyword">open</a> <a id="276" class="Keyword">import</a> <a id="283" href="Test.Prelude.html" class="Module">Test.Prelude</a> <a id="296" href="Test.Examples.DEx.Datum.html#695" class="Function">DExData</a>
<a id="304" class="Keyword">open</a> <a id="309" class="Keyword">import</a> <a id="316" href="Test.SymbolicData.html" class="Module">Test.SymbolicData</a> <a id="334" href="Test.Examples.DEx.Datum.html#695" class="Function">DExData</a>
<a id="342" class="Keyword">open</a> <a id="347" class="Keyword">import</a> <a id="354" href="Test.LedgerImplementation.html" class="Module">Test.LedgerImplementation</a> <a id="380" href="Test.SymbolicData.html#240" class="Function">SData</a> <a id="386" href="Test.SymbolicData.html#240" class="Function">SData</a>
<a id="392" class="Keyword">open</a> <a id="397" class="Keyword">import</a> <a id="404" href="Test.AbstractImplementation.html" class="Module">Test.AbstractImplementation</a> <a id="432" href="Test.SymbolicData.html#2904" class="Function">valContext</a>
<a id="443" class="Keyword">open</a> <a id="448" class="Keyword">import</a> <a id="455" href="Test.Lib.html" class="Module">Test.Lib</a> <a id="464" href="Test.SymbolicData.html#2904" class="Function">valContext</a>

<a id="476" class="Keyword">open</a> <a id="481" class="Keyword">import</a> <a id="488" href="Ledger.Conway.Specification.Utxo.html" class="Module">Ledger.Conway.Specification.Utxo</a> <a id="521" href="Test.LedgerImplementation.html#4278" class="Function">SVTransactionStructure</a> <a id="544" href="Test.AbstractImplementation.html#675" class="Function">SVAbstractFunctions</a>

<a id="565" class="Keyword">open</a> <a id="570" href="Ledger.Conway.Specification.Transaction.html#999" class="Module">TransactionStructure</a> <a id="591" href="Test.LedgerImplementation.html#4278" class="Function">SVTransactionStructure</a>
<a id="614" class="Keyword">open</a> <a id="619" href="Test.LedgerImplementation.html#1055" class="Module">Implementation</a>

<a id="makeCloseTx"></a><a id="635" href="Test.Examples.DEx.OffChain.Close.html#635" class="Function">makeCloseTx</a> <a id="647" class="Symbol">:</a> <a id="649" class="Symbol">(</a><a id="650" href="Test.Examples.DEx.OffChain.Close.html#650" class="Bound">id</a> <a id="653" class="Symbol">:</a> <a id="655" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a><a id="656" class="Symbol">)</a> <a id="658" class="Symbol">→</a> <a id="660" href="Ledger.Conway.Specification.Utxo.html#1226" class="Record">UTxOState</a> <a id="670" class="Symbol">→</a> <a id="672" href="Test.LedgerImplementation.html#1449" class="Function">PlutusScript</a> <a id="685" class="Symbol">→</a> <a id="687" class="Symbol">(</a><a id="688" href="Test.Examples.DEx.OffChain.Close.html#688" class="Bound">w</a> <a id="690" class="Symbol">:</a> <a id="692" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a><a id="693" class="Symbol">)</a> <a id="695" class="Symbol">→</a> <a id="697" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="703" href="Ledger.Conway.Specification.Transaction.html#4865" class="Record">Tx</a>
<a id="706" href="Test.Examples.DEx.OffChain.Close.html#635" class="Function">makeCloseTx</a> <a id="718" href="Test.Examples.DEx.OffChain.Close.html#718" class="Bound">id</a> <a id="721" href="Test.Examples.DEx.OffChain.Close.html#721" class="Bound">state</a> <a id="727" href="Test.Examples.DEx.OffChain.Close.html#727" class="Bound">script</a><a id="733" class="Symbol">@(</a><a id="735" href="Test.Examples.DEx.OffChain.Close.html#735" class="Bound">sh</a> <a id="738" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="740" class="Symbol">_)</a> <a id="743" href="Test.Examples.DEx.OffChain.Close.html#743" class="Bound">w</a> <a id="745" class="Symbol">=</a>
  <a id="749" class="Keyword">let</a>
    <a id="757" href="Test.Examples.DEx.OffChain.Close.html#757" class="Bound">wutxo</a> <a id="763" class="Symbol">=</a> <a id="765" href="Test.Examples.DEx.OffChain.Lib.html#2065" class="Function">getWalletUTxO</a> <a id="779" href="Test.Examples.DEx.OffChain.Close.html#743" class="Bound">w</a> <a id="781" class="Symbol">(</a><a id="782" href="Ledger.Conway.Specification.Utxo.html#1290" class="Field">UTxOState.utxo</a> <a id="797" href="Test.Examples.DEx.OffChain.Close.html#721" class="Bound">state</a><a id="802" class="Symbol">)</a>
  <a id="806" class="Keyword">in</a>
    <a id="813" href="Data.Maybe.Base.html#1276" class="Function">maybe</a> <a id="819" class="Symbol">(λ</a> <a id="822" class="Symbol">{</a> <a id="824" class="Symbol">(</a><a id="825" href="Test.Examples.DEx.OffChain.Close.html#825" class="Bound">scIn</a> <a id="830" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="832" class="Symbol">(</a><a id="833" href="Test.Examples.DEx.OffChain.Close.html#833" class="Bound">fst</a> <a id="837" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="839" href="Test.Examples.DEx.OffChain.Close.html#839" class="Bound">txValue</a> <a id="847" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="849" href="Test.Examples.DEx.OffChain.Close.html#849" class="Bound">snd</a><a id="852" class="Symbol">))</a> <a id="855" class="Symbol">→</a>
    <a id="861" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="866" class="Symbol">(</a>
          <a id="878" class="Keyword">record</a> <a id="885" class="Symbol">{</a> <a id="887" href="Ledger.Conway.Specification.Transaction.html#4897" class="Field">body</a> <a id="892" class="Symbol">=</a> <a id="894" class="Keyword">record</a> <a id="901" href="Test.Examples.DEx.OffChain.Lib.html#465" class="Function">defaultTxBody</a>
                         <a id="940" class="Symbol">{</a> <a id="942" href="Ledger.Conway.Specification.Transaction.html#3215" class="Field">txIns</a> <a id="948" class="Symbol">=</a> <a id="950" href="Axiom.Set.html#5903" class="Function">Ledger.Prelude.fromList</a> <a id="974" class="Symbol">((</a><a id="976" href="Test.Examples.DEx.OffChain.Close.html#825" class="Bound">scIn</a> <a id="981" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="983" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a><a id="985" class="Symbol">)</a> <a id="987" href="Data.List.Base.html#1712" class="Function Operator">++</a> <a id="990" class="Symbol">(</a><a id="991" href="Class.Functor.Core.html#272" class="Function">map</a> <a id="995" href="Data.Product.Base.html#636" class="Field">proj₁</a> <a id="1001" href="Test.Examples.DEx.OffChain.Close.html#757" class="Bound">wutxo</a><a id="1006" class="Symbol">))</a>
                         <a id="1034" class="Symbol">;</a> <a id="1036" href="Ledger.Conway.Specification.Transaction.html#3323" class="Field">txOuts</a> <a id="1043" class="Symbol">=</a> <a id="1045" href="Test.Lib.html#5531" class="Function">fromListIx</a> <a id="1056" class="Symbol">(</a><a id="1057" href="Test.Examples.DEx.OffChain.Lib.html#3147" class="Function">makeFeeUnPaymentTxOut</a> <a id="1079" href="Test.Examples.DEx.OffChain.Close.html#757" class="Bound">wutxo</a> <a id="1085" href="Test.Examples.DEx.OffChain.Close.html#839" class="Bound">txValue</a><a id="1092" class="Symbol">)</a>
                         <a id="1119" class="Symbol">;</a> <a id="1121" href="Ledger.Conway.Specification.Transaction.html#3363" class="Field">txId</a> <a id="1126" class="Symbol">=</a> <a id="1128" href="Test.Examples.DEx.OffChain.Close.html#718" class="Bound">id</a>
                         <a id="1156" class="Symbol">;</a> <a id="1158" href="Ledger.Conway.Specification.Transaction.html#3287" class="Field">collateralInputs</a> <a id="1175" class="Symbol">=</a> <a id="1177" href="Axiom.Set.html#5903" class="Function">Ledger.Prelude.fromList</a> <a id="1201" class="Symbol">(</a><a id="1202" href="Class.Functor.Core.html#272" class="Function">map</a> <a id="1206" href="Data.Product.Base.html#636" class="Field">proj₁</a> <a id="1212" href="Test.Examples.DEx.OffChain.Close.html#757" class="Bound">wutxo</a><a id="1217" class="Symbol">)</a>
                         <a id="1244" class="Symbol">;</a> <a id="1246" href="Ledger.Conway.Specification.Transaction.html#3856" class="Field">reqSignerHashes</a> <a id="1262" class="Symbol">=</a> <a id="1264" href="Axiom.Set.html#5903" class="Function">Ledger.Prelude.fromList</a> <a id="1288" class="Symbol">(</a><a id="1289" href="Test.Examples.DEx.OffChain.Close.html#743" class="Bound">w</a> <a id="1291" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="1293" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a><a id="1295" class="Symbol">)</a> 
                         <a id="1323" class="Symbol">}</a> <a id="1325" class="Symbol">;</a>
                <a id="1343" href="Ledger.Conway.Specification.Transaction.html#4921" class="Field">wits</a> <a id="1348" class="Symbol">=</a> <a id="1350" class="Keyword">record</a> <a id="1357" class="Symbol">{</a> <a id="1359" href="Ledger.Conway.Specification.Transaction.html#4661" class="Field">vkSigs</a> <a id="1366" class="Symbol">=</a> <a id="1368" href="Axiom.Set.Map.html#2713" class="Function">fromListᵐ</a> <a id="1378" class="Symbol">((</a><a id="1380" href="Test.Examples.DEx.OffChain.Close.html#743" class="Bound">w</a> <a id="1382" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1384" class="Symbol">(</a><a id="1385" href="Class.HasAdd.Core.html#162" class="Field Operator">_+_</a> <a id="1389" class="Symbol">{{</a><a id="1391" href="Class.HasAdd.Instances.html#143" class="Function">addNat</a><a id="1397" class="Symbol">}}</a> <a id="1400" class="Symbol">(</a><a id="1401" href="Test.Examples.DEx.OffChain.Lib.html#3935" class="Function">getTxId</a> <a id="1409" href="Test.Examples.DEx.OffChain.Close.html#757" class="Bound">wutxo</a><a id="1414" class="Symbol">)</a> <a id="1416" href="Test.Examples.DEx.OffChain.Close.html#743" class="Bound">w</a><a id="1417" class="Symbol">)</a> <a id="1419" class="Symbol">)</a> <a id="1421" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="1423" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a><a id="1425" class="Symbol">)</a> <a id="1427" class="Symbol">;</a>
                                <a id="1461" href="Ledger.Conway.Specification.Transaction.html#4689" class="Field">scripts</a> <a id="1469" class="Symbol">=</a> <a id="1471" href="Axiom.Set.html#5903" class="Function">Ledger.Prelude.fromList</a> <a id="1495" class="Symbol">((</a><a id="1497" href="Data.Sum.Base.html#700" class="InductiveConstructor">inj₂</a> <a id="1502" href="Test.Examples.DEx.OffChain.Close.html#727" class="Bound">script</a><a id="1508" class="Symbol">)</a> <a id="1510" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="1512" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a><a id="1514" class="Symbol">)</a> <a id="1516" class="Symbol">;</a>
                                <a id="1550" href="Ledger.Conway.Specification.Transaction.html#4715" class="Field">txdats</a> <a id="1557" class="Symbol">=</a> <a id="1559" href="Class.HasEmptySet.html#287" class="Field">∅</a> <a id="1561" class="Symbol">;</a> 
                                <a id="1596" href="Ledger.Conway.Specification.Transaction.html#4740" class="Field">txrdmrs</a> <a id="1604" class="Symbol">=</a> <a id="1606" href="Axiom.Set.Map.html#2713" class="Function">fromListᵐ</a> <a id="1616" class="Symbol">(((</a><a id="1619" href="Ledger.Conway.Specification.Transaction.html#881" class="InductiveConstructor">Spend</a> <a id="1625" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1627" class="Symbol">(</a><a id="1628" href="Data.Product.Base.html#650" class="Field">proj₂</a> <a id="1634" href="Test.Examples.DEx.OffChain.Close.html#825" class="Bound">scIn</a><a id="1638" class="Symbol">))</a> <a id="1641" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a>
                                                      <a id="1697" href="Data.Sum.Base.html#675" class="InductiveConstructor">inj₁</a> <a id="1702" class="Symbol">(</a><a id="1703" href="Data.Sum.Base.html#700" class="InductiveConstructor">inj₂</a> <a id="1708" href="Test.Examples.DEx.Datum.html#588" class="InductiveConstructor">Close</a><a id="1713" class="Symbol">)</a> <a id="1715" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> 
                                                      <a id="1772" class="Symbol">((</a><a id="1774" href="Test.Examples.DEx.OffChain.Lib.html#3935" class="Function">getTxId</a> <a id="1782" href="Test.Examples.DEx.OffChain.Close.html#757" class="Bound">wutxo</a><a id="1787" class="Symbol">)</a> <a id="1789" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1791" href="Test.Examples.DEx.OffChain.Close.html#743" class="Bound">w</a><a id="1792" class="Symbol">))</a> <a id="1795" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="1797" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a><a id="1799" class="Symbol">)</a> <a id="1801" class="Symbol">}</a> <a id="1803" class="Symbol">;</a>
                <a id="1821" href="Ledger.Conway.Specification.Transaction.html#4950" class="Field">txsize</a> <a id="1828" class="Symbol">=</a> <a id="1830" class="Number">10</a> <a id="1833" class="Symbol">;</a>
                <a id="1851" href="Ledger.Conway.Specification.Transaction.html#4969" class="Field">isValid</a> <a id="1859" class="Symbol">=</a> <a id="1861" href="Agda.Builtin.Bool.html#198" class="InductiveConstructor">true</a> <a id="1866" class="Symbol">;</a>
                <a id="1884" href="Ledger.Conway.Specification.Transaction.html#4991" class="Field">txAD</a> <a id="1889" class="Symbol">=</a> <a id="1891" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a> <a id="1899" class="Symbol">}</a>
                <a id="1917" class="Symbol">)</a>
            <a id="1931" class="Symbol">})</a>
          <a id="1944" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a>
          <a id="1962" class="Symbol">(</a><a id="1963" href="Test.Examples.DEx.OffChain.Lib.html#1556" class="Function">getScriptUTxO</a> <a id="1977" href="Test.Examples.DEx.OffChain.Close.html#735" class="Bound">sh</a> <a id="1980" class="Symbol">(</a><a id="1981" href="Ledger.Conway.Specification.Utxo.html#1290" class="Field">UTxOState.utxo</a> <a id="1996" href="Test.Examples.DEx.OffChain.Close.html#721" class="Bound">state</a><a id="2001" class="Symbol">))</a>

</pre></body></html>