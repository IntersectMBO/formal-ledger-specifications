<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>Ledger.Epoch</title><link rel="stylesheet" href="Agda.css"></head><body><pre class="Agda">
<a id="2" class="Symbol">{-#</a> <a id="6" class="Keyword">OPTIONS</a> <a id="14" class="Pragma">--safe</a> <a id="21" class="Symbol">#-}</a>

<a id="26" class="Keyword">open</a> <a id="31" class="Keyword">import</a> <a id="38" href="Data.Nat.Properties.html" class="Module">Data.Nat.Properties</a> <a id="58" class="Keyword">using</a> <a id="64" class="Symbol">(</a><a id="65" href="Data.Nat.Properties.html#17056" class="Function">+-0-monoid</a><a id="75" class="Symbol">;</a> <a id="77" href="Data.Nat.Properties.html#17135" class="Function">+-0-commutativeMonoid</a><a id="98" class="Symbol">)</a>
<a id="100" class="Keyword">open</a> <a id="105" class="Keyword">import</a> <a id="112" href="Data.List.html" class="Module">Data.List</a> <a id="122" class="Keyword">using</a> <a id="128" class="Symbol">(</a><a id="129" href="Data.List.Base.html#10687" class="Function">filter</a><a id="135" class="Symbol">)</a>
<a id="137" class="Keyword">open</a> <a id="142" class="Keyword">import</a> <a id="149" href="Data.Integer.html" class="Module">Data.Integer</a> <a id="162" class="Keyword">using</a> <a id="168" class="Symbol">()</a> <a id="171" class="Keyword">renaming</a> <a id="180" class="Symbol">(</a><a id="181" href="Agda.Builtin.Int.html#263" class="InductiveConstructor">+_</a> <a id="184" class="Symbol">to</a> <a id="187" class="InductiveConstructor">pos</a><a id="190" class="Symbol">)</a>
<a id="192" class="Keyword">open</a> <a id="197" class="Keyword">import</a> <a id="204" href="Data.Integer.Ext.html" class="Module">Data.Integer.Ext</a>
<a id="221" class="Keyword">open</a> <a id="226" class="Keyword">import</a> <a id="233" href="Data.Nat.GeneralisedArithmetic.html" class="Module">Data.Nat.GeneralisedArithmetic</a> <a id="264" class="Keyword">using</a> <a id="270" class="Symbol">(</a><a id="271" href="Data.Nat.GeneralisedArithmetic.html#866" class="Function">iterate</a><a id="278" class="Symbol">)</a>

<a id="281" class="Keyword">open</a> <a id="286" class="Keyword">import</a> <a id="293" href="Agda.Builtin.FromNat.html" class="Module">Agda.Builtin.FromNat</a>

<a id="315" class="Keyword">open</a> <a id="320" class="Keyword">import</a> <a id="327" href="Ledger.Prelude.html" class="Module">Ledger.Prelude</a> <a id="342" class="Keyword">hiding</a> <a id="349" class="Symbol">(</a><a id="350" href="Data.List.Base.html#5412" class="Function">iterate</a><a id="357" class="Symbol">)</a>
<a id="359" class="Keyword">open</a> <a id="364" class="Keyword">import</a> <a id="371" href="Ledger.Abstract.html" class="Module">Ledger.Abstract</a>
<a id="387" class="Keyword">open</a> <a id="392" class="Keyword">import</a> <a id="399" href="Ledger.Transaction.html" class="Module">Ledger.Transaction</a>

<a id="419" class="Keyword">module</a> <a id="426" href="Ledger.Epoch.html" class="Module">Ledger.Epoch</a>
  <a id="441" class="Symbol">(</a><a id="442" href="Ledger.Epoch.html#442" class="Bound">txs</a> <a id="446" class="Symbol">:</a> <a id="448" class="Symbol">_)</a> <a id="451" class="Symbol">(</a><a id="452" class="Keyword">open</a> <a id="457" href="Ledger.Transaction.html#867" class="Module">TransactionStructure</a> <a id="478" href="Ledger.Epoch.html#442" class="Bound">txs</a><a id="481" class="Symbol">)</a>
  <a id="485" class="Symbol">(</a><a id="486" href="Ledger.Epoch.html#486" class="Bound">abs</a> <a id="490" class="Symbol">:</a> <a id="492" href="Ledger.Abstract.html#578" class="Record">AbstractFunctions</a> <a id="510" href="Ledger.Epoch.html#442" class="Bound">txs</a><a id="513" class="Symbol">)</a> <a id="515" class="Symbol">(</a><a id="516" class="Keyword">open</a> <a id="521" href="Ledger.Abstract.html#578" class="Module">AbstractFunctions</a> <a id="539" href="Ledger.Epoch.html#486" class="Bound">abs</a><a id="542" class="Symbol">)</a>
  <a id="546" class="Keyword">where</a>

<a id="553" class="Keyword">open</a> <a id="558" class="Keyword">import</a> <a id="565" href="Ledger.Gov.html" class="Module">Ledger.Gov</a> <a id="576" href="Ledger.Epoch.html#442" class="Bound">txs</a>
<a id="580" class="Keyword">open</a> <a id="585" class="Keyword">import</a> <a id="592" href="Ledger.Enact.html" class="Module">Ledger.Enact</a> <a id="605" href="Ledger.Transaction.html#1809" class="Function">govStructure</a>
<a id="618" class="Keyword">open</a> <a id="623" class="Keyword">import</a> <a id="630" href="Ledger.Ledger.html" class="Module">Ledger.Ledger</a> <a id="644" href="Ledger.Epoch.html#442" class="Bound">txs</a> <a id="648" href="Ledger.Epoch.html#486" class="Bound">abs</a>
<a id="652" class="Keyword">open</a> <a id="657" class="Keyword">import</a> <a id="664" href="Ledger.Ratify.html" class="Module">Ledger.Ratify</a> <a id="678" href="Ledger.Epoch.html#442" class="Bound">txs</a>
<a id="682" class="Keyword">open</a> <a id="687" class="Keyword">import</a> <a id="694" href="Ledger.Utxo.html" class="Module">Ledger.Utxo</a> <a id="706" href="Ledger.Epoch.html#442" class="Bound">txs</a> <a id="710" href="Ledger.Epoch.html#486" class="Bound">abs</a>
<a id="714" class="Keyword">open</a> <a id="719" class="Keyword">import</a> <a id="726" href="Ledger.Certs.html" class="Module">Ledger.Certs</a> <a id="739" href="Ledger.Transaction.html#1809" class="Function">govStructure</a>


<a id="754" class="Keyword">record</a> <a id="RewardUpdate"></a><a id="761" href="Ledger.Epoch.html#761" class="Record">RewardUpdate</a> <a id="774" class="Symbol">:</a> <a id="776" href="Agda.Primitive.html#388" class="Primitive">Set</a> <a id="780" class="Keyword">where</a>


  <a id="790" class="Keyword">constructor</a> <a id="⟦_,_,_,_⟧ʳᵘ"></a><a id="802" href="Ledger.Epoch.html#802" class="InductiveConstructor Operator">⟦_,_,_,_⟧ʳᵘ</a>


  <a id="818" class="Keyword">field</a>
    <a id="RewardUpdate.Δt"></a><a id="828" href="Ledger.Epoch.html#828" class="Field">Δt</a> <a id="RewardUpdate.Δr"></a><a id="831" href="Ledger.Epoch.html#831" class="Field">Δr</a> <a id="RewardUpdate.Δf"></a><a id="834" href="Ledger.Epoch.html#834" class="Field">Δf</a> <a id="837" class="Symbol">:</a> <a id="839" href="Agda.Builtin.Int.html#245" class="Datatype">ℤ</a>
    <a id="RewardUpdate.rs"></a><a id="845" href="Ledger.Epoch.html#845" class="Field">rs</a> <a id="848" class="Symbol">:</a> <a id="850" href="Ledger.Address.html#273" class="Datatype">Credential</a> <a id="861" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="863" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a>


<a id="870" class="Keyword">record</a> <a id="Snapshot"></a><a id="877" href="Ledger.Epoch.html#877" class="Record">Snapshot</a> <a id="886" class="Symbol">:</a> <a id="888" href="Agda.Primitive.html#388" class="Primitive">Set</a> <a id="892" class="Keyword">where</a>
  <a id="900" class="Keyword">field</a>
    <a id="Snapshot.stake"></a><a id="910" href="Ledger.Epoch.html#910" class="Field">stake</a>        <a id="923" class="Symbol">:</a> <a id="925" href="Ledger.Address.html#273" class="Datatype">Credential</a> <a id="936" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="938" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a>
    <a id="Snapshot.delegations"></a><a id="947" href="Ledger.Epoch.html#947" class="Field">delegations</a>  <a id="960" class="Symbol">:</a> <a id="962" href="Ledger.Address.html#273" class="Datatype">Credential</a> <a id="973" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="975" href="Ledger.Crypto.html#1310" class="Function">KeyHash</a>
    <a id="987" class="Comment">-- poolParameters : KeyHash ⇀ PoolParam</a>

<a id="1028" class="Keyword">record</a> <a id="Snapshots"></a><a id="1035" href="Ledger.Epoch.html#1035" class="Record">Snapshots</a> <a id="1045" class="Symbol">:</a> <a id="1047" href="Agda.Primitive.html#388" class="Primitive">Set</a> <a id="1051" class="Keyword">where</a>
  <a id="1059" class="Keyword">field</a>
    <a id="Snapshots.mark"></a><a id="1069" href="Ledger.Epoch.html#1069" class="Field">mark</a> <a id="Snapshots.set"></a><a id="1074" href="Ledger.Epoch.html#1074" class="Field">set</a> <a id="Snapshots.go"></a><a id="1078" href="Ledger.Epoch.html#1078" class="Field">go</a>  <a id="1082" class="Symbol">:</a> <a id="1084" href="Ledger.Epoch.html#877" class="Record">Snapshot</a>
    <a id="Snapshots.feeSS"></a><a id="1097" href="Ledger.Epoch.html#1097" class="Field">feeSS</a>        <a id="1110" class="Symbol">:</a> <a id="1112" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a>



<a id="1120" class="Keyword">record</a> <a id="EpochState"></a><a id="1127" href="Ledger.Epoch.html#1127" class="Record">EpochState</a> <a id="1138" class="Symbol">:</a> <a id="1140" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="1145" class="Keyword">where</a>


  <a id="1155" class="Keyword">constructor</a> <a id="⟦_,_,_,_,_⟧ᵉ&#39;"></a><a id="1167" href="Ledger.Epoch.html#1167" class="InductiveConstructor Operator">⟦_,_,_,_,_⟧ᵉ&#39;</a>


  <a id="1185" class="Keyword">field</a>
    <a id="EpochState.acnt"></a><a id="1195" href="Ledger.Epoch.html#1195" class="Field">acnt</a>       <a id="1206" class="Symbol">:</a> <a id="1208" href="Ledger.PParams.html#674" class="Record">Acnt</a>
    <a id="EpochState.ss"></a><a id="1217" href="Ledger.Epoch.html#1217" class="Field">ss</a>         <a id="1228" class="Symbol">:</a> <a id="1230" href="Ledger.Epoch.html#1035" class="Record">Snapshots</a>
    <a id="EpochState.ls"></a><a id="1244" href="Ledger.Epoch.html#1244" class="Field">ls</a>         <a id="1255" class="Symbol">:</a> <a id="1257" href="Ledger.Ledger.html#715" class="Record">LState</a>
    <a id="EpochState.es"></a><a id="1268" href="Ledger.Epoch.html#1268" class="Field">es</a>         <a id="1279" class="Symbol">:</a> <a id="1281" href="Ledger.Enact.html#397" class="Record">EnactState</a>
    <a id="EpochState.fut"></a><a id="1296" href="Ledger.Epoch.html#1296" class="Field">fut</a>        <a id="1307" class="Symbol">:</a> <a id="1309" href="Ledger.Ratify.html#3255" class="Record">RatifyState</a>


<a id="1323" class="Keyword">record</a> <a id="NewEpochState"></a><a id="1330" href="Ledger.Epoch.html#1330" class="Record">NewEpochState</a> <a id="1344" class="Symbol">:</a> <a id="1346" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="1351" class="Keyword">where</a>
  <a id="1359" class="Keyword">field</a>
    <a id="NewEpochState.lastEpoch"></a><a id="1369" href="Ledger.Epoch.html#1369" class="Field">lastEpoch</a>   <a id="1381" class="Symbol">:</a> <a id="1383" href="Ledger.Types.Epoch.html#476" class="Function">Epoch</a>
    <a id="NewEpochState.epochState"></a><a id="1393" href="Ledger.Epoch.html#1393" class="Field">epochState</a>  <a id="1405" class="Symbol">:</a> <a id="1407" href="Ledger.Epoch.html#1127" class="Record">EpochState</a>
    <a id="NewEpochState.ru"></a><a id="1422" href="Ledger.Epoch.html#1422" class="Field">ru</a>          <a id="1434" class="Symbol">:</a> <a id="1436" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="1442" href="Ledger.Epoch.html#761" class="Record">RewardUpdate</a>


<a id="1457" class="Keyword">instance</a>
  <a id="1468" class="Keyword">unquoteDecl</a> <a id="To-RewardUpdate"></a><a id="1480" href="Ledger.Epoch.html#1480" class="Function">To-RewardUpdate</a> <a id="To-Snapshot"></a><a id="1496" href="Ledger.Epoch.html#1496" class="Function">To-Snapshot</a> <a id="To-Snapshots"></a><a id="1508" href="Ledger.Epoch.html#1508" class="Function">To-Snapshots</a> <a id="To-EpochState"></a><a id="1521" href="Ledger.Epoch.html#1521" class="Function">To-EpochState</a> <a id="To-NewEpochState"></a><a id="1535" href="Ledger.Epoch.html#1535" class="Function">To-NewEpochState</a> <a id="1552" class="Symbol">=</a> <a id="1554" href="Class.To.html#2693" class="Function">derive-To</a>
    <a id="1568" class="Symbol">(</a>   <a id="1572" class="Symbol">(</a><a id="1573" class="Keyword">quote</a> <a id="1579" href="Ledger.Epoch.html#761" class="Record">RewardUpdate</a>   <a id="1594" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1596" href="Ledger.Epoch.html#1480" class="Function">To-RewardUpdate</a><a id="1611" class="Symbol">)</a>
    <a id="1617" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a>   <a id="1621" class="Symbol">(</a><a id="1622" class="Keyword">quote</a> <a id="1628" href="Ledger.Epoch.html#877" class="Record">Snapshot</a>       <a id="1643" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1645" href="Ledger.Epoch.html#1496" class="Function">To-Snapshot</a><a id="1656" class="Symbol">)</a>
    <a id="1662" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a>   <a id="1666" class="Symbol">(</a><a id="1667" class="Keyword">quote</a> <a id="1673" href="Ledger.Epoch.html#1035" class="Record">Snapshots</a>      <a id="1688" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1690" href="Ledger.Epoch.html#1508" class="Function">To-Snapshots</a><a id="1702" class="Symbol">)</a>
    <a id="1708" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a>   <a id="1712" class="Symbol">(</a><a id="1713" class="Keyword">quote</a> <a id="1719" href="Ledger.Epoch.html#1127" class="Record">EpochState</a>     <a id="1734" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1736" href="Ledger.Epoch.html#1521" class="Function">To-EpochState</a><a id="1749" class="Symbol">)</a>
    <a id="1755" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="1757" href="Data.List.Base.html#5205" class="Function Operator">[</a> <a id="1759" class="Symbol">(</a><a id="1760" class="Keyword">quote</a> <a id="1766" href="Ledger.Epoch.html#1330" class="Record">NewEpochState</a>  <a id="1781" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1783" href="Ledger.Epoch.html#1535" class="Function">To-NewEpochState</a><a id="1799" class="Symbol">)</a><a id="1800" href="Data.List.Base.html#5205" class="Function Operator">]</a><a id="1801" class="Symbol">)</a>

<a id="1804" class="Keyword">instance</a> <a id="1813" href="Ledger.Epoch.html#1813" class="Function">_</a> <a id="1815" class="Symbol">=</a> <a id="1817" href="Data.Nat.Properties.html#17056" class="Function">+-0-monoid</a><a id="1827" class="Symbol">;</a> <a id="1829" href="Ledger.Epoch.html#1829" class="Function">_</a> <a id="1831" class="Symbol">=</a> <a id="1833" href="Data.Nat.Properties.html#17135" class="Function">+-0-commutativeMonoid</a>

<a id="toRwdAddr"></a><a id="1856" href="Ledger.Epoch.html#1856" class="Function">toRwdAddr</a> <a id="1866" class="Symbol">:</a> <a id="1868" href="Ledger.Address.html#273" class="Datatype">Credential</a> <a id="1879" class="Symbol">→</a> <a id="1881" href="Ledger.Address.html#1211" class="Record">RwdAddr</a>
<a id="1889" href="Ledger.Epoch.html#1856" class="Function">toRwdAddr</a> <a id="1899" href="Ledger.Epoch.html#1899" class="Bound">x</a> <a id="1901" class="Symbol">=</a> <a id="1903" class="Keyword">record</a> <a id="1910" class="Symbol">{</a> <a id="1912" href="Ledger.Address.html#1240" class="Field">net</a> <a id="1916" class="Symbol">=</a> <a id="1918" href="Ledger.Types.Epoch.html#2154" class="Function">NetworkId</a> <a id="1928" class="Symbol">;</a> <a id="1930" href="Ledger.Address.html#1265" class="Field">stake</a> <a id="1936" class="Symbol">=</a> <a id="1938" href="Ledger.Epoch.html#1899" class="Bound">x</a> <a id="1940" class="Symbol">}</a>

<a id="getStakeCred"></a><a id="1943" href="Ledger.Epoch.html#1943" class="Function">getStakeCred</a> <a id="1956" class="Symbol">:</a> <a id="1958" href="Ledger.Transaction.html#2334" class="Function">TxOut</a> <a id="1964" class="Symbol">→</a> <a id="1966" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="1972" href="Ledger.Address.html#273" class="Datatype">Credential</a>
<a id="1983" href="Ledger.Epoch.html#1943" class="Function">getStakeCred</a> <a id="1996" class="Symbol">(</a><a id="1997" href="Ledger.Epoch.html#1997" class="Bound">a</a> <a id="1999" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="2001" class="Symbol">_</a> <a id="2003" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="2005" class="Symbol">_</a> <a id="2007" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="2009" class="Symbol">_)</a> <a id="2012" class="Symbol">=</a> <a id="2014" href="Ledger.Address.html#1832" class="Function">stakeCred</a> <a id="2024" href="Ledger.Epoch.html#1997" class="Bound">a</a>

<a id="2027" class="Keyword">open</a> <a id="2032" href="Ledger.Address.html#1211" class="Module">RwdAddr</a> <a id="2040" class="Keyword">using</a> <a id="2046" class="Symbol">(</a><a id="2047" href="Ledger.Address.html#1265" class="Field">stake</a><a id="2052" class="Symbol">)</a>
<a id="2054" class="Keyword">open</a> <a id="2059" href="Ledger.GovernanceActions.html#2299" class="Module">GovActionState</a> <a id="2074" class="Keyword">using</a> <a id="2080" class="Symbol">(</a><a id="2081" href="Ledger.GovernanceActions.html#2370" class="Field">returnAddr</a><a id="2091" class="Symbol">)</a>


<a id="applyRUpd"></a><a id="2095" href="Ledger.Epoch.html#2095" class="Function">applyRUpd</a> <a id="2105" class="Symbol">:</a> <a id="2107" href="Ledger.Epoch.html#761" class="Record">RewardUpdate</a> <a id="2120" class="Symbol">→</a> <a id="2122" href="Ledger.Epoch.html#1127" class="Record">EpochState</a> <a id="2133" class="Symbol">→</a> <a id="2135" href="Ledger.Epoch.html#1127" class="Record">EpochState</a>
<a id="2146" href="Ledger.Epoch.html#2095" class="Function">applyRUpd</a> <a id="2156" href="Ledger.Epoch.html#802" class="InductiveConstructor Operator">⟦</a> <a id="2158" href="Ledger.Epoch.html#2158" class="Bound">Δt</a> <a id="2161" href="Ledger.Epoch.html#802" class="InductiveConstructor Operator">,</a> <a id="2163" href="Ledger.Epoch.html#2163" class="Bound">Δr</a> <a id="2166" href="Ledger.Epoch.html#802" class="InductiveConstructor Operator">,</a> <a id="2168" href="Ledger.Epoch.html#2168" class="Bound">Δf</a> <a id="2171" href="Ledger.Epoch.html#802" class="InductiveConstructor Operator">,</a> <a id="2173" href="Ledger.Epoch.html#2173" class="Bound">rs</a> <a id="2176" href="Ledger.Epoch.html#802" class="InductiveConstructor Operator">⟧ʳᵘ</a>
  <a id="2182" href="Ledger.Epoch.html#1167" class="InductiveConstructor Operator">⟦</a> <a id="2184" href="Ledger.PParams.html#708" class="InductiveConstructor Operator">⟦</a> <a id="2186" href="Ledger.Epoch.html#2186" class="Bound">treasury</a> <a id="2195" href="Ledger.PParams.html#708" class="InductiveConstructor Operator">,</a> <a id="2197" href="Ledger.Epoch.html#2197" class="Bound">reserves</a> <a id="2206" href="Ledger.PParams.html#708" class="InductiveConstructor Operator">⟧ᵃ</a>
  <a id="2211" href="Ledger.Epoch.html#1167" class="InductiveConstructor Operator">,</a> <a id="2213" href="Ledger.Epoch.html#2213" class="Bound">ss</a>
  <a id="2218" href="Ledger.Epoch.html#1167" class="InductiveConstructor Operator">,</a> <a id="2220" href="Ledger.Ledger.html#751" class="InductiveConstructor Operator">⟦</a> <a id="2222" href="Ledger.Utxo.html#2555" class="InductiveConstructor Operator">⟦</a> <a id="2224" href="Ledger.Epoch.html#2224" class="Bound">utxo</a> <a id="2229" href="Ledger.Utxo.html#2555" class="InductiveConstructor Operator">,</a> <a id="2231" href="Ledger.Epoch.html#2231" class="Bound">fees</a> <a id="2236" href="Ledger.Utxo.html#2555" class="InductiveConstructor Operator">,</a> <a id="2238" href="Ledger.Epoch.html#2238" class="Bound">deposits</a> <a id="2247" href="Ledger.Utxo.html#2555" class="InductiveConstructor Operator">,</a> <a id="2249" href="Ledger.Epoch.html#2249" class="Bound">donations</a> <a id="2259" href="Ledger.Utxo.html#2555" class="InductiveConstructor Operator">⟧ᵘ</a>
    <a id="2266" href="Ledger.Ledger.html#751" class="InductiveConstructor Operator">,</a> <a id="2268" href="Ledger.Epoch.html#2268" class="Bound">govSt</a>
    <a id="2278" href="Ledger.Ledger.html#751" class="InductiveConstructor Operator">,</a> <a id="2280" href="Ledger.Certs.html#2864" class="InductiveConstructor Operator">⟦</a> <a id="2282" href="Ledger.Certs.html#2429" class="InductiveConstructor Operator">⟦</a> <a id="2284" href="Ledger.Epoch.html#2284" class="Bound">voteDelegs</a> <a id="2295" href="Ledger.Certs.html#2429" class="InductiveConstructor Operator">,</a> <a id="2297" href="Ledger.Epoch.html#2297" class="Bound">stakeDelegs</a> <a id="2309" href="Ledger.Certs.html#2429" class="InductiveConstructor Operator">,</a> <a id="2311" href="Ledger.Epoch.html#2311" class="Bound">rewards</a> <a id="2319" href="Ledger.Certs.html#2429" class="InductiveConstructor Operator">⟧ᵈ</a> <a id="2322" href="Ledger.Certs.html#2864" class="InductiveConstructor Operator">,</a> <a id="2324" href="Ledger.Epoch.html#2324" class="Bound">pState</a> <a id="2331" href="Ledger.Certs.html#2864" class="InductiveConstructor Operator">,</a> <a id="2333" href="Ledger.Epoch.html#2333" class="Bound">gState</a> <a id="2340" href="Ledger.Certs.html#2864" class="InductiveConstructor Operator">⟧ᶜˢ</a> <a id="2344" href="Ledger.Ledger.html#751" class="InductiveConstructor Operator">⟧ˡ</a>
  <a id="2349" href="Ledger.Epoch.html#1167" class="InductiveConstructor Operator">,</a> <a id="2351" href="Ledger.Epoch.html#2351" class="Bound">es</a>
  <a id="2356" href="Ledger.Epoch.html#1167" class="InductiveConstructor Operator">,</a> <a id="2358" href="Ledger.Epoch.html#2358" class="Bound">fut</a>
  <a id="2364" href="Ledger.Epoch.html#1167" class="InductiveConstructor Operator">⟧ᵉ&#39;</a> <a id="2368" class="Symbol">=</a>
  <a id="2372" href="Class.To.html#102" class="Field Operator">⟦</a> <a id="2374" href="Class.To.html#102" class="Field Operator">⟦</a> <a id="2376" href="Data.Integer.Ext.html#349" class="Function">posPart</a> <a id="2384" class="Symbol">(</a><a id="2385" href="Ledger.Epoch.html#187" class="InductiveConstructor">pos</a> <a id="2389" href="Ledger.Epoch.html#2186" class="Bound">treasury</a> <a id="2398" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="2400" href="Ledger.Epoch.html#2158" class="Bound">Δt</a> <a id="2403" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="2405" href="Ledger.Epoch.html#187" class="InductiveConstructor">pos</a> <a id="2409" href="Ledger.Epoch.html#2713" class="Function">unregRU&#39;</a><a id="2417" class="Symbol">)</a>
    <a id="2423" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="2425" href="Data.Integer.Ext.html#349" class="Function">posPart</a> <a id="2433" class="Symbol">(</a><a id="2434" href="Ledger.Epoch.html#187" class="InductiveConstructor">pos</a> <a id="2438" href="Ledger.Epoch.html#2197" class="Bound">reserves</a> <a id="2447" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="2449" href="Ledger.Epoch.html#2163" class="Bound">Δr</a><a id="2451" class="Symbol">)</a> <a id="2453" href="Class.To.html#102" class="Field Operator">⟧</a>
  <a id="2457" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="2459" href="Ledger.Epoch.html#2213" class="Bound">ss</a>
  <a id="2464" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="2466" href="Class.To.html#102" class="Field Operator">⟦</a> <a id="2468" href="Class.To.html#102" class="Field Operator">⟦</a> <a id="2470" href="Ledger.Epoch.html#2224" class="Bound">utxo</a> <a id="2475" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="2477" href="Data.Integer.Ext.html#349" class="Function">posPart</a> <a id="2485" class="Symbol">(</a><a id="2486" href="Ledger.Epoch.html#187" class="InductiveConstructor">pos</a> <a id="2490" href="Ledger.Epoch.html#2231" class="Bound">fees</a> <a id="2495" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="2497" href="Ledger.Epoch.html#2168" class="Bound">Δf</a><a id="2499" class="Symbol">)</a> <a id="2501" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="2503" href="Ledger.Epoch.html#2238" class="Bound">deposits</a> <a id="2512" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="2514" href="Ledger.Epoch.html#2249" class="Bound">donations</a> <a id="2524" href="Class.To.html#102" class="Field Operator">⟧</a>
    <a id="2530" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="2532" href="Ledger.Epoch.html#2268" class="Bound">govSt</a>
    <a id="2542" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="2544" href="Class.To.html#102" class="Field Operator">⟦</a> <a id="2546" href="Class.To.html#102" class="Field Operator">⟦</a> <a id="2548" href="Ledger.Epoch.html#2284" class="Bound">voteDelegs</a> <a id="2559" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="2561" href="Ledger.Epoch.html#2297" class="Bound">stakeDelegs</a> <a id="2573" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="2575" href="Ledger.Epoch.html#2311" class="Bound">rewards</a> <a id="2583" href="Axiom.Set.Map.Dec.html#1854" class="Function Operator">∪⁺</a> <a id="2586" href="Ledger.Epoch.html#2645" class="Function">regRU</a> <a id="2592" href="Class.To.html#102" class="Field Operator">⟧</a> <a id="2594" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="2596" href="Ledger.Epoch.html#2324" class="Bound">pState</a> <a id="2603" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="2605" href="Ledger.Epoch.html#2333" class="Bound">gState</a> <a id="2612" href="Class.To.html#102" class="Field Operator">⟧</a> <a id="2614" href="Class.To.html#102" class="Field Operator">⟧</a>
  <a id="2618" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="2620" href="Ledger.Epoch.html#2351" class="Bound">es</a>
  <a id="2625" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="2627" href="Ledger.Epoch.html#2358" class="Bound">fut</a> <a id="2631" href="Class.To.html#102" class="Field Operator">⟧</a>
  <a id="2635" class="Keyword">where</a>
    <a id="2645" href="Ledger.Epoch.html#2645" class="Function">regRU</a>     <a id="2655" class="Symbol">=</a> <a id="2657" href="Ledger.Epoch.html#2173" class="Bound">rs</a> <a id="2660" href="Axiom.Set.Map.html#10678" class="Function Operator">∣</a> <a id="2662" href="Class.IsSet.html#916" class="Function">dom</a> <a id="2666" href="Ledger.Epoch.html#2311" class="Bound">rewards</a>
    <a id="2678" href="Ledger.Epoch.html#2678" class="Function">unregRU</a>   <a id="2688" class="Symbol">=</a> <a id="2690" href="Ledger.Epoch.html#2173" class="Bound">rs</a> <a id="2693" href="Axiom.Set.Map.html#10748" class="Function Operator">∣</a> <a id="2695" href="Class.IsSet.html#916" class="Function">dom</a> <a id="2699" href="Ledger.Epoch.html#2311" class="Bound">rewards</a> <a id="2707" href="Axiom.Set.Map.html#10748" class="Function Operator">ᶜ</a>
    <a id="2713" href="Ledger.Epoch.html#2713" class="Function">unregRU&#39;</a>  <a id="2723" class="Symbol">=</a> <a id="2725" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">∑[</a> <a id="2728" href="Ledger.Epoch.html#2728" class="Bound">x</a> <a id="2730" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">←</a> <a id="2732" href="Ledger.Epoch.html#2678" class="Function">unregRU</a> <a id="2740" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">]</a> <a id="2742" href="Ledger.Epoch.html#2728" class="Bound">x</a>

<a id="getOrphans"></a><a id="2745" href="Ledger.Epoch.html#2745" class="Function">getOrphans</a> <a id="2756" class="Symbol">:</a> <a id="2758" href="Ledger.Enact.html#397" class="Record">EnactState</a> <a id="2769" class="Symbol">→</a> <a id="2771" href="Ledger.Gov.html#1218" class="Function">GovState</a> <a id="2780" class="Symbol">→</a> <a id="2782" href="Ledger.Gov.html#1218" class="Function">GovState</a>
<a id="2791" href="Ledger.Epoch.html#2745" class="Function">getOrphans</a> <a id="2802" href="Ledger.Epoch.html#2802" class="Bound">es</a> <a id="2805" href="Ledger.Epoch.html#2805" class="Bound">govSt</a> <a id="2811" class="Symbol">=</a> <a id="2813" href="Data.Product.Base.html#636" class="Field">proj₁</a> <a id="2819" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="2821" href="Data.Nat.GeneralisedArithmetic.html#866" class="Function">iterate</a> <a id="2829" href="Ledger.Epoch.html#2874" class="Function">step</a> <a id="2834" class="Symbol">(</a><a id="2835" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a> <a id="2838" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="2840" href="Ledger.Epoch.html#2805" class="Bound">govSt</a><a id="2845" class="Symbol">)</a> <a id="2847" class="Symbol">(</a><a id="2848" href="Data.List.Base.html#5044" class="Function">length</a> <a id="2855" href="Ledger.Epoch.html#2805" class="Bound">govSt</a><a id="2860" class="Symbol">)</a>
  <a id="2864" class="Keyword">where</a>
    <a id="2874" href="Ledger.Epoch.html#2874" class="Function">step</a> <a id="2879" class="Symbol">:</a> <a id="2881" href="Ledger.Gov.html#1218" class="Function">GovState</a> <a id="2890" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="2892" href="Ledger.Gov.html#1218" class="Function">GovState</a> <a id="2901" class="Symbol">→</a> <a id="2903" href="Ledger.Gov.html#1218" class="Function">GovState</a> <a id="2912" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="2914" href="Ledger.Gov.html#1218" class="Function">GovState</a>
    <a id="2927" href="Ledger.Epoch.html#2874" class="Function">step</a> <a id="2932" class="Symbol">(</a><a id="2933" href="Ledger.Epoch.html#2933" class="Bound">orps</a> <a id="2938" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="2940" href="Ledger.Epoch.html#2940" class="Bound">govSt</a><a id="2945" class="Symbol">)</a> <a id="2947" class="Symbol">=</a>
      <a id="2955" class="Keyword">let</a>
        <a id="2967" href="Ledger.Epoch.html#2967" class="Bound">isOrphan?</a> <a id="2977" href="Ledger.Epoch.html#2977" class="Bound">a</a> <a id="2979" href="Ledger.Epoch.html#2979" class="Bound">prev</a> <a id="2984" class="Symbol">=</a> <a id="2986" href="Relation.Nullary.Decidable.Core.html#3011" class="Function">¬?</a> <a id="2989" class="Symbol">(</a><a id="2990" href="Ledger.Gov.html#8411" class="Function">hasParent?</a> <a id="3001" href="Ledger.Epoch.html#2802" class="Bound">es</a> <a id="3004" href="Ledger.Epoch.html#2940" class="Bound">govSt</a> <a id="3010" href="Ledger.Epoch.html#2977" class="Bound">a</a> <a id="3012" href="Ledger.Epoch.html#2979" class="Bound">prev</a><a id="3016" class="Symbol">)</a>
        <a id="3026" class="Symbol">(</a><a id="3027" href="Ledger.Epoch.html#3027" class="Bound">orps&#39;</a> <a id="3033" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="3035" href="Ledger.Epoch.html#3035" class="Bound">govSt&#39;</a><a id="3041" class="Symbol">)</a> <a id="3043" class="Symbol">=</a> <a id="3045" href="Data.List.Base.html#10926" class="Function">partition</a>
          <a id="3065" class="Symbol">(λ</a> <a id="3068" class="Symbol">(_</a> <a id="3071" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="3073" class="Keyword">record</a> <a id="3080" class="Symbol">{</a><a id="3081" href="Ledger.GovernanceActions.html#2420" class="Field">action</a> <a id="3088" class="Symbol">=</a> <a id="3090" href="Ledger.Epoch.html#3090" class="Bound">a</a> <a id="3092" class="Symbol">;</a> <a id="3094" href="Ledger.GovernanceActions.html#2448" class="Field">prevAction</a> <a id="3105" class="Symbol">=</a> <a id="3107" href="Ledger.Epoch.html#3107" class="Bound">prev</a><a id="3111" class="Symbol">})</a> <a id="3114" class="Symbol">→</a> <a id="3116" href="Ledger.Epoch.html#2967" class="Bound">isOrphan?</a> <a id="3126" class="Symbol">(</a><a id="3127" href="Ledger.Epoch.html#3090" class="Bound">a</a> <a id="3129" class="Symbol">.</a><a id="3130" href="Ledger.GovernanceActions.html#1429" class="Field">gaType</a><a id="3136" class="Symbol">)</a> <a id="3138" href="Ledger.Epoch.html#3107" class="Bound">prev</a><a id="3142" class="Symbol">)</a> <a id="3144" href="Ledger.Epoch.html#2940" class="Bound">govSt</a>
      <a id="3156" class="Keyword">in</a>
        <a id="3167" class="Symbol">(</a><a id="3168" href="Ledger.Epoch.html#2933" class="Bound">orps</a> <a id="3173" href="Data.List.Base.html#1734" class="Function Operator">++</a> <a id="3176" href="Ledger.Epoch.html#3027" class="Bound">orps&#39;</a> <a id="3182" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="3184" href="Ledger.Epoch.html#3035" class="Bound">govSt&#39;</a><a id="3190" class="Symbol">)</a>


<a id="stakeDistr"></a><a id="3194" href="Ledger.Epoch.html#3194" class="Function">stakeDistr</a> <a id="3205" class="Symbol">:</a> <a id="3207" href="Ledger.Transaction.html#2402" class="Function">UTxO</a> <a id="3212" class="Symbol">→</a> <a id="3214" href="Ledger.Certs.html#2393" class="Record">DState</a> <a id="3221" class="Symbol">→</a> <a id="3223" href="Ledger.Certs.html#2574" class="Record">PState</a> <a id="3230" class="Symbol">→</a> <a id="3232" href="Ledger.Epoch.html#877" class="Record">Snapshot</a>
<a id="3241" href="Ledger.Epoch.html#3194" class="Function">stakeDistr</a> <a id="3252" href="Ledger.Epoch.html#3252" class="Bound">utxo</a> <a id="3257" href="Ledger.Epoch.html#3257" class="Bound">stᵈ</a> <a id="3261" href="Ledger.Epoch.html#3261" class="Bound">pState</a> <a id="3268" class="Symbol">=</a> <a id="3270" href="Class.To.html#102" class="Field Operator">⟦</a> <a id="3272" href="Axiom.Set.Map.Dec.html#1932" class="Function">aggregate₊</a> <a id="3283" class="Symbol">(</a><a id="3284" href="Ledger.Epoch.html#3470" class="Function">stakeRelation</a> <a id="3298" href="abstract-set-theory.FiniteSetTheory.html#2767" class="Function Operator">ᶠˢ</a><a id="3300" class="Symbol">)</a> <a id="3302" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="3304" href="Ledger.Certs.html#2491" class="Function">stakeDelegs</a> <a id="3316" href="Class.To.html#102" class="Field Operator">⟧</a>
  <a id="3320" class="Keyword">where</a>
    <a id="3330" class="Keyword">open</a> <a id="3335" href="Ledger.Certs.html#2393" class="Module">DState</a> <a id="3342" href="Ledger.Epoch.html#3257" class="Bound">stᵈ</a> <a id="3346" class="Keyword">using</a> <a id="3352" class="Symbol">(</a><a id="3353" href="Ledger.Certs.html#2491" class="Field">stakeDelegs</a><a id="3364" class="Symbol">;</a> <a id="3366" href="Ledger.Certs.html#2531" class="Field">rewards</a><a id="3373" class="Symbol">)</a>
    <a id="3379" href="Ledger.Epoch.html#3379" class="Function">m</a> <a id="3381" class="Symbol">=</a> <a id="3383" href="abstract-set-theory.FiniteSetTheory.html#519" class="Function">mapˢ</a> <a id="3388" class="Symbol">(λ</a> <a id="3391" href="Ledger.Epoch.html#3391" class="Bound">a</a> <a id="3393" class="Symbol">→</a> <a id="3395" class="Symbol">(</a><a id="3396" href="Ledger.Epoch.html#3391" class="Bound">a</a> <a id="3398" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="3400" href="Ledger.Utxo.html#3117" class="Function">cbalance</a> <a id="3409" class="Symbol">(</a><a id="3410" href="Ledger.Epoch.html#3252" class="Bound">utxo</a> <a id="3415" href="abstract-set-theory.FiniteSetTheory.html#3088" class="Function Operator">∣^&#39;</a> <a id="3419" class="Symbol">λ</a> <a id="3421" href="Ledger.Epoch.html#3421" class="Bound">i</a> <a id="3423" class="Symbol">→</a> <a id="3425" href="Ledger.Epoch.html#1943" class="Function">getStakeCred</a> <a id="3438" href="Ledger.Epoch.html#3421" class="Bound">i</a> <a id="3440" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="3442" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="3447" href="Ledger.Epoch.html#3391" class="Bound">a</a><a id="3448" class="Symbol">)))</a> <a id="3452" class="Symbol">(</a><a id="3453" href="Class.IsSet.html#916" class="Function">dom</a> <a id="3457" href="Ledger.Certs.html#2531" class="Function">rewards</a><a id="3464" class="Symbol">)</a>
    <a id="3470" href="Ledger.Epoch.html#3470" class="Function">stakeRelation</a> <a id="3484" class="Symbol">=</a> <a id="3486" href="Ledger.Epoch.html#3379" class="Function">m</a> <a id="3488" href="Axiom.Set.html#8952" class="Function Operator">∪</a> <a id="3490" href="Data.Product.Base.html#636" class="Field">proj₁</a> <a id="3496" href="Ledger.Certs.html#2531" class="Function">rewards</a>

<a id="gaDepositStake"></a><a id="3505" href="Ledger.Epoch.html#3505" class="Function">gaDepositStake</a> <a id="3520" class="Symbol">:</a> <a id="3522" href="Ledger.Gov.html#1218" class="Function">GovState</a> <a id="3531" class="Symbol">→</a> <a id="3533" href="Ledger.Certs.html#527" class="Function">Deposits</a> <a id="3542" class="Symbol">→</a> <a id="3544" href="Ledger.Address.html#273" class="Datatype">Credential</a> <a id="3555" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="3557" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a>
<a id="3562" href="Ledger.Epoch.html#3505" class="Function">gaDepositStake</a> <a id="3577" href="Ledger.Epoch.html#3577" class="Bound">govSt</a> <a id="3583" href="Ledger.Epoch.html#3583" class="Bound">ds</a> <a id="3586" class="Symbol">=</a> <a id="3588" href="abstract-set-theory.FiniteSetTheory.html#3599" class="Function">aggregateBy</a>
  <a id="3602" class="Symbol">(</a><a id="3603" href="abstract-set-theory.FiniteSetTheory.html#519" class="Function">mapˢ</a> <a id="3608" class="Symbol">(λ</a> <a id="3611" class="Symbol">(</a><a id="3612" href="Ledger.Epoch.html#3612" class="Bound">gaid</a> <a id="3617" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="3619" href="Ledger.Epoch.html#3619" class="Bound">addr</a><a id="3623" class="Symbol">)</a> <a id="3625" class="Symbol">→</a> <a id="3627" class="Symbol">(</a><a id="3628" href="Ledger.Epoch.html#3612" class="Bound">gaid</a> <a id="3633" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="3635" href="Ledger.Epoch.html#3619" class="Bound">addr</a><a id="3639" class="Symbol">)</a> <a id="3641" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="3643" href="Ledger.Address.html#1265" class="Field">stake</a> <a id="3649" href="Ledger.Epoch.html#3619" class="Bound">addr</a><a id="3653" class="Symbol">)</a> <a id="3655" href="Ledger.Epoch.html#3753" class="Function">govSt&#39;</a><a id="3661" class="Symbol">)</a>
  <a id="3665" class="Symbol">(</a><a id="3666" href="Axiom.Set.Map.html#10460" class="Function">mapFromPartialFun</a> <a id="3684" class="Symbol">(λ</a> <a id="3687" class="Symbol">(</a><a id="3688" href="Ledger.Epoch.html#3688" class="Bound">gaid</a> <a id="3693" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="3695" class="Symbol">_)</a> <a id="3698" class="Symbol">→</a> <a id="3700" href="Axiom.Set.Map.html#13670" class="Function">lookupᵐ?</a> <a id="3709" href="Ledger.Epoch.html#3583" class="Bound">ds</a> <a id="3712" class="Symbol">(</a><a id="3713" href="Ledger.Certs.html#475" class="InductiveConstructor">GovActionDeposit</a> <a id="3730" href="Ledger.Epoch.html#3688" class="Bound">gaid</a><a id="3734" class="Symbol">))</a> <a id="3737" href="Ledger.Epoch.html#3753" class="Function">govSt&#39;</a><a id="3743" class="Symbol">)</a>
  <a id="3747" class="Keyword">where</a> <a id="3753" href="Ledger.Epoch.html#3753" class="Function">govSt&#39;</a> <a id="3760" class="Symbol">=</a> <a id="3762" href="abstract-set-theory.FiniteSetTheory.html#519" class="Function">mapˢ</a> <a id="3767" class="Symbol">(</a><a id="3768" href="Class.Bifunctor.html#1152" class="Function">map₂</a> <a id="3773" href="Ledger.GovernanceActions.html#2370" class="Field">returnAddr</a><a id="3783" class="Symbol">)</a> <a id="3785" class="Symbol">(</a><a id="3786" href="Axiom.Set.html#5718" class="Function">fromList</a> <a id="3795" href="Ledger.Epoch.html#3577" class="Bound">govSt</a><a id="3800" class="Symbol">)</a>



<a id="3805" class="Keyword">opaque</a>


  <a id="mkStakeDistrs"></a><a id="3816" href="Ledger.Epoch.html#3816" class="Function">mkStakeDistrs</a> <a id="3830" class="Symbol">:</a> <a id="3832" href="Ledger.Epoch.html#877" class="Record">Snapshot</a> <a id="3841" class="Symbol">→</a> <a id="3843" href="Ledger.Gov.html#1218" class="Function">GovState</a> <a id="3852" class="Symbol">→</a> <a id="3854" href="Ledger.Certs.html#527" class="Function">Deposits</a> <a id="3863" class="Symbol">→</a> <a id="3865" class="Symbol">(</a><a id="3866" href="Ledger.Address.html#273" class="Datatype">Credential</a> <a id="3877" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="3879" href="Ledger.GovernanceActions.html#458" class="Datatype">VDeleg</a><a id="3885" class="Symbol">)</a> <a id="3887" class="Symbol">→</a> <a id="3889" href="Ledger.Ratify.html#2890" class="Record">StakeDistrs</a>
  <a id="3903" href="Ledger.Epoch.html#3816" class="Function">mkStakeDistrs</a> <a id="3917" href="Ledger.Epoch.html#3917" class="Bound">ss</a> <a id="3920" href="Ledger.Epoch.html#3920" class="Bound">govSt</a> <a id="3926" href="Ledger.Epoch.html#3926" class="Bound">ds</a> <a id="3929" href="Ledger.Epoch.html#3929" class="Bound">delegations</a> <a id="3941" class="Symbol">.</a><a id="3942" href="Ledger.Ratify.html#2927" class="Field">StakeDistrs.stakeDistr</a> <a id="3965" class="Symbol">=</a>
    <a id="3971" href="abstract-set-theory.FiniteSetTheory.html#3599" class="Function">aggregateBy</a> <a id="3983" class="Symbol">(</a><a id="3984" href="Data.Product.Base.html#636" class="Field">proj₁</a> <a id="3990" href="Ledger.Epoch.html#3929" class="Bound">delegations</a><a id="4001" class="Symbol">)</a> <a id="4003" class="Symbol">(</a><a id="4004" href="Ledger.Epoch.html#910" class="Field">Snapshot.stake</a> <a id="4019" href="Ledger.Epoch.html#3917" class="Bound">ss</a> <a id="4022" href="Axiom.Set.Map.Dec.html#1854" class="Function Operator">∪⁺</a> <a id="4025" href="Ledger.Epoch.html#3505" class="Function">gaDepositStake</a> <a id="4040" href="Ledger.Epoch.html#3920" class="Bound">govSt</a> <a id="4046" href="Ledger.Epoch.html#3926" class="Bound">ds</a><a id="4048" class="Symbol">)</a>


<a id="4052" class="Keyword">private</a> <a id="4060" class="Keyword">variable</a>
  <a id="4071" href="Ledger.Epoch.html#4071" class="Generalizable">nes</a> <a id="4075" href="Ledger.Epoch.html#4075" class="Generalizable">nes&#39;</a> <a id="4080" class="Symbol">:</a> <a id="4082" href="Ledger.Epoch.html#1330" class="Record">NewEpochState</a>
  <a id="4098" href="Ledger.Epoch.html#4098" class="Generalizable">e</a> <a id="4100" href="Ledger.Epoch.html#4100" class="Generalizable">lastEpoch</a> <a id="4110" class="Symbol">:</a> <a id="4112" href="Ledger.Types.Epoch.html#476" class="Function">Epoch</a>
  <a id="4120" href="Ledger.Epoch.html#4120" class="Generalizable">fut</a> <a id="4124" href="Ledger.Epoch.html#4124" class="Generalizable">fut&#39;</a> <a id="4129" class="Symbol">:</a> <a id="4131" href="Ledger.Ratify.html#3255" class="Record">RatifyState</a>
  <a id="4145" href="Ledger.Epoch.html#4145" class="Generalizable">eps</a> <a id="4149" href="Ledger.Epoch.html#4149" class="Generalizable">eps&#39;</a> <a id="4154" href="Ledger.Epoch.html#4154" class="Generalizable">eps&#39;&#39;</a> <a id="4160" class="Symbol">:</a> <a id="4162" href="Ledger.Epoch.html#1127" class="Record">EpochState</a>
  <a id="4175" href="Ledger.Epoch.html#4175" class="Generalizable">ls</a> <a id="4178" class="Symbol">:</a> <a id="4180" href="Ledger.Ledger.html#715" class="Record">LState</a>
  <a id="4189" href="Ledger.Epoch.html#4189" class="Generalizable">acnt</a> <a id="4194" class="Symbol">:</a> <a id="4196" href="Ledger.PParams.html#674" class="Record">Acnt</a>
  <a id="4203" href="Ledger.Epoch.html#4203" class="Generalizable">es₀</a> <a id="4207" class="Symbol">:</a> <a id="4209" href="Ledger.Enact.html#397" class="Record">EnactState</a>
  <a id="4222" href="Ledger.Epoch.html#4222" class="Generalizable">mark</a> <a id="4227" href="Ledger.Epoch.html#4227" class="Generalizable">set</a> <a id="4231" href="Ledger.Epoch.html#4231" class="Generalizable">go</a> <a id="4234" class="Symbol">:</a> <a id="4236" href="Ledger.Epoch.html#877" class="Record">Snapshot</a>
  <a id="4247" href="Ledger.Epoch.html#4247" class="Generalizable">feeSS</a> <a id="4253" class="Symbol">:</a> <a id="4255" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a>
  <a id="4262" href="Ledger.Epoch.html#4262" class="Generalizable">lstate</a> <a id="4269" class="Symbol">:</a> <a id="4271" href="Ledger.Ledger.html#715" class="Record">LState</a>
  <a id="4280" href="Ledger.Epoch.html#4280" class="Generalizable">ss</a> <a id="4283" href="Ledger.Epoch.html#4283" class="Generalizable">ss&#39;</a> <a id="4287" class="Symbol">:</a> <a id="4289" href="Ledger.Epoch.html#1035" class="Record">Snapshots</a>
  <a id="4301" href="Ledger.Epoch.html#4301" class="Generalizable">ru</a> <a id="4304" class="Symbol">:</a> <a id="4306" href="Ledger.Epoch.html#761" class="Record">RewardUpdate</a>
  <a id="4321" href="Ledger.Epoch.html#4321" class="Generalizable">mru</a> <a id="4325" class="Symbol">:</a> <a id="4327" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="4333" href="Ledger.Epoch.html#761" class="Record">RewardUpdate</a>


<a id="4348" class="Keyword">data</a> <a id="_⊢_⇀⦇_,SNAP⦈_"></a><a id="4353" href="Ledger.Epoch.html#4353" class="Datatype Operator">_⊢_⇀⦇_,SNAP⦈_</a> <a id="4367" class="Symbol">:</a> <a id="4369" href="Ledger.Ledger.html#715" class="Record">LState</a> <a id="4376" class="Symbol">→</a> <a id="4378" href="Ledger.Epoch.html#1035" class="Record">Snapshots</a> <a id="4388" class="Symbol">→</a> <a id="4390" href="Agda.Builtin.Unit.html#175" class="Record">⊤</a> <a id="4392" class="Symbol">→</a> <a id="4394" href="Ledger.Epoch.html#1035" class="Record">Snapshots</a> <a id="4404" class="Symbol">→</a> <a id="4406" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="4411" class="Keyword">where</a>
  <a id="_⊢_⇀⦇_,SNAP⦈_.SNAP"></a><a id="4419" href="Ledger.Epoch.html#4419" class="InductiveConstructor">SNAP</a> <a id="4424" class="Symbol">:</a> <a id="4426" class="Keyword">let</a> <a id="4430" class="Keyword">open</a> <a id="4435" href="Ledger.Ledger.html#715" class="Module">LState</a> <a id="4442" href="Ledger.Epoch.html#4262" class="Generalizable">lstate</a><a id="4448" class="Symbol">;</a> <a id="4450" class="Keyword">open</a> <a id="4455" href="Ledger.Utxo.html#2516" class="Module">UTxOState</a> <a id="4465" href="Ledger.Ledger.html#774" class="Function">utxoSt</a><a id="4471" class="Symbol">;</a> <a id="4473" class="Keyword">open</a> <a id="4478" href="Ledger.Certs.html#2825" class="Module">CertState</a> <a id="4488" href="Ledger.Ledger.html#827" class="Function">certState</a>
             <a id="4511" href="Ledger.Epoch.html#4511" class="Bound">stake</a> <a id="4517" class="Symbol">=</a> <a id="4519" href="Ledger.Epoch.html#3194" class="Function">stakeDistr</a> <a id="4530" href="Ledger.Utxo.html#2580" class="Function">utxo</a> <a id="4535" href="Ledger.Certs.html#2888" class="Function">dState</a> <a id="4542" href="Ledger.Certs.html#2908" class="Function">pState</a>
    <a id="4553" class="Keyword">in</a>
    <a id="4560" href="Ledger.Epoch.html#4262" class="Generalizable">lstate</a> <a id="4567" href="Ledger.Epoch.html#4353" class="Datatype Operator">⊢</a> <a id="4569" href="Class.To.html#102" class="Field Operator">⟦</a> <a id="4571" href="Ledger.Epoch.html#4222" class="Generalizable">mark</a> <a id="4576" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="4578" href="Ledger.Epoch.html#4227" class="Generalizable">set</a> <a id="4582" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="4584" href="Ledger.Epoch.html#4231" class="Generalizable">go</a> <a id="4587" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="4589" href="Ledger.Epoch.html#4247" class="Generalizable">feeSS</a> <a id="4595" href="Class.To.html#102" class="Field Operator">⟧</a> <a id="4597" href="Ledger.Epoch.html#4353" class="Datatype Operator">⇀⦇</a> <a id="4600" href="Agda.Builtin.Unit.html#212" class="InductiveConstructor">tt</a> <a id="4603" href="Ledger.Epoch.html#4353" class="Datatype Operator">,SNAP⦈</a> <a id="4610" href="Class.To.html#102" class="Field Operator">⟦</a> <a id="4612" href="Ledger.Epoch.html#4511" class="Bound">stake</a> <a id="4618" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="4620" href="Ledger.Epoch.html#4222" class="Generalizable">mark</a> <a id="4625" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="4627" href="Ledger.Epoch.html#4227" class="Generalizable">set</a> <a id="4631" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="4633" href="Ledger.Utxo.html#2602" class="Function">fees</a> <a id="4638" href="Class.To.html#102" class="Field Operator">⟧</a>

<a id="4641" class="Keyword">data</a> <a id="_⊢_⇀⦇_,EPOCH⦈_"></a><a id="4646" href="Ledger.Epoch.html#4646" class="Datatype Operator">_⊢_⇀⦇_,EPOCH⦈_</a> <a id="4661" class="Symbol">:</a> <a id="4663" href="Agda.Builtin.Unit.html#175" class="Record">⊤</a> <a id="4665" class="Symbol">→</a> <a id="4667" href="Ledger.Epoch.html#1127" class="Record">EpochState</a> <a id="4678" class="Symbol">→</a> <a id="4680" href="Ledger.Types.Epoch.html#476" class="Function">Epoch</a> <a id="4686" class="Symbol">→</a> <a id="4688" href="Ledger.Epoch.html#1127" class="Record">EpochState</a> <a id="4699" class="Symbol">→</a> <a id="4701" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="4706" class="Keyword">where</a>


  <a id="_⊢_⇀⦇_,EPOCH⦈_.EPOCH"></a><a id="4716" href="Ledger.Epoch.html#4716" class="InductiveConstructor">EPOCH</a> <a id="4722" class="Symbol">:</a> <a id="4724" class="Keyword">let</a>


      <a id="4736" class="Keyword">open</a> <a id="4741" href="Ledger.Ledger.html#715" class="Module">LState</a> <a id="4748" href="Ledger.Epoch.html#4175" class="Generalizable">ls</a>
      <a id="4757" class="Keyword">open</a> <a id="4762" href="Ledger.Certs.html#2825" class="Module">CertState</a> <a id="4772" href="Ledger.Ledger.html#827" class="Function">certState</a>
      <a id="4788" class="Keyword">open</a> <a id="4793" href="Ledger.Ratify.html#3255" class="Module">RatifyState</a> <a id="4805" href="Ledger.Epoch.html#4120" class="Generalizable">fut</a> <a id="4809" class="Keyword">renaming</a> <a id="4818" class="Symbol">(</a><a id="4819" href="Ledger.Ratify.html#3292" class="Field">es</a> <a id="4822" class="Symbol">to</a> <a id="4825" class="Field">esW</a><a id="4828" class="Symbol">)</a>
      <a id="4836" class="Keyword">open</a> <a id="4841" href="Ledger.Utxo.html#2516" class="Module">UTxOState</a>
      <a id="4857" class="Keyword">open</a> <a id="4862" href="Ledger.Certs.html#2574" class="Module">PState</a><a id="4868" class="Symbol">;</a> <a id="4870" class="Keyword">open</a> <a id="4875" href="Ledger.Certs.html#2393" class="Module">DState</a><a id="4881" class="Symbol">;</a> <a id="4883" class="Keyword">open</a> <a id="4888" href="Ledger.Certs.html#2681" class="Module">GState</a>
      <a id="4901" class="Keyword">open</a> <a id="4906" href="Ledger.PParams.html#674" class="Module">Acnt</a><a id="4910" class="Symbol">;</a> <a id="4912" class="Keyword">open</a> <a id="4917" href="Ledger.Enact.html#397" class="Module">EnactState</a><a id="4927" class="Symbol">;</a> <a id="4929" class="Keyword">open</a> <a id="4934" href="Ledger.GovernanceActions.html#2299" class="Module">GovActionState</a>



      <a id="4958" href="Ledger.Epoch.html#4958" class="Bound">es</a>                <a id="4976" class="Symbol">=</a> <a id="4978" class="Keyword">record</a> <a id="4985" href="Ledger.Epoch.html#4825" class="Function">esW</a> <a id="4989" class="Symbol">{</a> <a id="4991" href="Ledger.Enact.html#649" class="Field">withdrawals</a> <a id="5003" class="Symbol">=</a> <a id="5005" href="Class.HasEmptySet.html#287" class="Field">∅</a> <a id="5007" class="Symbol">}</a>
      <a id="5015" href="Ledger.Epoch.html#5015" class="Bound">tmpGovSt</a>          <a id="5033" class="Symbol">=</a> <a id="5035" href="Data.List.Base.html#10687" class="Function">filter</a> <a id="5042" class="Symbol">(λ</a> <a id="5045" href="Ledger.Epoch.html#5045" class="Bound">x</a> <a id="5047" class="Symbol">→</a> <a id="5049" href="Class.Decidable.Core.html#461" class="Function Operator">¿</a> <a id="5051" href="Data.Product.Base.html#636" class="Field">proj₁</a> <a id="5057" href="Ledger.Epoch.html#5045" class="Bound">x</a> <a id="5059" href="Class.IsSet.html#462" class="Function Operator">∉</a> <a id="5061" href="abstract-set-theory.FiniteSetTheory.html#519" class="Function">mapˢ</a> <a id="5066" href="Data.Product.Base.html#636" class="Field">proj₁</a> <a id="5072" href="Ledger.Ratify.html#3325" class="Function">removed</a> <a id="5080" href="Class.Decidable.Core.html#461" class="Function Operator">¿</a><a id="5081" class="Symbol">)</a> <a id="5083" href="Ledger.Ledger.html#801" class="Function">govSt</a>
      <a id="5095" href="Ledger.Epoch.html#5095" class="Bound">orphans</a>           <a id="5113" class="Symbol">=</a> <a id="5115" href="Axiom.Set.html#5718" class="Function">fromList</a> <a id="5124" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="5126" href="Ledger.Epoch.html#2745" class="Function">getOrphans</a> <a id="5137" href="Ledger.Epoch.html#4958" class="Bound">es</a> <a id="5140" href="Ledger.Epoch.html#5015" class="Bound">tmpGovSt</a>
      <a id="5155" href="Ledger.Epoch.html#5155" class="Bound">removed&#39;</a>          <a id="5173" class="Symbol">=</a> <a id="5175" href="Ledger.Ratify.html#3325" class="Function">removed</a> <a id="5183" href="Axiom.Set.html#8952" class="Function Operator">∪</a> <a id="5185" href="Ledger.Epoch.html#5095" class="Bound">orphans</a>
      <a id="5199" href="Ledger.Epoch.html#5199" class="Bound">removedGovActions</a> <a id="5217" class="Symbol">=</a> <a id="5219" href="Function.Base.html#1638" class="Function">flip</a> <a id="5224" href="Axiom.Set.html#7022" class="Function">concatMapˢ</a> <a id="5235" href="Ledger.Epoch.html#5155" class="Bound">removed&#39;</a> <a id="5244" class="Symbol">λ</a> <a id="5246" class="Symbol">(</a><a id="5247" href="Ledger.Epoch.html#5247" class="Bound">gaid</a> <a id="5252" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5254" href="Ledger.Epoch.html#5254" class="Bound">gaSt</a><a id="5258" class="Symbol">)</a> <a id="5260" class="Symbol">→</a>
        <a id="5270" href="abstract-set-theory.FiniteSetTheory.html#519" class="Function">mapˢ</a> <a id="5275" class="Symbol">(</a><a id="5276" href="Ledger.GovernanceActions.html#2370" class="Field">returnAddr</a> <a id="5287" href="Ledger.Epoch.html#5254" class="Bound">gaSt</a> <a id="5292" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,_</a><a id="5294" class="Symbol">)</a> <a id="5296" class="Symbol">((</a><a id="5298" href="Ledger.Ledger.html#774" class="Function">utxoSt</a> <a id="5305" class="Symbol">.</a><a id="5306" href="Ledger.Utxo.html#2624" class="Field">deposits</a> <a id="5315" href="Axiom.Set.Map.html#10678" class="Function Operator">∣</a> <a id="5317" href="Class.HasSingleton.html#288" class="Field Operator">❴</a> <a id="5319" href="Ledger.Certs.html#475" class="InductiveConstructor">GovActionDeposit</a> <a id="5336" href="Ledger.Epoch.html#5247" class="Bound">gaid</a> <a id="5341" href="Class.HasSingleton.html#288" class="Field Operator">❵</a><a id="5342" class="Symbol">)</a> <a id="5344" href="Axiom.Set.Map.html#2293" class="Function Operator">ˢ</a><a id="5345" class="Symbol">)</a>
      <a id="5353" href="Ledger.Epoch.html#5353" class="Bound">govActionReturns</a> <a id="5370" class="Symbol">=</a> <a id="5372" href="Axiom.Set.Map.Dec.html#1932" class="Function">aggregate₊</a> <a id="5383" class="Symbol">(</a><a id="5384" href="abstract-set-theory.FiniteSetTheory.html#519" class="Function">mapˢ</a> <a id="5389" class="Symbol">(λ</a> <a id="5392" class="Symbol">(</a><a id="5393" href="Ledger.Epoch.html#5393" class="Bound">a</a> <a id="5395" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5397" class="Symbol">_</a> <a id="5399" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5401" href="Ledger.Epoch.html#5401" class="Bound">d</a><a id="5402" class="Symbol">)</a> <a id="5404" class="Symbol">→</a> <a id="5406" href="Ledger.Epoch.html#5393" class="Bound">a</a> <a id="5408" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5410" href="Ledger.Epoch.html#5401" class="Bound">d</a><a id="5411" class="Symbol">)</a> <a id="5413" href="Ledger.Epoch.html#5199" class="Bound">removedGovActions</a> <a id="5431" href="abstract-set-theory.FiniteSetTheory.html#2767" class="Function Operator">ᶠˢ</a><a id="5433" class="Symbol">)</a>

      <a id="5442" href="Ledger.Epoch.html#5442" class="Bound">trWithdrawals</a>   <a id="5458" class="Symbol">=</a> <a id="5460" href="Ledger.Epoch.html#4825" class="Function">esW</a> <a id="5464" class="Symbol">.</a><a id="5465" href="Ledger.Enact.html#649" class="Field">withdrawals</a>
      <a id="5483" href="Ledger.Epoch.html#5483" class="Bound">totWithdrawals</a>  <a id="5499" class="Symbol">=</a> <a id="5501" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">∑[</a> <a id="5504" href="Ledger.Epoch.html#5504" class="Bound">x</a> <a id="5506" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">←</a> <a id="5508" href="Ledger.Epoch.html#5442" class="Bound">trWithdrawals</a> <a id="5522" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">]</a> <a id="5524" href="Ledger.Epoch.html#5504" class="Bound">x</a>

      <a id="5533" href="Ledger.Epoch.html#5533" class="Bound">retired</a>    <a id="5544" class="Symbol">=</a> <a id="5546" class="Symbol">(</a><a id="5547" href="Ledger.Certs.html#2908" class="Function">pState</a> <a id="5554" class="Symbol">.</a><a id="5555" href="Ledger.Certs.html#2643" class="Field">retiring</a><a id="5563" class="Symbol">)</a> <a id="5565" href="Axiom.Set.Map.html#14230" class="Function Operator">⁻¹</a> <a id="5568" href="Ledger.Epoch.html#4098" class="Generalizable">e</a>
      <a id="5576" href="Ledger.Epoch.html#5576" class="Bound">payout</a>     <a id="5587" class="Symbol">=</a> <a id="5589" href="Ledger.Epoch.html#5353" class="Bound">govActionReturns</a> <a id="5606" href="Axiom.Set.Map.Dec.html#1854" class="Function Operator">∪⁺</a> <a id="5609" href="Ledger.Epoch.html#5442" class="Bound">trWithdrawals</a>
      <a id="5629" href="Ledger.Epoch.html#5629" class="Bound">refunds</a>    <a id="5640" class="Symbol">=</a> <a id="5642" href="Axiom.Set.Map.html#13791" class="Function">pullbackMap</a> <a id="5654" href="Ledger.Epoch.html#5576" class="Bound">payout</a> <a id="5661" href="Ledger.Epoch.html#1856" class="Function">toRwdAddr</a> <a id="5671" class="Symbol">(</a><a id="5672" href="Class.IsSet.html#916" class="Function">dom</a> <a id="5676" class="Symbol">(</a><a id="5677" href="Ledger.Certs.html#2888" class="Function">dState</a> <a id="5684" class="Symbol">.</a><a id="5685" href="Ledger.Certs.html#2531" class="Field">rewards</a><a id="5692" class="Symbol">))</a>
      <a id="5701" href="Ledger.Epoch.html#5701" class="Bound">unclaimed</a>  <a id="5712" class="Symbol">=</a> <a id="5714" href="Ledger.Interface.HasCoin.html#172" class="Field">getCoin</a> <a id="5722" href="Ledger.Epoch.html#5576" class="Bound">payout</a> <a id="5729" href="Interface.HasSubtract.html#209" class="Field Operator">-</a> <a id="5731" href="Ledger.Interface.HasCoin.html#172" class="Field">getCoin</a> <a id="5739" href="Ledger.Epoch.html#5629" class="Bound">refunds</a>

      <a id="5754" href="Ledger.Epoch.html#5754" class="Bound">govSt&#39;</a> <a id="5761" class="Symbol">=</a> <a id="5763" href="Data.List.Base.html#10687" class="Function">filter</a> <a id="5770" class="Symbol">(λ</a> <a id="5773" href="Ledger.Epoch.html#5773" class="Bound">x</a> <a id="5775" class="Symbol">→</a> <a id="5777" href="Class.Decidable.Core.html#461" class="Function Operator">¿</a> <a id="5779" href="Data.Product.Base.html#636" class="Field">proj₁</a> <a id="5785" href="Ledger.Epoch.html#5773" class="Bound">x</a> <a id="5787" href="Class.IsSet.html#462" class="Function Operator">∉</a> <a id="5789" href="abstract-set-theory.FiniteSetTheory.html#519" class="Function">mapˢ</a> <a id="5794" href="Data.Product.Base.html#636" class="Field">proj₁</a> <a id="5800" href="Ledger.Epoch.html#5155" class="Bound">removed&#39;</a> <a id="5809" href="Class.Decidable.Core.html#461" class="Function Operator">¿</a><a id="5810" class="Symbol">)</a> <a id="5812" href="Ledger.Ledger.html#801" class="Function">govSt</a>

      <a id="5825" href="Ledger.Epoch.html#5825" class="Bound">dState&#39;</a> <a id="5833" class="Symbol">=</a> <a id="5835" href="Class.To.html#102" class="Field Operator">⟦</a> <a id="5837" href="Ledger.Certs.html#2888" class="Function">dState</a> <a id="5844" class="Symbol">.</a><a id="5845" href="Ledger.Certs.html#2452" class="Field">voteDelegs</a> <a id="5856" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5858" href="Ledger.Certs.html#2888" class="Function">dState</a> <a id="5865" class="Symbol">.</a><a id="5866" href="Ledger.Certs.html#2491" class="Field">stakeDelegs</a> <a id="5878" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a>  <a id="5881" href="Ledger.Certs.html#2888" class="Function">dState</a> <a id="5888" class="Symbol">.</a><a id="5889" href="Ledger.Certs.html#2531" class="Field">rewards</a> <a id="5897" href="Axiom.Set.Map.Dec.html#1854" class="Function Operator">∪⁺</a> <a id="5900" href="Ledger.Epoch.html#5629" class="Bound">refunds</a> <a id="5908" href="Class.To.html#102" class="Field Operator">⟧</a>

      <a id="5917" href="Ledger.Epoch.html#5917" class="Bound">pState&#39;</a> <a id="5925" class="Symbol">=</a> <a id="5927" href="Class.To.html#102" class="Field Operator">⟦</a> <a id="5929" href="Ledger.Certs.html#2908" class="Function">pState</a> <a id="5936" class="Symbol">.</a><a id="5937" href="Ledger.Certs.html#2606" class="Field">pools</a> <a id="5943" href="Axiom.Set.Map.html#10748" class="Function Operator">∣</a> <a id="5945" href="Ledger.Epoch.html#5533" class="Bound">retired</a> <a id="5953" href="Axiom.Set.Map.html#10748" class="Function Operator">ᶜ</a> <a id="5955" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5957" href="Ledger.Certs.html#2908" class="Function">pState</a> <a id="5964" class="Symbol">.</a><a id="5965" href="Ledger.Certs.html#2643" class="Field">retiring</a> <a id="5974" href="Axiom.Set.Map.html#10748" class="Function Operator">∣</a> <a id="5976" href="Ledger.Epoch.html#5533" class="Bound">retired</a> <a id="5984" href="Axiom.Set.Map.html#10748" class="Function Operator">ᶜ</a> <a id="5986" href="Class.To.html#102" class="Field Operator">⟧</a>

      <a id="5995" href="Ledger.Epoch.html#5995" class="Bound">gState&#39;</a> <a id="6003" class="Symbol">=</a> <a id="6005" href="Class.To.html#102" class="Field Operator">⟦</a> <a id="6007" class="Symbol">(</a><a id="6008" href="Class.ToBool.html#389" class="Function Operator">if</a> <a id="6011" href="Data.List.Base.html#4703" class="Function">null</a> <a id="6016" href="Ledger.Epoch.html#5754" class="Bound">govSt&#39;</a> <a id="6023" href="Class.ToBool.html#389" class="Function Operator">then</a> <a id="6028" href="Axiom.Set.Map.html#6068" class="Function">mapValues</a> <a id="6038" class="Symbol">(</a><a id="6039" class="Number">1</a> <a id="6041" href="Class.HasAdd.Core.html#162" class="Field Operator">+_</a><a id="6043" class="Symbol">)</a> <a id="6045" class="Symbol">(</a><a id="6046" href="Ledger.Certs.html#2928" class="Function">gState</a> <a id="6053" class="Symbol">.</a><a id="6054" href="Ledger.Certs.html#2738" class="Field">dreps</a><a id="6059" class="Symbol">)</a> <a id="6061" href="Class.ToBool.html#389" class="Function Operator">else</a> <a id="6066" class="Symbol">(</a><a id="6067" href="Ledger.Certs.html#2928" class="Function">gState</a> <a id="6074" class="Symbol">.</a><a id="6075" href="Ledger.Certs.html#2738" class="Field">dreps</a><a id="6080" class="Symbol">))</a>
                <a id="6099" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="6101" href="Ledger.Certs.html#2928" class="Function">gState</a> <a id="6108" class="Symbol">.</a><a id="6109" href="Ledger.Certs.html#2774" class="Field">ccHotKeys</a> <a id="6119" href="Axiom.Set.Map.html#10678" class="Function Operator">∣</a> <a id="6121" href="Ledger.Enact.html#788" class="Function">ccCreds</a> <a id="6129" class="Symbol">(</a><a id="6130" href="Ledger.Epoch.html#4958" class="Bound">es</a> <a id="6133" class="Symbol">.</a><a id="6134" href="Ledger.Enact.html#433" class="Field">cc</a><a id="6136" class="Symbol">)</a> <a id="6138" href="Class.To.html#102" class="Field Operator">⟧</a>

      <a id="6147" href="Ledger.Epoch.html#6147" class="Bound">certState&#39;</a> <a id="6158" class="Symbol">:</a> <a id="6160" href="Ledger.Certs.html#2825" class="Record">CertState</a>
      <a id="6176" href="Ledger.Epoch.html#6147" class="Bound">certState&#39;</a> <a id="6187" class="Symbol">=</a> <a id="6189" href="Class.To.html#102" class="Field Operator">⟦</a> <a id="6191" href="Ledger.Epoch.html#5825" class="Bound">dState&#39;</a> <a id="6199" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="6201" href="Ledger.Epoch.html#5917" class="Bound">pState&#39;</a> <a id="6209" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="6211" href="Ledger.Epoch.html#5995" class="Bound">gState&#39;</a> <a id="6219" href="Class.To.html#102" class="Field Operator">⟧</a>

      <a id="6228" href="Ledger.Epoch.html#6228" class="Bound">utxoSt&#39;</a> <a id="6236" class="Symbol">=</a> <a id="6238" href="Class.To.html#102" class="Field Operator">⟦</a> <a id="6240" href="Ledger.Ledger.html#774" class="Function">utxoSt</a> <a id="6247" class="Symbol">.</a><a id="6248" href="Ledger.Utxo.html#2580" class="Field">utxo</a> <a id="6253" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="6255" href="Ledger.Ledger.html#774" class="Function">utxoSt</a> <a id="6262" class="Symbol">.</a><a id="6263" href="Ledger.Utxo.html#2602" class="Field">fees</a> <a id="6268" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="6270" href="Ledger.Ledger.html#774" class="Function">utxoSt</a> <a id="6277" class="Symbol">.</a><a id="6278" href="Ledger.Utxo.html#2624" class="Field">deposits</a> <a id="6287" href="Axiom.Set.Map.html#10748" class="Function Operator">∣</a> <a id="6289" href="abstract-set-theory.FiniteSetTheory.html#519" class="Function">mapˢ</a> <a id="6294" class="Symbol">(</a><a id="6295" href="Data.Product.Base.html#636" class="Field">proj₁</a> <a id="6301" href="Function.Base.html#1115" class="Function Operator">∘</a> <a id="6303" href="Data.Product.Base.html#650" class="Field">proj₂</a><a id="6308" class="Symbol">)</a> <a id="6310" href="Ledger.Epoch.html#5199" class="Bound">removedGovActions</a> <a id="6328" href="Axiom.Set.Map.html#10748" class="Function Operator">ᶜ</a> <a id="6330" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="6332" class="Number">0</a> <a id="6334" href="Class.To.html#102" class="Field Operator">⟧</a>

      <a id="6343" href="Ledger.Epoch.html#6343" class="Bound">acnt&#39;</a> <a id="6349" class="Symbol">=</a> <a id="6351" class="Keyword">record</a> <a id="6358" href="Ledger.Epoch.html#4189" class="Generalizable">acnt</a>
        <a id="6371" class="Symbol">{</a> <a id="6373" href="Ledger.PParams.html#729" class="Field">treasury</a>  <a id="6383" class="Symbol">=</a> <a id="6385" href="Ledger.Epoch.html#4189" class="Generalizable">acnt</a> <a id="6390" class="Symbol">.</a><a id="6391" href="Ledger.PParams.html#729" class="Field">treasury</a> <a id="6400" href="Data.Nat.Base.html#4456" class="Primitive Operator">∸</a> <a id="6402" href="Ledger.Epoch.html#5483" class="Bound">totWithdrawals</a> <a id="6417" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="6419" href="Ledger.Ledger.html#774" class="Function">utxoSt</a> <a id="6426" class="Symbol">.</a><a id="6427" href="Ledger.Utxo.html#2650" class="Field">donations</a> <a id="6437" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="6439" href="Ledger.Epoch.html#5701" class="Bound">unclaimed</a> <a id="6449" class="Symbol">}</a>
    <a id="6455" class="Keyword">in</a>
    <a id="6462" class="Keyword">record</a> <a id="6469" class="Symbol">{</a> <a id="6471" href="Ledger.Ratify.html#3030" class="Field">currentEpoch</a> <a id="6484" class="Symbol">=</a> <a id="6486" href="Ledger.Epoch.html#4098" class="Generalizable">e</a>
           <a id="6499" class="Symbol">;</a> <a id="6501" href="Ledger.Ratify.html#2998" class="Field">stakeDistrs</a> <a id="6513" class="Symbol">=</a> <a id="6515" href="Ledger.Epoch.html#3816" class="Function">mkStakeDistrs</a>  <a id="6530" class="Symbol">(</a><a id="6531" href="Ledger.Epoch.html#1069" class="Field">Snapshots.mark</a> <a id="6546" href="Ledger.Epoch.html#4283" class="Generalizable">ss&#39;</a><a id="6549" class="Symbol">)</a> <a id="6551" href="Ledger.Epoch.html#5754" class="Bound">govSt&#39;</a>
                                          <a id="6600" class="Symbol">(</a><a id="6601" href="Ledger.Epoch.html#6228" class="Bound">utxoSt&#39;</a> <a id="6609" class="Symbol">.</a><a id="6610" href="Ledger.Utxo.html#2624" class="Field">deposits</a><a id="6618" class="Symbol">)</a> <a id="6620" class="Symbol">(</a><a id="6621" href="Ledger.Certs.html#2452" class="Field">voteDelegs</a> <a id="6632" href="Ledger.Certs.html#2888" class="Function">dState</a><a id="6638" class="Symbol">)</a>
           <a id="6651" class="Symbol">;</a> <a id="6653" href="Ledger.Ratify.html#3145" class="Field">treasury</a> <a id="6662" class="Symbol">=</a> <a id="6664" href="Ledger.Epoch.html#4189" class="Generalizable">acnt</a> <a id="6669" class="Symbol">.</a><a id="6670" href="Ledger.PParams.html#729" class="Field">treasury</a> <a id="6679" class="Symbol">;</a> <a id="6681" href="Ledger.Epoch.html#6681" class="Module">GState</a> <a id="6688" href="Ledger.Certs.html#2928" class="Function">gState</a>
           <a id="6706" class="Symbol">;</a> <a id="6708" href="Ledger.Ratify.html#3170" class="Field">pools</a> <a id="6714" class="Symbol">=</a> <a id="6716" href="Ledger.Certs.html#2908" class="Function">pState</a> <a id="6723" class="Symbol">.</a><a id="6724" href="Ledger.Certs.html#2606" class="Field">pools</a> <a id="6730" class="Symbol">;</a> <a id="6732" href="Ledger.Ratify.html#3211" class="Field">delegatees</a> <a id="6743" class="Symbol">=</a> <a id="6745" href="Ledger.Certs.html#2888" class="Function">dState</a> <a id="6752" class="Symbol">.</a><a id="6753" href="Ledger.Certs.html#2452" class="Field">voteDelegs</a> <a id="6764" class="Symbol">}</a>
        <a id="6774" href="Ledger.Ratify.html#11776" class="Function Operator">⊢</a> <a id="6776" href="Class.To.html#102" class="Field Operator">⟦</a> <a id="6778" href="Ledger.Epoch.html#4958" class="Bound">es</a> <a id="6781" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="6783" href="Class.HasEmptySet.html#287" class="Field">∅</a> <a id="6785" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="6787" href="Agda.Builtin.Bool.html#192" class="InductiveConstructor">false</a> <a id="6793" href="Class.To.html#102" class="Field Operator">⟧</a> <a id="6795" href="Ledger.Ratify.html#11776" class="Function Operator">⇀⦇</a> <a id="6798" href="Ledger.Epoch.html#5754" class="Bound">govSt&#39;</a> <a id="6805" href="Ledger.Ratify.html#11776" class="Function Operator">,RATIFIES⦈</a> <a id="6816" href="Ledger.Epoch.html#4124" class="Generalizable">fut&#39;</a>
      <a id="6827" class="Symbol">→</a> <a id="6829" href="Ledger.Epoch.html#4175" class="Generalizable">ls</a> <a id="6832" href="Ledger.Epoch.html#4353" class="Datatype Operator">⊢</a> <a id="6834" href="Ledger.Epoch.html#4280" class="Generalizable">ss</a> <a id="6837" href="Ledger.Epoch.html#4353" class="Datatype Operator">⇀⦇</a> <a id="6840" href="Agda.Builtin.Unit.html#212" class="InductiveConstructor">tt</a> <a id="6843" href="Ledger.Epoch.html#4353" class="Datatype Operator">,SNAP⦈</a> <a id="6850" href="Ledger.Epoch.html#4283" class="Generalizable">ss&#39;</a>
    <a id="6858" href="Interface.STS.html#350" class="Function Operator">────────────────────────────────</a>
    <a id="6895" class="Symbol">_</a> <a id="6897" href="Ledger.Epoch.html#4646" class="Datatype Operator">⊢</a> <a id="6899" href="Class.To.html#102" class="Field Operator">⟦</a> <a id="6901" href="Ledger.Epoch.html#4189" class="Generalizable">acnt</a> <a id="6906" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="6908" href="Ledger.Epoch.html#4280" class="Generalizable">ss</a> <a id="6911" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="6913" href="Ledger.Epoch.html#4175" class="Generalizable">ls</a> <a id="6916" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="6918" href="Ledger.Epoch.html#4203" class="Generalizable">es₀</a> <a id="6922" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="6924" href="Ledger.Epoch.html#4120" class="Generalizable">fut</a> <a id="6928" href="Class.To.html#102" class="Field Operator">⟧</a> <a id="6930" href="Ledger.Epoch.html#4646" class="Datatype Operator">⇀⦇</a> <a id="6933" href="Ledger.Epoch.html#4098" class="Generalizable">e</a> <a id="6935" href="Ledger.Epoch.html#4646" class="Datatype Operator">,EPOCH⦈</a>
        <a id="6951" href="Class.To.html#102" class="Field Operator">⟦</a> <a id="6953" href="Ledger.Epoch.html#6343" class="Bound">acnt&#39;</a> <a id="6959" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="6961" href="Ledger.Epoch.html#4283" class="Generalizable">ss&#39;</a> <a id="6965" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="6967" href="Class.To.html#102" class="Field Operator">⟦</a> <a id="6969" href="Ledger.Epoch.html#6228" class="Bound">utxoSt&#39;</a> <a id="6977" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="6979" href="Ledger.Epoch.html#5754" class="Bound">govSt&#39;</a> <a id="6986" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="6988" href="Ledger.Epoch.html#6147" class="Bound">certState&#39;</a> <a id="6999" href="Class.To.html#102" class="Field Operator">⟧</a> <a id="7001" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="7003" href="Ledger.Epoch.html#4958" class="Bound">es</a> <a id="7006" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="7008" href="Ledger.Epoch.html#4124" class="Generalizable">fut&#39;</a> <a id="7013" href="Class.To.html#102" class="Field Operator">⟧</a>


<a id="7017" class="Keyword">data</a>


  <a id="_⊢_⇀⦇_,NEWEPOCH⦈_"></a><a id="7026" href="Ledger.Epoch.html#7026" class="Datatype Operator">_⊢_⇀⦇_,NEWEPOCH⦈_</a> <a id="7044" class="Symbol">:</a> <a id="7046" href="Agda.Builtin.Unit.html#175" class="Record">⊤</a> <a id="7048" class="Symbol">→</a> <a id="7050" href="Ledger.Epoch.html#1330" class="Record">NewEpochState</a> <a id="7064" class="Symbol">→</a> <a id="7066" href="Ledger.Types.Epoch.html#476" class="Function">Epoch</a> <a id="7072" class="Symbol">→</a> <a id="7074" href="Ledger.Epoch.html#1330" class="Record">NewEpochState</a> <a id="7088" class="Symbol">→</a> <a id="7090" href="Agda.Primitive.html#388" class="Primitive">Type</a>


  <a id="7099" class="Keyword">where</a>


  <a id="_⊢_⇀⦇_,NEWEPOCH⦈_.NEWEPOCH-New"></a><a id="7109" href="Ledger.Epoch.html#7109" class="InductiveConstructor">NEWEPOCH-New</a> <a id="7122" class="Symbol">:</a> <a id="7124" class="Keyword">let</a>
      <a id="7134" href="Ledger.Epoch.html#7134" class="Bound">eps&#39;</a> <a id="7139" class="Symbol">=</a> <a id="7141" href="Ledger.Epoch.html#2095" class="Function">applyRUpd</a> <a id="7151" href="Ledger.Epoch.html#4301" class="Generalizable">ru</a> <a id="7154" href="Ledger.Epoch.html#4145" class="Generalizable">eps</a>
    <a id="7162" class="Keyword">in</a>
    <a id="7169" href="Interface.STS.html#105" class="Function Operator">∙</a> <a id="7171" href="Ledger.Epoch.html#4098" class="Generalizable">e</a> <a id="7173" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="7175" href="Ledger.Epoch.html#4100" class="Generalizable">lastEpoch</a> <a id="7185" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="7187" class="Number">1</a>
    <a id="7193" href="Interface.STS.html#131" class="Function Operator">∙</a> <a id="7195" class="Symbol">_</a> <a id="7197" href="Ledger.Epoch.html#4646" class="Datatype Operator">⊢</a> <a id="7199" href="Ledger.Epoch.html#7134" class="Bound">eps&#39;</a> <a id="7204" href="Ledger.Epoch.html#4646" class="Datatype Operator">⇀⦇</a> <a id="7207" href="Ledger.Epoch.html#4098" class="Generalizable">e</a> <a id="7209" href="Ledger.Epoch.html#4646" class="Datatype Operator">,EPOCH⦈</a> <a id="7217" href="Ledger.Epoch.html#4154" class="Generalizable">eps&#39;&#39;</a>
      <a id="7229" href="Interface.STS.html#350" class="Function Operator">────────────────────────────────</a>
      <a id="7268" class="Symbol">_</a> <a id="7270" href="Ledger.Epoch.html#7026" class="Datatype Operator">⊢</a> <a id="7272" href="Class.To.html#102" class="Field Operator">⟦</a> <a id="7274" href="Ledger.Epoch.html#4100" class="Generalizable">lastEpoch</a> <a id="7284" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="7286" href="Ledger.Epoch.html#4145" class="Generalizable">eps</a> <a id="7290" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="7292" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="7297" href="Ledger.Epoch.html#4301" class="Generalizable">ru</a> <a id="7300" href="Class.To.html#102" class="Field Operator">⟧</a> <a id="7302" href="Ledger.Epoch.html#7026" class="Datatype Operator">⇀⦇</a> <a id="7305" href="Ledger.Epoch.html#4098" class="Generalizable">e</a> <a id="7307" href="Ledger.Epoch.html#7026" class="Datatype Operator">,NEWEPOCH⦈</a> <a id="7318" href="Class.To.html#102" class="Field Operator">⟦</a> <a id="7320" href="Ledger.Epoch.html#4098" class="Generalizable">e</a> <a id="7322" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="7324" href="Ledger.Epoch.html#4154" class="Generalizable">eps&#39;&#39;</a> <a id="7330" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="7332" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a> <a id="7340" href="Class.To.html#102" class="Field Operator">⟧</a>

  <a id="_⊢_⇀⦇_,NEWEPOCH⦈_.NEWEPOCH-Not-New"></a><a id="7345" href="Ledger.Epoch.html#7345" class="InductiveConstructor">NEWEPOCH-Not-New</a> <a id="7362" class="Symbol">:</a>
    <a id="7368" href="Interface.STS.html#105" class="Function Operator">∙</a> <a id="7370" href="Ledger.Epoch.html#4098" class="Generalizable">e</a> <a id="7372" href="Relation.Binary.PropositionalEquality.Core.html#858" class="Function Operator">≢</a> <a id="7374" href="Ledger.Epoch.html#4100" class="Generalizable">lastEpoch</a> <a id="7384" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="7386" class="Number">1</a>
      <a id="7394" href="Interface.STS.html#350" class="Function Operator">────────────────────────────────</a>
      <a id="7433" class="Symbol">_</a> <a id="7435" href="Ledger.Epoch.html#7026" class="Datatype Operator">⊢</a> <a id="7437" href="Class.To.html#102" class="Field Operator">⟦</a> <a id="7439" href="Ledger.Epoch.html#4100" class="Generalizable">lastEpoch</a> <a id="7449" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="7451" href="Ledger.Epoch.html#4145" class="Generalizable">eps</a> <a id="7455" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="7457" href="Ledger.Epoch.html#4321" class="Generalizable">mru</a> <a id="7461" href="Class.To.html#102" class="Field Operator">⟧</a> <a id="7463" href="Ledger.Epoch.html#7026" class="Datatype Operator">⇀⦇</a> <a id="7466" href="Ledger.Epoch.html#4098" class="Generalizable">e</a> <a id="7468" href="Ledger.Epoch.html#7026" class="Datatype Operator">,NEWEPOCH⦈</a> <a id="7479" href="Class.To.html#102" class="Field Operator">⟦</a> <a id="7481" href="Ledger.Epoch.html#4100" class="Generalizable">lastEpoch</a> <a id="7491" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="7493" href="Ledger.Epoch.html#4145" class="Generalizable">eps</a> <a id="7497" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="7499" href="Ledger.Epoch.html#4321" class="Generalizable">mru</a> <a id="7503" href="Class.To.html#102" class="Field Operator">⟧</a>

  <a id="_⊢_⇀⦇_,NEWEPOCH⦈_.NEWEPOCH-No-Reward-Update"></a><a id="7508" href="Ledger.Epoch.html#7508" class="InductiveConstructor">NEWEPOCH-No-Reward-Update</a> <a id="7534" class="Symbol">:</a>
    <a id="7540" href="Interface.STS.html#105" class="Function Operator">∙</a> <a id="7542" href="Ledger.Epoch.html#4098" class="Generalizable">e</a> <a id="7544" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="7546" href="Ledger.Epoch.html#4100" class="Generalizable">lastEpoch</a> <a id="7556" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="7558" class="Number">1</a>
    <a id="7564" href="Interface.STS.html#131" class="Function Operator">∙</a> <a id="7566" class="Symbol">_</a> <a id="7568" href="Ledger.Epoch.html#4646" class="Datatype Operator">⊢</a> <a id="7570" href="Ledger.Epoch.html#4145" class="Generalizable">eps</a> <a id="7574" href="Ledger.Epoch.html#4646" class="Datatype Operator">⇀⦇</a> <a id="7577" href="Ledger.Epoch.html#4098" class="Generalizable">e</a> <a id="7579" href="Ledger.Epoch.html#4646" class="Datatype Operator">,EPOCH⦈</a> <a id="7587" href="Ledger.Epoch.html#4149" class="Generalizable">eps&#39;</a>
      <a id="7598" href="Interface.STS.html#350" class="Function Operator">────────────────────────────────</a>
      <a id="7637" class="Symbol">_</a> <a id="7639" href="Ledger.Epoch.html#7026" class="Datatype Operator">⊢</a> <a id="7641" href="Class.To.html#102" class="Field Operator">⟦</a> <a id="7643" href="Ledger.Epoch.html#4100" class="Generalizable">lastEpoch</a> <a id="7653" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="7655" href="Ledger.Epoch.html#4145" class="Generalizable">eps</a> <a id="7659" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="7661" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a> <a id="7669" href="Class.To.html#102" class="Field Operator">⟧</a> <a id="7671" href="Ledger.Epoch.html#7026" class="Datatype Operator">⇀⦇</a> <a id="7674" href="Ledger.Epoch.html#4098" class="Generalizable">e</a> <a id="7676" href="Ledger.Epoch.html#7026" class="Datatype Operator">,NEWEPOCH⦈</a> <a id="7687" href="Class.To.html#102" class="Field Operator">⟦</a> <a id="7689" href="Ledger.Epoch.html#4098" class="Generalizable">e</a> <a id="7691" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="7693" href="Ledger.Epoch.html#4149" class="Generalizable">eps&#39;</a> <a id="7698" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="7700" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a> <a id="7708" href="Class.To.html#102" class="Field Operator">⟧</a>

</pre></body></html>