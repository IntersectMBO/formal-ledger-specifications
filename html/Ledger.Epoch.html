<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>Ledger.Epoch</title><link rel="stylesheet" href="Agda.css"></head><body><pre class="Agda">
<a id="2" class="Symbol">{-#</a> <a id="6" class="Keyword">OPTIONS</a> <a id="14" class="Pragma">--safe</a> <a id="21" class="Symbol">#-}</a>

<a id="26" class="Keyword">open</a> <a id="31" class="Keyword">import</a> <a id="38" href="Data.Nat.Properties.html" class="Module">Data.Nat.Properties</a> <a id="58" class="Keyword">using</a> <a id="64" class="Symbol">(</a><a id="65" href="Data.Nat.Properties.html#17252" class="Function">+-0-monoid</a><a id="75" class="Symbol">;</a> <a id="77" href="Data.Nat.Properties.html#17331" class="Function">+-0-commutativeMonoid</a><a id="98" class="Symbol">)</a>
<a id="100" class="Keyword">open</a> <a id="105" class="Keyword">import</a> <a id="112" href="Data.Integer.html" class="Module">Data.Integer</a> <a id="125" class="Keyword">using</a> <a id="131" class="Symbol">()</a> <a id="134" class="Keyword">renaming</a> <a id="143" class="Symbol">(</a><a id="144" href="Agda.Builtin.Int.html#263" class="InductiveConstructor">+_</a> <a id="147" class="Symbol">to</a> <a id="150" class="InductiveConstructor">pos</a><a id="153" class="Symbol">)</a>
<a id="155" class="Keyword">open</a> <a id="160" class="Keyword">import</a> <a id="167" href="Data.Nat.GeneralisedArithmetic.html" class="Module">Data.Nat.GeneralisedArithmetic</a> <a id="198" class="Keyword">using</a> <a id="204" class="Symbol">(</a><a id="205" href="Data.Nat.GeneralisedArithmetic.html#866" class="Function">iterate</a><a id="212" class="Symbol">)</a>
<a id="214" class="Keyword">open</a> <a id="219" class="Keyword">import</a> <a id="226" href="Data.Rational.html" class="Module">Data.Rational</a> <a id="240" class="Keyword">using</a> <a id="246" class="Symbol">(</a><a id="247" href="Data.Rational.Base.html#1342" class="Record">ℚ</a><a id="248" class="Symbol">;</a> <a id="250" href="Data.Rational.Base.html#7116" class="Function">floor</a><a id="255" class="Symbol">;</a> <a id="257" href="Data.Rational.Base.html#6315" class="Function Operator">_*_</a><a id="260" class="Symbol">;</a> <a id="262" href="Data.Rational.Base.html#6708" class="Function Operator">_÷_</a><a id="265" class="Symbol">;</a> <a id="267" href="Data.Rational.Base.html#3884" class="Function Operator">_/_</a><a id="270" class="Symbol">)</a>
<a id="272" class="Keyword">open</a> <a id="277" class="Keyword">import</a> <a id="284" href="Data.Rational.Literals.html" class="Module">Data.Rational.Literals</a> <a id="307" class="Keyword">using</a> <a id="313" class="Symbol">(</a><a id="314" href="Data.Rational.Literals.html#740" class="Function">number</a><a id="320" class="Symbol">;</a> <a id="322" href="Data.Rational.Literals.html#613" class="Function">fromℤ</a><a id="327" class="Symbol">)</a>
<a id="329" class="Keyword">import</a>      <a id="341" href="Data.Rational.html" class="Module">Data.Rational</a> <a id="355" class="Symbol">as</a> <a id="358" class="Module">ℚ</a> <a id="360" class="Keyword">renaming</a> <a id="369" class="Symbol">(</a><a id="370" href="Data.Rational.Base.html#6854" class="Function Operator">_⊓_</a> <a id="374" class="Symbol">to</a> <a id="377" class="Function Operator">min</a><a id="380" class="Symbol">)</a>

<a id="383" class="Keyword">open</a> <a id="388" class="Keyword">import</a> <a id="395" href="Agda.Builtin.FromNat.html" class="Module">Agda.Builtin.FromNat</a>

<a id="417" class="Keyword">open</a> <a id="422" class="Keyword">import</a> <a id="429" href="Ledger.Prelude.html" class="Module">Ledger.Prelude</a> <a id="444" class="Keyword">hiding</a> <a id="451" class="Symbol">(</a><a id="452" href="Data.List.Base.html#5412" class="Function">iterate</a><a id="459" class="Symbol">;</a> <a id="461" href="Data.Nat.Base.html#7102" class="Function Operator">_/_</a><a id="464" class="Symbol">;</a> <a id="466" href="Agda.Builtin.Nat.html#539" class="Primitive Operator">_*_</a><a id="469" class="Symbol">)</a>
<a id="471" class="Keyword">open</a> <a id="476" href="Ledger.Prelude.html#2677" class="Module">Filter</a> <a id="483" class="Keyword">using</a> <a id="489" class="Symbol">(</a><a id="490" href="Ledger.Prelude.html#2692" class="Function">filter</a><a id="496" class="Symbol">)</a>
<a id="498" class="Keyword">open</a> <a id="503" class="Keyword">import</a> <a id="510" href="Ledger.Abstract.html" class="Module">Ledger.Abstract</a>
<a id="526" class="Keyword">open</a> <a id="531" class="Keyword">import</a> <a id="538" href="Ledger.Transaction.html" class="Module">Ledger.Transaction</a>
<a id="557" class="Keyword">open</a> <a id="562" class="Keyword">import</a> <a id="569" href="Ledger.Types.Numeric.UnitInterval.html" class="Module">Ledger.Types.Numeric.UnitInterval</a>

<a id="604" class="Keyword">open</a> <a id="609" href="Agda.Builtin.FromNat.html#196" class="Module">Number</a> <a id="616" href="Data.Rational.Literals.html#740" class="Function">number</a> <a id="623" class="Keyword">renaming</a> <a id="632" class="Symbol">(</a><a id="633" href="Agda.Builtin.FromNat.html#281" class="Field">fromNat</a> <a id="641" class="Symbol">to</a> <a id="644" class="Field">fromℕ</a><a id="649" class="Symbol">)</a>

<a id="652" class="Keyword">module</a> <a id="659" href="Ledger.Epoch.html" class="Module">Ledger.Epoch</a>
  <a id="674" class="Symbol">(</a><a id="675" href="Ledger.Epoch.html#675" class="Bound">txs</a> <a id="679" class="Symbol">:</a> <a id="681" class="Symbol">_)</a> <a id="684" class="Symbol">(</a><a id="685" class="Keyword">open</a> <a id="690" href="Ledger.Transaction.html#840" class="Module">TransactionStructure</a> <a id="711" href="Ledger.Epoch.html#675" class="Bound">txs</a><a id="714" class="Symbol">)</a>
  <a id="718" class="Symbol">(</a><a id="719" href="Ledger.Epoch.html#719" class="Bound">abs</a> <a id="723" class="Symbol">:</a> <a id="725" href="Ledger.Abstract.html#578" class="Record">AbstractFunctions</a> <a id="743" href="Ledger.Epoch.html#675" class="Bound">txs</a><a id="746" class="Symbol">)</a> <a id="748" class="Symbol">(</a><a id="749" class="Keyword">open</a> <a id="754" href="Ledger.Abstract.html#578" class="Module">AbstractFunctions</a> <a id="772" href="Ledger.Epoch.html#719" class="Bound">abs</a><a id="775" class="Symbol">)</a>
  <a id="779" class="Keyword">where</a>

<a id="786" class="Keyword">open</a> <a id="791" class="Keyword">import</a> <a id="798" href="Ledger.Certs.html" class="Module">Ledger.Certs</a> <a id="811" href="Ledger.Transaction.html#1782" class="Function">govStructure</a>
<a id="824" class="Keyword">open</a> <a id="829" class="Keyword">import</a> <a id="836" href="Ledger.Enact.html" class="Module">Ledger.Enact</a> <a id="849" href="Ledger.Transaction.html#1782" class="Function">govStructure</a>
<a id="862" class="Keyword">open</a> <a id="867" class="Keyword">import</a> <a id="874" href="Ledger.Gov.html" class="Module">Ledger.Gov</a> <a id="885" href="Ledger.Epoch.html#675" class="Bound">txs</a>
<a id="889" class="Keyword">open</a> <a id="894" class="Keyword">import</a> <a id="901" href="Ledger.Ledger.html" class="Module">Ledger.Ledger</a> <a id="915" href="Ledger.Epoch.html#675" class="Bound">txs</a> <a id="919" href="Ledger.Epoch.html#719" class="Bound">abs</a>
<a id="923" class="Keyword">open</a> <a id="928" class="Keyword">import</a> <a id="935" href="Ledger.Ratify.html" class="Module">Ledger.Ratify</a> <a id="949" href="Ledger.Epoch.html#675" class="Bound">txs</a>
<a id="953" class="Keyword">open</a> <a id="958" class="Keyword">import</a> <a id="965" href="Ledger.Rewards.html" class="Module">Ledger.Rewards</a> <a id="980" href="Ledger.Epoch.html#675" class="Bound">txs</a> <a id="984" href="Ledger.Epoch.html#719" class="Bound">abs</a>
<a id="988" class="Keyword">open</a> <a id="993" class="Keyword">import</a> <a id="1000" href="Ledger.Utxo.html" class="Module">Ledger.Utxo</a> <a id="1012" href="Ledger.Epoch.html#675" class="Bound">txs</a> <a id="1016" href="Ledger.Epoch.html#719" class="Bound">abs</a>




<a id="1024" class="Keyword">record</a> <a id="EpochState"></a><a id="1031" href="Ledger.Epoch.html#1031" class="Record">EpochState</a> <a id="1042" class="Symbol">:</a> <a id="1044" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="1049" class="Keyword">where</a>


  <a id="1059" class="Keyword">constructor</a> <a id="⟦_,_,_,_,_⟧ᵉ&#39;"></a><a id="1071" href="Ledger.Epoch.html#1071" class="InductiveConstructor Operator">⟦_,_,_,_,_⟧ᵉ&#39;</a>


  <a id="1089" class="Keyword">field</a>
    <a id="EpochState.acnt"></a><a id="1099" href="Ledger.Epoch.html#1099" class="Field">acnt</a>       <a id="1110" class="Symbol">:</a> <a id="1112" href="Ledger.PParams.html#674" class="Record">Acnt</a>
    <a id="EpochState.ss"></a><a id="1121" href="Ledger.Epoch.html#1121" class="Field">ss</a>         <a id="1132" class="Symbol">:</a> <a id="1134" href="Ledger.Rewards.html#6668" class="Record">Snapshots</a>
    <a id="EpochState.ls"></a><a id="1148" href="Ledger.Epoch.html#1148" class="Field">ls</a>         <a id="1159" class="Symbol">:</a> <a id="1161" href="Ledger.Ledger.html#809" class="Record">LState</a>
    <a id="EpochState.es"></a><a id="1172" href="Ledger.Epoch.html#1172" class="Field">es</a>         <a id="1183" class="Symbol">:</a> <a id="1185" href="Ledger.Enact.html#397" class="Record">EnactState</a>
    <a id="EpochState.fut"></a><a id="1200" href="Ledger.Epoch.html#1200" class="Field">fut</a>        <a id="1211" class="Symbol">:</a> <a id="1213" href="Ledger.Ratify.html#3279" class="Record">RatifyState</a>



<a id="1228" class="Keyword">record</a> <a id="HasEpochState"></a><a id="1235" href="Ledger.Epoch.html#1235" class="Record">HasEpochState</a> <a id="1249" class="Symbol">{</a><a id="1250" href="Ledger.Epoch.html#1250" class="Bound">a</a><a id="1251" class="Symbol">}</a> <a id="1253" class="Symbol">(</a><a id="1254" href="Ledger.Epoch.html#1254" class="Bound">A</a> <a id="1256" class="Symbol">:</a> <a id="1258" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="1263" href="Ledger.Epoch.html#1250" class="Bound">a</a><a id="1264" class="Symbol">)</a> <a id="1266" class="Symbol">:</a> <a id="1268" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="1273" href="Ledger.Epoch.html#1250" class="Bound">a</a> <a id="1275" class="Keyword">where</a>
  <a id="1283" class="Keyword">field</a> <a id="HasEpochState.EpochStateOf"></a><a id="1289" href="Ledger.Epoch.html#1289" class="Field">EpochStateOf</a> <a id="1302" class="Symbol">:</a> <a id="1304" href="Ledger.Epoch.html#1254" class="Bound">A</a> <a id="1306" class="Symbol">→</a> <a id="1308" href="Ledger.Epoch.html#1031" class="Record">EpochState</a>
<a id="1319" class="Keyword">open</a> <a id="1324" href="Ledger.Epoch.html#1235" class="Module">HasEpochState</a> <a id="1338" class="Symbol">⦃...⦄</a> <a id="1344" class="Keyword">public</a>

<a id="1352" class="Keyword">instance</a>
  <a id="HasLState-EpochState"></a><a id="1363" href="Ledger.Epoch.html#1363" class="Function">HasLState-EpochState</a> <a id="1384" class="Symbol">:</a> <a id="1386" href="Ledger.Ledger.html#954" class="Record">HasLState</a> <a id="1396" href="Ledger.Epoch.html#1031" class="Record">EpochState</a>
  <a id="1409" href="Ledger.Epoch.html#1363" class="Function">HasLState-EpochState</a> <a id="1430" class="Symbol">.</a><a id="1431" href="Ledger.Ledger.html#1004" class="Field">LStateOf</a> <a id="1440" class="Symbol">=</a> <a id="1442" href="Ledger.Epoch.html#1148" class="Field">EpochState.ls</a>

  <a id="HasEnactState-EpochState"></a><a id="1459" href="Ledger.Epoch.html#1459" class="Function">HasEnactState-EpochState</a> <a id="1484" class="Symbol">:</a> <a id="1486" href="Ledger.Enact.html#689" class="Record">HasEnactState</a> <a id="1500" href="Ledger.Epoch.html#1031" class="Record">EpochState</a>
  <a id="1513" href="Ledger.Epoch.html#1459" class="Function">HasEnactState-EpochState</a> <a id="1538" class="Symbol">.</a><a id="1539" href="Ledger.Enact.html#743" class="Field">EnactStateOf</a> <a id="1552" class="Symbol">=</a> <a id="1554" href="Ledger.Epoch.html#1172" class="Field">EpochState.es</a>

  <a id="HasDeposits-EpochState"></a><a id="1571" href="Ledger.Epoch.html#1571" class="Function">HasDeposits-EpochState</a> <a id="1594" class="Symbol">:</a> <a id="1596" href="Ledger.Certs.html#677" class="Record">HasDeposits</a> <a id="1608" href="Ledger.Epoch.html#1031" class="Record">EpochState</a>
  <a id="1621" href="Ledger.Epoch.html#1571" class="Function">HasDeposits-EpochState</a> <a id="1644" class="Symbol">.</a><a id="1645" href="Ledger.Certs.html#729" class="Field">DepositsOf</a> <a id="1656" class="Symbol">=</a> <a id="1658" href="Ledger.Certs.html#729" class="Field">DepositsOf</a> <a id="1669" href="Function.Base.html#1115" class="Function Operator">∘</a> <a id="1671" href="Ledger.Ledger.html#1004" class="Field">LStateOf</a>

  <a id="Hastreasury-EpochState"></a><a id="1683" href="Ledger.Epoch.html#1683" class="Function">Hastreasury-EpochState</a> <a id="1706" class="Symbol">:</a> <a id="1708" href="Ledger.PParams.html#762" class="Record">Hastreasury</a> <a id="1720" href="Ledger.Epoch.html#1031" class="Record">EpochState</a>
  <a id="1733" href="Ledger.Epoch.html#1683" class="Function">Hastreasury-EpochState</a> <a id="1756" class="Symbol">.</a><a id="1757" href="Ledger.PParams.html#814" class="Field">treasuryOf</a> <a id="1768" class="Symbol">=</a> <a id="1770" href="Ledger.PParams.html#729" class="Field">Acnt.treasury</a> <a id="1784" href="Function.Base.html#1115" class="Function Operator">∘</a> <a id="1786" href="Ledger.Epoch.html#1099" class="Field">EpochState.acnt</a>



<a id="1805" class="Keyword">record</a> <a id="NewEpochState"></a><a id="1812" href="Ledger.Epoch.html#1812" class="Record">NewEpochState</a> <a id="1826" class="Symbol">:</a> <a id="1828" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="1833" class="Keyword">where</a>
  <a id="1841" class="Keyword">field</a>
    <a id="NewEpochState.lastEpoch"></a><a id="1851" href="Ledger.Epoch.html#1851" class="Field">lastEpoch</a>   <a id="1863" class="Symbol">:</a> <a id="1865" href="Ledger.Types.Epoch.html#543" class="Function">Epoch</a>
    <a id="NewEpochState.epochState"></a><a id="1875" href="Ledger.Epoch.html#1875" class="Field">epochState</a>  <a id="1887" class="Symbol">:</a> <a id="1889" href="Ledger.Epoch.html#1031" class="Record">EpochState</a>
    <a id="NewEpochState.ru"></a><a id="1904" href="Ledger.Epoch.html#1904" class="Field">ru</a>          <a id="1916" class="Symbol">:</a> <a id="1918" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="1924" href="Ledger.Rewards.html#5822" class="Record">RewardUpdate</a>


<a id="1939" class="Keyword">record</a> <a id="HasNewEpochState"></a><a id="1946" href="Ledger.Epoch.html#1946" class="Record">HasNewEpochState</a> <a id="1963" class="Symbol">{</a><a id="1964" href="Ledger.Epoch.html#1964" class="Bound">a</a><a id="1965" class="Symbol">}</a> <a id="1967" class="Symbol">(</a><a id="1968" href="Ledger.Epoch.html#1968" class="Bound">A</a> <a id="1970" class="Symbol">:</a> <a id="1972" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="1977" href="Ledger.Epoch.html#1964" class="Bound">a</a><a id="1978" class="Symbol">)</a> <a id="1980" class="Symbol">:</a> <a id="1982" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="1987" href="Ledger.Epoch.html#1964" class="Bound">a</a> <a id="1989" class="Keyword">where</a>
  <a id="1997" class="Keyword">field</a> <a id="HasNewEpochState.NewEpochStateOf"></a><a id="2003" href="Ledger.Epoch.html#2003" class="Field">NewEpochStateOf</a> <a id="2019" class="Symbol">:</a> <a id="2021" href="Ledger.Epoch.html#1968" class="Bound">A</a> <a id="2023" class="Symbol">→</a> <a id="2025" href="Ledger.Epoch.html#1812" class="Record">NewEpochState</a>
<a id="2039" class="Keyword">open</a> <a id="2044" href="Ledger.Epoch.html#1946" class="Module">HasNewEpochState</a> <a id="2061" class="Symbol">⦃...⦄</a> <a id="2067" class="Keyword">public</a>
<a id="2074" class="Keyword">record</a> <a id="HasLastEpoch"></a><a id="2081" href="Ledger.Epoch.html#2081" class="Record">HasLastEpoch</a>     <a id="2098" class="Symbol">{</a><a id="2099" href="Ledger.Epoch.html#2099" class="Bound">a</a><a id="2100" class="Symbol">}</a> <a id="2102" class="Symbol">(</a><a id="2103" href="Ledger.Epoch.html#2103" class="Bound">A</a> <a id="2105" class="Symbol">:</a> <a id="2107" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="2112" href="Ledger.Epoch.html#2099" class="Bound">a</a><a id="2113" class="Symbol">)</a> <a id="2115" class="Symbol">:</a> <a id="2117" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="2122" href="Ledger.Epoch.html#2099" class="Bound">a</a> <a id="2124" class="Keyword">where</a> <a id="2130" class="Keyword">field</a> <a id="HasLastEpoch.LastEpochOf"></a><a id="2136" href="Ledger.Epoch.html#2136" class="Field">LastEpochOf</a>     <a id="2152" class="Symbol">:</a> <a id="2154" href="Ledger.Epoch.html#2103" class="Bound">A</a> <a id="2156" class="Symbol">→</a> <a id="2158" href="Ledger.Types.Epoch.html#543" class="Function">Epoch</a>
<a id="2164" class="Keyword">open</a> <a id="2169" href="Ledger.Epoch.html#2081" class="Module">HasLastEpoch</a>     <a id="2186" class="Symbol">⦃...⦄</a> <a id="2192" class="Keyword">public</a>

<a id="2200" class="Keyword">instance</a>
  <a id="HasLastEpoch-NewEpochState"></a><a id="2211" href="Ledger.Epoch.html#2211" class="Function">HasLastEpoch-NewEpochState</a> <a id="2238" class="Symbol">:</a> <a id="2240" href="Ledger.Epoch.html#2081" class="Record">HasLastEpoch</a> <a id="2253" href="Ledger.Epoch.html#1812" class="Record">NewEpochState</a>
  <a id="2269" href="Ledger.Epoch.html#2211" class="Function">HasLastEpoch-NewEpochState</a> <a id="2296" class="Symbol">.</a><a id="2297" href="Ledger.Epoch.html#2136" class="Field">LastEpochOf</a> <a id="2309" class="Symbol">=</a> <a id="2311" href="Ledger.Epoch.html#1851" class="Field">NewEpochState.lastEpoch</a>

  <a id="HasEpochState-NewEpochState"></a><a id="2338" href="Ledger.Epoch.html#2338" class="Function">HasEpochState-NewEpochState</a> <a id="2366" class="Symbol">:</a> <a id="2368" href="Ledger.Epoch.html#1235" class="Record">HasEpochState</a> <a id="2382" href="Ledger.Epoch.html#1812" class="Record">NewEpochState</a>
  <a id="2398" href="Ledger.Epoch.html#2338" class="Function">HasEpochState-NewEpochState</a> <a id="2426" class="Symbol">.</a><a id="2427" href="Ledger.Epoch.html#1289" class="Field">EpochStateOf</a> <a id="2440" class="Symbol">=</a> <a id="2442" href="Ledger.Epoch.html#1875" class="Field">NewEpochState.epochState</a>

  <a id="Hastreasury-NewEpochState"></a><a id="2470" href="Ledger.Epoch.html#2470" class="Function">Hastreasury-NewEpochState</a> <a id="2496" class="Symbol">:</a> <a id="2498" href="Ledger.PParams.html#762" class="Record">Hastreasury</a> <a id="2510" href="Ledger.Epoch.html#1812" class="Record">NewEpochState</a>
  <a id="2526" href="Ledger.Epoch.html#2470" class="Function">Hastreasury-NewEpochState</a> <a id="2552" class="Symbol">.</a><a id="2553" href="Ledger.PParams.html#814" class="Field">treasuryOf</a> <a id="2564" class="Symbol">=</a> <a id="2566" href="Ledger.PParams.html#814" class="Field">treasuryOf</a> <a id="2577" href="Function.Base.html#1115" class="Function Operator">∘</a> <a id="2579" href="Ledger.Epoch.html#1289" class="Field">EpochStateOf</a>

  <a id="HasLState-NewEpochState"></a><a id="2595" href="Ledger.Epoch.html#2595" class="Function">HasLState-NewEpochState</a> <a id="2619" class="Symbol">:</a> <a id="2621" href="Ledger.Ledger.html#954" class="Record">HasLState</a> <a id="2631" href="Ledger.Epoch.html#1812" class="Record">NewEpochState</a>
  <a id="2647" href="Ledger.Epoch.html#2595" class="Function">HasLState-NewEpochState</a> <a id="2671" class="Symbol">.</a><a id="2672" href="Ledger.Ledger.html#1004" class="Field">LStateOf</a> <a id="2681" class="Symbol">=</a> <a id="2683" href="Ledger.Ledger.html#1004" class="Field">LStateOf</a> <a id="2692" href="Function.Base.html#1115" class="Function Operator">∘</a> <a id="2694" href="Ledger.Epoch.html#1289" class="Field">EpochStateOf</a>

  <a id="HasGovState-NewEpochState"></a><a id="2710" href="Ledger.Epoch.html#2710" class="Function">HasGovState-NewEpochState</a> <a id="2736" class="Symbol">:</a> <a id="2738" href="Ledger.Gov.html#1422" class="Record">HasGovState</a> <a id="2750" href="Ledger.Epoch.html#1812" class="Record">NewEpochState</a>
  <a id="2766" href="Ledger.Epoch.html#2710" class="Function">HasGovState-NewEpochState</a> <a id="2792" class="Symbol">.</a><a id="2793" href="Ledger.Gov.html#1474" class="Field">GovStateOf</a> <a id="2804" class="Symbol">=</a> <a id="2806" href="Ledger.Gov.html#1474" class="Field">GovStateOf</a> <a id="2817" href="Function.Base.html#1115" class="Function Operator">∘</a> <a id="2819" href="Ledger.Ledger.html#1004" class="Field">LStateOf</a>

  <a id="HasCertState-NewEpochState"></a><a id="2831" href="Ledger.Epoch.html#2831" class="Function">HasCertState-NewEpochState</a> <a id="2858" class="Symbol">:</a> <a id="2860" href="Ledger.Certs.html#4455" class="Record">HasCertState</a> <a id="2873" href="Ledger.Epoch.html#1812" class="Record">NewEpochState</a>
  <a id="2889" href="Ledger.Epoch.html#2831" class="Function">HasCertState-NewEpochState</a> <a id="2916" class="Symbol">.</a><a id="2917" href="Ledger.Certs.html#4508" class="Field">CertStateOf</a> <a id="2929" class="Symbol">=</a> <a id="2931" href="Ledger.Certs.html#4508" class="Field">CertStateOf</a> <a id="2943" href="Function.Base.html#1115" class="Function Operator">∘</a> <a id="2945" href="Ledger.Ledger.html#1004" class="Field">LStateOf</a>

  <a id="HasDReps-NewEpochState"></a><a id="2957" href="Ledger.Epoch.html#2957" class="Function">HasDReps-NewEpochState</a> <a id="2980" class="Symbol">:</a> <a id="2982" href="Ledger.Certs.html#906" class="Record">HasDReps</a> <a id="2991" href="Ledger.Epoch.html#1812" class="Record">NewEpochState</a> 
  <a id="3008" href="Ledger.Epoch.html#2957" class="Function">HasDReps-NewEpochState</a> <a id="3031" class="Symbol">.</a><a id="3032" href="Ledger.Certs.html#955" class="Field">DRepsOf</a> <a id="3040" class="Symbol">=</a> <a id="3042" href="Ledger.Certs.html#955" class="Field">DRepsOf</a> <a id="3050" href="Function.Base.html#1115" class="Function Operator">∘</a> <a id="3052" href="Ledger.Certs.html#4508" class="Field">CertStateOf</a>

  <a id="HasRewards-NewEpochState"></a><a id="3067" href="Ledger.Epoch.html#3067" class="Function">HasRewards-NewEpochState</a> <a id="3092" class="Symbol">:</a> <a id="3094" href="Ledger.Certs.html#793" class="Record">HasRewards</a> <a id="3105" href="Ledger.Epoch.html#1812" class="Record">NewEpochState</a>
  <a id="3121" href="Ledger.Epoch.html#3067" class="Function">HasRewards-NewEpochState</a> <a id="3146" class="Symbol">.</a><a id="3147" href="Ledger.Certs.html#844" class="Field">RewardsOf</a> <a id="3157" class="Symbol">=</a> <a id="3159" href="Ledger.Certs.html#844" class="Field">RewardsOf</a> <a id="3169" href="Function.Base.html#1115" class="Function Operator">∘</a> <a id="3171" href="Ledger.Certs.html#4508" class="Field">CertStateOf</a>

  <a id="3186" class="Keyword">unquoteDecl</a> <a id="HasCast-RewardUpdate"></a><a id="3198" href="Ledger.Epoch.html#3198" class="Function">HasCast-RewardUpdate</a> <a id="HasCast-EpochState"></a><a id="3219" href="Ledger.Epoch.html#3219" class="Function">HasCast-EpochState</a> <a id="HasCast-NewEpochState"></a><a id="3238" href="Ledger.Epoch.html#3238" class="Function">HasCast-NewEpochState</a> <a id="3260" class="Symbol">=</a> <a id="3262" href="stdlib-classes.Class.HasCast.Derive.html#2690" class="Function">derive-HasCast</a>
    <a id="3281" class="Symbol">(</a>   <a id="3285" class="Symbol">(</a><a id="3286" class="Keyword">quote</a> <a id="3292" href="Ledger.Rewards.html#5822" class="Record">RewardUpdate</a>   <a id="3307" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="3309" href="Ledger.Epoch.html#3198" class="Function">HasCast-RewardUpdate</a><a id="3329" class="Symbol">)</a>
    <a id="3335" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a>   <a id="3339" class="Symbol">(</a><a id="3340" class="Keyword">quote</a> <a id="3346" href="Ledger.Epoch.html#1031" class="Record">EpochState</a>     <a id="3361" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="3363" href="Ledger.Epoch.html#3219" class="Function">HasCast-EpochState</a><a id="3381" class="Symbol">)</a>
    <a id="3387" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="3389" href="Data.List.Base.html#5205" class="Function Operator">[</a> <a id="3391" class="Symbol">(</a><a id="3392" class="Keyword">quote</a> <a id="3398" href="Ledger.Epoch.html#1812" class="Record">NewEpochState</a>  <a id="3413" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="3415" href="Ledger.Epoch.html#3238" class="Function">HasCast-NewEpochState</a><a id="3436" class="Symbol">)</a><a id="3437" href="Data.List.Base.html#5205" class="Function Operator">]</a><a id="3438" class="Symbol">)</a>

<a id="3441" class="Keyword">instance</a> <a id="3450" href="Ledger.Epoch.html#3450" class="Function">_</a> <a id="3452" class="Symbol">=</a> <a id="3454" href="Data.Nat.Properties.html#17252" class="Function">+-0-monoid</a><a id="3464" class="Symbol">;</a> <a id="3466" href="Ledger.Epoch.html#3466" class="Function">_</a> <a id="3468" class="Symbol">=</a> <a id="3470" href="Data.Nat.Properties.html#17331" class="Function">+-0-commutativeMonoid</a>

<a id="toRwdAddr"></a><a id="3493" href="Ledger.Epoch.html#3493" class="Function">toRwdAddr</a> <a id="3503" class="Symbol">:</a> <a id="3505" href="Ledger.Address.html#273" class="Datatype">Credential</a> <a id="3516" class="Symbol">→</a> <a id="3518" href="Ledger.Address.html#1337" class="Record">RwdAddr</a>
<a id="3526" href="Ledger.Epoch.html#3493" class="Function">toRwdAddr</a> <a id="3536" href="Ledger.Epoch.html#3536" class="Bound">x</a> <a id="3538" class="Symbol">=</a> <a id="3540" class="Keyword">record</a> <a id="3547" class="Symbol">{</a> <a id="3549" href="Ledger.Address.html#1366" class="Field">net</a> <a id="3553" class="Symbol">=</a> <a id="3555" href="Ledger.Types.Epoch.html#2310" class="Function">NetworkId</a> <a id="3565" class="Symbol">;</a> <a id="3567" href="Ledger.Address.html#1391" class="Field">stake</a> <a id="3573" class="Symbol">=</a> <a id="3575" href="Ledger.Epoch.html#3536" class="Bound">x</a> <a id="3577" class="Symbol">}</a>

<a id="getStakeCred"></a><a id="3580" href="Ledger.Epoch.html#3580" class="Function">getStakeCred</a> <a id="3593" class="Symbol">:</a> <a id="3595" href="Ledger.Transaction.html#2293" class="Function">TxOut</a> <a id="3601" class="Symbol">→</a> <a id="3603" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="3609" href="Ledger.Address.html#273" class="Datatype">Credential</a>
<a id="3620" href="Ledger.Epoch.html#3580" class="Function">getStakeCred</a> <a id="3633" class="Symbol">(</a><a id="3634" href="Ledger.Epoch.html#3634" class="Bound">a</a> <a id="3636" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="3638" class="Symbol">_</a> <a id="3640" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="3642" class="Symbol">_</a> <a id="3644" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="3646" class="Symbol">_)</a> <a id="3649" class="Symbol">=</a> <a id="3651" href="Ledger.Address.html#2509" class="Function">stakeCred</a> <a id="3661" href="Ledger.Epoch.html#3634" class="Bound">a</a>

<a id="3664" class="Keyword">open</a> <a id="3669" href="Ledger.GovernanceActions.html#2746" class="Module">GovActionState</a> <a id="3684" class="Keyword">using</a> <a id="3690" class="Symbol">(</a><a id="3691" href="Ledger.GovernanceActions.html#2817" class="Field">returnAddr</a><a id="3701" class="Symbol">)</a>



<a id="createRUpd"></a><a id="3706" href="Ledger.Epoch.html#3706" class="Function">createRUpd</a> <a id="3717" class="Symbol">:</a> <a id="3719" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a> <a id="3721" class="Symbol">→</a> <a id="3723" href="Ledger.Rewards.html#4539" class="Function">BlocksMade</a> <a id="3734" class="Symbol">→</a> <a id="3736" href="Ledger.Epoch.html#1031" class="Record">EpochState</a> <a id="3747" class="Symbol">→</a> <a id="3749" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a> <a id="3754" class="Symbol">→</a> <a id="3756" href="Ledger.Rewards.html#5822" class="Record">RewardUpdate</a>
<a id="3769" href="Ledger.Epoch.html#3706" class="Function">createRUpd</a> <a id="3780" href="Ledger.Epoch.html#3780" class="Bound">slotsPerEpoch</a> <a id="3794" href="Ledger.Epoch.html#3794" class="Bound">b</a> <a id="3796" href="Ledger.Epoch.html#3796" class="Bound">es</a> <a id="3799" href="Ledger.Epoch.html#3799" class="Bound">total</a>
  <a id="3807" class="Symbol">=</a> <a id="3809" href="Ledger.Prelude.html#2441" class="Function Operator">⟦</a> <a id="3811" href="Ledger.Epoch.html#4514" class="Function">Δt₁</a> <a id="3815" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="3817" class="Number">0</a> <a id="3819" href="Interface.HasSubtract.html#209" class="Field Operator">-</a> <a id="3821" href="Ledger.Epoch.html#4373" class="Function">Δr₁</a> <a id="3825" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="3827" href="Ledger.Epoch.html#4687" class="Function">Δr₂</a> <a id="3831" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="3833" class="Number">0</a> <a id="3835" href="Interface.HasSubtract.html#209" class="Field Operator">-</a> <a id="3837" href="Ledger.Epoch.html#4013" class="Function">feeSS</a> <a id="3843" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="3845" href="Ledger.Epoch.html#4624" class="Function">rs</a> <a id="3848" href="Ledger.Prelude.html#2441" class="Function Operator">⟧</a>
  <a id="3852" class="Keyword">where</a>
    <a id="3862" href="Ledger.Epoch.html#3862" class="Function">prevPp</a>      <a id="3874" class="Symbol">=</a> <a id="3876" href="Ledger.PParams.html#3424" class="Field">PParamsOf</a> <a id="3886" class="Symbol">(</a><a id="3887" href="Ledger.Epoch.html#3796" class="Bound">es</a> <a id="3890" class="Symbol">.</a><a id="3891" href="Ledger.Epoch.html#1172" class="Field">EpochState.es</a><a id="3904" class="Symbol">)</a>
    <a id="3910" href="Ledger.Epoch.html#3910" class="Function">reserves</a>    <a id="3922" class="Symbol">=</a> <a id="3924" href="Ledger.Epoch.html#3796" class="Bound">es</a> <a id="3927" class="Symbol">.</a><a id="3928" href="Ledger.Epoch.html#1099" class="Field">EpochState.acnt</a> <a id="3944" class="Symbol">.</a><a id="3945" href="Ledger.PParams.html#738" class="Field">Acnt.reserves</a>
    <a id="3963" href="Ledger.Epoch.html#3963" class="Function">pstakego</a>    <a id="3975" class="Symbol">=</a> <a id="3977" href="Ledger.Epoch.html#3796" class="Bound">es</a> <a id="3980" class="Symbol">.</a><a id="3981" href="Ledger.Epoch.html#1121" class="Field">EpochState.ss</a> <a id="3995" class="Symbol">.</a><a id="3996" href="Ledger.Rewards.html#6711" class="Field">Snapshots.go</a>
    <a id="4013" href="Ledger.Epoch.html#4013" class="Function">feeSS</a>       <a id="4025" class="Symbol">=</a> <a id="4027" href="Ledger.Epoch.html#3796" class="Bound">es</a> <a id="4030" class="Symbol">.</a><a id="4031" href="Ledger.Epoch.html#1121" class="Field">EpochState.ss</a> <a id="4045" class="Symbol">.</a><a id="4046" href="Ledger.Rewards.html#6730" class="Field">Snapshots.feeSS</a>
    <a id="4066" href="Ledger.Epoch.html#4066" class="Function">stake</a>       <a id="4078" class="Symbol">=</a> <a id="4080" href="Ledger.Epoch.html#3963" class="Function">pstakego</a> <a id="4089" class="Symbol">.</a><a id="4090" href="Ledger.Rewards.html#5971" class="Field">Snapshot.stake</a>
    <a id="4109" href="Ledger.Epoch.html#4109" class="Function">delegs</a>      <a id="4121" class="Symbol">=</a> <a id="4123" href="Ledger.Epoch.html#3963" class="Function">pstakego</a> <a id="4132" class="Symbol">.</a><a id="4133" href="Ledger.Rewards.html#6011" class="Field">Snapshot.delegations</a>
    <a id="4158" href="Ledger.Epoch.html#4158" class="Function">poolParams</a>  <a id="4170" class="Symbol">=</a> <a id="4172" href="Ledger.Epoch.html#3963" class="Function">pstakego</a> <a id="4181" class="Symbol">.</a><a id="4182" href="Ledger.Rewards.html#6054" class="Field">Snapshot.poolParameters</a>

    <a id="4211" href="Ledger.Epoch.html#4211" class="Function">blocksMade</a> <a id="4222" class="Symbol">=</a> <a id="4224" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">∑[</a> <a id="4227" href="Ledger.Epoch.html#4227" class="Bound">m</a> <a id="4229" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">←</a> <a id="4231" href="Ledger.Epoch.html#3794" class="Bound">b</a> <a id="4233" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">]</a> <a id="4235" href="Ledger.Epoch.html#4227" class="Bound">m</a>

    <a id="4242" href="Ledger.Epoch.html#4242" class="Function">rho</a> <a id="4246" class="Symbol">=</a> <a id="4248" href="Ledger.Types.Numeric.UnitInterval.html#2334" class="Function">fromUnitInterval</a> <a id="4265" class="Symbol">(</a><a id="4266" href="Ledger.Epoch.html#3862" class="Function">prevPp</a> <a id="4273" class="Symbol">.</a><a id="4274" href="Ledger.PParams.html#2166" class="Field">PParams.monetaryExpansion</a><a id="4299" class="Symbol">)</a>
    <a id="4305" href="Ledger.Epoch.html#4305" class="Function">η</a> <a id="4307" class="Symbol">=</a> <a id="4309" href="Ledger.Epoch.html#644" class="Function">fromℕ</a> <a id="4315" href="Ledger.Epoch.html#4211" class="Function">blocksMade</a> <a id="4326" href="Ledger.Prelude.html#2305" class="Function Operator">÷₀</a> <a id="4329" class="Symbol">(</a><a id="4330" href="Ledger.Epoch.html#644" class="Function">fromℕ</a> <a id="4336" href="Ledger.Epoch.html#3780" class="Bound">slotsPerEpoch</a> <a id="4350" href="Data.Rational.Base.html#6315" class="Function Operator">*</a> <a id="4352" href="Ledger.Types.Epoch.html#2173" class="Function">ActiveSlotCoeff</a><a id="4367" class="Symbol">)</a>
    <a id="4373" href="Ledger.Epoch.html#4373" class="Function">Δr₁</a> <a id="4377" class="Symbol">=</a> <a id="4379" href="Data.Rational.Base.html#7116" class="Function">floor</a> <a id="4385" class="Symbol">(</a><a id="4386" href="Ledger.Epoch.html#377" class="Function">ℚ.min</a> <a id="4392" class="Number">1</a> <a id="4394" href="Ledger.Epoch.html#4305" class="Function">η</a> <a id="4396" href="Data.Rational.Base.html#6315" class="Function Operator">*</a> <a id="4398" href="Ledger.Epoch.html#4242" class="Function">rho</a> <a id="4402" href="Data.Rational.Base.html#6315" class="Function Operator">*</a> <a id="4404" href="Ledger.Epoch.html#644" class="Function">fromℕ</a> <a id="4410" href="Ledger.Epoch.html#3910" class="Function">reserves</a><a id="4418" class="Symbol">)</a>

    <a id="4425" href="Ledger.Epoch.html#4425" class="Function">rewardPot</a> <a id="4435" class="Symbol">=</a> <a id="4437" href="Ledger.Epoch.html#150" class="InductiveConstructor">pos</a> <a id="4441" href="Ledger.Epoch.html#4013" class="Function">feeSS</a> <a id="4447" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="4449" href="Ledger.Epoch.html#4373" class="Function">Δr₁</a>
    <a id="4457" href="Ledger.Epoch.html#4457" class="Function">tau</a> <a id="4461" class="Symbol">=</a> <a id="4463" href="Ledger.Types.Numeric.UnitInterval.html#2334" class="Function">fromUnitInterval</a> <a id="4480" class="Symbol">(</a><a id="4481" href="Ledger.Epoch.html#3862" class="Function">prevPp</a> <a id="4488" class="Symbol">.</a><a id="4489" href="Ledger.PParams.html#2236" class="Field">PParams.treasuryCut</a><a id="4508" class="Symbol">)</a>
    <a id="4514" href="Ledger.Epoch.html#4514" class="Function">Δt₁</a> <a id="4518" class="Symbol">=</a> <a id="4520" href="Data.Rational.Base.html#7116" class="Function">floor</a> <a id="4526" class="Symbol">(</a><a id="4527" href="Ledger.Epoch.html#4457" class="Function">tau</a> <a id="4531" href="Data.Rational.Base.html#6315" class="Function Operator">*</a> <a id="4533" href="Data.Rational.Literals.html#613" class="Function">fromℤ</a> <a id="4539" href="Ledger.Epoch.html#4425" class="Function">rewardPot</a><a id="4548" class="Symbol">)</a>
    <a id="4554" href="Ledger.Epoch.html#4554" class="Function">R</a> <a id="4556" class="Symbol">=</a> <a id="4558" href="Prelude.html#3167" class="Function">posPart</a> <a id="4566" class="Symbol">(</a><a id="4567" href="Ledger.Epoch.html#4425" class="Function">rewardPot</a> <a id="4577" href="Interface.HasSubtract.html#209" class="Field Operator">-</a> <a id="4579" href="Ledger.Epoch.html#4514" class="Function">Δt₁</a><a id="4582" class="Symbol">)</a>
    <a id="4588" href="Ledger.Epoch.html#4588" class="Function">circulation</a> <a id="4600" class="Symbol">=</a> <a id="4602" href="Ledger.Epoch.html#3799" class="Bound">total</a> <a id="4608" href="Interface.HasSubtract.html#209" class="Field Operator">-</a> <a id="4610" href="Ledger.Epoch.html#3910" class="Function">reserves</a>

    <a id="4624" href="Ledger.Epoch.html#4624" class="Function">rs</a> <a id="4627" class="Symbol">=</a> <a id="4629" href="Ledger.Rewards.html#5013" class="Function">reward</a> <a id="4636" href="Ledger.Epoch.html#3862" class="Function">prevPp</a> <a id="4643" href="Ledger.Epoch.html#3794" class="Bound">b</a> <a id="4645" href="Ledger.Epoch.html#4554" class="Function">R</a> <a id="4647" href="Ledger.Epoch.html#4158" class="Function">poolParams</a> <a id="4658" href="Ledger.Epoch.html#4066" class="Function">stake</a> <a id="4664" href="Ledger.Epoch.html#4109" class="Function">delegs</a> <a id="4671" href="Ledger.Epoch.html#4588" class="Function">circulation</a>
    <a id="4687" href="Ledger.Epoch.html#4687" class="Function">Δr₂</a> <a id="4691" class="Symbol">=</a> <a id="4693" href="Ledger.Epoch.html#4554" class="Function">R</a> <a id="4695" href="Interface.HasSubtract.html#209" class="Field Operator">-</a> <a id="4697" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">∑[</a> <a id="4700" href="Ledger.Epoch.html#4700" class="Bound">c</a> <a id="4702" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">←</a> <a id="4704" href="Ledger.Epoch.html#4624" class="Function">rs</a> <a id="4707" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">]</a> <a id="4709" href="Ledger.Epoch.html#4700" class="Bound">c</a>



<a id="applyRUpd"></a><a id="4714" href="Ledger.Epoch.html#4714" class="Function">applyRUpd</a> <a id="4724" class="Symbol">:</a> <a id="4726" href="Ledger.Rewards.html#5822" class="Record">RewardUpdate</a> <a id="4739" class="Symbol">→</a> <a id="4741" href="Ledger.Epoch.html#1031" class="Record">EpochState</a> <a id="4752" class="Symbol">→</a> <a id="4754" href="Ledger.Epoch.html#1031" class="Record">EpochState</a>
<a id="4765" href="Ledger.Epoch.html#4714" class="Function">applyRUpd</a> <a id="4775" href="Ledger.Rewards.html#5863" class="InductiveConstructor Operator">⟦</a> <a id="4777" href="Ledger.Epoch.html#4777" class="Bound">Δt</a> <a id="4780" href="Ledger.Rewards.html#5863" class="InductiveConstructor Operator">,</a> <a id="4782" href="Ledger.Epoch.html#4782" class="Bound">Δr</a> <a id="4785" href="Ledger.Rewards.html#5863" class="InductiveConstructor Operator">,</a> <a id="4787" href="Ledger.Epoch.html#4787" class="Bound">Δf</a> <a id="4790" href="Ledger.Rewards.html#5863" class="InductiveConstructor Operator">,</a> <a id="4792" href="Ledger.Epoch.html#4792" class="Bound">rs</a> <a id="4795" href="Ledger.Rewards.html#5863" class="InductiveConstructor Operator">⟧ʳᵘ</a>
  <a id="4801" href="Ledger.Epoch.html#1071" class="InductiveConstructor Operator">⟦</a> <a id="4803" href="Ledger.PParams.html#708" class="InductiveConstructor Operator">⟦</a> <a id="4805" href="Ledger.Epoch.html#4805" class="Bound">treasury</a> <a id="4814" href="Ledger.PParams.html#708" class="InductiveConstructor Operator">,</a> <a id="4816" href="Ledger.Epoch.html#4816" class="Bound">reserves</a> <a id="4825" href="Ledger.PParams.html#708" class="InductiveConstructor Operator">⟧ᵃ</a>
  <a id="4830" href="Ledger.Epoch.html#1071" class="InductiveConstructor Operator">,</a> <a id="4832" href="Ledger.Epoch.html#4832" class="Bound">ss</a>
  <a id="4837" href="Ledger.Epoch.html#1071" class="InductiveConstructor Operator">,</a> <a id="4839" href="Ledger.Ledger.html#845" class="InductiveConstructor Operator">⟦</a> <a id="4841" href="Ledger.Utxo.html#2744" class="InductiveConstructor Operator">⟦</a> <a id="4843" href="Ledger.Epoch.html#4843" class="Bound">utxo</a> <a id="4848" href="Ledger.Utxo.html#2744" class="InductiveConstructor Operator">,</a> <a id="4850" href="Ledger.Epoch.html#4850" class="Bound">fees</a> <a id="4855" href="Ledger.Utxo.html#2744" class="InductiveConstructor Operator">,</a> <a id="4857" href="Ledger.Epoch.html#4857" class="Bound">deposits</a> <a id="4866" href="Ledger.Utxo.html#2744" class="InductiveConstructor Operator">,</a> <a id="4868" href="Ledger.Epoch.html#4868" class="Bound">donations</a> <a id="4878" href="Ledger.Utxo.html#2744" class="InductiveConstructor Operator">⟧ᵘ</a>
    <a id="4885" href="Ledger.Ledger.html#845" class="InductiveConstructor Operator">,</a> <a id="4887" href="Ledger.Epoch.html#4887" class="Bound">govSt</a>
    <a id="4897" href="Ledger.Ledger.html#845" class="InductiveConstructor Operator">,</a> <a id="4899" href="Ledger.Certs.html#4366" class="InductiveConstructor Operator">⟦</a> <a id="4901" href="Ledger.Certs.html#3207" class="InductiveConstructor Operator">⟦</a> <a id="4903" href="Ledger.Epoch.html#4903" class="Bound">voteDelegs</a> <a id="4914" href="Ledger.Certs.html#3207" class="InductiveConstructor Operator">,</a> <a id="4916" href="Ledger.Epoch.html#4916" class="Bound">stakeDelegs</a> <a id="4928" href="Ledger.Certs.html#3207" class="InductiveConstructor Operator">,</a> <a id="4930" href="Ledger.Epoch.html#4930" class="Bound">rewards</a> <a id="4938" href="Ledger.Certs.html#3207" class="InductiveConstructor Operator">⟧ᵈ</a> <a id="4941" href="Ledger.Certs.html#4366" class="InductiveConstructor Operator">,</a> <a id="4943" href="Ledger.Epoch.html#4943" class="Bound">pState</a> <a id="4950" href="Ledger.Certs.html#4366" class="InductiveConstructor Operator">,</a> <a id="4952" href="Ledger.Epoch.html#4952" class="Bound">gState</a> <a id="4959" href="Ledger.Certs.html#4366" class="InductiveConstructor Operator">⟧ᶜˢ</a> <a id="4963" href="Ledger.Ledger.html#845" class="InductiveConstructor Operator">⟧ˡ</a>
  <a id="4968" href="Ledger.Epoch.html#1071" class="InductiveConstructor Operator">,</a> <a id="4970" href="Ledger.Epoch.html#4970" class="Bound">es</a>
  <a id="4975" href="Ledger.Epoch.html#1071" class="InductiveConstructor Operator">,</a> <a id="4977" href="Ledger.Epoch.html#4977" class="Bound">fut</a>
  <a id="4983" href="Ledger.Epoch.html#1071" class="InductiveConstructor Operator">⟧ᵉ&#39;</a> <a id="4987" class="Symbol">=</a>
  <a id="4991" href="Ledger.Prelude.html#2441" class="Function Operator">⟦</a> <a id="4993" href="Ledger.Prelude.html#2441" class="Function Operator">⟦</a> <a id="4995" href="Prelude.html#3167" class="Function">posPart</a> <a id="5003" class="Symbol">(</a><a id="5004" href="Ledger.Epoch.html#150" class="InductiveConstructor">pos</a> <a id="5008" href="Ledger.Epoch.html#4805" class="Bound">treasury</a> <a id="5017" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="5019" href="Ledger.Epoch.html#4777" class="Bound">Δt</a> <a id="5022" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="5024" href="Ledger.Epoch.html#150" class="InductiveConstructor">pos</a> <a id="5028" href="Ledger.Epoch.html#5332" class="Function">unregRU&#39;</a><a id="5036" class="Symbol">)</a>
    <a id="5042" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5044" href="Prelude.html#3167" class="Function">posPart</a> <a id="5052" class="Symbol">(</a><a id="5053" href="Ledger.Epoch.html#150" class="InductiveConstructor">pos</a> <a id="5057" href="Ledger.Epoch.html#4816" class="Bound">reserves</a> <a id="5066" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="5068" href="Ledger.Epoch.html#4782" class="Bound">Δr</a><a id="5070" class="Symbol">)</a> <a id="5072" href="Ledger.Prelude.html#2441" class="Function Operator">⟧</a>
  <a id="5076" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5078" href="Ledger.Epoch.html#4832" class="Bound">ss</a>
  <a id="5083" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5085" href="Ledger.Prelude.html#2441" class="Function Operator">⟦</a> <a id="5087" href="Ledger.Prelude.html#2441" class="Function Operator">⟦</a> <a id="5089" href="Ledger.Epoch.html#4843" class="Bound">utxo</a> <a id="5094" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5096" href="Prelude.html#3167" class="Function">posPart</a> <a id="5104" class="Symbol">(</a><a id="5105" href="Ledger.Epoch.html#150" class="InductiveConstructor">pos</a> <a id="5109" href="Ledger.Epoch.html#4850" class="Bound">fees</a> <a id="5114" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="5116" href="Ledger.Epoch.html#4787" class="Bound">Δf</a><a id="5118" class="Symbol">)</a> <a id="5120" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5122" href="Ledger.Epoch.html#4857" class="Bound">deposits</a> <a id="5131" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5133" href="Ledger.Epoch.html#4868" class="Bound">donations</a> <a id="5143" href="Ledger.Prelude.html#2441" class="Function Operator">⟧</a>
    <a id="5149" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5151" href="Ledger.Epoch.html#4887" class="Bound">govSt</a>
    <a id="5161" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5163" href="Ledger.Prelude.html#2441" class="Function Operator">⟦</a> <a id="5165" href="Ledger.Prelude.html#2441" class="Function Operator">⟦</a> <a id="5167" href="Ledger.Epoch.html#4903" class="Bound">voteDelegs</a> <a id="5178" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5180" href="Ledger.Epoch.html#4916" class="Bound">stakeDelegs</a> <a id="5192" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5194" href="Ledger.Epoch.html#4930" class="Bound">rewards</a> <a id="5202" href="Axiom.Set.Map.Dec.html#1854" class="Function Operator">∪⁺</a> <a id="5205" href="Ledger.Epoch.html#5264" class="Function">regRU</a> <a id="5211" href="Ledger.Prelude.html#2441" class="Function Operator">⟧</a> <a id="5213" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5215" href="Ledger.Epoch.html#4943" class="Bound">pState</a> <a id="5222" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5224" href="Ledger.Epoch.html#4952" class="Bound">gState</a> <a id="5231" href="Ledger.Prelude.html#2441" class="Function Operator">⟧</a> <a id="5233" href="Ledger.Prelude.html#2441" class="Function Operator">⟧</a>
  <a id="5237" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5239" href="Ledger.Epoch.html#4970" class="Bound">es</a>
  <a id="5244" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5246" href="Ledger.Epoch.html#4977" class="Bound">fut</a> <a id="5250" href="Ledger.Prelude.html#2441" class="Function Operator">⟧</a>
  <a id="5254" class="Keyword">where</a>
    <a id="5264" href="Ledger.Epoch.html#5264" class="Function">regRU</a>     <a id="5274" class="Symbol">=</a> <a id="5276" href="Ledger.Epoch.html#4792" class="Bound">rs</a> <a id="5279" href="Axiom.Set.Map.html#10678" class="Function Operator">∣</a> <a id="5281" href="Class.IsSet.html#916" class="Function">dom</a> <a id="5285" href="Ledger.Epoch.html#4930" class="Bound">rewards</a>
    <a id="5297" href="Ledger.Epoch.html#5297" class="Function">unregRU</a>   <a id="5307" class="Symbol">=</a> <a id="5309" href="Ledger.Epoch.html#4792" class="Bound">rs</a> <a id="5312" href="Axiom.Set.Map.html#10748" class="Function Operator">∣</a> <a id="5314" href="Class.IsSet.html#916" class="Function">dom</a> <a id="5318" href="Ledger.Epoch.html#4930" class="Bound">rewards</a> <a id="5326" href="Axiom.Set.Map.html#10748" class="Function Operator">ᶜ</a>
    <a id="5332" href="Ledger.Epoch.html#5332" class="Function">unregRU&#39;</a>  <a id="5342" class="Symbol">=</a> <a id="5344" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">∑[</a> <a id="5347" href="Ledger.Epoch.html#5347" class="Bound">x</a> <a id="5349" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">←</a> <a id="5351" href="Ledger.Epoch.html#5297" class="Function">unregRU</a> <a id="5359" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">]</a> <a id="5361" href="Ledger.Epoch.html#5347" class="Bound">x</a>

<a id="getOrphans"></a><a id="5364" href="Ledger.Epoch.html#5364" class="Function">getOrphans</a> <a id="5375" class="Symbol">:</a> <a id="5377" href="Ledger.Enact.html#397" class="Record">EnactState</a> <a id="5388" class="Symbol">→</a> <a id="5390" href="Ledger.Gov.html#1348" class="Function">GovState</a> <a id="5399" class="Symbol">→</a> <a id="5401" href="Ledger.Gov.html#1348" class="Function">GovState</a>
<a id="5410" href="Ledger.Epoch.html#5364" class="Function">getOrphans</a> <a id="5421" href="Ledger.Epoch.html#5421" class="Bound">es</a> <a id="5424" href="Ledger.Epoch.html#5424" class="Bound">govSt</a> <a id="5430" class="Symbol">=</a> <a id="5432" href="Data.Product.Base.html#636" class="Field">proj₁</a> <a id="5438" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="5440" href="Data.Nat.GeneralisedArithmetic.html#866" class="Function">iterate</a> <a id="5448" href="Ledger.Epoch.html#5493" class="Function">step</a> <a id="5453" class="Symbol">(</a><a id="5454" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a> <a id="5457" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5459" href="Ledger.Epoch.html#5424" class="Bound">govSt</a><a id="5464" class="Symbol">)</a> <a id="5466" class="Symbol">(</a><a id="5467" href="Data.List.Base.html#5044" class="Function">length</a> <a id="5474" href="Ledger.Epoch.html#5424" class="Bound">govSt</a><a id="5479" class="Symbol">)</a>
  <a id="5483" class="Keyword">where</a>
    <a id="5493" href="Ledger.Epoch.html#5493" class="Function">step</a> <a id="5498" class="Symbol">:</a> <a id="5500" href="Ledger.Gov.html#1348" class="Function">GovState</a> <a id="5509" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="5511" href="Ledger.Gov.html#1348" class="Function">GovState</a> <a id="5520" class="Symbol">→</a> <a id="5522" href="Ledger.Gov.html#1348" class="Function">GovState</a> <a id="5531" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="5533" href="Ledger.Gov.html#1348" class="Function">GovState</a>
    <a id="5546" href="Ledger.Epoch.html#5493" class="Function">step</a> <a id="5551" class="Symbol">(</a><a id="5552" href="Ledger.Epoch.html#5552" class="Bound">orps</a> <a id="5557" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5559" href="Ledger.Epoch.html#5559" class="Bound">govSt</a><a id="5564" class="Symbol">)</a> <a id="5566" class="Symbol">=</a>
      <a id="5574" class="Keyword">let</a>
        <a id="5586" href="Ledger.Epoch.html#5586" class="Bound">isOrphan?</a> <a id="5596" href="Ledger.Epoch.html#5596" class="Bound">a</a> <a id="5598" href="Ledger.Epoch.html#5598" class="Bound">prev</a> <a id="5603" class="Symbol">=</a> <a id="5605" href="Relation.Nullary.Decidable.Core.html#3011" class="Function">¬?</a> <a id="5608" class="Symbol">(</a><a id="5609" href="Ledger.Gov.html#8688" class="Function">hasParent?</a> <a id="5620" href="Ledger.Epoch.html#5421" class="Bound">es</a> <a id="5623" href="Ledger.Epoch.html#5559" class="Bound">govSt</a> <a id="5629" href="Ledger.Epoch.html#5596" class="Bound">a</a> <a id="5631" href="Ledger.Epoch.html#5598" class="Bound">prev</a><a id="5635" class="Symbol">)</a>
        <a id="5645" class="Symbol">(</a><a id="5646" href="Ledger.Epoch.html#5646" class="Bound">orps&#39;</a> <a id="5652" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5654" href="Ledger.Epoch.html#5654" class="Bound">govSt&#39;</a><a id="5660" class="Symbol">)</a> <a id="5662" class="Symbol">=</a> <a id="5664" href="Data.List.Base.html#10926" class="Function">partition</a>
          <a id="5684" class="Symbol">(λ</a> <a id="5687" class="Symbol">(_</a> <a id="5690" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5692" class="Keyword">record</a> <a id="5699" class="Symbol">{</a><a id="5700" href="Ledger.GovernanceActions.html#2867" class="Field">action</a> <a id="5707" class="Symbol">=</a> <a id="5709" href="Ledger.Epoch.html#5709" class="Bound">a</a> <a id="5711" class="Symbol">;</a> <a id="5713" href="Ledger.GovernanceActions.html#2895" class="Field">prevAction</a> <a id="5724" class="Symbol">=</a> <a id="5726" href="Ledger.Epoch.html#5726" class="Bound">prev</a><a id="5730" class="Symbol">})</a> <a id="5733" class="Symbol">→</a> <a id="5735" href="Ledger.Epoch.html#5586" class="Bound">isOrphan?</a> <a id="5745" class="Symbol">(</a><a id="5746" href="Ledger.Epoch.html#5709" class="Bound">a</a> <a id="5748" class="Symbol">.</a><a id="5749" href="Ledger.GovernanceActions.html#1433" class="Field">gaType</a><a id="5755" class="Symbol">)</a> <a id="5757" href="Ledger.Epoch.html#5726" class="Bound">prev</a><a id="5761" class="Symbol">)</a> <a id="5763" href="Ledger.Epoch.html#5559" class="Bound">govSt</a>
      <a id="5775" class="Keyword">in</a>
        <a id="5786" class="Symbol">(</a><a id="5787" href="Ledger.Epoch.html#5552" class="Bound">orps</a> <a id="5792" href="Data.List.Base.html#1734" class="Function Operator">++</a> <a id="5795" href="Ledger.Epoch.html#5646" class="Bound">orps&#39;</a> <a id="5801" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5803" href="Ledger.Epoch.html#5654" class="Bound">govSt&#39;</a><a id="5809" class="Symbol">)</a>


<a id="5813" class="Keyword">open</a> <a id="5818" href="Ledger.Address.html#1337" class="Module">RwdAddr</a> <a id="5826" class="Keyword">using</a> <a id="5832" class="Symbol">(</a><a id="5833" href="Ledger.Address.html#1391" class="Field">stake</a><a id="5838" class="Symbol">)</a>


<a id="gaDepositStake"></a><a id="5842" href="Ledger.Epoch.html#5842" class="Function">gaDepositStake</a> <a id="5857" class="Symbol">:</a> <a id="5859" href="Ledger.Gov.html#1348" class="Function">GovState</a> <a id="5868" class="Symbol">→</a> <a id="5870" href="Ledger.Certs.html#573" class="Function">Deposits</a> <a id="5879" class="Symbol">→</a> <a id="5881" href="Ledger.Address.html#273" class="Datatype">Credential</a> <a id="5892" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="5894" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a>
<a id="5899" href="Ledger.Epoch.html#5842" class="Function">gaDepositStake</a> <a id="5914" href="Ledger.Epoch.html#5914" class="Bound">govSt</a> <a id="5920" href="Ledger.Epoch.html#5920" class="Bound">ds</a> <a id="5923" class="Symbol">=</a> <a id="5925" href="abstract-set-theory.FiniteSetTheory.html#3599" class="Function">aggregateBy</a>
  <a id="5939" class="Symbol">(</a><a id="5940" href="abstract-set-theory.FiniteSetTheory.html#519" class="Function">mapˢ</a> <a id="5945" class="Symbol">(λ</a> <a id="5948" class="Symbol">(</a><a id="5949" href="Ledger.Epoch.html#5949" class="Bound">gaid</a> <a id="5954" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5956" href="Ledger.Epoch.html#5956" class="Bound">addr</a><a id="5960" class="Symbol">)</a> <a id="5962" class="Symbol">→</a> <a id="5964" class="Symbol">(</a><a id="5965" href="Ledger.Epoch.html#5949" class="Bound">gaid</a> <a id="5970" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5972" href="Ledger.Epoch.html#5956" class="Bound">addr</a><a id="5976" class="Symbol">)</a> <a id="5978" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5980" href="Ledger.Address.html#1391" class="Field">stake</a> <a id="5986" href="Ledger.Epoch.html#5956" class="Bound">addr</a><a id="5990" class="Symbol">)</a> <a id="5992" href="Ledger.Epoch.html#6090" class="Function">govSt&#39;</a><a id="5998" class="Symbol">)</a>
  <a id="6002" class="Symbol">(</a><a id="6003" href="Axiom.Set.Map.html#10460" class="Function">mapFromPartialFun</a> <a id="6021" class="Symbol">(λ</a> <a id="6024" class="Symbol">(</a><a id="6025" href="Ledger.Epoch.html#6025" class="Bound">gaid</a> <a id="6030" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="6032" class="Symbol">_)</a> <a id="6035" class="Symbol">→</a> <a id="6037" href="Axiom.Set.Map.html#13670" class="Function">lookupᵐ?</a> <a id="6046" href="Ledger.Epoch.html#5920" class="Bound">ds</a> <a id="6049" class="Symbol">(</a><a id="6050" href="Ledger.Certs.html#521" class="InductiveConstructor">GovActionDeposit</a> <a id="6067" href="Ledger.Epoch.html#6025" class="Bound">gaid</a><a id="6071" class="Symbol">))</a> <a id="6074" href="Ledger.Epoch.html#6090" class="Function">govSt&#39;</a><a id="6080" class="Symbol">)</a>
  <a id="6084" class="Keyword">where</a> <a id="6090" href="Ledger.Epoch.html#6090" class="Function">govSt&#39;</a> <a id="6097" class="Symbol">=</a> <a id="6099" href="abstract-set-theory.FiniteSetTheory.html#519" class="Function">mapˢ</a> <a id="6104" class="Symbol">(</a><a id="6105" href="Class.Bifunctor.html#1152" class="Function">map₂</a> <a id="6110" href="Ledger.GovernanceActions.html#2817" class="Field">returnAddr</a><a id="6120" class="Symbol">)</a> <a id="6122" class="Symbol">(</a><a id="6123" href="Axiom.Set.html#5718" class="Function">fromList</a> <a id="6132" href="Ledger.Epoch.html#5914" class="Bound">govSt</a><a id="6137" class="Symbol">)</a>



<a id="6142" class="Keyword">opaque</a>


  <a id="mkStakeDistrs"></a><a id="6153" href="Ledger.Epoch.html#6153" class="Function">mkStakeDistrs</a> <a id="6167" class="Symbol">:</a> <a id="6169" href="Ledger.Rewards.html#5938" class="Record">Snapshot</a> <a id="6178" class="Symbol">→</a> <a id="6180" href="Ledger.Gov.html#1348" class="Function">GovState</a> <a id="6189" class="Symbol">→</a> <a id="6191" href="Ledger.Certs.html#573" class="Function">Deposits</a> <a id="6200" class="Symbol">→</a> <a id="6202" class="Symbol">(</a><a id="6203" href="Ledger.Address.html#273" class="Datatype">Credential</a> <a id="6214" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="6216" href="Ledger.GovernanceActions.html#458" class="Datatype">VDeleg</a><a id="6222" class="Symbol">)</a> <a id="6224" class="Symbol">→</a> <a id="6226" href="Ledger.Ratify.html#2914" class="Record">StakeDistrs</a>
  <a id="6240" href="Ledger.Epoch.html#6153" class="Function">mkStakeDistrs</a> <a id="6254" href="Ledger.Epoch.html#6254" class="Bound">ss</a> <a id="6257" href="Ledger.Epoch.html#6257" class="Bound">govSt</a> <a id="6263" href="Ledger.Epoch.html#6263" class="Bound">ds</a> <a id="6266" href="Ledger.Epoch.html#6266" class="Bound">delegations</a> <a id="6278" class="Symbol">.</a><a id="6279" href="Ledger.Ratify.html#2951" class="Field">StakeDistrs.stakeDistr</a> <a id="6302" class="Symbol">=</a>
    <a id="6308" href="abstract-set-theory.FiniteSetTheory.html#3599" class="Function">aggregateBy</a> <a id="6320" href="Ledger.Prelude.html#2543" class="Function Operator">∣</a> <a id="6322" href="Ledger.Epoch.html#6266" class="Bound">delegations</a> <a id="6334" href="Ledger.Prelude.html#2543" class="Function Operator">∣</a> <a id="6336" class="Symbol">(</a><a id="6337" href="Ledger.Rewards.html#5971" class="Field">Snapshot.stake</a> <a id="6352" href="Ledger.Epoch.html#6254" class="Bound">ss</a> <a id="6355" href="Axiom.Set.Map.Dec.html#1854" class="Function Operator">∪⁺</a> <a id="6358" href="Ledger.Epoch.html#5842" class="Function">gaDepositStake</a> <a id="6373" href="Ledger.Epoch.html#6257" class="Bound">govSt</a> <a id="6379" href="Ledger.Epoch.html#6263" class="Bound">ds</a><a id="6381" class="Symbol">)</a>


<a id="6385" class="Keyword">private</a> <a id="6393" class="Keyword">variable</a>
  <a id="6404" href="Ledger.Epoch.html#6404" class="Generalizable">nes</a> <a id="6408" href="Ledger.Epoch.html#6408" class="Generalizable">nes&#39;</a> <a id="6413" class="Symbol">:</a> <a id="6415" href="Ledger.Epoch.html#1812" class="Record">NewEpochState</a>
  <a id="6431" href="Ledger.Epoch.html#6431" class="Generalizable">e</a> <a id="6433" href="Ledger.Epoch.html#6433" class="Generalizable">lastEpoch</a> <a id="6443" class="Symbol">:</a> <a id="6445" href="Ledger.Types.Epoch.html#543" class="Function">Epoch</a>
  <a id="6453" href="Ledger.Epoch.html#6453" class="Generalizable">fut</a> <a id="6457" href="Ledger.Epoch.html#6457" class="Generalizable">fut&#39;</a> <a id="6462" class="Symbol">:</a> <a id="6464" href="Ledger.Ratify.html#3279" class="Record">RatifyState</a>
  <a id="6478" href="Ledger.Epoch.html#6478" class="Generalizable">eps</a> <a id="6482" href="Ledger.Epoch.html#6482" class="Generalizable">eps&#39;</a> <a id="6487" href="Ledger.Epoch.html#6487" class="Generalizable">eps&#39;&#39;</a> <a id="6493" class="Symbol">:</a> <a id="6495" href="Ledger.Epoch.html#1031" class="Record">EpochState</a>
  <a id="6508" href="Ledger.Epoch.html#6508" class="Generalizable">ls</a> <a id="6511" class="Symbol">:</a> <a id="6513" href="Ledger.Ledger.html#809" class="Record">LState</a>
  <a id="6522" href="Ledger.Epoch.html#6522" class="Generalizable">acnt</a> <a id="6527" class="Symbol">:</a> <a id="6529" href="Ledger.PParams.html#674" class="Record">Acnt</a>
  <a id="6536" href="Ledger.Epoch.html#6536" class="Generalizable">es₀</a> <a id="6540" class="Symbol">:</a> <a id="6542" href="Ledger.Enact.html#397" class="Record">EnactState</a>
  <a id="6555" href="Ledger.Epoch.html#6555" class="Generalizable">mark</a> <a id="6560" href="Ledger.Epoch.html#6560" class="Generalizable">set</a> <a id="6564" href="Ledger.Epoch.html#6564" class="Generalizable">go</a> <a id="6567" class="Symbol">:</a> <a id="6569" href="Ledger.Rewards.html#5938" class="Record">Snapshot</a>
  <a id="6580" href="Ledger.Epoch.html#6580" class="Generalizable">feeSS</a> <a id="6586" class="Symbol">:</a> <a id="6588" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a>
  <a id="6595" href="Ledger.Epoch.html#6595" class="Generalizable">lstate</a> <a id="6602" class="Symbol">:</a> <a id="6604" href="Ledger.Ledger.html#809" class="Record">LState</a>
  <a id="6613" href="Ledger.Epoch.html#6613" class="Generalizable">ss</a> <a id="6616" href="Ledger.Epoch.html#6616" class="Generalizable">ss&#39;</a> <a id="6620" class="Symbol">:</a> <a id="6622" href="Ledger.Rewards.html#6668" class="Record">Snapshots</a>
  <a id="6634" href="Ledger.Epoch.html#6634" class="Generalizable">ru</a> <a id="6637" class="Symbol">:</a> <a id="6639" href="Ledger.Rewards.html#5822" class="Record">RewardUpdate</a>
  <a id="6654" href="Ledger.Epoch.html#6654" class="Generalizable">mru</a> <a id="6658" class="Symbol">:</a> <a id="6660" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="6666" href="Ledger.Rewards.html#5822" class="Record">RewardUpdate</a>


<a id="6681" class="Keyword">data</a> <a id="_⊢_⇀⦇_,EPOCH⦈_"></a><a id="6686" href="Ledger.Epoch.html#6686" class="Datatype Operator">_⊢_⇀⦇_,EPOCH⦈_</a> <a id="6701" class="Symbol">:</a> <a id="6703" href="Agda.Builtin.Unit.html#175" class="Record">⊤</a> <a id="6705" class="Symbol">→</a> <a id="6707" href="Ledger.Epoch.html#1031" class="Record">EpochState</a> <a id="6718" class="Symbol">→</a> <a id="6720" href="Ledger.Types.Epoch.html#543" class="Function">Epoch</a> <a id="6726" class="Symbol">→</a> <a id="6728" href="Ledger.Epoch.html#1031" class="Record">EpochState</a> <a id="6739" class="Symbol">→</a> <a id="6741" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="6746" class="Keyword">where</a>


  <a id="_⊢_⇀⦇_,EPOCH⦈_.EPOCH"></a><a id="6756" href="Ledger.Epoch.html#6756" class="InductiveConstructor">EPOCH</a> <a id="6762" class="Symbol">:</a> <a id="6764" class="Keyword">let</a>


      <a id="6776" class="Keyword">open</a> <a id="6781" href="Ledger.Ledger.html#809" class="Module">LState</a> <a id="6788" href="Ledger.Epoch.html#6508" class="Generalizable">ls</a>
      <a id="6797" class="Keyword">open</a> <a id="6802" href="Ledger.Certs.html#4327" class="Module">CertState</a> <a id="6812" href="Ledger.Ledger.html#921" class="Function">certState</a>
      <a id="6828" class="Keyword">open</a> <a id="6833" href="Ledger.Ratify.html#3279" class="Module">RatifyState</a> <a id="6845" href="Ledger.Epoch.html#6453" class="Generalizable">fut</a> <a id="6849" class="Keyword">hiding</a> <a id="6856" class="Symbol">(</a><a id="6857" href="Ledger.Ratify.html#3316" class="Field">es</a><a id="6859" class="Symbol">)</a>
      <a id="6867" class="Keyword">open</a> <a id="6872" href="Ledger.Utxo.html#2705" class="Module">UTxOState</a>
      <a id="6888" class="Keyword">open</a> <a id="6893" href="Ledger.Certs.html#3781" class="Module">PState</a><a id="6899" class="Symbol">;</a> <a id="6901" class="Keyword">open</a> <a id="6906" href="Ledger.Certs.html#3171" class="Module">DState</a><a id="6912" class="Symbol">;</a> <a id="6914" class="Keyword">open</a> <a id="6919" href="Ledger.Certs.html#3997" class="Module">GState</a>
      <a id="6932" class="Keyword">open</a> <a id="6937" href="Ledger.PParams.html#674" class="Module">Acnt</a><a id="6941" class="Symbol">;</a> <a id="6943" class="Keyword">open</a> <a id="6948" href="Ledger.Enact.html#397" class="Module">EnactState</a><a id="6958" class="Symbol">;</a> <a id="6960" class="Keyword">open</a> <a id="6965" href="Ledger.GovernanceActions.html#2746" class="Module">GovActionState</a>


      <a id="6988" href="Ledger.Epoch.html#6988" class="Bound">esW</a>               <a id="7006" class="Symbol">=</a> <a id="7008" href="Ledger.Ratify.html#3316" class="Field">RatifyState.es</a> <a id="7023" href="Ledger.Epoch.html#6453" class="Generalizable">fut</a>
      <a id="7033" href="Ledger.Epoch.html#7033" class="Bound">es</a>                <a id="7051" class="Symbol">=</a> <a id="7053" class="Keyword">record</a> <a id="7060" href="Ledger.Epoch.html#6988" class="Bound">esW</a> <a id="7064" class="Symbol">{</a> <a id="7066" href="Ledger.Enact.html#649" class="Field">withdrawals</a> <a id="7078" class="Symbol">=</a> <a id="7080" href="Class.HasEmptySet.html#287" class="Field">∅</a> <a id="7082" class="Symbol">}</a>
      <a id="7090" href="Ledger.Epoch.html#7090" class="Bound">tmpGovSt</a>          <a id="7108" class="Symbol">=</a> <a id="7110" href="Ledger.Prelude.html#2692" class="Function">filter</a> <a id="7117" class="Symbol">(λ</a> <a id="7120" href="Ledger.Epoch.html#7120" class="Bound">x</a> <a id="7122" class="Symbol">→</a> <a id="7124" href="Data.Product.Base.html#636" class="Field">proj₁</a> <a id="7130" href="Ledger.Epoch.html#7120" class="Bound">x</a> <a id="7132" href="Class.IsSet.html#462" class="Function Operator">∉</a> <a id="7134" href="abstract-set-theory.FiniteSetTheory.html#519" class="Function">mapˢ</a> <a id="7139" href="Data.Product.Base.html#636" class="Field">proj₁</a> <a id="7145" href="Ledger.Ratify.html#3349" class="Function">removed</a><a id="7152" class="Symbol">)</a> <a id="7154" href="Ledger.Ledger.html#895" class="Function">govSt</a>
      <a id="7166" href="Ledger.Epoch.html#7166" class="Bound">orphans</a>           <a id="7184" class="Symbol">=</a> <a id="7186" href="Axiom.Set.html#5718" class="Function">fromList</a> <a id="7195" class="Symbol">(</a><a id="7196" href="Ledger.Epoch.html#5364" class="Function">getOrphans</a> <a id="7207" href="Ledger.Epoch.html#7033" class="Bound">es</a> <a id="7210" href="Ledger.Epoch.html#7090" class="Bound">tmpGovSt</a><a id="7218" class="Symbol">)</a>
      <a id="7226" href="Ledger.Epoch.html#7226" class="Bound">removed&#39;</a>          <a id="7244" class="Symbol">=</a> <a id="7246" href="Ledger.Ratify.html#3349" class="Function">removed</a> <a id="7254" href="Axiom.Set.html#8952" class="Function Operator">∪</a> <a id="7256" href="Ledger.Epoch.html#7166" class="Bound">orphans</a>
      <a id="7270" href="Ledger.Epoch.html#7270" class="Bound">removedGovActions</a> <a id="7288" class="Symbol">=</a> <a id="7290" href="Function.Base.html#1638" class="Function">flip</a> <a id="7295" href="Axiom.Set.html#7022" class="Function">concatMapˢ</a> <a id="7306" href="Ledger.Epoch.html#7226" class="Bound">removed&#39;</a> <a id="7315" class="Symbol">λ</a> <a id="7317" class="Symbol">(</a><a id="7318" href="Ledger.Epoch.html#7318" class="Bound">gaid</a> <a id="7323" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="7325" href="Ledger.Epoch.html#7325" class="Bound">gaSt</a><a id="7329" class="Symbol">)</a> <a id="7331" class="Symbol">→</a>
        <a id="7341" href="abstract-set-theory.FiniteSetTheory.html#519" class="Function">mapˢ</a> <a id="7346" class="Symbol">(</a><a id="7347" href="Ledger.GovernanceActions.html#2817" class="Field">returnAddr</a> <a id="7358" href="Ledger.Epoch.html#7325" class="Bound">gaSt</a> <a id="7363" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,_</a><a id="7365" class="Symbol">)</a> <a id="7367" class="Symbol">((</a><a id="7369" href="Ledger.Ledger.html#868" class="Function">utxoSt</a> <a id="7376" class="Symbol">.</a><a id="7377" href="Ledger.Utxo.html#2813" class="Field">deposits</a> <a id="7386" href="Axiom.Set.Map.html#10678" class="Function Operator">∣</a> <a id="7388" href="Class.HasSingleton.html#288" class="Field Operator">❴</a> <a id="7390" href="Ledger.Certs.html#521" class="InductiveConstructor">GovActionDeposit</a> <a id="7407" href="Ledger.Epoch.html#7318" class="Bound">gaid</a> <a id="7412" href="Class.HasSingleton.html#288" class="Field Operator">❵</a><a id="7413" class="Symbol">)</a> <a id="7415" href="Axiom.Set.Map.html#2293" class="Function Operator">ˢ</a><a id="7416" class="Symbol">)</a>
      <a id="7424" href="Ledger.Epoch.html#7424" class="Bound">govActionReturns</a> <a id="7441" class="Symbol">=</a> <a id="7443" href="Axiom.Set.Map.Dec.html#1932" class="Function">aggregate₊</a> <a id="7454" class="Symbol">(</a><a id="7455" href="abstract-set-theory.FiniteSetTheory.html#519" class="Function">mapˢ</a> <a id="7460" class="Symbol">(λ</a> <a id="7463" class="Symbol">(</a><a id="7464" href="Ledger.Epoch.html#7464" class="Bound">a</a> <a id="7466" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="7468" class="Symbol">_</a> <a id="7470" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="7472" href="Ledger.Epoch.html#7472" class="Bound">d</a><a id="7473" class="Symbol">)</a> <a id="7475" class="Symbol">→</a> <a id="7477" href="Ledger.Epoch.html#7464" class="Bound">a</a> <a id="7479" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="7481" href="Ledger.Epoch.html#7472" class="Bound">d</a><a id="7482" class="Symbol">)</a> <a id="7484" href="Ledger.Epoch.html#7270" class="Bound">removedGovActions</a> <a id="7502" href="abstract-set-theory.FiniteSetTheory.html#2767" class="Function Operator">ᶠˢ</a><a id="7504" class="Symbol">)</a>

      <a id="7513" href="Ledger.Epoch.html#7513" class="Bound">trWithdrawals</a>   <a id="7529" class="Symbol">=</a> <a id="7531" href="Ledger.Epoch.html#6988" class="Bound">esW</a> <a id="7535" class="Symbol">.</a><a id="7536" href="Ledger.Enact.html#649" class="Field">withdrawals</a>
      <a id="7554" href="Ledger.Epoch.html#7554" class="Bound">totWithdrawals</a>  <a id="7570" class="Symbol">=</a> <a id="7572" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">∑[</a> <a id="7575" href="Ledger.Epoch.html#7575" class="Bound">x</a> <a id="7577" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">←</a> <a id="7579" href="Ledger.Epoch.html#7513" class="Bound">trWithdrawals</a> <a id="7593" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">]</a> <a id="7595" href="Ledger.Epoch.html#7575" class="Bound">x</a>

      <a id="7604" href="Ledger.Epoch.html#7604" class="Bound">retired</a>    <a id="7615" class="Symbol">=</a> <a id="7617" class="Symbol">(</a><a id="7618" href="Ledger.Certs.html#4410" class="Function">pState</a> <a id="7625" class="Symbol">.</a><a id="7626" href="Ledger.Certs.html#3850" class="Field">retiring</a><a id="7634" class="Symbol">)</a> <a id="7636" href="Axiom.Set.Map.html#14230" class="Function Operator">⁻¹</a> <a id="7639" href="Ledger.Epoch.html#6431" class="Generalizable">e</a>
      <a id="7647" href="Ledger.Epoch.html#7647" class="Bound">payout</a>     <a id="7658" class="Symbol">=</a> <a id="7660" href="Ledger.Epoch.html#7424" class="Bound">govActionReturns</a> <a id="7677" href="Axiom.Set.Map.Dec.html#1854" class="Function Operator">∪⁺</a> <a id="7680" href="Ledger.Epoch.html#7513" class="Bound">trWithdrawals</a>
      <a id="7700" href="Ledger.Epoch.html#7700" class="Bound">refunds</a>    <a id="7711" class="Symbol">=</a> <a id="7713" href="Axiom.Set.Map.html#13791" class="Function">pullbackMap</a> <a id="7725" href="Ledger.Epoch.html#7647" class="Bound">payout</a> <a id="7732" href="Ledger.Epoch.html#3493" class="Function">toRwdAddr</a> <a id="7742" class="Symbol">(</a><a id="7743" href="Class.IsSet.html#916" class="Function">dom</a> <a id="7747" class="Symbol">(</a><a id="7748" href="Ledger.Certs.html#4390" class="Function">dState</a> <a id="7755" class="Symbol">.</a><a id="7756" href="Ledger.Certs.html#3309" class="Field">rewards</a><a id="7763" class="Symbol">))</a>
      <a id="7772" href="Ledger.Epoch.html#7772" class="Bound">unclaimed</a>  <a id="7783" class="Symbol">=</a> <a id="7785" href="Ledger.Interface.HasCoin.html#172" class="Field">getCoin</a> <a id="7793" href="Ledger.Epoch.html#7647" class="Bound">payout</a> <a id="7800" href="Interface.HasSubtract.html#209" class="Field Operator">-</a> <a id="7802" href="Ledger.Interface.HasCoin.html#172" class="Field">getCoin</a> <a id="7810" href="Ledger.Epoch.html#7700" class="Bound">refunds</a>

      <a id="7825" href="Ledger.Epoch.html#7825" class="Bound">govSt&#39;</a> <a id="7832" class="Symbol">=</a> <a id="7834" href="Ledger.Prelude.html#2692" class="Function">filter</a> <a id="7841" class="Symbol">(λ</a> <a id="7844" href="Ledger.Epoch.html#7844" class="Bound">x</a> <a id="7846" class="Symbol">→</a> <a id="7848" href="Data.Product.Base.html#636" class="Field">proj₁</a> <a id="7854" href="Ledger.Epoch.html#7844" class="Bound">x</a> <a id="7856" href="Class.IsSet.html#462" class="Function Operator">∉</a> <a id="7858" href="abstract-set-theory.FiniteSetTheory.html#519" class="Function">mapˢ</a> <a id="7863" href="Data.Product.Base.html#636" class="Field">proj₁</a> <a id="7869" href="Ledger.Epoch.html#7226" class="Bound">removed&#39;</a><a id="7877" class="Symbol">)</a> <a id="7879" href="Ledger.Ledger.html#895" class="Function">govSt</a>

      <a id="7892" href="Ledger.Epoch.html#7892" class="Bound">dState&#39;</a> <a id="7900" class="Symbol">=</a> <a id="7902" href="Ledger.Prelude.html#2441" class="Function Operator">⟦</a> <a id="7904" href="Ledger.Certs.html#4390" class="Function">dState</a> <a id="7911" class="Symbol">.</a><a id="7912" href="Ledger.Certs.html#3230" class="Field">voteDelegs</a> <a id="7923" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="7925" href="Ledger.Certs.html#4390" class="Function">dState</a> <a id="7932" class="Symbol">.</a><a id="7933" href="Ledger.Certs.html#3269" class="Field">stakeDelegs</a> <a id="7945" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a>  <a id="7948" href="Ledger.Certs.html#4390" class="Function">dState</a> <a id="7955" class="Symbol">.</a><a id="7956" href="Ledger.Certs.html#3309" class="Field">rewards</a> <a id="7964" href="Axiom.Set.Map.Dec.html#1854" class="Function Operator">∪⁺</a> <a id="7967" href="Ledger.Epoch.html#7700" class="Bound">refunds</a> <a id="7975" href="Ledger.Prelude.html#2441" class="Function Operator">⟧</a>

      <a id="7984" href="Ledger.Epoch.html#7984" class="Bound">pState&#39;</a> <a id="7992" class="Symbol">=</a> <a id="7994" href="Ledger.Prelude.html#2441" class="Function Operator">⟦</a> <a id="7996" href="Ledger.Certs.html#4410" class="Function">pState</a> <a id="8003" class="Symbol">.</a><a id="8004" href="Ledger.Certs.html#3813" class="Field">pools</a> <a id="8010" href="Axiom.Set.Map.html#10748" class="Function Operator">∣</a> <a id="8012" href="Ledger.Epoch.html#7604" class="Bound">retired</a> <a id="8020" href="Axiom.Set.Map.html#10748" class="Function Operator">ᶜ</a> <a id="8022" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="8024" href="Ledger.Certs.html#4410" class="Function">pState</a> <a id="8031" class="Symbol">.</a><a id="8032" href="Ledger.Certs.html#3850" class="Field">retiring</a> <a id="8041" href="Axiom.Set.Map.html#10748" class="Function Operator">∣</a> <a id="8043" href="Ledger.Epoch.html#7604" class="Bound">retired</a> <a id="8051" href="Axiom.Set.Map.html#10748" class="Function Operator">ᶜ</a> <a id="8053" href="Ledger.Prelude.html#2441" class="Function Operator">⟧</a>

      <a id="8062" href="Ledger.Epoch.html#8062" class="Bound">gState&#39;</a> <a id="8070" class="Symbol">=</a> <a id="8072" href="Ledger.Prelude.html#2441" class="Function Operator">⟦</a> <a id="8074" class="Symbol">(</a><a id="8075" href="Class.ToBool.html#389" class="Function Operator">if</a> <a id="8078" href="Data.List.Base.html#4703" class="Function">null</a> <a id="8083" href="Ledger.Epoch.html#7825" class="Bound">govSt&#39;</a> <a id="8090" href="Class.ToBool.html#389" class="Function Operator">then</a> <a id="8095" href="Axiom.Set.Map.html#6068" class="Function">mapValues</a> <a id="8105" class="Symbol">(</a><a id="8106" class="Number">1</a> <a id="8108" href="Class.HasAdd.Core.html#162" class="Field Operator">+_</a><a id="8110" class="Symbol">)</a> <a id="8112" class="Symbol">(</a><a id="8113" href="Ledger.Certs.html#4430" class="Function">gState</a> <a id="8120" class="Symbol">.</a><a id="8121" href="Ledger.Certs.html#4054" class="Field">dreps</a><a id="8126" class="Symbol">)</a> <a id="8128" href="Class.ToBool.html#389" class="Function Operator">else</a> <a id="8133" class="Symbol">(</a><a id="8134" href="Ledger.Certs.html#4430" class="Function">gState</a> <a id="8141" class="Symbol">.</a><a id="8142" href="Ledger.Certs.html#4054" class="Field">dreps</a><a id="8147" class="Symbol">))</a>
                <a id="8166" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="8168" href="Ledger.Certs.html#4430" class="Function">gState</a> <a id="8175" class="Symbol">.</a><a id="8176" href="Ledger.Certs.html#4077" class="Field">ccHotKeys</a> <a id="8186" href="Axiom.Set.Map.html#10678" class="Function Operator">∣</a> <a id="8188" href="Ledger.Enact.html#1194" class="Function">ccCreds</a> <a id="8196" class="Symbol">(</a><a id="8197" href="Ledger.Epoch.html#7033" class="Bound">es</a> <a id="8200" class="Symbol">.</a><a id="8201" href="Ledger.Enact.html#433" class="Field">cc</a><a id="8203" class="Symbol">)</a> <a id="8205" href="Ledger.Prelude.html#2441" class="Function Operator">⟧</a>

      <a id="8214" href="Ledger.Epoch.html#8214" class="Bound">certState&#39;</a> <a id="8225" class="Symbol">:</a> <a id="8227" href="Ledger.Certs.html#4327" class="Record">CertState</a>
      <a id="8243" href="Ledger.Epoch.html#8214" class="Bound">certState&#39;</a> <a id="8254" class="Symbol">=</a> <a id="8256" href="Ledger.Prelude.html#2441" class="Function Operator">⟦</a> <a id="8258" href="Ledger.Epoch.html#7892" class="Bound">dState&#39;</a> <a id="8266" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="8268" href="Ledger.Epoch.html#7984" class="Bound">pState&#39;</a> <a id="8276" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="8278" href="Ledger.Epoch.html#8062" class="Bound">gState&#39;</a> <a id="8286" href="Ledger.Prelude.html#2441" class="Function Operator">⟧</a>

      <a id="8295" href="Ledger.Epoch.html#8295" class="Bound">utxoSt&#39;</a> <a id="8303" class="Symbol">=</a> <a id="8305" href="Ledger.Prelude.html#2441" class="Function Operator">⟦</a> <a id="8307" href="Ledger.Ledger.html#868" class="Function">utxoSt</a> <a id="8314" class="Symbol">.</a><a id="8315" href="Ledger.Utxo.html#2769" class="Field">utxo</a> <a id="8320" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="8322" href="Ledger.Ledger.html#868" class="Function">utxoSt</a> <a id="8329" class="Symbol">.</a><a id="8330" href="Ledger.Utxo.html#2791" class="Field">fees</a> <a id="8335" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="8337" href="Ledger.Ledger.html#868" class="Function">utxoSt</a> <a id="8344" class="Symbol">.</a><a id="8345" href="Ledger.Utxo.html#2813" class="Field">deposits</a> <a id="8354" href="Axiom.Set.Map.html#10748" class="Function Operator">∣</a> <a id="8356" href="abstract-set-theory.FiniteSetTheory.html#519" class="Function">mapˢ</a> <a id="8361" class="Symbol">(</a><a id="8362" href="Data.Product.Base.html#636" class="Field">proj₁</a> <a id="8368" href="Function.Base.html#1115" class="Function Operator">∘</a> <a id="8370" href="Data.Product.Base.html#650" class="Field">proj₂</a><a id="8375" class="Symbol">)</a> <a id="8377" href="Ledger.Epoch.html#7270" class="Bound">removedGovActions</a> <a id="8395" href="Axiom.Set.Map.html#10748" class="Function Operator">ᶜ</a> <a id="8397" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="8399" class="Number">0</a> <a id="8401" href="Ledger.Prelude.html#2441" class="Function Operator">⟧</a>

      <a id="8410" href="Ledger.Epoch.html#8410" class="Bound">acnt&#39;</a> <a id="8416" class="Symbol">=</a> <a id="8418" class="Keyword">record</a> <a id="8425" href="Ledger.Epoch.html#6522" class="Generalizable">acnt</a>
        <a id="8438" class="Symbol">{</a> <a id="8440" href="Ledger.PParams.html#729" class="Field">treasury</a>  <a id="8450" class="Symbol">=</a> <a id="8452" href="Ledger.Epoch.html#6522" class="Generalizable">acnt</a> <a id="8457" class="Symbol">.</a><a id="8458" href="Ledger.PParams.html#729" class="Field">treasury</a> <a id="8467" href="Data.Nat.Base.html#4462" class="Primitive Operator">∸</a> <a id="8469" href="Ledger.Epoch.html#7554" class="Bound">totWithdrawals</a> <a id="8484" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="8486" href="Ledger.Ledger.html#868" class="Function">utxoSt</a> <a id="8493" class="Symbol">.</a><a id="8494" href="Ledger.Utxo.html#2839" class="Field">donations</a> <a id="8504" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="8506" href="Ledger.Epoch.html#7772" class="Bound">unclaimed</a> <a id="8516" class="Symbol">}</a>
    <a id="8522" class="Keyword">in</a>
    <a id="8529" class="Keyword">record</a> <a id="8536" class="Symbol">{</a> <a id="8538" href="Ledger.Ratify.html#3054" class="Field">currentEpoch</a> <a id="8551" class="Symbol">=</a> <a id="8553" href="Ledger.Epoch.html#6431" class="Generalizable">e</a>
           <a id="8566" class="Symbol">;</a> <a id="8568" href="Ledger.Ratify.html#3022" class="Field">stakeDistrs</a> <a id="8580" class="Symbol">=</a> <a id="8582" href="Ledger.Epoch.html#6153" class="Function">mkStakeDistrs</a>  <a id="8597" class="Symbol">(</a><a id="8598" href="Ledger.Rewards.html#6702" class="Field">Snapshots.mark</a> <a id="8613" href="Ledger.Epoch.html#6616" class="Generalizable">ss&#39;</a><a id="8616" class="Symbol">)</a> <a id="8618" href="Ledger.Epoch.html#7825" class="Bound">govSt&#39;</a>
                                          <a id="8667" class="Symbol">(</a><a id="8668" href="Ledger.Epoch.html#8295" class="Bound">utxoSt&#39;</a> <a id="8676" class="Symbol">.</a><a id="8677" href="Ledger.Utxo.html#2813" class="Field">deposits</a><a id="8685" class="Symbol">)</a> <a id="8687" class="Symbol">(</a><a id="8688" href="Ledger.Certs.html#3230" class="Field">voteDelegs</a> <a id="8699" href="Ledger.Certs.html#4390" class="Function">dState</a><a id="8705" class="Symbol">)</a>
           <a id="8718" class="Symbol">;</a> <a id="8720" href="Ledger.Ratify.html#3169" class="Field">treasury</a> <a id="8729" class="Symbol">=</a> <a id="8731" href="Ledger.Epoch.html#6522" class="Generalizable">acnt</a> <a id="8736" class="Symbol">.</a><a id="8737" href="Ledger.PParams.html#729" class="Field">treasury</a> <a id="8746" class="Symbol">;</a> <a id="8748" href="Ledger.Epoch.html#8748" class="Module">GState</a> <a id="8755" href="Ledger.Certs.html#4430" class="Function">gState</a>
           <a id="8773" class="Symbol">;</a> <a id="8775" href="Ledger.Ratify.html#3194" class="Field">pools</a> <a id="8781" class="Symbol">=</a> <a id="8783" href="Ledger.Certs.html#4410" class="Function">pState</a> <a id="8790" class="Symbol">.</a><a id="8791" href="Ledger.Certs.html#3813" class="Field">pools</a> <a id="8797" class="Symbol">;</a> <a id="8799" href="Ledger.Ratify.html#3235" class="Field">delegatees</a> <a id="8810" class="Symbol">=</a> <a id="8812" href="Ledger.Certs.html#4390" class="Function">dState</a> <a id="8819" class="Symbol">.</a><a id="8820" href="Ledger.Certs.html#3230" class="Field">voteDelegs</a> <a id="8831" class="Symbol">}</a>
        <a id="8841" href="Ledger.Ratify.html#11072" class="Function Operator">⊢</a> <a id="8843" href="Ledger.Prelude.html#2441" class="Function Operator">⟦</a> <a id="8845" href="Ledger.Epoch.html#7033" class="Bound">es</a> <a id="8848" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="8850" href="Class.HasEmptySet.html#287" class="Field">∅</a> <a id="8852" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="8854" href="Agda.Builtin.Bool.html#192" class="InductiveConstructor">false</a> <a id="8860" href="Ledger.Prelude.html#2441" class="Function Operator">⟧</a> <a id="8862" href="Ledger.Ratify.html#11072" class="Function Operator">⇀⦇</a> <a id="8865" href="Ledger.Epoch.html#7825" class="Bound">govSt&#39;</a> <a id="8872" href="Ledger.Ratify.html#11072" class="Function Operator">,RATIFIES⦈</a> <a id="8883" href="Ledger.Epoch.html#6457" class="Generalizable">fut&#39;</a>
      <a id="8894" class="Symbol">→</a> <a id="8896" href="Ledger.Epoch.html#6508" class="Generalizable">ls</a> <a id="8899" href="Ledger.Rewards.html#6941" class="Datatype Operator">⊢</a> <a id="8901" href="Ledger.Epoch.html#6613" class="Generalizable">ss</a> <a id="8904" href="Ledger.Rewards.html#6941" class="Datatype Operator">⇀⦇</a> <a id="8907" href="Agda.Builtin.Unit.html#212" class="InductiveConstructor">tt</a> <a id="8910" href="Ledger.Rewards.html#6941" class="Datatype Operator">,SNAP⦈</a> <a id="8917" href="Ledger.Epoch.html#6616" class="Generalizable">ss&#39;</a>
    <a id="8925" href="iog-prelude.Prelude.InferenceRules.html#217" class="Function Operator">────────────────────────────────</a>
    <a id="8962" class="Symbol">_</a> <a id="8964" href="Ledger.Epoch.html#6686" class="Datatype Operator">⊢</a> <a id="8966" href="Ledger.Prelude.html#2441" class="Function Operator">⟦</a> <a id="8968" href="Ledger.Epoch.html#6522" class="Generalizable">acnt</a> <a id="8973" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="8975" href="Ledger.Epoch.html#6613" class="Generalizable">ss</a> <a id="8978" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="8980" href="Ledger.Epoch.html#6508" class="Generalizable">ls</a> <a id="8983" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="8985" href="Ledger.Epoch.html#6536" class="Generalizable">es₀</a> <a id="8989" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="8991" href="Ledger.Epoch.html#6453" class="Generalizable">fut</a> <a id="8995" href="Ledger.Prelude.html#2441" class="Function Operator">⟧</a> <a id="8997" href="Ledger.Epoch.html#6686" class="Datatype Operator">⇀⦇</a> <a id="9000" href="Ledger.Epoch.html#6431" class="Generalizable">e</a> <a id="9002" href="Ledger.Epoch.html#6686" class="Datatype Operator">,EPOCH⦈</a>
        <a id="9018" href="Ledger.Prelude.html#2441" class="Function Operator">⟦</a> <a id="9020" href="Ledger.Epoch.html#8410" class="Bound">acnt&#39;</a> <a id="9026" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="9028" href="Ledger.Epoch.html#6616" class="Generalizable">ss&#39;</a> <a id="9032" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="9034" href="Ledger.Prelude.html#2441" class="Function Operator">⟦</a> <a id="9036" href="Ledger.Epoch.html#8295" class="Bound">utxoSt&#39;</a> <a id="9044" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="9046" href="Ledger.Epoch.html#7825" class="Bound">govSt&#39;</a> <a id="9053" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="9055" href="Ledger.Epoch.html#8214" class="Bound">certState&#39;</a> <a id="9066" href="Ledger.Prelude.html#2441" class="Function Operator">⟧</a> <a id="9068" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="9070" href="Ledger.Epoch.html#7033" class="Bound">es</a> <a id="9073" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="9075" href="Ledger.Epoch.html#6457" class="Generalizable">fut&#39;</a> <a id="9080" href="Ledger.Prelude.html#2441" class="Function Operator">⟧</a>


<a id="9084" class="Keyword">data</a>


  <a id="_⊢_⇀⦇_,NEWEPOCH⦈_"></a><a id="9093" href="Ledger.Epoch.html#9093" class="Datatype Operator">_⊢_⇀⦇_,NEWEPOCH⦈_</a> <a id="9111" class="Symbol">:</a> <a id="9113" href="Agda.Builtin.Unit.html#175" class="Record">⊤</a> <a id="9115" class="Symbol">→</a> <a id="9117" href="Ledger.Epoch.html#1812" class="Record">NewEpochState</a> <a id="9131" class="Symbol">→</a> <a id="9133" href="Ledger.Types.Epoch.html#543" class="Function">Epoch</a> <a id="9139" class="Symbol">→</a> <a id="9141" href="Ledger.Epoch.html#1812" class="Record">NewEpochState</a> <a id="9155" class="Symbol">→</a> <a id="9157" href="Agda.Primitive.html#388" class="Primitive">Type</a>


  <a id="9166" class="Keyword">where</a>


  <a id="_⊢_⇀⦇_,NEWEPOCH⦈_.NEWEPOCH-New"></a><a id="9176" href="Ledger.Epoch.html#9176" class="InductiveConstructor">NEWEPOCH-New</a> <a id="9189" class="Symbol">:</a> <a id="9191" class="Keyword">let</a>
      <a id="9201" href="Ledger.Epoch.html#9201" class="Bound">eps&#39;</a> <a id="9206" class="Symbol">=</a> <a id="9208" href="Ledger.Epoch.html#4714" class="Function">applyRUpd</a> <a id="9218" href="Ledger.Epoch.html#6634" class="Generalizable">ru</a> <a id="9221" href="Ledger.Epoch.html#6478" class="Generalizable">eps</a>
    <a id="9229" class="Keyword">in</a>
    <a id="9236" href="Prelude.InferenceRules.html#56074" class="Function Operator">∙</a> <a id="9238" href="Ledger.Epoch.html#6431" class="Generalizable">e</a> <a id="9240" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="9242" href="Ledger.Epoch.html#6433" class="Generalizable">lastEpoch</a> <a id="9252" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="9254" class="Number">1</a>
    <a id="9260" href="iog-prelude.Prelude.InferenceRules.html#583" class="Function Operator">∙</a> <a id="9262" class="Symbol">_</a> <a id="9264" href="Ledger.Epoch.html#6686" class="Datatype Operator">⊢</a> <a id="9266" href="Ledger.Epoch.html#9201" class="Bound">eps&#39;</a> <a id="9271" href="Ledger.Epoch.html#6686" class="Datatype Operator">⇀⦇</a> <a id="9274" href="Ledger.Epoch.html#6431" class="Generalizable">e</a> <a id="9276" href="Ledger.Epoch.html#6686" class="Datatype Operator">,EPOCH⦈</a> <a id="9284" href="Ledger.Epoch.html#6487" class="Generalizable">eps&#39;&#39;</a>
      <a id="9296" href="iog-prelude.Prelude.InferenceRules.html#217" class="Function Operator">────────────────────────────────</a>
      <a id="9335" class="Symbol">_</a> <a id="9337" href="Ledger.Epoch.html#9093" class="Datatype Operator">⊢</a> <a id="9339" href="Ledger.Prelude.html#2441" class="Function Operator">⟦</a> <a id="9341" href="Ledger.Epoch.html#6433" class="Generalizable">lastEpoch</a> <a id="9351" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="9353" href="Ledger.Epoch.html#6478" class="Generalizable">eps</a> <a id="9357" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="9359" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="9364" href="Ledger.Epoch.html#6634" class="Generalizable">ru</a> <a id="9367" href="Ledger.Prelude.html#2441" class="Function Operator">⟧</a> <a id="9369" href="Ledger.Epoch.html#9093" class="Datatype Operator">⇀⦇</a> <a id="9372" href="Ledger.Epoch.html#6431" class="Generalizable">e</a> <a id="9374" href="Ledger.Epoch.html#9093" class="Datatype Operator">,NEWEPOCH⦈</a> <a id="9385" href="Ledger.Prelude.html#2441" class="Function Operator">⟦</a> <a id="9387" href="Ledger.Epoch.html#6431" class="Generalizable">e</a> <a id="9389" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="9391" href="Ledger.Epoch.html#6487" class="Generalizable">eps&#39;&#39;</a> <a id="9397" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="9399" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a> <a id="9407" href="Ledger.Prelude.html#2441" class="Function Operator">⟧</a>

  <a id="_⊢_⇀⦇_,NEWEPOCH⦈_.NEWEPOCH-Not-New"></a><a id="9412" href="Ledger.Epoch.html#9412" class="InductiveConstructor">NEWEPOCH-Not-New</a> <a id="9429" class="Symbol">:</a>
    <a id="9435" href="Prelude.InferenceRules.html#56074" class="Function Operator">∙</a> <a id="9437" href="Ledger.Epoch.html#6431" class="Generalizable">e</a> <a id="9439" href="Relation.Binary.PropositionalEquality.Core.html#858" class="Function Operator">≢</a> <a id="9441" href="Ledger.Epoch.html#6433" class="Generalizable">lastEpoch</a> <a id="9451" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="9453" class="Number">1</a>
      <a id="9461" href="iog-prelude.Prelude.InferenceRules.html#217" class="Function Operator">────────────────────────────────</a>
      <a id="9500" class="Symbol">_</a> <a id="9502" href="Ledger.Epoch.html#9093" class="Datatype Operator">⊢</a> <a id="9504" href="Ledger.Prelude.html#2441" class="Function Operator">⟦</a> <a id="9506" href="Ledger.Epoch.html#6433" class="Generalizable">lastEpoch</a> <a id="9516" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="9518" href="Ledger.Epoch.html#6478" class="Generalizable">eps</a> <a id="9522" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="9524" href="Ledger.Epoch.html#6654" class="Generalizable">mru</a> <a id="9528" href="Ledger.Prelude.html#2441" class="Function Operator">⟧</a> <a id="9530" href="Ledger.Epoch.html#9093" class="Datatype Operator">⇀⦇</a> <a id="9533" href="Ledger.Epoch.html#6431" class="Generalizable">e</a> <a id="9535" href="Ledger.Epoch.html#9093" class="Datatype Operator">,NEWEPOCH⦈</a> <a id="9546" href="Ledger.Prelude.html#2441" class="Function Operator">⟦</a> <a id="9548" href="Ledger.Epoch.html#6433" class="Generalizable">lastEpoch</a> <a id="9558" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="9560" href="Ledger.Epoch.html#6478" class="Generalizable">eps</a> <a id="9564" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="9566" href="Ledger.Epoch.html#6654" class="Generalizable">mru</a> <a id="9570" href="Ledger.Prelude.html#2441" class="Function Operator">⟧</a>

  <a id="_⊢_⇀⦇_,NEWEPOCH⦈_.NEWEPOCH-No-Reward-Update"></a><a id="9575" href="Ledger.Epoch.html#9575" class="InductiveConstructor">NEWEPOCH-No-Reward-Update</a> <a id="9601" class="Symbol">:</a>
    <a id="9607" href="Prelude.InferenceRules.html#56074" class="Function Operator">∙</a> <a id="9609" href="Ledger.Epoch.html#6431" class="Generalizable">e</a> <a id="9611" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="9613" href="Ledger.Epoch.html#6433" class="Generalizable">lastEpoch</a> <a id="9623" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="9625" class="Number">1</a>
    <a id="9631" href="iog-prelude.Prelude.InferenceRules.html#583" class="Function Operator">∙</a> <a id="9633" class="Symbol">_</a> <a id="9635" href="Ledger.Epoch.html#6686" class="Datatype Operator">⊢</a> <a id="9637" href="Ledger.Epoch.html#6478" class="Generalizable">eps</a> <a id="9641" href="Ledger.Epoch.html#6686" class="Datatype Operator">⇀⦇</a> <a id="9644" href="Ledger.Epoch.html#6431" class="Generalizable">e</a> <a id="9646" href="Ledger.Epoch.html#6686" class="Datatype Operator">,EPOCH⦈</a> <a id="9654" href="Ledger.Epoch.html#6482" class="Generalizable">eps&#39;</a>
      <a id="9665" href="iog-prelude.Prelude.InferenceRules.html#217" class="Function Operator">────────────────────────────────</a>
      <a id="9704" class="Symbol">_</a> <a id="9706" href="Ledger.Epoch.html#9093" class="Datatype Operator">⊢</a> <a id="9708" href="Ledger.Prelude.html#2441" class="Function Operator">⟦</a> <a id="9710" href="Ledger.Epoch.html#6433" class="Generalizable">lastEpoch</a> <a id="9720" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="9722" href="Ledger.Epoch.html#6478" class="Generalizable">eps</a> <a id="9726" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="9728" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a> <a id="9736" href="Ledger.Prelude.html#2441" class="Function Operator">⟧</a> <a id="9738" href="Ledger.Epoch.html#9093" class="Datatype Operator">⇀⦇</a> <a id="9741" href="Ledger.Epoch.html#6431" class="Generalizable">e</a> <a id="9743" href="Ledger.Epoch.html#9093" class="Datatype Operator">,NEWEPOCH⦈</a> <a id="9754" href="Ledger.Prelude.html#2441" class="Function Operator">⟦</a> <a id="9756" href="Ledger.Epoch.html#6431" class="Generalizable">e</a> <a id="9758" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="9760" href="Ledger.Epoch.html#6482" class="Generalizable">eps&#39;</a> <a id="9765" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="9767" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a> <a id="9775" href="Ledger.Prelude.html#2441" class="Function Operator">⟧</a>

</pre></body></html>