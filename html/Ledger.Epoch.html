<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>Ledger.Epoch</title><link rel="stylesheet" href="Agda.css"></head><body><pre class="Agda">
<a id="2" class="Symbol">{-#</a> <a id="6" class="Keyword">OPTIONS</a> <a id="14" class="Pragma">--safe</a> <a id="21" class="Symbol">#-}</a>

<a id="26" class="Keyword">open</a> <a id="31" class="Keyword">import</a> <a id="38" href="Ledger.Abstract.html" class="Module">Ledger.Abstract</a>
<a id="54" class="Keyword">open</a> <a id="59" class="Keyword">import</a> <a id="66" href="Ledger.Transaction.html" class="Module">Ledger.Transaction</a>

<a id="86" class="Keyword">module</a> <a id="93" href="Ledger.Epoch.html" class="Module">Ledger.Epoch</a>
  <a id="108" class="Symbol">(</a><a id="109" href="Ledger.Epoch.html#109" class="Bound">txs</a> <a id="113" class="Symbol">:</a> <a id="115" class="Symbol">_)</a> <a id="118" class="Symbol">(</a><a id="119" class="Keyword">open</a> <a id="124" href="Ledger.Transaction.html#867" class="Module">TransactionStructure</a> <a id="145" href="Ledger.Epoch.html#109" class="Bound">txs</a><a id="148" class="Symbol">)</a>
  <a id="152" class="Symbol">(</a><a id="153" href="Ledger.Epoch.html#153" class="Bound">abs</a> <a id="157" class="Symbol">:</a> <a id="159" href="Ledger.Abstract.html#578" class="Record">AbstractFunctions</a> <a id="177" href="Ledger.Epoch.html#109" class="Bound">txs</a><a id="180" class="Symbol">)</a> <a id="182" class="Symbol">(</a><a id="183" class="Keyword">open</a> <a id="188" href="Ledger.Abstract.html#578" class="Module">AbstractFunctions</a> <a id="206" href="Ledger.Epoch.html#153" class="Bound">abs</a><a id="209" class="Symbol">)</a>
  <a id="213" class="Keyword">where</a>

<a id="220" class="Keyword">open</a> <a id="225" class="Keyword">import</a> <a id="232" href="Ledger.Certs.html" class="Module">Ledger.Certs</a> <a id="245" href="Ledger.Transaction.html#1809" class="Function">govStructure</a>
<a id="258" class="Keyword">open</a> <a id="263" class="Keyword">import</a> <a id="270" href="Ledger.Enact.html" class="Module">Ledger.Enact</a> <a id="283" href="Ledger.Transaction.html#1809" class="Function">govStructure</a>
<a id="296" class="Keyword">open</a> <a id="301" class="Keyword">import</a> <a id="308" href="Ledger.Gov.html" class="Module">Ledger.Gov</a> <a id="319" href="Ledger.Epoch.html#109" class="Bound">txs</a>
<a id="323" class="Keyword">open</a> <a id="328" class="Keyword">import</a> <a id="335" href="Ledger.Ledger.html" class="Module">Ledger.Ledger</a> <a id="349" href="Ledger.Epoch.html#109" class="Bound">txs</a> <a id="353" href="Ledger.Epoch.html#153" class="Bound">abs</a>
<a id="357" class="Keyword">open</a> <a id="362" class="Keyword">import</a> <a id="369" href="Ledger.Prelude.html" class="Module">Ledger.Prelude</a> <a id="384" class="Keyword">hiding</a> <a id="391" class="Symbol">(</a><a id="392" href="Data.List.Base.html#5412" class="Function">iterate</a><a id="399" class="Symbol">)</a>
<a id="401" class="Keyword">open</a> <a id="406" class="Keyword">import</a> <a id="413" href="Ledger.Ratify.html" class="Module">Ledger.Ratify</a> <a id="427" href="Ledger.Epoch.html#109" class="Bound">txs</a>
<a id="431" class="Keyword">open</a> <a id="436" class="Keyword">import</a> <a id="443" href="Ledger.Utxo.html" class="Module">Ledger.Utxo</a> <a id="455" href="Ledger.Epoch.html#109" class="Bound">txs</a> <a id="459" href="Ledger.Epoch.html#153" class="Bound">abs</a>

<a id="464" class="Keyword">open</a> <a id="469" class="Keyword">import</a> <a id="476" href="Agda.Builtin.FromNat.html" class="Module">Agda.Builtin.FromNat</a>

<a id="498" class="Keyword">open</a> <a id="503" class="Keyword">import</a> <a id="510" href="Data.Integer.html" class="Module">Data.Integer</a> <a id="523" class="Keyword">using</a> <a id="529" class="Symbol">()</a> <a id="532" class="Keyword">renaming</a> <a id="541" class="Symbol">(</a><a id="542" href="Agda.Builtin.Int.html#263" class="InductiveConstructor">+_</a> <a id="545" class="Symbol">to</a> <a id="548" class="InductiveConstructor">pos</a><a id="551" class="Symbol">)</a>
<a id="553" class="Keyword">open</a> <a id="558" class="Keyword">import</a> <a id="565" href="Data.List.html" class="Module">Data.List</a> <a id="575" class="Keyword">using</a> <a id="581" class="Symbol">(</a><a id="582" href="Data.List.Base.html#10687" class="Function">filter</a><a id="588" class="Symbol">)</a>
<a id="590" class="Keyword">open</a> <a id="595" class="Keyword">import</a> <a id="602" href="Data.Nat.GeneralisedArithmetic.html" class="Module">Data.Nat.GeneralisedArithmetic</a> <a id="633" class="Keyword">using</a> <a id="639" class="Symbol">(</a><a id="640" href="Data.Nat.GeneralisedArithmetic.html#866" class="Function">iterate</a><a id="647" class="Symbol">)</a>
<a id="649" class="Keyword">open</a> <a id="654" class="Keyword">import</a> <a id="661" href="Data.Nat.Properties.html" class="Module">Data.Nat.Properties</a> <a id="681" class="Keyword">using</a> <a id="687" class="Symbol">(</a><a id="688" href="Data.Nat.Properties.html#17252" class="Function">+-0-monoid</a><a id="698" class="Symbol">;</a> <a id="700" href="Data.Nat.Properties.html#17331" class="Function">+-0-commutativeMonoid</a><a id="721" class="Symbol">)</a>



<a id="726" class="Keyword">record</a> <a id="RewardUpdate"></a><a id="733" href="Ledger.Epoch.html#733" class="Record">RewardUpdate</a> <a id="746" class="Symbol">:</a> <a id="748" href="Agda.Primitive.html#388" class="Primitive">Set</a> <a id="752" class="Keyword">where</a>


  <a id="762" class="Keyword">constructor</a> <a id="⟦_,_,_,_⟧ʳᵘ"></a><a id="774" href="Ledger.Epoch.html#774" class="InductiveConstructor Operator">⟦_,_,_,_⟧ʳᵘ</a>


  <a id="790" class="Keyword">field</a>
    <a id="RewardUpdate.Δt"></a><a id="800" href="Ledger.Epoch.html#800" class="Field">Δt</a> <a id="RewardUpdate.Δr"></a><a id="803" href="Ledger.Epoch.html#803" class="Field">Δr</a> <a id="RewardUpdate.Δf"></a><a id="806" href="Ledger.Epoch.html#806" class="Field">Δf</a> <a id="809" class="Symbol">:</a> <a id="811" href="Agda.Builtin.Int.html#245" class="Datatype">ℤ</a>
    <a id="RewardUpdate.rs"></a><a id="817" href="Ledger.Epoch.html#817" class="Field">rs</a> <a id="820" class="Symbol">:</a> <a id="822" href="Ledger.Address.html#273" class="Datatype">Credential</a> <a id="833" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="835" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a>


<a id="842" class="Keyword">record</a> <a id="Snapshot"></a><a id="849" href="Ledger.Epoch.html#849" class="Record">Snapshot</a> <a id="858" class="Symbol">:</a> <a id="860" href="Agda.Primitive.html#388" class="Primitive">Set</a> <a id="864" class="Keyword">where</a>
  <a id="872" class="Keyword">field</a>
    <a id="Snapshot.stake"></a><a id="882" href="Ledger.Epoch.html#882" class="Field">stake</a>        <a id="895" class="Symbol">:</a> <a id="897" href="Ledger.Address.html#273" class="Datatype">Credential</a> <a id="908" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="910" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a>
    <a id="Snapshot.delegations"></a><a id="919" href="Ledger.Epoch.html#919" class="Field">delegations</a>  <a id="932" class="Symbol">:</a> <a id="934" href="Ledger.Address.html#273" class="Datatype">Credential</a> <a id="945" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="947" href="Ledger.Crypto.html#1310" class="Function">KeyHash</a>
    <a id="959" class="Comment">-- poolParameters : KeyHash ⇀ PoolParam</a>

<a id="1000" class="Keyword">record</a> <a id="Snapshots"></a><a id="1007" href="Ledger.Epoch.html#1007" class="Record">Snapshots</a> <a id="1017" class="Symbol">:</a> <a id="1019" href="Agda.Primitive.html#388" class="Primitive">Set</a> <a id="1023" class="Keyword">where</a>
  <a id="1031" class="Keyword">field</a>
    <a id="Snapshots.mark"></a><a id="1041" href="Ledger.Epoch.html#1041" class="Field">mark</a> <a id="Snapshots.set"></a><a id="1046" href="Ledger.Epoch.html#1046" class="Field">set</a> <a id="Snapshots.go"></a><a id="1050" href="Ledger.Epoch.html#1050" class="Field">go</a>  <a id="1054" class="Symbol">:</a> <a id="1056" href="Ledger.Epoch.html#849" class="Record">Snapshot</a>
    <a id="Snapshots.feeSS"></a><a id="1069" href="Ledger.Epoch.html#1069" class="Field">feeSS</a>        <a id="1082" class="Symbol">:</a> <a id="1084" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a>



<a id="1092" class="Keyword">record</a> <a id="EpochState"></a><a id="1099" href="Ledger.Epoch.html#1099" class="Record">EpochState</a> <a id="1110" class="Symbol">:</a> <a id="1112" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="1117" class="Keyword">where</a>


  <a id="1127" class="Keyword">constructor</a> <a id="⟦_,_,_,_,_⟧ᵉ&#39;"></a><a id="1139" href="Ledger.Epoch.html#1139" class="InductiveConstructor Operator">⟦_,_,_,_,_⟧ᵉ&#39;</a>


  <a id="1157" class="Keyword">field</a>
    <a id="EpochState.acnt"></a><a id="1167" href="Ledger.Epoch.html#1167" class="Field">acnt</a>       <a id="1178" class="Symbol">:</a> <a id="1180" href="Ledger.PParams.html#674" class="Record">Acnt</a>
    <a id="EpochState.ss"></a><a id="1189" href="Ledger.Epoch.html#1189" class="Field">ss</a>         <a id="1200" class="Symbol">:</a> <a id="1202" href="Ledger.Epoch.html#1007" class="Record">Snapshots</a>
    <a id="EpochState.ls"></a><a id="1216" href="Ledger.Epoch.html#1216" class="Field">ls</a>         <a id="1227" class="Symbol">:</a> <a id="1229" href="Ledger.Ledger.html#809" class="Record">LState</a>
    <a id="EpochState.es"></a><a id="1240" href="Ledger.Epoch.html#1240" class="Field">es</a>         <a id="1251" class="Symbol">:</a> <a id="1253" href="Ledger.Enact.html#397" class="Record">EnactState</a>
    <a id="EpochState.fut"></a><a id="1268" href="Ledger.Epoch.html#1268" class="Field">fut</a>        <a id="1279" class="Symbol">:</a> <a id="1281" href="Ledger.Ratify.html#3224" class="Record">RatifyState</a>


<a id="1295" class="Keyword">record</a> <a id="HasEpochState"></a><a id="1302" href="Ledger.Epoch.html#1302" class="Record">HasEpochState</a> <a id="1316" class="Symbol">{</a><a id="1317" href="Ledger.Epoch.html#1317" class="Bound">a</a><a id="1318" class="Symbol">}</a> <a id="1320" class="Symbol">(</a><a id="1321" href="Ledger.Epoch.html#1321" class="Bound">A</a> <a id="1323" class="Symbol">:</a> <a id="1325" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="1330" href="Ledger.Epoch.html#1317" class="Bound">a</a><a id="1331" class="Symbol">)</a> <a id="1333" class="Symbol">:</a> <a id="1335" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="1340" href="Ledger.Epoch.html#1317" class="Bound">a</a> <a id="1342" class="Keyword">where</a>
  <a id="1350" class="Keyword">field</a> <a id="HasEpochState.EpochStateOf"></a><a id="1356" href="Ledger.Epoch.html#1356" class="Field">EpochStateOf</a> <a id="1369" class="Symbol">:</a> <a id="1371" href="Ledger.Epoch.html#1321" class="Bound">A</a> <a id="1373" class="Symbol">→</a> <a id="1375" href="Ledger.Epoch.html#1099" class="Record">EpochState</a>
<a id="1386" class="Keyword">open</a> <a id="1391" href="Ledger.Epoch.html#1302" class="Module">HasEpochState</a> <a id="1405" class="Symbol">⦃...⦄</a> <a id="1411" class="Keyword">public</a>

<a id="1419" class="Keyword">instance</a>
  <a id="HasLState-EpochState"></a><a id="1430" href="Ledger.Epoch.html#1430" class="Function">HasLState-EpochState</a> <a id="1451" class="Symbol">:</a> <a id="1453" href="Ledger.Ledger.html#954" class="Record">HasLState</a> <a id="1463" href="Ledger.Epoch.html#1099" class="Record">EpochState</a>
  <a id="1476" href="Ledger.Epoch.html#1430" class="Function">HasLState-EpochState</a> <a id="1497" class="Symbol">.</a><a id="1498" href="Ledger.Ledger.html#1004" class="Field">LStateOf</a> <a id="1507" class="Symbol">=</a> <a id="1509" href="Ledger.Epoch.html#1216" class="Field">EpochState.ls</a>

  <a id="HasEnactState-EpochState"></a><a id="1526" href="Ledger.Epoch.html#1526" class="Function">HasEnactState-EpochState</a> <a id="1551" class="Symbol">:</a> <a id="1553" href="Ledger.Enact.html#689" class="Record">HasEnactState</a> <a id="1567" href="Ledger.Epoch.html#1099" class="Record">EpochState</a>
  <a id="1580" href="Ledger.Epoch.html#1526" class="Function">HasEnactState-EpochState</a> <a id="1605" class="Symbol">.</a><a id="1606" href="Ledger.Enact.html#743" class="Field">EnactStateOf</a> <a id="1619" class="Symbol">=</a> <a id="1621" href="Ledger.Epoch.html#1240" class="Field">EpochState.es</a>

  <a id="HasDeposits-EpochState"></a><a id="1638" href="Ledger.Epoch.html#1638" class="Function">HasDeposits-EpochState</a> <a id="1661" class="Symbol">:</a> <a id="1663" href="Ledger.Certs.html#677" class="Record">HasDeposits</a> <a id="1675" href="Ledger.Epoch.html#1099" class="Record">EpochState</a>
  <a id="1688" href="Ledger.Epoch.html#1638" class="Function">HasDeposits-EpochState</a> <a id="1711" class="Symbol">.</a><a id="1712" href="Ledger.Certs.html#729" class="Field">DepositsOf</a> <a id="1723" class="Symbol">=</a> <a id="1725" href="Ledger.Certs.html#729" class="Field">DepositsOf</a> <a id="1736" href="Function.Base.html#1115" class="Function Operator">∘</a> <a id="1738" href="Ledger.Ledger.html#1004" class="Field">LStateOf</a>

  <a id="Hastreasury-EpochState"></a><a id="1750" href="Ledger.Epoch.html#1750" class="Function">Hastreasury-EpochState</a> <a id="1773" class="Symbol">:</a> <a id="1775" href="Ledger.PParams.html#762" class="Record">Hastreasury</a> <a id="1787" href="Ledger.Epoch.html#1099" class="Record">EpochState</a>
  <a id="1800" href="Ledger.Epoch.html#1750" class="Function">Hastreasury-EpochState</a> <a id="1823" class="Symbol">.</a><a id="1824" href="Ledger.PParams.html#814" class="Field">treasuryOf</a> <a id="1835" class="Symbol">=</a> <a id="1837" href="Ledger.PParams.html#729" class="Field">Acnt.treasury</a> <a id="1851" href="Function.Base.html#1115" class="Function Operator">∘</a> <a id="1853" href="Ledger.Epoch.html#1167" class="Field">EpochState.acnt</a>



<a id="1872" class="Keyword">record</a> <a id="NewEpochState"></a><a id="1879" href="Ledger.Epoch.html#1879" class="Record">NewEpochState</a> <a id="1893" class="Symbol">:</a> <a id="1895" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="1900" class="Keyword">where</a>
  <a id="1908" class="Keyword">field</a>
    <a id="NewEpochState.lastEpoch"></a><a id="1918" href="Ledger.Epoch.html#1918" class="Field">lastEpoch</a>   <a id="1930" class="Symbol">:</a> <a id="1932" href="Ledger.Types.Epoch.html#476" class="Function">Epoch</a>
    <a id="NewEpochState.epochState"></a><a id="1942" href="Ledger.Epoch.html#1942" class="Field">epochState</a>  <a id="1954" class="Symbol">:</a> <a id="1956" href="Ledger.Epoch.html#1099" class="Record">EpochState</a>
    <a id="NewEpochState.ru"></a><a id="1971" href="Ledger.Epoch.html#1971" class="Field">ru</a>          <a id="1983" class="Symbol">:</a> <a id="1985" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="1991" href="Ledger.Epoch.html#733" class="Record">RewardUpdate</a>


<a id="2006" class="Keyword">record</a> <a id="HasNewEpochState"></a><a id="2013" href="Ledger.Epoch.html#2013" class="Record">HasNewEpochState</a> <a id="2030" class="Symbol">{</a><a id="2031" href="Ledger.Epoch.html#2031" class="Bound">a</a><a id="2032" class="Symbol">}</a> <a id="2034" class="Symbol">(</a><a id="2035" href="Ledger.Epoch.html#2035" class="Bound">A</a> <a id="2037" class="Symbol">:</a> <a id="2039" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="2044" href="Ledger.Epoch.html#2031" class="Bound">a</a><a id="2045" class="Symbol">)</a> <a id="2047" class="Symbol">:</a> <a id="2049" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="2054" href="Ledger.Epoch.html#2031" class="Bound">a</a> <a id="2056" class="Keyword">where</a>
  <a id="2064" class="Keyword">field</a> <a id="HasNewEpochState.NewEpochStateOf"></a><a id="2070" href="Ledger.Epoch.html#2070" class="Field">NewEpochStateOf</a> <a id="2086" class="Symbol">:</a> <a id="2088" href="Ledger.Epoch.html#2035" class="Bound">A</a> <a id="2090" class="Symbol">→</a> <a id="2092" href="Ledger.Epoch.html#1879" class="Record">NewEpochState</a>
<a id="2106" class="Keyword">open</a> <a id="2111" href="Ledger.Epoch.html#2013" class="Module">HasNewEpochState</a> <a id="2128" class="Symbol">⦃...⦄</a> <a id="2134" class="Keyword">public</a>
<a id="2141" class="Keyword">record</a> <a id="HasLastEpoch"></a><a id="2148" href="Ledger.Epoch.html#2148" class="Record">HasLastEpoch</a>     <a id="2165" class="Symbol">{</a><a id="2166" href="Ledger.Epoch.html#2166" class="Bound">a</a><a id="2167" class="Symbol">}</a> <a id="2169" class="Symbol">(</a><a id="2170" href="Ledger.Epoch.html#2170" class="Bound">A</a> <a id="2172" class="Symbol">:</a> <a id="2174" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="2179" href="Ledger.Epoch.html#2166" class="Bound">a</a><a id="2180" class="Symbol">)</a> <a id="2182" class="Symbol">:</a> <a id="2184" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="2189" href="Ledger.Epoch.html#2166" class="Bound">a</a> <a id="2191" class="Keyword">where</a> <a id="2197" class="Keyword">field</a> <a id="HasLastEpoch.LastEpochOf"></a><a id="2203" href="Ledger.Epoch.html#2203" class="Field">LastEpochOf</a>     <a id="2219" class="Symbol">:</a> <a id="2221" href="Ledger.Epoch.html#2170" class="Bound">A</a> <a id="2223" class="Symbol">→</a> <a id="2225" href="Ledger.Types.Epoch.html#476" class="Function">Epoch</a>
<a id="2231" class="Keyword">open</a> <a id="2236" href="Ledger.Epoch.html#2148" class="Module">HasLastEpoch</a>     <a id="2253" class="Symbol">⦃...⦄</a> <a id="2259" class="Keyword">public</a>

<a id="2267" class="Keyword">instance</a>
  <a id="HasLastEpoch-NewEpochState"></a><a id="2278" href="Ledger.Epoch.html#2278" class="Function">HasLastEpoch-NewEpochState</a> <a id="2305" class="Symbol">:</a> <a id="2307" href="Ledger.Epoch.html#2148" class="Record">HasLastEpoch</a> <a id="2320" href="Ledger.Epoch.html#1879" class="Record">NewEpochState</a>
  <a id="2336" href="Ledger.Epoch.html#2278" class="Function">HasLastEpoch-NewEpochState</a> <a id="2363" class="Symbol">.</a><a id="2364" href="Ledger.Epoch.html#2203" class="Field">LastEpochOf</a> <a id="2376" class="Symbol">=</a> <a id="2378" href="Ledger.Epoch.html#1918" class="Field">NewEpochState.lastEpoch</a>

  <a id="HasEpochState-NewEpochState"></a><a id="2405" href="Ledger.Epoch.html#2405" class="Function">HasEpochState-NewEpochState</a> <a id="2433" class="Symbol">:</a> <a id="2435" href="Ledger.Epoch.html#1302" class="Record">HasEpochState</a> <a id="2449" href="Ledger.Epoch.html#1879" class="Record">NewEpochState</a>
  <a id="2465" href="Ledger.Epoch.html#2405" class="Function">HasEpochState-NewEpochState</a> <a id="2493" class="Symbol">.</a><a id="2494" href="Ledger.Epoch.html#1356" class="Field">EpochStateOf</a> <a id="2507" class="Symbol">=</a> <a id="2509" href="Ledger.Epoch.html#1942" class="Field">NewEpochState.epochState</a>

  <a id="Hastreasury-NewEpochState"></a><a id="2537" href="Ledger.Epoch.html#2537" class="Function">Hastreasury-NewEpochState</a> <a id="2563" class="Symbol">:</a> <a id="2565" href="Ledger.PParams.html#762" class="Record">Hastreasury</a> <a id="2577" href="Ledger.Epoch.html#1879" class="Record">NewEpochState</a>
  <a id="2593" href="Ledger.Epoch.html#2537" class="Function">Hastreasury-NewEpochState</a> <a id="2619" class="Symbol">.</a><a id="2620" href="Ledger.PParams.html#814" class="Field">treasuryOf</a> <a id="2631" class="Symbol">=</a> <a id="2633" href="Ledger.PParams.html#814" class="Field">treasuryOf</a> <a id="2644" href="Function.Base.html#1115" class="Function Operator">∘</a> <a id="2646" href="Ledger.Epoch.html#1356" class="Field">EpochStateOf</a>

  <a id="HasLState-NewEpochState"></a><a id="2662" href="Ledger.Epoch.html#2662" class="Function">HasLState-NewEpochState</a> <a id="2686" class="Symbol">:</a> <a id="2688" href="Ledger.Ledger.html#954" class="Record">HasLState</a> <a id="2698" href="Ledger.Epoch.html#1879" class="Record">NewEpochState</a>
  <a id="2714" href="Ledger.Epoch.html#2662" class="Function">HasLState-NewEpochState</a> <a id="2738" class="Symbol">.</a><a id="2739" href="Ledger.Ledger.html#1004" class="Field">LStateOf</a> <a id="2748" class="Symbol">=</a> <a id="2750" href="Ledger.Ledger.html#1004" class="Field">LStateOf</a> <a id="2759" href="Function.Base.html#1115" class="Function Operator">∘</a> <a id="2761" href="Ledger.Epoch.html#1356" class="Field">EpochStateOf</a>

  <a id="HasGovState-NewEpochState"></a><a id="2777" href="Ledger.Epoch.html#2777" class="Function">HasGovState-NewEpochState</a> <a id="2803" class="Symbol">:</a> <a id="2805" href="Ledger.Gov.html#1408" class="Record">HasGovState</a> <a id="2817" href="Ledger.Epoch.html#1879" class="Record">NewEpochState</a>
  <a id="2833" href="Ledger.Epoch.html#2777" class="Function">HasGovState-NewEpochState</a> <a id="2859" class="Symbol">.</a><a id="2860" href="Ledger.Gov.html#1460" class="Field">GovStateOf</a> <a id="2871" class="Symbol">=</a> <a id="2873" href="Ledger.Gov.html#1460" class="Field">GovStateOf</a> <a id="2884" href="Function.Base.html#1115" class="Function Operator">∘</a> <a id="2886" href="Ledger.Ledger.html#1004" class="Field">LStateOf</a>

  <a id="HasCertState-NewEpochState"></a><a id="2898" href="Ledger.Epoch.html#2898" class="Function">HasCertState-NewEpochState</a> <a id="2925" class="Symbol">:</a> <a id="2927" href="Ledger.Certs.html#4455" class="Record">HasCertState</a> <a id="2940" href="Ledger.Epoch.html#1879" class="Record">NewEpochState</a>
  <a id="2956" href="Ledger.Epoch.html#2898" class="Function">HasCertState-NewEpochState</a> <a id="2983" class="Symbol">.</a><a id="2984" href="Ledger.Certs.html#4508" class="Field">CertStateOf</a> <a id="2996" class="Symbol">=</a> <a id="2998" href="Ledger.Certs.html#4508" class="Field">CertStateOf</a> <a id="3010" href="Function.Base.html#1115" class="Function Operator">∘</a> <a id="3012" href="Ledger.Ledger.html#1004" class="Field">LStateOf</a>

  <a id="HasDReps-NewEpochState"></a><a id="3024" href="Ledger.Epoch.html#3024" class="Function">HasDReps-NewEpochState</a> <a id="3047" class="Symbol">:</a> <a id="3049" href="Ledger.Certs.html#906" class="Record">HasDReps</a> <a id="3058" href="Ledger.Epoch.html#1879" class="Record">NewEpochState</a> 
  <a id="3075" href="Ledger.Epoch.html#3024" class="Function">HasDReps-NewEpochState</a> <a id="3098" class="Symbol">.</a><a id="3099" href="Ledger.Certs.html#955" class="Field">DRepsOf</a> <a id="3107" class="Symbol">=</a> <a id="3109" href="Ledger.Certs.html#955" class="Field">DRepsOf</a> <a id="3117" href="Function.Base.html#1115" class="Function Operator">∘</a> <a id="3119" href="Ledger.Certs.html#4508" class="Field">CertStateOf</a>

  <a id="HasRewards-NewEpochState"></a><a id="3134" href="Ledger.Epoch.html#3134" class="Function">HasRewards-NewEpochState</a> <a id="3159" class="Symbol">:</a> <a id="3161" href="Ledger.Certs.html#793" class="Record">HasRewards</a> <a id="3172" href="Ledger.Epoch.html#1879" class="Record">NewEpochState</a>
  <a id="3188" href="Ledger.Epoch.html#3134" class="Function">HasRewards-NewEpochState</a> <a id="3213" class="Symbol">.</a><a id="3214" href="Ledger.Certs.html#844" class="Field">RewardsOf</a> <a id="3224" class="Symbol">=</a> <a id="3226" href="Ledger.Certs.html#844" class="Field">RewardsOf</a> <a id="3236" href="Function.Base.html#1115" class="Function Operator">∘</a> <a id="3238" href="Ledger.Certs.html#4508" class="Field">CertStateOf</a>

  <a id="3253" class="Keyword">unquoteDecl</a> <a id="HasCast-RewardUpdate"></a><a id="3265" href="Ledger.Epoch.html#3265" class="Function">HasCast-RewardUpdate</a> <a id="HasCast-Snapshot"></a><a id="3286" href="Ledger.Epoch.html#3286" class="Function">HasCast-Snapshot</a> <a id="HasCast-Snapshots"></a><a id="3303" href="Ledger.Epoch.html#3303" class="Function">HasCast-Snapshots</a> <a id="HasCast-EpochState"></a><a id="3321" href="Ledger.Epoch.html#3321" class="Function">HasCast-EpochState</a> <a id="HasCast-NewEpochState"></a><a id="3340" href="Ledger.Epoch.html#3340" class="Function">HasCast-NewEpochState</a> <a id="3362" class="Symbol">=</a> <a id="3364" href="Class.HasCast.Derive.html#2660" class="Function">derive-HasCast</a>
    <a id="3383" class="Symbol">(</a>   <a id="3387" class="Symbol">(</a><a id="3388" class="Keyword">quote</a> <a id="3394" href="Ledger.Epoch.html#733" class="Record">RewardUpdate</a>   <a id="3409" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="3411" href="Ledger.Epoch.html#3265" class="Function">HasCast-RewardUpdate</a><a id="3431" class="Symbol">)</a>
    <a id="3437" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a>   <a id="3441" class="Symbol">(</a><a id="3442" class="Keyword">quote</a> <a id="3448" href="Ledger.Epoch.html#849" class="Record">Snapshot</a>       <a id="3463" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="3465" href="Ledger.Epoch.html#3286" class="Function">HasCast-Snapshot</a><a id="3481" class="Symbol">)</a>
    <a id="3487" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a>   <a id="3491" class="Symbol">(</a><a id="3492" class="Keyword">quote</a> <a id="3498" href="Ledger.Epoch.html#1007" class="Record">Snapshots</a>      <a id="3513" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="3515" href="Ledger.Epoch.html#3303" class="Function">HasCast-Snapshots</a><a id="3532" class="Symbol">)</a>
    <a id="3538" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a>   <a id="3542" class="Symbol">(</a><a id="3543" class="Keyword">quote</a> <a id="3549" href="Ledger.Epoch.html#1099" class="Record">EpochState</a>     <a id="3564" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="3566" href="Ledger.Epoch.html#3321" class="Function">HasCast-EpochState</a><a id="3584" class="Symbol">)</a>
    <a id="3590" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="3592" href="Data.List.Base.html#5205" class="Function Operator">[</a> <a id="3594" class="Symbol">(</a><a id="3595" class="Keyword">quote</a> <a id="3601" href="Ledger.Epoch.html#1879" class="Record">NewEpochState</a>  <a id="3616" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="3618" href="Ledger.Epoch.html#3340" class="Function">HasCast-NewEpochState</a><a id="3639" class="Symbol">)</a><a id="3640" href="Data.List.Base.html#5205" class="Function Operator">]</a><a id="3641" class="Symbol">)</a>

<a id="3644" class="Keyword">instance</a> <a id="3653" href="Ledger.Epoch.html#3653" class="Function">_</a> <a id="3655" class="Symbol">=</a> <a id="3657" href="Data.Nat.Properties.html#17252" class="Function">+-0-monoid</a><a id="3667" class="Symbol">;</a> <a id="3669" href="Ledger.Epoch.html#3669" class="Function">_</a> <a id="3671" class="Symbol">=</a> <a id="3673" href="Data.Nat.Properties.html#17331" class="Function">+-0-commutativeMonoid</a>

<a id="toRwdAddr"></a><a id="3696" href="Ledger.Epoch.html#3696" class="Function">toRwdAddr</a> <a id="3706" class="Symbol">:</a> <a id="3708" href="Ledger.Address.html#273" class="Datatype">Credential</a> <a id="3719" class="Symbol">→</a> <a id="3721" href="Ledger.Address.html#1337" class="Record">RwdAddr</a>
<a id="3729" href="Ledger.Epoch.html#3696" class="Function">toRwdAddr</a> <a id="3739" href="Ledger.Epoch.html#3739" class="Bound">x</a> <a id="3741" class="Symbol">=</a> <a id="3743" class="Keyword">record</a> <a id="3750" class="Symbol">{</a> <a id="3752" href="Ledger.Address.html#1366" class="Field">net</a> <a id="3756" class="Symbol">=</a> <a id="3758" href="Ledger.Types.Epoch.html#2154" class="Function">NetworkId</a> <a id="3768" class="Symbol">;</a> <a id="3770" href="Ledger.Address.html#1391" class="Field">stake</a> <a id="3776" class="Symbol">=</a> <a id="3778" href="Ledger.Epoch.html#3739" class="Bound">x</a> <a id="3780" class="Symbol">}</a>

<a id="getStakeCred"></a><a id="3783" href="Ledger.Epoch.html#3783" class="Function">getStakeCred</a> <a id="3796" class="Symbol">:</a> <a id="3798" href="Ledger.Transaction.html#2320" class="Function">TxOut</a> <a id="3804" class="Symbol">→</a> <a id="3806" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="3812" href="Ledger.Address.html#273" class="Datatype">Credential</a>
<a id="3823" href="Ledger.Epoch.html#3783" class="Function">getStakeCred</a> <a id="3836" class="Symbol">(</a><a id="3837" href="Ledger.Epoch.html#3837" class="Bound">a</a> <a id="3839" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="3841" class="Symbol">_</a> <a id="3843" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="3845" class="Symbol">_</a> <a id="3847" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="3849" class="Symbol">_)</a> <a id="3852" class="Symbol">=</a> <a id="3854" href="Ledger.Address.html#2509" class="Function">stakeCred</a> <a id="3864" href="Ledger.Epoch.html#3837" class="Bound">a</a>

<a id="3867" class="Keyword">open</a> <a id="3872" href="Ledger.Address.html#1337" class="Module">RwdAddr</a> <a id="3880" class="Keyword">using</a> <a id="3886" class="Symbol">(</a><a id="3887" href="Ledger.Address.html#1391" class="Field">stake</a><a id="3892" class="Symbol">)</a>
<a id="3894" class="Keyword">open</a> <a id="3899" href="Ledger.GovernanceActions.html#2594" class="Module">GovActionState</a> <a id="3914" class="Keyword">using</a> <a id="3920" class="Symbol">(</a><a id="3921" href="Ledger.GovernanceActions.html#2665" class="Field">returnAddr</a><a id="3931" class="Symbol">)</a>


<a id="applyRUpd"></a><a id="3935" href="Ledger.Epoch.html#3935" class="Function">applyRUpd</a> <a id="3945" class="Symbol">:</a> <a id="3947" href="Ledger.Epoch.html#733" class="Record">RewardUpdate</a> <a id="3960" class="Symbol">→</a> <a id="3962" href="Ledger.Epoch.html#1099" class="Record">EpochState</a> <a id="3973" class="Symbol">→</a> <a id="3975" href="Ledger.Epoch.html#1099" class="Record">EpochState</a>
<a id="3986" href="Ledger.Epoch.html#3935" class="Function">applyRUpd</a> <a id="3996" href="Ledger.Epoch.html#774" class="InductiveConstructor Operator">⟦</a> <a id="3998" href="Ledger.Epoch.html#3998" class="Bound">Δt</a> <a id="4001" href="Ledger.Epoch.html#774" class="InductiveConstructor Operator">,</a> <a id="4003" href="Ledger.Epoch.html#4003" class="Bound">Δr</a> <a id="4006" href="Ledger.Epoch.html#774" class="InductiveConstructor Operator">,</a> <a id="4008" href="Ledger.Epoch.html#4008" class="Bound">Δf</a> <a id="4011" href="Ledger.Epoch.html#774" class="InductiveConstructor Operator">,</a> <a id="4013" href="Ledger.Epoch.html#4013" class="Bound">rs</a> <a id="4016" href="Ledger.Epoch.html#774" class="InductiveConstructor Operator">⟧ʳᵘ</a>
  <a id="4022" href="Ledger.Epoch.html#1139" class="InductiveConstructor Operator">⟦</a> <a id="4024" href="Ledger.PParams.html#708" class="InductiveConstructor Operator">⟦</a> <a id="4026" href="Ledger.Epoch.html#4026" class="Bound">treasury</a> <a id="4035" href="Ledger.PParams.html#708" class="InductiveConstructor Operator">,</a> <a id="4037" href="Ledger.Epoch.html#4037" class="Bound">reserves</a> <a id="4046" href="Ledger.PParams.html#708" class="InductiveConstructor Operator">⟧ᵃ</a>
  <a id="4051" href="Ledger.Epoch.html#1139" class="InductiveConstructor Operator">,</a> <a id="4053" href="Ledger.Epoch.html#4053" class="Bound">ss</a>
  <a id="4058" href="Ledger.Epoch.html#1139" class="InductiveConstructor Operator">,</a> <a id="4060" href="Ledger.Ledger.html#845" class="InductiveConstructor Operator">⟦</a> <a id="4062" href="Ledger.Utxo.html#2744" class="InductiveConstructor Operator">⟦</a> <a id="4064" href="Ledger.Epoch.html#4064" class="Bound">utxo</a> <a id="4069" href="Ledger.Utxo.html#2744" class="InductiveConstructor Operator">,</a> <a id="4071" href="Ledger.Epoch.html#4071" class="Bound">fees</a> <a id="4076" href="Ledger.Utxo.html#2744" class="InductiveConstructor Operator">,</a> <a id="4078" href="Ledger.Epoch.html#4078" class="Bound">deposits</a> <a id="4087" href="Ledger.Utxo.html#2744" class="InductiveConstructor Operator">,</a> <a id="4089" href="Ledger.Epoch.html#4089" class="Bound">donations</a> <a id="4099" href="Ledger.Utxo.html#2744" class="InductiveConstructor Operator">⟧ᵘ</a>
    <a id="4106" href="Ledger.Ledger.html#845" class="InductiveConstructor Operator">,</a> <a id="4108" href="Ledger.Epoch.html#4108" class="Bound">govSt</a>
    <a id="4118" href="Ledger.Ledger.html#845" class="InductiveConstructor Operator">,</a> <a id="4120" href="Ledger.Certs.html#4366" class="InductiveConstructor Operator">⟦</a> <a id="4122" href="Ledger.Certs.html#3207" class="InductiveConstructor Operator">⟦</a> <a id="4124" href="Ledger.Epoch.html#4124" class="Bound">voteDelegs</a> <a id="4135" href="Ledger.Certs.html#3207" class="InductiveConstructor Operator">,</a> <a id="4137" href="Ledger.Epoch.html#4137" class="Bound">stakeDelegs</a> <a id="4149" href="Ledger.Certs.html#3207" class="InductiveConstructor Operator">,</a> <a id="4151" href="Ledger.Epoch.html#4151" class="Bound">rewards</a> <a id="4159" href="Ledger.Certs.html#3207" class="InductiveConstructor Operator">⟧ᵈ</a> <a id="4162" href="Ledger.Certs.html#4366" class="InductiveConstructor Operator">,</a> <a id="4164" href="Ledger.Epoch.html#4164" class="Bound">pState</a> <a id="4171" href="Ledger.Certs.html#4366" class="InductiveConstructor Operator">,</a> <a id="4173" href="Ledger.Epoch.html#4173" class="Bound">gState</a> <a id="4180" href="Ledger.Certs.html#4366" class="InductiveConstructor Operator">⟧ᶜˢ</a> <a id="4184" href="Ledger.Ledger.html#845" class="InductiveConstructor Operator">⟧ˡ</a>
  <a id="4189" href="Ledger.Epoch.html#1139" class="InductiveConstructor Operator">,</a> <a id="4191" href="Ledger.Epoch.html#4191" class="Bound">es</a>
  <a id="4196" href="Ledger.Epoch.html#1139" class="InductiveConstructor Operator">,</a> <a id="4198" href="Ledger.Epoch.html#4198" class="Bound">fut</a>
  <a id="4204" href="Ledger.Epoch.html#1139" class="InductiveConstructor Operator">⟧ᵉ&#39;</a> <a id="4208" class="Symbol">=</a>
  <a id="4212" href="Ledger.Prelude.html#2291" class="Function Operator">⟦</a> <a id="4214" href="Ledger.Prelude.html#2291" class="Function Operator">⟦</a> <a id="4216" href="Prelude.html#3167" class="Function">posPart</a> <a id="4224" class="Symbol">(</a><a id="4225" href="Ledger.Epoch.html#548" class="InductiveConstructor">pos</a> <a id="4229" href="Ledger.Epoch.html#4026" class="Bound">treasury</a> <a id="4238" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="4240" href="Ledger.Epoch.html#3998" class="Bound">Δt</a> <a id="4243" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="4245" href="Ledger.Epoch.html#548" class="InductiveConstructor">pos</a> <a id="4249" href="Ledger.Epoch.html#4553" class="Function">unregRU&#39;</a><a id="4257" class="Symbol">)</a>
    <a id="4263" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="4265" href="Prelude.html#3167" class="Function">posPart</a> <a id="4273" class="Symbol">(</a><a id="4274" href="Ledger.Epoch.html#548" class="InductiveConstructor">pos</a> <a id="4278" href="Ledger.Epoch.html#4037" class="Bound">reserves</a> <a id="4287" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="4289" href="Ledger.Epoch.html#4003" class="Bound">Δr</a><a id="4291" class="Symbol">)</a> <a id="4293" href="Ledger.Prelude.html#2291" class="Function Operator">⟧</a>
  <a id="4297" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="4299" href="Ledger.Epoch.html#4053" class="Bound">ss</a>
  <a id="4304" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="4306" href="Ledger.Prelude.html#2291" class="Function Operator">⟦</a> <a id="4308" href="Ledger.Prelude.html#2291" class="Function Operator">⟦</a> <a id="4310" href="Ledger.Epoch.html#4064" class="Bound">utxo</a> <a id="4315" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="4317" href="Prelude.html#3167" class="Function">posPart</a> <a id="4325" class="Symbol">(</a><a id="4326" href="Ledger.Epoch.html#548" class="InductiveConstructor">pos</a> <a id="4330" href="Ledger.Epoch.html#4071" class="Bound">fees</a> <a id="4335" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="4337" href="Ledger.Epoch.html#4008" class="Bound">Δf</a><a id="4339" class="Symbol">)</a> <a id="4341" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="4343" href="Ledger.Epoch.html#4078" class="Bound">deposits</a> <a id="4352" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="4354" href="Ledger.Epoch.html#4089" class="Bound">donations</a> <a id="4364" href="Ledger.Prelude.html#2291" class="Function Operator">⟧</a>
    <a id="4370" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="4372" href="Ledger.Epoch.html#4108" class="Bound">govSt</a>
    <a id="4382" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="4384" href="Ledger.Prelude.html#2291" class="Function Operator">⟦</a> <a id="4386" href="Ledger.Prelude.html#2291" class="Function Operator">⟦</a> <a id="4388" href="Ledger.Epoch.html#4124" class="Bound">voteDelegs</a> <a id="4399" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="4401" href="Ledger.Epoch.html#4137" class="Bound">stakeDelegs</a> <a id="4413" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="4415" href="Ledger.Epoch.html#4151" class="Bound">rewards</a> <a id="4423" href="Axiom.Set.Map.Dec.html#1854" class="Function Operator">∪⁺</a> <a id="4426" href="Ledger.Epoch.html#4485" class="Function">regRU</a> <a id="4432" href="Ledger.Prelude.html#2291" class="Function Operator">⟧</a> <a id="4434" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="4436" href="Ledger.Epoch.html#4164" class="Bound">pState</a> <a id="4443" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="4445" href="Ledger.Epoch.html#4173" class="Bound">gState</a> <a id="4452" href="Ledger.Prelude.html#2291" class="Function Operator">⟧</a> <a id="4454" href="Ledger.Prelude.html#2291" class="Function Operator">⟧</a>
  <a id="4458" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="4460" href="Ledger.Epoch.html#4191" class="Bound">es</a>
  <a id="4465" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="4467" href="Ledger.Epoch.html#4198" class="Bound">fut</a> <a id="4471" href="Ledger.Prelude.html#2291" class="Function Operator">⟧</a>
  <a id="4475" class="Keyword">where</a>
    <a id="4485" href="Ledger.Epoch.html#4485" class="Function">regRU</a>     <a id="4495" class="Symbol">=</a> <a id="4497" href="Ledger.Epoch.html#4013" class="Bound">rs</a> <a id="4500" href="Axiom.Set.Map.html#10678" class="Function Operator">∣</a> <a id="4502" href="Class.IsSet.html#916" class="Function">dom</a> <a id="4506" href="Ledger.Epoch.html#4151" class="Bound">rewards</a>
    <a id="4518" href="Ledger.Epoch.html#4518" class="Function">unregRU</a>   <a id="4528" class="Symbol">=</a> <a id="4530" href="Ledger.Epoch.html#4013" class="Bound">rs</a> <a id="4533" href="Axiom.Set.Map.html#10748" class="Function Operator">∣</a> <a id="4535" href="Class.IsSet.html#916" class="Function">dom</a> <a id="4539" href="Ledger.Epoch.html#4151" class="Bound">rewards</a> <a id="4547" href="Axiom.Set.Map.html#10748" class="Function Operator">ᶜ</a>
    <a id="4553" href="Ledger.Epoch.html#4553" class="Function">unregRU&#39;</a>  <a id="4563" class="Symbol">=</a> <a id="4565" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">∑[</a> <a id="4568" href="Ledger.Epoch.html#4568" class="Bound">x</a> <a id="4570" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">←</a> <a id="4572" href="Ledger.Epoch.html#4518" class="Function">unregRU</a> <a id="4580" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">]</a> <a id="4582" href="Ledger.Epoch.html#4568" class="Bound">x</a>

<a id="getOrphans"></a><a id="4585" href="Ledger.Epoch.html#4585" class="Function">getOrphans</a> <a id="4596" class="Symbol">:</a> <a id="4598" href="Ledger.Enact.html#397" class="Record">EnactState</a> <a id="4609" class="Symbol">→</a> <a id="4611" href="Ledger.Gov.html#1334" class="Function">GovState</a> <a id="4620" class="Symbol">→</a> <a id="4622" href="Ledger.Gov.html#1334" class="Function">GovState</a>
<a id="4631" href="Ledger.Epoch.html#4585" class="Function">getOrphans</a> <a id="4642" href="Ledger.Epoch.html#4642" class="Bound">es</a> <a id="4645" href="Ledger.Epoch.html#4645" class="Bound">govSt</a> <a id="4651" class="Symbol">=</a> <a id="4653" href="Data.Product.Base.html#636" class="Field">proj₁</a> <a id="4659" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="4661" href="Data.Nat.GeneralisedArithmetic.html#866" class="Function">iterate</a> <a id="4669" href="Ledger.Epoch.html#4714" class="Function">step</a> <a id="4674" class="Symbol">(</a><a id="4675" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a> <a id="4678" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="4680" href="Ledger.Epoch.html#4645" class="Bound">govSt</a><a id="4685" class="Symbol">)</a> <a id="4687" class="Symbol">(</a><a id="4688" href="Data.List.Base.html#5044" class="Function">length</a> <a id="4695" href="Ledger.Epoch.html#4645" class="Bound">govSt</a><a id="4700" class="Symbol">)</a>
  <a id="4704" class="Keyword">where</a>
    <a id="4714" href="Ledger.Epoch.html#4714" class="Function">step</a> <a id="4719" class="Symbol">:</a> <a id="4721" href="Ledger.Gov.html#1334" class="Function">GovState</a> <a id="4730" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="4732" href="Ledger.Gov.html#1334" class="Function">GovState</a> <a id="4741" class="Symbol">→</a> <a id="4743" href="Ledger.Gov.html#1334" class="Function">GovState</a> <a id="4752" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="4754" href="Ledger.Gov.html#1334" class="Function">GovState</a>
    <a id="4767" href="Ledger.Epoch.html#4714" class="Function">step</a> <a id="4772" class="Symbol">(</a><a id="4773" href="Ledger.Epoch.html#4773" class="Bound">orps</a> <a id="4778" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="4780" href="Ledger.Epoch.html#4780" class="Bound">govSt</a><a id="4785" class="Symbol">)</a> <a id="4787" class="Symbol">=</a>
      <a id="4795" class="Keyword">let</a>
        <a id="4807" href="Ledger.Epoch.html#4807" class="Bound">isOrphan?</a> <a id="4817" href="Ledger.Epoch.html#4817" class="Bound">a</a> <a id="4819" href="Ledger.Epoch.html#4819" class="Bound">prev</a> <a id="4824" class="Symbol">=</a> <a id="4826" href="Relation.Nullary.Decidable.Core.html#3011" class="Function">¬?</a> <a id="4829" class="Symbol">(</a><a id="4830" href="Ledger.Gov.html#8661" class="Function">hasParent?</a> <a id="4841" href="Ledger.Epoch.html#4642" class="Bound">es</a> <a id="4844" href="Ledger.Epoch.html#4780" class="Bound">govSt</a> <a id="4850" href="Ledger.Epoch.html#4817" class="Bound">a</a> <a id="4852" href="Ledger.Epoch.html#4819" class="Bound">prev</a><a id="4856" class="Symbol">)</a>
        <a id="4866" class="Symbol">(</a><a id="4867" href="Ledger.Epoch.html#4867" class="Bound">orps&#39;</a> <a id="4873" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="4875" href="Ledger.Epoch.html#4875" class="Bound">govSt&#39;</a><a id="4881" class="Symbol">)</a> <a id="4883" class="Symbol">=</a> <a id="4885" href="Data.List.Base.html#10926" class="Function">partition</a>
          <a id="4905" class="Symbol">(λ</a> <a id="4908" class="Symbol">(_</a> <a id="4911" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="4913" class="Keyword">record</a> <a id="4920" class="Symbol">{</a><a id="4921" href="Ledger.GovernanceActions.html#2715" class="Field">action</a> <a id="4928" class="Symbol">=</a> <a id="4930" href="Ledger.Epoch.html#4930" class="Bound">a</a> <a id="4932" class="Symbol">;</a> <a id="4934" href="Ledger.GovernanceActions.html#2743" class="Field">prevAction</a> <a id="4945" class="Symbol">=</a> <a id="4947" href="Ledger.Epoch.html#4947" class="Bound">prev</a><a id="4951" class="Symbol">})</a> <a id="4954" class="Symbol">→</a> <a id="4956" href="Ledger.Epoch.html#4807" class="Bound">isOrphan?</a> <a id="4966" class="Symbol">(</a><a id="4967" href="Ledger.Epoch.html#4930" class="Bound">a</a> <a id="4969" class="Symbol">.</a><a id="4970" href="Ledger.GovernanceActions.html#1429" class="Field">gaType</a><a id="4976" class="Symbol">)</a> <a id="4978" href="Ledger.Epoch.html#4947" class="Bound">prev</a><a id="4982" class="Symbol">)</a> <a id="4984" href="Ledger.Epoch.html#4780" class="Bound">govSt</a>
      <a id="4996" class="Keyword">in</a>
        <a id="5007" class="Symbol">(</a><a id="5008" href="Ledger.Epoch.html#4773" class="Bound">orps</a> <a id="5013" href="Data.List.Base.html#1734" class="Function Operator">++</a> <a id="5016" href="Ledger.Epoch.html#4867" class="Bound">orps&#39;</a> <a id="5022" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5024" href="Ledger.Epoch.html#4875" class="Bound">govSt&#39;</a><a id="5030" class="Symbol">)</a>


<a id="stakeDistr"></a><a id="5034" href="Ledger.Epoch.html#5034" class="Function">stakeDistr</a> <a id="5045" class="Symbol">:</a> <a id="5047" href="Ledger.Transaction.html#2388" class="Function">UTxO</a> <a id="5052" class="Symbol">→</a> <a id="5054" href="Ledger.Certs.html#3171" class="Record">DState</a> <a id="5061" class="Symbol">→</a> <a id="5063" href="Ledger.Certs.html#3781" class="Record">PState</a> <a id="5070" class="Symbol">→</a> <a id="5072" href="Ledger.Epoch.html#849" class="Record">Snapshot</a>
<a id="5081" href="Ledger.Epoch.html#5034" class="Function">stakeDistr</a> <a id="5092" href="Ledger.Epoch.html#5092" class="Bound">utxo</a> <a id="5097" href="Ledger.Epoch.html#5097" class="Bound">stᵈ</a> <a id="5101" href="Ledger.Epoch.html#5101" class="Bound">pState</a> <a id="5108" class="Symbol">=</a> <a id="5110" href="Ledger.Prelude.html#2291" class="Function Operator">⟦</a> <a id="5112" href="Axiom.Set.Map.Dec.html#1932" class="Function">aggregate₊</a> <a id="5123" class="Symbol">(</a><a id="5124" href="Ledger.Epoch.html#5310" class="Function">stakeRelation</a> <a id="5138" href="abstract-set-theory.FiniteSetTheory.html#2767" class="Function Operator">ᶠˢ</a><a id="5140" class="Symbol">)</a> <a id="5142" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5144" href="Ledger.Certs.html#3269" class="Function">stakeDelegs</a> <a id="5156" href="Ledger.Prelude.html#2291" class="Function Operator">⟧</a>
  <a id="5160" class="Keyword">where</a>
    <a id="5170" class="Keyword">open</a> <a id="5175" href="Ledger.Certs.html#3171" class="Module">DState</a> <a id="5182" href="Ledger.Epoch.html#5097" class="Bound">stᵈ</a> <a id="5186" class="Keyword">using</a> <a id="5192" class="Symbol">(</a><a id="5193" href="Ledger.Certs.html#3269" class="Field">stakeDelegs</a><a id="5204" class="Symbol">;</a> <a id="5206" href="Ledger.Certs.html#3309" class="Field">rewards</a><a id="5213" class="Symbol">)</a>
    <a id="5219" href="Ledger.Epoch.html#5219" class="Function">m</a> <a id="5221" class="Symbol">=</a> <a id="5223" href="abstract-set-theory.FiniteSetTheory.html#519" class="Function">mapˢ</a> <a id="5228" class="Symbol">(λ</a> <a id="5231" href="Ledger.Epoch.html#5231" class="Bound">a</a> <a id="5233" class="Symbol">→</a> <a id="5235" class="Symbol">(</a><a id="5236" href="Ledger.Epoch.html#5231" class="Bound">a</a> <a id="5238" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5240" href="Ledger.Utxo.html#3643" class="Function">cbalance</a> <a id="5249" class="Symbol">(</a><a id="5250" href="Ledger.Epoch.html#5092" class="Bound">utxo</a> <a id="5255" href="abstract-set-theory.FiniteSetTheory.html#3088" class="Function Operator">∣^&#39;</a> <a id="5259" class="Symbol">λ</a> <a id="5261" href="Ledger.Epoch.html#5261" class="Bound">i</a> <a id="5263" class="Symbol">→</a> <a id="5265" href="Ledger.Epoch.html#3783" class="Function">getStakeCred</a> <a id="5278" href="Ledger.Epoch.html#5261" class="Bound">i</a> <a id="5280" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="5282" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="5287" href="Ledger.Epoch.html#5231" class="Bound">a</a><a id="5288" class="Symbol">)))</a> <a id="5292" class="Symbol">(</a><a id="5293" href="Class.IsSet.html#916" class="Function">dom</a> <a id="5297" href="Ledger.Certs.html#3309" class="Function">rewards</a><a id="5304" class="Symbol">)</a>
    <a id="5310" href="Ledger.Epoch.html#5310" class="Function">stakeRelation</a> <a id="5324" class="Symbol">=</a> <a id="5326" href="Ledger.Epoch.html#5219" class="Function">m</a> <a id="5328" href="Axiom.Set.html#8952" class="Function Operator">∪</a> <a id="5330" href="Ledger.Prelude.html#2393" class="Function Operator">∣</a> <a id="5332" href="Ledger.Certs.html#3309" class="Function">rewards</a> <a id="5340" href="Ledger.Prelude.html#2393" class="Function Operator">∣</a>

<a id="gaDepositStake"></a><a id="5343" href="Ledger.Epoch.html#5343" class="Function">gaDepositStake</a> <a id="5358" class="Symbol">:</a> <a id="5360" href="Ledger.Gov.html#1334" class="Function">GovState</a> <a id="5369" class="Symbol">→</a> <a id="5371" href="Ledger.Certs.html#573" class="Function">Deposits</a> <a id="5380" class="Symbol">→</a> <a id="5382" href="Ledger.Address.html#273" class="Datatype">Credential</a> <a id="5393" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="5395" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a>
<a id="5400" href="Ledger.Epoch.html#5343" class="Function">gaDepositStake</a> <a id="5415" href="Ledger.Epoch.html#5415" class="Bound">govSt</a> <a id="5421" href="Ledger.Epoch.html#5421" class="Bound">ds</a> <a id="5424" class="Symbol">=</a> <a id="5426" href="abstract-set-theory.FiniteSetTheory.html#3599" class="Function">aggregateBy</a>
  <a id="5440" class="Symbol">(</a><a id="5441" href="abstract-set-theory.FiniteSetTheory.html#519" class="Function">mapˢ</a> <a id="5446" class="Symbol">(λ</a> <a id="5449" class="Symbol">(</a><a id="5450" href="Ledger.Epoch.html#5450" class="Bound">gaid</a> <a id="5455" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5457" href="Ledger.Epoch.html#5457" class="Bound">addr</a><a id="5461" class="Symbol">)</a> <a id="5463" class="Symbol">→</a> <a id="5465" class="Symbol">(</a><a id="5466" href="Ledger.Epoch.html#5450" class="Bound">gaid</a> <a id="5471" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5473" href="Ledger.Epoch.html#5457" class="Bound">addr</a><a id="5477" class="Symbol">)</a> <a id="5479" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5481" href="Ledger.Address.html#1391" class="Field">stake</a> <a id="5487" href="Ledger.Epoch.html#5457" class="Bound">addr</a><a id="5491" class="Symbol">)</a> <a id="5493" href="Ledger.Epoch.html#5591" class="Function">govSt&#39;</a><a id="5499" class="Symbol">)</a>
  <a id="5503" class="Symbol">(</a><a id="5504" href="Axiom.Set.Map.html#10460" class="Function">mapFromPartialFun</a> <a id="5522" class="Symbol">(λ</a> <a id="5525" class="Symbol">(</a><a id="5526" href="Ledger.Epoch.html#5526" class="Bound">gaid</a> <a id="5531" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5533" class="Symbol">_)</a> <a id="5536" class="Symbol">→</a> <a id="5538" href="Axiom.Set.Map.html#13670" class="Function">lookupᵐ?</a> <a id="5547" href="Ledger.Epoch.html#5421" class="Bound">ds</a> <a id="5550" class="Symbol">(</a><a id="5551" href="Ledger.Certs.html#521" class="InductiveConstructor">GovActionDeposit</a> <a id="5568" href="Ledger.Epoch.html#5526" class="Bound">gaid</a><a id="5572" class="Symbol">))</a> <a id="5575" href="Ledger.Epoch.html#5591" class="Function">govSt&#39;</a><a id="5581" class="Symbol">)</a>
  <a id="5585" class="Keyword">where</a> <a id="5591" href="Ledger.Epoch.html#5591" class="Function">govSt&#39;</a> <a id="5598" class="Symbol">=</a> <a id="5600" href="abstract-set-theory.FiniteSetTheory.html#519" class="Function">mapˢ</a> <a id="5605" class="Symbol">(</a><a id="5606" href="Class.Bifunctor.html#1152" class="Function">map₂</a> <a id="5611" href="Ledger.GovernanceActions.html#2665" class="Field">returnAddr</a><a id="5621" class="Symbol">)</a> <a id="5623" class="Symbol">(</a><a id="5624" href="Axiom.Set.html#5718" class="Function">fromList</a> <a id="5633" href="Ledger.Epoch.html#5415" class="Bound">govSt</a><a id="5638" class="Symbol">)</a>



<a id="5643" class="Keyword">opaque</a>


  <a id="mkStakeDistrs"></a><a id="5654" href="Ledger.Epoch.html#5654" class="Function">mkStakeDistrs</a> <a id="5668" class="Symbol">:</a> <a id="5670" href="Ledger.Epoch.html#849" class="Record">Snapshot</a> <a id="5679" class="Symbol">→</a> <a id="5681" href="Ledger.Gov.html#1334" class="Function">GovState</a> <a id="5690" class="Symbol">→</a> <a id="5692" href="Ledger.Certs.html#573" class="Function">Deposits</a> <a id="5701" class="Symbol">→</a> <a id="5703" class="Symbol">(</a><a id="5704" href="Ledger.Address.html#273" class="Datatype">Credential</a> <a id="5715" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="5717" href="Ledger.GovernanceActions.html#458" class="Datatype">VDeleg</a><a id="5723" class="Symbol">)</a> <a id="5725" class="Symbol">→</a> <a id="5727" href="Ledger.Ratify.html#2859" class="Record">StakeDistrs</a>
  <a id="5741" href="Ledger.Epoch.html#5654" class="Function">mkStakeDistrs</a> <a id="5755" href="Ledger.Epoch.html#5755" class="Bound">ss</a> <a id="5758" href="Ledger.Epoch.html#5758" class="Bound">govSt</a> <a id="5764" href="Ledger.Epoch.html#5764" class="Bound">ds</a> <a id="5767" href="Ledger.Epoch.html#5767" class="Bound">delegations</a> <a id="5779" class="Symbol">.</a><a id="5780" href="Ledger.Ratify.html#2896" class="Field">StakeDistrs.stakeDistr</a> <a id="5803" class="Symbol">=</a>
    <a id="5809" href="abstract-set-theory.FiniteSetTheory.html#3599" class="Function">aggregateBy</a> <a id="5821" href="Ledger.Prelude.html#2393" class="Function Operator">∣</a> <a id="5823" href="Ledger.Epoch.html#5767" class="Bound">delegations</a> <a id="5835" href="Ledger.Prelude.html#2393" class="Function Operator">∣</a> <a id="5837" class="Symbol">(</a><a id="5838" href="Ledger.Epoch.html#882" class="Field">Snapshot.stake</a> <a id="5853" href="Ledger.Epoch.html#5755" class="Bound">ss</a> <a id="5856" href="Axiom.Set.Map.Dec.html#1854" class="Function Operator">∪⁺</a> <a id="5859" href="Ledger.Epoch.html#5343" class="Function">gaDepositStake</a> <a id="5874" href="Ledger.Epoch.html#5758" class="Bound">govSt</a> <a id="5880" href="Ledger.Epoch.html#5764" class="Bound">ds</a><a id="5882" class="Symbol">)</a>


<a id="5886" class="Keyword">private</a> <a id="5894" class="Keyword">variable</a>
  <a id="5905" href="Ledger.Epoch.html#5905" class="Generalizable">nes</a> <a id="5909" href="Ledger.Epoch.html#5909" class="Generalizable">nes&#39;</a> <a id="5914" class="Symbol">:</a> <a id="5916" href="Ledger.Epoch.html#1879" class="Record">NewEpochState</a>
  <a id="5932" href="Ledger.Epoch.html#5932" class="Generalizable">e</a> <a id="5934" href="Ledger.Epoch.html#5934" class="Generalizable">lastEpoch</a> <a id="5944" class="Symbol">:</a> <a id="5946" href="Ledger.Types.Epoch.html#476" class="Function">Epoch</a>
  <a id="5954" href="Ledger.Epoch.html#5954" class="Generalizable">fut</a> <a id="5958" href="Ledger.Epoch.html#5958" class="Generalizable">fut&#39;</a> <a id="5963" class="Symbol">:</a> <a id="5965" href="Ledger.Ratify.html#3224" class="Record">RatifyState</a>
  <a id="5979" href="Ledger.Epoch.html#5979" class="Generalizable">eps</a> <a id="5983" href="Ledger.Epoch.html#5983" class="Generalizable">eps&#39;</a> <a id="5988" href="Ledger.Epoch.html#5988" class="Generalizable">eps&#39;&#39;</a> <a id="5994" class="Symbol">:</a> <a id="5996" href="Ledger.Epoch.html#1099" class="Record">EpochState</a>
  <a id="6009" href="Ledger.Epoch.html#6009" class="Generalizable">ls</a> <a id="6012" class="Symbol">:</a> <a id="6014" href="Ledger.Ledger.html#809" class="Record">LState</a>
  <a id="6023" href="Ledger.Epoch.html#6023" class="Generalizable">acnt</a> <a id="6028" class="Symbol">:</a> <a id="6030" href="Ledger.PParams.html#674" class="Record">Acnt</a>
  <a id="6037" href="Ledger.Epoch.html#6037" class="Generalizable">es₀</a> <a id="6041" class="Symbol">:</a> <a id="6043" href="Ledger.Enact.html#397" class="Record">EnactState</a>
  <a id="6056" href="Ledger.Epoch.html#6056" class="Generalizable">mark</a> <a id="6061" href="Ledger.Epoch.html#6061" class="Generalizable">set</a> <a id="6065" href="Ledger.Epoch.html#6065" class="Generalizable">go</a> <a id="6068" class="Symbol">:</a> <a id="6070" href="Ledger.Epoch.html#849" class="Record">Snapshot</a>
  <a id="6081" href="Ledger.Epoch.html#6081" class="Generalizable">feeSS</a> <a id="6087" class="Symbol">:</a> <a id="6089" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a>
  <a id="6096" href="Ledger.Epoch.html#6096" class="Generalizable">lstate</a> <a id="6103" class="Symbol">:</a> <a id="6105" href="Ledger.Ledger.html#809" class="Record">LState</a>
  <a id="6114" href="Ledger.Epoch.html#6114" class="Generalizable">ss</a> <a id="6117" href="Ledger.Epoch.html#6117" class="Generalizable">ss&#39;</a> <a id="6121" class="Symbol">:</a> <a id="6123" href="Ledger.Epoch.html#1007" class="Record">Snapshots</a>
  <a id="6135" href="Ledger.Epoch.html#6135" class="Generalizable">ru</a> <a id="6138" class="Symbol">:</a> <a id="6140" href="Ledger.Epoch.html#733" class="Record">RewardUpdate</a>
  <a id="6155" href="Ledger.Epoch.html#6155" class="Generalizable">mru</a> <a id="6159" class="Symbol">:</a> <a id="6161" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="6167" href="Ledger.Epoch.html#733" class="Record">RewardUpdate</a>


<a id="6182" class="Keyword">data</a> <a id="_⊢_⇀⦇_,SNAP⦈_"></a><a id="6187" href="Ledger.Epoch.html#6187" class="Datatype Operator">_⊢_⇀⦇_,SNAP⦈_</a> <a id="6201" class="Symbol">:</a> <a id="6203" href="Ledger.Ledger.html#809" class="Record">LState</a> <a id="6210" class="Symbol">→</a> <a id="6212" href="Ledger.Epoch.html#1007" class="Record">Snapshots</a> <a id="6222" class="Symbol">→</a> <a id="6224" href="Agda.Builtin.Unit.html#175" class="Record">⊤</a> <a id="6226" class="Symbol">→</a> <a id="6228" href="Ledger.Epoch.html#1007" class="Record">Snapshots</a> <a id="6238" class="Symbol">→</a> <a id="6240" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="6245" class="Keyword">where</a>
  <a id="_⊢_⇀⦇_,SNAP⦈_.SNAP"></a><a id="6253" href="Ledger.Epoch.html#6253" class="InductiveConstructor">SNAP</a> <a id="6258" class="Symbol">:</a> <a id="6260" class="Keyword">let</a> <a id="6264" class="Keyword">open</a> <a id="6269" href="Ledger.Ledger.html#809" class="Module">LState</a> <a id="6276" href="Ledger.Epoch.html#6096" class="Generalizable">lstate</a><a id="6282" class="Symbol">;</a> <a id="6284" class="Keyword">open</a> <a id="6289" href="Ledger.Utxo.html#2705" class="Module">UTxOState</a> <a id="6299" href="Ledger.Ledger.html#868" class="Function">utxoSt</a><a id="6305" class="Symbol">;</a> <a id="6307" class="Keyword">open</a> <a id="6312" href="Ledger.Certs.html#4327" class="Module">CertState</a> <a id="6322" href="Ledger.Ledger.html#921" class="Function">certState</a>
             <a id="6345" href="Ledger.Epoch.html#6345" class="Bound">stake</a> <a id="6351" class="Symbol">=</a> <a id="6353" href="Ledger.Epoch.html#5034" class="Function">stakeDistr</a> <a id="6364" href="Ledger.Utxo.html#2769" class="Function">utxo</a> <a id="6369" href="Ledger.Certs.html#4390" class="Function">dState</a> <a id="6376" href="Ledger.Certs.html#4410" class="Function">pState</a>
    <a id="6387" class="Keyword">in</a>
    <a id="6394" href="Ledger.Epoch.html#6096" class="Generalizable">lstate</a> <a id="6401" href="Ledger.Epoch.html#6187" class="Datatype Operator">⊢</a> <a id="6403" href="Ledger.Prelude.html#2291" class="Function Operator">⟦</a> <a id="6405" href="Ledger.Epoch.html#6056" class="Generalizable">mark</a> <a id="6410" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="6412" href="Ledger.Epoch.html#6061" class="Generalizable">set</a> <a id="6416" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="6418" href="Ledger.Epoch.html#6065" class="Generalizable">go</a> <a id="6421" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="6423" href="Ledger.Epoch.html#6081" class="Generalizable">feeSS</a> <a id="6429" href="Ledger.Prelude.html#2291" class="Function Operator">⟧</a> <a id="6431" href="Ledger.Epoch.html#6187" class="Datatype Operator">⇀⦇</a> <a id="6434" href="Agda.Builtin.Unit.html#212" class="InductiveConstructor">tt</a> <a id="6437" href="Ledger.Epoch.html#6187" class="Datatype Operator">,SNAP⦈</a> <a id="6444" href="Ledger.Prelude.html#2291" class="Function Operator">⟦</a> <a id="6446" href="Ledger.Epoch.html#6345" class="Bound">stake</a> <a id="6452" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="6454" href="Ledger.Epoch.html#6056" class="Generalizable">mark</a> <a id="6459" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="6461" href="Ledger.Epoch.html#6061" class="Generalizable">set</a> <a id="6465" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="6467" href="Ledger.Utxo.html#2791" class="Function">fees</a> <a id="6472" href="Ledger.Prelude.html#2291" class="Function Operator">⟧</a>

<a id="6475" class="Keyword">data</a> <a id="_⊢_⇀⦇_,EPOCH⦈_"></a><a id="6480" href="Ledger.Epoch.html#6480" class="Datatype Operator">_⊢_⇀⦇_,EPOCH⦈_</a> <a id="6495" class="Symbol">:</a> <a id="6497" href="Agda.Builtin.Unit.html#175" class="Record">⊤</a> <a id="6499" class="Symbol">→</a> <a id="6501" href="Ledger.Epoch.html#1099" class="Record">EpochState</a> <a id="6512" class="Symbol">→</a> <a id="6514" href="Ledger.Types.Epoch.html#476" class="Function">Epoch</a> <a id="6520" class="Symbol">→</a> <a id="6522" href="Ledger.Epoch.html#1099" class="Record">EpochState</a> <a id="6533" class="Symbol">→</a> <a id="6535" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="6540" class="Keyword">where</a>


  <a id="_⊢_⇀⦇_,EPOCH⦈_.EPOCH"></a><a id="6550" href="Ledger.Epoch.html#6550" class="InductiveConstructor">EPOCH</a> <a id="6556" class="Symbol">:</a> <a id="6558" class="Keyword">let</a>


      <a id="6570" class="Keyword">open</a> <a id="6575" href="Ledger.Ledger.html#809" class="Module">LState</a> <a id="6582" href="Ledger.Epoch.html#6009" class="Generalizable">ls</a>
      <a id="6591" class="Keyword">open</a> <a id="6596" href="Ledger.Certs.html#4327" class="Module">CertState</a> <a id="6606" href="Ledger.Ledger.html#921" class="Function">certState</a>
      <a id="6622" class="Keyword">open</a> <a id="6627" href="Ledger.Ratify.html#3224" class="Module">RatifyState</a> <a id="6639" href="Ledger.Epoch.html#5954" class="Generalizable">fut</a> <a id="6643" class="Keyword">renaming</a> <a id="6652" class="Symbol">(</a><a id="6653" href="Ledger.Ratify.html#3261" class="Field">es</a> <a id="6656" class="Symbol">to</a> <a id="6659" class="Field">esW</a><a id="6662" class="Symbol">)</a>
      <a id="6670" class="Keyword">open</a> <a id="6675" href="Ledger.Utxo.html#2705" class="Module">UTxOState</a>
      <a id="6691" class="Keyword">open</a> <a id="6696" href="Ledger.Certs.html#3781" class="Module">PState</a><a id="6702" class="Symbol">;</a> <a id="6704" class="Keyword">open</a> <a id="6709" href="Ledger.Certs.html#3171" class="Module">DState</a><a id="6715" class="Symbol">;</a> <a id="6717" class="Keyword">open</a> <a id="6722" href="Ledger.Certs.html#3997" class="Module">GState</a>
      <a id="6735" class="Keyword">open</a> <a id="6740" href="Ledger.PParams.html#674" class="Module">Acnt</a><a id="6744" class="Symbol">;</a> <a id="6746" class="Keyword">open</a> <a id="6751" href="Ledger.Enact.html#397" class="Module">EnactState</a><a id="6761" class="Symbol">;</a> <a id="6763" class="Keyword">open</a> <a id="6768" href="Ledger.GovernanceActions.html#2594" class="Module">GovActionState</a>



      <a id="6792" href="Ledger.Epoch.html#6792" class="Bound">es</a>                <a id="6810" class="Symbol">=</a> <a id="6812" class="Keyword">record</a> <a id="6819" href="Ledger.Epoch.html#6659" class="Function">esW</a> <a id="6823" class="Symbol">{</a> <a id="6825" href="Ledger.Enact.html#649" class="Field">withdrawals</a> <a id="6837" class="Symbol">=</a> <a id="6839" href="Class.HasEmptySet.html#287" class="Field">∅</a> <a id="6841" class="Symbol">}</a>
      <a id="6849" href="Ledger.Epoch.html#6849" class="Bound">tmpGovSt</a>          <a id="6867" class="Symbol">=</a> <a id="6869" href="Data.List.Base.html#10687" class="Function">filter</a> <a id="6876" class="Symbol">(λ</a> <a id="6879" href="Ledger.Epoch.html#6879" class="Bound">x</a> <a id="6881" class="Symbol">→</a> <a id="6883" href="Class.Decidable.Core.html#461" class="Function Operator">¿</a> <a id="6885" href="Data.Product.Base.html#636" class="Field">proj₁</a> <a id="6891" href="Ledger.Epoch.html#6879" class="Bound">x</a> <a id="6893" href="Class.IsSet.html#462" class="Function Operator">∉</a> <a id="6895" href="abstract-set-theory.FiniteSetTheory.html#519" class="Function">mapˢ</a> <a id="6900" href="Data.Product.Base.html#636" class="Field">proj₁</a> <a id="6906" href="Ledger.Ratify.html#3294" class="Function">removed</a> <a id="6914" href="Class.Decidable.Core.html#461" class="Function Operator">¿</a><a id="6915" class="Symbol">)</a> <a id="6917" href="Ledger.Ledger.html#895" class="Function">govSt</a>
      <a id="6929" href="Ledger.Epoch.html#6929" class="Bound">orphans</a>           <a id="6947" class="Symbol">=</a> <a id="6949" href="Axiom.Set.html#5718" class="Function">fromList</a> <a id="6958" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="6960" href="Ledger.Epoch.html#4585" class="Function">getOrphans</a> <a id="6971" href="Ledger.Epoch.html#6792" class="Bound">es</a> <a id="6974" href="Ledger.Epoch.html#6849" class="Bound">tmpGovSt</a>
      <a id="6989" href="Ledger.Epoch.html#6989" class="Bound">removed&#39;</a>          <a id="7007" class="Symbol">=</a> <a id="7009" href="Ledger.Ratify.html#3294" class="Function">removed</a> <a id="7017" href="Axiom.Set.html#8952" class="Function Operator">∪</a> <a id="7019" href="Ledger.Epoch.html#6929" class="Bound">orphans</a>
      <a id="7033" href="Ledger.Epoch.html#7033" class="Bound">removedGovActions</a> <a id="7051" class="Symbol">=</a> <a id="7053" href="Function.Base.html#1638" class="Function">flip</a> <a id="7058" href="Axiom.Set.html#7022" class="Function">concatMapˢ</a> <a id="7069" href="Ledger.Epoch.html#6989" class="Bound">removed&#39;</a> <a id="7078" class="Symbol">λ</a> <a id="7080" class="Symbol">(</a><a id="7081" href="Ledger.Epoch.html#7081" class="Bound">gaid</a> <a id="7086" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="7088" href="Ledger.Epoch.html#7088" class="Bound">gaSt</a><a id="7092" class="Symbol">)</a> <a id="7094" class="Symbol">→</a>
        <a id="7104" href="abstract-set-theory.FiniteSetTheory.html#519" class="Function">mapˢ</a> <a id="7109" class="Symbol">(</a><a id="7110" href="Ledger.GovernanceActions.html#2665" class="Field">returnAddr</a> <a id="7121" href="Ledger.Epoch.html#7088" class="Bound">gaSt</a> <a id="7126" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,_</a><a id="7128" class="Symbol">)</a> <a id="7130" class="Symbol">((</a><a id="7132" href="Ledger.Ledger.html#868" class="Function">utxoSt</a> <a id="7139" class="Symbol">.</a><a id="7140" href="Ledger.Utxo.html#2813" class="Field">deposits</a> <a id="7149" href="Axiom.Set.Map.html#10678" class="Function Operator">∣</a> <a id="7151" href="Class.HasSingleton.html#288" class="Field Operator">❴</a> <a id="7153" href="Ledger.Certs.html#521" class="InductiveConstructor">GovActionDeposit</a> <a id="7170" href="Ledger.Epoch.html#7081" class="Bound">gaid</a> <a id="7175" href="Class.HasSingleton.html#288" class="Field Operator">❵</a><a id="7176" class="Symbol">)</a> <a id="7178" href="Axiom.Set.Map.html#2293" class="Function Operator">ˢ</a><a id="7179" class="Symbol">)</a>
      <a id="7187" href="Ledger.Epoch.html#7187" class="Bound">govActionReturns</a> <a id="7204" class="Symbol">=</a> <a id="7206" href="Axiom.Set.Map.Dec.html#1932" class="Function">aggregate₊</a> <a id="7217" class="Symbol">(</a><a id="7218" href="abstract-set-theory.FiniteSetTheory.html#519" class="Function">mapˢ</a> <a id="7223" class="Symbol">(λ</a> <a id="7226" class="Symbol">(</a><a id="7227" href="Ledger.Epoch.html#7227" class="Bound">a</a> <a id="7229" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="7231" class="Symbol">_</a> <a id="7233" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="7235" href="Ledger.Epoch.html#7235" class="Bound">d</a><a id="7236" class="Symbol">)</a> <a id="7238" class="Symbol">→</a> <a id="7240" href="Ledger.Epoch.html#7227" class="Bound">a</a> <a id="7242" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="7244" href="Ledger.Epoch.html#7235" class="Bound">d</a><a id="7245" class="Symbol">)</a> <a id="7247" href="Ledger.Epoch.html#7033" class="Bound">removedGovActions</a> <a id="7265" href="abstract-set-theory.FiniteSetTheory.html#2767" class="Function Operator">ᶠˢ</a><a id="7267" class="Symbol">)</a>

      <a id="7276" href="Ledger.Epoch.html#7276" class="Bound">trWithdrawals</a>   <a id="7292" class="Symbol">=</a> <a id="7294" href="Ledger.Epoch.html#6659" class="Function">esW</a> <a id="7298" class="Symbol">.</a><a id="7299" href="Ledger.Enact.html#649" class="Field">withdrawals</a>
      <a id="7317" href="Ledger.Epoch.html#7317" class="Bound">totWithdrawals</a>  <a id="7333" class="Symbol">=</a> <a id="7335" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">∑[</a> <a id="7338" href="Ledger.Epoch.html#7338" class="Bound">x</a> <a id="7340" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">←</a> <a id="7342" href="Ledger.Epoch.html#7276" class="Bound">trWithdrawals</a> <a id="7356" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">]</a> <a id="7358" href="Ledger.Epoch.html#7338" class="Bound">x</a>

      <a id="7367" href="Ledger.Epoch.html#7367" class="Bound">retired</a>    <a id="7378" class="Symbol">=</a> <a id="7380" class="Symbol">(</a><a id="7381" href="Ledger.Certs.html#4410" class="Function">pState</a> <a id="7388" class="Symbol">.</a><a id="7389" href="Ledger.Certs.html#3850" class="Field">retiring</a><a id="7397" class="Symbol">)</a> <a id="7399" href="Axiom.Set.Map.html#14230" class="Function Operator">⁻¹</a> <a id="7402" href="Ledger.Epoch.html#5932" class="Generalizable">e</a>
      <a id="7410" href="Ledger.Epoch.html#7410" class="Bound">payout</a>     <a id="7421" class="Symbol">=</a> <a id="7423" href="Ledger.Epoch.html#7187" class="Bound">govActionReturns</a> <a id="7440" href="Axiom.Set.Map.Dec.html#1854" class="Function Operator">∪⁺</a> <a id="7443" href="Ledger.Epoch.html#7276" class="Bound">trWithdrawals</a>
      <a id="7463" href="Ledger.Epoch.html#7463" class="Bound">refunds</a>    <a id="7474" class="Symbol">=</a> <a id="7476" href="Axiom.Set.Map.html#13791" class="Function">pullbackMap</a> <a id="7488" href="Ledger.Epoch.html#7410" class="Bound">payout</a> <a id="7495" href="Ledger.Epoch.html#3696" class="Function">toRwdAddr</a> <a id="7505" class="Symbol">(</a><a id="7506" href="Class.IsSet.html#916" class="Function">dom</a> <a id="7510" class="Symbol">(</a><a id="7511" href="Ledger.Certs.html#4390" class="Function">dState</a> <a id="7518" class="Symbol">.</a><a id="7519" href="Ledger.Certs.html#3309" class="Field">rewards</a><a id="7526" class="Symbol">))</a>
      <a id="7535" href="Ledger.Epoch.html#7535" class="Bound">unclaimed</a>  <a id="7546" class="Symbol">=</a> <a id="7548" href="Ledger.Interface.HasCoin.html#172" class="Field">getCoin</a> <a id="7556" href="Ledger.Epoch.html#7410" class="Bound">payout</a> <a id="7563" href="Interface.HasSubtract.html#209" class="Field Operator">-</a> <a id="7565" href="Ledger.Interface.HasCoin.html#172" class="Field">getCoin</a> <a id="7573" href="Ledger.Epoch.html#7463" class="Bound">refunds</a>

      <a id="7588" href="Ledger.Epoch.html#7588" class="Bound">govSt&#39;</a> <a id="7595" class="Symbol">=</a> <a id="7597" href="Data.List.Base.html#10687" class="Function">filter</a> <a id="7604" class="Symbol">(λ</a> <a id="7607" href="Ledger.Epoch.html#7607" class="Bound">x</a> <a id="7609" class="Symbol">→</a> <a id="7611" href="Class.Decidable.Core.html#461" class="Function Operator">¿</a> <a id="7613" href="Data.Product.Base.html#636" class="Field">proj₁</a> <a id="7619" href="Ledger.Epoch.html#7607" class="Bound">x</a> <a id="7621" href="Class.IsSet.html#462" class="Function Operator">∉</a> <a id="7623" href="abstract-set-theory.FiniteSetTheory.html#519" class="Function">mapˢ</a> <a id="7628" href="Data.Product.Base.html#636" class="Field">proj₁</a> <a id="7634" href="Ledger.Epoch.html#6989" class="Bound">removed&#39;</a> <a id="7643" href="Class.Decidable.Core.html#461" class="Function Operator">¿</a><a id="7644" class="Symbol">)</a> <a id="7646" href="Ledger.Ledger.html#895" class="Function">govSt</a>

      <a id="7659" href="Ledger.Epoch.html#7659" class="Bound">dState&#39;</a> <a id="7667" class="Symbol">=</a> <a id="7669" href="Ledger.Prelude.html#2291" class="Function Operator">⟦</a> <a id="7671" href="Ledger.Certs.html#4390" class="Function">dState</a> <a id="7678" class="Symbol">.</a><a id="7679" href="Ledger.Certs.html#3230" class="Field">voteDelegs</a> <a id="7690" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="7692" href="Ledger.Certs.html#4390" class="Function">dState</a> <a id="7699" class="Symbol">.</a><a id="7700" href="Ledger.Certs.html#3269" class="Field">stakeDelegs</a> <a id="7712" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a>  <a id="7715" href="Ledger.Certs.html#4390" class="Function">dState</a> <a id="7722" class="Symbol">.</a><a id="7723" href="Ledger.Certs.html#3309" class="Field">rewards</a> <a id="7731" href="Axiom.Set.Map.Dec.html#1854" class="Function Operator">∪⁺</a> <a id="7734" href="Ledger.Epoch.html#7463" class="Bound">refunds</a> <a id="7742" href="Ledger.Prelude.html#2291" class="Function Operator">⟧</a>

      <a id="7751" href="Ledger.Epoch.html#7751" class="Bound">pState&#39;</a> <a id="7759" class="Symbol">=</a> <a id="7761" href="Ledger.Prelude.html#2291" class="Function Operator">⟦</a> <a id="7763" href="Ledger.Certs.html#4410" class="Function">pState</a> <a id="7770" class="Symbol">.</a><a id="7771" href="Ledger.Certs.html#3813" class="Field">pools</a> <a id="7777" href="Axiom.Set.Map.html#10748" class="Function Operator">∣</a> <a id="7779" href="Ledger.Epoch.html#7367" class="Bound">retired</a> <a id="7787" href="Axiom.Set.Map.html#10748" class="Function Operator">ᶜ</a> <a id="7789" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="7791" href="Ledger.Certs.html#4410" class="Function">pState</a> <a id="7798" class="Symbol">.</a><a id="7799" href="Ledger.Certs.html#3850" class="Field">retiring</a> <a id="7808" href="Axiom.Set.Map.html#10748" class="Function Operator">∣</a> <a id="7810" href="Ledger.Epoch.html#7367" class="Bound">retired</a> <a id="7818" href="Axiom.Set.Map.html#10748" class="Function Operator">ᶜ</a> <a id="7820" href="Ledger.Prelude.html#2291" class="Function Operator">⟧</a>

      <a id="7829" href="Ledger.Epoch.html#7829" class="Bound">gState&#39;</a> <a id="7837" class="Symbol">=</a> <a id="7839" href="Ledger.Prelude.html#2291" class="Function Operator">⟦</a> <a id="7841" class="Symbol">(</a><a id="7842" href="Class.ToBool.html#389" class="Function Operator">if</a> <a id="7845" href="Data.List.Base.html#4703" class="Function">null</a> <a id="7850" href="Ledger.Epoch.html#7588" class="Bound">govSt&#39;</a> <a id="7857" href="Class.ToBool.html#389" class="Function Operator">then</a> <a id="7862" href="Axiom.Set.Map.html#6068" class="Function">mapValues</a> <a id="7872" class="Symbol">(</a><a id="7873" class="Number">1</a> <a id="7875" href="Class.HasAdd.Core.html#162" class="Field Operator">+_</a><a id="7877" class="Symbol">)</a> <a id="7879" class="Symbol">(</a><a id="7880" href="Ledger.Certs.html#4430" class="Function">gState</a> <a id="7887" class="Symbol">.</a><a id="7888" href="Ledger.Certs.html#4054" class="Field">dreps</a><a id="7893" class="Symbol">)</a> <a id="7895" href="Class.ToBool.html#389" class="Function Operator">else</a> <a id="7900" class="Symbol">(</a><a id="7901" href="Ledger.Certs.html#4430" class="Function">gState</a> <a id="7908" class="Symbol">.</a><a id="7909" href="Ledger.Certs.html#4054" class="Field">dreps</a><a id="7914" class="Symbol">))</a>
                <a id="7933" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="7935" href="Ledger.Certs.html#4430" class="Function">gState</a> <a id="7942" class="Symbol">.</a><a id="7943" href="Ledger.Certs.html#4077" class="Field">ccHotKeys</a> <a id="7953" href="Axiom.Set.Map.html#10678" class="Function Operator">∣</a> <a id="7955" href="Ledger.Enact.html#1194" class="Function">ccCreds</a> <a id="7963" class="Symbol">(</a><a id="7964" href="Ledger.Epoch.html#6792" class="Bound">es</a> <a id="7967" class="Symbol">.</a><a id="7968" href="Ledger.Enact.html#433" class="Field">cc</a><a id="7970" class="Symbol">)</a> <a id="7972" href="Ledger.Prelude.html#2291" class="Function Operator">⟧</a>

      <a id="7981" href="Ledger.Epoch.html#7981" class="Bound">certState&#39;</a> <a id="7992" class="Symbol">:</a> <a id="7994" href="Ledger.Certs.html#4327" class="Record">CertState</a>
      <a id="8010" href="Ledger.Epoch.html#7981" class="Bound">certState&#39;</a> <a id="8021" class="Symbol">=</a> <a id="8023" href="Ledger.Prelude.html#2291" class="Function Operator">⟦</a> <a id="8025" href="Ledger.Epoch.html#7659" class="Bound">dState&#39;</a> <a id="8033" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="8035" href="Ledger.Epoch.html#7751" class="Bound">pState&#39;</a> <a id="8043" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="8045" href="Ledger.Epoch.html#7829" class="Bound">gState&#39;</a> <a id="8053" href="Ledger.Prelude.html#2291" class="Function Operator">⟧</a>

      <a id="8062" href="Ledger.Epoch.html#8062" class="Bound">utxoSt&#39;</a> <a id="8070" class="Symbol">=</a> <a id="8072" href="Ledger.Prelude.html#2291" class="Function Operator">⟦</a> <a id="8074" href="Ledger.Ledger.html#868" class="Function">utxoSt</a> <a id="8081" class="Symbol">.</a><a id="8082" href="Ledger.Utxo.html#2769" class="Field">utxo</a> <a id="8087" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="8089" href="Ledger.Ledger.html#868" class="Function">utxoSt</a> <a id="8096" class="Symbol">.</a><a id="8097" href="Ledger.Utxo.html#2791" class="Field">fees</a> <a id="8102" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="8104" href="Ledger.Ledger.html#868" class="Function">utxoSt</a> <a id="8111" class="Symbol">.</a><a id="8112" href="Ledger.Utxo.html#2813" class="Field">deposits</a> <a id="8121" href="Axiom.Set.Map.html#10748" class="Function Operator">∣</a> <a id="8123" href="abstract-set-theory.FiniteSetTheory.html#519" class="Function">mapˢ</a> <a id="8128" class="Symbol">(</a><a id="8129" href="Data.Product.Base.html#636" class="Field">proj₁</a> <a id="8135" href="Function.Base.html#1115" class="Function Operator">∘</a> <a id="8137" href="Data.Product.Base.html#650" class="Field">proj₂</a><a id="8142" class="Symbol">)</a> <a id="8144" href="Ledger.Epoch.html#7033" class="Bound">removedGovActions</a> <a id="8162" href="Axiom.Set.Map.html#10748" class="Function Operator">ᶜ</a> <a id="8164" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="8166" class="Number">0</a> <a id="8168" href="Ledger.Prelude.html#2291" class="Function Operator">⟧</a>

      <a id="8177" href="Ledger.Epoch.html#8177" class="Bound">acnt&#39;</a> <a id="8183" class="Symbol">=</a> <a id="8185" class="Keyword">record</a> <a id="8192" href="Ledger.Epoch.html#6023" class="Generalizable">acnt</a>
        <a id="8205" class="Symbol">{</a> <a id="8207" href="Ledger.PParams.html#729" class="Field">treasury</a>  <a id="8217" class="Symbol">=</a> <a id="8219" href="Ledger.Epoch.html#6023" class="Generalizable">acnt</a> <a id="8224" class="Symbol">.</a><a id="8225" href="Ledger.PParams.html#729" class="Field">treasury</a> <a id="8234" href="Data.Nat.Base.html#4462" class="Primitive Operator">∸</a> <a id="8236" href="Ledger.Epoch.html#7317" class="Bound">totWithdrawals</a> <a id="8251" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="8253" href="Ledger.Ledger.html#868" class="Function">utxoSt</a> <a id="8260" class="Symbol">.</a><a id="8261" href="Ledger.Utxo.html#2839" class="Field">donations</a> <a id="8271" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="8273" href="Ledger.Epoch.html#7535" class="Bound">unclaimed</a> <a id="8283" class="Symbol">}</a>
    <a id="8289" class="Keyword">in</a>
    <a id="8296" class="Keyword">record</a> <a id="8303" class="Symbol">{</a> <a id="8305" href="Ledger.Ratify.html#2999" class="Field">currentEpoch</a> <a id="8318" class="Symbol">=</a> <a id="8320" href="Ledger.Epoch.html#5932" class="Generalizable">e</a>
           <a id="8333" class="Symbol">;</a> <a id="8335" href="Ledger.Ratify.html#2967" class="Field">stakeDistrs</a> <a id="8347" class="Symbol">=</a> <a id="8349" href="Ledger.Epoch.html#5654" class="Function">mkStakeDistrs</a>  <a id="8364" class="Symbol">(</a><a id="8365" href="Ledger.Epoch.html#1041" class="Field">Snapshots.mark</a> <a id="8380" href="Ledger.Epoch.html#6117" class="Generalizable">ss&#39;</a><a id="8383" class="Symbol">)</a> <a id="8385" href="Ledger.Epoch.html#7588" class="Bound">govSt&#39;</a>
                                          <a id="8434" class="Symbol">(</a><a id="8435" href="Ledger.Epoch.html#8062" class="Bound">utxoSt&#39;</a> <a id="8443" class="Symbol">.</a><a id="8444" href="Ledger.Utxo.html#2813" class="Field">deposits</a><a id="8452" class="Symbol">)</a> <a id="8454" class="Symbol">(</a><a id="8455" href="Ledger.Certs.html#3230" class="Field">voteDelegs</a> <a id="8466" href="Ledger.Certs.html#4390" class="Function">dState</a><a id="8472" class="Symbol">)</a>
           <a id="8485" class="Symbol">;</a> <a id="8487" href="Ledger.Ratify.html#3114" class="Field">treasury</a> <a id="8496" class="Symbol">=</a> <a id="8498" href="Ledger.Epoch.html#6023" class="Generalizable">acnt</a> <a id="8503" class="Symbol">.</a><a id="8504" href="Ledger.PParams.html#729" class="Field">treasury</a> <a id="8513" class="Symbol">;</a> <a id="8515" href="Ledger.Epoch.html#8515" class="Module">GState</a> <a id="8522" href="Ledger.Certs.html#4430" class="Function">gState</a>
           <a id="8540" class="Symbol">;</a> <a id="8542" href="Ledger.Ratify.html#3139" class="Field">pools</a> <a id="8548" class="Symbol">=</a> <a id="8550" href="Ledger.Certs.html#4410" class="Function">pState</a> <a id="8557" class="Symbol">.</a><a id="8558" href="Ledger.Certs.html#3813" class="Field">pools</a> <a id="8564" class="Symbol">;</a> <a id="8566" href="Ledger.Ratify.html#3180" class="Field">delegatees</a> <a id="8577" class="Symbol">=</a> <a id="8579" href="Ledger.Certs.html#4390" class="Function">dState</a> <a id="8586" class="Symbol">.</a><a id="8587" href="Ledger.Certs.html#3230" class="Field">voteDelegs</a> <a id="8598" class="Symbol">}</a>
        <a id="8608" href="Ledger.Ratify.html#12026" class="Function Operator">⊢</a> <a id="8610" href="Ledger.Prelude.html#2291" class="Function Operator">⟦</a> <a id="8612" href="Ledger.Epoch.html#6792" class="Bound">es</a> <a id="8615" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="8617" href="Class.HasEmptySet.html#287" class="Field">∅</a> <a id="8619" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="8621" href="Agda.Builtin.Bool.html#192" class="InductiveConstructor">false</a> <a id="8627" href="Ledger.Prelude.html#2291" class="Function Operator">⟧</a> <a id="8629" href="Ledger.Ratify.html#12026" class="Function Operator">⇀⦇</a> <a id="8632" href="Ledger.Epoch.html#7588" class="Bound">govSt&#39;</a> <a id="8639" href="Ledger.Ratify.html#12026" class="Function Operator">,RATIFIES⦈</a> <a id="8650" href="Ledger.Epoch.html#5958" class="Generalizable">fut&#39;</a>
      <a id="8661" class="Symbol">→</a> <a id="8663" href="Ledger.Epoch.html#6009" class="Generalizable">ls</a> <a id="8666" href="Ledger.Epoch.html#6187" class="Datatype Operator">⊢</a> <a id="8668" href="Ledger.Epoch.html#6114" class="Generalizable">ss</a> <a id="8671" href="Ledger.Epoch.html#6187" class="Datatype Operator">⇀⦇</a> <a id="8674" href="Agda.Builtin.Unit.html#212" class="InductiveConstructor">tt</a> <a id="8677" href="Ledger.Epoch.html#6187" class="Datatype Operator">,SNAP⦈</a> <a id="8684" href="Ledger.Epoch.html#6117" class="Generalizable">ss&#39;</a>
    <a id="8692" href="Interface.STS.html#350" class="Function Operator">────────────────────────────────</a>
    <a id="8729" class="Symbol">_</a> <a id="8731" href="Ledger.Epoch.html#6480" class="Datatype Operator">⊢</a> <a id="8733" href="Ledger.Prelude.html#2291" class="Function Operator">⟦</a> <a id="8735" href="Ledger.Epoch.html#6023" class="Generalizable">acnt</a> <a id="8740" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="8742" href="Ledger.Epoch.html#6114" class="Generalizable">ss</a> <a id="8745" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="8747" href="Ledger.Epoch.html#6009" class="Generalizable">ls</a> <a id="8750" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="8752" href="Ledger.Epoch.html#6037" class="Generalizable">es₀</a> <a id="8756" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="8758" href="Ledger.Epoch.html#5954" class="Generalizable">fut</a> <a id="8762" href="Ledger.Prelude.html#2291" class="Function Operator">⟧</a> <a id="8764" href="Ledger.Epoch.html#6480" class="Datatype Operator">⇀⦇</a> <a id="8767" href="Ledger.Epoch.html#5932" class="Generalizable">e</a> <a id="8769" href="Ledger.Epoch.html#6480" class="Datatype Operator">,EPOCH⦈</a>
        <a id="8785" href="Ledger.Prelude.html#2291" class="Function Operator">⟦</a> <a id="8787" href="Ledger.Epoch.html#8177" class="Bound">acnt&#39;</a> <a id="8793" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="8795" href="Ledger.Epoch.html#6117" class="Generalizable">ss&#39;</a> <a id="8799" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="8801" href="Ledger.Prelude.html#2291" class="Function Operator">⟦</a> <a id="8803" href="Ledger.Epoch.html#8062" class="Bound">utxoSt&#39;</a> <a id="8811" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="8813" href="Ledger.Epoch.html#7588" class="Bound">govSt&#39;</a> <a id="8820" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="8822" href="Ledger.Epoch.html#7981" class="Bound">certState&#39;</a> <a id="8833" href="Ledger.Prelude.html#2291" class="Function Operator">⟧</a> <a id="8835" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="8837" href="Ledger.Epoch.html#6792" class="Bound">es</a> <a id="8840" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="8842" href="Ledger.Epoch.html#5958" class="Generalizable">fut&#39;</a> <a id="8847" href="Ledger.Prelude.html#2291" class="Function Operator">⟧</a>


<a id="8851" class="Keyword">data</a>


  <a id="_⊢_⇀⦇_,NEWEPOCH⦈_"></a><a id="8860" href="Ledger.Epoch.html#8860" class="Datatype Operator">_⊢_⇀⦇_,NEWEPOCH⦈_</a> <a id="8878" class="Symbol">:</a> <a id="8880" href="Agda.Builtin.Unit.html#175" class="Record">⊤</a> <a id="8882" class="Symbol">→</a> <a id="8884" href="Ledger.Epoch.html#1879" class="Record">NewEpochState</a> <a id="8898" class="Symbol">→</a> <a id="8900" href="Ledger.Types.Epoch.html#476" class="Function">Epoch</a> <a id="8906" class="Symbol">→</a> <a id="8908" href="Ledger.Epoch.html#1879" class="Record">NewEpochState</a> <a id="8922" class="Symbol">→</a> <a id="8924" href="Agda.Primitive.html#388" class="Primitive">Type</a>


  <a id="8933" class="Keyword">where</a>


  <a id="_⊢_⇀⦇_,NEWEPOCH⦈_.NEWEPOCH-New"></a><a id="8943" href="Ledger.Epoch.html#8943" class="InductiveConstructor">NEWEPOCH-New</a> <a id="8956" class="Symbol">:</a> <a id="8958" class="Keyword">let</a>
      <a id="8968" href="Ledger.Epoch.html#8968" class="Bound">eps&#39;</a> <a id="8973" class="Symbol">=</a> <a id="8975" href="Ledger.Epoch.html#3935" class="Function">applyRUpd</a> <a id="8985" href="Ledger.Epoch.html#6135" class="Generalizable">ru</a> <a id="8988" href="Ledger.Epoch.html#5979" class="Generalizable">eps</a>
    <a id="8996" class="Keyword">in</a>
    <a id="9003" href="Interface.STS.html#105" class="Function Operator">∙</a> <a id="9005" href="Ledger.Epoch.html#5932" class="Generalizable">e</a> <a id="9007" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="9009" href="Ledger.Epoch.html#5934" class="Generalizable">lastEpoch</a> <a id="9019" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="9021" class="Number">1</a>
    <a id="9027" href="Interface.STS.html#131" class="Function Operator">∙</a> <a id="9029" class="Symbol">_</a> <a id="9031" href="Ledger.Epoch.html#6480" class="Datatype Operator">⊢</a> <a id="9033" href="Ledger.Epoch.html#8968" class="Bound">eps&#39;</a> <a id="9038" href="Ledger.Epoch.html#6480" class="Datatype Operator">⇀⦇</a> <a id="9041" href="Ledger.Epoch.html#5932" class="Generalizable">e</a> <a id="9043" href="Ledger.Epoch.html#6480" class="Datatype Operator">,EPOCH⦈</a> <a id="9051" href="Ledger.Epoch.html#5988" class="Generalizable">eps&#39;&#39;</a>
      <a id="9063" href="Interface.STS.html#350" class="Function Operator">────────────────────────────────</a>
      <a id="9102" class="Symbol">_</a> <a id="9104" href="Ledger.Epoch.html#8860" class="Datatype Operator">⊢</a> <a id="9106" href="Ledger.Prelude.html#2291" class="Function Operator">⟦</a> <a id="9108" href="Ledger.Epoch.html#5934" class="Generalizable">lastEpoch</a> <a id="9118" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="9120" href="Ledger.Epoch.html#5979" class="Generalizable">eps</a> <a id="9124" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="9126" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="9131" href="Ledger.Epoch.html#6135" class="Generalizable">ru</a> <a id="9134" href="Ledger.Prelude.html#2291" class="Function Operator">⟧</a> <a id="9136" href="Ledger.Epoch.html#8860" class="Datatype Operator">⇀⦇</a> <a id="9139" href="Ledger.Epoch.html#5932" class="Generalizable">e</a> <a id="9141" href="Ledger.Epoch.html#8860" class="Datatype Operator">,NEWEPOCH⦈</a> <a id="9152" href="Ledger.Prelude.html#2291" class="Function Operator">⟦</a> <a id="9154" href="Ledger.Epoch.html#5932" class="Generalizable">e</a> <a id="9156" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="9158" href="Ledger.Epoch.html#5988" class="Generalizable">eps&#39;&#39;</a> <a id="9164" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="9166" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a> <a id="9174" href="Ledger.Prelude.html#2291" class="Function Operator">⟧</a>

  <a id="_⊢_⇀⦇_,NEWEPOCH⦈_.NEWEPOCH-Not-New"></a><a id="9179" href="Ledger.Epoch.html#9179" class="InductiveConstructor">NEWEPOCH-Not-New</a> <a id="9196" class="Symbol">:</a>
    <a id="9202" href="Interface.STS.html#105" class="Function Operator">∙</a> <a id="9204" href="Ledger.Epoch.html#5932" class="Generalizable">e</a> <a id="9206" href="Relation.Binary.PropositionalEquality.Core.html#858" class="Function Operator">≢</a> <a id="9208" href="Ledger.Epoch.html#5934" class="Generalizable">lastEpoch</a> <a id="9218" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="9220" class="Number">1</a>
      <a id="9228" href="Interface.STS.html#350" class="Function Operator">────────────────────────────────</a>
      <a id="9267" class="Symbol">_</a> <a id="9269" href="Ledger.Epoch.html#8860" class="Datatype Operator">⊢</a> <a id="9271" href="Ledger.Prelude.html#2291" class="Function Operator">⟦</a> <a id="9273" href="Ledger.Epoch.html#5934" class="Generalizable">lastEpoch</a> <a id="9283" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="9285" href="Ledger.Epoch.html#5979" class="Generalizable">eps</a> <a id="9289" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="9291" href="Ledger.Epoch.html#6155" class="Generalizable">mru</a> <a id="9295" href="Ledger.Prelude.html#2291" class="Function Operator">⟧</a> <a id="9297" href="Ledger.Epoch.html#8860" class="Datatype Operator">⇀⦇</a> <a id="9300" href="Ledger.Epoch.html#5932" class="Generalizable">e</a> <a id="9302" href="Ledger.Epoch.html#8860" class="Datatype Operator">,NEWEPOCH⦈</a> <a id="9313" href="Ledger.Prelude.html#2291" class="Function Operator">⟦</a> <a id="9315" href="Ledger.Epoch.html#5934" class="Generalizable">lastEpoch</a> <a id="9325" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="9327" href="Ledger.Epoch.html#5979" class="Generalizable">eps</a> <a id="9331" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="9333" href="Ledger.Epoch.html#6155" class="Generalizable">mru</a> <a id="9337" href="Ledger.Prelude.html#2291" class="Function Operator">⟧</a>

  <a id="_⊢_⇀⦇_,NEWEPOCH⦈_.NEWEPOCH-No-Reward-Update"></a><a id="9342" href="Ledger.Epoch.html#9342" class="InductiveConstructor">NEWEPOCH-No-Reward-Update</a> <a id="9368" class="Symbol">:</a>
    <a id="9374" href="Interface.STS.html#105" class="Function Operator">∙</a> <a id="9376" href="Ledger.Epoch.html#5932" class="Generalizable">e</a> <a id="9378" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="9380" href="Ledger.Epoch.html#5934" class="Generalizable">lastEpoch</a> <a id="9390" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="9392" class="Number">1</a>
    <a id="9398" href="Interface.STS.html#131" class="Function Operator">∙</a> <a id="9400" class="Symbol">_</a> <a id="9402" href="Ledger.Epoch.html#6480" class="Datatype Operator">⊢</a> <a id="9404" href="Ledger.Epoch.html#5979" class="Generalizable">eps</a> <a id="9408" href="Ledger.Epoch.html#6480" class="Datatype Operator">⇀⦇</a> <a id="9411" href="Ledger.Epoch.html#5932" class="Generalizable">e</a> <a id="9413" href="Ledger.Epoch.html#6480" class="Datatype Operator">,EPOCH⦈</a> <a id="9421" href="Ledger.Epoch.html#5983" class="Generalizable">eps&#39;</a>
      <a id="9432" href="Interface.STS.html#350" class="Function Operator">────────────────────────────────</a>
      <a id="9471" class="Symbol">_</a> <a id="9473" href="Ledger.Epoch.html#8860" class="Datatype Operator">⊢</a> <a id="9475" href="Ledger.Prelude.html#2291" class="Function Operator">⟦</a> <a id="9477" href="Ledger.Epoch.html#5934" class="Generalizable">lastEpoch</a> <a id="9487" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="9489" href="Ledger.Epoch.html#5979" class="Generalizable">eps</a> <a id="9493" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="9495" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a> <a id="9503" href="Ledger.Prelude.html#2291" class="Function Operator">⟧</a> <a id="9505" href="Ledger.Epoch.html#8860" class="Datatype Operator">⇀⦇</a> <a id="9508" href="Ledger.Epoch.html#5932" class="Generalizable">e</a> <a id="9510" href="Ledger.Epoch.html#8860" class="Datatype Operator">,NEWEPOCH⦈</a> <a id="9521" href="Ledger.Prelude.html#2291" class="Function Operator">⟦</a> <a id="9523" href="Ledger.Epoch.html#5932" class="Generalizable">e</a> <a id="9525" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="9527" href="Ledger.Epoch.html#5983" class="Generalizable">eps&#39;</a> <a id="9532" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="9534" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a> <a id="9542" href="Ledger.Prelude.html#2291" class="Function Operator">⟧</a>

</pre></body></html>