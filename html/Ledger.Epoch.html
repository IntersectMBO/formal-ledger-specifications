<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>Ledger.Epoch</title><link rel="stylesheet" href="Agda.css"></head><body><pre class="Agda">
<a id="2" class="Symbol">{-#</a> <a id="6" class="Keyword">OPTIONS</a> <a id="14" class="Pragma">--safe</a> <a id="21" class="Symbol">#-}</a>

<a id="26" class="Keyword">open</a> <a id="31" class="Keyword">import</a> <a id="38" href="Data.Nat.Properties.html" class="Module">Data.Nat.Properties</a> <a id="58" class="Keyword">using</a> <a id="64" class="Symbol">(</a><a id="65" href="Data.Nat.Properties.html#17252" class="Function">+-0-monoid</a><a id="75" class="Symbol">;</a> <a id="77" href="Data.Nat.Properties.html#17331" class="Function">+-0-commutativeMonoid</a><a id="98" class="Symbol">)</a>
<a id="100" class="Keyword">open</a> <a id="105" class="Keyword">import</a> <a id="112" href="Data.List.html" class="Module">Data.List</a> <a id="122" class="Keyword">using</a> <a id="128" class="Symbol">(</a><a id="129" href="Data.List.Base.html#10687" class="Function">filter</a><a id="135" class="Symbol">)</a>
<a id="137" class="Keyword">open</a> <a id="142" class="Keyword">import</a> <a id="149" href="Data.Integer.html" class="Module">Data.Integer</a> <a id="162" class="Keyword">using</a> <a id="168" class="Symbol">()</a> <a id="171" class="Keyword">renaming</a> <a id="180" class="Symbol">(</a><a id="181" href="Agda.Builtin.Int.html#263" class="InductiveConstructor">+_</a> <a id="184" class="Symbol">to</a> <a id="187" class="InductiveConstructor">pos</a><a id="190" class="Symbol">)</a>
<a id="192" class="Keyword">open</a> <a id="197" class="Keyword">import</a> <a id="204" href="Data.Nat.GeneralisedArithmetic.html" class="Module">Data.Nat.GeneralisedArithmetic</a> <a id="235" class="Keyword">using</a> <a id="241" class="Symbol">(</a><a id="242" href="Data.Nat.GeneralisedArithmetic.html#866" class="Function">iterate</a><a id="249" class="Symbol">)</a>

<a id="252" class="Keyword">open</a> <a id="257" class="Keyword">import</a> <a id="264" href="Agda.Builtin.FromNat.html" class="Module">Agda.Builtin.FromNat</a>

<a id="286" class="Keyword">open</a> <a id="291" class="Keyword">import</a> <a id="298" href="Ledger.Prelude.html" class="Module">Ledger.Prelude</a> <a id="313" class="Keyword">hiding</a> <a id="320" class="Symbol">(</a><a id="321" href="Data.List.Base.html#5412" class="Function">iterate</a><a id="328" class="Symbol">)</a>
<a id="330" class="Keyword">open</a> <a id="335" class="Keyword">import</a> <a id="342" href="Ledger.Abstract.html" class="Module">Ledger.Abstract</a>
<a id="358" class="Keyword">open</a> <a id="363" class="Keyword">import</a> <a id="370" href="Ledger.Transaction.html" class="Module">Ledger.Transaction</a>

<a id="390" class="Keyword">module</a> <a id="397" href="Ledger.Epoch.html" class="Module">Ledger.Epoch</a>
  <a id="412" class="Symbol">(</a><a id="413" href="Ledger.Epoch.html#413" class="Bound">txs</a> <a id="417" class="Symbol">:</a> <a id="419" class="Symbol">_)</a> <a id="422" class="Symbol">(</a><a id="423" class="Keyword">open</a> <a id="428" href="Ledger.Transaction.html#867" class="Module">TransactionStructure</a> <a id="449" href="Ledger.Epoch.html#413" class="Bound">txs</a><a id="452" class="Symbol">)</a>
  <a id="456" class="Symbol">(</a><a id="457" href="Ledger.Epoch.html#457" class="Bound">abs</a> <a id="461" class="Symbol">:</a> <a id="463" href="Ledger.Abstract.html#578" class="Record">AbstractFunctions</a> <a id="481" href="Ledger.Epoch.html#413" class="Bound">txs</a><a id="484" class="Symbol">)</a> <a id="486" class="Symbol">(</a><a id="487" class="Keyword">open</a> <a id="492" href="Ledger.Abstract.html#578" class="Module">AbstractFunctions</a> <a id="510" href="Ledger.Epoch.html#457" class="Bound">abs</a><a id="513" class="Symbol">)</a>
  <a id="517" class="Keyword">where</a>

<a id="524" class="Keyword">open</a> <a id="529" class="Keyword">import</a> <a id="536" href="Ledger.Gov.html" class="Module">Ledger.Gov</a> <a id="547" href="Ledger.Epoch.html#413" class="Bound">txs</a>
<a id="551" class="Keyword">open</a> <a id="556" class="Keyword">import</a> <a id="563" href="Ledger.Enact.html" class="Module">Ledger.Enact</a> <a id="576" href="Ledger.Transaction.html#1809" class="Function">govStructure</a>
<a id="589" class="Keyword">open</a> <a id="594" class="Keyword">import</a> <a id="601" href="Ledger.Ledger.html" class="Module">Ledger.Ledger</a> <a id="615" href="Ledger.Epoch.html#413" class="Bound">txs</a> <a id="619" href="Ledger.Epoch.html#457" class="Bound">abs</a>
<a id="623" class="Keyword">open</a> <a id="628" class="Keyword">import</a> <a id="635" href="Ledger.Ratify.html" class="Module">Ledger.Ratify</a> <a id="649" href="Ledger.Epoch.html#413" class="Bound">txs</a>
<a id="653" class="Keyword">open</a> <a id="658" class="Keyword">import</a> <a id="665" href="Ledger.Utxo.html" class="Module">Ledger.Utxo</a> <a id="677" href="Ledger.Epoch.html#413" class="Bound">txs</a> <a id="681" href="Ledger.Epoch.html#457" class="Bound">abs</a>
<a id="685" class="Keyword">open</a> <a id="690" class="Keyword">import</a> <a id="697" href="Ledger.Certs.html" class="Module">Ledger.Certs</a> <a id="710" href="Ledger.Transaction.html#1809" class="Function">govStructure</a>


<a id="725" class="Keyword">record</a> <a id="RewardUpdate"></a><a id="732" href="Ledger.Epoch.html#732" class="Record">RewardUpdate</a> <a id="745" class="Symbol">:</a> <a id="747" href="Agda.Primitive.html#388" class="Primitive">Set</a> <a id="751" class="Keyword">where</a>


  <a id="761" class="Keyword">constructor</a> <a id="⟦_,_,_,_⟧ʳᵘ"></a><a id="773" href="Ledger.Epoch.html#773" class="InductiveConstructor Operator">⟦_,_,_,_⟧ʳᵘ</a>


  <a id="789" class="Keyword">field</a>
    <a id="RewardUpdate.Δt"></a><a id="799" href="Ledger.Epoch.html#799" class="Field">Δt</a> <a id="RewardUpdate.Δr"></a><a id="802" href="Ledger.Epoch.html#802" class="Field">Δr</a> <a id="RewardUpdate.Δf"></a><a id="805" href="Ledger.Epoch.html#805" class="Field">Δf</a> <a id="808" class="Symbol">:</a> <a id="810" href="Agda.Builtin.Int.html#245" class="Datatype">ℤ</a>
    <a id="RewardUpdate.rs"></a><a id="816" href="Ledger.Epoch.html#816" class="Field">rs</a> <a id="819" class="Symbol">:</a> <a id="821" href="Ledger.Address.html#273" class="Datatype">Credential</a> <a id="832" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="834" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a>


<a id="841" class="Keyword">record</a> <a id="Snapshot"></a><a id="848" href="Ledger.Epoch.html#848" class="Record">Snapshot</a> <a id="857" class="Symbol">:</a> <a id="859" href="Agda.Primitive.html#388" class="Primitive">Set</a> <a id="863" class="Keyword">where</a>
  <a id="871" class="Keyword">field</a>
    <a id="Snapshot.stake"></a><a id="881" href="Ledger.Epoch.html#881" class="Field">stake</a>        <a id="894" class="Symbol">:</a> <a id="896" href="Ledger.Address.html#273" class="Datatype">Credential</a> <a id="907" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="909" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a>
    <a id="Snapshot.delegations"></a><a id="918" href="Ledger.Epoch.html#918" class="Field">delegations</a>  <a id="931" class="Symbol">:</a> <a id="933" href="Ledger.Address.html#273" class="Datatype">Credential</a> <a id="944" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="946" href="Ledger.Crypto.html#1310" class="Function">KeyHash</a>
    <a id="958" class="Comment">-- poolParameters : KeyHash ⇀ PoolParam</a>

<a id="999" class="Keyword">record</a> <a id="Snapshots"></a><a id="1006" href="Ledger.Epoch.html#1006" class="Record">Snapshots</a> <a id="1016" class="Symbol">:</a> <a id="1018" href="Agda.Primitive.html#388" class="Primitive">Set</a> <a id="1022" class="Keyword">where</a>
  <a id="1030" class="Keyword">field</a>
    <a id="Snapshots.mark"></a><a id="1040" href="Ledger.Epoch.html#1040" class="Field">mark</a> <a id="Snapshots.set"></a><a id="1045" href="Ledger.Epoch.html#1045" class="Field">set</a> <a id="Snapshots.go"></a><a id="1049" href="Ledger.Epoch.html#1049" class="Field">go</a>  <a id="1053" class="Symbol">:</a> <a id="1055" href="Ledger.Epoch.html#848" class="Record">Snapshot</a>
    <a id="Snapshots.feeSS"></a><a id="1068" href="Ledger.Epoch.html#1068" class="Field">feeSS</a>        <a id="1081" class="Symbol">:</a> <a id="1083" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a>



<a id="1091" class="Keyword">record</a> <a id="EpochState"></a><a id="1098" href="Ledger.Epoch.html#1098" class="Record">EpochState</a> <a id="1109" class="Symbol">:</a> <a id="1111" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="1116" class="Keyword">where</a>


  <a id="1126" class="Keyword">constructor</a> <a id="⟦_,_,_,_,_⟧ᵉ&#39;"></a><a id="1138" href="Ledger.Epoch.html#1138" class="InductiveConstructor Operator">⟦_,_,_,_,_⟧ᵉ&#39;</a>


  <a id="1156" class="Keyword">field</a>
    <a id="EpochState.acnt"></a><a id="1166" href="Ledger.Epoch.html#1166" class="Field">acnt</a>       <a id="1177" class="Symbol">:</a> <a id="1179" href="Ledger.PParams.html#674" class="Record">Acnt</a>
    <a id="EpochState.ss"></a><a id="1188" href="Ledger.Epoch.html#1188" class="Field">ss</a>         <a id="1199" class="Symbol">:</a> <a id="1201" href="Ledger.Epoch.html#1006" class="Record">Snapshots</a>
    <a id="EpochState.ls"></a><a id="1215" href="Ledger.Epoch.html#1215" class="Field">ls</a>         <a id="1226" class="Symbol">:</a> <a id="1228" href="Ledger.Ledger.html#809" class="Record">LState</a>
    <a id="EpochState.es"></a><a id="1239" href="Ledger.Epoch.html#1239" class="Field">es</a>         <a id="1250" class="Symbol">:</a> <a id="1252" href="Ledger.Enact.html#397" class="Record">EnactState</a>
    <a id="EpochState.fut"></a><a id="1267" href="Ledger.Epoch.html#1267" class="Field">fut</a>        <a id="1278" class="Symbol">:</a> <a id="1280" href="Ledger.Ratify.html#3224" class="Record">RatifyState</a>


<a id="1294" class="Keyword">record</a> <a id="HasEpochState"></a><a id="1301" href="Ledger.Epoch.html#1301" class="Record">HasEpochState</a> <a id="1315" class="Symbol">{</a><a id="1316" href="Ledger.Epoch.html#1316" class="Bound">a</a><a id="1317" class="Symbol">}</a> <a id="1319" class="Symbol">(</a><a id="1320" href="Ledger.Epoch.html#1320" class="Bound">A</a> <a id="1322" class="Symbol">:</a> <a id="1324" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="1329" href="Ledger.Epoch.html#1316" class="Bound">a</a><a id="1330" class="Symbol">)</a> <a id="1332" class="Symbol">:</a> <a id="1334" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="1339" href="Ledger.Epoch.html#1316" class="Bound">a</a> <a id="1341" class="Keyword">where</a>
  <a id="1349" class="Keyword">field</a> <a id="HasEpochState.EpochStateOf"></a><a id="1355" href="Ledger.Epoch.html#1355" class="Field">EpochStateOf</a> <a id="1368" class="Symbol">:</a> <a id="1370" href="Ledger.Epoch.html#1320" class="Bound">A</a> <a id="1372" class="Symbol">→</a> <a id="1374" href="Ledger.Epoch.html#1098" class="Record">EpochState</a>
<a id="1385" class="Keyword">open</a> <a id="1390" href="Ledger.Epoch.html#1301" class="Module">HasEpochState</a> <a id="1404" class="Symbol">⦃...⦄</a> <a id="1410" class="Keyword">public</a>

<a id="1418" class="Keyword">instance</a>
  <a id="HasLState-EpochState"></a><a id="1429" href="Ledger.Epoch.html#1429" class="Function">HasLState-EpochState</a> <a id="1450" class="Symbol">:</a> <a id="1452" href="Ledger.Ledger.html#954" class="Record">HasLState</a> <a id="1462" href="Ledger.Epoch.html#1098" class="Record">EpochState</a>
  <a id="1475" href="Ledger.Epoch.html#1429" class="Function">HasLState-EpochState</a> <a id="1496" class="Symbol">.</a><a id="1497" href="Ledger.Ledger.html#1004" class="Field">LStateOf</a> <a id="1506" class="Symbol">=</a> <a id="1508" href="Ledger.Epoch.html#1215" class="Field">EpochState.ls</a>

  <a id="HasEnactState-EpochState"></a><a id="1525" href="Ledger.Epoch.html#1525" class="Function">HasEnactState-EpochState</a> <a id="1550" class="Symbol">:</a> <a id="1552" href="Ledger.Enact.html#689" class="Record">HasEnactState</a> <a id="1566" href="Ledger.Epoch.html#1098" class="Record">EpochState</a>
  <a id="1579" href="Ledger.Epoch.html#1525" class="Function">HasEnactState-EpochState</a> <a id="1604" class="Symbol">.</a><a id="1605" href="Ledger.Enact.html#743" class="Field">EnactStateOf</a> <a id="1618" class="Symbol">=</a> <a id="1620" href="Ledger.Epoch.html#1239" class="Field">EpochState.es</a>

  <a id="HasDeposits-EpochState"></a><a id="1637" href="Ledger.Epoch.html#1637" class="Function">HasDeposits-EpochState</a> <a id="1660" class="Symbol">:</a> <a id="1662" href="Ledger.Certs.html#677" class="Record">HasDeposits</a> <a id="1674" href="Ledger.Epoch.html#1098" class="Record">EpochState</a>
  <a id="1687" href="Ledger.Epoch.html#1637" class="Function">HasDeposits-EpochState</a> <a id="1710" class="Symbol">.</a><a id="1711" href="Ledger.Certs.html#729" class="Field">DepositsOf</a> <a id="1722" class="Symbol">=</a> <a id="1724" href="Ledger.Certs.html#729" class="Field">DepositsOf</a> <a id="1735" href="Function.Base.html#1115" class="Function Operator">∘</a> <a id="1737" href="Ledger.Ledger.html#1004" class="Field">LStateOf</a>

  <a id="Hastreasury-EpochState"></a><a id="1749" href="Ledger.Epoch.html#1749" class="Function">Hastreasury-EpochState</a> <a id="1772" class="Symbol">:</a> <a id="1774" href="Ledger.PParams.html#762" class="Record">Hastreasury</a> <a id="1786" href="Ledger.Epoch.html#1098" class="Record">EpochState</a>
  <a id="1799" href="Ledger.Epoch.html#1749" class="Function">Hastreasury-EpochState</a> <a id="1822" class="Symbol">.</a><a id="1823" href="Ledger.PParams.html#814" class="Field">treasuryOf</a> <a id="1834" class="Symbol">=</a> <a id="1836" href="Ledger.PParams.html#729" class="Field">Acnt.treasury</a> <a id="1850" href="Function.Base.html#1115" class="Function Operator">∘</a> <a id="1852" href="Ledger.Epoch.html#1166" class="Field">EpochState.acnt</a>



<a id="1871" class="Keyword">record</a> <a id="NewEpochState"></a><a id="1878" href="Ledger.Epoch.html#1878" class="Record">NewEpochState</a> <a id="1892" class="Symbol">:</a> <a id="1894" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="1899" class="Keyword">where</a>
  <a id="1907" class="Keyword">field</a>
    <a id="NewEpochState.lastEpoch"></a><a id="1917" href="Ledger.Epoch.html#1917" class="Field">lastEpoch</a>   <a id="1929" class="Symbol">:</a> <a id="1931" href="Ledger.Types.Epoch.html#476" class="Function">Epoch</a>
    <a id="NewEpochState.epochState"></a><a id="1941" href="Ledger.Epoch.html#1941" class="Field">epochState</a>  <a id="1953" class="Symbol">:</a> <a id="1955" href="Ledger.Epoch.html#1098" class="Record">EpochState</a>
    <a id="NewEpochState.ru"></a><a id="1970" href="Ledger.Epoch.html#1970" class="Field">ru</a>          <a id="1982" class="Symbol">:</a> <a id="1984" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="1990" href="Ledger.Epoch.html#732" class="Record">RewardUpdate</a>


<a id="2005" class="Keyword">record</a> <a id="HasNewEpochState"></a><a id="2012" href="Ledger.Epoch.html#2012" class="Record">HasNewEpochState</a> <a id="2029" class="Symbol">{</a><a id="2030" href="Ledger.Epoch.html#2030" class="Bound">a</a><a id="2031" class="Symbol">}</a> <a id="2033" class="Symbol">(</a><a id="2034" href="Ledger.Epoch.html#2034" class="Bound">A</a> <a id="2036" class="Symbol">:</a> <a id="2038" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="2043" href="Ledger.Epoch.html#2030" class="Bound">a</a><a id="2044" class="Symbol">)</a> <a id="2046" class="Symbol">:</a> <a id="2048" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="2053" href="Ledger.Epoch.html#2030" class="Bound">a</a> <a id="2055" class="Keyword">where</a>
  <a id="2063" class="Keyword">field</a> <a id="HasNewEpochState.NewEpochStateOf"></a><a id="2069" href="Ledger.Epoch.html#2069" class="Field">NewEpochStateOf</a> <a id="2085" class="Symbol">:</a> <a id="2087" href="Ledger.Epoch.html#2034" class="Bound">A</a> <a id="2089" class="Symbol">→</a> <a id="2091" href="Ledger.Epoch.html#1878" class="Record">NewEpochState</a>
<a id="2105" class="Keyword">open</a> <a id="2110" href="Ledger.Epoch.html#2012" class="Module">HasNewEpochState</a> <a id="2127" class="Symbol">⦃...⦄</a> <a id="2133" class="Keyword">public</a>

<a id="2141" class="Keyword">instance</a>
  <a id="HasEpochState-NewEpochState"></a><a id="2152" href="Ledger.Epoch.html#2152" class="Function">HasEpochState-NewEpochState</a> <a id="2180" class="Symbol">:</a> <a id="2182" href="Ledger.Epoch.html#1301" class="Record">HasEpochState</a> <a id="2196" href="Ledger.Epoch.html#1878" class="Record">NewEpochState</a>
  <a id="2212" href="Ledger.Epoch.html#2152" class="Function">HasEpochState-NewEpochState</a> <a id="2240" class="Symbol">.</a><a id="2241" href="Ledger.Epoch.html#1355" class="Field">EpochStateOf</a> <a id="2254" class="Symbol">=</a> <a id="2256" href="Ledger.Epoch.html#1941" class="Field">NewEpochState.epochState</a>

  <a id="Hastreasury-NewEpochState"></a><a id="2284" href="Ledger.Epoch.html#2284" class="Function">Hastreasury-NewEpochState</a> <a id="2310" class="Symbol">:</a> <a id="2312" href="Ledger.PParams.html#762" class="Record">Hastreasury</a> <a id="2324" href="Ledger.Epoch.html#1878" class="Record">NewEpochState</a>
  <a id="2340" href="Ledger.Epoch.html#2284" class="Function">Hastreasury-NewEpochState</a> <a id="2366" class="Symbol">.</a><a id="2367" href="Ledger.PParams.html#814" class="Field">treasuryOf</a> <a id="2378" class="Symbol">=</a> <a id="2380" href="Ledger.PParams.html#814" class="Field">treasuryOf</a> <a id="2391" href="Function.Base.html#1115" class="Function Operator">∘</a> <a id="2393" href="Ledger.Epoch.html#1355" class="Field">EpochStateOf</a>

  <a id="HasLState-NewEpochState"></a><a id="2409" href="Ledger.Epoch.html#2409" class="Function">HasLState-NewEpochState</a> <a id="2433" class="Symbol">:</a> <a id="2435" href="Ledger.Ledger.html#954" class="Record">HasLState</a> <a id="2445" href="Ledger.Epoch.html#1878" class="Record">NewEpochState</a>
  <a id="2461" href="Ledger.Epoch.html#2409" class="Function">HasLState-NewEpochState</a> <a id="2485" class="Symbol">.</a><a id="2486" href="Ledger.Ledger.html#1004" class="Field">LStateOf</a> <a id="2495" class="Symbol">=</a> <a id="2497" href="Ledger.Ledger.html#1004" class="Field">LStateOf</a> <a id="2506" href="Function.Base.html#1115" class="Function Operator">∘</a> <a id="2508" href="Ledger.Epoch.html#1355" class="Field">EpochStateOf</a>

  <a id="HasGovState-NewEpochState"></a><a id="2524" href="Ledger.Epoch.html#2524" class="Function">HasGovState-NewEpochState</a> <a id="2550" class="Symbol">:</a> <a id="2552" href="Ledger.Gov.html#1408" class="Record">HasGovState</a> <a id="2564" href="Ledger.Epoch.html#1878" class="Record">NewEpochState</a>
  <a id="2580" href="Ledger.Epoch.html#2524" class="Function">HasGovState-NewEpochState</a> <a id="2606" class="Symbol">.</a><a id="2607" href="Ledger.Gov.html#1460" class="Field">GovStateOf</a> <a id="2618" class="Symbol">=</a> <a id="2620" href="Ledger.Gov.html#1460" class="Field">GovStateOf</a> <a id="2631" href="Function.Base.html#1115" class="Function Operator">∘</a> <a id="2633" href="Ledger.Ledger.html#1004" class="Field">LStateOf</a>

  <a id="HasCertState-NewEpochState"></a><a id="2645" href="Ledger.Epoch.html#2645" class="Function">HasCertState-NewEpochState</a> <a id="2672" class="Symbol">:</a> <a id="2674" href="Ledger.Certs.html#4025" class="Record">HasCertState</a> <a id="2687" href="Ledger.Epoch.html#1878" class="Record">NewEpochState</a>
  <a id="2703" href="Ledger.Epoch.html#2645" class="Function">HasCertState-NewEpochState</a> <a id="2730" class="Symbol">.</a><a id="2731" href="Ledger.Certs.html#4078" class="Field">CertStateOf</a> <a id="2743" class="Symbol">=</a> <a id="2745" href="Ledger.Certs.html#4078" class="Field">CertStateOf</a> <a id="2757" href="Function.Base.html#1115" class="Function Operator">∘</a> <a id="2759" href="Ledger.Ledger.html#1004" class="Field">LStateOf</a>

  <a id="HasDReps-NewEpochState"></a><a id="2771" href="Ledger.Epoch.html#2771" class="Function">HasDReps-NewEpochState</a> <a id="2794" class="Symbol">:</a> <a id="2796" href="Ledger.Certs.html#906" class="Record">HasDReps</a> <a id="2805" href="Ledger.Epoch.html#1878" class="Record">NewEpochState</a> 
  <a id="2822" href="Ledger.Epoch.html#2771" class="Function">HasDReps-NewEpochState</a> <a id="2845" class="Symbol">.</a><a id="2846" href="Ledger.Certs.html#955" class="Field">DRepsOf</a> <a id="2854" class="Symbol">=</a> <a id="2856" href="Ledger.Certs.html#955" class="Field">DRepsOf</a> <a id="2864" href="Function.Base.html#1115" class="Function Operator">∘</a> <a id="2866" href="Ledger.Certs.html#4078" class="Field">CertStateOf</a>

  <a id="HasRewards-NewEpochState"></a><a id="2881" href="Ledger.Epoch.html#2881" class="Function">HasRewards-NewEpochState</a> <a id="2906" class="Symbol">:</a> <a id="2908" href="Ledger.Certs.html#793" class="Record">HasRewards</a> <a id="2919" href="Ledger.Epoch.html#1878" class="Record">NewEpochState</a>
  <a id="2935" href="Ledger.Epoch.html#2881" class="Function">HasRewards-NewEpochState</a> <a id="2960" class="Symbol">.</a><a id="2961" href="Ledger.Certs.html#844" class="Field">RewardsOf</a> <a id="2971" class="Symbol">=</a> <a id="2973" href="Ledger.Certs.html#844" class="Field">RewardsOf</a> <a id="2983" href="Function.Base.html#1115" class="Function Operator">∘</a> <a id="2985" href="Ledger.Certs.html#4078" class="Field">CertStateOf</a>

  <a id="3000" class="Keyword">unquoteDecl</a> <a id="HasCast-RewardUpdate"></a><a id="3012" href="Ledger.Epoch.html#3012" class="Function">HasCast-RewardUpdate</a> <a id="HasCast-Snapshot"></a><a id="3033" href="Ledger.Epoch.html#3033" class="Function">HasCast-Snapshot</a> <a id="HasCast-Snapshots"></a><a id="3050" href="Ledger.Epoch.html#3050" class="Function">HasCast-Snapshots</a> <a id="HasCast-EpochState"></a><a id="3068" href="Ledger.Epoch.html#3068" class="Function">HasCast-EpochState</a> <a id="HasCast-NewEpochState"></a><a id="3087" href="Ledger.Epoch.html#3087" class="Function">HasCast-NewEpochState</a> <a id="3109" class="Symbol">=</a> <a id="3111" href="Class.HasCast.Derive.html#2660" class="Function">derive-HasCast</a>
    <a id="3130" class="Symbol">(</a>   <a id="3134" class="Symbol">(</a><a id="3135" class="Keyword">quote</a> <a id="3141" href="Ledger.Epoch.html#732" class="Record">RewardUpdate</a>   <a id="3156" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="3158" href="Ledger.Epoch.html#3012" class="Function">HasCast-RewardUpdate</a><a id="3178" class="Symbol">)</a>
    <a id="3184" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a>   <a id="3188" class="Symbol">(</a><a id="3189" class="Keyword">quote</a> <a id="3195" href="Ledger.Epoch.html#848" class="Record">Snapshot</a>       <a id="3210" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="3212" href="Ledger.Epoch.html#3033" class="Function">HasCast-Snapshot</a><a id="3228" class="Symbol">)</a>
    <a id="3234" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a>   <a id="3238" class="Symbol">(</a><a id="3239" class="Keyword">quote</a> <a id="3245" href="Ledger.Epoch.html#1006" class="Record">Snapshots</a>      <a id="3260" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="3262" href="Ledger.Epoch.html#3050" class="Function">HasCast-Snapshots</a><a id="3279" class="Symbol">)</a>
    <a id="3285" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a>   <a id="3289" class="Symbol">(</a><a id="3290" class="Keyword">quote</a> <a id="3296" href="Ledger.Epoch.html#1098" class="Record">EpochState</a>     <a id="3311" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="3313" href="Ledger.Epoch.html#3068" class="Function">HasCast-EpochState</a><a id="3331" class="Symbol">)</a>
    <a id="3337" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="3339" href="Data.List.Base.html#5205" class="Function Operator">[</a> <a id="3341" class="Symbol">(</a><a id="3342" class="Keyword">quote</a> <a id="3348" href="Ledger.Epoch.html#1878" class="Record">NewEpochState</a>  <a id="3363" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="3365" href="Ledger.Epoch.html#3087" class="Function">HasCast-NewEpochState</a><a id="3386" class="Symbol">)</a><a id="3387" href="Data.List.Base.html#5205" class="Function Operator">]</a><a id="3388" class="Symbol">)</a>

<a id="3391" class="Keyword">instance</a> <a id="3400" href="Ledger.Epoch.html#3400" class="Function">_</a> <a id="3402" class="Symbol">=</a> <a id="3404" href="Data.Nat.Properties.html#17252" class="Function">+-0-monoid</a><a id="3414" class="Symbol">;</a> <a id="3416" href="Ledger.Epoch.html#3416" class="Function">_</a> <a id="3418" class="Symbol">=</a> <a id="3420" href="Data.Nat.Properties.html#17331" class="Function">+-0-commutativeMonoid</a>

<a id="toRwdAddr"></a><a id="3443" href="Ledger.Epoch.html#3443" class="Function">toRwdAddr</a> <a id="3453" class="Symbol">:</a> <a id="3455" href="Ledger.Address.html#273" class="Datatype">Credential</a> <a id="3466" class="Symbol">→</a> <a id="3468" href="Ledger.Address.html#1336" class="Record">RwdAddr</a>
<a id="3476" href="Ledger.Epoch.html#3443" class="Function">toRwdAddr</a> <a id="3486" href="Ledger.Epoch.html#3486" class="Bound">x</a> <a id="3488" class="Symbol">=</a> <a id="3490" class="Keyword">record</a> <a id="3497" class="Symbol">{</a> <a id="3499" href="Ledger.Address.html#1365" class="Field">net</a> <a id="3503" class="Symbol">=</a> <a id="3505" href="Ledger.Types.Epoch.html#2154" class="Function">NetworkId</a> <a id="3515" class="Symbol">;</a> <a id="3517" href="Ledger.Address.html#1390" class="Field">stake</a> <a id="3523" class="Symbol">=</a> <a id="3525" href="Ledger.Epoch.html#3486" class="Bound">x</a> <a id="3527" class="Symbol">}</a>

<a id="getStakeCred"></a><a id="3530" href="Ledger.Epoch.html#3530" class="Function">getStakeCred</a> <a id="3543" class="Symbol">:</a> <a id="3545" href="Ledger.Transaction.html#2334" class="Function">TxOut</a> <a id="3551" class="Symbol">→</a> <a id="3553" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="3559" href="Ledger.Address.html#273" class="Datatype">Credential</a>
<a id="3570" href="Ledger.Epoch.html#3530" class="Function">getStakeCred</a> <a id="3583" class="Symbol">(</a><a id="3584" href="Ledger.Epoch.html#3584" class="Bound">a</a> <a id="3586" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="3588" class="Symbol">_</a> <a id="3590" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="3592" class="Symbol">_</a> <a id="3594" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="3596" class="Symbol">_)</a> <a id="3599" class="Symbol">=</a> <a id="3601" href="Ledger.Address.html#2508" class="Function">stakeCred</a> <a id="3611" href="Ledger.Epoch.html#3584" class="Bound">a</a>

<a id="3614" class="Keyword">open</a> <a id="3619" href="Ledger.Address.html#1336" class="Module">RwdAddr</a> <a id="3627" class="Keyword">using</a> <a id="3633" class="Symbol">(</a><a id="3634" href="Ledger.Address.html#1390" class="Field">stake</a><a id="3639" class="Symbol">)</a>
<a id="3641" class="Keyword">open</a> <a id="3646" href="Ledger.GovernanceActions.html#2594" class="Module">GovActionState</a> <a id="3661" class="Keyword">using</a> <a id="3667" class="Symbol">(</a><a id="3668" href="Ledger.GovernanceActions.html#2665" class="Field">returnAddr</a><a id="3678" class="Symbol">)</a>


<a id="applyRUpd"></a><a id="3682" href="Ledger.Epoch.html#3682" class="Function">applyRUpd</a> <a id="3692" class="Symbol">:</a> <a id="3694" href="Ledger.Epoch.html#732" class="Record">RewardUpdate</a> <a id="3707" class="Symbol">→</a> <a id="3709" href="Ledger.Epoch.html#1098" class="Record">EpochState</a> <a id="3720" class="Symbol">→</a> <a id="3722" href="Ledger.Epoch.html#1098" class="Record">EpochState</a>
<a id="3733" href="Ledger.Epoch.html#3682" class="Function">applyRUpd</a> <a id="3743" href="Ledger.Epoch.html#773" class="InductiveConstructor Operator">⟦</a> <a id="3745" href="Ledger.Epoch.html#3745" class="Bound">Δt</a> <a id="3748" href="Ledger.Epoch.html#773" class="InductiveConstructor Operator">,</a> <a id="3750" href="Ledger.Epoch.html#3750" class="Bound">Δr</a> <a id="3753" href="Ledger.Epoch.html#773" class="InductiveConstructor Operator">,</a> <a id="3755" href="Ledger.Epoch.html#3755" class="Bound">Δf</a> <a id="3758" href="Ledger.Epoch.html#773" class="InductiveConstructor Operator">,</a> <a id="3760" href="Ledger.Epoch.html#3760" class="Bound">rs</a> <a id="3763" href="Ledger.Epoch.html#773" class="InductiveConstructor Operator">⟧ʳᵘ</a>
  <a id="3769" href="Ledger.Epoch.html#1138" class="InductiveConstructor Operator">⟦</a> <a id="3771" href="Ledger.PParams.html#708" class="InductiveConstructor Operator">⟦</a> <a id="3773" href="Ledger.Epoch.html#3773" class="Bound">treasury</a> <a id="3782" href="Ledger.PParams.html#708" class="InductiveConstructor Operator">,</a> <a id="3784" href="Ledger.Epoch.html#3784" class="Bound">reserves</a> <a id="3793" href="Ledger.PParams.html#708" class="InductiveConstructor Operator">⟧ᵃ</a>
  <a id="3798" href="Ledger.Epoch.html#1138" class="InductiveConstructor Operator">,</a> <a id="3800" href="Ledger.Epoch.html#3800" class="Bound">ss</a>
  <a id="3805" href="Ledger.Epoch.html#1138" class="InductiveConstructor Operator">,</a> <a id="3807" href="Ledger.Ledger.html#845" class="InductiveConstructor Operator">⟦</a> <a id="3809" href="Ledger.Utxo.html#2600" class="InductiveConstructor Operator">⟦</a> <a id="3811" href="Ledger.Epoch.html#3811" class="Bound">utxo</a> <a id="3816" href="Ledger.Utxo.html#2600" class="InductiveConstructor Operator">,</a> <a id="3818" href="Ledger.Epoch.html#3818" class="Bound">fees</a> <a id="3823" href="Ledger.Utxo.html#2600" class="InductiveConstructor Operator">,</a> <a id="3825" href="Ledger.Epoch.html#3825" class="Bound">deposits</a> <a id="3834" href="Ledger.Utxo.html#2600" class="InductiveConstructor Operator">,</a> <a id="3836" href="Ledger.Epoch.html#3836" class="Bound">donations</a> <a id="3846" href="Ledger.Utxo.html#2600" class="InductiveConstructor Operator">⟧ᵘ</a>
    <a id="3853" href="Ledger.Ledger.html#845" class="InductiveConstructor Operator">,</a> <a id="3855" href="Ledger.Epoch.html#3855" class="Bound">govSt</a>
    <a id="3865" href="Ledger.Ledger.html#845" class="InductiveConstructor Operator">,</a> <a id="3867" href="Ledger.Certs.html#3936" class="InductiveConstructor Operator">⟦</a> <a id="3869" href="Ledger.Certs.html#2999" class="InductiveConstructor Operator">⟦</a> <a id="3871" href="Ledger.Epoch.html#3871" class="Bound">voteDelegs</a> <a id="3882" href="Ledger.Certs.html#2999" class="InductiveConstructor Operator">,</a> <a id="3884" href="Ledger.Epoch.html#3884" class="Bound">stakeDelegs</a> <a id="3896" href="Ledger.Certs.html#2999" class="InductiveConstructor Operator">,</a> <a id="3898" href="Ledger.Epoch.html#3898" class="Bound">rewards</a> <a id="3906" href="Ledger.Certs.html#2999" class="InductiveConstructor Operator">⟧ᵈ</a> <a id="3909" href="Ledger.Certs.html#3936" class="InductiveConstructor Operator">,</a> <a id="3911" href="Ledger.Epoch.html#3911" class="Bound">pState</a> <a id="3918" href="Ledger.Certs.html#3936" class="InductiveConstructor Operator">,</a> <a id="3920" href="Ledger.Epoch.html#3920" class="Bound">gState</a> <a id="3927" href="Ledger.Certs.html#3936" class="InductiveConstructor Operator">⟧ᶜˢ</a> <a id="3931" href="Ledger.Ledger.html#845" class="InductiveConstructor Operator">⟧ˡ</a>
  <a id="3936" href="Ledger.Epoch.html#1138" class="InductiveConstructor Operator">,</a> <a id="3938" href="Ledger.Epoch.html#3938" class="Bound">es</a>
  <a id="3943" href="Ledger.Epoch.html#1138" class="InductiveConstructor Operator">,</a> <a id="3945" href="Ledger.Epoch.html#3945" class="Bound">fut</a>
  <a id="3951" href="Ledger.Epoch.html#1138" class="InductiveConstructor Operator">⟧ᵉ&#39;</a> <a id="3955" class="Symbol">=</a>
  <a id="3959" href="Ledger.Prelude.html#2291" class="Function Operator">⟦</a> <a id="3961" href="Ledger.Prelude.html#2291" class="Function Operator">⟦</a> <a id="3963" href="Prelude.html#3167" class="Function">posPart</a> <a id="3971" class="Symbol">(</a><a id="3972" href="Ledger.Epoch.html#187" class="InductiveConstructor">pos</a> <a id="3976" href="Ledger.Epoch.html#3773" class="Bound">treasury</a> <a id="3985" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="3987" href="Ledger.Epoch.html#3745" class="Bound">Δt</a> <a id="3990" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="3992" href="Ledger.Epoch.html#187" class="InductiveConstructor">pos</a> <a id="3996" href="Ledger.Epoch.html#4300" class="Function">unregRU&#39;</a><a id="4004" class="Symbol">)</a>
    <a id="4010" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="4012" href="Prelude.html#3167" class="Function">posPart</a> <a id="4020" class="Symbol">(</a><a id="4021" href="Ledger.Epoch.html#187" class="InductiveConstructor">pos</a> <a id="4025" href="Ledger.Epoch.html#3784" class="Bound">reserves</a> <a id="4034" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="4036" href="Ledger.Epoch.html#3750" class="Bound">Δr</a><a id="4038" class="Symbol">)</a> <a id="4040" href="Ledger.Prelude.html#2291" class="Function Operator">⟧</a>
  <a id="4044" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="4046" href="Ledger.Epoch.html#3800" class="Bound">ss</a>
  <a id="4051" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="4053" href="Ledger.Prelude.html#2291" class="Function Operator">⟦</a> <a id="4055" href="Ledger.Prelude.html#2291" class="Function Operator">⟦</a> <a id="4057" href="Ledger.Epoch.html#3811" class="Bound">utxo</a> <a id="4062" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="4064" href="Prelude.html#3167" class="Function">posPart</a> <a id="4072" class="Symbol">(</a><a id="4073" href="Ledger.Epoch.html#187" class="InductiveConstructor">pos</a> <a id="4077" href="Ledger.Epoch.html#3818" class="Bound">fees</a> <a id="4082" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="4084" href="Ledger.Epoch.html#3755" class="Bound">Δf</a><a id="4086" class="Symbol">)</a> <a id="4088" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="4090" href="Ledger.Epoch.html#3825" class="Bound">deposits</a> <a id="4099" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="4101" href="Ledger.Epoch.html#3836" class="Bound">donations</a> <a id="4111" href="Ledger.Prelude.html#2291" class="Function Operator">⟧</a>
    <a id="4117" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="4119" href="Ledger.Epoch.html#3855" class="Bound">govSt</a>
    <a id="4129" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="4131" href="Ledger.Prelude.html#2291" class="Function Operator">⟦</a> <a id="4133" href="Ledger.Prelude.html#2291" class="Function Operator">⟦</a> <a id="4135" href="Ledger.Epoch.html#3871" class="Bound">voteDelegs</a> <a id="4146" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="4148" href="Ledger.Epoch.html#3884" class="Bound">stakeDelegs</a> <a id="4160" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="4162" href="Ledger.Epoch.html#3898" class="Bound">rewards</a> <a id="4170" href="Axiom.Set.Map.Dec.html#1854" class="Function Operator">∪⁺</a> <a id="4173" href="Ledger.Epoch.html#4232" class="Function">regRU</a> <a id="4179" href="Ledger.Prelude.html#2291" class="Function Operator">⟧</a> <a id="4181" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="4183" href="Ledger.Epoch.html#3911" class="Bound">pState</a> <a id="4190" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="4192" href="Ledger.Epoch.html#3920" class="Bound">gState</a> <a id="4199" href="Ledger.Prelude.html#2291" class="Function Operator">⟧</a> <a id="4201" href="Ledger.Prelude.html#2291" class="Function Operator">⟧</a>
  <a id="4205" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="4207" href="Ledger.Epoch.html#3938" class="Bound">es</a>
  <a id="4212" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="4214" href="Ledger.Epoch.html#3945" class="Bound">fut</a> <a id="4218" href="Ledger.Prelude.html#2291" class="Function Operator">⟧</a>
  <a id="4222" class="Keyword">where</a>
    <a id="4232" href="Ledger.Epoch.html#4232" class="Function">regRU</a>     <a id="4242" class="Symbol">=</a> <a id="4244" href="Ledger.Epoch.html#3760" class="Bound">rs</a> <a id="4247" href="Axiom.Set.Map.html#10678" class="Function Operator">∣</a> <a id="4249" href="Class.IsSet.html#916" class="Function">dom</a> <a id="4253" href="Ledger.Epoch.html#3898" class="Bound">rewards</a>
    <a id="4265" href="Ledger.Epoch.html#4265" class="Function">unregRU</a>   <a id="4275" class="Symbol">=</a> <a id="4277" href="Ledger.Epoch.html#3760" class="Bound">rs</a> <a id="4280" href="Axiom.Set.Map.html#10748" class="Function Operator">∣</a> <a id="4282" href="Class.IsSet.html#916" class="Function">dom</a> <a id="4286" href="Ledger.Epoch.html#3898" class="Bound">rewards</a> <a id="4294" href="Axiom.Set.Map.html#10748" class="Function Operator">ᶜ</a>
    <a id="4300" href="Ledger.Epoch.html#4300" class="Function">unregRU&#39;</a>  <a id="4310" class="Symbol">=</a> <a id="4312" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">∑[</a> <a id="4315" href="Ledger.Epoch.html#4315" class="Bound">x</a> <a id="4317" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">←</a> <a id="4319" href="Ledger.Epoch.html#4265" class="Function">unregRU</a> <a id="4327" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">]</a> <a id="4329" href="Ledger.Epoch.html#4315" class="Bound">x</a>

<a id="getOrphans"></a><a id="4332" href="Ledger.Epoch.html#4332" class="Function">getOrphans</a> <a id="4343" class="Symbol">:</a> <a id="4345" href="Ledger.Enact.html#397" class="Record">EnactState</a> <a id="4356" class="Symbol">→</a> <a id="4358" href="Ledger.Gov.html#1334" class="Function">GovState</a> <a id="4367" class="Symbol">→</a> <a id="4369" href="Ledger.Gov.html#1334" class="Function">GovState</a>
<a id="4378" href="Ledger.Epoch.html#4332" class="Function">getOrphans</a> <a id="4389" href="Ledger.Epoch.html#4389" class="Bound">es</a> <a id="4392" href="Ledger.Epoch.html#4392" class="Bound">govSt</a> <a id="4398" class="Symbol">=</a> <a id="4400" href="Data.Product.Base.html#636" class="Field">proj₁</a> <a id="4406" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="4408" href="Data.Nat.GeneralisedArithmetic.html#866" class="Function">iterate</a> <a id="4416" href="Ledger.Epoch.html#4461" class="Function">step</a> <a id="4421" class="Symbol">(</a><a id="4422" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a> <a id="4425" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="4427" href="Ledger.Epoch.html#4392" class="Bound">govSt</a><a id="4432" class="Symbol">)</a> <a id="4434" class="Symbol">(</a><a id="4435" href="Data.List.Base.html#5044" class="Function">length</a> <a id="4442" href="Ledger.Epoch.html#4392" class="Bound">govSt</a><a id="4447" class="Symbol">)</a>
  <a id="4451" class="Keyword">where</a>
    <a id="4461" href="Ledger.Epoch.html#4461" class="Function">step</a> <a id="4466" class="Symbol">:</a> <a id="4468" href="Ledger.Gov.html#1334" class="Function">GovState</a> <a id="4477" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="4479" href="Ledger.Gov.html#1334" class="Function">GovState</a> <a id="4488" class="Symbol">→</a> <a id="4490" href="Ledger.Gov.html#1334" class="Function">GovState</a> <a id="4499" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="4501" href="Ledger.Gov.html#1334" class="Function">GovState</a>
    <a id="4514" href="Ledger.Epoch.html#4461" class="Function">step</a> <a id="4519" class="Symbol">(</a><a id="4520" href="Ledger.Epoch.html#4520" class="Bound">orps</a> <a id="4525" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="4527" href="Ledger.Epoch.html#4527" class="Bound">govSt</a><a id="4532" class="Symbol">)</a> <a id="4534" class="Symbol">=</a>
      <a id="4542" class="Keyword">let</a>
        <a id="4554" href="Ledger.Epoch.html#4554" class="Bound">isOrphan?</a> <a id="4564" href="Ledger.Epoch.html#4564" class="Bound">a</a> <a id="4566" href="Ledger.Epoch.html#4566" class="Bound">prev</a> <a id="4571" class="Symbol">=</a> <a id="4573" href="Relation.Nullary.Decidable.Core.html#3011" class="Function">¬?</a> <a id="4576" class="Symbol">(</a><a id="4577" href="Ledger.Gov.html#8661" class="Function">hasParent?</a> <a id="4588" href="Ledger.Epoch.html#4389" class="Bound">es</a> <a id="4591" href="Ledger.Epoch.html#4527" class="Bound">govSt</a> <a id="4597" href="Ledger.Epoch.html#4564" class="Bound">a</a> <a id="4599" href="Ledger.Epoch.html#4566" class="Bound">prev</a><a id="4603" class="Symbol">)</a>
        <a id="4613" class="Symbol">(</a><a id="4614" href="Ledger.Epoch.html#4614" class="Bound">orps&#39;</a> <a id="4620" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="4622" href="Ledger.Epoch.html#4622" class="Bound">govSt&#39;</a><a id="4628" class="Symbol">)</a> <a id="4630" class="Symbol">=</a> <a id="4632" href="Data.List.Base.html#10926" class="Function">partition</a>
          <a id="4652" class="Symbol">(λ</a> <a id="4655" class="Symbol">(_</a> <a id="4658" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="4660" class="Keyword">record</a> <a id="4667" class="Symbol">{</a><a id="4668" href="Ledger.GovernanceActions.html#2715" class="Field">action</a> <a id="4675" class="Symbol">=</a> <a id="4677" href="Ledger.Epoch.html#4677" class="Bound">a</a> <a id="4679" class="Symbol">;</a> <a id="4681" href="Ledger.GovernanceActions.html#2743" class="Field">prevAction</a> <a id="4692" class="Symbol">=</a> <a id="4694" href="Ledger.Epoch.html#4694" class="Bound">prev</a><a id="4698" class="Symbol">})</a> <a id="4701" class="Symbol">→</a> <a id="4703" href="Ledger.Epoch.html#4554" class="Bound">isOrphan?</a> <a id="4713" class="Symbol">(</a><a id="4714" href="Ledger.Epoch.html#4677" class="Bound">a</a> <a id="4716" class="Symbol">.</a><a id="4717" href="Ledger.GovernanceActions.html#1429" class="Field">gaType</a><a id="4723" class="Symbol">)</a> <a id="4725" href="Ledger.Epoch.html#4694" class="Bound">prev</a><a id="4729" class="Symbol">)</a> <a id="4731" href="Ledger.Epoch.html#4527" class="Bound">govSt</a>
      <a id="4743" class="Keyword">in</a>
        <a id="4754" class="Symbol">(</a><a id="4755" href="Ledger.Epoch.html#4520" class="Bound">orps</a> <a id="4760" href="Data.List.Base.html#1734" class="Function Operator">++</a> <a id="4763" href="Ledger.Epoch.html#4614" class="Bound">orps&#39;</a> <a id="4769" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="4771" href="Ledger.Epoch.html#4622" class="Bound">govSt&#39;</a><a id="4777" class="Symbol">)</a>


<a id="stakeDistr"></a><a id="4781" href="Ledger.Epoch.html#4781" class="Function">stakeDistr</a> <a id="4792" class="Symbol">:</a> <a id="4794" href="Ledger.Transaction.html#2402" class="Function">UTxO</a> <a id="4799" class="Symbol">→</a> <a id="4801" href="Ledger.Certs.html#2963" class="Record">DState</a> <a id="4808" class="Symbol">→</a> <a id="4810" href="Ledger.Certs.html#3351" class="Record">PState</a> <a id="4817" class="Symbol">→</a> <a id="4819" href="Ledger.Epoch.html#848" class="Record">Snapshot</a>
<a id="4828" href="Ledger.Epoch.html#4781" class="Function">stakeDistr</a> <a id="4839" href="Ledger.Epoch.html#4839" class="Bound">utxo</a> <a id="4844" href="Ledger.Epoch.html#4844" class="Bound">stᵈ</a> <a id="4848" href="Ledger.Epoch.html#4848" class="Bound">pState</a> <a id="4855" class="Symbol">=</a> <a id="4857" href="Ledger.Prelude.html#2291" class="Function Operator">⟦</a> <a id="4859" href="Axiom.Set.Map.Dec.html#1932" class="Function">aggregate₊</a> <a id="4870" class="Symbol">(</a><a id="4871" href="Ledger.Epoch.html#5057" class="Function">stakeRelation</a> <a id="4885" href="abstract-set-theory.FiniteSetTheory.html#2767" class="Function Operator">ᶠˢ</a><a id="4887" class="Symbol">)</a> <a id="4889" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="4891" href="Ledger.Certs.html#3061" class="Function">stakeDelegs</a> <a id="4903" href="Ledger.Prelude.html#2291" class="Function Operator">⟧</a>
  <a id="4907" class="Keyword">where</a>
    <a id="4917" class="Keyword">open</a> <a id="4922" href="Ledger.Certs.html#2963" class="Module">DState</a> <a id="4929" href="Ledger.Epoch.html#4844" class="Bound">stᵈ</a> <a id="4933" class="Keyword">using</a> <a id="4939" class="Symbol">(</a><a id="4940" href="Ledger.Certs.html#3061" class="Field">stakeDelegs</a><a id="4951" class="Symbol">;</a> <a id="4953" href="Ledger.Certs.html#3101" class="Field">rewards</a><a id="4960" class="Symbol">)</a>
    <a id="4966" href="Ledger.Epoch.html#4966" class="Function">m</a> <a id="4968" class="Symbol">=</a> <a id="4970" href="abstract-set-theory.FiniteSetTheory.html#519" class="Function">mapˢ</a> <a id="4975" class="Symbol">(λ</a> <a id="4978" href="Ledger.Epoch.html#4978" class="Bound">a</a> <a id="4980" class="Symbol">→</a> <a id="4982" class="Symbol">(</a><a id="4983" href="Ledger.Epoch.html#4978" class="Bound">a</a> <a id="4985" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="4987" href="Ledger.Utxo.html#3499" class="Function">cbalance</a> <a id="4996" class="Symbol">(</a><a id="4997" href="Ledger.Epoch.html#4839" class="Bound">utxo</a> <a id="5002" href="abstract-set-theory.FiniteSetTheory.html#3088" class="Function Operator">∣^&#39;</a> <a id="5006" class="Symbol">λ</a> <a id="5008" href="Ledger.Epoch.html#5008" class="Bound">i</a> <a id="5010" class="Symbol">→</a> <a id="5012" href="Ledger.Epoch.html#3530" class="Function">getStakeCred</a> <a id="5025" href="Ledger.Epoch.html#5008" class="Bound">i</a> <a id="5027" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="5029" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="5034" href="Ledger.Epoch.html#4978" class="Bound">a</a><a id="5035" class="Symbol">)))</a> <a id="5039" class="Symbol">(</a><a id="5040" href="Class.IsSet.html#916" class="Function">dom</a> <a id="5044" href="Ledger.Certs.html#3101" class="Function">rewards</a><a id="5051" class="Symbol">)</a>
    <a id="5057" href="Ledger.Epoch.html#5057" class="Function">stakeRelation</a> <a id="5071" class="Symbol">=</a> <a id="5073" href="Ledger.Epoch.html#4966" class="Function">m</a> <a id="5075" href="Axiom.Set.html#8952" class="Function Operator">∪</a> <a id="5077" href="Ledger.Prelude.html#2393" class="Function Operator">∣</a> <a id="5079" href="Ledger.Certs.html#3101" class="Function">rewards</a> <a id="5087" href="Ledger.Prelude.html#2393" class="Function Operator">∣</a>

<a id="gaDepositStake"></a><a id="5090" href="Ledger.Epoch.html#5090" class="Function">gaDepositStake</a> <a id="5105" class="Symbol">:</a> <a id="5107" href="Ledger.Gov.html#1334" class="Function">GovState</a> <a id="5116" class="Symbol">→</a> <a id="5118" href="Ledger.Certs.html#573" class="Function">Deposits</a> <a id="5127" class="Symbol">→</a> <a id="5129" href="Ledger.Address.html#273" class="Datatype">Credential</a> <a id="5140" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="5142" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a>
<a id="5147" href="Ledger.Epoch.html#5090" class="Function">gaDepositStake</a> <a id="5162" href="Ledger.Epoch.html#5162" class="Bound">govSt</a> <a id="5168" href="Ledger.Epoch.html#5168" class="Bound">ds</a> <a id="5171" class="Symbol">=</a> <a id="5173" href="abstract-set-theory.FiniteSetTheory.html#3599" class="Function">aggregateBy</a>
  <a id="5187" class="Symbol">(</a><a id="5188" href="abstract-set-theory.FiniteSetTheory.html#519" class="Function">mapˢ</a> <a id="5193" class="Symbol">(λ</a> <a id="5196" class="Symbol">(</a><a id="5197" href="Ledger.Epoch.html#5197" class="Bound">gaid</a> <a id="5202" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5204" href="Ledger.Epoch.html#5204" class="Bound">addr</a><a id="5208" class="Symbol">)</a> <a id="5210" class="Symbol">→</a> <a id="5212" class="Symbol">(</a><a id="5213" href="Ledger.Epoch.html#5197" class="Bound">gaid</a> <a id="5218" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5220" href="Ledger.Epoch.html#5204" class="Bound">addr</a><a id="5224" class="Symbol">)</a> <a id="5226" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5228" href="Ledger.Address.html#1390" class="Field">stake</a> <a id="5234" href="Ledger.Epoch.html#5204" class="Bound">addr</a><a id="5238" class="Symbol">)</a> <a id="5240" href="Ledger.Epoch.html#5338" class="Function">govSt&#39;</a><a id="5246" class="Symbol">)</a>
  <a id="5250" class="Symbol">(</a><a id="5251" href="Axiom.Set.Map.html#10460" class="Function">mapFromPartialFun</a> <a id="5269" class="Symbol">(λ</a> <a id="5272" class="Symbol">(</a><a id="5273" href="Ledger.Epoch.html#5273" class="Bound">gaid</a> <a id="5278" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5280" class="Symbol">_)</a> <a id="5283" class="Symbol">→</a> <a id="5285" href="Axiom.Set.Map.html#13670" class="Function">lookupᵐ?</a> <a id="5294" href="Ledger.Epoch.html#5168" class="Bound">ds</a> <a id="5297" class="Symbol">(</a><a id="5298" href="Ledger.Certs.html#521" class="InductiveConstructor">GovActionDeposit</a> <a id="5315" href="Ledger.Epoch.html#5273" class="Bound">gaid</a><a id="5319" class="Symbol">))</a> <a id="5322" href="Ledger.Epoch.html#5338" class="Function">govSt&#39;</a><a id="5328" class="Symbol">)</a>
  <a id="5332" class="Keyword">where</a> <a id="5338" href="Ledger.Epoch.html#5338" class="Function">govSt&#39;</a> <a id="5345" class="Symbol">=</a> <a id="5347" href="abstract-set-theory.FiniteSetTheory.html#519" class="Function">mapˢ</a> <a id="5352" class="Symbol">(</a><a id="5353" href="Class.Bifunctor.html#1152" class="Function">map₂</a> <a id="5358" href="Ledger.GovernanceActions.html#2665" class="Field">returnAddr</a><a id="5368" class="Symbol">)</a> <a id="5370" class="Symbol">(</a><a id="5371" href="Axiom.Set.html#5718" class="Function">fromList</a> <a id="5380" href="Ledger.Epoch.html#5162" class="Bound">govSt</a><a id="5385" class="Symbol">)</a>



<a id="5390" class="Keyword">opaque</a>


  <a id="mkStakeDistrs"></a><a id="5401" href="Ledger.Epoch.html#5401" class="Function">mkStakeDistrs</a> <a id="5415" class="Symbol">:</a> <a id="5417" href="Ledger.Epoch.html#848" class="Record">Snapshot</a> <a id="5426" class="Symbol">→</a> <a id="5428" href="Ledger.Gov.html#1334" class="Function">GovState</a> <a id="5437" class="Symbol">→</a> <a id="5439" href="Ledger.Certs.html#573" class="Function">Deposits</a> <a id="5448" class="Symbol">→</a> <a id="5450" class="Symbol">(</a><a id="5451" href="Ledger.Address.html#273" class="Datatype">Credential</a> <a id="5462" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="5464" href="Ledger.GovernanceActions.html#458" class="Datatype">VDeleg</a><a id="5470" class="Symbol">)</a> <a id="5472" class="Symbol">→</a> <a id="5474" href="Ledger.Ratify.html#2859" class="Record">StakeDistrs</a>
  <a id="5488" href="Ledger.Epoch.html#5401" class="Function">mkStakeDistrs</a> <a id="5502" href="Ledger.Epoch.html#5502" class="Bound">ss</a> <a id="5505" href="Ledger.Epoch.html#5505" class="Bound">govSt</a> <a id="5511" href="Ledger.Epoch.html#5511" class="Bound">ds</a> <a id="5514" href="Ledger.Epoch.html#5514" class="Bound">delegations</a> <a id="5526" class="Symbol">.</a><a id="5527" href="Ledger.Ratify.html#2896" class="Field">StakeDistrs.stakeDistr</a> <a id="5550" class="Symbol">=</a>
    <a id="5556" href="abstract-set-theory.FiniteSetTheory.html#3599" class="Function">aggregateBy</a> <a id="5568" href="Ledger.Prelude.html#2393" class="Function Operator">∣</a> <a id="5570" href="Ledger.Epoch.html#5514" class="Bound">delegations</a> <a id="5582" href="Ledger.Prelude.html#2393" class="Function Operator">∣</a> <a id="5584" class="Symbol">(</a><a id="5585" href="Ledger.Epoch.html#881" class="Field">Snapshot.stake</a> <a id="5600" href="Ledger.Epoch.html#5502" class="Bound">ss</a> <a id="5603" href="Axiom.Set.Map.Dec.html#1854" class="Function Operator">∪⁺</a> <a id="5606" href="Ledger.Epoch.html#5090" class="Function">gaDepositStake</a> <a id="5621" href="Ledger.Epoch.html#5505" class="Bound">govSt</a> <a id="5627" href="Ledger.Epoch.html#5511" class="Bound">ds</a><a id="5629" class="Symbol">)</a>


<a id="5633" class="Keyword">private</a> <a id="5641" class="Keyword">variable</a>
  <a id="5652" href="Ledger.Epoch.html#5652" class="Generalizable">nes</a> <a id="5656" href="Ledger.Epoch.html#5656" class="Generalizable">nes&#39;</a> <a id="5661" class="Symbol">:</a> <a id="5663" href="Ledger.Epoch.html#1878" class="Record">NewEpochState</a>
  <a id="5679" href="Ledger.Epoch.html#5679" class="Generalizable">e</a> <a id="5681" href="Ledger.Epoch.html#5681" class="Generalizable">lastEpoch</a> <a id="5691" class="Symbol">:</a> <a id="5693" href="Ledger.Types.Epoch.html#476" class="Function">Epoch</a>
  <a id="5701" href="Ledger.Epoch.html#5701" class="Generalizable">fut</a> <a id="5705" href="Ledger.Epoch.html#5705" class="Generalizable">fut&#39;</a> <a id="5710" class="Symbol">:</a> <a id="5712" href="Ledger.Ratify.html#3224" class="Record">RatifyState</a>
  <a id="5726" href="Ledger.Epoch.html#5726" class="Generalizable">eps</a> <a id="5730" href="Ledger.Epoch.html#5730" class="Generalizable">eps&#39;</a> <a id="5735" href="Ledger.Epoch.html#5735" class="Generalizable">eps&#39;&#39;</a> <a id="5741" class="Symbol">:</a> <a id="5743" href="Ledger.Epoch.html#1098" class="Record">EpochState</a>
  <a id="5756" href="Ledger.Epoch.html#5756" class="Generalizable">ls</a> <a id="5759" class="Symbol">:</a> <a id="5761" href="Ledger.Ledger.html#809" class="Record">LState</a>
  <a id="5770" href="Ledger.Epoch.html#5770" class="Generalizable">acnt</a> <a id="5775" class="Symbol">:</a> <a id="5777" href="Ledger.PParams.html#674" class="Record">Acnt</a>
  <a id="5784" href="Ledger.Epoch.html#5784" class="Generalizable">es₀</a> <a id="5788" class="Symbol">:</a> <a id="5790" href="Ledger.Enact.html#397" class="Record">EnactState</a>
  <a id="5803" href="Ledger.Epoch.html#5803" class="Generalizable">mark</a> <a id="5808" href="Ledger.Epoch.html#5808" class="Generalizable">set</a> <a id="5812" href="Ledger.Epoch.html#5812" class="Generalizable">go</a> <a id="5815" class="Symbol">:</a> <a id="5817" href="Ledger.Epoch.html#848" class="Record">Snapshot</a>
  <a id="5828" href="Ledger.Epoch.html#5828" class="Generalizable">feeSS</a> <a id="5834" class="Symbol">:</a> <a id="5836" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a>
  <a id="5843" href="Ledger.Epoch.html#5843" class="Generalizable">lstate</a> <a id="5850" class="Symbol">:</a> <a id="5852" href="Ledger.Ledger.html#809" class="Record">LState</a>
  <a id="5861" href="Ledger.Epoch.html#5861" class="Generalizable">ss</a> <a id="5864" href="Ledger.Epoch.html#5864" class="Generalizable">ss&#39;</a> <a id="5868" class="Symbol">:</a> <a id="5870" href="Ledger.Epoch.html#1006" class="Record">Snapshots</a>
  <a id="5882" href="Ledger.Epoch.html#5882" class="Generalizable">ru</a> <a id="5885" class="Symbol">:</a> <a id="5887" href="Ledger.Epoch.html#732" class="Record">RewardUpdate</a>
  <a id="5902" href="Ledger.Epoch.html#5902" class="Generalizable">mru</a> <a id="5906" class="Symbol">:</a> <a id="5908" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="5914" href="Ledger.Epoch.html#732" class="Record">RewardUpdate</a>


<a id="5929" class="Keyword">data</a> <a id="_⊢_⇀⦇_,SNAP⦈_"></a><a id="5934" href="Ledger.Epoch.html#5934" class="Datatype Operator">_⊢_⇀⦇_,SNAP⦈_</a> <a id="5948" class="Symbol">:</a> <a id="5950" href="Ledger.Ledger.html#809" class="Record">LState</a> <a id="5957" class="Symbol">→</a> <a id="5959" href="Ledger.Epoch.html#1006" class="Record">Snapshots</a> <a id="5969" class="Symbol">→</a> <a id="5971" href="Agda.Builtin.Unit.html#175" class="Record">⊤</a> <a id="5973" class="Symbol">→</a> <a id="5975" href="Ledger.Epoch.html#1006" class="Record">Snapshots</a> <a id="5985" class="Symbol">→</a> <a id="5987" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="5992" class="Keyword">where</a>
  <a id="_⊢_⇀⦇_,SNAP⦈_.SNAP"></a><a id="6000" href="Ledger.Epoch.html#6000" class="InductiveConstructor">SNAP</a> <a id="6005" class="Symbol">:</a> <a id="6007" class="Keyword">let</a> <a id="6011" class="Keyword">open</a> <a id="6016" href="Ledger.Ledger.html#809" class="Module">LState</a> <a id="6023" href="Ledger.Epoch.html#5843" class="Generalizable">lstate</a><a id="6029" class="Symbol">;</a> <a id="6031" class="Keyword">open</a> <a id="6036" href="Ledger.Utxo.html#2561" class="Module">UTxOState</a> <a id="6046" href="Ledger.Ledger.html#868" class="Function">utxoSt</a><a id="6052" class="Symbol">;</a> <a id="6054" class="Keyword">open</a> <a id="6059" href="Ledger.Certs.html#3897" class="Module">CertState</a> <a id="6069" href="Ledger.Ledger.html#921" class="Function">certState</a>
             <a id="6092" href="Ledger.Epoch.html#6092" class="Bound">stake</a> <a id="6098" class="Symbol">=</a> <a id="6100" href="Ledger.Epoch.html#4781" class="Function">stakeDistr</a> <a id="6111" href="Ledger.Utxo.html#2625" class="Function">utxo</a> <a id="6116" href="Ledger.Certs.html#3960" class="Function">dState</a> <a id="6123" href="Ledger.Certs.html#3980" class="Function">pState</a>
    <a id="6134" class="Keyword">in</a>
    <a id="6141" href="Ledger.Epoch.html#5843" class="Generalizable">lstate</a> <a id="6148" href="Ledger.Epoch.html#5934" class="Datatype Operator">⊢</a> <a id="6150" href="Ledger.Prelude.html#2291" class="Function Operator">⟦</a> <a id="6152" href="Ledger.Epoch.html#5803" class="Generalizable">mark</a> <a id="6157" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="6159" href="Ledger.Epoch.html#5808" class="Generalizable">set</a> <a id="6163" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="6165" href="Ledger.Epoch.html#5812" class="Generalizable">go</a> <a id="6168" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="6170" href="Ledger.Epoch.html#5828" class="Generalizable">feeSS</a> <a id="6176" href="Ledger.Prelude.html#2291" class="Function Operator">⟧</a> <a id="6178" href="Ledger.Epoch.html#5934" class="Datatype Operator">⇀⦇</a> <a id="6181" href="Agda.Builtin.Unit.html#212" class="InductiveConstructor">tt</a> <a id="6184" href="Ledger.Epoch.html#5934" class="Datatype Operator">,SNAP⦈</a> <a id="6191" href="Ledger.Prelude.html#2291" class="Function Operator">⟦</a> <a id="6193" href="Ledger.Epoch.html#6092" class="Bound">stake</a> <a id="6199" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="6201" href="Ledger.Epoch.html#5803" class="Generalizable">mark</a> <a id="6206" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="6208" href="Ledger.Epoch.html#5808" class="Generalizable">set</a> <a id="6212" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="6214" href="Ledger.Utxo.html#2647" class="Function">fees</a> <a id="6219" href="Ledger.Prelude.html#2291" class="Function Operator">⟧</a>

<a id="6222" class="Keyword">data</a> <a id="_⊢_⇀⦇_,EPOCH⦈_"></a><a id="6227" href="Ledger.Epoch.html#6227" class="Datatype Operator">_⊢_⇀⦇_,EPOCH⦈_</a> <a id="6242" class="Symbol">:</a> <a id="6244" href="Agda.Builtin.Unit.html#175" class="Record">⊤</a> <a id="6246" class="Symbol">→</a> <a id="6248" href="Ledger.Epoch.html#1098" class="Record">EpochState</a> <a id="6259" class="Symbol">→</a> <a id="6261" href="Ledger.Types.Epoch.html#476" class="Function">Epoch</a> <a id="6267" class="Symbol">→</a> <a id="6269" href="Ledger.Epoch.html#1098" class="Record">EpochState</a> <a id="6280" class="Symbol">→</a> <a id="6282" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="6287" class="Keyword">where</a>


  <a id="_⊢_⇀⦇_,EPOCH⦈_.EPOCH"></a><a id="6297" href="Ledger.Epoch.html#6297" class="InductiveConstructor">EPOCH</a> <a id="6303" class="Symbol">:</a> <a id="6305" class="Keyword">let</a>


      <a id="6317" class="Keyword">open</a> <a id="6322" href="Ledger.Ledger.html#809" class="Module">LState</a> <a id="6329" href="Ledger.Epoch.html#5756" class="Generalizable">ls</a>
      <a id="6338" class="Keyword">open</a> <a id="6343" href="Ledger.Certs.html#3897" class="Module">CertState</a> <a id="6353" href="Ledger.Ledger.html#921" class="Function">certState</a>
      <a id="6369" class="Keyword">open</a> <a id="6374" href="Ledger.Ratify.html#3224" class="Module">RatifyState</a> <a id="6386" href="Ledger.Epoch.html#5701" class="Generalizable">fut</a> <a id="6390" class="Keyword">renaming</a> <a id="6399" class="Symbol">(</a><a id="6400" href="Ledger.Ratify.html#3261" class="Field">es</a> <a id="6403" class="Symbol">to</a> <a id="6406" class="Field">esW</a><a id="6409" class="Symbol">)</a>
      <a id="6417" class="Keyword">open</a> <a id="6422" href="Ledger.Utxo.html#2561" class="Module">UTxOState</a>
      <a id="6438" class="Keyword">open</a> <a id="6443" href="Ledger.Certs.html#3351" class="Module">PState</a><a id="6449" class="Symbol">;</a> <a id="6451" class="Keyword">open</a> <a id="6456" href="Ledger.Certs.html#2963" class="Module">DState</a><a id="6462" class="Symbol">;</a> <a id="6464" class="Keyword">open</a> <a id="6469" href="Ledger.Certs.html#3567" class="Module">GState</a>
      <a id="6482" class="Keyword">open</a> <a id="6487" href="Ledger.PParams.html#674" class="Module">Acnt</a><a id="6491" class="Symbol">;</a> <a id="6493" class="Keyword">open</a> <a id="6498" href="Ledger.Enact.html#397" class="Module">EnactState</a><a id="6508" class="Symbol">;</a> <a id="6510" class="Keyword">open</a> <a id="6515" href="Ledger.GovernanceActions.html#2594" class="Module">GovActionState</a>



      <a id="6539" href="Ledger.Epoch.html#6539" class="Bound">es</a>                <a id="6557" class="Symbol">=</a> <a id="6559" class="Keyword">record</a> <a id="6566" href="Ledger.Epoch.html#6406" class="Function">esW</a> <a id="6570" class="Symbol">{</a> <a id="6572" href="Ledger.Enact.html#649" class="Field">withdrawals</a> <a id="6584" class="Symbol">=</a> <a id="6586" href="Class.HasEmptySet.html#287" class="Field">∅</a> <a id="6588" class="Symbol">}</a>
      <a id="6596" href="Ledger.Epoch.html#6596" class="Bound">tmpGovSt</a>          <a id="6614" class="Symbol">=</a> <a id="6616" href="Data.List.Base.html#10687" class="Function">filter</a> <a id="6623" class="Symbol">(λ</a> <a id="6626" href="Ledger.Epoch.html#6626" class="Bound">x</a> <a id="6628" class="Symbol">→</a> <a id="6630" href="Class.Decidable.Core.html#461" class="Function Operator">¿</a> <a id="6632" href="Data.Product.Base.html#636" class="Field">proj₁</a> <a id="6638" href="Ledger.Epoch.html#6626" class="Bound">x</a> <a id="6640" href="Class.IsSet.html#462" class="Function Operator">∉</a> <a id="6642" href="abstract-set-theory.FiniteSetTheory.html#519" class="Function">mapˢ</a> <a id="6647" href="Data.Product.Base.html#636" class="Field">proj₁</a> <a id="6653" href="Ledger.Ratify.html#3294" class="Function">removed</a> <a id="6661" href="Class.Decidable.Core.html#461" class="Function Operator">¿</a><a id="6662" class="Symbol">)</a> <a id="6664" href="Ledger.Ledger.html#895" class="Function">govSt</a>
      <a id="6676" href="Ledger.Epoch.html#6676" class="Bound">orphans</a>           <a id="6694" class="Symbol">=</a> <a id="6696" href="Axiom.Set.html#5718" class="Function">fromList</a> <a id="6705" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="6707" href="Ledger.Epoch.html#4332" class="Function">getOrphans</a> <a id="6718" href="Ledger.Epoch.html#6539" class="Bound">es</a> <a id="6721" href="Ledger.Epoch.html#6596" class="Bound">tmpGovSt</a>
      <a id="6736" href="Ledger.Epoch.html#6736" class="Bound">removed&#39;</a>          <a id="6754" class="Symbol">=</a> <a id="6756" href="Ledger.Ratify.html#3294" class="Function">removed</a> <a id="6764" href="Axiom.Set.html#8952" class="Function Operator">∪</a> <a id="6766" href="Ledger.Epoch.html#6676" class="Bound">orphans</a>
      <a id="6780" href="Ledger.Epoch.html#6780" class="Bound">removedGovActions</a> <a id="6798" class="Symbol">=</a> <a id="6800" href="Function.Base.html#1638" class="Function">flip</a> <a id="6805" href="Axiom.Set.html#7022" class="Function">concatMapˢ</a> <a id="6816" href="Ledger.Epoch.html#6736" class="Bound">removed&#39;</a> <a id="6825" class="Symbol">λ</a> <a id="6827" class="Symbol">(</a><a id="6828" href="Ledger.Epoch.html#6828" class="Bound">gaid</a> <a id="6833" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="6835" href="Ledger.Epoch.html#6835" class="Bound">gaSt</a><a id="6839" class="Symbol">)</a> <a id="6841" class="Symbol">→</a>
        <a id="6851" href="abstract-set-theory.FiniteSetTheory.html#519" class="Function">mapˢ</a> <a id="6856" class="Symbol">(</a><a id="6857" href="Ledger.GovernanceActions.html#2665" class="Field">returnAddr</a> <a id="6868" href="Ledger.Epoch.html#6835" class="Bound">gaSt</a> <a id="6873" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,_</a><a id="6875" class="Symbol">)</a> <a id="6877" class="Symbol">((</a><a id="6879" href="Ledger.Ledger.html#868" class="Function">utxoSt</a> <a id="6886" class="Symbol">.</a><a id="6887" href="Ledger.Utxo.html#2669" class="Field">deposits</a> <a id="6896" href="Axiom.Set.Map.html#10678" class="Function Operator">∣</a> <a id="6898" href="Class.HasSingleton.html#288" class="Field Operator">❴</a> <a id="6900" href="Ledger.Certs.html#521" class="InductiveConstructor">GovActionDeposit</a> <a id="6917" href="Ledger.Epoch.html#6828" class="Bound">gaid</a> <a id="6922" href="Class.HasSingleton.html#288" class="Field Operator">❵</a><a id="6923" class="Symbol">)</a> <a id="6925" href="Axiom.Set.Map.html#2293" class="Function Operator">ˢ</a><a id="6926" class="Symbol">)</a>
      <a id="6934" href="Ledger.Epoch.html#6934" class="Bound">govActionReturns</a> <a id="6951" class="Symbol">=</a> <a id="6953" href="Axiom.Set.Map.Dec.html#1932" class="Function">aggregate₊</a> <a id="6964" class="Symbol">(</a><a id="6965" href="abstract-set-theory.FiniteSetTheory.html#519" class="Function">mapˢ</a> <a id="6970" class="Symbol">(λ</a> <a id="6973" class="Symbol">(</a><a id="6974" href="Ledger.Epoch.html#6974" class="Bound">a</a> <a id="6976" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="6978" class="Symbol">_</a> <a id="6980" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="6982" href="Ledger.Epoch.html#6982" class="Bound">d</a><a id="6983" class="Symbol">)</a> <a id="6985" class="Symbol">→</a> <a id="6987" href="Ledger.Epoch.html#6974" class="Bound">a</a> <a id="6989" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="6991" href="Ledger.Epoch.html#6982" class="Bound">d</a><a id="6992" class="Symbol">)</a> <a id="6994" href="Ledger.Epoch.html#6780" class="Bound">removedGovActions</a> <a id="7012" href="abstract-set-theory.FiniteSetTheory.html#2767" class="Function Operator">ᶠˢ</a><a id="7014" class="Symbol">)</a>

      <a id="7023" href="Ledger.Epoch.html#7023" class="Bound">trWithdrawals</a>   <a id="7039" class="Symbol">=</a> <a id="7041" href="Ledger.Epoch.html#6406" class="Function">esW</a> <a id="7045" class="Symbol">.</a><a id="7046" href="Ledger.Enact.html#649" class="Field">withdrawals</a>
      <a id="7064" href="Ledger.Epoch.html#7064" class="Bound">totWithdrawals</a>  <a id="7080" class="Symbol">=</a> <a id="7082" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">∑[</a> <a id="7085" href="Ledger.Epoch.html#7085" class="Bound">x</a> <a id="7087" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">←</a> <a id="7089" href="Ledger.Epoch.html#7023" class="Bound">trWithdrawals</a> <a id="7103" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">]</a> <a id="7105" href="Ledger.Epoch.html#7085" class="Bound">x</a>

      <a id="7114" href="Ledger.Epoch.html#7114" class="Bound">retired</a>    <a id="7125" class="Symbol">=</a> <a id="7127" class="Symbol">(</a><a id="7128" href="Ledger.Certs.html#3980" class="Function">pState</a> <a id="7135" class="Symbol">.</a><a id="7136" href="Ledger.Certs.html#3420" class="Field">retiring</a><a id="7144" class="Symbol">)</a> <a id="7146" href="Axiom.Set.Map.html#14230" class="Function Operator">⁻¹</a> <a id="7149" href="Ledger.Epoch.html#5679" class="Generalizable">e</a>
      <a id="7157" href="Ledger.Epoch.html#7157" class="Bound">payout</a>     <a id="7168" class="Symbol">=</a> <a id="7170" href="Ledger.Epoch.html#6934" class="Bound">govActionReturns</a> <a id="7187" href="Axiom.Set.Map.Dec.html#1854" class="Function Operator">∪⁺</a> <a id="7190" href="Ledger.Epoch.html#7023" class="Bound">trWithdrawals</a>
      <a id="7210" href="Ledger.Epoch.html#7210" class="Bound">refunds</a>    <a id="7221" class="Symbol">=</a> <a id="7223" href="Axiom.Set.Map.html#13791" class="Function">pullbackMap</a> <a id="7235" href="Ledger.Epoch.html#7157" class="Bound">payout</a> <a id="7242" href="Ledger.Epoch.html#3443" class="Function">toRwdAddr</a> <a id="7252" class="Symbol">(</a><a id="7253" href="Class.IsSet.html#916" class="Function">dom</a> <a id="7257" class="Symbol">(</a><a id="7258" href="Ledger.Certs.html#3960" class="Function">dState</a> <a id="7265" class="Symbol">.</a><a id="7266" href="Ledger.Certs.html#3101" class="Field">rewards</a><a id="7273" class="Symbol">))</a>
      <a id="7282" href="Ledger.Epoch.html#7282" class="Bound">unclaimed</a>  <a id="7293" class="Symbol">=</a> <a id="7295" href="Ledger.Interface.HasCoin.html#172" class="Field">getCoin</a> <a id="7303" href="Ledger.Epoch.html#7157" class="Bound">payout</a> <a id="7310" href="Interface.HasSubtract.html#209" class="Field Operator">-</a> <a id="7312" href="Ledger.Interface.HasCoin.html#172" class="Field">getCoin</a> <a id="7320" href="Ledger.Epoch.html#7210" class="Bound">refunds</a>

      <a id="7335" href="Ledger.Epoch.html#7335" class="Bound">govSt&#39;</a> <a id="7342" class="Symbol">=</a> <a id="7344" href="Data.List.Base.html#10687" class="Function">filter</a> <a id="7351" class="Symbol">(λ</a> <a id="7354" href="Ledger.Epoch.html#7354" class="Bound">x</a> <a id="7356" class="Symbol">→</a> <a id="7358" href="Class.Decidable.Core.html#461" class="Function Operator">¿</a> <a id="7360" href="Data.Product.Base.html#636" class="Field">proj₁</a> <a id="7366" href="Ledger.Epoch.html#7354" class="Bound">x</a> <a id="7368" href="Class.IsSet.html#462" class="Function Operator">∉</a> <a id="7370" href="abstract-set-theory.FiniteSetTheory.html#519" class="Function">mapˢ</a> <a id="7375" href="Data.Product.Base.html#636" class="Field">proj₁</a> <a id="7381" href="Ledger.Epoch.html#6736" class="Bound">removed&#39;</a> <a id="7390" href="Class.Decidable.Core.html#461" class="Function Operator">¿</a><a id="7391" class="Symbol">)</a> <a id="7393" href="Ledger.Ledger.html#895" class="Function">govSt</a>

      <a id="7406" href="Ledger.Epoch.html#7406" class="Bound">dState&#39;</a> <a id="7414" class="Symbol">=</a> <a id="7416" href="Ledger.Prelude.html#2291" class="Function Operator">⟦</a> <a id="7418" href="Ledger.Certs.html#3960" class="Function">dState</a> <a id="7425" class="Symbol">.</a><a id="7426" href="Ledger.Certs.html#3022" class="Field">voteDelegs</a> <a id="7437" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="7439" href="Ledger.Certs.html#3960" class="Function">dState</a> <a id="7446" class="Symbol">.</a><a id="7447" href="Ledger.Certs.html#3061" class="Field">stakeDelegs</a> <a id="7459" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a>  <a id="7462" href="Ledger.Certs.html#3960" class="Function">dState</a> <a id="7469" class="Symbol">.</a><a id="7470" href="Ledger.Certs.html#3101" class="Field">rewards</a> <a id="7478" href="Axiom.Set.Map.Dec.html#1854" class="Function Operator">∪⁺</a> <a id="7481" href="Ledger.Epoch.html#7210" class="Bound">refunds</a> <a id="7489" href="Ledger.Prelude.html#2291" class="Function Operator">⟧</a>

      <a id="7498" href="Ledger.Epoch.html#7498" class="Bound">pState&#39;</a> <a id="7506" class="Symbol">=</a> <a id="7508" href="Ledger.Prelude.html#2291" class="Function Operator">⟦</a> <a id="7510" href="Ledger.Certs.html#3980" class="Function">pState</a> <a id="7517" class="Symbol">.</a><a id="7518" href="Ledger.Certs.html#3383" class="Field">pools</a> <a id="7524" href="Axiom.Set.Map.html#10748" class="Function Operator">∣</a> <a id="7526" href="Ledger.Epoch.html#7114" class="Bound">retired</a> <a id="7534" href="Axiom.Set.Map.html#10748" class="Function Operator">ᶜ</a> <a id="7536" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="7538" href="Ledger.Certs.html#3980" class="Function">pState</a> <a id="7545" class="Symbol">.</a><a id="7546" href="Ledger.Certs.html#3420" class="Field">retiring</a> <a id="7555" href="Axiom.Set.Map.html#10748" class="Function Operator">∣</a> <a id="7557" href="Ledger.Epoch.html#7114" class="Bound">retired</a> <a id="7565" href="Axiom.Set.Map.html#10748" class="Function Operator">ᶜ</a> <a id="7567" href="Ledger.Prelude.html#2291" class="Function Operator">⟧</a>

      <a id="7576" href="Ledger.Epoch.html#7576" class="Bound">gState&#39;</a> <a id="7584" class="Symbol">=</a> <a id="7586" href="Ledger.Prelude.html#2291" class="Function Operator">⟦</a> <a id="7588" class="Symbol">(</a><a id="7589" href="Class.ToBool.html#389" class="Function Operator">if</a> <a id="7592" href="Data.List.Base.html#4703" class="Function">null</a> <a id="7597" href="Ledger.Epoch.html#7335" class="Bound">govSt&#39;</a> <a id="7604" href="Class.ToBool.html#389" class="Function Operator">then</a> <a id="7609" href="Axiom.Set.Map.html#6068" class="Function">mapValues</a> <a id="7619" class="Symbol">(</a><a id="7620" class="Number">1</a> <a id="7622" href="Class.HasAdd.Core.html#162" class="Field Operator">+_</a><a id="7624" class="Symbol">)</a> <a id="7626" class="Symbol">(</a><a id="7627" href="Ledger.Certs.html#4000" class="Function">gState</a> <a id="7634" class="Symbol">.</a><a id="7635" href="Ledger.Certs.html#3624" class="Field">dreps</a><a id="7640" class="Symbol">)</a> <a id="7642" href="Class.ToBool.html#389" class="Function Operator">else</a> <a id="7647" class="Symbol">(</a><a id="7648" href="Ledger.Certs.html#4000" class="Function">gState</a> <a id="7655" class="Symbol">.</a><a id="7656" href="Ledger.Certs.html#3624" class="Field">dreps</a><a id="7661" class="Symbol">))</a>
                <a id="7680" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="7682" href="Ledger.Certs.html#4000" class="Function">gState</a> <a id="7689" class="Symbol">.</a><a id="7690" href="Ledger.Certs.html#3647" class="Field">ccHotKeys</a> <a id="7700" href="Axiom.Set.Map.html#10678" class="Function Operator">∣</a> <a id="7702" href="Ledger.Enact.html#1194" class="Function">ccCreds</a> <a id="7710" class="Symbol">(</a><a id="7711" href="Ledger.Epoch.html#6539" class="Bound">es</a> <a id="7714" class="Symbol">.</a><a id="7715" href="Ledger.Enact.html#433" class="Field">cc</a><a id="7717" class="Symbol">)</a> <a id="7719" href="Ledger.Prelude.html#2291" class="Function Operator">⟧</a>

      <a id="7728" href="Ledger.Epoch.html#7728" class="Bound">certState&#39;</a> <a id="7739" class="Symbol">:</a> <a id="7741" href="Ledger.Certs.html#3897" class="Record">CertState</a>
      <a id="7757" href="Ledger.Epoch.html#7728" class="Bound">certState&#39;</a> <a id="7768" class="Symbol">=</a> <a id="7770" href="Ledger.Prelude.html#2291" class="Function Operator">⟦</a> <a id="7772" href="Ledger.Epoch.html#7406" class="Bound">dState&#39;</a> <a id="7780" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="7782" href="Ledger.Epoch.html#7498" class="Bound">pState&#39;</a> <a id="7790" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="7792" href="Ledger.Epoch.html#7576" class="Bound">gState&#39;</a> <a id="7800" href="Ledger.Prelude.html#2291" class="Function Operator">⟧</a>

      <a id="7809" href="Ledger.Epoch.html#7809" class="Bound">utxoSt&#39;</a> <a id="7817" class="Symbol">=</a> <a id="7819" href="Ledger.Prelude.html#2291" class="Function Operator">⟦</a> <a id="7821" href="Ledger.Ledger.html#868" class="Function">utxoSt</a> <a id="7828" class="Symbol">.</a><a id="7829" href="Ledger.Utxo.html#2625" class="Field">utxo</a> <a id="7834" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="7836" href="Ledger.Ledger.html#868" class="Function">utxoSt</a> <a id="7843" class="Symbol">.</a><a id="7844" href="Ledger.Utxo.html#2647" class="Field">fees</a> <a id="7849" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="7851" href="Ledger.Ledger.html#868" class="Function">utxoSt</a> <a id="7858" class="Symbol">.</a><a id="7859" href="Ledger.Utxo.html#2669" class="Field">deposits</a> <a id="7868" href="Axiom.Set.Map.html#10748" class="Function Operator">∣</a> <a id="7870" href="abstract-set-theory.FiniteSetTheory.html#519" class="Function">mapˢ</a> <a id="7875" class="Symbol">(</a><a id="7876" href="Data.Product.Base.html#636" class="Field">proj₁</a> <a id="7882" href="Function.Base.html#1115" class="Function Operator">∘</a> <a id="7884" href="Data.Product.Base.html#650" class="Field">proj₂</a><a id="7889" class="Symbol">)</a> <a id="7891" href="Ledger.Epoch.html#6780" class="Bound">removedGovActions</a> <a id="7909" href="Axiom.Set.Map.html#10748" class="Function Operator">ᶜ</a> <a id="7911" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="7913" class="Number">0</a> <a id="7915" href="Ledger.Prelude.html#2291" class="Function Operator">⟧</a>

      <a id="7924" href="Ledger.Epoch.html#7924" class="Bound">acnt&#39;</a> <a id="7930" class="Symbol">=</a> <a id="7932" class="Keyword">record</a> <a id="7939" href="Ledger.Epoch.html#5770" class="Generalizable">acnt</a>
        <a id="7952" class="Symbol">{</a> <a id="7954" href="Ledger.PParams.html#729" class="Field">treasury</a>  <a id="7964" class="Symbol">=</a> <a id="7966" href="Ledger.Epoch.html#5770" class="Generalizable">acnt</a> <a id="7971" class="Symbol">.</a><a id="7972" href="Ledger.PParams.html#729" class="Field">treasury</a> <a id="7981" href="Data.Nat.Base.html#4462" class="Primitive Operator">∸</a> <a id="7983" href="Ledger.Epoch.html#7064" class="Bound">totWithdrawals</a> <a id="7998" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="8000" href="Ledger.Ledger.html#868" class="Function">utxoSt</a> <a id="8007" class="Symbol">.</a><a id="8008" href="Ledger.Utxo.html#2695" class="Field">donations</a> <a id="8018" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="8020" href="Ledger.Epoch.html#7282" class="Bound">unclaimed</a> <a id="8030" class="Symbol">}</a>
    <a id="8036" class="Keyword">in</a>
    <a id="8043" class="Keyword">record</a> <a id="8050" class="Symbol">{</a> <a id="8052" href="Ledger.Ratify.html#2999" class="Field">currentEpoch</a> <a id="8065" class="Symbol">=</a> <a id="8067" href="Ledger.Epoch.html#5679" class="Generalizable">e</a>
           <a id="8080" class="Symbol">;</a> <a id="8082" href="Ledger.Ratify.html#2967" class="Field">stakeDistrs</a> <a id="8094" class="Symbol">=</a> <a id="8096" href="Ledger.Epoch.html#5401" class="Function">mkStakeDistrs</a>  <a id="8111" class="Symbol">(</a><a id="8112" href="Ledger.Epoch.html#1040" class="Field">Snapshots.mark</a> <a id="8127" href="Ledger.Epoch.html#5864" class="Generalizable">ss&#39;</a><a id="8130" class="Symbol">)</a> <a id="8132" href="Ledger.Epoch.html#7335" class="Bound">govSt&#39;</a>
                                          <a id="8181" class="Symbol">(</a><a id="8182" href="Ledger.Epoch.html#7809" class="Bound">utxoSt&#39;</a> <a id="8190" class="Symbol">.</a><a id="8191" href="Ledger.Utxo.html#2669" class="Field">deposits</a><a id="8199" class="Symbol">)</a> <a id="8201" class="Symbol">(</a><a id="8202" href="Ledger.Certs.html#3022" class="Field">voteDelegs</a> <a id="8213" href="Ledger.Certs.html#3960" class="Function">dState</a><a id="8219" class="Symbol">)</a>
           <a id="8232" class="Symbol">;</a> <a id="8234" href="Ledger.Ratify.html#3114" class="Field">treasury</a> <a id="8243" class="Symbol">=</a> <a id="8245" href="Ledger.Epoch.html#5770" class="Generalizable">acnt</a> <a id="8250" class="Symbol">.</a><a id="8251" href="Ledger.PParams.html#729" class="Field">treasury</a> <a id="8260" class="Symbol">;</a> <a id="8262" href="Ledger.Epoch.html#8262" class="Module">GState</a> <a id="8269" href="Ledger.Certs.html#4000" class="Function">gState</a>
           <a id="8287" class="Symbol">;</a> <a id="8289" href="Ledger.Ratify.html#3139" class="Field">pools</a> <a id="8295" class="Symbol">=</a> <a id="8297" href="Ledger.Certs.html#3980" class="Function">pState</a> <a id="8304" class="Symbol">.</a><a id="8305" href="Ledger.Certs.html#3383" class="Field">pools</a> <a id="8311" class="Symbol">;</a> <a id="8313" href="Ledger.Ratify.html#3180" class="Field">delegatees</a> <a id="8324" class="Symbol">=</a> <a id="8326" href="Ledger.Certs.html#3960" class="Function">dState</a> <a id="8333" class="Symbol">.</a><a id="8334" href="Ledger.Certs.html#3022" class="Field">voteDelegs</a> <a id="8345" class="Symbol">}</a>
        <a id="8355" href="Ledger.Ratify.html#11955" class="Function Operator">⊢</a> <a id="8357" href="Ledger.Prelude.html#2291" class="Function Operator">⟦</a> <a id="8359" href="Ledger.Epoch.html#6539" class="Bound">es</a> <a id="8362" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="8364" href="Class.HasEmptySet.html#287" class="Field">∅</a> <a id="8366" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="8368" href="Agda.Builtin.Bool.html#192" class="InductiveConstructor">false</a> <a id="8374" href="Ledger.Prelude.html#2291" class="Function Operator">⟧</a> <a id="8376" href="Ledger.Ratify.html#11955" class="Function Operator">⇀⦇</a> <a id="8379" href="Ledger.Epoch.html#7335" class="Bound">govSt&#39;</a> <a id="8386" href="Ledger.Ratify.html#11955" class="Function Operator">,RATIFIES⦈</a> <a id="8397" href="Ledger.Epoch.html#5705" class="Generalizable">fut&#39;</a>
      <a id="8408" class="Symbol">→</a> <a id="8410" href="Ledger.Epoch.html#5756" class="Generalizable">ls</a> <a id="8413" href="Ledger.Epoch.html#5934" class="Datatype Operator">⊢</a> <a id="8415" href="Ledger.Epoch.html#5861" class="Generalizable">ss</a> <a id="8418" href="Ledger.Epoch.html#5934" class="Datatype Operator">⇀⦇</a> <a id="8421" href="Agda.Builtin.Unit.html#212" class="InductiveConstructor">tt</a> <a id="8424" href="Ledger.Epoch.html#5934" class="Datatype Operator">,SNAP⦈</a> <a id="8431" href="Ledger.Epoch.html#5864" class="Generalizable">ss&#39;</a>
    <a id="8439" href="Interface.STS.html#350" class="Function Operator">────────────────────────────────</a>
    <a id="8476" class="Symbol">_</a> <a id="8478" href="Ledger.Epoch.html#6227" class="Datatype Operator">⊢</a> <a id="8480" href="Ledger.Prelude.html#2291" class="Function Operator">⟦</a> <a id="8482" href="Ledger.Epoch.html#5770" class="Generalizable">acnt</a> <a id="8487" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="8489" href="Ledger.Epoch.html#5861" class="Generalizable">ss</a> <a id="8492" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="8494" href="Ledger.Epoch.html#5756" class="Generalizable">ls</a> <a id="8497" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="8499" href="Ledger.Epoch.html#5784" class="Generalizable">es₀</a> <a id="8503" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="8505" href="Ledger.Epoch.html#5701" class="Generalizable">fut</a> <a id="8509" href="Ledger.Prelude.html#2291" class="Function Operator">⟧</a> <a id="8511" href="Ledger.Epoch.html#6227" class="Datatype Operator">⇀⦇</a> <a id="8514" href="Ledger.Epoch.html#5679" class="Generalizable">e</a> <a id="8516" href="Ledger.Epoch.html#6227" class="Datatype Operator">,EPOCH⦈</a>
        <a id="8532" href="Ledger.Prelude.html#2291" class="Function Operator">⟦</a> <a id="8534" href="Ledger.Epoch.html#7924" class="Bound">acnt&#39;</a> <a id="8540" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="8542" href="Ledger.Epoch.html#5864" class="Generalizable">ss&#39;</a> <a id="8546" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="8548" href="Ledger.Prelude.html#2291" class="Function Operator">⟦</a> <a id="8550" href="Ledger.Epoch.html#7809" class="Bound">utxoSt&#39;</a> <a id="8558" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="8560" href="Ledger.Epoch.html#7335" class="Bound">govSt&#39;</a> <a id="8567" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="8569" href="Ledger.Epoch.html#7728" class="Bound">certState&#39;</a> <a id="8580" href="Ledger.Prelude.html#2291" class="Function Operator">⟧</a> <a id="8582" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="8584" href="Ledger.Epoch.html#6539" class="Bound">es</a> <a id="8587" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="8589" href="Ledger.Epoch.html#5705" class="Generalizable">fut&#39;</a> <a id="8594" href="Ledger.Prelude.html#2291" class="Function Operator">⟧</a>


<a id="8598" class="Keyword">data</a>


  <a id="_⊢_⇀⦇_,NEWEPOCH⦈_"></a><a id="8607" href="Ledger.Epoch.html#8607" class="Datatype Operator">_⊢_⇀⦇_,NEWEPOCH⦈_</a> <a id="8625" class="Symbol">:</a> <a id="8627" href="Agda.Builtin.Unit.html#175" class="Record">⊤</a> <a id="8629" class="Symbol">→</a> <a id="8631" href="Ledger.Epoch.html#1878" class="Record">NewEpochState</a> <a id="8645" class="Symbol">→</a> <a id="8647" href="Ledger.Types.Epoch.html#476" class="Function">Epoch</a> <a id="8653" class="Symbol">→</a> <a id="8655" href="Ledger.Epoch.html#1878" class="Record">NewEpochState</a> <a id="8669" class="Symbol">→</a> <a id="8671" href="Agda.Primitive.html#388" class="Primitive">Type</a>


  <a id="8680" class="Keyword">where</a>


  <a id="_⊢_⇀⦇_,NEWEPOCH⦈_.NEWEPOCH-New"></a><a id="8690" href="Ledger.Epoch.html#8690" class="InductiveConstructor">NEWEPOCH-New</a> <a id="8703" class="Symbol">:</a> <a id="8705" class="Keyword">let</a>
      <a id="8715" href="Ledger.Epoch.html#8715" class="Bound">eps&#39;</a> <a id="8720" class="Symbol">=</a> <a id="8722" href="Ledger.Epoch.html#3682" class="Function">applyRUpd</a> <a id="8732" href="Ledger.Epoch.html#5882" class="Generalizable">ru</a> <a id="8735" href="Ledger.Epoch.html#5726" class="Generalizable">eps</a>
    <a id="8743" class="Keyword">in</a>
    <a id="8750" href="Interface.STS.html#105" class="Function Operator">∙</a> <a id="8752" href="Ledger.Epoch.html#5679" class="Generalizable">e</a> <a id="8754" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="8756" href="Ledger.Epoch.html#5681" class="Generalizable">lastEpoch</a> <a id="8766" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="8768" class="Number">1</a>
    <a id="8774" href="Interface.STS.html#131" class="Function Operator">∙</a> <a id="8776" class="Symbol">_</a> <a id="8778" href="Ledger.Epoch.html#6227" class="Datatype Operator">⊢</a> <a id="8780" href="Ledger.Epoch.html#8715" class="Bound">eps&#39;</a> <a id="8785" href="Ledger.Epoch.html#6227" class="Datatype Operator">⇀⦇</a> <a id="8788" href="Ledger.Epoch.html#5679" class="Generalizable">e</a> <a id="8790" href="Ledger.Epoch.html#6227" class="Datatype Operator">,EPOCH⦈</a> <a id="8798" href="Ledger.Epoch.html#5735" class="Generalizable">eps&#39;&#39;</a>
      <a id="8810" href="Interface.STS.html#350" class="Function Operator">────────────────────────────────</a>
      <a id="8849" class="Symbol">_</a> <a id="8851" href="Ledger.Epoch.html#8607" class="Datatype Operator">⊢</a> <a id="8853" href="Ledger.Prelude.html#2291" class="Function Operator">⟦</a> <a id="8855" href="Ledger.Epoch.html#5681" class="Generalizable">lastEpoch</a> <a id="8865" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="8867" href="Ledger.Epoch.html#5726" class="Generalizable">eps</a> <a id="8871" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="8873" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="8878" href="Ledger.Epoch.html#5882" class="Generalizable">ru</a> <a id="8881" href="Ledger.Prelude.html#2291" class="Function Operator">⟧</a> <a id="8883" href="Ledger.Epoch.html#8607" class="Datatype Operator">⇀⦇</a> <a id="8886" href="Ledger.Epoch.html#5679" class="Generalizable">e</a> <a id="8888" href="Ledger.Epoch.html#8607" class="Datatype Operator">,NEWEPOCH⦈</a> <a id="8899" href="Ledger.Prelude.html#2291" class="Function Operator">⟦</a> <a id="8901" href="Ledger.Epoch.html#5679" class="Generalizable">e</a> <a id="8903" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="8905" href="Ledger.Epoch.html#5735" class="Generalizable">eps&#39;&#39;</a> <a id="8911" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="8913" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a> <a id="8921" href="Ledger.Prelude.html#2291" class="Function Operator">⟧</a>

  <a id="_⊢_⇀⦇_,NEWEPOCH⦈_.NEWEPOCH-Not-New"></a><a id="8926" href="Ledger.Epoch.html#8926" class="InductiveConstructor">NEWEPOCH-Not-New</a> <a id="8943" class="Symbol">:</a>
    <a id="8949" href="Interface.STS.html#105" class="Function Operator">∙</a> <a id="8951" href="Ledger.Epoch.html#5679" class="Generalizable">e</a> <a id="8953" href="Relation.Binary.PropositionalEquality.Core.html#858" class="Function Operator">≢</a> <a id="8955" href="Ledger.Epoch.html#5681" class="Generalizable">lastEpoch</a> <a id="8965" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="8967" class="Number">1</a>
      <a id="8975" href="Interface.STS.html#350" class="Function Operator">────────────────────────────────</a>
      <a id="9014" class="Symbol">_</a> <a id="9016" href="Ledger.Epoch.html#8607" class="Datatype Operator">⊢</a> <a id="9018" href="Ledger.Prelude.html#2291" class="Function Operator">⟦</a> <a id="9020" href="Ledger.Epoch.html#5681" class="Generalizable">lastEpoch</a> <a id="9030" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="9032" href="Ledger.Epoch.html#5726" class="Generalizable">eps</a> <a id="9036" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="9038" href="Ledger.Epoch.html#5902" class="Generalizable">mru</a> <a id="9042" href="Ledger.Prelude.html#2291" class="Function Operator">⟧</a> <a id="9044" href="Ledger.Epoch.html#8607" class="Datatype Operator">⇀⦇</a> <a id="9047" href="Ledger.Epoch.html#5679" class="Generalizable">e</a> <a id="9049" href="Ledger.Epoch.html#8607" class="Datatype Operator">,NEWEPOCH⦈</a> <a id="9060" href="Ledger.Prelude.html#2291" class="Function Operator">⟦</a> <a id="9062" href="Ledger.Epoch.html#5681" class="Generalizable">lastEpoch</a> <a id="9072" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="9074" href="Ledger.Epoch.html#5726" class="Generalizable">eps</a> <a id="9078" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="9080" href="Ledger.Epoch.html#5902" class="Generalizable">mru</a> <a id="9084" href="Ledger.Prelude.html#2291" class="Function Operator">⟧</a>

  <a id="_⊢_⇀⦇_,NEWEPOCH⦈_.NEWEPOCH-No-Reward-Update"></a><a id="9089" href="Ledger.Epoch.html#9089" class="InductiveConstructor">NEWEPOCH-No-Reward-Update</a> <a id="9115" class="Symbol">:</a>
    <a id="9121" href="Interface.STS.html#105" class="Function Operator">∙</a> <a id="9123" href="Ledger.Epoch.html#5679" class="Generalizable">e</a> <a id="9125" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="9127" href="Ledger.Epoch.html#5681" class="Generalizable">lastEpoch</a> <a id="9137" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="9139" class="Number">1</a>
    <a id="9145" href="Interface.STS.html#131" class="Function Operator">∙</a> <a id="9147" class="Symbol">_</a> <a id="9149" href="Ledger.Epoch.html#6227" class="Datatype Operator">⊢</a> <a id="9151" href="Ledger.Epoch.html#5726" class="Generalizable">eps</a> <a id="9155" href="Ledger.Epoch.html#6227" class="Datatype Operator">⇀⦇</a> <a id="9158" href="Ledger.Epoch.html#5679" class="Generalizable">e</a> <a id="9160" href="Ledger.Epoch.html#6227" class="Datatype Operator">,EPOCH⦈</a> <a id="9168" href="Ledger.Epoch.html#5730" class="Generalizable">eps&#39;</a>
      <a id="9179" href="Interface.STS.html#350" class="Function Operator">────────────────────────────────</a>
      <a id="9218" class="Symbol">_</a> <a id="9220" href="Ledger.Epoch.html#8607" class="Datatype Operator">⊢</a> <a id="9222" href="Ledger.Prelude.html#2291" class="Function Operator">⟦</a> <a id="9224" href="Ledger.Epoch.html#5681" class="Generalizable">lastEpoch</a> <a id="9234" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="9236" href="Ledger.Epoch.html#5726" class="Generalizable">eps</a> <a id="9240" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="9242" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a> <a id="9250" href="Ledger.Prelude.html#2291" class="Function Operator">⟧</a> <a id="9252" href="Ledger.Epoch.html#8607" class="Datatype Operator">⇀⦇</a> <a id="9255" href="Ledger.Epoch.html#5679" class="Generalizable">e</a> <a id="9257" href="Ledger.Epoch.html#8607" class="Datatype Operator">,NEWEPOCH⦈</a> <a id="9268" href="Ledger.Prelude.html#2291" class="Function Operator">⟦</a> <a id="9270" href="Ledger.Epoch.html#5679" class="Generalizable">e</a> <a id="9272" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="9274" href="Ledger.Epoch.html#5730" class="Generalizable">eps&#39;</a> <a id="9279" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="9281" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a> <a id="9289" href="Ledger.Prelude.html#2291" class="Function Operator">⟧</a>

</pre></body></html>