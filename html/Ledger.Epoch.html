<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>Ledger.Epoch</title><link rel="stylesheet" href="Agda.css"></head><body><pre class="Agda">
<a id="2" class="Symbol">{-#</a> <a id="6" class="Keyword">OPTIONS</a> <a id="14" class="Pragma">--safe</a> <a id="21" class="Symbol">#-}</a>

<a id="26" class="Keyword">open</a> <a id="31" class="Keyword">import</a> <a id="38" href="Data.Nat.Properties.html" class="Module">Data.Nat.Properties</a> <a id="58" class="Keyword">using</a> <a id="64" class="Symbol">(</a><a id="65" href="Data.Nat.Properties.html#17252" class="Function">+-0-monoid</a><a id="75" class="Symbol">;</a> <a id="77" href="Data.Nat.Properties.html#17331" class="Function">+-0-commutativeMonoid</a><a id="98" class="Symbol">)</a>
<a id="100" class="Keyword">open</a> <a id="105" class="Keyword">import</a> <a id="112" href="Data.Integer.html" class="Module">Data.Integer</a> <a id="125" class="Keyword">using</a> <a id="131" class="Symbol">()</a> <a id="134" class="Keyword">renaming</a> <a id="143" class="Symbol">(</a><a id="144" href="Agda.Builtin.Int.html#263" class="InductiveConstructor">+_</a> <a id="147" class="Symbol">to</a> <a id="150" class="InductiveConstructor">pos</a><a id="153" class="Symbol">)</a>
<a id="155" class="Keyword">open</a> <a id="160" class="Keyword">import</a> <a id="167" href="Data.Nat.GeneralisedArithmetic.html" class="Module">Data.Nat.GeneralisedArithmetic</a> <a id="198" class="Keyword">using</a> <a id="204" class="Symbol">(</a><a id="205" href="Data.Nat.GeneralisedArithmetic.html#866" class="Function">iterate</a><a id="212" class="Symbol">)</a>

<a id="215" class="Keyword">open</a> <a id="220" class="Keyword">import</a> <a id="227" href="Agda.Builtin.FromNat.html" class="Module">Agda.Builtin.FromNat</a>

<a id="249" class="Keyword">open</a> <a id="254" class="Keyword">import</a> <a id="261" href="Ledger.Prelude.html" class="Module">Ledger.Prelude</a> <a id="276" class="Keyword">hiding</a> <a id="283" class="Symbol">(</a><a id="284" href="Data.List.Base.html#5412" class="Function">iterate</a><a id="291" class="Symbol">)</a>
<a id="293" class="Keyword">open</a> <a id="298" href="Ledger.Prelude.html#2544" class="Module">Filter</a> <a id="305" class="Keyword">using</a> <a id="311" class="Symbol">(</a><a id="312" href="Ledger.Prelude.html#2559" class="Function">filter</a><a id="318" class="Symbol">)</a>
<a id="320" class="Keyword">open</a> <a id="325" class="Keyword">import</a> <a id="332" href="Ledger.Abstract.html" class="Module">Ledger.Abstract</a>
<a id="348" class="Keyword">open</a> <a id="353" class="Keyword">import</a> <a id="360" href="Ledger.Transaction.html" class="Module">Ledger.Transaction</a>

<a id="380" class="Keyword">module</a> <a id="387" href="Ledger.Epoch.html" class="Module">Ledger.Epoch</a>
  <a id="402" class="Symbol">(</a><a id="403" href="Ledger.Epoch.html#403" class="Bound">txs</a> <a id="407" class="Symbol">:</a> <a id="409" class="Symbol">_)</a> <a id="412" class="Symbol">(</a><a id="413" class="Keyword">open</a> <a id="418" href="Ledger.Transaction.html#867" class="Module">TransactionStructure</a> <a id="439" href="Ledger.Epoch.html#403" class="Bound">txs</a><a id="442" class="Symbol">)</a>
  <a id="446" class="Symbol">(</a><a id="447" href="Ledger.Epoch.html#447" class="Bound">abs</a> <a id="451" class="Symbol">:</a> <a id="453" href="Ledger.Abstract.html#578" class="Record">AbstractFunctions</a> <a id="471" href="Ledger.Epoch.html#403" class="Bound">txs</a><a id="474" class="Symbol">)</a> <a id="476" class="Symbol">(</a><a id="477" class="Keyword">open</a> <a id="482" href="Ledger.Abstract.html#578" class="Module">AbstractFunctions</a> <a id="500" href="Ledger.Epoch.html#447" class="Bound">abs</a><a id="503" class="Symbol">)</a>
  <a id="507" class="Keyword">where</a>

<a id="514" class="Keyword">open</a> <a id="519" class="Keyword">import</a> <a id="526" href="Ledger.Certs.html" class="Module">Ledger.Certs</a> <a id="539" href="Ledger.Transaction.html#1809" class="Function">govStructure</a>
<a id="552" class="Keyword">open</a> <a id="557" class="Keyword">import</a> <a id="564" href="Ledger.Enact.html" class="Module">Ledger.Enact</a> <a id="577" href="Ledger.Transaction.html#1809" class="Function">govStructure</a>
<a id="590" class="Keyword">open</a> <a id="595" class="Keyword">import</a> <a id="602" href="Ledger.Gov.html" class="Module">Ledger.Gov</a> <a id="613" href="Ledger.Epoch.html#403" class="Bound">txs</a>
<a id="617" class="Keyword">open</a> <a id="622" class="Keyword">import</a> <a id="629" href="Ledger.Ledger.html" class="Module">Ledger.Ledger</a> <a id="643" href="Ledger.Epoch.html#403" class="Bound">txs</a> <a id="647" href="Ledger.Epoch.html#447" class="Bound">abs</a>
<a id="651" class="Keyword">open</a> <a id="656" class="Keyword">import</a> <a id="663" href="Ledger.Prelude.html" class="Module">Ledger.Prelude</a> <a id="678" class="Keyword">hiding</a> <a id="685" class="Symbol">(</a><a id="686" href="Data.List.Base.html#5412" class="Function">iterate</a><a id="693" class="Symbol">)</a>
<a id="695" class="Keyword">open</a> <a id="700" class="Keyword">import</a> <a id="707" href="Ledger.Ratify.html" class="Module">Ledger.Ratify</a> <a id="721" href="Ledger.Epoch.html#403" class="Bound">txs</a>
<a id="725" class="Keyword">open</a> <a id="730" class="Keyword">import</a> <a id="737" href="Ledger.Utxo.html" class="Module">Ledger.Utxo</a> <a id="749" href="Ledger.Epoch.html#403" class="Bound">txs</a> <a id="753" href="Ledger.Epoch.html#447" class="Bound">abs</a>

<a id="758" class="Keyword">open</a> <a id="763" class="Keyword">import</a> <a id="770" href="Agda.Builtin.FromNat.html" class="Module">Agda.Builtin.FromNat</a>

<a id="792" class="Keyword">open</a> <a id="797" class="Keyword">import</a> <a id="804" href="Data.Integer.html" class="Module">Data.Integer</a> <a id="817" class="Keyword">using</a> <a id="823" class="Symbol">()</a> <a id="826" class="Keyword">renaming</a> <a id="835" class="Symbol">(</a><a id="836" href="Agda.Builtin.Int.html#263" class="InductiveConstructor">+_</a> <a id="839" class="Symbol">to</a> <a id="842" class="InductiveConstructor">pos</a><a id="845" class="Symbol">)</a>
<a id="847" class="Keyword">open</a> <a id="852" class="Keyword">import</a> <a id="859" href="Data.Nat.GeneralisedArithmetic.html" class="Module">Data.Nat.GeneralisedArithmetic</a> <a id="890" class="Keyword">using</a> <a id="896" class="Symbol">(</a><a id="897" href="Data.Nat.GeneralisedArithmetic.html#866" class="Function">iterate</a><a id="904" class="Symbol">)</a>
<a id="906" class="Keyword">open</a> <a id="911" class="Keyword">import</a> <a id="918" href="Data.Nat.Properties.html" class="Module">Data.Nat.Properties</a> <a id="938" class="Keyword">using</a> <a id="944" class="Symbol">(</a><a id="945" href="Data.Nat.Properties.html#17252" class="Function">+-0-monoid</a><a id="955" class="Symbol">;</a> <a id="957" href="Data.Nat.Properties.html#17331" class="Function">+-0-commutativeMonoid</a><a id="978" class="Symbol">)</a>



<a id="983" class="Keyword">record</a> <a id="RewardUpdate"></a><a id="990" href="Ledger.Epoch.html#990" class="Record">RewardUpdate</a> <a id="1003" class="Symbol">:</a> <a id="1005" href="Agda.Primitive.html#388" class="Primitive">Set</a> <a id="1009" class="Keyword">where</a>


  <a id="1019" class="Keyword">constructor</a> <a id="⟦_,_,_,_⟧ʳᵘ"></a><a id="1031" href="Ledger.Epoch.html#1031" class="InductiveConstructor Operator">⟦_,_,_,_⟧ʳᵘ</a>


  <a id="1047" class="Keyword">field</a>
    <a id="RewardUpdate.Δt"></a><a id="1057" href="Ledger.Epoch.html#1057" class="Field">Δt</a> <a id="RewardUpdate.Δr"></a><a id="1060" href="Ledger.Epoch.html#1060" class="Field">Δr</a> <a id="RewardUpdate.Δf"></a><a id="1063" href="Ledger.Epoch.html#1063" class="Field">Δf</a> <a id="1066" class="Symbol">:</a> <a id="1068" href="Agda.Builtin.Int.html#245" class="Datatype">ℤ</a>
    <a id="RewardUpdate.rs"></a><a id="1074" href="Ledger.Epoch.html#1074" class="Field">rs</a> <a id="1077" class="Symbol">:</a> <a id="1079" href="Ledger.Address.html#273" class="Datatype">Credential</a> <a id="1090" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="1092" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a>


<a id="1099" class="Keyword">record</a> <a id="Snapshot"></a><a id="1106" href="Ledger.Epoch.html#1106" class="Record">Snapshot</a> <a id="1115" class="Symbol">:</a> <a id="1117" href="Agda.Primitive.html#388" class="Primitive">Set</a> <a id="1121" class="Keyword">where</a>
  <a id="1129" class="Keyword">field</a>
    <a id="Snapshot.stake"></a><a id="1139" href="Ledger.Epoch.html#1139" class="Field">stake</a>        <a id="1152" class="Symbol">:</a> <a id="1154" href="Ledger.Address.html#273" class="Datatype">Credential</a> <a id="1165" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="1167" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a>
    <a id="Snapshot.delegations"></a><a id="1176" href="Ledger.Epoch.html#1176" class="Field">delegations</a>  <a id="1189" class="Symbol">:</a> <a id="1191" href="Ledger.Address.html#273" class="Datatype">Credential</a> <a id="1202" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="1204" href="Ledger.Crypto.html#1310" class="Function">KeyHash</a>
    <a id="1216" class="Comment">-- poolParameters : KeyHash ⇀ PoolParam</a>

<a id="1257" class="Keyword">record</a> <a id="Snapshots"></a><a id="1264" href="Ledger.Epoch.html#1264" class="Record">Snapshots</a> <a id="1274" class="Symbol">:</a> <a id="1276" href="Agda.Primitive.html#388" class="Primitive">Set</a> <a id="1280" class="Keyword">where</a>
  <a id="1288" class="Keyword">field</a>
    <a id="Snapshots.mark"></a><a id="1298" href="Ledger.Epoch.html#1298" class="Field">mark</a> <a id="Snapshots.set"></a><a id="1303" href="Ledger.Epoch.html#1303" class="Field">set</a> <a id="Snapshots.go"></a><a id="1307" href="Ledger.Epoch.html#1307" class="Field">go</a>  <a id="1311" class="Symbol">:</a> <a id="1313" href="Ledger.Epoch.html#1106" class="Record">Snapshot</a>
    <a id="Snapshots.feeSS"></a><a id="1326" href="Ledger.Epoch.html#1326" class="Field">feeSS</a>        <a id="1339" class="Symbol">:</a> <a id="1341" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a>



<a id="1349" class="Keyword">record</a> <a id="EpochState"></a><a id="1356" href="Ledger.Epoch.html#1356" class="Record">EpochState</a> <a id="1367" class="Symbol">:</a> <a id="1369" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="1374" class="Keyword">where</a>


  <a id="1384" class="Keyword">constructor</a> <a id="⟦_,_,_,_,_⟧ᵉ&#39;"></a><a id="1396" href="Ledger.Epoch.html#1396" class="InductiveConstructor Operator">⟦_,_,_,_,_⟧ᵉ&#39;</a>


  <a id="1414" class="Keyword">field</a>
    <a id="EpochState.acnt"></a><a id="1424" href="Ledger.Epoch.html#1424" class="Field">acnt</a>       <a id="1435" class="Symbol">:</a> <a id="1437" href="Ledger.PParams.html#674" class="Record">Acnt</a>
    <a id="EpochState.ss"></a><a id="1446" href="Ledger.Epoch.html#1446" class="Field">ss</a>         <a id="1457" class="Symbol">:</a> <a id="1459" href="Ledger.Epoch.html#1264" class="Record">Snapshots</a>
    <a id="EpochState.ls"></a><a id="1473" href="Ledger.Epoch.html#1473" class="Field">ls</a>         <a id="1484" class="Symbol">:</a> <a id="1486" href="Ledger.Ledger.html#809" class="Record">LState</a>
    <a id="EpochState.es"></a><a id="1497" href="Ledger.Epoch.html#1497" class="Field">es</a>         <a id="1508" class="Symbol">:</a> <a id="1510" href="Ledger.Enact.html#397" class="Record">EnactState</a>
    <a id="EpochState.fut"></a><a id="1525" href="Ledger.Epoch.html#1525" class="Field">fut</a>        <a id="1536" class="Symbol">:</a> <a id="1538" href="Ledger.Ratify.html#3279" class="Record">RatifyState</a>


<a id="1552" class="Keyword">record</a> <a id="HasEpochState"></a><a id="1559" href="Ledger.Epoch.html#1559" class="Record">HasEpochState</a> <a id="1573" class="Symbol">{</a><a id="1574" href="Ledger.Epoch.html#1574" class="Bound">a</a><a id="1575" class="Symbol">}</a> <a id="1577" class="Symbol">(</a><a id="1578" href="Ledger.Epoch.html#1578" class="Bound">A</a> <a id="1580" class="Symbol">:</a> <a id="1582" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="1587" href="Ledger.Epoch.html#1574" class="Bound">a</a><a id="1588" class="Symbol">)</a> <a id="1590" class="Symbol">:</a> <a id="1592" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="1597" href="Ledger.Epoch.html#1574" class="Bound">a</a> <a id="1599" class="Keyword">where</a>
  <a id="1607" class="Keyword">field</a> <a id="HasEpochState.EpochStateOf"></a><a id="1613" href="Ledger.Epoch.html#1613" class="Field">EpochStateOf</a> <a id="1626" class="Symbol">:</a> <a id="1628" href="Ledger.Epoch.html#1578" class="Bound">A</a> <a id="1630" class="Symbol">→</a> <a id="1632" href="Ledger.Epoch.html#1356" class="Record">EpochState</a>
<a id="1643" class="Keyword">open</a> <a id="1648" href="Ledger.Epoch.html#1559" class="Module">HasEpochState</a> <a id="1662" class="Symbol">⦃...⦄</a> <a id="1668" class="Keyword">public</a>

<a id="1676" class="Keyword">instance</a>
  <a id="HasLState-EpochState"></a><a id="1687" href="Ledger.Epoch.html#1687" class="Function">HasLState-EpochState</a> <a id="1708" class="Symbol">:</a> <a id="1710" href="Ledger.Ledger.html#954" class="Record">HasLState</a> <a id="1720" href="Ledger.Epoch.html#1356" class="Record">EpochState</a>
  <a id="1733" href="Ledger.Epoch.html#1687" class="Function">HasLState-EpochState</a> <a id="1754" class="Symbol">.</a><a id="1755" href="Ledger.Ledger.html#1004" class="Field">LStateOf</a> <a id="1764" class="Symbol">=</a> <a id="1766" href="Ledger.Epoch.html#1473" class="Field">EpochState.ls</a>

  <a id="HasEnactState-EpochState"></a><a id="1783" href="Ledger.Epoch.html#1783" class="Function">HasEnactState-EpochState</a> <a id="1808" class="Symbol">:</a> <a id="1810" href="Ledger.Enact.html#689" class="Record">HasEnactState</a> <a id="1824" href="Ledger.Epoch.html#1356" class="Record">EpochState</a>
  <a id="1837" href="Ledger.Epoch.html#1783" class="Function">HasEnactState-EpochState</a> <a id="1862" class="Symbol">.</a><a id="1863" href="Ledger.Enact.html#743" class="Field">EnactStateOf</a> <a id="1876" class="Symbol">=</a> <a id="1878" href="Ledger.Epoch.html#1497" class="Field">EpochState.es</a>

  <a id="HasDeposits-EpochState"></a><a id="1895" href="Ledger.Epoch.html#1895" class="Function">HasDeposits-EpochState</a> <a id="1918" class="Symbol">:</a> <a id="1920" href="Ledger.Certs.html#677" class="Record">HasDeposits</a> <a id="1932" href="Ledger.Epoch.html#1356" class="Record">EpochState</a>
  <a id="1945" href="Ledger.Epoch.html#1895" class="Function">HasDeposits-EpochState</a> <a id="1968" class="Symbol">.</a><a id="1969" href="Ledger.Certs.html#729" class="Field">DepositsOf</a> <a id="1980" class="Symbol">=</a> <a id="1982" href="Ledger.Certs.html#729" class="Field">DepositsOf</a> <a id="1993" href="Function.Base.html#1115" class="Function Operator">∘</a> <a id="1995" href="Ledger.Ledger.html#1004" class="Field">LStateOf</a>

  <a id="Hastreasury-EpochState"></a><a id="2007" href="Ledger.Epoch.html#2007" class="Function">Hastreasury-EpochState</a> <a id="2030" class="Symbol">:</a> <a id="2032" href="Ledger.PParams.html#762" class="Record">Hastreasury</a> <a id="2044" href="Ledger.Epoch.html#1356" class="Record">EpochState</a>
  <a id="2057" href="Ledger.Epoch.html#2007" class="Function">Hastreasury-EpochState</a> <a id="2080" class="Symbol">.</a><a id="2081" href="Ledger.PParams.html#814" class="Field">treasuryOf</a> <a id="2092" class="Symbol">=</a> <a id="2094" href="Ledger.PParams.html#729" class="Field">Acnt.treasury</a> <a id="2108" href="Function.Base.html#1115" class="Function Operator">∘</a> <a id="2110" href="Ledger.Epoch.html#1424" class="Field">EpochState.acnt</a>



<a id="2129" class="Keyword">record</a> <a id="NewEpochState"></a><a id="2136" href="Ledger.Epoch.html#2136" class="Record">NewEpochState</a> <a id="2150" class="Symbol">:</a> <a id="2152" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="2157" class="Keyword">where</a>
  <a id="2165" class="Keyword">field</a>
    <a id="NewEpochState.lastEpoch"></a><a id="2175" href="Ledger.Epoch.html#2175" class="Field">lastEpoch</a>   <a id="2187" class="Symbol">:</a> <a id="2189" href="Ledger.Types.Epoch.html#476" class="Function">Epoch</a>
    <a id="NewEpochState.epochState"></a><a id="2199" href="Ledger.Epoch.html#2199" class="Field">epochState</a>  <a id="2211" class="Symbol">:</a> <a id="2213" href="Ledger.Epoch.html#1356" class="Record">EpochState</a>
    <a id="NewEpochState.ru"></a><a id="2228" href="Ledger.Epoch.html#2228" class="Field">ru</a>          <a id="2240" class="Symbol">:</a> <a id="2242" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="2248" href="Ledger.Epoch.html#990" class="Record">RewardUpdate</a>


<a id="2263" class="Keyword">record</a> <a id="HasNewEpochState"></a><a id="2270" href="Ledger.Epoch.html#2270" class="Record">HasNewEpochState</a> <a id="2287" class="Symbol">{</a><a id="2288" href="Ledger.Epoch.html#2288" class="Bound">a</a><a id="2289" class="Symbol">}</a> <a id="2291" class="Symbol">(</a><a id="2292" href="Ledger.Epoch.html#2292" class="Bound">A</a> <a id="2294" class="Symbol">:</a> <a id="2296" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="2301" href="Ledger.Epoch.html#2288" class="Bound">a</a><a id="2302" class="Symbol">)</a> <a id="2304" class="Symbol">:</a> <a id="2306" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="2311" href="Ledger.Epoch.html#2288" class="Bound">a</a> <a id="2313" class="Keyword">where</a>
  <a id="2321" class="Keyword">field</a> <a id="HasNewEpochState.NewEpochStateOf"></a><a id="2327" href="Ledger.Epoch.html#2327" class="Field">NewEpochStateOf</a> <a id="2343" class="Symbol">:</a> <a id="2345" href="Ledger.Epoch.html#2292" class="Bound">A</a> <a id="2347" class="Symbol">→</a> <a id="2349" href="Ledger.Epoch.html#2136" class="Record">NewEpochState</a>
<a id="2363" class="Keyword">open</a> <a id="2368" href="Ledger.Epoch.html#2270" class="Module">HasNewEpochState</a> <a id="2385" class="Symbol">⦃...⦄</a> <a id="2391" class="Keyword">public</a>
<a id="2398" class="Keyword">record</a> <a id="HasLastEpoch"></a><a id="2405" href="Ledger.Epoch.html#2405" class="Record">HasLastEpoch</a>     <a id="2422" class="Symbol">{</a><a id="2423" href="Ledger.Epoch.html#2423" class="Bound">a</a><a id="2424" class="Symbol">}</a> <a id="2426" class="Symbol">(</a><a id="2427" href="Ledger.Epoch.html#2427" class="Bound">A</a> <a id="2429" class="Symbol">:</a> <a id="2431" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="2436" href="Ledger.Epoch.html#2423" class="Bound">a</a><a id="2437" class="Symbol">)</a> <a id="2439" class="Symbol">:</a> <a id="2441" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="2446" href="Ledger.Epoch.html#2423" class="Bound">a</a> <a id="2448" class="Keyword">where</a> <a id="2454" class="Keyword">field</a> <a id="HasLastEpoch.LastEpochOf"></a><a id="2460" href="Ledger.Epoch.html#2460" class="Field">LastEpochOf</a>     <a id="2476" class="Symbol">:</a> <a id="2478" href="Ledger.Epoch.html#2427" class="Bound">A</a> <a id="2480" class="Symbol">→</a> <a id="2482" href="Ledger.Types.Epoch.html#476" class="Function">Epoch</a>
<a id="2488" class="Keyword">open</a> <a id="2493" href="Ledger.Epoch.html#2405" class="Module">HasLastEpoch</a>     <a id="2510" class="Symbol">⦃...⦄</a> <a id="2516" class="Keyword">public</a>

<a id="2524" class="Keyword">instance</a>
  <a id="HasLastEpoch-NewEpochState"></a><a id="2535" href="Ledger.Epoch.html#2535" class="Function">HasLastEpoch-NewEpochState</a> <a id="2562" class="Symbol">:</a> <a id="2564" href="Ledger.Epoch.html#2405" class="Record">HasLastEpoch</a> <a id="2577" href="Ledger.Epoch.html#2136" class="Record">NewEpochState</a>
  <a id="2593" href="Ledger.Epoch.html#2535" class="Function">HasLastEpoch-NewEpochState</a> <a id="2620" class="Symbol">.</a><a id="2621" href="Ledger.Epoch.html#2460" class="Field">LastEpochOf</a> <a id="2633" class="Symbol">=</a> <a id="2635" href="Ledger.Epoch.html#2175" class="Field">NewEpochState.lastEpoch</a>

  <a id="HasEpochState-NewEpochState"></a><a id="2662" href="Ledger.Epoch.html#2662" class="Function">HasEpochState-NewEpochState</a> <a id="2690" class="Symbol">:</a> <a id="2692" href="Ledger.Epoch.html#1559" class="Record">HasEpochState</a> <a id="2706" href="Ledger.Epoch.html#2136" class="Record">NewEpochState</a>
  <a id="2722" href="Ledger.Epoch.html#2662" class="Function">HasEpochState-NewEpochState</a> <a id="2750" class="Symbol">.</a><a id="2751" href="Ledger.Epoch.html#1613" class="Field">EpochStateOf</a> <a id="2764" class="Symbol">=</a> <a id="2766" href="Ledger.Epoch.html#2199" class="Field">NewEpochState.epochState</a>

  <a id="Hastreasury-NewEpochState"></a><a id="2794" href="Ledger.Epoch.html#2794" class="Function">Hastreasury-NewEpochState</a> <a id="2820" class="Symbol">:</a> <a id="2822" href="Ledger.PParams.html#762" class="Record">Hastreasury</a> <a id="2834" href="Ledger.Epoch.html#2136" class="Record">NewEpochState</a>
  <a id="2850" href="Ledger.Epoch.html#2794" class="Function">Hastreasury-NewEpochState</a> <a id="2876" class="Symbol">.</a><a id="2877" href="Ledger.PParams.html#814" class="Field">treasuryOf</a> <a id="2888" class="Symbol">=</a> <a id="2890" href="Ledger.PParams.html#814" class="Field">treasuryOf</a> <a id="2901" href="Function.Base.html#1115" class="Function Operator">∘</a> <a id="2903" href="Ledger.Epoch.html#1613" class="Field">EpochStateOf</a>

  <a id="HasLState-NewEpochState"></a><a id="2919" href="Ledger.Epoch.html#2919" class="Function">HasLState-NewEpochState</a> <a id="2943" class="Symbol">:</a> <a id="2945" href="Ledger.Ledger.html#954" class="Record">HasLState</a> <a id="2955" href="Ledger.Epoch.html#2136" class="Record">NewEpochState</a>
  <a id="2971" href="Ledger.Epoch.html#2919" class="Function">HasLState-NewEpochState</a> <a id="2995" class="Symbol">.</a><a id="2996" href="Ledger.Ledger.html#1004" class="Field">LStateOf</a> <a id="3005" class="Symbol">=</a> <a id="3007" href="Ledger.Ledger.html#1004" class="Field">LStateOf</a> <a id="3016" href="Function.Base.html#1115" class="Function Operator">∘</a> <a id="3018" href="Ledger.Epoch.html#1613" class="Field">EpochStateOf</a>

  <a id="HasGovState-NewEpochState"></a><a id="3034" href="Ledger.Epoch.html#3034" class="Function">HasGovState-NewEpochState</a> <a id="3060" class="Symbol">:</a> <a id="3062" href="Ledger.Gov.html#1408" class="Record">HasGovState</a> <a id="3074" href="Ledger.Epoch.html#2136" class="Record">NewEpochState</a>
  <a id="3090" href="Ledger.Epoch.html#3034" class="Function">HasGovState-NewEpochState</a> <a id="3116" class="Symbol">.</a><a id="3117" href="Ledger.Gov.html#1460" class="Field">GovStateOf</a> <a id="3128" class="Symbol">=</a> <a id="3130" href="Ledger.Gov.html#1460" class="Field">GovStateOf</a> <a id="3141" href="Function.Base.html#1115" class="Function Operator">∘</a> <a id="3143" href="Ledger.Ledger.html#1004" class="Field">LStateOf</a>

  <a id="HasCertState-NewEpochState"></a><a id="3155" href="Ledger.Epoch.html#3155" class="Function">HasCertState-NewEpochState</a> <a id="3182" class="Symbol">:</a> <a id="3184" href="Ledger.Certs.html#4455" class="Record">HasCertState</a> <a id="3197" href="Ledger.Epoch.html#2136" class="Record">NewEpochState</a>
  <a id="3213" href="Ledger.Epoch.html#3155" class="Function">HasCertState-NewEpochState</a> <a id="3240" class="Symbol">.</a><a id="3241" href="Ledger.Certs.html#4508" class="Field">CertStateOf</a> <a id="3253" class="Symbol">=</a> <a id="3255" href="Ledger.Certs.html#4508" class="Field">CertStateOf</a> <a id="3267" href="Function.Base.html#1115" class="Function Operator">∘</a> <a id="3269" href="Ledger.Ledger.html#1004" class="Field">LStateOf</a>

  <a id="HasDReps-NewEpochState"></a><a id="3281" href="Ledger.Epoch.html#3281" class="Function">HasDReps-NewEpochState</a> <a id="3304" class="Symbol">:</a> <a id="3306" href="Ledger.Certs.html#906" class="Record">HasDReps</a> <a id="3315" href="Ledger.Epoch.html#2136" class="Record">NewEpochState</a> 
  <a id="3332" href="Ledger.Epoch.html#3281" class="Function">HasDReps-NewEpochState</a> <a id="3355" class="Symbol">.</a><a id="3356" href="Ledger.Certs.html#955" class="Field">DRepsOf</a> <a id="3364" class="Symbol">=</a> <a id="3366" href="Ledger.Certs.html#955" class="Field">DRepsOf</a> <a id="3374" href="Function.Base.html#1115" class="Function Operator">∘</a> <a id="3376" href="Ledger.Certs.html#4508" class="Field">CertStateOf</a>

  <a id="HasRewards-NewEpochState"></a><a id="3391" href="Ledger.Epoch.html#3391" class="Function">HasRewards-NewEpochState</a> <a id="3416" class="Symbol">:</a> <a id="3418" href="Ledger.Certs.html#793" class="Record">HasRewards</a> <a id="3429" href="Ledger.Epoch.html#2136" class="Record">NewEpochState</a>
  <a id="3445" href="Ledger.Epoch.html#3391" class="Function">HasRewards-NewEpochState</a> <a id="3470" class="Symbol">.</a><a id="3471" href="Ledger.Certs.html#844" class="Field">RewardsOf</a> <a id="3481" class="Symbol">=</a> <a id="3483" href="Ledger.Certs.html#844" class="Field">RewardsOf</a> <a id="3493" href="Function.Base.html#1115" class="Function Operator">∘</a> <a id="3495" href="Ledger.Certs.html#4508" class="Field">CertStateOf</a>

  <a id="3510" class="Keyword">unquoteDecl</a> <a id="HasCast-RewardUpdate"></a><a id="3522" href="Ledger.Epoch.html#3522" class="Function">HasCast-RewardUpdate</a> <a id="HasCast-Snapshot"></a><a id="3543" href="Ledger.Epoch.html#3543" class="Function">HasCast-Snapshot</a> <a id="HasCast-Snapshots"></a><a id="3560" href="Ledger.Epoch.html#3560" class="Function">HasCast-Snapshots</a> <a id="HasCast-EpochState"></a><a id="3578" href="Ledger.Epoch.html#3578" class="Function">HasCast-EpochState</a> <a id="HasCast-NewEpochState"></a><a id="3597" href="Ledger.Epoch.html#3597" class="Function">HasCast-NewEpochState</a> <a id="3619" class="Symbol">=</a> <a id="3621" href="Class.HasCast.Derive.html#2660" class="Function">derive-HasCast</a>
    <a id="3640" class="Symbol">(</a>   <a id="3644" class="Symbol">(</a><a id="3645" class="Keyword">quote</a> <a id="3651" href="Ledger.Epoch.html#990" class="Record">RewardUpdate</a>   <a id="3666" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="3668" href="Ledger.Epoch.html#3522" class="Function">HasCast-RewardUpdate</a><a id="3688" class="Symbol">)</a>
    <a id="3694" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a>   <a id="3698" class="Symbol">(</a><a id="3699" class="Keyword">quote</a> <a id="3705" href="Ledger.Epoch.html#1106" class="Record">Snapshot</a>       <a id="3720" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="3722" href="Ledger.Epoch.html#3543" class="Function">HasCast-Snapshot</a><a id="3738" class="Symbol">)</a>
    <a id="3744" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a>   <a id="3748" class="Symbol">(</a><a id="3749" class="Keyword">quote</a> <a id="3755" href="Ledger.Epoch.html#1264" class="Record">Snapshots</a>      <a id="3770" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="3772" href="Ledger.Epoch.html#3560" class="Function">HasCast-Snapshots</a><a id="3789" class="Symbol">)</a>
    <a id="3795" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a>   <a id="3799" class="Symbol">(</a><a id="3800" class="Keyword">quote</a> <a id="3806" href="Ledger.Epoch.html#1356" class="Record">EpochState</a>     <a id="3821" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="3823" href="Ledger.Epoch.html#3578" class="Function">HasCast-EpochState</a><a id="3841" class="Symbol">)</a>
    <a id="3847" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="3849" href="Data.List.Base.html#5205" class="Function Operator">[</a> <a id="3851" class="Symbol">(</a><a id="3852" class="Keyword">quote</a> <a id="3858" href="Ledger.Epoch.html#2136" class="Record">NewEpochState</a>  <a id="3873" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="3875" href="Ledger.Epoch.html#3597" class="Function">HasCast-NewEpochState</a><a id="3896" class="Symbol">)</a><a id="3897" href="Data.List.Base.html#5205" class="Function Operator">]</a><a id="3898" class="Symbol">)</a>

<a id="3901" class="Keyword">instance</a> <a id="3910" href="Ledger.Epoch.html#3910" class="Function">_</a> <a id="3912" class="Symbol">=</a> <a id="3914" href="Data.Nat.Properties.html#17252" class="Function">+-0-monoid</a><a id="3924" class="Symbol">;</a> <a id="3926" href="Ledger.Epoch.html#3926" class="Function">_</a> <a id="3928" class="Symbol">=</a> <a id="3930" href="Data.Nat.Properties.html#17331" class="Function">+-0-commutativeMonoid</a>

<a id="toRwdAddr"></a><a id="3953" href="Ledger.Epoch.html#3953" class="Function">toRwdAddr</a> <a id="3963" class="Symbol">:</a> <a id="3965" href="Ledger.Address.html#273" class="Datatype">Credential</a> <a id="3976" class="Symbol">→</a> <a id="3978" href="Ledger.Address.html#1337" class="Record">RwdAddr</a>
<a id="3986" href="Ledger.Epoch.html#3953" class="Function">toRwdAddr</a> <a id="3996" href="Ledger.Epoch.html#3996" class="Bound">x</a> <a id="3998" class="Symbol">=</a> <a id="4000" class="Keyword">record</a> <a id="4007" class="Symbol">{</a> <a id="4009" href="Ledger.Address.html#1366" class="Field">net</a> <a id="4013" class="Symbol">=</a> <a id="4015" href="Ledger.Types.Epoch.html#2154" class="Function">NetworkId</a> <a id="4025" class="Symbol">;</a> <a id="4027" href="Ledger.Address.html#1391" class="Field">stake</a> <a id="4033" class="Symbol">=</a> <a id="4035" href="Ledger.Epoch.html#3996" class="Bound">x</a> <a id="4037" class="Symbol">}</a>

<a id="getStakeCred"></a><a id="4040" href="Ledger.Epoch.html#4040" class="Function">getStakeCred</a> <a id="4053" class="Symbol">:</a> <a id="4055" href="Ledger.Transaction.html#2320" class="Function">TxOut</a> <a id="4061" class="Symbol">→</a> <a id="4063" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="4069" href="Ledger.Address.html#273" class="Datatype">Credential</a>
<a id="4080" href="Ledger.Epoch.html#4040" class="Function">getStakeCred</a> <a id="4093" class="Symbol">(</a><a id="4094" href="Ledger.Epoch.html#4094" class="Bound">a</a> <a id="4096" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="4098" class="Symbol">_</a> <a id="4100" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="4102" class="Symbol">_</a> <a id="4104" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="4106" class="Symbol">_)</a> <a id="4109" class="Symbol">=</a> <a id="4111" href="Ledger.Address.html#2509" class="Function">stakeCred</a> <a id="4121" href="Ledger.Epoch.html#4094" class="Bound">a</a>

<a id="4124" class="Keyword">open</a> <a id="4129" href="Ledger.Address.html#1337" class="Module">RwdAddr</a> <a id="4137" class="Keyword">using</a> <a id="4143" class="Symbol">(</a><a id="4144" href="Ledger.Address.html#1391" class="Field">stake</a><a id="4149" class="Symbol">)</a>
<a id="4151" class="Keyword">open</a> <a id="4156" href="Ledger.GovernanceActions.html#2746" class="Module">GovActionState</a> <a id="4171" class="Keyword">using</a> <a id="4177" class="Symbol">(</a><a id="4178" href="Ledger.GovernanceActions.html#2817" class="Field">returnAddr</a><a id="4188" class="Symbol">)</a>


<a id="applyRUpd"></a><a id="4192" href="Ledger.Epoch.html#4192" class="Function">applyRUpd</a> <a id="4202" class="Symbol">:</a> <a id="4204" href="Ledger.Epoch.html#990" class="Record">RewardUpdate</a> <a id="4217" class="Symbol">→</a> <a id="4219" href="Ledger.Epoch.html#1356" class="Record">EpochState</a> <a id="4230" class="Symbol">→</a> <a id="4232" href="Ledger.Epoch.html#1356" class="Record">EpochState</a>
<a id="4243" href="Ledger.Epoch.html#4192" class="Function">applyRUpd</a> <a id="4253" href="Ledger.Epoch.html#1031" class="InductiveConstructor Operator">⟦</a> <a id="4255" href="Ledger.Epoch.html#4255" class="Bound">Δt</a> <a id="4258" href="Ledger.Epoch.html#1031" class="InductiveConstructor Operator">,</a> <a id="4260" href="Ledger.Epoch.html#4260" class="Bound">Δr</a> <a id="4263" href="Ledger.Epoch.html#1031" class="InductiveConstructor Operator">,</a> <a id="4265" href="Ledger.Epoch.html#4265" class="Bound">Δf</a> <a id="4268" href="Ledger.Epoch.html#1031" class="InductiveConstructor Operator">,</a> <a id="4270" href="Ledger.Epoch.html#4270" class="Bound">rs</a> <a id="4273" href="Ledger.Epoch.html#1031" class="InductiveConstructor Operator">⟧ʳᵘ</a>
  <a id="4279" href="Ledger.Epoch.html#1396" class="InductiveConstructor Operator">⟦</a> <a id="4281" href="Ledger.PParams.html#708" class="InductiveConstructor Operator">⟦</a> <a id="4283" href="Ledger.Epoch.html#4283" class="Bound">treasury</a> <a id="4292" href="Ledger.PParams.html#708" class="InductiveConstructor Operator">,</a> <a id="4294" href="Ledger.Epoch.html#4294" class="Bound">reserves</a> <a id="4303" href="Ledger.PParams.html#708" class="InductiveConstructor Operator">⟧ᵃ</a>
  <a id="4308" href="Ledger.Epoch.html#1396" class="InductiveConstructor Operator">,</a> <a id="4310" href="Ledger.Epoch.html#4310" class="Bound">ss</a>
  <a id="4315" href="Ledger.Epoch.html#1396" class="InductiveConstructor Operator">,</a> <a id="4317" href="Ledger.Ledger.html#845" class="InductiveConstructor Operator">⟦</a> <a id="4319" href="Ledger.Utxo.html#2744" class="InductiveConstructor Operator">⟦</a> <a id="4321" href="Ledger.Epoch.html#4321" class="Bound">utxo</a> <a id="4326" href="Ledger.Utxo.html#2744" class="InductiveConstructor Operator">,</a> <a id="4328" href="Ledger.Epoch.html#4328" class="Bound">fees</a> <a id="4333" href="Ledger.Utxo.html#2744" class="InductiveConstructor Operator">,</a> <a id="4335" href="Ledger.Epoch.html#4335" class="Bound">deposits</a> <a id="4344" href="Ledger.Utxo.html#2744" class="InductiveConstructor Operator">,</a> <a id="4346" href="Ledger.Epoch.html#4346" class="Bound">donations</a> <a id="4356" href="Ledger.Utxo.html#2744" class="InductiveConstructor Operator">⟧ᵘ</a>
    <a id="4363" href="Ledger.Ledger.html#845" class="InductiveConstructor Operator">,</a> <a id="4365" href="Ledger.Epoch.html#4365" class="Bound">govSt</a>
    <a id="4375" href="Ledger.Ledger.html#845" class="InductiveConstructor Operator">,</a> <a id="4377" href="Ledger.Certs.html#4366" class="InductiveConstructor Operator">⟦</a> <a id="4379" href="Ledger.Certs.html#3207" class="InductiveConstructor Operator">⟦</a> <a id="4381" href="Ledger.Epoch.html#4381" class="Bound">voteDelegs</a> <a id="4392" href="Ledger.Certs.html#3207" class="InductiveConstructor Operator">,</a> <a id="4394" href="Ledger.Epoch.html#4394" class="Bound">stakeDelegs</a> <a id="4406" href="Ledger.Certs.html#3207" class="InductiveConstructor Operator">,</a> <a id="4408" href="Ledger.Epoch.html#4408" class="Bound">rewards</a> <a id="4416" href="Ledger.Certs.html#3207" class="InductiveConstructor Operator">⟧ᵈ</a> <a id="4419" href="Ledger.Certs.html#4366" class="InductiveConstructor Operator">,</a> <a id="4421" href="Ledger.Epoch.html#4421" class="Bound">pState</a> <a id="4428" href="Ledger.Certs.html#4366" class="InductiveConstructor Operator">,</a> <a id="4430" href="Ledger.Epoch.html#4430" class="Bound">gState</a> <a id="4437" href="Ledger.Certs.html#4366" class="InductiveConstructor Operator">⟧ᶜˢ</a> <a id="4441" href="Ledger.Ledger.html#845" class="InductiveConstructor Operator">⟧ˡ</a>
  <a id="4446" href="Ledger.Epoch.html#1396" class="InductiveConstructor Operator">,</a> <a id="4448" href="Ledger.Epoch.html#4448" class="Bound">es</a>
  <a id="4453" href="Ledger.Epoch.html#1396" class="InductiveConstructor Operator">,</a> <a id="4455" href="Ledger.Epoch.html#4455" class="Bound">fut</a>
  <a id="4461" href="Ledger.Epoch.html#1396" class="InductiveConstructor Operator">⟧ᵉ&#39;</a> <a id="4465" class="Symbol">=</a>
  <a id="4469" href="Ledger.Prelude.html#2308" class="Function Operator">⟦</a> <a id="4471" href="Ledger.Prelude.html#2308" class="Function Operator">⟦</a> <a id="4473" href="Prelude.html#3167" class="Function">posPart</a> <a id="4481" class="Symbol">(</a><a id="4482" href="Ledger.Epoch.html#842" class="InductiveConstructor">pos</a> <a id="4486" href="Ledger.Epoch.html#4283" class="Bound">treasury</a> <a id="4495" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="4497" href="Ledger.Epoch.html#4255" class="Bound">Δt</a> <a id="4500" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="4502" href="Ledger.Epoch.html#842" class="InductiveConstructor">pos</a> <a id="4506" href="Ledger.Epoch.html#4810" class="Function">unregRU&#39;</a><a id="4514" class="Symbol">)</a>
    <a id="4520" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="4522" href="Prelude.html#3167" class="Function">posPart</a> <a id="4530" class="Symbol">(</a><a id="4531" href="Ledger.Epoch.html#842" class="InductiveConstructor">pos</a> <a id="4535" href="Ledger.Epoch.html#4294" class="Bound">reserves</a> <a id="4544" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="4546" href="Ledger.Epoch.html#4260" class="Bound">Δr</a><a id="4548" class="Symbol">)</a> <a id="4550" href="Ledger.Prelude.html#2308" class="Function Operator">⟧</a>
  <a id="4554" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="4556" href="Ledger.Epoch.html#4310" class="Bound">ss</a>
  <a id="4561" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="4563" href="Ledger.Prelude.html#2308" class="Function Operator">⟦</a> <a id="4565" href="Ledger.Prelude.html#2308" class="Function Operator">⟦</a> <a id="4567" href="Ledger.Epoch.html#4321" class="Bound">utxo</a> <a id="4572" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="4574" href="Prelude.html#3167" class="Function">posPart</a> <a id="4582" class="Symbol">(</a><a id="4583" href="Ledger.Epoch.html#842" class="InductiveConstructor">pos</a> <a id="4587" href="Ledger.Epoch.html#4328" class="Bound">fees</a> <a id="4592" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="4594" href="Ledger.Epoch.html#4265" class="Bound">Δf</a><a id="4596" class="Symbol">)</a> <a id="4598" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="4600" href="Ledger.Epoch.html#4335" class="Bound">deposits</a> <a id="4609" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="4611" href="Ledger.Epoch.html#4346" class="Bound">donations</a> <a id="4621" href="Ledger.Prelude.html#2308" class="Function Operator">⟧</a>
    <a id="4627" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="4629" href="Ledger.Epoch.html#4365" class="Bound">govSt</a>
    <a id="4639" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="4641" href="Ledger.Prelude.html#2308" class="Function Operator">⟦</a> <a id="4643" href="Ledger.Prelude.html#2308" class="Function Operator">⟦</a> <a id="4645" href="Ledger.Epoch.html#4381" class="Bound">voteDelegs</a> <a id="4656" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="4658" href="Ledger.Epoch.html#4394" class="Bound">stakeDelegs</a> <a id="4670" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="4672" href="Ledger.Epoch.html#4408" class="Bound">rewards</a> <a id="4680" href="Axiom.Set.Map.Dec.html#1854" class="Function Operator">∪⁺</a> <a id="4683" href="Ledger.Epoch.html#4742" class="Function">regRU</a> <a id="4689" href="Ledger.Prelude.html#2308" class="Function Operator">⟧</a> <a id="4691" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="4693" href="Ledger.Epoch.html#4421" class="Bound">pState</a> <a id="4700" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="4702" href="Ledger.Epoch.html#4430" class="Bound">gState</a> <a id="4709" href="Ledger.Prelude.html#2308" class="Function Operator">⟧</a> <a id="4711" href="Ledger.Prelude.html#2308" class="Function Operator">⟧</a>
  <a id="4715" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="4717" href="Ledger.Epoch.html#4448" class="Bound">es</a>
  <a id="4722" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="4724" href="Ledger.Epoch.html#4455" class="Bound">fut</a> <a id="4728" href="Ledger.Prelude.html#2308" class="Function Operator">⟧</a>
  <a id="4732" class="Keyword">where</a>
    <a id="4742" href="Ledger.Epoch.html#4742" class="Function">regRU</a>     <a id="4752" class="Symbol">=</a> <a id="4754" href="Ledger.Epoch.html#4270" class="Bound">rs</a> <a id="4757" href="Axiom.Set.Map.html#10678" class="Function Operator">∣</a> <a id="4759" href="Class.IsSet.html#916" class="Function">dom</a> <a id="4763" href="Ledger.Epoch.html#4408" class="Bound">rewards</a>
    <a id="4775" href="Ledger.Epoch.html#4775" class="Function">unregRU</a>   <a id="4785" class="Symbol">=</a> <a id="4787" href="Ledger.Epoch.html#4270" class="Bound">rs</a> <a id="4790" href="Axiom.Set.Map.html#10748" class="Function Operator">∣</a> <a id="4792" href="Class.IsSet.html#916" class="Function">dom</a> <a id="4796" href="Ledger.Epoch.html#4408" class="Bound">rewards</a> <a id="4804" href="Axiom.Set.Map.html#10748" class="Function Operator">ᶜ</a>
    <a id="4810" href="Ledger.Epoch.html#4810" class="Function">unregRU&#39;</a>  <a id="4820" class="Symbol">=</a> <a id="4822" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">∑[</a> <a id="4825" href="Ledger.Epoch.html#4825" class="Bound">x</a> <a id="4827" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">←</a> <a id="4829" href="Ledger.Epoch.html#4775" class="Function">unregRU</a> <a id="4837" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">]</a> <a id="4839" href="Ledger.Epoch.html#4825" class="Bound">x</a>

<a id="getOrphans"></a><a id="4842" href="Ledger.Epoch.html#4842" class="Function">getOrphans</a> <a id="4853" class="Symbol">:</a> <a id="4855" href="Ledger.Enact.html#397" class="Record">EnactState</a> <a id="4866" class="Symbol">→</a> <a id="4868" href="Ledger.Gov.html#1334" class="Function">GovState</a> <a id="4877" class="Symbol">→</a> <a id="4879" href="Ledger.Gov.html#1334" class="Function">GovState</a>
<a id="4888" href="Ledger.Epoch.html#4842" class="Function">getOrphans</a> <a id="4899" href="Ledger.Epoch.html#4899" class="Bound">es</a> <a id="4902" href="Ledger.Epoch.html#4902" class="Bound">govSt</a> <a id="4908" class="Symbol">=</a> <a id="4910" href="Data.Product.Base.html#636" class="Field">proj₁</a> <a id="4916" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="4918" href="Data.Nat.GeneralisedArithmetic.html#866" class="Function">iterate</a> <a id="4926" href="Ledger.Epoch.html#4971" class="Function">step</a> <a id="4931" class="Symbol">(</a><a id="4932" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a> <a id="4935" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="4937" href="Ledger.Epoch.html#4902" class="Bound">govSt</a><a id="4942" class="Symbol">)</a> <a id="4944" class="Symbol">(</a><a id="4945" href="Data.List.Base.html#5044" class="Function">length</a> <a id="4952" href="Ledger.Epoch.html#4902" class="Bound">govSt</a><a id="4957" class="Symbol">)</a>
  <a id="4961" class="Keyword">where</a>
    <a id="4971" href="Ledger.Epoch.html#4971" class="Function">step</a> <a id="4976" class="Symbol">:</a> <a id="4978" href="Ledger.Gov.html#1334" class="Function">GovState</a> <a id="4987" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="4989" href="Ledger.Gov.html#1334" class="Function">GovState</a> <a id="4998" class="Symbol">→</a> <a id="5000" href="Ledger.Gov.html#1334" class="Function">GovState</a> <a id="5009" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="5011" href="Ledger.Gov.html#1334" class="Function">GovState</a>
    <a id="5024" href="Ledger.Epoch.html#4971" class="Function">step</a> <a id="5029" class="Symbol">(</a><a id="5030" href="Ledger.Epoch.html#5030" class="Bound">orps</a> <a id="5035" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5037" href="Ledger.Epoch.html#5037" class="Bound">govSt</a><a id="5042" class="Symbol">)</a> <a id="5044" class="Symbol">=</a>
      <a id="5052" class="Keyword">let</a>
        <a id="5064" href="Ledger.Epoch.html#5064" class="Bound">isOrphan?</a> <a id="5074" href="Ledger.Epoch.html#5074" class="Bound">a</a> <a id="5076" href="Ledger.Epoch.html#5076" class="Bound">prev</a> <a id="5081" class="Symbol">=</a> <a id="5083" href="Relation.Nullary.Decidable.Core.html#3011" class="Function">¬?</a> <a id="5086" class="Symbol">(</a><a id="5087" href="Ledger.Gov.html#8674" class="Function">hasParent?</a> <a id="5098" href="Ledger.Epoch.html#4899" class="Bound">es</a> <a id="5101" href="Ledger.Epoch.html#5037" class="Bound">govSt</a> <a id="5107" href="Ledger.Epoch.html#5074" class="Bound">a</a> <a id="5109" href="Ledger.Epoch.html#5076" class="Bound">prev</a><a id="5113" class="Symbol">)</a>
        <a id="5123" class="Symbol">(</a><a id="5124" href="Ledger.Epoch.html#5124" class="Bound">orps&#39;</a> <a id="5130" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5132" href="Ledger.Epoch.html#5132" class="Bound">govSt&#39;</a><a id="5138" class="Symbol">)</a> <a id="5140" class="Symbol">=</a> <a id="5142" href="Data.List.Base.html#10926" class="Function">partition</a>
          <a id="5162" class="Symbol">(λ</a> <a id="5165" class="Symbol">(_</a> <a id="5168" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5170" class="Keyword">record</a> <a id="5177" class="Symbol">{</a><a id="5178" href="Ledger.GovernanceActions.html#2867" class="Field">action</a> <a id="5185" class="Symbol">=</a> <a id="5187" href="Ledger.Epoch.html#5187" class="Bound">a</a> <a id="5189" class="Symbol">;</a> <a id="5191" href="Ledger.GovernanceActions.html#2895" class="Field">prevAction</a> <a id="5202" class="Symbol">=</a> <a id="5204" href="Ledger.Epoch.html#5204" class="Bound">prev</a><a id="5208" class="Symbol">})</a> <a id="5211" class="Symbol">→</a> <a id="5213" href="Ledger.Epoch.html#5064" class="Bound">isOrphan?</a> <a id="5223" class="Symbol">(</a><a id="5224" href="Ledger.Epoch.html#5187" class="Bound">a</a> <a id="5226" class="Symbol">.</a><a id="5227" href="Ledger.GovernanceActions.html#1433" class="Field">gaType</a><a id="5233" class="Symbol">)</a> <a id="5235" href="Ledger.Epoch.html#5204" class="Bound">prev</a><a id="5239" class="Symbol">)</a> <a id="5241" href="Ledger.Epoch.html#5037" class="Bound">govSt</a>
      <a id="5253" class="Keyword">in</a>
        <a id="5264" class="Symbol">(</a><a id="5265" href="Ledger.Epoch.html#5030" class="Bound">orps</a> <a id="5270" href="Data.List.Base.html#1734" class="Function Operator">++</a> <a id="5273" href="Ledger.Epoch.html#5124" class="Bound">orps&#39;</a> <a id="5279" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5281" href="Ledger.Epoch.html#5132" class="Bound">govSt&#39;</a><a id="5287" class="Symbol">)</a>


<a id="stakeDistr"></a><a id="5291" href="Ledger.Epoch.html#5291" class="Function">stakeDistr</a> <a id="5302" class="Symbol">:</a> <a id="5304" href="Ledger.Transaction.html#2388" class="Function">UTxO</a> <a id="5309" class="Symbol">→</a> <a id="5311" href="Ledger.Certs.html#3171" class="Record">DState</a> <a id="5318" class="Symbol">→</a> <a id="5320" href="Ledger.Certs.html#3781" class="Record">PState</a> <a id="5327" class="Symbol">→</a> <a id="5329" href="Ledger.Epoch.html#1106" class="Record">Snapshot</a>
<a id="5338" href="Ledger.Epoch.html#5291" class="Function">stakeDistr</a> <a id="5349" href="Ledger.Epoch.html#5349" class="Bound">utxo</a> <a id="5354" href="Ledger.Epoch.html#5354" class="Bound">stᵈ</a> <a id="5358" href="Ledger.Epoch.html#5358" class="Bound">pState</a> <a id="5365" class="Symbol">=</a> <a id="5367" href="Ledger.Prelude.html#2308" class="Function Operator">⟦</a> <a id="5369" href="Axiom.Set.Map.Dec.html#1932" class="Function">aggregate₊</a> <a id="5380" class="Symbol">(</a><a id="5381" href="Ledger.Epoch.html#5567" class="Function">stakeRelation</a> <a id="5395" href="abstract-set-theory.FiniteSetTheory.html#2767" class="Function Operator">ᶠˢ</a><a id="5397" class="Symbol">)</a> <a id="5399" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5401" href="Ledger.Certs.html#3269" class="Function">stakeDelegs</a> <a id="5413" href="Ledger.Prelude.html#2308" class="Function Operator">⟧</a>
  <a id="5417" class="Keyword">where</a>
    <a id="5427" class="Keyword">open</a> <a id="5432" href="Ledger.Certs.html#3171" class="Module">DState</a> <a id="5439" href="Ledger.Epoch.html#5354" class="Bound">stᵈ</a> <a id="5443" class="Keyword">using</a> <a id="5449" class="Symbol">(</a><a id="5450" href="Ledger.Certs.html#3269" class="Field">stakeDelegs</a><a id="5461" class="Symbol">;</a> <a id="5463" href="Ledger.Certs.html#3309" class="Field">rewards</a><a id="5470" class="Symbol">)</a>
    <a id="5476" href="Ledger.Epoch.html#5476" class="Function">m</a> <a id="5478" class="Symbol">=</a> <a id="5480" href="abstract-set-theory.FiniteSetTheory.html#519" class="Function">mapˢ</a> <a id="5485" class="Symbol">(λ</a> <a id="5488" href="Ledger.Epoch.html#5488" class="Bound">a</a> <a id="5490" class="Symbol">→</a> <a id="5492" class="Symbol">(</a><a id="5493" href="Ledger.Epoch.html#5488" class="Bound">a</a> <a id="5495" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5497" href="Ledger.Utxo.html#3643" class="Function">cbalance</a> <a id="5506" class="Symbol">(</a><a id="5507" href="Ledger.Epoch.html#5349" class="Bound">utxo</a> <a id="5512" href="abstract-set-theory.FiniteSetTheory.html#3088" class="Function Operator">∣^&#39;</a> <a id="5516" class="Symbol">λ</a> <a id="5518" href="Ledger.Epoch.html#5518" class="Bound">i</a> <a id="5520" class="Symbol">→</a> <a id="5522" href="Ledger.Epoch.html#4040" class="Function">getStakeCred</a> <a id="5535" href="Ledger.Epoch.html#5518" class="Bound">i</a> <a id="5537" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="5539" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="5544" href="Ledger.Epoch.html#5488" class="Bound">a</a><a id="5545" class="Symbol">)))</a> <a id="5549" class="Symbol">(</a><a id="5550" href="Class.IsSet.html#916" class="Function">dom</a> <a id="5554" href="Ledger.Certs.html#3309" class="Function">rewards</a><a id="5561" class="Symbol">)</a>
    <a id="5567" href="Ledger.Epoch.html#5567" class="Function">stakeRelation</a> <a id="5581" class="Symbol">=</a> <a id="5583" href="Ledger.Epoch.html#5476" class="Function">m</a> <a id="5585" href="Axiom.Set.html#8952" class="Function Operator">∪</a> <a id="5587" href="Ledger.Prelude.html#2410" class="Function Operator">∣</a> <a id="5589" href="Ledger.Certs.html#3309" class="Function">rewards</a> <a id="5597" href="Ledger.Prelude.html#2410" class="Function Operator">∣</a>

<a id="gaDepositStake"></a><a id="5600" href="Ledger.Epoch.html#5600" class="Function">gaDepositStake</a> <a id="5615" class="Symbol">:</a> <a id="5617" href="Ledger.Gov.html#1334" class="Function">GovState</a> <a id="5626" class="Symbol">→</a> <a id="5628" href="Ledger.Certs.html#573" class="Function">Deposits</a> <a id="5637" class="Symbol">→</a> <a id="5639" href="Ledger.Address.html#273" class="Datatype">Credential</a> <a id="5650" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="5652" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a>
<a id="5657" href="Ledger.Epoch.html#5600" class="Function">gaDepositStake</a> <a id="5672" href="Ledger.Epoch.html#5672" class="Bound">govSt</a> <a id="5678" href="Ledger.Epoch.html#5678" class="Bound">ds</a> <a id="5681" class="Symbol">=</a> <a id="5683" href="abstract-set-theory.FiniteSetTheory.html#3599" class="Function">aggregateBy</a>
  <a id="5697" class="Symbol">(</a><a id="5698" href="abstract-set-theory.FiniteSetTheory.html#519" class="Function">mapˢ</a> <a id="5703" class="Symbol">(λ</a> <a id="5706" class="Symbol">(</a><a id="5707" href="Ledger.Epoch.html#5707" class="Bound">gaid</a> <a id="5712" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5714" href="Ledger.Epoch.html#5714" class="Bound">addr</a><a id="5718" class="Symbol">)</a> <a id="5720" class="Symbol">→</a> <a id="5722" class="Symbol">(</a><a id="5723" href="Ledger.Epoch.html#5707" class="Bound">gaid</a> <a id="5728" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5730" href="Ledger.Epoch.html#5714" class="Bound">addr</a><a id="5734" class="Symbol">)</a> <a id="5736" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5738" href="Ledger.Address.html#1391" class="Field">stake</a> <a id="5744" href="Ledger.Epoch.html#5714" class="Bound">addr</a><a id="5748" class="Symbol">)</a> <a id="5750" href="Ledger.Epoch.html#5848" class="Function">govSt&#39;</a><a id="5756" class="Symbol">)</a>
  <a id="5760" class="Symbol">(</a><a id="5761" href="Axiom.Set.Map.html#10460" class="Function">mapFromPartialFun</a> <a id="5779" class="Symbol">(λ</a> <a id="5782" class="Symbol">(</a><a id="5783" href="Ledger.Epoch.html#5783" class="Bound">gaid</a> <a id="5788" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5790" class="Symbol">_)</a> <a id="5793" class="Symbol">→</a> <a id="5795" href="Axiom.Set.Map.html#13670" class="Function">lookupᵐ?</a> <a id="5804" href="Ledger.Epoch.html#5678" class="Bound">ds</a> <a id="5807" class="Symbol">(</a><a id="5808" href="Ledger.Certs.html#521" class="InductiveConstructor">GovActionDeposit</a> <a id="5825" href="Ledger.Epoch.html#5783" class="Bound">gaid</a><a id="5829" class="Symbol">))</a> <a id="5832" href="Ledger.Epoch.html#5848" class="Function">govSt&#39;</a><a id="5838" class="Symbol">)</a>
  <a id="5842" class="Keyword">where</a> <a id="5848" href="Ledger.Epoch.html#5848" class="Function">govSt&#39;</a> <a id="5855" class="Symbol">=</a> <a id="5857" href="abstract-set-theory.FiniteSetTheory.html#519" class="Function">mapˢ</a> <a id="5862" class="Symbol">(</a><a id="5863" href="Class.Bifunctor.html#1152" class="Function">map₂</a> <a id="5868" href="Ledger.GovernanceActions.html#2817" class="Field">returnAddr</a><a id="5878" class="Symbol">)</a> <a id="5880" class="Symbol">(</a><a id="5881" href="Axiom.Set.html#5718" class="Function">fromList</a> <a id="5890" href="Ledger.Epoch.html#5672" class="Bound">govSt</a><a id="5895" class="Symbol">)</a>



<a id="5900" class="Keyword">opaque</a>


  <a id="mkStakeDistrs"></a><a id="5911" href="Ledger.Epoch.html#5911" class="Function">mkStakeDistrs</a> <a id="5925" class="Symbol">:</a> <a id="5927" href="Ledger.Epoch.html#1106" class="Record">Snapshot</a> <a id="5936" class="Symbol">→</a> <a id="5938" href="Ledger.Gov.html#1334" class="Function">GovState</a> <a id="5947" class="Symbol">→</a> <a id="5949" href="Ledger.Certs.html#573" class="Function">Deposits</a> <a id="5958" class="Symbol">→</a> <a id="5960" class="Symbol">(</a><a id="5961" href="Ledger.Address.html#273" class="Datatype">Credential</a> <a id="5972" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="5974" href="Ledger.GovernanceActions.html#458" class="Datatype">VDeleg</a><a id="5980" class="Symbol">)</a> <a id="5982" class="Symbol">→</a> <a id="5984" href="Ledger.Ratify.html#2914" class="Record">StakeDistrs</a>
  <a id="5998" href="Ledger.Epoch.html#5911" class="Function">mkStakeDistrs</a> <a id="6012" href="Ledger.Epoch.html#6012" class="Bound">ss</a> <a id="6015" href="Ledger.Epoch.html#6015" class="Bound">govSt</a> <a id="6021" href="Ledger.Epoch.html#6021" class="Bound">ds</a> <a id="6024" href="Ledger.Epoch.html#6024" class="Bound">delegations</a> <a id="6036" class="Symbol">.</a><a id="6037" href="Ledger.Ratify.html#2951" class="Field">StakeDistrs.stakeDistr</a> <a id="6060" class="Symbol">=</a>
    <a id="6066" href="abstract-set-theory.FiniteSetTheory.html#3599" class="Function">aggregateBy</a> <a id="6078" href="Ledger.Prelude.html#2410" class="Function Operator">∣</a> <a id="6080" href="Ledger.Epoch.html#6024" class="Bound">delegations</a> <a id="6092" href="Ledger.Prelude.html#2410" class="Function Operator">∣</a> <a id="6094" class="Symbol">(</a><a id="6095" href="Ledger.Epoch.html#1139" class="Field">Snapshot.stake</a> <a id="6110" href="Ledger.Epoch.html#6012" class="Bound">ss</a> <a id="6113" href="Axiom.Set.Map.Dec.html#1854" class="Function Operator">∪⁺</a> <a id="6116" href="Ledger.Epoch.html#5600" class="Function">gaDepositStake</a> <a id="6131" href="Ledger.Epoch.html#6015" class="Bound">govSt</a> <a id="6137" href="Ledger.Epoch.html#6021" class="Bound">ds</a><a id="6139" class="Symbol">)</a>


<a id="6143" class="Keyword">private</a> <a id="6151" class="Keyword">variable</a>
  <a id="6162" href="Ledger.Epoch.html#6162" class="Generalizable">nes</a> <a id="6166" href="Ledger.Epoch.html#6166" class="Generalizable">nes&#39;</a> <a id="6171" class="Symbol">:</a> <a id="6173" href="Ledger.Epoch.html#2136" class="Record">NewEpochState</a>
  <a id="6189" href="Ledger.Epoch.html#6189" class="Generalizable">e</a> <a id="6191" href="Ledger.Epoch.html#6191" class="Generalizable">lastEpoch</a> <a id="6201" class="Symbol">:</a> <a id="6203" href="Ledger.Types.Epoch.html#476" class="Function">Epoch</a>
  <a id="6211" href="Ledger.Epoch.html#6211" class="Generalizable">fut</a> <a id="6215" href="Ledger.Epoch.html#6215" class="Generalizable">fut&#39;</a> <a id="6220" class="Symbol">:</a> <a id="6222" href="Ledger.Ratify.html#3279" class="Record">RatifyState</a>
  <a id="6236" href="Ledger.Epoch.html#6236" class="Generalizable">eps</a> <a id="6240" href="Ledger.Epoch.html#6240" class="Generalizable">eps&#39;</a> <a id="6245" href="Ledger.Epoch.html#6245" class="Generalizable">eps&#39;&#39;</a> <a id="6251" class="Symbol">:</a> <a id="6253" href="Ledger.Epoch.html#1356" class="Record">EpochState</a>
  <a id="6266" href="Ledger.Epoch.html#6266" class="Generalizable">ls</a> <a id="6269" class="Symbol">:</a> <a id="6271" href="Ledger.Ledger.html#809" class="Record">LState</a>
  <a id="6280" href="Ledger.Epoch.html#6280" class="Generalizable">acnt</a> <a id="6285" class="Symbol">:</a> <a id="6287" href="Ledger.PParams.html#674" class="Record">Acnt</a>
  <a id="6294" href="Ledger.Epoch.html#6294" class="Generalizable">es₀</a> <a id="6298" class="Symbol">:</a> <a id="6300" href="Ledger.Enact.html#397" class="Record">EnactState</a>
  <a id="6313" href="Ledger.Epoch.html#6313" class="Generalizable">mark</a> <a id="6318" href="Ledger.Epoch.html#6318" class="Generalizable">set</a> <a id="6322" href="Ledger.Epoch.html#6322" class="Generalizable">go</a> <a id="6325" class="Symbol">:</a> <a id="6327" href="Ledger.Epoch.html#1106" class="Record">Snapshot</a>
  <a id="6338" href="Ledger.Epoch.html#6338" class="Generalizable">feeSS</a> <a id="6344" class="Symbol">:</a> <a id="6346" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a>
  <a id="6353" href="Ledger.Epoch.html#6353" class="Generalizable">lstate</a> <a id="6360" class="Symbol">:</a> <a id="6362" href="Ledger.Ledger.html#809" class="Record">LState</a>
  <a id="6371" href="Ledger.Epoch.html#6371" class="Generalizable">ss</a> <a id="6374" href="Ledger.Epoch.html#6374" class="Generalizable">ss&#39;</a> <a id="6378" class="Symbol">:</a> <a id="6380" href="Ledger.Epoch.html#1264" class="Record">Snapshots</a>
  <a id="6392" href="Ledger.Epoch.html#6392" class="Generalizable">ru</a> <a id="6395" class="Symbol">:</a> <a id="6397" href="Ledger.Epoch.html#990" class="Record">RewardUpdate</a>
  <a id="6412" href="Ledger.Epoch.html#6412" class="Generalizable">mru</a> <a id="6416" class="Symbol">:</a> <a id="6418" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="6424" href="Ledger.Epoch.html#990" class="Record">RewardUpdate</a>


<a id="6439" class="Keyword">data</a> <a id="_⊢_⇀⦇_,SNAP⦈_"></a><a id="6444" href="Ledger.Epoch.html#6444" class="Datatype Operator">_⊢_⇀⦇_,SNAP⦈_</a> <a id="6458" class="Symbol">:</a> <a id="6460" href="Ledger.Ledger.html#809" class="Record">LState</a> <a id="6467" class="Symbol">→</a> <a id="6469" href="Ledger.Epoch.html#1264" class="Record">Snapshots</a> <a id="6479" class="Symbol">→</a> <a id="6481" href="Agda.Builtin.Unit.html#175" class="Record">⊤</a> <a id="6483" class="Symbol">→</a> <a id="6485" href="Ledger.Epoch.html#1264" class="Record">Snapshots</a> <a id="6495" class="Symbol">→</a> <a id="6497" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="6502" class="Keyword">where</a>
  <a id="_⊢_⇀⦇_,SNAP⦈_.SNAP"></a><a id="6510" href="Ledger.Epoch.html#6510" class="InductiveConstructor">SNAP</a> <a id="6515" class="Symbol">:</a> <a id="6517" class="Keyword">let</a> <a id="6521" class="Keyword">open</a> <a id="6526" href="Ledger.Ledger.html#809" class="Module">LState</a> <a id="6533" href="Ledger.Epoch.html#6353" class="Generalizable">lstate</a><a id="6539" class="Symbol">;</a> <a id="6541" class="Keyword">open</a> <a id="6546" href="Ledger.Utxo.html#2705" class="Module">UTxOState</a> <a id="6556" href="Ledger.Ledger.html#868" class="Function">utxoSt</a><a id="6562" class="Symbol">;</a> <a id="6564" class="Keyword">open</a> <a id="6569" href="Ledger.Certs.html#4327" class="Module">CertState</a> <a id="6579" href="Ledger.Ledger.html#921" class="Function">certState</a>
             <a id="6602" href="Ledger.Epoch.html#6602" class="Bound">stake</a> <a id="6608" class="Symbol">=</a> <a id="6610" href="Ledger.Epoch.html#5291" class="Function">stakeDistr</a> <a id="6621" href="Ledger.Utxo.html#2769" class="Function">utxo</a> <a id="6626" href="Ledger.Certs.html#4390" class="Function">dState</a> <a id="6633" href="Ledger.Certs.html#4410" class="Function">pState</a>
    <a id="6644" class="Keyword">in</a>
    <a id="6651" href="Ledger.Epoch.html#6353" class="Generalizable">lstate</a> <a id="6658" href="Ledger.Epoch.html#6444" class="Datatype Operator">⊢</a> <a id="6660" href="Ledger.Prelude.html#2308" class="Function Operator">⟦</a> <a id="6662" href="Ledger.Epoch.html#6313" class="Generalizable">mark</a> <a id="6667" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="6669" href="Ledger.Epoch.html#6318" class="Generalizable">set</a> <a id="6673" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="6675" href="Ledger.Epoch.html#6322" class="Generalizable">go</a> <a id="6678" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="6680" href="Ledger.Epoch.html#6338" class="Generalizable">feeSS</a> <a id="6686" href="Ledger.Prelude.html#2308" class="Function Operator">⟧</a> <a id="6688" href="Ledger.Epoch.html#6444" class="Datatype Operator">⇀⦇</a> <a id="6691" href="Agda.Builtin.Unit.html#212" class="InductiveConstructor">tt</a> <a id="6694" href="Ledger.Epoch.html#6444" class="Datatype Operator">,SNAP⦈</a> <a id="6701" href="Ledger.Prelude.html#2308" class="Function Operator">⟦</a> <a id="6703" href="Ledger.Epoch.html#6602" class="Bound">stake</a> <a id="6709" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="6711" href="Ledger.Epoch.html#6313" class="Generalizable">mark</a> <a id="6716" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="6718" href="Ledger.Epoch.html#6318" class="Generalizable">set</a> <a id="6722" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="6724" href="Ledger.Utxo.html#2791" class="Function">fees</a> <a id="6729" href="Ledger.Prelude.html#2308" class="Function Operator">⟧</a>

<a id="6732" class="Keyword">data</a> <a id="_⊢_⇀⦇_,EPOCH⦈_"></a><a id="6737" href="Ledger.Epoch.html#6737" class="Datatype Operator">_⊢_⇀⦇_,EPOCH⦈_</a> <a id="6752" class="Symbol">:</a> <a id="6754" href="Agda.Builtin.Unit.html#175" class="Record">⊤</a> <a id="6756" class="Symbol">→</a> <a id="6758" href="Ledger.Epoch.html#1356" class="Record">EpochState</a> <a id="6769" class="Symbol">→</a> <a id="6771" href="Ledger.Types.Epoch.html#476" class="Function">Epoch</a> <a id="6777" class="Symbol">→</a> <a id="6779" href="Ledger.Epoch.html#1356" class="Record">EpochState</a> <a id="6790" class="Symbol">→</a> <a id="6792" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="6797" class="Keyword">where</a>


  <a id="_⊢_⇀⦇_,EPOCH⦈_.EPOCH"></a><a id="6807" href="Ledger.Epoch.html#6807" class="InductiveConstructor">EPOCH</a> <a id="6813" class="Symbol">:</a> <a id="6815" class="Keyword">let</a>


      <a id="6827" class="Keyword">open</a> <a id="6832" href="Ledger.Ledger.html#809" class="Module">LState</a> <a id="6839" href="Ledger.Epoch.html#6266" class="Generalizable">ls</a>
      <a id="6848" class="Keyword">open</a> <a id="6853" href="Ledger.Certs.html#4327" class="Module">CertState</a> <a id="6863" href="Ledger.Ledger.html#921" class="Function">certState</a>
      <a id="6879" class="Keyword">open</a> <a id="6884" href="Ledger.Ratify.html#3279" class="Module">RatifyState</a> <a id="6896" href="Ledger.Epoch.html#6211" class="Generalizable">fut</a> <a id="6900" class="Keyword">hiding</a> <a id="6907" class="Symbol">(</a><a id="6908" href="Ledger.Ratify.html#3316" class="Field">es</a><a id="6910" class="Symbol">)</a>
      <a id="6918" class="Keyword">open</a> <a id="6923" href="Ledger.Utxo.html#2705" class="Module">UTxOState</a>
      <a id="6939" class="Keyword">open</a> <a id="6944" href="Ledger.Certs.html#3781" class="Module">PState</a><a id="6950" class="Symbol">;</a> <a id="6952" class="Keyword">open</a> <a id="6957" href="Ledger.Certs.html#3171" class="Module">DState</a><a id="6963" class="Symbol">;</a> <a id="6965" class="Keyword">open</a> <a id="6970" href="Ledger.Certs.html#3997" class="Module">GState</a>
      <a id="6983" class="Keyword">open</a> <a id="6988" href="Ledger.PParams.html#674" class="Module">Acnt</a><a id="6992" class="Symbol">;</a> <a id="6994" class="Keyword">open</a> <a id="6999" href="Ledger.Enact.html#397" class="Module">EnactState</a><a id="7009" class="Symbol">;</a> <a id="7011" class="Keyword">open</a> <a id="7016" href="Ledger.GovernanceActions.html#2746" class="Module">GovActionState</a>


      <a id="7039" href="Ledger.Epoch.html#7039" class="Bound">esW</a>               <a id="7057" class="Symbol">=</a> <a id="7059" href="Ledger.Ratify.html#3316" class="Field">RatifyState.es</a> <a id="7074" href="Ledger.Epoch.html#6211" class="Generalizable">fut</a>
      <a id="7084" href="Ledger.Epoch.html#7084" class="Bound">es</a>                <a id="7102" class="Symbol">=</a> <a id="7104" class="Keyword">record</a> <a id="7111" href="Ledger.Epoch.html#7039" class="Bound">esW</a> <a id="7115" class="Symbol">{</a> <a id="7117" href="Ledger.Enact.html#649" class="Field">withdrawals</a> <a id="7129" class="Symbol">=</a> <a id="7131" href="Class.HasEmptySet.html#287" class="Field">∅</a> <a id="7133" class="Symbol">}</a>
      <a id="7141" href="Ledger.Epoch.html#7141" class="Bound">tmpGovSt</a>          <a id="7159" class="Symbol">=</a> <a id="7161" href="Ledger.Prelude.html#2559" class="Function">filter</a> <a id="7168" class="Symbol">(λ</a> <a id="7171" href="Ledger.Epoch.html#7171" class="Bound">x</a> <a id="7173" class="Symbol">→</a> <a id="7175" href="Data.Product.Base.html#636" class="Field">proj₁</a> <a id="7181" href="Ledger.Epoch.html#7171" class="Bound">x</a> <a id="7183" href="Class.IsSet.html#462" class="Function Operator">∉</a> <a id="7185" href="abstract-set-theory.FiniteSetTheory.html#519" class="Function">mapˢ</a> <a id="7190" href="Data.Product.Base.html#636" class="Field">proj₁</a> <a id="7196" href="Ledger.Ratify.html#3349" class="Function">removed</a><a id="7203" class="Symbol">)</a> <a id="7205" href="Ledger.Ledger.html#895" class="Function">govSt</a>
      <a id="7217" href="Ledger.Epoch.html#7217" class="Bound">orphans</a>           <a id="7235" class="Symbol">=</a> <a id="7237" href="Axiom.Set.html#5718" class="Function">fromList</a> <a id="7246" class="Symbol">(</a><a id="7247" href="Ledger.Epoch.html#4842" class="Function">getOrphans</a> <a id="7258" href="Ledger.Epoch.html#7084" class="Bound">es</a> <a id="7261" href="Ledger.Epoch.html#7141" class="Bound">tmpGovSt</a><a id="7269" class="Symbol">)</a>
      <a id="7277" href="Ledger.Epoch.html#7277" class="Bound">removed&#39;</a>          <a id="7295" class="Symbol">=</a> <a id="7297" href="Ledger.Ratify.html#3349" class="Function">removed</a> <a id="7305" href="Axiom.Set.html#8952" class="Function Operator">∪</a> <a id="7307" href="Ledger.Epoch.html#7217" class="Bound">orphans</a>
      <a id="7321" href="Ledger.Epoch.html#7321" class="Bound">removedGovActions</a> <a id="7339" class="Symbol">=</a> <a id="7341" href="Function.Base.html#1638" class="Function">flip</a> <a id="7346" href="Axiom.Set.html#7022" class="Function">concatMapˢ</a> <a id="7357" href="Ledger.Epoch.html#7277" class="Bound">removed&#39;</a> <a id="7366" class="Symbol">λ</a> <a id="7368" class="Symbol">(</a><a id="7369" href="Ledger.Epoch.html#7369" class="Bound">gaid</a> <a id="7374" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="7376" href="Ledger.Epoch.html#7376" class="Bound">gaSt</a><a id="7380" class="Symbol">)</a> <a id="7382" class="Symbol">→</a>
        <a id="7392" href="abstract-set-theory.FiniteSetTheory.html#519" class="Function">mapˢ</a> <a id="7397" class="Symbol">(</a><a id="7398" href="Ledger.GovernanceActions.html#2817" class="Field">returnAddr</a> <a id="7409" href="Ledger.Epoch.html#7376" class="Bound">gaSt</a> <a id="7414" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,_</a><a id="7416" class="Symbol">)</a> <a id="7418" class="Symbol">((</a><a id="7420" href="Ledger.Ledger.html#868" class="Function">utxoSt</a> <a id="7427" class="Symbol">.</a><a id="7428" href="Ledger.Utxo.html#2813" class="Field">deposits</a> <a id="7437" href="Axiom.Set.Map.html#10678" class="Function Operator">∣</a> <a id="7439" href="Class.HasSingleton.html#288" class="Field Operator">❴</a> <a id="7441" href="Ledger.Certs.html#521" class="InductiveConstructor">GovActionDeposit</a> <a id="7458" href="Ledger.Epoch.html#7369" class="Bound">gaid</a> <a id="7463" href="Class.HasSingleton.html#288" class="Field Operator">❵</a><a id="7464" class="Symbol">)</a> <a id="7466" href="Axiom.Set.Map.html#2293" class="Function Operator">ˢ</a><a id="7467" class="Symbol">)</a>
      <a id="7475" href="Ledger.Epoch.html#7475" class="Bound">govActionReturns</a> <a id="7492" class="Symbol">=</a> <a id="7494" href="Axiom.Set.Map.Dec.html#1932" class="Function">aggregate₊</a> <a id="7505" class="Symbol">(</a><a id="7506" href="abstract-set-theory.FiniteSetTheory.html#519" class="Function">mapˢ</a> <a id="7511" class="Symbol">(λ</a> <a id="7514" class="Symbol">(</a><a id="7515" href="Ledger.Epoch.html#7515" class="Bound">a</a> <a id="7517" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="7519" class="Symbol">_</a> <a id="7521" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="7523" href="Ledger.Epoch.html#7523" class="Bound">d</a><a id="7524" class="Symbol">)</a> <a id="7526" class="Symbol">→</a> <a id="7528" href="Ledger.Epoch.html#7515" class="Bound">a</a> <a id="7530" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="7532" href="Ledger.Epoch.html#7523" class="Bound">d</a><a id="7533" class="Symbol">)</a> <a id="7535" href="Ledger.Epoch.html#7321" class="Bound">removedGovActions</a> <a id="7553" href="abstract-set-theory.FiniteSetTheory.html#2767" class="Function Operator">ᶠˢ</a><a id="7555" class="Symbol">)</a>

      <a id="7564" href="Ledger.Epoch.html#7564" class="Bound">trWithdrawals</a>   <a id="7580" class="Symbol">=</a> <a id="7582" href="Ledger.Epoch.html#7039" class="Bound">esW</a> <a id="7586" class="Symbol">.</a><a id="7587" href="Ledger.Enact.html#649" class="Field">withdrawals</a>
      <a id="7605" href="Ledger.Epoch.html#7605" class="Bound">totWithdrawals</a>  <a id="7621" class="Symbol">=</a> <a id="7623" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">∑[</a> <a id="7626" href="Ledger.Epoch.html#7626" class="Bound">x</a> <a id="7628" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">←</a> <a id="7630" href="Ledger.Epoch.html#7564" class="Bound">trWithdrawals</a> <a id="7644" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">]</a> <a id="7646" href="Ledger.Epoch.html#7626" class="Bound">x</a>

      <a id="7655" href="Ledger.Epoch.html#7655" class="Bound">retired</a>    <a id="7666" class="Symbol">=</a> <a id="7668" class="Symbol">(</a><a id="7669" href="Ledger.Certs.html#4410" class="Function">pState</a> <a id="7676" class="Symbol">.</a><a id="7677" href="Ledger.Certs.html#3850" class="Field">retiring</a><a id="7685" class="Symbol">)</a> <a id="7687" href="Axiom.Set.Map.html#14230" class="Function Operator">⁻¹</a> <a id="7690" href="Ledger.Epoch.html#6189" class="Generalizable">e</a>
      <a id="7698" href="Ledger.Epoch.html#7698" class="Bound">payout</a>     <a id="7709" class="Symbol">=</a> <a id="7711" href="Ledger.Epoch.html#7475" class="Bound">govActionReturns</a> <a id="7728" href="Axiom.Set.Map.Dec.html#1854" class="Function Operator">∪⁺</a> <a id="7731" href="Ledger.Epoch.html#7564" class="Bound">trWithdrawals</a>
      <a id="7751" href="Ledger.Epoch.html#7751" class="Bound">refunds</a>    <a id="7762" class="Symbol">=</a> <a id="7764" href="Axiom.Set.Map.html#13791" class="Function">pullbackMap</a> <a id="7776" href="Ledger.Epoch.html#7698" class="Bound">payout</a> <a id="7783" href="Ledger.Epoch.html#3953" class="Function">toRwdAddr</a> <a id="7793" class="Symbol">(</a><a id="7794" href="Class.IsSet.html#916" class="Function">dom</a> <a id="7798" class="Symbol">(</a><a id="7799" href="Ledger.Certs.html#4390" class="Function">dState</a> <a id="7806" class="Symbol">.</a><a id="7807" href="Ledger.Certs.html#3309" class="Field">rewards</a><a id="7814" class="Symbol">))</a>
      <a id="7823" href="Ledger.Epoch.html#7823" class="Bound">unclaimed</a>  <a id="7834" class="Symbol">=</a> <a id="7836" href="Ledger.Interface.HasCoin.html#172" class="Field">getCoin</a> <a id="7844" href="Ledger.Epoch.html#7698" class="Bound">payout</a> <a id="7851" href="Interface.HasSubtract.html#209" class="Field Operator">-</a> <a id="7853" href="Ledger.Interface.HasCoin.html#172" class="Field">getCoin</a> <a id="7861" href="Ledger.Epoch.html#7751" class="Bound">refunds</a>

      <a id="7876" href="Ledger.Epoch.html#7876" class="Bound">govSt&#39;</a> <a id="7883" class="Symbol">=</a> <a id="7885" href="Ledger.Prelude.html#2559" class="Function">filter</a> <a id="7892" class="Symbol">(λ</a> <a id="7895" href="Ledger.Epoch.html#7895" class="Bound">x</a> <a id="7897" class="Symbol">→</a> <a id="7899" href="Data.Product.Base.html#636" class="Field">proj₁</a> <a id="7905" href="Ledger.Epoch.html#7895" class="Bound">x</a> <a id="7907" href="Class.IsSet.html#462" class="Function Operator">∉</a> <a id="7909" href="abstract-set-theory.FiniteSetTheory.html#519" class="Function">mapˢ</a> <a id="7914" href="Data.Product.Base.html#636" class="Field">proj₁</a> <a id="7920" href="Ledger.Epoch.html#7277" class="Bound">removed&#39;</a><a id="7928" class="Symbol">)</a> <a id="7930" href="Ledger.Ledger.html#895" class="Function">govSt</a>

      <a id="7943" href="Ledger.Epoch.html#7943" class="Bound">dState&#39;</a> <a id="7951" class="Symbol">=</a> <a id="7953" href="Ledger.Prelude.html#2308" class="Function Operator">⟦</a> <a id="7955" href="Ledger.Certs.html#4390" class="Function">dState</a> <a id="7962" class="Symbol">.</a><a id="7963" href="Ledger.Certs.html#3230" class="Field">voteDelegs</a> <a id="7974" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="7976" href="Ledger.Certs.html#4390" class="Function">dState</a> <a id="7983" class="Symbol">.</a><a id="7984" href="Ledger.Certs.html#3269" class="Field">stakeDelegs</a> <a id="7996" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a>  <a id="7999" href="Ledger.Certs.html#4390" class="Function">dState</a> <a id="8006" class="Symbol">.</a><a id="8007" href="Ledger.Certs.html#3309" class="Field">rewards</a> <a id="8015" href="Axiom.Set.Map.Dec.html#1854" class="Function Operator">∪⁺</a> <a id="8018" href="Ledger.Epoch.html#7751" class="Bound">refunds</a> <a id="8026" href="Ledger.Prelude.html#2308" class="Function Operator">⟧</a>

      <a id="8035" href="Ledger.Epoch.html#8035" class="Bound">pState&#39;</a> <a id="8043" class="Symbol">=</a> <a id="8045" href="Ledger.Prelude.html#2308" class="Function Operator">⟦</a> <a id="8047" href="Ledger.Certs.html#4410" class="Function">pState</a> <a id="8054" class="Symbol">.</a><a id="8055" href="Ledger.Certs.html#3813" class="Field">pools</a> <a id="8061" href="Axiom.Set.Map.html#10748" class="Function Operator">∣</a> <a id="8063" href="Ledger.Epoch.html#7655" class="Bound">retired</a> <a id="8071" href="Axiom.Set.Map.html#10748" class="Function Operator">ᶜ</a> <a id="8073" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="8075" href="Ledger.Certs.html#4410" class="Function">pState</a> <a id="8082" class="Symbol">.</a><a id="8083" href="Ledger.Certs.html#3850" class="Field">retiring</a> <a id="8092" href="Axiom.Set.Map.html#10748" class="Function Operator">∣</a> <a id="8094" href="Ledger.Epoch.html#7655" class="Bound">retired</a> <a id="8102" href="Axiom.Set.Map.html#10748" class="Function Operator">ᶜ</a> <a id="8104" href="Ledger.Prelude.html#2308" class="Function Operator">⟧</a>

      <a id="8113" href="Ledger.Epoch.html#8113" class="Bound">gState&#39;</a> <a id="8121" class="Symbol">=</a> <a id="8123" href="Ledger.Prelude.html#2308" class="Function Operator">⟦</a> <a id="8125" class="Symbol">(</a><a id="8126" href="Class.ToBool.html#389" class="Function Operator">if</a> <a id="8129" href="Data.List.Base.html#4703" class="Function">null</a> <a id="8134" href="Ledger.Epoch.html#7876" class="Bound">govSt&#39;</a> <a id="8141" href="Class.ToBool.html#389" class="Function Operator">then</a> <a id="8146" href="Axiom.Set.Map.html#6068" class="Function">mapValues</a> <a id="8156" class="Symbol">(</a><a id="8157" class="Number">1</a> <a id="8159" href="Class.HasAdd.Core.html#162" class="Field Operator">+_</a><a id="8161" class="Symbol">)</a> <a id="8163" class="Symbol">(</a><a id="8164" href="Ledger.Certs.html#4430" class="Function">gState</a> <a id="8171" class="Symbol">.</a><a id="8172" href="Ledger.Certs.html#4054" class="Field">dreps</a><a id="8177" class="Symbol">)</a> <a id="8179" href="Class.ToBool.html#389" class="Function Operator">else</a> <a id="8184" class="Symbol">(</a><a id="8185" href="Ledger.Certs.html#4430" class="Function">gState</a> <a id="8192" class="Symbol">.</a><a id="8193" href="Ledger.Certs.html#4054" class="Field">dreps</a><a id="8198" class="Symbol">))</a>
                <a id="8217" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="8219" href="Ledger.Certs.html#4430" class="Function">gState</a> <a id="8226" class="Symbol">.</a><a id="8227" href="Ledger.Certs.html#4077" class="Field">ccHotKeys</a> <a id="8237" href="Axiom.Set.Map.html#10678" class="Function Operator">∣</a> <a id="8239" href="Ledger.Enact.html#1194" class="Function">ccCreds</a> <a id="8247" class="Symbol">(</a><a id="8248" href="Ledger.Epoch.html#7084" class="Bound">es</a> <a id="8251" class="Symbol">.</a><a id="8252" href="Ledger.Enact.html#433" class="Field">cc</a><a id="8254" class="Symbol">)</a> <a id="8256" href="Ledger.Prelude.html#2308" class="Function Operator">⟧</a>

      <a id="8265" href="Ledger.Epoch.html#8265" class="Bound">certState&#39;</a> <a id="8276" class="Symbol">:</a> <a id="8278" href="Ledger.Certs.html#4327" class="Record">CertState</a>
      <a id="8294" href="Ledger.Epoch.html#8265" class="Bound">certState&#39;</a> <a id="8305" class="Symbol">=</a> <a id="8307" href="Ledger.Prelude.html#2308" class="Function Operator">⟦</a> <a id="8309" href="Ledger.Epoch.html#7943" class="Bound">dState&#39;</a> <a id="8317" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="8319" href="Ledger.Epoch.html#8035" class="Bound">pState&#39;</a> <a id="8327" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="8329" href="Ledger.Epoch.html#8113" class="Bound">gState&#39;</a> <a id="8337" href="Ledger.Prelude.html#2308" class="Function Operator">⟧</a>

      <a id="8346" href="Ledger.Epoch.html#8346" class="Bound">utxoSt&#39;</a> <a id="8354" class="Symbol">=</a> <a id="8356" href="Ledger.Prelude.html#2308" class="Function Operator">⟦</a> <a id="8358" href="Ledger.Ledger.html#868" class="Function">utxoSt</a> <a id="8365" class="Symbol">.</a><a id="8366" href="Ledger.Utxo.html#2769" class="Field">utxo</a> <a id="8371" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="8373" href="Ledger.Ledger.html#868" class="Function">utxoSt</a> <a id="8380" class="Symbol">.</a><a id="8381" href="Ledger.Utxo.html#2791" class="Field">fees</a> <a id="8386" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="8388" href="Ledger.Ledger.html#868" class="Function">utxoSt</a> <a id="8395" class="Symbol">.</a><a id="8396" href="Ledger.Utxo.html#2813" class="Field">deposits</a> <a id="8405" href="Axiom.Set.Map.html#10748" class="Function Operator">∣</a> <a id="8407" href="abstract-set-theory.FiniteSetTheory.html#519" class="Function">mapˢ</a> <a id="8412" class="Symbol">(</a><a id="8413" href="Data.Product.Base.html#636" class="Field">proj₁</a> <a id="8419" href="Function.Base.html#1115" class="Function Operator">∘</a> <a id="8421" href="Data.Product.Base.html#650" class="Field">proj₂</a><a id="8426" class="Symbol">)</a> <a id="8428" href="Ledger.Epoch.html#7321" class="Bound">removedGovActions</a> <a id="8446" href="Axiom.Set.Map.html#10748" class="Function Operator">ᶜ</a> <a id="8448" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="8450" class="Number">0</a> <a id="8452" href="Ledger.Prelude.html#2308" class="Function Operator">⟧</a>

      <a id="8461" href="Ledger.Epoch.html#8461" class="Bound">acnt&#39;</a> <a id="8467" class="Symbol">=</a> <a id="8469" class="Keyword">record</a> <a id="8476" href="Ledger.Epoch.html#6280" class="Generalizable">acnt</a>
        <a id="8489" class="Symbol">{</a> <a id="8491" href="Ledger.PParams.html#729" class="Field">treasury</a>  <a id="8501" class="Symbol">=</a> <a id="8503" href="Ledger.Epoch.html#6280" class="Generalizable">acnt</a> <a id="8508" class="Symbol">.</a><a id="8509" href="Ledger.PParams.html#729" class="Field">treasury</a> <a id="8518" href="Data.Nat.Base.html#4462" class="Primitive Operator">∸</a> <a id="8520" href="Ledger.Epoch.html#7605" class="Bound">totWithdrawals</a> <a id="8535" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="8537" href="Ledger.Ledger.html#868" class="Function">utxoSt</a> <a id="8544" class="Symbol">.</a><a id="8545" href="Ledger.Utxo.html#2839" class="Field">donations</a> <a id="8555" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="8557" href="Ledger.Epoch.html#7823" class="Bound">unclaimed</a> <a id="8567" class="Symbol">}</a>
    <a id="8573" class="Keyword">in</a>
    <a id="8580" class="Keyword">record</a> <a id="8587" class="Symbol">{</a> <a id="8589" href="Ledger.Ratify.html#3054" class="Field">currentEpoch</a> <a id="8602" class="Symbol">=</a> <a id="8604" href="Ledger.Epoch.html#6189" class="Generalizable">e</a>
           <a id="8617" class="Symbol">;</a> <a id="8619" href="Ledger.Ratify.html#3022" class="Field">stakeDistrs</a> <a id="8631" class="Symbol">=</a> <a id="8633" href="Ledger.Epoch.html#5911" class="Function">mkStakeDistrs</a>  <a id="8648" class="Symbol">(</a><a id="8649" href="Ledger.Epoch.html#1298" class="Field">Snapshots.mark</a> <a id="8664" href="Ledger.Epoch.html#6374" class="Generalizable">ss&#39;</a><a id="8667" class="Symbol">)</a> <a id="8669" href="Ledger.Epoch.html#7876" class="Bound">govSt&#39;</a>
                                          <a id="8718" class="Symbol">(</a><a id="8719" href="Ledger.Epoch.html#8346" class="Bound">utxoSt&#39;</a> <a id="8727" class="Symbol">.</a><a id="8728" href="Ledger.Utxo.html#2813" class="Field">deposits</a><a id="8736" class="Symbol">)</a> <a id="8738" class="Symbol">(</a><a id="8739" href="Ledger.Certs.html#3230" class="Field">voteDelegs</a> <a id="8750" href="Ledger.Certs.html#4390" class="Function">dState</a><a id="8756" class="Symbol">)</a>
           <a id="8769" class="Symbol">;</a> <a id="8771" href="Ledger.Ratify.html#3169" class="Field">treasury</a> <a id="8780" class="Symbol">=</a> <a id="8782" href="Ledger.Epoch.html#6280" class="Generalizable">acnt</a> <a id="8787" class="Symbol">.</a><a id="8788" href="Ledger.PParams.html#729" class="Field">treasury</a> <a id="8797" class="Symbol">;</a> <a id="8799" href="Ledger.Epoch.html#8799" class="Module">GState</a> <a id="8806" href="Ledger.Certs.html#4430" class="Function">gState</a>
           <a id="8824" class="Symbol">;</a> <a id="8826" href="Ledger.Ratify.html#3194" class="Field">pools</a> <a id="8832" class="Symbol">=</a> <a id="8834" href="Ledger.Certs.html#4410" class="Function">pState</a> <a id="8841" class="Symbol">.</a><a id="8842" href="Ledger.Certs.html#3813" class="Field">pools</a> <a id="8848" class="Symbol">;</a> <a id="8850" href="Ledger.Ratify.html#3235" class="Field">delegatees</a> <a id="8861" class="Symbol">=</a> <a id="8863" href="Ledger.Certs.html#4390" class="Function">dState</a> <a id="8870" class="Symbol">.</a><a id="8871" href="Ledger.Certs.html#3230" class="Field">voteDelegs</a> <a id="8882" class="Symbol">}</a>
        <a id="8892" href="Ledger.Ratify.html#11072" class="Function Operator">⊢</a> <a id="8894" href="Ledger.Prelude.html#2308" class="Function Operator">⟦</a> <a id="8896" href="Ledger.Epoch.html#7084" class="Bound">es</a> <a id="8899" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="8901" href="Class.HasEmptySet.html#287" class="Field">∅</a> <a id="8903" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="8905" href="Agda.Builtin.Bool.html#192" class="InductiveConstructor">false</a> <a id="8911" href="Ledger.Prelude.html#2308" class="Function Operator">⟧</a> <a id="8913" href="Ledger.Ratify.html#11072" class="Function Operator">⇀⦇</a> <a id="8916" href="Ledger.Epoch.html#7876" class="Bound">govSt&#39;</a> <a id="8923" href="Ledger.Ratify.html#11072" class="Function Operator">,RATIFIES⦈</a> <a id="8934" href="Ledger.Epoch.html#6215" class="Generalizable">fut&#39;</a>
      <a id="8945" class="Symbol">→</a> <a id="8947" href="Ledger.Epoch.html#6266" class="Generalizable">ls</a> <a id="8950" href="Ledger.Epoch.html#6444" class="Datatype Operator">⊢</a> <a id="8952" href="Ledger.Epoch.html#6371" class="Generalizable">ss</a> <a id="8955" href="Ledger.Epoch.html#6444" class="Datatype Operator">⇀⦇</a> <a id="8958" href="Agda.Builtin.Unit.html#212" class="InductiveConstructor">tt</a> <a id="8961" href="Ledger.Epoch.html#6444" class="Datatype Operator">,SNAP⦈</a> <a id="8968" href="Ledger.Epoch.html#6374" class="Generalizable">ss&#39;</a>
    <a id="8976" href="Interface.STS.html#350" class="Function Operator">────────────────────────────────</a>
    <a id="9013" class="Symbol">_</a> <a id="9015" href="Ledger.Epoch.html#6737" class="Datatype Operator">⊢</a> <a id="9017" href="Ledger.Prelude.html#2308" class="Function Operator">⟦</a> <a id="9019" href="Ledger.Epoch.html#6280" class="Generalizable">acnt</a> <a id="9024" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="9026" href="Ledger.Epoch.html#6371" class="Generalizable">ss</a> <a id="9029" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="9031" href="Ledger.Epoch.html#6266" class="Generalizable">ls</a> <a id="9034" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="9036" href="Ledger.Epoch.html#6294" class="Generalizable">es₀</a> <a id="9040" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="9042" href="Ledger.Epoch.html#6211" class="Generalizable">fut</a> <a id="9046" href="Ledger.Prelude.html#2308" class="Function Operator">⟧</a> <a id="9048" href="Ledger.Epoch.html#6737" class="Datatype Operator">⇀⦇</a> <a id="9051" href="Ledger.Epoch.html#6189" class="Generalizable">e</a> <a id="9053" href="Ledger.Epoch.html#6737" class="Datatype Operator">,EPOCH⦈</a>
        <a id="9069" href="Ledger.Prelude.html#2308" class="Function Operator">⟦</a> <a id="9071" href="Ledger.Epoch.html#8461" class="Bound">acnt&#39;</a> <a id="9077" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="9079" href="Ledger.Epoch.html#6374" class="Generalizable">ss&#39;</a> <a id="9083" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="9085" href="Ledger.Prelude.html#2308" class="Function Operator">⟦</a> <a id="9087" href="Ledger.Epoch.html#8346" class="Bound">utxoSt&#39;</a> <a id="9095" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="9097" href="Ledger.Epoch.html#7876" class="Bound">govSt&#39;</a> <a id="9104" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="9106" href="Ledger.Epoch.html#8265" class="Bound">certState&#39;</a> <a id="9117" href="Ledger.Prelude.html#2308" class="Function Operator">⟧</a> <a id="9119" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="9121" href="Ledger.Epoch.html#7084" class="Bound">es</a> <a id="9124" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="9126" href="Ledger.Epoch.html#6215" class="Generalizable">fut&#39;</a> <a id="9131" href="Ledger.Prelude.html#2308" class="Function Operator">⟧</a>


<a id="9135" class="Keyword">data</a>


  <a id="_⊢_⇀⦇_,NEWEPOCH⦈_"></a><a id="9144" href="Ledger.Epoch.html#9144" class="Datatype Operator">_⊢_⇀⦇_,NEWEPOCH⦈_</a> <a id="9162" class="Symbol">:</a> <a id="9164" href="Agda.Builtin.Unit.html#175" class="Record">⊤</a> <a id="9166" class="Symbol">→</a> <a id="9168" href="Ledger.Epoch.html#2136" class="Record">NewEpochState</a> <a id="9182" class="Symbol">→</a> <a id="9184" href="Ledger.Types.Epoch.html#476" class="Function">Epoch</a> <a id="9190" class="Symbol">→</a> <a id="9192" href="Ledger.Epoch.html#2136" class="Record">NewEpochState</a> <a id="9206" class="Symbol">→</a> <a id="9208" href="Agda.Primitive.html#388" class="Primitive">Type</a>


  <a id="9217" class="Keyword">where</a>


  <a id="_⊢_⇀⦇_,NEWEPOCH⦈_.NEWEPOCH-New"></a><a id="9227" href="Ledger.Epoch.html#9227" class="InductiveConstructor">NEWEPOCH-New</a> <a id="9240" class="Symbol">:</a> <a id="9242" class="Keyword">let</a>
      <a id="9252" href="Ledger.Epoch.html#9252" class="Bound">eps&#39;</a> <a id="9257" class="Symbol">=</a> <a id="9259" href="Ledger.Epoch.html#4192" class="Function">applyRUpd</a> <a id="9269" href="Ledger.Epoch.html#6392" class="Generalizable">ru</a> <a id="9272" href="Ledger.Epoch.html#6236" class="Generalizable">eps</a>
    <a id="9280" class="Keyword">in</a>
    <a id="9287" href="Interface.STS.html#105" class="Function Operator">∙</a> <a id="9289" href="Ledger.Epoch.html#6189" class="Generalizable">e</a> <a id="9291" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="9293" href="Ledger.Epoch.html#6191" class="Generalizable">lastEpoch</a> <a id="9303" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="9305" class="Number">1</a>
    <a id="9311" href="Interface.STS.html#131" class="Function Operator">∙</a> <a id="9313" class="Symbol">_</a> <a id="9315" href="Ledger.Epoch.html#6737" class="Datatype Operator">⊢</a> <a id="9317" href="Ledger.Epoch.html#9252" class="Bound">eps&#39;</a> <a id="9322" href="Ledger.Epoch.html#6737" class="Datatype Operator">⇀⦇</a> <a id="9325" href="Ledger.Epoch.html#6189" class="Generalizable">e</a> <a id="9327" href="Ledger.Epoch.html#6737" class="Datatype Operator">,EPOCH⦈</a> <a id="9335" href="Ledger.Epoch.html#6245" class="Generalizable">eps&#39;&#39;</a>
      <a id="9347" href="Interface.STS.html#350" class="Function Operator">────────────────────────────────</a>
      <a id="9386" class="Symbol">_</a> <a id="9388" href="Ledger.Epoch.html#9144" class="Datatype Operator">⊢</a> <a id="9390" href="Ledger.Prelude.html#2308" class="Function Operator">⟦</a> <a id="9392" href="Ledger.Epoch.html#6191" class="Generalizable">lastEpoch</a> <a id="9402" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="9404" href="Ledger.Epoch.html#6236" class="Generalizable">eps</a> <a id="9408" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="9410" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="9415" href="Ledger.Epoch.html#6392" class="Generalizable">ru</a> <a id="9418" href="Ledger.Prelude.html#2308" class="Function Operator">⟧</a> <a id="9420" href="Ledger.Epoch.html#9144" class="Datatype Operator">⇀⦇</a> <a id="9423" href="Ledger.Epoch.html#6189" class="Generalizable">e</a> <a id="9425" href="Ledger.Epoch.html#9144" class="Datatype Operator">,NEWEPOCH⦈</a> <a id="9436" href="Ledger.Prelude.html#2308" class="Function Operator">⟦</a> <a id="9438" href="Ledger.Epoch.html#6189" class="Generalizable">e</a> <a id="9440" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="9442" href="Ledger.Epoch.html#6245" class="Generalizable">eps&#39;&#39;</a> <a id="9448" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="9450" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a> <a id="9458" href="Ledger.Prelude.html#2308" class="Function Operator">⟧</a>

  <a id="_⊢_⇀⦇_,NEWEPOCH⦈_.NEWEPOCH-Not-New"></a><a id="9463" href="Ledger.Epoch.html#9463" class="InductiveConstructor">NEWEPOCH-Not-New</a> <a id="9480" class="Symbol">:</a>
    <a id="9486" href="Interface.STS.html#105" class="Function Operator">∙</a> <a id="9488" href="Ledger.Epoch.html#6189" class="Generalizable">e</a> <a id="9490" href="Relation.Binary.PropositionalEquality.Core.html#858" class="Function Operator">≢</a> <a id="9492" href="Ledger.Epoch.html#6191" class="Generalizable">lastEpoch</a> <a id="9502" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="9504" class="Number">1</a>
      <a id="9512" href="Interface.STS.html#350" class="Function Operator">────────────────────────────────</a>
      <a id="9551" class="Symbol">_</a> <a id="9553" href="Ledger.Epoch.html#9144" class="Datatype Operator">⊢</a> <a id="9555" href="Ledger.Prelude.html#2308" class="Function Operator">⟦</a> <a id="9557" href="Ledger.Epoch.html#6191" class="Generalizable">lastEpoch</a> <a id="9567" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="9569" href="Ledger.Epoch.html#6236" class="Generalizable">eps</a> <a id="9573" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="9575" href="Ledger.Epoch.html#6412" class="Generalizable">mru</a> <a id="9579" href="Ledger.Prelude.html#2308" class="Function Operator">⟧</a> <a id="9581" href="Ledger.Epoch.html#9144" class="Datatype Operator">⇀⦇</a> <a id="9584" href="Ledger.Epoch.html#6189" class="Generalizable">e</a> <a id="9586" href="Ledger.Epoch.html#9144" class="Datatype Operator">,NEWEPOCH⦈</a> <a id="9597" href="Ledger.Prelude.html#2308" class="Function Operator">⟦</a> <a id="9599" href="Ledger.Epoch.html#6191" class="Generalizable">lastEpoch</a> <a id="9609" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="9611" href="Ledger.Epoch.html#6236" class="Generalizable">eps</a> <a id="9615" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="9617" href="Ledger.Epoch.html#6412" class="Generalizable">mru</a> <a id="9621" href="Ledger.Prelude.html#2308" class="Function Operator">⟧</a>

  <a id="_⊢_⇀⦇_,NEWEPOCH⦈_.NEWEPOCH-No-Reward-Update"></a><a id="9626" href="Ledger.Epoch.html#9626" class="InductiveConstructor">NEWEPOCH-No-Reward-Update</a> <a id="9652" class="Symbol">:</a>
    <a id="9658" href="Interface.STS.html#105" class="Function Operator">∙</a> <a id="9660" href="Ledger.Epoch.html#6189" class="Generalizable">e</a> <a id="9662" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="9664" href="Ledger.Epoch.html#6191" class="Generalizable">lastEpoch</a> <a id="9674" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="9676" class="Number">1</a>
    <a id="9682" href="Interface.STS.html#131" class="Function Operator">∙</a> <a id="9684" class="Symbol">_</a> <a id="9686" href="Ledger.Epoch.html#6737" class="Datatype Operator">⊢</a> <a id="9688" href="Ledger.Epoch.html#6236" class="Generalizable">eps</a> <a id="9692" href="Ledger.Epoch.html#6737" class="Datatype Operator">⇀⦇</a> <a id="9695" href="Ledger.Epoch.html#6189" class="Generalizable">e</a> <a id="9697" href="Ledger.Epoch.html#6737" class="Datatype Operator">,EPOCH⦈</a> <a id="9705" href="Ledger.Epoch.html#6240" class="Generalizable">eps&#39;</a>
      <a id="9716" href="Interface.STS.html#350" class="Function Operator">────────────────────────────────</a>
      <a id="9755" class="Symbol">_</a> <a id="9757" href="Ledger.Epoch.html#9144" class="Datatype Operator">⊢</a> <a id="9759" href="Ledger.Prelude.html#2308" class="Function Operator">⟦</a> <a id="9761" href="Ledger.Epoch.html#6191" class="Generalizable">lastEpoch</a> <a id="9771" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="9773" href="Ledger.Epoch.html#6236" class="Generalizable">eps</a> <a id="9777" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="9779" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a> <a id="9787" href="Ledger.Prelude.html#2308" class="Function Operator">⟧</a> <a id="9789" href="Ledger.Epoch.html#9144" class="Datatype Operator">⇀⦇</a> <a id="9792" href="Ledger.Epoch.html#6189" class="Generalizable">e</a> <a id="9794" href="Ledger.Epoch.html#9144" class="Datatype Operator">,NEWEPOCH⦈</a> <a id="9805" href="Ledger.Prelude.html#2308" class="Function Operator">⟦</a> <a id="9807" href="Ledger.Epoch.html#6189" class="Generalizable">e</a> <a id="9809" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="9811" href="Ledger.Epoch.html#6240" class="Generalizable">eps&#39;</a> <a id="9816" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="9818" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a> <a id="9826" href="Ledger.Prelude.html#2308" class="Function Operator">⟧</a>

</pre></body></html>