<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>Ledger.Epoch</title><link rel="stylesheet" href="Agda.css"></head><body><pre class="Agda">
<a id="2" class="Symbol">{-#</a> <a id="6" class="Keyword">OPTIONS</a> <a id="14" class="Pragma">--safe</a> <a id="21" class="Symbol">#-}</a>

<a id="26" class="Keyword">open</a> <a id="31" class="Keyword">import</a> <a id="38" href="Data.Nat.Properties.html" class="Module">Data.Nat.Properties</a> <a id="58" class="Keyword">using</a> <a id="64" class="Symbol">(</a><a id="65" href="Data.Nat.Properties.html#17056" class="Function">+-0-monoid</a><a id="75" class="Symbol">;</a> <a id="77" href="Data.Nat.Properties.html#17135" class="Function">+-0-commutativeMonoid</a><a id="98" class="Symbol">)</a>
<a id="100" class="Keyword">open</a> <a id="105" class="Keyword">import</a> <a id="112" href="Data.List.html" class="Module">Data.List</a> <a id="122" class="Keyword">using</a> <a id="128" class="Symbol">(</a><a id="129" href="Data.List.Base.html#10687" class="Function">filter</a><a id="135" class="Symbol">)</a>
<a id="137" class="Keyword">open</a> <a id="142" class="Keyword">import</a> <a id="149" href="Data.Integer.html" class="Module">Data.Integer</a> <a id="162" class="Keyword">using</a> <a id="168" class="Symbol">()</a> <a id="171" class="Keyword">renaming</a> <a id="180" class="Symbol">(</a><a id="181" href="Agda.Builtin.Int.html#263" class="InductiveConstructor">+_</a> <a id="184" class="Symbol">to</a> <a id="187" class="InductiveConstructor">pos</a><a id="190" class="Symbol">)</a>
<a id="192" class="Keyword">open</a> <a id="197" class="Keyword">import</a> <a id="204" href="Data.Integer.Ext.html" class="Module">Data.Integer.Ext</a>
<a id="221" class="Keyword">open</a> <a id="226" class="Keyword">import</a> <a id="233" href="Data.Nat.GeneralisedArithmetic.html" class="Module">Data.Nat.GeneralisedArithmetic</a> <a id="264" class="Keyword">using</a> <a id="270" class="Symbol">(</a><a id="271" href="Data.Nat.GeneralisedArithmetic.html#866" class="Function">iterate</a><a id="278" class="Symbol">)</a>

<a id="281" class="Keyword">open</a> <a id="286" class="Keyword">import</a> <a id="293" href="Agda.Builtin.FromNat.html" class="Module">Agda.Builtin.FromNat</a>

<a id="315" class="Keyword">open</a> <a id="320" class="Keyword">import</a> <a id="327" href="Ledger.Prelude.html" class="Module">Ledger.Prelude</a> <a id="342" class="Keyword">hiding</a> <a id="349" class="Symbol">(</a><a id="350" href="Data.List.Base.html#5412" class="Function">iterate</a><a id="357" class="Symbol">)</a>
<a id="359" class="Keyword">open</a> <a id="364" class="Keyword">import</a> <a id="371" href="Ledger.Abstract.html" class="Module">Ledger.Abstract</a>
<a id="387" class="Keyword">open</a> <a id="392" class="Keyword">import</a> <a id="399" href="Ledger.Transaction.html" class="Module">Ledger.Transaction</a>

<a id="419" class="Keyword">module</a> <a id="426" href="Ledger.Epoch.html" class="Module">Ledger.Epoch</a>
  <a id="441" class="Symbol">(</a><a id="442" href="Ledger.Epoch.html#442" class="Bound">txs</a> <a id="446" class="Symbol">:</a> <a id="448" class="Symbol">_)</a> <a id="451" class="Symbol">(</a><a id="452" class="Keyword">open</a> <a id="457" href="Ledger.Transaction.html#867" class="Module">TransactionStructure</a> <a id="478" href="Ledger.Epoch.html#442" class="Bound">txs</a><a id="481" class="Symbol">)</a>
  <a id="485" class="Symbol">(</a><a id="486" href="Ledger.Epoch.html#486" class="Bound">abs</a> <a id="490" class="Symbol">:</a> <a id="492" href="Ledger.Abstract.html#578" class="Record">AbstractFunctions</a> <a id="510" href="Ledger.Epoch.html#442" class="Bound">txs</a><a id="513" class="Symbol">)</a> <a id="515" class="Symbol">(</a><a id="516" class="Keyword">open</a> <a id="521" href="Ledger.Abstract.html#578" class="Module">AbstractFunctions</a> <a id="539" href="Ledger.Epoch.html#486" class="Bound">abs</a><a id="542" class="Symbol">)</a>
  <a id="546" class="Keyword">where</a>

<a id="553" class="Keyword">open</a> <a id="558" class="Keyword">import</a> <a id="565" href="Ledger.Gov.html" class="Module">Ledger.Gov</a> <a id="576" href="Ledger.Epoch.html#442" class="Bound">txs</a>
<a id="580" class="Keyword">open</a> <a id="585" class="Keyword">import</a> <a id="592" href="Ledger.Enact.html" class="Module">Ledger.Enact</a> <a id="605" href="Ledger.Transaction.html#1809" class="Function">govStructure</a>
<a id="618" class="Keyword">open</a> <a id="623" class="Keyword">import</a> <a id="630" href="Ledger.Ledger.html" class="Module">Ledger.Ledger</a> <a id="644" href="Ledger.Epoch.html#442" class="Bound">txs</a> <a id="648" href="Ledger.Epoch.html#486" class="Bound">abs</a>
<a id="652" class="Keyword">open</a> <a id="657" class="Keyword">import</a> <a id="664" href="Ledger.Ratify.html" class="Module">Ledger.Ratify</a> <a id="678" href="Ledger.Epoch.html#442" class="Bound">txs</a>
<a id="682" class="Keyword">open</a> <a id="687" class="Keyword">import</a> <a id="694" href="Ledger.Utxo.html" class="Module">Ledger.Utxo</a> <a id="706" href="Ledger.Epoch.html#442" class="Bound">txs</a> <a id="710" href="Ledger.Epoch.html#486" class="Bound">abs</a>
<a id="714" class="Keyword">open</a> <a id="719" class="Keyword">import</a> <a id="726" href="Ledger.Certs.html" class="Module">Ledger.Certs</a> <a id="739" href="Ledger.Transaction.html#1809" class="Function">govStructure</a>


<a id="754" class="Keyword">record</a> <a id="RewardUpdate"></a><a id="761" href="Ledger.Epoch.html#761" class="Record">RewardUpdate</a> <a id="774" class="Symbol">:</a> <a id="776" href="Agda.Primitive.html#388" class="Primitive">Set</a> <a id="780" class="Keyword">where</a>


  <a id="790" class="Keyword">constructor</a> <a id="⟦_,_,_,_⟧ʳᵘ"></a><a id="802" href="Ledger.Epoch.html#802" class="InductiveConstructor Operator">⟦_,_,_,_⟧ʳᵘ</a>


  <a id="818" class="Keyword">field</a>
    <a id="RewardUpdate.Δt"></a><a id="828" href="Ledger.Epoch.html#828" class="Field">Δt</a> <a id="RewardUpdate.Δr"></a><a id="831" href="Ledger.Epoch.html#831" class="Field">Δr</a> <a id="RewardUpdate.Δf"></a><a id="834" href="Ledger.Epoch.html#834" class="Field">Δf</a> <a id="837" class="Symbol">:</a> <a id="839" href="Agda.Builtin.Int.html#245" class="Datatype">ℤ</a>
    <a id="RewardUpdate.rs"></a><a id="845" href="Ledger.Epoch.html#845" class="Field">rs</a> <a id="848" class="Symbol">:</a> <a id="850" href="Ledger.Address.html#273" class="Datatype">Credential</a> <a id="861" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="863" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a>


<a id="870" class="Keyword">record</a> <a id="Snapshot"></a><a id="877" href="Ledger.Epoch.html#877" class="Record">Snapshot</a> <a id="886" class="Symbol">:</a> <a id="888" href="Agda.Primitive.html#388" class="Primitive">Set</a> <a id="892" class="Keyword">where</a>
  <a id="900" class="Keyword">field</a>
    <a id="Snapshot.stake"></a><a id="910" href="Ledger.Epoch.html#910" class="Field">stake</a>        <a id="923" class="Symbol">:</a> <a id="925" href="Ledger.Address.html#273" class="Datatype">Credential</a> <a id="936" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="938" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a>
    <a id="Snapshot.delegations"></a><a id="947" href="Ledger.Epoch.html#947" class="Field">delegations</a>  <a id="960" class="Symbol">:</a> <a id="962" href="Ledger.Address.html#273" class="Datatype">Credential</a> <a id="973" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="975" href="Ledger.Crypto.html#1310" class="Function">KeyHash</a>
    <a id="987" class="Comment">-- poolParameters : KeyHash ⇀ PoolParam</a>

<a id="1028" class="Keyword">record</a> <a id="Snapshots"></a><a id="1035" href="Ledger.Epoch.html#1035" class="Record">Snapshots</a> <a id="1045" class="Symbol">:</a> <a id="1047" href="Agda.Primitive.html#388" class="Primitive">Set</a> <a id="1051" class="Keyword">where</a>
  <a id="1059" class="Keyword">field</a>
    <a id="Snapshots.mark"></a><a id="1069" href="Ledger.Epoch.html#1069" class="Field">mark</a> <a id="Snapshots.set"></a><a id="1074" href="Ledger.Epoch.html#1074" class="Field">set</a> <a id="Snapshots.go"></a><a id="1078" href="Ledger.Epoch.html#1078" class="Field">go</a>  <a id="1082" class="Symbol">:</a> <a id="1084" href="Ledger.Epoch.html#877" class="Record">Snapshot</a>
    <a id="Snapshots.feeSS"></a><a id="1097" href="Ledger.Epoch.html#1097" class="Field">feeSS</a>        <a id="1110" class="Symbol">:</a> <a id="1112" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a>



<a id="1120" class="Keyword">record</a> <a id="EpochState"></a><a id="1127" href="Ledger.Epoch.html#1127" class="Record">EpochState</a> <a id="1138" class="Symbol">:</a> <a id="1140" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="1145" class="Keyword">where</a>


  <a id="1155" class="Keyword">constructor</a> <a id="⟦_,_,_,_,_⟧ᵉ&#39;"></a><a id="1167" href="Ledger.Epoch.html#1167" class="InductiveConstructor Operator">⟦_,_,_,_,_⟧ᵉ&#39;</a>


  <a id="1185" class="Keyword">field</a>
    <a id="EpochState.acnt"></a><a id="1195" href="Ledger.Epoch.html#1195" class="Field">acnt</a>       <a id="1206" class="Symbol">:</a> <a id="1208" href="Ledger.PParams.html#674" class="Record">Acnt</a>
    <a id="EpochState.ss"></a><a id="1217" href="Ledger.Epoch.html#1217" class="Field">ss</a>         <a id="1228" class="Symbol">:</a> <a id="1230" href="Ledger.Epoch.html#1035" class="Record">Snapshots</a>
    <a id="EpochState.ls"></a><a id="1244" href="Ledger.Epoch.html#1244" class="Field">ls</a>         <a id="1255" class="Symbol">:</a> <a id="1257" href="Ledger.Ledger.html#715" class="Record">LState</a>
    <a id="EpochState.es"></a><a id="1268" href="Ledger.Epoch.html#1268" class="Field">es</a>         <a id="1279" class="Symbol">:</a> <a id="1281" href="Ledger.Enact.html#397" class="Record">EnactState</a>
    <a id="EpochState.fut"></a><a id="1296" href="Ledger.Epoch.html#1296" class="Field">fut</a>        <a id="1307" class="Symbol">:</a> <a id="1309" href="Ledger.Ratify.html#3241" class="Record">RatifyState</a>


<a id="1323" class="Keyword">record</a> <a id="NewEpochState"></a><a id="1330" href="Ledger.Epoch.html#1330" class="Record">NewEpochState</a> <a id="1344" class="Symbol">:</a> <a id="1346" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="1351" class="Keyword">where</a>
  <a id="1359" class="Keyword">field</a>
    <a id="NewEpochState.lastEpoch"></a><a id="1369" href="Ledger.Epoch.html#1369" class="Field">lastEpoch</a>   <a id="1381" class="Symbol">:</a> <a id="1383" href="Ledger.Types.Epoch.html#476" class="Function">Epoch</a>
    <a id="NewEpochState.epochState"></a><a id="1393" href="Ledger.Epoch.html#1393" class="Field">epochState</a>  <a id="1405" class="Symbol">:</a> <a id="1407" href="Ledger.Epoch.html#1127" class="Record">EpochState</a>
    <a id="NewEpochState.ru"></a><a id="1422" href="Ledger.Epoch.html#1422" class="Field">ru</a>          <a id="1434" class="Symbol">:</a> <a id="1436" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="1442" href="Ledger.Epoch.html#761" class="Record">RewardUpdate</a>


<a id="1457" class="Keyword">instance</a>
  <a id="1468" class="Keyword">unquoteDecl</a> <a id="To-RewardUpdate"></a><a id="1480" href="Ledger.Epoch.html#1480" class="Function">To-RewardUpdate</a> <a id="To-Snapshot"></a><a id="1496" href="Ledger.Epoch.html#1496" class="Function">To-Snapshot</a> <a id="To-Snapshots"></a><a id="1508" href="Ledger.Epoch.html#1508" class="Function">To-Snapshots</a> <a id="To-EpochState"></a><a id="1521" href="Ledger.Epoch.html#1521" class="Function">To-EpochState</a> <a id="To-NewEpochState"></a><a id="1535" href="Ledger.Epoch.html#1535" class="Function">To-NewEpochState</a> <a id="1552" class="Symbol">=</a> <a id="1554" href="Class.To.html#2693" class="Function">derive-To</a>
    <a id="1568" class="Symbol">(</a>   <a id="1572" class="Symbol">(</a><a id="1573" class="Keyword">quote</a> <a id="1579" href="Ledger.Epoch.html#761" class="Record">RewardUpdate</a>   <a id="1594" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1596" href="Ledger.Epoch.html#1480" class="Function">To-RewardUpdate</a><a id="1611" class="Symbol">)</a>
    <a id="1617" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a>   <a id="1621" class="Symbol">(</a><a id="1622" class="Keyword">quote</a> <a id="1628" href="Ledger.Epoch.html#877" class="Record">Snapshot</a>       <a id="1643" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1645" href="Ledger.Epoch.html#1496" class="Function">To-Snapshot</a><a id="1656" class="Symbol">)</a>
    <a id="1662" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a>   <a id="1666" class="Symbol">(</a><a id="1667" class="Keyword">quote</a> <a id="1673" href="Ledger.Epoch.html#1035" class="Record">Snapshots</a>      <a id="1688" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1690" href="Ledger.Epoch.html#1508" class="Function">To-Snapshots</a><a id="1702" class="Symbol">)</a>
    <a id="1708" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a>   <a id="1712" class="Symbol">(</a><a id="1713" class="Keyword">quote</a> <a id="1719" href="Ledger.Epoch.html#1127" class="Record">EpochState</a>     <a id="1734" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1736" href="Ledger.Epoch.html#1521" class="Function">To-EpochState</a><a id="1749" class="Symbol">)</a>
    <a id="1755" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="1757" href="Data.List.Base.html#5205" class="Function Operator">[</a> <a id="1759" class="Symbol">(</a><a id="1760" class="Keyword">quote</a> <a id="1766" href="Ledger.Epoch.html#1330" class="Record">NewEpochState</a>  <a id="1781" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1783" href="Ledger.Epoch.html#1535" class="Function">To-NewEpochState</a><a id="1799" class="Symbol">)</a><a id="1800" href="Data.List.Base.html#5205" class="Function Operator">]</a><a id="1801" class="Symbol">)</a>

<a id="1804" class="Keyword">instance</a> <a id="1813" href="Ledger.Epoch.html#1813" class="Function">_</a> <a id="1815" class="Symbol">=</a> <a id="1817" href="Data.Nat.Properties.html#17056" class="Function">+-0-monoid</a><a id="1827" class="Symbol">;</a> <a id="1829" href="Ledger.Epoch.html#1829" class="Function">_</a> <a id="1831" class="Symbol">=</a> <a id="1833" href="Data.Nat.Properties.html#17135" class="Function">+-0-commutativeMonoid</a>

<a id="toRwdAddr"></a><a id="1856" href="Ledger.Epoch.html#1856" class="Function">toRwdAddr</a> <a id="1866" class="Symbol">:</a> <a id="1868" href="Ledger.Address.html#273" class="Datatype">Credential</a> <a id="1879" class="Symbol">→</a> <a id="1881" href="Ledger.Address.html#1211" class="Record">RwdAddr</a>
<a id="1889" href="Ledger.Epoch.html#1856" class="Function">toRwdAddr</a> <a id="1899" href="Ledger.Epoch.html#1899" class="Bound">x</a> <a id="1901" class="Symbol">=</a> <a id="1903" class="Keyword">record</a> <a id="1910" class="Symbol">{</a> <a id="1912" href="Ledger.Address.html#1240" class="Field">net</a> <a id="1916" class="Symbol">=</a> <a id="1918" href="Ledger.Types.Epoch.html#2154" class="Function">NetworkId</a> <a id="1928" class="Symbol">;</a> <a id="1930" href="Ledger.Address.html#1265" class="Field">stake</a> <a id="1936" class="Symbol">=</a> <a id="1938" href="Ledger.Epoch.html#1899" class="Bound">x</a> <a id="1940" class="Symbol">}</a>

<a id="getStakeCred"></a><a id="1943" href="Ledger.Epoch.html#1943" class="Function">getStakeCred</a> <a id="1956" class="Symbol">:</a> <a id="1958" href="Ledger.Transaction.html#2334" class="Function">TxOut</a> <a id="1964" class="Symbol">→</a> <a id="1966" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="1972" href="Ledger.Address.html#273" class="Datatype">Credential</a>
<a id="1983" href="Ledger.Epoch.html#1943" class="Function">getStakeCred</a> <a id="1996" class="Symbol">(</a><a id="1997" href="Ledger.Epoch.html#1997" class="Bound">a</a> <a id="1999" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="2001" class="Symbol">_</a> <a id="2003" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="2005" class="Symbol">_</a> <a id="2007" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="2009" class="Symbol">_)</a> <a id="2012" class="Symbol">=</a> <a id="2014" href="Ledger.Address.html#1832" class="Function">stakeCred</a> <a id="2024" href="Ledger.Epoch.html#1997" class="Bound">a</a>

<a id="2027" class="Keyword">open</a> <a id="2032" href="Ledger.Address.html#1211" class="Module">RwdAddr</a> <a id="2040" class="Keyword">using</a> <a id="2046" class="Symbol">(</a><a id="2047" href="Ledger.Address.html#1265" class="Field">stake</a><a id="2052" class="Symbol">)</a>
<a id="2054" class="Keyword">open</a> <a id="2059" href="Ledger.GovernanceActions.html#2096" class="Module">GovActionState</a> <a id="2074" class="Keyword">using</a> <a id="2080" class="Symbol">(</a><a id="2081" href="Ledger.GovernanceActions.html#2167" class="Field">returnAddr</a><a id="2091" class="Symbol">)</a>


<a id="applyRUpd"></a><a id="2095" href="Ledger.Epoch.html#2095" class="Function">applyRUpd</a> <a id="2105" class="Symbol">:</a> <a id="2107" href="Ledger.Epoch.html#761" class="Record">RewardUpdate</a> <a id="2120" class="Symbol">→</a> <a id="2122" href="Ledger.Epoch.html#1127" class="Record">EpochState</a> <a id="2133" class="Symbol">→</a> <a id="2135" href="Ledger.Epoch.html#1127" class="Record">EpochState</a>
<a id="2146" href="Ledger.Epoch.html#2095" class="Function">applyRUpd</a> <a id="2156" href="Ledger.Epoch.html#802" class="InductiveConstructor Operator">⟦</a> <a id="2158" href="Ledger.Epoch.html#2158" class="Bound">Δt</a> <a id="2161" href="Ledger.Epoch.html#802" class="InductiveConstructor Operator">,</a> <a id="2163" href="Ledger.Epoch.html#2163" class="Bound">Δr</a> <a id="2166" href="Ledger.Epoch.html#802" class="InductiveConstructor Operator">,</a> <a id="2168" href="Ledger.Epoch.html#2168" class="Bound">Δf</a> <a id="2171" href="Ledger.Epoch.html#802" class="InductiveConstructor Operator">,</a> <a id="2173" href="Ledger.Epoch.html#2173" class="Bound">rs</a> <a id="2176" href="Ledger.Epoch.html#802" class="InductiveConstructor Operator">⟧ʳᵘ</a>
  <a id="2182" href="Ledger.Epoch.html#1167" class="InductiveConstructor Operator">⟦</a> <a id="2184" href="Ledger.PParams.html#708" class="InductiveConstructor Operator">⟦</a> <a id="2186" href="Ledger.Epoch.html#2186" class="Bound">treasury</a> <a id="2195" href="Ledger.PParams.html#708" class="InductiveConstructor Operator">,</a> <a id="2197" href="Ledger.Epoch.html#2197" class="Bound">reserves</a> <a id="2206" href="Ledger.PParams.html#708" class="InductiveConstructor Operator">⟧ᵃ</a>
  <a id="2211" href="Ledger.Epoch.html#1167" class="InductiveConstructor Operator">,</a> <a id="2213" href="Ledger.Epoch.html#2213" class="Bound">ss</a>
  <a id="2218" href="Ledger.Epoch.html#1167" class="InductiveConstructor Operator">,</a> <a id="2220" href="Ledger.Ledger.html#751" class="InductiveConstructor Operator">⟦</a> <a id="2222" href="Ledger.Utxo.html#2555" class="InductiveConstructor Operator">⟦</a> <a id="2224" href="Ledger.Epoch.html#2224" class="Bound">utxo</a> <a id="2229" href="Ledger.Utxo.html#2555" class="InductiveConstructor Operator">,</a> <a id="2231" href="Ledger.Epoch.html#2231" class="Bound">fees</a> <a id="2236" href="Ledger.Utxo.html#2555" class="InductiveConstructor Operator">,</a> <a id="2238" href="Ledger.Epoch.html#2238" class="Bound">deposits</a> <a id="2247" href="Ledger.Utxo.html#2555" class="InductiveConstructor Operator">,</a> <a id="2249" href="Ledger.Epoch.html#2249" class="Bound">donations</a> <a id="2259" href="Ledger.Utxo.html#2555" class="InductiveConstructor Operator">⟧ᵘ</a>
    <a id="2266" href="Ledger.Ledger.html#751" class="InductiveConstructor Operator">,</a> <a id="2268" href="Ledger.Epoch.html#2268" class="Bound">govSt</a>
    <a id="2278" href="Ledger.Ledger.html#751" class="InductiveConstructor Operator">,</a> <a id="2280" href="Ledger.Certs.html#2864" class="InductiveConstructor Operator">⟦</a> <a id="2282" href="Ledger.Certs.html#2429" class="InductiveConstructor Operator">⟦</a> <a id="2284" href="Ledger.Epoch.html#2284" class="Bound">voteDelegs</a> <a id="2295" href="Ledger.Certs.html#2429" class="InductiveConstructor Operator">,</a> <a id="2297" href="Ledger.Epoch.html#2297" class="Bound">stakeDelegs</a> <a id="2309" href="Ledger.Certs.html#2429" class="InductiveConstructor Operator">,</a> <a id="2311" href="Ledger.Epoch.html#2311" class="Bound">rewards</a> <a id="2319" href="Ledger.Certs.html#2429" class="InductiveConstructor Operator">⟧ᵈ</a> <a id="2322" href="Ledger.Certs.html#2864" class="InductiveConstructor Operator">,</a> <a id="2324" href="Ledger.Epoch.html#2324" class="Bound">pState</a> <a id="2331" href="Ledger.Certs.html#2864" class="InductiveConstructor Operator">,</a> <a id="2333" href="Ledger.Epoch.html#2333" class="Bound">gState</a> <a id="2340" href="Ledger.Certs.html#2864" class="InductiveConstructor Operator">⟧ᶜˢ</a> <a id="2344" href="Ledger.Ledger.html#751" class="InductiveConstructor Operator">⟧ˡ</a>
  <a id="2349" href="Ledger.Epoch.html#1167" class="InductiveConstructor Operator">,</a> <a id="2351" href="Ledger.Epoch.html#2351" class="Bound">es</a>
  <a id="2356" href="Ledger.Epoch.html#1167" class="InductiveConstructor Operator">,</a> <a id="2358" href="Ledger.Epoch.html#2358" class="Bound">fut</a>
  <a id="2364" href="Ledger.Epoch.html#1167" class="InductiveConstructor Operator">⟧ᵉ&#39;</a> <a id="2368" class="Symbol">=</a>
  <a id="2372" href="Class.To.html#102" class="Field Operator">⟦</a> <a id="2374" href="Class.To.html#102" class="Field Operator">⟦</a> <a id="2376" href="Data.Integer.Ext.html#349" class="Function">posPart</a> <a id="2384" class="Symbol">(</a><a id="2385" href="Ledger.Epoch.html#187" class="InductiveConstructor">pos</a> <a id="2389" href="Ledger.Epoch.html#2186" class="Bound">treasury</a> <a id="2398" href="Class.HasAdd.Core.html#136" class="Field Operator">+</a> <a id="2400" href="Ledger.Epoch.html#2158" class="Bound">Δt</a> <a id="2403" href="Class.HasAdd.Core.html#136" class="Field Operator">+</a> <a id="2405" href="Ledger.Epoch.html#187" class="InductiveConstructor">pos</a> <a id="2409" href="Ledger.Epoch.html#2713" class="Function">unregRU&#39;</a><a id="2417" class="Symbol">)</a>
    <a id="2423" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="2425" href="Data.Integer.Ext.html#349" class="Function">posPart</a> <a id="2433" class="Symbol">(</a><a id="2434" href="Ledger.Epoch.html#187" class="InductiveConstructor">pos</a> <a id="2438" href="Ledger.Epoch.html#2197" class="Bound">reserves</a> <a id="2447" href="Class.HasAdd.Core.html#136" class="Field Operator">+</a> <a id="2449" href="Ledger.Epoch.html#2163" class="Bound">Δr</a><a id="2451" class="Symbol">)</a> <a id="2453" href="Class.To.html#102" class="Field Operator">⟧</a>
  <a id="2457" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="2459" href="Ledger.Epoch.html#2213" class="Bound">ss</a>
  <a id="2464" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="2466" href="Class.To.html#102" class="Field Operator">⟦</a> <a id="2468" href="Class.To.html#102" class="Field Operator">⟦</a> <a id="2470" href="Ledger.Epoch.html#2224" class="Bound">utxo</a> <a id="2475" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="2477" href="Data.Integer.Ext.html#349" class="Function">posPart</a> <a id="2485" class="Symbol">(</a><a id="2486" href="Ledger.Epoch.html#187" class="InductiveConstructor">pos</a> <a id="2490" href="Ledger.Epoch.html#2231" class="Bound">fees</a> <a id="2495" href="Class.HasAdd.Core.html#136" class="Field Operator">+</a> <a id="2497" href="Ledger.Epoch.html#2168" class="Bound">Δf</a><a id="2499" class="Symbol">)</a> <a id="2501" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="2503" href="Ledger.Epoch.html#2238" class="Bound">deposits</a> <a id="2512" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="2514" href="Ledger.Epoch.html#2249" class="Bound">donations</a> <a id="2524" href="Class.To.html#102" class="Field Operator">⟧</a>
    <a id="2530" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="2532" href="Ledger.Epoch.html#2268" class="Bound">govSt</a>
    <a id="2542" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="2544" href="Class.To.html#102" class="Field Operator">⟦</a> <a id="2546" href="Class.To.html#102" class="Field Operator">⟦</a> <a id="2548" href="Ledger.Epoch.html#2284" class="Bound">voteDelegs</a> <a id="2559" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="2561" href="Ledger.Epoch.html#2297" class="Bound">stakeDelegs</a> <a id="2573" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="2575" href="Ledger.Epoch.html#2311" class="Bound">rewards</a> <a id="2583" href="Axiom.Set.Map.Dec.html#1854" class="Function Operator">∪⁺</a> <a id="2586" href="Ledger.Epoch.html#2645" class="Function">regRU</a> <a id="2592" href="Class.To.html#102" class="Field Operator">⟧</a> <a id="2594" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="2596" href="Ledger.Epoch.html#2324" class="Bound">pState</a> <a id="2603" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="2605" href="Ledger.Epoch.html#2333" class="Bound">gState</a> <a id="2612" href="Class.To.html#102" class="Field Operator">⟧</a> <a id="2614" href="Class.To.html#102" class="Field Operator">⟧</a>
  <a id="2618" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="2620" href="Ledger.Epoch.html#2351" class="Bound">es</a>
  <a id="2625" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="2627" href="Ledger.Epoch.html#2358" class="Bound">fut</a> <a id="2631" href="Class.To.html#102" class="Field Operator">⟧</a>
  <a id="2635" class="Keyword">where</a>
    <a id="2645" href="Ledger.Epoch.html#2645" class="Function">regRU</a>     <a id="2655" class="Symbol">=</a> <a id="2657" href="Ledger.Epoch.html#2173" class="Bound">rs</a> <a id="2660" href="Axiom.Set.Map.html#10678" class="Function Operator">∣</a> <a id="2662" href="Class.IsSet.html#916" class="Function">dom</a> <a id="2666" href="Ledger.Epoch.html#2311" class="Bound">rewards</a>
    <a id="2678" href="Ledger.Epoch.html#2678" class="Function">unregRU</a>   <a id="2688" class="Symbol">=</a> <a id="2690" href="Ledger.Epoch.html#2173" class="Bound">rs</a> <a id="2693" href="Axiom.Set.Map.html#10748" class="Function Operator">∣</a> <a id="2695" href="Class.IsSet.html#916" class="Function">dom</a> <a id="2699" href="Ledger.Epoch.html#2311" class="Bound">rewards</a> <a id="2707" href="Axiom.Set.Map.html#10748" class="Function Operator">ᶜ</a>
    <a id="2713" href="Ledger.Epoch.html#2713" class="Function">unregRU&#39;</a>  <a id="2723" class="Symbol">=</a> <a id="2725" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">∑[</a> <a id="2728" href="Ledger.Epoch.html#2728" class="Bound">x</a> <a id="2730" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">←</a> <a id="2732" href="Ledger.Epoch.html#2678" class="Function">unregRU</a> <a id="2740" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">]</a> <a id="2742" href="Ledger.Epoch.html#2728" class="Bound">x</a>

<a id="getOrphans"></a><a id="2745" href="Ledger.Epoch.html#2745" class="Function">getOrphans</a> <a id="2756" class="Symbol">:</a> <a id="2758" href="Ledger.Enact.html#397" class="Record">EnactState</a> <a id="2769" class="Symbol">→</a> <a id="2771" href="Ledger.Gov.html#1218" class="Function">GovState</a> <a id="2780" class="Symbol">→</a> <a id="2782" href="Ledger.Gov.html#1218" class="Function">GovState</a>
<a id="2791" href="Ledger.Epoch.html#2745" class="Function">getOrphans</a> <a id="2802" href="Ledger.Epoch.html#2802" class="Bound">es</a> <a id="2805" href="Ledger.Epoch.html#2805" class="Bound">govSt</a> <a id="2811" class="Symbol">=</a> <a id="2813" href="Data.Product.Base.html#636" class="Field">proj₁</a> <a id="2819" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="2821" href="Data.Nat.GeneralisedArithmetic.html#866" class="Function">iterate</a> <a id="2829" href="Ledger.Epoch.html#2874" class="Function">step</a> <a id="2834" class="Symbol">(</a><a id="2835" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a> <a id="2838" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="2840" href="Ledger.Epoch.html#2805" class="Bound">govSt</a><a id="2845" class="Symbol">)</a> <a id="2847" class="Symbol">(</a><a id="2848" href="Data.List.Base.html#5044" class="Function">length</a> <a id="2855" href="Ledger.Epoch.html#2805" class="Bound">govSt</a><a id="2860" class="Symbol">)</a>
  <a id="2864" class="Keyword">where</a>
    <a id="2874" href="Ledger.Epoch.html#2874" class="Function">step</a> <a id="2879" class="Symbol">:</a> <a id="2881" href="Ledger.Gov.html#1218" class="Function">GovState</a> <a id="2890" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="2892" href="Ledger.Gov.html#1218" class="Function">GovState</a> <a id="2901" class="Symbol">→</a> <a id="2903" href="Ledger.Gov.html#1218" class="Function">GovState</a> <a id="2912" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="2914" href="Ledger.Gov.html#1218" class="Function">GovState</a>
    <a id="2927" href="Ledger.Epoch.html#2874" class="Function">step</a> <a id="2932" class="Symbol">(</a><a id="2933" href="Ledger.Epoch.html#2933" class="Bound">orps</a> <a id="2938" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="2940" href="Ledger.Epoch.html#2940" class="Bound">govSt</a><a id="2945" class="Symbol">)</a> <a id="2947" class="Symbol">=</a>
      <a id="2955" class="Keyword">let</a>
        <a id="2967" href="Ledger.Epoch.html#2967" class="Bound">isOrphan?</a> <a id="2977" href="Ledger.Epoch.html#2977" class="Bound">a</a> <a id="2979" href="Ledger.Epoch.html#2979" class="Bound">prev</a> <a id="2984" class="Symbol">=</a> <a id="2986" href="Relation.Nullary.Decidable.Core.html#3011" class="Function">¬?</a> <a id="2989" class="Symbol">(</a><a id="2990" href="Ledger.Gov.html#6242" class="Function">hasParent?</a> <a id="3001" href="Ledger.Epoch.html#2802" class="Bound">es</a> <a id="3004" href="Ledger.Epoch.html#2940" class="Bound">govSt</a> <a id="3010" href="Ledger.Epoch.html#2977" class="Bound">a</a> <a id="3012" href="Ledger.Epoch.html#2979" class="Bound">prev</a><a id="3016" class="Symbol">)</a>
        <a id="3026" class="Symbol">(</a><a id="3027" href="Ledger.Epoch.html#3027" class="Bound">orps&#39;</a> <a id="3033" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="3035" href="Ledger.Epoch.html#3035" class="Bound">govSt&#39;</a><a id="3041" class="Symbol">)</a> <a id="3043" class="Symbol">=</a> <a id="3045" href="Data.List.Base.html#10926" class="Function">partition</a>
          <a id="3065" class="Symbol">(λ</a> <a id="3068" class="Symbol">(_</a> <a id="3071" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="3073" class="Keyword">record</a> <a id="3080" class="Symbol">{</a><a id="3081" href="Ledger.GovernanceActions.html#2217" class="Field">action</a> <a id="3088" class="Symbol">=</a> <a id="3090" href="Ledger.Epoch.html#3090" class="Bound">a</a> <a id="3092" class="Symbol">;</a> <a id="3094" href="Ledger.GovernanceActions.html#2245" class="Field">prevAction</a> <a id="3105" class="Symbol">=</a> <a id="3107" href="Ledger.Epoch.html#3107" class="Bound">prev</a><a id="3111" class="Symbol">})</a> <a id="3114" class="Symbol">→</a> <a id="3116" href="Ledger.Epoch.html#2967" class="Bound">isOrphan?</a> <a id="3126" href="Ledger.Epoch.html#3090" class="Bound">a</a> <a id="3128" href="Ledger.Epoch.html#3107" class="Bound">prev</a><a id="3132" class="Symbol">)</a> <a id="3134" href="Ledger.Epoch.html#2940" class="Bound">govSt</a>
      <a id="3146" class="Keyword">in</a>
        <a id="3157" class="Symbol">(</a><a id="3158" href="Ledger.Epoch.html#2933" class="Bound">orps</a> <a id="3163" href="Data.List.Base.html#1734" class="Function Operator">++</a> <a id="3166" href="Ledger.Epoch.html#3027" class="Bound">orps&#39;</a> <a id="3172" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="3174" href="Ledger.Epoch.html#3035" class="Bound">govSt&#39;</a><a id="3180" class="Symbol">)</a>


<a id="stakeDistr"></a><a id="3184" href="Ledger.Epoch.html#3184" class="Function">stakeDistr</a> <a id="3195" class="Symbol">:</a> <a id="3197" href="Ledger.Transaction.html#2402" class="Function">UTxO</a> <a id="3202" class="Symbol">→</a> <a id="3204" href="Ledger.Certs.html#2393" class="Record">DState</a> <a id="3211" class="Symbol">→</a> <a id="3213" href="Ledger.Certs.html#2574" class="Record">PState</a> <a id="3220" class="Symbol">→</a> <a id="3222" href="Ledger.Epoch.html#877" class="Record">Snapshot</a>
<a id="3231" href="Ledger.Epoch.html#3184" class="Function">stakeDistr</a> <a id="3242" href="Ledger.Epoch.html#3242" class="Bound">utxo</a> <a id="3247" href="Ledger.Epoch.html#3247" class="Bound">stᵈ</a> <a id="3251" href="Ledger.Epoch.html#3251" class="Bound">pState</a> <a id="3258" class="Symbol">=</a> <a id="3260" href="Class.To.html#102" class="Field Operator">⟦</a> <a id="3262" href="Axiom.Set.Map.Dec.html#1932" class="Function">aggregate₊</a> <a id="3273" class="Symbol">(</a><a id="3274" href="Ledger.Epoch.html#3460" class="Function">stakeRelation</a> <a id="3288" href="abstract-set-theory.FiniteSetTheory.html#2767" class="Function Operator">ᶠˢ</a><a id="3290" class="Symbol">)</a> <a id="3292" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="3294" href="Ledger.Certs.html#2491" class="Function">stakeDelegs</a> <a id="3306" href="Class.To.html#102" class="Field Operator">⟧</a>
  <a id="3310" class="Keyword">where</a>
    <a id="3320" class="Keyword">open</a> <a id="3325" href="Ledger.Certs.html#2393" class="Module">DState</a> <a id="3332" href="Ledger.Epoch.html#3247" class="Bound">stᵈ</a> <a id="3336" class="Keyword">using</a> <a id="3342" class="Symbol">(</a><a id="3343" href="Ledger.Certs.html#2491" class="Field">stakeDelegs</a><a id="3354" class="Symbol">;</a> <a id="3356" href="Ledger.Certs.html#2531" class="Field">rewards</a><a id="3363" class="Symbol">)</a>
    <a id="3369" href="Ledger.Epoch.html#3369" class="Function">m</a> <a id="3371" class="Symbol">=</a> <a id="3373" href="abstract-set-theory.FiniteSetTheory.html#519" class="Function">mapˢ</a> <a id="3378" class="Symbol">(λ</a> <a id="3381" href="Ledger.Epoch.html#3381" class="Bound">a</a> <a id="3383" class="Symbol">→</a> <a id="3385" class="Symbol">(</a><a id="3386" href="Ledger.Epoch.html#3381" class="Bound">a</a> <a id="3388" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="3390" href="Ledger.Utxo.html#3117" class="Function">cbalance</a> <a id="3399" class="Symbol">(</a><a id="3400" href="Ledger.Epoch.html#3242" class="Bound">utxo</a> <a id="3405" href="abstract-set-theory.FiniteSetTheory.html#3088" class="Function Operator">∣^&#39;</a> <a id="3409" class="Symbol">λ</a> <a id="3411" href="Ledger.Epoch.html#3411" class="Bound">i</a> <a id="3413" class="Symbol">→</a> <a id="3415" href="Ledger.Epoch.html#1943" class="Function">getStakeCred</a> <a id="3428" href="Ledger.Epoch.html#3411" class="Bound">i</a> <a id="3430" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="3432" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="3437" href="Ledger.Epoch.html#3381" class="Bound">a</a><a id="3438" class="Symbol">)))</a> <a id="3442" class="Symbol">(</a><a id="3443" href="Class.IsSet.html#916" class="Function">dom</a> <a id="3447" href="Ledger.Certs.html#2531" class="Function">rewards</a><a id="3454" class="Symbol">)</a>
    <a id="3460" href="Ledger.Epoch.html#3460" class="Function">stakeRelation</a> <a id="3474" class="Symbol">=</a> <a id="3476" href="Ledger.Epoch.html#3369" class="Function">m</a> <a id="3478" href="Axiom.Set.html#8952" class="Function Operator">∪</a> <a id="3480" href="Data.Product.Base.html#636" class="Field">proj₁</a> <a id="3486" href="Ledger.Certs.html#2531" class="Function">rewards</a>

<a id="gaDepositStake"></a><a id="3495" href="Ledger.Epoch.html#3495" class="Function">gaDepositStake</a> <a id="3510" class="Symbol">:</a> <a id="3512" href="Ledger.Gov.html#1218" class="Function">GovState</a> <a id="3521" class="Symbol">→</a> <a id="3523" href="Ledger.Certs.html#527" class="Function">Deposits</a> <a id="3532" class="Symbol">→</a> <a id="3534" href="Ledger.Address.html#273" class="Datatype">Credential</a> <a id="3545" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="3547" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a>
<a id="3552" href="Ledger.Epoch.html#3495" class="Function">gaDepositStake</a> <a id="3567" href="Ledger.Epoch.html#3567" class="Bound">govSt</a> <a id="3573" href="Ledger.Epoch.html#3573" class="Bound">ds</a> <a id="3576" class="Symbol">=</a> <a id="3578" href="abstract-set-theory.FiniteSetTheory.html#3599" class="Function">aggregateBy</a>
  <a id="3592" class="Symbol">(</a><a id="3593" href="abstract-set-theory.FiniteSetTheory.html#519" class="Function">mapˢ</a> <a id="3598" class="Symbol">(λ</a> <a id="3601" class="Symbol">(</a><a id="3602" href="Ledger.Epoch.html#3602" class="Bound">gaid</a> <a id="3607" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="3609" href="Ledger.Epoch.html#3609" class="Bound">addr</a><a id="3613" class="Symbol">)</a> <a id="3615" class="Symbol">→</a> <a id="3617" class="Symbol">(</a><a id="3618" href="Ledger.Epoch.html#3602" class="Bound">gaid</a> <a id="3623" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="3625" href="Ledger.Epoch.html#3609" class="Bound">addr</a><a id="3629" class="Symbol">)</a> <a id="3631" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="3633" href="Ledger.Address.html#1265" class="Field">stake</a> <a id="3639" href="Ledger.Epoch.html#3609" class="Bound">addr</a><a id="3643" class="Symbol">)</a> <a id="3645" href="Ledger.Epoch.html#3743" class="Function">govSt&#39;</a><a id="3651" class="Symbol">)</a>
  <a id="3655" class="Symbol">(</a><a id="3656" href="Axiom.Set.Map.html#10460" class="Function">mapFromPartialFun</a> <a id="3674" class="Symbol">(λ</a> <a id="3677" class="Symbol">(</a><a id="3678" href="Ledger.Epoch.html#3678" class="Bound">gaid</a> <a id="3683" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="3685" class="Symbol">_)</a> <a id="3688" class="Symbol">→</a> <a id="3690" href="Axiom.Set.Map.html#13670" class="Function">lookupᵐ?</a> <a id="3699" href="Ledger.Epoch.html#3573" class="Bound">ds</a> <a id="3702" class="Symbol">(</a><a id="3703" href="Ledger.Certs.html#475" class="InductiveConstructor">GovActionDeposit</a> <a id="3720" href="Ledger.Epoch.html#3678" class="Bound">gaid</a><a id="3724" class="Symbol">))</a> <a id="3727" href="Ledger.Epoch.html#3743" class="Function">govSt&#39;</a><a id="3733" class="Symbol">)</a>
  <a id="3737" class="Keyword">where</a> <a id="3743" href="Ledger.Epoch.html#3743" class="Function">govSt&#39;</a> <a id="3750" class="Symbol">=</a> <a id="3752" href="abstract-set-theory.FiniteSetTheory.html#519" class="Function">mapˢ</a> <a id="3757" class="Symbol">(</a><a id="3758" href="Class.Bifunctor.html#1143" class="Function">map₂</a> <a id="3763" href="Ledger.GovernanceActions.html#2167" class="Field">returnAddr</a><a id="3773" class="Symbol">)</a> <a id="3775" class="Symbol">(</a><a id="3776" href="Axiom.Set.html#5718" class="Function">fromList</a> <a id="3785" href="Ledger.Epoch.html#3567" class="Bound">govSt</a><a id="3790" class="Symbol">)</a>



<a id="3795" class="Keyword">opaque</a>


  <a id="mkStakeDistrs"></a><a id="3806" href="Ledger.Epoch.html#3806" class="Function">mkStakeDistrs</a> <a id="3820" class="Symbol">:</a> <a id="3822" href="Ledger.Epoch.html#877" class="Record">Snapshot</a> <a id="3831" class="Symbol">→</a> <a id="3833" href="Ledger.Gov.html#1218" class="Function">GovState</a> <a id="3842" class="Symbol">→</a> <a id="3844" href="Ledger.Certs.html#527" class="Function">Deposits</a> <a id="3853" class="Symbol">→</a> <a id="3855" class="Symbol">(</a><a id="3856" href="Ledger.Address.html#273" class="Datatype">Credential</a> <a id="3867" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="3869" href="Ledger.GovernanceActions.html#458" class="Datatype">VDeleg</a><a id="3875" class="Symbol">)</a> <a id="3877" class="Symbol">→</a> <a id="3879" href="Ledger.Ratify.html#2876" class="Record">StakeDistrs</a>
  <a id="3893" href="Ledger.Epoch.html#3806" class="Function">mkStakeDistrs</a> <a id="3907" href="Ledger.Epoch.html#3907" class="Bound">ss</a> <a id="3910" href="Ledger.Epoch.html#3910" class="Bound">govSt</a> <a id="3916" href="Ledger.Epoch.html#3916" class="Bound">ds</a> <a id="3919" href="Ledger.Epoch.html#3919" class="Bound">delegations</a> <a id="3931" class="Symbol">.</a><a id="3932" href="Ledger.Ratify.html#2913" class="Field">StakeDistrs.stakeDistr</a> <a id="3955" class="Symbol">=</a>
    <a id="3961" href="abstract-set-theory.FiniteSetTheory.html#3599" class="Function">aggregateBy</a> <a id="3973" class="Symbol">(</a><a id="3974" href="Data.Product.Base.html#636" class="Field">proj₁</a> <a id="3980" href="Ledger.Epoch.html#3919" class="Bound">delegations</a><a id="3991" class="Symbol">)</a> <a id="3993" class="Symbol">(</a><a id="3994" href="Ledger.Epoch.html#910" class="Field">Snapshot.stake</a> <a id="4009" href="Ledger.Epoch.html#3907" class="Bound">ss</a> <a id="4012" href="Axiom.Set.Map.Dec.html#1854" class="Function Operator">∪⁺</a> <a id="4015" href="Ledger.Epoch.html#3495" class="Function">gaDepositStake</a> <a id="4030" href="Ledger.Epoch.html#3910" class="Bound">govSt</a> <a id="4036" href="Ledger.Epoch.html#3916" class="Bound">ds</a><a id="4038" class="Symbol">)</a>


<a id="4042" class="Keyword">private</a> <a id="4050" class="Keyword">variable</a>
  <a id="4061" href="Ledger.Epoch.html#4061" class="Generalizable">nes</a> <a id="4065" href="Ledger.Epoch.html#4065" class="Generalizable">nes&#39;</a> <a id="4070" class="Symbol">:</a> <a id="4072" href="Ledger.Epoch.html#1330" class="Record">NewEpochState</a>
  <a id="4088" href="Ledger.Epoch.html#4088" class="Generalizable">e</a> <a id="4090" href="Ledger.Epoch.html#4090" class="Generalizable">lastEpoch</a> <a id="4100" class="Symbol">:</a> <a id="4102" href="Ledger.Types.Epoch.html#476" class="Function">Epoch</a>
  <a id="4110" href="Ledger.Epoch.html#4110" class="Generalizable">fut</a> <a id="4114" href="Ledger.Epoch.html#4114" class="Generalizable">fut&#39;</a> <a id="4119" class="Symbol">:</a> <a id="4121" href="Ledger.Ratify.html#3241" class="Record">RatifyState</a>
  <a id="4135" href="Ledger.Epoch.html#4135" class="Generalizable">eps</a> <a id="4139" href="Ledger.Epoch.html#4139" class="Generalizable">eps&#39;</a> <a id="4144" href="Ledger.Epoch.html#4144" class="Generalizable">eps&#39;&#39;</a> <a id="4150" class="Symbol">:</a> <a id="4152" href="Ledger.Epoch.html#1127" class="Record">EpochState</a>
  <a id="4165" href="Ledger.Epoch.html#4165" class="Generalizable">ls</a> <a id="4168" class="Symbol">:</a> <a id="4170" href="Ledger.Ledger.html#715" class="Record">LState</a>
  <a id="4179" href="Ledger.Epoch.html#4179" class="Generalizable">acnt</a> <a id="4184" class="Symbol">:</a> <a id="4186" href="Ledger.PParams.html#674" class="Record">Acnt</a>
  <a id="4193" href="Ledger.Epoch.html#4193" class="Generalizable">es₀</a> <a id="4197" class="Symbol">:</a> <a id="4199" href="Ledger.Enact.html#397" class="Record">EnactState</a>
  <a id="4212" href="Ledger.Epoch.html#4212" class="Generalizable">mark</a> <a id="4217" href="Ledger.Epoch.html#4217" class="Generalizable">set</a> <a id="4221" href="Ledger.Epoch.html#4221" class="Generalizable">go</a> <a id="4224" class="Symbol">:</a> <a id="4226" href="Ledger.Epoch.html#877" class="Record">Snapshot</a>
  <a id="4237" href="Ledger.Epoch.html#4237" class="Generalizable">feeSS</a> <a id="4243" class="Symbol">:</a> <a id="4245" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a>
  <a id="4252" href="Ledger.Epoch.html#4252" class="Generalizable">lstate</a> <a id="4259" class="Symbol">:</a> <a id="4261" href="Ledger.Ledger.html#715" class="Record">LState</a>
  <a id="4270" href="Ledger.Epoch.html#4270" class="Generalizable">ss</a> <a id="4273" href="Ledger.Epoch.html#4273" class="Generalizable">ss&#39;</a> <a id="4277" class="Symbol">:</a> <a id="4279" href="Ledger.Epoch.html#1035" class="Record">Snapshots</a>
  <a id="4291" href="Ledger.Epoch.html#4291" class="Generalizable">ru</a> <a id="4294" class="Symbol">:</a> <a id="4296" href="Ledger.Epoch.html#761" class="Record">RewardUpdate</a>
  <a id="4311" href="Ledger.Epoch.html#4311" class="Generalizable">mru</a> <a id="4315" class="Symbol">:</a> <a id="4317" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="4323" href="Ledger.Epoch.html#761" class="Record">RewardUpdate</a>


<a id="4338" class="Keyword">data</a> <a id="_⊢_⇀⦇_,SNAP⦈_"></a><a id="4343" href="Ledger.Epoch.html#4343" class="Datatype Operator">_⊢_⇀⦇_,SNAP⦈_</a> <a id="4357" class="Symbol">:</a> <a id="4359" href="Ledger.Ledger.html#715" class="Record">LState</a> <a id="4366" class="Symbol">→</a> <a id="4368" href="Ledger.Epoch.html#1035" class="Record">Snapshots</a> <a id="4378" class="Symbol">→</a> <a id="4380" href="Agda.Builtin.Unit.html#175" class="Record">⊤</a> <a id="4382" class="Symbol">→</a> <a id="4384" href="Ledger.Epoch.html#1035" class="Record">Snapshots</a> <a id="4394" class="Symbol">→</a> <a id="4396" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="4401" class="Keyword">where</a>
  <a id="_⊢_⇀⦇_,SNAP⦈_.SNAP"></a><a id="4409" href="Ledger.Epoch.html#4409" class="InductiveConstructor">SNAP</a> <a id="4414" class="Symbol">:</a> <a id="4416" class="Keyword">let</a> <a id="4420" class="Keyword">open</a> <a id="4425" href="Ledger.Ledger.html#715" class="Module">LState</a> <a id="4432" href="Ledger.Epoch.html#4252" class="Generalizable">lstate</a><a id="4438" class="Symbol">;</a> <a id="4440" class="Keyword">open</a> <a id="4445" href="Ledger.Utxo.html#2516" class="Module">UTxOState</a> <a id="4455" href="Ledger.Ledger.html#774" class="Function">utxoSt</a><a id="4461" class="Symbol">;</a> <a id="4463" class="Keyword">open</a> <a id="4468" href="Ledger.Certs.html#2825" class="Module">CertState</a> <a id="4478" href="Ledger.Ledger.html#827" class="Function">certState</a>
             <a id="4501" href="Ledger.Epoch.html#4501" class="Bound">stake</a> <a id="4507" class="Symbol">=</a> <a id="4509" href="Ledger.Epoch.html#3184" class="Function">stakeDistr</a> <a id="4520" href="Ledger.Utxo.html#2580" class="Function">utxo</a> <a id="4525" href="Ledger.Certs.html#2888" class="Function">dState</a> <a id="4532" href="Ledger.Certs.html#2908" class="Function">pState</a>
    <a id="4543" class="Keyword">in</a>
    <a id="4550" href="Ledger.Epoch.html#4252" class="Generalizable">lstate</a> <a id="4557" href="Ledger.Epoch.html#4343" class="Datatype Operator">⊢</a> <a id="4559" href="Class.To.html#102" class="Field Operator">⟦</a> <a id="4561" href="Ledger.Epoch.html#4212" class="Generalizable">mark</a> <a id="4566" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="4568" href="Ledger.Epoch.html#4217" class="Generalizable">set</a> <a id="4572" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="4574" href="Ledger.Epoch.html#4221" class="Generalizable">go</a> <a id="4577" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="4579" href="Ledger.Epoch.html#4237" class="Generalizable">feeSS</a> <a id="4585" href="Class.To.html#102" class="Field Operator">⟧</a> <a id="4587" href="Ledger.Epoch.html#4343" class="Datatype Operator">⇀⦇</a> <a id="4590" href="Agda.Builtin.Unit.html#212" class="InductiveConstructor">tt</a> <a id="4593" href="Ledger.Epoch.html#4343" class="Datatype Operator">,SNAP⦈</a> <a id="4600" href="Class.To.html#102" class="Field Operator">⟦</a> <a id="4602" href="Ledger.Epoch.html#4501" class="Bound">stake</a> <a id="4608" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="4610" href="Ledger.Epoch.html#4212" class="Generalizable">mark</a> <a id="4615" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="4617" href="Ledger.Epoch.html#4217" class="Generalizable">set</a> <a id="4621" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="4623" href="Ledger.Utxo.html#2602" class="Function">fees</a> <a id="4628" href="Class.To.html#102" class="Field Operator">⟧</a>

<a id="4631" class="Keyword">data</a> <a id="_⊢_⇀⦇_,EPOCH⦈_"></a><a id="4636" href="Ledger.Epoch.html#4636" class="Datatype Operator">_⊢_⇀⦇_,EPOCH⦈_</a> <a id="4651" class="Symbol">:</a> <a id="4653" href="Agda.Builtin.Unit.html#175" class="Record">⊤</a> <a id="4655" class="Symbol">→</a> <a id="4657" href="Ledger.Epoch.html#1127" class="Record">EpochState</a> <a id="4668" class="Symbol">→</a> <a id="4670" href="Ledger.Types.Epoch.html#476" class="Function">Epoch</a> <a id="4676" class="Symbol">→</a> <a id="4678" href="Ledger.Epoch.html#1127" class="Record">EpochState</a> <a id="4689" class="Symbol">→</a> <a id="4691" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="4696" class="Keyword">where</a>


  <a id="_⊢_⇀⦇_,EPOCH⦈_.EPOCH"></a><a id="4706" href="Ledger.Epoch.html#4706" class="InductiveConstructor">EPOCH</a> <a id="4712" class="Symbol">:</a> <a id="4714" class="Keyword">let</a>


      <a id="4726" class="Keyword">open</a> <a id="4731" href="Ledger.Ledger.html#715" class="Module">LState</a> <a id="4738" href="Ledger.Epoch.html#4165" class="Generalizable">ls</a>
      <a id="4747" class="Keyword">open</a> <a id="4752" href="Ledger.Certs.html#2825" class="Module">CertState</a> <a id="4762" href="Ledger.Ledger.html#827" class="Function">certState</a>
      <a id="4778" class="Keyword">open</a> <a id="4783" href="Ledger.Ratify.html#3241" class="Module">RatifyState</a> <a id="4795" href="Ledger.Epoch.html#4110" class="Generalizable">fut</a> <a id="4799" class="Keyword">renaming</a> <a id="4808" class="Symbol">(</a><a id="4809" href="Ledger.Ratify.html#3278" class="Field">es</a> <a id="4812" class="Symbol">to</a> <a id="4815" class="Field">esW</a><a id="4818" class="Symbol">)</a>
      <a id="4826" class="Keyword">open</a> <a id="4831" href="Ledger.Utxo.html#2516" class="Module">UTxOState</a>
      <a id="4847" class="Keyword">open</a> <a id="4852" href="Ledger.Certs.html#2574" class="Module">PState</a><a id="4858" class="Symbol">;</a> <a id="4860" class="Keyword">open</a> <a id="4865" href="Ledger.Certs.html#2393" class="Module">DState</a><a id="4871" class="Symbol">;</a> <a id="4873" class="Keyword">open</a> <a id="4878" href="Ledger.Certs.html#2681" class="Module">GState</a>
      <a id="4891" class="Keyword">open</a> <a id="4896" href="Ledger.PParams.html#674" class="Module">Acnt</a><a id="4900" class="Symbol">;</a> <a id="4902" class="Keyword">open</a> <a id="4907" href="Ledger.Enact.html#397" class="Module">EnactState</a><a id="4917" class="Symbol">;</a> <a id="4919" class="Keyword">open</a> <a id="4924" href="Ledger.GovernanceActions.html#2096" class="Module">GovActionState</a>



      <a id="4948" href="Ledger.Epoch.html#4948" class="Bound">es</a>                <a id="4966" class="Symbol">=</a> <a id="4968" class="Keyword">record</a> <a id="4975" href="Ledger.Epoch.html#4815" class="Function">esW</a> <a id="4979" class="Symbol">{</a> <a id="4981" href="Ledger.Enact.html#649" class="Field">withdrawals</a> <a id="4993" class="Symbol">=</a> <a id="4995" href="Class.HasEmptySet.html#287" class="Field">∅</a> <a id="4997" class="Symbol">}</a>
      <a id="5005" href="Ledger.Epoch.html#5005" class="Bound">tmpGovSt</a>          <a id="5023" class="Symbol">=</a> <a id="5025" href="Data.List.Base.html#10687" class="Function">filter</a> <a id="5032" class="Symbol">(λ</a> <a id="5035" href="Ledger.Epoch.html#5035" class="Bound">x</a> <a id="5037" class="Symbol">→</a> <a id="5039" href="Class.Decidable.Core.html#461" class="Function Operator">¿</a> <a id="5041" href="Data.Product.Base.html#636" class="Field">proj₁</a> <a id="5047" href="Ledger.Epoch.html#5035" class="Bound">x</a> <a id="5049" href="Class.IsSet.html#462" class="Function Operator">∉</a> <a id="5051" href="abstract-set-theory.FiniteSetTheory.html#519" class="Function">mapˢ</a> <a id="5056" href="Data.Product.Base.html#636" class="Field">proj₁</a> <a id="5062" href="Ledger.Ratify.html#3311" class="Function">removed</a> <a id="5070" href="Class.Decidable.Core.html#461" class="Function Operator">¿</a><a id="5071" class="Symbol">)</a> <a id="5073" href="Ledger.Ledger.html#801" class="Function">govSt</a>
      <a id="5085" href="Ledger.Epoch.html#5085" class="Bound">orphans</a>           <a id="5103" class="Symbol">=</a> <a id="5105" href="Axiom.Set.html#5718" class="Function">fromList</a> <a id="5114" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="5116" href="Ledger.Epoch.html#2745" class="Function">getOrphans</a> <a id="5127" href="Ledger.Epoch.html#4948" class="Bound">es</a> <a id="5130" href="Ledger.Epoch.html#5005" class="Bound">tmpGovSt</a>
      <a id="5145" href="Ledger.Epoch.html#5145" class="Bound">removed&#39;</a>          <a id="5163" class="Symbol">=</a> <a id="5165" href="Ledger.Ratify.html#3311" class="Function">removed</a> <a id="5173" href="Axiom.Set.html#8952" class="Function Operator">∪</a> <a id="5175" href="Ledger.Epoch.html#5085" class="Bound">orphans</a>
      <a id="5189" href="Ledger.Epoch.html#5189" class="Bound">removedGovActions</a> <a id="5207" class="Symbol">=</a> <a id="5209" href="Function.Base.html#1638" class="Function">flip</a> <a id="5214" href="Axiom.Set.html#7022" class="Function">concatMapˢ</a> <a id="5225" href="Ledger.Epoch.html#5145" class="Bound">removed&#39;</a> <a id="5234" class="Symbol">λ</a> <a id="5236" class="Symbol">(</a><a id="5237" href="Ledger.Epoch.html#5237" class="Bound">gaid</a> <a id="5242" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5244" href="Ledger.Epoch.html#5244" class="Bound">gaSt</a><a id="5248" class="Symbol">)</a> <a id="5250" class="Symbol">→</a>
        <a id="5260" href="abstract-set-theory.FiniteSetTheory.html#519" class="Function">mapˢ</a> <a id="5265" class="Symbol">(</a><a id="5266" href="Ledger.GovernanceActions.html#2167" class="Field">returnAddr</a> <a id="5277" href="Ledger.Epoch.html#5244" class="Bound">gaSt</a> <a id="5282" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,_</a><a id="5284" class="Symbol">)</a> <a id="5286" class="Symbol">((</a><a id="5288" href="Ledger.Ledger.html#774" class="Function">utxoSt</a> <a id="5295" class="Symbol">.</a><a id="5296" href="Ledger.Utxo.html#2624" class="Field">deposits</a> <a id="5305" href="Axiom.Set.Map.html#10678" class="Function Operator">∣</a> <a id="5307" href="Class.HasSingleton.html#288" class="Field Operator">❴</a> <a id="5309" href="Ledger.Certs.html#475" class="InductiveConstructor">GovActionDeposit</a> <a id="5326" href="Ledger.Epoch.html#5237" class="Bound">gaid</a> <a id="5331" href="Class.HasSingleton.html#288" class="Field Operator">❵</a><a id="5332" class="Symbol">)</a> <a id="5334" href="Axiom.Set.Map.html#2293" class="Function Operator">ˢ</a><a id="5335" class="Symbol">)</a>
      <a id="5343" href="Ledger.Epoch.html#5343" class="Bound">govActionReturns</a> <a id="5360" class="Symbol">=</a> <a id="5362" href="Axiom.Set.Map.Dec.html#1932" class="Function">aggregate₊</a> <a id="5373" class="Symbol">(</a><a id="5374" href="abstract-set-theory.FiniteSetTheory.html#519" class="Function">mapˢ</a> <a id="5379" class="Symbol">(λ</a> <a id="5382" class="Symbol">(</a><a id="5383" href="Ledger.Epoch.html#5383" class="Bound">a</a> <a id="5385" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5387" class="Symbol">_</a> <a id="5389" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5391" href="Ledger.Epoch.html#5391" class="Bound">d</a><a id="5392" class="Symbol">)</a> <a id="5394" class="Symbol">→</a> <a id="5396" href="Ledger.Epoch.html#5383" class="Bound">a</a> <a id="5398" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5400" href="Ledger.Epoch.html#5391" class="Bound">d</a><a id="5401" class="Symbol">)</a> <a id="5403" href="Ledger.Epoch.html#5189" class="Bound">removedGovActions</a> <a id="5421" href="abstract-set-theory.FiniteSetTheory.html#2767" class="Function Operator">ᶠˢ</a><a id="5423" class="Symbol">)</a>

      <a id="5432" href="Ledger.Epoch.html#5432" class="Bound">trWithdrawals</a>   <a id="5448" class="Symbol">=</a> <a id="5450" href="Ledger.Epoch.html#4815" class="Function">esW</a> <a id="5454" class="Symbol">.</a><a id="5455" href="Ledger.Enact.html#649" class="Field">withdrawals</a>
      <a id="5473" href="Ledger.Epoch.html#5473" class="Bound">totWithdrawals</a>  <a id="5489" class="Symbol">=</a> <a id="5491" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">∑[</a> <a id="5494" href="Ledger.Epoch.html#5494" class="Bound">x</a> <a id="5496" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">←</a> <a id="5498" href="Ledger.Epoch.html#5432" class="Bound">trWithdrawals</a> <a id="5512" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">]</a> <a id="5514" href="Ledger.Epoch.html#5494" class="Bound">x</a>

      <a id="5523" href="Ledger.Epoch.html#5523" class="Bound">retired</a>    <a id="5534" class="Symbol">=</a> <a id="5536" class="Symbol">(</a><a id="5537" href="Ledger.Certs.html#2908" class="Function">pState</a> <a id="5544" class="Symbol">.</a><a id="5545" href="Ledger.Certs.html#2643" class="Field">retiring</a><a id="5553" class="Symbol">)</a> <a id="5555" href="Axiom.Set.Map.html#14230" class="Function Operator">⁻¹</a> <a id="5558" href="Ledger.Epoch.html#4088" class="Generalizable">e</a>
      <a id="5566" href="Ledger.Epoch.html#5566" class="Bound">payout</a>     <a id="5577" class="Symbol">=</a> <a id="5579" href="Ledger.Epoch.html#5343" class="Bound">govActionReturns</a> <a id="5596" href="Axiom.Set.Map.Dec.html#1854" class="Function Operator">∪⁺</a> <a id="5599" href="Ledger.Epoch.html#5432" class="Bound">trWithdrawals</a>
      <a id="5619" href="Ledger.Epoch.html#5619" class="Bound">refunds</a>    <a id="5630" class="Symbol">=</a> <a id="5632" href="Axiom.Set.Map.html#13791" class="Function">pullbackMap</a> <a id="5644" href="Ledger.Epoch.html#5566" class="Bound">payout</a> <a id="5651" href="Ledger.Epoch.html#1856" class="Function">toRwdAddr</a> <a id="5661" class="Symbol">(</a><a id="5662" href="Class.IsSet.html#916" class="Function">dom</a> <a id="5666" class="Symbol">(</a><a id="5667" href="Ledger.Certs.html#2888" class="Function">dState</a> <a id="5674" class="Symbol">.</a><a id="5675" href="Ledger.Certs.html#2531" class="Field">rewards</a><a id="5682" class="Symbol">))</a>
      <a id="5691" href="Ledger.Epoch.html#5691" class="Bound">unclaimed</a>  <a id="5702" class="Symbol">=</a> <a id="5704" href="Ledger.Interface.HasCoin.html#172" class="Field">getCoin</a> <a id="5712" href="Ledger.Epoch.html#5566" class="Bound">payout</a> <a id="5719" href="Interface.HasSubtract.html#209" class="Field Operator">-</a> <a id="5721" href="Ledger.Interface.HasCoin.html#172" class="Field">getCoin</a> <a id="5729" href="Ledger.Epoch.html#5619" class="Bound">refunds</a>

      <a id="5744" href="Ledger.Epoch.html#5744" class="Bound">govSt&#39;</a> <a id="5751" class="Symbol">=</a> <a id="5753" href="Data.List.Base.html#10687" class="Function">filter</a> <a id="5760" class="Symbol">(λ</a> <a id="5763" href="Ledger.Epoch.html#5763" class="Bound">x</a> <a id="5765" class="Symbol">→</a> <a id="5767" href="Class.Decidable.Core.html#461" class="Function Operator">¿</a> <a id="5769" href="Data.Product.Base.html#636" class="Field">proj₁</a> <a id="5775" href="Ledger.Epoch.html#5763" class="Bound">x</a> <a id="5777" href="Class.IsSet.html#462" class="Function Operator">∉</a> <a id="5779" href="abstract-set-theory.FiniteSetTheory.html#519" class="Function">mapˢ</a> <a id="5784" href="Data.Product.Base.html#636" class="Field">proj₁</a> <a id="5790" href="Ledger.Epoch.html#5145" class="Bound">removed&#39;</a> <a id="5799" href="Class.Decidable.Core.html#461" class="Function Operator">¿</a><a id="5800" class="Symbol">)</a> <a id="5802" href="Ledger.Ledger.html#801" class="Function">govSt</a>

      <a id="5815" href="Ledger.Epoch.html#5815" class="Bound">dState&#39;</a> <a id="5823" class="Symbol">=</a> <a id="5825" href="Class.To.html#102" class="Field Operator">⟦</a> <a id="5827" href="Ledger.Certs.html#2888" class="Function">dState</a> <a id="5834" class="Symbol">.</a><a id="5835" href="Ledger.Certs.html#2452" class="Field">voteDelegs</a> <a id="5846" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5848" href="Ledger.Certs.html#2888" class="Function">dState</a> <a id="5855" class="Symbol">.</a><a id="5856" href="Ledger.Certs.html#2491" class="Field">stakeDelegs</a> <a id="5868" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a>  <a id="5871" href="Ledger.Certs.html#2888" class="Function">dState</a> <a id="5878" class="Symbol">.</a><a id="5879" href="Ledger.Certs.html#2531" class="Field">rewards</a> <a id="5887" href="Axiom.Set.Map.Dec.html#1854" class="Function Operator">∪⁺</a> <a id="5890" href="Ledger.Epoch.html#5619" class="Bound">refunds</a> <a id="5898" href="Class.To.html#102" class="Field Operator">⟧</a>

      <a id="5907" href="Ledger.Epoch.html#5907" class="Bound">pState&#39;</a> <a id="5915" class="Symbol">=</a> <a id="5917" href="Class.To.html#102" class="Field Operator">⟦</a> <a id="5919" href="Ledger.Certs.html#2908" class="Function">pState</a> <a id="5926" class="Symbol">.</a><a id="5927" href="Ledger.Certs.html#2606" class="Field">pools</a> <a id="5933" href="Axiom.Set.Map.html#10748" class="Function Operator">∣</a> <a id="5935" href="Ledger.Epoch.html#5523" class="Bound">retired</a> <a id="5943" href="Axiom.Set.Map.html#10748" class="Function Operator">ᶜ</a> <a id="5945" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5947" href="Ledger.Certs.html#2908" class="Function">pState</a> <a id="5954" class="Symbol">.</a><a id="5955" href="Ledger.Certs.html#2643" class="Field">retiring</a> <a id="5964" href="Axiom.Set.Map.html#10748" class="Function Operator">∣</a> <a id="5966" href="Ledger.Epoch.html#5523" class="Bound">retired</a> <a id="5974" href="Axiom.Set.Map.html#10748" class="Function Operator">ᶜ</a> <a id="5976" href="Class.To.html#102" class="Field Operator">⟧</a>

      <a id="5985" href="Ledger.Epoch.html#5985" class="Bound">gState&#39;</a> <a id="5993" class="Symbol">=</a> <a id="5995" href="Class.To.html#102" class="Field Operator">⟦</a> <a id="5997" class="Symbol">(</a><a id="5998" href="Class.ToBool.html#534" class="Function Operator">if</a> <a id="6001" href="Data.List.Base.html#4703" class="Function">null</a> <a id="6006" href="Ledger.Epoch.html#5744" class="Bound">govSt&#39;</a> <a id="6013" href="Class.ToBool.html#534" class="Function Operator">then</a> <a id="6018" href="Axiom.Set.Map.html#6068" class="Function">mapValues</a> <a id="6028" class="Symbol">(</a><a id="6029" class="Number">1</a> <a id="6031" href="Class.HasAdd.Core.html#136" class="Field Operator">+_</a><a id="6033" class="Symbol">)</a> <a id="6035" class="Symbol">(</a><a id="6036" href="Ledger.Certs.html#2928" class="Function">gState</a> <a id="6043" class="Symbol">.</a><a id="6044" href="Ledger.Certs.html#2738" class="Field">dreps</a><a id="6049" class="Symbol">)</a> <a id="6051" href="Class.ToBool.html#534" class="Function Operator">else</a> <a id="6056" class="Symbol">(</a><a id="6057" href="Ledger.Certs.html#2928" class="Function">gState</a> <a id="6064" class="Symbol">.</a><a id="6065" href="Ledger.Certs.html#2738" class="Field">dreps</a><a id="6070" class="Symbol">))</a>
                <a id="6089" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="6091" href="Ledger.Certs.html#2928" class="Function">gState</a> <a id="6098" class="Symbol">.</a><a id="6099" href="Ledger.Certs.html#2774" class="Field">ccHotKeys</a> <a id="6109" href="Axiom.Set.Map.html#10678" class="Function Operator">∣</a> <a id="6111" href="Ledger.Enact.html#788" class="Function">ccCreds</a> <a id="6119" class="Symbol">(</a><a id="6120" href="Ledger.Epoch.html#4948" class="Bound">es</a> <a id="6123" class="Symbol">.</a><a id="6124" href="Ledger.Enact.html#433" class="Field">cc</a><a id="6126" class="Symbol">)</a> <a id="6128" href="Class.To.html#102" class="Field Operator">⟧</a>

      <a id="6137" href="Ledger.Epoch.html#6137" class="Bound">certState&#39;</a> <a id="6148" class="Symbol">:</a> <a id="6150" href="Ledger.Certs.html#2825" class="Record">CertState</a>
      <a id="6166" href="Ledger.Epoch.html#6137" class="Bound">certState&#39;</a> <a id="6177" class="Symbol">=</a> <a id="6179" href="Class.To.html#102" class="Field Operator">⟦</a> <a id="6181" href="Ledger.Epoch.html#5815" class="Bound">dState&#39;</a> <a id="6189" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="6191" href="Ledger.Epoch.html#5907" class="Bound">pState&#39;</a> <a id="6199" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="6201" href="Ledger.Epoch.html#5985" class="Bound">gState&#39;</a> <a id="6209" href="Class.To.html#102" class="Field Operator">⟧</a>

      <a id="6218" href="Ledger.Epoch.html#6218" class="Bound">utxoSt&#39;</a> <a id="6226" class="Symbol">=</a> <a id="6228" href="Class.To.html#102" class="Field Operator">⟦</a> <a id="6230" href="Ledger.Ledger.html#774" class="Function">utxoSt</a> <a id="6237" class="Symbol">.</a><a id="6238" href="Ledger.Utxo.html#2580" class="Field">utxo</a> <a id="6243" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="6245" href="Ledger.Ledger.html#774" class="Function">utxoSt</a> <a id="6252" class="Symbol">.</a><a id="6253" href="Ledger.Utxo.html#2602" class="Field">fees</a> <a id="6258" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="6260" href="Ledger.Ledger.html#774" class="Function">utxoSt</a> <a id="6267" class="Symbol">.</a><a id="6268" href="Ledger.Utxo.html#2624" class="Field">deposits</a> <a id="6277" href="Axiom.Set.Map.html#10748" class="Function Operator">∣</a> <a id="6279" href="abstract-set-theory.FiniteSetTheory.html#519" class="Function">mapˢ</a> <a id="6284" class="Symbol">(</a><a id="6285" href="Data.Product.Base.html#636" class="Field">proj₁</a> <a id="6291" href="Function.Base.html#1115" class="Function Operator">∘</a> <a id="6293" href="Data.Product.Base.html#650" class="Field">proj₂</a><a id="6298" class="Symbol">)</a> <a id="6300" href="Ledger.Epoch.html#5189" class="Bound">removedGovActions</a> <a id="6318" href="Axiom.Set.Map.html#10748" class="Function Operator">ᶜ</a> <a id="6320" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="6322" class="Number">0</a> <a id="6324" href="Class.To.html#102" class="Field Operator">⟧</a>

      <a id="6333" href="Ledger.Epoch.html#6333" class="Bound">acnt&#39;</a> <a id="6339" class="Symbol">=</a> <a id="6341" class="Keyword">record</a> <a id="6348" href="Ledger.Epoch.html#4179" class="Generalizable">acnt</a>
        <a id="6361" class="Symbol">{</a> <a id="6363" href="Ledger.PParams.html#729" class="Field">treasury</a>  <a id="6373" class="Symbol">=</a> <a id="6375" href="Ledger.Epoch.html#4179" class="Generalizable">acnt</a> <a id="6380" class="Symbol">.</a><a id="6381" href="Ledger.PParams.html#729" class="Field">treasury</a> <a id="6390" href="Data.Nat.Base.html#4456" class="Primitive Operator">∸</a> <a id="6392" href="Ledger.Epoch.html#5473" class="Bound">totWithdrawals</a> <a id="6407" href="Class.HasAdd.Core.html#136" class="Field Operator">+</a> <a id="6409" href="Ledger.Ledger.html#774" class="Function">utxoSt</a> <a id="6416" class="Symbol">.</a><a id="6417" href="Ledger.Utxo.html#2650" class="Field">donations</a> <a id="6427" href="Class.HasAdd.Core.html#136" class="Field Operator">+</a> <a id="6429" href="Ledger.Epoch.html#5691" class="Bound">unclaimed</a> <a id="6439" class="Symbol">}</a>
    <a id="6445" class="Keyword">in</a>
    <a id="6452" class="Keyword">record</a> <a id="6459" class="Symbol">{</a> <a id="6461" href="Ledger.Ratify.html#3016" class="Field">currentEpoch</a> <a id="6474" class="Symbol">=</a> <a id="6476" href="Ledger.Epoch.html#4088" class="Generalizable">e</a>
           <a id="6489" class="Symbol">;</a> <a id="6491" href="Ledger.Ratify.html#2984" class="Field">stakeDistrs</a> <a id="6503" class="Symbol">=</a> <a id="6505" href="Ledger.Epoch.html#3806" class="Function">mkStakeDistrs</a>  <a id="6520" class="Symbol">(</a><a id="6521" href="Ledger.Epoch.html#1069" class="Field">Snapshots.mark</a> <a id="6536" href="Ledger.Epoch.html#4273" class="Generalizable">ss&#39;</a><a id="6539" class="Symbol">)</a> <a id="6541" href="Ledger.Epoch.html#5744" class="Bound">govSt&#39;</a>
                                          <a id="6590" class="Symbol">(</a><a id="6591" href="Ledger.Epoch.html#6218" class="Bound">utxoSt&#39;</a> <a id="6599" class="Symbol">.</a><a id="6600" href="Ledger.Utxo.html#2624" class="Field">deposits</a><a id="6608" class="Symbol">)</a> <a id="6610" class="Symbol">(</a><a id="6611" href="Ledger.Certs.html#2452" class="Field">voteDelegs</a> <a id="6622" href="Ledger.Certs.html#2888" class="Function">dState</a><a id="6628" class="Symbol">)</a>
           <a id="6641" class="Symbol">;</a> <a id="6643" href="Ledger.Ratify.html#3131" class="Field">treasury</a> <a id="6652" class="Symbol">=</a> <a id="6654" href="Ledger.Epoch.html#4179" class="Generalizable">acnt</a> <a id="6659" class="Symbol">.</a><a id="6660" href="Ledger.PParams.html#729" class="Field">treasury</a> <a id="6669" class="Symbol">;</a> <a id="6671" href="Ledger.Epoch.html#6671" class="Module">GState</a> <a id="6678" href="Ledger.Certs.html#2928" class="Function">gState</a>
           <a id="6696" class="Symbol">;</a> <a id="6698" href="Ledger.Ratify.html#3156" class="Field">pools</a> <a id="6704" class="Symbol">=</a> <a id="6706" href="Ledger.Certs.html#2908" class="Function">pState</a> <a id="6713" class="Symbol">.</a><a id="6714" href="Ledger.Certs.html#2606" class="Field">pools</a> <a id="6720" class="Symbol">;</a> <a id="6722" href="Ledger.Ratify.html#3197" class="Field">delegatees</a> <a id="6733" class="Symbol">=</a> <a id="6735" href="Ledger.Certs.html#2888" class="Function">dState</a> <a id="6742" class="Symbol">.</a><a id="6743" href="Ledger.Certs.html#2452" class="Field">voteDelegs</a> <a id="6754" class="Symbol">}</a>
        <a id="6764" href="Ledger.Ratify.html#11866" class="Function Operator">⊢</a> <a id="6766" href="Class.To.html#102" class="Field Operator">⟦</a> <a id="6768" href="Ledger.Epoch.html#4948" class="Bound">es</a> <a id="6771" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="6773" href="Class.HasEmptySet.html#287" class="Field">∅</a> <a id="6775" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="6777" href="Agda.Builtin.Bool.html#192" class="InductiveConstructor">false</a> <a id="6783" href="Class.To.html#102" class="Field Operator">⟧</a> <a id="6785" href="Ledger.Ratify.html#11866" class="Function Operator">⇀⦇</a> <a id="6788" href="Ledger.Epoch.html#5744" class="Bound">govSt&#39;</a> <a id="6795" href="Ledger.Ratify.html#11866" class="Function Operator">,RATIFIES⦈</a> <a id="6806" href="Ledger.Epoch.html#4114" class="Generalizable">fut&#39;</a>
      <a id="6817" class="Symbol">→</a> <a id="6819" href="Ledger.Epoch.html#4165" class="Generalizable">ls</a> <a id="6822" href="Ledger.Epoch.html#4343" class="Datatype Operator">⊢</a> <a id="6824" href="Ledger.Epoch.html#4270" class="Generalizable">ss</a> <a id="6827" href="Ledger.Epoch.html#4343" class="Datatype Operator">⇀⦇</a> <a id="6830" href="Agda.Builtin.Unit.html#212" class="InductiveConstructor">tt</a> <a id="6833" href="Ledger.Epoch.html#4343" class="Datatype Operator">,SNAP⦈</a> <a id="6840" href="Ledger.Epoch.html#4273" class="Generalizable">ss&#39;</a>
    <a id="6848" href="Interface.STS.html#350" class="Function Operator">────────────────────────────────</a>
    <a id="6885" class="Symbol">_</a> <a id="6887" href="Ledger.Epoch.html#4636" class="Datatype Operator">⊢</a> <a id="6889" href="Class.To.html#102" class="Field Operator">⟦</a> <a id="6891" href="Ledger.Epoch.html#4179" class="Generalizable">acnt</a> <a id="6896" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="6898" href="Ledger.Epoch.html#4270" class="Generalizable">ss</a> <a id="6901" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="6903" href="Ledger.Epoch.html#4165" class="Generalizable">ls</a> <a id="6906" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="6908" href="Ledger.Epoch.html#4193" class="Generalizable">es₀</a> <a id="6912" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="6914" href="Ledger.Epoch.html#4110" class="Generalizable">fut</a> <a id="6918" href="Class.To.html#102" class="Field Operator">⟧</a> <a id="6920" href="Ledger.Epoch.html#4636" class="Datatype Operator">⇀⦇</a> <a id="6923" href="Ledger.Epoch.html#4088" class="Generalizable">e</a> <a id="6925" href="Ledger.Epoch.html#4636" class="Datatype Operator">,EPOCH⦈</a>
        <a id="6941" href="Class.To.html#102" class="Field Operator">⟦</a> <a id="6943" href="Ledger.Epoch.html#6333" class="Bound">acnt&#39;</a> <a id="6949" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="6951" href="Ledger.Epoch.html#4273" class="Generalizable">ss&#39;</a> <a id="6955" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="6957" href="Class.To.html#102" class="Field Operator">⟦</a> <a id="6959" href="Ledger.Epoch.html#6218" class="Bound">utxoSt&#39;</a> <a id="6967" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="6969" href="Ledger.Epoch.html#5744" class="Bound">govSt&#39;</a> <a id="6976" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="6978" href="Ledger.Epoch.html#6137" class="Bound">certState&#39;</a> <a id="6989" href="Class.To.html#102" class="Field Operator">⟧</a> <a id="6991" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="6993" href="Ledger.Epoch.html#4948" class="Bound">es</a> <a id="6996" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="6998" href="Ledger.Epoch.html#4114" class="Generalizable">fut&#39;</a> <a id="7003" href="Class.To.html#102" class="Field Operator">⟧</a>


<a id="7007" class="Keyword">data</a>


  <a id="_⊢_⇀⦇_,NEWEPOCH⦈_"></a><a id="7016" href="Ledger.Epoch.html#7016" class="Datatype Operator">_⊢_⇀⦇_,NEWEPOCH⦈_</a> <a id="7034" class="Symbol">:</a> <a id="7036" href="Agda.Builtin.Unit.html#175" class="Record">⊤</a> <a id="7038" class="Symbol">→</a> <a id="7040" href="Ledger.Epoch.html#1330" class="Record">NewEpochState</a> <a id="7054" class="Symbol">→</a> <a id="7056" href="Ledger.Types.Epoch.html#476" class="Function">Epoch</a> <a id="7062" class="Symbol">→</a> <a id="7064" href="Ledger.Epoch.html#1330" class="Record">NewEpochState</a> <a id="7078" class="Symbol">→</a> <a id="7080" href="Agda.Primitive.html#388" class="Primitive">Type</a>


  <a id="7089" class="Keyword">where</a>


  <a id="_⊢_⇀⦇_,NEWEPOCH⦈_.NEWEPOCH-New"></a><a id="7099" href="Ledger.Epoch.html#7099" class="InductiveConstructor">NEWEPOCH-New</a> <a id="7112" class="Symbol">:</a> <a id="7114" class="Keyword">let</a>
      <a id="7124" href="Ledger.Epoch.html#7124" class="Bound">eps&#39;</a> <a id="7129" class="Symbol">=</a> <a id="7131" href="Ledger.Epoch.html#2095" class="Function">applyRUpd</a> <a id="7141" href="Ledger.Epoch.html#4291" class="Generalizable">ru</a> <a id="7144" href="Ledger.Epoch.html#4135" class="Generalizable">eps</a>
    <a id="7152" class="Keyword">in</a>
    <a id="7159" href="Interface.STS.html#105" class="Function Operator">∙</a> <a id="7161" href="Ledger.Epoch.html#4088" class="Generalizable">e</a> <a id="7163" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="7165" href="Ledger.Epoch.html#4090" class="Generalizable">lastEpoch</a> <a id="7175" href="Class.HasAdd.Core.html#136" class="Field Operator">+</a> <a id="7177" class="Number">1</a>
    <a id="7183" href="Interface.STS.html#131" class="Function Operator">∙</a> <a id="7185" class="Symbol">_</a> <a id="7187" href="Ledger.Epoch.html#4636" class="Datatype Operator">⊢</a> <a id="7189" href="Ledger.Epoch.html#7124" class="Bound">eps&#39;</a> <a id="7194" href="Ledger.Epoch.html#4636" class="Datatype Operator">⇀⦇</a> <a id="7197" href="Ledger.Epoch.html#4088" class="Generalizable">e</a> <a id="7199" href="Ledger.Epoch.html#4636" class="Datatype Operator">,EPOCH⦈</a> <a id="7207" href="Ledger.Epoch.html#4144" class="Generalizable">eps&#39;&#39;</a>
      <a id="7219" href="Interface.STS.html#350" class="Function Operator">────────────────────────────────</a>
      <a id="7258" class="Symbol">_</a> <a id="7260" href="Ledger.Epoch.html#7016" class="Datatype Operator">⊢</a> <a id="7262" href="Class.To.html#102" class="Field Operator">⟦</a> <a id="7264" href="Ledger.Epoch.html#4090" class="Generalizable">lastEpoch</a> <a id="7274" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="7276" href="Ledger.Epoch.html#4135" class="Generalizable">eps</a> <a id="7280" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="7282" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="7287" href="Ledger.Epoch.html#4291" class="Generalizable">ru</a> <a id="7290" href="Class.To.html#102" class="Field Operator">⟧</a> <a id="7292" href="Ledger.Epoch.html#7016" class="Datatype Operator">⇀⦇</a> <a id="7295" href="Ledger.Epoch.html#4088" class="Generalizable">e</a> <a id="7297" href="Ledger.Epoch.html#7016" class="Datatype Operator">,NEWEPOCH⦈</a> <a id="7308" href="Class.To.html#102" class="Field Operator">⟦</a> <a id="7310" href="Ledger.Epoch.html#4088" class="Generalizable">e</a> <a id="7312" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="7314" href="Ledger.Epoch.html#4144" class="Generalizable">eps&#39;&#39;</a> <a id="7320" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="7322" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a> <a id="7330" href="Class.To.html#102" class="Field Operator">⟧</a>

  <a id="_⊢_⇀⦇_,NEWEPOCH⦈_.NEWEPOCH-Not-New"></a><a id="7335" href="Ledger.Epoch.html#7335" class="InductiveConstructor">NEWEPOCH-Not-New</a> <a id="7352" class="Symbol">:</a>
    <a id="7358" href="Interface.STS.html#105" class="Function Operator">∙</a> <a id="7360" href="Ledger.Epoch.html#4088" class="Generalizable">e</a> <a id="7362" href="Relation.Binary.PropositionalEquality.Core.html#858" class="Function Operator">≢</a> <a id="7364" href="Ledger.Epoch.html#4090" class="Generalizable">lastEpoch</a> <a id="7374" href="Class.HasAdd.Core.html#136" class="Field Operator">+</a> <a id="7376" class="Number">1</a>
      <a id="7384" href="Interface.STS.html#350" class="Function Operator">────────────────────────────────</a>
      <a id="7423" class="Symbol">_</a> <a id="7425" href="Ledger.Epoch.html#7016" class="Datatype Operator">⊢</a> <a id="7427" href="Class.To.html#102" class="Field Operator">⟦</a> <a id="7429" href="Ledger.Epoch.html#4090" class="Generalizable">lastEpoch</a> <a id="7439" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="7441" href="Ledger.Epoch.html#4135" class="Generalizable">eps</a> <a id="7445" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="7447" href="Ledger.Epoch.html#4311" class="Generalizable">mru</a> <a id="7451" href="Class.To.html#102" class="Field Operator">⟧</a> <a id="7453" href="Ledger.Epoch.html#7016" class="Datatype Operator">⇀⦇</a> <a id="7456" href="Ledger.Epoch.html#4088" class="Generalizable">e</a> <a id="7458" href="Ledger.Epoch.html#7016" class="Datatype Operator">,NEWEPOCH⦈</a> <a id="7469" href="Class.To.html#102" class="Field Operator">⟦</a> <a id="7471" href="Ledger.Epoch.html#4090" class="Generalizable">lastEpoch</a> <a id="7481" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="7483" href="Ledger.Epoch.html#4135" class="Generalizable">eps</a> <a id="7487" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="7489" href="Ledger.Epoch.html#4311" class="Generalizable">mru</a> <a id="7493" href="Class.To.html#102" class="Field Operator">⟧</a>

  <a id="_⊢_⇀⦇_,NEWEPOCH⦈_.NEWEPOCH-No-Reward-Update"></a><a id="7498" href="Ledger.Epoch.html#7498" class="InductiveConstructor">NEWEPOCH-No-Reward-Update</a> <a id="7524" class="Symbol">:</a>
    <a id="7530" href="Interface.STS.html#105" class="Function Operator">∙</a> <a id="7532" href="Ledger.Epoch.html#4088" class="Generalizable">e</a> <a id="7534" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="7536" href="Ledger.Epoch.html#4090" class="Generalizable">lastEpoch</a> <a id="7546" href="Class.HasAdd.Core.html#136" class="Field Operator">+</a> <a id="7548" class="Number">1</a>
    <a id="7554" href="Interface.STS.html#131" class="Function Operator">∙</a> <a id="7556" class="Symbol">_</a> <a id="7558" href="Ledger.Epoch.html#4636" class="Datatype Operator">⊢</a> <a id="7560" href="Ledger.Epoch.html#4135" class="Generalizable">eps</a> <a id="7564" href="Ledger.Epoch.html#4636" class="Datatype Operator">⇀⦇</a> <a id="7567" href="Ledger.Epoch.html#4088" class="Generalizable">e</a> <a id="7569" href="Ledger.Epoch.html#4636" class="Datatype Operator">,EPOCH⦈</a> <a id="7577" href="Ledger.Epoch.html#4139" class="Generalizable">eps&#39;</a>
      <a id="7588" href="Interface.STS.html#350" class="Function Operator">────────────────────────────────</a>
      <a id="7627" class="Symbol">_</a> <a id="7629" href="Ledger.Epoch.html#7016" class="Datatype Operator">⊢</a> <a id="7631" href="Class.To.html#102" class="Field Operator">⟦</a> <a id="7633" href="Ledger.Epoch.html#4090" class="Generalizable">lastEpoch</a> <a id="7643" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="7645" href="Ledger.Epoch.html#4135" class="Generalizable">eps</a> <a id="7649" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="7651" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a> <a id="7659" href="Class.To.html#102" class="Field Operator">⟧</a> <a id="7661" href="Ledger.Epoch.html#7016" class="Datatype Operator">⇀⦇</a> <a id="7664" href="Ledger.Epoch.html#4088" class="Generalizable">e</a> <a id="7666" href="Ledger.Epoch.html#7016" class="Datatype Operator">,NEWEPOCH⦈</a> <a id="7677" href="Class.To.html#102" class="Field Operator">⟦</a> <a id="7679" href="Ledger.Epoch.html#4088" class="Generalizable">e</a> <a id="7681" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="7683" href="Ledger.Epoch.html#4139" class="Generalizable">eps&#39;</a> <a id="7688" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="7690" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a> <a id="7698" href="Class.To.html#102" class="Field Operator">⟧</a>

</pre></body></html>