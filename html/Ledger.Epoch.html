<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>Ledger.Epoch</title><link rel="stylesheet" href="Agda.css"></head><body><pre class="Agda">
<a id="2" class="Symbol">{-#</a> <a id="6" class="Keyword">OPTIONS</a> <a id="14" class="Pragma">--safe</a> <a id="21" class="Symbol">#-}</a>

<a id="26" class="Keyword">open</a> <a id="31" class="Keyword">import</a> <a id="38" href="Data.Nat.Properties.html" class="Module">Data.Nat.Properties</a> <a id="58" class="Keyword">using</a> <a id="64" class="Symbol">(</a><a id="65" href="Data.Nat.Properties.html#17252" class="Function">+-0-monoid</a><a id="75" class="Symbol">;</a> <a id="77" href="Data.Nat.Properties.html#17331" class="Function">+-0-commutativeMonoid</a><a id="98" class="Symbol">)</a>
<a id="100" class="Keyword">open</a> <a id="105" class="Keyword">import</a> <a id="112" href="Data.Integer.html" class="Module">Data.Integer</a> <a id="125" class="Keyword">using</a> <a id="131" class="Symbol">()</a> <a id="134" class="Keyword">renaming</a> <a id="143" class="Symbol">(</a><a id="144" href="Agda.Builtin.Int.html#263" class="InductiveConstructor">+_</a> <a id="147" class="Symbol">to</a> <a id="150" class="InductiveConstructor">pos</a><a id="153" class="Symbol">)</a>
<a id="155" class="Keyword">open</a> <a id="160" class="Keyword">import</a> <a id="167" href="Data.Nat.GeneralisedArithmetic.html" class="Module">Data.Nat.GeneralisedArithmetic</a> <a id="198" class="Keyword">using</a> <a id="204" class="Symbol">(</a><a id="205" href="Data.Nat.GeneralisedArithmetic.html#866" class="Function">iterate</a><a id="212" class="Symbol">)</a>
<a id="214" class="Keyword">open</a> <a id="219" class="Keyword">import</a> <a id="226" href="Data.Rational.html" class="Module">Data.Rational</a> <a id="240" class="Keyword">using</a> <a id="246" class="Symbol">(</a><a id="247" href="Data.Rational.Base.html#1342" class="Record">ℚ</a><a id="248" class="Symbol">;</a> <a id="250" href="Data.Rational.Base.html#7116" class="Function">floor</a><a id="255" class="Symbol">;</a> <a id="257" href="Data.Rational.Base.html#6315" class="Function Operator">_*_</a><a id="260" class="Symbol">;</a> <a id="262" href="Data.Rational.Base.html#6708" class="Function Operator">_÷_</a><a id="265" class="Symbol">;</a> <a id="267" href="Data.Rational.Base.html#3884" class="Function Operator">_/_</a><a id="270" class="Symbol">)</a>
<a id="272" class="Keyword">open</a> <a id="277" class="Keyword">import</a> <a id="284" href="Data.Rational.Literals.html" class="Module">Data.Rational.Literals</a> <a id="307" class="Keyword">using</a> <a id="313" class="Symbol">(</a><a id="314" href="Data.Rational.Literals.html#740" class="Function">number</a><a id="320" class="Symbol">;</a> <a id="322" href="Data.Rational.Literals.html#613" class="Function">fromℤ</a><a id="327" class="Symbol">)</a>
<a id="329" class="Keyword">import</a>      <a id="341" href="Data.Rational.html" class="Module">Data.Rational</a> <a id="355" class="Symbol">as</a> <a id="358" class="Module">ℚ</a> <a id="360" class="Keyword">renaming</a> <a id="369" class="Symbol">(</a><a id="370" href="Data.Rational.Base.html#6854" class="Function Operator">_⊓_</a> <a id="374" class="Symbol">to</a> <a id="377" class="Function Operator">min</a><a id="380" class="Symbol">)</a>

<a id="383" class="Keyword">open</a> <a id="388" class="Keyword">import</a> <a id="395" href="Agda.Builtin.FromNat.html" class="Module">Agda.Builtin.FromNat</a>

<a id="417" class="Keyword">open</a> <a id="422" class="Keyword">import</a> <a id="429" href="Ledger.Prelude.html" class="Module">Ledger.Prelude</a> <a id="444" class="Keyword">hiding</a> <a id="451" class="Symbol">(</a><a id="452" href="Data.List.Base.html#5412" class="Function">iterate</a><a id="459" class="Symbol">;</a> <a id="461" href="Data.Nat.Base.html#7102" class="Function Operator">_/_</a><a id="464" class="Symbol">;</a> <a id="466" href="Agda.Builtin.Nat.html#539" class="Primitive Operator">_*_</a><a id="469" class="Symbol">)</a>
<a id="471" class="Keyword">open</a> <a id="476" href="Ledger.Prelude.html#2677" class="Module">Filter</a> <a id="483" class="Keyword">using</a> <a id="489" class="Symbol">(</a><a id="490" href="Ledger.Prelude.html#2692" class="Function">filter</a><a id="496" class="Symbol">)</a>
<a id="498" class="Keyword">open</a> <a id="503" class="Keyword">import</a> <a id="510" href="Ledger.Abstract.html" class="Module">Ledger.Abstract</a>
<a id="526" class="Keyword">open</a> <a id="531" class="Keyword">import</a> <a id="538" href="Ledger.Transaction.html" class="Module">Ledger.Transaction</a>
<a id="557" class="Keyword">open</a> <a id="562" class="Keyword">import</a> <a id="569" href="Ledger.Types.Numeric.UnitInterval.html" class="Module">Ledger.Types.Numeric.UnitInterval</a>

<a id="604" class="Keyword">open</a> <a id="609" href="Agda.Builtin.FromNat.html#196" class="Module">Number</a> <a id="616" href="Data.Rational.Literals.html#740" class="Function">number</a> <a id="623" class="Keyword">renaming</a> <a id="632" class="Symbol">(</a><a id="633" href="Agda.Builtin.FromNat.html#281" class="Field">fromNat</a> <a id="641" class="Symbol">to</a> <a id="644" class="Field">fromℕ</a><a id="649" class="Symbol">)</a>

<a id="652" class="Keyword">module</a> <a id="659" href="Ledger.Epoch.html" class="Module">Ledger.Epoch</a>
  <a id="674" class="Symbol">(</a><a id="675" href="Ledger.Epoch.html#675" class="Bound">txs</a> <a id="679" class="Symbol">:</a> <a id="681" class="Symbol">_)</a> <a id="684" class="Symbol">(</a><a id="685" class="Keyword">open</a> <a id="690" href="Ledger.Transaction.html#840" class="Module">TransactionStructure</a> <a id="711" href="Ledger.Epoch.html#675" class="Bound">txs</a><a id="714" class="Symbol">)</a>
  <a id="718" class="Symbol">(</a><a id="719" href="Ledger.Epoch.html#719" class="Bound">abs</a> <a id="723" class="Symbol">:</a> <a id="725" href="Ledger.Abstract.html#578" class="Record">AbstractFunctions</a> <a id="743" href="Ledger.Epoch.html#675" class="Bound">txs</a><a id="746" class="Symbol">)</a> <a id="748" class="Symbol">(</a><a id="749" class="Keyword">open</a> <a id="754" href="Ledger.Abstract.html#578" class="Module">AbstractFunctions</a> <a id="772" href="Ledger.Epoch.html#719" class="Bound">abs</a><a id="775" class="Symbol">)</a>
  <a id="779" class="Keyword">where</a>

<a id="786" class="Keyword">open</a> <a id="791" class="Keyword">import</a> <a id="798" href="Ledger.Certs.html" class="Module">Ledger.Certs</a> <a id="811" href="Ledger.Transaction.html#1782" class="Function">govStructure</a>
<a id="824" class="Keyword">open</a> <a id="829" class="Keyword">import</a> <a id="836" href="Ledger.Enact.html" class="Module">Ledger.Enact</a> <a id="849" href="Ledger.Transaction.html#1782" class="Function">govStructure</a>
<a id="862" class="Keyword">open</a> <a id="867" class="Keyword">import</a> <a id="874" href="Ledger.Gov.html" class="Module">Ledger.Gov</a> <a id="885" href="Ledger.Epoch.html#675" class="Bound">txs</a>
<a id="889" class="Keyword">open</a> <a id="894" class="Keyword">import</a> <a id="901" href="Ledger.Ledger.html" class="Module">Ledger.Ledger</a> <a id="915" href="Ledger.Epoch.html#675" class="Bound">txs</a> <a id="919" href="Ledger.Epoch.html#719" class="Bound">abs</a>
<a id="923" class="Keyword">open</a> <a id="928" class="Keyword">import</a> <a id="935" href="Ledger.Ratify.html" class="Module">Ledger.Ratify</a> <a id="949" href="Ledger.Epoch.html#675" class="Bound">txs</a>
<a id="953" class="Keyword">open</a> <a id="958" class="Keyword">import</a> <a id="965" href="Ledger.Rewards.html" class="Module">Ledger.Rewards</a> <a id="980" href="Ledger.Transaction.html#1782" class="Function">govStructure</a>
<a id="993" class="Keyword">open</a> <a id="998" class="Keyword">import</a> <a id="1005" href="Ledger.Utxo.html" class="Module">Ledger.Utxo</a> <a id="1017" href="Ledger.Epoch.html#675" class="Bound">txs</a> <a id="1021" href="Ledger.Epoch.html#719" class="Bound">abs</a>



<a id="1028" class="Keyword">record</a> <a id="Snapshot"></a><a id="1035" href="Ledger.Epoch.html#1035" class="Record">Snapshot</a> <a id="1044" class="Symbol">:</a> <a id="1046" href="Agda.Primitive.html#388" class="Primitive">Set</a> <a id="1050" class="Keyword">where</a>
  <a id="1058" class="Keyword">field</a>
    <a id="Snapshot.stake"></a><a id="1068" href="Ledger.Epoch.html#1068" class="Field">stake</a>           <a id="1084" class="Symbol">:</a> <a id="1086" href="Ledger.Address.html#273" class="Datatype">Credential</a> <a id="1097" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="1099" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a>
    <a id="Snapshot.delegations"></a><a id="1108" href="Ledger.Epoch.html#1108" class="Field">delegations</a>     <a id="1124" class="Symbol">:</a> <a id="1126" href="Ledger.Address.html#273" class="Datatype">Credential</a> <a id="1137" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="1139" href="Ledger.Crypto.html#1310" class="Function">KeyHash</a>
    <a id="Snapshot.poolParameters"></a><a id="1151" href="Ledger.Epoch.html#1151" class="Field">poolParameters</a>  <a id="1167" class="Symbol">:</a> <a id="1169" href="Ledger.Crypto.html#1310" class="Function">KeyHash</a> <a id="1177" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="1179" href="Ledger.Certs.html#1131" class="Record">PoolParams</a>

<a id="1191" class="Keyword">record</a> <a id="Snapshots"></a><a id="1198" href="Ledger.Epoch.html#1198" class="Record">Snapshots</a> <a id="1208" class="Symbol">:</a> <a id="1210" href="Agda.Primitive.html#388" class="Primitive">Set</a> <a id="1214" class="Keyword">where</a>
  <a id="1222" class="Keyword">field</a>
    <a id="Snapshots.mark"></a><a id="1232" href="Ledger.Epoch.html#1232" class="Field">mark</a> <a id="Snapshots.set"></a><a id="1237" href="Ledger.Epoch.html#1237" class="Field">set</a> <a id="Snapshots.go"></a><a id="1241" href="Ledger.Epoch.html#1241" class="Field">go</a>  <a id="1245" class="Symbol">:</a> <a id="1247" href="Ledger.Epoch.html#1035" class="Record">Snapshot</a>
    <a id="Snapshots.feeSS"></a><a id="1260" href="Ledger.Epoch.html#1260" class="Field">feeSS</a>        <a id="1273" class="Symbol">:</a> <a id="1275" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a>



<a id="1283" class="Keyword">record</a> <a id="EpochState"></a><a id="1290" href="Ledger.Epoch.html#1290" class="Record">EpochState</a> <a id="1301" class="Symbol">:</a> <a id="1303" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="1308" class="Keyword">where</a>


  <a id="1318" class="Keyword">constructor</a> <a id="⟦_,_,_,_,_⟧ᵉ&#39;"></a><a id="1330" href="Ledger.Epoch.html#1330" class="InductiveConstructor Operator">⟦_,_,_,_,_⟧ᵉ&#39;</a>


  <a id="1348" class="Keyword">field</a>
    <a id="EpochState.acnt"></a><a id="1358" href="Ledger.Epoch.html#1358" class="Field">acnt</a>       <a id="1369" class="Symbol">:</a> <a id="1371" href="Ledger.PParams.html#674" class="Record">Acnt</a>
    <a id="EpochState.ss"></a><a id="1380" href="Ledger.Epoch.html#1380" class="Field">ss</a>         <a id="1391" class="Symbol">:</a> <a id="1393" href="Ledger.Epoch.html#1198" class="Record">Snapshots</a>
    <a id="EpochState.ls"></a><a id="1407" href="Ledger.Epoch.html#1407" class="Field">ls</a>         <a id="1418" class="Symbol">:</a> <a id="1420" href="Ledger.Ledger.html#809" class="Record">LState</a>
    <a id="EpochState.es"></a><a id="1431" href="Ledger.Epoch.html#1431" class="Field">es</a>         <a id="1442" class="Symbol">:</a> <a id="1444" href="Ledger.Enact.html#397" class="Record">EnactState</a>
    <a id="EpochState.fut"></a><a id="1459" href="Ledger.Epoch.html#1459" class="Field">fut</a>        <a id="1470" class="Symbol">:</a> <a id="1472" href="Ledger.Ratify.html#3279" class="Record">RatifyState</a>


<a id="1486" class="Keyword">record</a> <a id="HasEpochState"></a><a id="1493" href="Ledger.Epoch.html#1493" class="Record">HasEpochState</a> <a id="1507" class="Symbol">{</a><a id="1508" href="Ledger.Epoch.html#1508" class="Bound">a</a><a id="1509" class="Symbol">}</a> <a id="1511" class="Symbol">(</a><a id="1512" href="Ledger.Epoch.html#1512" class="Bound">A</a> <a id="1514" class="Symbol">:</a> <a id="1516" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="1521" href="Ledger.Epoch.html#1508" class="Bound">a</a><a id="1522" class="Symbol">)</a> <a id="1524" class="Symbol">:</a> <a id="1526" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="1531" href="Ledger.Epoch.html#1508" class="Bound">a</a> <a id="1533" class="Keyword">where</a>
  <a id="1541" class="Keyword">field</a> <a id="HasEpochState.EpochStateOf"></a><a id="1547" href="Ledger.Epoch.html#1547" class="Field">EpochStateOf</a> <a id="1560" class="Symbol">:</a> <a id="1562" href="Ledger.Epoch.html#1512" class="Bound">A</a> <a id="1564" class="Symbol">→</a> <a id="1566" href="Ledger.Epoch.html#1290" class="Record">EpochState</a>
<a id="1577" class="Keyword">open</a> <a id="1582" href="Ledger.Epoch.html#1493" class="Module">HasEpochState</a> <a id="1596" class="Symbol">⦃...⦄</a> <a id="1602" class="Keyword">public</a>

<a id="1610" class="Keyword">instance</a>
  <a id="HasLState-EpochState"></a><a id="1621" href="Ledger.Epoch.html#1621" class="Function">HasLState-EpochState</a> <a id="1642" class="Symbol">:</a> <a id="1644" href="Ledger.Ledger.html#954" class="Record">HasLState</a> <a id="1654" href="Ledger.Epoch.html#1290" class="Record">EpochState</a>
  <a id="1667" href="Ledger.Epoch.html#1621" class="Function">HasLState-EpochState</a> <a id="1688" class="Symbol">.</a><a id="1689" href="Ledger.Ledger.html#1004" class="Field">LStateOf</a> <a id="1698" class="Symbol">=</a> <a id="1700" href="Ledger.Epoch.html#1407" class="Field">EpochState.ls</a>

  <a id="HasEnactState-EpochState"></a><a id="1717" href="Ledger.Epoch.html#1717" class="Function">HasEnactState-EpochState</a> <a id="1742" class="Symbol">:</a> <a id="1744" href="Ledger.Enact.html#689" class="Record">HasEnactState</a> <a id="1758" href="Ledger.Epoch.html#1290" class="Record">EpochState</a>
  <a id="1771" href="Ledger.Epoch.html#1717" class="Function">HasEnactState-EpochState</a> <a id="1796" class="Symbol">.</a><a id="1797" href="Ledger.Enact.html#743" class="Field">EnactStateOf</a> <a id="1810" class="Symbol">=</a> <a id="1812" href="Ledger.Epoch.html#1431" class="Field">EpochState.es</a>

  <a id="HasDeposits-EpochState"></a><a id="1829" href="Ledger.Epoch.html#1829" class="Function">HasDeposits-EpochState</a> <a id="1852" class="Symbol">:</a> <a id="1854" href="Ledger.Certs.html#677" class="Record">HasDeposits</a> <a id="1866" href="Ledger.Epoch.html#1290" class="Record">EpochState</a>
  <a id="1879" href="Ledger.Epoch.html#1829" class="Function">HasDeposits-EpochState</a> <a id="1902" class="Symbol">.</a><a id="1903" href="Ledger.Certs.html#729" class="Field">DepositsOf</a> <a id="1914" class="Symbol">=</a> <a id="1916" href="Ledger.Certs.html#729" class="Field">DepositsOf</a> <a id="1927" href="Function.Base.html#1115" class="Function Operator">∘</a> <a id="1929" href="Ledger.Ledger.html#1004" class="Field">LStateOf</a>

  <a id="Hastreasury-EpochState"></a><a id="1941" href="Ledger.Epoch.html#1941" class="Function">Hastreasury-EpochState</a> <a id="1964" class="Symbol">:</a> <a id="1966" href="Ledger.PParams.html#762" class="Record">Hastreasury</a> <a id="1978" href="Ledger.Epoch.html#1290" class="Record">EpochState</a>
  <a id="1991" href="Ledger.Epoch.html#1941" class="Function">Hastreasury-EpochState</a> <a id="2014" class="Symbol">.</a><a id="2015" href="Ledger.PParams.html#814" class="Field">treasuryOf</a> <a id="2026" class="Symbol">=</a> <a id="2028" href="Ledger.PParams.html#729" class="Field">Acnt.treasury</a> <a id="2042" href="Function.Base.html#1115" class="Function Operator">∘</a> <a id="2044" href="Ledger.Epoch.html#1358" class="Field">EpochState.acnt</a>



<a id="2063" class="Keyword">record</a> <a id="NewEpochState"></a><a id="2070" href="Ledger.Epoch.html#2070" class="Record">NewEpochState</a> <a id="2084" class="Symbol">:</a> <a id="2086" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="2091" class="Keyword">where</a>
  <a id="2099" class="Keyword">field</a>
    <a id="NewEpochState.lastEpoch"></a><a id="2109" href="Ledger.Epoch.html#2109" class="Field">lastEpoch</a>   <a id="2121" class="Symbol">:</a> <a id="2123" href="Ledger.Types.Epoch.html#543" class="Function">Epoch</a>
    <a id="NewEpochState.epochState"></a><a id="2133" href="Ledger.Epoch.html#2133" class="Field">epochState</a>  <a id="2145" class="Symbol">:</a> <a id="2147" href="Ledger.Epoch.html#1290" class="Record">EpochState</a>
    <a id="NewEpochState.ru"></a><a id="2162" href="Ledger.Epoch.html#2162" class="Field">ru</a>          <a id="2174" class="Symbol">:</a> <a id="2176" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="2182" href="Ledger.Rewards.html#5643" class="Record">RewardUpdate</a>


<a id="2197" class="Keyword">record</a> <a id="HasNewEpochState"></a><a id="2204" href="Ledger.Epoch.html#2204" class="Record">HasNewEpochState</a> <a id="2221" class="Symbol">{</a><a id="2222" href="Ledger.Epoch.html#2222" class="Bound">a</a><a id="2223" class="Symbol">}</a> <a id="2225" class="Symbol">(</a><a id="2226" href="Ledger.Epoch.html#2226" class="Bound">A</a> <a id="2228" class="Symbol">:</a> <a id="2230" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="2235" href="Ledger.Epoch.html#2222" class="Bound">a</a><a id="2236" class="Symbol">)</a> <a id="2238" class="Symbol">:</a> <a id="2240" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="2245" href="Ledger.Epoch.html#2222" class="Bound">a</a> <a id="2247" class="Keyword">where</a>
  <a id="2255" class="Keyword">field</a> <a id="HasNewEpochState.NewEpochStateOf"></a><a id="2261" href="Ledger.Epoch.html#2261" class="Field">NewEpochStateOf</a> <a id="2277" class="Symbol">:</a> <a id="2279" href="Ledger.Epoch.html#2226" class="Bound">A</a> <a id="2281" class="Symbol">→</a> <a id="2283" href="Ledger.Epoch.html#2070" class="Record">NewEpochState</a>
<a id="2297" class="Keyword">open</a> <a id="2302" href="Ledger.Epoch.html#2204" class="Module">HasNewEpochState</a> <a id="2319" class="Symbol">⦃...⦄</a> <a id="2325" class="Keyword">public</a>
<a id="2332" class="Keyword">record</a> <a id="HasLastEpoch"></a><a id="2339" href="Ledger.Epoch.html#2339" class="Record">HasLastEpoch</a>     <a id="2356" class="Symbol">{</a><a id="2357" href="Ledger.Epoch.html#2357" class="Bound">a</a><a id="2358" class="Symbol">}</a> <a id="2360" class="Symbol">(</a><a id="2361" href="Ledger.Epoch.html#2361" class="Bound">A</a> <a id="2363" class="Symbol">:</a> <a id="2365" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="2370" href="Ledger.Epoch.html#2357" class="Bound">a</a><a id="2371" class="Symbol">)</a> <a id="2373" class="Symbol">:</a> <a id="2375" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="2380" href="Ledger.Epoch.html#2357" class="Bound">a</a> <a id="2382" class="Keyword">where</a> <a id="2388" class="Keyword">field</a> <a id="HasLastEpoch.LastEpochOf"></a><a id="2394" href="Ledger.Epoch.html#2394" class="Field">LastEpochOf</a>     <a id="2410" class="Symbol">:</a> <a id="2412" href="Ledger.Epoch.html#2361" class="Bound">A</a> <a id="2414" class="Symbol">→</a> <a id="2416" href="Ledger.Types.Epoch.html#543" class="Function">Epoch</a>
<a id="2422" class="Keyword">open</a> <a id="2427" href="Ledger.Epoch.html#2339" class="Module">HasLastEpoch</a>     <a id="2444" class="Symbol">⦃...⦄</a> <a id="2450" class="Keyword">public</a>

<a id="2458" class="Keyword">instance</a>
  <a id="HasLastEpoch-NewEpochState"></a><a id="2469" href="Ledger.Epoch.html#2469" class="Function">HasLastEpoch-NewEpochState</a> <a id="2496" class="Symbol">:</a> <a id="2498" href="Ledger.Epoch.html#2339" class="Record">HasLastEpoch</a> <a id="2511" href="Ledger.Epoch.html#2070" class="Record">NewEpochState</a>
  <a id="2527" href="Ledger.Epoch.html#2469" class="Function">HasLastEpoch-NewEpochState</a> <a id="2554" class="Symbol">.</a><a id="2555" href="Ledger.Epoch.html#2394" class="Field">LastEpochOf</a> <a id="2567" class="Symbol">=</a> <a id="2569" href="Ledger.Epoch.html#2109" class="Field">NewEpochState.lastEpoch</a>

  <a id="HasEpochState-NewEpochState"></a><a id="2596" href="Ledger.Epoch.html#2596" class="Function">HasEpochState-NewEpochState</a> <a id="2624" class="Symbol">:</a> <a id="2626" href="Ledger.Epoch.html#1493" class="Record">HasEpochState</a> <a id="2640" href="Ledger.Epoch.html#2070" class="Record">NewEpochState</a>
  <a id="2656" href="Ledger.Epoch.html#2596" class="Function">HasEpochState-NewEpochState</a> <a id="2684" class="Symbol">.</a><a id="2685" href="Ledger.Epoch.html#1547" class="Field">EpochStateOf</a> <a id="2698" class="Symbol">=</a> <a id="2700" href="Ledger.Epoch.html#2133" class="Field">NewEpochState.epochState</a>

  <a id="Hastreasury-NewEpochState"></a><a id="2728" href="Ledger.Epoch.html#2728" class="Function">Hastreasury-NewEpochState</a> <a id="2754" class="Symbol">:</a> <a id="2756" href="Ledger.PParams.html#762" class="Record">Hastreasury</a> <a id="2768" href="Ledger.Epoch.html#2070" class="Record">NewEpochState</a>
  <a id="2784" href="Ledger.Epoch.html#2728" class="Function">Hastreasury-NewEpochState</a> <a id="2810" class="Symbol">.</a><a id="2811" href="Ledger.PParams.html#814" class="Field">treasuryOf</a> <a id="2822" class="Symbol">=</a> <a id="2824" href="Ledger.PParams.html#814" class="Field">treasuryOf</a> <a id="2835" href="Function.Base.html#1115" class="Function Operator">∘</a> <a id="2837" href="Ledger.Epoch.html#1547" class="Field">EpochStateOf</a>

  <a id="HasLState-NewEpochState"></a><a id="2853" href="Ledger.Epoch.html#2853" class="Function">HasLState-NewEpochState</a> <a id="2877" class="Symbol">:</a> <a id="2879" href="Ledger.Ledger.html#954" class="Record">HasLState</a> <a id="2889" href="Ledger.Epoch.html#2070" class="Record">NewEpochState</a>
  <a id="2905" href="Ledger.Epoch.html#2853" class="Function">HasLState-NewEpochState</a> <a id="2929" class="Symbol">.</a><a id="2930" href="Ledger.Ledger.html#1004" class="Field">LStateOf</a> <a id="2939" class="Symbol">=</a> <a id="2941" href="Ledger.Ledger.html#1004" class="Field">LStateOf</a> <a id="2950" href="Function.Base.html#1115" class="Function Operator">∘</a> <a id="2952" href="Ledger.Epoch.html#1547" class="Field">EpochStateOf</a>

  <a id="HasGovState-NewEpochState"></a><a id="2968" href="Ledger.Epoch.html#2968" class="Function">HasGovState-NewEpochState</a> <a id="2994" class="Symbol">:</a> <a id="2996" href="Ledger.Gov.html#1422" class="Record">HasGovState</a> <a id="3008" href="Ledger.Epoch.html#2070" class="Record">NewEpochState</a>
  <a id="3024" href="Ledger.Epoch.html#2968" class="Function">HasGovState-NewEpochState</a> <a id="3050" class="Symbol">.</a><a id="3051" href="Ledger.Gov.html#1474" class="Field">GovStateOf</a> <a id="3062" class="Symbol">=</a> <a id="3064" href="Ledger.Gov.html#1474" class="Field">GovStateOf</a> <a id="3075" href="Function.Base.html#1115" class="Function Operator">∘</a> <a id="3077" href="Ledger.Ledger.html#1004" class="Field">LStateOf</a>

  <a id="HasCertState-NewEpochState"></a><a id="3089" href="Ledger.Epoch.html#3089" class="Function">HasCertState-NewEpochState</a> <a id="3116" class="Symbol">:</a> <a id="3118" href="Ledger.Certs.html#4455" class="Record">HasCertState</a> <a id="3131" href="Ledger.Epoch.html#2070" class="Record">NewEpochState</a>
  <a id="3147" href="Ledger.Epoch.html#3089" class="Function">HasCertState-NewEpochState</a> <a id="3174" class="Symbol">.</a><a id="3175" href="Ledger.Certs.html#4508" class="Field">CertStateOf</a> <a id="3187" class="Symbol">=</a> <a id="3189" href="Ledger.Certs.html#4508" class="Field">CertStateOf</a> <a id="3201" href="Function.Base.html#1115" class="Function Operator">∘</a> <a id="3203" href="Ledger.Ledger.html#1004" class="Field">LStateOf</a>

  <a id="HasDReps-NewEpochState"></a><a id="3215" href="Ledger.Epoch.html#3215" class="Function">HasDReps-NewEpochState</a> <a id="3238" class="Symbol">:</a> <a id="3240" href="Ledger.Certs.html#906" class="Record">HasDReps</a> <a id="3249" href="Ledger.Epoch.html#2070" class="Record">NewEpochState</a> 
  <a id="3266" href="Ledger.Epoch.html#3215" class="Function">HasDReps-NewEpochState</a> <a id="3289" class="Symbol">.</a><a id="3290" href="Ledger.Certs.html#955" class="Field">DRepsOf</a> <a id="3298" class="Symbol">=</a> <a id="3300" href="Ledger.Certs.html#955" class="Field">DRepsOf</a> <a id="3308" href="Function.Base.html#1115" class="Function Operator">∘</a> <a id="3310" href="Ledger.Certs.html#4508" class="Field">CertStateOf</a>

  <a id="HasRewards-NewEpochState"></a><a id="3325" href="Ledger.Epoch.html#3325" class="Function">HasRewards-NewEpochState</a> <a id="3350" class="Symbol">:</a> <a id="3352" href="Ledger.Certs.html#793" class="Record">HasRewards</a> <a id="3363" href="Ledger.Epoch.html#2070" class="Record">NewEpochState</a>
  <a id="3379" href="Ledger.Epoch.html#3325" class="Function">HasRewards-NewEpochState</a> <a id="3404" class="Symbol">.</a><a id="3405" href="Ledger.Certs.html#844" class="Field">RewardsOf</a> <a id="3415" class="Symbol">=</a> <a id="3417" href="Ledger.Certs.html#844" class="Field">RewardsOf</a> <a id="3427" href="Function.Base.html#1115" class="Function Operator">∘</a> <a id="3429" href="Ledger.Certs.html#4508" class="Field">CertStateOf</a>

  <a id="3444" class="Keyword">unquoteDecl</a> <a id="HasCast-RewardUpdate"></a><a id="3456" href="Ledger.Epoch.html#3456" class="Function">HasCast-RewardUpdate</a> <a id="HasCast-Snapshot"></a><a id="3477" href="Ledger.Epoch.html#3477" class="Function">HasCast-Snapshot</a> <a id="HasCast-Snapshots"></a><a id="3494" href="Ledger.Epoch.html#3494" class="Function">HasCast-Snapshots</a> <a id="HasCast-EpochState"></a><a id="3512" href="Ledger.Epoch.html#3512" class="Function">HasCast-EpochState</a> <a id="HasCast-NewEpochState"></a><a id="3531" href="Ledger.Epoch.html#3531" class="Function">HasCast-NewEpochState</a> <a id="3553" class="Symbol">=</a> <a id="3555" href="stdlib-classes.Class.HasCast.Derive.html#2690" class="Function">derive-HasCast</a>
    <a id="3574" class="Symbol">(</a>   <a id="3578" class="Symbol">(</a><a id="3579" class="Keyword">quote</a> <a id="3585" href="Ledger.Rewards.html#5643" class="Record">RewardUpdate</a>   <a id="3600" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="3602" href="Ledger.Epoch.html#3456" class="Function">HasCast-RewardUpdate</a><a id="3622" class="Symbol">)</a>
    <a id="3628" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a>   <a id="3632" class="Symbol">(</a><a id="3633" class="Keyword">quote</a> <a id="3639" href="Ledger.Epoch.html#1035" class="Record">Snapshot</a>       <a id="3654" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="3656" href="Ledger.Epoch.html#3477" class="Function">HasCast-Snapshot</a><a id="3672" class="Symbol">)</a>
    <a id="3678" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a>   <a id="3682" class="Symbol">(</a><a id="3683" class="Keyword">quote</a> <a id="3689" href="Ledger.Epoch.html#1198" class="Record">Snapshots</a>      <a id="3704" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="3706" href="Ledger.Epoch.html#3494" class="Function">HasCast-Snapshots</a><a id="3723" class="Symbol">)</a>
    <a id="3729" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a>   <a id="3733" class="Symbol">(</a><a id="3734" class="Keyword">quote</a> <a id="3740" href="Ledger.Epoch.html#1290" class="Record">EpochState</a>     <a id="3755" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="3757" href="Ledger.Epoch.html#3512" class="Function">HasCast-EpochState</a><a id="3775" class="Symbol">)</a>
    <a id="3781" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="3783" href="Data.List.Base.html#5205" class="Function Operator">[</a> <a id="3785" class="Symbol">(</a><a id="3786" class="Keyword">quote</a> <a id="3792" href="Ledger.Epoch.html#2070" class="Record">NewEpochState</a>  <a id="3807" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="3809" href="Ledger.Epoch.html#3531" class="Function">HasCast-NewEpochState</a><a id="3830" class="Symbol">)</a><a id="3831" href="Data.List.Base.html#5205" class="Function Operator">]</a><a id="3832" class="Symbol">)</a>

<a id="3835" class="Keyword">instance</a> <a id="3844" href="Ledger.Epoch.html#3844" class="Function">_</a> <a id="3846" class="Symbol">=</a> <a id="3848" href="Data.Nat.Properties.html#17252" class="Function">+-0-monoid</a><a id="3858" class="Symbol">;</a> <a id="3860" href="Ledger.Epoch.html#3860" class="Function">_</a> <a id="3862" class="Symbol">=</a> <a id="3864" href="Data.Nat.Properties.html#17331" class="Function">+-0-commutativeMonoid</a>

<a id="toRwdAddr"></a><a id="3887" href="Ledger.Epoch.html#3887" class="Function">toRwdAddr</a> <a id="3897" class="Symbol">:</a> <a id="3899" href="Ledger.Address.html#273" class="Datatype">Credential</a> <a id="3910" class="Symbol">→</a> <a id="3912" href="Ledger.Address.html#1337" class="Record">RwdAddr</a>
<a id="3920" href="Ledger.Epoch.html#3887" class="Function">toRwdAddr</a> <a id="3930" href="Ledger.Epoch.html#3930" class="Bound">x</a> <a id="3932" class="Symbol">=</a> <a id="3934" class="Keyword">record</a> <a id="3941" class="Symbol">{</a> <a id="3943" href="Ledger.Address.html#1366" class="Field">net</a> <a id="3947" class="Symbol">=</a> <a id="3949" href="Ledger.Types.Epoch.html#2310" class="Function">NetworkId</a> <a id="3959" class="Symbol">;</a> <a id="3961" href="Ledger.Address.html#1391" class="Field">stake</a> <a id="3967" class="Symbol">=</a> <a id="3969" href="Ledger.Epoch.html#3930" class="Bound">x</a> <a id="3971" class="Symbol">}</a>

<a id="getStakeCred"></a><a id="3974" href="Ledger.Epoch.html#3974" class="Function">getStakeCred</a> <a id="3987" class="Symbol">:</a> <a id="3989" href="Ledger.Transaction.html#2293" class="Function">TxOut</a> <a id="3995" class="Symbol">→</a> <a id="3997" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="4003" href="Ledger.Address.html#273" class="Datatype">Credential</a>
<a id="4014" href="Ledger.Epoch.html#3974" class="Function">getStakeCred</a> <a id="4027" class="Symbol">(</a><a id="4028" href="Ledger.Epoch.html#4028" class="Bound">a</a> <a id="4030" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="4032" class="Symbol">_</a> <a id="4034" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="4036" class="Symbol">_</a> <a id="4038" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="4040" class="Symbol">_)</a> <a id="4043" class="Symbol">=</a> <a id="4045" href="Ledger.Address.html#2509" class="Function">stakeCred</a> <a id="4055" href="Ledger.Epoch.html#4028" class="Bound">a</a>

<a id="4058" class="Keyword">open</a> <a id="4063" href="Ledger.GovernanceActions.html#2746" class="Module">GovActionState</a> <a id="4078" class="Keyword">using</a> <a id="4084" class="Symbol">(</a><a id="4085" href="Ledger.GovernanceActions.html#2817" class="Field">returnAddr</a><a id="4095" class="Symbol">)</a>



<a id="createRUpd"></a><a id="4100" href="Ledger.Epoch.html#4100" class="Function">createRUpd</a> <a id="4111" class="Symbol">:</a> <a id="4113" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a> <a id="4115" class="Symbol">→</a> <a id="4117" href="Ledger.Rewards.html#4360" class="Function">BlocksMade</a> <a id="4128" class="Symbol">→</a> <a id="4130" href="Ledger.Epoch.html#1290" class="Record">EpochState</a> <a id="4141" class="Symbol">→</a> <a id="4143" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a> <a id="4148" class="Symbol">→</a> <a id="4150" href="Ledger.Rewards.html#5643" class="Record">RewardUpdate</a>
<a id="4163" href="Ledger.Epoch.html#4100" class="Function">createRUpd</a> <a id="4174" href="Ledger.Epoch.html#4174" class="Bound">slotsPerEpoch</a> <a id="4188" href="Ledger.Epoch.html#4188" class="Bound">b</a> <a id="4190" href="Ledger.Epoch.html#4190" class="Bound">es</a> <a id="4193" href="Ledger.Epoch.html#4193" class="Bound">total</a>
  <a id="4201" class="Symbol">=</a> <a id="4203" href="Ledger.Prelude.html#2441" class="Function Operator">⟦</a> <a id="4205" href="Ledger.Epoch.html#4908" class="Function">Δt₁</a> <a id="4209" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="4211" class="Number">0</a> <a id="4213" href="Interface.HasSubtract.html#209" class="Field Operator">-</a> <a id="4215" href="Ledger.Epoch.html#4767" class="Function">Δr₁</a> <a id="4219" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="4221" href="Ledger.Epoch.html#5081" class="Function">Δr₂</a> <a id="4225" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="4227" class="Number">0</a> <a id="4229" href="Interface.HasSubtract.html#209" class="Field Operator">-</a> <a id="4231" href="Ledger.Epoch.html#4407" class="Function">feeSS</a> <a id="4237" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="4239" href="Ledger.Epoch.html#5018" class="Function">rs</a> <a id="4242" href="Ledger.Prelude.html#2441" class="Function Operator">⟧</a>
  <a id="4246" class="Keyword">where</a>
    <a id="4256" href="Ledger.Epoch.html#4256" class="Function">prevPp</a>      <a id="4268" class="Symbol">=</a> <a id="4270" href="Ledger.PParams.html#3424" class="Field">PParamsOf</a> <a id="4280" class="Symbol">(</a><a id="4281" href="Ledger.Epoch.html#4190" class="Bound">es</a> <a id="4284" class="Symbol">.</a><a id="4285" href="Ledger.Epoch.html#1431" class="Field">EpochState.es</a><a id="4298" class="Symbol">)</a>
    <a id="4304" href="Ledger.Epoch.html#4304" class="Function">reserves</a>    <a id="4316" class="Symbol">=</a> <a id="4318" href="Ledger.Epoch.html#4190" class="Bound">es</a> <a id="4321" class="Symbol">.</a><a id="4322" href="Ledger.Epoch.html#1358" class="Field">EpochState.acnt</a> <a id="4338" class="Symbol">.</a><a id="4339" href="Ledger.PParams.html#738" class="Field">Acnt.reserves</a>
    <a id="4357" href="Ledger.Epoch.html#4357" class="Function">pstakego</a>    <a id="4369" class="Symbol">=</a> <a id="4371" href="Ledger.Epoch.html#4190" class="Bound">es</a> <a id="4374" class="Symbol">.</a><a id="4375" href="Ledger.Epoch.html#1380" class="Field">EpochState.ss</a> <a id="4389" class="Symbol">.</a><a id="4390" href="Ledger.Epoch.html#1241" class="Field">Snapshots.go</a>
    <a id="4407" href="Ledger.Epoch.html#4407" class="Function">feeSS</a>       <a id="4419" class="Symbol">=</a> <a id="4421" href="Ledger.Epoch.html#4190" class="Bound">es</a> <a id="4424" class="Symbol">.</a><a id="4425" href="Ledger.Epoch.html#1380" class="Field">EpochState.ss</a> <a id="4439" class="Symbol">.</a><a id="4440" href="Ledger.Epoch.html#1260" class="Field">Snapshots.feeSS</a>
    <a id="4460" href="Ledger.Epoch.html#4460" class="Function">stake</a>       <a id="4472" class="Symbol">=</a> <a id="4474" href="Ledger.Epoch.html#4357" class="Function">pstakego</a> <a id="4483" class="Symbol">.</a><a id="4484" href="Ledger.Epoch.html#1068" class="Field">Snapshot.stake</a>
    <a id="4503" href="Ledger.Epoch.html#4503" class="Function">delegs</a>      <a id="4515" class="Symbol">=</a> <a id="4517" href="Ledger.Epoch.html#4357" class="Function">pstakego</a> <a id="4526" class="Symbol">.</a><a id="4527" href="Ledger.Epoch.html#1108" class="Field">Snapshot.delegations</a>
    <a id="4552" href="Ledger.Epoch.html#4552" class="Function">poolParams</a>  <a id="4564" class="Symbol">=</a> <a id="4566" href="Ledger.Epoch.html#4357" class="Function">pstakego</a> <a id="4575" class="Symbol">.</a><a id="4576" href="Ledger.Epoch.html#1151" class="Field">Snapshot.poolParameters</a>

    <a id="4605" href="Ledger.Epoch.html#4605" class="Function">blocksMade</a> <a id="4616" class="Symbol">=</a> <a id="4618" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">∑[</a> <a id="4621" href="Ledger.Epoch.html#4621" class="Bound">m</a> <a id="4623" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">←</a> <a id="4625" href="Ledger.Epoch.html#4188" class="Bound">b</a> <a id="4627" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">]</a> <a id="4629" href="Ledger.Epoch.html#4621" class="Bound">m</a>

    <a id="4636" href="Ledger.Epoch.html#4636" class="Function">rho</a> <a id="4640" class="Symbol">=</a> <a id="4642" href="Ledger.Types.Numeric.UnitInterval.html#2334" class="Function">fromUnitInterval</a> <a id="4659" class="Symbol">(</a><a id="4660" href="Ledger.Epoch.html#4256" class="Function">prevPp</a> <a id="4667" class="Symbol">.</a><a id="4668" href="Ledger.PParams.html#2166" class="Field">PParams.monetaryExpansion</a><a id="4693" class="Symbol">)</a>
    <a id="4699" href="Ledger.Epoch.html#4699" class="Function">η</a> <a id="4701" class="Symbol">=</a> <a id="4703" href="Ledger.Epoch.html#644" class="Function">fromℕ</a> <a id="4709" href="Ledger.Epoch.html#4605" class="Function">blocksMade</a> <a id="4720" href="Ledger.Prelude.html#2305" class="Function Operator">÷₀</a> <a id="4723" class="Symbol">(</a><a id="4724" href="Ledger.Epoch.html#644" class="Function">fromℕ</a> <a id="4730" href="Ledger.Epoch.html#4174" class="Bound">slotsPerEpoch</a> <a id="4744" href="Data.Rational.Base.html#6315" class="Function Operator">*</a> <a id="4746" href="Ledger.Types.Epoch.html#2173" class="Function">ActiveSlotCoeff</a><a id="4761" class="Symbol">)</a>
    <a id="4767" href="Ledger.Epoch.html#4767" class="Function">Δr₁</a> <a id="4771" class="Symbol">=</a> <a id="4773" href="Data.Rational.Base.html#7116" class="Function">floor</a> <a id="4779" class="Symbol">(</a><a id="4780" href="Ledger.Epoch.html#377" class="Function">ℚ.min</a> <a id="4786" class="Number">1</a> <a id="4788" href="Ledger.Epoch.html#4699" class="Function">η</a> <a id="4790" href="Data.Rational.Base.html#6315" class="Function Operator">*</a> <a id="4792" href="Ledger.Epoch.html#4636" class="Function">rho</a> <a id="4796" href="Data.Rational.Base.html#6315" class="Function Operator">*</a> <a id="4798" href="Ledger.Epoch.html#644" class="Function">fromℕ</a> <a id="4804" href="Ledger.Epoch.html#4304" class="Function">reserves</a><a id="4812" class="Symbol">)</a>

    <a id="4819" href="Ledger.Epoch.html#4819" class="Function">rewardPot</a> <a id="4829" class="Symbol">=</a> <a id="4831" href="Ledger.Epoch.html#150" class="InductiveConstructor">pos</a> <a id="4835" href="Ledger.Epoch.html#4407" class="Function">feeSS</a> <a id="4841" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="4843" href="Ledger.Epoch.html#4767" class="Function">Δr₁</a>
    <a id="4851" href="Ledger.Epoch.html#4851" class="Function">tau</a> <a id="4855" class="Symbol">=</a> <a id="4857" href="Ledger.Types.Numeric.UnitInterval.html#2334" class="Function">fromUnitInterval</a> <a id="4874" class="Symbol">(</a><a id="4875" href="Ledger.Epoch.html#4256" class="Function">prevPp</a> <a id="4882" class="Symbol">.</a><a id="4883" href="Ledger.PParams.html#2236" class="Field">PParams.treasuryCut</a><a id="4902" class="Symbol">)</a>
    <a id="4908" href="Ledger.Epoch.html#4908" class="Function">Δt₁</a> <a id="4912" class="Symbol">=</a> <a id="4914" href="Data.Rational.Base.html#7116" class="Function">floor</a> <a id="4920" class="Symbol">(</a><a id="4921" href="Ledger.Epoch.html#4851" class="Function">tau</a> <a id="4925" href="Data.Rational.Base.html#6315" class="Function Operator">*</a> <a id="4927" href="Data.Rational.Literals.html#613" class="Function">fromℤ</a> <a id="4933" href="Ledger.Epoch.html#4819" class="Function">rewardPot</a><a id="4942" class="Symbol">)</a>
    <a id="4948" href="Ledger.Epoch.html#4948" class="Function">R</a> <a id="4950" class="Symbol">=</a> <a id="4952" href="Prelude.html#3167" class="Function">posPart</a> <a id="4960" class="Symbol">(</a><a id="4961" href="Ledger.Epoch.html#4819" class="Function">rewardPot</a> <a id="4971" href="Interface.HasSubtract.html#209" class="Field Operator">-</a> <a id="4973" href="Ledger.Epoch.html#4908" class="Function">Δt₁</a><a id="4976" class="Symbol">)</a>
    <a id="4982" href="Ledger.Epoch.html#4982" class="Function">circulation</a> <a id="4994" class="Symbol">=</a> <a id="4996" href="Ledger.Epoch.html#4193" class="Bound">total</a> <a id="5002" href="Interface.HasSubtract.html#209" class="Field Operator">-</a> <a id="5004" href="Ledger.Epoch.html#4304" class="Function">reserves</a>

    <a id="5018" href="Ledger.Epoch.html#5018" class="Function">rs</a> <a id="5021" class="Symbol">=</a> <a id="5023" href="Ledger.Rewards.html#4834" class="Function">reward</a> <a id="5030" href="Ledger.Epoch.html#4256" class="Function">prevPp</a> <a id="5037" href="Ledger.Epoch.html#4188" class="Bound">b</a> <a id="5039" href="Ledger.Epoch.html#4948" class="Function">R</a> <a id="5041" href="Ledger.Epoch.html#4552" class="Function">poolParams</a> <a id="5052" href="Ledger.Epoch.html#4460" class="Function">stake</a> <a id="5058" href="Ledger.Epoch.html#4503" class="Function">delegs</a> <a id="5065" href="Ledger.Epoch.html#4982" class="Function">circulation</a>
    <a id="5081" href="Ledger.Epoch.html#5081" class="Function">Δr₂</a> <a id="5085" class="Symbol">=</a> <a id="5087" href="Ledger.Epoch.html#4948" class="Function">R</a> <a id="5089" href="Interface.HasSubtract.html#209" class="Field Operator">-</a> <a id="5091" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">∑[</a> <a id="5094" href="Ledger.Epoch.html#5094" class="Bound">c</a> <a id="5096" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">←</a> <a id="5098" href="Ledger.Epoch.html#5018" class="Function">rs</a> <a id="5101" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">]</a> <a id="5103" href="Ledger.Epoch.html#5094" class="Bound">c</a>



<a id="applyRUpd"></a><a id="5108" href="Ledger.Epoch.html#5108" class="Function">applyRUpd</a> <a id="5118" class="Symbol">:</a> <a id="5120" href="Ledger.Rewards.html#5643" class="Record">RewardUpdate</a> <a id="5133" class="Symbol">→</a> <a id="5135" href="Ledger.Epoch.html#1290" class="Record">EpochState</a> <a id="5146" class="Symbol">→</a> <a id="5148" href="Ledger.Epoch.html#1290" class="Record">EpochState</a>
<a id="5159" href="Ledger.Epoch.html#5108" class="Function">applyRUpd</a> <a id="5169" href="Ledger.Rewards.html#5684" class="InductiveConstructor Operator">⟦</a> <a id="5171" href="Ledger.Epoch.html#5171" class="Bound">Δt</a> <a id="5174" href="Ledger.Rewards.html#5684" class="InductiveConstructor Operator">,</a> <a id="5176" href="Ledger.Epoch.html#5176" class="Bound">Δr</a> <a id="5179" href="Ledger.Rewards.html#5684" class="InductiveConstructor Operator">,</a> <a id="5181" href="Ledger.Epoch.html#5181" class="Bound">Δf</a> <a id="5184" href="Ledger.Rewards.html#5684" class="InductiveConstructor Operator">,</a> <a id="5186" href="Ledger.Epoch.html#5186" class="Bound">rs</a> <a id="5189" href="Ledger.Rewards.html#5684" class="InductiveConstructor Operator">⟧ʳᵘ</a>
  <a id="5195" href="Ledger.Epoch.html#1330" class="InductiveConstructor Operator">⟦</a> <a id="5197" href="Ledger.PParams.html#708" class="InductiveConstructor Operator">⟦</a> <a id="5199" href="Ledger.Epoch.html#5199" class="Bound">treasury</a> <a id="5208" href="Ledger.PParams.html#708" class="InductiveConstructor Operator">,</a> <a id="5210" href="Ledger.Epoch.html#5210" class="Bound">reserves</a> <a id="5219" href="Ledger.PParams.html#708" class="InductiveConstructor Operator">⟧ᵃ</a>
  <a id="5224" href="Ledger.Epoch.html#1330" class="InductiveConstructor Operator">,</a> <a id="5226" href="Ledger.Epoch.html#5226" class="Bound">ss</a>
  <a id="5231" href="Ledger.Epoch.html#1330" class="InductiveConstructor Operator">,</a> <a id="5233" href="Ledger.Ledger.html#845" class="InductiveConstructor Operator">⟦</a> <a id="5235" href="Ledger.Utxo.html#2744" class="InductiveConstructor Operator">⟦</a> <a id="5237" href="Ledger.Epoch.html#5237" class="Bound">utxo</a> <a id="5242" href="Ledger.Utxo.html#2744" class="InductiveConstructor Operator">,</a> <a id="5244" href="Ledger.Epoch.html#5244" class="Bound">fees</a> <a id="5249" href="Ledger.Utxo.html#2744" class="InductiveConstructor Operator">,</a> <a id="5251" href="Ledger.Epoch.html#5251" class="Bound">deposits</a> <a id="5260" href="Ledger.Utxo.html#2744" class="InductiveConstructor Operator">,</a> <a id="5262" href="Ledger.Epoch.html#5262" class="Bound">donations</a> <a id="5272" href="Ledger.Utxo.html#2744" class="InductiveConstructor Operator">⟧ᵘ</a>
    <a id="5279" href="Ledger.Ledger.html#845" class="InductiveConstructor Operator">,</a> <a id="5281" href="Ledger.Epoch.html#5281" class="Bound">govSt</a>
    <a id="5291" href="Ledger.Ledger.html#845" class="InductiveConstructor Operator">,</a> <a id="5293" href="Ledger.Certs.html#4366" class="InductiveConstructor Operator">⟦</a> <a id="5295" href="Ledger.Certs.html#3207" class="InductiveConstructor Operator">⟦</a> <a id="5297" href="Ledger.Epoch.html#5297" class="Bound">voteDelegs</a> <a id="5308" href="Ledger.Certs.html#3207" class="InductiveConstructor Operator">,</a> <a id="5310" href="Ledger.Epoch.html#5310" class="Bound">stakeDelegs</a> <a id="5322" href="Ledger.Certs.html#3207" class="InductiveConstructor Operator">,</a> <a id="5324" href="Ledger.Epoch.html#5324" class="Bound">rewards</a> <a id="5332" href="Ledger.Certs.html#3207" class="InductiveConstructor Operator">⟧ᵈ</a> <a id="5335" href="Ledger.Certs.html#4366" class="InductiveConstructor Operator">,</a> <a id="5337" href="Ledger.Epoch.html#5337" class="Bound">pState</a> <a id="5344" href="Ledger.Certs.html#4366" class="InductiveConstructor Operator">,</a> <a id="5346" href="Ledger.Epoch.html#5346" class="Bound">gState</a> <a id="5353" href="Ledger.Certs.html#4366" class="InductiveConstructor Operator">⟧ᶜˢ</a> <a id="5357" href="Ledger.Ledger.html#845" class="InductiveConstructor Operator">⟧ˡ</a>
  <a id="5362" href="Ledger.Epoch.html#1330" class="InductiveConstructor Operator">,</a> <a id="5364" href="Ledger.Epoch.html#5364" class="Bound">es</a>
  <a id="5369" href="Ledger.Epoch.html#1330" class="InductiveConstructor Operator">,</a> <a id="5371" href="Ledger.Epoch.html#5371" class="Bound">fut</a>
  <a id="5377" href="Ledger.Epoch.html#1330" class="InductiveConstructor Operator">⟧ᵉ&#39;</a> <a id="5381" class="Symbol">=</a>
  <a id="5385" href="Ledger.Prelude.html#2441" class="Function Operator">⟦</a> <a id="5387" href="Ledger.Prelude.html#2441" class="Function Operator">⟦</a> <a id="5389" href="Prelude.html#3167" class="Function">posPart</a> <a id="5397" class="Symbol">(</a><a id="5398" href="Ledger.Epoch.html#150" class="InductiveConstructor">pos</a> <a id="5402" href="Ledger.Epoch.html#5199" class="Bound">treasury</a> <a id="5411" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="5413" href="Ledger.Epoch.html#5171" class="Bound">Δt</a> <a id="5416" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="5418" href="Ledger.Epoch.html#150" class="InductiveConstructor">pos</a> <a id="5422" href="Ledger.Epoch.html#5726" class="Function">unregRU&#39;</a><a id="5430" class="Symbol">)</a>
    <a id="5436" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5438" href="Prelude.html#3167" class="Function">posPart</a> <a id="5446" class="Symbol">(</a><a id="5447" href="Ledger.Epoch.html#150" class="InductiveConstructor">pos</a> <a id="5451" href="Ledger.Epoch.html#5210" class="Bound">reserves</a> <a id="5460" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="5462" href="Ledger.Epoch.html#5176" class="Bound">Δr</a><a id="5464" class="Symbol">)</a> <a id="5466" href="Ledger.Prelude.html#2441" class="Function Operator">⟧</a>
  <a id="5470" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5472" href="Ledger.Epoch.html#5226" class="Bound">ss</a>
  <a id="5477" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5479" href="Ledger.Prelude.html#2441" class="Function Operator">⟦</a> <a id="5481" href="Ledger.Prelude.html#2441" class="Function Operator">⟦</a> <a id="5483" href="Ledger.Epoch.html#5237" class="Bound">utxo</a> <a id="5488" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5490" href="Prelude.html#3167" class="Function">posPart</a> <a id="5498" class="Symbol">(</a><a id="5499" href="Ledger.Epoch.html#150" class="InductiveConstructor">pos</a> <a id="5503" href="Ledger.Epoch.html#5244" class="Bound">fees</a> <a id="5508" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="5510" href="Ledger.Epoch.html#5181" class="Bound">Δf</a><a id="5512" class="Symbol">)</a> <a id="5514" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5516" href="Ledger.Epoch.html#5251" class="Bound">deposits</a> <a id="5525" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5527" href="Ledger.Epoch.html#5262" class="Bound">donations</a> <a id="5537" href="Ledger.Prelude.html#2441" class="Function Operator">⟧</a>
    <a id="5543" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5545" href="Ledger.Epoch.html#5281" class="Bound">govSt</a>
    <a id="5555" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5557" href="Ledger.Prelude.html#2441" class="Function Operator">⟦</a> <a id="5559" href="Ledger.Prelude.html#2441" class="Function Operator">⟦</a> <a id="5561" href="Ledger.Epoch.html#5297" class="Bound">voteDelegs</a> <a id="5572" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5574" href="Ledger.Epoch.html#5310" class="Bound">stakeDelegs</a> <a id="5586" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5588" href="Ledger.Epoch.html#5324" class="Bound">rewards</a> <a id="5596" href="Axiom.Set.Map.Dec.html#1854" class="Function Operator">∪⁺</a> <a id="5599" href="Ledger.Epoch.html#5658" class="Function">regRU</a> <a id="5605" href="Ledger.Prelude.html#2441" class="Function Operator">⟧</a> <a id="5607" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5609" href="Ledger.Epoch.html#5337" class="Bound">pState</a> <a id="5616" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5618" href="Ledger.Epoch.html#5346" class="Bound">gState</a> <a id="5625" href="Ledger.Prelude.html#2441" class="Function Operator">⟧</a> <a id="5627" href="Ledger.Prelude.html#2441" class="Function Operator">⟧</a>
  <a id="5631" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5633" href="Ledger.Epoch.html#5364" class="Bound">es</a>
  <a id="5638" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5640" href="Ledger.Epoch.html#5371" class="Bound">fut</a> <a id="5644" href="Ledger.Prelude.html#2441" class="Function Operator">⟧</a>
  <a id="5648" class="Keyword">where</a>
    <a id="5658" href="Ledger.Epoch.html#5658" class="Function">regRU</a>     <a id="5668" class="Symbol">=</a> <a id="5670" href="Ledger.Epoch.html#5186" class="Bound">rs</a> <a id="5673" href="Axiom.Set.Map.html#10678" class="Function Operator">∣</a> <a id="5675" href="Class.IsSet.html#916" class="Function">dom</a> <a id="5679" href="Ledger.Epoch.html#5324" class="Bound">rewards</a>
    <a id="5691" href="Ledger.Epoch.html#5691" class="Function">unregRU</a>   <a id="5701" class="Symbol">=</a> <a id="5703" href="Ledger.Epoch.html#5186" class="Bound">rs</a> <a id="5706" href="Axiom.Set.Map.html#10748" class="Function Operator">∣</a> <a id="5708" href="Class.IsSet.html#916" class="Function">dom</a> <a id="5712" href="Ledger.Epoch.html#5324" class="Bound">rewards</a> <a id="5720" href="Axiom.Set.Map.html#10748" class="Function Operator">ᶜ</a>
    <a id="5726" href="Ledger.Epoch.html#5726" class="Function">unregRU&#39;</a>  <a id="5736" class="Symbol">=</a> <a id="5738" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">∑[</a> <a id="5741" href="Ledger.Epoch.html#5741" class="Bound">x</a> <a id="5743" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">←</a> <a id="5745" href="Ledger.Epoch.html#5691" class="Function">unregRU</a> <a id="5753" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">]</a> <a id="5755" href="Ledger.Epoch.html#5741" class="Bound">x</a>

<a id="getOrphans"></a><a id="5758" href="Ledger.Epoch.html#5758" class="Function">getOrphans</a> <a id="5769" class="Symbol">:</a> <a id="5771" href="Ledger.Enact.html#397" class="Record">EnactState</a> <a id="5782" class="Symbol">→</a> <a id="5784" href="Ledger.Gov.html#1348" class="Function">GovState</a> <a id="5793" class="Symbol">→</a> <a id="5795" href="Ledger.Gov.html#1348" class="Function">GovState</a>
<a id="5804" href="Ledger.Epoch.html#5758" class="Function">getOrphans</a> <a id="5815" href="Ledger.Epoch.html#5815" class="Bound">es</a> <a id="5818" href="Ledger.Epoch.html#5818" class="Bound">govSt</a> <a id="5824" class="Symbol">=</a> <a id="5826" href="Data.Product.Base.html#636" class="Field">proj₁</a> <a id="5832" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="5834" href="Data.Nat.GeneralisedArithmetic.html#866" class="Function">iterate</a> <a id="5842" href="Ledger.Epoch.html#5887" class="Function">step</a> <a id="5847" class="Symbol">(</a><a id="5848" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a> <a id="5851" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5853" href="Ledger.Epoch.html#5818" class="Bound">govSt</a><a id="5858" class="Symbol">)</a> <a id="5860" class="Symbol">(</a><a id="5861" href="Data.List.Base.html#5044" class="Function">length</a> <a id="5868" href="Ledger.Epoch.html#5818" class="Bound">govSt</a><a id="5873" class="Symbol">)</a>
  <a id="5877" class="Keyword">where</a>
    <a id="5887" href="Ledger.Epoch.html#5887" class="Function">step</a> <a id="5892" class="Symbol">:</a> <a id="5894" href="Ledger.Gov.html#1348" class="Function">GovState</a> <a id="5903" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="5905" href="Ledger.Gov.html#1348" class="Function">GovState</a> <a id="5914" class="Symbol">→</a> <a id="5916" href="Ledger.Gov.html#1348" class="Function">GovState</a> <a id="5925" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="5927" href="Ledger.Gov.html#1348" class="Function">GovState</a>
    <a id="5940" href="Ledger.Epoch.html#5887" class="Function">step</a> <a id="5945" class="Symbol">(</a><a id="5946" href="Ledger.Epoch.html#5946" class="Bound">orps</a> <a id="5951" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5953" href="Ledger.Epoch.html#5953" class="Bound">govSt</a><a id="5958" class="Symbol">)</a> <a id="5960" class="Symbol">=</a>
      <a id="5968" class="Keyword">let</a>
        <a id="5980" href="Ledger.Epoch.html#5980" class="Bound">isOrphan?</a> <a id="5990" href="Ledger.Epoch.html#5990" class="Bound">a</a> <a id="5992" href="Ledger.Epoch.html#5992" class="Bound">prev</a> <a id="5997" class="Symbol">=</a> <a id="5999" href="Relation.Nullary.Decidable.Core.html#3011" class="Function">¬?</a> <a id="6002" class="Symbol">(</a><a id="6003" href="Ledger.Gov.html#8688" class="Function">hasParent?</a> <a id="6014" href="Ledger.Epoch.html#5815" class="Bound">es</a> <a id="6017" href="Ledger.Epoch.html#5953" class="Bound">govSt</a> <a id="6023" href="Ledger.Epoch.html#5990" class="Bound">a</a> <a id="6025" href="Ledger.Epoch.html#5992" class="Bound">prev</a><a id="6029" class="Symbol">)</a>
        <a id="6039" class="Symbol">(</a><a id="6040" href="Ledger.Epoch.html#6040" class="Bound">orps&#39;</a> <a id="6046" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="6048" href="Ledger.Epoch.html#6048" class="Bound">govSt&#39;</a><a id="6054" class="Symbol">)</a> <a id="6056" class="Symbol">=</a> <a id="6058" href="Data.List.Base.html#10926" class="Function">partition</a>
          <a id="6078" class="Symbol">(λ</a> <a id="6081" class="Symbol">(_</a> <a id="6084" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="6086" class="Keyword">record</a> <a id="6093" class="Symbol">{</a><a id="6094" href="Ledger.GovernanceActions.html#2867" class="Field">action</a> <a id="6101" class="Symbol">=</a> <a id="6103" href="Ledger.Epoch.html#6103" class="Bound">a</a> <a id="6105" class="Symbol">;</a> <a id="6107" href="Ledger.GovernanceActions.html#2895" class="Field">prevAction</a> <a id="6118" class="Symbol">=</a> <a id="6120" href="Ledger.Epoch.html#6120" class="Bound">prev</a><a id="6124" class="Symbol">})</a> <a id="6127" class="Symbol">→</a> <a id="6129" href="Ledger.Epoch.html#5980" class="Bound">isOrphan?</a> <a id="6139" class="Symbol">(</a><a id="6140" href="Ledger.Epoch.html#6103" class="Bound">a</a> <a id="6142" class="Symbol">.</a><a id="6143" href="Ledger.GovernanceActions.html#1433" class="Field">gaType</a><a id="6149" class="Symbol">)</a> <a id="6151" href="Ledger.Epoch.html#6120" class="Bound">prev</a><a id="6155" class="Symbol">)</a> <a id="6157" href="Ledger.Epoch.html#5953" class="Bound">govSt</a>
      <a id="6169" class="Keyword">in</a>
        <a id="6180" class="Symbol">(</a><a id="6181" href="Ledger.Epoch.html#5946" class="Bound">orps</a> <a id="6186" href="Data.List.Base.html#1734" class="Function Operator">++</a> <a id="6189" href="Ledger.Epoch.html#6040" class="Bound">orps&#39;</a> <a id="6195" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="6197" href="Ledger.Epoch.html#6048" class="Bound">govSt&#39;</a><a id="6203" class="Symbol">)</a>


<a id="6207" class="Keyword">open</a> <a id="6212" href="Ledger.Address.html#1337" class="Module">RwdAddr</a> <a id="6220" class="Keyword">using</a> <a id="6226" class="Symbol">(</a><a id="6227" href="Ledger.Address.html#1391" class="Field">stake</a><a id="6232" class="Symbol">)</a>


<a id="stakeDistr"></a><a id="6236" href="Ledger.Epoch.html#6236" class="Function">stakeDistr</a> <a id="6247" class="Symbol">:</a> <a id="6249" href="Ledger.Transaction.html#2361" class="Function">UTxO</a> <a id="6254" class="Symbol">→</a> <a id="6256" href="Ledger.Certs.html#3171" class="Record">DState</a> <a id="6263" class="Symbol">→</a> <a id="6265" href="Ledger.Certs.html#3781" class="Record">PState</a> <a id="6272" class="Symbol">→</a> <a id="6274" href="Ledger.Epoch.html#1035" class="Record">Snapshot</a>
<a id="6283" href="Ledger.Epoch.html#6236" class="Function">stakeDistr</a> <a id="6294" href="Ledger.Epoch.html#6294" class="Bound">utxo</a> <a id="6299" href="Ledger.Epoch.html#6299" class="Bound">stᵈ</a> <a id="6303" href="Ledger.Epoch.html#6303" class="Bound">pState</a> <a id="6310" class="Symbol">=</a>
    <a id="6316" href="Ledger.Prelude.html#2441" class="Function Operator">⟦</a> <a id="6318" href="Axiom.Set.Map.Dec.html#1932" class="Function">aggregate₊</a> <a id="6329" class="Symbol">(</a><a id="6330" href="Ledger.Epoch.html#6567" class="Function">stakeRelation</a> <a id="6344" href="abstract-set-theory.FiniteSetTheory.html#2767" class="Function Operator">ᶠˢ</a><a id="6346" class="Symbol">)</a> <a id="6348" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="6350" href="Ledger.Certs.html#3269" class="Function">stakeDelegs</a> <a id="6362" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="6364" href="Ledger.Epoch.html#6389" class="Function">poolParams</a> <a id="6375" href="Ledger.Prelude.html#2441" class="Function Operator">⟧</a>
  <a id="6379" class="Keyword">where</a>
    <a id="6389" href="Ledger.Epoch.html#6389" class="Function">poolParams</a> <a id="6400" class="Symbol">=</a> <a id="6402" href="Ledger.Epoch.html#6303" class="Bound">pState</a> <a id="6409" class="Symbol">.</a><a id="6410" href="Ledger.Certs.html#3813" class="Field">PState.pools</a>
    <a id="6427" class="Keyword">open</a> <a id="6432" href="Ledger.Certs.html#3171" class="Module">DState</a> <a id="6439" href="Ledger.Epoch.html#6299" class="Bound">stᵈ</a> <a id="6443" class="Keyword">using</a> <a id="6449" class="Symbol">(</a><a id="6450" href="Ledger.Certs.html#3269" class="Field">stakeDelegs</a><a id="6461" class="Symbol">;</a> <a id="6463" href="Ledger.Certs.html#3309" class="Field">rewards</a><a id="6470" class="Symbol">)</a>
    <a id="6476" href="Ledger.Epoch.html#6476" class="Function">m</a> <a id="6478" class="Symbol">=</a> <a id="6480" href="abstract-set-theory.FiniteSetTheory.html#519" class="Function">mapˢ</a> <a id="6485" class="Symbol">(λ</a> <a id="6488" href="Ledger.Epoch.html#6488" class="Bound">a</a> <a id="6490" class="Symbol">→</a> <a id="6492" class="Symbol">(</a><a id="6493" href="Ledger.Epoch.html#6488" class="Bound">a</a> <a id="6495" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="6497" href="Ledger.Utxo.html#3643" class="Function">cbalance</a> <a id="6506" class="Symbol">(</a><a id="6507" href="Ledger.Epoch.html#6294" class="Bound">utxo</a> <a id="6512" href="abstract-set-theory.FiniteSetTheory.html#3088" class="Function Operator">∣^&#39;</a> <a id="6516" class="Symbol">λ</a> <a id="6518" href="Ledger.Epoch.html#6518" class="Bound">i</a> <a id="6520" class="Symbol">→</a> <a id="6522" href="Ledger.Epoch.html#3974" class="Function">getStakeCred</a> <a id="6535" href="Ledger.Epoch.html#6518" class="Bound">i</a> <a id="6537" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="6539" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="6544" href="Ledger.Epoch.html#6488" class="Bound">a</a><a id="6545" class="Symbol">)))</a> <a id="6549" class="Symbol">(</a><a id="6550" href="Class.IsSet.html#916" class="Function">dom</a> <a id="6554" href="Ledger.Certs.html#3309" class="Function">rewards</a><a id="6561" class="Symbol">)</a>
    <a id="6567" href="Ledger.Epoch.html#6567" class="Function">stakeRelation</a> <a id="6581" class="Symbol">=</a> <a id="6583" href="Ledger.Epoch.html#6476" class="Function">m</a> <a id="6585" href="Axiom.Set.html#8952" class="Function Operator">∪</a> <a id="6587" href="Ledger.Prelude.html#2543" class="Function Operator">∣</a> <a id="6589" href="Ledger.Certs.html#3309" class="Function">rewards</a> <a id="6597" href="Ledger.Prelude.html#2543" class="Function Operator">∣</a>

<a id="gaDepositStake"></a><a id="6600" href="Ledger.Epoch.html#6600" class="Function">gaDepositStake</a> <a id="6615" class="Symbol">:</a> <a id="6617" href="Ledger.Gov.html#1348" class="Function">GovState</a> <a id="6626" class="Symbol">→</a> <a id="6628" href="Ledger.Certs.html#573" class="Function">Deposits</a> <a id="6637" class="Symbol">→</a> <a id="6639" href="Ledger.Address.html#273" class="Datatype">Credential</a> <a id="6650" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="6652" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a>
<a id="6657" href="Ledger.Epoch.html#6600" class="Function">gaDepositStake</a> <a id="6672" href="Ledger.Epoch.html#6672" class="Bound">govSt</a> <a id="6678" href="Ledger.Epoch.html#6678" class="Bound">ds</a> <a id="6681" class="Symbol">=</a> <a id="6683" href="abstract-set-theory.FiniteSetTheory.html#3599" class="Function">aggregateBy</a>
  <a id="6697" class="Symbol">(</a><a id="6698" href="abstract-set-theory.FiniteSetTheory.html#519" class="Function">mapˢ</a> <a id="6703" class="Symbol">(λ</a> <a id="6706" class="Symbol">(</a><a id="6707" href="Ledger.Epoch.html#6707" class="Bound">gaid</a> <a id="6712" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="6714" href="Ledger.Epoch.html#6714" class="Bound">addr</a><a id="6718" class="Symbol">)</a> <a id="6720" class="Symbol">→</a> <a id="6722" class="Symbol">(</a><a id="6723" href="Ledger.Epoch.html#6707" class="Bound">gaid</a> <a id="6728" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="6730" href="Ledger.Epoch.html#6714" class="Bound">addr</a><a id="6734" class="Symbol">)</a> <a id="6736" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="6738" href="Ledger.Address.html#1391" class="Field">stake</a> <a id="6744" href="Ledger.Epoch.html#6714" class="Bound">addr</a><a id="6748" class="Symbol">)</a> <a id="6750" href="Ledger.Epoch.html#6848" class="Function">govSt&#39;</a><a id="6756" class="Symbol">)</a>
  <a id="6760" class="Symbol">(</a><a id="6761" href="Axiom.Set.Map.html#10460" class="Function">mapFromPartialFun</a> <a id="6779" class="Symbol">(λ</a> <a id="6782" class="Symbol">(</a><a id="6783" href="Ledger.Epoch.html#6783" class="Bound">gaid</a> <a id="6788" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="6790" class="Symbol">_)</a> <a id="6793" class="Symbol">→</a> <a id="6795" href="Axiom.Set.Map.html#13670" class="Function">lookupᵐ?</a> <a id="6804" href="Ledger.Epoch.html#6678" class="Bound">ds</a> <a id="6807" class="Symbol">(</a><a id="6808" href="Ledger.Certs.html#521" class="InductiveConstructor">GovActionDeposit</a> <a id="6825" href="Ledger.Epoch.html#6783" class="Bound">gaid</a><a id="6829" class="Symbol">))</a> <a id="6832" href="Ledger.Epoch.html#6848" class="Function">govSt&#39;</a><a id="6838" class="Symbol">)</a>
  <a id="6842" class="Keyword">where</a> <a id="6848" href="Ledger.Epoch.html#6848" class="Function">govSt&#39;</a> <a id="6855" class="Symbol">=</a> <a id="6857" href="abstract-set-theory.FiniteSetTheory.html#519" class="Function">mapˢ</a> <a id="6862" class="Symbol">(</a><a id="6863" href="Class.Bifunctor.html#1152" class="Function">map₂</a> <a id="6868" href="Ledger.GovernanceActions.html#2817" class="Field">returnAddr</a><a id="6878" class="Symbol">)</a> <a id="6880" class="Symbol">(</a><a id="6881" href="Axiom.Set.html#5718" class="Function">fromList</a> <a id="6890" href="Ledger.Epoch.html#6672" class="Bound">govSt</a><a id="6895" class="Symbol">)</a>



<a id="6900" class="Keyword">opaque</a>


  <a id="mkStakeDistrs"></a><a id="6911" href="Ledger.Epoch.html#6911" class="Function">mkStakeDistrs</a> <a id="6925" class="Symbol">:</a> <a id="6927" href="Ledger.Epoch.html#1035" class="Record">Snapshot</a> <a id="6936" class="Symbol">→</a> <a id="6938" href="Ledger.Gov.html#1348" class="Function">GovState</a> <a id="6947" class="Symbol">→</a> <a id="6949" href="Ledger.Certs.html#573" class="Function">Deposits</a> <a id="6958" class="Symbol">→</a> <a id="6960" class="Symbol">(</a><a id="6961" href="Ledger.Address.html#273" class="Datatype">Credential</a> <a id="6972" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="6974" href="Ledger.GovernanceActions.html#458" class="Datatype">VDeleg</a><a id="6980" class="Symbol">)</a> <a id="6982" class="Symbol">→</a> <a id="6984" href="Ledger.Ratify.html#2914" class="Record">StakeDistrs</a>
  <a id="6998" href="Ledger.Epoch.html#6911" class="Function">mkStakeDistrs</a> <a id="7012" href="Ledger.Epoch.html#7012" class="Bound">ss</a> <a id="7015" href="Ledger.Epoch.html#7015" class="Bound">govSt</a> <a id="7021" href="Ledger.Epoch.html#7021" class="Bound">ds</a> <a id="7024" href="Ledger.Epoch.html#7024" class="Bound">delegations</a> <a id="7036" class="Symbol">.</a><a id="7037" href="Ledger.Ratify.html#2951" class="Field">StakeDistrs.stakeDistr</a> <a id="7060" class="Symbol">=</a>
    <a id="7066" href="abstract-set-theory.FiniteSetTheory.html#3599" class="Function">aggregateBy</a> <a id="7078" href="Ledger.Prelude.html#2543" class="Function Operator">∣</a> <a id="7080" href="Ledger.Epoch.html#7024" class="Bound">delegations</a> <a id="7092" href="Ledger.Prelude.html#2543" class="Function Operator">∣</a> <a id="7094" class="Symbol">(</a><a id="7095" href="Ledger.Epoch.html#1068" class="Field">Snapshot.stake</a> <a id="7110" href="Ledger.Epoch.html#7012" class="Bound">ss</a> <a id="7113" href="Axiom.Set.Map.Dec.html#1854" class="Function Operator">∪⁺</a> <a id="7116" href="Ledger.Epoch.html#6600" class="Function">gaDepositStake</a> <a id="7131" href="Ledger.Epoch.html#7015" class="Bound">govSt</a> <a id="7137" href="Ledger.Epoch.html#7021" class="Bound">ds</a><a id="7139" class="Symbol">)</a>


<a id="7143" class="Keyword">private</a> <a id="7151" class="Keyword">variable</a>
  <a id="7162" href="Ledger.Epoch.html#7162" class="Generalizable">nes</a> <a id="7166" href="Ledger.Epoch.html#7166" class="Generalizable">nes&#39;</a> <a id="7171" class="Symbol">:</a> <a id="7173" href="Ledger.Epoch.html#2070" class="Record">NewEpochState</a>
  <a id="7189" href="Ledger.Epoch.html#7189" class="Generalizable">e</a> <a id="7191" href="Ledger.Epoch.html#7191" class="Generalizable">lastEpoch</a> <a id="7201" class="Symbol">:</a> <a id="7203" href="Ledger.Types.Epoch.html#543" class="Function">Epoch</a>
  <a id="7211" href="Ledger.Epoch.html#7211" class="Generalizable">fut</a> <a id="7215" href="Ledger.Epoch.html#7215" class="Generalizable">fut&#39;</a> <a id="7220" class="Symbol">:</a> <a id="7222" href="Ledger.Ratify.html#3279" class="Record">RatifyState</a>
  <a id="7236" href="Ledger.Epoch.html#7236" class="Generalizable">eps</a> <a id="7240" href="Ledger.Epoch.html#7240" class="Generalizable">eps&#39;</a> <a id="7245" href="Ledger.Epoch.html#7245" class="Generalizable">eps&#39;&#39;</a> <a id="7251" class="Symbol">:</a> <a id="7253" href="Ledger.Epoch.html#1290" class="Record">EpochState</a>
  <a id="7266" href="Ledger.Epoch.html#7266" class="Generalizable">ls</a> <a id="7269" class="Symbol">:</a> <a id="7271" href="Ledger.Ledger.html#809" class="Record">LState</a>
  <a id="7280" href="Ledger.Epoch.html#7280" class="Generalizable">acnt</a> <a id="7285" class="Symbol">:</a> <a id="7287" href="Ledger.PParams.html#674" class="Record">Acnt</a>
  <a id="7294" href="Ledger.Epoch.html#7294" class="Generalizable">es₀</a> <a id="7298" class="Symbol">:</a> <a id="7300" href="Ledger.Enact.html#397" class="Record">EnactState</a>
  <a id="7313" href="Ledger.Epoch.html#7313" class="Generalizable">mark</a> <a id="7318" href="Ledger.Epoch.html#7318" class="Generalizable">set</a> <a id="7322" href="Ledger.Epoch.html#7322" class="Generalizable">go</a> <a id="7325" class="Symbol">:</a> <a id="7327" href="Ledger.Epoch.html#1035" class="Record">Snapshot</a>
  <a id="7338" href="Ledger.Epoch.html#7338" class="Generalizable">feeSS</a> <a id="7344" class="Symbol">:</a> <a id="7346" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a>
  <a id="7353" href="Ledger.Epoch.html#7353" class="Generalizable">lstate</a> <a id="7360" class="Symbol">:</a> <a id="7362" href="Ledger.Ledger.html#809" class="Record">LState</a>
  <a id="7371" href="Ledger.Epoch.html#7371" class="Generalizable">ss</a> <a id="7374" href="Ledger.Epoch.html#7374" class="Generalizable">ss&#39;</a> <a id="7378" class="Symbol">:</a> <a id="7380" href="Ledger.Epoch.html#1198" class="Record">Snapshots</a>
  <a id="7392" href="Ledger.Epoch.html#7392" class="Generalizable">ru</a> <a id="7395" class="Symbol">:</a> <a id="7397" href="Ledger.Rewards.html#5643" class="Record">RewardUpdate</a>
  <a id="7412" href="Ledger.Epoch.html#7412" class="Generalizable">mru</a> <a id="7416" class="Symbol">:</a> <a id="7418" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="7424" href="Ledger.Rewards.html#5643" class="Record">RewardUpdate</a>


<a id="7439" class="Keyword">data</a> <a id="_⊢_⇀⦇_,SNAP⦈_"></a><a id="7444" href="Ledger.Epoch.html#7444" class="Datatype Operator">_⊢_⇀⦇_,SNAP⦈_</a> <a id="7458" class="Symbol">:</a> <a id="7460" href="Ledger.Ledger.html#809" class="Record">LState</a> <a id="7467" class="Symbol">→</a> <a id="7469" href="Ledger.Epoch.html#1198" class="Record">Snapshots</a> <a id="7479" class="Symbol">→</a> <a id="7481" href="Agda.Builtin.Unit.html#175" class="Record">⊤</a> <a id="7483" class="Symbol">→</a> <a id="7485" href="Ledger.Epoch.html#1198" class="Record">Snapshots</a> <a id="7495" class="Symbol">→</a> <a id="7497" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="7502" class="Keyword">where</a>
  <a id="_⊢_⇀⦇_,SNAP⦈_.SNAP"></a><a id="7510" href="Ledger.Epoch.html#7510" class="InductiveConstructor">SNAP</a> <a id="7515" class="Symbol">:</a> <a id="7517" class="Keyword">let</a> <a id="7521" class="Keyword">open</a> <a id="7526" href="Ledger.Ledger.html#809" class="Module">LState</a> <a id="7533" href="Ledger.Epoch.html#7353" class="Generalizable">lstate</a><a id="7539" class="Symbol">;</a> <a id="7541" class="Keyword">open</a> <a id="7546" href="Ledger.Utxo.html#2705" class="Module">UTxOState</a> <a id="7556" href="Ledger.Ledger.html#868" class="Function">utxoSt</a><a id="7562" class="Symbol">;</a> <a id="7564" class="Keyword">open</a> <a id="7569" href="Ledger.Certs.html#4327" class="Module">CertState</a> <a id="7579" href="Ledger.Ledger.html#921" class="Function">certState</a>
             <a id="7602" href="Ledger.Epoch.html#7602" class="Bound">stake</a> <a id="7608" class="Symbol">=</a> <a id="7610" href="Ledger.Epoch.html#6236" class="Function">stakeDistr</a> <a id="7621" href="Ledger.Utxo.html#2769" class="Function">utxo</a> <a id="7626" href="Ledger.Certs.html#4390" class="Function">dState</a> <a id="7633" href="Ledger.Certs.html#4410" class="Function">pState</a>
    <a id="7644" class="Keyword">in</a>
    <a id="7651" href="Ledger.Epoch.html#7353" class="Generalizable">lstate</a> <a id="7658" href="Ledger.Epoch.html#7444" class="Datatype Operator">⊢</a> <a id="7660" href="Ledger.Prelude.html#2441" class="Function Operator">⟦</a> <a id="7662" href="Ledger.Epoch.html#7313" class="Generalizable">mark</a> <a id="7667" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="7669" href="Ledger.Epoch.html#7318" class="Generalizable">set</a> <a id="7673" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="7675" href="Ledger.Epoch.html#7322" class="Generalizable">go</a> <a id="7678" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="7680" href="Ledger.Epoch.html#7338" class="Generalizable">feeSS</a> <a id="7686" href="Ledger.Prelude.html#2441" class="Function Operator">⟧</a> <a id="7688" href="Ledger.Epoch.html#7444" class="Datatype Operator">⇀⦇</a> <a id="7691" href="Agda.Builtin.Unit.html#212" class="InductiveConstructor">tt</a> <a id="7694" href="Ledger.Epoch.html#7444" class="Datatype Operator">,SNAP⦈</a> <a id="7701" href="Ledger.Prelude.html#2441" class="Function Operator">⟦</a> <a id="7703" href="Ledger.Epoch.html#7602" class="Bound">stake</a> <a id="7709" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="7711" href="Ledger.Epoch.html#7313" class="Generalizable">mark</a> <a id="7716" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="7718" href="Ledger.Epoch.html#7318" class="Generalizable">set</a> <a id="7722" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="7724" href="Ledger.Utxo.html#2791" class="Function">fees</a> <a id="7729" href="Ledger.Prelude.html#2441" class="Function Operator">⟧</a>

<a id="7732" class="Keyword">data</a> <a id="_⊢_⇀⦇_,EPOCH⦈_"></a><a id="7737" href="Ledger.Epoch.html#7737" class="Datatype Operator">_⊢_⇀⦇_,EPOCH⦈_</a> <a id="7752" class="Symbol">:</a> <a id="7754" href="Agda.Builtin.Unit.html#175" class="Record">⊤</a> <a id="7756" class="Symbol">→</a> <a id="7758" href="Ledger.Epoch.html#1290" class="Record">EpochState</a> <a id="7769" class="Symbol">→</a> <a id="7771" href="Ledger.Types.Epoch.html#543" class="Function">Epoch</a> <a id="7777" class="Symbol">→</a> <a id="7779" href="Ledger.Epoch.html#1290" class="Record">EpochState</a> <a id="7790" class="Symbol">→</a> <a id="7792" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="7797" class="Keyword">where</a>


  <a id="_⊢_⇀⦇_,EPOCH⦈_.EPOCH"></a><a id="7807" href="Ledger.Epoch.html#7807" class="InductiveConstructor">EPOCH</a> <a id="7813" class="Symbol">:</a> <a id="7815" class="Keyword">let</a>


      <a id="7827" class="Keyword">open</a> <a id="7832" href="Ledger.Ledger.html#809" class="Module">LState</a> <a id="7839" href="Ledger.Epoch.html#7266" class="Generalizable">ls</a>
      <a id="7848" class="Keyword">open</a> <a id="7853" href="Ledger.Certs.html#4327" class="Module">CertState</a> <a id="7863" href="Ledger.Ledger.html#921" class="Function">certState</a>
      <a id="7879" class="Keyword">open</a> <a id="7884" href="Ledger.Ratify.html#3279" class="Module">RatifyState</a> <a id="7896" href="Ledger.Epoch.html#7211" class="Generalizable">fut</a> <a id="7900" class="Keyword">hiding</a> <a id="7907" class="Symbol">(</a><a id="7908" href="Ledger.Ratify.html#3316" class="Field">es</a><a id="7910" class="Symbol">)</a>
      <a id="7918" class="Keyword">open</a> <a id="7923" href="Ledger.Utxo.html#2705" class="Module">UTxOState</a>
      <a id="7939" class="Keyword">open</a> <a id="7944" href="Ledger.Certs.html#3781" class="Module">PState</a><a id="7950" class="Symbol">;</a> <a id="7952" class="Keyword">open</a> <a id="7957" href="Ledger.Certs.html#3171" class="Module">DState</a><a id="7963" class="Symbol">;</a> <a id="7965" class="Keyword">open</a> <a id="7970" href="Ledger.Certs.html#3997" class="Module">GState</a>
      <a id="7983" class="Keyword">open</a> <a id="7988" href="Ledger.PParams.html#674" class="Module">Acnt</a><a id="7992" class="Symbol">;</a> <a id="7994" class="Keyword">open</a> <a id="7999" href="Ledger.Enact.html#397" class="Module">EnactState</a><a id="8009" class="Symbol">;</a> <a id="8011" class="Keyword">open</a> <a id="8016" href="Ledger.GovernanceActions.html#2746" class="Module">GovActionState</a>


      <a id="8039" href="Ledger.Epoch.html#8039" class="Bound">esW</a>               <a id="8057" class="Symbol">=</a> <a id="8059" href="Ledger.Ratify.html#3316" class="Field">RatifyState.es</a> <a id="8074" href="Ledger.Epoch.html#7211" class="Generalizable">fut</a>
      <a id="8084" href="Ledger.Epoch.html#8084" class="Bound">es</a>                <a id="8102" class="Symbol">=</a> <a id="8104" class="Keyword">record</a> <a id="8111" href="Ledger.Epoch.html#8039" class="Bound">esW</a> <a id="8115" class="Symbol">{</a> <a id="8117" href="Ledger.Enact.html#649" class="Field">withdrawals</a> <a id="8129" class="Symbol">=</a> <a id="8131" href="Class.HasEmptySet.html#287" class="Field">∅</a> <a id="8133" class="Symbol">}</a>
      <a id="8141" href="Ledger.Epoch.html#8141" class="Bound">tmpGovSt</a>          <a id="8159" class="Symbol">=</a> <a id="8161" href="Ledger.Prelude.html#2692" class="Function">filter</a> <a id="8168" class="Symbol">(λ</a> <a id="8171" href="Ledger.Epoch.html#8171" class="Bound">x</a> <a id="8173" class="Symbol">→</a> <a id="8175" href="Data.Product.Base.html#636" class="Field">proj₁</a> <a id="8181" href="Ledger.Epoch.html#8171" class="Bound">x</a> <a id="8183" href="Class.IsSet.html#462" class="Function Operator">∉</a> <a id="8185" href="abstract-set-theory.FiniteSetTheory.html#519" class="Function">mapˢ</a> <a id="8190" href="Data.Product.Base.html#636" class="Field">proj₁</a> <a id="8196" href="Ledger.Ratify.html#3349" class="Function">removed</a><a id="8203" class="Symbol">)</a> <a id="8205" href="Ledger.Ledger.html#895" class="Function">govSt</a>
      <a id="8217" href="Ledger.Epoch.html#8217" class="Bound">orphans</a>           <a id="8235" class="Symbol">=</a> <a id="8237" href="Axiom.Set.html#5718" class="Function">fromList</a> <a id="8246" class="Symbol">(</a><a id="8247" href="Ledger.Epoch.html#5758" class="Function">getOrphans</a> <a id="8258" href="Ledger.Epoch.html#8084" class="Bound">es</a> <a id="8261" href="Ledger.Epoch.html#8141" class="Bound">tmpGovSt</a><a id="8269" class="Symbol">)</a>
      <a id="8277" href="Ledger.Epoch.html#8277" class="Bound">removed&#39;</a>          <a id="8295" class="Symbol">=</a> <a id="8297" href="Ledger.Ratify.html#3349" class="Function">removed</a> <a id="8305" href="Axiom.Set.html#8952" class="Function Operator">∪</a> <a id="8307" href="Ledger.Epoch.html#8217" class="Bound">orphans</a>
      <a id="8321" href="Ledger.Epoch.html#8321" class="Bound">removedGovActions</a> <a id="8339" class="Symbol">=</a> <a id="8341" href="Function.Base.html#1638" class="Function">flip</a> <a id="8346" href="Axiom.Set.html#7022" class="Function">concatMapˢ</a> <a id="8357" href="Ledger.Epoch.html#8277" class="Bound">removed&#39;</a> <a id="8366" class="Symbol">λ</a> <a id="8368" class="Symbol">(</a><a id="8369" href="Ledger.Epoch.html#8369" class="Bound">gaid</a> <a id="8374" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="8376" href="Ledger.Epoch.html#8376" class="Bound">gaSt</a><a id="8380" class="Symbol">)</a> <a id="8382" class="Symbol">→</a>
        <a id="8392" href="abstract-set-theory.FiniteSetTheory.html#519" class="Function">mapˢ</a> <a id="8397" class="Symbol">(</a><a id="8398" href="Ledger.GovernanceActions.html#2817" class="Field">returnAddr</a> <a id="8409" href="Ledger.Epoch.html#8376" class="Bound">gaSt</a> <a id="8414" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,_</a><a id="8416" class="Symbol">)</a> <a id="8418" class="Symbol">((</a><a id="8420" href="Ledger.Ledger.html#868" class="Function">utxoSt</a> <a id="8427" class="Symbol">.</a><a id="8428" href="Ledger.Utxo.html#2813" class="Field">deposits</a> <a id="8437" href="Axiom.Set.Map.html#10678" class="Function Operator">∣</a> <a id="8439" href="Class.HasSingleton.html#288" class="Field Operator">❴</a> <a id="8441" href="Ledger.Certs.html#521" class="InductiveConstructor">GovActionDeposit</a> <a id="8458" href="Ledger.Epoch.html#8369" class="Bound">gaid</a> <a id="8463" href="Class.HasSingleton.html#288" class="Field Operator">❵</a><a id="8464" class="Symbol">)</a> <a id="8466" href="Axiom.Set.Map.html#2293" class="Function Operator">ˢ</a><a id="8467" class="Symbol">)</a>
      <a id="8475" href="Ledger.Epoch.html#8475" class="Bound">govActionReturns</a> <a id="8492" class="Symbol">=</a> <a id="8494" href="Axiom.Set.Map.Dec.html#1932" class="Function">aggregate₊</a> <a id="8505" class="Symbol">(</a><a id="8506" href="abstract-set-theory.FiniteSetTheory.html#519" class="Function">mapˢ</a> <a id="8511" class="Symbol">(λ</a> <a id="8514" class="Symbol">(</a><a id="8515" href="Ledger.Epoch.html#8515" class="Bound">a</a> <a id="8517" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="8519" class="Symbol">_</a> <a id="8521" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="8523" href="Ledger.Epoch.html#8523" class="Bound">d</a><a id="8524" class="Symbol">)</a> <a id="8526" class="Symbol">→</a> <a id="8528" href="Ledger.Epoch.html#8515" class="Bound">a</a> <a id="8530" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="8532" href="Ledger.Epoch.html#8523" class="Bound">d</a><a id="8533" class="Symbol">)</a> <a id="8535" href="Ledger.Epoch.html#8321" class="Bound">removedGovActions</a> <a id="8553" href="abstract-set-theory.FiniteSetTheory.html#2767" class="Function Operator">ᶠˢ</a><a id="8555" class="Symbol">)</a>

      <a id="8564" href="Ledger.Epoch.html#8564" class="Bound">trWithdrawals</a>   <a id="8580" class="Symbol">=</a> <a id="8582" href="Ledger.Epoch.html#8039" class="Bound">esW</a> <a id="8586" class="Symbol">.</a><a id="8587" href="Ledger.Enact.html#649" class="Field">withdrawals</a>
      <a id="8605" href="Ledger.Epoch.html#8605" class="Bound">totWithdrawals</a>  <a id="8621" class="Symbol">=</a> <a id="8623" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">∑[</a> <a id="8626" href="Ledger.Epoch.html#8626" class="Bound">x</a> <a id="8628" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">←</a> <a id="8630" href="Ledger.Epoch.html#8564" class="Bound">trWithdrawals</a> <a id="8644" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">]</a> <a id="8646" href="Ledger.Epoch.html#8626" class="Bound">x</a>

      <a id="8655" href="Ledger.Epoch.html#8655" class="Bound">retired</a>    <a id="8666" class="Symbol">=</a> <a id="8668" class="Symbol">(</a><a id="8669" href="Ledger.Certs.html#4410" class="Function">pState</a> <a id="8676" class="Symbol">.</a><a id="8677" href="Ledger.Certs.html#3850" class="Field">retiring</a><a id="8685" class="Symbol">)</a> <a id="8687" href="Axiom.Set.Map.html#14230" class="Function Operator">⁻¹</a> <a id="8690" href="Ledger.Epoch.html#7189" class="Generalizable">e</a>
      <a id="8698" href="Ledger.Epoch.html#8698" class="Bound">payout</a>     <a id="8709" class="Symbol">=</a> <a id="8711" href="Ledger.Epoch.html#8475" class="Bound">govActionReturns</a> <a id="8728" href="Axiom.Set.Map.Dec.html#1854" class="Function Operator">∪⁺</a> <a id="8731" href="Ledger.Epoch.html#8564" class="Bound">trWithdrawals</a>
      <a id="8751" href="Ledger.Epoch.html#8751" class="Bound">refunds</a>    <a id="8762" class="Symbol">=</a> <a id="8764" href="Axiom.Set.Map.html#13791" class="Function">pullbackMap</a> <a id="8776" href="Ledger.Epoch.html#8698" class="Bound">payout</a> <a id="8783" href="Ledger.Epoch.html#3887" class="Function">toRwdAddr</a> <a id="8793" class="Symbol">(</a><a id="8794" href="Class.IsSet.html#916" class="Function">dom</a> <a id="8798" class="Symbol">(</a><a id="8799" href="Ledger.Certs.html#4390" class="Function">dState</a> <a id="8806" class="Symbol">.</a><a id="8807" href="Ledger.Certs.html#3309" class="Field">rewards</a><a id="8814" class="Symbol">))</a>
      <a id="8823" href="Ledger.Epoch.html#8823" class="Bound">unclaimed</a>  <a id="8834" class="Symbol">=</a> <a id="8836" href="Ledger.Interface.HasCoin.html#172" class="Field">getCoin</a> <a id="8844" href="Ledger.Epoch.html#8698" class="Bound">payout</a> <a id="8851" href="Interface.HasSubtract.html#209" class="Field Operator">-</a> <a id="8853" href="Ledger.Interface.HasCoin.html#172" class="Field">getCoin</a> <a id="8861" href="Ledger.Epoch.html#8751" class="Bound">refunds</a>

      <a id="8876" href="Ledger.Epoch.html#8876" class="Bound">govSt&#39;</a> <a id="8883" class="Symbol">=</a> <a id="8885" href="Ledger.Prelude.html#2692" class="Function">filter</a> <a id="8892" class="Symbol">(λ</a> <a id="8895" href="Ledger.Epoch.html#8895" class="Bound">x</a> <a id="8897" class="Symbol">→</a> <a id="8899" href="Data.Product.Base.html#636" class="Field">proj₁</a> <a id="8905" href="Ledger.Epoch.html#8895" class="Bound">x</a> <a id="8907" href="Class.IsSet.html#462" class="Function Operator">∉</a> <a id="8909" href="abstract-set-theory.FiniteSetTheory.html#519" class="Function">mapˢ</a> <a id="8914" href="Data.Product.Base.html#636" class="Field">proj₁</a> <a id="8920" href="Ledger.Epoch.html#8277" class="Bound">removed&#39;</a><a id="8928" class="Symbol">)</a> <a id="8930" href="Ledger.Ledger.html#895" class="Function">govSt</a>

      <a id="8943" href="Ledger.Epoch.html#8943" class="Bound">dState&#39;</a> <a id="8951" class="Symbol">=</a> <a id="8953" href="Ledger.Prelude.html#2441" class="Function Operator">⟦</a> <a id="8955" href="Ledger.Certs.html#4390" class="Function">dState</a> <a id="8962" class="Symbol">.</a><a id="8963" href="Ledger.Certs.html#3230" class="Field">voteDelegs</a> <a id="8974" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="8976" href="Ledger.Certs.html#4390" class="Function">dState</a> <a id="8983" class="Symbol">.</a><a id="8984" href="Ledger.Certs.html#3269" class="Field">stakeDelegs</a> <a id="8996" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a>  <a id="8999" href="Ledger.Certs.html#4390" class="Function">dState</a> <a id="9006" class="Symbol">.</a><a id="9007" href="Ledger.Certs.html#3309" class="Field">rewards</a> <a id="9015" href="Axiom.Set.Map.Dec.html#1854" class="Function Operator">∪⁺</a> <a id="9018" href="Ledger.Epoch.html#8751" class="Bound">refunds</a> <a id="9026" href="Ledger.Prelude.html#2441" class="Function Operator">⟧</a>

      <a id="9035" href="Ledger.Epoch.html#9035" class="Bound">pState&#39;</a> <a id="9043" class="Symbol">=</a> <a id="9045" href="Ledger.Prelude.html#2441" class="Function Operator">⟦</a> <a id="9047" href="Ledger.Certs.html#4410" class="Function">pState</a> <a id="9054" class="Symbol">.</a><a id="9055" href="Ledger.Certs.html#3813" class="Field">pools</a> <a id="9061" href="Axiom.Set.Map.html#10748" class="Function Operator">∣</a> <a id="9063" href="Ledger.Epoch.html#8655" class="Bound">retired</a> <a id="9071" href="Axiom.Set.Map.html#10748" class="Function Operator">ᶜ</a> <a id="9073" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="9075" href="Ledger.Certs.html#4410" class="Function">pState</a> <a id="9082" class="Symbol">.</a><a id="9083" href="Ledger.Certs.html#3850" class="Field">retiring</a> <a id="9092" href="Axiom.Set.Map.html#10748" class="Function Operator">∣</a> <a id="9094" href="Ledger.Epoch.html#8655" class="Bound">retired</a> <a id="9102" href="Axiom.Set.Map.html#10748" class="Function Operator">ᶜ</a> <a id="9104" href="Ledger.Prelude.html#2441" class="Function Operator">⟧</a>

      <a id="9113" href="Ledger.Epoch.html#9113" class="Bound">gState&#39;</a> <a id="9121" class="Symbol">=</a> <a id="9123" href="Ledger.Prelude.html#2441" class="Function Operator">⟦</a> <a id="9125" class="Symbol">(</a><a id="9126" href="Class.ToBool.html#389" class="Function Operator">if</a> <a id="9129" href="Data.List.Base.html#4703" class="Function">null</a> <a id="9134" href="Ledger.Epoch.html#8876" class="Bound">govSt&#39;</a> <a id="9141" href="Class.ToBool.html#389" class="Function Operator">then</a> <a id="9146" href="Axiom.Set.Map.html#6068" class="Function">mapValues</a> <a id="9156" class="Symbol">(</a><a id="9157" class="Number">1</a> <a id="9159" href="Class.HasAdd.Core.html#162" class="Field Operator">+_</a><a id="9161" class="Symbol">)</a> <a id="9163" class="Symbol">(</a><a id="9164" href="Ledger.Certs.html#4430" class="Function">gState</a> <a id="9171" class="Symbol">.</a><a id="9172" href="Ledger.Certs.html#4054" class="Field">dreps</a><a id="9177" class="Symbol">)</a> <a id="9179" href="Class.ToBool.html#389" class="Function Operator">else</a> <a id="9184" class="Symbol">(</a><a id="9185" href="Ledger.Certs.html#4430" class="Function">gState</a> <a id="9192" class="Symbol">.</a><a id="9193" href="Ledger.Certs.html#4054" class="Field">dreps</a><a id="9198" class="Symbol">))</a>
                <a id="9217" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="9219" href="Ledger.Certs.html#4430" class="Function">gState</a> <a id="9226" class="Symbol">.</a><a id="9227" href="Ledger.Certs.html#4077" class="Field">ccHotKeys</a> <a id="9237" href="Axiom.Set.Map.html#10678" class="Function Operator">∣</a> <a id="9239" href="Ledger.Enact.html#1194" class="Function">ccCreds</a> <a id="9247" class="Symbol">(</a><a id="9248" href="Ledger.Epoch.html#8084" class="Bound">es</a> <a id="9251" class="Symbol">.</a><a id="9252" href="Ledger.Enact.html#433" class="Field">cc</a><a id="9254" class="Symbol">)</a> <a id="9256" href="Ledger.Prelude.html#2441" class="Function Operator">⟧</a>

      <a id="9265" href="Ledger.Epoch.html#9265" class="Bound">certState&#39;</a> <a id="9276" class="Symbol">:</a> <a id="9278" href="Ledger.Certs.html#4327" class="Record">CertState</a>
      <a id="9294" href="Ledger.Epoch.html#9265" class="Bound">certState&#39;</a> <a id="9305" class="Symbol">=</a> <a id="9307" href="Ledger.Prelude.html#2441" class="Function Operator">⟦</a> <a id="9309" href="Ledger.Epoch.html#8943" class="Bound">dState&#39;</a> <a id="9317" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="9319" href="Ledger.Epoch.html#9035" class="Bound">pState&#39;</a> <a id="9327" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="9329" href="Ledger.Epoch.html#9113" class="Bound">gState&#39;</a> <a id="9337" href="Ledger.Prelude.html#2441" class="Function Operator">⟧</a>

      <a id="9346" href="Ledger.Epoch.html#9346" class="Bound">utxoSt&#39;</a> <a id="9354" class="Symbol">=</a> <a id="9356" href="Ledger.Prelude.html#2441" class="Function Operator">⟦</a> <a id="9358" href="Ledger.Ledger.html#868" class="Function">utxoSt</a> <a id="9365" class="Symbol">.</a><a id="9366" href="Ledger.Utxo.html#2769" class="Field">utxo</a> <a id="9371" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="9373" href="Ledger.Ledger.html#868" class="Function">utxoSt</a> <a id="9380" class="Symbol">.</a><a id="9381" href="Ledger.Utxo.html#2791" class="Field">fees</a> <a id="9386" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="9388" href="Ledger.Ledger.html#868" class="Function">utxoSt</a> <a id="9395" class="Symbol">.</a><a id="9396" href="Ledger.Utxo.html#2813" class="Field">deposits</a> <a id="9405" href="Axiom.Set.Map.html#10748" class="Function Operator">∣</a> <a id="9407" href="abstract-set-theory.FiniteSetTheory.html#519" class="Function">mapˢ</a> <a id="9412" class="Symbol">(</a><a id="9413" href="Data.Product.Base.html#636" class="Field">proj₁</a> <a id="9419" href="Function.Base.html#1115" class="Function Operator">∘</a> <a id="9421" href="Data.Product.Base.html#650" class="Field">proj₂</a><a id="9426" class="Symbol">)</a> <a id="9428" href="Ledger.Epoch.html#8321" class="Bound">removedGovActions</a> <a id="9446" href="Axiom.Set.Map.html#10748" class="Function Operator">ᶜ</a> <a id="9448" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="9450" class="Number">0</a> <a id="9452" href="Ledger.Prelude.html#2441" class="Function Operator">⟧</a>

      <a id="9461" href="Ledger.Epoch.html#9461" class="Bound">acnt&#39;</a> <a id="9467" class="Symbol">=</a> <a id="9469" class="Keyword">record</a> <a id="9476" href="Ledger.Epoch.html#7280" class="Generalizable">acnt</a>
        <a id="9489" class="Symbol">{</a> <a id="9491" href="Ledger.PParams.html#729" class="Field">treasury</a>  <a id="9501" class="Symbol">=</a> <a id="9503" href="Ledger.Epoch.html#7280" class="Generalizable">acnt</a> <a id="9508" class="Symbol">.</a><a id="9509" href="Ledger.PParams.html#729" class="Field">treasury</a> <a id="9518" href="Data.Nat.Base.html#4462" class="Primitive Operator">∸</a> <a id="9520" href="Ledger.Epoch.html#8605" class="Bound">totWithdrawals</a> <a id="9535" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="9537" href="Ledger.Ledger.html#868" class="Function">utxoSt</a> <a id="9544" class="Symbol">.</a><a id="9545" href="Ledger.Utxo.html#2839" class="Field">donations</a> <a id="9555" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="9557" href="Ledger.Epoch.html#8823" class="Bound">unclaimed</a> <a id="9567" class="Symbol">}</a>
    <a id="9573" class="Keyword">in</a>
    <a id="9580" class="Keyword">record</a> <a id="9587" class="Symbol">{</a> <a id="9589" href="Ledger.Ratify.html#3054" class="Field">currentEpoch</a> <a id="9602" class="Symbol">=</a> <a id="9604" href="Ledger.Epoch.html#7189" class="Generalizable">e</a>
           <a id="9617" class="Symbol">;</a> <a id="9619" href="Ledger.Ratify.html#3022" class="Field">stakeDistrs</a> <a id="9631" class="Symbol">=</a> <a id="9633" href="Ledger.Epoch.html#6911" class="Function">mkStakeDistrs</a>  <a id="9648" class="Symbol">(</a><a id="9649" href="Ledger.Epoch.html#1232" class="Field">Snapshots.mark</a> <a id="9664" href="Ledger.Epoch.html#7374" class="Generalizable">ss&#39;</a><a id="9667" class="Symbol">)</a> <a id="9669" href="Ledger.Epoch.html#8876" class="Bound">govSt&#39;</a>
                                          <a id="9718" class="Symbol">(</a><a id="9719" href="Ledger.Epoch.html#9346" class="Bound">utxoSt&#39;</a> <a id="9727" class="Symbol">.</a><a id="9728" href="Ledger.Utxo.html#2813" class="Field">deposits</a><a id="9736" class="Symbol">)</a> <a id="9738" class="Symbol">(</a><a id="9739" href="Ledger.Certs.html#3230" class="Field">voteDelegs</a> <a id="9750" href="Ledger.Certs.html#4390" class="Function">dState</a><a id="9756" class="Symbol">)</a>
           <a id="9769" class="Symbol">;</a> <a id="9771" href="Ledger.Ratify.html#3169" class="Field">treasury</a> <a id="9780" class="Symbol">=</a> <a id="9782" href="Ledger.Epoch.html#7280" class="Generalizable">acnt</a> <a id="9787" class="Symbol">.</a><a id="9788" href="Ledger.PParams.html#729" class="Field">treasury</a> <a id="9797" class="Symbol">;</a> <a id="9799" href="Ledger.Epoch.html#9799" class="Module">GState</a> <a id="9806" href="Ledger.Certs.html#4430" class="Function">gState</a>
           <a id="9824" class="Symbol">;</a> <a id="9826" href="Ledger.Ratify.html#3194" class="Field">pools</a> <a id="9832" class="Symbol">=</a> <a id="9834" href="Ledger.Certs.html#4410" class="Function">pState</a> <a id="9841" class="Symbol">.</a><a id="9842" href="Ledger.Certs.html#3813" class="Field">pools</a> <a id="9848" class="Symbol">;</a> <a id="9850" href="Ledger.Ratify.html#3235" class="Field">delegatees</a> <a id="9861" class="Symbol">=</a> <a id="9863" href="Ledger.Certs.html#4390" class="Function">dState</a> <a id="9870" class="Symbol">.</a><a id="9871" href="Ledger.Certs.html#3230" class="Field">voteDelegs</a> <a id="9882" class="Symbol">}</a>
        <a id="9892" href="Ledger.Ratify.html#11072" class="Function Operator">⊢</a> <a id="9894" href="Ledger.Prelude.html#2441" class="Function Operator">⟦</a> <a id="9896" href="Ledger.Epoch.html#8084" class="Bound">es</a> <a id="9899" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="9901" href="Class.HasEmptySet.html#287" class="Field">∅</a> <a id="9903" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="9905" href="Agda.Builtin.Bool.html#192" class="InductiveConstructor">false</a> <a id="9911" href="Ledger.Prelude.html#2441" class="Function Operator">⟧</a> <a id="9913" href="Ledger.Ratify.html#11072" class="Function Operator">⇀⦇</a> <a id="9916" href="Ledger.Epoch.html#8876" class="Bound">govSt&#39;</a> <a id="9923" href="Ledger.Ratify.html#11072" class="Function Operator">,RATIFIES⦈</a> <a id="9934" href="Ledger.Epoch.html#7215" class="Generalizable">fut&#39;</a>
      <a id="9945" class="Symbol">→</a> <a id="9947" href="Ledger.Epoch.html#7266" class="Generalizable">ls</a> <a id="9950" href="Ledger.Epoch.html#7444" class="Datatype Operator">⊢</a> <a id="9952" href="Ledger.Epoch.html#7371" class="Generalizable">ss</a> <a id="9955" href="Ledger.Epoch.html#7444" class="Datatype Operator">⇀⦇</a> <a id="9958" href="Agda.Builtin.Unit.html#212" class="InductiveConstructor">tt</a> <a id="9961" href="Ledger.Epoch.html#7444" class="Datatype Operator">,SNAP⦈</a> <a id="9968" href="Ledger.Epoch.html#7374" class="Generalizable">ss&#39;</a>
    <a id="9976" href="iog-prelude.Prelude.InferenceRules.html#217" class="Function Operator">────────────────────────────────</a>
    <a id="10013" class="Symbol">_</a> <a id="10015" href="Ledger.Epoch.html#7737" class="Datatype Operator">⊢</a> <a id="10017" href="Ledger.Prelude.html#2441" class="Function Operator">⟦</a> <a id="10019" href="Ledger.Epoch.html#7280" class="Generalizable">acnt</a> <a id="10024" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="10026" href="Ledger.Epoch.html#7371" class="Generalizable">ss</a> <a id="10029" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="10031" href="Ledger.Epoch.html#7266" class="Generalizable">ls</a> <a id="10034" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="10036" href="Ledger.Epoch.html#7294" class="Generalizable">es₀</a> <a id="10040" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="10042" href="Ledger.Epoch.html#7211" class="Generalizable">fut</a> <a id="10046" href="Ledger.Prelude.html#2441" class="Function Operator">⟧</a> <a id="10048" href="Ledger.Epoch.html#7737" class="Datatype Operator">⇀⦇</a> <a id="10051" href="Ledger.Epoch.html#7189" class="Generalizable">e</a> <a id="10053" href="Ledger.Epoch.html#7737" class="Datatype Operator">,EPOCH⦈</a>
        <a id="10069" href="Ledger.Prelude.html#2441" class="Function Operator">⟦</a> <a id="10071" href="Ledger.Epoch.html#9461" class="Bound">acnt&#39;</a> <a id="10077" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="10079" href="Ledger.Epoch.html#7374" class="Generalizable">ss&#39;</a> <a id="10083" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="10085" href="Ledger.Prelude.html#2441" class="Function Operator">⟦</a> <a id="10087" href="Ledger.Epoch.html#9346" class="Bound">utxoSt&#39;</a> <a id="10095" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="10097" href="Ledger.Epoch.html#8876" class="Bound">govSt&#39;</a> <a id="10104" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="10106" href="Ledger.Epoch.html#9265" class="Bound">certState&#39;</a> <a id="10117" href="Ledger.Prelude.html#2441" class="Function Operator">⟧</a> <a id="10119" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="10121" href="Ledger.Epoch.html#8084" class="Bound">es</a> <a id="10124" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="10126" href="Ledger.Epoch.html#7215" class="Generalizable">fut&#39;</a> <a id="10131" href="Ledger.Prelude.html#2441" class="Function Operator">⟧</a>


<a id="10135" class="Keyword">data</a>


  <a id="_⊢_⇀⦇_,NEWEPOCH⦈_"></a><a id="10144" href="Ledger.Epoch.html#10144" class="Datatype Operator">_⊢_⇀⦇_,NEWEPOCH⦈_</a> <a id="10162" class="Symbol">:</a> <a id="10164" href="Agda.Builtin.Unit.html#175" class="Record">⊤</a> <a id="10166" class="Symbol">→</a> <a id="10168" href="Ledger.Epoch.html#2070" class="Record">NewEpochState</a> <a id="10182" class="Symbol">→</a> <a id="10184" href="Ledger.Types.Epoch.html#543" class="Function">Epoch</a> <a id="10190" class="Symbol">→</a> <a id="10192" href="Ledger.Epoch.html#2070" class="Record">NewEpochState</a> <a id="10206" class="Symbol">→</a> <a id="10208" href="Agda.Primitive.html#388" class="Primitive">Type</a>


  <a id="10217" class="Keyword">where</a>


  <a id="_⊢_⇀⦇_,NEWEPOCH⦈_.NEWEPOCH-New"></a><a id="10227" href="Ledger.Epoch.html#10227" class="InductiveConstructor">NEWEPOCH-New</a> <a id="10240" class="Symbol">:</a> <a id="10242" class="Keyword">let</a>
      <a id="10252" href="Ledger.Epoch.html#10252" class="Bound">eps&#39;</a> <a id="10257" class="Symbol">=</a> <a id="10259" href="Ledger.Epoch.html#5108" class="Function">applyRUpd</a> <a id="10269" href="Ledger.Epoch.html#7392" class="Generalizable">ru</a> <a id="10272" href="Ledger.Epoch.html#7236" class="Generalizable">eps</a>
    <a id="10280" class="Keyword">in</a>
    <a id="10287" href="Prelude.InferenceRules.html#56074" class="Function Operator">∙</a> <a id="10289" href="Ledger.Epoch.html#7189" class="Generalizable">e</a> <a id="10291" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="10293" href="Ledger.Epoch.html#7191" class="Generalizable">lastEpoch</a> <a id="10303" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="10305" class="Number">1</a>
    <a id="10311" href="iog-prelude.Prelude.InferenceRules.html#583" class="Function Operator">∙</a> <a id="10313" class="Symbol">_</a> <a id="10315" href="Ledger.Epoch.html#7737" class="Datatype Operator">⊢</a> <a id="10317" href="Ledger.Epoch.html#10252" class="Bound">eps&#39;</a> <a id="10322" href="Ledger.Epoch.html#7737" class="Datatype Operator">⇀⦇</a> <a id="10325" href="Ledger.Epoch.html#7189" class="Generalizable">e</a> <a id="10327" href="Ledger.Epoch.html#7737" class="Datatype Operator">,EPOCH⦈</a> <a id="10335" href="Ledger.Epoch.html#7245" class="Generalizable">eps&#39;&#39;</a>
      <a id="10347" href="iog-prelude.Prelude.InferenceRules.html#217" class="Function Operator">────────────────────────────────</a>
      <a id="10386" class="Symbol">_</a> <a id="10388" href="Ledger.Epoch.html#10144" class="Datatype Operator">⊢</a> <a id="10390" href="Ledger.Prelude.html#2441" class="Function Operator">⟦</a> <a id="10392" href="Ledger.Epoch.html#7191" class="Generalizable">lastEpoch</a> <a id="10402" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="10404" href="Ledger.Epoch.html#7236" class="Generalizable">eps</a> <a id="10408" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="10410" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="10415" href="Ledger.Epoch.html#7392" class="Generalizable">ru</a> <a id="10418" href="Ledger.Prelude.html#2441" class="Function Operator">⟧</a> <a id="10420" href="Ledger.Epoch.html#10144" class="Datatype Operator">⇀⦇</a> <a id="10423" href="Ledger.Epoch.html#7189" class="Generalizable">e</a> <a id="10425" href="Ledger.Epoch.html#10144" class="Datatype Operator">,NEWEPOCH⦈</a> <a id="10436" href="Ledger.Prelude.html#2441" class="Function Operator">⟦</a> <a id="10438" href="Ledger.Epoch.html#7189" class="Generalizable">e</a> <a id="10440" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="10442" href="Ledger.Epoch.html#7245" class="Generalizable">eps&#39;&#39;</a> <a id="10448" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="10450" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a> <a id="10458" href="Ledger.Prelude.html#2441" class="Function Operator">⟧</a>

  <a id="_⊢_⇀⦇_,NEWEPOCH⦈_.NEWEPOCH-Not-New"></a><a id="10463" href="Ledger.Epoch.html#10463" class="InductiveConstructor">NEWEPOCH-Not-New</a> <a id="10480" class="Symbol">:</a>
    <a id="10486" href="Prelude.InferenceRules.html#56074" class="Function Operator">∙</a> <a id="10488" href="Ledger.Epoch.html#7189" class="Generalizable">e</a> <a id="10490" href="Relation.Binary.PropositionalEquality.Core.html#858" class="Function Operator">≢</a> <a id="10492" href="Ledger.Epoch.html#7191" class="Generalizable">lastEpoch</a> <a id="10502" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="10504" class="Number">1</a>
      <a id="10512" href="iog-prelude.Prelude.InferenceRules.html#217" class="Function Operator">────────────────────────────────</a>
      <a id="10551" class="Symbol">_</a> <a id="10553" href="Ledger.Epoch.html#10144" class="Datatype Operator">⊢</a> <a id="10555" href="Ledger.Prelude.html#2441" class="Function Operator">⟦</a> <a id="10557" href="Ledger.Epoch.html#7191" class="Generalizable">lastEpoch</a> <a id="10567" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="10569" href="Ledger.Epoch.html#7236" class="Generalizable">eps</a> <a id="10573" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="10575" href="Ledger.Epoch.html#7412" class="Generalizable">mru</a> <a id="10579" href="Ledger.Prelude.html#2441" class="Function Operator">⟧</a> <a id="10581" href="Ledger.Epoch.html#10144" class="Datatype Operator">⇀⦇</a> <a id="10584" href="Ledger.Epoch.html#7189" class="Generalizable">e</a> <a id="10586" href="Ledger.Epoch.html#10144" class="Datatype Operator">,NEWEPOCH⦈</a> <a id="10597" href="Ledger.Prelude.html#2441" class="Function Operator">⟦</a> <a id="10599" href="Ledger.Epoch.html#7191" class="Generalizable">lastEpoch</a> <a id="10609" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="10611" href="Ledger.Epoch.html#7236" class="Generalizable">eps</a> <a id="10615" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="10617" href="Ledger.Epoch.html#7412" class="Generalizable">mru</a> <a id="10621" href="Ledger.Prelude.html#2441" class="Function Operator">⟧</a>

  <a id="_⊢_⇀⦇_,NEWEPOCH⦈_.NEWEPOCH-No-Reward-Update"></a><a id="10626" href="Ledger.Epoch.html#10626" class="InductiveConstructor">NEWEPOCH-No-Reward-Update</a> <a id="10652" class="Symbol">:</a>
    <a id="10658" href="Prelude.InferenceRules.html#56074" class="Function Operator">∙</a> <a id="10660" href="Ledger.Epoch.html#7189" class="Generalizable">e</a> <a id="10662" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="10664" href="Ledger.Epoch.html#7191" class="Generalizable">lastEpoch</a> <a id="10674" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="10676" class="Number">1</a>
    <a id="10682" href="iog-prelude.Prelude.InferenceRules.html#583" class="Function Operator">∙</a> <a id="10684" class="Symbol">_</a> <a id="10686" href="Ledger.Epoch.html#7737" class="Datatype Operator">⊢</a> <a id="10688" href="Ledger.Epoch.html#7236" class="Generalizable">eps</a> <a id="10692" href="Ledger.Epoch.html#7737" class="Datatype Operator">⇀⦇</a> <a id="10695" href="Ledger.Epoch.html#7189" class="Generalizable">e</a> <a id="10697" href="Ledger.Epoch.html#7737" class="Datatype Operator">,EPOCH⦈</a> <a id="10705" href="Ledger.Epoch.html#7240" class="Generalizable">eps&#39;</a>
      <a id="10716" href="iog-prelude.Prelude.InferenceRules.html#217" class="Function Operator">────────────────────────────────</a>
      <a id="10755" class="Symbol">_</a> <a id="10757" href="Ledger.Epoch.html#10144" class="Datatype Operator">⊢</a> <a id="10759" href="Ledger.Prelude.html#2441" class="Function Operator">⟦</a> <a id="10761" href="Ledger.Epoch.html#7191" class="Generalizable">lastEpoch</a> <a id="10771" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="10773" href="Ledger.Epoch.html#7236" class="Generalizable">eps</a> <a id="10777" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="10779" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a> <a id="10787" href="Ledger.Prelude.html#2441" class="Function Operator">⟧</a> <a id="10789" href="Ledger.Epoch.html#10144" class="Datatype Operator">⇀⦇</a> <a id="10792" href="Ledger.Epoch.html#7189" class="Generalizable">e</a> <a id="10794" href="Ledger.Epoch.html#10144" class="Datatype Operator">,NEWEPOCH⦈</a> <a id="10805" href="Ledger.Prelude.html#2441" class="Function Operator">⟦</a> <a id="10807" href="Ledger.Epoch.html#7189" class="Generalizable">e</a> <a id="10809" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="10811" href="Ledger.Epoch.html#7240" class="Generalizable">eps&#39;</a> <a id="10816" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="10818" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a> <a id="10826" href="Ledger.Prelude.html#2441" class="Function Operator">⟧</a>

</pre></body></html>