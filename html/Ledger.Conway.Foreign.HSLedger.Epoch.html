<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>Ledger.Conway.Foreign.HSLedger.Epoch</title><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.css"><link rel="stylesheet" href="Agda.css"><script src="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.js"></script><script src="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/contrib/auto-render.min.js"></script><script src="AgdaKaTeX.js" defer=""></script></head><body><pre class="Agda"><a id="1" class="Keyword">module</a> <a id="8" href="Ledger.Conway.Foreign.HSLedger.Epoch.html" class="Module">Ledger.Conway.Foreign.HSLedger.Epoch</a> <a id="45" class="Keyword">where</a>

<a id="52" class="Keyword">open</a> <a id="57" class="Keyword">import</a> <a id="64" href="Ledger.Conway.Foreign.HSLedger.BaseTypes.html" class="Module">Ledger.Conway.Foreign.HSLedger.BaseTypes</a>
<a id="105" class="Keyword">open</a> <a id="110" class="Keyword">import</a> <a id="117" href="Ledger.Conway.Foreign.HSLedger.Enact.html" class="Module">Ledger.Conway.Foreign.HSLedger.Enact</a>
<a id="154" class="Keyword">open</a> <a id="159" class="Keyword">import</a> <a id="166" href="Ledger.Conway.Foreign.HSLedger.Ledger.html" class="Module">Ledger.Conway.Foreign.HSLedger.Ledger</a>
<a id="204" class="Keyword">open</a> <a id="209" class="Keyword">import</a> <a id="216" href="Ledger.Conway.Foreign.HSLedger.PParams.html" class="Module">Ledger.Conway.Foreign.HSLedger.PParams</a>
<a id="255" class="Keyword">open</a> <a id="260" class="Keyword">import</a> <a id="267" href="Ledger.Conway.Foreign.HSLedger.Ratify.html" class="Module">Ledger.Conway.Foreign.HSLedger.Ratify</a>
<a id="305" class="Keyword">open</a> <a id="310" class="Keyword">import</a> <a id="317" href="Ledger.Conway.Foreign.HSLedger.Rewards.html" class="Module">Ledger.Conway.Foreign.HSLedger.Rewards</a>

<a id="357" class="Keyword">open</a> <a id="362" class="Keyword">import</a> <a id="369" href="Ledger.Conway.Conformance.Equivalence.Convert.html" class="Module">Ledger.Conway.Conformance.Equivalence.Convert</a>
<a id="415" class="Keyword">open</a> <a id="420" class="Keyword">import</a> <a id="427" href="Ledger.Conway.Conformance.Epoch.html" class="Module">Ledger.Conway.Conformance.Epoch</a> <a id="459" href="Function.Base.html#4755" class="Function">it</a> <a id="462" href="Function.Base.html#4755" class="Function">it</a>
<a id="465" class="Keyword">open</a> <a id="470" class="Keyword">import</a> <a id="477" href="Ledger.Conway.Conformance.Epoch.Properties.html" class="Module">Ledger.Conway.Conformance.Epoch.Properties</a> <a id="520" href="Function.Base.html#4755" class="Function">it</a> <a id="523" href="Function.Base.html#4755" class="Function">it</a>

<a id="527" class="Keyword">module</a> <a id="EpochSpec"></a><a id="534" href="Ledger.Conway.Foreign.HSLedger.Epoch.html#534" class="Module">EpochSpec</a> <a id="544" class="Keyword">where</a>
  <a id="552" class="Keyword">open</a> <a id="557" class="Keyword">import</a> <a id="564" href="Ledger.Conway.Specification.Epoch.html" class="Module">Ledger.Conway.Specification.Epoch</a> <a id="598" href="Function.Base.html#4755" class="Function">it</a> <a id="601" href="Function.Base.html#4755" class="Function">it</a> <a id="604" class="Keyword">public</a>
  <a id="613" class="Keyword">open</a> <a id="618" class="Keyword">import</a> <a id="625" href="Ledger.Conway.Specification.Epoch.Properties.html" class="Module">Ledger.Conway.Specification.Epoch.Properties</a> <a id="670" href="Function.Base.html#4755" class="Function">it</a> <a id="673" href="Function.Base.html#4755" class="Function">it</a> <a id="676" class="Keyword">public</a>

<a id="684" class="Keyword">import</a> <a id="691" href="Data.String.html" class="Module">Data.String</a> <a id="703" class="Symbol">as</a> <a id="706" class="Module">S</a>

<a id="709" class="Keyword">instance</a>
  <a id="Show-EPOCH"></a><a id="720" href="Ledger.Conway.Foreign.HSLedger.Epoch.html#720" class="Function">Show-EPOCH</a> <a id="731" class="Symbol">:</a> <a id="733" class="Symbol">∀</a> <a id="735" class="Symbol">{</a><a id="736" href="Ledger.Conway.Foreign.HSLedger.Epoch.html#736" class="Bound">eps</a> <a id="740" href="Ledger.Conway.Foreign.HSLedger.Epoch.html#740" class="Bound">e</a> <a id="742" href="Ledger.Conway.Foreign.HSLedger.Epoch.html#742" class="Bound">eps&#39;</a><a id="746" class="Symbol">}</a> <a id="748" class="Symbol">→</a> <a id="750" href="Class.Show.Core.html#125" class="Record">Show</a> <a id="755" class="Symbol">(_</a> <a id="758" href="Ledger.Conway.Conformance.Epoch.html#3184" class="Datatype Operator">⊢</a> <a id="760" href="Ledger.Conway.Foreign.HSLedger.Epoch.html#736" class="Bound">eps</a> <a id="764" href="Ledger.Conway.Conformance.Epoch.html#3184" class="Datatype Operator">⇀⦇</a> <a id="767" href="Ledger.Conway.Foreign.HSLedger.Epoch.html#740" class="Bound">e</a> <a id="769" href="Ledger.Conway.Conformance.Epoch.html#3184" class="Datatype Operator">,EPOCH⦈</a> <a id="777" href="Ledger.Conway.Foreign.HSLedger.Epoch.html#742" class="Bound">eps&#39;</a><a id="781" class="Symbol">)</a>
  <a id="785" href="Ledger.Conway.Foreign.HSLedger.Epoch.html#720" class="Function">Show-EPOCH</a> <a id="796" class="Symbol">.</a><a id="797" href="Class.Show.Core.html#187" class="Field">show</a> <a id="802" class="Symbol">(</a><a id="803" href="Ledger.Conway.Conformance.Epoch.html#3253" class="InductiveConstructor">EPOCH</a> <a id="809" href="Ledger.Conway.Foreign.HSLedger.Epoch.html#809" class="Bound">e</a> <a id="811" href="Ledger.Conway.Foreign.HSLedger.Epoch.html#811" class="Bound">s</a><a id="812" class="Symbol">)</a> <a id="814" class="Symbol">=</a> <a id="816" class="String">&quot;EPOCH\n&quot;</a> <a id="826" href="Data.String.Base.html#2425" class="Function Operator">S.++</a> <a id="831" href="Class.Show.Core.html#187" class="Field">show</a> <a id="836" href="Ledger.Conway.Foreign.HSLedger.Epoch.html#811" class="Bound">s</a> <a id="838" href="Data.String.Base.html#2425" class="Function Operator">S.++</a> <a id="843" class="String">&quot; &quot;</a> <a id="847" href="Data.String.Base.html#2425" class="Function Operator">S.++</a> <a id="852" href="Class.Show.Core.html#187" class="Field">show</a> <a id="857" href="Ledger.Conway.Foreign.HSLedger.Epoch.html#809" class="Bound">e</a>

  <a id="Show-SPEC-EPOCH"></a><a id="862" href="Ledger.Conway.Foreign.HSLedger.Epoch.html#862" class="Function">Show-SPEC-EPOCH</a> <a id="878" class="Symbol">:</a> <a id="880" class="Symbol">∀</a> <a id="882" class="Symbol">{</a><a id="883" href="Ledger.Conway.Foreign.HSLedger.Epoch.html#883" class="Bound">eps</a> <a id="887" href="Ledger.Conway.Foreign.HSLedger.Epoch.html#887" class="Bound">e</a> <a id="889" href="Ledger.Conway.Foreign.HSLedger.Epoch.html#889" class="Bound">eps&#39;</a><a id="893" class="Symbol">}</a> <a id="895" class="Symbol">→</a> <a id="897" href="Class.Show.Core.html#125" class="Record">Show</a> <a id="902" class="Symbol">(_</a> <a id="905" href="Ledger.Conway.Specification.Epoch.html#15676" class="Datatype Operator">EpochSpec.⊢</a> <a id="917" href="Ledger.Conway.Foreign.HSLedger.Epoch.html#883" class="Bound">eps</a> <a id="921" href="Ledger.Conway.Specification.Epoch.html#15676" class="Datatype Operator">⇀⦇</a> <a id="924" href="Ledger.Conway.Foreign.HSLedger.Epoch.html#887" class="Bound">e</a> <a id="926" href="Ledger.Conway.Specification.Epoch.html#15676" class="Datatype Operator">,EPOCH⦈</a> <a id="934" href="Ledger.Conway.Foreign.HSLedger.Epoch.html#889" class="Bound">eps&#39;</a><a id="938" class="Symbol">)</a>
  <a id="942" href="Ledger.Conway.Foreign.HSLedger.Epoch.html#862" class="Function">Show-SPEC-EPOCH</a> <a id="958" class="Symbol">.</a><a id="959" href="Class.Show.Core.html#187" class="Field">show</a> <a id="964" class="Symbol">(</a><a id="965" href="Ledger.Conway.Specification.Epoch.html#15746" class="InductiveConstructor">EpochSpec.EPOCH</a> <a id="981" class="Symbol">(</a><a id="982" href="Ledger.Conway.Foreign.HSLedger.Epoch.html#982" class="Bound">s</a> <a id="984" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="986" href="Ledger.Conway.Foreign.HSLedger.Epoch.html#986" class="Bound">r</a> <a id="988" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="990" href="Ledger.Conway.Foreign.HSLedger.Epoch.html#990" class="Bound">pr</a><a id="992" class="Symbol">))</a> <a id="995" class="Symbol">=</a>
    <a id="1001" class="String">&quot;SPEC-EPOCH\n&quot;</a> <a id="1016" href="Data.String.Base.html#2425" class="Function Operator">S.++</a> <a id="1021" class="String">&quot;SNAP&quot;</a> <a id="1028" href="Data.String.Base.html#2425" class="Function Operator">S.++</a> <a id="1033" class="String">&quot; &quot;</a> <a id="1037" href="Data.String.Base.html#2425" class="Function Operator">S.++</a> <a id="1042" href="Class.Show.Core.html#187" class="Field">show</a> <a id="1047" href="Ledger.Conway.Foreign.HSLedger.Epoch.html#986" class="Bound">r</a>

    <a id="1054" class="Comment">-- record { currentEpoch = e</a>
    <a id="1087" class="Comment">--        ; stakeDistrs = mkStakeDistrs  (Snapshots.mark ss&#39;) govSt&#39;</a>
    <a id="1160" class="Comment">--                                       (utxoSt&#39; .deposits) (voteDelegs dState)</a>
<a id="1241" class="Keyword">instance</a>
  <a id="HsTy-EpochState"></a><a id="1252" href="Ledger.Conway.Foreign.HSLedger.Epoch.html#1252" class="Function">HsTy-EpochState</a> <a id="1268" class="Symbol">=</a> <a id="1270" href="Foreign.HaskellTypes.Deriving.html#11530" class="Macro Operator">autoHsType</a> <a id="1281" href="Ledger.Conway.Conformance.Epoch.html#1234" class="Record">EpochState</a> <a id="1292" href="Foreign.HaskellTypes.Deriving.html#11530" class="Macro Operator">⊣</a> <a id="1294" href="Foreign.HaskellTypes.Deriving.html#3237" class="Function">withConstructor</a> <a id="1310" class="String">&quot;MkEpochState&quot;</a>
                                          <a id="1367" href="Foreign.HaskellTypes.Deriving.html#3523" class="Function Operator">•</a> <a id="1369" href="Foreign.HaskellTypes.Deriving.html#3419" class="Function">fieldPrefix</a> <a id="1381" class="String">&quot;es&quot;</a>
  <a id="Conv-EpochState"></a><a id="1388" href="Ledger.Conway.Foreign.HSLedger.Epoch.html#1388" class="Function">Conv-EpochState</a> <a id="1404" class="Symbol">=</a> <a id="1406" href="Foreign.Convertible.Deriving.html#6814" class="Macro">autoConvert</a> <a id="1418" href="Ledger.Conway.Conformance.Epoch.html#1234" class="Record">EpochState</a>

<a id="epoch-step"></a><a id="1430" href="Ledger.Conway.Foreign.HSLedger.Epoch.html#1430" class="Function">epoch-step</a> <a id="1441" class="Symbol">:</a> <a id="1443" href="Foreign.HaskellTypes.html#593" class="Function">HsType</a> <a id="1450" class="Symbol">(</a><a id="1451" href="Agda.Builtin.Unit.html#175" class="Record">⊤</a> <a id="1453" class="Symbol">→</a> <a id="1455" href="Ledger.Conway.Conformance.Epoch.html#1234" class="Record">EpochState</a> <a id="1466" class="Symbol">→</a> <a id="1468" href="Ledger.Core.Specification.Epoch.html#598" class="Function">Epoch</a> <a id="1474" class="Symbol">→</a> <a id="1476" href="Interface.ComputationalRelation.html#235" class="Datatype">ComputationResult</a> <a id="1494" href="Data.Empty.html#914" class="Function">⊥</a> <a id="1496" class="Symbol">(</a><a id="1497" href="Ledger.Conway.Conformance.Epoch.html#1234" class="Record">EpochState</a> <a id="1508" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="1510" href="Agda.Builtin.String.html#335" class="Postulate">String</a><a id="1516" class="Symbol">))</a>
<a id="1519" href="Ledger.Conway.Foreign.HSLedger.Epoch.html#1430" class="Function">epoch-step</a> <a id="1530" class="Symbol">_</a> <a id="1532" href="Ledger.Conway.Foreign.HSLedger.Epoch.html#1532" class="Bound">epochSt</a> <a id="1540" href="Ledger.Conway.Foreign.HSLedger.Epoch.html#1540" class="Bound">e</a> <a id="1542" class="Symbol">=</a>
  <a id="1546" class="Keyword">let</a> <a id="1550" href="Ledger.Conway.Foreign.HSLedger.Epoch.html#1550" class="Bound">r</a> <a id="1552" class="Symbol">=</a> <a id="1554" href="Ledger.Conway.Conformance.Epoch.Properties.html#3058" class="Function">Computational-EPOCH</a> <a id="1574" class="Symbol">.</a><a id="1575" href="Interface.ComputationalRelation.html#2879" class="Field">computeProof</a> <a id="1588" class="Symbol">_</a> <a id="1590" class="Symbol">(</a><a id="1591" href="Foreign.Convertible.html#170" class="Field">from</a> <a id="1596" href="Ledger.Conway.Foreign.HSLedger.Epoch.html#1532" class="Bound">epochSt</a><a id="1603" class="Symbol">)</a> <a id="1605" href="Ledger.Conway.Foreign.HSLedger.Epoch.html#1540" class="Bound">e</a>
  <a id="1609" class="Keyword">in</a> <a id="1612" href="Function.Base.html#4061" class="Function Operator">case</a> <a id="1617" href="Ledger.Conway.Foreign.HSLedger.Epoch.html#1550" class="Bound">r</a> <a id="1619" href="Function.Base.html#4061" class="Function Operator">of</a> <a id="1622" class="Symbol">λ</a> <a id="1624" class="Keyword">where</a>
    <a id="1634" class="Symbol">(</a><a id="1635" href="Interface.ComputationalRelation.html#308" class="InductiveConstructor">success</a> <a id="1643" class="Symbol">(</a><a id="1644" href="Ledger.Conway.Foreign.HSLedger.Epoch.html#1644" class="Bound">s</a> <a id="1646" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1648" href="Ledger.Conway.Foreign.HSLedger.Epoch.html#1648" class="Bound">p</a><a id="1649" class="Symbol">))</a> <a id="1652" class="Symbol">→</a> <a id="1654" href="Foreign.Convertible.html#149" class="Field">to</a> <a id="1657" class="Symbol">(</a><a id="1658" href="Interface.ComputationalRelation.html#308" class="InductiveConstructor">success</a> <a id="1666" class="Symbol">(</a><a id="1667" href="Ledger.Conway.Foreign.HSLedger.Epoch.html#1644" class="Bound">s</a> <a id="1669" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1671" href="Class.Show.Core.html#187" class="Field">show</a> <a id="1676" href="Ledger.Conway.Foreign.HSLedger.Epoch.html#1648" class="Bound">p</a><a id="1677" class="Symbol">))</a>

<a id="1681" class="Symbol">{-#</a> <a id="1685" class="Keyword">COMPILE</a> <a id="1693" class="Keyword">GHC</a> <a id="1697" href="Ledger.Conway.Foreign.HSLedger.Epoch.html#1430" class="Function">epoch-step</a> <a id="1708" class="Pragma">as</a> <a id="1711" class="Pragma">epochStep</a> <a id="1721" class="Symbol">#-}</a>

<a id="1726" class="Comment">-- An alternative implementation of EPOCH that connects the conformance state</a>
<a id="1804" class="Comment">-- with the specification rule.</a>

<a id="spec-epoch-step"></a><a id="1837" href="Ledger.Conway.Foreign.HSLedger.Epoch.html#1837" class="Function">spec-epoch-step</a>
  <a id="1855" class="Symbol">:</a> <a id="1857" href="Foreign.HaskellTypes.html#593" class="Function">HsType</a> <a id="1864" class="Symbol">(</a><a id="1865" href="Agda.Builtin.Unit.html#175" class="Record">⊤</a> <a id="1867" class="Symbol">→</a> <a id="1869" href="Ledger.Conway.Conformance.Epoch.html#1234" class="Record">EpochState</a> <a id="1880" class="Symbol">→</a> <a id="1882" href="Ledger.Core.Specification.Epoch.html#598" class="Function">Epoch</a> <a id="1888" class="Symbol">→</a> <a id="1890" href="Interface.ComputationalRelation.html#235" class="Datatype">ComputationResult</a> <a id="1908" href="Data.Empty.html#914" class="Function">⊥</a> <a id="1910" class="Symbol">(</a><a id="1911" href="Ledger.Conway.Conformance.Epoch.html#1234" class="Record">EpochState</a> <a id="1922" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="1924" href="Agda.Builtin.String.html#335" class="Postulate">String</a><a id="1930" class="Symbol">))</a>
<a id="1933" href="Ledger.Conway.Foreign.HSLedger.Epoch.html#1837" class="Function">spec-epoch-step</a> <a id="1949" class="Symbol">_</a> <a id="1951" href="Ledger.Conway.Foreign.HSLedger.Epoch.html#1951" class="Bound">epochSt</a> <a id="1959" href="Ledger.Conway.Foreign.HSLedger.Epoch.html#1959" class="Bound">e</a> <a id="1961" class="Symbol">=</a>
  <a id="1965" class="Keyword">let</a> <a id="1969" href="Ledger.Conway.Foreign.HSLedger.Epoch.html#1969" class="Bound">r</a> <a id="1971" class="Symbol">=</a> <a id="1973" href="Ledger.Conway.Specification.Epoch.Properties.html#4583" class="Function">EpochSpec.Computational-EPOCH</a> <a id="2003" class="Symbol">.</a><a id="2004" href="Interface.ComputationalRelation.html#2879" class="Field">computeProof</a> <a id="2017" class="Symbol">_</a> <a id="2019" class="Symbol">(</a><a id="2020" href="Ledger.Conway.Conformance.Equivalence.Convert.html#452" class="Function">conv</a> <a id="2025" class="Symbol">(</a><a id="2026" href="Foreign.Convertible.html#170" class="Field">from</a> <a id="2031" href="Ledger.Conway.Foreign.HSLedger.Epoch.html#1951" class="Bound">epochSt</a><a id="2038" class="Symbol">))</a> <a id="2041" href="Ledger.Conway.Foreign.HSLedger.Epoch.html#1959" class="Bound">e</a>
  <a id="2045" class="Keyword">in</a> <a id="2048" href="Function.Base.html#4061" class="Function Operator">case</a> <a id="2053" href="Ledger.Conway.Foreign.HSLedger.Epoch.html#1969" class="Bound">r</a> <a id="2055" href="Function.Base.html#4061" class="Function Operator">of</a> <a id="2058" class="Symbol">λ</a> <a id="2060" class="Keyword">where</a>
    <a id="2070" class="Symbol">(</a><a id="2071" href="Interface.ComputationalRelation.html#308" class="InductiveConstructor">success</a> <a id="2079" class="Symbol">(</a><a id="2080" href="Ledger.Conway.Foreign.HSLedger.Epoch.html#2080" class="Bound">s</a> <a id="2082" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="2084" href="Ledger.Conway.Foreign.HSLedger.Epoch.html#2084" class="Bound">p</a><a id="2085" class="Symbol">))</a> <a id="2088" class="Symbol">→</a> <a id="2090" href="Foreign.Convertible.html#149" class="Field">to</a> <a id="2093" class="Symbol">(</a><a id="2094" href="Interface.ComputationalRelation.html#308" class="InductiveConstructor">success</a> <a id="2102" class="Symbol">(</a><a id="2103" href="Ledger.Conway.Conformance.Equivalence.Convert.html#452" class="Function">conv</a> <a id="2108" href="Ledger.Conway.Foreign.HSLedger.Epoch.html#2080" class="Bound">s</a> <a id="2110" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="2112" href="Class.Show.Core.html#187" class="Field">show</a> <a id="2117" href="Ledger.Conway.Foreign.HSLedger.Epoch.html#2084" class="Bound">p</a><a id="2118" class="Symbol">))</a>

<a id="2122" class="Symbol">{-#</a> <a id="2126" class="Keyword">COMPILE</a> <a id="2134" class="Keyword">GHC</a> <a id="2138" href="Ledger.Conway.Foreign.HSLedger.Epoch.html#1837" class="Function">spec-epoch-step</a> <a id="2154" class="Pragma">as</a> <a id="2157" class="Pragma">specEpochStep</a> <a id="2171" class="Symbol">#-}</a>
</pre></body></html>