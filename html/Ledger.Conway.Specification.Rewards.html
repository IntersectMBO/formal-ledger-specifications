<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>Ledger.Conway.Specification.Rewards</title><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.css"><link rel="stylesheet" href="Agda.css"><script src="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.js"></script><script src="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/contrib/auto-render.min.js"></script><script src="AgdaKaTeX.js" defer=""></script></head><body><pre class="Agda">
<a id="2" class="Symbol">{-#</a> <a id="6" class="Keyword">OPTIONS</a> <a id="14" class="Pragma">--safe</a> <a id="21" class="Symbol">#-}</a>

<a id="26" class="Keyword">open</a> <a id="31" class="Keyword">import</a> <a id="38" href="Ledger.Core.Specification.Abstract.html" class="Module">Ledger.Core.Specification.Abstract</a>
<a id="73" class="Keyword">open</a> <a id="78" class="Keyword">import</a> <a id="85" href="Ledger.Core.Specification.Transaction.html" class="Module">Ledger.Core.Specification.Transaction</a>

<a id="124" class="Keyword">module</a> <a id="131" href="Ledger.Conway.Specification.Rewards.html" class="Module">Ledger.Conway.Specification.Rewards</a>
  <a id="169" class="Symbol">(</a><a id="170" href="Ledger.Conway.Specification.Rewards.html#170" class="Bound">txs</a> <a id="174" class="Symbol">:</a> <a id="176" href="Ledger.Core.Specification.Transaction.html#896" class="Record">TransactionStructure</a><a id="196" class="Symbol">)</a> <a id="198" class="Symbol">(</a><a id="199" class="Keyword">open</a> <a id="204" href="Ledger.Core.Specification.Transaction.html#896" class="Module">TransactionStructure</a> <a id="225" href="Ledger.Conway.Specification.Rewards.html#170" class="Bound">txs</a><a id="228" class="Symbol">)</a>
  <a id="232" class="Symbol">(</a><a id="233" href="Ledger.Conway.Specification.Rewards.html#233" class="Bound">abs</a> <a id="237" class="Symbol">:</a> <a id="239" href="Ledger.Core.Specification.Abstract.html#651" class="Record">AbstractFunctions</a> <a id="257" href="Ledger.Conway.Specification.Rewards.html#170" class="Bound">txs</a><a id="260" class="Symbol">)</a>
  <a id="264" class="Keyword">where</a>

<a id="271" class="Keyword">open</a> <a id="276" class="Keyword">import</a> <a id="283" href="Data.Integer.html" class="Module">Data.Integer</a> <a id="296" class="Keyword">using</a> <a id="302" class="Symbol">()</a> <a id="305" class="Keyword">renaming</a> <a id="314" class="Symbol">(</a><a id="315" href="Agda.Builtin.Int.html#263" class="InductiveConstructor">+_</a> <a id="318" class="Symbol">to</a> <a id="321" class="InductiveConstructor">pos</a><a id="324" class="Symbol">)</a>
<a id="326" class="Keyword">open</a> <a id="331" class="Keyword">import</a> <a id="338" href="Data.Rational.html" class="Module">Data.Rational</a> <a id="352" class="Keyword">using</a> <a id="358" class="Symbol">(</a><a id="359" href="Data.Rational.Base.html#1421" class="Record">ℚ</a><a id="360" class="Symbol">;</a> <a id="362" href="Data.Rational.Base.html#7195" class="Function">floor</a><a id="367" class="Symbol">;</a> <a id="369" href="Data.Rational.Base.html#6394" class="Function Operator">_*_</a><a id="372" class="Symbol">;</a> <a id="374" href="Data.Rational.Base.html#6787" class="Function Operator">_÷_</a><a id="377" class="Symbol">;</a> <a id="379" href="Data.Rational.Base.html#3963" class="Function Operator">_/_</a><a id="382" class="Symbol">;</a> <a id="384" href="Data.Rational.Base.html#6484" class="Function Operator">_-_</a><a id="387" class="Symbol">;</a> <a id="389" href="Data.Rational.Base.html#5293" class="Function">&gt;-nonZero</a><a id="398" class="Symbol">;</a> <a id="400" href="Data.Rational.Base.html#6933" class="Function Operator">_⊓_</a><a id="403" class="Symbol">)</a>
                          <a id="431" class="Keyword">renaming</a> <a id="440" class="Symbol">(</a><a id="441" href="Data.Rational.Base.html#6855" class="Function Operator">_⊔_</a> <a id="445" class="Symbol">to</a> <a id="448" class="Function Operator">_⊔ℚ_</a><a id="452" class="Symbol">;</a> <a id="454" href="Data.Rational.Base.html#4577" class="Function">NonZero</a> <a id="462" class="Symbol">to</a> <a id="465" class="Function">NonZeroℚ</a><a id="473" class="Symbol">)</a>
<a id="475" class="Keyword">open</a> <a id="480" class="Keyword">import</a> <a id="487" href="Data.Rational.Literals.html" class="Module">Data.Rational.Literals</a> <a id="510" class="Keyword">using</a> <a id="516" class="Symbol">(</a><a id="517" href="Data.Rational.Literals.html#740" class="Function">number</a><a id="523" class="Symbol">;</a> <a id="525" href="Data.Rational.Literals.html#613" class="Function">fromℤ</a><a id="530" class="Symbol">)</a>
<a id="532" class="Keyword">open</a> <a id="537" class="Keyword">import</a> <a id="544" href="Data.Rational.Properties.html" class="Module">Data.Rational.Properties</a> <a id="569" class="Keyword">using</a> <a id="575" class="Symbol">(</a><a id="576" href="Data.Rational.Properties.html#7854" class="Function">pos⇒nonZero</a><a id="587" class="Symbol">;</a> <a id="589" href="Data.Rational.Properties.html#26962" class="Function">positive⁻¹</a><a id="599" class="Symbol">;</a> <a id="601" href="Data.Rational.Properties.html#36227" class="Function">+-mono-&lt;-≤</a><a id="611" class="Symbol">;</a> <a id="613" href="Data.Rational.Properties.html#11914" class="Function">normalize-pos</a><a id="626" class="Symbol">;</a> <a id="628" href="Data.Rational.Properties.html#58180" class="Function">p≤p⊔q</a><a id="633" class="Symbol">)</a>
<a id="635" class="Keyword">open</a> <a id="640" class="Keyword">import</a> <a id="647" href="Ledger.Prelude.Numeric.UnitInterval.html" class="Module">Ledger.Prelude.Numeric.UnitInterval</a>

<a id="684" class="Keyword">open</a> <a id="689" class="Keyword">import</a> <a id="696" href="Agda.Builtin.FromNat.html" class="Module">Agda.Builtin.FromNat</a>
<a id="717" class="Keyword">open</a>        <a id="729" href="Agda.Builtin.FromNat.html#196" class="Module">Number</a> <a id="736" href="Data.Rational.Literals.html#740" class="Function">number</a> <a id="743" class="Keyword">renaming</a> <a id="752" class="Symbol">(</a><a id="753" href="Agda.Builtin.FromNat.html#281" class="Field">fromNat</a> <a id="761" class="Symbol">to</a> <a id="764" class="Field">fromℕ</a><a id="769" class="Symbol">)</a>

<a id="772" class="Keyword">open</a> <a id="777" class="Keyword">import</a> <a id="784" href="Ledger.Conway.Specification.Certs.html" class="Module">Ledger.Conway.Specification.Certs</a> <a id="818" href="Ledger.Core.Specification.Transaction.html#1970" class="Function">govStructure</a>
<a id="831" class="Keyword">open</a> <a id="836" class="Keyword">import</a> <a id="843" href="Ledger.Conway.Specification.Ledger.html" class="Module">Ledger.Conway.Specification.Ledger</a> <a id="878" href="Ledger.Conway.Specification.Rewards.html#170" class="Bound">txs</a> <a id="882" href="Ledger.Conway.Specification.Rewards.html#233" class="Bound">abs</a>
<a id="886" class="Keyword">open</a> <a id="891" class="Keyword">import</a> <a id="898" href="Ledger.Prelude.html" class="Module">Ledger.Prelude</a> <a id="913" class="Keyword">hiding</a> <a id="920" class="Symbol">(</a><a id="921" href="Data.Nat.Base.html#7102" class="Function Operator">_/_</a><a id="924" class="Symbol">;</a> <a id="926" href="Agda.Builtin.Nat.html#539" class="Primitive Operator">_*_</a><a id="929" class="Symbol">;</a> <a id="931" href="Interface.TypeClasses.HasSubtract.html#223" class="Field Operator">_-_</a><a id="934" class="Symbol">;</a> <a id="936" href="Data.Nat.Base.html#3537" class="Function">&gt;-nonZero</a><a id="945" class="Symbol">;</a> <a id="947" href="Data.Nat.Base.html#5851" class="Function Operator">_⊓_</a><a id="950" class="Symbol">)</a>
<a id="952" class="Keyword">open</a> <a id="957" class="Keyword">import</a> <a id="964" href="Ledger.Conway.Specification.Utxo.html" class="Module">Ledger.Conway.Specification.Utxo</a> <a id="997" href="Ledger.Conway.Specification.Rewards.html#170" class="Bound">txs</a> <a id="1001" href="Ledger.Conway.Specification.Rewards.html#233" class="Bound">abs</a>


<a id="nonZero-max-1"></a><a id="1007" href="Ledger.Conway.Specification.Rewards.html#1007" class="Function">nonZero-max-1</a> <a id="1021" class="Symbol">:</a> <a id="1023" class="Symbol">∀</a> <a id="1025" class="Symbol">(</a><a id="1026" href="Ledger.Conway.Specification.Rewards.html#1026" class="Bound">n</a> <a id="1028" class="Symbol">:</a> <a id="1030" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a><a id="1031" class="Symbol">)</a> <a id="1033" class="Symbol">→</a> <a id="1035" href="Data.Nat.Base.html#3266" class="Record">NonZero</a> <a id="1043" class="Symbol">(</a><a id="1044" class="Number">1</a> <a id="1046" href="Data.Nat.Base.html#5485" class="Function Operator">⊔</a> <a id="1048" href="Ledger.Conway.Specification.Rewards.html#1026" class="Bound">n</a><a id="1049" class="Symbol">)</a>
<a id="1051" href="Ledger.Conway.Specification.Rewards.html#1007" class="Function">nonZero-max-1</a> <a id="1065" href="Agda.Builtin.Nat.html#221" class="InductiveConstructor">zero</a> <a id="1070" class="Symbol">=</a> <a id="1072" href="Data.Nat.Base.html#3359" class="Function">nonZero</a>
<a id="1080" href="Ledger.Conway.Specification.Rewards.html#1007" class="Function">nonZero-max-1</a> <a id="1094" class="Symbol">(</a><a id="1095" href="Agda.Builtin.Nat.html#234" class="InductiveConstructor">suc</a> <a id="1099" href="Ledger.Conway.Specification.Rewards.html#1099" class="Bound">n</a><a id="1100" class="Symbol">)</a> <a id="1102" class="Symbol">=</a> <a id="1104" href="Data.Nat.Base.html#3359" class="Function">nonZero</a>

<a id="nonZero-1/n"></a><a id="1113" href="Ledger.Conway.Specification.Rewards.html#1113" class="Function">nonZero-1/n</a> <a id="1125" class="Symbol">:</a> <a id="1127" class="Symbol">∀</a> <a id="1129" class="Symbol">(</a><a id="1130" href="Ledger.Conway.Specification.Rewards.html#1130" class="Bound">n</a> <a id="1132" class="Symbol">:</a> <a id="1134" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a><a id="1135" class="Symbol">)</a> <a id="1137" class="Symbol">→</a> <a id="1139" class="Symbol">.{{</a><a id="1142" href="Ledger.Conway.Specification.Rewards.html#1142" class="Bound">_</a> <a id="1144" class="Symbol">:</a> <a id="1146" href="Data.Nat.Base.html#3266" class="Record">NonZero</a> <a id="1154" href="Ledger.Conway.Specification.Rewards.html#1130" class="Bound">n</a><a id="1155" class="Symbol">}}</a> <a id="1158" class="Symbol">→</a> <a id="1160" href="Ledger.Conway.Specification.Rewards.html#465" class="Function">NonZeroℚ</a> <a id="1169" class="Symbol">(</a><a id="1170" class="Number">1</a> <a id="1172" href="Data.Rational.Base.html#3963" class="Function Operator">/</a> <a id="1174" href="Ledger.Conway.Specification.Rewards.html#1130" class="Bound">n</a><a id="1175" class="Symbol">)</a>
<a id="1177" href="Ledger.Conway.Specification.Rewards.html#1113" class="Function">nonZero-1/n</a> <a id="1189" href="Ledger.Conway.Specification.Rewards.html#1189" class="Bound">n</a> <a id="1191" class="Symbol">{{</a><a id="1193" href="Ledger.Conway.Specification.Rewards.html#1193" class="Bound">prf</a><a id="1196" class="Symbol">}}</a> <a id="1199" class="Symbol">=</a>
  <a id="1203" href="Data.Rational.Properties.html#7854" class="Function">pos⇒nonZero</a> <a id="1215" class="Symbol">(</a><a id="1216" class="Number">1</a> <a id="1218" href="Data.Rational.Base.html#3963" class="Function Operator">/</a> <a id="1220" href="Ledger.Conway.Specification.Rewards.html#1189" class="Bound">n</a><a id="1221" class="Symbol">)</a> <a id="1223" class="Symbol">{{</a><a id="1225" href="Data.Rational.Properties.html#11914" class="Function">normalize-pos</a> <a id="1239" class="Number">1</a> <a id="1241" href="Ledger.Conway.Specification.Rewards.html#1189" class="Bound">n</a> <a id="1243" class="Symbol">{{</a><a id="1245" href="Ledger.Conway.Specification.Rewards.html#1193" class="Bound">prf</a><a id="1248" class="Symbol">}}</a> <a id="1251" class="Symbol">{{_}}</a> <a id="1257" class="Symbol">}}</a>

<a id="nonZero-1+max0-x"></a><a id="1261" href="Ledger.Conway.Specification.Rewards.html#1261" class="Function">nonZero-1+max0-x</a> <a id="1278" class="Symbol">:</a> <a id="1280" class="Symbol">∀</a> <a id="1282" class="Symbol">(</a><a id="1283" href="Ledger.Conway.Specification.Rewards.html#1283" class="Bound">x</a> <a id="1285" class="Symbol">:</a> <a id="1287" href="Data.Rational.Base.html#1421" class="Record">ℚ</a><a id="1288" class="Symbol">)</a> <a id="1290" class="Symbol">→</a> <a id="1292" href="Ledger.Conway.Specification.Rewards.html#465" class="Function">NonZeroℚ</a> <a id="1301" class="Symbol">(</a><a id="1302" class="Number">1</a> <a id="1304" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="1306" class="Symbol">(</a><a id="1307" class="Number">0</a> <a id="1309" href="Ledger.Conway.Specification.Rewards.html#448" class="Function Operator">⊔ℚ</a> <a id="1312" href="Ledger.Conway.Specification.Rewards.html#1283" class="Bound">x</a><a id="1313" class="Symbol">))</a>
<a id="1316" href="Ledger.Conway.Specification.Rewards.html#1261" class="Function">nonZero-1+max0-x</a> <a id="1333" href="Ledger.Conway.Specification.Rewards.html#1333" class="Bound">x</a> <a id="1335" class="Symbol">=</a>
  <a id="1339" href="Data.Rational.Base.html#5293" class="Function">&gt;-nonZero</a> <a id="1349" class="Symbol">(</a><a id="1350" href="Data.Rational.Properties.html#36227" class="Function">+-mono-&lt;-≤</a> <a id="1361" class="Symbol">(</a><a id="1362" href="Data.Rational.Properties.html#26962" class="Function">positive⁻¹</a> <a id="1373" class="Number">1</a> <a id="1375" class="Symbol">{{_}})</a> <a id="1382" class="Symbol">(</a><a id="1383" href="Data.Rational.Properties.html#58180" class="Function">p≤p⊔q</a> <a id="1389" class="Number">0</a> <a id="1391" href="Ledger.Conway.Specification.Rewards.html#1333" class="Bound">x</a><a id="1392" class="Symbol">))</a>


<a id="maxPool"></a><a id="1397" href="Ledger.Conway.Specification.Rewards.html#1397" class="Function">maxPool</a> <a id="1405" class="Symbol">:</a> <a id="1407" href="Ledger.Conway.Specification.PParams.html#1687" class="Record">PParams</a> <a id="1415" class="Symbol">→</a> <a id="1417" href="Ledger.Prelude.Base.html#154" class="Function">Coin</a> <a id="1422" class="Symbol">→</a> <a id="1424" href="Ledger.Prelude.Numeric.UnitInterval.html#1777" class="Function">UnitInterval</a> <a id="1437" class="Symbol">→</a> <a id="1439" href="Ledger.Prelude.Numeric.UnitInterval.html#1777" class="Function">UnitInterval</a> <a id="1452" class="Symbol">→</a> <a id="1454" href="Ledger.Prelude.Base.html#154" class="Function">Coin</a>
<a id="1459" href="Ledger.Conway.Specification.Rewards.html#1397" class="Function">maxPool</a> <a id="1467" href="Ledger.Conway.Specification.Rewards.html#1467" class="Bound">pparams</a> <a id="1475" href="Ledger.Conway.Specification.Rewards.html#1475" class="Bound">rewardPot</a> <a id="1485" href="Ledger.Conway.Specification.Rewards.html#1485" class="Bound">stake</a> <a id="1491" href="Ledger.Conway.Specification.Rewards.html#1491" class="Bound">pledge</a> <a id="1498" class="Symbol">=</a> <a id="1500" href="Ledger.Conway.Specification.Rewards.html#2205" class="Function">rewardℕ</a>
  <a id="1510" class="Keyword">where</a>
    <a id="1520" href="Ledger.Conway.Specification.Rewards.html#1520" class="Function">a0</a>    <a id="1526" class="Symbol">=</a> <a id="1528" class="Number">0</a> <a id="1530" href="Ledger.Conway.Specification.Rewards.html#448" class="Function Operator">⊔ℚ</a> <a id="1533" href="Ledger.Conway.Specification.Rewards.html#1467" class="Bound">pparams</a> <a id="1541" class="Symbol">.</a><a id="1542" href="Ledger.Conway.Specification.PParams.html#2888" class="Field">PParams.a0</a>
    <a id="1557" href="Ledger.Conway.Specification.Rewards.html#1557" class="Function">1+a0</a>  <a id="1563" class="Symbol">=</a> <a id="1565" class="Number">1</a> <a id="1567" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="1569" href="Ledger.Conway.Specification.Rewards.html#1520" class="Function">a0</a>
    <a id="1576" href="Ledger.Conway.Specification.Rewards.html#1576" class="Function">nopt</a>  <a id="1582" class="Symbol">=</a> <a id="1584" class="Number">1</a> <a id="1586" href="Data.Nat.Base.html#5485" class="Function Operator">⊔</a> <a id="1588" href="Ledger.Conway.Specification.Rewards.html#1467" class="Bound">pparams</a> <a id="1596" class="Symbol">.</a><a id="1597" href="Ledger.Conway.Specification.PParams.html#2846" class="Field">PParams.nopt</a>


    <a id="1616" class="Keyword">instance</a>
      <a id="1631" href="Ledger.Conway.Specification.Rewards.html#1631" class="Function">nonZero-nopt</a> <a id="1644" class="Symbol">:</a> <a id="1646" href="Data.Nat.Base.html#3266" class="Record">NonZero</a> <a id="1654" href="Ledger.Conway.Specification.Rewards.html#1576" class="Function">nopt</a>
      <a id="1665" href="Ledger.Conway.Specification.Rewards.html#1631" class="Function">nonZero-nopt</a> <a id="1678" class="Symbol">=</a> <a id="1680" href="Ledger.Conway.Specification.Rewards.html#1007" class="Function">nonZero-max-1</a> <a id="1694" class="Symbol">(</a><a id="1695" href="Ledger.Conway.Specification.Rewards.html#1467" class="Bound">pparams</a> <a id="1703" class="Symbol">.</a><a id="1704" href="Ledger.Conway.Specification.PParams.html#2846" class="Field">PParams.nopt</a><a id="1716" class="Symbol">)</a>


    <a id="1724" href="Ledger.Conway.Specification.Rewards.html#1724" class="Function">z0</a>       <a id="1733" class="Symbol">=</a> <a id="1735" class="Number">1</a> <a id="1737" href="Data.Rational.Base.html#3963" class="Function Operator">/</a> <a id="1739" href="Ledger.Conway.Specification.Rewards.html#1576" class="Function">nopt</a>
    <a id="1748" href="Ledger.Conway.Specification.Rewards.html#1748" class="Function">stake&#39;</a>   <a id="1757" class="Symbol">=</a> <a id="1759" href="Ledger.Prelude.Numeric.UnitInterval.html#1989" class="Function">fromUnitInterval</a> <a id="1776" href="Ledger.Conway.Specification.Rewards.html#1485" class="Bound">stake</a> <a id="1782" href="Data.Rational.Base.html#6933" class="Function Operator">⊓</a> <a id="1784" href="Ledger.Conway.Specification.Rewards.html#1724" class="Function">z0</a>
    <a id="1791" href="Ledger.Conway.Specification.Rewards.html#1791" class="Function">pledge&#39;</a>  <a id="1800" class="Symbol">=</a> <a id="1802" href="Ledger.Prelude.Numeric.UnitInterval.html#1989" class="Function">fromUnitInterval</a> <a id="1819" href="Ledger.Conway.Specification.Rewards.html#1491" class="Bound">pledge</a> <a id="1826" href="Data.Rational.Base.html#6933" class="Function Operator">⊓</a> <a id="1828" href="Ledger.Conway.Specification.Rewards.html#1724" class="Function">z0</a>


    <a id="1837" class="Keyword">instance</a>
      <a id="1852" href="Ledger.Conway.Specification.Rewards.html#1852" class="Function">nonZeroz0</a> <a id="1862" class="Symbol">:</a> <a id="1864" href="Ledger.Conway.Specification.Rewards.html#465" class="Function">NonZeroℚ</a> <a id="1873" href="Ledger.Conway.Specification.Rewards.html#1724" class="Function">z0</a>
      <a id="1882" href="Ledger.Conway.Specification.Rewards.html#1852" class="Function">nonZeroz0</a> <a id="1892" class="Symbol">=</a> <a id="1894" href="Ledger.Conway.Specification.Rewards.html#1113" class="Function">nonZero-1/n</a> <a id="1906" href="Ledger.Conway.Specification.Rewards.html#1576" class="Function">nopt</a>

      <a id="1918" href="Ledger.Conway.Specification.Rewards.html#1918" class="Function">nonZero-1+a0</a> <a id="1931" class="Symbol">:</a> <a id="1933" href="Ledger.Conway.Specification.Rewards.html#465" class="Function">NonZeroℚ</a> <a id="1942" class="Symbol">(</a><a id="1943" href="Ledger.Conway.Specification.Rewards.html#1557" class="Function">1+a0</a><a id="1947" class="Symbol">)</a>
      <a id="1955" href="Ledger.Conway.Specification.Rewards.html#1918" class="Function">nonZero-1+a0</a> <a id="1968" class="Symbol">=</a> <a id="1970" href="Ledger.Conway.Specification.Rewards.html#1261" class="Function">nonZero-1+max0-x</a> <a id="1987" class="Symbol">(</a><a id="1988" href="Ledger.Conway.Specification.Rewards.html#1467" class="Bound">pparams</a> <a id="1996" class="Symbol">.</a><a id="1997" href="Ledger.Conway.Specification.PParams.html#2888" class="Field">PParams.a0</a><a id="2007" class="Symbol">)</a>


    <a id="2015" href="Ledger.Conway.Specification.Rewards.html#2015" class="Function">rewardℚ</a> <a id="2023" class="Symbol">=</a>  <a id="2026" href="Ledger.Conway.Specification.Rewards.html#764" class="Function">fromℕ</a> <a id="2032" href="Ledger.Conway.Specification.Rewards.html#1475" class="Bound">rewardPot</a> <a id="2042" href="Data.Rational.Base.html#6787" class="Function Operator">÷</a> <a id="2044" href="Ledger.Conway.Specification.Rewards.html#1557" class="Function">1+a0</a>
               <a id="2064" href="Data.Rational.Base.html#6394" class="Function Operator">*</a>  <a id="2067" class="Symbol">(</a>  <a id="2070" href="Ledger.Conway.Specification.Rewards.html#1748" class="Function">stake&#39;</a> <a id="2077" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="2079" href="Ledger.Conway.Specification.Rewards.html#1791" class="Function">pledge&#39;</a> <a id="2087" href="Data.Rational.Base.html#6394" class="Function Operator">*</a> <a id="2089" href="Ledger.Conway.Specification.Rewards.html#1520" class="Function">a0</a>
                    <a id="2112" href="Data.Rational.Base.html#6394" class="Function Operator">*</a> <a id="2114" class="Symbol">(</a> <a id="2116" href="Ledger.Conway.Specification.Rewards.html#1748" class="Function">stake&#39;</a> <a id="2123" href="Data.Rational.Base.html#6484" class="Function Operator">-</a> <a id="2125" href="Ledger.Conway.Specification.Rewards.html#1791" class="Function">pledge&#39;</a> <a id="2133" href="Data.Rational.Base.html#6394" class="Function Operator">*</a> <a id="2135" class="Symbol">(</a><a id="2136" href="Ledger.Conway.Specification.Rewards.html#1724" class="Function">z0</a> <a id="2139" href="Data.Rational.Base.html#6484" class="Function Operator">-</a> <a id="2141" href="Ledger.Conway.Specification.Rewards.html#1748" class="Function">stake&#39;</a><a id="2147" class="Symbol">)</a> <a id="2149" href="Data.Rational.Base.html#6787" class="Function Operator">÷</a> <a id="2151" href="Ledger.Conway.Specification.Rewards.html#1724" class="Function">z0</a> <a id="2154" class="Symbol">)</a>
                    <a id="2176" href="Data.Rational.Base.html#6787" class="Function Operator">÷</a> <a id="2178" href="Ledger.Conway.Specification.Rewards.html#1724" class="Function">z0</a>
                  <a id="2199" class="Symbol">)</a>
    <a id="2205" href="Ledger.Conway.Specification.Rewards.html#2205" class="Function">rewardℕ</a> <a id="2213" class="Symbol">=</a> <a id="2215" href="Prelude.html#3280" class="Function">posPart</a> <a id="2223" class="Symbol">(</a><a id="2224" href="Data.Rational.Base.html#7195" class="Function">floor</a> <a id="2230" href="Ledger.Conway.Specification.Rewards.html#2015" class="Function">rewardℚ</a><a id="2237" class="Symbol">)</a>


<a id="mkApparentPerformance"></a><a id="2241" href="Ledger.Conway.Specification.Rewards.html#2241" class="Function">mkApparentPerformance</a> <a id="2263" class="Symbol">:</a> <a id="2265" href="Ledger.Prelude.Numeric.UnitInterval.html#1777" class="Function">UnitInterval</a> <a id="2278" class="Symbol">→</a> <a id="2280" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a> <a id="2282" class="Symbol">→</a> <a id="2284" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a> <a id="2286" class="Symbol">→</a> <a id="2288" href="Data.Rational.Base.html#1421" class="Record">ℚ</a>
<a id="2290" href="Ledger.Conway.Specification.Rewards.html#2241" class="Function">mkApparentPerformance</a> <a id="2312" href="Ledger.Conway.Specification.Rewards.html#2312" class="Bound">stake</a> <a id="2318" href="Ledger.Conway.Specification.Rewards.html#2318" class="Bound">poolBlocks</a> <a id="2329" href="Ledger.Conway.Specification.Rewards.html#2329" class="Bound">totalBlocks</a> <a id="2341" class="Symbol">=</a> <a id="2343" href="Ledger.Conway.Specification.Rewards.html#2519" class="Function">ratioBlocks</a> <a id="2355" href="Ledger.Prelude.html#2064" class="Function Operator">÷₀</a> <a id="2358" class="Symbol">(</a><a id="2359" href="Ledger.Prelude.Numeric.UnitInterval.html#1989" class="Function">fromUnitInterval</a> <a id="2376" href="Ledger.Conway.Specification.Rewards.html#2312" class="Bound">stake</a><a id="2381" class="Symbol">)</a>
  <a id="2385" class="Keyword">where</a>


    <a id="2397" class="Keyword">instance</a>
      <a id="2412" href="Ledger.Conway.Specification.Rewards.html#2412" class="Function">nonZero-totalBlocks</a> <a id="2432" class="Symbol">:</a> <a id="2434" href="Data.Nat.Base.html#3266" class="Record">NonZero</a> <a id="2442" class="Symbol">(</a><a id="2443" class="Number">1</a> <a id="2445" href="Data.Nat.Base.html#5485" class="Function Operator">⊔</a> <a id="2447" href="Ledger.Conway.Specification.Rewards.html#2329" class="Bound">totalBlocks</a><a id="2458" class="Symbol">)</a>
      <a id="2466" href="Ledger.Conway.Specification.Rewards.html#2412" class="Function">nonZero-totalBlocks</a> <a id="2486" class="Symbol">=</a> <a id="2488" href="Ledger.Conway.Specification.Rewards.html#1007" class="Function">nonZero-max-1</a> <a id="2502" href="Ledger.Conway.Specification.Rewards.html#2329" class="Bound">totalBlocks</a>

    <a id="2519" href="Ledger.Conway.Specification.Rewards.html#2519" class="Function">ratioBlocks</a> <a id="2531" class="Symbol">:</a> <a id="2533" class="Symbol">.⦃</a> <a id="2536" href="Ledger.Conway.Specification.Rewards.html#2536" class="Bound">_</a> <a id="2538" class="Symbol">:</a> <a id="2540" href="Data.Nat.Base.html#3266" class="Record">NonZero</a> <a id="2548" class="Symbol">(</a><a id="2549" class="Number">1</a> <a id="2551" href="Data.Nat.Base.html#5485" class="Function Operator">⊔</a> <a id="2553" href="Ledger.Conway.Specification.Rewards.html#2329" class="Bound">totalBlocks</a><a id="2564" class="Symbol">)</a> <a id="2566" class="Symbol">⦄</a> <a id="2568" class="Symbol">→</a> <a id="2570" href="Data.Rational.Base.html#1421" class="Record">ℚ</a>


    <a id="2578" href="Ledger.Conway.Specification.Rewards.html#2519" class="Function">ratioBlocks</a> <a id="2590" class="Symbol">=</a> <a id="2592" class="Symbol">(</a><a id="2593" href="Ledger.Conway.Specification.Rewards.html#321" class="InductiveConstructor">pos</a> <a id="2597" href="Ledger.Conway.Specification.Rewards.html#2318" class="Bound">poolBlocks</a><a id="2607" class="Symbol">)</a> <a id="2609" href="Data.Rational.Base.html#3963" class="Function Operator">/</a> <a id="2611" class="Symbol">(</a><a id="2612" class="Number">1</a> <a id="2614" href="Data.Nat.Base.html#5485" class="Function Operator">⊔</a> <a id="2616" href="Ledger.Conway.Specification.Rewards.html#2329" class="Bound">totalBlocks</a><a id="2627" class="Symbol">)</a>


<a id="rewardOwners"></a><a id="2631" href="Ledger.Conway.Specification.Rewards.html#2631" class="Function">rewardOwners</a> <a id="2644" class="Symbol">:</a> <a id="2646" href="Ledger.Prelude.Base.html#154" class="Function">Coin</a> <a id="2651" class="Symbol">→</a> <a id="2653" href="Ledger.Core.Specification.Certs.html#336" class="Record">StakePoolParams</a> <a id="2669" class="Symbol">→</a> <a id="2671" href="Ledger.Prelude.Numeric.UnitInterval.html#1777" class="Function">UnitInterval</a> <a id="2684" class="Symbol">→</a> <a id="2686" href="Ledger.Prelude.Numeric.UnitInterval.html#1777" class="Function">UnitInterval</a> <a id="2699" class="Symbol">→</a> <a id="2701" href="Ledger.Prelude.Base.html#154" class="Function">Coin</a>
<a id="2706" href="Ledger.Conway.Specification.Rewards.html#2631" class="Function">rewardOwners</a> <a id="2719" href="Ledger.Conway.Specification.Rewards.html#2719" class="Bound">rewards</a> <a id="2727" href="Ledger.Conway.Specification.Rewards.html#2727" class="Bound">poolParams</a> <a id="2738" href="Ledger.Conway.Specification.Rewards.html#2738" class="Bound">ownerStake</a> <a id="2749" href="Ledger.Conway.Specification.Rewards.html#2749" class="Bound">stake</a> <a id="2755" class="Symbol">=</a> <a id="2757" href="Class.ToBool.html#342" class="Function Operator">if</a> <a id="2760" href="Ledger.Conway.Specification.Rewards.html#2719" class="Bound">rewards</a> <a id="2768" href="Class.HasOrder.Core.html#613" class="Field Operator">≤</a> <a id="2770" href="Ledger.Conway.Specification.Rewards.html#2983" class="Function">cost</a>
  <a id="2777" href="Class.ToBool.html#342" class="Function Operator">then</a> <a id="2782" href="Ledger.Conway.Specification.Rewards.html#2719" class="Bound">rewards</a>
  <a id="2792" href="Class.ToBool.html#342" class="Function Operator">else</a> <a id="2797" href="Ledger.Conway.Specification.Rewards.html#2983" class="Function">cost</a> <a id="2802" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="2804" href="Prelude.html#3280" class="Function">posPart</a> <a id="2812" class="Symbol">(</a><a id="2813" href="Data.Rational.Base.html#7195" class="Function">floor</a> <a id="2819" class="Symbol">(</a>
        <a id="2829" class="Symbol">(</a><a id="2830" href="Ledger.Conway.Specification.Rewards.html#764" class="Function">fromℕ</a> <a id="2836" href="Ledger.Conway.Specification.Rewards.html#2719" class="Bound">rewards</a> <a id="2844" href="Data.Rational.Base.html#6484" class="Function Operator">-</a> <a id="2846" href="Ledger.Conway.Specification.Rewards.html#764" class="Function">fromℕ</a> <a id="2852" href="Ledger.Conway.Specification.Rewards.html#2983" class="Function">cost</a><a id="2856" class="Symbol">)</a> <a id="2858" href="Data.Rational.Base.html#6394" class="Function Operator">*</a> <a id="2860" class="Symbol">(</a><a id="2861" href="Ledger.Conway.Specification.Rewards.html#3034" class="Function">margin</a> <a id="2868" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="2870" class="Symbol">(</a><a id="2871" class="Number">1</a> <a id="2873" href="Data.Rational.Base.html#6484" class="Function Operator">-</a> <a id="2875" href="Ledger.Conway.Specification.Rewards.html#3034" class="Function">margin</a><a id="2881" class="Symbol">)</a> <a id="2883" href="Data.Rational.Base.html#6394" class="Function Operator">*</a> <a id="2885" href="Ledger.Conway.Specification.Rewards.html#2911" class="Function">ratioStake</a><a id="2895" class="Symbol">)))</a>
  <a id="2901" class="Keyword">where</a>
    <a id="2911" href="Ledger.Conway.Specification.Rewards.html#2911" class="Function">ratioStake</a>  <a id="2923" class="Symbol">=</a> <a id="2925" href="Ledger.Prelude.Numeric.UnitInterval.html#1989" class="Function">fromUnitInterval</a> <a id="2942" href="Ledger.Conway.Specification.Rewards.html#2738" class="Bound">ownerStake</a> <a id="2953" href="Ledger.Prelude.html#2064" class="Function Operator">÷₀</a> <a id="2956" href="Ledger.Prelude.Numeric.UnitInterval.html#1989" class="Function">fromUnitInterval</a> <a id="2973" href="Ledger.Conway.Specification.Rewards.html#2749" class="Bound">stake</a>
    <a id="2983" href="Ledger.Conway.Specification.Rewards.html#2983" class="Function">cost</a>        <a id="2995" class="Symbol">=</a> <a id="2997" href="Ledger.Conway.Specification.Rewards.html#2727" class="Bound">poolParams</a> <a id="3008" class="Symbol">.</a><a id="3009" href="Ledger.Core.Specification.Certs.html#409" class="Field">StakePoolParams.cost</a>
    <a id="3034" href="Ledger.Conway.Specification.Rewards.html#3034" class="Function">margin</a>      <a id="3046" class="Symbol">=</a> <a id="3048" href="Ledger.Prelude.Numeric.UnitInterval.html#1989" class="Function">fromUnitInterval</a> <a id="3065" class="Symbol">(</a><a id="3066" href="Ledger.Conway.Specification.Rewards.html#2727" class="Bound">poolParams</a> <a id="3077" class="Symbol">.</a><a id="3078" href="Ledger.Core.Specification.Certs.html#436" class="Field">StakePoolParams.margin</a><a id="3100" class="Symbol">)</a>

<a id="rewardMember"></a><a id="3103" href="Ledger.Conway.Specification.Rewards.html#3103" class="Function">rewardMember</a> <a id="3116" class="Symbol">:</a> <a id="3118" href="Ledger.Prelude.Base.html#154" class="Function">Coin</a> <a id="3123" class="Symbol">→</a> <a id="3125" href="Ledger.Core.Specification.Certs.html#336" class="Record">StakePoolParams</a> <a id="3141" class="Symbol">→</a> <a id="3143" href="Ledger.Prelude.Numeric.UnitInterval.html#1777" class="Function">UnitInterval</a> <a id="3156" class="Symbol">→</a> <a id="3158" href="Ledger.Prelude.Numeric.UnitInterval.html#1777" class="Function">UnitInterval</a> <a id="3171" class="Symbol">→</a> <a id="3173" href="Ledger.Prelude.Base.html#154" class="Function">Coin</a>
<a id="3178" href="Ledger.Conway.Specification.Rewards.html#3103" class="Function">rewardMember</a> <a id="3191" href="Ledger.Conway.Specification.Rewards.html#3191" class="Bound">rewards</a> <a id="3199" href="Ledger.Conway.Specification.Rewards.html#3199" class="Bound">poolParams</a> <a id="3210" href="Ledger.Conway.Specification.Rewards.html#3210" class="Bound">memberStake</a> <a id="3222" href="Ledger.Conway.Specification.Rewards.html#3222" class="Bound">stake</a> <a id="3228" class="Symbol">=</a> <a id="3230" href="Class.ToBool.html#342" class="Function Operator">if</a> <a id="3233" href="Ledger.Conway.Specification.Rewards.html#3191" class="Bound">rewards</a> <a id="3241" href="Class.HasOrder.Core.html#613" class="Field Operator">≤</a> <a id="3243" href="Ledger.Conway.Specification.Rewards.html#3436" class="Function">cost</a>
  <a id="3250" href="Class.ToBool.html#342" class="Function Operator">then</a> <a id="3255" class="Number">0</a>
  <a id="3259" href="Class.ToBool.html#342" class="Function Operator">else</a> <a id="3264" href="Prelude.html#3280" class="Function">posPart</a> <a id="3272" class="Symbol">(</a><a id="3273" href="Data.Rational.Base.html#7195" class="Function">floor</a> <a id="3279" class="Symbol">(</a>
         <a id="3290" class="Symbol">(</a><a id="3291" href="Ledger.Conway.Specification.Rewards.html#764" class="Function">fromℕ</a> <a id="3297" href="Ledger.Conway.Specification.Rewards.html#3191" class="Bound">rewards</a> <a id="3305" href="Data.Rational.Base.html#6484" class="Function Operator">-</a> <a id="3307" href="Ledger.Conway.Specification.Rewards.html#764" class="Function">fromℕ</a> <a id="3313" href="Ledger.Conway.Specification.Rewards.html#3436" class="Function">cost</a><a id="3317" class="Symbol">)</a> <a id="3319" href="Data.Rational.Base.html#6394" class="Function Operator">*</a> <a id="3321" class="Symbol">((</a><a id="3323" class="Number">1</a> <a id="3325" href="Data.Rational.Base.html#6484" class="Function Operator">-</a> <a id="3327" href="Ledger.Conway.Specification.Rewards.html#3487" class="Function">margin</a><a id="3333" class="Symbol">)</a> <a id="3335" href="Data.Rational.Base.html#6394" class="Function Operator">*</a> <a id="3337" href="Ledger.Conway.Specification.Rewards.html#3363" class="Function">ratioStake</a><a id="3347" class="Symbol">)))</a>
  <a id="3353" class="Keyword">where</a>
    <a id="3363" href="Ledger.Conway.Specification.Rewards.html#3363" class="Function">ratioStake</a>  <a id="3375" class="Symbol">=</a> <a id="3377" href="Ledger.Prelude.Numeric.UnitInterval.html#1989" class="Function">fromUnitInterval</a> <a id="3394" href="Ledger.Conway.Specification.Rewards.html#3210" class="Bound">memberStake</a> <a id="3406" href="Ledger.Prelude.html#2064" class="Function Operator">÷₀</a> <a id="3409" href="Ledger.Prelude.Numeric.UnitInterval.html#1989" class="Function">fromUnitInterval</a> <a id="3426" href="Ledger.Conway.Specification.Rewards.html#3222" class="Bound">stake</a>
    <a id="3436" href="Ledger.Conway.Specification.Rewards.html#3436" class="Function">cost</a>        <a id="3448" class="Symbol">=</a> <a id="3450" href="Ledger.Conway.Specification.Rewards.html#3199" class="Bound">poolParams</a> <a id="3461" class="Symbol">.</a><a id="3462" href="Ledger.Core.Specification.Certs.html#409" class="Field">StakePoolParams.cost</a>
    <a id="3487" href="Ledger.Conway.Specification.Rewards.html#3487" class="Function">margin</a>      <a id="3499" class="Symbol">=</a> <a id="3501" href="Ledger.Prelude.Numeric.UnitInterval.html#1989" class="Function">fromUnitInterval</a> <a id="3518" class="Symbol">(</a><a id="3519" href="Ledger.Conway.Specification.Rewards.html#3199" class="Bound">poolParams</a> <a id="3530" class="Symbol">.</a><a id="3531" href="Ledger.Core.Specification.Certs.html#436" class="Field">StakePoolParams.margin</a><a id="3553" class="Symbol">)</a>


<a id="rewardOnePool"></a><a id="3557" href="Ledger.Conway.Specification.Rewards.html#3557" class="Function">rewardOnePool</a> <a id="3571" class="Symbol">:</a>  <a id="3574" href="Ledger.Conway.Specification.PParams.html#1687" class="Record">PParams</a> <a id="3582" class="Symbol">→</a> <a id="3584" href="Ledger.Prelude.Base.html#154" class="Function">Coin</a> <a id="3589" class="Symbol">→</a> <a id="3591" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a> <a id="3593" class="Symbol">→</a> <a id="3595" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a> <a id="3597" class="Symbol">→</a> <a id="3599" href="Ledger.Core.Specification.Certs.html#336" class="Record">StakePoolParams</a>
                 <a id="3632" class="Symbol">→</a> <a id="3634" href="Ledger.Core.Specification.Certs.html#1331" class="Function">Stake</a> <a id="3640" class="Symbol">→</a> <a id="3642" href="Ledger.Prelude.Numeric.UnitInterval.html#1777" class="Function">UnitInterval</a> <a id="3655" class="Symbol">→</a> <a id="3657" href="Ledger.Prelude.Numeric.UnitInterval.html#1777" class="Function">UnitInterval</a> <a id="3670" class="Symbol">→</a> <a id="3672" href="Ledger.Prelude.Base.html#154" class="Function">Coin</a> <a id="3677" class="Symbol">→</a> <a id="3679" href="Ledger.Core.Specification.Certs.html#1331" class="Function">Stake</a>

<a id="3686" href="Ledger.Conway.Specification.Rewards.html#3557" class="Function">rewardOnePool</a> <a id="3700" href="Ledger.Conway.Specification.Rewards.html#3700" class="Bound">pp</a> <a id="3703" href="Ledger.Conway.Specification.Rewards.html#3703" class="Bound">rewardPot</a> <a id="3713" href="Ledger.Conway.Specification.Rewards.html#3713" class="Bound">n</a> <a id="3715" href="Ledger.Conway.Specification.Rewards.html#3715" class="Bound">N</a> <a id="3717" href="Ledger.Conway.Specification.Rewards.html#3717" class="Bound">poolParams</a> <a id="3728" href="Ledger.Conway.Specification.Rewards.html#3728" class="Bound">stakeDistr</a> <a id="3739" href="Ledger.Conway.Specification.Rewards.html#3739" class="Bound">σ</a> <a id="3741" href="Ledger.Conway.Specification.Rewards.html#3741" class="Bound">σa</a> <a id="3744" href="Ledger.Conway.Specification.Rewards.html#3744" class="Bound">tot</a> <a id="3748" class="Symbol">=</a> <a id="3750" href="Ledger.Conway.Specification.Rewards.html#4512" class="Function">memberRewards</a> <a id="3764" href="Axiom.Set.Map.Dec.html#2052" class="Function Operator">∪⁺</a> <a id="3767" href="Ledger.Conway.Specification.Rewards.html#4660" class="Function">ownersRewards</a>
  <a id="3783" class="Keyword">where</a>
  <a id="3791" href="Ledger.Conway.Specification.Rewards.html#3791" class="Function">mkRelativeStake</a> <a id="3807" class="Symbol">:</a> <a id="3809" href="Ledger.Prelude.Base.html#154" class="Function">Coin</a> <a id="3814" class="Symbol">→</a> <a id="3816" href="Ledger.Prelude.Numeric.UnitInterval.html#1777" class="Function">UnitInterval</a>
  <a id="3831" href="Ledger.Conway.Specification.Rewards.html#3791" class="Function">mkRelativeStake</a> <a id="3847" class="Symbol">=</a> <a id="3849" class="Symbol">λ</a> <a id="3851" href="Ledger.Conway.Specification.Rewards.html#3851" class="Bound">coin</a> <a id="3856" class="Symbol">→</a> <a id="3858" href="Ledger.Prelude.Numeric.UnitInterval.html#2765" class="Function">clamp</a> <a id="3864" class="Symbol">(</a><a id="3865" href="Ledger.Conway.Specification.Rewards.html#3851" class="Bound">coin</a> <a id="3870" href="Ledger.Prelude.html#1945" class="Function Operator">/₀</a> <a id="3873" href="Ledger.Conway.Specification.Rewards.html#3744" class="Bound">tot</a><a id="3876" class="Symbol">)</a>

  <a id="3881" href="Ledger.Conway.Specification.Rewards.html#3881" class="Function">owners</a> <a id="3888" class="Symbol">:</a> <a id="3890" href="abstract-set-theory.FiniteSetTheory.html#488" class="Function Operator">ℙ</a> <a id="3892" href="Ledger.Core.Specification.Address.html#259" class="Datatype">Credential</a>
  <a id="3905" href="Ledger.Conway.Specification.Rewards.html#3881" class="Function">owners</a> <a id="3912" class="Symbol">=</a> <a id="3914" href="abstract-set-theory.FiniteSetTheory.html#519" class="Function">mapˢ</a> <a id="3919" href="Ledger.Core.Specification.Address.html#285" class="InductiveConstructor">KeyHashObj</a> <a id="3930" class="Symbol">(</a><a id="3931" href="Ledger.Conway.Specification.Rewards.html#3717" class="Bound">poolParams</a> <a id="3942" class="Symbol">.</a><a id="3943" href="Ledger.Core.Specification.Certs.html#377" class="Field">StakePoolParams.owners</a><a id="3965" class="Symbol">)</a>

  <a id="3970" href="Ledger.Conway.Specification.Rewards.html#3970" class="Function">ownerStake</a> <a id="3981" href="Ledger.Conway.Specification.Rewards.html#3981" class="Function">pledge</a> <a id="3988" href="Ledger.Conway.Specification.Rewards.html#3988" class="Function">maxP</a> <a id="3993" href="Ledger.Conway.Specification.Rewards.html#3993" class="Function">poolReward</a> <a id="4004" class="Symbol">:</a> <a id="4006" href="Ledger.Prelude.Base.html#154" class="Function">Coin</a>
  <a id="4013" href="Ledger.Conway.Specification.Rewards.html#3970" class="Function">ownerStake</a>  <a id="4025" class="Symbol">=</a> <a id="4027" href="abstract-set-theory.FiniteSetTheory.html#4312" class="Function">∑[</a> <a id="4030" href="Ledger.Conway.Specification.Rewards.html#4030" class="Bound">c</a> <a id="4032" href="abstract-set-theory.FiniteSetTheory.html#4312" class="Function">←</a> <a id="4034" href="Ledger.Conway.Specification.Rewards.html#3728" class="Bound">stakeDistr</a> <a id="4045" href="Axiom.Set.Map.html#13534" class="Function Operator">∣</a> <a id="4047" href="Ledger.Conway.Specification.Rewards.html#3881" class="Function">owners</a> <a id="4054" href="abstract-set-theory.FiniteSetTheory.html#4312" class="Function">]</a> <a id="4056" href="Ledger.Conway.Specification.Rewards.html#4030" class="Bound">c</a>
  <a id="4060" href="Ledger.Conway.Specification.Rewards.html#3981" class="Function">pledge</a>      <a id="4072" class="Symbol">=</a> <a id="4074" href="Ledger.Conway.Specification.Rewards.html#3717" class="Bound">poolParams</a> <a id="4085" class="Symbol">.</a><a id="4086" href="Ledger.Core.Specification.Certs.html#471" class="Field">StakePoolParams.pledge</a>
  <a id="4111" href="Ledger.Conway.Specification.Rewards.html#3988" class="Function">maxP</a>        <a id="4123" class="Symbol">=</a>  <a id="4126" href="Class.ToBool.html#342" class="Function Operator">if</a> <a id="4129" href="Ledger.Conway.Specification.Rewards.html#3981" class="Function">pledge</a> <a id="4136" href="Class.HasOrder.Core.html#613" class="Field Operator">≤</a> <a id="4138" href="Ledger.Conway.Specification.Rewards.html#3970" class="Function">ownerStake</a>
                 <a id="4166" href="Class.ToBool.html#342" class="Function Operator">then</a> <a id="4171" href="Ledger.Conway.Specification.Rewards.html#1397" class="Function">maxPool</a> <a id="4179" href="Ledger.Conway.Specification.Rewards.html#3700" class="Bound">pp</a> <a id="4182" href="Ledger.Conway.Specification.Rewards.html#3703" class="Bound">rewardPot</a> <a id="4192" href="Ledger.Conway.Specification.Rewards.html#3739" class="Bound">σ</a> <a id="4194" class="Symbol">(</a><a id="4195" href="Ledger.Conway.Specification.Rewards.html#3791" class="Function">mkRelativeStake</a> <a id="4211" href="Ledger.Conway.Specification.Rewards.html#3981" class="Function">pledge</a><a id="4217" class="Symbol">)</a>
                 <a id="4236" href="Class.ToBool.html#342" class="Function Operator">else</a> <a id="4241" class="Number">0</a>
  <a id="4245" href="Ledger.Conway.Specification.Rewards.html#3993" class="Function">poolReward</a>  <a id="4257" class="Symbol">=</a> <a id="4259" href="Prelude.html#3280" class="Function">posPart</a> <a id="4267" href="Function.Base.html#1993" class="Function Operator">$</a> <a id="4269" href="Data.Rational.Base.html#7195" class="Function">floor</a> <a id="4275" href="Function.Base.html#1993" class="Function Operator">$</a> <a id="4277" class="Symbol">(</a><a id="4278" href="Ledger.Conway.Specification.Rewards.html#2241" class="Function">mkApparentPerformance</a> <a id="4300" href="Ledger.Conway.Specification.Rewards.html#3741" class="Bound">σa</a> <a id="4303" href="Ledger.Conway.Specification.Rewards.html#3713" class="Bound">n</a> <a id="4305" href="Ledger.Conway.Specification.Rewards.html#3715" class="Bound">N</a><a id="4306" class="Symbol">)</a> <a id="4308" href="Data.Rational.Base.html#6394" class="Function Operator">*</a> <a id="4310" href="Ledger.Conway.Specification.Rewards.html#764" class="Function">fromℕ</a> <a id="4316" href="Ledger.Conway.Specification.Rewards.html#3988" class="Function">maxP</a>

  <a id="4324" href="Ledger.Conway.Specification.Rewards.html#4324" class="Function Operator">stakeMap[_]</a> <a id="4336" class="Symbol">:</a>  <a id="4339" class="Symbol">(</a><a id="4340" href="Ledger.Prelude.Base.html#154" class="Function">Coin</a> <a id="4345" class="Symbol">→</a> <a id="4347" href="Ledger.Core.Specification.Certs.html#336" class="Record">StakePoolParams</a> <a id="4363" class="Symbol">→</a> <a id="4365" href="Ledger.Prelude.Numeric.UnitInterval.html#1777" class="Function">UnitInterval</a> <a id="4378" class="Symbol">→</a> <a id="4380" href="Ledger.Prelude.Numeric.UnitInterval.html#1777" class="Function">UnitInterval</a> <a id="4393" class="Symbol">→</a> <a id="4395" href="Ledger.Prelude.Base.html#154" class="Function">Coin</a><a id="4399" class="Symbol">)</a>
                 <a id="4418" class="Symbol">→</a> <a id="4420" href="Ledger.Prelude.Base.html#154" class="Function">Coin</a> <a id="4425" class="Symbol">→</a> <a id="4427" href="Ledger.Prelude.Numeric.UnitInterval.html#1777" class="Function">UnitInterval</a> <a id="4440" class="Symbol">→</a> <a id="4442" href="Ledger.Prelude.Base.html#154" class="Function">Coin</a>
  <a id="4449" href="Ledger.Conway.Specification.Rewards.html#4324" class="Function Operator">stakeMap[</a> <a id="4459" href="Ledger.Conway.Specification.Rewards.html#4459" class="Bound">f</a> <a id="4461" href="Ledger.Conway.Specification.Rewards.html#4324" class="Function Operator">]</a> <a id="4463" class="Symbol">=</a> <a id="4465" class="Symbol">(</a><a id="4466" href="Ledger.Conway.Specification.Rewards.html#4459" class="Bound">f</a> <a id="4468" href="Ledger.Conway.Specification.Rewards.html#3993" class="Function">poolReward</a> <a id="4479" href="Ledger.Conway.Specification.Rewards.html#3717" class="Bound">poolParams</a><a id="4489" class="Symbol">)</a> <a id="4491" href="Function.Base.html#1134" class="Function Operator">∘</a> <a id="4493" href="Ledger.Conway.Specification.Rewards.html#3791" class="Function">mkRelativeStake</a>

  <a id="4512" href="Ledger.Conway.Specification.Rewards.html#4512" class="Function">memberRewards</a> <a id="4526" class="Symbol">:</a> <a id="4528" href="Ledger.Core.Specification.Certs.html#1331" class="Function">Stake</a>
  <a id="4536" href="Ledger.Conway.Specification.Rewards.html#4512" class="Function">memberRewards</a> <a id="4550" class="Symbol">=</a> <a id="4552" href="Axiom.Set.Map.html#7106" class="Function">mapValues</a> <a id="4562" class="Symbol">(λ</a> <a id="4565" href="Ledger.Conway.Specification.Rewards.html#4565" class="Bound">coin</a> <a id="4570" class="Symbol">→</a> <a id="4572" href="Ledger.Conway.Specification.Rewards.html#4324" class="Function Operator">stakeMap[</a> <a id="4582" href="Ledger.Conway.Specification.Rewards.html#3103" class="Function">rewardMember</a> <a id="4595" href="Ledger.Conway.Specification.Rewards.html#4324" class="Function Operator">]</a> <a id="4597" href="Ledger.Conway.Specification.Rewards.html#4565" class="Bound">coin</a> <a id="4602" href="Ledger.Conway.Specification.Rewards.html#3739" class="Bound">σ</a><a id="4603" class="Symbol">)</a>
                            <a id="4633" class="Symbol">(</a><a id="4634" href="Ledger.Conway.Specification.Rewards.html#3728" class="Bound">stakeDistr</a> <a id="4645" href="Axiom.Set.Map.html#13604" class="Function Operator">∣</a> <a id="4647" href="Ledger.Conway.Specification.Rewards.html#3881" class="Function">owners</a> <a id="4654" href="Axiom.Set.Map.html#13604" class="Function Operator">ᶜ</a><a id="4655" class="Symbol">)</a>

  <a id="4660" href="Ledger.Conway.Specification.Rewards.html#4660" class="Function">ownersRewards</a> <a id="4674" class="Symbol">:</a> <a id="4676" href="Ledger.Core.Specification.Certs.html#1331" class="Function">Stake</a>
  <a id="4684" href="Ledger.Conway.Specification.Rewards.html#4660" class="Function">ownersRewards</a> <a id="4698" class="Symbol">=</a>  <a id="4701" href="Axiom.Set.Map.html#5626" class="Function Operator">❴</a> <a id="4703" href="Ledger.Conway.Specification.Rewards.html#3717" class="Bound">poolParams</a> <a id="4714" class="Symbol">.</a><a id="4715" href="Ledger.Core.Specification.Certs.html#498" class="Field">StakePoolParams.rewardAccount</a>
                   <a id="4764" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="4766" href="Ledger.Conway.Specification.Rewards.html#4324" class="Function Operator">stakeMap[</a> <a id="4776" href="Ledger.Conway.Specification.Rewards.html#2631" class="Function">rewardOwners</a> <a id="4789" href="Ledger.Conway.Specification.Rewards.html#4324" class="Function Operator">]</a> <a id="4791" href="Ledger.Conway.Specification.Rewards.html#3970" class="Function">ownerStake</a> <a id="4802" href="Ledger.Conway.Specification.Rewards.html#3739" class="Bound">σ</a> <a id="4804" href="Axiom.Set.Map.html#5626" class="Function Operator">❵ᵐ</a>


<a id="poolStake"></a><a id="4809" href="Ledger.Conway.Specification.Rewards.html#4809" class="Function">poolStake</a>  <a id="4820" class="Symbol">:</a> <a id="4822" href="Ledger.Core.Specification.Crypto.html#1386" class="Function">KeyHash</a> <a id="4830" class="Symbol">→</a> <a id="4832" href="Ledger.Core.Specification.Certs.html#1371" class="Function">StakeDelegs</a> <a id="4844" class="Symbol">→</a> <a id="4846" href="Ledger.Core.Specification.Certs.html#1331" class="Function">Stake</a> <a id="4852" class="Symbol">→</a> <a id="4854" href="Ledger.Core.Specification.Certs.html#1331" class="Function">Stake</a>
<a id="4860" href="Ledger.Conway.Specification.Rewards.html#4809" class="Function">poolStake</a> <a id="4870" href="Ledger.Conway.Specification.Rewards.html#4870" class="Bound">hk</a> <a id="4873" href="Ledger.Conway.Specification.Rewards.html#4873" class="Bound">delegs</a> <a id="4880" href="Ledger.Conway.Specification.Rewards.html#4880" class="Bound">stake</a> <a id="4886" class="Symbol">=</a> <a id="4888" href="Ledger.Conway.Specification.Rewards.html#4880" class="Bound">stake</a> <a id="4894" href="Axiom.Set.Map.html#13534" class="Function Operator">∣</a> <a id="4896" href="Class.IsSet.html#916" class="Function">dom</a> <a id="4900" class="Symbol">(</a><a id="4901" href="Ledger.Conway.Specification.Rewards.html#4873" class="Bound">delegs</a> <a id="4908" href="Axiom.Set.Map.html#17773" class="Function Operator">∣^</a> <a id="4911" href="Class.HasSingleton.html#288" class="Field Operator">❴</a> <a id="4913" href="Ledger.Conway.Specification.Rewards.html#4870" class="Bound">hk</a> <a id="4916" href="Class.HasSingleton.html#288" class="Field Operator">❵</a><a id="4917" class="Symbol">)</a>


<a id="BlocksMade"></a><a id="4921" href="Ledger.Conway.Specification.Rewards.html#4921" class="Function">BlocksMade</a> <a id="4932" class="Symbol">:</a> <a id="4934" href="Agda.Primitive.html#388" class="Primitive">Type</a>
<a id="4939" href="Ledger.Conway.Specification.Rewards.html#4921" class="Function">BlocksMade</a> <a id="4950" class="Symbol">=</a> <a id="4952" href="Ledger.Core.Specification.Crypto.html#1386" class="Function">KeyHash</a> <a id="4960" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="4962" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a>

<a id="uncurryᵐ"></a><a id="4965" href="Ledger.Conway.Specification.Rewards.html#4965" class="Function">uncurryᵐ</a> <a id="4974" class="Symbol">:</a>


  <a id="4980" class="Symbol">∀</a> <a id="4982" class="Symbol">{</a><a id="4983" href="Ledger.Conway.Specification.Rewards.html#4983" class="Bound">A</a> <a id="4985" href="Ledger.Conway.Specification.Rewards.html#4985" class="Bound">B</a> <a id="4987" href="Ledger.Conway.Specification.Rewards.html#4987" class="Bound">C</a> <a id="4989" class="Symbol">:</a> <a id="4991" href="Agda.Primitive.html#388" class="Primitive">Type</a><a id="4995" class="Symbol">}</a> <a id="4997" class="Symbol">⦃</a> <a id="4999" href="Ledger.Conway.Specification.Rewards.html#4999" class="Bound">_</a> <a id="5001" class="Symbol">:</a> <a id="5003" href="Class.DecEq.Core.html#126" class="Record">DecEq</a> <a id="5009" href="Ledger.Conway.Specification.Rewards.html#4983" class="Bound">A</a> <a id="5011" class="Symbol">⦄</a> <a id="5013" class="Symbol">⦃</a> <a id="5015" href="Ledger.Conway.Specification.Rewards.html#5015" class="Bound">_</a> <a id="5017" class="Symbol">:</a> <a id="5019" href="Class.DecEq.Core.html#126" class="Record">DecEq</a> <a id="5025" href="Ledger.Conway.Specification.Rewards.html#4985" class="Bound">B</a> <a id="5027" class="Symbol">⦄</a> <a id="5029" class="Symbol">→</a>


  <a id="5035" href="Ledger.Conway.Specification.Rewards.html#4983" class="Bound">A</a> <a id="5037" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="5039" class="Symbol">(</a><a id="5040" href="Ledger.Conway.Specification.Rewards.html#4985" class="Bound">B</a> <a id="5042" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="5044" href="Ledger.Conway.Specification.Rewards.html#4987" class="Bound">C</a><a id="5045" class="Symbol">)</a> <a id="5047" class="Symbol">→</a> <a id="5049" class="Symbol">(</a><a id="5050" href="Ledger.Conway.Specification.Rewards.html#4983" class="Bound">A</a> <a id="5052" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="5054" href="Ledger.Conway.Specification.Rewards.html#4985" class="Bound">B</a><a id="5055" class="Symbol">)</a> <a id="5057" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="5059" href="Ledger.Conway.Specification.Rewards.html#4987" class="Bound">C</a>


<a id="5063" href="Ledger.Conway.Specification.Rewards.html#4965" class="Function">uncurryᵐ</a> <a id="5072" class="Symbol">{</a><a id="5073" href="Ledger.Conway.Specification.Rewards.html#5073" class="Bound">A</a><a id="5074" class="Symbol">}</a> <a id="5076" class="Symbol">{</a><a id="5077" href="Ledger.Conway.Specification.Rewards.html#5077" class="Bound">B</a><a id="5078" class="Symbol">}</a> <a id="5080" class="Symbol">{</a><a id="5081" href="Ledger.Conway.Specification.Rewards.html#5081" class="Bound">C</a><a id="5082" class="Symbol">}</a> <a id="5084" href="Ledger.Conway.Specification.Rewards.html#5084" class="Bound">abc</a> <a id="5088" class="Symbol">=</a> <a id="5090" href="Axiom.Set.Map.html#13316" class="Function">mapFromPartialFun</a> <a id="5108" href="Ledger.Conway.Specification.Rewards.html#5136" class="Function">lookup&#39;</a> <a id="5116" href="Ledger.Conway.Specification.Rewards.html#5294" class="Function">domain&#39;</a>
  <a id="5126" class="Keyword">where</a>
    <a id="5136" href="Ledger.Conway.Specification.Rewards.html#5136" class="Function">lookup&#39;</a> <a id="5144" class="Symbol">:</a> <a id="5146" class="Symbol">(</a><a id="5147" href="Ledger.Conway.Specification.Rewards.html#5073" class="Bound">A</a> <a id="5149" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="5151" href="Ledger.Conway.Specification.Rewards.html#5077" class="Bound">B</a><a id="5152" class="Symbol">)</a> <a id="5154" class="Symbol">→</a> <a id="5156" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="5162" href="Ledger.Conway.Specification.Rewards.html#5081" class="Bound">C</a>
    <a id="5168" href="Ledger.Conway.Specification.Rewards.html#5136" class="Function">lookup&#39;</a> <a id="5176" class="Symbol">(</a><a id="5177" href="Ledger.Conway.Specification.Rewards.html#5177" class="Bound">a</a> <a id="5179" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5181" href="Ledger.Conway.Specification.Rewards.html#5181" class="Bound">b</a><a id="5182" class="Symbol">)</a> <a id="5184" class="Symbol">=</a> <a id="5186" href="Axiom.Set.Map.html#17167" class="Function">lookupᵐ?</a> <a id="5195" href="Ledger.Conway.Specification.Rewards.html#5084" class="Bound">abc</a> <a id="5199" href="Ledger.Conway.Specification.Rewards.html#5177" class="Bound">a</a> <a id="5201" href="Class.Monad.Core.html#337" class="Field Operator">&gt;&gt;=</a> <a id="5205" class="Symbol">(λ</a> <a id="5208" href="Ledger.Conway.Specification.Rewards.html#5208" class="Bound">bc</a> <a id="5211" class="Symbol">→</a> <a id="5213" href="Axiom.Set.Map.html#17167" class="Function">lookupᵐ?</a> <a id="5222" href="Ledger.Conway.Specification.Rewards.html#5208" class="Bound">bc</a> <a id="5225" href="Ledger.Conway.Specification.Rewards.html#5181" class="Bound">b</a><a id="5226" class="Symbol">)</a>

    <a id="5233" href="Ledger.Conway.Specification.Rewards.html#5233" class="Function">joinˢ</a> <a id="5239" class="Symbol">:</a> <a id="5241" class="Symbol">∀</a> <a id="5243" class="Symbol">{</a><a id="5244" href="Ledger.Conway.Specification.Rewards.html#5244" class="Bound">X</a><a id="5245" class="Symbol">}</a> <a id="5247" class="Symbol">→</a> <a id="5249" href="abstract-set-theory.FiniteSetTheory.html#488" class="Function Operator">ℙ</a> <a id="5251" class="Symbol">(</a><a id="5252" href="abstract-set-theory.FiniteSetTheory.html#488" class="Function Operator">ℙ</a> <a id="5254" href="Ledger.Conway.Specification.Rewards.html#5244" class="Bound">X</a><a id="5255" class="Symbol">)</a> <a id="5257" class="Symbol">→</a> <a id="5259" href="abstract-set-theory.FiniteSetTheory.html#488" class="Function Operator">ℙ</a> <a id="5261" href="Ledger.Conway.Specification.Rewards.html#5244" class="Bound">X</a>
    <a id="5267" href="Ledger.Conway.Specification.Rewards.html#5233" class="Function">joinˢ</a> <a id="5273" class="Symbol">=</a> <a id="5275" href="Axiom.Set.html#7207" class="Function">concatMapˢ</a> <a id="5286" href="Function.Base.html#704" class="Function">id</a>

    <a id="5294" href="Ledger.Conway.Specification.Rewards.html#5294" class="Function">domain&#39;</a> <a id="5302" class="Symbol">:</a> <a id="5304" href="abstract-set-theory.FiniteSetTheory.html#488" class="Function Operator">ℙ</a> <a id="5306" class="Symbol">(</a><a id="5307" href="Ledger.Conway.Specification.Rewards.html#5073" class="Bound">A</a> <a id="5309" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="5311" href="Ledger.Conway.Specification.Rewards.html#5077" class="Bound">B</a><a id="5312" class="Symbol">)</a>
    <a id="5318" href="Ledger.Conway.Specification.Rewards.html#5294" class="Function">domain&#39;</a> <a id="5326" class="Symbol">=</a> <a id="5328" href="Ledger.Conway.Specification.Rewards.html#5233" class="Function">joinˢ</a> <a id="5334" class="Symbol">(</a><a id="5335" href="Class.IsSet.html#959" class="Function">range</a> <a id="5341" class="Symbol">(</a><a id="5342" href="Axiom.Set.Map.html#11562" class="Function">mapWithKey</a> <a id="5353" class="Symbol">(λ</a> <a id="5356" href="Ledger.Conway.Specification.Rewards.html#5356" class="Bound">a</a> <a id="5358" href="Ledger.Conway.Specification.Rewards.html#5358" class="Bound">bc</a> <a id="5361" class="Symbol">→</a> <a id="5363" href="Class.IsSet.html#959" class="Function">range</a> <a id="5369" class="Symbol">(</a><a id="5370" href="Axiom.Set.Map.html#11562" class="Function">mapWithKey</a> <a id="5381" class="Symbol">(λ</a> <a id="5384" href="Ledger.Conway.Specification.Rewards.html#5384" class="Bound">b</a> <a id="5386" href="Ledger.Conway.Specification.Rewards.html#5386" class="Bound">_</a> <a id="5388" class="Symbol">→</a> <a id="5390" class="Symbol">(</a><a id="5391" href="Ledger.Conway.Specification.Rewards.html#5356" class="Bound">a</a> <a id="5393" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5395" href="Ledger.Conway.Specification.Rewards.html#5384" class="Bound">b</a><a id="5396" class="Symbol">))</a> <a id="5399" href="Ledger.Conway.Specification.Rewards.html#5358" class="Bound">bc</a><a id="5401" class="Symbol">))</a> <a id="5404" href="Ledger.Conway.Specification.Rewards.html#5084" class="Bound">abc</a><a id="5407" class="Symbol">))</a>


<a id="reward"></a><a id="5412" href="Ledger.Conway.Specification.Rewards.html#5412" class="Function">reward</a> <a id="5419" class="Symbol">:</a>  <a id="5422" href="Ledger.Conway.Specification.PParams.html#1687" class="Record">PParams</a> <a id="5430" class="Symbol">→</a> <a id="5432" href="Ledger.Conway.Specification.Rewards.html#4921" class="Function">BlocksMade</a> <a id="5443" class="Symbol">→</a> <a id="5445" href="Ledger.Prelude.Base.html#154" class="Function">Coin</a> <a id="5450" class="Symbol">→</a> <a id="5452" href="Ledger.Core.Specification.Certs.html#1195" class="Function">Pools</a> <a id="5458" class="Symbol">→</a> <a id="5460" href="Ledger.Core.Specification.Certs.html#1331" class="Function">Stake</a> <a id="5466" class="Symbol">→</a> <a id="5468" href="Ledger.Core.Specification.Certs.html#1371" class="Function">StakeDelegs</a> <a id="5480" class="Symbol">→</a> <a id="5482" href="Ledger.Prelude.Base.html#154" class="Function">Coin</a> <a id="5487" class="Symbol">→</a> <a id="5489" href="Ledger.Core.Specification.Certs.html#1331" class="Function">Stake</a>
<a id="5495" href="Ledger.Conway.Specification.Rewards.html#5412" class="Function">reward</a> <a id="5502" href="Ledger.Conway.Specification.Rewards.html#5502" class="Bound">pp</a> <a id="5505" href="Ledger.Conway.Specification.Rewards.html#5505" class="Bound">blocks</a> <a id="5512" href="Ledger.Conway.Specification.Rewards.html#5512" class="Bound">rewardPot</a> <a id="5522" href="Ledger.Conway.Specification.Rewards.html#5522" class="Bound">pools</a> <a id="5528" href="Ledger.Conway.Specification.Rewards.html#5528" class="Bound">stake</a> <a id="5534" href="Ledger.Conway.Specification.Rewards.html#5534" class="Bound">delegs</a> <a id="5541" href="Ledger.Conway.Specification.Rewards.html#5541" class="Bound">total</a> <a id="5547" class="Symbol">=</a> <a id="5549" href="Ledger.Conway.Specification.Rewards.html#6166" class="Function">rewards</a>
  <a id="5559" class="Keyword">where</a>
    <a id="5569" href="Ledger.Conway.Specification.Rewards.html#5569" class="Function">active</a>      <a id="5581" class="Symbol">=</a> <a id="5583" href="abstract-set-theory.FiniteSetTheory.html#4312" class="Function">∑[</a> <a id="5586" href="Ledger.Conway.Specification.Rewards.html#5586" class="Bound">c</a> <a id="5588" href="abstract-set-theory.FiniteSetTheory.html#4312" class="Function">←</a> <a id="5590" href="Ledger.Conway.Specification.Rewards.html#5528" class="Bound">stake</a> <a id="5596" href="abstract-set-theory.FiniteSetTheory.html#4312" class="Function">]</a> <a id="5598" href="Ledger.Conway.Specification.Rewards.html#5586" class="Bound">c</a>
    <a id="5604" href="Ledger.Conway.Specification.Rewards.html#5604" class="Function Operator">Σ_/total</a>    <a id="5616" class="Symbol">=</a> <a id="5618" class="Symbol">λ</a> <a id="5620" href="Ledger.Conway.Specification.Rewards.html#5620" class="Bound">st</a> <a id="5623" class="Symbol">→</a> <a id="5625" href="Ledger.Prelude.Numeric.UnitInterval.html#2765" class="Function">clamp</a> <a id="5631" class="Symbol">((</a><a id="5633" href="abstract-set-theory.FiniteSetTheory.html#4312" class="Function">∑[</a> <a id="5636" href="Ledger.Conway.Specification.Rewards.html#5636" class="Bound">c</a> <a id="5638" href="abstract-set-theory.FiniteSetTheory.html#4312" class="Function">←</a> <a id="5640" href="Ledger.Conway.Specification.Rewards.html#5620" class="Bound">st</a> <a id="5643" href="abstract-set-theory.FiniteSetTheory.html#4312" class="Function">]</a> <a id="5645" href="Ledger.Conway.Specification.Rewards.html#5636" class="Bound">c</a><a id="5646" class="Symbol">)</a> <a id="5648" href="Ledger.Prelude.html#1945" class="Function Operator">/₀</a> <a id="5651" href="Ledger.Conway.Specification.Rewards.html#5541" class="Bound">total</a><a id="5656" class="Symbol">)</a>
    <a id="5662" href="Ledger.Conway.Specification.Rewards.html#5662" class="Function Operator">Σ_/active</a>   <a id="5674" class="Symbol">=</a> <a id="5676" class="Symbol">λ</a> <a id="5678" href="Ledger.Conway.Specification.Rewards.html#5678" class="Bound">st</a> <a id="5681" class="Symbol">→</a> <a id="5683" href="Ledger.Prelude.Numeric.UnitInterval.html#2765" class="Function">clamp</a> <a id="5689" class="Symbol">((</a><a id="5691" href="abstract-set-theory.FiniteSetTheory.html#4312" class="Function">∑[</a> <a id="5694" href="Ledger.Conway.Specification.Rewards.html#5694" class="Bound">c</a> <a id="5696" href="abstract-set-theory.FiniteSetTheory.html#4312" class="Function">←</a> <a id="5698" href="Ledger.Conway.Specification.Rewards.html#5678" class="Bound">st</a> <a id="5701" href="abstract-set-theory.FiniteSetTheory.html#4312" class="Function">]</a> <a id="5703" href="Ledger.Conway.Specification.Rewards.html#5694" class="Bound">c</a><a id="5704" class="Symbol">)</a> <a id="5706" href="Ledger.Prelude.html#1945" class="Function Operator">/₀</a> <a id="5709" href="Ledger.Conway.Specification.Rewards.html#5569" class="Function">active</a><a id="5715" class="Symbol">)</a>
    <a id="5721" href="Ledger.Conway.Specification.Rewards.html#5721" class="Function">N</a>           <a id="5733" class="Symbol">=</a> <a id="5735" href="abstract-set-theory.FiniteSetTheory.html#4312" class="Function">∑[</a> <a id="5738" href="Ledger.Conway.Specification.Rewards.html#5738" class="Bound">m</a> <a id="5740" href="abstract-set-theory.FiniteSetTheory.html#4312" class="Function">←</a> <a id="5742" href="Ledger.Conway.Specification.Rewards.html#5505" class="Bound">blocks</a> <a id="5749" href="abstract-set-theory.FiniteSetTheory.html#4312" class="Function">]</a> <a id="5751" href="Ledger.Conway.Specification.Rewards.html#5738" class="Bound">m</a>
    <a id="5757" href="Ledger.Conway.Specification.Rewards.html#5757" class="Function">mkPoolData</a>  <a id="5769" class="Symbol">=</a> <a id="5771" class="Symbol">λ</a> <a id="5773" href="Ledger.Conway.Specification.Rewards.html#5773" class="Bound">hk</a> <a id="5776" href="Ledger.Conway.Specification.Rewards.html#5776" class="Bound">p</a> <a id="5778" class="Symbol">→</a> <a id="5780" href="Class.Functor.Core.html#272" class="Function">map</a>  <a id="5785" class="Symbol">(λ</a> <a id="5788" href="Ledger.Conway.Specification.Rewards.html#5788" class="Bound">n</a> <a id="5790" class="Symbol">→</a> <a id="5792" class="Symbol">(</a><a id="5793" href="Ledger.Conway.Specification.Rewards.html#5788" class="Bound">n</a> <a id="5795" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5797" href="Ledger.Conway.Specification.Rewards.html#5776" class="Bound">p</a> <a id="5799" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5801" href="Ledger.Conway.Specification.Rewards.html#4809" class="Function">poolStake</a> <a id="5811" href="Ledger.Conway.Specification.Rewards.html#5773" class="Bound">hk</a> <a id="5814" href="Ledger.Conway.Specification.Rewards.html#5534" class="Bound">delegs</a> <a id="5821" href="Ledger.Conway.Specification.Rewards.html#5528" class="Bound">stake</a><a id="5826" class="Symbol">))</a>
                                <a id="5861" class="Symbol">(</a><a id="5862" href="Axiom.Set.Map.html#17167" class="Function">lookupᵐ?</a> <a id="5871" href="Ledger.Conway.Specification.Rewards.html#5505" class="Bound">blocks</a> <a id="5878" href="Ledger.Conway.Specification.Rewards.html#5773" class="Bound">hk</a><a id="5880" class="Symbol">)</a>
    <a id="5886" href="Ledger.Conway.Specification.Rewards.html#5886" class="Function">pdata</a>       <a id="5898" class="Symbol">=</a> <a id="5900" href="Axiom.Set.Map.html#13169" class="Function">mapMaybeWithKeyᵐ</a> <a id="5917" href="Ledger.Conway.Specification.Rewards.html#5757" class="Function">mkPoolData</a> <a id="5928" href="Ledger.Conway.Specification.Rewards.html#5522" class="Bound">pools</a>

    <a id="5939" href="Ledger.Conway.Specification.Rewards.html#5939" class="Function">f</a> <a id="5941" class="Symbol">:</a> <a id="5943" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a> <a id="5945" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="5947" href="Ledger.Core.Specification.Certs.html#336" class="Record">StakePoolParams</a> <a id="5963" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="5965" href="Ledger.Core.Specification.Certs.html#1331" class="Function">Stake</a> <a id="5971" class="Symbol">→</a> <a id="5973" href="Ledger.Core.Specification.Certs.html#1331" class="Function">Stake</a>
    <a id="5983" href="Ledger.Conway.Specification.Rewards.html#5939" class="Function">f</a> <a id="5985" class="Symbol">=</a> <a id="5987" class="Symbol">(λ</a> <a id="5990" class="Symbol">(</a><a id="5991" href="Ledger.Conway.Specification.Rewards.html#5991" class="Bound">n</a> <a id="5993" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5995" href="Ledger.Conway.Specification.Rewards.html#5995" class="Bound">p</a> <a id="5997" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5999" href="Ledger.Conway.Specification.Rewards.html#5999" class="Bound">s</a><a id="6000" class="Symbol">)</a> <a id="6002" class="Symbol">→</a> <a id="6004" href="Ledger.Conway.Specification.Rewards.html#3557" class="Function">rewardOnePool</a> <a id="6018" href="Ledger.Conway.Specification.Rewards.html#5502" class="Bound">pp</a> <a id="6021" href="Ledger.Conway.Specification.Rewards.html#5512" class="Bound">rewardPot</a> <a id="6031" href="Ledger.Conway.Specification.Rewards.html#5991" class="Bound">n</a> <a id="6033" href="Ledger.Conway.Specification.Rewards.html#5721" class="Function">N</a> <a id="6035" href="Ledger.Conway.Specification.Rewards.html#5995" class="Bound">p</a> <a id="6037" href="Ledger.Conway.Specification.Rewards.html#5999" class="Bound">s</a> <a id="6039" class="Symbol">(</a><a id="6040" href="Ledger.Conway.Specification.Rewards.html#5604" class="Function Operator">Σ</a> <a id="6042" href="Ledger.Conway.Specification.Rewards.html#5999" class="Bound">s</a> <a id="6044" href="Ledger.Conway.Specification.Rewards.html#5604" class="Function Operator">/total</a><a id="6050" class="Symbol">)</a> <a id="6052" class="Symbol">(</a><a id="6053" href="Ledger.Conway.Specification.Rewards.html#5662" class="Function Operator">Σ</a> <a id="6055" href="Ledger.Conway.Specification.Rewards.html#5999" class="Bound">s</a> <a id="6057" href="Ledger.Conway.Specification.Rewards.html#5662" class="Function Operator">/active</a><a id="6064" class="Symbol">)</a> <a id="6066" href="Ledger.Conway.Specification.Rewards.html#5541" class="Bound">total</a><a id="6071" class="Symbol">)</a>

    <a id="6078" href="Ledger.Conway.Specification.Rewards.html#6078" class="Function">results</a> <a id="6086" class="Symbol">:</a> <a id="6088" class="Symbol">(</a><a id="6089" href="Ledger.Core.Specification.Crypto.html#1386" class="Function">KeyHash</a> <a id="6097" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="6099" href="Ledger.Core.Specification.Address.html#259" class="Datatype">Credential</a><a id="6109" class="Symbol">)</a> <a id="6111" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="6113" href="Ledger.Prelude.Base.html#154" class="Function">Coin</a>
    <a id="6122" href="Ledger.Conway.Specification.Rewards.html#6078" class="Function">results</a> <a id="6130" class="Symbol">=</a>  <a id="6133" href="Ledger.Conway.Specification.Rewards.html#4965" class="Function">uncurryᵐ</a> <a id="6142" class="Symbol">(</a><a id="6143" href="Axiom.Set.Map.html#7106" class="Function">mapValues</a> <a id="6153" href="Ledger.Conway.Specification.Rewards.html#5939" class="Function">f</a> <a id="6155" href="Ledger.Conway.Specification.Rewards.html#5886" class="Function">pdata</a><a id="6160" class="Symbol">)</a>
    <a id="6166" href="Ledger.Conway.Specification.Rewards.html#6166" class="Function">rewards</a>  <a id="6175" class="Symbol">=</a> <a id="6177" href="abstract-set-theory.FiniteSetTheory.html#4745" class="Function">aggregateBy</a> <a id="6189" class="Symbol">(</a><a id="6190" href="abstract-set-theory.FiniteSetTheory.html#519" class="Function">mapˢ</a> <a id="6195" class="Symbol">(λ</a> <a id="6198" class="Symbol">(</a><a id="6199" href="Ledger.Conway.Specification.Rewards.html#6199" class="Bound">kh</a> <a id="6202" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="6204" href="Ledger.Conway.Specification.Rewards.html#6204" class="Bound">cred</a><a id="6208" class="Symbol">)</a> <a id="6210" class="Symbol">→</a> <a id="6212" class="Symbol">(</a><a id="6213" href="Ledger.Conway.Specification.Rewards.html#6199" class="Bound">kh</a> <a id="6216" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="6218" href="Ledger.Conway.Specification.Rewards.html#6204" class="Bound">cred</a><a id="6222" class="Symbol">)</a> <a id="6224" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="6226" href="Ledger.Conway.Specification.Rewards.html#6204" class="Bound">cred</a><a id="6230" class="Symbol">)</a> <a id="6232" class="Symbol">(</a><a id="6233" href="Class.IsSet.html#916" class="Function">dom</a> <a id="6237" href="Ledger.Conway.Specification.Rewards.html#6078" class="Function">results</a><a id="6244" class="Symbol">))</a> <a id="6247" href="Ledger.Conway.Specification.Rewards.html#6078" class="Function">results</a>


<a id="6257" class="Keyword">record</a> <a id="RewardUpdate"></a><a id="6264" href="Ledger.Conway.Specification.Rewards.html#6264" class="Record">RewardUpdate</a> <a id="6277" class="Symbol">:</a> <a id="6279" href="Agda.Primitive.html#388" class="Primitive">Set</a> <a id="6283" class="Keyword">where</a>
  <a id="6291" class="Keyword">field</a>
    <a id="RewardUpdate.Δt"></a><a id="6301" href="Ledger.Conway.Specification.Rewards.html#6301" class="Field">Δt</a> <a id="RewardUpdate.Δr"></a><a id="6304" href="Ledger.Conway.Specification.Rewards.html#6304" class="Field">Δr</a> <a id="RewardUpdate.Δf"></a><a id="6307" href="Ledger.Conway.Specification.Rewards.html#6307" class="Field">Δf</a>          <a id="6319" class="Symbol">:</a> <a id="6321" href="Agda.Builtin.Int.html#245" class="Datatype">ℤ</a>
    <a id="RewardUpdate.rs"></a><a id="6327" href="Ledger.Conway.Specification.Rewards.html#6327" class="Field">rs</a>                <a id="6345" class="Symbol">:</a> <a id="6347" href="Ledger.Core.Specification.Certs.html#1331" class="Function">Stake</a>
    <a id="RewardUpdate.flowConservation"></a><a id="6357" href="Ledger.Conway.Specification.Rewards.html#6357" class="Field">flowConservation</a>  <a id="6375" class="Symbol">:</a> <a id="6377" href="Ledger.Conway.Specification.Rewards.html#6301" class="Field">Δt</a> <a id="6380" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="6382" href="Ledger.Conway.Specification.Rewards.html#6304" class="Field">Δr</a> <a id="6385" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="6387" href="Ledger.Conway.Specification.Rewards.html#6307" class="Field">Δf</a> <a id="6390" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="6392" href="Ledger.Conway.Specification.Rewards.html#321" class="InductiveConstructor">pos</a> <a id="6396" class="Symbol">(</a><a id="6397" href="abstract-set-theory.FiniteSetTheory.html#4312" class="Function">∑[</a> <a id="6400" href="Ledger.Conway.Specification.Rewards.html#6400" class="Bound">c</a> <a id="6402" href="abstract-set-theory.FiniteSetTheory.html#4312" class="Function">←</a> <a id="6404" href="Ledger.Conway.Specification.Rewards.html#6327" class="Field">rs</a> <a id="6407" href="abstract-set-theory.FiniteSetTheory.html#4312" class="Function">]</a> <a id="6409" href="Ledger.Conway.Specification.Rewards.html#6400" class="Bound">c</a><a id="6410" class="Symbol">)</a> <a id="6412" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="6414" class="Number">0</a>
    <a id="RewardUpdate.Δt-nonnegative"></a><a id="6420" href="Ledger.Conway.Specification.Rewards.html#6420" class="Field">Δt-nonnegative</a>    <a id="6438" class="Symbol">:</a> <a id="6440" class="Number">0</a> <a id="6442" href="Class.HasOrder.Core.html#613" class="Field Operator">≤</a> <a id="6444" href="Ledger.Conway.Specification.Rewards.html#6301" class="Field">Δt</a>
    <a id="RewardUpdate.Δf-nonpositive"></a><a id="6451" href="Ledger.Conway.Specification.Rewards.html#6451" class="Field">Δf-nonpositive</a>    <a id="6469" class="Symbol">:</a> <a id="6471" href="Ledger.Conway.Specification.Rewards.html#6307" class="Field">Δf</a> <a id="6474" href="Class.HasOrder.Core.html#613" class="Field Operator">≤</a> <a id="6476" class="Number">0</a>


<a id="6480" class="Keyword">record</a> <a id="Snapshot"></a><a id="6487" href="Ledger.Conway.Specification.Rewards.html#6487" class="Record">Snapshot</a> <a id="6496" class="Symbol">:</a> <a id="6498" href="Agda.Primitive.html#388" class="Primitive">Set</a> <a id="6502" class="Keyword">where</a>
  <a id="6510" class="Keyword">field</a>
    <a id="Snapshot.stake"></a><a id="6520" href="Ledger.Conway.Specification.Rewards.html#6520" class="Field">stake</a>        <a id="6533" class="Symbol">:</a> <a id="6535" href="Ledger.Core.Specification.Certs.html#1331" class="Function">Stake</a>
    <a id="Snapshot.delegations"></a><a id="6545" href="Ledger.Conway.Specification.Rewards.html#6545" class="Field">delegations</a>  <a id="6558" class="Symbol">:</a> <a id="6560" href="Ledger.Core.Specification.Certs.html#1371" class="Function">StakeDelegs</a>
    <a id="Snapshot.pools"></a><a id="6576" href="Ledger.Conway.Specification.Rewards.html#6576" class="Field">pools</a>        <a id="6589" class="Symbol">:</a> <a id="6591" href="Ledger.Core.Specification.Certs.html#1195" class="Function">Pools</a>


<a id="6599" class="Keyword">instance</a>
  <a id="HasStake-Snapshot"></a><a id="6610" href="Ledger.Conway.Specification.Rewards.html#6610" class="Function">HasStake-Snapshot</a> <a id="6628" class="Symbol">:</a> <a id="6630" href="Ledger.Core.Specification.Certs.html#1846" class="Record">HasStake</a> <a id="6639" href="Ledger.Conway.Specification.Rewards.html#6487" class="Record">Snapshot</a>
  <a id="6650" href="Ledger.Conway.Specification.Rewards.html#6610" class="Function">HasStake-Snapshot</a> <a id="6668" class="Symbol">.</a><a id="6669" href="Ledger.Core.Specification.Certs.html#1895" class="Field">StakeOf</a> <a id="6677" class="Symbol">=</a> <a id="6679" href="Ledger.Conway.Specification.Rewards.html#6520" class="Field">Snapshot.stake</a>

  <a id="HasStakeDelegs-Snapshot"></a><a id="6697" href="Ledger.Conway.Specification.Rewards.html#6697" class="Function">HasStakeDelegs-Snapshot</a> <a id="6721" class="Symbol">:</a> <a id="6723" href="Ledger.Core.Specification.Certs.html#1924" class="Record">HasStakeDelegs</a> <a id="6738" href="Ledger.Conway.Specification.Rewards.html#6487" class="Record">Snapshot</a>
  <a id="6749" href="Ledger.Conway.Specification.Rewards.html#6697" class="Function">HasStakeDelegs-Snapshot</a> <a id="6773" class="Symbol">.</a><a id="6774" href="Ledger.Core.Specification.Certs.html#1979" class="Field">StakeDelegsOf</a> <a id="6788" class="Symbol">=</a> <a id="6790" href="Ledger.Conway.Specification.Rewards.html#6545" class="Field">Snapshot.delegations</a>

  <a id="HasPools-Snapshot"></a><a id="6814" href="Ledger.Conway.Specification.Rewards.html#6814" class="Function">HasPools-Snapshot</a> <a id="6832" class="Symbol">:</a> <a id="6834" href="Ledger.Core.Specification.Certs.html#1600" class="Record">HasPools</a> <a id="6843" href="Ledger.Conway.Specification.Rewards.html#6487" class="Record">Snapshot</a>
  <a id="6854" href="Ledger.Conway.Specification.Rewards.html#6814" class="Function">HasPools-Snapshot</a> <a id="6872" class="Symbol">.</a><a id="6873" href="Ledger.Core.Specification.Certs.html#1649" class="Field">PoolsOf</a> <a id="6881" class="Symbol">=</a> <a id="6883" href="Ledger.Conway.Specification.Rewards.html#6576" class="Field">Snapshot.pools</a>

  <a id="6901" class="Keyword">unquoteDecl</a> <a id="HasCast-Snapshot"></a><a id="6913" href="Ledger.Conway.Specification.Rewards.html#6913" class="Function">HasCast-Snapshot</a> <a id="6930" class="Symbol">=</a>
    <a id="6936" href="stdlib-classes.Class.HasCast.Derive.html#2690" class="Function">derive-HasCast</a> <a id="6951" href="Data.List.Base.html#4907" class="Function Operator">[</a> <a id="6953" class="Symbol">(</a><a id="6954" class="Keyword">quote</a> <a id="6960" href="Ledger.Conway.Specification.Rewards.html#6487" class="Record">Snapshot</a> <a id="6969" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="6971" href="Ledger.Conway.Specification.Rewards.html#6913" class="Function">HasCast-Snapshot</a><a id="6987" class="Symbol">)</a> <a id="6989" href="Data.List.Base.html#4907" class="Function Operator">]</a>


<a id="6993" class="Keyword">private</a>
  <a id="getStakeCred"></a><a id="7003" href="Ledger.Conway.Specification.Rewards.html#7003" class="Function">getStakeCred</a> <a id="7016" class="Symbol">:</a> <a id="7018" href="Ledger.Core.Specification.Transaction.html#2529" class="Function">TxOut</a> <a id="7024" class="Symbol">→</a> <a id="7026" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="7032" href="Ledger.Core.Specification.Address.html#259" class="Datatype">Credential</a>
  <a id="7045" href="Ledger.Conway.Specification.Rewards.html#7003" class="Function">getStakeCred</a> <a id="7058" class="Symbol">(</a><a id="7059" href="Ledger.Conway.Specification.Rewards.html#7059" class="Bound">a</a> <a id="7061" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="7063" class="Symbol">_</a> <a id="7065" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="7067" class="Symbol">_</a> <a id="7069" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="7071" class="Symbol">_)</a> <a id="7074" class="Symbol">=</a> <a id="7076" href="Ledger.Core.Specification.Address.html#2659" class="Function">stakeCred</a> <a id="7086" href="Ledger.Conway.Specification.Rewards.html#7059" class="Bound">a</a>

<a id="7089" class="Keyword">opaque</a>


  <a id="stakeDistr"></a><a id="7100" href="Ledger.Conway.Specification.Rewards.html#7100" class="Function">stakeDistr</a> <a id="7111" class="Symbol">:</a> <a id="7113" href="Ledger.Core.Specification.Transaction.html#2607" class="Function">UTxO</a> <a id="7118" class="Symbol">→</a> <a id="7120" href="Ledger.Core.Specification.Certs.html#3866" class="Record">DState</a> <a id="7127" class="Symbol">→</a> <a id="7129" href="Ledger.Core.Specification.Certs.html#4017" class="Record">PState</a> <a id="7136" class="Symbol">→</a> <a id="7138" href="Ledger.Conway.Specification.Rewards.html#6487" class="Record">Snapshot</a>
  <a id="7149" href="Ledger.Conway.Specification.Rewards.html#7100" class="Function">stakeDistr</a> <a id="7160" href="Ledger.Conway.Specification.Rewards.html#7160" class="Bound">utxo</a> <a id="7165" href="Ledger.Conway.Specification.Rewards.html#7165" class="Bound">dState</a> <a id="7172" href="Ledger.Conway.Specification.Rewards.html#7172" class="Bound">pState</a> <a id="7179" class="Symbol">=</a> <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.Conway.Specification.Rewards.html#7610}{\htmlId{7183}{\htmlClass{Function}{\text{activeStake}}}}\, \\ \,\href{Ledger.Core.Specification.Certs.html#1979}{\htmlId{7197}{\htmlClass{Field}{\text{StakeDelegsOf}}}}\, \,\href{Ledger.Conway.Specification.Rewards.html#7165}{\htmlId{7211}{\htmlClass{Bound}{\text{dState}}}}\, \\ \,\href{Ledger.Conway.Specification.Rewards.html#7242}{\htmlId{7220}{\htmlClass{Function}{\text{pools}}}}\, \end{pmatrix}$</a>
    <a id="7232" class="Keyword">where</a>
    <a id="7242" href="Ledger.Conway.Specification.Rewards.html#7242" class="Function">pools</a> <a id="7248" class="Symbol">:</a> <a id="7250" href="Ledger.Core.Specification.Certs.html#1195" class="Function">Pools</a>
    <a id="7260" href="Ledger.Conway.Specification.Rewards.html#7242" class="Function">pools</a> <a id="7266" class="Symbol">=</a> <a id="7268" href="Ledger.Core.Specification.Certs.html#1649" class="Field">PoolsOf</a> <a id="7276" href="Ledger.Conway.Specification.Rewards.html#7172" class="Bound">pState</a>

    <a id="7288" href="Ledger.Conway.Specification.Rewards.html#7288" class="Function">utxoBalance</a> <a id="7300" class="Symbol">:</a> <a id="7302" href="Ledger.Core.Specification.Address.html#259" class="Datatype">Credential</a> <a id="7313" class="Symbol">→</a> <a id="7315" href="Ledger.Prelude.Base.html#154" class="Function">Coin</a>
    <a id="7324" href="Ledger.Conway.Specification.Rewards.html#7288" class="Function">utxoBalance</a> <a id="7336" class="Symbol">=</a> <a id="7338" class="Symbol">λ</a> <a id="7340" href="Ledger.Conway.Specification.Rewards.html#7340" class="Bound">cred</a> <a id="7345" class="Symbol">→</a> <a id="7347" href="Ledger.Conway.Specification.Utxo.html#2532" class="Function">cbalance</a> <a id="7356" class="Symbol">(</a><a id="7357" href="Ledger.Conway.Specification.Rewards.html#7160" class="Bound">utxo</a> <a id="7362" href="abstract-set-theory.FiniteSetTheory.html#4234" class="Function Operator">∣^&#39;</a> <a id="7366" class="Symbol">λ</a> <a id="7368" href="Ledger.Conway.Specification.Rewards.html#7368" class="Bound">txout</a> <a id="7374" class="Symbol">→</a> <a id="7376" href="Ledger.Conway.Specification.Rewards.html#7003" class="Function">getStakeCred</a> <a id="7389" href="Ledger.Conway.Specification.Rewards.html#7368" class="Bound">txout</a> <a id="7395" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="7397" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="7402" href="Ledger.Conway.Specification.Rewards.html#7340" class="Bound">cred</a><a id="7406" class="Symbol">)</a>

    <a id="7413" href="Ledger.Conway.Specification.Rewards.html#7413" class="Function">activeDelegs</a> <a id="7426" class="Symbol">:</a> <a id="7428" href="Ledger.Core.Specification.Certs.html#1371" class="Function">StakeDelegs</a>
    <a id="7444" href="Ledger.Conway.Specification.Rewards.html#7413" class="Function">activeDelegs</a> <a id="7457" class="Symbol">=</a> <a id="7459" class="Symbol">(</a><a id="7460" href="Ledger.Core.Specification.Certs.html#1979" class="Field">StakeDelegsOf</a> <a id="7474" href="Ledger.Conway.Specification.Rewards.html#7165" class="Bound">dState</a> <a id="7481" href="Axiom.Set.Map.html#13534" class="Function Operator">∣</a> <a id="7483" href="Class.IsSet.html#916" class="Function">dom</a> <a id="7487" class="Symbol">(</a><a id="7488" href="Ledger.Core.Specification.Certs.html#1814" class="Field">RewardsOf</a> <a id="7498" href="Ledger.Conway.Specification.Rewards.html#7165" class="Bound">dState</a><a id="7504" class="Symbol">))</a> <a id="7507" href="Axiom.Set.Map.html#17773" class="Function Operator">∣^</a> <a id="7510" href="Class.IsSet.html#916" class="Function">dom</a> <a id="7514" href="Ledger.Conway.Specification.Rewards.html#7242" class="Function">pools</a>

    <a id="7525" href="Ledger.Conway.Specification.Rewards.html#7525" class="Function">activeRewards</a> <a id="7539" class="Symbol">:</a> <a id="7541" href="Ledger.Core.Specification.Certs.html#1287" class="Function">Rewards</a>
    <a id="7553" href="Ledger.Conway.Specification.Rewards.html#7525" class="Function">activeRewards</a> <a id="7567" class="Symbol">=</a> <a id="7569" href="Ledger.Core.Specification.Certs.html#1814" class="Field">RewardsOf</a> <a id="7579" href="Ledger.Conway.Specification.Rewards.html#7165" class="Bound">dState</a> <a id="7586" href="Axiom.Set.Map.html#13534" class="Function Operator">∣</a> <a id="7588" href="Class.IsSet.html#916" class="Function">dom</a> <a id="7592" href="Ledger.Conway.Specification.Rewards.html#7413" class="Function">activeDelegs</a>

    <a id="7610" href="Ledger.Conway.Specification.Rewards.html#7610" class="Function">activeStake</a> <a id="7622" class="Symbol">:</a> <a id="7624" href="Ledger.Core.Specification.Certs.html#1331" class="Function">Stake</a>
    <a id="7634" href="Ledger.Conway.Specification.Rewards.html#7610" class="Function">activeStake</a> <a id="7646" class="Symbol">=</a> <a id="7648" href="Axiom.Set.Map.html#11562" class="Function">mapWithKey</a> <a id="7659" class="Symbol">(λ</a> <a id="7662" href="Ledger.Conway.Specification.Rewards.html#7662" class="Bound">c</a> <a id="7664" href="Ledger.Conway.Specification.Rewards.html#7664" class="Bound">rewardBalance</a> <a id="7678" class="Symbol">→</a> <a id="7680" href="Ledger.Conway.Specification.Rewards.html#7288" class="Function">utxoBalance</a> <a id="7692" href="Ledger.Conway.Specification.Rewards.html#7662" class="Bound">c</a> <a id="7694" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="7696" href="Ledger.Conway.Specification.Rewards.html#7664" class="Bound">rewardBalance</a><a id="7709" class="Symbol">)</a> <a id="7711" href="Ledger.Conway.Specification.Rewards.html#7525" class="Function">activeRewards</a>


<a id="7727" class="Keyword">record</a> <a id="Snapshots"></a><a id="7734" href="Ledger.Conway.Specification.Rewards.html#7734" class="Record">Snapshots</a> <a id="7744" class="Symbol">:</a> <a id="7746" href="Agda.Primitive.html#388" class="Primitive">Set</a> <a id="7750" class="Keyword">where</a>
  <a id="7758" class="Keyword">field</a>
    <a id="Snapshots.mark"></a><a id="7768" href="Ledger.Conway.Specification.Rewards.html#7768" class="Field">mark</a> <a id="Snapshots.set"></a><a id="7773" href="Ledger.Conway.Specification.Rewards.html#7773" class="Field">set</a> <a id="Snapshots.go"></a><a id="7777" href="Ledger.Conway.Specification.Rewards.html#7777" class="Field">go</a>  <a id="7781" class="Symbol">:</a> <a id="7783" href="Ledger.Conway.Specification.Rewards.html#6487" class="Record">Snapshot</a>
    <a id="Snapshots.feeSS"></a><a id="7796" href="Ledger.Conway.Specification.Rewards.html#7796" class="Field">feeSS</a>        <a id="7809" class="Symbol">:</a> <a id="7811" href="Ledger.Prelude.Base.html#186" class="Function">Fees</a>


<a id="7818" class="Keyword">record</a> <a id="HasSnapshots"></a><a id="7825" href="Ledger.Conway.Specification.Rewards.html#7825" class="Record">HasSnapshots</a> <a id="7838" class="Symbol">{</a><a id="7839" href="Ledger.Conway.Specification.Rewards.html#7839" class="Bound">a</a><a id="7840" class="Symbol">}</a> <a id="7842" class="Symbol">(</a><a id="7843" href="Ledger.Conway.Specification.Rewards.html#7843" class="Bound">A</a> <a id="7845" class="Symbol">:</a> <a id="7847" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="7852" href="Ledger.Conway.Specification.Rewards.html#7839" class="Bound">a</a><a id="7853" class="Symbol">)</a> <a id="7855" class="Symbol">:</a> <a id="7857" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="7862" href="Ledger.Conway.Specification.Rewards.html#7839" class="Bound">a</a> <a id="7864" class="Keyword">where</a>
  <a id="7872" class="Keyword">field</a> <a id="HasSnapshots.SnapshotsOf"></a><a id="7878" href="Ledger.Conway.Specification.Rewards.html#7878" class="Field">SnapshotsOf</a> <a id="7890" class="Symbol">:</a> <a id="7892" href="Ledger.Conway.Specification.Rewards.html#7843" class="Bound">A</a> <a id="7894" class="Symbol">→</a> <a id="7896" href="Ledger.Conway.Specification.Rewards.html#7734" class="Record">Snapshots</a>
<a id="7906" class="Keyword">open</a> <a id="7911" href="Ledger.Conway.Specification.Rewards.html#7825" class="Module">HasSnapshots</a> <a id="7924" class="Symbol">⦃...⦄</a> <a id="7930" class="Keyword">public</a>

<a id="7938" class="Keyword">instance</a>
  <a id="HasFees-Snapshots"></a><a id="7949" href="Ledger.Conway.Specification.Rewards.html#7949" class="Function">HasFees-Snapshots</a> <a id="7967" class="Symbol">:</a> <a id="7969" href="Ledger.Prelude.Base.html#621" class="Record">HasFees</a> <a id="7977" href="Ledger.Conway.Specification.Rewards.html#7734" class="Record">Snapshots</a>
  <a id="7989" href="Ledger.Conway.Specification.Rewards.html#7949" class="Function">HasFees-Snapshots</a> <a id="8007" class="Symbol">.</a><a id="8008" href="Ledger.Prelude.Base.html#669" class="Field">FeesOf</a> <a id="8015" class="Symbol">=</a> <a id="8017" href="Ledger.Conway.Specification.Rewards.html#7796" class="Field">Snapshots.feeSS</a>

  <a id="8036" class="Keyword">unquoteDecl</a> <a id="HasCast-Snapshots"></a><a id="8048" href="Ledger.Conway.Specification.Rewards.html#8048" class="Function">HasCast-Snapshots</a> <a id="8066" class="Symbol">=</a>
    <a id="8072" href="stdlib-classes.Class.HasCast.Derive.html#2690" class="Function">derive-HasCast</a> <a id="8087" href="Data.List.Base.html#4907" class="Function Operator">[</a> <a id="8089" class="Symbol">(</a><a id="8090" class="Keyword">quote</a> <a id="8096" href="Ledger.Conway.Specification.Rewards.html#7734" class="Record">Snapshots</a> <a id="8106" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="8108" href="Ledger.Conway.Specification.Rewards.html#8048" class="Function">HasCast-Snapshots</a><a id="8125" class="Symbol">)</a> <a id="8127" href="Data.List.Base.html#4907" class="Function Operator">]</a>


<a id="8131" class="Keyword">private</a> <a id="8139" class="Keyword">variable</a>
  <a id="8150" href="Ledger.Conway.Specification.Rewards.html#8150" class="Generalizable">ls</a> <a id="8153" class="Symbol">:</a> <a id="8155" href="Ledger.Conway.Specification.Ledger.html#997" class="Record">LState</a>
  <a id="8164" href="Ledger.Conway.Specification.Rewards.html#8164" class="Generalizable">mark</a> <a id="8169" href="Ledger.Conway.Specification.Rewards.html#8169" class="Generalizable">set</a> <a id="8173" href="Ledger.Conway.Specification.Rewards.html#8173" class="Generalizable">go</a> <a id="8176" class="Symbol">:</a> <a id="8178" href="Ledger.Conway.Specification.Rewards.html#6487" class="Record">Snapshot</a>
  <a id="8189" href="Ledger.Conway.Specification.Rewards.html#8189" class="Generalizable">feeSS</a> <a id="8195" class="Symbol">:</a> <a id="8197" href="Ledger.Prelude.Base.html#154" class="Function">Coin</a>


<a id="8204" class="Keyword">data</a> <a id="_⊢_⇀⦇_,SNAP⦈_"></a><a id="8209" href="Ledger.Conway.Specification.Rewards.html#8209" class="Datatype Operator">_⊢_⇀⦇_,SNAP⦈_</a> <a id="8223" class="Symbol">:</a> <a id="8225" href="Ledger.Conway.Specification.Ledger.html#997" class="Record">LState</a> <a id="8232" class="Symbol">→</a> <a id="8234" href="Ledger.Conway.Specification.Rewards.html#7734" class="Record">Snapshots</a> <a id="8244" class="Symbol">→</a> <a id="8246" href="Agda.Builtin.Unit.html#175" class="Record">⊤</a> <a id="8248" class="Symbol">→</a> <a id="8250" href="Ledger.Conway.Specification.Rewards.html#7734" class="Record">Snapshots</a> <a id="8260" class="Symbol">→</a> <a id="8262" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="8267" class="Keyword">where</a>
  <a id="_⊢_⇀⦇_,SNAP⦈_.SNAP"></a><a id="8275" href="Ledger.Conway.Specification.Rewards.html#8275" class="InductiveConstructor">SNAP</a> <a id="8280" class="Symbol">:</a>
    <a id="8286" class="Keyword">let</a> <a id="8290" href="Ledger.Conway.Specification.Rewards.html#8290" class="Bound">stake</a> <a id="8296" class="Symbol">=</a> <a id="8298" href="Ledger.Conway.Specification.Rewards.html#7100" class="Function">stakeDistr</a> <a id="8309" class="Symbol">(</a><a id="8310" href="Ledger.Core.Specification.Transaction.html#2830" class="Field">UTxOOf</a> <a id="8317" href="Ledger.Conway.Specification.Rewards.html#8150" class="Generalizable">ls</a><a id="8319" class="Symbol">)</a> <a id="8321" class="Symbol">(</a><a id="8322" href="Ledger.Core.Specification.Certs.html#4563" class="Field">DStateOf</a> <a id="8331" href="Ledger.Conway.Specification.Rewards.html#8150" class="Generalizable">ls</a><a id="8333" class="Symbol">)</a> <a id="8335" class="Symbol">(</a><a id="8336" href="Ledger.Core.Specification.Certs.html#4671" class="Field">PStateOf</a> <a id="8345" href="Ledger.Conway.Specification.Rewards.html#8150" class="Generalizable">ls</a><a id="8347" class="Symbol">)</a> <a id="8349" class="Keyword">in</a>
    <a id="8356" href="Ledger.Conway.Specification.Rewards.html#8150" class="Generalizable">ls</a> <a id="8359" href="Ledger.Conway.Specification.Rewards.html#8209" class="Datatype Operator">⊢</a> <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.Conway.Specification.Rewards.html#8164}{\htmlId{8363}{\htmlClass{Generalizable}{\text{mark}}}}\, \\ \,\href{Ledger.Conway.Specification.Rewards.html#8169}{\htmlId{8370}{\htmlClass{Generalizable}{\text{set}}}}\, \\ \,\href{Ledger.Conway.Specification.Rewards.html#8173}{\htmlId{8376}{\htmlClass{Generalizable}{\text{go}}}}\, \\ \,\href{Ledger.Conway.Specification.Rewards.html#8189}{\htmlId{8381}{\htmlClass{Generalizable}{\text{feeSS}}}}\, \end{pmatrix}$</a> <a id="8389" href="Ledger.Conway.Specification.Rewards.html#8209" class="Datatype Operator">⇀⦇</a> <a id="8392" href="Agda.Builtin.Unit.html#212" class="InductiveConstructor">tt</a> <a id="8395" href="Ledger.Conway.Specification.Rewards.html#8209" class="Datatype Operator">,SNAP⦈</a> <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.Conway.Specification.Rewards.html#8290}{\htmlId{8404}{\htmlClass{Bound}{\text{stake}}}}\, \\ \,\href{Ledger.Conway.Specification.Rewards.html#8164}{\htmlId{8412}{\htmlClass{Generalizable}{\text{mark}}}}\, \\ \,\href{Ledger.Conway.Specification.Rewards.html#8169}{\htmlId{8419}{\htmlClass{Generalizable}{\text{set}}}}\, \\ \,\href{Ledger.Prelude.Base.html#669}{\htmlId{8425}{\htmlClass{Field}{\text{FeesOf}}}}\, \,\href{Ledger.Conway.Specification.Rewards.html#8150}{\htmlId{8432}{\htmlClass{Generalizable}{\text{ls}}}}\, \end{pmatrix}$</a>

</pre></body></html>