<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>Ledger.Conway.Specification.Rewards</title><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.css"><link rel="stylesheet" href="Agda.css"><script src="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.js"></script><script src="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/contrib/auto-render.min.js"></script><script src="AgdaKaTeX.js" defer=""></script></head><body><pre class="Agda">

<a id="3" class="Symbol">{-#</a> <a id="7" class="Keyword">OPTIONS</a> <a id="15" class="Pragma">--safe</a> <a id="22" class="Symbol">#-}</a>

<a id="27" class="Keyword">open</a> <a id="32" class="Keyword">import</a> <a id="39" href="Data.Integer.html" class="Module">Data.Integer</a> <a id="52" class="Keyword">using</a> <a id="58" class="Symbol">()</a> <a id="61" class="Keyword">renaming</a> <a id="70" class="Symbol">(</a><a id="71" href="Agda.Builtin.Int.html#263" class="InductiveConstructor">+_</a> <a id="74" class="Symbol">to</a> <a id="77" class="InductiveConstructor">pos</a><a id="80" class="Symbol">)</a>
<a id="82" class="Keyword">open</a> <a id="87" class="Keyword">import</a> <a id="94" href="Data.Rational.html" class="Module">Data.Rational</a> <a id="108" class="Keyword">using</a> <a id="114" class="Symbol">(</a><a id="115" href="Data.Rational.Base.html#1421" class="Record">ℚ</a><a id="116" class="Symbol">;</a> <a id="118" href="Data.Rational.Base.html#7195" class="Function">floor</a><a id="123" class="Symbol">;</a> <a id="125" href="Data.Rational.Base.html#6394" class="Function Operator">_*_</a><a id="128" class="Symbol">;</a> <a id="130" href="Data.Rational.Base.html#6787" class="Function Operator">_÷_</a><a id="133" class="Symbol">;</a> <a id="135" href="Data.Rational.Base.html#3963" class="Function Operator">_/_</a><a id="138" class="Symbol">;</a> <a id="140" href="Data.Rational.Base.html#6484" class="Function Operator">_-_</a><a id="143" class="Symbol">;</a> <a id="145" href="Data.Rational.Base.html#5293" class="Function">&gt;-nonZero</a><a id="154" class="Symbol">;</a> <a id="156" href="Data.Rational.Base.html#6933" class="Function Operator">_⊓_</a><a id="159" class="Symbol">)</a>
                          <a id="187" class="Keyword">renaming</a> <a id="196" class="Symbol">(</a><a id="197" href="Data.Rational.Base.html#6855" class="Function Operator">_⊔_</a> <a id="201" class="Symbol">to</a> <a id="204" class="Function Operator">_⊔ℚ_</a><a id="208" class="Symbol">;</a> <a id="210" href="Data.Rational.Base.html#4577" class="Function">NonZero</a> <a id="218" class="Symbol">to</a> <a id="221" class="Function">NonZeroℚ</a><a id="229" class="Symbol">)</a>
<a id="231" class="Keyword">open</a> <a id="236" class="Keyword">import</a> <a id="243" href="Data.Rational.Literals.html" class="Module">Data.Rational.Literals</a> <a id="266" class="Keyword">using</a> <a id="272" class="Symbol">(</a><a id="273" href="Data.Rational.Literals.html#740" class="Function">number</a><a id="279" class="Symbol">;</a> <a id="281" href="Data.Rational.Literals.html#613" class="Function">fromℤ</a><a id="286" class="Symbol">)</a>
<a id="288" class="Keyword">open</a> <a id="293" class="Keyword">import</a> <a id="300" href="Data.Rational.Properties.html" class="Module">Data.Rational.Properties</a> <a id="325" class="Keyword">using</a> <a id="331" class="Symbol">(</a><a id="332" href="Data.Rational.Properties.html#7854" class="Function">pos⇒nonZero</a><a id="343" class="Symbol">;</a> <a id="345" href="Data.Rational.Properties.html#26962" class="Function">positive⁻¹</a><a id="355" class="Symbol">;</a> <a id="357" href="Data.Rational.Properties.html#36227" class="Function">+-mono-&lt;-≤</a><a id="367" class="Symbol">;</a> <a id="369" href="Data.Rational.Properties.html#11914" class="Function">normalize-pos</a><a id="382" class="Symbol">;</a> <a id="384" href="Data.Rational.Properties.html#58180" class="Function">p≤p⊔q</a><a id="389" class="Symbol">)</a>
<a id="391" class="Keyword">open</a> <a id="396" class="Keyword">import</a> <a id="403" href="Ledger.Conway.Specification.Abstract.html" class="Module">Ledger.Conway.Specification.Abstract</a>
<a id="440" class="Keyword">open</a> <a id="445" class="Keyword">import</a> <a id="452" href="Ledger.Conway.Specification.Transaction.html" class="Module">Ledger.Conway.Specification.Transaction</a>
<a id="492" class="Keyword">open</a> <a id="497" class="Keyword">import</a> <a id="504" href="Ledger.Prelude.Numeric.UnitInterval.html" class="Module">Ledger.Prelude.Numeric.UnitInterval</a>

<a id="541" class="Keyword">open</a> <a id="546" class="Keyword">import</a> <a id="553" href="Agda.Builtin.FromNat.html" class="Module">Agda.Builtin.FromNat</a>
<a id="574" class="Keyword">open</a>        <a id="586" href="Agda.Builtin.FromNat.html#196" class="Module">Number</a> <a id="593" href="Data.Rational.Literals.html#740" class="Function">number</a> <a id="600" class="Keyword">renaming</a> <a id="609" class="Symbol">(</a><a id="610" href="Agda.Builtin.FromNat.html#281" class="Field">fromNat</a> <a id="618" class="Symbol">to</a> <a id="621" class="Field">fromℕ</a><a id="626" class="Symbol">)</a>

<a id="629" class="Keyword">module</a> <a id="636" href="Ledger.Conway.Specification.Rewards.html" class="Module">Ledger.Conway.Specification.Rewards</a>
  <a id="674" class="Symbol">(</a><a id="675" href="Ledger.Conway.Specification.Rewards.html#675" class="Bound">txs</a> <a id="679" class="Symbol">:</a> <a id="681" class="Symbol">_)</a> <a id="684" class="Symbol">(</a><a id="685" class="Keyword">open</a> <a id="690" href="Ledger.Conway.Specification.Transaction.html#999" class="Module">TransactionStructure</a> <a id="711" href="Ledger.Conway.Specification.Rewards.html#675" class="Bound">txs</a><a id="714" class="Symbol">)</a>
  <a id="718" class="Symbol">(</a><a id="719" href="Ledger.Conway.Specification.Rewards.html#719" class="Bound">abs</a> <a id="723" class="Symbol">:</a> <a id="725" href="Ledger.Conway.Specification.Abstract.html#654" class="Record">AbstractFunctions</a> <a id="743" href="Ledger.Conway.Specification.Rewards.html#675" class="Bound">txs</a><a id="746" class="Symbol">)</a>
  <a id="750" class="Keyword">where</a>

<a id="757" class="Keyword">open</a> <a id="762" class="Keyword">import</a> <a id="769" href="Ledger.Conway.Specification.Certs.html" class="Module">Ledger.Conway.Specification.Certs</a> <a id="803" href="Ledger.Conway.Specification.Transaction.html#2077" class="Function">govStructure</a>
<a id="816" class="Keyword">open</a> <a id="821" class="Keyword">import</a> <a id="828" href="Ledger.Conway.Specification.Ledger.html" class="Module">Ledger.Conway.Specification.Ledger</a> <a id="863" href="Ledger.Conway.Specification.Rewards.html#675" class="Bound">txs</a> <a id="867" href="Ledger.Conway.Specification.Rewards.html#719" class="Bound">abs</a>
<a id="871" class="Keyword">open</a> <a id="876" class="Keyword">import</a> <a id="883" href="Ledger.Prelude.html" class="Module">Ledger.Prelude</a> <a id="898" class="Keyword">hiding</a> <a id="905" class="Symbol">(</a><a id="906" href="Data.Nat.Base.html#7102" class="Function Operator">_/_</a><a id="909" class="Symbol">;</a> <a id="911" href="Agda.Builtin.Nat.html#539" class="Primitive Operator">_*_</a><a id="914" class="Symbol">;</a> <a id="916" href="Interface.HasSubtract.html#209" class="Field Operator">_-_</a><a id="919" class="Symbol">;</a> <a id="921" href="Data.Nat.Base.html#3537" class="Function">&gt;-nonZero</a><a id="930" class="Symbol">;</a> <a id="932" href="Data.Nat.Base.html#5851" class="Function Operator">_⊓_</a><a id="935" class="Symbol">)</a>
<a id="937" class="Keyword">open</a> <a id="942" class="Keyword">import</a> <a id="949" href="Ledger.Conway.Specification.Utxo.html" class="Module">Ledger.Conway.Specification.Utxo</a> <a id="982" href="Ledger.Conway.Specification.Rewards.html#675" class="Bound">txs</a> <a id="986" href="Ledger.Conway.Specification.Rewards.html#719" class="Bound">abs</a>


<a id="nonZero-max-1"></a><a id="992" href="Ledger.Conway.Specification.Rewards.html#992" class="Function">nonZero-max-1</a> <a id="1006" class="Symbol">:</a> <a id="1008" class="Symbol">∀</a> <a id="1010" class="Symbol">(</a><a id="1011" href="Ledger.Conway.Specification.Rewards.html#1011" class="Bound">n</a> <a id="1013" class="Symbol">:</a> <a id="1015" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a><a id="1016" class="Symbol">)</a> <a id="1018" class="Symbol">→</a> <a id="1020" href="Data.Nat.Base.html#3266" class="Record">NonZero</a> <a id="1028" class="Symbol">(</a><a id="1029" class="Number">1</a> <a id="1031" href="Data.Nat.Base.html#5485" class="Function Operator">⊔</a> <a id="1033" href="Ledger.Conway.Specification.Rewards.html#1011" class="Bound">n</a><a id="1034" class="Symbol">)</a>
<a id="1036" href="Ledger.Conway.Specification.Rewards.html#992" class="Function">nonZero-max-1</a> <a id="1050" href="Agda.Builtin.Nat.html#221" class="InductiveConstructor">zero</a> <a id="1055" class="Symbol">=</a> <a id="1057" href="Data.Nat.Base.html#3359" class="Function">nonZero</a>
<a id="1065" href="Ledger.Conway.Specification.Rewards.html#992" class="Function">nonZero-max-1</a> <a id="1079" class="Symbol">(</a><a id="1080" href="Agda.Builtin.Nat.html#234" class="InductiveConstructor">suc</a> <a id="1084" href="Ledger.Conway.Specification.Rewards.html#1084" class="Bound">n</a><a id="1085" class="Symbol">)</a> <a id="1087" class="Symbol">=</a> <a id="1089" href="Data.Nat.Base.html#3359" class="Function">nonZero</a>

<a id="nonZero-1/n"></a><a id="1098" href="Ledger.Conway.Specification.Rewards.html#1098" class="Function">nonZero-1/n</a> <a id="1110" class="Symbol">:</a> <a id="1112" class="Symbol">∀</a> <a id="1114" class="Symbol">(</a><a id="1115" href="Ledger.Conway.Specification.Rewards.html#1115" class="Bound">n</a> <a id="1117" class="Symbol">:</a> <a id="1119" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a><a id="1120" class="Symbol">)</a> <a id="1122" class="Symbol">→</a> <a id="1124" class="Symbol">.{{</a><a id="1127" href="Ledger.Conway.Specification.Rewards.html#1127" class="Bound">_</a> <a id="1129" class="Symbol">:</a> <a id="1131" href="Data.Nat.Base.html#3266" class="Record">NonZero</a> <a id="1139" href="Ledger.Conway.Specification.Rewards.html#1115" class="Bound">n</a><a id="1140" class="Symbol">}}</a> <a id="1143" class="Symbol">→</a> <a id="1145" href="Ledger.Conway.Specification.Rewards.html#221" class="Function">NonZeroℚ</a> <a id="1154" class="Symbol">(</a><a id="1155" class="Number">1</a> <a id="1157" href="Data.Rational.Base.html#3963" class="Function Operator">/</a> <a id="1159" href="Ledger.Conway.Specification.Rewards.html#1115" class="Bound">n</a><a id="1160" class="Symbol">)</a>
<a id="1162" href="Ledger.Conway.Specification.Rewards.html#1098" class="Function">nonZero-1/n</a> <a id="1174" href="Ledger.Conway.Specification.Rewards.html#1174" class="Bound">n</a> <a id="1176" class="Symbol">{{</a><a id="1178" href="Ledger.Conway.Specification.Rewards.html#1178" class="Bound">prf</a><a id="1181" class="Symbol">}}</a> <a id="1184" class="Symbol">=</a>
  <a id="1188" href="Data.Rational.Properties.html#7854" class="Function">pos⇒nonZero</a> <a id="1200" class="Symbol">(</a><a id="1201" class="Number">1</a> <a id="1203" href="Data.Rational.Base.html#3963" class="Function Operator">/</a> <a id="1205" href="Ledger.Conway.Specification.Rewards.html#1174" class="Bound">n</a><a id="1206" class="Symbol">)</a> <a id="1208" class="Symbol">{{</a><a id="1210" href="Data.Rational.Properties.html#11914" class="Function">normalize-pos</a> <a id="1224" class="Number">1</a> <a id="1226" href="Ledger.Conway.Specification.Rewards.html#1174" class="Bound">n</a> <a id="1228" class="Symbol">{{</a><a id="1230" href="Ledger.Conway.Specification.Rewards.html#1178" class="Bound">prf</a><a id="1233" class="Symbol">}}</a> <a id="1236" class="Symbol">{{_}}</a> <a id="1242" class="Symbol">}}</a>

<a id="nonZero-1+max0-x"></a><a id="1246" href="Ledger.Conway.Specification.Rewards.html#1246" class="Function">nonZero-1+max0-x</a> <a id="1263" class="Symbol">:</a> <a id="1265" class="Symbol">∀</a> <a id="1267" class="Symbol">(</a><a id="1268" href="Ledger.Conway.Specification.Rewards.html#1268" class="Bound">x</a> <a id="1270" class="Symbol">:</a> <a id="1272" href="Data.Rational.Base.html#1421" class="Record">ℚ</a><a id="1273" class="Symbol">)</a> <a id="1275" class="Symbol">→</a> <a id="1277" href="Ledger.Conway.Specification.Rewards.html#221" class="Function">NonZeroℚ</a> <a id="1286" class="Symbol">(</a><a id="1287" class="Number">1</a> <a id="1289" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="1291" class="Symbol">(</a><a id="1292" class="Number">0</a> <a id="1294" href="Ledger.Conway.Specification.Rewards.html#204" class="Function Operator">⊔ℚ</a> <a id="1297" href="Ledger.Conway.Specification.Rewards.html#1268" class="Bound">x</a><a id="1298" class="Symbol">))</a>
<a id="1301" href="Ledger.Conway.Specification.Rewards.html#1246" class="Function">nonZero-1+max0-x</a> <a id="1318" href="Ledger.Conway.Specification.Rewards.html#1318" class="Bound">x</a> <a id="1320" class="Symbol">=</a>
  <a id="1324" href="Data.Rational.Base.html#5293" class="Function">&gt;-nonZero</a> <a id="1334" class="Symbol">(</a><a id="1335" href="Data.Rational.Properties.html#36227" class="Function">+-mono-&lt;-≤</a> <a id="1346" class="Symbol">(</a><a id="1347" href="Data.Rational.Properties.html#26962" class="Function">positive⁻¹</a> <a id="1358" class="Number">1</a> <a id="1360" class="Symbol">{{_}})</a> <a id="1367" class="Symbol">(</a><a id="1368" href="Data.Rational.Properties.html#58180" class="Function">p≤p⊔q</a> <a id="1374" class="Number">0</a> <a id="1376" href="Ledger.Conway.Specification.Rewards.html#1318" class="Bound">x</a><a id="1377" class="Symbol">))</a>


<a id="maxPool"></a><a id="1382" href="Ledger.Conway.Specification.Rewards.html#1382" class="Function">maxPool</a> <a id="1390" class="Symbol">:</a> <a id="1392" href="Ledger.Conway.Specification.PParams.html#1685" class="Record">PParams</a> <a id="1400" class="Symbol">→</a> <a id="1402" href="Ledger.Prelude.Base.html#154" class="Function">Coin</a> <a id="1407" class="Symbol">→</a> <a id="1409" href="Ledger.Prelude.Numeric.UnitInterval.html#1776" class="Function">UnitInterval</a> <a id="1422" class="Symbol">→</a> <a id="1424" href="Ledger.Prelude.Numeric.UnitInterval.html#1776" class="Function">UnitInterval</a> <a id="1437" class="Symbol">→</a> <a id="1439" href="Ledger.Prelude.Base.html#154" class="Function">Coin</a>
<a id="1444" href="Ledger.Conway.Specification.Rewards.html#1382" class="Function">maxPool</a> <a id="1452" href="Ledger.Conway.Specification.Rewards.html#1452" class="Bound">pparams</a> <a id="1460" href="Ledger.Conway.Specification.Rewards.html#1460" class="Bound">rewardPot</a> <a id="1470" href="Ledger.Conway.Specification.Rewards.html#1470" class="Bound">stake</a> <a id="1476" href="Ledger.Conway.Specification.Rewards.html#1476" class="Bound">pledge</a> <a id="1483" class="Symbol">=</a> <a id="1485" href="Ledger.Conway.Specification.Rewards.html#2190" class="Function">rewardℕ</a>
  <a id="1495" class="Keyword">where</a>
    <a id="1505" href="Ledger.Conway.Specification.Rewards.html#1505" class="Function">a0</a>    <a id="1511" class="Symbol">=</a> <a id="1513" class="Number">0</a> <a id="1515" href="Ledger.Conway.Specification.Rewards.html#204" class="Function Operator">⊔ℚ</a> <a id="1518" href="Ledger.Conway.Specification.Rewards.html#1452" class="Bound">pparams</a> <a id="1526" class="Symbol">.</a><a id="1527" href="Ledger.Conway.Specification.PParams.html#2886" class="Field">PParams.a0</a>
    <a id="1542" href="Ledger.Conway.Specification.Rewards.html#1542" class="Function">1+a0</a>  <a id="1548" class="Symbol">=</a> <a id="1550" class="Number">1</a> <a id="1552" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="1554" href="Ledger.Conway.Specification.Rewards.html#1505" class="Function">a0</a>
    <a id="1561" href="Ledger.Conway.Specification.Rewards.html#1561" class="Function">nopt</a>  <a id="1567" class="Symbol">=</a> <a id="1569" class="Number">1</a> <a id="1571" href="Data.Nat.Base.html#5485" class="Function Operator">⊔</a> <a id="1573" href="Ledger.Conway.Specification.Rewards.html#1452" class="Bound">pparams</a> <a id="1581" class="Symbol">.</a><a id="1582" href="Ledger.Conway.Specification.PParams.html#2844" class="Field">PParams.nopt</a>


    <a id="1601" class="Keyword">instance</a>
      <a id="1616" href="Ledger.Conway.Specification.Rewards.html#1616" class="Function">nonZero-nopt</a> <a id="1629" class="Symbol">:</a> <a id="1631" href="Data.Nat.Base.html#3266" class="Record">NonZero</a> <a id="1639" href="Ledger.Conway.Specification.Rewards.html#1561" class="Function">nopt</a>
      <a id="1650" href="Ledger.Conway.Specification.Rewards.html#1616" class="Function">nonZero-nopt</a> <a id="1663" class="Symbol">=</a> <a id="1665" href="Ledger.Conway.Specification.Rewards.html#992" class="Function">nonZero-max-1</a> <a id="1679" class="Symbol">(</a><a id="1680" href="Ledger.Conway.Specification.Rewards.html#1452" class="Bound">pparams</a> <a id="1688" class="Symbol">.</a><a id="1689" href="Ledger.Conway.Specification.PParams.html#2844" class="Field">PParams.nopt</a><a id="1701" class="Symbol">)</a>


    <a id="1709" href="Ledger.Conway.Specification.Rewards.html#1709" class="Function">z0</a>       <a id="1718" class="Symbol">=</a> <a id="1720" class="Number">1</a> <a id="1722" href="Data.Rational.Base.html#3963" class="Function Operator">/</a> <a id="1724" href="Ledger.Conway.Specification.Rewards.html#1561" class="Function">nopt</a>
    <a id="1733" href="Ledger.Conway.Specification.Rewards.html#1733" class="Function">stake&#39;</a>   <a id="1742" class="Symbol">=</a> <a id="1744" href="Ledger.Prelude.Numeric.UnitInterval.html#1988" class="Function">fromUnitInterval</a> <a id="1761" href="Ledger.Conway.Specification.Rewards.html#1470" class="Bound">stake</a> <a id="1767" href="Data.Rational.Base.html#6933" class="Function Operator">⊓</a> <a id="1769" href="Ledger.Conway.Specification.Rewards.html#1709" class="Function">z0</a>
    <a id="1776" href="Ledger.Conway.Specification.Rewards.html#1776" class="Function">pledge&#39;</a>  <a id="1785" class="Symbol">=</a> <a id="1787" href="Ledger.Prelude.Numeric.UnitInterval.html#1988" class="Function">fromUnitInterval</a> <a id="1804" href="Ledger.Conway.Specification.Rewards.html#1476" class="Bound">pledge</a> <a id="1811" href="Data.Rational.Base.html#6933" class="Function Operator">⊓</a> <a id="1813" href="Ledger.Conway.Specification.Rewards.html#1709" class="Function">z0</a>


    <a id="1822" class="Keyword">instance</a>
      <a id="1837" href="Ledger.Conway.Specification.Rewards.html#1837" class="Function">nonZeroz0</a> <a id="1847" class="Symbol">:</a> <a id="1849" href="Ledger.Conway.Specification.Rewards.html#221" class="Function">NonZeroℚ</a> <a id="1858" href="Ledger.Conway.Specification.Rewards.html#1709" class="Function">z0</a>
      <a id="1867" href="Ledger.Conway.Specification.Rewards.html#1837" class="Function">nonZeroz0</a> <a id="1877" class="Symbol">=</a> <a id="1879" href="Ledger.Conway.Specification.Rewards.html#1098" class="Function">nonZero-1/n</a> <a id="1891" href="Ledger.Conway.Specification.Rewards.html#1561" class="Function">nopt</a>

      <a id="1903" href="Ledger.Conway.Specification.Rewards.html#1903" class="Function">nonZero-1+a0</a> <a id="1916" class="Symbol">:</a> <a id="1918" href="Ledger.Conway.Specification.Rewards.html#221" class="Function">NonZeroℚ</a> <a id="1927" class="Symbol">(</a><a id="1928" href="Ledger.Conway.Specification.Rewards.html#1542" class="Function">1+a0</a><a id="1932" class="Symbol">)</a>
      <a id="1940" href="Ledger.Conway.Specification.Rewards.html#1903" class="Function">nonZero-1+a0</a> <a id="1953" class="Symbol">=</a> <a id="1955" href="Ledger.Conway.Specification.Rewards.html#1246" class="Function">nonZero-1+max0-x</a> <a id="1972" class="Symbol">(</a><a id="1973" href="Ledger.Conway.Specification.Rewards.html#1452" class="Bound">pparams</a> <a id="1981" class="Symbol">.</a><a id="1982" href="Ledger.Conway.Specification.PParams.html#2886" class="Field">PParams.a0</a><a id="1992" class="Symbol">)</a>


    <a id="2000" href="Ledger.Conway.Specification.Rewards.html#2000" class="Function">rewardℚ</a> <a id="2008" class="Symbol">=</a>  <a id="2011" href="Ledger.Conway.Specification.Rewards.html#621" class="Function">fromℕ</a> <a id="2017" href="Ledger.Conway.Specification.Rewards.html#1460" class="Bound">rewardPot</a> <a id="2027" href="Data.Rational.Base.html#6787" class="Function Operator">÷</a> <a id="2029" href="Ledger.Conway.Specification.Rewards.html#1542" class="Function">1+a0</a>
               <a id="2049" href="Data.Rational.Base.html#6394" class="Function Operator">*</a>  <a id="2052" class="Symbol">(</a>  <a id="2055" href="Ledger.Conway.Specification.Rewards.html#1733" class="Function">stake&#39;</a> <a id="2062" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="2064" href="Ledger.Conway.Specification.Rewards.html#1776" class="Function">pledge&#39;</a> <a id="2072" href="Data.Rational.Base.html#6394" class="Function Operator">*</a> <a id="2074" href="Ledger.Conway.Specification.Rewards.html#1505" class="Function">a0</a>
                    <a id="2097" href="Data.Rational.Base.html#6394" class="Function Operator">*</a> <a id="2099" class="Symbol">(</a> <a id="2101" href="Ledger.Conway.Specification.Rewards.html#1733" class="Function">stake&#39;</a> <a id="2108" href="Data.Rational.Base.html#6484" class="Function Operator">-</a> <a id="2110" href="Ledger.Conway.Specification.Rewards.html#1776" class="Function">pledge&#39;</a> <a id="2118" href="Data.Rational.Base.html#6394" class="Function Operator">*</a> <a id="2120" class="Symbol">(</a><a id="2121" href="Ledger.Conway.Specification.Rewards.html#1709" class="Function">z0</a> <a id="2124" href="Data.Rational.Base.html#6484" class="Function Operator">-</a> <a id="2126" href="Ledger.Conway.Specification.Rewards.html#1733" class="Function">stake&#39;</a><a id="2132" class="Symbol">)</a> <a id="2134" href="Data.Rational.Base.html#6787" class="Function Operator">÷</a> <a id="2136" href="Ledger.Conway.Specification.Rewards.html#1709" class="Function">z0</a> <a id="2139" class="Symbol">)</a>
                    <a id="2161" href="Data.Rational.Base.html#6787" class="Function Operator">÷</a> <a id="2163" href="Ledger.Conway.Specification.Rewards.html#1709" class="Function">z0</a>
                  <a id="2184" class="Symbol">)</a>
    <a id="2190" href="Ledger.Conway.Specification.Rewards.html#2190" class="Function">rewardℕ</a> <a id="2198" class="Symbol">=</a> <a id="2200" href="Prelude.html#3279" class="Function">posPart</a> <a id="2208" class="Symbol">(</a><a id="2209" href="Data.Rational.Base.html#7195" class="Function">floor</a> <a id="2215" href="Ledger.Conway.Specification.Rewards.html#2000" class="Function">rewardℚ</a><a id="2222" class="Symbol">)</a>


<a id="mkApparentPerformance"></a><a id="2226" href="Ledger.Conway.Specification.Rewards.html#2226" class="Function">mkApparentPerformance</a> <a id="2248" class="Symbol">:</a> <a id="2250" href="Ledger.Prelude.Numeric.UnitInterval.html#1776" class="Function">UnitInterval</a> <a id="2263" class="Symbol">→</a> <a id="2265" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a> <a id="2267" class="Symbol">→</a> <a id="2269" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a> <a id="2271" class="Symbol">→</a> <a id="2273" href="Data.Rational.Base.html#1421" class="Record">ℚ</a>
<a id="2275" href="Ledger.Conway.Specification.Rewards.html#2226" class="Function">mkApparentPerformance</a> <a id="2297" href="Ledger.Conway.Specification.Rewards.html#2297" class="Bound">stake</a> <a id="2303" href="Ledger.Conway.Specification.Rewards.html#2303" class="Bound">poolBlocks</a> <a id="2314" href="Ledger.Conway.Specification.Rewards.html#2314" class="Bound">totalBlocks</a> <a id="2326" class="Symbol">=</a> <a id="2328" href="Ledger.Conway.Specification.Rewards.html#2523" class="Function">ratioBlocks</a> <a id="2340" href="Ledger.Prelude.html#2015" class="Function Operator">÷₀</a> <a id="2343" href="Ledger.Conway.Specification.Rewards.html#2362" class="Function">stake&#39;</a>
  <a id="2352" class="Keyword">where</a>
    <a id="2362" href="Ledger.Conway.Specification.Rewards.html#2362" class="Function">stake&#39;</a> <a id="2369" class="Symbol">=</a> <a id="2371" href="Ledger.Prelude.Numeric.UnitInterval.html#1988" class="Function">fromUnitInterval</a> <a id="2388" href="Ledger.Conway.Specification.Rewards.html#2297" class="Bound">stake</a>


    <a id="2400" class="Keyword">instance</a>
      <a id="2415" href="Ledger.Conway.Specification.Rewards.html#2415" class="Function">nonZero-totalBlocks</a> <a id="2435" class="Symbol">:</a> <a id="2437" href="Data.Nat.Base.html#3266" class="Record">NonZero</a> <a id="2445" class="Symbol">(</a><a id="2446" class="Number">1</a> <a id="2448" href="Data.Nat.Base.html#5485" class="Function Operator">⊔</a> <a id="2450" href="Ledger.Conway.Specification.Rewards.html#2314" class="Bound">totalBlocks</a><a id="2461" class="Symbol">)</a>
      <a id="2469" href="Ledger.Conway.Specification.Rewards.html#2415" class="Function">nonZero-totalBlocks</a> <a id="2489" class="Symbol">=</a> <a id="2491" href="Ledger.Conway.Specification.Rewards.html#992" class="Function">nonZero-max-1</a> <a id="2505" href="Ledger.Conway.Specification.Rewards.html#2314" class="Bound">totalBlocks</a>


    <a id="2523" href="Ledger.Conway.Specification.Rewards.html#2523" class="Function">ratioBlocks</a> <a id="2535" class="Symbol">=</a> <a id="2537" class="Symbol">(</a><a id="2538" href="Ledger.Conway.Specification.Rewards.html#77" class="InductiveConstructor">pos</a> <a id="2542" href="Ledger.Conway.Specification.Rewards.html#2303" class="Bound">poolBlocks</a><a id="2552" class="Symbol">)</a> <a id="2554" href="Data.Rational.Base.html#3963" class="Function Operator">/</a> <a id="2556" class="Symbol">(</a><a id="2557" class="Number">1</a> <a id="2559" href="Data.Nat.Base.html#5485" class="Function Operator">⊔</a> <a id="2561" href="Ledger.Conway.Specification.Rewards.html#2314" class="Bound">totalBlocks</a><a id="2572" class="Symbol">)</a>


<a id="rewardOwners"></a><a id="2576" href="Ledger.Conway.Specification.Rewards.html#2576" class="Function">rewardOwners</a> <a id="2589" class="Symbol">:</a> <a id="2591" href="Ledger.Prelude.Base.html#154" class="Function">Coin</a> <a id="2596" class="Symbol">→</a> <a id="2598" href="Ledger.Conway.Specification.Certs.html#350" class="Record">StakePoolParams</a> <a id="2614" class="Symbol">→</a> <a id="2616" href="Ledger.Prelude.Numeric.UnitInterval.html#1776" class="Function">UnitInterval</a> <a id="2629" class="Symbol">→</a> <a id="2631" href="Ledger.Prelude.Numeric.UnitInterval.html#1776" class="Function">UnitInterval</a> <a id="2644" class="Symbol">→</a> <a id="2646" href="Ledger.Prelude.Base.html#154" class="Function">Coin</a>
<a id="2651" href="Ledger.Conway.Specification.Rewards.html#2576" class="Function">rewardOwners</a> <a id="2664" href="Ledger.Conway.Specification.Rewards.html#2664" class="Bound">rewards</a> <a id="2672" href="Ledger.Conway.Specification.Rewards.html#2672" class="Bound">poolParams</a> <a id="2683" href="Ledger.Conway.Specification.Rewards.html#2683" class="Bound">ownerStake</a> <a id="2694" href="Ledger.Conway.Specification.Rewards.html#2694" class="Bound">stake</a> <a id="2700" class="Symbol">=</a> <a id="2702" href="Class.ToBool.html#342" class="Function Operator">if</a> <a id="2705" href="Ledger.Conway.Specification.Rewards.html#2664" class="Bound">rewards</a> <a id="2713" href="Class.HasOrder.Core.html#613" class="Field Operator">≤</a> <a id="2715" href="Ledger.Conway.Specification.Rewards.html#2928" class="Function">cost</a>
  <a id="2722" href="Class.ToBool.html#342" class="Function Operator">then</a> <a id="2727" href="Ledger.Conway.Specification.Rewards.html#2664" class="Bound">rewards</a>
  <a id="2737" href="Class.ToBool.html#342" class="Function Operator">else</a> <a id="2742" href="Ledger.Conway.Specification.Rewards.html#2928" class="Function">cost</a> <a id="2747" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="2749" href="Prelude.html#3279" class="Function">posPart</a> <a id="2757" class="Symbol">(</a><a id="2758" href="Data.Rational.Base.html#7195" class="Function">floor</a> <a id="2764" class="Symbol">(</a>
        <a id="2774" class="Symbol">(</a><a id="2775" href="Ledger.Conway.Specification.Rewards.html#621" class="Function">fromℕ</a> <a id="2781" href="Ledger.Conway.Specification.Rewards.html#2664" class="Bound">rewards</a> <a id="2789" href="Data.Rational.Base.html#6484" class="Function Operator">-</a> <a id="2791" href="Ledger.Conway.Specification.Rewards.html#621" class="Function">fromℕ</a> <a id="2797" href="Ledger.Conway.Specification.Rewards.html#2928" class="Function">cost</a><a id="2801" class="Symbol">)</a> <a id="2803" href="Data.Rational.Base.html#6394" class="Function Operator">*</a> <a id="2805" class="Symbol">(</a><a id="2806" href="Ledger.Conway.Specification.Rewards.html#2979" class="Function">margin</a> <a id="2813" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="2815" class="Symbol">(</a><a id="2816" class="Number">1</a> <a id="2818" href="Data.Rational.Base.html#6484" class="Function Operator">-</a> <a id="2820" href="Ledger.Conway.Specification.Rewards.html#2979" class="Function">margin</a><a id="2826" class="Symbol">)</a> <a id="2828" href="Data.Rational.Base.html#6394" class="Function Operator">*</a> <a id="2830" href="Ledger.Conway.Specification.Rewards.html#2856" class="Function">ratioStake</a><a id="2840" class="Symbol">)))</a>
  <a id="2846" class="Keyword">where</a>
    <a id="2856" href="Ledger.Conway.Specification.Rewards.html#2856" class="Function">ratioStake</a>  <a id="2868" class="Symbol">=</a> <a id="2870" href="Ledger.Prelude.Numeric.UnitInterval.html#1988" class="Function">fromUnitInterval</a> <a id="2887" href="Ledger.Conway.Specification.Rewards.html#2683" class="Bound">ownerStake</a> <a id="2898" href="Ledger.Prelude.html#2015" class="Function Operator">÷₀</a> <a id="2901" href="Ledger.Prelude.Numeric.UnitInterval.html#1988" class="Function">fromUnitInterval</a> <a id="2918" href="Ledger.Conway.Specification.Rewards.html#2694" class="Bound">stake</a>
    <a id="2928" href="Ledger.Conway.Specification.Rewards.html#2928" class="Function">cost</a>        <a id="2940" class="Symbol">=</a> <a id="2942" href="Ledger.Conway.Specification.Rewards.html#2672" class="Bound">poolParams</a> <a id="2953" class="Symbol">.</a><a id="2954" href="Ledger.Conway.Specification.Certs.html#423" class="Field">StakePoolParams.cost</a>
    <a id="2979" href="Ledger.Conway.Specification.Rewards.html#2979" class="Function">margin</a>      <a id="2991" class="Symbol">=</a> <a id="2993" href="Ledger.Prelude.Numeric.UnitInterval.html#1988" class="Function">fromUnitInterval</a> <a id="3010" class="Symbol">(</a><a id="3011" href="Ledger.Conway.Specification.Rewards.html#2672" class="Bound">poolParams</a> <a id="3022" class="Symbol">.</a><a id="3023" href="Ledger.Conway.Specification.Certs.html#450" class="Field">StakePoolParams.margin</a><a id="3045" class="Symbol">)</a>


<a id="rewardMember"></a><a id="3049" href="Ledger.Conway.Specification.Rewards.html#3049" class="Function">rewardMember</a> <a id="3062" class="Symbol">:</a> <a id="3064" href="Ledger.Prelude.Base.html#154" class="Function">Coin</a> <a id="3069" class="Symbol">→</a> <a id="3071" href="Ledger.Conway.Specification.Certs.html#350" class="Record">StakePoolParams</a> <a id="3087" class="Symbol">→</a> <a id="3089" href="Ledger.Prelude.Numeric.UnitInterval.html#1776" class="Function">UnitInterval</a> <a id="3102" class="Symbol">→</a> <a id="3104" href="Ledger.Prelude.Numeric.UnitInterval.html#1776" class="Function">UnitInterval</a> <a id="3117" class="Symbol">→</a> <a id="3119" href="Ledger.Prelude.Base.html#154" class="Function">Coin</a>
<a id="3124" href="Ledger.Conway.Specification.Rewards.html#3049" class="Function">rewardMember</a> <a id="3137" href="Ledger.Conway.Specification.Rewards.html#3137" class="Bound">rewards</a> <a id="3145" href="Ledger.Conway.Specification.Rewards.html#3145" class="Bound">poolParams</a> <a id="3156" href="Ledger.Conway.Specification.Rewards.html#3156" class="Bound">memberStake</a> <a id="3168" href="Ledger.Conway.Specification.Rewards.html#3168" class="Bound">stake</a> <a id="3174" class="Symbol">=</a> <a id="3176" href="Class.ToBool.html#342" class="Function Operator">if</a> <a id="3179" href="Ledger.Conway.Specification.Rewards.html#3137" class="Bound">rewards</a> <a id="3187" href="Class.HasOrder.Core.html#613" class="Field Operator">≤</a> <a id="3189" href="Ledger.Conway.Specification.Rewards.html#3382" class="Function">cost</a>
  <a id="3196" href="Class.ToBool.html#342" class="Function Operator">then</a> <a id="3201" class="Number">0</a>
  <a id="3205" href="Class.ToBool.html#342" class="Function Operator">else</a> <a id="3210" href="Prelude.html#3279" class="Function">posPart</a> <a id="3218" class="Symbol">(</a><a id="3219" href="Data.Rational.Base.html#7195" class="Function">floor</a> <a id="3225" class="Symbol">(</a>
         <a id="3236" class="Symbol">(</a><a id="3237" href="Ledger.Conway.Specification.Rewards.html#621" class="Function">fromℕ</a> <a id="3243" href="Ledger.Conway.Specification.Rewards.html#3137" class="Bound">rewards</a> <a id="3251" href="Data.Rational.Base.html#6484" class="Function Operator">-</a> <a id="3253" href="Ledger.Conway.Specification.Rewards.html#621" class="Function">fromℕ</a> <a id="3259" href="Ledger.Conway.Specification.Rewards.html#3382" class="Function">cost</a><a id="3263" class="Symbol">)</a> <a id="3265" href="Data.Rational.Base.html#6394" class="Function Operator">*</a> <a id="3267" class="Symbol">((</a><a id="3269" class="Number">1</a> <a id="3271" href="Data.Rational.Base.html#6484" class="Function Operator">-</a> <a id="3273" href="Ledger.Conway.Specification.Rewards.html#3433" class="Function">margin</a><a id="3279" class="Symbol">)</a> <a id="3281" href="Data.Rational.Base.html#6394" class="Function Operator">*</a> <a id="3283" href="Ledger.Conway.Specification.Rewards.html#3309" class="Function">ratioStake</a><a id="3293" class="Symbol">)))</a>
  <a id="3299" class="Keyword">where</a>
    <a id="3309" href="Ledger.Conway.Specification.Rewards.html#3309" class="Function">ratioStake</a>  <a id="3321" class="Symbol">=</a> <a id="3323" href="Ledger.Prelude.Numeric.UnitInterval.html#1988" class="Function">fromUnitInterval</a> <a id="3340" href="Ledger.Conway.Specification.Rewards.html#3156" class="Bound">memberStake</a> <a id="3352" href="Ledger.Prelude.html#2015" class="Function Operator">÷₀</a> <a id="3355" href="Ledger.Prelude.Numeric.UnitInterval.html#1988" class="Function">fromUnitInterval</a> <a id="3372" href="Ledger.Conway.Specification.Rewards.html#3168" class="Bound">stake</a>
    <a id="3382" href="Ledger.Conway.Specification.Rewards.html#3382" class="Function">cost</a>        <a id="3394" class="Symbol">=</a> <a id="3396" href="Ledger.Conway.Specification.Rewards.html#3145" class="Bound">poolParams</a> <a id="3407" class="Symbol">.</a><a id="3408" href="Ledger.Conway.Specification.Certs.html#423" class="Field">StakePoolParams.cost</a>
    <a id="3433" href="Ledger.Conway.Specification.Rewards.html#3433" class="Function">margin</a>      <a id="3445" class="Symbol">=</a> <a id="3447" href="Ledger.Prelude.Numeric.UnitInterval.html#1988" class="Function">fromUnitInterval</a> <a id="3464" class="Symbol">(</a><a id="3465" href="Ledger.Conway.Specification.Rewards.html#3145" class="Bound">poolParams</a> <a id="3476" class="Symbol">.</a><a id="3477" href="Ledger.Conway.Specification.Certs.html#450" class="Field">StakePoolParams.margin</a><a id="3499" class="Symbol">)</a>


<a id="rewardOnePool"></a><a id="3503" href="Ledger.Conway.Specification.Rewards.html#3503" class="Function">rewardOnePool</a> <a id="3517" class="Symbol">:</a>  <a id="3520" href="Ledger.Conway.Specification.PParams.html#1685" class="Record">PParams</a> <a id="3528" class="Symbol">→</a> <a id="3530" href="Ledger.Prelude.Base.html#154" class="Function">Coin</a> <a id="3535" class="Symbol">→</a> <a id="3537" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a> <a id="3539" class="Symbol">→</a> <a id="3541" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a> <a id="3543" class="Symbol">→</a> <a id="3545" href="Ledger.Conway.Specification.Certs.html#350" class="Record">StakePoolParams</a>
                 <a id="3578" class="Symbol">→</a> <a id="3580" href="Ledger.Conway.Specification.Certs.html#1345" class="Function">Stake</a> <a id="3586" class="Symbol">→</a> <a id="3588" href="Ledger.Prelude.Numeric.UnitInterval.html#1776" class="Function">UnitInterval</a> <a id="3601" class="Symbol">→</a> <a id="3603" href="Ledger.Prelude.Numeric.UnitInterval.html#1776" class="Function">UnitInterval</a> <a id="3616" class="Symbol">→</a> <a id="3618" href="Ledger.Prelude.Base.html#154" class="Function">Coin</a> <a id="3623" class="Symbol">→</a> <a id="3625" href="Ledger.Conway.Specification.Certs.html#1345" class="Function">Stake</a>

<a id="3632" href="Ledger.Conway.Specification.Rewards.html#3503" class="Function">rewardOnePool</a> <a id="3646" href="Ledger.Conway.Specification.Rewards.html#3646" class="Bound">pp</a> <a id="3649" href="Ledger.Conway.Specification.Rewards.html#3649" class="Bound">rewardPot</a> <a id="3659" href="Ledger.Conway.Specification.Rewards.html#3659" class="Bound">n</a> <a id="3661" href="Ledger.Conway.Specification.Rewards.html#3661" class="Bound">N</a> <a id="3663" href="Ledger.Conway.Specification.Rewards.html#3663" class="Bound">poolParams</a> <a id="3674" href="Ledger.Conway.Specification.Rewards.html#3674" class="Bound">stakeDistr</a> <a id="3685" href="Ledger.Conway.Specification.Rewards.html#3685" class="Bound">σ</a> <a id="3687" href="Ledger.Conway.Specification.Rewards.html#3687" class="Bound">σa</a> <a id="3690" href="Ledger.Conway.Specification.Rewards.html#3690" class="Bound">tot</a> <a id="3694" class="Symbol">=</a> <a id="3696" href="Ledger.Conway.Specification.Rewards.html#4458" class="Function">memberRewards</a> <a id="3710" href="Axiom.Set.Map.Dec.html#2046" class="Function Operator">∪⁺</a> <a id="3713" href="Ledger.Conway.Specification.Rewards.html#4606" class="Function">ownersRewards</a>
  <a id="3729" class="Keyword">where</a>
  <a id="3737" href="Ledger.Conway.Specification.Rewards.html#3737" class="Function">mkRelativeStake</a> <a id="3753" class="Symbol">:</a> <a id="3755" href="Ledger.Prelude.Base.html#154" class="Function">Coin</a> <a id="3760" class="Symbol">→</a> <a id="3762" href="Ledger.Prelude.Numeric.UnitInterval.html#1776" class="Function">UnitInterval</a>
  <a id="3777" href="Ledger.Conway.Specification.Rewards.html#3737" class="Function">mkRelativeStake</a> <a id="3793" class="Symbol">=</a> <a id="3795" class="Symbol">λ</a> <a id="3797" href="Ledger.Conway.Specification.Rewards.html#3797" class="Bound">coin</a> <a id="3802" class="Symbol">→</a> <a id="3804" href="Ledger.Prelude.Numeric.UnitInterval.html#2764" class="Function">clamp</a> <a id="3810" class="Symbol">(</a><a id="3811" href="Ledger.Conway.Specification.Rewards.html#3797" class="Bound">coin</a> <a id="3816" href="Ledger.Prelude.html#1896" class="Function Operator">/₀</a> <a id="3819" href="Ledger.Conway.Specification.Rewards.html#3690" class="Bound">tot</a><a id="3822" class="Symbol">)</a>

  <a id="3827" href="Ledger.Conway.Specification.Rewards.html#3827" class="Function">owners</a> <a id="3834" class="Symbol">:</a> <a id="3836" href="abstract-set-theory.FiniteSetTheory.html#488" class="Function Operator">ℙ</a> <a id="3838" href="Ledger.Core.Specification.Address.html#260" class="Datatype">Credential</a>
  <a id="3851" href="Ledger.Conway.Specification.Rewards.html#3827" class="Function">owners</a> <a id="3858" class="Symbol">=</a> <a id="3860" href="abstract-set-theory.FiniteSetTheory.html#519" class="Function">mapˢ</a> <a id="3865" href="Ledger.Core.Specification.Address.html#286" class="InductiveConstructor">KeyHashObj</a> <a id="3876" class="Symbol">(</a><a id="3877" href="Ledger.Conway.Specification.Rewards.html#3663" class="Bound">poolParams</a> <a id="3888" class="Symbol">.</a><a id="3889" href="Ledger.Conway.Specification.Certs.html#391" class="Field">StakePoolParams.owners</a><a id="3911" class="Symbol">)</a>

  <a id="3916" href="Ledger.Conway.Specification.Rewards.html#3916" class="Function">ownerStake</a> <a id="3927" href="Ledger.Conway.Specification.Rewards.html#3927" class="Function">pledge</a> <a id="3934" href="Ledger.Conway.Specification.Rewards.html#3934" class="Function">maxP</a> <a id="3939" href="Ledger.Conway.Specification.Rewards.html#3939" class="Function">poolReward</a> <a id="3950" class="Symbol">:</a> <a id="3952" href="Ledger.Prelude.Base.html#154" class="Function">Coin</a>
  <a id="3959" href="Ledger.Conway.Specification.Rewards.html#3916" class="Function">ownerStake</a>  <a id="3971" class="Symbol">=</a> <a id="3973" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">∑[</a> <a id="3976" href="Ledger.Conway.Specification.Rewards.html#3976" class="Bound">c</a> <a id="3978" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">←</a> <a id="3980" href="Ledger.Conway.Specification.Rewards.html#3674" class="Bound">stakeDistr</a> <a id="3991" href="Axiom.Set.Map.html#10678" class="Function Operator">∣</a> <a id="3993" href="Ledger.Conway.Specification.Rewards.html#3827" class="Function">owners</a> <a id="4000" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">]</a> <a id="4002" href="Ledger.Conway.Specification.Rewards.html#3976" class="Bound">c</a>
  <a id="4006" href="Ledger.Conway.Specification.Rewards.html#3927" class="Function">pledge</a>      <a id="4018" class="Symbol">=</a> <a id="4020" href="Ledger.Conway.Specification.Rewards.html#3663" class="Bound">poolParams</a> <a id="4031" class="Symbol">.</a><a id="4032" href="Ledger.Conway.Specification.Certs.html#485" class="Field">StakePoolParams.pledge</a>
  <a id="4057" href="Ledger.Conway.Specification.Rewards.html#3934" class="Function">maxP</a>        <a id="4069" class="Symbol">=</a>  <a id="4072" href="Class.ToBool.html#342" class="Function Operator">if</a> <a id="4075" href="Ledger.Conway.Specification.Rewards.html#3927" class="Function">pledge</a> <a id="4082" href="Class.HasOrder.Core.html#613" class="Field Operator">≤</a> <a id="4084" href="Ledger.Conway.Specification.Rewards.html#3916" class="Function">ownerStake</a>
                 <a id="4112" href="Class.ToBool.html#342" class="Function Operator">then</a> <a id="4117" href="Ledger.Conway.Specification.Rewards.html#1382" class="Function">maxPool</a> <a id="4125" href="Ledger.Conway.Specification.Rewards.html#3646" class="Bound">pp</a> <a id="4128" href="Ledger.Conway.Specification.Rewards.html#3649" class="Bound">rewardPot</a> <a id="4138" href="Ledger.Conway.Specification.Rewards.html#3685" class="Bound">σ</a> <a id="4140" class="Symbol">(</a><a id="4141" href="Ledger.Conway.Specification.Rewards.html#3737" class="Function">mkRelativeStake</a> <a id="4157" href="Ledger.Conway.Specification.Rewards.html#3927" class="Function">pledge</a><a id="4163" class="Symbol">)</a>
                 <a id="4182" href="Class.ToBool.html#342" class="Function Operator">else</a> <a id="4187" class="Number">0</a>
  <a id="4191" href="Ledger.Conway.Specification.Rewards.html#3939" class="Function">poolReward</a>  <a id="4203" class="Symbol">=</a> <a id="4205" href="Prelude.html#3279" class="Function">posPart</a> <a id="4213" href="Function.Base.html#1993" class="Function Operator">$</a> <a id="4215" href="Data.Rational.Base.html#7195" class="Function">floor</a> <a id="4221" href="Function.Base.html#1993" class="Function Operator">$</a> <a id="4223" class="Symbol">(</a><a id="4224" href="Ledger.Conway.Specification.Rewards.html#2226" class="Function">mkApparentPerformance</a> <a id="4246" href="Ledger.Conway.Specification.Rewards.html#3687" class="Bound">σa</a> <a id="4249" href="Ledger.Conway.Specification.Rewards.html#3659" class="Bound">n</a> <a id="4251" href="Ledger.Conway.Specification.Rewards.html#3661" class="Bound">N</a><a id="4252" class="Symbol">)</a> <a id="4254" href="Data.Rational.Base.html#6394" class="Function Operator">*</a> <a id="4256" href="Ledger.Conway.Specification.Rewards.html#621" class="Function">fromℕ</a> <a id="4262" href="Ledger.Conway.Specification.Rewards.html#3934" class="Function">maxP</a>

  <a id="4270" href="Ledger.Conway.Specification.Rewards.html#4270" class="Function Operator">stakeMap[_]</a> <a id="4282" class="Symbol">:</a>  <a id="4285" class="Symbol">(</a><a id="4286" href="Ledger.Prelude.Base.html#154" class="Function">Coin</a> <a id="4291" class="Symbol">→</a> <a id="4293" href="Ledger.Conway.Specification.Certs.html#350" class="Record">StakePoolParams</a> <a id="4309" class="Symbol">→</a> <a id="4311" href="Ledger.Prelude.Numeric.UnitInterval.html#1776" class="Function">UnitInterval</a> <a id="4324" class="Symbol">→</a> <a id="4326" href="Ledger.Prelude.Numeric.UnitInterval.html#1776" class="Function">UnitInterval</a> <a id="4339" class="Symbol">→</a> <a id="4341" href="Ledger.Prelude.Base.html#154" class="Function">Coin</a><a id="4345" class="Symbol">)</a>
                 <a id="4364" class="Symbol">→</a> <a id="4366" href="Ledger.Prelude.Base.html#154" class="Function">Coin</a> <a id="4371" class="Symbol">→</a> <a id="4373" href="Ledger.Prelude.Numeric.UnitInterval.html#1776" class="Function">UnitInterval</a> <a id="4386" class="Symbol">→</a> <a id="4388" href="Ledger.Prelude.Base.html#154" class="Function">Coin</a>
  <a id="4395" href="Ledger.Conway.Specification.Rewards.html#4270" class="Function Operator">stakeMap[</a> <a id="4405" href="Ledger.Conway.Specification.Rewards.html#4405" class="Bound">f</a> <a id="4407" href="Ledger.Conway.Specification.Rewards.html#4270" class="Function Operator">]</a> <a id="4409" class="Symbol">=</a> <a id="4411" class="Symbol">(</a><a id="4412" href="Ledger.Conway.Specification.Rewards.html#4405" class="Bound">f</a> <a id="4414" href="Ledger.Conway.Specification.Rewards.html#3939" class="Function">poolReward</a> <a id="4425" href="Ledger.Conway.Specification.Rewards.html#3663" class="Bound">poolParams</a><a id="4435" class="Symbol">)</a> <a id="4437" href="Function.Base.html#1134" class="Function Operator">∘</a> <a id="4439" href="Ledger.Conway.Specification.Rewards.html#3737" class="Function">mkRelativeStake</a>

  <a id="4458" href="Ledger.Conway.Specification.Rewards.html#4458" class="Function">memberRewards</a> <a id="4472" class="Symbol">:</a> <a id="4474" href="Ledger.Conway.Specification.Certs.html#1345" class="Function">Stake</a>
  <a id="4482" href="Ledger.Conway.Specification.Rewards.html#4458" class="Function">memberRewards</a> <a id="4496" class="Symbol">=</a> <a id="4498" href="Axiom.Set.Map.html#6068" class="Function">mapValues</a> <a id="4508" class="Symbol">(λ</a> <a id="4511" href="Ledger.Conway.Specification.Rewards.html#4511" class="Bound">coin</a> <a id="4516" class="Symbol">→</a> <a id="4518" href="Ledger.Conway.Specification.Rewards.html#4270" class="Function Operator">stakeMap[</a> <a id="4528" href="Ledger.Conway.Specification.Rewards.html#3049" class="Function">rewardMember</a> <a id="4541" href="Ledger.Conway.Specification.Rewards.html#4270" class="Function Operator">]</a> <a id="4543" href="Ledger.Conway.Specification.Rewards.html#4511" class="Bound">coin</a> <a id="4548" href="Ledger.Conway.Specification.Rewards.html#3685" class="Bound">σ</a><a id="4549" class="Symbol">)</a>
                            <a id="4579" class="Symbol">(</a><a id="4580" href="Ledger.Conway.Specification.Rewards.html#3674" class="Bound">stakeDistr</a> <a id="4591" href="Axiom.Set.Map.html#10748" class="Function Operator">∣</a> <a id="4593" href="Ledger.Conway.Specification.Rewards.html#3827" class="Function">owners</a> <a id="4600" href="Axiom.Set.Map.html#10748" class="Function Operator">ᶜ</a><a id="4601" class="Symbol">)</a>

  <a id="4606" href="Ledger.Conway.Specification.Rewards.html#4606" class="Function">ownersRewards</a> <a id="4620" class="Symbol">:</a> <a id="4622" href="Ledger.Conway.Specification.Certs.html#1345" class="Function">Stake</a>
  <a id="4630" href="Ledger.Conway.Specification.Rewards.html#4606" class="Function">ownersRewards</a> <a id="4644" class="Symbol">=</a>  <a id="4647" href="Axiom.Set.Map.html#4588" class="Function Operator">❴</a> <a id="4649" href="Ledger.Conway.Specification.Rewards.html#3663" class="Bound">poolParams</a> <a id="4660" class="Symbol">.</a><a id="4661" href="Ledger.Conway.Specification.Certs.html#512" class="Field">StakePoolParams.rewardAccount</a>
                   <a id="4710" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="4712" href="Ledger.Conway.Specification.Rewards.html#4270" class="Function Operator">stakeMap[</a> <a id="4722" href="Ledger.Conway.Specification.Rewards.html#2576" class="Function">rewardOwners</a> <a id="4735" href="Ledger.Conway.Specification.Rewards.html#4270" class="Function Operator">]</a> <a id="4737" href="Ledger.Conway.Specification.Rewards.html#3916" class="Function">ownerStake</a> <a id="4748" href="Ledger.Conway.Specification.Rewards.html#3685" class="Bound">σ</a> <a id="4750" href="Axiom.Set.Map.html#4588" class="Function Operator">❵ᵐ</a>


<a id="poolStake"></a><a id="4755" href="Ledger.Conway.Specification.Rewards.html#4755" class="Function">poolStake</a>  <a id="4766" class="Symbol">:</a> <a id="4768" href="Ledger.Core.Specification.Crypto.html#1386" class="Function">KeyHash</a> <a id="4776" class="Symbol">→</a> <a id="4778" href="Ledger.Conway.Specification.Certs.html#1385" class="Function">StakeDelegs</a> <a id="4790" class="Symbol">→</a> <a id="4792" href="Ledger.Conway.Specification.Certs.html#1345" class="Function">Stake</a> <a id="4798" class="Symbol">→</a> <a id="4800" href="Ledger.Conway.Specification.Certs.html#1345" class="Function">Stake</a>
<a id="4806" href="Ledger.Conway.Specification.Rewards.html#4755" class="Function">poolStake</a> <a id="4816" href="Ledger.Conway.Specification.Rewards.html#4816" class="Bound">hk</a> <a id="4819" href="Ledger.Conway.Specification.Rewards.html#4819" class="Bound">delegs</a> <a id="4826" href="Ledger.Conway.Specification.Rewards.html#4826" class="Bound">stake</a> <a id="4832" class="Symbol">=</a> <a id="4834" href="Ledger.Conway.Specification.Rewards.html#4826" class="Bound">stake</a> <a id="4840" href="Axiom.Set.Map.html#10678" class="Function Operator">∣</a> <a id="4842" href="Class.IsSet.html#916" class="Function">dom</a> <a id="4846" class="Symbol">(</a><a id="4847" href="Ledger.Conway.Specification.Rewards.html#4819" class="Bound">delegs</a> <a id="4854" href="Axiom.Set.Map.html#14434" class="Function Operator">∣^</a> <a id="4857" href="Class.HasSingleton.html#288" class="Field Operator">❴</a> <a id="4859" href="Ledger.Conway.Specification.Rewards.html#4816" class="Bound">hk</a> <a id="4862" href="Class.HasSingleton.html#288" class="Field Operator">❵</a><a id="4863" class="Symbol">)</a>


<a id="BlocksMade"></a><a id="4867" href="Ledger.Conway.Specification.Rewards.html#4867" class="Function">BlocksMade</a> <a id="4878" class="Symbol">:</a> <a id="4880" href="Agda.Primitive.html#388" class="Primitive">Type</a>
<a id="4885" href="Ledger.Conway.Specification.Rewards.html#4867" class="Function">BlocksMade</a> <a id="4896" class="Symbol">=</a> <a id="4898" href="Ledger.Core.Specification.Crypto.html#1386" class="Function">KeyHash</a> <a id="4906" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="4908" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a>

<a id="uncurryᵐ"></a><a id="4911" href="Ledger.Conway.Specification.Rewards.html#4911" class="Function">uncurryᵐ</a> <a id="4920" class="Symbol">:</a>


  <a id="4926" class="Symbol">∀</a> <a id="4928" class="Symbol">{</a><a id="4929" href="Ledger.Conway.Specification.Rewards.html#4929" class="Bound">A</a> <a id="4931" href="Ledger.Conway.Specification.Rewards.html#4931" class="Bound">B</a> <a id="4933" href="Ledger.Conway.Specification.Rewards.html#4933" class="Bound">C</a> <a id="4935" class="Symbol">:</a> <a id="4937" href="Agda.Primitive.html#388" class="Primitive">Type</a><a id="4941" class="Symbol">}</a> <a id="4943" class="Symbol">⦃</a> <a id="4945" href="Ledger.Conway.Specification.Rewards.html#4945" class="Bound">_</a> <a id="4947" class="Symbol">:</a> <a id="4949" href="Class.DecEq.Core.html#126" class="Record">DecEq</a> <a id="4955" href="Ledger.Conway.Specification.Rewards.html#4929" class="Bound">A</a> <a id="4957" class="Symbol">⦄</a> <a id="4959" class="Symbol">⦃</a> <a id="4961" href="Ledger.Conway.Specification.Rewards.html#4961" class="Bound">_</a> <a id="4963" class="Symbol">:</a> <a id="4965" href="Class.DecEq.Core.html#126" class="Record">DecEq</a> <a id="4971" href="Ledger.Conway.Specification.Rewards.html#4931" class="Bound">B</a> <a id="4973" class="Symbol">⦄</a> <a id="4975" class="Symbol">→</a>


  <a id="4981" href="Ledger.Conway.Specification.Rewards.html#4929" class="Bound">A</a> <a id="4983" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="4985" class="Symbol">(</a><a id="4986" href="Ledger.Conway.Specification.Rewards.html#4931" class="Bound">B</a> <a id="4988" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="4990" href="Ledger.Conway.Specification.Rewards.html#4933" class="Bound">C</a><a id="4991" class="Symbol">)</a> <a id="4993" class="Symbol">→</a> <a id="4995" class="Symbol">(</a><a id="4996" href="Ledger.Conway.Specification.Rewards.html#4929" class="Bound">A</a> <a id="4998" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="5000" href="Ledger.Conway.Specification.Rewards.html#4931" class="Bound">B</a><a id="5001" class="Symbol">)</a> <a id="5003" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="5005" href="Ledger.Conway.Specification.Rewards.html#4933" class="Bound">C</a>


<a id="5009" href="Ledger.Conway.Specification.Rewards.html#4911" class="Function">uncurryᵐ</a> <a id="5018" class="Symbol">{</a><a id="5019" href="Ledger.Conway.Specification.Rewards.html#5019" class="Bound">A</a><a id="5020" class="Symbol">}</a> <a id="5022" class="Symbol">{</a><a id="5023" href="Ledger.Conway.Specification.Rewards.html#5023" class="Bound">B</a><a id="5024" class="Symbol">}</a> <a id="5026" class="Symbol">{</a><a id="5027" href="Ledger.Conway.Specification.Rewards.html#5027" class="Bound">C</a><a id="5028" class="Symbol">}</a> <a id="5030" href="Ledger.Conway.Specification.Rewards.html#5030" class="Bound">abc</a> <a id="5034" class="Symbol">=</a> <a id="5036" href="Axiom.Set.Map.html#10460" class="Function">mapFromPartialFun</a> <a id="5054" href="Ledger.Conway.Specification.Rewards.html#5082" class="Function">lookup&#39;</a> <a id="5062" href="Ledger.Conway.Specification.Rewards.html#5240" class="Function">domain&#39;</a>
  <a id="5072" class="Keyword">where</a>
    <a id="5082" href="Ledger.Conway.Specification.Rewards.html#5082" class="Function">lookup&#39;</a> <a id="5090" class="Symbol">:</a> <a id="5092" class="Symbol">(</a><a id="5093" href="Ledger.Conway.Specification.Rewards.html#5019" class="Bound">A</a> <a id="5095" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="5097" href="Ledger.Conway.Specification.Rewards.html#5023" class="Bound">B</a><a id="5098" class="Symbol">)</a> <a id="5100" class="Symbol">→</a> <a id="5102" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="5108" href="Ledger.Conway.Specification.Rewards.html#5027" class="Bound">C</a>
    <a id="5114" href="Ledger.Conway.Specification.Rewards.html#5082" class="Function">lookup&#39;</a> <a id="5122" class="Symbol">(</a><a id="5123" href="Ledger.Conway.Specification.Rewards.html#5123" class="Bound">a</a> <a id="5125" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5127" href="Ledger.Conway.Specification.Rewards.html#5127" class="Bound">b</a><a id="5128" class="Symbol">)</a> <a id="5130" class="Symbol">=</a> <a id="5132" href="Axiom.Set.Map.html#13828" class="Function">lookupᵐ?</a> <a id="5141" href="Ledger.Conway.Specification.Rewards.html#5030" class="Bound">abc</a> <a id="5145" href="Ledger.Conway.Specification.Rewards.html#5123" class="Bound">a</a> <a id="5147" href="Class.Monad.Core.html#337" class="Field Operator">&gt;&gt;=</a> <a id="5151" class="Symbol">(λ</a> <a id="5154" href="Ledger.Conway.Specification.Rewards.html#5154" class="Bound">bc</a> <a id="5157" class="Symbol">→</a> <a id="5159" href="Axiom.Set.Map.html#13828" class="Function">lookupᵐ?</a> <a id="5168" href="Ledger.Conway.Specification.Rewards.html#5154" class="Bound">bc</a> <a id="5171" href="Ledger.Conway.Specification.Rewards.html#5127" class="Bound">b</a><a id="5172" class="Symbol">)</a>

    <a id="5179" href="Ledger.Conway.Specification.Rewards.html#5179" class="Function">joinˢ</a> <a id="5185" class="Symbol">:</a> <a id="5187" class="Symbol">∀</a> <a id="5189" class="Symbol">{</a><a id="5190" href="Ledger.Conway.Specification.Rewards.html#5190" class="Bound">X</a><a id="5191" class="Symbol">}</a> <a id="5193" class="Symbol">→</a> <a id="5195" href="abstract-set-theory.FiniteSetTheory.html#488" class="Function Operator">ℙ</a> <a id="5197" class="Symbol">(</a><a id="5198" href="abstract-set-theory.FiniteSetTheory.html#488" class="Function Operator">ℙ</a> <a id="5200" href="Ledger.Conway.Specification.Rewards.html#5190" class="Bound">X</a><a id="5201" class="Symbol">)</a> <a id="5203" class="Symbol">→</a> <a id="5205" href="abstract-set-theory.FiniteSetTheory.html#488" class="Function Operator">ℙ</a> <a id="5207" href="Ledger.Conway.Specification.Rewards.html#5190" class="Bound">X</a>
    <a id="5213" href="Ledger.Conway.Specification.Rewards.html#5179" class="Function">joinˢ</a> <a id="5219" class="Symbol">=</a> <a id="5221" href="Axiom.Set.html#7022" class="Function">concatMapˢ</a> <a id="5232" href="Function.Base.html#704" class="Function">id</a>

    <a id="5240" href="Ledger.Conway.Specification.Rewards.html#5240" class="Function">domain&#39;</a> <a id="5248" class="Symbol">:</a> <a id="5250" href="abstract-set-theory.FiniteSetTheory.html#488" class="Function Operator">ℙ</a> <a id="5252" class="Symbol">(</a><a id="5253" href="Ledger.Conway.Specification.Rewards.html#5019" class="Bound">A</a> <a id="5255" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="5257" href="Ledger.Conway.Specification.Rewards.html#5023" class="Bound">B</a><a id="5258" class="Symbol">)</a>
    <a id="5264" href="Ledger.Conway.Specification.Rewards.html#5240" class="Function">domain&#39;</a> <a id="5272" class="Symbol">=</a> <a id="5274" href="Ledger.Conway.Specification.Rewards.html#5179" class="Function">joinˢ</a> <a id="5280" class="Symbol">(</a><a id="5281" href="Class.IsSet.html#959" class="Function">range</a> <a id="5287" class="Symbol">(</a><a id="5288" href="Axiom.Set.Map.html#8706" class="Function">mapWithKey</a> <a id="5299" class="Symbol">(λ</a> <a id="5302" href="Ledger.Conway.Specification.Rewards.html#5302" class="Bound">a</a> <a id="5304" href="Ledger.Conway.Specification.Rewards.html#5304" class="Bound">bc</a> <a id="5307" class="Symbol">→</a> <a id="5309" href="Class.IsSet.html#959" class="Function">range</a> <a id="5315" class="Symbol">(</a><a id="5316" href="Axiom.Set.Map.html#8706" class="Function">mapWithKey</a> <a id="5327" class="Symbol">(λ</a> <a id="5330" href="Ledger.Conway.Specification.Rewards.html#5330" class="Bound">b</a> <a id="5332" href="Ledger.Conway.Specification.Rewards.html#5332" class="Bound">_</a> <a id="5334" class="Symbol">→</a> <a id="5336" class="Symbol">(</a><a id="5337" href="Ledger.Conway.Specification.Rewards.html#5302" class="Bound">a</a> <a id="5339" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5341" href="Ledger.Conway.Specification.Rewards.html#5330" class="Bound">b</a><a id="5342" class="Symbol">))</a> <a id="5345" href="Ledger.Conway.Specification.Rewards.html#5304" class="Bound">bc</a><a id="5347" class="Symbol">))</a> <a id="5350" href="Ledger.Conway.Specification.Rewards.html#5030" class="Bound">abc</a><a id="5353" class="Symbol">))</a>


<a id="reward"></a><a id="5358" href="Ledger.Conway.Specification.Rewards.html#5358" class="Function">reward</a> <a id="5365" class="Symbol">:</a>  <a id="5368" href="Ledger.Conway.Specification.PParams.html#1685" class="Record">PParams</a> <a id="5376" class="Symbol">→</a> <a id="5378" href="Ledger.Conway.Specification.Rewards.html#4867" class="Function">BlocksMade</a> <a id="5389" class="Symbol">→</a> <a id="5391" href="Ledger.Prelude.Base.html#154" class="Function">Coin</a> <a id="5396" class="Symbol">→</a> <a id="5398" href="Ledger.Conway.Specification.Certs.html#1209" class="Function">Pools</a> <a id="5404" class="Symbol">→</a> <a id="5406" href="Ledger.Conway.Specification.Certs.html#1345" class="Function">Stake</a> <a id="5412" class="Symbol">→</a> <a id="5414" href="Ledger.Conway.Specification.Certs.html#1385" class="Function">StakeDelegs</a> <a id="5426" class="Symbol">→</a> <a id="5428" href="Ledger.Prelude.Base.html#154" class="Function">Coin</a> <a id="5433" class="Symbol">→</a> <a id="5435" href="Ledger.Conway.Specification.Certs.html#1345" class="Function">Stake</a>
<a id="5441" href="Ledger.Conway.Specification.Rewards.html#5358" class="Function">reward</a> <a id="5448" href="Ledger.Conway.Specification.Rewards.html#5448" class="Bound">pp</a> <a id="5451" href="Ledger.Conway.Specification.Rewards.html#5451" class="Bound">blocks</a> <a id="5458" href="Ledger.Conway.Specification.Rewards.html#5458" class="Bound">rewardPot</a> <a id="5468" href="Ledger.Conway.Specification.Rewards.html#5468" class="Bound">pools</a> <a id="5474" href="Ledger.Conway.Specification.Rewards.html#5474" class="Bound">stake</a> <a id="5480" href="Ledger.Conway.Specification.Rewards.html#5480" class="Bound">delegs</a> <a id="5487" href="Ledger.Conway.Specification.Rewards.html#5487" class="Bound">total</a> <a id="5493" class="Symbol">=</a> <a id="5495" href="Ledger.Conway.Specification.Rewards.html#6112" class="Function">rewards</a>
  <a id="5505" class="Keyword">where</a>
    <a id="5515" href="Ledger.Conway.Specification.Rewards.html#5515" class="Function">active</a>      <a id="5527" class="Symbol">=</a> <a id="5529" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">∑[</a> <a id="5532" href="Ledger.Conway.Specification.Rewards.html#5532" class="Bound">c</a> <a id="5534" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">←</a> <a id="5536" href="Ledger.Conway.Specification.Rewards.html#5474" class="Bound">stake</a> <a id="5542" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">]</a> <a id="5544" href="Ledger.Conway.Specification.Rewards.html#5532" class="Bound">c</a>
    <a id="5550" href="Ledger.Conway.Specification.Rewards.html#5550" class="Function Operator">Σ_/total</a>    <a id="5562" class="Symbol">=</a> <a id="5564" class="Symbol">λ</a> <a id="5566" href="Ledger.Conway.Specification.Rewards.html#5566" class="Bound">st</a> <a id="5569" class="Symbol">→</a> <a id="5571" href="Ledger.Prelude.Numeric.UnitInterval.html#2764" class="Function">clamp</a> <a id="5577" class="Symbol">((</a><a id="5579" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">∑[</a> <a id="5582" href="Ledger.Conway.Specification.Rewards.html#5582" class="Bound">c</a> <a id="5584" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">←</a> <a id="5586" href="Ledger.Conway.Specification.Rewards.html#5566" class="Bound">st</a> <a id="5589" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">]</a> <a id="5591" href="Ledger.Conway.Specification.Rewards.html#5582" class="Bound">c</a><a id="5592" class="Symbol">)</a> <a id="5594" href="Ledger.Prelude.html#1896" class="Function Operator">/₀</a> <a id="5597" href="Ledger.Conway.Specification.Rewards.html#5487" class="Bound">total</a><a id="5602" class="Symbol">)</a>
    <a id="5608" href="Ledger.Conway.Specification.Rewards.html#5608" class="Function Operator">Σ_/active</a>   <a id="5620" class="Symbol">=</a> <a id="5622" class="Symbol">λ</a> <a id="5624" href="Ledger.Conway.Specification.Rewards.html#5624" class="Bound">st</a> <a id="5627" class="Symbol">→</a> <a id="5629" href="Ledger.Prelude.Numeric.UnitInterval.html#2764" class="Function">clamp</a> <a id="5635" class="Symbol">((</a><a id="5637" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">∑[</a> <a id="5640" href="Ledger.Conway.Specification.Rewards.html#5640" class="Bound">c</a> <a id="5642" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">←</a> <a id="5644" href="Ledger.Conway.Specification.Rewards.html#5624" class="Bound">st</a> <a id="5647" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">]</a> <a id="5649" href="Ledger.Conway.Specification.Rewards.html#5640" class="Bound">c</a><a id="5650" class="Symbol">)</a> <a id="5652" href="Ledger.Prelude.html#1896" class="Function Operator">/₀</a> <a id="5655" href="Ledger.Conway.Specification.Rewards.html#5515" class="Function">active</a><a id="5661" class="Symbol">)</a>
    <a id="5667" href="Ledger.Conway.Specification.Rewards.html#5667" class="Function">N</a>           <a id="5679" class="Symbol">=</a> <a id="5681" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">∑[</a> <a id="5684" href="Ledger.Conway.Specification.Rewards.html#5684" class="Bound">m</a> <a id="5686" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">←</a> <a id="5688" href="Ledger.Conway.Specification.Rewards.html#5451" class="Bound">blocks</a> <a id="5695" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">]</a> <a id="5697" href="Ledger.Conway.Specification.Rewards.html#5684" class="Bound">m</a>
    <a id="5703" href="Ledger.Conway.Specification.Rewards.html#5703" class="Function">mkPoolData</a>  <a id="5715" class="Symbol">=</a> <a id="5717" class="Symbol">λ</a> <a id="5719" href="Ledger.Conway.Specification.Rewards.html#5719" class="Bound">hk</a> <a id="5722" href="Ledger.Conway.Specification.Rewards.html#5722" class="Bound">p</a> <a id="5724" class="Symbol">→</a> <a id="5726" href="Class.Functor.Core.html#272" class="Function">map</a>  <a id="5731" class="Symbol">(λ</a> <a id="5734" href="Ledger.Conway.Specification.Rewards.html#5734" class="Bound">n</a> <a id="5736" class="Symbol">→</a> <a id="5738" class="Symbol">(</a><a id="5739" href="Ledger.Conway.Specification.Rewards.html#5734" class="Bound">n</a> <a id="5741" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5743" href="Ledger.Conway.Specification.Rewards.html#5722" class="Bound">p</a> <a id="5745" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5747" href="Ledger.Conway.Specification.Rewards.html#4755" class="Function">poolStake</a> <a id="5757" href="Ledger.Conway.Specification.Rewards.html#5719" class="Bound">hk</a> <a id="5760" href="Ledger.Conway.Specification.Rewards.html#5480" class="Bound">delegs</a> <a id="5767" href="Ledger.Conway.Specification.Rewards.html#5474" class="Bound">stake</a><a id="5772" class="Symbol">))</a>
                                <a id="5807" class="Symbol">(</a><a id="5808" href="Axiom.Set.Map.html#13828" class="Function">lookupᵐ?</a> <a id="5817" href="Ledger.Conway.Specification.Rewards.html#5451" class="Bound">blocks</a> <a id="5824" href="Ledger.Conway.Specification.Rewards.html#5719" class="Bound">hk</a><a id="5826" class="Symbol">)</a>
    <a id="5832" href="Ledger.Conway.Specification.Rewards.html#5832" class="Function">pdata</a>       <a id="5844" class="Symbol">=</a> <a id="5846" href="Axiom.Set.Map.html#10313" class="Function">mapMaybeWithKeyᵐ</a> <a id="5863" href="Ledger.Conway.Specification.Rewards.html#5703" class="Function">mkPoolData</a> <a id="5874" href="Ledger.Conway.Specification.Rewards.html#5468" class="Bound">pools</a>

    <a id="5885" href="Ledger.Conway.Specification.Rewards.html#5885" class="Function">f</a> <a id="5887" class="Symbol">:</a> <a id="5889" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a> <a id="5891" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="5893" href="Ledger.Conway.Specification.Certs.html#350" class="Record">StakePoolParams</a> <a id="5909" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="5911" href="Ledger.Conway.Specification.Certs.html#1345" class="Function">Stake</a> <a id="5917" class="Symbol">→</a> <a id="5919" href="Ledger.Conway.Specification.Certs.html#1345" class="Function">Stake</a>
    <a id="5929" href="Ledger.Conway.Specification.Rewards.html#5885" class="Function">f</a> <a id="5931" class="Symbol">=</a> <a id="5933" class="Symbol">(λ</a> <a id="5936" class="Symbol">(</a><a id="5937" href="Ledger.Conway.Specification.Rewards.html#5937" class="Bound">n</a> <a id="5939" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5941" href="Ledger.Conway.Specification.Rewards.html#5941" class="Bound">p</a> <a id="5943" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5945" href="Ledger.Conway.Specification.Rewards.html#5945" class="Bound">s</a><a id="5946" class="Symbol">)</a> <a id="5948" class="Symbol">→</a> <a id="5950" href="Ledger.Conway.Specification.Rewards.html#3503" class="Function">rewardOnePool</a> <a id="5964" href="Ledger.Conway.Specification.Rewards.html#5448" class="Bound">pp</a> <a id="5967" href="Ledger.Conway.Specification.Rewards.html#5458" class="Bound">rewardPot</a> <a id="5977" href="Ledger.Conway.Specification.Rewards.html#5937" class="Bound">n</a> <a id="5979" href="Ledger.Conway.Specification.Rewards.html#5667" class="Function">N</a> <a id="5981" href="Ledger.Conway.Specification.Rewards.html#5941" class="Bound">p</a> <a id="5983" href="Ledger.Conway.Specification.Rewards.html#5945" class="Bound">s</a> <a id="5985" class="Symbol">(</a><a id="5986" href="Ledger.Conway.Specification.Rewards.html#5550" class="Function Operator">Σ</a> <a id="5988" href="Ledger.Conway.Specification.Rewards.html#5945" class="Bound">s</a> <a id="5990" href="Ledger.Conway.Specification.Rewards.html#5550" class="Function Operator">/total</a><a id="5996" class="Symbol">)</a> <a id="5998" class="Symbol">(</a><a id="5999" href="Ledger.Conway.Specification.Rewards.html#5608" class="Function Operator">Σ</a> <a id="6001" href="Ledger.Conway.Specification.Rewards.html#5945" class="Bound">s</a> <a id="6003" href="Ledger.Conway.Specification.Rewards.html#5608" class="Function Operator">/active</a><a id="6010" class="Symbol">)</a> <a id="6012" href="Ledger.Conway.Specification.Rewards.html#5487" class="Bound">total</a><a id="6017" class="Symbol">)</a>

    <a id="6024" href="Ledger.Conway.Specification.Rewards.html#6024" class="Function">results</a> <a id="6032" class="Symbol">:</a> <a id="6034" class="Symbol">(</a><a id="6035" href="Ledger.Core.Specification.Crypto.html#1386" class="Function">KeyHash</a> <a id="6043" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="6045" href="Ledger.Core.Specification.Address.html#260" class="Datatype">Credential</a><a id="6055" class="Symbol">)</a> <a id="6057" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="6059" href="Ledger.Prelude.Base.html#154" class="Function">Coin</a>
    <a id="6068" href="Ledger.Conway.Specification.Rewards.html#6024" class="Function">results</a> <a id="6076" class="Symbol">=</a>  <a id="6079" href="Ledger.Conway.Specification.Rewards.html#4911" class="Function">uncurryᵐ</a> <a id="6088" class="Symbol">(</a><a id="6089" href="Axiom.Set.Map.html#6068" class="Function">mapValues</a> <a id="6099" href="Ledger.Conway.Specification.Rewards.html#5885" class="Function">f</a> <a id="6101" href="Ledger.Conway.Specification.Rewards.html#5832" class="Function">pdata</a><a id="6106" class="Symbol">)</a>
    <a id="6112" href="Ledger.Conway.Specification.Rewards.html#6112" class="Function">rewards</a>  <a id="6121" class="Symbol">=</a> <a id="6123" href="abstract-set-theory.FiniteSetTheory.html#3599" class="Function">aggregateBy</a> <a id="6135" class="Symbol">(</a><a id="6136" href="abstract-set-theory.FiniteSetTheory.html#519" class="Function">mapˢ</a> <a id="6141" class="Symbol">(λ</a> <a id="6144" class="Symbol">(</a><a id="6145" href="Ledger.Conway.Specification.Rewards.html#6145" class="Bound">kh</a> <a id="6148" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="6150" href="Ledger.Conway.Specification.Rewards.html#6150" class="Bound">cred</a><a id="6154" class="Symbol">)</a> <a id="6156" class="Symbol">→</a> <a id="6158" class="Symbol">(</a><a id="6159" href="Ledger.Conway.Specification.Rewards.html#6145" class="Bound">kh</a> <a id="6162" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="6164" href="Ledger.Conway.Specification.Rewards.html#6150" class="Bound">cred</a><a id="6168" class="Symbol">)</a> <a id="6170" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="6172" href="Ledger.Conway.Specification.Rewards.html#6150" class="Bound">cred</a><a id="6176" class="Symbol">)</a> <a id="6178" class="Symbol">(</a><a id="6179" href="Class.IsSet.html#916" class="Function">dom</a> <a id="6183" href="Ledger.Conway.Specification.Rewards.html#6024" class="Function">results</a><a id="6190" class="Symbol">))</a> <a id="6193" href="Ledger.Conway.Specification.Rewards.html#6024" class="Function">results</a>


<a id="6203" class="Keyword">record</a> <a id="RewardUpdate"></a><a id="6210" href="Ledger.Conway.Specification.Rewards.html#6210" class="Record">RewardUpdate</a> <a id="6223" class="Symbol">:</a> <a id="6225" href="Agda.Primitive.html#388" class="Primitive">Set</a> <a id="6229" class="Keyword">where</a>
  <a id="6237" class="Keyword">field</a>
    <a id="RewardUpdate.Δt"></a><a id="6247" href="Ledger.Conway.Specification.Rewards.html#6247" class="Field">Δt</a> <a id="RewardUpdate.Δr"></a><a id="6250" href="Ledger.Conway.Specification.Rewards.html#6250" class="Field">Δr</a> <a id="RewardUpdate.Δf"></a><a id="6253" href="Ledger.Conway.Specification.Rewards.html#6253" class="Field">Δf</a>          <a id="6265" class="Symbol">:</a> <a id="6267" href="Agda.Builtin.Int.html#245" class="Datatype">ℤ</a>
    <a id="RewardUpdate.rs"></a><a id="6273" href="Ledger.Conway.Specification.Rewards.html#6273" class="Field">rs</a>                <a id="6291" class="Symbol">:</a> <a id="6293" href="Ledger.Conway.Specification.Certs.html#1345" class="Function">Stake</a>
    <a id="RewardUpdate.flowConservation"></a><a id="6303" href="Ledger.Conway.Specification.Rewards.html#6303" class="Field">flowConservation</a>  <a id="6321" class="Symbol">:</a> <a id="6323" href="Ledger.Conway.Specification.Rewards.html#6247" class="Field">Δt</a> <a id="6326" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="6328" href="Ledger.Conway.Specification.Rewards.html#6250" class="Field">Δr</a> <a id="6331" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="6333" href="Ledger.Conway.Specification.Rewards.html#6253" class="Field">Δf</a> <a id="6336" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="6338" href="Ledger.Conway.Specification.Rewards.html#77" class="InductiveConstructor">pos</a> <a id="6342" class="Symbol">(</a><a id="6343" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">∑[</a> <a id="6346" href="Ledger.Conway.Specification.Rewards.html#6346" class="Bound">c</a> <a id="6348" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">←</a> <a id="6350" href="Ledger.Conway.Specification.Rewards.html#6273" class="Field">rs</a> <a id="6353" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">]</a> <a id="6355" href="Ledger.Conway.Specification.Rewards.html#6346" class="Bound">c</a><a id="6356" class="Symbol">)</a> <a id="6358" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="6360" class="Number">0</a>
    <a id="RewardUpdate.Δt-nonnegative"></a><a id="6366" href="Ledger.Conway.Specification.Rewards.html#6366" class="Field">Δt-nonnegative</a>    <a id="6384" class="Symbol">:</a> <a id="6386" class="Number">0</a> <a id="6388" href="Class.HasOrder.Core.html#613" class="Field Operator">≤</a> <a id="6390" href="Ledger.Conway.Specification.Rewards.html#6247" class="Field">Δt</a>
    <a id="RewardUpdate.Δf-nonpositive"></a><a id="6397" href="Ledger.Conway.Specification.Rewards.html#6397" class="Field">Δf-nonpositive</a>    <a id="6415" class="Symbol">:</a> <a id="6417" href="Ledger.Conway.Specification.Rewards.html#6253" class="Field">Δf</a> <a id="6420" href="Class.HasOrder.Core.html#613" class="Field Operator">≤</a> <a id="6422" class="Number">0</a>


<a id="6426" class="Keyword">record</a> <a id="Snapshot"></a><a id="6433" href="Ledger.Conway.Specification.Rewards.html#6433" class="Record">Snapshot</a> <a id="6442" class="Symbol">:</a> <a id="6444" href="Agda.Primitive.html#388" class="Primitive">Set</a> <a id="6448" class="Keyword">where</a>
  <a id="6456" class="Keyword">field</a>
    <a id="Snapshot.stake"></a><a id="6466" href="Ledger.Conway.Specification.Rewards.html#6466" class="Field">stake</a>        <a id="6479" class="Symbol">:</a> <a id="6481" href="Ledger.Conway.Specification.Certs.html#1345" class="Function">Stake</a>
    <a id="Snapshot.delegations"></a><a id="6491" href="Ledger.Conway.Specification.Rewards.html#6491" class="Field">delegations</a>  <a id="6504" class="Symbol">:</a> <a id="6506" href="Ledger.Conway.Specification.Certs.html#1385" class="Function">StakeDelegs</a>
    <a id="Snapshot.pools"></a><a id="6522" href="Ledger.Conway.Specification.Rewards.html#6522" class="Field">pools</a>        <a id="6535" class="Symbol">:</a> <a id="6537" href="Ledger.Conway.Specification.Certs.html#1209" class="Function">Pools</a>


<a id="6545" class="Keyword">instance</a>
  <a id="HasStake-Snapshot"></a><a id="6556" href="Ledger.Conway.Specification.Rewards.html#6556" class="Function">HasStake-Snapshot</a> <a id="6574" class="Symbol">:</a> <a id="6576" href="Ledger.Conway.Specification.Certs.html#1860" class="Record">HasStake</a> <a id="6585" href="Ledger.Conway.Specification.Rewards.html#6433" class="Record">Snapshot</a>
  <a id="6596" href="Ledger.Conway.Specification.Rewards.html#6556" class="Function">HasStake-Snapshot</a> <a id="6614" class="Symbol">.</a><a id="6615" href="Ledger.Conway.Specification.Certs.html#1909" class="Field">StakeOf</a> <a id="6623" class="Symbol">=</a> <a id="6625" href="Ledger.Conway.Specification.Rewards.html#6466" class="Field">Snapshot.stake</a>

  <a id="HasStakeDelegs-Snapshot"></a><a id="6643" href="Ledger.Conway.Specification.Rewards.html#6643" class="Function">HasStakeDelegs-Snapshot</a> <a id="6667" class="Symbol">:</a> <a id="6669" href="Ledger.Conway.Specification.Certs.html#1938" class="Record">HasStakeDelegs</a> <a id="6684" href="Ledger.Conway.Specification.Rewards.html#6433" class="Record">Snapshot</a>
  <a id="6695" href="Ledger.Conway.Specification.Rewards.html#6643" class="Function">HasStakeDelegs-Snapshot</a> <a id="6719" class="Symbol">.</a><a id="6720" href="Ledger.Conway.Specification.Certs.html#1993" class="Field">StakeDelegsOf</a> <a id="6734" class="Symbol">=</a> <a id="6736" href="Ledger.Conway.Specification.Rewards.html#6491" class="Field">Snapshot.delegations</a>

  <a id="HasPools-Snapshot"></a><a id="6760" href="Ledger.Conway.Specification.Rewards.html#6760" class="Function">HasPools-Snapshot</a> <a id="6778" class="Symbol">:</a> <a id="6780" href="Ledger.Conway.Specification.Certs.html#1614" class="Record">HasPools</a> <a id="6789" href="Ledger.Conway.Specification.Rewards.html#6433" class="Record">Snapshot</a>
  <a id="6800" href="Ledger.Conway.Specification.Rewards.html#6760" class="Function">HasPools-Snapshot</a> <a id="6818" class="Symbol">.</a><a id="6819" href="Ledger.Conway.Specification.Certs.html#1663" class="Field">PoolsOf</a> <a id="6827" class="Symbol">=</a> <a id="6829" href="Ledger.Conway.Specification.Rewards.html#6522" class="Field">Snapshot.pools</a>

  <a id="6847" class="Keyword">unquoteDecl</a> <a id="HasCast-Snapshot"></a><a id="6859" href="Ledger.Conway.Specification.Rewards.html#6859" class="Function">HasCast-Snapshot</a> <a id="6876" class="Symbol">=</a>
    <a id="6882" href="stdlib-classes.Class.HasCast.Derive.html#2690" class="Function">derive-HasCast</a> <a id="6897" href="Data.List.Base.html#4907" class="Function Operator">[</a> <a id="6899" class="Symbol">(</a><a id="6900" class="Keyword">quote</a> <a id="6906" href="Ledger.Conway.Specification.Rewards.html#6433" class="Record">Snapshot</a> <a id="6915" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="6917" href="Ledger.Conway.Specification.Rewards.html#6859" class="Function">HasCast-Snapshot</a><a id="6933" class="Symbol">)</a> <a id="6935" href="Data.List.Base.html#4907" class="Function Operator">]</a>


<a id="6939" class="Keyword">private</a>
  <a id="getStakeCred"></a><a id="6949" href="Ledger.Conway.Specification.Rewards.html#6949" class="Function">getStakeCred</a> <a id="6962" class="Symbol">:</a> <a id="6964" href="Ledger.Conway.Specification.Transaction.html#2638" class="Function">TxOut</a> <a id="6970" class="Symbol">→</a> <a id="6972" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="6978" href="Ledger.Core.Specification.Address.html#260" class="Datatype">Credential</a>
  <a id="6991" href="Ledger.Conway.Specification.Rewards.html#6949" class="Function">getStakeCred</a> <a id="7004" class="Symbol">(</a><a id="7005" href="Ledger.Conway.Specification.Rewards.html#7005" class="Bound">a</a> <a id="7007" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="7009" class="Symbol">_</a> <a id="7011" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="7013" class="Symbol">_</a> <a id="7015" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="7017" class="Symbol">_)</a> <a id="7020" class="Symbol">=</a> <a id="7022" href="Ledger.Core.Specification.Address.html#2673" class="Function">stakeCred</a> <a id="7032" href="Ledger.Conway.Specification.Rewards.html#7005" class="Bound">a</a>

<a id="7035" class="Keyword">opaque</a>


  <a id="stakeDistr"></a><a id="7046" href="Ledger.Conway.Specification.Rewards.html#7046" class="Function">stakeDistr</a> <a id="7057" class="Symbol">:</a> <a id="7059" href="Ledger.Conway.Specification.Transaction.html#2716" class="Function">UTxO</a> <a id="7064" class="Symbol">→</a> <a id="7066" href="Ledger.Conway.Specification.Certs.html#3880" class="Record">DState</a> <a id="7073" class="Symbol">→</a> <a id="7075" href="Ledger.Conway.Specification.Certs.html#4031" class="Record">PState</a> <a id="7082" class="Symbol">→</a> <a id="7084" href="Ledger.Conway.Specification.Rewards.html#6433" class="Record">Snapshot</a>
  <a id="7095" href="Ledger.Conway.Specification.Rewards.html#7046" class="Function">stakeDistr</a> <a id="7106" href="Ledger.Conway.Specification.Rewards.html#7106" class="Bound">utxo</a> <a id="7111" href="Ledger.Conway.Specification.Rewards.html#7111" class="Bound">dState</a> <a id="7118" href="Ledger.Conway.Specification.Rewards.html#7118" class="Bound">pState</a> <a id="7125" class="Symbol">=</a>
      <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.Conway.Specification.Rewards.html#7330}{\htmlId{7135}{\htmlClass{Function}{\text{activeStake}}}}\, \\ \,\href{Ledger.Conway.Specification.Certs.html#1993}{\htmlId{7149}{\htmlClass{Field}{\text{StakeDelegsOf}}}}\, \,\href{Ledger.Conway.Specification.Rewards.html#7111}{\htmlId{7163}{\htmlClass{Bound}{\text{dState}}}}\, \\ \,\href{Ledger.Conway.Specification.Rewards.html#7198}{\htmlId{7172}{\htmlClass{Function}{\text{pools}}}}\, \end{pmatrix}$</a>
    <a id="7184" class="Keyword">where</a>


      <a id="7198" href="Ledger.Conway.Specification.Rewards.html#7198" class="Function">pools</a>         <a id="7212" class="Symbol">:</a> <a id="7214" href="Ledger.Conway.Specification.Certs.html#1209" class="Function">Pools</a>
      <a id="7226" href="Ledger.Conway.Specification.Rewards.html#7226" class="Function">utxoBalance</a>   <a id="7240" class="Symbol">:</a> <a id="7242" href="Ledger.Core.Specification.Address.html#260" class="Datatype">Credential</a> <a id="7253" class="Symbol">→</a> <a id="7255" href="Ledger.Prelude.Base.html#154" class="Function">Coin</a>
      <a id="7266" href="Ledger.Conway.Specification.Rewards.html#7266" class="Function">activeDelegs</a>  <a id="7280" class="Symbol">:</a> <a id="7282" href="Ledger.Conway.Specification.Certs.html#1385" class="Function">StakeDelegs</a>
      <a id="7300" href="Ledger.Conway.Specification.Rewards.html#7300" class="Function">activeRewards</a> <a id="7314" class="Symbol">:</a> <a id="7316" href="Ledger.Conway.Specification.Certs.html#1301" class="Function">Rewards</a>
      <a id="7330" href="Ledger.Conway.Specification.Rewards.html#7330" class="Function">activeStake</a>   <a id="7344" class="Symbol">:</a> <a id="7346" href="Ledger.Conway.Specification.Certs.html#1345" class="Function">Stake</a>


      <a id="7360" href="Ledger.Conway.Specification.Rewards.html#7198" class="Function">pools</a>          <a id="7375" class="Symbol">=</a> <a id="7377" href="Ledger.Conway.Specification.Certs.html#1663" class="Field">PoolsOf</a> <a id="7385" href="Ledger.Conway.Specification.Rewards.html#7118" class="Bound">pState</a>
      <a id="7398" href="Ledger.Conway.Specification.Rewards.html#7226" class="Function">utxoBalance</a>    <a id="7413" class="Symbol">=</a> <a id="7415" class="Symbol">λ</a> <a id="7417" href="Ledger.Conway.Specification.Rewards.html#7417" class="Bound">cred</a> <a id="7422" class="Symbol">→</a> <a id="7424" href="Ledger.Conway.Specification.Utxo.html#2456" class="Function">cbalance</a> <a id="7433" class="Symbol">(</a><a id="7434" href="Ledger.Conway.Specification.Rewards.html#7106" class="Bound">utxo</a> <a id="7439" href="abstract-set-theory.FiniteSetTheory.html#3088" class="Function Operator">∣^&#39;</a> <a id="7443" class="Symbol">λ</a> <a id="7445" href="Ledger.Conway.Specification.Rewards.html#7445" class="Bound">txout</a> <a id="7451" class="Symbol">→</a> <a id="7453" href="Ledger.Conway.Specification.Rewards.html#6949" class="Function">getStakeCred</a> <a id="7466" href="Ledger.Conway.Specification.Rewards.html#7445" class="Bound">txout</a> <a id="7472" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="7474" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="7479" href="Ledger.Conway.Specification.Rewards.html#7417" class="Bound">cred</a><a id="7483" class="Symbol">)</a>
      <a id="7491" href="Ledger.Conway.Specification.Rewards.html#7266" class="Function">activeDelegs</a>   <a id="7506" class="Symbol">=</a> <a id="7508" class="Symbol">(</a><a id="7509" href="Ledger.Conway.Specification.Certs.html#1993" class="Field">StakeDelegsOf</a> <a id="7523" href="Ledger.Conway.Specification.Rewards.html#7111" class="Bound">dState</a> <a id="7530" href="Axiom.Set.Map.html#10678" class="Function Operator">∣</a> <a id="7532" href="Class.IsSet.html#916" class="Function">dom</a> <a id="7536" class="Symbol">(</a><a id="7537" href="Ledger.Conway.Specification.Certs.html#1828" class="Field">RewardsOf</a> <a id="7547" href="Ledger.Conway.Specification.Rewards.html#7111" class="Bound">dState</a><a id="7553" class="Symbol">))</a> <a id="7556" href="Axiom.Set.Map.html#14434" class="Function Operator">∣^</a> <a id="7559" href="Class.IsSet.html#916" class="Function">dom</a> <a id="7563" href="Ledger.Conway.Specification.Rewards.html#7198" class="Function">pools</a>
      <a id="7575" href="Ledger.Conway.Specification.Rewards.html#7300" class="Function">activeRewards</a>  <a id="7590" class="Symbol">=</a> <a id="7592" href="Ledger.Conway.Specification.Certs.html#1828" class="Field">RewardsOf</a> <a id="7602" href="Ledger.Conway.Specification.Rewards.html#7111" class="Bound">dState</a> <a id="7609" href="Axiom.Set.Map.html#10678" class="Function Operator">∣</a> <a id="7611" href="Class.IsSet.html#916" class="Function">dom</a> <a id="7615" href="Ledger.Conway.Specification.Rewards.html#7266" class="Function">activeDelegs</a>
      <a id="7634" href="Ledger.Conway.Specification.Rewards.html#7330" class="Function">activeStake</a>    <a id="7649" class="Symbol">=</a>
        <a id="7659" href="Axiom.Set.Map.html#8706" class="Function">mapWithKey</a> <a id="7670" class="Symbol">(λ</a> <a id="7673" href="Ledger.Conway.Specification.Rewards.html#7673" class="Bound">c</a> <a id="7675" href="Ledger.Conway.Specification.Rewards.html#7675" class="Bound">rewardBalance</a> <a id="7689" class="Symbol">→</a> <a id="7691" href="Ledger.Conway.Specification.Rewards.html#7226" class="Function">utxoBalance</a> <a id="7703" href="Ledger.Conway.Specification.Rewards.html#7673" class="Bound">c</a> <a id="7705" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="7707" href="Ledger.Conway.Specification.Rewards.html#7675" class="Bound">rewardBalance</a><a id="7720" class="Symbol">)</a> <a id="7722" href="Ledger.Conway.Specification.Rewards.html#7300" class="Function">activeRewards</a>


<a id="7738" class="Keyword">record</a> <a id="Snapshots"></a><a id="7745" href="Ledger.Conway.Specification.Rewards.html#7745" class="Record">Snapshots</a> <a id="7755" class="Symbol">:</a> <a id="7757" href="Agda.Primitive.html#388" class="Primitive">Set</a> <a id="7761" class="Keyword">where</a>
  <a id="7769" class="Keyword">field</a>
    <a id="Snapshots.mark"></a><a id="7779" href="Ledger.Conway.Specification.Rewards.html#7779" class="Field">mark</a> <a id="Snapshots.set"></a><a id="7784" href="Ledger.Conway.Specification.Rewards.html#7784" class="Field">set</a> <a id="Snapshots.go"></a><a id="7788" href="Ledger.Conway.Specification.Rewards.html#7788" class="Field">go</a>  <a id="7792" class="Symbol">:</a> <a id="7794" href="Ledger.Conway.Specification.Rewards.html#6433" class="Record">Snapshot</a>
    <a id="Snapshots.feeSS"></a><a id="7807" href="Ledger.Conway.Specification.Rewards.html#7807" class="Field">feeSS</a>        <a id="7820" class="Symbol">:</a> <a id="7822" href="Ledger.Prelude.Base.html#186" class="Function">Fees</a>


<a id="7829" class="Keyword">record</a> <a id="HasSnapshots"></a><a id="7836" href="Ledger.Conway.Specification.Rewards.html#7836" class="Record">HasSnapshots</a> <a id="7849" class="Symbol">{</a><a id="7850" href="Ledger.Conway.Specification.Rewards.html#7850" class="Bound">a</a><a id="7851" class="Symbol">}</a> <a id="7853" class="Symbol">(</a><a id="7854" href="Ledger.Conway.Specification.Rewards.html#7854" class="Bound">A</a> <a id="7856" class="Symbol">:</a> <a id="7858" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="7863" href="Ledger.Conway.Specification.Rewards.html#7850" class="Bound">a</a><a id="7864" class="Symbol">)</a> <a id="7866" class="Symbol">:</a> <a id="7868" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="7873" href="Ledger.Conway.Specification.Rewards.html#7850" class="Bound">a</a> <a id="7875" class="Keyword">where</a>
  <a id="7883" class="Keyword">field</a> <a id="HasSnapshots.SnapshotsOf"></a><a id="7889" href="Ledger.Conway.Specification.Rewards.html#7889" class="Field">SnapshotsOf</a> <a id="7901" class="Symbol">:</a> <a id="7903" href="Ledger.Conway.Specification.Rewards.html#7854" class="Bound">A</a> <a id="7905" class="Symbol">→</a> <a id="7907" href="Ledger.Conway.Specification.Rewards.html#7745" class="Record">Snapshots</a>
<a id="7917" class="Keyword">open</a> <a id="7922" href="Ledger.Conway.Specification.Rewards.html#7836" class="Module">HasSnapshots</a> <a id="7935" class="Symbol">⦃...⦄</a> <a id="7941" class="Keyword">public</a>

<a id="7949" class="Keyword">instance</a>
  <a id="HasFees-Snapshots"></a><a id="7960" href="Ledger.Conway.Specification.Rewards.html#7960" class="Function">HasFees-Snapshots</a> <a id="7978" class="Symbol">:</a> <a id="7980" href="Ledger.Prelude.Base.html#621" class="Record">HasFees</a> <a id="7988" href="Ledger.Conway.Specification.Rewards.html#7745" class="Record">Snapshots</a>
  <a id="8000" href="Ledger.Conway.Specification.Rewards.html#7960" class="Function">HasFees-Snapshots</a> <a id="8018" class="Symbol">.</a><a id="8019" href="Ledger.Prelude.Base.html#669" class="Field">FeesOf</a> <a id="8026" class="Symbol">=</a> <a id="8028" href="Ledger.Conway.Specification.Rewards.html#7807" class="Field">Snapshots.feeSS</a>

  <a id="8047" class="Keyword">unquoteDecl</a> <a id="HasCast-Snapshots"></a><a id="8059" href="Ledger.Conway.Specification.Rewards.html#8059" class="Function">HasCast-Snapshots</a> <a id="8077" class="Symbol">=</a>
    <a id="8083" href="stdlib-classes.Class.HasCast.Derive.html#2690" class="Function">derive-HasCast</a> <a id="8098" href="Data.List.Base.html#4907" class="Function Operator">[</a> <a id="8100" class="Symbol">(</a><a id="8101" class="Keyword">quote</a> <a id="8107" href="Ledger.Conway.Specification.Rewards.html#7745" class="Record">Snapshots</a> <a id="8117" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="8119" href="Ledger.Conway.Specification.Rewards.html#8059" class="Function">HasCast-Snapshots</a><a id="8136" class="Symbol">)</a> <a id="8138" href="Data.List.Base.html#4907" class="Function Operator">]</a>


<a id="8142" class="Keyword">private</a> <a id="8150" class="Keyword">variable</a>
  <a id="8161" href="Ledger.Conway.Specification.Rewards.html#8161" class="Generalizable">ls</a> <a id="8164" class="Symbol">:</a> <a id="8166" href="Ledger.Conway.Specification.Ledger.html#979" class="Record">LState</a>
  <a id="8175" href="Ledger.Conway.Specification.Rewards.html#8175" class="Generalizable">mark</a> <a id="8180" href="Ledger.Conway.Specification.Rewards.html#8180" class="Generalizable">set</a> <a id="8184" href="Ledger.Conway.Specification.Rewards.html#8184" class="Generalizable">go</a> <a id="8187" class="Symbol">:</a> <a id="8189" href="Ledger.Conway.Specification.Rewards.html#6433" class="Record">Snapshot</a>
  <a id="8200" href="Ledger.Conway.Specification.Rewards.html#8200" class="Generalizable">feeSS</a> <a id="8206" class="Symbol">:</a> <a id="8208" href="Ledger.Prelude.Base.html#154" class="Function">Coin</a>


<a id="8215" class="Keyword">data</a> <a id="_⊢_⇀⦇_,SNAP⦈_"></a><a id="8220" href="Ledger.Conway.Specification.Rewards.html#8220" class="Datatype Operator">_⊢_⇀⦇_,SNAP⦈_</a> <a id="8234" class="Symbol">:</a> <a id="8236" href="Ledger.Conway.Specification.Ledger.html#979" class="Record">LState</a> <a id="8243" class="Symbol">→</a> <a id="8245" href="Ledger.Conway.Specification.Rewards.html#7745" class="Record">Snapshots</a> <a id="8255" class="Symbol">→</a> <a id="8257" href="Agda.Builtin.Unit.html#175" class="Record">⊤</a> <a id="8259" class="Symbol">→</a> <a id="8261" href="Ledger.Conway.Specification.Rewards.html#7745" class="Record">Snapshots</a> <a id="8271" class="Symbol">→</a> <a id="8273" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="8278" class="Keyword">where</a>
  <a id="_⊢_⇀⦇_,SNAP⦈_.SNAP"></a><a id="8286" href="Ledger.Conway.Specification.Rewards.html#8286" class="InductiveConstructor">SNAP</a> <a id="8291" class="Symbol">:</a>
    <a id="8297" class="Keyword">let</a> <a id="8301" href="Ledger.Conway.Specification.Rewards.html#8301" class="Bound">stake</a> <a id="8307" class="Symbol">=</a> <a id="8309" href="Ledger.Conway.Specification.Rewards.html#7046" class="Function">stakeDistr</a> <a id="8320" class="Symbol">(</a><a id="8321" href="Ledger.Conway.Specification.Transaction.html#2939" class="Field">UTxOOf</a> <a id="8328" href="Ledger.Conway.Specification.Rewards.html#8161" class="Generalizable">ls</a><a id="8330" class="Symbol">)</a> <a id="8332" class="Symbol">(</a><a id="8333" href="Ledger.Conway.Specification.Certs.html#4555" class="Field">DStateOf</a> <a id="8342" href="Ledger.Conway.Specification.Rewards.html#8161" class="Generalizable">ls</a><a id="8344" class="Symbol">)</a> <a id="8346" class="Symbol">(</a><a id="8347" href="Ledger.Conway.Specification.Certs.html#4663" class="Field">PStateOf</a> <a id="8356" href="Ledger.Conway.Specification.Rewards.html#8161" class="Generalizable">ls</a><a id="8358" class="Symbol">)</a> <a id="8360" class="Keyword">in</a>
    <a id="8367" href="Ledger.Conway.Specification.Rewards.html#8161" class="Generalizable">ls</a> <a id="8370" href="Ledger.Conway.Specification.Rewards.html#8220" class="Datatype Operator">⊢</a> <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.Conway.Specification.Rewards.html#8175}{\htmlId{8374}{\htmlClass{Generalizable}{\text{mark}}}}\, \\ \,\href{Ledger.Conway.Specification.Rewards.html#8180}{\htmlId{8381}{\htmlClass{Generalizable}{\text{set}}}}\, \\ \,\href{Ledger.Conway.Specification.Rewards.html#8184}{\htmlId{8387}{\htmlClass{Generalizable}{\text{go}}}}\, \\ \,\href{Ledger.Conway.Specification.Rewards.html#8200}{\htmlId{8392}{\htmlClass{Generalizable}{\text{feeSS}}}}\, \end{pmatrix}$</a> <a id="8400" href="Ledger.Conway.Specification.Rewards.html#8220" class="Datatype Operator">⇀⦇</a> <a id="8403" href="Agda.Builtin.Unit.html#212" class="InductiveConstructor">tt</a> <a id="8406" href="Ledger.Conway.Specification.Rewards.html#8220" class="Datatype Operator">,SNAP⦈</a> <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.Conway.Specification.Rewards.html#8301}{\htmlId{8415}{\htmlClass{Bound}{\text{stake}}}}\, \\ \,\href{Ledger.Conway.Specification.Rewards.html#8175}{\htmlId{8423}{\htmlClass{Generalizable}{\text{mark}}}}\, \\ \,\href{Ledger.Conway.Specification.Rewards.html#8180}{\htmlId{8430}{\htmlClass{Generalizable}{\text{set}}}}\, \\ \,\href{Ledger.Prelude.Base.html#669}{\htmlId{8436}{\htmlClass{Field}{\text{FeesOf}}}}\, \,\href{Ledger.Conway.Specification.Rewards.html#8161}{\htmlId{8443}{\htmlClass{Generalizable}{\text{ls}}}}\, \end{pmatrix}$</a>

</pre></body></html>