<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>Ledger.Conway.Specification.Rewards</title><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.css"><link rel="stylesheet" href="Agda.css"><script src="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.js"></script><script src="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/contrib/auto-render.min.js"></script><script src="AgdaKaTeX.js" defer=""></script></head><body><pre class="Agda">
<a id="2" class="Symbol">{-#</a> <a id="6" class="Keyword">OPTIONS</a> <a id="14" class="Pragma">--safe</a> <a id="21" class="Symbol">#-}</a>

<a id="26" class="Keyword">open</a> <a id="31" class="Keyword">import</a> <a id="38" href="Data.Integer.html" class="Module">Data.Integer</a> <a id="51" class="Keyword">using</a> <a id="57" class="Symbol">()</a> <a id="60" class="Keyword">renaming</a> <a id="69" class="Symbol">(</a><a id="70" href="Agda.Builtin.Int.html#263" class="InductiveConstructor">+_</a> <a id="73" class="Symbol">to</a> <a id="76" class="InductiveConstructor">pos</a><a id="79" class="Symbol">)</a>
<a id="81" class="Keyword">open</a> <a id="86" class="Keyword">import</a> <a id="93" href="Data.Rational.html" class="Module">Data.Rational</a> <a id="107" class="Keyword">using</a> <a id="113" class="Symbol">(</a><a id="114" href="Data.Rational.Base.html#1342" class="Record">ℚ</a><a id="115" class="Symbol">;</a> <a id="117" href="Data.Rational.Base.html#7116" class="Function">floor</a><a id="122" class="Symbol">;</a> <a id="124" href="Data.Rational.Base.html#6315" class="Function Operator">_*_</a><a id="127" class="Symbol">;</a> <a id="129" href="Data.Rational.Base.html#6708" class="Function Operator">_÷_</a><a id="132" class="Symbol">;</a> <a id="134" href="Data.Rational.Base.html#3884" class="Function Operator">_/_</a><a id="137" class="Symbol">;</a> <a id="139" href="Data.Rational.Base.html#6405" class="Function Operator">_-_</a><a id="142" class="Symbol">;</a> <a id="144" href="Data.Rational.Base.html#5214" class="Function">&gt;-nonZero</a><a id="153" class="Symbol">;</a> <a id="155" href="Data.Rational.Base.html#6854" class="Function Operator">_⊓_</a><a id="158" class="Symbol">)</a>
                          <a id="186" class="Keyword">renaming</a> <a id="195" class="Symbol">(</a><a id="196" href="Data.Rational.Base.html#6776" class="Function Operator">_⊔_</a> <a id="200" class="Symbol">to</a> <a id="203" class="Function Operator">_⊔ℚ_</a><a id="207" class="Symbol">;</a> <a id="209" href="Data.Rational.Base.html#4498" class="Function">NonZero</a> <a id="217" class="Symbol">to</a> <a id="220" class="Function">NonZeroℚ</a><a id="228" class="Symbol">)</a>
<a id="230" class="Keyword">open</a> <a id="235" class="Keyword">import</a> <a id="242" href="Data.Rational.Literals.html" class="Module">Data.Rational.Literals</a> <a id="265" class="Keyword">using</a> <a id="271" class="Symbol">(</a><a id="272" href="Data.Rational.Literals.html#740" class="Function">number</a><a id="278" class="Symbol">;</a> <a id="280" href="Data.Rational.Literals.html#613" class="Function">fromℤ</a><a id="285" class="Symbol">)</a>
<a id="287" class="Keyword">open</a> <a id="292" class="Keyword">import</a> <a id="299" href="Data.Rational.Properties.html" class="Module">Data.Rational.Properties</a> <a id="324" class="Keyword">using</a> <a id="330" class="Symbol">(</a><a id="331" href="Data.Rational.Properties.html#7612" class="Function">pos⇒nonZero</a><a id="342" class="Symbol">;</a> <a id="344" href="Data.Rational.Properties.html#26724" class="Function">positive⁻¹</a><a id="354" class="Symbol">;</a> <a id="356" href="Data.Rational.Properties.html#36007" class="Function">+-mono-&lt;-≤</a><a id="366" class="Symbol">;</a> <a id="368" href="Data.Rational.Properties.html#11672" class="Function">normalize-pos</a><a id="381" class="Symbol">;</a> <a id="383" href="Data.Rational.Properties.html#57994" class="Function">p≤p⊔q</a><a id="388" class="Symbol">)</a>
<a id="390" class="Keyword">open</a> <a id="395" class="Keyword">import</a> <a id="402" href="Ledger.Conway.Specification.Abstract.html" class="Module">Ledger.Conway.Specification.Abstract</a>
<a id="439" class="Keyword">open</a> <a id="444" class="Keyword">import</a> <a id="451" href="Ledger.Conway.Specification.Transaction.html" class="Module">Ledger.Conway.Specification.Transaction</a>
<a id="491" class="Keyword">open</a> <a id="496" class="Keyword">import</a> <a id="503" href="Ledger.Prelude.Numeric.UnitInterval.html" class="Module">Ledger.Prelude.Numeric.UnitInterval</a>

<a id="540" class="Keyword">open</a> <a id="545" class="Keyword">import</a> <a id="552" href="Agda.Builtin.FromNat.html" class="Module">Agda.Builtin.FromNat</a>
<a id="573" class="Keyword">open</a>        <a id="585" href="Agda.Builtin.FromNat.html#196" class="Module">Number</a> <a id="592" href="Data.Rational.Literals.html#740" class="Function">number</a> <a id="599" class="Keyword">renaming</a> <a id="608" class="Symbol">(</a><a id="609" href="Agda.Builtin.FromNat.html#281" class="Field">fromNat</a> <a id="617" class="Symbol">to</a> <a id="620" class="Field">fromℕ</a><a id="625" class="Symbol">)</a>

<a id="628" class="Keyword">module</a> <a id="635" href="Ledger.Conway.Specification.Rewards.html" class="Module">Ledger.Conway.Specification.Rewards</a>
  <a id="673" class="Symbol">(</a><a id="674" href="Ledger.Conway.Specification.Rewards.html#674" class="Bound">txs</a> <a id="678" class="Symbol">:</a> <a id="680" class="Symbol">_)</a> <a id="683" class="Symbol">(</a><a id="684" class="Keyword">open</a> <a id="689" href="Ledger.Conway.Specification.Transaction.html#1000" class="Module">TransactionStructure</a> <a id="710" href="Ledger.Conway.Specification.Rewards.html#674" class="Bound">txs</a><a id="713" class="Symbol">)</a>
  <a id="717" class="Symbol">(</a><a id="718" href="Ledger.Conway.Specification.Rewards.html#718" class="Bound">abs</a> <a id="722" class="Symbol">:</a> <a id="724" href="Ledger.Conway.Specification.Abstract.html#641" class="Record">AbstractFunctions</a> <a id="742" href="Ledger.Conway.Specification.Rewards.html#674" class="Bound">txs</a><a id="745" class="Symbol">)</a>
  <a id="749" class="Keyword">where</a>

<a id="756" class="Keyword">open</a> <a id="761" class="Keyword">import</a> <a id="768" href="Ledger.Conway.Specification.Certs.html" class="Module">Ledger.Conway.Specification.Certs</a> <a id="802" href="Ledger.Conway.Specification.Transaction.html#2079" class="Function">govStructure</a>
<a id="815" class="Keyword">open</a> <a id="820" class="Keyword">import</a> <a id="827" href="Ledger.Conway.Specification.Ledger.html" class="Module">Ledger.Conway.Specification.Ledger</a> <a id="862" href="Ledger.Conway.Specification.Rewards.html#674" class="Bound">txs</a> <a id="866" href="Ledger.Conway.Specification.Rewards.html#718" class="Bound">abs</a>
<a id="870" class="Keyword">open</a> <a id="875" class="Keyword">import</a> <a id="882" href="Ledger.Prelude.html" class="Module">Ledger.Prelude</a> <a id="897" class="Keyword">hiding</a> <a id="904" class="Symbol">(</a><a id="905" href="Data.Nat.Base.html#7102" class="Function Operator">_/_</a><a id="908" class="Symbol">;</a> <a id="910" href="Agda.Builtin.Nat.html#539" class="Primitive Operator">_*_</a><a id="913" class="Symbol">;</a> <a id="915" href="Interface.HasSubtract.html#209" class="Field Operator">_-_</a><a id="918" class="Symbol">;</a> <a id="920" href="Data.Nat.Base.html#3537" class="Function">&gt;-nonZero</a><a id="929" class="Symbol">;</a> <a id="931" href="Data.Nat.Base.html#5851" class="Function Operator">_⊓_</a><a id="934" class="Symbol">)</a>
<a id="936" class="Keyword">open</a> <a id="941" class="Keyword">import</a> <a id="948" href="Ledger.Conway.Specification.Utxo.html" class="Module">Ledger.Conway.Specification.Utxo</a> <a id="981" href="Ledger.Conway.Specification.Rewards.html#674" class="Bound">txs</a> <a id="985" href="Ledger.Conway.Specification.Rewards.html#718" class="Bound">abs</a>



<a id="nonZero-max-1"></a><a id="992" href="Ledger.Conway.Specification.Rewards.html#992" class="Function">nonZero-max-1</a> <a id="1006" class="Symbol">:</a> <a id="1008" class="Symbol">∀</a> <a id="1010" class="Symbol">(</a><a id="1011" href="Ledger.Conway.Specification.Rewards.html#1011" class="Bound">n</a> <a id="1013" class="Symbol">:</a> <a id="1015" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a><a id="1016" class="Symbol">)</a> <a id="1018" class="Symbol">→</a> <a id="1020" href="Data.Nat.Base.html#3266" class="Record">NonZero</a> <a id="1028" class="Symbol">(</a><a id="1029" class="Number">1</a> <a id="1031" href="Data.Nat.Base.html#5485" class="Function Operator">⊔</a> <a id="1033" href="Ledger.Conway.Specification.Rewards.html#1011" class="Bound">n</a><a id="1034" class="Symbol">)</a>
<a id="1036" href="Ledger.Conway.Specification.Rewards.html#992" class="Function">nonZero-max-1</a> <a id="1050" href="Agda.Builtin.Nat.html#221" class="InductiveConstructor">zero</a> <a id="1055" class="Symbol">=</a> <a id="1057" href="Data.Nat.Base.html#3359" class="Function">nonZero</a>
<a id="1065" href="Ledger.Conway.Specification.Rewards.html#992" class="Function">nonZero-max-1</a> <a id="1079" class="Symbol">(</a><a id="1080" href="Agda.Builtin.Nat.html#234" class="InductiveConstructor">suc</a> <a id="1084" href="Ledger.Conway.Specification.Rewards.html#1084" class="Bound">n</a><a id="1085" class="Symbol">)</a> <a id="1087" class="Symbol">=</a> <a id="1089" href="Data.Nat.Base.html#3359" class="Function">nonZero</a>

<a id="nonZero-1/n"></a><a id="1098" href="Ledger.Conway.Specification.Rewards.html#1098" class="Function">nonZero-1/n</a> <a id="1110" class="Symbol">:</a> <a id="1112" class="Symbol">∀</a> <a id="1114" class="Symbol">(</a><a id="1115" href="Ledger.Conway.Specification.Rewards.html#1115" class="Bound">n</a> <a id="1117" class="Symbol">:</a> <a id="1119" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a><a id="1120" class="Symbol">)</a> <a id="1122" class="Symbol">→</a> <a id="1124" class="Symbol">.{{</a><a id="1127" href="Ledger.Conway.Specification.Rewards.html#1127" class="Bound">_</a> <a id="1129" class="Symbol">:</a> <a id="1131" href="Data.Nat.Base.html#3266" class="Record">NonZero</a> <a id="1139" href="Ledger.Conway.Specification.Rewards.html#1115" class="Bound">n</a><a id="1140" class="Symbol">}}</a> <a id="1143" class="Symbol">→</a> <a id="1145" href="Ledger.Conway.Specification.Rewards.html#220" class="Function">NonZeroℚ</a> <a id="1154" class="Symbol">(</a><a id="1155" class="Number">1</a> <a id="1157" href="Data.Rational.Base.html#3884" class="Function Operator">/</a> <a id="1159" href="Ledger.Conway.Specification.Rewards.html#1115" class="Bound">n</a><a id="1160" class="Symbol">)</a>
<a id="1162" href="Ledger.Conway.Specification.Rewards.html#1098" class="Function">nonZero-1/n</a> <a id="1174" href="Ledger.Conway.Specification.Rewards.html#1174" class="Bound">n</a> <a id="1176" class="Symbol">{{</a><a id="1178" href="Ledger.Conway.Specification.Rewards.html#1178" class="Bound">prf</a><a id="1181" class="Symbol">}}</a> <a id="1184" class="Symbol">=</a>
  <a id="1188" href="Data.Rational.Properties.html#7612" class="Function">pos⇒nonZero</a> <a id="1200" class="Symbol">(</a><a id="1201" class="Number">1</a> <a id="1203" href="Data.Rational.Base.html#3884" class="Function Operator">/</a> <a id="1205" href="Ledger.Conway.Specification.Rewards.html#1174" class="Bound">n</a><a id="1206" class="Symbol">)</a> <a id="1208" class="Symbol">{{</a><a id="1210" href="Data.Rational.Properties.html#11672" class="Function">normalize-pos</a> <a id="1224" class="Number">1</a> <a id="1226" href="Ledger.Conway.Specification.Rewards.html#1174" class="Bound">n</a> <a id="1228" class="Symbol">{{</a><a id="1230" href="Ledger.Conway.Specification.Rewards.html#1178" class="Bound">prf</a><a id="1233" class="Symbol">}}</a> <a id="1236" class="Symbol">{{_}}</a> <a id="1242" class="Symbol">}}</a>

<a id="nonZero-1+max0-x"></a><a id="1246" href="Ledger.Conway.Specification.Rewards.html#1246" class="Function">nonZero-1+max0-x</a> <a id="1263" class="Symbol">:</a> <a id="1265" class="Symbol">∀</a> <a id="1267" class="Symbol">(</a><a id="1268" href="Ledger.Conway.Specification.Rewards.html#1268" class="Bound">x</a> <a id="1270" class="Symbol">:</a> <a id="1272" href="Data.Rational.Base.html#1342" class="Record">ℚ</a><a id="1273" class="Symbol">)</a> <a id="1275" class="Symbol">→</a> <a id="1277" href="Ledger.Conway.Specification.Rewards.html#220" class="Function">NonZeroℚ</a> <a id="1286" class="Symbol">(</a><a id="1287" class="Number">1</a> <a id="1289" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="1291" class="Symbol">(</a><a id="1292" class="Number">0</a> <a id="1294" href="Ledger.Conway.Specification.Rewards.html#203" class="Function Operator">⊔ℚ</a> <a id="1297" href="Ledger.Conway.Specification.Rewards.html#1268" class="Bound">x</a><a id="1298" class="Symbol">))</a>
<a id="1301" href="Ledger.Conway.Specification.Rewards.html#1246" class="Function">nonZero-1+max0-x</a> <a id="1318" href="Ledger.Conway.Specification.Rewards.html#1318" class="Bound">x</a> <a id="1320" class="Symbol">=</a>
  <a id="1324" href="Data.Rational.Base.html#5214" class="Function">&gt;-nonZero</a> <a id="1334" class="Symbol">(</a><a id="1335" href="Data.Rational.Properties.html#36007" class="Function">+-mono-&lt;-≤</a> <a id="1346" class="Symbol">(</a><a id="1347" href="Data.Rational.Properties.html#26724" class="Function">positive⁻¹</a> <a id="1358" class="Number">1</a> <a id="1360" class="Symbol">{{_}})</a> <a id="1367" class="Symbol">(</a><a id="1368" href="Data.Rational.Properties.html#57994" class="Function">p≤p⊔q</a> <a id="1374" class="Number">0</a> <a id="1376" href="Ledger.Conway.Specification.Rewards.html#1318" class="Bound">x</a><a id="1377" class="Symbol">))</a>


<a id="maxPool"></a><a id="1382" href="Ledger.Conway.Specification.Rewards.html#1382" class="Function">maxPool</a> <a id="1390" class="Symbol">:</a> <a id="1392" href="Ledger.Conway.Specification.PParams.html#1728" class="Record">PParams</a> <a id="1400" class="Symbol">→</a> <a id="1402" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a> <a id="1407" class="Symbol">→</a> <a id="1409" href="Ledger.Prelude.Numeric.UnitInterval.html#1776" class="Function">UnitInterval</a> <a id="1422" class="Symbol">→</a> <a id="1424" href="Ledger.Prelude.Numeric.UnitInterval.html#1776" class="Function">UnitInterval</a> <a id="1437" class="Symbol">→</a> <a id="1439" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a>
<a id="1444" href="Ledger.Conway.Specification.Rewards.html#1382" class="Function">maxPool</a> <a id="1452" href="Ledger.Conway.Specification.Rewards.html#1452" class="Bound">pparams</a> <a id="1460" href="Ledger.Conway.Specification.Rewards.html#1460" class="Bound">rewardPot</a> <a id="1470" href="Ledger.Conway.Specification.Rewards.html#1470" class="Bound">stake</a> <a id="1476" href="Ledger.Conway.Specification.Rewards.html#1476" class="Bound">pledge</a> <a id="1483" class="Symbol">=</a> <a id="1485" href="Ledger.Conway.Specification.Rewards.html#2126" class="Function">rewardℕ</a>
  <a id="1495" class="Keyword">where</a>
    <a id="1505" href="Ledger.Conway.Specification.Rewards.html#1505" class="Function">a0</a>    <a id="1511" class="Symbol">=</a> <a id="1513" class="Number">0</a> <a id="1515" href="Ledger.Conway.Specification.Rewards.html#203" class="Function Operator">⊔ℚ</a> <a id="1518" href="Ledger.Conway.Specification.Rewards.html#1452" class="Bound">pparams</a> <a id="1526" class="Symbol">.</a><a id="1527" href="Ledger.Conway.Specification.PParams.html#2929" class="Field">PParams.a0</a>
    <a id="1542" href="Ledger.Conway.Specification.Rewards.html#1542" class="Function">1+a0</a>  <a id="1548" class="Symbol">=</a> <a id="1550" class="Number">1</a> <a id="1552" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="1554" href="Ledger.Conway.Specification.Rewards.html#1505" class="Function">a0</a>
    <a id="1561" href="Ledger.Conway.Specification.Rewards.html#1561" class="Function">nopt</a>  <a id="1567" class="Symbol">=</a> <a id="1569" class="Number">1</a> <a id="1571" href="Data.Nat.Base.html#5485" class="Function Operator">⊔</a> <a id="1573" href="Ledger.Conway.Specification.Rewards.html#1452" class="Bound">pparams</a> <a id="1581" class="Symbol">.</a><a id="1582" href="Ledger.Conway.Specification.PParams.html#2887" class="Field">PParams.nopt</a>


    <a id="1601" class="Keyword">instance</a>
      <a id="1616" href="Ledger.Conway.Specification.Rewards.html#1616" class="Function">nonZero-nopt</a> <a id="1629" class="Symbol">:</a> <a id="1631" href="Data.Nat.Base.html#3266" class="Record">NonZero</a> <a id="1639" href="Ledger.Conway.Specification.Rewards.html#1561" class="Function">nopt</a>
      <a id="1650" href="Ledger.Conway.Specification.Rewards.html#1616" class="Function">nonZero-nopt</a> <a id="1663" class="Symbol">=</a> <a id="1665" href="Ledger.Conway.Specification.Rewards.html#992" class="Function">nonZero-max-1</a> <a id="1679" class="Symbol">(</a><a id="1680" href="Ledger.Conway.Specification.Rewards.html#1452" class="Bound">pparams</a> <a id="1688" class="Symbol">.</a><a id="1689" href="Ledger.Conway.Specification.PParams.html#2887" class="Field">PParams.nopt</a><a id="1701" class="Symbol">)</a>


    <a id="1709" href="Ledger.Conway.Specification.Rewards.html#1709" class="Function">z0</a>       <a id="1718" class="Symbol">=</a> <a id="1720" class="Number">1</a> <a id="1722" href="Data.Rational.Base.html#3884" class="Function Operator">/</a> <a id="1724" href="Ledger.Conway.Specification.Rewards.html#1561" class="Function">nopt</a>
    <a id="1733" href="Ledger.Conway.Specification.Rewards.html#1733" class="Function">stake&#39;</a>   <a id="1742" class="Symbol">=</a> <a id="1744" href="Ledger.Prelude.Numeric.UnitInterval.html#1988" class="Function">fromUnitInterval</a> <a id="1761" href="Ledger.Conway.Specification.Rewards.html#1470" class="Bound">stake</a> <a id="1767" href="Data.Rational.Base.html#6854" class="Function Operator">⊓</a> <a id="1769" href="Ledger.Conway.Specification.Rewards.html#1709" class="Function">z0</a>
    <a id="1776" href="Ledger.Conway.Specification.Rewards.html#1776" class="Function">pledge&#39;</a>  <a id="1785" class="Symbol">=</a> <a id="1787" href="Ledger.Prelude.Numeric.UnitInterval.html#1988" class="Function">fromUnitInterval</a> <a id="1804" href="Ledger.Conway.Specification.Rewards.html#1476" class="Bound">pledge</a> <a id="1811" href="Data.Rational.Base.html#6854" class="Function Operator">⊓</a> <a id="1813" href="Ledger.Conway.Specification.Rewards.html#1709" class="Function">z0</a>


    <a id="1822" class="Keyword">instance</a>
      <a id="1837" href="Ledger.Conway.Specification.Rewards.html#1837" class="Function">nonZeroz0</a> <a id="1847" class="Symbol">:</a> <a id="1849" href="Ledger.Conway.Specification.Rewards.html#220" class="Function">NonZeroℚ</a> <a id="1858" href="Ledger.Conway.Specification.Rewards.html#1709" class="Function">z0</a>
      <a id="1867" href="Ledger.Conway.Specification.Rewards.html#1837" class="Function">nonZeroz0</a> <a id="1877" class="Symbol">=</a> <a id="1879" href="Ledger.Conway.Specification.Rewards.html#1098" class="Function">nonZero-1/n</a> <a id="1891" href="Ledger.Conway.Specification.Rewards.html#1561" class="Function">nopt</a>

      <a id="1903" href="Ledger.Conway.Specification.Rewards.html#1903" class="Function">nonZero-1+a0</a> <a id="1916" class="Symbol">:</a> <a id="1918" href="Ledger.Conway.Specification.Rewards.html#220" class="Function">NonZeroℚ</a> <a id="1927" class="Symbol">(</a><a id="1928" href="Ledger.Conway.Specification.Rewards.html#1542" class="Function">1+a0</a><a id="1932" class="Symbol">)</a>
      <a id="1940" href="Ledger.Conway.Specification.Rewards.html#1903" class="Function">nonZero-1+a0</a> <a id="1953" class="Symbol">=</a> <a id="1955" href="Ledger.Conway.Specification.Rewards.html#1246" class="Function">nonZero-1+max0-x</a> <a id="1972" class="Symbol">(</a><a id="1973" href="Ledger.Conway.Specification.Rewards.html#1452" class="Bound">pparams</a> <a id="1981" class="Symbol">.</a><a id="1982" href="Ledger.Conway.Specification.PParams.html#2929" class="Field">PParams.a0</a><a id="1992" class="Symbol">)</a>


    <a id="2000" href="Ledger.Conway.Specification.Rewards.html#2000" class="Function">rewardℚ</a> <a id="2008" class="Symbol">=</a>
        <a id="2018" href="Ledger.Conway.Specification.Rewards.html#620" class="Function">fromℕ</a> <a id="2024" href="Ledger.Conway.Specification.Rewards.html#1460" class="Bound">rewardPot</a> <a id="2034" href="Data.Rational.Base.html#6708" class="Function Operator">÷</a> <a id="2036" href="Ledger.Conway.Specification.Rewards.html#1542" class="Function">1+a0</a>
        <a id="2049" href="Data.Rational.Base.html#6315" class="Function Operator">*</a> <a id="2051" class="Symbol">(</a><a id="2052" href="Ledger.Conway.Specification.Rewards.html#1733" class="Function">stake&#39;</a> <a id="2059" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="2061" href="Ledger.Conway.Specification.Rewards.html#1776" class="Function">pledge&#39;</a> <a id="2069" href="Data.Rational.Base.html#6315" class="Function Operator">*</a> <a id="2071" href="Ledger.Conway.Specification.Rewards.html#1505" class="Function">a0</a> <a id="2074" href="Data.Rational.Base.html#6315" class="Function Operator">*</a> <a id="2076" class="Symbol">(</a><a id="2077" href="Ledger.Conway.Specification.Rewards.html#1733" class="Function">stake&#39;</a> <a id="2084" href="Data.Rational.Base.html#6405" class="Function Operator">-</a> <a id="2086" href="Ledger.Conway.Specification.Rewards.html#1776" class="Function">pledge&#39;</a> <a id="2094" href="Data.Rational.Base.html#6315" class="Function Operator">*</a> <a id="2096" class="Symbol">(</a><a id="2097" href="Ledger.Conway.Specification.Rewards.html#1709" class="Function">z0</a> <a id="2100" href="Data.Rational.Base.html#6405" class="Function Operator">-</a> <a id="2102" href="Ledger.Conway.Specification.Rewards.html#1733" class="Function">stake&#39;</a><a id="2108" class="Symbol">)</a> <a id="2110" href="Data.Rational.Base.html#6708" class="Function Operator">÷</a> <a id="2112" href="Ledger.Conway.Specification.Rewards.html#1709" class="Function">z0</a><a id="2114" class="Symbol">)</a> <a id="2116" href="Data.Rational.Base.html#6708" class="Function Operator">÷</a> <a id="2118" href="Ledger.Conway.Specification.Rewards.html#1709" class="Function">z0</a><a id="2120" class="Symbol">)</a>
    <a id="2126" href="Ledger.Conway.Specification.Rewards.html#2126" class="Function">rewardℕ</a> <a id="2134" class="Symbol">=</a> <a id="2136" href="Prelude.html#3167" class="Function">posPart</a> <a id="2144" class="Symbol">(</a><a id="2145" href="Data.Rational.Base.html#7116" class="Function">floor</a> <a id="2151" href="Ledger.Conway.Specification.Rewards.html#2000" class="Function">rewardℚ</a><a id="2158" class="Symbol">)</a>


<a id="mkApparentPerformance"></a><a id="2162" href="Ledger.Conway.Specification.Rewards.html#2162" class="Function">mkApparentPerformance</a> <a id="2184" class="Symbol">:</a> <a id="2186" href="Ledger.Prelude.Numeric.UnitInterval.html#1776" class="Function">UnitInterval</a> <a id="2199" class="Symbol">→</a> <a id="2201" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a> <a id="2203" class="Symbol">→</a> <a id="2205" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a> <a id="2207" class="Symbol">→</a> <a id="2209" href="Data.Rational.Base.html#1342" class="Record">ℚ</a>
<a id="2211" href="Ledger.Conway.Specification.Rewards.html#2162" class="Function">mkApparentPerformance</a> <a id="2233" href="Ledger.Conway.Specification.Rewards.html#2233" class="Bound">stake</a> <a id="2239" href="Ledger.Conway.Specification.Rewards.html#2239" class="Bound">poolBlocks</a> <a id="2250" href="Ledger.Conway.Specification.Rewards.html#2250" class="Bound">totalBlocks</a> <a id="2262" class="Symbol">=</a> <a id="2264" href="Ledger.Conway.Specification.Rewards.html#2459" class="Function">ratioBlocks</a> <a id="2276" href="Ledger.Prelude.html#2064" class="Function Operator">÷₀</a> <a id="2279" href="Ledger.Conway.Specification.Rewards.html#2298" class="Function">stake&#39;</a>
  <a id="2288" class="Keyword">where</a>
    <a id="2298" href="Ledger.Conway.Specification.Rewards.html#2298" class="Function">stake&#39;</a> <a id="2305" class="Symbol">=</a> <a id="2307" href="Ledger.Prelude.Numeric.UnitInterval.html#1988" class="Function">fromUnitInterval</a> <a id="2324" href="Ledger.Conway.Specification.Rewards.html#2233" class="Bound">stake</a>


    <a id="2336" class="Keyword">instance</a>
      <a id="2351" href="Ledger.Conway.Specification.Rewards.html#2351" class="Function">nonZero-totalBlocks</a> <a id="2371" class="Symbol">:</a> <a id="2373" href="Data.Nat.Base.html#3266" class="Record">NonZero</a> <a id="2381" class="Symbol">(</a><a id="2382" class="Number">1</a> <a id="2384" href="Data.Nat.Base.html#5485" class="Function Operator">⊔</a> <a id="2386" href="Ledger.Conway.Specification.Rewards.html#2250" class="Bound">totalBlocks</a><a id="2397" class="Symbol">)</a>
      <a id="2405" href="Ledger.Conway.Specification.Rewards.html#2351" class="Function">nonZero-totalBlocks</a> <a id="2425" class="Symbol">=</a> <a id="2427" href="Ledger.Conway.Specification.Rewards.html#992" class="Function">nonZero-max-1</a> <a id="2441" href="Ledger.Conway.Specification.Rewards.html#2250" class="Bound">totalBlocks</a>


    <a id="2459" href="Ledger.Conway.Specification.Rewards.html#2459" class="Function">ratioBlocks</a> <a id="2471" class="Symbol">=</a> <a id="2473" class="Symbol">(</a><a id="2474" href="Ledger.Conway.Specification.Rewards.html#76" class="InductiveConstructor">pos</a> <a id="2478" href="Ledger.Conway.Specification.Rewards.html#2239" class="Bound">poolBlocks</a><a id="2488" class="Symbol">)</a> <a id="2490" href="Data.Rational.Base.html#3884" class="Function Operator">/</a> <a id="2492" class="Symbol">(</a><a id="2493" class="Number">1</a> <a id="2495" href="Data.Nat.Base.html#5485" class="Function Operator">⊔</a> <a id="2497" href="Ledger.Conway.Specification.Rewards.html#2250" class="Bound">totalBlocks</a><a id="2508" class="Symbol">)</a>


<a id="rewardOwners"></a><a id="2512" href="Ledger.Conway.Specification.Rewards.html#2512" class="Function">rewardOwners</a> <a id="2525" class="Symbol">:</a> <a id="2527" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a> <a id="2532" class="Symbol">→</a> <a id="2534" href="Ledger.Conway.Specification.Certs.html#1148" class="Record">StakePoolParams</a> <a id="2550" class="Symbol">→</a> <a id="2552" href="Ledger.Prelude.Numeric.UnitInterval.html#1776" class="Function">UnitInterval</a> <a id="2565" class="Symbol">→</a> <a id="2567" href="Ledger.Prelude.Numeric.UnitInterval.html#1776" class="Function">UnitInterval</a> <a id="2580" class="Symbol">→</a> <a id="2582" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a>
<a id="2587" href="Ledger.Conway.Specification.Rewards.html#2512" class="Function">rewardOwners</a> <a id="2600" href="Ledger.Conway.Specification.Rewards.html#2600" class="Bound">rewards</a> <a id="2608" href="Ledger.Conway.Specification.Rewards.html#2608" class="Bound">pool</a> <a id="2613" href="Ledger.Conway.Specification.Rewards.html#2613" class="Bound">ownerStake</a> <a id="2624" href="Ledger.Conway.Specification.Rewards.html#2624" class="Bound">stake</a> <a id="2630" class="Symbol">=</a> <a id="2632" href="Class.ToBool.html#389" class="Function Operator">if</a> <a id="2635" href="Ledger.Conway.Specification.Rewards.html#2600" class="Bound">rewards</a> <a id="2643" href="Class.HasOrder.Core.html#608" class="Field Operator">≤</a> <a id="2645" href="Ledger.Conway.Specification.Rewards.html#2858" class="Function">cost</a>
  <a id="2652" href="Class.ToBool.html#389" class="Function Operator">then</a> <a id="2657" href="Ledger.Conway.Specification.Rewards.html#2600" class="Bound">rewards</a>
  <a id="2667" href="Class.ToBool.html#389" class="Function Operator">else</a> <a id="2672" href="Ledger.Conway.Specification.Rewards.html#2858" class="Function">cost</a> <a id="2677" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="2679" href="Prelude.html#3167" class="Function">posPart</a> <a id="2687" class="Symbol">(</a><a id="2688" href="Data.Rational.Base.html#7116" class="Function">floor</a> <a id="2694" class="Symbol">(</a>
        <a id="2704" class="Symbol">(</a><a id="2705" href="Ledger.Conway.Specification.Rewards.html#620" class="Function">fromℕ</a> <a id="2711" href="Ledger.Conway.Specification.Rewards.html#2600" class="Bound">rewards</a> <a id="2719" href="Data.Rational.Base.html#6405" class="Function Operator">-</a> <a id="2721" href="Ledger.Conway.Specification.Rewards.html#620" class="Function">fromℕ</a> <a id="2727" href="Ledger.Conway.Specification.Rewards.html#2858" class="Function">cost</a><a id="2731" class="Symbol">)</a> <a id="2733" href="Data.Rational.Base.html#6315" class="Function Operator">*</a> <a id="2735" class="Symbol">(</a><a id="2736" href="Ledger.Conway.Specification.Rewards.html#2903" class="Function">margin</a> <a id="2743" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="2745" class="Symbol">(</a><a id="2746" class="Number">1</a> <a id="2748" href="Data.Rational.Base.html#6405" class="Function Operator">-</a> <a id="2750" href="Ledger.Conway.Specification.Rewards.html#2903" class="Function">margin</a><a id="2756" class="Symbol">)</a> <a id="2758" href="Data.Rational.Base.html#6315" class="Function Operator">*</a> <a id="2760" href="Ledger.Conway.Specification.Rewards.html#2786" class="Function">ratioStake</a><a id="2770" class="Symbol">)))</a>
  <a id="2776" class="Keyword">where</a>
    <a id="2786" href="Ledger.Conway.Specification.Rewards.html#2786" class="Function">ratioStake</a>  <a id="2798" class="Symbol">=</a> <a id="2800" href="Ledger.Prelude.Numeric.UnitInterval.html#1988" class="Function">fromUnitInterval</a> <a id="2817" href="Ledger.Conway.Specification.Rewards.html#2613" class="Bound">ownerStake</a> <a id="2828" href="Ledger.Prelude.html#2064" class="Function Operator">÷₀</a> <a id="2831" href="Ledger.Prelude.Numeric.UnitInterval.html#1988" class="Function">fromUnitInterval</a> <a id="2848" href="Ledger.Conway.Specification.Rewards.html#2624" class="Bound">stake</a>
    <a id="2858" href="Ledger.Conway.Specification.Rewards.html#2858" class="Function">cost</a>        <a id="2870" class="Symbol">=</a> <a id="2872" href="Ledger.Conway.Specification.Rewards.html#2608" class="Bound">pool</a> <a id="2877" class="Symbol">.</a><a id="2878" href="Ledger.Conway.Specification.Certs.html#1221" class="Field">StakePoolParams.cost</a>
    <a id="2903" href="Ledger.Conway.Specification.Rewards.html#2903" class="Function">margin</a>      <a id="2915" class="Symbol">=</a> <a id="2917" href="Ledger.Prelude.Numeric.UnitInterval.html#1988" class="Function">fromUnitInterval</a> <a id="2934" class="Symbol">(</a><a id="2935" href="Ledger.Conway.Specification.Rewards.html#2608" class="Bound">pool</a> <a id="2940" class="Symbol">.</a><a id="2941" href="Ledger.Conway.Specification.Certs.html#1248" class="Field">StakePoolParams.margin</a><a id="2963" class="Symbol">)</a>


<a id="rewardMember"></a><a id="2967" href="Ledger.Conway.Specification.Rewards.html#2967" class="Function">rewardMember</a> <a id="2980" class="Symbol">:</a> <a id="2982" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a> <a id="2987" class="Symbol">→</a> <a id="2989" href="Ledger.Conway.Specification.Certs.html#1148" class="Record">StakePoolParams</a> <a id="3005" class="Symbol">→</a> <a id="3007" href="Ledger.Prelude.Numeric.UnitInterval.html#1776" class="Function">UnitInterval</a> <a id="3020" class="Symbol">→</a> <a id="3022" href="Ledger.Prelude.Numeric.UnitInterval.html#1776" class="Function">UnitInterval</a> <a id="3035" class="Symbol">→</a> <a id="3037" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a>
<a id="3042" href="Ledger.Conway.Specification.Rewards.html#2967" class="Function">rewardMember</a> <a id="3055" href="Ledger.Conway.Specification.Rewards.html#3055" class="Bound">rewards</a> <a id="3063" href="Ledger.Conway.Specification.Rewards.html#3063" class="Bound">pool</a> <a id="3068" href="Ledger.Conway.Specification.Rewards.html#3068" class="Bound">memberStake</a> <a id="3080" href="Ledger.Conway.Specification.Rewards.html#3080" class="Bound">stake</a> <a id="3086" class="Symbol">=</a> <a id="3088" href="Class.ToBool.html#389" class="Function Operator">if</a> <a id="3091" href="Ledger.Conway.Specification.Rewards.html#3055" class="Bound">rewards</a> <a id="3099" href="Class.HasOrder.Core.html#608" class="Field Operator">≤</a> <a id="3101" href="Ledger.Conway.Specification.Rewards.html#3294" class="Function">cost</a>
  <a id="3108" href="Class.ToBool.html#389" class="Function Operator">then</a> <a id="3113" class="Number">0</a>
  <a id="3117" href="Class.ToBool.html#389" class="Function Operator">else</a> <a id="3122" href="Prelude.html#3167" class="Function">posPart</a> <a id="3130" class="Symbol">(</a><a id="3131" href="Data.Rational.Base.html#7116" class="Function">floor</a> <a id="3137" class="Symbol">(</a>
         <a id="3148" class="Symbol">(</a><a id="3149" href="Ledger.Conway.Specification.Rewards.html#620" class="Function">fromℕ</a> <a id="3155" href="Ledger.Conway.Specification.Rewards.html#3055" class="Bound">rewards</a> <a id="3163" href="Data.Rational.Base.html#6405" class="Function Operator">-</a> <a id="3165" href="Ledger.Conway.Specification.Rewards.html#620" class="Function">fromℕ</a> <a id="3171" href="Ledger.Conway.Specification.Rewards.html#3294" class="Function">cost</a><a id="3175" class="Symbol">)</a> <a id="3177" href="Data.Rational.Base.html#6315" class="Function Operator">*</a> <a id="3179" class="Symbol">((</a><a id="3181" class="Number">1</a> <a id="3183" href="Data.Rational.Base.html#6405" class="Function Operator">-</a> <a id="3185" href="Ledger.Conway.Specification.Rewards.html#3339" class="Function">margin</a><a id="3191" class="Symbol">)</a> <a id="3193" href="Data.Rational.Base.html#6315" class="Function Operator">*</a> <a id="3195" href="Ledger.Conway.Specification.Rewards.html#3221" class="Function">ratioStake</a><a id="3205" class="Symbol">)))</a>
  <a id="3211" class="Keyword">where</a>
    <a id="3221" href="Ledger.Conway.Specification.Rewards.html#3221" class="Function">ratioStake</a>  <a id="3233" class="Symbol">=</a> <a id="3235" href="Ledger.Prelude.Numeric.UnitInterval.html#1988" class="Function">fromUnitInterval</a> <a id="3252" href="Ledger.Conway.Specification.Rewards.html#3068" class="Bound">memberStake</a> <a id="3264" href="Ledger.Prelude.html#2064" class="Function Operator">÷₀</a> <a id="3267" href="Ledger.Prelude.Numeric.UnitInterval.html#1988" class="Function">fromUnitInterval</a> <a id="3284" href="Ledger.Conway.Specification.Rewards.html#3080" class="Bound">stake</a>
    <a id="3294" href="Ledger.Conway.Specification.Rewards.html#3294" class="Function">cost</a>        <a id="3306" class="Symbol">=</a> <a id="3308" href="Ledger.Conway.Specification.Rewards.html#3063" class="Bound">pool</a> <a id="3313" class="Symbol">.</a><a id="3314" href="Ledger.Conway.Specification.Certs.html#1221" class="Field">StakePoolParams.cost</a>
    <a id="3339" href="Ledger.Conway.Specification.Rewards.html#3339" class="Function">margin</a>      <a id="3351" class="Symbol">=</a> <a id="3353" href="Ledger.Prelude.Numeric.UnitInterval.html#1988" class="Function">fromUnitInterval</a> <a id="3370" class="Symbol">(</a><a id="3371" href="Ledger.Conway.Specification.Rewards.html#3063" class="Bound">pool</a> <a id="3376" class="Symbol">.</a><a id="3377" href="Ledger.Conway.Specification.Certs.html#1248" class="Field">StakePoolParams.margin</a><a id="3399" class="Symbol">)</a>


<a id="Stake"></a><a id="3403" href="Ledger.Conway.Specification.Rewards.html#3403" class="Function">Stake</a> <a id="3409" class="Symbol">=</a> <a id="3411" href="Ledger.Core.Specification.Address.html#260" class="Datatype">Credential</a> <a id="3422" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="3424" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a>

<a id="rewardOnePool"></a><a id="3430" href="Ledger.Conway.Specification.Rewards.html#3430" class="Function">rewardOnePool</a> <a id="3444" class="Symbol">:</a> <a id="3446" href="Ledger.Conway.Specification.PParams.html#1728" class="Record">PParams</a> <a id="3454" class="Symbol">→</a> <a id="3456" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a> <a id="3461" class="Symbol">→</a> <a id="3463" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a> <a id="3465" class="Symbol">→</a> <a id="3467" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a> <a id="3469" class="Symbol">→</a> <a id="3471" href="Ledger.Conway.Specification.Certs.html#1148" class="Record">StakePoolParams</a>
  <a id="3489" class="Symbol">→</a> <a id="3491" href="Ledger.Conway.Specification.Rewards.html#3403" class="Function">Stake</a> <a id="3497" class="Symbol">→</a> <a id="3499" href="Ledger.Prelude.Numeric.UnitInterval.html#1776" class="Function">UnitInterval</a> <a id="3512" class="Symbol">→</a> <a id="3514" href="Ledger.Prelude.Numeric.UnitInterval.html#1776" class="Function">UnitInterval</a> <a id="3527" class="Symbol">→</a> <a id="3529" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a> <a id="3534" class="Symbol">→</a> <a id="3536" class="Symbol">(</a><a id="3537" href="Ledger.Core.Specification.Address.html#260" class="Datatype">Credential</a> <a id="3548" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="3550" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a><a id="3554" class="Symbol">)</a>
<a id="3556" href="Ledger.Conway.Specification.Rewards.html#3430" class="Function">rewardOnePool</a> <a id="3570" href="Ledger.Conway.Specification.Rewards.html#3570" class="Bound">pparams</a> <a id="3578" href="Ledger.Conway.Specification.Rewards.html#3578" class="Bound">rewardPot</a> <a id="3588" href="Ledger.Conway.Specification.Rewards.html#3588" class="Bound">n</a> <a id="3590" href="Ledger.Conway.Specification.Rewards.html#3590" class="Bound">N</a> <a id="3592" href="Ledger.Conway.Specification.Rewards.html#3592" class="Bound">pool</a> <a id="3597" href="Ledger.Conway.Specification.Rewards.html#3597" class="Bound">stakeDistr</a> <a id="3608" href="Ledger.Conway.Specification.Rewards.html#3608" class="Bound">σ</a> <a id="3610" href="Ledger.Conway.Specification.Rewards.html#3610" class="Bound">σa</a> <a id="3613" href="Ledger.Conway.Specification.Rewards.html#3613" class="Bound">tot</a> <a id="3617" class="Symbol">=</a> <a id="3619" href="Ledger.Conway.Specification.Rewards.html#4343" class="Function">rewards</a>
  <a id="3629" class="Keyword">where</a>
    <a id="3639" href="Ledger.Conway.Specification.Rewards.html#3639" class="Function">mkRelativeStake</a> <a id="3655" class="Symbol">=</a> <a id="3657" class="Symbol">λ</a> <a id="3659" href="Ledger.Conway.Specification.Rewards.html#3659" class="Bound">coin</a> <a id="3664" class="Symbol">→</a> <a id="3666" href="Ledger.Prelude.Numeric.UnitInterval.html#2764" class="Function">clamp</a> <a id="3672" class="Symbol">(</a><a id="3673" href="Ledger.Conway.Specification.Rewards.html#3659" class="Bound">coin</a> <a id="3678" href="Ledger.Prelude.html#1945" class="Function Operator">/₀</a> <a id="3681" href="Ledger.Conway.Specification.Rewards.html#3613" class="Bound">tot</a><a id="3684" class="Symbol">)</a>
    <a id="3690" href="Ledger.Conway.Specification.Rewards.html#3690" class="Function">owners</a> <a id="3697" class="Symbol">=</a> <a id="3699" href="abstract-set-theory.FiniteSetTheory.html#519" class="Function">mapˢ</a> <a id="3704" href="Ledger.Core.Specification.Address.html#286" class="InductiveConstructor">KeyHashObj</a> <a id="3715" class="Symbol">(</a><a id="3716" href="Ledger.Conway.Specification.Rewards.html#3592" class="Bound">pool</a> <a id="3721" class="Symbol">.</a><a id="3722" href="Ledger.Conway.Specification.Certs.html#1189" class="Field">StakePoolParams.owners</a><a id="3744" class="Symbol">)</a>
    <a id="3750" href="Ledger.Conway.Specification.Rewards.html#3750" class="Function">ownerStake</a> <a id="3761" class="Symbol">=</a> <a id="3763" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">∑[</a> <a id="3766" href="Ledger.Conway.Specification.Rewards.html#3766" class="Bound">c</a> <a id="3768" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">←</a> <a id="3770" href="Ledger.Conway.Specification.Rewards.html#3597" class="Bound">stakeDistr</a> <a id="3781" href="Axiom.Set.Map.html#10678" class="Function Operator">∣</a> <a id="3783" href="Ledger.Conway.Specification.Rewards.html#3690" class="Function">owners</a> <a id="3790" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">]</a> <a id="3792" href="Ledger.Conway.Specification.Rewards.html#3766" class="Bound">c</a>
    <a id="3798" href="Ledger.Conway.Specification.Rewards.html#3798" class="Function">pledge</a> <a id="3805" class="Symbol">=</a> <a id="3807" href="Ledger.Conway.Specification.Rewards.html#3592" class="Bound">pool</a> <a id="3812" class="Symbol">.</a><a id="3813" href="Ledger.Conway.Specification.Certs.html#1283" class="Field">StakePoolParams.pledge</a>
    <a id="3840" href="Ledger.Conway.Specification.Rewards.html#3840" class="Function">maxP</a> <a id="3845" class="Symbol">=</a> <a id="3847" href="Class.ToBool.html#389" class="Function Operator">if</a> <a id="3850" href="Ledger.Conway.Specification.Rewards.html#3798" class="Function">pledge</a> <a id="3857" href="Class.HasOrder.Core.html#608" class="Field Operator">≤</a> <a id="3859" href="Ledger.Conway.Specification.Rewards.html#3750" class="Function">ownerStake</a>
      <a id="3876" href="Class.ToBool.html#389" class="Function Operator">then</a> <a id="3881" href="Ledger.Conway.Specification.Rewards.html#1382" class="Function">maxPool</a> <a id="3889" href="Ledger.Conway.Specification.Rewards.html#3570" class="Bound">pparams</a> <a id="3897" href="Ledger.Conway.Specification.Rewards.html#3578" class="Bound">rewardPot</a> <a id="3907" href="Ledger.Conway.Specification.Rewards.html#3608" class="Bound">σ</a> <a id="3909" class="Symbol">(</a><a id="3910" href="Ledger.Conway.Specification.Rewards.html#3639" class="Function">mkRelativeStake</a> <a id="3926" href="Ledger.Conway.Specification.Rewards.html#3798" class="Function">pledge</a><a id="3932" class="Symbol">)</a>
      <a id="3940" href="Class.ToBool.html#389" class="Function Operator">else</a> <a id="3945" class="Number">0</a>
    <a id="3951" href="Ledger.Conway.Specification.Rewards.html#3951" class="Function">apparentPerformance</a> <a id="3971" class="Symbol">=</a> <a id="3973" href="Ledger.Conway.Specification.Rewards.html#2162" class="Function">mkApparentPerformance</a> <a id="3995" href="Ledger.Conway.Specification.Rewards.html#3610" class="Bound">σa</a> <a id="3998" href="Ledger.Conway.Specification.Rewards.html#3588" class="Bound">n</a> <a id="4000" href="Ledger.Conway.Specification.Rewards.html#3590" class="Bound">N</a>
    <a id="4006" href="Ledger.Conway.Specification.Rewards.html#4006" class="Function">poolReward</a> <a id="4017" class="Symbol">=</a> <a id="4019" href="Prelude.html#3167" class="Function">posPart</a> <a id="4027" class="Symbol">(</a><a id="4028" href="Data.Rational.Base.html#7116" class="Function">floor</a> <a id="4034" class="Symbol">(</a><a id="4035" href="Ledger.Conway.Specification.Rewards.html#3951" class="Function">apparentPerformance</a> <a id="4055" href="Data.Rational.Base.html#6315" class="Function Operator">*</a> <a id="4057" href="Ledger.Conway.Specification.Rewards.html#620" class="Function">fromℕ</a> <a id="4063" href="Ledger.Conway.Specification.Rewards.html#3840" class="Function">maxP</a><a id="4067" class="Symbol">))</a>
    <a id="4074" href="Ledger.Conway.Specification.Rewards.html#4074" class="Function">memberRewards</a> <a id="4088" class="Symbol">=</a>
      <a id="4096" href="Axiom.Set.Map.html#6068" class="Function">mapValues</a> <a id="4106" class="Symbol">(λ</a> <a id="4109" href="Ledger.Conway.Specification.Rewards.html#4109" class="Bound">coin</a> <a id="4114" class="Symbol">→</a> <a id="4116" href="Ledger.Conway.Specification.Rewards.html#2967" class="Function">rewardMember</a> <a id="4129" href="Ledger.Conway.Specification.Rewards.html#4006" class="Function">poolReward</a> <a id="4140" href="Ledger.Conway.Specification.Rewards.html#3592" class="Bound">pool</a> <a id="4145" class="Symbol">(</a><a id="4146" href="Ledger.Conway.Specification.Rewards.html#3639" class="Function">mkRelativeStake</a> <a id="4162" href="Ledger.Conway.Specification.Rewards.html#4109" class="Bound">coin</a><a id="4166" class="Symbol">)</a> <a id="4168" href="Ledger.Conway.Specification.Rewards.html#3608" class="Bound">σ</a><a id="4169" class="Symbol">)</a>
        <a id="4179" class="Symbol">(</a><a id="4180" href="Ledger.Conway.Specification.Rewards.html#3597" class="Bound">stakeDistr</a> <a id="4191" href="Axiom.Set.Map.html#10748" class="Function Operator">∣</a> <a id="4193" href="Ledger.Conway.Specification.Rewards.html#3690" class="Function">owners</a> <a id="4200" href="Axiom.Set.Map.html#10748" class="Function Operator">ᶜ</a><a id="4201" class="Symbol">)</a>
    <a id="4207" href="Ledger.Conway.Specification.Rewards.html#4207" class="Function">ownersRewards</a>  <a id="4222" class="Symbol">=</a>
      <a id="4230" href="Axiom.Set.Map.html#4588" class="Function Operator">❴</a> <a id="4232" href="Ledger.Conway.Specification.Rewards.html#3592" class="Bound">pool</a> <a id="4237" class="Symbol">.</a><a id="4238" href="Ledger.Conway.Specification.Certs.html#1310" class="Field">StakePoolParams.rewardAccount</a>
      <a id="4274" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="4276" href="Ledger.Conway.Specification.Rewards.html#2512" class="Function">rewardOwners</a> <a id="4289" href="Ledger.Conway.Specification.Rewards.html#4006" class="Function">poolReward</a> <a id="4300" href="Ledger.Conway.Specification.Rewards.html#3592" class="Bound">pool</a> <a id="4305" class="Symbol">(</a><a id="4306" href="Ledger.Conway.Specification.Rewards.html#3639" class="Function">mkRelativeStake</a> <a id="4322" href="Ledger.Conway.Specification.Rewards.html#3750" class="Function">ownerStake</a><a id="4332" class="Symbol">)</a> <a id="4334" href="Ledger.Conway.Specification.Rewards.html#3608" class="Bound">σ</a> <a id="4336" href="Axiom.Set.Map.html#4588" class="Function Operator">❵ᵐ</a>
    <a id="4343" href="Ledger.Conway.Specification.Rewards.html#4343" class="Function">rewards</a> <a id="4351" class="Symbol">=</a> <a id="4353" href="Ledger.Conway.Specification.Rewards.html#4074" class="Function">memberRewards</a> <a id="4367" href="Axiom.Set.Map.Dec.html#1854" class="Function Operator">∪⁺</a> <a id="4370" href="Ledger.Conway.Specification.Rewards.html#4207" class="Function">ownersRewards</a>


<a id="Delegations"></a><a id="4386" href="Ledger.Conway.Specification.Rewards.html#4386" class="Function">Delegations</a> <a id="4398" class="Symbol">=</a> <a id="4400" href="Ledger.Core.Specification.Address.html#260" class="Datatype">Credential</a> <a id="4411" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="4413" href="Ledger.Core.Specification.Crypto.html#1338" class="Function">KeyHash</a>

<a id="poolStake"></a><a id="4422" href="Ledger.Conway.Specification.Rewards.html#4422" class="Function">poolStake</a>  <a id="4433" class="Symbol">:</a> <a id="4435" href="Ledger.Core.Specification.Crypto.html#1338" class="Function">KeyHash</a> <a id="4443" class="Symbol">→</a> <a id="4445" href="Ledger.Conway.Specification.Rewards.html#4386" class="Function">Delegations</a> <a id="4457" class="Symbol">→</a> <a id="4459" href="Ledger.Conway.Specification.Rewards.html#3403" class="Function">Stake</a> <a id="4465" class="Symbol">→</a> <a id="4467" href="Ledger.Conway.Specification.Rewards.html#3403" class="Function">Stake</a>
<a id="4473" href="Ledger.Conway.Specification.Rewards.html#4422" class="Function">poolStake</a> <a id="4483" href="Ledger.Conway.Specification.Rewards.html#4483" class="Bound">hk</a> <a id="4486" href="Ledger.Conway.Specification.Rewards.html#4486" class="Bound">delegs</a> <a id="4493" href="Ledger.Conway.Specification.Rewards.html#4493" class="Bound">stake</a> <a id="4499" class="Symbol">=</a> <a id="4501" href="Ledger.Conway.Specification.Rewards.html#4493" class="Bound">stake</a> <a id="4507" href="Axiom.Set.Map.html#10678" class="Function Operator">∣</a> <a id="4509" href="Class.IsSet.html#916" class="Function">dom</a> <a id="4513" class="Symbol">(</a><a id="4514" href="Ledger.Conway.Specification.Rewards.html#4486" class="Bound">delegs</a> <a id="4521" href="Axiom.Set.Map.html#14048" class="Function Operator">∣^</a> <a id="4524" href="Class.HasSingleton.html#288" class="Field Operator">❴</a> <a id="4526" href="Ledger.Conway.Specification.Rewards.html#4483" class="Bound">hk</a> <a id="4529" href="Class.HasSingleton.html#288" class="Field Operator">❵</a><a id="4530" class="Symbol">)</a>


<a id="BlocksMade"></a><a id="4534" href="Ledger.Conway.Specification.Rewards.html#4534" class="Function">BlocksMade</a> <a id="4545" class="Symbol">=</a> <a id="4547" href="Ledger.Core.Specification.Crypto.html#1338" class="Function">KeyHash</a> <a id="4555" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="4557" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a>

<a id="uncurryᵐ"></a><a id="4560" href="Ledger.Conway.Specification.Rewards.html#4560" class="Function">uncurryᵐ</a> <a id="4569" class="Symbol">:</a>


  <a id="4575" class="Symbol">∀</a> <a id="4577" class="Symbol">{</a><a id="4578" href="Ledger.Conway.Specification.Rewards.html#4578" class="Bound">A</a> <a id="4580" href="Ledger.Conway.Specification.Rewards.html#4580" class="Bound">B</a> <a id="4582" href="Ledger.Conway.Specification.Rewards.html#4582" class="Bound">C</a> <a id="4584" class="Symbol">:</a> <a id="4586" href="Agda.Primitive.html#388" class="Primitive">Type</a><a id="4590" class="Symbol">}</a> <a id="4592" class="Symbol">⦃</a> <a id="4594" href="Ledger.Conway.Specification.Rewards.html#4594" class="Bound">_</a> <a id="4596" class="Symbol">:</a> <a id="4598" href="Class.DecEq.Core.html#117" class="Record">DecEq</a> <a id="4604" href="Ledger.Conway.Specification.Rewards.html#4578" class="Bound">A</a> <a id="4606" class="Symbol">⦄</a> <a id="4608" class="Symbol">⦃</a> <a id="4610" href="Ledger.Conway.Specification.Rewards.html#4610" class="Bound">_</a> <a id="4612" class="Symbol">:</a> <a id="4614" href="Class.DecEq.Core.html#117" class="Record">DecEq</a> <a id="4620" href="Ledger.Conway.Specification.Rewards.html#4580" class="Bound">B</a> <a id="4622" class="Symbol">⦄</a> <a id="4624" class="Symbol">→</a>


  <a id="4630" href="Ledger.Conway.Specification.Rewards.html#4578" class="Bound">A</a> <a id="4632" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="4634" class="Symbol">(</a><a id="4635" href="Ledger.Conway.Specification.Rewards.html#4580" class="Bound">B</a> <a id="4637" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="4639" href="Ledger.Conway.Specification.Rewards.html#4582" class="Bound">C</a><a id="4640" class="Symbol">)</a> <a id="4642" class="Symbol">→</a> <a id="4644" class="Symbol">(</a><a id="4645" href="Ledger.Conway.Specification.Rewards.html#4578" class="Bound">A</a> <a id="4647" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="4649" href="Ledger.Conway.Specification.Rewards.html#4580" class="Bound">B</a><a id="4650" class="Symbol">)</a> <a id="4652" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="4654" href="Ledger.Conway.Specification.Rewards.html#4582" class="Bound">C</a>


<a id="4658" href="Ledger.Conway.Specification.Rewards.html#4560" class="Function">uncurryᵐ</a> <a id="4667" class="Symbol">{</a><a id="4668" href="Ledger.Conway.Specification.Rewards.html#4668" class="Bound">A</a><a id="4669" class="Symbol">}</a> <a id="4671" class="Symbol">{</a><a id="4672" href="Ledger.Conway.Specification.Rewards.html#4672" class="Bound">B</a><a id="4673" class="Symbol">}</a> <a id="4675" class="Symbol">{</a><a id="4676" href="Ledger.Conway.Specification.Rewards.html#4676" class="Bound">C</a><a id="4677" class="Symbol">}</a> <a id="4679" href="Ledger.Conway.Specification.Rewards.html#4679" class="Bound">abc</a> <a id="4683" class="Symbol">=</a> <a id="4685" href="Axiom.Set.Map.html#10460" class="Function">mapFromPartialFun</a> <a id="4703" href="Ledger.Conway.Specification.Rewards.html#4731" class="Function">lookup&#39;</a> <a id="4711" href="Ledger.Conway.Specification.Rewards.html#4889" class="Function">domain&#39;</a>
  <a id="4721" class="Keyword">where</a>
    <a id="4731" href="Ledger.Conway.Specification.Rewards.html#4731" class="Function">lookup&#39;</a> <a id="4739" class="Symbol">:</a> <a id="4741" class="Symbol">(</a><a id="4742" href="Ledger.Conway.Specification.Rewards.html#4668" class="Bound">A</a> <a id="4744" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="4746" href="Ledger.Conway.Specification.Rewards.html#4672" class="Bound">B</a><a id="4747" class="Symbol">)</a> <a id="4749" class="Symbol">→</a> <a id="4751" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="4757" href="Ledger.Conway.Specification.Rewards.html#4676" class="Bound">C</a>
    <a id="4763" href="Ledger.Conway.Specification.Rewards.html#4731" class="Function">lookup&#39;</a> <a id="4771" class="Symbol">(</a><a id="4772" href="Ledger.Conway.Specification.Rewards.html#4772" class="Bound">a</a> <a id="4774" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="4776" href="Ledger.Conway.Specification.Rewards.html#4776" class="Bound">b</a><a id="4777" class="Symbol">)</a> <a id="4779" class="Symbol">=</a> <a id="4781" href="Axiom.Set.Map.html#13670" class="Function">lookupᵐ?</a> <a id="4790" href="Ledger.Conway.Specification.Rewards.html#4679" class="Bound">abc</a> <a id="4794" href="Ledger.Conway.Specification.Rewards.html#4772" class="Bound">a</a> <a id="4796" href="Class.Monad.Core.html#299" class="Field Operator">&gt;&gt;=</a> <a id="4800" class="Symbol">(λ</a> <a id="4803" href="Ledger.Conway.Specification.Rewards.html#4803" class="Bound">bc</a> <a id="4806" class="Symbol">→</a> <a id="4808" href="Axiom.Set.Map.html#13670" class="Function">lookupᵐ?</a> <a id="4817" href="Ledger.Conway.Specification.Rewards.html#4803" class="Bound">bc</a> <a id="4820" href="Ledger.Conway.Specification.Rewards.html#4776" class="Bound">b</a><a id="4821" class="Symbol">)</a>

    <a id="4828" href="Ledger.Conway.Specification.Rewards.html#4828" class="Function">joinˢ</a> <a id="4834" class="Symbol">:</a> <a id="4836" class="Symbol">∀</a> <a id="4838" class="Symbol">{</a><a id="4839" href="Ledger.Conway.Specification.Rewards.html#4839" class="Bound">X</a><a id="4840" class="Symbol">}</a> <a id="4842" class="Symbol">→</a> <a id="4844" href="abstract-set-theory.FiniteSetTheory.html#488" class="Function Operator">ℙ</a> <a id="4846" class="Symbol">(</a><a id="4847" href="abstract-set-theory.FiniteSetTheory.html#488" class="Function Operator">ℙ</a> <a id="4849" href="Ledger.Conway.Specification.Rewards.html#4839" class="Bound">X</a><a id="4850" class="Symbol">)</a> <a id="4852" class="Symbol">→</a> <a id="4854" href="abstract-set-theory.FiniteSetTheory.html#488" class="Function Operator">ℙ</a> <a id="4856" href="Ledger.Conway.Specification.Rewards.html#4839" class="Bound">X</a>
    <a id="4862" href="Ledger.Conway.Specification.Rewards.html#4828" class="Function">joinˢ</a> <a id="4868" class="Symbol">=</a> <a id="4870" href="Axiom.Set.html#7022" class="Function">concatMapˢ</a> <a id="4881" href="Function.Base.html#704" class="Function">id</a>

    <a id="4889" href="Ledger.Conway.Specification.Rewards.html#4889" class="Function">domain&#39;</a> <a id="4897" class="Symbol">:</a> <a id="4899" href="abstract-set-theory.FiniteSetTheory.html#488" class="Function Operator">ℙ</a> <a id="4901" class="Symbol">(</a><a id="4902" href="Ledger.Conway.Specification.Rewards.html#4668" class="Bound">A</a> <a id="4904" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="4906" href="Ledger.Conway.Specification.Rewards.html#4672" class="Bound">B</a><a id="4907" class="Symbol">)</a>
    <a id="4913" href="Ledger.Conway.Specification.Rewards.html#4889" class="Function">domain&#39;</a> <a id="4921" class="Symbol">=</a> <a id="4923" href="Ledger.Conway.Specification.Rewards.html#4828" class="Function">joinˢ</a> <a id="4929" class="Symbol">(</a><a id="4930" href="Class.IsSet.html#959" class="Function">range</a> <a id="4936" class="Symbol">(</a><a id="4937" href="Axiom.Set.Map.html#8706" class="Function">mapWithKey</a> <a id="4948" class="Symbol">(λ</a> <a id="4951" href="Ledger.Conway.Specification.Rewards.html#4951" class="Bound">a</a> <a id="4953" href="Ledger.Conway.Specification.Rewards.html#4953" class="Bound">bc</a> <a id="4956" class="Symbol">→</a> <a id="4958" href="Class.IsSet.html#959" class="Function">range</a> <a id="4964" class="Symbol">(</a><a id="4965" href="Axiom.Set.Map.html#8706" class="Function">mapWithKey</a> <a id="4976" class="Symbol">(λ</a> <a id="4979" href="Ledger.Conway.Specification.Rewards.html#4979" class="Bound">b</a> <a id="4981" href="Ledger.Conway.Specification.Rewards.html#4981" class="Bound">_</a> <a id="4983" class="Symbol">→</a> <a id="4985" class="Symbol">(</a><a id="4986" href="Ledger.Conway.Specification.Rewards.html#4951" class="Bound">a</a> <a id="4988" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="4990" href="Ledger.Conway.Specification.Rewards.html#4979" class="Bound">b</a><a id="4991" class="Symbol">))</a> <a id="4994" href="Ledger.Conway.Specification.Rewards.html#4953" class="Bound">bc</a><a id="4996" class="Symbol">))</a> <a id="4999" href="Ledger.Conway.Specification.Rewards.html#4679" class="Bound">abc</a><a id="5002" class="Symbol">))</a>



<a id="reward"></a><a id="5008" href="Ledger.Conway.Specification.Rewards.html#5008" class="Function">reward</a> <a id="5015" class="Symbol">:</a> <a id="5017" href="Ledger.Conway.Specification.PParams.html#1728" class="Record">PParams</a> <a id="5025" class="Symbol">→</a> <a id="5027" href="Ledger.Conway.Specification.Rewards.html#4534" class="Function">BlocksMade</a> <a id="5038" class="Symbol">→</a> <a id="5040" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a> <a id="5045" class="Symbol">→</a> <a id="5047" class="Symbol">(</a><a id="5048" href="Ledger.Core.Specification.Crypto.html#1338" class="Function">KeyHash</a> <a id="5056" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="5058" href="Ledger.Conway.Specification.Certs.html#1148" class="Record">StakePoolParams</a><a id="5073" class="Symbol">)</a>
  <a id="5077" class="Symbol">→</a> <a id="5079" href="Ledger.Conway.Specification.Rewards.html#3403" class="Function">Stake</a> <a id="5085" class="Symbol">→</a> <a id="5087" href="Ledger.Conway.Specification.Rewards.html#4386" class="Function">Delegations</a> <a id="5099" class="Symbol">→</a> <a id="5101" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a> <a id="5106" class="Symbol">→</a> <a id="5108" class="Symbol">(</a><a id="5109" href="Ledger.Core.Specification.Address.html#260" class="Datatype">Credential</a> <a id="5120" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="5122" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a><a id="5126" class="Symbol">)</a>
<a id="5128" href="Ledger.Conway.Specification.Rewards.html#5008" class="Function">reward</a> <a id="5135" href="Ledger.Conway.Specification.Rewards.html#5135" class="Bound">pp</a> <a id="5138" href="Ledger.Conway.Specification.Rewards.html#5138" class="Bound">blocks</a> <a id="5145" href="Ledger.Conway.Specification.Rewards.html#5145" class="Bound">rewardPot</a> <a id="5155" href="Ledger.Conway.Specification.Rewards.html#5155" class="Bound">poolParams</a> <a id="5166" href="Ledger.Conway.Specification.Rewards.html#5166" class="Bound">stake</a> <a id="5172" href="Ledger.Conway.Specification.Rewards.html#5172" class="Bound">delegs</a> <a id="5179" href="Ledger.Conway.Specification.Rewards.html#5179" class="Bound">total</a> <a id="5185" class="Symbol">=</a> <a id="5187" href="Ledger.Conway.Specification.Rewards.html#5712" class="Function">rewards</a>
  <a id="5197" class="Keyword">where</a>
    <a id="5207" href="Ledger.Conway.Specification.Rewards.html#5207" class="Function">active</a> <a id="5214" class="Symbol">=</a> <a id="5216" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">∑[</a> <a id="5219" href="Ledger.Conway.Specification.Rewards.html#5219" class="Bound">c</a> <a id="5221" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">←</a> <a id="5223" href="Ledger.Conway.Specification.Rewards.html#5166" class="Bound">stake</a> <a id="5229" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">]</a> <a id="5231" href="Ledger.Conway.Specification.Rewards.html#5219" class="Bound">c</a>
    <a id="5237" href="Ledger.Conway.Specification.Rewards.html#5237" class="Function Operator">Σ_/total</a> <a id="5246" class="Symbol">=</a> <a id="5248" class="Symbol">λ</a> <a id="5250" href="Ledger.Conway.Specification.Rewards.html#5250" class="Bound">st</a> <a id="5253" class="Symbol">→</a> <a id="5255" href="Ledger.Prelude.Numeric.UnitInterval.html#2764" class="Function">clamp</a> <a id="5261" class="Symbol">((</a><a id="5263" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">∑[</a> <a id="5266" href="Ledger.Conway.Specification.Rewards.html#5266" class="Bound">c</a> <a id="5268" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">←</a> <a id="5270" href="Ledger.Conway.Specification.Rewards.html#5250" class="Bound">st</a> <a id="5273" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">]</a> <a id="5275" href="Ledger.Conway.Specification.Rewards.html#5266" class="Bound">c</a><a id="5276" class="Symbol">)</a> <a id="5278" href="Ledger.Prelude.html#1945" class="Function Operator">/₀</a> <a id="5281" href="Ledger.Conway.Specification.Rewards.html#5179" class="Bound">total</a><a id="5286" class="Symbol">)</a>
    <a id="5292" href="Ledger.Conway.Specification.Rewards.html#5292" class="Function Operator">Σ_/active</a> <a id="5302" class="Symbol">=</a> <a id="5304" class="Symbol">λ</a> <a id="5306" href="Ledger.Conway.Specification.Rewards.html#5306" class="Bound">st</a> <a id="5309" class="Symbol">→</a> <a id="5311" href="Ledger.Prelude.Numeric.UnitInterval.html#2764" class="Function">clamp</a> <a id="5317" class="Symbol">((</a><a id="5319" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">∑[</a> <a id="5322" href="Ledger.Conway.Specification.Rewards.html#5322" class="Bound">c</a> <a id="5324" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">←</a> <a id="5326" href="Ledger.Conway.Specification.Rewards.html#5306" class="Bound">st</a> <a id="5329" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">]</a> <a id="5331" href="Ledger.Conway.Specification.Rewards.html#5322" class="Bound">c</a><a id="5332" class="Symbol">)</a> <a id="5334" href="Ledger.Prelude.html#1945" class="Function Operator">/₀</a> <a id="5337" href="Ledger.Conway.Specification.Rewards.html#5207" class="Function">active</a><a id="5343" class="Symbol">)</a>
    <a id="5349" href="Ledger.Conway.Specification.Rewards.html#5349" class="Function">N</a> <a id="5351" class="Symbol">=</a> <a id="5353" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">∑[</a> <a id="5356" href="Ledger.Conway.Specification.Rewards.html#5356" class="Bound">m</a> <a id="5358" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">←</a> <a id="5360" href="Ledger.Conway.Specification.Rewards.html#5138" class="Bound">blocks</a> <a id="5367" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">]</a> <a id="5369" href="Ledger.Conway.Specification.Rewards.html#5356" class="Bound">m</a>
    <a id="5375" href="Ledger.Conway.Specification.Rewards.html#5375" class="Function">mkPoolData</a> <a id="5386" class="Symbol">=</a> <a id="5388" class="Symbol">λ</a> <a id="5390" href="Ledger.Conway.Specification.Rewards.html#5390" class="Bound">hk</a> <a id="5393" href="Ledger.Conway.Specification.Rewards.html#5393" class="Bound">p</a> <a id="5395" class="Symbol">→</a>
      <a id="5403" href="Class.Functor.Core.html#272" class="Function">map</a> <a id="5407" class="Symbol">(λ</a> <a id="5410" href="Ledger.Conway.Specification.Rewards.html#5410" class="Bound">n</a> <a id="5412" class="Symbol">→</a> <a id="5414" class="Symbol">(</a><a id="5415" href="Ledger.Conway.Specification.Rewards.html#5410" class="Bound">n</a> <a id="5417" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5419" href="Ledger.Conway.Specification.Rewards.html#5393" class="Bound">p</a> <a id="5421" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5423" href="Ledger.Conway.Specification.Rewards.html#4422" class="Function">poolStake</a> <a id="5433" href="Ledger.Conway.Specification.Rewards.html#5390" class="Bound">hk</a> <a id="5436" href="Ledger.Conway.Specification.Rewards.html#5172" class="Bound">delegs</a> <a id="5443" href="Ledger.Conway.Specification.Rewards.html#5166" class="Bound">stake</a><a id="5448" class="Symbol">))</a> <a id="5451" class="Symbol">(</a><a id="5452" href="Axiom.Set.Map.html#13670" class="Function">lookupᵐ?</a> <a id="5461" href="Ledger.Conway.Specification.Rewards.html#5138" class="Bound">blocks</a> <a id="5468" href="Ledger.Conway.Specification.Rewards.html#5390" class="Bound">hk</a><a id="5470" class="Symbol">)</a>
    <a id="5476" href="Ledger.Conway.Specification.Rewards.html#5476" class="Function">pdata</a> <a id="5482" class="Symbol">=</a> <a id="5484" href="Axiom.Set.Map.html#10313" class="Function">mapMaybeWithKeyᵐ</a> <a id="5501" href="Ledger.Conway.Specification.Rewards.html#5375" class="Function">mkPoolData</a> <a id="5512" href="Ledger.Conway.Specification.Rewards.html#5155" class="Bound">poolParams</a>

    <a id="5528" href="Ledger.Conway.Specification.Rewards.html#5528" class="Function">results</a>  <a id="5537" class="Symbol">:</a> <a id="5539" class="Symbol">(</a><a id="5540" href="Ledger.Core.Specification.Crypto.html#1338" class="Function">KeyHash</a> <a id="5548" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="5550" href="Ledger.Core.Specification.Address.html#260" class="Datatype">Credential</a><a id="5560" class="Symbol">)</a> <a id="5562" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="5564" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a>
    <a id="5573" href="Ledger.Conway.Specification.Rewards.html#5528" class="Function">results</a> <a id="5581" class="Symbol">=</a> <a id="5583" href="Ledger.Conway.Specification.Rewards.html#4560" class="Function">uncurryᵐ</a> <a id="5592" class="Symbol">(</a><a id="5593" href="Axiom.Set.Map.html#6068" class="Function">mapValues</a> <a id="5603" class="Symbol">(λ</a> <a id="5606" class="Symbol">(</a><a id="5607" href="Ledger.Conway.Specification.Rewards.html#5607" class="Bound">n</a> <a id="5609" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5611" href="Ledger.Conway.Specification.Rewards.html#5611" class="Bound">p</a> <a id="5613" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5615" href="Ledger.Conway.Specification.Rewards.html#5615" class="Bound">s</a><a id="5616" class="Symbol">)</a>
      <a id="5624" class="Symbol">→</a> <a id="5626" href="Ledger.Conway.Specification.Rewards.html#3430" class="Function">rewardOnePool</a> <a id="5640" href="Ledger.Conway.Specification.Rewards.html#5135" class="Bound">pp</a> <a id="5643" href="Ledger.Conway.Specification.Rewards.html#5145" class="Bound">rewardPot</a> <a id="5653" href="Ledger.Conway.Specification.Rewards.html#5607" class="Bound">n</a> <a id="5655" href="Ledger.Conway.Specification.Rewards.html#5349" class="Function">N</a> <a id="5657" href="Ledger.Conway.Specification.Rewards.html#5611" class="Bound">p</a> <a id="5659" href="Ledger.Conway.Specification.Rewards.html#5615" class="Bound">s</a> <a id="5661" class="Symbol">(</a><a id="5662" href="Ledger.Conway.Specification.Rewards.html#5237" class="Function Operator">Σ</a> <a id="5664" href="Ledger.Conway.Specification.Rewards.html#5615" class="Bound">s</a> <a id="5666" href="Ledger.Conway.Specification.Rewards.html#5237" class="Function Operator">/total</a><a id="5672" class="Symbol">)</a> <a id="5674" class="Symbol">(</a><a id="5675" href="Ledger.Conway.Specification.Rewards.html#5292" class="Function Operator">Σ</a> <a id="5677" href="Ledger.Conway.Specification.Rewards.html#5615" class="Bound">s</a> <a id="5679" href="Ledger.Conway.Specification.Rewards.html#5292" class="Function Operator">/active</a><a id="5686" class="Symbol">)</a> <a id="5688" href="Ledger.Conway.Specification.Rewards.html#5179" class="Bound">total</a><a id="5693" class="Symbol">)</a>
      <a id="5701" href="Ledger.Conway.Specification.Rewards.html#5476" class="Function">pdata</a><a id="5706" class="Symbol">)</a>
    <a id="5712" href="Ledger.Conway.Specification.Rewards.html#5712" class="Function">rewards</a>  <a id="5721" class="Symbol">=</a> <a id="5723" href="abstract-set-theory.FiniteSetTheory.html#3599" class="Function">aggregateBy</a>
      <a id="5741" class="Symbol">(</a><a id="5742" href="abstract-set-theory.FiniteSetTheory.html#519" class="Function">mapˢ</a> <a id="5747" class="Symbol">(λ</a> <a id="5750" class="Symbol">(</a><a id="5751" href="Ledger.Conway.Specification.Rewards.html#5751" class="Bound">kh</a> <a id="5754" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5756" href="Ledger.Conway.Specification.Rewards.html#5756" class="Bound">cred</a><a id="5760" class="Symbol">)</a> <a id="5762" class="Symbol">→</a> <a id="5764" class="Symbol">(</a><a id="5765" href="Ledger.Conway.Specification.Rewards.html#5751" class="Bound">kh</a> <a id="5768" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5770" href="Ledger.Conway.Specification.Rewards.html#5756" class="Bound">cred</a><a id="5774" class="Symbol">)</a> <a id="5776" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5778" href="Ledger.Conway.Specification.Rewards.html#5756" class="Bound">cred</a><a id="5782" class="Symbol">)</a> <a id="5784" class="Symbol">(</a><a id="5785" href="Class.IsSet.html#916" class="Function">dom</a> <a id="5789" href="Ledger.Conway.Specification.Rewards.html#5528" class="Function">results</a><a id="5796" class="Symbol">))</a>
      <a id="5805" href="Ledger.Conway.Specification.Rewards.html#5528" class="Function">results</a>


<a id="5815" class="Keyword">record</a> <a id="RewardUpdate"></a><a id="5822" href="Ledger.Conway.Specification.Rewards.html#5822" class="Record">RewardUpdate</a> <a id="5835" class="Symbol">:</a> <a id="5837" href="Agda.Primitive.html#388" class="Primitive">Set</a> <a id="5841" class="Keyword">where</a>
  <a id="5849" class="Keyword">field</a>
    <a id="RewardUpdate.Δt"></a><a id="5859" href="Ledger.Conway.Specification.Rewards.html#5859" class="Field">Δt</a> <a id="RewardUpdate.Δr"></a><a id="5862" href="Ledger.Conway.Specification.Rewards.html#5862" class="Field">Δr</a> <a id="RewardUpdate.Δf"></a><a id="5865" href="Ledger.Conway.Specification.Rewards.html#5865" class="Field">Δf</a>          <a id="5877" class="Symbol">:</a> <a id="5879" href="Agda.Builtin.Int.html#245" class="Datatype">ℤ</a>
    <a id="RewardUpdate.rs"></a><a id="5885" href="Ledger.Conway.Specification.Rewards.html#5885" class="Field">rs</a>                <a id="5903" class="Symbol">:</a> <a id="5905" href="Ledger.Core.Specification.Address.html#260" class="Datatype">Credential</a> <a id="5916" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="5918" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a>
    <a id="RewardUpdate.flowConservation"></a><a id="5927" href="Ledger.Conway.Specification.Rewards.html#5927" class="Field">flowConservation</a>  <a id="5945" class="Symbol">:</a> <a id="5947" href="Ledger.Conway.Specification.Rewards.html#5859" class="Field">Δt</a> <a id="5950" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="5952" href="Ledger.Conway.Specification.Rewards.html#5862" class="Field">Δr</a> <a id="5955" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="5957" href="Ledger.Conway.Specification.Rewards.html#5865" class="Field">Δf</a> <a id="5960" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="5962" href="Ledger.Conway.Specification.Rewards.html#76" class="InductiveConstructor">pos</a> <a id="5966" class="Symbol">(</a><a id="5967" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">∑[</a> <a id="5970" href="Ledger.Conway.Specification.Rewards.html#5970" class="Bound">c</a> <a id="5972" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">←</a> <a id="5974" href="Ledger.Conway.Specification.Rewards.html#5885" class="Field">rs</a> <a id="5977" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">]</a> <a id="5979" href="Ledger.Conway.Specification.Rewards.html#5970" class="Bound">c</a><a id="5980" class="Symbol">)</a> <a id="5982" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="5984" class="Number">0</a>
    <a id="RewardUpdate.Δt-nonnegative"></a><a id="5990" href="Ledger.Conway.Specification.Rewards.html#5990" class="Field">Δt-nonnegative</a>    <a id="6008" class="Symbol">:</a> <a id="6010" class="Number">0</a> <a id="6012" href="Class.HasOrder.Core.html#608" class="Field Operator">≤</a> <a id="6014" href="Ledger.Conway.Specification.Rewards.html#5859" class="Field">Δt</a>
    <a id="RewardUpdate.Δf-nonpositive"></a><a id="6021" href="Ledger.Conway.Specification.Rewards.html#6021" class="Field">Δf-nonpositive</a>    <a id="6039" class="Symbol">:</a> <a id="6041" href="Ledger.Conway.Specification.Rewards.html#5865" class="Field">Δf</a> <a id="6044" href="Class.HasOrder.Core.html#608" class="Field Operator">≤</a> <a id="6046" class="Number">0</a>



<a id="6051" class="Keyword">record</a> <a id="Snapshot"></a><a id="6058" href="Ledger.Conway.Specification.Rewards.html#6058" class="Record">Snapshot</a> <a id="6067" class="Symbol">:</a> <a id="6069" href="Agda.Primitive.html#388" class="Primitive">Set</a> <a id="6073" class="Keyword">where</a>
  <a id="6081" class="Keyword">field</a>
    <a id="Snapshot.stake"></a><a id="6091" href="Ledger.Conway.Specification.Rewards.html#6091" class="Field">stake</a>           <a id="6107" class="Symbol">:</a> <a id="6109" href="Ledger.Core.Specification.Address.html#260" class="Datatype">Credential</a> <a id="6120" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="6122" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a>
    <a id="Snapshot.delegations"></a><a id="6131" href="Ledger.Conway.Specification.Rewards.html#6131" class="Field">delegations</a>     <a id="6147" class="Symbol">:</a> <a id="6149" href="Ledger.Core.Specification.Address.html#260" class="Datatype">Credential</a> <a id="6160" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="6162" href="Ledger.Core.Specification.Crypto.html#1338" class="Function">KeyHash</a>
    <a id="Snapshot.poolParameters"></a><a id="6174" href="Ledger.Conway.Specification.Rewards.html#6174" class="Field">poolParameters</a>  <a id="6190" class="Symbol">:</a> <a id="6192" href="Ledger.Core.Specification.Crypto.html#1338" class="Function">KeyHash</a> <a id="6200" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="6202" href="Ledger.Conway.Specification.Certs.html#1148" class="Record">StakePoolParams</a>



<a id="6221" class="Keyword">instance</a>
  <a id="6232" class="Keyword">unquoteDecl</a> <a id="HasCast-Snapshot"></a><a id="6244" href="Ledger.Conway.Specification.Rewards.html#6244" class="Function">HasCast-Snapshot</a> <a id="6261" class="Symbol">=</a>
    <a id="6267" href="stdlib-classes.Class.HasCast.Derive.html#2690" class="Function">derive-HasCast</a> <a id="6282" href="Data.List.Base.html#5205" class="Function Operator">[</a> <a id="6284" class="Symbol">(</a><a id="6285" class="Keyword">quote</a> <a id="6291" href="Ledger.Conway.Specification.Rewards.html#6058" class="Record">Snapshot</a> <a id="6300" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="6302" href="Ledger.Conway.Specification.Rewards.html#6244" class="Function">HasCast-Snapshot</a><a id="6318" class="Symbol">)</a> <a id="6320" href="Data.List.Base.html#5205" class="Function Operator">]</a>


<a id="6324" class="Keyword">private</a>
  <a id="getStakeCred"></a><a id="6334" href="Ledger.Conway.Specification.Rewards.html#6334" class="Function">getStakeCred</a> <a id="6347" class="Symbol">:</a> <a id="6349" href="Ledger.Conway.Specification.Transaction.html#2630" class="Function">TxOut</a> <a id="6355" class="Symbol">→</a> <a id="6357" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="6363" href="Ledger.Core.Specification.Address.html#260" class="Datatype">Credential</a>
  <a id="6376" href="Ledger.Conway.Specification.Rewards.html#6334" class="Function">getStakeCred</a> <a id="6389" class="Symbol">(</a><a id="6390" href="Ledger.Conway.Specification.Rewards.html#6390" class="Bound">a</a> <a id="6392" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="6394" class="Symbol">_</a> <a id="6396" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="6398" class="Symbol">_</a> <a id="6400" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="6402" class="Symbol">_)</a> <a id="6405" class="Symbol">=</a> <a id="6407" href="Ledger.Core.Specification.Address.html#2496" class="Function">stakeCred</a> <a id="6417" href="Ledger.Conway.Specification.Rewards.html#6390" class="Bound">a</a>

<a id="6420" class="Keyword">opaque</a>



  <a id="stakeDistr"></a><a id="6432" href="Ledger.Conway.Specification.Rewards.html#6432" class="Function">stakeDistr</a> <a id="6443" class="Symbol">:</a> <a id="6445" href="Ledger.Conway.Specification.Transaction.html#2698" class="Function">UTxO</a> <a id="6450" class="Symbol">→</a> <a id="6452" href="Ledger.Conway.Specification.Certs.html#3198" class="Record">DState</a> <a id="6459" class="Symbol">→</a> <a id="6461" href="Ledger.Conway.Specification.Certs.html#3808" class="Record">PState</a> <a id="6468" class="Symbol">→</a> <a id="6470" href="Ledger.Conway.Specification.Rewards.html#6058" class="Record">Snapshot</a>
  <a id="6481" href="Ledger.Conway.Specification.Rewards.html#6432" class="Function">stakeDistr</a> <a id="6492" href="Ledger.Conway.Specification.Rewards.html#6492" class="Bound">utxo</a> <a id="6497" href="Ledger.Conway.Specification.Rewards.html#6497" class="Bound">dState</a> <a id="6504" href="Ledger.Conway.Specification.Rewards.html#6504" class="Bound">pState</a> <a id="6511" class="Symbol">=</a>
      <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.Conway.Specification.Rewards.html#6751}{\htmlId{6521}{\htmlClass{Function}{\text{activeStake}}}}\, \\ \,\href{Ledger.Conway.Specification.Certs.html#3296}{\htmlId{6535}{\htmlClass{Function}{\text{stakeDelegs}}}}\, \\ \,\href{Ledger.Conway.Specification.Rewards.html#6580}{\htmlId{6549}{\htmlClass{Function}{\text{poolParams}}}}\, \end{pmatrix}$</a>
    <a id="6566" class="Keyword">where</a>


      <a id="6580" href="Ledger.Conway.Specification.Rewards.html#6580" class="Function">poolParams</a>    <a id="6594" class="Symbol">:</a> <a id="6596" href="Ledger.Core.Specification.Crypto.html#1338" class="Function">KeyHash</a> <a id="6604" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="6606" href="Ledger.Conway.Specification.Certs.html#1148" class="Record">StakePoolParams</a>
      <a id="6628" href="Ledger.Conway.Specification.Rewards.html#6628" class="Function">utxoBalance</a>   <a id="6642" class="Symbol">:</a> <a id="6644" href="Ledger.Core.Specification.Address.html#260" class="Datatype">Credential</a> <a id="6655" class="Symbol">→</a> <a id="6657" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a>
      <a id="6668" href="Ledger.Conway.Specification.Rewards.html#6668" class="Function">activeDelegs</a>  <a id="6682" class="Symbol">:</a> <a id="6684" href="Ledger.Core.Specification.Address.html#260" class="Datatype">Credential</a> <a id="6695" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="6697" href="Ledger.Core.Specification.Crypto.html#1338" class="Function">KeyHash</a>
      <a id="6711" href="Ledger.Conway.Specification.Rewards.html#6711" class="Function">activeRewards</a> <a id="6725" class="Symbol">:</a> <a id="6727" href="Ledger.Core.Specification.Address.html#260" class="Datatype">Credential</a> <a id="6738" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="6740" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a>
      <a id="6751" href="Ledger.Conway.Specification.Rewards.html#6751" class="Function">activeStake</a>   <a id="6765" class="Symbol">:</a> <a id="6767" href="Ledger.Core.Specification.Address.html#260" class="Datatype">Credential</a> <a id="6778" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="6780" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a>


      <a id="6793" href="Ledger.Conway.Specification.Rewards.html#6580" class="Function">poolParams</a>     <a id="6808" class="Symbol">=</a> <a id="6810" href="Ledger.Conway.Specification.Rewards.html#6504" class="Bound">pState</a> <a id="6817" class="Symbol">.</a><a id="6818" href="Ledger.Conway.Specification.Certs.html#3840" class="Field">PState.pools</a>
      <a id="6837" class="Keyword">open</a> <a id="6842" href="Ledger.Conway.Specification.Certs.html#3198" class="Module">DState</a> <a id="6849" href="Ledger.Conway.Specification.Rewards.html#6497" class="Bound">dState</a> <a id="6856" class="Keyword">using</a> <a id="6862" class="Symbol">(</a><a id="6863" href="Ledger.Conway.Specification.Certs.html#3296" class="Field">stakeDelegs</a><a id="6874" class="Symbol">;</a> <a id="6876" href="Ledger.Conway.Specification.Certs.html#3336" class="Field">rewards</a><a id="6883" class="Symbol">)</a>
      <a id="6891" href="Ledger.Conway.Specification.Rewards.html#6628" class="Function">utxoBalance</a>    <a id="6906" class="Symbol">=</a> <a id="6908" class="Symbol">λ</a> <a id="6910" href="Ledger.Conway.Specification.Rewards.html#6910" class="Bound">cred</a> <a id="6915" class="Symbol">→</a> <a id="6917" href="Ledger.Conway.Specification.Utxo.html#2412" class="Function">cbalance</a> <a id="6926" class="Symbol">(</a><a id="6927" href="Ledger.Conway.Specification.Rewards.html#6492" class="Bound">utxo</a> <a id="6932" href="abstract-set-theory.FiniteSetTheory.html#3088" class="Function Operator">∣^&#39;</a> <a id="6936" class="Symbol">λ</a> <a id="6938" href="Ledger.Conway.Specification.Rewards.html#6938" class="Bound">txout</a> <a id="6944" class="Symbol">→</a> <a id="6946" href="Ledger.Conway.Specification.Rewards.html#6334" class="Function">getStakeCred</a> <a id="6959" href="Ledger.Conway.Specification.Rewards.html#6938" class="Bound">txout</a> <a id="6965" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="6967" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="6972" href="Ledger.Conway.Specification.Rewards.html#6910" class="Bound">cred</a><a id="6976" class="Symbol">)</a>
      <a id="6984" href="Ledger.Conway.Specification.Rewards.html#6668" class="Function">activeDelegs</a>   <a id="6999" class="Symbol">=</a> <a id="7001" class="Symbol">(</a><a id="7002" href="Ledger.Conway.Specification.Certs.html#3296" class="Function">stakeDelegs</a> <a id="7014" href="Axiom.Set.Map.html#10678" class="Function Operator">∣</a> <a id="7016" href="Class.IsSet.html#916" class="Function">dom</a> <a id="7020" href="Ledger.Conway.Specification.Certs.html#3336" class="Function">rewards</a><a id="7027" class="Symbol">)</a> <a id="7029" href="Axiom.Set.Map.html#14048" class="Function Operator">∣^</a> <a id="7032" href="Class.IsSet.html#916" class="Function">dom</a> <a id="7036" href="Ledger.Conway.Specification.Rewards.html#6580" class="Function">poolParams</a>
      <a id="7053" href="Ledger.Conway.Specification.Rewards.html#6711" class="Function">activeRewards</a>  <a id="7068" class="Symbol">=</a> <a id="7070" href="Ledger.Conway.Specification.Certs.html#3336" class="Function">rewards</a> <a id="7078" href="Axiom.Set.Map.html#10678" class="Function Operator">∣</a> <a id="7080" href="Class.IsSet.html#916" class="Function">dom</a> <a id="7084" href="Ledger.Conway.Specification.Rewards.html#6668" class="Function">activeDelegs</a>
      <a id="7103" href="Ledger.Conway.Specification.Rewards.html#6751" class="Function">activeStake</a>    <a id="7118" class="Symbol">=</a>
        <a id="7128" href="Axiom.Set.Map.html#8706" class="Function">mapWithKey</a> <a id="7139" class="Symbol">(λ</a> <a id="7142" href="Ledger.Conway.Specification.Rewards.html#7142" class="Bound">c</a> <a id="7144" href="Ledger.Conway.Specification.Rewards.html#7144" class="Bound">rewardBalance</a> <a id="7158" class="Symbol">→</a> <a id="7160" href="Ledger.Conway.Specification.Rewards.html#6628" class="Function">utxoBalance</a> <a id="7172" href="Ledger.Conway.Specification.Rewards.html#7142" class="Bound">c</a> <a id="7174" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="7176" href="Ledger.Conway.Specification.Rewards.html#7144" class="Bound">rewardBalance</a><a id="7189" class="Symbol">)</a> <a id="7191" href="Ledger.Conway.Specification.Rewards.html#6711" class="Function">activeRewards</a>


<a id="7207" class="Keyword">record</a> <a id="Snapshots"></a><a id="7214" href="Ledger.Conway.Specification.Rewards.html#7214" class="Record">Snapshots</a> <a id="7224" class="Symbol">:</a> <a id="7226" href="Agda.Primitive.html#388" class="Primitive">Set</a> <a id="7230" class="Keyword">where</a>
  <a id="7238" class="Keyword">field</a>
    <a id="Snapshots.mark"></a><a id="7248" href="Ledger.Conway.Specification.Rewards.html#7248" class="Field">mark</a> <a id="Snapshots.set"></a><a id="7253" href="Ledger.Conway.Specification.Rewards.html#7253" class="Field">set</a> <a id="Snapshots.go"></a><a id="7257" href="Ledger.Conway.Specification.Rewards.html#7257" class="Field">go</a>  <a id="7261" class="Symbol">:</a> <a id="7263" href="Ledger.Conway.Specification.Rewards.html#6058" class="Record">Snapshot</a>
    <a id="Snapshots.feeSS"></a><a id="7276" href="Ledger.Conway.Specification.Rewards.html#7276" class="Field">feeSS</a>        <a id="7289" class="Symbol">:</a> <a id="7291" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a>



<a id="7299" class="Keyword">instance</a>
  <a id="7310" class="Keyword">unquoteDecl</a> <a id="HasCast-Snapshots"></a><a id="7322" href="Ledger.Conway.Specification.Rewards.html#7322" class="Function">HasCast-Snapshots</a> <a id="7340" class="Symbol">=</a>
    <a id="7346" href="stdlib-classes.Class.HasCast.Derive.html#2690" class="Function">derive-HasCast</a> <a id="7361" href="Data.List.Base.html#5205" class="Function Operator">[</a> <a id="7363" class="Symbol">(</a><a id="7364" class="Keyword">quote</a> <a id="7370" href="Ledger.Conway.Specification.Rewards.html#7214" class="Record">Snapshots</a> <a id="7380" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="7382" href="Ledger.Conway.Specification.Rewards.html#7322" class="Function">HasCast-Snapshots</a><a id="7399" class="Symbol">)</a> <a id="7401" href="Data.List.Base.html#5205" class="Function Operator">]</a>


<a id="7405" class="Keyword">private</a> <a id="7413" class="Keyword">variable</a>
  <a id="7424" href="Ledger.Conway.Specification.Rewards.html#7424" class="Generalizable">lstate</a> <a id="7431" class="Symbol">:</a> <a id="7433" href="Ledger.Conway.Specification.Ledger.html#977" class="Record">LState</a>
  <a id="7442" href="Ledger.Conway.Specification.Rewards.html#7442" class="Generalizable">mark</a> <a id="7447" href="Ledger.Conway.Specification.Rewards.html#7447" class="Generalizable">set</a> <a id="7451" href="Ledger.Conway.Specification.Rewards.html#7451" class="Generalizable">go</a> <a id="7454" class="Symbol">:</a> <a id="7456" href="Ledger.Conway.Specification.Rewards.html#6058" class="Record">Snapshot</a>
  <a id="7467" href="Ledger.Conway.Specification.Rewards.html#7467" class="Generalizable">feeSS</a> <a id="7473" class="Symbol">:</a> <a id="7475" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a>


<a id="7482" class="Keyword">data</a> <a id="_⊢_⇀⦇_,SNAP⦈_"></a><a id="7487" href="Ledger.Conway.Specification.Rewards.html#7487" class="Datatype Operator">_⊢_⇀⦇_,SNAP⦈_</a> <a id="7501" class="Symbol">:</a> <a id="7503" href="Ledger.Conway.Specification.Ledger.html#977" class="Record">LState</a> <a id="7510" class="Symbol">→</a> <a id="7512" href="Ledger.Conway.Specification.Rewards.html#7214" class="Record">Snapshots</a> <a id="7522" class="Symbol">→</a> <a id="7524" href="Agda.Builtin.Unit.html#175" class="Record">⊤</a> <a id="7526" class="Symbol">→</a> <a id="7528" href="Ledger.Conway.Specification.Rewards.html#7214" class="Record">Snapshots</a> <a id="7538" class="Symbol">→</a> <a id="7540" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="7545" class="Keyword">where</a>
  <a id="_⊢_⇀⦇_,SNAP⦈_.SNAP"></a><a id="7553" href="Ledger.Conway.Specification.Rewards.html#7553" class="InductiveConstructor">SNAP</a> <a id="7558" class="Symbol">:</a> <a id="7560" class="Keyword">let</a> <a id="7564" class="Keyword">open</a> <a id="7569" href="Ledger.Conway.Specification.Ledger.html#977" class="Module">LState</a> <a id="7576" href="Ledger.Conway.Specification.Rewards.html#7424" class="Generalizable">lstate</a><a id="7582" class="Symbol">;</a> <a id="7584" class="Keyword">open</a> <a id="7589" href="Ledger.Conway.Specification.Utxo.html#1474" class="Module">UTxOState</a> <a id="7599" href="Ledger.Conway.Specification.Ledger.html#1036" class="Function">utxoSt</a><a id="7605" class="Symbol">;</a> <a id="7607" class="Keyword">open</a> <a id="7612" href="Ledger.Conway.Specification.Certs.html#4359" class="Module">CertState</a> <a id="7622" href="Ledger.Conway.Specification.Ledger.html#1089" class="Function">certState</a>
             <a id="7645" href="Ledger.Conway.Specification.Rewards.html#7645" class="Bound">stake</a> <a id="7651" class="Symbol">=</a> <a id="7653" href="Ledger.Conway.Specification.Rewards.html#6432" class="Function">stakeDistr</a> <a id="7664" href="Ledger.Conway.Specification.Utxo.html#1538" class="Function">utxo</a> <a id="7669" href="Ledger.Conway.Specification.Certs.html#4422" class="Function">dState</a> <a id="7676" href="Ledger.Conway.Specification.Certs.html#4442" class="Function">pState</a>
    <a id="7687" class="Keyword">in</a>
    <a id="7694" href="Ledger.Conway.Specification.Rewards.html#7424" class="Generalizable">lstate</a> <a id="7701" href="Ledger.Conway.Specification.Rewards.html#7487" class="Datatype Operator">⊢</a> <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.Conway.Specification.Rewards.html#7442}{\htmlId{7705}{\htmlClass{Generalizable}{\text{mark}}}}\, \\ \,\href{Ledger.Conway.Specification.Rewards.html#7447}{\htmlId{7712}{\htmlClass{Generalizable}{\text{set}}}}\, \\ \,\href{Ledger.Conway.Specification.Rewards.html#7451}{\htmlId{7718}{\htmlClass{Generalizable}{\text{go}}}}\, \\ \,\href{Ledger.Conway.Specification.Rewards.html#7467}{\htmlId{7723}{\htmlClass{Generalizable}{\text{feeSS}}}}\, \end{pmatrix}$</a> <a id="7731" href="Ledger.Conway.Specification.Rewards.html#7487" class="Datatype Operator">⇀⦇</a> <a id="7734" href="Agda.Builtin.Unit.html#212" class="InductiveConstructor">tt</a> <a id="7737" href="Ledger.Conway.Specification.Rewards.html#7487" class="Datatype Operator">,SNAP⦈</a> <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.Conway.Specification.Rewards.html#7645}{\htmlId{7746}{\htmlClass{Bound}{\text{stake}}}}\, \\ \,\href{Ledger.Conway.Specification.Rewards.html#7442}{\htmlId{7754}{\htmlClass{Generalizable}{\text{mark}}}}\, \\ \,\href{Ledger.Conway.Specification.Rewards.html#7447}{\htmlId{7761}{\htmlClass{Generalizable}{\text{set}}}}\, \\ \,\href{Ledger.Conway.Specification.Utxo.html#1560}{\htmlId{7767}{\htmlClass{Function}{\text{fees}}}}\, \end{pmatrix}$</a>

</pre></body></html>