<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>Ledger.Conway.Specification.Rewards</title><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.css"><link rel="stylesheet" href="Agda.css"><script src="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.js"></script><script src="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/contrib/auto-render.min.js"></script><script src="AgdaKaTeX.js" defer=""></script></head><body><pre class="Agda">
<a id="2" class="Symbol">{-#</a> <a id="6" class="Keyword">OPTIONS</a> <a id="14" class="Pragma">--safe</a> <a id="21" class="Symbol">#-}</a>

<a id="26" class="Keyword">open</a> <a id="31" class="Keyword">import</a> <a id="38" href="Data.Integer.html" class="Module">Data.Integer</a> <a id="51" class="Keyword">using</a> <a id="57" class="Symbol">()</a> <a id="60" class="Keyword">renaming</a> <a id="69" class="Symbol">(</a><a id="70" href="Agda.Builtin.Int.html#263" class="InductiveConstructor">+_</a> <a id="73" class="Symbol">to</a> <a id="76" class="InductiveConstructor">pos</a><a id="79" class="Symbol">)</a>
<a id="81" class="Keyword">open</a> <a id="86" class="Keyword">import</a> <a id="93" href="Data.Rational.html" class="Module">Data.Rational</a> <a id="107" class="Keyword">using</a> <a id="113" class="Symbol">(</a><a id="114" href="Data.Rational.Base.html#1342" class="Record">ℚ</a><a id="115" class="Symbol">;</a> <a id="117" href="Data.Rational.Base.html#7116" class="Function">floor</a><a id="122" class="Symbol">;</a> <a id="124" href="Data.Rational.Base.html#6315" class="Function Operator">_*_</a><a id="127" class="Symbol">;</a> <a id="129" href="Data.Rational.Base.html#6708" class="Function Operator">_÷_</a><a id="132" class="Symbol">;</a> <a id="134" href="Data.Rational.Base.html#3884" class="Function Operator">_/_</a><a id="137" class="Symbol">;</a> <a id="139" href="Data.Rational.Base.html#6405" class="Function Operator">_-_</a><a id="142" class="Symbol">;</a> <a id="144" href="Data.Rational.Base.html#5214" class="Function">&gt;-nonZero</a><a id="153" class="Symbol">;</a> <a id="155" href="Data.Rational.Base.html#6854" class="Function Operator">_⊓_</a><a id="158" class="Symbol">)</a>
                          <a id="186" class="Keyword">renaming</a> <a id="195" class="Symbol">(</a><a id="196" href="Data.Rational.Base.html#6776" class="Function Operator">_⊔_</a> <a id="200" class="Symbol">to</a> <a id="203" class="Function Operator">_⊔ℚ_</a><a id="207" class="Symbol">;</a> <a id="209" href="Data.Rational.Base.html#4498" class="Function">NonZero</a> <a id="217" class="Symbol">to</a> <a id="220" class="Function">NonZeroℚ</a><a id="228" class="Symbol">)</a>
<a id="230" class="Keyword">open</a> <a id="235" class="Keyword">import</a> <a id="242" href="Data.Rational.Literals.html" class="Module">Data.Rational.Literals</a> <a id="265" class="Keyword">using</a> <a id="271" class="Symbol">(</a><a id="272" href="Data.Rational.Literals.html#740" class="Function">number</a><a id="278" class="Symbol">;</a> <a id="280" href="Data.Rational.Literals.html#613" class="Function">fromℤ</a><a id="285" class="Symbol">)</a>
<a id="287" class="Keyword">open</a> <a id="292" class="Keyword">import</a> <a id="299" href="Data.Rational.Properties.html" class="Module">Data.Rational.Properties</a> <a id="324" class="Keyword">using</a> <a id="330" class="Symbol">(</a><a id="331" href="Data.Rational.Properties.html#7612" class="Function">pos⇒nonZero</a><a id="342" class="Symbol">;</a> <a id="344" href="Data.Rational.Properties.html#26724" class="Function">positive⁻¹</a><a id="354" class="Symbol">;</a> <a id="356" href="Data.Rational.Properties.html#36007" class="Function">+-mono-&lt;-≤</a><a id="366" class="Symbol">;</a> <a id="368" href="Data.Rational.Properties.html#11672" class="Function">normalize-pos</a><a id="381" class="Symbol">;</a> <a id="383" href="Data.Rational.Properties.html#57994" class="Function">p≤p⊔q</a><a id="388" class="Symbol">)</a>
<a id="390" class="Keyword">open</a> <a id="395" class="Keyword">import</a> <a id="402" href="Ledger.Conway.Specification.Abstract.html" class="Module">Ledger.Conway.Specification.Abstract</a>
<a id="439" class="Keyword">open</a> <a id="444" class="Keyword">import</a> <a id="451" href="Ledger.Conway.Specification.Transaction.html" class="Module">Ledger.Conway.Specification.Transaction</a>
<a id="491" class="Keyword">open</a> <a id="496" class="Keyword">import</a> <a id="503" href="Ledger.Prelude.Numeric.UnitInterval.html" class="Module">Ledger.Prelude.Numeric.UnitInterval</a>

<a id="540" class="Keyword">open</a> <a id="545" class="Keyword">import</a> <a id="552" href="Agda.Builtin.FromNat.html" class="Module">Agda.Builtin.FromNat</a>
<a id="573" class="Keyword">open</a>        <a id="585" href="Agda.Builtin.FromNat.html#196" class="Module">Number</a> <a id="592" href="Data.Rational.Literals.html#740" class="Function">number</a> <a id="599" class="Keyword">renaming</a> <a id="608" class="Symbol">(</a><a id="609" href="Agda.Builtin.FromNat.html#281" class="Field">fromNat</a> <a id="617" class="Symbol">to</a> <a id="620" class="Field">fromℕ</a><a id="625" class="Symbol">)</a>

<a id="628" class="Keyword">module</a> <a id="635" href="Ledger.Conway.Specification.Rewards.html" class="Module">Ledger.Conway.Specification.Rewards</a>
  <a id="673" class="Symbol">(</a><a id="674" href="Ledger.Conway.Specification.Rewards.html#674" class="Bound">txs</a> <a id="678" class="Symbol">:</a> <a id="680" class="Symbol">_)</a> <a id="683" class="Symbol">(</a><a id="684" class="Keyword">open</a> <a id="689" href="Ledger.Conway.Specification.Transaction.html#1000" class="Module">TransactionStructure</a> <a id="710" href="Ledger.Conway.Specification.Rewards.html#674" class="Bound">txs</a><a id="713" class="Symbol">)</a>
  <a id="717" class="Symbol">(</a><a id="718" href="Ledger.Conway.Specification.Rewards.html#718" class="Bound">abs</a> <a id="722" class="Symbol">:</a> <a id="724" href="Ledger.Conway.Specification.Abstract.html#641" class="Record">AbstractFunctions</a> <a id="742" href="Ledger.Conway.Specification.Rewards.html#674" class="Bound">txs</a><a id="745" class="Symbol">)</a>
  <a id="749" class="Keyword">where</a>

<a id="756" class="Keyword">open</a> <a id="761" class="Keyword">import</a> <a id="768" href="Ledger.Conway.Specification.Certs.html" class="Module">Ledger.Conway.Specification.Certs</a> <a id="802" href="Ledger.Conway.Specification.Transaction.html#2079" class="Function">govStructure</a>
<a id="815" class="Keyword">open</a> <a id="820" class="Keyword">import</a> <a id="827" href="Ledger.Conway.Specification.Ledger.html" class="Module">Ledger.Conway.Specification.Ledger</a> <a id="862" href="Ledger.Conway.Specification.Rewards.html#674" class="Bound">txs</a> <a id="866" href="Ledger.Conway.Specification.Rewards.html#718" class="Bound">abs</a>
<a id="870" class="Keyword">open</a> <a id="875" class="Keyword">import</a> <a id="882" href="Ledger.Prelude.html" class="Module">Ledger.Prelude</a> <a id="897" class="Keyword">hiding</a> <a id="904" class="Symbol">(</a><a id="905" href="Data.Nat.Base.html#7102" class="Function Operator">_/_</a><a id="908" class="Symbol">;</a> <a id="910" href="Agda.Builtin.Nat.html#539" class="Primitive Operator">_*_</a><a id="913" class="Symbol">;</a> <a id="915" href="Interface.HasSubtract.html#209" class="Field Operator">_-_</a><a id="918" class="Symbol">;</a> <a id="920" href="Data.Nat.Base.html#3537" class="Function">&gt;-nonZero</a><a id="929" class="Symbol">;</a> <a id="931" href="Data.Nat.Base.html#5851" class="Function Operator">_⊓_</a><a id="934" class="Symbol">)</a>
<a id="936" class="Keyword">open</a> <a id="941" class="Keyword">import</a> <a id="948" href="Ledger.Conway.Specification.Utxo.html" class="Module">Ledger.Conway.Specification.Utxo</a> <a id="981" href="Ledger.Conway.Specification.Rewards.html#674" class="Bound">txs</a> <a id="985" href="Ledger.Conway.Specification.Rewards.html#718" class="Bound">abs</a>



<a id="nonZero-max-1"></a><a id="992" href="Ledger.Conway.Specification.Rewards.html#992" class="Function">nonZero-max-1</a> <a id="1006" class="Symbol">:</a> <a id="1008" class="Symbol">∀</a> <a id="1010" class="Symbol">(</a><a id="1011" href="Ledger.Conway.Specification.Rewards.html#1011" class="Bound">n</a> <a id="1013" class="Symbol">:</a> <a id="1015" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a><a id="1016" class="Symbol">)</a> <a id="1018" class="Symbol">→</a> <a id="1020" href="Data.Nat.Base.html#3266" class="Record">NonZero</a> <a id="1028" class="Symbol">(</a><a id="1029" class="Number">1</a> <a id="1031" href="Data.Nat.Base.html#5485" class="Function Operator">⊔</a> <a id="1033" href="Ledger.Conway.Specification.Rewards.html#1011" class="Bound">n</a><a id="1034" class="Symbol">)</a>
<a id="1036" href="Ledger.Conway.Specification.Rewards.html#992" class="Function">nonZero-max-1</a> <a id="1050" href="Agda.Builtin.Nat.html#221" class="InductiveConstructor">zero</a> <a id="1055" class="Symbol">=</a> <a id="1057" href="Data.Nat.Base.html#3359" class="Function">nonZero</a>
<a id="1065" href="Ledger.Conway.Specification.Rewards.html#992" class="Function">nonZero-max-1</a> <a id="1079" class="Symbol">(</a><a id="1080" href="Agda.Builtin.Nat.html#234" class="InductiveConstructor">suc</a> <a id="1084" href="Ledger.Conway.Specification.Rewards.html#1084" class="Bound">n</a><a id="1085" class="Symbol">)</a> <a id="1087" class="Symbol">=</a> <a id="1089" href="Data.Nat.Base.html#3359" class="Function">nonZero</a>

<a id="nonZero-1/n"></a><a id="1098" href="Ledger.Conway.Specification.Rewards.html#1098" class="Function">nonZero-1/n</a> <a id="1110" class="Symbol">:</a> <a id="1112" class="Symbol">∀</a> <a id="1114" class="Symbol">(</a><a id="1115" href="Ledger.Conway.Specification.Rewards.html#1115" class="Bound">n</a> <a id="1117" class="Symbol">:</a> <a id="1119" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a><a id="1120" class="Symbol">)</a> <a id="1122" class="Symbol">→</a> <a id="1124" class="Symbol">.{{</a><a id="1127" href="Ledger.Conway.Specification.Rewards.html#1127" class="Bound">_</a> <a id="1129" class="Symbol">:</a> <a id="1131" href="Data.Nat.Base.html#3266" class="Record">NonZero</a> <a id="1139" href="Ledger.Conway.Specification.Rewards.html#1115" class="Bound">n</a><a id="1140" class="Symbol">}}</a> <a id="1143" class="Symbol">→</a> <a id="1145" href="Ledger.Conway.Specification.Rewards.html#220" class="Function">NonZeroℚ</a> <a id="1154" class="Symbol">(</a><a id="1155" class="Number">1</a> <a id="1157" href="Data.Rational.Base.html#3884" class="Function Operator">/</a> <a id="1159" href="Ledger.Conway.Specification.Rewards.html#1115" class="Bound">n</a><a id="1160" class="Symbol">)</a>
<a id="1162" href="Ledger.Conway.Specification.Rewards.html#1098" class="Function">nonZero-1/n</a> <a id="1174" href="Ledger.Conway.Specification.Rewards.html#1174" class="Bound">n</a> <a id="1176" class="Symbol">{{</a><a id="1178" href="Ledger.Conway.Specification.Rewards.html#1178" class="Bound">prf</a><a id="1181" class="Symbol">}}</a> <a id="1184" class="Symbol">=</a>
  <a id="1188" href="Data.Rational.Properties.html#7612" class="Function">pos⇒nonZero</a> <a id="1200" class="Symbol">(</a><a id="1201" class="Number">1</a> <a id="1203" href="Data.Rational.Base.html#3884" class="Function Operator">/</a> <a id="1205" href="Ledger.Conway.Specification.Rewards.html#1174" class="Bound">n</a><a id="1206" class="Symbol">)</a> <a id="1208" class="Symbol">{{</a><a id="1210" href="Data.Rational.Properties.html#11672" class="Function">normalize-pos</a> <a id="1224" class="Number">1</a> <a id="1226" href="Ledger.Conway.Specification.Rewards.html#1174" class="Bound">n</a> <a id="1228" class="Symbol">{{</a><a id="1230" href="Ledger.Conway.Specification.Rewards.html#1178" class="Bound">prf</a><a id="1233" class="Symbol">}}</a> <a id="1236" class="Symbol">{{_}}</a> <a id="1242" class="Symbol">}}</a>

<a id="nonZero-1+max0-x"></a><a id="1246" href="Ledger.Conway.Specification.Rewards.html#1246" class="Function">nonZero-1+max0-x</a> <a id="1263" class="Symbol">:</a> <a id="1265" class="Symbol">∀</a> <a id="1267" class="Symbol">(</a><a id="1268" href="Ledger.Conway.Specification.Rewards.html#1268" class="Bound">x</a> <a id="1270" class="Symbol">:</a> <a id="1272" href="Data.Rational.Base.html#1342" class="Record">ℚ</a><a id="1273" class="Symbol">)</a> <a id="1275" class="Symbol">→</a> <a id="1277" href="Ledger.Conway.Specification.Rewards.html#220" class="Function">NonZeroℚ</a> <a id="1286" class="Symbol">(</a><a id="1287" class="Number">1</a> <a id="1289" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="1291" class="Symbol">(</a><a id="1292" class="Number">0</a> <a id="1294" href="Ledger.Conway.Specification.Rewards.html#203" class="Function Operator">⊔ℚ</a> <a id="1297" href="Ledger.Conway.Specification.Rewards.html#1268" class="Bound">x</a><a id="1298" class="Symbol">))</a>
<a id="1301" href="Ledger.Conway.Specification.Rewards.html#1246" class="Function">nonZero-1+max0-x</a> <a id="1318" href="Ledger.Conway.Specification.Rewards.html#1318" class="Bound">x</a> <a id="1320" class="Symbol">=</a>
  <a id="1324" href="Data.Rational.Base.html#5214" class="Function">&gt;-nonZero</a> <a id="1334" class="Symbol">(</a><a id="1335" href="Data.Rational.Properties.html#36007" class="Function">+-mono-&lt;-≤</a> <a id="1346" class="Symbol">(</a><a id="1347" href="Data.Rational.Properties.html#26724" class="Function">positive⁻¹</a> <a id="1358" class="Number">1</a> <a id="1360" class="Symbol">{{_}})</a> <a id="1367" class="Symbol">(</a><a id="1368" href="Data.Rational.Properties.html#57994" class="Function">p≤p⊔q</a> <a id="1374" class="Number">0</a> <a id="1376" href="Ledger.Conway.Specification.Rewards.html#1318" class="Bound">x</a><a id="1377" class="Symbol">))</a>


<a id="maxPool"></a><a id="1382" href="Ledger.Conway.Specification.Rewards.html#1382" class="Function">maxPool</a> <a id="1390" class="Symbol">:</a> <a id="1392" href="Ledger.Conway.Specification.PParams.html#1728" class="Record">PParams</a> <a id="1400" class="Symbol">→</a> <a id="1402" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a> <a id="1407" class="Symbol">→</a> <a id="1409" href="Ledger.Prelude.Numeric.UnitInterval.html#1776" class="Function">UnitInterval</a> <a id="1422" class="Symbol">→</a> <a id="1424" href="Ledger.Prelude.Numeric.UnitInterval.html#1776" class="Function">UnitInterval</a> <a id="1437" class="Symbol">→</a> <a id="1439" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a>
<a id="1444" href="Ledger.Conway.Specification.Rewards.html#1382" class="Function">maxPool</a> <a id="1452" href="Ledger.Conway.Specification.Rewards.html#1452" class="Bound">pparams</a> <a id="1460" href="Ledger.Conway.Specification.Rewards.html#1460" class="Bound">rewardPot</a> <a id="1470" href="Ledger.Conway.Specification.Rewards.html#1470" class="Bound">stake</a> <a id="1476" href="Ledger.Conway.Specification.Rewards.html#1476" class="Bound">pledge</a> <a id="1483" class="Symbol">=</a> <a id="1485" href="Ledger.Conway.Specification.Rewards.html#2126" class="Function">rewardℕ</a>
  <a id="1495" class="Keyword">where</a>
    <a id="1505" href="Ledger.Conway.Specification.Rewards.html#1505" class="Function">a0</a>    <a id="1511" class="Symbol">=</a> <a id="1513" class="Number">0</a> <a id="1515" href="Ledger.Conway.Specification.Rewards.html#203" class="Function Operator">⊔ℚ</a> <a id="1518" href="Ledger.Conway.Specification.Rewards.html#1452" class="Bound">pparams</a> <a id="1526" class="Symbol">.</a><a id="1527" href="Ledger.Conway.Specification.PParams.html#2929" class="Field">PParams.a0</a>
    <a id="1542" href="Ledger.Conway.Specification.Rewards.html#1542" class="Function">1+a0</a>  <a id="1548" class="Symbol">=</a> <a id="1550" class="Number">1</a> <a id="1552" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="1554" href="Ledger.Conway.Specification.Rewards.html#1505" class="Function">a0</a>
    <a id="1561" href="Ledger.Conway.Specification.Rewards.html#1561" class="Function">nopt</a>  <a id="1567" class="Symbol">=</a> <a id="1569" class="Number">1</a> <a id="1571" href="Data.Nat.Base.html#5485" class="Function Operator">⊔</a> <a id="1573" href="Ledger.Conway.Specification.Rewards.html#1452" class="Bound">pparams</a> <a id="1581" class="Symbol">.</a><a id="1582" href="Ledger.Conway.Specification.PParams.html#2887" class="Field">PParams.nopt</a>


    <a id="1601" class="Keyword">instance</a>
      <a id="1616" href="Ledger.Conway.Specification.Rewards.html#1616" class="Function">nonZero-nopt</a> <a id="1629" class="Symbol">:</a> <a id="1631" href="Data.Nat.Base.html#3266" class="Record">NonZero</a> <a id="1639" href="Ledger.Conway.Specification.Rewards.html#1561" class="Function">nopt</a>
      <a id="1650" href="Ledger.Conway.Specification.Rewards.html#1616" class="Function">nonZero-nopt</a> <a id="1663" class="Symbol">=</a> <a id="1665" href="Ledger.Conway.Specification.Rewards.html#992" class="Function">nonZero-max-1</a> <a id="1679" class="Symbol">(</a><a id="1680" href="Ledger.Conway.Specification.Rewards.html#1452" class="Bound">pparams</a> <a id="1688" class="Symbol">.</a><a id="1689" href="Ledger.Conway.Specification.PParams.html#2887" class="Field">PParams.nopt</a><a id="1701" class="Symbol">)</a>


    <a id="1709" href="Ledger.Conway.Specification.Rewards.html#1709" class="Function">z0</a>       <a id="1718" class="Symbol">=</a> <a id="1720" class="Number">1</a> <a id="1722" href="Data.Rational.Base.html#3884" class="Function Operator">/</a> <a id="1724" href="Ledger.Conway.Specification.Rewards.html#1561" class="Function">nopt</a>
    <a id="1733" href="Ledger.Conway.Specification.Rewards.html#1733" class="Function">stake&#39;</a>   <a id="1742" class="Symbol">=</a> <a id="1744" href="Ledger.Prelude.Numeric.UnitInterval.html#1988" class="Function">fromUnitInterval</a> <a id="1761" href="Ledger.Conway.Specification.Rewards.html#1470" class="Bound">stake</a> <a id="1767" href="Data.Rational.Base.html#6854" class="Function Operator">⊓</a> <a id="1769" href="Ledger.Conway.Specification.Rewards.html#1709" class="Function">z0</a>
    <a id="1776" href="Ledger.Conway.Specification.Rewards.html#1776" class="Function">pledge&#39;</a>  <a id="1785" class="Symbol">=</a> <a id="1787" href="Ledger.Prelude.Numeric.UnitInterval.html#1988" class="Function">fromUnitInterval</a> <a id="1804" href="Ledger.Conway.Specification.Rewards.html#1476" class="Bound">pledge</a> <a id="1811" href="Data.Rational.Base.html#6854" class="Function Operator">⊓</a> <a id="1813" href="Ledger.Conway.Specification.Rewards.html#1709" class="Function">z0</a>


    <a id="1822" class="Keyword">instance</a>
      <a id="1837" href="Ledger.Conway.Specification.Rewards.html#1837" class="Function">nonZeroz0</a> <a id="1847" class="Symbol">:</a> <a id="1849" href="Ledger.Conway.Specification.Rewards.html#220" class="Function">NonZeroℚ</a> <a id="1858" href="Ledger.Conway.Specification.Rewards.html#1709" class="Function">z0</a>
      <a id="1867" href="Ledger.Conway.Specification.Rewards.html#1837" class="Function">nonZeroz0</a> <a id="1877" class="Symbol">=</a> <a id="1879" href="Ledger.Conway.Specification.Rewards.html#1098" class="Function">nonZero-1/n</a> <a id="1891" href="Ledger.Conway.Specification.Rewards.html#1561" class="Function">nopt</a>

      <a id="1903" href="Ledger.Conway.Specification.Rewards.html#1903" class="Function">nonZero-1+a0</a> <a id="1916" class="Symbol">:</a> <a id="1918" href="Ledger.Conway.Specification.Rewards.html#220" class="Function">NonZeroℚ</a> <a id="1927" class="Symbol">(</a><a id="1928" href="Ledger.Conway.Specification.Rewards.html#1542" class="Function">1+a0</a><a id="1932" class="Symbol">)</a>
      <a id="1940" href="Ledger.Conway.Specification.Rewards.html#1903" class="Function">nonZero-1+a0</a> <a id="1953" class="Symbol">=</a> <a id="1955" href="Ledger.Conway.Specification.Rewards.html#1246" class="Function">nonZero-1+max0-x</a> <a id="1972" class="Symbol">(</a><a id="1973" href="Ledger.Conway.Specification.Rewards.html#1452" class="Bound">pparams</a> <a id="1981" class="Symbol">.</a><a id="1982" href="Ledger.Conway.Specification.PParams.html#2929" class="Field">PParams.a0</a><a id="1992" class="Symbol">)</a>


    <a id="2000" href="Ledger.Conway.Specification.Rewards.html#2000" class="Function">rewardℚ</a> <a id="2008" class="Symbol">=</a>
        <a id="2018" href="Ledger.Conway.Specification.Rewards.html#620" class="Function">fromℕ</a> <a id="2024" href="Ledger.Conway.Specification.Rewards.html#1460" class="Bound">rewardPot</a> <a id="2034" href="Data.Rational.Base.html#6708" class="Function Operator">÷</a> <a id="2036" href="Ledger.Conway.Specification.Rewards.html#1542" class="Function">1+a0</a>
        <a id="2049" href="Data.Rational.Base.html#6315" class="Function Operator">*</a> <a id="2051" class="Symbol">(</a><a id="2052" href="Ledger.Conway.Specification.Rewards.html#1733" class="Function">stake&#39;</a> <a id="2059" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="2061" href="Ledger.Conway.Specification.Rewards.html#1776" class="Function">pledge&#39;</a> <a id="2069" href="Data.Rational.Base.html#6315" class="Function Operator">*</a> <a id="2071" href="Ledger.Conway.Specification.Rewards.html#1505" class="Function">a0</a> <a id="2074" href="Data.Rational.Base.html#6315" class="Function Operator">*</a> <a id="2076" class="Symbol">(</a><a id="2077" href="Ledger.Conway.Specification.Rewards.html#1733" class="Function">stake&#39;</a> <a id="2084" href="Data.Rational.Base.html#6405" class="Function Operator">-</a> <a id="2086" href="Ledger.Conway.Specification.Rewards.html#1776" class="Function">pledge&#39;</a> <a id="2094" href="Data.Rational.Base.html#6315" class="Function Operator">*</a> <a id="2096" class="Symbol">(</a><a id="2097" href="Ledger.Conway.Specification.Rewards.html#1709" class="Function">z0</a> <a id="2100" href="Data.Rational.Base.html#6405" class="Function Operator">-</a> <a id="2102" href="Ledger.Conway.Specification.Rewards.html#1733" class="Function">stake&#39;</a><a id="2108" class="Symbol">)</a> <a id="2110" href="Data.Rational.Base.html#6708" class="Function Operator">÷</a> <a id="2112" href="Ledger.Conway.Specification.Rewards.html#1709" class="Function">z0</a><a id="2114" class="Symbol">)</a> <a id="2116" href="Data.Rational.Base.html#6708" class="Function Operator">÷</a> <a id="2118" href="Ledger.Conway.Specification.Rewards.html#1709" class="Function">z0</a><a id="2120" class="Symbol">)</a>
    <a id="2126" href="Ledger.Conway.Specification.Rewards.html#2126" class="Function">rewardℕ</a> <a id="2134" class="Symbol">=</a> <a id="2136" href="Prelude.html#3167" class="Function">posPart</a> <a id="2144" class="Symbol">(</a><a id="2145" href="Data.Rational.Base.html#7116" class="Function">floor</a> <a id="2151" href="Ledger.Conway.Specification.Rewards.html#2000" class="Function">rewardℚ</a><a id="2158" class="Symbol">)</a>


<a id="mkApparentPerformance"></a><a id="2162" href="Ledger.Conway.Specification.Rewards.html#2162" class="Function">mkApparentPerformance</a> <a id="2184" class="Symbol">:</a> <a id="2186" href="Ledger.Prelude.Numeric.UnitInterval.html#1776" class="Function">UnitInterval</a> <a id="2199" class="Symbol">→</a> <a id="2201" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a> <a id="2203" class="Symbol">→</a> <a id="2205" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a> <a id="2207" class="Symbol">→</a> <a id="2209" href="Data.Rational.Base.html#1342" class="Record">ℚ</a>
<a id="2211" href="Ledger.Conway.Specification.Rewards.html#2162" class="Function">mkApparentPerformance</a> <a id="2233" href="Ledger.Conway.Specification.Rewards.html#2233" class="Bound">stake</a> <a id="2239" href="Ledger.Conway.Specification.Rewards.html#2239" class="Bound">poolBlocks</a> <a id="2250" href="Ledger.Conway.Specification.Rewards.html#2250" class="Bound">totalBlocks</a> <a id="2262" class="Symbol">=</a> <a id="2264" href="Ledger.Conway.Specification.Rewards.html#2459" class="Function">ratioBlocks</a> <a id="2276" href="Ledger.Prelude.html#2064" class="Function Operator">÷₀</a> <a id="2279" href="Ledger.Conway.Specification.Rewards.html#2298" class="Function">stake&#39;</a>
  <a id="2288" class="Keyword">where</a>
    <a id="2298" href="Ledger.Conway.Specification.Rewards.html#2298" class="Function">stake&#39;</a> <a id="2305" class="Symbol">=</a> <a id="2307" href="Ledger.Prelude.Numeric.UnitInterval.html#1988" class="Function">fromUnitInterval</a> <a id="2324" href="Ledger.Conway.Specification.Rewards.html#2233" class="Bound">stake</a>


    <a id="2336" class="Keyword">instance</a>
      <a id="2351" href="Ledger.Conway.Specification.Rewards.html#2351" class="Function">nonZero-totalBlocks</a> <a id="2371" class="Symbol">:</a> <a id="2373" href="Data.Nat.Base.html#3266" class="Record">NonZero</a> <a id="2381" class="Symbol">(</a><a id="2382" class="Number">1</a> <a id="2384" href="Data.Nat.Base.html#5485" class="Function Operator">⊔</a> <a id="2386" href="Ledger.Conway.Specification.Rewards.html#2250" class="Bound">totalBlocks</a><a id="2397" class="Symbol">)</a>
      <a id="2405" href="Ledger.Conway.Specification.Rewards.html#2351" class="Function">nonZero-totalBlocks</a> <a id="2425" class="Symbol">=</a> <a id="2427" href="Ledger.Conway.Specification.Rewards.html#992" class="Function">nonZero-max-1</a> <a id="2441" href="Ledger.Conway.Specification.Rewards.html#2250" class="Bound">totalBlocks</a>


    <a id="2459" href="Ledger.Conway.Specification.Rewards.html#2459" class="Function">ratioBlocks</a> <a id="2471" class="Symbol">=</a> <a id="2473" class="Symbol">(</a><a id="2474" href="Ledger.Conway.Specification.Rewards.html#76" class="InductiveConstructor">pos</a> <a id="2478" href="Ledger.Conway.Specification.Rewards.html#2239" class="Bound">poolBlocks</a><a id="2488" class="Symbol">)</a> <a id="2490" href="Data.Rational.Base.html#3884" class="Function Operator">/</a> <a id="2492" class="Symbol">(</a><a id="2493" class="Number">1</a> <a id="2495" href="Data.Nat.Base.html#5485" class="Function Operator">⊔</a> <a id="2497" href="Ledger.Conway.Specification.Rewards.html#2250" class="Bound">totalBlocks</a><a id="2508" class="Symbol">)</a>


<a id="rewardOwners"></a><a id="2512" href="Ledger.Conway.Specification.Rewards.html#2512" class="Function">rewardOwners</a> <a id="2525" class="Symbol">:</a> <a id="2527" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a> <a id="2532" class="Symbol">→</a> <a id="2534" href="Ledger.Conway.Specification.Certs.html#1148" class="Record">PoolParams</a> <a id="2545" class="Symbol">→</a> <a id="2547" href="Ledger.Prelude.Numeric.UnitInterval.html#1776" class="Function">UnitInterval</a> <a id="2560" class="Symbol">→</a> <a id="2562" href="Ledger.Prelude.Numeric.UnitInterval.html#1776" class="Function">UnitInterval</a> <a id="2575" class="Symbol">→</a> <a id="2577" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a>
<a id="2582" href="Ledger.Conway.Specification.Rewards.html#2512" class="Function">rewardOwners</a> <a id="2595" href="Ledger.Conway.Specification.Rewards.html#2595" class="Bound">rewards</a> <a id="2603" href="Ledger.Conway.Specification.Rewards.html#2603" class="Bound">pool</a> <a id="2608" href="Ledger.Conway.Specification.Rewards.html#2608" class="Bound">ownerStake</a> <a id="2619" href="Ledger.Conway.Specification.Rewards.html#2619" class="Bound">stake</a> <a id="2625" class="Symbol">=</a> <a id="2627" href="Class.ToBool.html#389" class="Function Operator">if</a> <a id="2630" href="Ledger.Conway.Specification.Rewards.html#2595" class="Bound">rewards</a> <a id="2638" href="Class.HasOrder.Core.html#608" class="Field Operator">≤</a> <a id="2640" href="Ledger.Conway.Specification.Rewards.html#2853" class="Function">cost</a>
  <a id="2647" href="Class.ToBool.html#389" class="Function Operator">then</a> <a id="2652" href="Ledger.Conway.Specification.Rewards.html#2595" class="Bound">rewards</a>
  <a id="2662" href="Class.ToBool.html#389" class="Function Operator">else</a> <a id="2667" href="Ledger.Conway.Specification.Rewards.html#2853" class="Function">cost</a> <a id="2672" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="2674" href="Prelude.html#3167" class="Function">posPart</a> <a id="2682" class="Symbol">(</a><a id="2683" href="Data.Rational.Base.html#7116" class="Function">floor</a> <a id="2689" class="Symbol">(</a>
        <a id="2699" class="Symbol">(</a><a id="2700" href="Ledger.Conway.Specification.Rewards.html#620" class="Function">fromℕ</a> <a id="2706" href="Ledger.Conway.Specification.Rewards.html#2595" class="Bound">rewards</a> <a id="2714" href="Data.Rational.Base.html#6405" class="Function Operator">-</a> <a id="2716" href="Ledger.Conway.Specification.Rewards.html#620" class="Function">fromℕ</a> <a id="2722" href="Ledger.Conway.Specification.Rewards.html#2853" class="Function">cost</a><a id="2726" class="Symbol">)</a> <a id="2728" href="Data.Rational.Base.html#6315" class="Function Operator">*</a> <a id="2730" class="Symbol">(</a><a id="2731" href="Ledger.Conway.Specification.Rewards.html#2893" class="Function">margin</a> <a id="2738" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="2740" class="Symbol">(</a><a id="2741" class="Number">1</a> <a id="2743" href="Data.Rational.Base.html#6405" class="Function Operator">-</a> <a id="2745" href="Ledger.Conway.Specification.Rewards.html#2893" class="Function">margin</a><a id="2751" class="Symbol">)</a> <a id="2753" href="Data.Rational.Base.html#6315" class="Function Operator">*</a> <a id="2755" href="Ledger.Conway.Specification.Rewards.html#2781" class="Function">ratioStake</a><a id="2765" class="Symbol">)))</a>
  <a id="2771" class="Keyword">where</a>
    <a id="2781" href="Ledger.Conway.Specification.Rewards.html#2781" class="Function">ratioStake</a>  <a id="2793" class="Symbol">=</a> <a id="2795" href="Ledger.Prelude.Numeric.UnitInterval.html#1988" class="Function">fromUnitInterval</a> <a id="2812" href="Ledger.Conway.Specification.Rewards.html#2608" class="Bound">ownerStake</a> <a id="2823" href="Ledger.Prelude.html#2064" class="Function Operator">÷₀</a> <a id="2826" href="Ledger.Prelude.Numeric.UnitInterval.html#1988" class="Function">fromUnitInterval</a> <a id="2843" href="Ledger.Conway.Specification.Rewards.html#2619" class="Bound">stake</a>
    <a id="2853" href="Ledger.Conway.Specification.Rewards.html#2853" class="Function">cost</a>        <a id="2865" class="Symbol">=</a> <a id="2867" href="Ledger.Conway.Specification.Rewards.html#2603" class="Bound">pool</a> <a id="2872" class="Symbol">.</a><a id="2873" href="Ledger.Conway.Specification.Certs.html#1216" class="Field">PoolParams.cost</a>
    <a id="2893" href="Ledger.Conway.Specification.Rewards.html#2893" class="Function">margin</a>      <a id="2905" class="Symbol">=</a> <a id="2907" href="Ledger.Prelude.Numeric.UnitInterval.html#1988" class="Function">fromUnitInterval</a> <a id="2924" class="Symbol">(</a><a id="2925" href="Ledger.Conway.Specification.Rewards.html#2603" class="Bound">pool</a> <a id="2930" class="Symbol">.</a><a id="2931" href="Ledger.Conway.Specification.Certs.html#1243" class="Field">PoolParams.margin</a><a id="2948" class="Symbol">)</a>


<a id="rewardMember"></a><a id="2952" href="Ledger.Conway.Specification.Rewards.html#2952" class="Function">rewardMember</a> <a id="2965" class="Symbol">:</a> <a id="2967" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a> <a id="2972" class="Symbol">→</a> <a id="2974" href="Ledger.Conway.Specification.Certs.html#1148" class="Record">PoolParams</a> <a id="2985" class="Symbol">→</a> <a id="2987" href="Ledger.Prelude.Numeric.UnitInterval.html#1776" class="Function">UnitInterval</a> <a id="3000" class="Symbol">→</a> <a id="3002" href="Ledger.Prelude.Numeric.UnitInterval.html#1776" class="Function">UnitInterval</a> <a id="3015" class="Symbol">→</a> <a id="3017" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a>
<a id="3022" href="Ledger.Conway.Specification.Rewards.html#2952" class="Function">rewardMember</a> <a id="3035" href="Ledger.Conway.Specification.Rewards.html#3035" class="Bound">rewards</a> <a id="3043" href="Ledger.Conway.Specification.Rewards.html#3043" class="Bound">pool</a> <a id="3048" href="Ledger.Conway.Specification.Rewards.html#3048" class="Bound">memberStake</a> <a id="3060" href="Ledger.Conway.Specification.Rewards.html#3060" class="Bound">stake</a> <a id="3066" class="Symbol">=</a> <a id="3068" href="Class.ToBool.html#389" class="Function Operator">if</a> <a id="3071" href="Ledger.Conway.Specification.Rewards.html#3035" class="Bound">rewards</a> <a id="3079" href="Class.HasOrder.Core.html#608" class="Field Operator">≤</a> <a id="3081" href="Ledger.Conway.Specification.Rewards.html#3274" class="Function">cost</a>
  <a id="3088" href="Class.ToBool.html#389" class="Function Operator">then</a> <a id="3093" class="Number">0</a>
  <a id="3097" href="Class.ToBool.html#389" class="Function Operator">else</a> <a id="3102" href="Prelude.html#3167" class="Function">posPart</a> <a id="3110" class="Symbol">(</a><a id="3111" href="Data.Rational.Base.html#7116" class="Function">floor</a> <a id="3117" class="Symbol">(</a>
         <a id="3128" class="Symbol">(</a><a id="3129" href="Ledger.Conway.Specification.Rewards.html#620" class="Function">fromℕ</a> <a id="3135" href="Ledger.Conway.Specification.Rewards.html#3035" class="Bound">rewards</a> <a id="3143" href="Data.Rational.Base.html#6405" class="Function Operator">-</a> <a id="3145" href="Ledger.Conway.Specification.Rewards.html#620" class="Function">fromℕ</a> <a id="3151" href="Ledger.Conway.Specification.Rewards.html#3274" class="Function">cost</a><a id="3155" class="Symbol">)</a> <a id="3157" href="Data.Rational.Base.html#6315" class="Function Operator">*</a> <a id="3159" class="Symbol">((</a><a id="3161" class="Number">1</a> <a id="3163" href="Data.Rational.Base.html#6405" class="Function Operator">-</a> <a id="3165" href="Ledger.Conway.Specification.Rewards.html#3314" class="Function">margin</a><a id="3171" class="Symbol">)</a> <a id="3173" href="Data.Rational.Base.html#6315" class="Function Operator">*</a> <a id="3175" href="Ledger.Conway.Specification.Rewards.html#3201" class="Function">ratioStake</a><a id="3185" class="Symbol">)))</a>
  <a id="3191" class="Keyword">where</a>
    <a id="3201" href="Ledger.Conway.Specification.Rewards.html#3201" class="Function">ratioStake</a>  <a id="3213" class="Symbol">=</a> <a id="3215" href="Ledger.Prelude.Numeric.UnitInterval.html#1988" class="Function">fromUnitInterval</a> <a id="3232" href="Ledger.Conway.Specification.Rewards.html#3048" class="Bound">memberStake</a> <a id="3244" href="Ledger.Prelude.html#2064" class="Function Operator">÷₀</a> <a id="3247" href="Ledger.Prelude.Numeric.UnitInterval.html#1988" class="Function">fromUnitInterval</a> <a id="3264" href="Ledger.Conway.Specification.Rewards.html#3060" class="Bound">stake</a>
    <a id="3274" href="Ledger.Conway.Specification.Rewards.html#3274" class="Function">cost</a>        <a id="3286" class="Symbol">=</a> <a id="3288" href="Ledger.Conway.Specification.Rewards.html#3043" class="Bound">pool</a> <a id="3293" class="Symbol">.</a><a id="3294" href="Ledger.Conway.Specification.Certs.html#1216" class="Field">PoolParams.cost</a>
    <a id="3314" href="Ledger.Conway.Specification.Rewards.html#3314" class="Function">margin</a>      <a id="3326" class="Symbol">=</a> <a id="3328" href="Ledger.Prelude.Numeric.UnitInterval.html#1988" class="Function">fromUnitInterval</a> <a id="3345" class="Symbol">(</a><a id="3346" href="Ledger.Conway.Specification.Rewards.html#3043" class="Bound">pool</a> <a id="3351" class="Symbol">.</a><a id="3352" href="Ledger.Conway.Specification.Certs.html#1243" class="Field">PoolParams.margin</a><a id="3369" class="Symbol">)</a>


<a id="Stake"></a><a id="3373" href="Ledger.Conway.Specification.Rewards.html#3373" class="Function">Stake</a> <a id="3379" class="Symbol">=</a> <a id="3381" href="Ledger.Core.Specification.Address.html#260" class="Datatype">Credential</a> <a id="3392" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="3394" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a>

<a id="rewardOnePool"></a><a id="3400" href="Ledger.Conway.Specification.Rewards.html#3400" class="Function">rewardOnePool</a> <a id="3414" class="Symbol">:</a> <a id="3416" href="Ledger.Conway.Specification.PParams.html#1728" class="Record">PParams</a> <a id="3424" class="Symbol">→</a> <a id="3426" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a> <a id="3431" class="Symbol">→</a> <a id="3433" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a> <a id="3435" class="Symbol">→</a> <a id="3437" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a> <a id="3439" class="Symbol">→</a> <a id="3441" href="Ledger.Conway.Specification.Certs.html#1148" class="Record">PoolParams</a>
  <a id="3454" class="Symbol">→</a> <a id="3456" href="Ledger.Conway.Specification.Rewards.html#3373" class="Function">Stake</a> <a id="3462" class="Symbol">→</a> <a id="3464" href="Ledger.Prelude.Numeric.UnitInterval.html#1776" class="Function">UnitInterval</a> <a id="3477" class="Symbol">→</a> <a id="3479" href="Ledger.Prelude.Numeric.UnitInterval.html#1776" class="Function">UnitInterval</a> <a id="3492" class="Symbol">→</a> <a id="3494" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a> <a id="3499" class="Symbol">→</a> <a id="3501" class="Symbol">(</a><a id="3502" href="Ledger.Core.Specification.Address.html#260" class="Datatype">Credential</a> <a id="3513" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="3515" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a><a id="3519" class="Symbol">)</a>
<a id="3521" href="Ledger.Conway.Specification.Rewards.html#3400" class="Function">rewardOnePool</a> <a id="3535" href="Ledger.Conway.Specification.Rewards.html#3535" class="Bound">pparams</a> <a id="3543" href="Ledger.Conway.Specification.Rewards.html#3543" class="Bound">rewardPot</a> <a id="3553" href="Ledger.Conway.Specification.Rewards.html#3553" class="Bound">n</a> <a id="3555" href="Ledger.Conway.Specification.Rewards.html#3555" class="Bound">N</a> <a id="3557" href="Ledger.Conway.Specification.Rewards.html#3557" class="Bound">pool</a> <a id="3562" href="Ledger.Conway.Specification.Rewards.html#3562" class="Bound">stakeDistr</a> <a id="3573" href="Ledger.Conway.Specification.Rewards.html#3573" class="Bound">σ</a> <a id="3575" href="Ledger.Conway.Specification.Rewards.html#3575" class="Bound">σa</a> <a id="3578" href="Ledger.Conway.Specification.Rewards.html#3578" class="Bound">tot</a> <a id="3582" class="Symbol">=</a> <a id="3584" href="Ledger.Conway.Specification.Rewards.html#4294" class="Function">rewards</a>
  <a id="3594" class="Keyword">where</a>
    <a id="3604" href="Ledger.Conway.Specification.Rewards.html#3604" class="Function">mkRelativeStake</a> <a id="3620" class="Symbol">=</a> <a id="3622" class="Symbol">λ</a> <a id="3624" href="Ledger.Conway.Specification.Rewards.html#3624" class="Bound">coin</a> <a id="3629" class="Symbol">→</a> <a id="3631" href="Ledger.Prelude.Numeric.UnitInterval.html#2764" class="Function">clamp</a> <a id="3637" class="Symbol">(</a><a id="3638" href="Ledger.Conway.Specification.Rewards.html#3624" class="Bound">coin</a> <a id="3643" href="Ledger.Prelude.html#1945" class="Function Operator">/₀</a> <a id="3646" href="Ledger.Conway.Specification.Rewards.html#3578" class="Bound">tot</a><a id="3649" class="Symbol">)</a>
    <a id="3655" href="Ledger.Conway.Specification.Rewards.html#3655" class="Function">owners</a> <a id="3662" class="Symbol">=</a> <a id="3664" href="abstract-set-theory.FiniteSetTheory.html#519" class="Function">mapˢ</a> <a id="3669" href="Ledger.Core.Specification.Address.html#286" class="InductiveConstructor">KeyHashObj</a> <a id="3680" class="Symbol">(</a><a id="3681" href="Ledger.Conway.Specification.Rewards.html#3557" class="Bound">pool</a> <a id="3686" class="Symbol">.</a><a id="3687" href="Ledger.Conway.Specification.Certs.html#1184" class="Field">PoolParams.owners</a><a id="3704" class="Symbol">)</a> 
    <a id="3711" href="Ledger.Conway.Specification.Rewards.html#3711" class="Function">ownerStake</a> <a id="3722" class="Symbol">=</a> <a id="3724" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">∑[</a> <a id="3727" href="Ledger.Conway.Specification.Rewards.html#3727" class="Bound">c</a> <a id="3729" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">←</a> <a id="3731" href="Ledger.Conway.Specification.Rewards.html#3562" class="Bound">stakeDistr</a> <a id="3742" href="Axiom.Set.Map.html#10678" class="Function Operator">∣</a> <a id="3744" href="Ledger.Conway.Specification.Rewards.html#3655" class="Function">owners</a> <a id="3751" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">]</a> <a id="3753" href="Ledger.Conway.Specification.Rewards.html#3727" class="Bound">c</a>
    <a id="3759" href="Ledger.Conway.Specification.Rewards.html#3759" class="Function">pledge</a> <a id="3766" class="Symbol">=</a> <a id="3768" href="Ledger.Conway.Specification.Rewards.html#3557" class="Bound">pool</a> <a id="3773" class="Symbol">.</a><a id="3774" href="Ledger.Conway.Specification.Certs.html#1278" class="Field">PoolParams.pledge</a>
    <a id="3796" href="Ledger.Conway.Specification.Rewards.html#3796" class="Function">maxP</a> <a id="3801" class="Symbol">=</a> <a id="3803" href="Class.ToBool.html#389" class="Function Operator">if</a> <a id="3806" href="Ledger.Conway.Specification.Rewards.html#3759" class="Function">pledge</a> <a id="3813" href="Class.HasOrder.Core.html#608" class="Field Operator">≤</a> <a id="3815" href="Ledger.Conway.Specification.Rewards.html#3711" class="Function">ownerStake</a>
      <a id="3832" href="Class.ToBool.html#389" class="Function Operator">then</a> <a id="3837" href="Ledger.Conway.Specification.Rewards.html#1382" class="Function">maxPool</a> <a id="3845" href="Ledger.Conway.Specification.Rewards.html#3535" class="Bound">pparams</a> <a id="3853" href="Ledger.Conway.Specification.Rewards.html#3543" class="Bound">rewardPot</a> <a id="3863" href="Ledger.Conway.Specification.Rewards.html#3573" class="Bound">σ</a> <a id="3865" class="Symbol">(</a><a id="3866" href="Ledger.Conway.Specification.Rewards.html#3604" class="Function">mkRelativeStake</a> <a id="3882" href="Ledger.Conway.Specification.Rewards.html#3759" class="Function">pledge</a><a id="3888" class="Symbol">)</a>
      <a id="3896" href="Class.ToBool.html#389" class="Function Operator">else</a> <a id="3901" class="Number">0</a>
    <a id="3907" href="Ledger.Conway.Specification.Rewards.html#3907" class="Function">apparentPerformance</a> <a id="3927" class="Symbol">=</a> <a id="3929" href="Ledger.Conway.Specification.Rewards.html#2162" class="Function">mkApparentPerformance</a> <a id="3951" href="Ledger.Conway.Specification.Rewards.html#3575" class="Bound">σa</a> <a id="3954" href="Ledger.Conway.Specification.Rewards.html#3553" class="Bound">n</a> <a id="3956" href="Ledger.Conway.Specification.Rewards.html#3555" class="Bound">N</a>
    <a id="3962" href="Ledger.Conway.Specification.Rewards.html#3962" class="Function">poolReward</a> <a id="3973" class="Symbol">=</a> <a id="3975" href="Prelude.html#3167" class="Function">posPart</a> <a id="3983" class="Symbol">(</a><a id="3984" href="Data.Rational.Base.html#7116" class="Function">floor</a> <a id="3990" class="Symbol">(</a><a id="3991" href="Ledger.Conway.Specification.Rewards.html#3907" class="Function">apparentPerformance</a> <a id="4011" href="Data.Rational.Base.html#6315" class="Function Operator">*</a> <a id="4013" href="Ledger.Conway.Specification.Rewards.html#620" class="Function">fromℕ</a> <a id="4019" href="Ledger.Conway.Specification.Rewards.html#3796" class="Function">maxP</a><a id="4023" class="Symbol">))</a>
    <a id="4030" href="Ledger.Conway.Specification.Rewards.html#4030" class="Function">memberRewards</a> <a id="4044" class="Symbol">=</a>
      <a id="4052" href="Axiom.Set.Map.html#6068" class="Function">mapValues</a> <a id="4062" class="Symbol">(λ</a> <a id="4065" href="Ledger.Conway.Specification.Rewards.html#4065" class="Bound">coin</a> <a id="4070" class="Symbol">→</a> <a id="4072" href="Ledger.Conway.Specification.Rewards.html#2952" class="Function">rewardMember</a> <a id="4085" href="Ledger.Conway.Specification.Rewards.html#3962" class="Function">poolReward</a> <a id="4096" href="Ledger.Conway.Specification.Rewards.html#3557" class="Bound">pool</a> <a id="4101" class="Symbol">(</a><a id="4102" href="Ledger.Conway.Specification.Rewards.html#3604" class="Function">mkRelativeStake</a> <a id="4118" href="Ledger.Conway.Specification.Rewards.html#4065" class="Bound">coin</a><a id="4122" class="Symbol">)</a> <a id="4124" href="Ledger.Conway.Specification.Rewards.html#3573" class="Bound">σ</a><a id="4125" class="Symbol">)</a>
        <a id="4135" class="Symbol">(</a><a id="4136" href="Ledger.Conway.Specification.Rewards.html#3562" class="Bound">stakeDistr</a> <a id="4147" href="Axiom.Set.Map.html#10748" class="Function Operator">∣</a> <a id="4149" href="Ledger.Conway.Specification.Rewards.html#3655" class="Function">owners</a> <a id="4156" href="Axiom.Set.Map.html#10748" class="Function Operator">ᶜ</a><a id="4157" class="Symbol">)</a>
    <a id="4163" href="Ledger.Conway.Specification.Rewards.html#4163" class="Function">ownersRewards</a>  <a id="4178" class="Symbol">=</a>
      <a id="4186" href="Axiom.Set.Map.html#4588" class="Function Operator">❴</a> <a id="4188" href="Ledger.Conway.Specification.Rewards.html#3557" class="Bound">pool</a> <a id="4193" class="Symbol">.</a><a id="4194" href="Ledger.Conway.Specification.Certs.html#1305" class="Field">PoolParams.rewardAccount</a>
      <a id="4225" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="4227" href="Ledger.Conway.Specification.Rewards.html#2512" class="Function">rewardOwners</a> <a id="4240" href="Ledger.Conway.Specification.Rewards.html#3962" class="Function">poolReward</a> <a id="4251" href="Ledger.Conway.Specification.Rewards.html#3557" class="Bound">pool</a> <a id="4256" class="Symbol">(</a><a id="4257" href="Ledger.Conway.Specification.Rewards.html#3604" class="Function">mkRelativeStake</a> <a id="4273" href="Ledger.Conway.Specification.Rewards.html#3711" class="Function">ownerStake</a><a id="4283" class="Symbol">)</a> <a id="4285" href="Ledger.Conway.Specification.Rewards.html#3573" class="Bound">σ</a> <a id="4287" href="Axiom.Set.Map.html#4588" class="Function Operator">❵ᵐ</a>
    <a id="4294" href="Ledger.Conway.Specification.Rewards.html#4294" class="Function">rewards</a> <a id="4302" class="Symbol">=</a> <a id="4304" href="Ledger.Conway.Specification.Rewards.html#4030" class="Function">memberRewards</a> <a id="4318" href="Axiom.Set.Map.Dec.html#1854" class="Function Operator">∪⁺</a> <a id="4321" href="Ledger.Conway.Specification.Rewards.html#4163" class="Function">ownersRewards</a>


<a id="Delegations"></a><a id="4337" href="Ledger.Conway.Specification.Rewards.html#4337" class="Function">Delegations</a> <a id="4349" class="Symbol">=</a> <a id="4351" href="Ledger.Core.Specification.Address.html#260" class="Datatype">Credential</a> <a id="4362" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="4364" href="Ledger.Core.Specification.Crypto.html#1338" class="Function">KeyHash</a>

<a id="poolStake"></a><a id="4373" href="Ledger.Conway.Specification.Rewards.html#4373" class="Function">poolStake</a>  <a id="4384" class="Symbol">:</a> <a id="4386" href="Ledger.Core.Specification.Crypto.html#1338" class="Function">KeyHash</a> <a id="4394" class="Symbol">→</a> <a id="4396" href="Ledger.Conway.Specification.Rewards.html#4337" class="Function">Delegations</a> <a id="4408" class="Symbol">→</a> <a id="4410" href="Ledger.Conway.Specification.Rewards.html#3373" class="Function">Stake</a> <a id="4416" class="Symbol">→</a> <a id="4418" href="Ledger.Conway.Specification.Rewards.html#3373" class="Function">Stake</a>
<a id="4424" href="Ledger.Conway.Specification.Rewards.html#4373" class="Function">poolStake</a> <a id="4434" href="Ledger.Conway.Specification.Rewards.html#4434" class="Bound">hk</a> <a id="4437" href="Ledger.Conway.Specification.Rewards.html#4437" class="Bound">delegs</a> <a id="4444" href="Ledger.Conway.Specification.Rewards.html#4444" class="Bound">stake</a> <a id="4450" class="Symbol">=</a> <a id="4452" href="Ledger.Conway.Specification.Rewards.html#4444" class="Bound">stake</a> <a id="4458" href="Axiom.Set.Map.html#10678" class="Function Operator">∣</a> <a id="4460" href="Class.IsSet.html#916" class="Function">dom</a> <a id="4464" class="Symbol">(</a><a id="4465" href="Ledger.Conway.Specification.Rewards.html#4437" class="Bound">delegs</a> <a id="4472" href="Axiom.Set.Map.html#14048" class="Function Operator">∣^</a> <a id="4475" href="Class.HasSingleton.html#288" class="Field Operator">❴</a> <a id="4477" href="Ledger.Conway.Specification.Rewards.html#4434" class="Bound">hk</a> <a id="4480" href="Class.HasSingleton.html#288" class="Field Operator">❵</a><a id="4481" class="Symbol">)</a>


<a id="BlocksMade"></a><a id="4485" href="Ledger.Conway.Specification.Rewards.html#4485" class="Function">BlocksMade</a> <a id="4496" class="Symbol">=</a> <a id="4498" href="Ledger.Core.Specification.Crypto.html#1338" class="Function">KeyHash</a> <a id="4506" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="4508" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a>

<a id="uncurryᵐ"></a><a id="4511" href="Ledger.Conway.Specification.Rewards.html#4511" class="Function">uncurryᵐ</a> <a id="4520" class="Symbol">:</a>


  <a id="4526" class="Symbol">∀</a> <a id="4528" class="Symbol">{</a><a id="4529" href="Ledger.Conway.Specification.Rewards.html#4529" class="Bound">A</a> <a id="4531" href="Ledger.Conway.Specification.Rewards.html#4531" class="Bound">B</a> <a id="4533" href="Ledger.Conway.Specification.Rewards.html#4533" class="Bound">C</a> <a id="4535" class="Symbol">:</a> <a id="4537" href="Agda.Primitive.html#388" class="Primitive">Type</a><a id="4541" class="Symbol">}</a> <a id="4543" class="Symbol">⦃</a> <a id="4545" href="Ledger.Conway.Specification.Rewards.html#4545" class="Bound">_</a> <a id="4547" class="Symbol">:</a> <a id="4549" href="Class.DecEq.Core.html#117" class="Record">DecEq</a> <a id="4555" href="Ledger.Conway.Specification.Rewards.html#4529" class="Bound">A</a> <a id="4557" class="Symbol">⦄</a> <a id="4559" class="Symbol">⦃</a> <a id="4561" href="Ledger.Conway.Specification.Rewards.html#4561" class="Bound">_</a> <a id="4563" class="Symbol">:</a> <a id="4565" href="Class.DecEq.Core.html#117" class="Record">DecEq</a> <a id="4571" href="Ledger.Conway.Specification.Rewards.html#4531" class="Bound">B</a> <a id="4573" class="Symbol">⦄</a> <a id="4575" class="Symbol">→</a>


  <a id="4581" href="Ledger.Conway.Specification.Rewards.html#4529" class="Bound">A</a> <a id="4583" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="4585" class="Symbol">(</a><a id="4586" href="Ledger.Conway.Specification.Rewards.html#4531" class="Bound">B</a> <a id="4588" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="4590" href="Ledger.Conway.Specification.Rewards.html#4533" class="Bound">C</a><a id="4591" class="Symbol">)</a> <a id="4593" class="Symbol">→</a> <a id="4595" class="Symbol">(</a><a id="4596" href="Ledger.Conway.Specification.Rewards.html#4529" class="Bound">A</a> <a id="4598" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="4600" href="Ledger.Conway.Specification.Rewards.html#4531" class="Bound">B</a><a id="4601" class="Symbol">)</a> <a id="4603" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="4605" href="Ledger.Conway.Specification.Rewards.html#4533" class="Bound">C</a>


<a id="4609" href="Ledger.Conway.Specification.Rewards.html#4511" class="Function">uncurryᵐ</a> <a id="4618" class="Symbol">{</a><a id="4619" href="Ledger.Conway.Specification.Rewards.html#4619" class="Bound">A</a><a id="4620" class="Symbol">}</a> <a id="4622" class="Symbol">{</a><a id="4623" href="Ledger.Conway.Specification.Rewards.html#4623" class="Bound">B</a><a id="4624" class="Symbol">}</a> <a id="4626" class="Symbol">{</a><a id="4627" href="Ledger.Conway.Specification.Rewards.html#4627" class="Bound">C</a><a id="4628" class="Symbol">}</a> <a id="4630" href="Ledger.Conway.Specification.Rewards.html#4630" class="Bound">abc</a> <a id="4634" class="Symbol">=</a> <a id="4636" href="Axiom.Set.Map.html#10460" class="Function">mapFromPartialFun</a> <a id="4654" href="Ledger.Conway.Specification.Rewards.html#4682" class="Function">lookup&#39;</a> <a id="4662" href="Ledger.Conway.Specification.Rewards.html#4840" class="Function">domain&#39;</a>
  <a id="4672" class="Keyword">where</a>
    <a id="4682" href="Ledger.Conway.Specification.Rewards.html#4682" class="Function">lookup&#39;</a> <a id="4690" class="Symbol">:</a> <a id="4692" class="Symbol">(</a><a id="4693" href="Ledger.Conway.Specification.Rewards.html#4619" class="Bound">A</a> <a id="4695" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="4697" href="Ledger.Conway.Specification.Rewards.html#4623" class="Bound">B</a><a id="4698" class="Symbol">)</a> <a id="4700" class="Symbol">→</a> <a id="4702" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="4708" href="Ledger.Conway.Specification.Rewards.html#4627" class="Bound">C</a>
    <a id="4714" href="Ledger.Conway.Specification.Rewards.html#4682" class="Function">lookup&#39;</a> <a id="4722" class="Symbol">(</a><a id="4723" href="Ledger.Conway.Specification.Rewards.html#4723" class="Bound">a</a> <a id="4725" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="4727" href="Ledger.Conway.Specification.Rewards.html#4727" class="Bound">b</a><a id="4728" class="Symbol">)</a> <a id="4730" class="Symbol">=</a> <a id="4732" href="Axiom.Set.Map.html#13670" class="Function">lookupᵐ?</a> <a id="4741" href="Ledger.Conway.Specification.Rewards.html#4630" class="Bound">abc</a> <a id="4745" href="Ledger.Conway.Specification.Rewards.html#4723" class="Bound">a</a> <a id="4747" href="Class.Monad.Core.html#299" class="Field Operator">&gt;&gt;=</a> <a id="4751" class="Symbol">(λ</a> <a id="4754" href="Ledger.Conway.Specification.Rewards.html#4754" class="Bound">bc</a> <a id="4757" class="Symbol">→</a> <a id="4759" href="Axiom.Set.Map.html#13670" class="Function">lookupᵐ?</a> <a id="4768" href="Ledger.Conway.Specification.Rewards.html#4754" class="Bound">bc</a> <a id="4771" href="Ledger.Conway.Specification.Rewards.html#4727" class="Bound">b</a><a id="4772" class="Symbol">)</a>

    <a id="4779" href="Ledger.Conway.Specification.Rewards.html#4779" class="Function">joinˢ</a> <a id="4785" class="Symbol">:</a> <a id="4787" class="Symbol">∀</a> <a id="4789" class="Symbol">{</a><a id="4790" href="Ledger.Conway.Specification.Rewards.html#4790" class="Bound">X</a><a id="4791" class="Symbol">}</a> <a id="4793" class="Symbol">→</a> <a id="4795" href="abstract-set-theory.FiniteSetTheory.html#488" class="Function Operator">ℙ</a> <a id="4797" class="Symbol">(</a><a id="4798" href="abstract-set-theory.FiniteSetTheory.html#488" class="Function Operator">ℙ</a> <a id="4800" href="Ledger.Conway.Specification.Rewards.html#4790" class="Bound">X</a><a id="4801" class="Symbol">)</a> <a id="4803" class="Symbol">→</a> <a id="4805" href="abstract-set-theory.FiniteSetTheory.html#488" class="Function Operator">ℙ</a> <a id="4807" href="Ledger.Conway.Specification.Rewards.html#4790" class="Bound">X</a>
    <a id="4813" href="Ledger.Conway.Specification.Rewards.html#4779" class="Function">joinˢ</a> <a id="4819" class="Symbol">=</a> <a id="4821" href="Axiom.Set.html#7022" class="Function">concatMapˢ</a> <a id="4832" href="Function.Base.html#704" class="Function">id</a>

    <a id="4840" href="Ledger.Conway.Specification.Rewards.html#4840" class="Function">domain&#39;</a> <a id="4848" class="Symbol">:</a> <a id="4850" href="abstract-set-theory.FiniteSetTheory.html#488" class="Function Operator">ℙ</a> <a id="4852" class="Symbol">(</a><a id="4853" href="Ledger.Conway.Specification.Rewards.html#4619" class="Bound">A</a> <a id="4855" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="4857" href="Ledger.Conway.Specification.Rewards.html#4623" class="Bound">B</a><a id="4858" class="Symbol">)</a>
    <a id="4864" href="Ledger.Conway.Specification.Rewards.html#4840" class="Function">domain&#39;</a> <a id="4872" class="Symbol">=</a> <a id="4874" href="Ledger.Conway.Specification.Rewards.html#4779" class="Function">joinˢ</a> <a id="4880" class="Symbol">(</a><a id="4881" href="Class.IsSet.html#959" class="Function">range</a> <a id="4887" class="Symbol">(</a><a id="4888" href="Axiom.Set.Map.html#8706" class="Function">mapWithKey</a> <a id="4899" class="Symbol">(λ</a> <a id="4902" href="Ledger.Conway.Specification.Rewards.html#4902" class="Bound">a</a> <a id="4904" href="Ledger.Conway.Specification.Rewards.html#4904" class="Bound">bc</a> <a id="4907" class="Symbol">→</a> <a id="4909" href="Class.IsSet.html#959" class="Function">range</a> <a id="4915" class="Symbol">(</a><a id="4916" href="Axiom.Set.Map.html#8706" class="Function">mapWithKey</a> <a id="4927" class="Symbol">(λ</a> <a id="4930" href="Ledger.Conway.Specification.Rewards.html#4930" class="Bound">b</a> <a id="4932" href="Ledger.Conway.Specification.Rewards.html#4932" class="Bound">_</a> <a id="4934" class="Symbol">→</a> <a id="4936" class="Symbol">(</a><a id="4937" href="Ledger.Conway.Specification.Rewards.html#4902" class="Bound">a</a> <a id="4939" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="4941" href="Ledger.Conway.Specification.Rewards.html#4930" class="Bound">b</a><a id="4942" class="Symbol">))</a> <a id="4945" href="Ledger.Conway.Specification.Rewards.html#4904" class="Bound">bc</a><a id="4947" class="Symbol">))</a> <a id="4950" href="Ledger.Conway.Specification.Rewards.html#4630" class="Bound">abc</a><a id="4953" class="Symbol">))</a>



<a id="reward"></a><a id="4959" href="Ledger.Conway.Specification.Rewards.html#4959" class="Function">reward</a> <a id="4966" class="Symbol">:</a> <a id="4968" href="Ledger.Conway.Specification.PParams.html#1728" class="Record">PParams</a> <a id="4976" class="Symbol">→</a> <a id="4978" href="Ledger.Conway.Specification.Rewards.html#4485" class="Function">BlocksMade</a> <a id="4989" class="Symbol">→</a> <a id="4991" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a> <a id="4996" class="Symbol">→</a> <a id="4998" class="Symbol">(</a><a id="4999" href="Ledger.Core.Specification.Crypto.html#1338" class="Function">KeyHash</a> <a id="5007" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="5009" href="Ledger.Conway.Specification.Certs.html#1148" class="Record">PoolParams</a><a id="5019" class="Symbol">)</a>
  <a id="5023" class="Symbol">→</a> <a id="5025" href="Ledger.Conway.Specification.Rewards.html#3373" class="Function">Stake</a> <a id="5031" class="Symbol">→</a> <a id="5033" href="Ledger.Conway.Specification.Rewards.html#4337" class="Function">Delegations</a> <a id="5045" class="Symbol">→</a> <a id="5047" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a> <a id="5052" class="Symbol">→</a> <a id="5054" class="Symbol">(</a><a id="5055" href="Ledger.Core.Specification.Address.html#260" class="Datatype">Credential</a> <a id="5066" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="5068" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a><a id="5072" class="Symbol">)</a>
<a id="5074" href="Ledger.Conway.Specification.Rewards.html#4959" class="Function">reward</a> <a id="5081" href="Ledger.Conway.Specification.Rewards.html#5081" class="Bound">pp</a> <a id="5084" href="Ledger.Conway.Specification.Rewards.html#5084" class="Bound">blocks</a> <a id="5091" href="Ledger.Conway.Specification.Rewards.html#5091" class="Bound">rewardPot</a> <a id="5101" href="Ledger.Conway.Specification.Rewards.html#5101" class="Bound">poolParams</a> <a id="5112" href="Ledger.Conway.Specification.Rewards.html#5112" class="Bound">stake</a> <a id="5118" href="Ledger.Conway.Specification.Rewards.html#5118" class="Bound">delegs</a> <a id="5125" href="Ledger.Conway.Specification.Rewards.html#5125" class="Bound">total</a> <a id="5131" class="Symbol">=</a> <a id="5133" href="Ledger.Conway.Specification.Rewards.html#5658" class="Function">rewards</a>
  <a id="5143" class="Keyword">where</a>
    <a id="5153" href="Ledger.Conway.Specification.Rewards.html#5153" class="Function">active</a> <a id="5160" class="Symbol">=</a> <a id="5162" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">∑[</a> <a id="5165" href="Ledger.Conway.Specification.Rewards.html#5165" class="Bound">c</a> <a id="5167" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">←</a> <a id="5169" href="Ledger.Conway.Specification.Rewards.html#5112" class="Bound">stake</a> <a id="5175" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">]</a> <a id="5177" href="Ledger.Conway.Specification.Rewards.html#5165" class="Bound">c</a>
    <a id="5183" href="Ledger.Conway.Specification.Rewards.html#5183" class="Function Operator">Σ_/total</a> <a id="5192" class="Symbol">=</a> <a id="5194" class="Symbol">λ</a> <a id="5196" href="Ledger.Conway.Specification.Rewards.html#5196" class="Bound">st</a> <a id="5199" class="Symbol">→</a> <a id="5201" href="Ledger.Prelude.Numeric.UnitInterval.html#2764" class="Function">clamp</a> <a id="5207" class="Symbol">((</a><a id="5209" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">∑[</a> <a id="5212" href="Ledger.Conway.Specification.Rewards.html#5212" class="Bound">c</a> <a id="5214" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">←</a> <a id="5216" href="Ledger.Conway.Specification.Rewards.html#5196" class="Bound">st</a> <a id="5219" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">]</a> <a id="5221" href="Ledger.Conway.Specification.Rewards.html#5212" class="Bound">c</a><a id="5222" class="Symbol">)</a> <a id="5224" href="Ledger.Prelude.html#1945" class="Function Operator">/₀</a> <a id="5227" href="Ledger.Conway.Specification.Rewards.html#5125" class="Bound">total</a><a id="5232" class="Symbol">)</a>
    <a id="5238" href="Ledger.Conway.Specification.Rewards.html#5238" class="Function Operator">Σ_/active</a> <a id="5248" class="Symbol">=</a> <a id="5250" class="Symbol">λ</a> <a id="5252" href="Ledger.Conway.Specification.Rewards.html#5252" class="Bound">st</a> <a id="5255" class="Symbol">→</a> <a id="5257" href="Ledger.Prelude.Numeric.UnitInterval.html#2764" class="Function">clamp</a> <a id="5263" class="Symbol">((</a><a id="5265" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">∑[</a> <a id="5268" href="Ledger.Conway.Specification.Rewards.html#5268" class="Bound">c</a> <a id="5270" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">←</a> <a id="5272" href="Ledger.Conway.Specification.Rewards.html#5252" class="Bound">st</a> <a id="5275" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">]</a> <a id="5277" href="Ledger.Conway.Specification.Rewards.html#5268" class="Bound">c</a><a id="5278" class="Symbol">)</a> <a id="5280" href="Ledger.Prelude.html#1945" class="Function Operator">/₀</a> <a id="5283" href="Ledger.Conway.Specification.Rewards.html#5153" class="Function">active</a><a id="5289" class="Symbol">)</a>
    <a id="5295" href="Ledger.Conway.Specification.Rewards.html#5295" class="Function">N</a> <a id="5297" class="Symbol">=</a> <a id="5299" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">∑[</a> <a id="5302" href="Ledger.Conway.Specification.Rewards.html#5302" class="Bound">m</a> <a id="5304" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">←</a> <a id="5306" href="Ledger.Conway.Specification.Rewards.html#5084" class="Bound">blocks</a> <a id="5313" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">]</a> <a id="5315" href="Ledger.Conway.Specification.Rewards.html#5302" class="Bound">m</a>
    <a id="5321" href="Ledger.Conway.Specification.Rewards.html#5321" class="Function">mkPoolData</a> <a id="5332" class="Symbol">=</a> <a id="5334" class="Symbol">λ</a> <a id="5336" href="Ledger.Conway.Specification.Rewards.html#5336" class="Bound">hk</a> <a id="5339" href="Ledger.Conway.Specification.Rewards.html#5339" class="Bound">p</a> <a id="5341" class="Symbol">→</a>
      <a id="5349" href="Class.Functor.Core.html#272" class="Function">map</a> <a id="5353" class="Symbol">(λ</a> <a id="5356" href="Ledger.Conway.Specification.Rewards.html#5356" class="Bound">n</a> <a id="5358" class="Symbol">→</a> <a id="5360" class="Symbol">(</a><a id="5361" href="Ledger.Conway.Specification.Rewards.html#5356" class="Bound">n</a> <a id="5363" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5365" href="Ledger.Conway.Specification.Rewards.html#5339" class="Bound">p</a> <a id="5367" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5369" href="Ledger.Conway.Specification.Rewards.html#4373" class="Function">poolStake</a> <a id="5379" href="Ledger.Conway.Specification.Rewards.html#5336" class="Bound">hk</a> <a id="5382" href="Ledger.Conway.Specification.Rewards.html#5118" class="Bound">delegs</a> <a id="5389" href="Ledger.Conway.Specification.Rewards.html#5112" class="Bound">stake</a><a id="5394" class="Symbol">))</a> <a id="5397" class="Symbol">(</a><a id="5398" href="Axiom.Set.Map.html#13670" class="Function">lookupᵐ?</a> <a id="5407" href="Ledger.Conway.Specification.Rewards.html#5084" class="Bound">blocks</a> <a id="5414" href="Ledger.Conway.Specification.Rewards.html#5336" class="Bound">hk</a><a id="5416" class="Symbol">)</a>
    <a id="5422" href="Ledger.Conway.Specification.Rewards.html#5422" class="Function">pdata</a> <a id="5428" class="Symbol">=</a> <a id="5430" href="Axiom.Set.Map.html#10313" class="Function">mapMaybeWithKeyᵐ</a> <a id="5447" href="Ledger.Conway.Specification.Rewards.html#5321" class="Function">mkPoolData</a> <a id="5458" href="Ledger.Conway.Specification.Rewards.html#5101" class="Bound">poolParams</a>

    <a id="5474" href="Ledger.Conway.Specification.Rewards.html#5474" class="Function">results</a>  <a id="5483" class="Symbol">:</a> <a id="5485" class="Symbol">(</a><a id="5486" href="Ledger.Core.Specification.Crypto.html#1338" class="Function">KeyHash</a> <a id="5494" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="5496" href="Ledger.Core.Specification.Address.html#260" class="Datatype">Credential</a><a id="5506" class="Symbol">)</a> <a id="5508" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="5510" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a>
    <a id="5519" href="Ledger.Conway.Specification.Rewards.html#5474" class="Function">results</a> <a id="5527" class="Symbol">=</a> <a id="5529" href="Ledger.Conway.Specification.Rewards.html#4511" class="Function">uncurryᵐ</a> <a id="5538" class="Symbol">(</a><a id="5539" href="Axiom.Set.Map.html#6068" class="Function">mapValues</a> <a id="5549" class="Symbol">(λ</a> <a id="5552" class="Symbol">(</a><a id="5553" href="Ledger.Conway.Specification.Rewards.html#5553" class="Bound">n</a> <a id="5555" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5557" href="Ledger.Conway.Specification.Rewards.html#5557" class="Bound">p</a> <a id="5559" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5561" href="Ledger.Conway.Specification.Rewards.html#5561" class="Bound">s</a><a id="5562" class="Symbol">)</a>
      <a id="5570" class="Symbol">→</a> <a id="5572" href="Ledger.Conway.Specification.Rewards.html#3400" class="Function">rewardOnePool</a> <a id="5586" href="Ledger.Conway.Specification.Rewards.html#5081" class="Bound">pp</a> <a id="5589" href="Ledger.Conway.Specification.Rewards.html#5091" class="Bound">rewardPot</a> <a id="5599" href="Ledger.Conway.Specification.Rewards.html#5553" class="Bound">n</a> <a id="5601" href="Ledger.Conway.Specification.Rewards.html#5295" class="Function">N</a> <a id="5603" href="Ledger.Conway.Specification.Rewards.html#5557" class="Bound">p</a> <a id="5605" href="Ledger.Conway.Specification.Rewards.html#5561" class="Bound">s</a> <a id="5607" class="Symbol">(</a><a id="5608" href="Ledger.Conway.Specification.Rewards.html#5183" class="Function Operator">Σ</a> <a id="5610" href="Ledger.Conway.Specification.Rewards.html#5561" class="Bound">s</a> <a id="5612" href="Ledger.Conway.Specification.Rewards.html#5183" class="Function Operator">/total</a><a id="5618" class="Symbol">)</a> <a id="5620" class="Symbol">(</a><a id="5621" href="Ledger.Conway.Specification.Rewards.html#5238" class="Function Operator">Σ</a> <a id="5623" href="Ledger.Conway.Specification.Rewards.html#5561" class="Bound">s</a> <a id="5625" href="Ledger.Conway.Specification.Rewards.html#5238" class="Function Operator">/active</a><a id="5632" class="Symbol">)</a> <a id="5634" href="Ledger.Conway.Specification.Rewards.html#5125" class="Bound">total</a><a id="5639" class="Symbol">)</a>
      <a id="5647" href="Ledger.Conway.Specification.Rewards.html#5422" class="Function">pdata</a><a id="5652" class="Symbol">)</a>
    <a id="5658" href="Ledger.Conway.Specification.Rewards.html#5658" class="Function">rewards</a>  <a id="5667" class="Symbol">=</a> <a id="5669" href="abstract-set-theory.FiniteSetTheory.html#3599" class="Function">aggregateBy</a>
      <a id="5687" class="Symbol">(</a><a id="5688" href="abstract-set-theory.FiniteSetTheory.html#519" class="Function">mapˢ</a> <a id="5693" class="Symbol">(λ</a> <a id="5696" class="Symbol">(</a><a id="5697" href="Ledger.Conway.Specification.Rewards.html#5697" class="Bound">kh</a> <a id="5700" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5702" href="Ledger.Conway.Specification.Rewards.html#5702" class="Bound">cred</a><a id="5706" class="Symbol">)</a> <a id="5708" class="Symbol">→</a> <a id="5710" class="Symbol">(</a><a id="5711" href="Ledger.Conway.Specification.Rewards.html#5697" class="Bound">kh</a> <a id="5714" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5716" href="Ledger.Conway.Specification.Rewards.html#5702" class="Bound">cred</a><a id="5720" class="Symbol">)</a> <a id="5722" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5724" href="Ledger.Conway.Specification.Rewards.html#5702" class="Bound">cred</a><a id="5728" class="Symbol">)</a> <a id="5730" class="Symbol">(</a><a id="5731" href="Class.IsSet.html#916" class="Function">dom</a> <a id="5735" href="Ledger.Conway.Specification.Rewards.html#5474" class="Function">results</a><a id="5742" class="Symbol">))</a>
      <a id="5751" href="Ledger.Conway.Specification.Rewards.html#5474" class="Function">results</a>


<a id="5761" class="Keyword">record</a> <a id="RewardUpdate"></a><a id="5768" href="Ledger.Conway.Specification.Rewards.html#5768" class="Record">RewardUpdate</a> <a id="5781" class="Symbol">:</a> <a id="5783" href="Agda.Primitive.html#388" class="Primitive">Set</a> <a id="5787" class="Keyword">where</a>
  <a id="5795" class="Keyword">field</a>
    <a id="RewardUpdate.Δt"></a><a id="5805" href="Ledger.Conway.Specification.Rewards.html#5805" class="Field">Δt</a> <a id="RewardUpdate.Δr"></a><a id="5808" href="Ledger.Conway.Specification.Rewards.html#5808" class="Field">Δr</a> <a id="RewardUpdate.Δf"></a><a id="5811" href="Ledger.Conway.Specification.Rewards.html#5811" class="Field">Δf</a>          <a id="5823" class="Symbol">:</a> <a id="5825" href="Agda.Builtin.Int.html#245" class="Datatype">ℤ</a>
    <a id="RewardUpdate.rs"></a><a id="5831" href="Ledger.Conway.Specification.Rewards.html#5831" class="Field">rs</a>                <a id="5849" class="Symbol">:</a> <a id="5851" href="Ledger.Core.Specification.Address.html#260" class="Datatype">Credential</a> <a id="5862" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="5864" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a>
    <a id="RewardUpdate.flowConservation"></a><a id="5873" href="Ledger.Conway.Specification.Rewards.html#5873" class="Field">flowConservation</a>  <a id="5891" class="Symbol">:</a> <a id="5893" href="Ledger.Conway.Specification.Rewards.html#5805" class="Field">Δt</a> <a id="5896" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="5898" href="Ledger.Conway.Specification.Rewards.html#5808" class="Field">Δr</a> <a id="5901" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="5903" href="Ledger.Conway.Specification.Rewards.html#5811" class="Field">Δf</a> <a id="5906" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="5908" href="Ledger.Conway.Specification.Rewards.html#76" class="InductiveConstructor">pos</a> <a id="5912" class="Symbol">(</a><a id="5913" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">∑[</a> <a id="5916" href="Ledger.Conway.Specification.Rewards.html#5916" class="Bound">c</a> <a id="5918" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">←</a> <a id="5920" href="Ledger.Conway.Specification.Rewards.html#5831" class="Field">rs</a> <a id="5923" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">]</a> <a id="5925" href="Ledger.Conway.Specification.Rewards.html#5916" class="Bound">c</a><a id="5926" class="Symbol">)</a> <a id="5928" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="5930" class="Number">0</a>
    <a id="RewardUpdate.Δt-nonnegative"></a><a id="5936" href="Ledger.Conway.Specification.Rewards.html#5936" class="Field">Δt-nonnegative</a>    <a id="5954" class="Symbol">:</a> <a id="5956" class="Number">0</a> <a id="5958" href="Class.HasOrder.Core.html#608" class="Field Operator">≤</a> <a id="5960" href="Ledger.Conway.Specification.Rewards.html#5805" class="Field">Δt</a>
    <a id="RewardUpdate.Δf-nonpositive"></a><a id="5967" href="Ledger.Conway.Specification.Rewards.html#5967" class="Field">Δf-nonpositive</a>    <a id="5985" class="Symbol">:</a> <a id="5987" href="Ledger.Conway.Specification.Rewards.html#5811" class="Field">Δf</a> <a id="5990" href="Class.HasOrder.Core.html#608" class="Field Operator">≤</a> <a id="5992" class="Number">0</a>



<a id="5997" class="Keyword">record</a> <a id="Snapshot"></a><a id="6004" href="Ledger.Conway.Specification.Rewards.html#6004" class="Record">Snapshot</a> <a id="6013" class="Symbol">:</a> <a id="6015" href="Agda.Primitive.html#388" class="Primitive">Set</a> <a id="6019" class="Keyword">where</a>
  <a id="6027" class="Keyword">field</a>
    <a id="Snapshot.stake"></a><a id="6037" href="Ledger.Conway.Specification.Rewards.html#6037" class="Field">stake</a>           <a id="6053" class="Symbol">:</a> <a id="6055" href="Ledger.Core.Specification.Address.html#260" class="Datatype">Credential</a> <a id="6066" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="6068" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a>
    <a id="Snapshot.delegations"></a><a id="6077" href="Ledger.Conway.Specification.Rewards.html#6077" class="Field">delegations</a>     <a id="6093" class="Symbol">:</a> <a id="6095" href="Ledger.Core.Specification.Address.html#260" class="Datatype">Credential</a> <a id="6106" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="6108" href="Ledger.Core.Specification.Crypto.html#1338" class="Function">KeyHash</a>
    <a id="Snapshot.poolParameters"></a><a id="6120" href="Ledger.Conway.Specification.Rewards.html#6120" class="Field">poolParameters</a>  <a id="6136" class="Symbol">:</a> <a id="6138" href="Ledger.Core.Specification.Crypto.html#1338" class="Function">KeyHash</a> <a id="6146" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="6148" href="Ledger.Conway.Specification.Certs.html#1148" class="Record">PoolParams</a>



<a id="6162" class="Keyword">instance</a>
  <a id="6173" class="Keyword">unquoteDecl</a> <a id="HasCast-Snapshot"></a><a id="6185" href="Ledger.Conway.Specification.Rewards.html#6185" class="Function">HasCast-Snapshot</a> <a id="6202" class="Symbol">=</a>
    <a id="6208" href="stdlib-classes.Class.HasCast.Derive.html#2690" class="Function">derive-HasCast</a> <a id="6223" href="Data.List.Base.html#5205" class="Function Operator">[</a> <a id="6225" class="Symbol">(</a><a id="6226" class="Keyword">quote</a> <a id="6232" href="Ledger.Conway.Specification.Rewards.html#6004" class="Record">Snapshot</a> <a id="6241" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="6243" href="Ledger.Conway.Specification.Rewards.html#6185" class="Function">HasCast-Snapshot</a><a id="6259" class="Symbol">)</a> <a id="6261" href="Data.List.Base.html#5205" class="Function Operator">]</a>


<a id="6265" class="Keyword">private</a>
  <a id="getStakeCred"></a><a id="6275" href="Ledger.Conway.Specification.Rewards.html#6275" class="Function">getStakeCred</a> <a id="6288" class="Symbol">:</a> <a id="6290" href="Ledger.Conway.Specification.Transaction.html#2630" class="Function">TxOut</a> <a id="6296" class="Symbol">→</a> <a id="6298" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="6304" href="Ledger.Core.Specification.Address.html#260" class="Datatype">Credential</a>
  <a id="6317" href="Ledger.Conway.Specification.Rewards.html#6275" class="Function">getStakeCred</a> <a id="6330" class="Symbol">(</a><a id="6331" href="Ledger.Conway.Specification.Rewards.html#6331" class="Bound">a</a> <a id="6333" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="6335" class="Symbol">_</a> <a id="6337" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="6339" class="Symbol">_</a> <a id="6341" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="6343" class="Symbol">_)</a> <a id="6346" class="Symbol">=</a> <a id="6348" href="Ledger.Core.Specification.Address.html#2496" class="Function">stakeCred</a> <a id="6358" href="Ledger.Conway.Specification.Rewards.html#6331" class="Bound">a</a>

<a id="6361" class="Keyword">opaque</a>



  <a id="stakeDistr"></a><a id="6373" href="Ledger.Conway.Specification.Rewards.html#6373" class="Function">stakeDistr</a> <a id="6384" class="Symbol">:</a> <a id="6386" href="Ledger.Conway.Specification.Transaction.html#2698" class="Function">UTxO</a> <a id="6391" class="Symbol">→</a> <a id="6393" href="Ledger.Conway.Specification.Certs.html#3188" class="Record">DState</a> <a id="6400" class="Symbol">→</a> <a id="6402" href="Ledger.Conway.Specification.Certs.html#3798" class="Record">PState</a> <a id="6409" class="Symbol">→</a> <a id="6411" href="Ledger.Conway.Specification.Rewards.html#6004" class="Record">Snapshot</a>
  <a id="6422" href="Ledger.Conway.Specification.Rewards.html#6373" class="Function">stakeDistr</a> <a id="6433" href="Ledger.Conway.Specification.Rewards.html#6433" class="Bound">utxo</a> <a id="6438" href="Ledger.Conway.Specification.Rewards.html#6438" class="Bound">dState</a> <a id="6445" href="Ledger.Conway.Specification.Rewards.html#6445" class="Bound">pState</a> <a id="6452" class="Symbol">=</a>
      <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.Conway.Specification.Rewards.html#6687}{\htmlId{6462}{\htmlClass{Function}{\text{activeStake}}}}\, \\ \,\href{Ledger.Conway.Specification.Certs.html#3286}{\htmlId{6476}{\htmlClass{Function}{\text{stakeDelegs}}}}\, \\ \,\href{Ledger.Conway.Specification.Rewards.html#6521}{\htmlId{6490}{\htmlClass{Function}{\text{poolParams}}}}\, \end{pmatrix}$</a>
    <a id="6507" class="Keyword">where</a>


      <a id="6521" href="Ledger.Conway.Specification.Rewards.html#6521" class="Function">poolParams</a>    <a id="6535" class="Symbol">:</a> <a id="6537" href="Ledger.Core.Specification.Crypto.html#1338" class="Function">KeyHash</a> <a id="6545" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="6547" href="Ledger.Conway.Specification.Certs.html#1148" class="Record">PoolParams</a>
      <a id="6564" href="Ledger.Conway.Specification.Rewards.html#6564" class="Function">utxoBalance</a>   <a id="6578" class="Symbol">:</a> <a id="6580" href="Ledger.Core.Specification.Address.html#260" class="Datatype">Credential</a> <a id="6591" class="Symbol">→</a> <a id="6593" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a>
      <a id="6604" href="Ledger.Conway.Specification.Rewards.html#6604" class="Function">activeDelegs</a>  <a id="6618" class="Symbol">:</a> <a id="6620" href="Ledger.Core.Specification.Address.html#260" class="Datatype">Credential</a> <a id="6631" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="6633" href="Ledger.Core.Specification.Crypto.html#1338" class="Function">KeyHash</a>
      <a id="6647" href="Ledger.Conway.Specification.Rewards.html#6647" class="Function">activeRewards</a> <a id="6661" class="Symbol">:</a> <a id="6663" href="Ledger.Core.Specification.Address.html#260" class="Datatype">Credential</a> <a id="6674" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="6676" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a>
      <a id="6687" href="Ledger.Conway.Specification.Rewards.html#6687" class="Function">activeStake</a>   <a id="6701" class="Symbol">:</a> <a id="6703" href="Ledger.Core.Specification.Address.html#260" class="Datatype">Credential</a> <a id="6714" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="6716" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a>


      <a id="6729" href="Ledger.Conway.Specification.Rewards.html#6521" class="Function">poolParams</a>     <a id="6744" class="Symbol">=</a> <a id="6746" href="Ledger.Conway.Specification.Rewards.html#6445" class="Bound">pState</a> <a id="6753" class="Symbol">.</a><a id="6754" href="Ledger.Conway.Specification.Certs.html#3830" class="Field">PState.pools</a>
      <a id="6773" class="Keyword">open</a> <a id="6778" href="Ledger.Conway.Specification.Certs.html#3188" class="Module">DState</a> <a id="6785" href="Ledger.Conway.Specification.Rewards.html#6438" class="Bound">dState</a> <a id="6792" class="Keyword">using</a> <a id="6798" class="Symbol">(</a><a id="6799" href="Ledger.Conway.Specification.Certs.html#3286" class="Field">stakeDelegs</a><a id="6810" class="Symbol">;</a> <a id="6812" href="Ledger.Conway.Specification.Certs.html#3326" class="Field">rewards</a><a id="6819" class="Symbol">)</a>
      <a id="6827" href="Ledger.Conway.Specification.Rewards.html#6564" class="Function">utxoBalance</a>    <a id="6842" class="Symbol">=</a> <a id="6844" class="Symbol">λ</a> <a id="6846" href="Ledger.Conway.Specification.Rewards.html#6846" class="Bound">cred</a> <a id="6851" class="Symbol">→</a> <a id="6853" href="Ledger.Conway.Specification.Utxo.html#2412" class="Function">cbalance</a> <a id="6862" class="Symbol">(</a><a id="6863" href="Ledger.Conway.Specification.Rewards.html#6433" class="Bound">utxo</a> <a id="6868" href="abstract-set-theory.FiniteSetTheory.html#3088" class="Function Operator">∣^&#39;</a> <a id="6872" class="Symbol">λ</a> <a id="6874" href="Ledger.Conway.Specification.Rewards.html#6874" class="Bound">txout</a> <a id="6880" class="Symbol">→</a> <a id="6882" href="Ledger.Conway.Specification.Rewards.html#6275" class="Function">getStakeCred</a> <a id="6895" href="Ledger.Conway.Specification.Rewards.html#6874" class="Bound">txout</a> <a id="6901" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="6903" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="6908" href="Ledger.Conway.Specification.Rewards.html#6846" class="Bound">cred</a><a id="6912" class="Symbol">)</a>
      <a id="6920" href="Ledger.Conway.Specification.Rewards.html#6604" class="Function">activeDelegs</a>   <a id="6935" class="Symbol">=</a> <a id="6937" class="Symbol">(</a><a id="6938" href="Ledger.Conway.Specification.Certs.html#3286" class="Function">stakeDelegs</a> <a id="6950" href="Axiom.Set.Map.html#10678" class="Function Operator">∣</a> <a id="6952" href="Class.IsSet.html#916" class="Function">dom</a> <a id="6956" href="Ledger.Conway.Specification.Certs.html#3326" class="Function">rewards</a><a id="6963" class="Symbol">)</a> <a id="6965" href="Axiom.Set.Map.html#14048" class="Function Operator">∣^</a> <a id="6968" href="Class.IsSet.html#916" class="Function">dom</a> <a id="6972" href="Ledger.Conway.Specification.Rewards.html#6521" class="Function">poolParams</a>
      <a id="6989" href="Ledger.Conway.Specification.Rewards.html#6647" class="Function">activeRewards</a>  <a id="7004" class="Symbol">=</a> <a id="7006" href="Ledger.Conway.Specification.Certs.html#3326" class="Function">rewards</a> <a id="7014" href="Axiom.Set.Map.html#10678" class="Function Operator">∣</a> <a id="7016" href="Class.IsSet.html#916" class="Function">dom</a> <a id="7020" href="Ledger.Conway.Specification.Rewards.html#6604" class="Function">activeDelegs</a>
      <a id="7039" href="Ledger.Conway.Specification.Rewards.html#6687" class="Function">activeStake</a>    <a id="7054" class="Symbol">=</a>
        <a id="7064" href="Axiom.Set.Map.html#8706" class="Function">mapWithKey</a> <a id="7075" class="Symbol">(λ</a> <a id="7078" href="Ledger.Conway.Specification.Rewards.html#7078" class="Bound">c</a> <a id="7080" href="Ledger.Conway.Specification.Rewards.html#7080" class="Bound">rewardBalance</a> <a id="7094" class="Symbol">→</a> <a id="7096" href="Ledger.Conway.Specification.Rewards.html#6564" class="Function">utxoBalance</a> <a id="7108" href="Ledger.Conway.Specification.Rewards.html#7078" class="Bound">c</a> <a id="7110" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="7112" href="Ledger.Conway.Specification.Rewards.html#7080" class="Bound">rewardBalance</a><a id="7125" class="Symbol">)</a> <a id="7127" href="Ledger.Conway.Specification.Rewards.html#6647" class="Function">activeRewards</a>


<a id="7143" class="Keyword">record</a> <a id="Snapshots"></a><a id="7150" href="Ledger.Conway.Specification.Rewards.html#7150" class="Record">Snapshots</a> <a id="7160" class="Symbol">:</a> <a id="7162" href="Agda.Primitive.html#388" class="Primitive">Set</a> <a id="7166" class="Keyword">where</a>
  <a id="7174" class="Keyword">field</a>
    <a id="Snapshots.mark"></a><a id="7184" href="Ledger.Conway.Specification.Rewards.html#7184" class="Field">mark</a> <a id="Snapshots.set"></a><a id="7189" href="Ledger.Conway.Specification.Rewards.html#7189" class="Field">set</a> <a id="Snapshots.go"></a><a id="7193" href="Ledger.Conway.Specification.Rewards.html#7193" class="Field">go</a>  <a id="7197" class="Symbol">:</a> <a id="7199" href="Ledger.Conway.Specification.Rewards.html#6004" class="Record">Snapshot</a>
    <a id="Snapshots.feeSS"></a><a id="7212" href="Ledger.Conway.Specification.Rewards.html#7212" class="Field">feeSS</a>        <a id="7225" class="Symbol">:</a> <a id="7227" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a>



<a id="7235" class="Keyword">instance</a>
  <a id="7246" class="Keyword">unquoteDecl</a> <a id="HasCast-Snapshots"></a><a id="7258" href="Ledger.Conway.Specification.Rewards.html#7258" class="Function">HasCast-Snapshots</a> <a id="7276" class="Symbol">=</a>
    <a id="7282" href="stdlib-classes.Class.HasCast.Derive.html#2690" class="Function">derive-HasCast</a> <a id="7297" href="Data.List.Base.html#5205" class="Function Operator">[</a> <a id="7299" class="Symbol">(</a><a id="7300" class="Keyword">quote</a> <a id="7306" href="Ledger.Conway.Specification.Rewards.html#7150" class="Record">Snapshots</a> <a id="7316" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="7318" href="Ledger.Conway.Specification.Rewards.html#7258" class="Function">HasCast-Snapshots</a><a id="7335" class="Symbol">)</a> <a id="7337" href="Data.List.Base.html#5205" class="Function Operator">]</a>


<a id="7341" class="Keyword">private</a> <a id="7349" class="Keyword">variable</a>
  <a id="7360" href="Ledger.Conway.Specification.Rewards.html#7360" class="Generalizable">lstate</a> <a id="7367" class="Symbol">:</a> <a id="7369" href="Ledger.Conway.Specification.Ledger.html#977" class="Record">LState</a>
  <a id="7378" href="Ledger.Conway.Specification.Rewards.html#7378" class="Generalizable">mark</a> <a id="7383" href="Ledger.Conway.Specification.Rewards.html#7383" class="Generalizable">set</a> <a id="7387" href="Ledger.Conway.Specification.Rewards.html#7387" class="Generalizable">go</a> <a id="7390" class="Symbol">:</a> <a id="7392" href="Ledger.Conway.Specification.Rewards.html#6004" class="Record">Snapshot</a>
  <a id="7403" href="Ledger.Conway.Specification.Rewards.html#7403" class="Generalizable">feeSS</a> <a id="7409" class="Symbol">:</a> <a id="7411" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a>


<a id="7418" class="Keyword">data</a> <a id="_⊢_⇀⦇_,SNAP⦈_"></a><a id="7423" href="Ledger.Conway.Specification.Rewards.html#7423" class="Datatype Operator">_⊢_⇀⦇_,SNAP⦈_</a> <a id="7437" class="Symbol">:</a> <a id="7439" href="Ledger.Conway.Specification.Ledger.html#977" class="Record">LState</a> <a id="7446" class="Symbol">→</a> <a id="7448" href="Ledger.Conway.Specification.Rewards.html#7150" class="Record">Snapshots</a> <a id="7458" class="Symbol">→</a> <a id="7460" href="Agda.Builtin.Unit.html#175" class="Record">⊤</a> <a id="7462" class="Symbol">→</a> <a id="7464" href="Ledger.Conway.Specification.Rewards.html#7150" class="Record">Snapshots</a> <a id="7474" class="Symbol">→</a> <a id="7476" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="7481" class="Keyword">where</a>
  <a id="_⊢_⇀⦇_,SNAP⦈_.SNAP"></a><a id="7489" href="Ledger.Conway.Specification.Rewards.html#7489" class="InductiveConstructor">SNAP</a> <a id="7494" class="Symbol">:</a> <a id="7496" class="Keyword">let</a> <a id="7500" class="Keyword">open</a> <a id="7505" href="Ledger.Conway.Specification.Ledger.html#977" class="Module">LState</a> <a id="7512" href="Ledger.Conway.Specification.Rewards.html#7360" class="Generalizable">lstate</a><a id="7518" class="Symbol">;</a> <a id="7520" class="Keyword">open</a> <a id="7525" href="Ledger.Conway.Specification.Utxo.html#1474" class="Module">UTxOState</a> <a id="7535" href="Ledger.Conway.Specification.Ledger.html#1036" class="Function">utxoSt</a><a id="7541" class="Symbol">;</a> <a id="7543" class="Keyword">open</a> <a id="7548" href="Ledger.Conway.Specification.Certs.html#4344" class="Module">CertState</a> <a id="7558" href="Ledger.Conway.Specification.Ledger.html#1089" class="Function">certState</a>
             <a id="7581" href="Ledger.Conway.Specification.Rewards.html#7581" class="Bound">stake</a> <a id="7587" class="Symbol">=</a> <a id="7589" href="Ledger.Conway.Specification.Rewards.html#6373" class="Function">stakeDistr</a> <a id="7600" href="Ledger.Conway.Specification.Utxo.html#1538" class="Function">utxo</a> <a id="7605" href="Ledger.Conway.Specification.Certs.html#4407" class="Function">dState</a> <a id="7612" href="Ledger.Conway.Specification.Certs.html#4427" class="Function">pState</a>
    <a id="7623" class="Keyword">in</a>
    <a id="7630" href="Ledger.Conway.Specification.Rewards.html#7360" class="Generalizable">lstate</a> <a id="7637" href="Ledger.Conway.Specification.Rewards.html#7423" class="Datatype Operator">⊢</a> <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.Conway.Specification.Rewards.html#7378}{\htmlId{7641}{\htmlClass{Generalizable}{\text{mark}}}}\, \\ \,\href{Ledger.Conway.Specification.Rewards.html#7383}{\htmlId{7648}{\htmlClass{Generalizable}{\text{set}}}}\, \\ \,\href{Ledger.Conway.Specification.Rewards.html#7387}{\htmlId{7654}{\htmlClass{Generalizable}{\text{go}}}}\, \\ \,\href{Ledger.Conway.Specification.Rewards.html#7403}{\htmlId{7659}{\htmlClass{Generalizable}{\text{feeSS}}}}\, \end{pmatrix}$</a> <a id="7667" href="Ledger.Conway.Specification.Rewards.html#7423" class="Datatype Operator">⇀⦇</a> <a id="7670" href="Agda.Builtin.Unit.html#212" class="InductiveConstructor">tt</a> <a id="7673" href="Ledger.Conway.Specification.Rewards.html#7423" class="Datatype Operator">,SNAP⦈</a> <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.Conway.Specification.Rewards.html#7581}{\htmlId{7682}{\htmlClass{Bound}{\text{stake}}}}\, \\ \,\href{Ledger.Conway.Specification.Rewards.html#7378}{\htmlId{7690}{\htmlClass{Generalizable}{\text{mark}}}}\, \\ \,\href{Ledger.Conway.Specification.Rewards.html#7383}{\htmlId{7697}{\htmlClass{Generalizable}{\text{set}}}}\, \\ \,\href{Ledger.Conway.Specification.Utxo.html#1560}{\htmlId{7703}{\htmlClass{Function}{\text{fees}}}}\, \end{pmatrix}$</a>

</pre></body></html>