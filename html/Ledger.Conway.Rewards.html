<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>Ledger.Conway.Rewards</title><link rel="stylesheet" href="Agda.css"></head><body><pre class="Agda">
<a id="2" class="Symbol">{-#</a> <a id="6" class="Keyword">OPTIONS</a> <a id="14" class="Pragma">--safe</a> <a id="21" class="Symbol">#-}</a>

<a id="26" class="Keyword">import</a>      <a id="38" href="Data.Nat.html" class="Module">Data.Nat</a> <a id="47" class="Symbol">as</a> <a id="50" class="Module">ℕ</a> <a id="52" class="Keyword">renaming</a> <a id="61" class="Symbol">(</a><a id="62" href="Data.Nat.Base.html#5485" class="Function Operator">_⊔_</a> <a id="66" class="Symbol">to</a> <a id="69" class="Function Operator">max</a><a id="72" class="Symbol">)</a>
<a id="74" class="Keyword">import</a>      <a id="86" href="Data.Integer.html" class="Module">Data.Integer</a> <a id="99" class="Symbol">as</a> <a id="102" class="Module">ℤ</a> <a id="104" class="Keyword">renaming</a> <a id="113" class="Symbol">(</a><a id="114" href="Data.Integer.Base.html#5556" class="Function Operator">_⊔_</a> <a id="118" class="Symbol">to</a> <a id="121" class="Function Operator">max</a><a id="124" class="Symbol">)</a>
<a id="126" class="Keyword">import</a>      <a id="138" href="Data.Integer.Properties.html" class="Module">Data.Integer.Properties</a> <a id="162" class="Symbol">as</a> <a id="165" class="Module">ℤ</a>
<a id="167" class="Keyword">open</a> <a id="172" class="Keyword">import</a> <a id="179" href="Data.Rational.html" class="Module">Data.Rational</a> <a id="193" class="Keyword">using</a> <a id="199" class="Symbol">(</a><a id="200" href="Data.Rational.Base.html#1342" class="Record">ℚ</a><a id="201" class="Symbol">;</a> <a id="203" href="Data.Rational.Base.html#7116" class="Function">floor</a><a id="208" class="Symbol">;</a> <a id="210" href="Data.Rational.Base.html#6315" class="Function Operator">_*_</a><a id="213" class="Symbol">;</a> <a id="215" href="Data.Rational.Base.html#6708" class="Function Operator">_÷_</a><a id="218" class="Symbol">;</a> <a id="220" href="Data.Rational.Base.html#3884" class="Function Operator">_/_</a><a id="223" class="Symbol">;</a> <a id="225" href="Data.Rational.Base.html#6405" class="Function Operator">_-_</a><a id="228" class="Symbol">)</a>
<a id="230" class="Keyword">import</a>      <a id="242" href="Data.Rational.html" class="Module">Data.Rational</a> <a id="256" class="Symbol">as</a> <a id="259" class="Module">ℚ</a> <a id="261" class="Keyword">renaming</a> <a id="270" class="Symbol">(</a><a id="271" href="Data.Rational.Base.html#6854" class="Function Operator">_⊓_</a> <a id="275" class="Symbol">to</a> <a id="278" class="Function Operator">min</a><a id="281" class="Symbol">;</a> <a id="283" href="Data.Rational.Base.html#6776" class="Function Operator">_⊔_</a> <a id="287" class="Symbol">to</a> <a id="290" class="Function Operator">max</a><a id="293" class="Symbol">)</a>
<a id="295" class="Keyword">open</a> <a id="300" class="Keyword">import</a> <a id="307" href="Data.Rational.Literals.html" class="Module">Data.Rational.Literals</a> <a id="330" class="Keyword">using</a> <a id="336" class="Symbol">(</a><a id="337" href="Data.Rational.Literals.html#740" class="Function">number</a><a id="343" class="Symbol">;</a> <a id="345" href="Data.Rational.Literals.html#613" class="Function">fromℤ</a><a id="350" class="Symbol">)</a>
<a id="352" class="Keyword">import</a>      <a id="364" href="Data.Rational.Properties.html" class="Module">Data.Rational.Properties</a> <a id="389" class="Symbol">as</a> <a id="392" class="Module">ℚ</a>

<a id="395" class="Keyword">open</a> <a id="400" class="Keyword">import</a> <a id="407" href="Ledger.Conway.Abstract.html" class="Module">Ledger.Conway.Abstract</a>
<a id="430" class="Keyword">open</a> <a id="435" class="Keyword">import</a> <a id="442" href="Ledger.Conway.Transaction.html" class="Module">Ledger.Conway.Transaction</a>
<a id="468" class="Keyword">open</a> <a id="473" class="Keyword">import</a> <a id="480" href="Ledger.Conway.Types.Numeric.UnitInterval.html" class="Module">Ledger.Conway.Types.Numeric.UnitInterval</a>

<a id="522" class="Keyword">open</a> <a id="527" class="Keyword">import</a> <a id="534" href="Agda.Builtin.FromNat.html" class="Module">Agda.Builtin.FromNat</a>
<a id="555" class="Keyword">open</a>        <a id="567" href="Agda.Builtin.FromNat.html#196" class="Module">Number</a> <a id="574" href="Data.Rational.Literals.html#740" class="Function">number</a> <a id="581" class="Keyword">renaming</a> <a id="590" class="Symbol">(</a><a id="591" href="Agda.Builtin.FromNat.html#281" class="Field">fromNat</a> <a id="599" class="Symbol">to</a> <a id="602" class="Field">fromℕ</a><a id="607" class="Symbol">)</a>

<a id="610" class="Keyword">module</a> <a id="617" href="Ledger.Conway.Rewards.html" class="Module">Ledger.Conway.Rewards</a>
  <a id="641" class="Symbol">(</a><a id="642" href="Ledger.Conway.Rewards.html#642" class="Bound">txs</a> <a id="646" class="Symbol">:</a> <a id="648" class="Symbol">_)</a> <a id="651" class="Symbol">(</a><a id="652" class="Keyword">open</a> <a id="657" href="Ledger.Conway.Transaction.html#910" class="Module">TransactionStructure</a> <a id="678" href="Ledger.Conway.Rewards.html#642" class="Bound">txs</a><a id="681" class="Symbol">)</a>
  <a id="685" class="Symbol">(</a><a id="686" href="Ledger.Conway.Rewards.html#686" class="Bound">abs</a> <a id="690" class="Symbol">:</a> <a id="692" href="Ledger.Conway.Abstract.html#599" class="Record">AbstractFunctions</a> <a id="710" href="Ledger.Conway.Rewards.html#642" class="Bound">txs</a><a id="713" class="Symbol">)</a>
  <a id="717" class="Keyword">where</a>

<a id="724" class="Keyword">open</a> <a id="729" class="Keyword">import</a> <a id="736" href="Ledger.Conway.Certs.html" class="Module">Ledger.Conway.Certs</a> <a id="756" href="Ledger.Conway.Transaction.html#1880" class="Function">govStructure</a>
<a id="769" class="Keyword">open</a> <a id="774" class="Keyword">import</a> <a id="781" href="Ledger.Conway.Ledger.html" class="Module">Ledger.Conway.Ledger</a> <a id="802" href="Ledger.Conway.Rewards.html#642" class="Bound">txs</a> <a id="806" href="Ledger.Conway.Rewards.html#686" class="Bound">abs</a>
<a id="810" class="Keyword">open</a> <a id="815" class="Keyword">import</a> <a id="822" href="Ledger.Prelude.html" class="Module">Ledger.Prelude</a> <a id="837" class="Keyword">hiding</a> <a id="844" class="Symbol">(</a><a id="845" href="Data.Nat.Base.html#7102" class="Function Operator">_/_</a><a id="848" class="Symbol">;</a> <a id="850" href="Agda.Builtin.Nat.html#539" class="Primitive Operator">_*_</a><a id="853" class="Symbol">;</a> <a id="855" href="Interface.HasSubtract.html#209" class="Field Operator">_-_</a><a id="858" class="Symbol">)</a>
<a id="860" class="Keyword">open</a> <a id="865" class="Keyword">import</a> <a id="872" href="Ledger.Conway.Utxo.html" class="Module">Ledger.Conway.Utxo</a> <a id="891" href="Ledger.Conway.Rewards.html#642" class="Bound">txs</a> <a id="895" href="Ledger.Conway.Rewards.html#686" class="Bound">abs</a>



<a id="nonZero-max-1"></a><a id="902" href="Ledger.Conway.Rewards.html#902" class="Function">nonZero-max-1</a> <a id="916" class="Symbol">:</a> <a id="918" class="Symbol">∀</a> <a id="920" class="Symbol">(</a><a id="921" href="Ledger.Conway.Rewards.html#921" class="Bound">n</a> <a id="923" class="Symbol">:</a> <a id="925" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a><a id="926" class="Symbol">)</a> <a id="928" class="Symbol">→</a> <a id="930" href="Data.Nat.Base.html#3266" class="Record">ℕ.NonZero</a> <a id="940" class="Symbol">(</a><a id="941" href="Ledger.Conway.Rewards.html#69" class="Function">ℕ.max</a> <a id="947" class="Number">1</a> <a id="949" href="Ledger.Conway.Rewards.html#921" class="Bound">n</a><a id="950" class="Symbol">)</a>
<a id="952" href="Ledger.Conway.Rewards.html#902" class="Function">nonZero-max-1</a> <a id="966" href="Agda.Builtin.Nat.html#221" class="InductiveConstructor">zero</a> <a id="971" class="Symbol">=</a> <a id="973" href="Data.Nat.Base.html#3359" class="Function">ℕ.nonZero</a>
<a id="983" href="Ledger.Conway.Rewards.html#902" class="Function">nonZero-max-1</a> <a id="997" class="Symbol">(</a><a id="998" href="Agda.Builtin.Nat.html#234" class="InductiveConstructor">suc</a> <a id="1002" href="Ledger.Conway.Rewards.html#1002" class="Bound">n</a><a id="1003" class="Symbol">)</a> <a id="1005" class="Symbol">=</a> <a id="1007" href="Data.Nat.Base.html#3359" class="Function">ℕ.nonZero</a>

<a id="nonZero-1/n"></a><a id="1018" href="Ledger.Conway.Rewards.html#1018" class="Function">nonZero-1/n</a> <a id="1030" class="Symbol">:</a> <a id="1032" class="Symbol">∀</a> <a id="1034" class="Symbol">(</a><a id="1035" href="Ledger.Conway.Rewards.html#1035" class="Bound">n</a> <a id="1037" class="Symbol">:</a> <a id="1039" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a><a id="1040" class="Symbol">)</a> <a id="1042" class="Symbol">→</a> <a id="1044" class="Symbol">.{{</a><a id="1047" href="Ledger.Conway.Rewards.html#1047" class="Bound">_</a> <a id="1049" class="Symbol">:</a> <a id="1051" href="Data.Nat.Base.html#3266" class="Record">ℕ.NonZero</a> <a id="1061" href="Ledger.Conway.Rewards.html#1035" class="Bound">n</a><a id="1062" class="Symbol">}}</a> <a id="1065" class="Symbol">→</a> <a id="1067" href="Data.Rational.Base.html#4498" class="Function">ℚ.NonZero</a> <a id="1077" class="Symbol">(</a><a id="1078" class="Number">1</a> <a id="1080" href="Data.Rational.Base.html#3884" class="Function Operator">/</a> <a id="1082" href="Ledger.Conway.Rewards.html#1035" class="Bound">n</a><a id="1083" class="Symbol">)</a>
<a id="1085" href="Ledger.Conway.Rewards.html#1018" class="Function">nonZero-1/n</a> <a id="1097" href="Ledger.Conway.Rewards.html#1097" class="Bound">n</a> <a id="1099" class="Symbol">{{</a><a id="1101" href="Ledger.Conway.Rewards.html#1101" class="Bound">prf</a><a id="1104" class="Symbol">}}</a> <a id="1107" class="Symbol">=</a>
  <a id="1111" href="Data.Rational.Properties.html#7612" class="Function">ℚ.pos⇒nonZero</a> <a id="1125" class="Symbol">(</a><a id="1126" class="Number">1</a> <a id="1128" href="Data.Rational.Base.html#3884" class="Function Operator">/</a> <a id="1130" href="Ledger.Conway.Rewards.html#1097" class="Bound">n</a><a id="1131" class="Symbol">)</a> <a id="1133" class="Symbol">{{</a><a id="1135" href="Data.Rational.Properties.html#11672" class="Function">ℚ.normalize-pos</a> <a id="1151" class="Number">1</a> <a id="1153" href="Ledger.Conway.Rewards.html#1097" class="Bound">n</a> <a id="1155" class="Symbol">{{</a><a id="1157" href="Ledger.Conway.Rewards.html#1101" class="Bound">prf</a><a id="1160" class="Symbol">}}</a> <a id="1163" class="Symbol">{{_}}</a> <a id="1169" class="Symbol">}}</a>

<a id="nonZero-1+max0-x"></a><a id="1173" href="Ledger.Conway.Rewards.html#1173" class="Function">nonZero-1+max0-x</a> <a id="1190" class="Symbol">:</a> <a id="1192" class="Symbol">∀</a> <a id="1194" class="Symbol">(</a><a id="1195" href="Ledger.Conway.Rewards.html#1195" class="Bound">x</a> <a id="1197" class="Symbol">:</a> <a id="1199" href="Data.Rational.Base.html#1342" class="Record">ℚ</a><a id="1200" class="Symbol">)</a> <a id="1202" class="Symbol">→</a> <a id="1204" href="Data.Rational.Base.html#4498" class="Function">ℚ.NonZero</a> <a id="1214" class="Symbol">(</a><a id="1215" class="Number">1</a> <a id="1217" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="1219" href="Ledger.Conway.Rewards.html#290" class="Function">ℚ.max</a> <a id="1225" class="Number">0</a> <a id="1227" href="Ledger.Conway.Rewards.html#1195" class="Bound">x</a><a id="1228" class="Symbol">)</a>
<a id="1230" href="Ledger.Conway.Rewards.html#1173" class="Function">nonZero-1+max0-x</a> <a id="1247" href="Ledger.Conway.Rewards.html#1247" class="Bound">x</a> <a id="1249" class="Symbol">=</a>
  <a id="1253" href="Data.Rational.Base.html#5214" class="Function">ℚ.&gt;-nonZero</a> <a id="1265" class="Symbol">(</a><a id="1266" href="Data.Rational.Properties.html#36007" class="Function">ℚ.+-mono-&lt;-≤</a> <a id="1279" class="Symbol">(</a><a id="1280" href="Data.Rational.Properties.html#26724" class="Function">ℚ.positive⁻¹</a> <a id="1293" class="Number">1</a><a id="1294" class="Symbol">)</a> <a id="1296" class="Symbol">(</a><a id="1297" href="Data.Rational.Properties.html#57994" class="Function">ℚ.p≤p⊔q</a> <a id="1305" class="Number">0</a> <a id="1307" href="Ledger.Conway.Rewards.html#1247" class="Bound">x</a><a id="1308" class="Symbol">))</a>

<a id="1312" class="Keyword">private</a> <a id="1320" class="Keyword">instance</a>
  <a id="nonNegative"></a><a id="1331" href="Ledger.Conway.Rewards.html#1331" class="Function">nonNegative</a> <a id="1343" class="Symbol">:</a> <a id="1345" class="Symbol">∀</a> <a id="1347" class="Symbol">{</a><a id="1348" href="Ledger.Conway.Rewards.html#1348" class="Bound">i</a><a id="1349" class="Symbol">}</a> <a id="1351" class="Symbol">→</a> <a id="1353" href="Data.Integer.Base.html#3053" class="Record">ℤ.NonNegative</a> <a id="1367" class="Symbol">(</a><a id="1368" href="Ledger.Conway.Rewards.html#121" class="Function">ℤ.max</a> <a id="1374" class="Number">0</a> <a id="1376" href="Ledger.Conway.Rewards.html#1348" class="Bound">i</a><a id="1377" class="Symbol">)</a>
  <a id="1381" href="Ledger.Conway.Rewards.html#1331" class="Function">nonNegative</a> <a id="1393" class="Symbol">{</a><a id="1394" href="Ledger.Conway.Rewards.html#1394" class="Bound">i</a><a id="1395" class="Symbol">}</a> <a id="1397" class="Symbol">=</a> <a id="1399" href="Data.Integer.Base.html#4073" class="Function">ℤ.nonNegative</a> <a id="1413" class="Symbol">(</a><a id="1414" href="Data.Integer.Properties.html#67574" class="Function">ℤ.i≤i⊔j</a> <a id="1422" class="Number">0</a> <a id="1424" href="Ledger.Conway.Rewards.html#1394" class="Bound">i</a><a id="1425" class="Symbol">)</a>


<a id="maxPool"></a><a id="1429" href="Ledger.Conway.Rewards.html#1429" class="Function">maxPool</a> <a id="1437" class="Symbol">:</a> <a id="1439" href="Ledger.Conway.PParams.html#1605" class="Record">PParams</a> <a id="1447" class="Symbol">→</a> <a id="1449" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a> <a id="1454" class="Symbol">→</a> <a id="1456" href="Ledger.Conway.Types.Numeric.UnitInterval.html#2124" class="Function">UnitInterval</a> <a id="1469" class="Symbol">→</a> <a id="1471" href="Ledger.Conway.Types.Numeric.UnitInterval.html#2124" class="Function">UnitInterval</a> <a id="1484" class="Symbol">→</a> <a id="1486" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a>
<a id="1491" href="Ledger.Conway.Rewards.html#1429" class="Function">maxPool</a> <a id="1499" href="Ledger.Conway.Rewards.html#1499" class="Bound">pparams</a> <a id="1507" href="Ledger.Conway.Rewards.html#1507" class="Bound">rewardPot</a> <a id="1517" href="Ledger.Conway.Rewards.html#1517" class="Bound">stake</a> <a id="1523" href="Ledger.Conway.Rewards.html#1523" class="Bound">pledge</a> <a id="1530" class="Symbol">=</a> <a id="1532" href="Ledger.Conway.Rewards.html#2210" class="Function">rewardℕ</a>
  <a id="1542" class="Keyword">where</a>
    <a id="1552" href="Ledger.Conway.Rewards.html#1552" class="Function">a0</a>      <a id="1560" class="Symbol">=</a> <a id="1562" href="Ledger.Conway.Rewards.html#290" class="Function">ℚ.max</a> <a id="1568" class="Number">0</a> <a id="1570" class="Symbol">(</a><a id="1571" href="Ledger.Conway.Rewards.html#1499" class="Bound">pparams</a> <a id="1579" class="Symbol">.</a><a id="1580" href="Ledger.Conway.PParams.html#2805" class="Field">PParams.a0</a><a id="1590" class="Symbol">)</a>
    <a id="1596" href="Ledger.Conway.Rewards.html#1596" class="Function">1+a0</a>    <a id="1604" class="Symbol">=</a> <a id="1606" class="Number">1</a> <a id="1608" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="1610" href="Ledger.Conway.Rewards.html#1552" class="Function">a0</a>
    <a id="1617" href="Ledger.Conway.Rewards.html#1617" class="Function">nopt</a>    <a id="1625" class="Symbol">=</a> <a id="1627" href="Ledger.Conway.Rewards.html#69" class="Function">ℕ.max</a> <a id="1633" class="Number">1</a> <a id="1635" class="Symbol">(</a><a id="1636" href="Ledger.Conway.Rewards.html#1499" class="Bound">pparams</a> <a id="1644" class="Symbol">.</a><a id="1645" href="Ledger.Conway.PParams.html#2763" class="Field">PParams.nopt</a><a id="1657" class="Symbol">)</a>


    <a id="1665" class="Keyword">instance</a>
      <a id="1680" href="Ledger.Conway.Rewards.html#1680" class="Function">nonZero-nopt</a> <a id="1693" class="Symbol">:</a> <a id="1695" href="Data.Nat.Base.html#3266" class="Record">ℕ.NonZero</a> <a id="1705" href="Ledger.Conway.Rewards.html#1617" class="Function">nopt</a>
      <a id="1716" href="Ledger.Conway.Rewards.html#1680" class="Function">nonZero-nopt</a> <a id="1729" class="Symbol">=</a> <a id="1731" href="Ledger.Conway.Rewards.html#902" class="Function">nonZero-max-1</a> <a id="1745" class="Symbol">(</a><a id="1746" href="Ledger.Conway.Rewards.html#1499" class="Bound">pparams</a> <a id="1754" class="Symbol">.</a><a id="1755" href="Ledger.Conway.PParams.html#2763" class="Field">PParams.nopt</a><a id="1767" class="Symbol">)</a>


    <a id="1775" href="Ledger.Conway.Rewards.html#1775" class="Function">z0</a>       <a id="1784" class="Symbol">=</a> <a id="1786" class="Number">1</a> <a id="1788" href="Data.Rational.Base.html#3884" class="Function Operator">/</a> <a id="1790" href="Ledger.Conway.Rewards.html#1617" class="Function">nopt</a>
    <a id="1799" href="Ledger.Conway.Rewards.html#1799" class="Function">stake&#39;</a>   <a id="1808" class="Symbol">=</a> <a id="1810" href="Ledger.Conway.Rewards.html#278" class="Function">ℚ.min</a> <a id="1816" class="Symbol">(</a><a id="1817" href="Ledger.Conway.Types.Numeric.UnitInterval.html#2341" class="Function">fromUnitInterval</a> <a id="1834" href="Ledger.Conway.Rewards.html#1517" class="Bound">stake</a><a id="1839" class="Symbol">)</a> <a id="1841" href="Ledger.Conway.Rewards.html#1775" class="Function">z0</a>
    <a id="1848" href="Ledger.Conway.Rewards.html#1848" class="Function">pledge&#39;</a>  <a id="1857" class="Symbol">=</a> <a id="1859" href="Ledger.Conway.Rewards.html#278" class="Function">ℚ.min</a> <a id="1865" class="Symbol">(</a><a id="1866" href="Ledger.Conway.Types.Numeric.UnitInterval.html#2341" class="Function">fromUnitInterval</a> <a id="1883" href="Ledger.Conway.Rewards.html#1523" class="Bound">pledge</a><a id="1889" class="Symbol">)</a> <a id="1891" href="Ledger.Conway.Rewards.html#1775" class="Function">z0</a>


    <a id="1900" class="Keyword">instance</a>
      <a id="1915" href="Ledger.Conway.Rewards.html#1915" class="Function">nonZeroz0</a> <a id="1925" class="Symbol">:</a> <a id="1927" href="Data.Rational.Base.html#4498" class="Function">ℚ.NonZero</a> <a id="1937" href="Ledger.Conway.Rewards.html#1775" class="Function">z0</a>
      <a id="1946" href="Ledger.Conway.Rewards.html#1915" class="Function">nonZeroz0</a> <a id="1956" class="Symbol">=</a> <a id="1958" href="Ledger.Conway.Rewards.html#1018" class="Function">nonZero-1/n</a> <a id="1970" href="Ledger.Conway.Rewards.html#1617" class="Function">nopt</a>

      <a id="1982" href="Ledger.Conway.Rewards.html#1982" class="Function">nonZero-1+a0</a> <a id="1995" class="Symbol">:</a> <a id="1997" href="Data.Rational.Base.html#4498" class="Function">ℚ.NonZero</a> <a id="2007" class="Symbol">(</a><a id="2008" href="Ledger.Conway.Rewards.html#1596" class="Function">1+a0</a><a id="2012" class="Symbol">)</a>
      <a id="2020" href="Ledger.Conway.Rewards.html#1982" class="Function">nonZero-1+a0</a> <a id="2033" class="Symbol">=</a> <a id="2035" href="Ledger.Conway.Rewards.html#1173" class="Function">nonZero-1+max0-x</a> <a id="2052" class="Symbol">(</a><a id="2053" href="Ledger.Conway.Rewards.html#1499" class="Bound">pparams</a> <a id="2061" class="Symbol">.</a><a id="2062" href="Ledger.Conway.PParams.html#2805" class="Field">PParams.a0</a><a id="2072" class="Symbol">)</a>


    <a id="2080" href="Ledger.Conway.Rewards.html#2080" class="Function">rewardℚ</a> <a id="2088" class="Symbol">=</a>
        <a id="2098" class="Symbol">((</a><a id="2100" href="Ledger.Conway.Rewards.html#602" class="Function">fromℕ</a> <a id="2106" href="Ledger.Conway.Rewards.html#1507" class="Bound">rewardPot</a><a id="2115" class="Symbol">)</a> <a id="2117" href="Data.Rational.Base.html#6708" class="Function Operator">÷</a> <a id="2119" href="Ledger.Conway.Rewards.html#1596" class="Function">1+a0</a><a id="2123" class="Symbol">)</a>
        <a id="2133" href="Data.Rational.Base.html#6315" class="Function Operator">*</a> <a id="2135" class="Symbol">(</a><a id="2136" href="Ledger.Conway.Rewards.html#1799" class="Function">stake&#39;</a> <a id="2143" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="2145" href="Ledger.Conway.Rewards.html#1848" class="Function">pledge&#39;</a> <a id="2153" href="Data.Rational.Base.html#6315" class="Function Operator">*</a> <a id="2155" href="Ledger.Conway.Rewards.html#1552" class="Function">a0</a> <a id="2158" href="Data.Rational.Base.html#6315" class="Function Operator">*</a> <a id="2160" class="Symbol">(</a><a id="2161" href="Ledger.Conway.Rewards.html#1799" class="Function">stake&#39;</a> <a id="2168" href="Data.Rational.Base.html#6405" class="Function Operator">-</a> <a id="2170" href="Ledger.Conway.Rewards.html#1848" class="Function">pledge&#39;</a> <a id="2178" href="Data.Rational.Base.html#6315" class="Function Operator">*</a> <a id="2180" class="Symbol">(</a><a id="2181" href="Ledger.Conway.Rewards.html#1775" class="Function">z0</a> <a id="2184" href="Data.Rational.Base.html#6405" class="Function Operator">-</a> <a id="2186" href="Ledger.Conway.Rewards.html#1799" class="Function">stake&#39;</a><a id="2192" class="Symbol">)</a> <a id="2194" href="Data.Rational.Base.html#6708" class="Function Operator">÷</a> <a id="2196" href="Ledger.Conway.Rewards.html#1775" class="Function">z0</a><a id="2198" class="Symbol">)</a> <a id="2200" href="Data.Rational.Base.html#6708" class="Function Operator">÷</a> <a id="2202" href="Ledger.Conway.Rewards.html#1775" class="Function">z0</a><a id="2204" class="Symbol">)</a>
    <a id="2210" href="Ledger.Conway.Rewards.html#2210" class="Function">rewardℕ</a> <a id="2218" class="Symbol">=</a> <a id="2220" href="Prelude.html#3167" class="Function">posPart</a> <a id="2228" class="Symbol">(</a><a id="2229" href="Data.Rational.Base.html#7116" class="Function">floor</a> <a id="2235" href="Ledger.Conway.Rewards.html#2080" class="Function">rewardℚ</a><a id="2242" class="Symbol">)</a>


<a id="mkApparentPerformance"></a><a id="2246" href="Ledger.Conway.Rewards.html#2246" class="Function">mkApparentPerformance</a> <a id="2268" class="Symbol">:</a> <a id="2270" href="Ledger.Conway.Types.Numeric.UnitInterval.html#2124" class="Function">UnitInterval</a> <a id="2283" class="Symbol">→</a> <a id="2285" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a> <a id="2287" class="Symbol">→</a> <a id="2289" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a> <a id="2291" class="Symbol">→</a> <a id="2293" href="Data.Rational.Base.html#1342" class="Record">ℚ</a>
<a id="2295" href="Ledger.Conway.Rewards.html#2246" class="Function">mkApparentPerformance</a> <a id="2317" href="Ledger.Conway.Rewards.html#2317" class="Bound">stake</a> <a id="2323" href="Ledger.Conway.Rewards.html#2323" class="Bound">poolBlocks</a> <a id="2334" href="Ledger.Conway.Rewards.html#2334" class="Bound">totalBlocks</a> <a id="2346" class="Symbol">=</a> <a id="2348" href="Ledger.Conway.Rewards.html#2549" class="Function">ratioBlocks</a> <a id="2360" href="Ledger.Prelude.html#2305" class="Function Operator">÷₀</a> <a id="2363" href="Ledger.Conway.Rewards.html#2382" class="Function">stake&#39;</a>
  <a id="2372" class="Keyword">where</a>
    <a id="2382" href="Ledger.Conway.Rewards.html#2382" class="Function">stake&#39;</a> <a id="2389" class="Symbol">=</a> <a id="2391" href="Ledger.Conway.Types.Numeric.UnitInterval.html#2341" class="Function">fromUnitInterval</a> <a id="2408" href="Ledger.Conway.Rewards.html#2317" class="Bound">stake</a>


    <a id="2420" class="Keyword">instance</a>
      <a id="2435" href="Ledger.Conway.Rewards.html#2435" class="Function">nonZero-totalBlocks</a> <a id="2455" class="Symbol">:</a> <a id="2457" href="Data.Nat.Base.html#3266" class="Record">ℕ.NonZero</a> <a id="2467" class="Symbol">(</a><a id="2468" href="Ledger.Conway.Rewards.html#69" class="Function">ℕ.max</a> <a id="2474" class="Number">1</a> <a id="2476" href="Ledger.Conway.Rewards.html#2334" class="Bound">totalBlocks</a><a id="2487" class="Symbol">)</a>
      <a id="2495" href="Ledger.Conway.Rewards.html#2435" class="Function">nonZero-totalBlocks</a> <a id="2515" class="Symbol">=</a> <a id="2517" href="Ledger.Conway.Rewards.html#902" class="Function">nonZero-max-1</a> <a id="2531" href="Ledger.Conway.Rewards.html#2334" class="Bound">totalBlocks</a>


    <a id="2549" href="Ledger.Conway.Rewards.html#2549" class="Function">ratioBlocks</a> <a id="2561" class="Symbol">=</a> <a id="2563" class="Symbol">(</a><a id="2564" href="Agda.Builtin.Int.html#263" class="InductiveConstructor Operator">ℤ.+</a> <a id="2568" href="Ledger.Conway.Rewards.html#2323" class="Bound">poolBlocks</a><a id="2578" class="Symbol">)</a> <a id="2580" href="Data.Rational.Base.html#3884" class="Function Operator">/</a> <a id="2582" class="Symbol">(</a><a id="2583" href="Ledger.Conway.Rewards.html#69" class="Function">ℕ.max</a> <a id="2589" class="Number">1</a> <a id="2591" href="Ledger.Conway.Rewards.html#2334" class="Bound">totalBlocks</a><a id="2602" class="Symbol">)</a>


<a id="rewardOwners"></a><a id="2606" href="Ledger.Conway.Rewards.html#2606" class="Function">rewardOwners</a> <a id="2619" class="Symbol">:</a> <a id="2621" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a> <a id="2626" class="Symbol">→</a> <a id="2628" href="Ledger.Conway.Certs.html#1159" class="Record">PoolParams</a> <a id="2639" class="Symbol">→</a> <a id="2641" href="Ledger.Conway.Types.Numeric.UnitInterval.html#2124" class="Function">UnitInterval</a> <a id="2654" class="Symbol">→</a> <a id="2656" href="Ledger.Conway.Types.Numeric.UnitInterval.html#2124" class="Function">UnitInterval</a> <a id="2669" class="Symbol">→</a> <a id="2671" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a>
<a id="2676" href="Ledger.Conway.Rewards.html#2606" class="Function">rewardOwners</a> <a id="2689" href="Ledger.Conway.Rewards.html#2689" class="Bound">rewards</a> <a id="2697" href="Ledger.Conway.Rewards.html#2697" class="Bound">pool</a> <a id="2702" href="Ledger.Conway.Rewards.html#2702" class="Bound">ownerStake</a> <a id="2713" href="Ledger.Conway.Rewards.html#2713" class="Bound">stake</a> <a id="2719" class="Symbol">=</a> <a id="2721" href="Class.ToBool.html#389" class="Function Operator">if</a> <a id="2724" href="Ledger.Conway.Rewards.html#2689" class="Bound">rewards</a> <a id="2732" href="Class.HasOrder.Core.html#608" class="Field Operator">≤</a> <a id="2734" href="Ledger.Conway.Rewards.html#2948" class="Function">cost</a>
  <a id="2741" href="Class.ToBool.html#389" class="Function Operator">then</a> <a id="2746" href="Ledger.Conway.Rewards.html#2689" class="Bound">rewards</a>
  <a id="2756" href="Class.ToBool.html#389" class="Function Operator">else</a> <a id="2761" href="Ledger.Conway.Rewards.html#2948" class="Function">cost</a> <a id="2766" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="2768" href="Prelude.html#3167" class="Function">posPart</a> <a id="2776" class="Symbol">(</a><a id="2777" href="Data.Rational.Base.html#7116" class="Function">floor</a> <a id="2783" class="Symbol">(</a>
        <a id="2793" class="Symbol">(</a><a id="2794" href="Ledger.Conway.Rewards.html#602" class="Function">fromℕ</a> <a id="2800" href="Ledger.Conway.Rewards.html#2689" class="Bound">rewards</a> <a id="2808" href="Data.Rational.Base.html#6405" class="Function Operator">-</a> <a id="2810" href="Ledger.Conway.Rewards.html#602" class="Function">fromℕ</a> <a id="2816" href="Ledger.Conway.Rewards.html#2948" class="Function">cost</a><a id="2820" class="Symbol">)</a> <a id="2822" href="Data.Rational.Base.html#6315" class="Function Operator">*</a> <a id="2824" class="Symbol">(</a><a id="2825" href="Ledger.Conway.Rewards.html#2989" class="Function">margin</a> <a id="2832" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="2834" class="Symbol">(</a><a id="2835" class="Number">1</a> <a id="2837" href="Data.Rational.Base.html#6405" class="Function Operator">-</a> <a id="2839" href="Ledger.Conway.Rewards.html#2989" class="Function">margin</a><a id="2845" class="Symbol">)</a> <a id="2847" href="Data.Rational.Base.html#6315" class="Function Operator">*</a> <a id="2849" href="Ledger.Conway.Rewards.html#2875" class="Function">ratioStake</a><a id="2859" class="Symbol">)))</a>
  <a id="2865" class="Keyword">where</a>
    <a id="2875" href="Ledger.Conway.Rewards.html#2875" class="Function">ratioStake</a>   <a id="2888" class="Symbol">=</a> <a id="2890" href="Ledger.Conway.Types.Numeric.UnitInterval.html#2341" class="Function">fromUnitInterval</a> <a id="2907" href="Ledger.Conway.Rewards.html#2702" class="Bound">ownerStake</a> <a id="2918" href="Ledger.Prelude.html#2305" class="Function Operator">÷₀</a> <a id="2921" href="Ledger.Conway.Types.Numeric.UnitInterval.html#2341" class="Function">fromUnitInterval</a> <a id="2938" href="Ledger.Conway.Rewards.html#2713" class="Bound">stake</a>
    <a id="2948" href="Ledger.Conway.Rewards.html#2948" class="Function">cost</a>         <a id="2961" class="Symbol">=</a> <a id="2963" href="Ledger.Conway.Rewards.html#2697" class="Bound">pool</a> <a id="2968" class="Symbol">.</a><a id="2969" href="Ledger.Conway.Certs.html#1227" class="Field">PoolParams.cost</a>
    <a id="2989" href="Ledger.Conway.Rewards.html#2989" class="Function">margin</a>       <a id="3002" class="Symbol">=</a> <a id="3004" href="Ledger.Conway.Types.Numeric.UnitInterval.html#2341" class="Function">fromUnitInterval</a> <a id="3021" class="Symbol">(</a><a id="3022" href="Ledger.Conway.Rewards.html#2697" class="Bound">pool</a> <a id="3027" class="Symbol">.</a><a id="3028" href="Ledger.Conway.Certs.html#1254" class="Field">PoolParams.margin</a><a id="3045" class="Symbol">)</a>


<a id="rewardMember"></a><a id="3049" href="Ledger.Conway.Rewards.html#3049" class="Function">rewardMember</a> <a id="3062" class="Symbol">:</a> <a id="3064" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a> <a id="3069" class="Symbol">→</a> <a id="3071" href="Ledger.Conway.Certs.html#1159" class="Record">PoolParams</a> <a id="3082" class="Symbol">→</a> <a id="3084" href="Ledger.Conway.Types.Numeric.UnitInterval.html#2124" class="Function">UnitInterval</a> <a id="3097" class="Symbol">→</a> <a id="3099" href="Ledger.Conway.Types.Numeric.UnitInterval.html#2124" class="Function">UnitInterval</a> <a id="3112" class="Symbol">→</a> <a id="3114" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a>
<a id="3119" href="Ledger.Conway.Rewards.html#3049" class="Function">rewardMember</a> <a id="3132" href="Ledger.Conway.Rewards.html#3132" class="Bound">rewards</a> <a id="3140" href="Ledger.Conway.Rewards.html#3140" class="Bound">pool</a> <a id="3145" href="Ledger.Conway.Rewards.html#3145" class="Bound">memberStake</a> <a id="3157" href="Ledger.Conway.Rewards.html#3157" class="Bound">stake</a> <a id="3163" class="Symbol">=</a> <a id="3165" href="Class.ToBool.html#389" class="Function Operator">if</a> <a id="3168" href="Ledger.Conway.Rewards.html#3132" class="Bound">rewards</a> <a id="3176" href="Class.HasOrder.Core.html#608" class="Field Operator">≤</a> <a id="3178" href="Ledger.Conway.Rewards.html#3373" class="Function">cost</a>
  <a id="3185" href="Class.ToBool.html#389" class="Function Operator">then</a> <a id="3190" class="Number">0</a>
  <a id="3194" href="Class.ToBool.html#389" class="Function Operator">else</a> <a id="3199" href="Prelude.html#3167" class="Function">posPart</a> <a id="3207" class="Symbol">(</a><a id="3208" href="Data.Rational.Base.html#7116" class="Function">floor</a> <a id="3214" class="Symbol">(</a>
         <a id="3225" class="Symbol">(</a><a id="3226" href="Ledger.Conway.Rewards.html#602" class="Function">fromℕ</a> <a id="3232" href="Ledger.Conway.Rewards.html#3132" class="Bound">rewards</a> <a id="3240" href="Data.Rational.Base.html#6405" class="Function Operator">-</a> <a id="3242" href="Ledger.Conway.Rewards.html#602" class="Function">fromℕ</a> <a id="3248" href="Ledger.Conway.Rewards.html#3373" class="Function">cost</a><a id="3252" class="Symbol">)</a> <a id="3254" href="Data.Rational.Base.html#6315" class="Function Operator">*</a> <a id="3256" class="Symbol">((</a><a id="3258" class="Number">1</a> <a id="3260" href="Data.Rational.Base.html#6405" class="Function Operator">-</a> <a id="3262" href="Ledger.Conway.Rewards.html#3415" class="Function">margin</a><a id="3268" class="Symbol">)</a> <a id="3270" href="Data.Rational.Base.html#6315" class="Function Operator">*</a> <a id="3272" href="Ledger.Conway.Rewards.html#3298" class="Function">ratioStake</a><a id="3282" class="Symbol">)))</a>
  <a id="3288" class="Keyword">where</a>
    <a id="3298" href="Ledger.Conway.Rewards.html#3298" class="Function">ratioStake</a>    <a id="3312" class="Symbol">=</a> <a id="3314" href="Ledger.Conway.Types.Numeric.UnitInterval.html#2341" class="Function">fromUnitInterval</a> <a id="3331" href="Ledger.Conway.Rewards.html#3145" class="Bound">memberStake</a> <a id="3343" href="Ledger.Prelude.html#2305" class="Function Operator">÷₀</a> <a id="3346" href="Ledger.Conway.Types.Numeric.UnitInterval.html#2341" class="Function">fromUnitInterval</a> <a id="3363" href="Ledger.Conway.Rewards.html#3157" class="Bound">stake</a>
    <a id="3373" href="Ledger.Conway.Rewards.html#3373" class="Function">cost</a>          <a id="3387" class="Symbol">=</a> <a id="3389" href="Ledger.Conway.Rewards.html#3140" class="Bound">pool</a> <a id="3394" class="Symbol">.</a><a id="3395" href="Ledger.Conway.Certs.html#1227" class="Field">PoolParams.cost</a>
    <a id="3415" href="Ledger.Conway.Rewards.html#3415" class="Function">margin</a>        <a id="3429" class="Symbol">=</a> <a id="3431" href="Ledger.Conway.Types.Numeric.UnitInterval.html#2341" class="Function">fromUnitInterval</a> <a id="3448" class="Symbol">(</a><a id="3449" href="Ledger.Conway.Rewards.html#3140" class="Bound">pool</a> <a id="3454" class="Symbol">.</a><a id="3455" href="Ledger.Conway.Certs.html#1254" class="Field">PoolParams.margin</a><a id="3472" class="Symbol">)</a>


<a id="Stake"></a><a id="3476" href="Ledger.Conway.Rewards.html#3476" class="Function">Stake</a> <a id="3482" class="Symbol">=</a> <a id="3484" href="Ledger.Conway.Address.html#280" class="Datatype">Credential</a> <a id="3495" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="3497" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a>

<a id="rewardOnePool"></a><a id="3503" href="Ledger.Conway.Rewards.html#3503" class="Function">rewardOnePool</a> <a id="3517" class="Symbol">:</a> <a id="3519" href="Ledger.Conway.PParams.html#1605" class="Record">PParams</a> <a id="3527" class="Symbol">→</a> <a id="3529" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a> <a id="3534" class="Symbol">→</a> <a id="3536" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a> <a id="3538" class="Symbol">→</a> <a id="3540" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a> <a id="3542" class="Symbol">→</a> <a id="3544" href="Ledger.Conway.Certs.html#1159" class="Record">PoolParams</a>
  <a id="3557" class="Symbol">→</a> <a id="3559" href="Ledger.Conway.Rewards.html#3476" class="Function">Stake</a> <a id="3565" class="Symbol">→</a> <a id="3567" href="Ledger.Conway.Types.Numeric.UnitInterval.html#2124" class="Function">UnitInterval</a> <a id="3580" class="Symbol">→</a> <a id="3582" href="Ledger.Conway.Types.Numeric.UnitInterval.html#2124" class="Function">UnitInterval</a> <a id="3595" class="Symbol">→</a> <a id="3597" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a> <a id="3602" class="Symbol">→</a> <a id="3604" class="Symbol">(</a><a id="3605" href="Ledger.Conway.Address.html#280" class="Datatype">Credential</a> <a id="3616" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="3618" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a><a id="3622" class="Symbol">)</a>
<a id="3624" href="Ledger.Conway.Rewards.html#3503" class="Function">rewardOnePool</a> <a id="3638" href="Ledger.Conway.Rewards.html#3638" class="Bound">pparams</a> <a id="3646" href="Ledger.Conway.Rewards.html#3646" class="Bound">rewardPot</a> <a id="3656" href="Ledger.Conway.Rewards.html#3656" class="Bound">n</a> <a id="3658" href="Ledger.Conway.Rewards.html#3658" class="Bound">N</a> <a id="3660" href="Ledger.Conway.Rewards.html#3660" class="Bound">pool</a> <a id="3665" href="Ledger.Conway.Rewards.html#3665" class="Bound">stakeDistr</a> <a id="3676" href="Ledger.Conway.Rewards.html#3676" class="Bound">σ</a> <a id="3678" href="Ledger.Conway.Rewards.html#3678" class="Bound">σa</a> <a id="3681" href="Ledger.Conway.Rewards.html#3681" class="Bound">tot</a> <a id="3685" class="Symbol">=</a> <a id="3687" href="Ledger.Conway.Rewards.html#4397" class="Function">rewards</a>
  <a id="3697" class="Keyword">where</a>
    <a id="3707" href="Ledger.Conway.Rewards.html#3707" class="Function">mkRelativeStake</a> <a id="3723" class="Symbol">=</a> <a id="3725" class="Symbol">λ</a> <a id="3727" href="Ledger.Conway.Rewards.html#3727" class="Bound">coin</a> <a id="3732" class="Symbol">→</a> <a id="3734" href="Ledger.Conway.Types.Numeric.UnitInterval.html#3117" class="Function">clamp</a> <a id="3740" class="Symbol">(</a><a id="3741" href="Ledger.Conway.Rewards.html#3727" class="Bound">coin</a> <a id="3746" href="Ledger.Prelude.html#2186" class="Function Operator">/₀</a> <a id="3749" href="Ledger.Conway.Rewards.html#3681" class="Bound">tot</a><a id="3752" class="Symbol">)</a>
    <a id="3758" href="Ledger.Conway.Rewards.html#3758" class="Function">owners</a> <a id="3765" class="Symbol">=</a> <a id="3767" href="abstract-set-theory.FiniteSetTheory.html#519" class="Function">mapˢ</a> <a id="3772" href="Ledger.Conway.Address.html#306" class="InductiveConstructor">KeyHashObj</a> <a id="3783" class="Symbol">(</a><a id="3784" href="Ledger.Conway.Rewards.html#3660" class="Bound">pool</a> <a id="3789" class="Symbol">.</a><a id="3790" href="Ledger.Conway.Certs.html#1195" class="Field">PoolParams.owners</a><a id="3807" class="Symbol">)</a> 
    <a id="3814" href="Ledger.Conway.Rewards.html#3814" class="Function">ownerStake</a> <a id="3825" class="Symbol">=</a> <a id="3827" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">∑[</a> <a id="3830" href="Ledger.Conway.Rewards.html#3830" class="Bound">c</a> <a id="3832" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">←</a> <a id="3834" href="Ledger.Conway.Rewards.html#3665" class="Bound">stakeDistr</a> <a id="3845" href="Axiom.Set.Map.html#10678" class="Function Operator">∣</a> <a id="3847" href="Ledger.Conway.Rewards.html#3758" class="Function">owners</a> <a id="3854" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">]</a> <a id="3856" href="Ledger.Conway.Rewards.html#3830" class="Bound">c</a>
    <a id="3862" href="Ledger.Conway.Rewards.html#3862" class="Function">pledge</a> <a id="3869" class="Symbol">=</a> <a id="3871" href="Ledger.Conway.Rewards.html#3660" class="Bound">pool</a> <a id="3876" class="Symbol">.</a><a id="3877" href="Ledger.Conway.Certs.html#1289" class="Field">PoolParams.pledge</a>
    <a id="3899" href="Ledger.Conway.Rewards.html#3899" class="Function">maxP</a> <a id="3904" class="Symbol">=</a> <a id="3906" href="Class.ToBool.html#389" class="Function Operator">if</a> <a id="3909" href="Ledger.Conway.Rewards.html#3862" class="Function">pledge</a> <a id="3916" href="Class.HasOrder.Core.html#608" class="Field Operator">≤</a> <a id="3918" href="Ledger.Conway.Rewards.html#3814" class="Function">ownerStake</a>
      <a id="3935" href="Class.ToBool.html#389" class="Function Operator">then</a> <a id="3940" href="Ledger.Conway.Rewards.html#1429" class="Function">maxPool</a> <a id="3948" href="Ledger.Conway.Rewards.html#3638" class="Bound">pparams</a> <a id="3956" href="Ledger.Conway.Rewards.html#3646" class="Bound">rewardPot</a> <a id="3966" href="Ledger.Conway.Rewards.html#3676" class="Bound">σ</a> <a id="3968" class="Symbol">(</a><a id="3969" href="Ledger.Conway.Rewards.html#3707" class="Function">mkRelativeStake</a> <a id="3985" href="Ledger.Conway.Rewards.html#3862" class="Function">pledge</a><a id="3991" class="Symbol">)</a>
      <a id="3999" href="Class.ToBool.html#389" class="Function Operator">else</a> <a id="4004" class="Number">0</a>
    <a id="4010" href="Ledger.Conway.Rewards.html#4010" class="Function">apparentPerformance</a> <a id="4030" class="Symbol">=</a> <a id="4032" href="Ledger.Conway.Rewards.html#2246" class="Function">mkApparentPerformance</a> <a id="4054" href="Ledger.Conway.Rewards.html#3678" class="Bound">σa</a> <a id="4057" href="Ledger.Conway.Rewards.html#3656" class="Bound">n</a> <a id="4059" href="Ledger.Conway.Rewards.html#3658" class="Bound">N</a>
    <a id="4065" href="Ledger.Conway.Rewards.html#4065" class="Function">poolReward</a> <a id="4076" class="Symbol">=</a> <a id="4078" href="Prelude.html#3167" class="Function">posPart</a> <a id="4086" class="Symbol">(</a><a id="4087" href="Data.Rational.Base.html#7116" class="Function">floor</a> <a id="4093" class="Symbol">(</a><a id="4094" href="Ledger.Conway.Rewards.html#4010" class="Function">apparentPerformance</a> <a id="4114" href="Data.Rational.Base.html#6315" class="Function Operator">*</a> <a id="4116" href="Ledger.Conway.Rewards.html#602" class="Function">fromℕ</a> <a id="4122" href="Ledger.Conway.Rewards.html#3899" class="Function">maxP</a><a id="4126" class="Symbol">))</a>
    <a id="4133" href="Ledger.Conway.Rewards.html#4133" class="Function">memberRewards</a> <a id="4147" class="Symbol">=</a>
      <a id="4155" href="Axiom.Set.Map.html#6068" class="Function">mapValues</a> <a id="4165" class="Symbol">(λ</a> <a id="4168" href="Ledger.Conway.Rewards.html#4168" class="Bound">coin</a> <a id="4173" class="Symbol">→</a> <a id="4175" href="Ledger.Conway.Rewards.html#3049" class="Function">rewardMember</a> <a id="4188" href="Ledger.Conway.Rewards.html#4065" class="Function">poolReward</a> <a id="4199" href="Ledger.Conway.Rewards.html#3660" class="Bound">pool</a> <a id="4204" class="Symbol">(</a><a id="4205" href="Ledger.Conway.Rewards.html#3707" class="Function">mkRelativeStake</a> <a id="4221" href="Ledger.Conway.Rewards.html#4168" class="Bound">coin</a><a id="4225" class="Symbol">)</a> <a id="4227" href="Ledger.Conway.Rewards.html#3676" class="Bound">σ</a><a id="4228" class="Symbol">)</a>
        <a id="4238" class="Symbol">(</a><a id="4239" href="Ledger.Conway.Rewards.html#3665" class="Bound">stakeDistr</a> <a id="4250" href="Axiom.Set.Map.html#10748" class="Function Operator">∣</a> <a id="4252" href="Ledger.Conway.Rewards.html#3758" class="Function">owners</a> <a id="4259" href="Axiom.Set.Map.html#10748" class="Function Operator">ᶜ</a><a id="4260" class="Symbol">)</a>
    <a id="4266" href="Ledger.Conway.Rewards.html#4266" class="Function">ownersRewards</a>  <a id="4281" class="Symbol">=</a>
      <a id="4289" href="Axiom.Set.Map.html#4588" class="Function Operator">❴</a> <a id="4291" href="Ledger.Conway.Rewards.html#3660" class="Bound">pool</a> <a id="4296" class="Symbol">.</a><a id="4297" href="Ledger.Conway.Certs.html#1316" class="Field">PoolParams.rewardAccount</a>
      <a id="4328" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="4330" href="Ledger.Conway.Rewards.html#2606" class="Function">rewardOwners</a> <a id="4343" href="Ledger.Conway.Rewards.html#4065" class="Function">poolReward</a> <a id="4354" href="Ledger.Conway.Rewards.html#3660" class="Bound">pool</a> <a id="4359" class="Symbol">(</a><a id="4360" href="Ledger.Conway.Rewards.html#3707" class="Function">mkRelativeStake</a> <a id="4376" href="Ledger.Conway.Rewards.html#3814" class="Function">ownerStake</a><a id="4386" class="Symbol">)</a> <a id="4388" href="Ledger.Conway.Rewards.html#3676" class="Bound">σ</a> <a id="4390" href="Axiom.Set.Map.html#4588" class="Function Operator">❵ᵐ</a>
    <a id="4397" href="Ledger.Conway.Rewards.html#4397" class="Function">rewards</a> <a id="4405" class="Symbol">=</a> <a id="4407" href="Ledger.Conway.Rewards.html#4133" class="Function">memberRewards</a> <a id="4421" href="Axiom.Set.Map.Dec.html#1854" class="Function Operator">∪⁺</a> <a id="4424" href="Ledger.Conway.Rewards.html#4266" class="Function">ownersRewards</a>


<a id="Delegations"></a><a id="4440" href="Ledger.Conway.Rewards.html#4440" class="Function">Delegations</a> <a id="4452" class="Symbol">=</a> <a id="4454" href="Ledger.Conway.Address.html#280" class="Datatype">Credential</a> <a id="4465" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="4467" href="Ledger.Conway.Crypto.html#1317" class="Function">KeyHash</a>

<a id="poolStake"></a><a id="4476" href="Ledger.Conway.Rewards.html#4476" class="Function">poolStake</a>  <a id="4487" class="Symbol">:</a> <a id="4489" href="Ledger.Conway.Crypto.html#1317" class="Function">KeyHash</a> <a id="4497" class="Symbol">→</a> <a id="4499" href="Ledger.Conway.Rewards.html#4440" class="Function">Delegations</a> <a id="4511" class="Symbol">→</a> <a id="4513" href="Ledger.Conway.Rewards.html#3476" class="Function">Stake</a> <a id="4519" class="Symbol">→</a> <a id="4521" href="Ledger.Conway.Rewards.html#3476" class="Function">Stake</a>
<a id="4527" href="Ledger.Conway.Rewards.html#4476" class="Function">poolStake</a> <a id="4537" href="Ledger.Conway.Rewards.html#4537" class="Bound">hk</a> <a id="4540" href="Ledger.Conway.Rewards.html#4540" class="Bound">delegs</a> <a id="4547" href="Ledger.Conway.Rewards.html#4547" class="Bound">stake</a> <a id="4553" class="Symbol">=</a> <a id="4555" href="Ledger.Conway.Rewards.html#4547" class="Bound">stake</a> <a id="4561" href="Axiom.Set.Map.html#10678" class="Function Operator">∣</a> <a id="4563" href="Class.IsSet.html#916" class="Function">dom</a> <a id="4567" class="Symbol">(</a><a id="4568" href="Ledger.Conway.Rewards.html#4540" class="Bound">delegs</a> <a id="4575" href="Axiom.Set.Map.html#14048" class="Function Operator">∣^</a> <a id="4578" href="Class.HasSingleton.html#288" class="Field Operator">❴</a> <a id="4580" href="Ledger.Conway.Rewards.html#4537" class="Bound">hk</a> <a id="4583" href="Class.HasSingleton.html#288" class="Field Operator">❵</a><a id="4584" class="Symbol">)</a>


<a id="BlocksMade"></a><a id="4588" href="Ledger.Conway.Rewards.html#4588" class="Function">BlocksMade</a> <a id="4599" class="Symbol">=</a> <a id="4601" href="Ledger.Conway.Crypto.html#1317" class="Function">KeyHash</a> <a id="4609" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="4611" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a>

<a id="uncurryᵐ"></a><a id="4614" href="Ledger.Conway.Rewards.html#4614" class="Function">uncurryᵐ</a> <a id="4623" class="Symbol">:</a>


  <a id="4629" class="Symbol">∀</a> <a id="4631" class="Symbol">{</a><a id="4632" href="Ledger.Conway.Rewards.html#4632" class="Bound">A</a> <a id="4634" href="Ledger.Conway.Rewards.html#4634" class="Bound">B</a> <a id="4636" href="Ledger.Conway.Rewards.html#4636" class="Bound">C</a> <a id="4638" class="Symbol">:</a> <a id="4640" href="Agda.Primitive.html#388" class="Primitive">Type</a><a id="4644" class="Symbol">}</a> <a id="4646" class="Symbol">⦃</a> <a id="4648" href="Ledger.Conway.Rewards.html#4648" class="Bound">_</a> <a id="4650" class="Symbol">:</a> <a id="4652" href="Class.DecEq.Core.html#117" class="Record">DecEq</a> <a id="4658" href="Ledger.Conway.Rewards.html#4632" class="Bound">A</a> <a id="4660" class="Symbol">⦄</a> <a id="4662" class="Symbol">⦃</a> <a id="4664" href="Ledger.Conway.Rewards.html#4664" class="Bound">_</a> <a id="4666" class="Symbol">:</a> <a id="4668" href="Class.DecEq.Core.html#117" class="Record">DecEq</a> <a id="4674" href="Ledger.Conway.Rewards.html#4634" class="Bound">B</a> <a id="4676" class="Symbol">⦄</a> <a id="4678" class="Symbol">→</a>


  <a id="4684" href="Ledger.Conway.Rewards.html#4632" class="Bound">A</a> <a id="4686" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="4688" class="Symbol">(</a><a id="4689" href="Ledger.Conway.Rewards.html#4634" class="Bound">B</a> <a id="4691" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="4693" href="Ledger.Conway.Rewards.html#4636" class="Bound">C</a><a id="4694" class="Symbol">)</a> <a id="4696" class="Symbol">→</a> <a id="4698" class="Symbol">(</a><a id="4699" href="Ledger.Conway.Rewards.html#4632" class="Bound">A</a> <a id="4701" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="4703" href="Ledger.Conway.Rewards.html#4634" class="Bound">B</a><a id="4704" class="Symbol">)</a> <a id="4706" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="4708" href="Ledger.Conway.Rewards.html#4636" class="Bound">C</a>


<a id="4712" href="Ledger.Conway.Rewards.html#4614" class="Function">uncurryᵐ</a> <a id="4721" class="Symbol">{</a><a id="4722" href="Ledger.Conway.Rewards.html#4722" class="Bound">A</a><a id="4723" class="Symbol">}</a> <a id="4725" class="Symbol">{</a><a id="4726" href="Ledger.Conway.Rewards.html#4726" class="Bound">B</a><a id="4727" class="Symbol">}</a> <a id="4729" class="Symbol">{</a><a id="4730" href="Ledger.Conway.Rewards.html#4730" class="Bound">C</a><a id="4731" class="Symbol">}</a> <a id="4733" href="Ledger.Conway.Rewards.html#4733" class="Bound">abc</a> <a id="4737" class="Symbol">=</a> <a id="4739" href="Axiom.Set.Map.html#10460" class="Function">mapFromPartialFun</a> <a id="4757" href="Ledger.Conway.Rewards.html#4785" class="Function">lookup&#39;</a> <a id="4765" href="Ledger.Conway.Rewards.html#4943" class="Function">domain&#39;</a>
  <a id="4775" class="Keyword">where</a>
    <a id="4785" href="Ledger.Conway.Rewards.html#4785" class="Function">lookup&#39;</a> <a id="4793" class="Symbol">:</a> <a id="4795" class="Symbol">(</a><a id="4796" href="Ledger.Conway.Rewards.html#4722" class="Bound">A</a> <a id="4798" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="4800" href="Ledger.Conway.Rewards.html#4726" class="Bound">B</a><a id="4801" class="Symbol">)</a> <a id="4803" class="Symbol">→</a> <a id="4805" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="4811" href="Ledger.Conway.Rewards.html#4730" class="Bound">C</a>
    <a id="4817" href="Ledger.Conway.Rewards.html#4785" class="Function">lookup&#39;</a> <a id="4825" class="Symbol">(</a><a id="4826" href="Ledger.Conway.Rewards.html#4826" class="Bound">a</a> <a id="4828" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="4830" href="Ledger.Conway.Rewards.html#4830" class="Bound">b</a><a id="4831" class="Symbol">)</a> <a id="4833" class="Symbol">=</a> <a id="4835" href="Axiom.Set.Map.html#13670" class="Function">lookupᵐ?</a> <a id="4844" href="Ledger.Conway.Rewards.html#4733" class="Bound">abc</a> <a id="4848" href="Ledger.Conway.Rewards.html#4826" class="Bound">a</a> <a id="4850" href="Class.Monad.Core.html#299" class="Field Operator">&gt;&gt;=</a> <a id="4854" class="Symbol">(λ</a> <a id="4857" href="Ledger.Conway.Rewards.html#4857" class="Bound">bc</a> <a id="4860" class="Symbol">→</a> <a id="4862" href="Axiom.Set.Map.html#13670" class="Function">lookupᵐ?</a> <a id="4871" href="Ledger.Conway.Rewards.html#4857" class="Bound">bc</a> <a id="4874" href="Ledger.Conway.Rewards.html#4830" class="Bound">b</a><a id="4875" class="Symbol">)</a>

    <a id="4882" href="Ledger.Conway.Rewards.html#4882" class="Function">joinˢ</a> <a id="4888" class="Symbol">:</a> <a id="4890" class="Symbol">∀</a> <a id="4892" class="Symbol">{</a><a id="4893" href="Ledger.Conway.Rewards.html#4893" class="Bound">X</a><a id="4894" class="Symbol">}</a> <a id="4896" class="Symbol">→</a> <a id="4898" href="abstract-set-theory.FiniteSetTheory.html#488" class="Function Operator">ℙ</a> <a id="4900" class="Symbol">(</a><a id="4901" href="abstract-set-theory.FiniteSetTheory.html#488" class="Function Operator">ℙ</a> <a id="4903" href="Ledger.Conway.Rewards.html#4893" class="Bound">X</a><a id="4904" class="Symbol">)</a> <a id="4906" class="Symbol">→</a> <a id="4908" href="abstract-set-theory.FiniteSetTheory.html#488" class="Function Operator">ℙ</a> <a id="4910" href="Ledger.Conway.Rewards.html#4893" class="Bound">X</a>
    <a id="4916" href="Ledger.Conway.Rewards.html#4882" class="Function">joinˢ</a> <a id="4922" class="Symbol">=</a> <a id="4924" href="Axiom.Set.html#7022" class="Function">concatMapˢ</a> <a id="4935" href="Function.Base.html#704" class="Function">id</a>

    <a id="4943" href="Ledger.Conway.Rewards.html#4943" class="Function">domain&#39;</a> <a id="4951" class="Symbol">:</a> <a id="4953" href="abstract-set-theory.FiniteSetTheory.html#488" class="Function Operator">ℙ</a> <a id="4955" class="Symbol">(</a><a id="4956" href="Ledger.Conway.Rewards.html#4722" class="Bound">A</a> <a id="4958" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="4960" href="Ledger.Conway.Rewards.html#4726" class="Bound">B</a><a id="4961" class="Symbol">)</a>
    <a id="4967" href="Ledger.Conway.Rewards.html#4943" class="Function">domain&#39;</a> <a id="4975" class="Symbol">=</a> <a id="4977" href="Ledger.Conway.Rewards.html#4882" class="Function">joinˢ</a> <a id="4983" class="Symbol">(</a><a id="4984" href="Class.IsSet.html#959" class="Function">range</a> <a id="4990" class="Symbol">(</a><a id="4991" href="Axiom.Set.Map.html#8706" class="Function">mapWithKey</a> <a id="5002" class="Symbol">(λ</a> <a id="5005" href="Ledger.Conway.Rewards.html#5005" class="Bound">a</a> <a id="5007" href="Ledger.Conway.Rewards.html#5007" class="Bound">bc</a> <a id="5010" class="Symbol">→</a> <a id="5012" href="Class.IsSet.html#959" class="Function">range</a> <a id="5018" class="Symbol">(</a><a id="5019" href="Axiom.Set.Map.html#8706" class="Function">mapWithKey</a> <a id="5030" class="Symbol">(λ</a> <a id="5033" href="Ledger.Conway.Rewards.html#5033" class="Bound">b</a> <a id="5035" href="Ledger.Conway.Rewards.html#5035" class="Bound">_</a> <a id="5037" class="Symbol">→</a> <a id="5039" class="Symbol">(</a><a id="5040" href="Ledger.Conway.Rewards.html#5005" class="Bound">a</a> <a id="5042" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5044" href="Ledger.Conway.Rewards.html#5033" class="Bound">b</a><a id="5045" class="Symbol">))</a> <a id="5048" href="Ledger.Conway.Rewards.html#5007" class="Bound">bc</a><a id="5050" class="Symbol">))</a> <a id="5053" href="Ledger.Conway.Rewards.html#4733" class="Bound">abc</a><a id="5056" class="Symbol">))</a>



<a id="reward"></a><a id="5062" href="Ledger.Conway.Rewards.html#5062" class="Function">reward</a> <a id="5069" class="Symbol">:</a> <a id="5071" href="Ledger.Conway.PParams.html#1605" class="Record">PParams</a> <a id="5079" class="Symbol">→</a> <a id="5081" href="Ledger.Conway.Rewards.html#4588" class="Function">BlocksMade</a> <a id="5092" class="Symbol">→</a> <a id="5094" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a> <a id="5099" class="Symbol">→</a> <a id="5101" class="Symbol">(</a><a id="5102" href="Ledger.Conway.Crypto.html#1317" class="Function">KeyHash</a> <a id="5110" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="5112" href="Ledger.Conway.Certs.html#1159" class="Record">PoolParams</a><a id="5122" class="Symbol">)</a>
  <a id="5126" class="Symbol">→</a> <a id="5128" href="Ledger.Conway.Rewards.html#3476" class="Function">Stake</a> <a id="5134" class="Symbol">→</a> <a id="5136" href="Ledger.Conway.Rewards.html#4440" class="Function">Delegations</a> <a id="5148" class="Symbol">→</a> <a id="5150" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a> <a id="5155" class="Symbol">→</a> <a id="5157" class="Symbol">(</a><a id="5158" href="Ledger.Conway.Address.html#280" class="Datatype">Credential</a> <a id="5169" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="5171" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a><a id="5175" class="Symbol">)</a>
<a id="5177" href="Ledger.Conway.Rewards.html#5062" class="Function">reward</a> <a id="5184" href="Ledger.Conway.Rewards.html#5184" class="Bound">pp</a> <a id="5187" href="Ledger.Conway.Rewards.html#5187" class="Bound">blocks</a> <a id="5194" href="Ledger.Conway.Rewards.html#5194" class="Bound">rewardPot</a> <a id="5204" href="Ledger.Conway.Rewards.html#5204" class="Bound">poolParams</a> <a id="5215" href="Ledger.Conway.Rewards.html#5215" class="Bound">stake</a> <a id="5221" href="Ledger.Conway.Rewards.html#5221" class="Bound">delegs</a> <a id="5228" href="Ledger.Conway.Rewards.html#5228" class="Bound">total</a> <a id="5234" class="Symbol">=</a> <a id="5236" href="Ledger.Conway.Rewards.html#5761" class="Function">rewards</a>
  <a id="5246" class="Keyword">where</a>
    <a id="5256" href="Ledger.Conway.Rewards.html#5256" class="Function">active</a> <a id="5263" class="Symbol">=</a> <a id="5265" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">∑[</a> <a id="5268" href="Ledger.Conway.Rewards.html#5268" class="Bound">c</a> <a id="5270" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">←</a> <a id="5272" href="Ledger.Conway.Rewards.html#5215" class="Bound">stake</a> <a id="5278" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">]</a> <a id="5280" href="Ledger.Conway.Rewards.html#5268" class="Bound">c</a>
    <a id="5286" href="Ledger.Conway.Rewards.html#5286" class="Function Operator">Σ_/total</a> <a id="5295" class="Symbol">=</a> <a id="5297" class="Symbol">λ</a> <a id="5299" href="Ledger.Conway.Rewards.html#5299" class="Bound">st</a> <a id="5302" class="Symbol">→</a> <a id="5304" href="Ledger.Conway.Types.Numeric.UnitInterval.html#3117" class="Function">clamp</a> <a id="5310" class="Symbol">((</a><a id="5312" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">∑[</a> <a id="5315" href="Ledger.Conway.Rewards.html#5315" class="Bound">c</a> <a id="5317" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">←</a> <a id="5319" href="Ledger.Conway.Rewards.html#5299" class="Bound">st</a> <a id="5322" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">]</a> <a id="5324" href="Ledger.Conway.Rewards.html#5315" class="Bound">c</a><a id="5325" class="Symbol">)</a> <a id="5327" href="Ledger.Prelude.html#2186" class="Function Operator">/₀</a> <a id="5330" href="Ledger.Conway.Rewards.html#5228" class="Bound">total</a><a id="5335" class="Symbol">)</a>
    <a id="5341" href="Ledger.Conway.Rewards.html#5341" class="Function Operator">Σ_/active</a> <a id="5351" class="Symbol">=</a> <a id="5353" class="Symbol">λ</a> <a id="5355" href="Ledger.Conway.Rewards.html#5355" class="Bound">st</a> <a id="5358" class="Symbol">→</a> <a id="5360" href="Ledger.Conway.Types.Numeric.UnitInterval.html#3117" class="Function">clamp</a> <a id="5366" class="Symbol">((</a><a id="5368" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">∑[</a> <a id="5371" href="Ledger.Conway.Rewards.html#5371" class="Bound">c</a> <a id="5373" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">←</a> <a id="5375" href="Ledger.Conway.Rewards.html#5355" class="Bound">st</a> <a id="5378" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">]</a> <a id="5380" href="Ledger.Conway.Rewards.html#5371" class="Bound">c</a><a id="5381" class="Symbol">)</a> <a id="5383" href="Ledger.Prelude.html#2186" class="Function Operator">/₀</a> <a id="5386" href="Ledger.Conway.Rewards.html#5256" class="Function">active</a><a id="5392" class="Symbol">)</a>
    <a id="5398" href="Ledger.Conway.Rewards.html#5398" class="Function">N</a> <a id="5400" class="Symbol">=</a> <a id="5402" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">∑[</a> <a id="5405" href="Ledger.Conway.Rewards.html#5405" class="Bound">m</a> <a id="5407" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">←</a> <a id="5409" href="Ledger.Conway.Rewards.html#5187" class="Bound">blocks</a> <a id="5416" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">]</a> <a id="5418" href="Ledger.Conway.Rewards.html#5405" class="Bound">m</a>
    <a id="5424" href="Ledger.Conway.Rewards.html#5424" class="Function">mkPoolData</a> <a id="5435" class="Symbol">=</a> <a id="5437" class="Symbol">λ</a> <a id="5439" href="Ledger.Conway.Rewards.html#5439" class="Bound">hk</a> <a id="5442" href="Ledger.Conway.Rewards.html#5442" class="Bound">p</a> <a id="5444" class="Symbol">→</a>
      <a id="5452" href="Class.Functor.Core.html#272" class="Function">map</a> <a id="5456" class="Symbol">(λ</a> <a id="5459" href="Ledger.Conway.Rewards.html#5459" class="Bound">n</a> <a id="5461" class="Symbol">→</a> <a id="5463" class="Symbol">(</a><a id="5464" href="Ledger.Conway.Rewards.html#5459" class="Bound">n</a> <a id="5466" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5468" href="Ledger.Conway.Rewards.html#5442" class="Bound">p</a> <a id="5470" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5472" href="Ledger.Conway.Rewards.html#4476" class="Function">poolStake</a> <a id="5482" href="Ledger.Conway.Rewards.html#5439" class="Bound">hk</a> <a id="5485" href="Ledger.Conway.Rewards.html#5221" class="Bound">delegs</a> <a id="5492" href="Ledger.Conway.Rewards.html#5215" class="Bound">stake</a><a id="5497" class="Symbol">))</a> <a id="5500" class="Symbol">(</a><a id="5501" href="Axiom.Set.Map.html#13670" class="Function">lookupᵐ?</a> <a id="5510" href="Ledger.Conway.Rewards.html#5187" class="Bound">blocks</a> <a id="5517" href="Ledger.Conway.Rewards.html#5439" class="Bound">hk</a><a id="5519" class="Symbol">)</a>
    <a id="5525" href="Ledger.Conway.Rewards.html#5525" class="Function">pdata</a> <a id="5531" class="Symbol">=</a> <a id="5533" href="Axiom.Set.Map.html#10313" class="Function">mapMaybeWithKeyᵐ</a> <a id="5550" href="Ledger.Conway.Rewards.html#5424" class="Function">mkPoolData</a> <a id="5561" href="Ledger.Conway.Rewards.html#5204" class="Bound">poolParams</a>

    <a id="5577" href="Ledger.Conway.Rewards.html#5577" class="Function">results</a>  <a id="5586" class="Symbol">:</a> <a id="5588" class="Symbol">(</a><a id="5589" href="Ledger.Conway.Crypto.html#1317" class="Function">KeyHash</a> <a id="5597" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="5599" href="Ledger.Conway.Address.html#280" class="Datatype">Credential</a><a id="5609" class="Symbol">)</a> <a id="5611" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="5613" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a>
    <a id="5622" href="Ledger.Conway.Rewards.html#5577" class="Function">results</a> <a id="5630" class="Symbol">=</a> <a id="5632" href="Ledger.Conway.Rewards.html#4614" class="Function">uncurryᵐ</a> <a id="5641" class="Symbol">(</a><a id="5642" href="Axiom.Set.Map.html#6068" class="Function">mapValues</a> <a id="5652" class="Symbol">(λ</a> <a id="5655" class="Symbol">(</a><a id="5656" href="Ledger.Conway.Rewards.html#5656" class="Bound">n</a> <a id="5658" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5660" href="Ledger.Conway.Rewards.html#5660" class="Bound">p</a> <a id="5662" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5664" href="Ledger.Conway.Rewards.html#5664" class="Bound">s</a><a id="5665" class="Symbol">)</a>
      <a id="5673" class="Symbol">→</a> <a id="5675" href="Ledger.Conway.Rewards.html#3503" class="Function">rewardOnePool</a> <a id="5689" href="Ledger.Conway.Rewards.html#5184" class="Bound">pp</a> <a id="5692" href="Ledger.Conway.Rewards.html#5194" class="Bound">rewardPot</a> <a id="5702" href="Ledger.Conway.Rewards.html#5656" class="Bound">n</a> <a id="5704" href="Ledger.Conway.Rewards.html#5398" class="Function">N</a> <a id="5706" href="Ledger.Conway.Rewards.html#5660" class="Bound">p</a> <a id="5708" href="Ledger.Conway.Rewards.html#5664" class="Bound">s</a> <a id="5710" class="Symbol">(</a><a id="5711" href="Ledger.Conway.Rewards.html#5286" class="Function Operator">Σ</a> <a id="5713" href="Ledger.Conway.Rewards.html#5664" class="Bound">s</a> <a id="5715" href="Ledger.Conway.Rewards.html#5286" class="Function Operator">/total</a><a id="5721" class="Symbol">)</a> <a id="5723" class="Symbol">(</a><a id="5724" href="Ledger.Conway.Rewards.html#5341" class="Function Operator">Σ</a> <a id="5726" href="Ledger.Conway.Rewards.html#5664" class="Bound">s</a> <a id="5728" href="Ledger.Conway.Rewards.html#5341" class="Function Operator">/active</a><a id="5735" class="Symbol">)</a> <a id="5737" href="Ledger.Conway.Rewards.html#5228" class="Bound">total</a><a id="5742" class="Symbol">)</a>
      <a id="5750" href="Ledger.Conway.Rewards.html#5525" class="Function">pdata</a><a id="5755" class="Symbol">)</a>
    <a id="5761" href="Ledger.Conway.Rewards.html#5761" class="Function">rewards</a>  <a id="5770" class="Symbol">=</a> <a id="5772" href="abstract-set-theory.FiniteSetTheory.html#3599" class="Function">aggregateBy</a>
      <a id="5790" class="Symbol">(</a><a id="5791" href="abstract-set-theory.FiniteSetTheory.html#519" class="Function">mapˢ</a> <a id="5796" class="Symbol">(λ</a> <a id="5799" class="Symbol">(</a><a id="5800" href="Ledger.Conway.Rewards.html#5800" class="Bound">kh</a> <a id="5803" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5805" href="Ledger.Conway.Rewards.html#5805" class="Bound">cred</a><a id="5809" class="Symbol">)</a> <a id="5811" class="Symbol">→</a> <a id="5813" class="Symbol">(</a><a id="5814" href="Ledger.Conway.Rewards.html#5800" class="Bound">kh</a> <a id="5817" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5819" href="Ledger.Conway.Rewards.html#5805" class="Bound">cred</a><a id="5823" class="Symbol">)</a> <a id="5825" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5827" href="Ledger.Conway.Rewards.html#5805" class="Bound">cred</a><a id="5831" class="Symbol">)</a> <a id="5833" class="Symbol">(</a><a id="5834" href="Class.IsSet.html#916" class="Function">dom</a> <a id="5838" href="Ledger.Conway.Rewards.html#5577" class="Function">results</a><a id="5845" class="Symbol">))</a>
      <a id="5854" href="Ledger.Conway.Rewards.html#5577" class="Function">results</a>


<a id="5864" class="Keyword">record</a> <a id="RewardUpdate"></a><a id="5871" href="Ledger.Conway.Rewards.html#5871" class="Record">RewardUpdate</a> <a id="5884" class="Symbol">:</a> <a id="5886" href="Agda.Primitive.html#388" class="Primitive">Set</a> <a id="5890" class="Keyword">where</a>


  <a id="5900" class="Keyword">constructor</a> <a id="⟦_,_,_,_⟧ʳᵘ"></a><a id="5912" href="Ledger.Conway.Rewards.html#5912" class="InductiveConstructor Operator">⟦_,_,_,_⟧ʳᵘ</a>


  <a id="5928" class="Keyword">field</a>
    <a id="RewardUpdate.Δt"></a><a id="5938" href="Ledger.Conway.Rewards.html#5938" class="Field">Δt</a> <a id="RewardUpdate.Δr"></a><a id="5941" href="Ledger.Conway.Rewards.html#5941" class="Field">Δr</a> <a id="RewardUpdate.Δf"></a><a id="5944" href="Ledger.Conway.Rewards.html#5944" class="Field">Δf</a> <a id="5947" class="Symbol">:</a> <a id="5949" href="Agda.Builtin.Int.html#245" class="Datatype">ℤ</a>
    <a id="RewardUpdate.rs"></a><a id="5955" href="Ledger.Conway.Rewards.html#5955" class="Field">rs</a> <a id="5958" class="Symbol">:</a> <a id="5960" href="Ledger.Conway.Address.html#280" class="Datatype">Credential</a> <a id="5971" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="5973" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a>


<a id="5980" class="Keyword">record</a> <a id="Snapshot"></a><a id="5987" href="Ledger.Conway.Rewards.html#5987" class="Record">Snapshot</a> <a id="5996" class="Symbol">:</a> <a id="5998" href="Agda.Primitive.html#388" class="Primitive">Set</a> <a id="6002" class="Keyword">where</a>
  <a id="6010" class="Keyword">field</a>
    <a id="Snapshot.stake"></a><a id="6020" href="Ledger.Conway.Rewards.html#6020" class="Field">stake</a>           <a id="6036" class="Symbol">:</a> <a id="6038" href="Ledger.Conway.Address.html#280" class="Datatype">Credential</a> <a id="6049" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="6051" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a>
    <a id="Snapshot.delegations"></a><a id="6060" href="Ledger.Conway.Rewards.html#6060" class="Field">delegations</a>     <a id="6076" class="Symbol">:</a> <a id="6078" href="Ledger.Conway.Address.html#280" class="Datatype">Credential</a> <a id="6089" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="6091" href="Ledger.Conway.Crypto.html#1317" class="Function">KeyHash</a>
    <a id="Snapshot.poolParameters"></a><a id="6103" href="Ledger.Conway.Rewards.html#6103" class="Field">poolParameters</a>  <a id="6119" class="Symbol">:</a> <a id="6121" href="Ledger.Conway.Crypto.html#1317" class="Function">KeyHash</a> <a id="6129" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="6131" href="Ledger.Conway.Certs.html#1159" class="Record">PoolParams</a>



<a id="6145" class="Keyword">instance</a>
  <a id="6156" class="Keyword">unquoteDecl</a> <a id="HasCast-Snapshot"></a><a id="6168" href="Ledger.Conway.Rewards.html#6168" class="Function">HasCast-Snapshot</a> <a id="6185" class="Symbol">=</a>
    <a id="6191" href="stdlib-classes.Class.HasCast.Derive.html#2690" class="Function">derive-HasCast</a> <a id="6206" href="Data.List.Base.html#5205" class="Function Operator">[</a> <a id="6208" class="Symbol">(</a><a id="6209" class="Keyword">quote</a> <a id="6215" href="Ledger.Conway.Rewards.html#5987" class="Record">Snapshot</a> <a id="6224" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="6226" href="Ledger.Conway.Rewards.html#6168" class="Function">HasCast-Snapshot</a><a id="6242" class="Symbol">)</a> <a id="6244" href="Data.List.Base.html#5205" class="Function Operator">]</a>


<a id="6248" class="Keyword">private</a>
  <a id="getStakeCred"></a><a id="6258" href="Ledger.Conway.Rewards.html#6258" class="Function">getStakeCred</a> <a id="6271" class="Symbol">:</a> <a id="6273" href="Ledger.Conway.Transaction.html#2405" class="Function">TxOut</a> <a id="6279" class="Symbol">→</a> <a id="6281" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="6287" href="Ledger.Conway.Address.html#280" class="Datatype">Credential</a>
  <a id="6300" href="Ledger.Conway.Rewards.html#6258" class="Function">getStakeCred</a> <a id="6313" class="Symbol">(</a><a id="6314" href="Ledger.Conway.Rewards.html#6314" class="Bound">a</a> <a id="6316" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="6318" class="Symbol">_</a> <a id="6320" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="6322" class="Symbol">_</a> <a id="6324" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="6326" class="Symbol">_)</a> <a id="6329" class="Symbol">=</a> <a id="6331" href="Ledger.Conway.Address.html#2516" class="Function">stakeCred</a> <a id="6341" href="Ledger.Conway.Rewards.html#6314" class="Bound">a</a>


<a id="stakeDistr"></a><a id="6345" href="Ledger.Conway.Rewards.html#6345" class="Function">stakeDistr</a> <a id="6356" class="Symbol">:</a> <a id="6358" href="Ledger.Conway.Transaction.html#2473" class="Function">UTxO</a> <a id="6363" class="Symbol">→</a> <a id="6365" href="Ledger.Conway.Certs.html#3199" class="Record">DState</a> <a id="6372" class="Symbol">→</a> <a id="6374" href="Ledger.Conway.Certs.html#3809" class="Record">PState</a> <a id="6381" class="Symbol">→</a> <a id="6383" href="Ledger.Conway.Rewards.html#5987" class="Record">Snapshot</a>
<a id="6392" href="Ledger.Conway.Rewards.html#6345" class="Function">stakeDistr</a> <a id="6403" href="Ledger.Conway.Rewards.html#6403" class="Bound">utxo</a> <a id="6408" href="Ledger.Conway.Rewards.html#6408" class="Bound">stᵈ</a> <a id="6412" href="Ledger.Conway.Rewards.html#6412" class="Bound">pState</a> <a id="6419" class="Symbol">=</a>
    <a id="6425" href="Ledger.Prelude.html#2441" class="Function Operator">⟦</a> <a id="6427" href="Axiom.Set.Map.Dec.html#1932" class="Function">aggregate₊</a> <a id="6438" class="Symbol">(</a><a id="6439" href="Ledger.Conway.Rewards.html#6676" class="Function">stakeRelation</a> <a id="6453" href="abstract-set-theory.FiniteSetTheory.html#2767" class="Function Operator">ᶠˢ</a><a id="6455" class="Symbol">)</a> <a id="6457" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="6459" href="Ledger.Conway.Certs.html#3297" class="Function">stakeDelegs</a> <a id="6471" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="6473" href="Ledger.Conway.Rewards.html#6498" class="Function">poolParams</a> <a id="6484" href="Ledger.Prelude.html#2441" class="Function Operator">⟧</a>
  <a id="6488" class="Keyword">where</a>
    <a id="6498" href="Ledger.Conway.Rewards.html#6498" class="Function">poolParams</a> <a id="6509" class="Symbol">=</a> <a id="6511" href="Ledger.Conway.Rewards.html#6412" class="Bound">pState</a> <a id="6518" class="Symbol">.</a><a id="6519" href="Ledger.Conway.Certs.html#3841" class="Field">PState.pools</a>
    <a id="6536" class="Keyword">open</a> <a id="6541" href="Ledger.Conway.Certs.html#3199" class="Module">DState</a> <a id="6548" href="Ledger.Conway.Rewards.html#6408" class="Bound">stᵈ</a> <a id="6552" class="Keyword">using</a> <a id="6558" class="Symbol">(</a><a id="6559" href="Ledger.Conway.Certs.html#3297" class="Field">stakeDelegs</a><a id="6570" class="Symbol">;</a> <a id="6572" href="Ledger.Conway.Certs.html#3337" class="Field">rewards</a><a id="6579" class="Symbol">)</a>
    <a id="6585" href="Ledger.Conway.Rewards.html#6585" class="Function">m</a> <a id="6587" class="Symbol">=</a> <a id="6589" href="abstract-set-theory.FiniteSetTheory.html#519" class="Function">mapˢ</a> <a id="6594" class="Symbol">(λ</a> <a id="6597" href="Ledger.Conway.Rewards.html#6597" class="Bound">a</a> <a id="6599" class="Symbol">→</a> <a id="6601" class="Symbol">(</a><a id="6602" href="Ledger.Conway.Rewards.html#6597" class="Bound">a</a> <a id="6604" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="6606" href="Ledger.Conway.Utxo.html#3685" class="Function">cbalance</a> <a id="6615" class="Symbol">(</a><a id="6616" href="Ledger.Conway.Rewards.html#6403" class="Bound">utxo</a> <a id="6621" href="abstract-set-theory.FiniteSetTheory.html#3088" class="Function Operator">∣^&#39;</a> <a id="6625" class="Symbol">λ</a> <a id="6627" href="Ledger.Conway.Rewards.html#6627" class="Bound">i</a> <a id="6629" class="Symbol">→</a> <a id="6631" href="Ledger.Conway.Rewards.html#6258" class="Function">getStakeCred</a> <a id="6644" href="Ledger.Conway.Rewards.html#6627" class="Bound">i</a> <a id="6646" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="6648" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="6653" href="Ledger.Conway.Rewards.html#6597" class="Bound">a</a><a id="6654" class="Symbol">)))</a> <a id="6658" class="Symbol">(</a><a id="6659" href="Class.IsSet.html#916" class="Function">dom</a> <a id="6663" href="Ledger.Conway.Certs.html#3337" class="Function">rewards</a><a id="6670" class="Symbol">)</a>
    <a id="6676" href="Ledger.Conway.Rewards.html#6676" class="Function">stakeRelation</a> <a id="6690" class="Symbol">=</a> <a id="6692" href="Ledger.Conway.Rewards.html#6585" class="Function">m</a> <a id="6694" href="Axiom.Set.html#8952" class="Function Operator">∪</a> <a id="6696" href="Ledger.Prelude.html#2543" class="Function Operator">∣</a> <a id="6698" href="Ledger.Conway.Certs.html#3337" class="Function">rewards</a> <a id="6706" href="Ledger.Prelude.html#2543" class="Function Operator">∣</a>


<a id="6710" class="Keyword">record</a> <a id="Snapshots"></a><a id="6717" href="Ledger.Conway.Rewards.html#6717" class="Record">Snapshots</a> <a id="6727" class="Symbol">:</a> <a id="6729" href="Agda.Primitive.html#388" class="Primitive">Set</a> <a id="6733" class="Keyword">where</a>
  <a id="6741" class="Keyword">field</a>
    <a id="Snapshots.mark"></a><a id="6751" href="Ledger.Conway.Rewards.html#6751" class="Field">mark</a> <a id="Snapshots.set"></a><a id="6756" href="Ledger.Conway.Rewards.html#6756" class="Field">set</a> <a id="Snapshots.go"></a><a id="6760" href="Ledger.Conway.Rewards.html#6760" class="Field">go</a>  <a id="6764" class="Symbol">:</a> <a id="6766" href="Ledger.Conway.Rewards.html#5987" class="Record">Snapshot</a>
    <a id="Snapshots.feeSS"></a><a id="6779" href="Ledger.Conway.Rewards.html#6779" class="Field">feeSS</a>        <a id="6792" class="Symbol">:</a> <a id="6794" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a>



<a id="6802" class="Keyword">instance</a>
  <a id="6813" class="Keyword">unquoteDecl</a> <a id="HasCast-Snapshots"></a><a id="6825" href="Ledger.Conway.Rewards.html#6825" class="Function">HasCast-Snapshots</a> <a id="6843" class="Symbol">=</a>
    <a id="6849" href="stdlib-classes.Class.HasCast.Derive.html#2690" class="Function">derive-HasCast</a> <a id="6864" href="Data.List.Base.html#5205" class="Function Operator">[</a> <a id="6866" class="Symbol">(</a><a id="6867" class="Keyword">quote</a> <a id="6873" href="Ledger.Conway.Rewards.html#6717" class="Record">Snapshots</a> <a id="6883" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="6885" href="Ledger.Conway.Rewards.html#6825" class="Function">HasCast-Snapshots</a><a id="6902" class="Symbol">)</a> <a id="6904" href="Data.List.Base.html#5205" class="Function Operator">]</a>


<a id="6908" class="Keyword">private</a> <a id="6916" class="Keyword">variable</a>
  <a id="6927" href="Ledger.Conway.Rewards.html#6927" class="Generalizable">lstate</a> <a id="6934" class="Symbol">:</a> <a id="6936" href="Ledger.Conway.Ledger.html#865" class="Record">LState</a>
  <a id="6945" href="Ledger.Conway.Rewards.html#6945" class="Generalizable">mark</a> <a id="6950" href="Ledger.Conway.Rewards.html#6950" class="Generalizable">set</a> <a id="6954" href="Ledger.Conway.Rewards.html#6954" class="Generalizable">go</a> <a id="6957" class="Symbol">:</a> <a id="6959" href="Ledger.Conway.Rewards.html#5987" class="Record">Snapshot</a>
  <a id="6970" href="Ledger.Conway.Rewards.html#6970" class="Generalizable">feeSS</a> <a id="6976" class="Symbol">:</a> <a id="6978" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a>


<a id="6985" class="Keyword">data</a> <a id="_⊢_⇀⦇_,SNAP⦈_"></a><a id="6990" href="Ledger.Conway.Rewards.html#6990" class="Datatype Operator">_⊢_⇀⦇_,SNAP⦈_</a> <a id="7004" class="Symbol">:</a> <a id="7006" href="Ledger.Conway.Ledger.html#865" class="Record">LState</a> <a id="7013" class="Symbol">→</a> <a id="7015" href="Ledger.Conway.Rewards.html#6717" class="Record">Snapshots</a> <a id="7025" class="Symbol">→</a> <a id="7027" href="Agda.Builtin.Unit.html#175" class="Record">⊤</a> <a id="7029" class="Symbol">→</a> <a id="7031" href="Ledger.Conway.Rewards.html#6717" class="Record">Snapshots</a> <a id="7041" class="Symbol">→</a> <a id="7043" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="7048" class="Keyword">where</a>
  <a id="_⊢_⇀⦇_,SNAP⦈_.SNAP"></a><a id="7056" href="Ledger.Conway.Rewards.html#7056" class="InductiveConstructor">SNAP</a> <a id="7061" class="Symbol">:</a> <a id="7063" class="Keyword">let</a> <a id="7067" class="Keyword">open</a> <a id="7072" href="Ledger.Conway.Ledger.html#865" class="Module">LState</a> <a id="7079" href="Ledger.Conway.Rewards.html#6927" class="Generalizable">lstate</a><a id="7085" class="Symbol">;</a> <a id="7087" class="Keyword">open</a> <a id="7092" href="Ledger.Conway.Utxo.html#2747" class="Module">UTxOState</a> <a id="7102" href="Ledger.Conway.Ledger.html#924" class="Function">utxoSt</a><a id="7108" class="Symbol">;</a> <a id="7110" class="Keyword">open</a> <a id="7115" href="Ledger.Conway.Certs.html#4355" class="Module">CertState</a> <a id="7125" href="Ledger.Conway.Ledger.html#977" class="Function">certState</a>
             <a id="7148" href="Ledger.Conway.Rewards.html#7148" class="Bound">stake</a> <a id="7154" class="Symbol">=</a> <a id="7156" href="Ledger.Conway.Rewards.html#6345" class="Function">stakeDistr</a> <a id="7167" href="Ledger.Conway.Utxo.html#2811" class="Function">utxo</a> <a id="7172" href="Ledger.Conway.Certs.html#4418" class="Function">dState</a> <a id="7179" href="Ledger.Conway.Certs.html#4438" class="Function">pState</a>
    <a id="7190" class="Keyword">in</a>
    <a id="7197" href="Ledger.Conway.Rewards.html#6927" class="Generalizable">lstate</a> <a id="7204" href="Ledger.Conway.Rewards.html#6990" class="Datatype Operator">⊢</a> <a id="7206" href="Ledger.Prelude.html#2441" class="Function Operator">⟦</a> <a id="7208" href="Ledger.Conway.Rewards.html#6945" class="Generalizable">mark</a> <a id="7213" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="7215" href="Ledger.Conway.Rewards.html#6950" class="Generalizable">set</a> <a id="7219" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="7221" href="Ledger.Conway.Rewards.html#6954" class="Generalizable">go</a> <a id="7224" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="7226" href="Ledger.Conway.Rewards.html#6970" class="Generalizable">feeSS</a> <a id="7232" href="Ledger.Prelude.html#2441" class="Function Operator">⟧</a> <a id="7234" href="Ledger.Conway.Rewards.html#6990" class="Datatype Operator">⇀⦇</a> <a id="7237" href="Agda.Builtin.Unit.html#212" class="InductiveConstructor">tt</a> <a id="7240" href="Ledger.Conway.Rewards.html#6990" class="Datatype Operator">,SNAP⦈</a> <a id="7247" href="Ledger.Prelude.html#2441" class="Function Operator">⟦</a> <a id="7249" href="Ledger.Conway.Rewards.html#7148" class="Bound">stake</a> <a id="7255" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="7257" href="Ledger.Conway.Rewards.html#6945" class="Generalizable">mark</a> <a id="7262" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="7264" href="Ledger.Conway.Rewards.html#6950" class="Generalizable">set</a> <a id="7268" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="7270" href="Ledger.Conway.Utxo.html#2833" class="Function">fees</a> <a id="7275" href="Ledger.Prelude.html#2441" class="Function Operator">⟧</a>

</pre></body></html>