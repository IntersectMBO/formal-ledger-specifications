<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>Ledger.Dijkstra.Specification.Script.Validation</title><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.css"><link rel="stylesheet" href="Agda.css"><script src="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.js"></script><script src="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/contrib/auto-render.min.js"></script><script src="AgdaKaTeX.js" defer=""></script></head><body><pre class="Agda">
<a id="2" class="Symbol">{-#</a> <a id="6" class="Keyword">OPTIONS</a> <a id="14" class="Pragma">--safe</a> <a id="21" class="Symbol">#-}</a>

<a id="26" class="Keyword">open</a> <a id="31" class="Keyword">import</a> <a id="38" href="Ledger.Dijkstra.Specification.Transaction.html" class="Module">Ledger.Dijkstra.Specification.Transaction</a>
<a id="80" class="Keyword">open</a> <a id="85" class="Keyword">import</a> <a id="92" href="Ledger.Dijkstra.Specification.Abstract.html" class="Module">Ledger.Dijkstra.Specification.Abstract</a>

<a id="132" class="Keyword">module</a> <a id="139" href="Ledger.Dijkstra.Specification.Script.Validation.html" class="Module">Ledger.Dijkstra.Specification.Script.Validation</a>
  <a id="189" class="Symbol">(</a><a id="190" href="Ledger.Dijkstra.Specification.Script.Validation.html#190" class="Bound">txs</a> <a id="194" class="Symbol">:</a> <a id="196" class="Symbol">_)</a> <a id="199" class="Symbol">(</a><a id="200" class="Keyword">open</a> <a id="205" href="Ledger.Dijkstra.Specification.Transaction.html#1329" class="Module">TransactionStructure</a> <a id="226" href="Ledger.Dijkstra.Specification.Script.Validation.html#190" class="Bound">txs</a><a id="229" class="Symbol">)</a>
  <a id="233" class="Symbol">(</a><a id="234" href="Ledger.Dijkstra.Specification.Script.Validation.html#234" class="Bound">abs</a> <a id="238" class="Symbol">:</a> <a id="240" href="Ledger.Dijkstra.Specification.Abstract.html#912" class="Record">AbstractFunctions</a> <a id="258" href="Ledger.Dijkstra.Specification.Script.Validation.html#190" class="Bound">txs</a><a id="261" class="Symbol">)</a> <a id="263" class="Symbol">(</a><a id="264" class="Keyword">open</a> <a id="269" href="Ledger.Dijkstra.Specification.Abstract.html#912" class="Module">AbstractFunctions</a> <a id="287" href="Ledger.Dijkstra.Specification.Script.Validation.html#234" class="Bound">abs</a><a id="290" class="Symbol">)</a> <a id="292" class="Symbol">(</a><a id="293" class="Keyword">open</a> <a id="298" href="Ledger.Dijkstra.Specification.Abstract.html#357" class="Module">indexOf</a> <a id="306" href="Ledger.Dijkstra.Specification.Abstract.html#1050" class="Field">indexOfImp</a><a id="316" class="Symbol">)</a>
  <a id="320" class="Keyword">where</a>

<a id="327" class="Keyword">open</a> <a id="332" class="Keyword">import</a> <a id="339" href="Ledger.Prelude.html" class="Module">Ledger.Prelude</a>
<a id="354" class="Keyword">open</a> <a id="359" class="Keyword">import</a> <a id="366" href="Ledger.Dijkstra.Specification.Certs.html" class="Module">Ledger.Dijkstra.Specification.Certs</a> <a id="402" href="Ledger.Dijkstra.Specification.Transaction.html#2505" class="Function">govStructure</a>

<a id="416" class="Keyword">open</a> <a id="421" class="Keyword">import</a> <a id="428" href="Ledger.Dijkstra.Specification.Abstract.html" class="Module">Ledger.Dijkstra.Specification.Abstract</a> <a id="467" href="Ledger.Dijkstra.Specification.Script.Validation.html#190" class="Bound">txs</a>
<a id="471" class="Keyword">open</a> <a id="476" class="Keyword">import</a> <a id="483" href="Ledger.Dijkstra.Specification.Script.ScriptPurpose.html" class="Module">Ledger.Dijkstra.Specification.Script.ScriptPurpose</a> <a id="534" href="Ledger.Dijkstra.Specification.Script.Validation.html#190" class="Bound">txs</a>


<a id="540" class="Keyword">private</a> <a id="548" class="Keyword">variable</a>
  <a id="559" href="Ledger.Dijkstra.Specification.Script.Validation.html#559" class="Generalizable">ℓ</a> <a id="561" class="Symbol">:</a> <a id="563" href="Ledger.Dijkstra.Specification.Transaction.html#768" class="Datatype">TxLevel</a>

<a id="rdptr"></a><a id="572" href="Ledger.Dijkstra.Specification.Script.Validation.html#572" class="Function">rdptr</a> <a id="578" class="Symbol">:</a> <a id="580" href="Ledger.Dijkstra.Specification.Transaction.html#3522" class="Record">Tx</a> <a id="583" href="Ledger.Dijkstra.Specification.Script.Validation.html#559" class="Generalizable">ℓ</a> <a id="585" class="Symbol">→</a> <a id="587" href="Ledger.Dijkstra.Specification.Script.ScriptPurpose.html#300" class="Datatype">ScriptPurpose</a> <a id="601" class="Symbol">→</a> <a id="603" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="609" class="Symbol">(</a><a id="610" href="Ledger.Dijkstra.Specification.Transaction.html#3195" class="Function">RedeemerPtr</a> <a id="622" href="Ledger.Dijkstra.Specification.Script.Validation.html#559" class="Generalizable">ℓ</a><a id="623" class="Symbol">)</a>
<a id="625" href="Ledger.Dijkstra.Specification.Script.Validation.html#572" class="Function">rdptr</a> <a id="631" href="Ledger.Dijkstra.Specification.Script.Validation.html#631" class="Bound">tx</a> <a id="634" class="Symbol">=</a> <a id="636" class="Symbol">λ</a> <a id="638" class="Keyword">where</a>
  <a id="646" class="Symbol">(</a><a id="647" href="Ledger.Dijkstra.Specification.Script.ScriptPurpose.html#329" class="InductiveConstructor">Cert</a> <a id="652" href="Ledger.Dijkstra.Specification.Script.Validation.html#652" class="Bound">h</a><a id="653" class="Symbol">)</a>     <a id="659" class="Symbol">→</a> <a id="661" href="Class.Functor.Core.html#272" class="Function">map</a> <a id="665" class="Symbol">(</a><a id="666" href="Ledger.Dijkstra.Specification.Transaction.html#1178" class="InductiveConstructor">Cert</a>     <a id="675" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,_</a><a id="677" class="Symbol">)</a> <a id="679" href="Function.Base.html#1993" class="Function Operator">$</a> <a id="681" href="Ledger.Dijkstra.Specification.Abstract.html#390" class="Function">indexOfDCert</a>           <a id="704" href="Ledger.Dijkstra.Specification.Script.Validation.html#652" class="Bound">h</a> <a id="706" class="Symbol">(</a><a id="707" href="Ledger.Dijkstra.Specification.Transaction.html#7687" class="Field">DCertsOf</a> <a id="716" href="Ledger.Dijkstra.Specification.Script.Validation.html#631" class="Bound">tx</a><a id="718" class="Symbol">)</a>
  <a id="722" class="Symbol">(</a><a id="723" href="Ledger.Dijkstra.Specification.Script.ScriptPurpose.html#373" class="InductiveConstructor">Rwrd</a> <a id="728" href="Ledger.Dijkstra.Specification.Script.Validation.html#728" class="Bound">h</a><a id="729" class="Symbol">)</a>     <a id="735" class="Symbol">→</a> <a id="737" href="Class.Functor.Core.html#272" class="Function">map</a> <a id="741" class="Symbol">(</a><a id="742" href="Ledger.Dijkstra.Specification.Transaction.html#1183" class="InductiveConstructor">Reward</a>   <a id="751" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,_</a><a id="753" class="Symbol">)</a> <a id="755" href="Function.Base.html#1993" class="Function Operator">$</a> <a id="757" href="Ledger.Dijkstra.Specification.Abstract.html#464" class="Function">indexOfRewardAddress</a>   <a id="780" href="Ledger.Dijkstra.Specification.Script.Validation.html#728" class="Bound">h</a> <a id="782" class="Symbol">(</a><a id="783" href="Ledger.Core.Specification.Address.html#1839" class="Field">WithdrawalsOf</a> <a id="797" href="Ledger.Dijkstra.Specification.Script.Validation.html#631" class="Bound">tx</a><a id="799" class="Symbol">)</a>
  <a id="803" class="Symbol">(</a><a id="804" href="Ledger.Dijkstra.Specification.Script.ScriptPurpose.html#417" class="InductiveConstructor">Mint</a> <a id="809" href="Ledger.Dijkstra.Specification.Script.Validation.html#809" class="Bound">h</a><a id="810" class="Symbol">)</a>     <a id="816" class="Symbol">→</a> <a id="818" href="Class.Functor.Core.html#272" class="Function">map</a> <a id="822" class="Symbol">(</a><a id="823" href="Ledger.Dijkstra.Specification.Transaction.html#1173" class="InductiveConstructor">Mint</a>     <a id="832" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,_</a><a id="834" class="Symbol">)</a> <a id="836" href="Function.Base.html#1993" class="Function Operator">$</a> <a id="838" href="Ledger.Dijkstra.Specification.Abstract.html#612" class="Function">indexOfPolicyId</a>        <a id="861" href="Ledger.Dijkstra.Specification.Script.Validation.html#809" class="Bound">h</a> <a id="863" class="Symbol">(</a><a id="864" href="Ledger.Conway.Specification.TokenAlgebra.Base.html#927" class="Function">policies</a> <a id="873" class="Symbol">(</a><a id="874" href="Ledger.Dijkstra.Specification.Transaction.html#7449" class="Field">MintedValueOf</a> <a id="888" href="Ledger.Dijkstra.Specification.Script.Validation.html#631" class="Bound">tx</a><a id="890" class="Symbol">))</a>
  <a id="895" class="Symbol">(</a><a id="896" href="Ledger.Dijkstra.Specification.Script.ScriptPurpose.html#461" class="InductiveConstructor">Spend</a> <a id="902" href="Ledger.Dijkstra.Specification.Script.Validation.html#902" class="Bound">h</a><a id="903" class="Symbol">)</a>    <a id="908" class="Symbol">→</a> <a id="910" href="Class.Functor.Core.html#272" class="Function">map</a> <a id="914" class="Symbol">(</a><a id="915" href="Ledger.Dijkstra.Specification.Transaction.html#1167" class="InductiveConstructor">Spend</a>    <a id="924" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,_</a><a id="926" class="Symbol">)</a> <a id="928" href="Function.Base.html#1993" class="Function Operator">$</a> <a id="930" href="Ledger.Dijkstra.Specification.Abstract.html#538" class="Function">indexOfTxIn</a>            <a id="953" href="Ledger.Dijkstra.Specification.Script.Validation.html#902" class="Bound">h</a> <a id="955" class="Symbol">(</a><a id="956" href="Ledger.Dijkstra.Specification.Transaction.html#7179" class="Field">SpendInputsOf</a> <a id="970" href="Ledger.Dijkstra.Specification.Script.Validation.html#631" class="Bound">tx</a><a id="972" class="Symbol">)</a>
  <a id="976" class="Symbol">(</a><a id="977" href="Ledger.Dijkstra.Specification.Script.ScriptPurpose.html#505" class="InductiveConstructor">Vote</a> <a id="982" href="Ledger.Dijkstra.Specification.Script.Validation.html#982" class="Bound">h</a><a id="983" class="Symbol">)</a>     <a id="989" class="Symbol">→</a> <a id="991" href="Class.Functor.Core.html#272" class="Function">map</a> <a id="995" class="Symbol">(</a><a id="996" href="Ledger.Dijkstra.Specification.Transaction.html#1190" class="InductiveConstructor">Vote</a>     <a id="1005" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,_</a><a id="1007" class="Symbol">)</a> <a id="1009" href="Function.Base.html#1993" class="Function Operator">$</a> <a id="1011" href="Ledger.Dijkstra.Specification.Abstract.html#686" class="Function">indexOfVote</a>            <a id="1034" href="Ledger.Dijkstra.Specification.Script.Validation.html#982" class="Bound">h</a> <a id="1036" class="Symbol">(</a><a id="1037" href="Class.Functor.Core.html#272" class="Function">map</a> <a id="1041" href="Ledger.Dijkstra.Specification.Gov.Actions.html#1921" class="Field">GovVote.voter</a> <a id="1055" class="Symbol">(</a><a id="1056" href="Ledger.Dijkstra.Specification.Transaction.html#8082" class="Field">ListOfGovVotesOf</a> <a id="1073" href="Ledger.Dijkstra.Specification.Script.Validation.html#631" class="Bound">tx</a><a id="1075" class="Symbol">))</a>
  <a id="1080" class="Symbol">(</a><a id="1081" href="Ledger.Dijkstra.Specification.Script.ScriptPurpose.html#549" class="InductiveConstructor">Propose</a> <a id="1089" href="Ledger.Dijkstra.Specification.Script.Validation.html#1089" class="Bound">h</a><a id="1090" class="Symbol">)</a>  <a id="1093" class="Symbol">→</a> <a id="1095" href="Class.Functor.Core.html#272" class="Function">map</a> <a id="1099" class="Symbol">(</a><a id="1100" href="Ledger.Dijkstra.Specification.Transaction.html#1195" class="InductiveConstructor">Propose</a>  <a id="1109" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,_</a><a id="1111" class="Symbol">)</a> <a id="1113" href="Function.Base.html#1993" class="Function Operator">$</a> <a id="1115" href="Ledger.Dijkstra.Specification.Abstract.html#760" class="Function">indexOfProposal</a>        <a id="1138" href="Ledger.Dijkstra.Specification.Script.Validation.html#1089" class="Bound">h</a> <a id="1140" class="Symbol">(</a><a id="1141" href="Ledger.Dijkstra.Specification.Transaction.html#7926" class="Field">ListOfGovProposalsOf</a> <a id="1162" href="Ledger.Dijkstra.Specification.Script.Validation.html#631" class="Bound">tx</a><a id="1164" class="Symbol">)</a>
  <a id="1168" class="Symbol">(</a><a id="1169" href="Ledger.Dijkstra.Specification.Script.ScriptPurpose.html#593" class="InductiveConstructor">Guard</a> <a id="1175" href="Ledger.Dijkstra.Specification.Script.Validation.html#1175" class="Bound">c</a><a id="1176" class="Symbol">)</a>    <a id="1181" class="Symbol">→</a> <a id="1183" href="Class.Functor.Core.html#272" class="Function">map</a> <a id="1187" class="Symbol">(</a><a id="1188" href="Ledger.Dijkstra.Specification.Transaction.html#1203" class="InductiveConstructor">Guard</a>    <a id="1197" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,_</a><a id="1199" class="Symbol">)</a> <a id="1201" href="Function.Base.html#1993" class="Function Operator">$</a> <a id="1203" href="Ledger.Dijkstra.Specification.Abstract.html#834" class="Function">indexOfGuard</a>           <a id="1226" href="Ledger.Dijkstra.Specification.Script.Validation.html#1175" class="Bound">c</a> <a id="1228" class="Symbol">(</a><a id="1229" href="abstract-set-theory.FiniteSetTheory.html#2617" class="Function">setToList</a> <a id="1239" class="Symbol">(</a><a id="1240" href="Ledger.Dijkstra.Specification.Transaction.html#8218" class="Field">GuardsOf</a> <a id="1249" href="Ledger.Dijkstra.Specification.Script.Validation.html#631" class="Bound">tx</a><a id="1251" class="Symbol">))</a>

<a id="indexedRdmrs"></a><a id="1255" href="Ledger.Dijkstra.Specification.Script.Validation.html#1255" class="Function">indexedRdmrs</a> <a id="1268" class="Symbol">:</a> <a id="1270" href="Ledger.Dijkstra.Specification.Transaction.html#3522" class="Record">Tx</a> <a id="1273" href="Ledger.Dijkstra.Specification.Script.Validation.html#559" class="Generalizable">ℓ</a> <a id="1275" class="Symbol">→</a> <a id="1277" href="Ledger.Dijkstra.Specification.Script.ScriptPurpose.html#300" class="Datatype">ScriptPurpose</a> <a id="1291" class="Symbol">→</a> <a id="1293" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="1299" class="Symbol">(</a><a id="1300" href="Ledger.Dijkstra.Specification.Script.Base.html#1853" class="Function">Redeemer</a> <a id="1309" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="1311" href="Ledger.Dijkstra.Specification.Script.Base.html#1023" class="Function">ExUnits</a><a id="1318" class="Symbol">)</a>
<a id="1320" href="Ledger.Dijkstra.Specification.Script.Validation.html#1255" class="Function">indexedRdmrs</a> <a id="1333" href="Ledger.Dijkstra.Specification.Script.Validation.html#1333" class="Bound">tx</a> <a id="1336" href="Ledger.Dijkstra.Specification.Script.Validation.html#1336" class="Bound">sp</a> <a id="1339" class="Symbol">=</a> <a id="1341" href="Data.Maybe.Base.html#1276" class="Function">maybe</a> <a id="1347" class="Symbol">(λ</a> <a id="1350" href="Ledger.Dijkstra.Specification.Script.Validation.html#1350" class="Bound">x</a> <a id="1352" class="Symbol">→</a> <a id="1354" href="Axiom.Set.Map.html#17169" class="Function">lookupᵐ?</a> <a id="1363" class="Symbol">(</a><a id="1364" href="Ledger.Dijkstra.Specification.Transaction.html#5876" class="Field">RedeemersOf</a> <a id="1376" href="Ledger.Dijkstra.Specification.Script.Validation.html#1333" class="Bound">tx</a><a id="1378" class="Symbol">)</a> <a id="1380" href="Ledger.Dijkstra.Specification.Script.Validation.html#1350" class="Bound">x</a><a id="1381" class="Symbol">)</a> <a id="1383" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a> <a id="1391" class="Symbol">(</a><a id="1392" href="Ledger.Dijkstra.Specification.Script.Validation.html#572" class="Function">rdptr</a> <a id="1398" href="Ledger.Dijkstra.Specification.Script.Validation.html#1333" class="Bound">tx</a> <a id="1401" href="Ledger.Dijkstra.Specification.Script.Validation.html#1336" class="Bound">sp</a><a id="1403" class="Symbol">)</a>

<a id="txDataMap"></a><a id="1406" href="Ledger.Dijkstra.Specification.Script.Validation.html#1406" class="Function">txDataMap</a> <a id="1416" class="Symbol">:</a> <a id="1418" href="Ledger.Dijkstra.Specification.Transaction.html#3522" class="Record">Tx</a> <a id="1421" href="Ledger.Dijkstra.Specification.Script.Validation.html#559" class="Generalizable">ℓ</a> <a id="1423" class="Symbol">→</a> <a id="1425" href="Ledger.Dijkstra.Specification.Script.Base.html#1788" class="Function">DataHash</a> <a id="1434" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="1436" href="Ledger.Dijkstra.Specification.Script.Base.html#1835" class="Function">Datum</a>
<a id="1442" href="Ledger.Dijkstra.Specification.Script.Validation.html#1406" class="Function">txDataMap</a> <a id="1452" href="Ledger.Dijkstra.Specification.Script.Validation.html#1452" class="Bound">tx</a> <a id="1455" class="Symbol">=</a> <a id="1457" href="Ledger.Prelude.html#1894" class="Function">setToMap</a> <a id="1466" class="Symbol">(</a><a id="1467" href="abstract-set-theory.FiniteSetTheory.html#519" class="Function">mapˢ</a> <a id="1472" href="Data.Product.Base.html#2000" class="Function Operator">&lt;</a> <a id="1474" href="Interface.TypeClasses.Hashable.html#219" class="Field">hash</a> <a id="1479" href="Data.Product.Base.html#2000" class="Function Operator">,</a> <a id="1481" href="Function.Base.html#704" class="Function">id</a> <a id="1484" href="Data.Product.Base.html#2000" class="Function Operator">&gt;</a> <a id="1486" class="Symbol">(</a><a id="1487" href="Ledger.Dijkstra.Specification.Transaction.html#7803" class="Field">DataOf</a> <a id="1494" href="Ledger.Dijkstra.Specification.Script.Validation.html#1452" class="Bound">tx</a><a id="1496" class="Symbol">))</a>

<a id="1500" class="Comment">-- Datum lookup for spent outputs (Spend txin). Uses initial UTxO snapshot, utxoSpend₀.</a>
<a id="getDatum"></a><a id="1588" href="Ledger.Dijkstra.Specification.Script.Validation.html#1588" class="Function">getDatum</a> <a id="1597" class="Symbol">:</a> <a id="1599" href="Ledger.Dijkstra.Specification.Transaction.html#3522" class="Record">Tx</a> <a id="1602" href="Ledger.Dijkstra.Specification.Script.Validation.html#559" class="Generalizable">ℓ</a> <a id="1604" class="Symbol">→</a> <a id="1606" href="Ledger.Dijkstra.Specification.Transaction.html#3158" class="Function">UTxO</a> <a id="1611" class="Symbol">→</a> <a id="1613" class="Symbol">(</a><a id="1614" href="Ledger.Dijkstra.Specification.Script.Base.html#1788" class="Function">DataHash</a> <a id="1623" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="1625" href="Ledger.Dijkstra.Specification.Script.Base.html#1835" class="Function">Datum</a><a id="1630" class="Symbol">)</a> <a id="1632" class="Symbol">→</a> <a id="1634" href="Ledger.Dijkstra.Specification.Script.ScriptPurpose.html#300" class="Datatype">ScriptPurpose</a> <a id="1648" class="Symbol">→</a> <a id="1650" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="1656" href="Ledger.Dijkstra.Specification.Script.Base.html#1835" class="Function">Datum</a>
<a id="1662" href="Ledger.Dijkstra.Specification.Script.Validation.html#1588" class="Function">getDatum</a> <a id="1671" href="Ledger.Dijkstra.Specification.Script.Validation.html#1671" class="Bound">tx</a> <a id="1674" href="Ledger.Dijkstra.Specification.Script.Validation.html#1674" class="Bound">utxo₀</a> <a id="1680" href="Ledger.Dijkstra.Specification.Script.Validation.html#1680" class="Bound">extraData</a> <a id="1690" class="Symbol">(</a><a id="1691" href="Ledger.Dijkstra.Specification.Script.ScriptPurpose.html#461" class="InductiveConstructor">Spend</a> <a id="1697" href="Ledger.Dijkstra.Specification.Script.Validation.html#1697" class="Bound">txin</a><a id="1701" class="Symbol">)</a> <a id="1703" class="Keyword">with</a> <a id="1708" href="Axiom.Set.Map.html#17169" class="Function">lookupᵐ?</a> <a id="1717" href="Ledger.Dijkstra.Specification.Script.Validation.html#1674" class="Bound">utxo₀</a> <a id="1723" href="Ledger.Dijkstra.Specification.Script.Validation.html#1697" class="Bound">txin</a>
<a id="1728" class="Symbol">...</a> <a id="1732" class="Symbol">|</a> <a id="1734" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="1739" class="Symbol">(_</a> <a id="1742" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1744" class="Symbol">_</a> <a id="1746" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1748" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="1753" href="Ledger.Dijkstra.Specification.Script.Validation.html#1753" class="Bound">d</a> <a id="1755" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1757" class="Symbol">_)</a> <a id="1760" class="Symbol">=</a>
  <a id="1764" href="Function.Base.html#4061" class="Function Operator">case</a> <a id="1769" href="Ledger.Dijkstra.Specification.Script.Validation.html#1753" class="Bound">d</a> <a id="1771" href="Function.Base.html#4061" class="Function Operator">of</a> <a id="1774" class="Symbol">λ</a> <a id="1776" class="Keyword">where</a>
    <a id="1786" class="Symbol">(</a><a id="1787" href="Data.Sum.Base.html#675" class="InductiveConstructor">inj₁</a> <a id="1792" href="Ledger.Dijkstra.Specification.Script.Validation.html#1792" class="Bound">d</a><a id="1793" class="Symbol">)</a> <a id="1795" class="Symbol">→</a> <a id="1797" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="1802" href="Ledger.Dijkstra.Specification.Script.Validation.html#1792" class="Bound">d</a>
    <a id="1808" class="Symbol">(</a><a id="1809" href="Data.Sum.Base.html#700" class="InductiveConstructor">inj₂</a> <a id="1814" href="Ledger.Dijkstra.Specification.Script.Validation.html#1814" class="Bound">h</a><a id="1815" class="Symbol">)</a> <a id="1817" class="Symbol">→</a> <a id="1819" href="Axiom.Set.Map.html#17169" class="Function">lookupᵐ?</a> <a id="1828" class="Symbol">(</a><a id="1829" href="Ledger.Dijkstra.Specification.Script.Validation.html#1406" class="Function">txDataMap</a> <a id="1839" class="Bound">tx</a> <a id="1842" href="Axiom.Set.Map.html#7640" class="Function Operator">∪ˡ</a> <a id="1845" class="Bound">extraData</a><a id="1854" class="Symbol">)</a> <a id="1856" href="Ledger.Dijkstra.Specification.Script.Validation.html#1814" class="Bound">h</a>
                        <a id="1882" class="Comment">-- tx-local witness data takes precedence over batch/global pool.</a>
<a id="1948" class="CatchallClause Symbol">...</a><a id="1951" class="CatchallClause"> </a><a id="1952" class="CatchallClause Symbol">|</a><a id="1953" class="CatchallClause"> </a><a id="1954" class="CatchallClause Symbol">_</a> <a id="1956" class="Symbol">=</a> <a id="1958" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a>
<a id="1966" href="Ledger.Dijkstra.Specification.Script.Validation.html#1588" class="CatchallClause Function">getDatum</a><a id="1974" class="CatchallClause"> </a><a id="1975" href="Ledger.Dijkstra.Specification.Script.Validation.html#1975" class="CatchallClause Bound">tx</a><a id="1977" class="CatchallClause"> </a><a id="1978" href="Ledger.Dijkstra.Specification.Script.Validation.html#1978" class="CatchallClause Bound">utxo₀</a><a id="1983" class="CatchallClause"> </a><a id="1984" class="CatchallClause Symbol">_</a><a id="1985" class="CatchallClause"> </a><a id="1986" class="CatchallClause Symbol">_</a> <a id="1988" class="Symbol">=</a> <a id="1990" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a>


<a id="txInfo"></a><a id="2000" href="Ledger.Dijkstra.Specification.Script.Validation.html#2000" class="Function">txInfo</a> <a id="2007" class="Symbol">:</a> <a id="2009" class="Symbol">(</a><a id="2010" href="Ledger.Dijkstra.Specification.Script.Validation.html#2010" class="Bound">ℓ</a> <a id="2012" class="Symbol">:</a> <a id="2014" href="Ledger.Dijkstra.Specification.Transaction.html#768" class="Datatype">TxLevel</a><a id="2021" class="Symbol">)</a> <a id="2023" class="Symbol">→</a> <a id="2025" href="Ledger.Dijkstra.Specification.Transaction.html#3158" class="Function">UTxO</a> <a id="2030" class="Symbol">→</a> <a id="2032" href="Ledger.Dijkstra.Specification.Transaction.html#3522" class="Record">Tx</a> <a id="2035" href="Ledger.Dijkstra.Specification.Script.Validation.html#2010" class="Bound">ℓ</a> <a id="2037" class="Symbol">→</a> <a id="2039" href="Ledger.Dijkstra.Specification.Script.ScriptPurpose.html#653" class="Record">TxInfo</a>

<a id="2047" href="Ledger.Dijkstra.Specification.Script.Validation.html#2000" class="Function">txInfo</a> <a id="2054" href="Ledger.Dijkstra.Specification.Transaction.html#791" class="InductiveConstructor">TxLevelTop</a> <a id="2065" href="Ledger.Dijkstra.Specification.Script.Validation.html#2065" class="Bound">utxo</a> <a id="2070" href="Ledger.Dijkstra.Specification.Script.Validation.html#2070" class="Bound">tx</a> <a id="2073" class="Symbol">=</a>
  <a id="2077" class="Keyword">record</a>  <a id="2085" class="Symbol">{</a> <a id="2087" href="Ledger.Dijkstra.Specification.Script.ScriptPurpose.html#703" class="Field">realizedInputs</a>  <a id="2103" class="Symbol">=</a> <a id="2105" href="Ledger.Dijkstra.Specification.Script.Validation.html#2065" class="Bound">utxo</a> <a id="2110" href="Axiom.Set.Map.html#13536" class="Function Operator">∣</a> <a id="2112" class="Symbol">(</a><a id="2113" href="Ledger.Dijkstra.Specification.Transaction.html#7179" class="Field">SpendInputsOf</a> <a id="2127" href="Ledger.Dijkstra.Specification.Script.Validation.html#2070" class="Bound">tx</a><a id="2129" class="Symbol">)</a>
          <a id="2141" class="Symbol">;</a> <a id="2143" href="Ledger.Dijkstra.Specification.Script.ScriptPurpose.html#731" class="Field">txOuts</a>          <a id="2159" class="Symbol">=</a> <a id="2161" href="Ledger.Dijkstra.Specification.Transaction.html#8457" class="Field">TxOutsOf</a> <a id="2170" href="Ledger.Dijkstra.Specification.Script.Validation.html#2070" class="Bound">tx</a>
          <a id="2183" class="Symbol">;</a> <a id="2185" href="Ledger.Dijkstra.Specification.Script.ScriptPurpose.html#765" class="Field">txFee</a>           <a id="2201" class="Symbol">=</a> <a id="2203" href="Ledger.Dijkstra.Specification.Transaction.html#7571" class="Field">FeesOf?</a> <a id="2211" href="Ledger.Dijkstra.Specification.Script.Validation.html#2070" class="Bound">tx</a>
          <a id="2224" class="Symbol">;</a> <a id="2226" href="Ledger.Dijkstra.Specification.Script.ScriptPurpose.html#799" class="Field">mint</a>            <a id="2242" class="Symbol">=</a> <a id="2244" href="Ledger.Dijkstra.Specification.Transaction.html#7449" class="Field">MintedValueOf</a> <a id="2258" href="Ledger.Dijkstra.Specification.Script.Validation.html#2070" class="Bound">tx</a>
          <a id="2271" class="Symbol">;</a> <a id="2273" href="Ledger.Dijkstra.Specification.Script.ScriptPurpose.html#828" class="Field">txCerts</a>         <a id="2289" class="Symbol">=</a> <a id="2291" href="Ledger.Dijkstra.Specification.Transaction.html#7687" class="Field">DCertsOf</a> <a id="2300" href="Ledger.Dijkstra.Specification.Script.Validation.html#2070" class="Bound">tx</a>
          <a id="2313" class="Symbol">;</a> <a id="2315" href="Ledger.Dijkstra.Specification.Script.ScriptPurpose.html#862" class="Field">txWithdrawals</a>   <a id="2331" class="Symbol">=</a> <a id="2333" href="Ledger.Core.Specification.Address.html#1839" class="Field">WithdrawalsOf</a> <a id="2347" href="Ledger.Dijkstra.Specification.Script.Validation.html#2070" class="Bound">tx</a>
          <a id="2360" class="Symbol">;</a> <a id="2362" href="Ledger.Dijkstra.Specification.Script.ScriptPurpose.html#897" class="Field">txVldt</a>          <a id="2378" class="Symbol">=</a> <a id="2380" href="Ledger.Dijkstra.Specification.Transaction.html#7029" class="Field">ValidIntervalOf</a> <a id="2396" href="Ledger.Dijkstra.Specification.Script.Validation.html#2070" class="Bound">tx</a>
          <a id="2409" class="Symbol">;</a> <a id="2411" href="Ledger.Dijkstra.Specification.Script.ScriptPurpose.html#944" class="Field">vkKey</a>           <a id="2427" class="Symbol">=</a> <a id="2429" href="Ledger.Dijkstra.Specification.Transaction.html#8589" class="Field">RequiredSignerHashesOf</a> <a id="2452" href="Ledger.Dijkstra.Specification.Script.Validation.html#2070" class="Bound">tx</a>
          <a id="2465" class="Symbol">;</a> <a id="2467" href="Ledger.Dijkstra.Specification.Script.ScriptPurpose.html#1016" class="Field">txGuards</a>        <a id="2483" class="Symbol">=</a> <a id="2485" href="Ledger.Dijkstra.Specification.Transaction.html#8218" class="Field">GuardsOf</a> <a id="2494" href="Ledger.Dijkstra.Specification.Script.Validation.html#2070" class="Bound">tx</a>
          <a id="2507" class="Symbol">;</a> <a id="2509" href="Ledger.Dijkstra.Specification.Script.ScriptPurpose.html#1099" class="Field">txData</a>          <a id="2525" class="Symbol">=</a> <a id="2527" href="Ledger.Dijkstra.Specification.Transaction.html#7803" class="Field">DataOf</a> <a id="2534" href="Ledger.Dijkstra.Specification.Script.Validation.html#2070" class="Bound">tx</a>
          <a id="2547" class="Symbol">;</a> <a id="2549" href="Ledger.Dijkstra.Specification.Script.ScriptPurpose.html#1130" class="Field">txId</a>            <a id="2565" class="Symbol">=</a> <a id="2567" href="Ledger.Dijkstra.Specification.Transaction.html#6811" class="Field">TxIdOf</a> <a id="2574" href="Ledger.Dijkstra.Specification.Script.Validation.html#2070" class="Bound">tx</a>
          <a id="2587" class="Symbol">;</a> <a id="2589" href="Ledger.Dijkstra.Specification.Script.ScriptPurpose.html#1158" class="Field">txInfoSubTxs</a>    <a id="2605" class="Symbol">=</a> <a id="2607" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a>
          <a id="2625" class="Symbol">}</a>

<a id="2628" href="Ledger.Dijkstra.Specification.Script.Validation.html#2000" class="Function">txInfo</a> <a id="2635" href="Ledger.Dijkstra.Specification.Transaction.html#802" class="InductiveConstructor">TxLevelSub</a> <a id="2646" href="Ledger.Dijkstra.Specification.Script.Validation.html#2646" class="Bound">utxo</a> <a id="2651" href="Ledger.Dijkstra.Specification.Script.Validation.html#2651" class="Bound">tx</a> <a id="2654" class="Symbol">=</a>
  <a id="2658" class="Keyword">record</a>  <a id="2666" class="Symbol">{</a> <a id="2668" href="Ledger.Dijkstra.Specification.Script.ScriptPurpose.html#703" class="Field">realizedInputs</a>  <a id="2684" class="Symbol">=</a> <a id="2686" href="Ledger.Dijkstra.Specification.Script.Validation.html#2646" class="Bound">utxo</a> <a id="2691" href="Axiom.Set.Map.html#13536" class="Function Operator">∣</a> <a id="2693" class="Symbol">(</a><a id="2694" href="Ledger.Dijkstra.Specification.Transaction.html#3870" class="Field">TxBody.txIns</a> <a id="2707" href="Ledger.Dijkstra.Specification.Transaction.html#3594" class="Field">txBody</a><a id="2713" class="Symbol">)</a>
          <a id="2725" class="Symbol">;</a> <a id="2727" href="Ledger.Dijkstra.Specification.Script.ScriptPurpose.html#731" class="Field">txOuts</a>          <a id="2743" class="Symbol">=</a> <a id="2745" href="Ledger.Dijkstra.Specification.Transaction.html#4005" class="Field">TxBody.txOuts</a> <a id="2759" href="Ledger.Dijkstra.Specification.Transaction.html#3594" class="Field">txBody</a>
          <a id="2776" class="Symbol">;</a> <a id="2778" href="Ledger.Dijkstra.Specification.Script.ScriptPurpose.html#765" class="Field">txFee</a>           <a id="2794" class="Symbol">=</a> <a id="2796" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a>
          <a id="2814" class="Symbol">;</a> <a id="2816" href="Ledger.Dijkstra.Specification.Script.ScriptPurpose.html#799" class="Field">mint</a>            <a id="2832" class="Symbol">=</a> <a id="2834" href="Ledger.Dijkstra.Specification.Transaction.html#4542" class="Field">TxBody.mint</a> <a id="2846" href="Ledger.Dijkstra.Specification.Transaction.html#3594" class="Field">txBody</a>
          <a id="2863" class="Symbol">;</a> <a id="2865" href="Ledger.Dijkstra.Specification.Script.ScriptPurpose.html#828" class="Field">txCerts</a>         <a id="2881" class="Symbol">=</a> <a id="2883" href="Ledger.Dijkstra.Specification.Transaction.html#4083" class="Field">TxBody.txCerts</a> <a id="2898" href="Ledger.Dijkstra.Specification.Transaction.html#3594" class="Field">txBody</a>
          <a id="2915" class="Symbol">;</a> <a id="2917" href="Ledger.Dijkstra.Specification.Script.ScriptPurpose.html#862" class="Field">txWithdrawals</a>   <a id="2933" class="Symbol">=</a> <a id="2935" href="Ledger.Dijkstra.Specification.Transaction.html#4180" class="Field">TxBody.txWithdrawals</a> <a id="2956" href="Ledger.Dijkstra.Specification.Transaction.html#3594" class="Field">txBody</a>
          <a id="2973" class="Symbol">;</a> <a id="2975" href="Ledger.Dijkstra.Specification.Script.ScriptPurpose.html#897" class="Field">txVldt</a>          <a id="2991" class="Symbol">=</a> <a id="2993" href="Ledger.Dijkstra.Specification.Transaction.html#4223" class="Field">TxBody.txVldt</a> <a id="3007" href="Ledger.Dijkstra.Specification.Transaction.html#3594" class="Field">txBody</a>
          <a id="3024" class="Symbol">;</a> <a id="3026" href="Ledger.Dijkstra.Specification.Script.ScriptPurpose.html#944" class="Field">vkKey</a>           <a id="3042" class="Symbol">=</a> <a id="3044" href="Ledger.Dijkstra.Specification.Transaction.html#4900" class="Function">TxBody.requiredSignerHashes</a> <a id="3072" href="Ledger.Dijkstra.Specification.Transaction.html#3594" class="Field">txBody</a>
          <a id="3089" class="Symbol">;</a> <a id="3091" href="Ledger.Dijkstra.Specification.Script.ScriptPurpose.html#1016" class="Field">txGuards</a>        <a id="3107" class="Symbol">=</a> <a id="3109" href="Ledger.Dijkstra.Specification.Transaction.html#4736" class="Field">TxBody.txGuards</a> <a id="3125" href="Ledger.Dijkstra.Specification.Transaction.html#3594" class="Field">txBody</a>
          <a id="3142" class="Symbol">;</a> <a id="3144" href="Ledger.Dijkstra.Specification.Script.ScriptPurpose.html#1099" class="Field">txData</a>          <a id="3160" class="Symbol">=</a> <a id="3162" href="Ledger.Dijkstra.Specification.Transaction.html#7803" class="Field">DataOf</a> <a id="3169" href="Ledger.Dijkstra.Specification.Script.Validation.html#2651" class="Bound">tx</a>
          <a id="3182" class="Symbol">;</a> <a id="3184" href="Ledger.Dijkstra.Specification.Script.ScriptPurpose.html#1130" class="Field">txId</a>            <a id="3200" class="Symbol">=</a> <a id="3202" href="Ledger.Dijkstra.Specification.Transaction.html#4047" class="Field">TxBody.txId</a> <a id="3214" href="Ledger.Dijkstra.Specification.Transaction.html#3594" class="Field">txBody</a>
          <a id="3231" class="Symbol">;</a> <a id="3233" href="Ledger.Dijkstra.Specification.Script.ScriptPurpose.html#1158" class="Field">txInfoSubTxs</a>    <a id="3249" class="Symbol">=</a> <a id="3251" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a>
          <a id="3269" class="Symbol">}</a> <a id="3271" class="Keyword">where</a> <a id="3277" class="Keyword">open</a> <a id="3282" href="Ledger.Dijkstra.Specification.Transaction.html#3522" class="Module">Tx</a> <a id="3285" href="Ledger.Dijkstra.Specification.Script.Validation.html#2651" class="Bound">tx</a>

<a id="txInfoForPurpose"></a><a id="3289" href="Ledger.Dijkstra.Specification.Script.Validation.html#3289" class="Function">txInfoForPurpose</a> <a id="3306" class="Symbol">:</a> <a id="3308" class="Symbol">{</a><a id="3309" href="Ledger.Dijkstra.Specification.Script.Validation.html#3309" class="Bound">ℓ</a> <a id="3311" class="Symbol">:</a> <a id="3313" href="Ledger.Dijkstra.Specification.Transaction.html#768" class="Datatype">TxLevel</a><a id="3320" class="Symbol">}</a> <a id="3322" class="Symbol">→</a> <a id="3324" href="Ledger.Dijkstra.Specification.Transaction.html#3158" class="Function">UTxO</a> <a id="3329" class="Symbol">→</a> <a id="3331" href="Ledger.Dijkstra.Specification.Transaction.html#3522" class="Record">Tx</a> <a id="3334" href="Ledger.Dijkstra.Specification.Script.Validation.html#3309" class="Bound">ℓ</a> <a id="3336" class="Symbol">→</a> <a id="3338" href="Ledger.Dijkstra.Specification.Script.ScriptPurpose.html#300" class="Datatype">ScriptPurpose</a> <a id="3352" class="Symbol">→</a> <a id="3354" href="Ledger.Dijkstra.Specification.Script.ScriptPurpose.html#653" class="Record">TxInfo</a>

<a id="3362" class="Comment">-- subtransactions: never get subTx infos (even if the ScriptPurpose is Guard).</a>
<a id="3442" href="Ledger.Dijkstra.Specification.Script.Validation.html#3289" class="Function">txInfoForPurpose</a> <a id="3459" class="Symbol">{</a><a id="3460" href="Ledger.Dijkstra.Specification.Transaction.html#802" class="InductiveConstructor">TxLevelSub</a><a id="3470" class="Symbol">}</a> <a id="3472" href="Ledger.Dijkstra.Specification.Script.Validation.html#3472" class="Bound">utxo</a> <a id="3477" href="Ledger.Dijkstra.Specification.Script.Validation.html#3477" class="Bound">tx</a> <a id="3480" class="Symbol">_</a> <a id="3482" class="Symbol">=</a> <a id="3484" href="Ledger.Dijkstra.Specification.Script.Validation.html#2000" class="Function">txInfo</a> <a id="3491" href="Ledger.Dijkstra.Specification.Transaction.html#802" class="InductiveConstructor">TxLevelSub</a> <a id="3502" href="Ledger.Dijkstra.Specification.Script.Validation.html#3472" class="Bound">utxo</a> <a id="3507" href="Ledger.Dijkstra.Specification.Script.Validation.html#3477" class="Bound">tx</a>

<a id="3511" class="Comment">-- top-level transactions:</a>
<a id="3538" href="Ledger.Dijkstra.Specification.Script.Validation.html#3289" class="Function">txInfoForPurpose</a> <a id="3555" class="Symbol">{</a><a id="3556" href="Ledger.Dijkstra.Specification.Transaction.html#791" class="InductiveConstructor">TxLevelTop</a><a id="3566" class="Symbol">}</a> <a id="3568" href="Ledger.Dijkstra.Specification.Script.Validation.html#3568" class="Bound">utxo</a> <a id="3573" href="Ledger.Dijkstra.Specification.Script.Validation.html#3573" class="Bound">tx</a> <a id="3576" href="Ledger.Dijkstra.Specification.Script.Validation.html#3576" class="Bound">sp</a> <a id="3579" class="Keyword">with</a> <a id="3584" href="Ledger.Dijkstra.Specification.Script.Validation.html#3576" class="Bound">sp</a>
   <a id="3590" class="Comment">-- · guard scripts see subTx infos</a>
<a id="3625" class="Symbol">...</a> <a id="3629" class="Symbol">|</a> <a id="3631" href="Ledger.Dijkstra.Specification.Script.ScriptPurpose.html#593" class="InductiveConstructor">Guard</a> <a id="3637" class="Symbol">_</a> <a id="3639" class="Symbol">=</a>  <a id="3642" class="Keyword">record</a> <a id="3649" href="Ledger.Dijkstra.Specification.Script.Validation.html#3727" class="Function">base</a> <a id="3654" class="Symbol">{</a> <a id="3656" href="Ledger.Dijkstra.Specification.Script.ScriptPurpose.html#1158" class="Field">txInfoSubTxs</a> <a id="3669" class="Symbol">=</a> <a id="3671" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="3676" href="Ledger.Dijkstra.Specification.Script.Validation.html#3808" class="Function">subInfos</a> <a id="3685" class="Symbol">}</a>
                 <a id="3704" class="Keyword">where</a>
                 <a id="3727" href="Ledger.Dijkstra.Specification.Script.Validation.html#3727" class="Function">base</a> <a id="3732" class="Symbol">:</a> <a id="3734" href="Ledger.Dijkstra.Specification.Script.ScriptPurpose.html#653" class="Record">TxInfo</a>
                 <a id="3758" href="Ledger.Dijkstra.Specification.Script.Validation.html#3727" class="Function">base</a> <a id="3763" class="Symbol">=</a> <a id="3765" href="Ledger.Dijkstra.Specification.Script.Validation.html#2000" class="Function">txInfo</a> <a id="3772" href="Ledger.Dijkstra.Specification.Transaction.html#791" class="InductiveConstructor">TxLevelTop</a> <a id="3783" class="Bound">utxo</a> <a id="3788" class="Bound">tx</a>
                 <a id="3808" href="Ledger.Dijkstra.Specification.Script.Validation.html#3808" class="Function">subInfos</a> <a id="3817" class="Symbol">:</a> <a id="3819" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="3824" href="Ledger.Dijkstra.Specification.Script.ScriptPurpose.html#1201" class="Function">SubTxInfo</a>
                 <a id="3851" href="Ledger.Dijkstra.Specification.Script.Validation.html#3808" class="Function">subInfos</a> <a id="3860" class="Symbol">=</a> <a id="3862" href="Class.Functor.Core.html#272" class="Function">map</a> <a id="3866" class="Symbol">(</a><a id="3867" href="Ledger.Dijkstra.Specification.Script.Validation.html#2000" class="Function">txInfo</a> <a id="3874" href="Ledger.Dijkstra.Specification.Transaction.html#802" class="InductiveConstructor">TxLevelSub</a> <a id="3885" class="Bound">utxo</a><a id="3889" class="Symbol">)</a> <a id="3891" class="Symbol">(</a><a id="3892" href="Ledger.Dijkstra.Specification.Transaction.html#6390" class="Field">SubTransactionsOf</a> <a id="3910" class="Bound">tx</a><a id="3912" class="Symbol">)</a>
   <a id="3917" class="Comment">-- · other top-level scripts see no subTx infos</a>
<a id="3965" class="CatchallClause Symbol">...</a><a id="3968" class="CatchallClause"> </a><a id="3969" class="CatchallClause Symbol">|</a><a id="3970" class="CatchallClause"> </a><a id="3971" class="CatchallClause Symbol">_</a> <a id="3973" class="Symbol">=</a> <a id="3975" href="Ledger.Dijkstra.Specification.Script.Validation.html#2000" class="Function">txInfo</a> <a id="3982" href="Ledger.Dijkstra.Specification.Transaction.html#791" class="InductiveConstructor">TxLevelTop</a> <a id="3993" class="Bound">utxo</a> <a id="3998" class="Bound">tx</a>


<a id="credsNeededMinusCollateral"></a><a id="4003" href="Ledger.Dijkstra.Specification.Script.Validation.html#4003" class="Function">credsNeededMinusCollateral</a> <a id="4030" class="Symbol">:</a> <a id="4032" class="Symbol">{</a><a id="4033" href="Ledger.Dijkstra.Specification.Script.Validation.html#4033" class="Bound">ℓ</a> <a id="4035" class="Symbol">:</a> <a id="4037" href="Ledger.Dijkstra.Specification.Transaction.html#768" class="Datatype">TxLevel</a><a id="4044" class="Symbol">}</a> <a id="4046" class="Symbol">→</a> <a id="4048" href="Ledger.Dijkstra.Specification.Transaction.html#3522" class="Record">Tx</a> <a id="4051" href="Ledger.Dijkstra.Specification.Script.Validation.html#4033" class="Bound">ℓ</a> <a id="4053" class="Symbol">→</a> <a id="4055" href="abstract-set-theory.FiniteSetTheory.html#488" class="Function Operator">ℙ</a> <a id="4057" class="Symbol">(</a><a id="4058" href="Ledger.Dijkstra.Specification.Script.ScriptPurpose.html#300" class="Datatype">ScriptPurpose</a> <a id="4072" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="4074" href="Ledger.Core.Specification.Address.html#259" class="Datatype">Credential</a><a id="4084" class="Symbol">)</a>
<a id="4086" href="Ledger.Dijkstra.Specification.Script.Validation.html#4003" class="Function">credsNeededMinusCollateral</a> <a id="4113" href="Ledger.Dijkstra.Specification.Script.Validation.html#4113" class="Bound">tx</a> <a id="4116" class="Symbol">=</a>
    <a id="4122" href="abstract-set-theory.FiniteSetTheory.html#519" class="Function">mapˢ</a>        <a id="4134" class="Symbol">(λ</a> <a id="4137" href="Ledger.Dijkstra.Specification.Script.Validation.html#4137" class="Bound">a</a> <a id="4139" class="Symbol">→</a>  <a id="4142" class="Symbol">(</a><a id="4143" href="Ledger.Dijkstra.Specification.Script.ScriptPurpose.html#373" class="InductiveConstructor">Rwrd</a> <a id="4148" href="Ledger.Dijkstra.Specification.Script.Validation.html#4137" class="Bound">a</a> <a id="4150" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="4152" href="Ledger.Core.Specification.Address.html#421" class="Field">CredentialOf</a> <a id="4165" href="Ledger.Dijkstra.Specification.Script.Validation.html#4137" class="Bound">a</a><a id="4166" class="Symbol">))</a>        <a id="4176" class="Symbol">(</a><a id="4177" href="Class.IsSet.html#916" class="Function">dom</a> <a id="4181" href="Ledger.Prelude.html#2407" class="Function Operator">∣</a> <a id="4183" href="Ledger.Core.Specification.Address.html#1839" class="Field">WithdrawalsOf</a> <a id="4197" href="Ledger.Dijkstra.Specification.Script.Validation.html#4113" class="Bound">tx</a> <a id="4200" href="Ledger.Prelude.html#2407" class="Function Operator">∣</a><a id="4201" class="Symbol">)</a>
  <a id="4205" href="Axiom.Set.html#9137" class="Function Operator">∪</a> <a id="4207" href="Axiom.Set.html#7990" class="Function">mapPartial</a>  <a id="4219" class="Symbol">(λ</a> <a id="4222" href="Ledger.Dijkstra.Specification.Script.Validation.html#4222" class="Bound">c</a> <a id="4224" class="Symbol">→</a>  <a id="4227" class="Symbol">(</a><a id="4228" href="Ledger.Dijkstra.Specification.Script.ScriptPurpose.html#329" class="InductiveConstructor">Cert</a> <a id="4233" href="Ledger.Dijkstra.Specification.Script.Validation.html#4222" class="Bound">c</a> <a id="4235" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,_</a><a id="4237" class="Symbol">)</a> <a id="4239" href="Class.Functor.Core.html#242" class="Field Operator">&lt;$&gt;</a> <a id="4243" href="Ledger.Dijkstra.Specification.Certs.html#1370" class="Function">cwitness</a> <a id="4252" href="Ledger.Dijkstra.Specification.Script.Validation.html#4222" class="Bound">c</a><a id="4253" class="Symbol">)</a>       <a id="4261" class="Symbol">(</a><a id="4262" href="Axiom.Set.html#5903" class="Function">fromList</a> <a id="4271" class="Symbol">(</a><a id="4272" href="Ledger.Dijkstra.Specification.Transaction.html#7687" class="Field">DCertsOf</a> <a id="4281" href="Ledger.Dijkstra.Specification.Script.Validation.html#4113" class="Bound">tx</a><a id="4283" class="Symbol">))</a>
  <a id="4288" href="Axiom.Set.html#9137" class="Function Operator">∪</a> <a id="4290" href="abstract-set-theory.FiniteSetTheory.html#519" class="Function">mapˢ</a>        <a id="4302" class="Symbol">(λ</a> <a id="4305" href="Ledger.Dijkstra.Specification.Script.Validation.html#4305" class="Bound">x</a> <a id="4307" class="Symbol">→</a>  <a id="4310" class="Symbol">(</a><a id="4311" href="Ledger.Dijkstra.Specification.Script.ScriptPurpose.html#417" class="InductiveConstructor">Mint</a> <a id="4316" href="Ledger.Dijkstra.Specification.Script.Validation.html#4305" class="Bound">x</a> <a id="4318" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="4320" href="Ledger.Core.Specification.Address.html#321" class="InductiveConstructor">ScriptObj</a> <a id="4330" href="Ledger.Dijkstra.Specification.Script.Validation.html#4305" class="Bound">x</a><a id="4331" class="Symbol">))</a>           <a id="4344" class="Symbol">(</a><a id="4345" href="Ledger.Conway.Specification.TokenAlgebra.Base.html#927" class="Function">policies</a> <a id="4354" class="Symbol">(</a><a id="4355" href="Ledger.Dijkstra.Specification.Transaction.html#7449" class="Field">MintedValueOf</a> <a id="4369" href="Ledger.Dijkstra.Specification.Script.Validation.html#4113" class="Bound">tx</a><a id="4371" class="Symbol">))</a>
  <a id="4376" href="Axiom.Set.html#9137" class="Function Operator">∪</a> <a id="4378" href="abstract-set-theory.FiniteSetTheory.html#519" class="Function">mapˢ</a>        <a id="4390" class="Symbol">(λ</a> <a id="4393" href="Ledger.Dijkstra.Specification.Script.Validation.html#4393" class="Bound">v</a> <a id="4395" class="Symbol">→</a>  <a id="4398" class="Symbol">(</a><a id="4399" href="Ledger.Dijkstra.Specification.Script.ScriptPurpose.html#505" class="InductiveConstructor">Vote</a> <a id="4404" href="Ledger.Dijkstra.Specification.Script.Validation.html#4393" class="Bound">v</a> <a id="4406" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="4408" href="Ledger.Dijkstra.Specification.Gov.Actions.html#3741" class="Function">govVoterCredential</a> <a id="4427" href="Ledger.Dijkstra.Specification.Script.Validation.html#4393" class="Bound">v</a><a id="4428" class="Symbol">))</a>  <a id="4432" class="Symbol">(</a><a id="4433" href="Axiom.Set.html#5903" class="Function">fromList</a> <a id="4442" class="Symbol">(</a><a id="4443" href="Class.Functor.Core.html#272" class="Function">map</a> <a id="4447" href="Ledger.Dijkstra.Specification.Gov.Actions.html#4490" class="Field">GovVoterOf</a> <a id="4458" class="Symbol">(</a><a id="4459" href="Ledger.Dijkstra.Specification.Transaction.html#8082" class="Field">ListOfGovVotesOf</a> <a id="4476" href="Ledger.Dijkstra.Specification.Script.Validation.html#4113" class="Bound">tx</a><a id="4478" class="Symbol">)))</a>
  <a id="4484" href="Axiom.Set.html#9137" class="Function Operator">∪</a> <a id="4486" href="Axiom.Set.html#7990" class="Function">mapPartial</a>  <a id="4498" class="Symbol">(λ</a> <a id="4501" href="Ledger.Dijkstra.Specification.Script.Validation.html#4501" class="Bound">p</a> <a id="4503" class="Symbol">→</a>  <a id="4506" href="Class.ToBool.html#342" class="Function Operator">if</a> <a id="4509" href="Ledger.Dijkstra.Specification.Gov.Actions.html#4820" class="Field">PolicyOf</a> <a id="4518" href="Ledger.Dijkstra.Specification.Script.Validation.html#4501" class="Bound">p</a> <a id="4520" href="Class.ToBool.html#342" class="Function Operator">then</a> <a id="4525" class="Symbol">(λ</a> <a id="4528" class="Symbol">{</a><a id="4529" href="Ledger.Dijkstra.Specification.Script.Validation.html#4529" class="Bound">sh</a><a id="4531" class="Symbol">}</a> <a id="4533" class="Symbol">→</a> <a id="4535" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="4540" class="Symbol">(</a><a id="4541" href="Ledger.Dijkstra.Specification.Script.ScriptPurpose.html#549" class="InductiveConstructor">Propose</a>  <a id="4550" href="Ledger.Dijkstra.Specification.Script.Validation.html#4501" class="Bound">p</a> <a id="4552" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="4554" href="Ledger.Core.Specification.Address.html#321" class="InductiveConstructor">ScriptObj</a> <a id="4564" href="Ledger.Dijkstra.Specification.Script.Validation.html#4529" class="Bound">sh</a><a id="4566" class="Symbol">))</a>
                        <a id="4593" href="Class.ToBool.html#342" class="Function Operator">else</a> <a id="4598" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a><a id="4605" class="Symbol">)</a> <a id="4607" class="Symbol">(</a><a id="4608" href="Axiom.Set.html#5903" class="Function">fromList</a> <a id="4617" class="Symbol">(</a><a id="4618" href="Ledger.Dijkstra.Specification.Transaction.html#7926" class="Field">ListOfGovProposalsOf</a> <a id="4639" href="Ledger.Dijkstra.Specification.Script.Validation.html#4113" class="Bound">tx</a><a id="4641" class="Symbol">))</a>
  <a id="4646" href="Axiom.Set.html#9137" class="Function Operator">∪</a> <a id="4648" href="abstract-set-theory.FiniteSetTheory.html#519" class="Function">mapˢ</a>        <a id="4660" class="Symbol">(λ</a> <a id="4663" href="Ledger.Dijkstra.Specification.Script.Validation.html#4663" class="Bound">c</a> <a id="4665" class="Symbol">→</a>  <a id="4668" class="Symbol">(</a><a id="4669" href="Ledger.Dijkstra.Specification.Script.ScriptPurpose.html#593" class="InductiveConstructor">Guard</a> <a id="4675" href="Ledger.Dijkstra.Specification.Script.Validation.html#4663" class="Bound">c</a> <a id="4677" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="4679" href="Ledger.Dijkstra.Specification.Script.Validation.html#4663" class="Bound">c</a><a id="4680" class="Symbol">))</a> <a id="4683" class="Symbol">(</a><a id="4684" href="Ledger.Dijkstra.Specification.Transaction.html#8218" class="Field">GuardsOf</a> <a id="4693" href="Ledger.Dijkstra.Specification.Script.Validation.html#4113" class="Bound">tx</a><a id="4695" class="Symbol">)</a> <a id="4697" class="Comment">-- collectP2ScriptsWithContext should</a>
                                                     <a id="4788" class="Comment">-- include scripts with creds in txGuards.</a>

<a id="credsNeeded"></a><a id="4832" href="Ledger.Dijkstra.Specification.Script.Validation.html#4832" class="Function">credsNeeded</a> <a id="4844" class="Symbol">:</a> <a id="4846" class="Symbol">{</a><a id="4847" href="Ledger.Dijkstra.Specification.Script.Validation.html#4847" class="Bound">ℓ</a> <a id="4849" class="Symbol">:</a> <a id="4851" href="Ledger.Dijkstra.Specification.Transaction.html#768" class="Datatype">TxLevel</a><a id="4858" class="Symbol">}</a> <a id="4860" class="Symbol">→</a> <a id="4862" href="Ledger.Dijkstra.Specification.Transaction.html#3158" class="Function">UTxO</a> <a id="4867" class="Symbol">→</a> <a id="4869" href="Ledger.Dijkstra.Specification.Transaction.html#3522" class="Record">Tx</a> <a id="4872" href="Ledger.Dijkstra.Specification.Script.Validation.html#4847" class="Bound">ℓ</a> <a id="4874" class="Symbol">→</a> <a id="4876" href="abstract-set-theory.FiniteSetTheory.html#488" class="Function Operator">ℙ</a> <a id="4878" class="Symbol">(</a><a id="4879" href="Ledger.Dijkstra.Specification.Script.ScriptPurpose.html#300" class="Datatype">ScriptPurpose</a> <a id="4893" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="4895" href="Ledger.Core.Specification.Address.html#259" class="Datatype">Credential</a><a id="4905" class="Symbol">)</a>
<a id="4907" href="Ledger.Dijkstra.Specification.Script.Validation.html#4832" class="Function">credsNeeded</a> <a id="4919" class="Symbol">{</a><a id="4920" href="Ledger.Dijkstra.Specification.Transaction.html#791" class="InductiveConstructor">TxLevelTop</a><a id="4930" class="Symbol">}</a> <a id="4932" href="Ledger.Dijkstra.Specification.Script.Validation.html#4932" class="Bound">utxo</a> <a id="4937" href="Ledger.Dijkstra.Specification.Script.Validation.html#4937" class="Bound">tx</a> <a id="4940" class="Symbol">=</a>
  <a id="4944" href="Ledger.Dijkstra.Specification.Script.Validation.html#4003" class="Function">credsNeededMinusCollateral</a> <a id="4971" href="Ledger.Dijkstra.Specification.Script.Validation.html#4937" class="Bound">tx</a>
    <a id="4978" href="Axiom.Set.html#9137" class="Function Operator">∪</a> <a id="4980" href="abstract-set-theory.FiniteSetTheory.html#519" class="Function">mapˢ</a>  <a id="4986" class="Symbol">(λ</a> <a id="4989" class="Symbol">(</a><a id="4990" href="Ledger.Dijkstra.Specification.Script.Validation.html#4990" class="Bound">i</a> <a id="4992" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="4994" href="Ledger.Dijkstra.Specification.Script.Validation.html#4994" class="Bound">o</a><a id="4995" class="Symbol">)</a> <a id="4997" class="Symbol">→</a> <a id="4999" class="Symbol">(</a><a id="5000" href="Ledger.Dijkstra.Specification.Script.ScriptPurpose.html#461" class="InductiveConstructor">Spend</a>  <a id="5007" href="Ledger.Dijkstra.Specification.Script.Validation.html#4990" class="Bound">i</a> <a id="5009" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5011" href="Ledger.Core.Specification.Address.html#3056" class="Function">payCred</a> <a id="5019" class="Symbol">(</a><a id="5020" href="Data.Product.Base.html#636" class="Field">proj₁</a> <a id="5026" href="Ledger.Dijkstra.Specification.Script.Validation.html#4994" class="Bound">o</a><a id="5027" class="Symbol">)))</a>
            <a id="5043" class="Symbol">((</a><a id="5045" href="Ledger.Dijkstra.Specification.Script.Validation.html#4932" class="Bound">utxo</a> <a id="5050" href="Axiom.Set.Map.html#13536" class="Function Operator">∣</a> <a id="5052" class="Symbol">(</a><a id="5053" href="Ledger.Dijkstra.Specification.Transaction.html#7179" class="Field">SpendInputsOf</a> <a id="5067" href="Ledger.Dijkstra.Specification.Script.Validation.html#4937" class="Bound">tx</a> <a id="5070" href="Axiom.Set.html#9137" class="Function Operator">∪</a> <a id="5072" href="Ledger.Dijkstra.Specification.Transaction.html#6075" class="Field">CollateralInputsOf</a> <a id="5091" href="Ledger.Dijkstra.Specification.Script.Validation.html#4937" class="Bound">tx</a><a id="5093" class="Symbol">))</a> <a id="5096" href="Axiom.Set.Map.html#2293" class="Function Operator">ˢ</a><a id="5097" class="Symbol">)</a>

<a id="5100" href="Ledger.Dijkstra.Specification.Script.Validation.html#4832" class="Function">credsNeeded</a> <a id="5112" class="Symbol">{</a><a id="5113" href="Ledger.Dijkstra.Specification.Transaction.html#802" class="InductiveConstructor">TxLevelSub</a><a id="5123" class="Symbol">}</a> <a id="5125" href="Ledger.Dijkstra.Specification.Script.Validation.html#5125" class="Bound">utxo</a> <a id="5130" href="Ledger.Dijkstra.Specification.Script.Validation.html#5130" class="Bound">tx</a> <a id="5133" class="Symbol">=</a> <a id="5135" href="Ledger.Dijkstra.Specification.Script.Validation.html#4003" class="Function">credsNeededMinusCollateral</a> <a id="5162" href="Ledger.Dijkstra.Specification.Script.Validation.html#5130" class="Bound">tx</a>
  <a id="5167" href="Axiom.Set.html#9137" class="Function Operator">∪</a> <a id="5169" href="abstract-set-theory.FiniteSetTheory.html#519" class="Function">mapˢ</a> <a id="5174" class="Symbol">(λ</a> <a id="5177" class="Symbol">(</a><a id="5178" href="Ledger.Dijkstra.Specification.Script.Validation.html#5178" class="Bound">i</a> <a id="5180" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5182" href="Ledger.Dijkstra.Specification.Script.Validation.html#5182" class="Bound">o</a><a id="5183" class="Symbol">)</a> <a id="5185" class="Symbol">→</a> <a id="5187" class="Symbol">(</a><a id="5188" href="Ledger.Dijkstra.Specification.Script.ScriptPurpose.html#461" class="InductiveConstructor">Spend</a>  <a id="5195" href="Ledger.Dijkstra.Specification.Script.Validation.html#5178" class="Bound">i</a> <a id="5197" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5199" href="Ledger.Core.Specification.Address.html#3056" class="Function">payCred</a> <a id="5207" class="Symbol">(</a><a id="5208" href="Data.Product.Base.html#636" class="Field">proj₁</a> <a id="5214" href="Ledger.Dijkstra.Specification.Script.Validation.html#5182" class="Bound">o</a><a id="5215" class="Symbol">)))</a> <a id="5219" class="Symbol">((</a><a id="5221" href="Ledger.Dijkstra.Specification.Script.Validation.html#5125" class="Bound">utxo</a> <a id="5226" href="Axiom.Set.Map.html#13536" class="Function Operator">∣</a> <a id="5228" href="Ledger.Dijkstra.Specification.Transaction.html#7179" class="Field">SpendInputsOf</a> <a id="5242" href="Ledger.Dijkstra.Specification.Script.Validation.html#5130" class="Bound">tx</a><a id="5244" class="Symbol">)</a> <a id="5246" href="Axiom.Set.Map.html#2293" class="Function Operator">ˢ</a><a id="5247" class="Symbol">)</a>

<a id="txOutToDataHash"></a><a id="5250" href="Ledger.Dijkstra.Specification.Script.Validation.html#5250" class="Function">txOutToDataHash</a> <a id="5266" class="Symbol">:</a> <a id="5268" href="Ledger.Dijkstra.Specification.Transaction.html#3077" class="Function">TxOut</a> <a id="5274" class="Symbol">→</a> <a id="5276" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="5282" href="Ledger.Dijkstra.Specification.Script.Base.html#1788" class="Function">DataHash</a>
<a id="5291" href="Ledger.Dijkstra.Specification.Script.Validation.html#5250" class="Function">txOutToDataHash</a> <a id="5307" class="Symbol">(_</a> <a id="5310" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5312" class="Symbol">_</a> <a id="5314" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5316" href="Ledger.Dijkstra.Specification.Script.Validation.html#5316" class="Bound">d</a> <a id="5318" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5320" class="Symbol">_)</a> <a id="5323" class="Symbol">=</a> <a id="5325" href="Ledger.Dijkstra.Specification.Script.Validation.html#5316" class="Bound">d</a> <a id="5327" href="Class.Monad.Core.html#337" class="Field Operator">&gt;&gt;=</a> <a id="5331" href="Data.Sum.html#870" class="Function">isInj₂</a>

<a id="txOutToP2Script"></a><a id="5339" href="Ledger.Dijkstra.Specification.Script.Validation.html#5339" class="Function">txOutToP2Script</a> <a id="5355" class="Symbol">:</a> <a id="5357" href="abstract-set-theory.FiniteSetTheory.html#488" class="Function Operator">ℙ</a> <a id="5359" href="Ledger.Dijkstra.Specification.Script.Base.html#2510" class="Function">Script</a> <a id="5366" class="Symbol">→</a> <a id="5368" href="Ledger.Dijkstra.Specification.Transaction.html#3077" class="Function">TxOut</a> <a id="5374" class="Symbol">→</a> <a id="5376" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="5382" href="Ledger.Dijkstra.Specification.Script.Base.html#2432" class="Function">P2Script</a>
<a id="5391" href="Ledger.Dijkstra.Specification.Script.Validation.html#5339" class="Function">txOutToP2Script</a> <a id="5407" href="Ledger.Dijkstra.Specification.Script.Validation.html#5407" class="Bound">allScripts</a> <a id="5418" class="Symbol">(</a><a id="5419" href="Ledger.Dijkstra.Specification.Script.Validation.html#5419" class="Bound">a</a> <a id="5421" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5423" class="Symbol">_)</a> <a id="5426" class="Symbol">=</a>
  <a id="5430" class="Keyword">do</a> <a id="5433" href="Ledger.Dijkstra.Specification.Script.Validation.html#5433" class="Bound">sh</a> <a id="5436" href="Class.Monad.Core.html#337" class="Field Operator">←</a> <a id="5438" href="Ledger.Core.Specification.Address.html#765" class="Function">isScriptObj</a> <a id="5450" class="Symbol">(</a><a id="5451" href="Ledger.Core.Specification.Address.html#3056" class="Function">payCred</a> <a id="5459" href="Ledger.Dijkstra.Specification.Script.Validation.html#5419" class="Bound">a</a><a id="5460" class="Symbol">)</a>
     <a id="5467" href="Ledger.Dijkstra.Specification.Script.Validation.html#5467" class="Bound">s</a>  <a id="5470" href="Class.Monad.Core.html#337" class="Field Operator">←</a> <a id="5472" href="Ledger.Prelude.html#2672" class="Function">lookupHash</a> <a id="5483" href="Ledger.Dijkstra.Specification.Script.Validation.html#5433" class="Bound">sh</a> <a id="5486" href="Ledger.Dijkstra.Specification.Script.Validation.html#5407" class="Bound">allScripts</a>
     <a id="5502" href="Ledger.Dijkstra.Specification.Script.Base.html#3285" class="Function">toP2Script</a> <a id="5513" href="Ledger.Dijkstra.Specification.Script.Validation.html#5467" class="Bound">s</a>

<a id="5516" class="Keyword">opaque</a>
  <a id="collectP2ScriptsWithContext"></a><a id="5525" href="Ledger.Dijkstra.Specification.Script.Validation.html#5525" class="Function">collectP2ScriptsWithContext</a> <a id="5553" class="Symbol">:</a> <a id="5555" class="Symbol">{</a><a id="5556" href="Ledger.Dijkstra.Specification.Script.Validation.html#5556" class="Bound">ℓ</a> <a id="5558" class="Symbol">:</a> <a id="5560" href="Ledger.Dijkstra.Specification.Transaction.html#768" class="Datatype">TxLevel</a><a id="5567" class="Symbol">}</a> <a id="5569" class="Symbol">→</a> <a id="5571" href="Ledger.Dijkstra.Specification.PParams.html#1960" class="Record">PParams</a> <a id="5579" class="Symbol">→</a> <a id="5581" href="Ledger.Dijkstra.Specification.Transaction.html#3522" class="Record">Tx</a> <a id="5584" href="Ledger.Dijkstra.Specification.Script.Validation.html#5556" class="Bound">ℓ</a>
    <a id="5590" class="Symbol">→</a> <a id="5592" href="Ledger.Dijkstra.Specification.Transaction.html#3158" class="Function">UTxO</a> <a id="5597" class="Symbol">→</a> <a id="5599" class="Symbol">(</a><a id="5600" href="Ledger.Dijkstra.Specification.Script.Base.html#1788" class="Function">DataHash</a> <a id="5609" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="5611" href="Ledger.Dijkstra.Specification.Script.Base.html#1835" class="Function">Datum</a><a id="5616" class="Symbol">)</a> <a id="5618" class="Symbol">→</a> <a id="5620" href="abstract-set-theory.FiniteSetTheory.html#488" class="Function Operator">ℙ</a> <a id="5622" href="Ledger.Dijkstra.Specification.Script.Base.html#2510" class="Function">Script</a>
    <a id="5633" class="Symbol">→</a> <a id="5635" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="5640" class="Symbol">(</a><a id="5641" href="Ledger.Dijkstra.Specification.Script.Base.html#2432" class="Function">P2Script</a> <a id="5650" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="5652" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="5657" href="Ledger.Dijkstra.Specification.Script.Base.html#1773" class="Function">Data</a> <a id="5662" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="5664" href="Ledger.Dijkstra.Specification.Script.Base.html#1023" class="Function">ExUnits</a> <a id="5672" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="5674" href="Ledger.Dijkstra.Specification.Script.Base.html#994" class="Function">CostModel</a><a id="5683" class="Symbol">)</a>
  <a id="5687" href="Ledger.Dijkstra.Specification.Script.Validation.html#5525" class="Function">collectP2ScriptsWithContext</a> <a id="5715" href="Ledger.Dijkstra.Specification.Script.Validation.html#5715" class="Bound">pp</a> <a id="5718" href="Ledger.Dijkstra.Specification.Script.Validation.html#5718" class="Bound">tx</a> <a id="5721" href="Ledger.Dijkstra.Specification.Script.Validation.html#5721" class="Bound">utxo</a> <a id="5726" href="Ledger.Dijkstra.Specification.Script.Validation.html#5726" class="Bound">extraData</a> <a id="5736" href="Ledger.Dijkstra.Specification.Script.Validation.html#5736" class="Bound">allScripts</a>
    <a id="5751" class="Symbol">=</a> <a id="5753" href="abstract-set-theory.FiniteSetTheory.html#2617" class="Function">setToList</a> <a id="5763" href="Function.Base.html#1993" class="Function Operator">$</a> <a id="5765" href="Axiom.Set.html#7990" class="Function">mapPartial</a>  <a id="5777" class="Symbol">(</a> <a id="5779" class="Symbol">λ</a> <a id="5781" class="Symbol">(</a><a id="5782" href="Ledger.Dijkstra.Specification.Script.Validation.html#5782" class="Bound">sp</a> <a id="5785" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5787" href="Ledger.Dijkstra.Specification.Script.Validation.html#5787" class="Bound">c</a><a id="5788" class="Symbol">)</a> <a id="5790" class="Symbol">→</a>  <a id="5793" href="Class.ToBool.html#342" class="Function Operator">if</a> <a id="5796" href="Ledger.Core.Specification.Address.html#765" class="Function">isScriptObj</a> <a id="5808" href="Ledger.Dijkstra.Specification.Script.Validation.html#5787" class="Bound">c</a>
                                              <a id="5856" href="Class.ToBool.html#342" class="Function Operator">then</a> <a id="5861" class="Symbol">(λ</a> <a id="5864" class="Symbol">{</a><a id="5865" href="Ledger.Dijkstra.Specification.Script.Validation.html#5865" class="Bound">sh</a><a id="5867" class="Symbol">}</a> <a id="5869" class="Symbol">→</a> <a id="5871" href="Ledger.Dijkstra.Specification.Script.Validation.html#6023" class="Function">toScriptInput</a> <a id="5885" href="Ledger.Dijkstra.Specification.Script.Validation.html#5782" class="Bound">sp</a> <a id="5888" href="Ledger.Dijkstra.Specification.Script.Validation.html#5865" class="Bound">sh</a><a id="5890" class="Symbol">)</a>
                                              <a id="5938" href="Class.ToBool.html#342" class="Function Operator">else</a> <a id="5943" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a> <a id="5951" class="Symbol">)</a>
                              <a id="5983" class="Symbol">(</a> <a id="5985" href="Ledger.Dijkstra.Specification.Script.Validation.html#4832" class="Function">credsNeeded</a> <a id="5997" href="Ledger.Dijkstra.Specification.Script.Validation.html#5721" class="Bound">utxo</a> <a id="6002" href="Ledger.Dijkstra.Specification.Script.Validation.html#5718" class="Bound">tx</a> <a id="6005" class="Symbol">)</a>
    <a id="6011" class="Keyword">where</a>
      <a id="6023" href="Ledger.Dijkstra.Specification.Script.Validation.html#6023" class="Function">toScriptInput</a>
        <a id="6045" class="Symbol">:</a> <a id="6047" href="Ledger.Dijkstra.Specification.Script.ScriptPurpose.html#300" class="Datatype">ScriptPurpose</a> <a id="6061" class="Symbol">→</a> <a id="6063" href="Ledger.Core.Specification.Crypto.html#1242" class="Function">ScriptHash</a>
        <a id="6082" class="Symbol">→</a> <a id="6084" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="6090" class="Symbol">(</a><a id="6091" href="Ledger.Dijkstra.Specification.Script.Base.html#2432" class="Function">P2Script</a> <a id="6100" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="6102" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="6107" href="Ledger.Dijkstra.Specification.Script.Base.html#1773" class="Function">Data</a> <a id="6112" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="6114" href="Ledger.Dijkstra.Specification.Script.Base.html#1023" class="Function">ExUnits</a> <a id="6122" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="6124" href="Ledger.Dijkstra.Specification.Script.Base.html#994" class="Function">CostModel</a><a id="6133" class="Symbol">)</a>
      <a id="6141" href="Ledger.Dijkstra.Specification.Script.Validation.html#6023" class="Function">toScriptInput</a> <a id="6155" href="Ledger.Dijkstra.Specification.Script.Validation.html#6155" class="Bound">sp</a> <a id="6158" href="Ledger.Dijkstra.Specification.Script.Validation.html#6158" class="Bound">sh</a> <a id="6161" class="Symbol">=</a>
        <a id="6171" class="Keyword">do</a> <a id="6174" href="Ledger.Dijkstra.Specification.Script.Validation.html#6174" class="Bound">s</a> <a id="6176" href="Class.Monad.Core.html#337" class="Field Operator">←</a> <a id="6178" href="Ledger.Prelude.html#2672" class="Function">lookupHash</a> <a id="6189" href="Ledger.Dijkstra.Specification.Script.Validation.html#6158" class="Bound">sh</a> <a id="6192" href="Ledger.Dijkstra.Specification.Script.Validation.html#5736" class="Bound">allScripts</a>
           <a id="6214" href="Ledger.Dijkstra.Specification.Script.Validation.html#6214" class="Bound">p2s</a> <a id="6218" href="Class.Monad.Core.html#337" class="Field Operator">←</a> <a id="6220" href="Ledger.Dijkstra.Specification.Script.Base.html#3285" class="Function">toP2Script</a> <a id="6231" href="Ledger.Dijkstra.Specification.Script.Validation.html#6174" class="Bound">s</a>
           <a id="6244" class="Symbol">(</a><a id="6245" href="Ledger.Dijkstra.Specification.Script.Validation.html#6245" class="Bound">rdmr</a> <a id="6250" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="6252" href="Ledger.Dijkstra.Specification.Script.Validation.html#6252" class="Bound">exunits</a><a id="6259" class="Symbol">)</a> <a id="6261" href="Class.Monad.Core.html#337" class="Field Operator">←</a> <a id="6263" href="Ledger.Dijkstra.Specification.Script.Validation.html#1255" class="Function">indexedRdmrs</a> <a id="6276" href="Ledger.Dijkstra.Specification.Script.Validation.html#5718" class="Bound">tx</a> <a id="6279" href="Ledger.Dijkstra.Specification.Script.Validation.html#6155" class="Bound">sp</a>
           <a id="6293" class="Keyword">let</a> <a id="6297" href="Ledger.Dijkstra.Specification.Script.Validation.html#6297" class="Bound">data&#39;</a> <a id="6303" class="Symbol">=</a> <a id="6305" href="Data.Maybe.Base.html#1276" class="Function">maybe</a> <a id="6311" href="Data.List.Base.html#4907" class="Function Operator">[_]</a> <a id="6315" class="InductiveConstructor">[]</a> <a id="6318" class="Symbol">(</a><a id="6319" href="Ledger.Dijkstra.Specification.Script.Validation.html#1588" class="Function">getDatum</a> <a id="6328" href="Ledger.Dijkstra.Specification.Script.Validation.html#5718" class="Bound">tx</a> <a id="6331" href="Ledger.Dijkstra.Specification.Script.Validation.html#5721" class="Bound">utxo</a> <a id="6336" href="Ledger.Dijkstra.Specification.Script.Validation.html#5726" class="Bound">extraData</a> <a id="6346" href="Ledger.Dijkstra.Specification.Script.Validation.html#6155" class="Bound">sp</a><a id="6348" class="Symbol">)</a>
                        <a id="6374" href="Data.List.Base.html#1712" class="Function Operator">++</a> <a id="6377" href="Ledger.Dijkstra.Specification.Script.Validation.html#6245" class="Bound">rdmr</a> <a id="6382" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="6384" href="Data.List.Base.html#4907" class="Function Operator">[</a> <a id="6386" href="Ledger.Dijkstra.Specification.Abstract.html#1197" class="Field">valContext</a> <a id="6397" class="Symbol">(</a><a id="6398" href="Ledger.Dijkstra.Specification.Script.Validation.html#3289" class="Function">txInfoForPurpose</a> <a id="6415" href="Ledger.Dijkstra.Specification.Script.Validation.html#5721" class="Bound">utxo</a> <a id="6420" href="Ledger.Dijkstra.Specification.Script.Validation.html#5718" class="Bound">tx</a> <a id="6423" href="Ledger.Dijkstra.Specification.Script.Validation.html#6155" class="Bound">sp</a><a id="6425" class="Symbol">)</a> <a id="6427" href="Ledger.Dijkstra.Specification.Script.Validation.html#6155" class="Bound">sp</a> <a id="6430" href="Data.List.Base.html#4907" class="Function Operator">]</a>
           <a id="6443" href="Ledger.Dijkstra.Specification.Script.Validation.html#6443" class="Bound">costModel</a> <a id="6453" href="Class.Monad.Core.html#337" class="Field Operator">←</a> <a id="6455" href="Axiom.Set.Map.html#17169" class="Function">lookupᵐ?</a> <a id="6464" class="Symbol">(</a><a id="6465" href="Ledger.Dijkstra.Specification.PParams.html#3673" class="Function">PParams.costmdls</a> <a id="6482" href="Ledger.Dijkstra.Specification.Script.Validation.html#5715" class="Bound">pp</a><a id="6484" class="Symbol">)</a> <a id="6486" class="Symbol">(</a><a id="6487" href="Ledger.Dijkstra.Specification.Script.Base.html#2029" class="Function">language</a> <a id="6496" href="Ledger.Dijkstra.Specification.Script.Validation.html#6214" class="Bound">p2s</a><a id="6499" class="Symbol">)</a>
           <a id="6512" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="6517" class="Symbol">(</a><a id="6518" href="Ledger.Dijkstra.Specification.Script.Validation.html#6214" class="Bound">p2s</a> <a id="6522" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="6524" href="Ledger.Dijkstra.Specification.Script.Validation.html#6297" class="Bound">data&#39;</a> <a id="6530" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="6532" href="Ledger.Dijkstra.Specification.Script.Validation.html#6252" class="Bound">exunits</a> <a id="6540" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="6542" href="Ledger.Dijkstra.Specification.Script.Validation.html#6443" class="Bound">costModel</a><a id="6551" class="Symbol">)</a>

<a id="evalP2Scripts"></a><a id="6554" href="Ledger.Dijkstra.Specification.Script.Validation.html#6554" class="Function">evalP2Scripts</a> <a id="6568" class="Symbol">:</a> <a id="6570" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="6575" class="Symbol">(</a><a id="6576" href="Ledger.Dijkstra.Specification.Script.Base.html#2432" class="Function">P2Script</a> <a id="6585" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="6587" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="6592" href="Ledger.Dijkstra.Specification.Script.Base.html#1773" class="Function">Data</a> <a id="6597" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="6599" href="Ledger.Dijkstra.Specification.Script.Base.html#1023" class="Function">ExUnits</a> <a id="6607" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="6609" href="Ledger.Dijkstra.Specification.Script.Base.html#994" class="Function">CostModel</a><a id="6618" class="Symbol">)</a> <a id="6620" class="Symbol">→</a> <a id="6622" href="Agda.Builtin.Bool.html#173" class="Datatype">Bool</a>
<a id="6627" href="Ledger.Dijkstra.Specification.Script.Validation.html#6554" class="Function">evalP2Scripts</a> <a id="6641" class="Symbol">=</a> <a id="6643" href="Data.Bool.ListAction.html#927" class="Function">all</a> <a id="6647" class="Symbol">(λ</a> <a id="6650" class="Symbol">(</a><a id="6651" href="Ledger.Dijkstra.Specification.Script.Validation.html#6651" class="Bound">s</a> <a id="6653" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="6655" href="Ledger.Dijkstra.Specification.Script.Validation.html#6655" class="Bound">d</a> <a id="6657" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="6659" href="Ledger.Dijkstra.Specification.Script.Validation.html#6659" class="Bound">eu</a> <a id="6662" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="6664" href="Ledger.Dijkstra.Specification.Script.Validation.html#6664" class="Bound">cm</a><a id="6666" class="Symbol">)</a> <a id="6668" class="Symbol">→</a> <a id="6670" href="Ledger.Dijkstra.Specification.Abstract.html#1084" class="Field">runPLCScript</a> <a id="6683" href="Ledger.Dijkstra.Specification.Script.Validation.html#6664" class="Bound">cm</a> <a id="6686" href="Ledger.Dijkstra.Specification.Script.Validation.html#6651" class="Bound">s</a> <a id="6688" href="Ledger.Dijkstra.Specification.Script.Validation.html#6659" class="Bound">eu</a> <a id="6691" href="Ledger.Dijkstra.Specification.Script.Validation.html#6655" class="Bound">d</a><a id="6692" class="Symbol">)</a>

</pre></body></html>