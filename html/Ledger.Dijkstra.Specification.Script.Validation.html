<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>Ledger.Dijkstra.Specification.Script.Validation</title><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.css"><link rel="stylesheet" href="Agda.css"><script src="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.js"></script><script src="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/contrib/auto-render.min.js"></script><script src="AgdaKaTeX.js" defer=""></script></head><body><pre class="Agda">
<a id="2" class="Symbol">{-#</a> <a id="6" class="Keyword">OPTIONS</a> <a id="14" class="Pragma">--safe</a> <a id="21" class="Symbol">#-}</a>

<a id="26" class="Keyword">open</a> <a id="31" class="Keyword">import</a> <a id="38" href="Ledger.Dijkstra.Specification.Transaction.html" class="Module">Ledger.Dijkstra.Specification.Transaction</a>
<a id="80" class="Keyword">open</a> <a id="85" class="Keyword">import</a> <a id="92" href="Ledger.Dijkstra.Specification.Abstract.html" class="Module">Ledger.Dijkstra.Specification.Abstract</a>

<a id="132" class="Keyword">module</a> <a id="139" href="Ledger.Dijkstra.Specification.Script.Validation.html" class="Module">Ledger.Dijkstra.Specification.Script.Validation</a>
  <a id="189" class="Symbol">(</a><a id="190" href="Ledger.Dijkstra.Specification.Script.Validation.html#190" class="Bound">txs</a> <a id="194" class="Symbol">:</a> <a id="196" class="Symbol">_)</a> <a id="199" class="Symbol">(</a><a id="200" class="Keyword">open</a> <a id="205" href="Ledger.Dijkstra.Specification.Transaction.html#1279" class="Module">TransactionStructure</a> <a id="226" href="Ledger.Dijkstra.Specification.Script.Validation.html#190" class="Bound">txs</a><a id="229" class="Symbol">)</a>
  <a id="233" class="Symbol">(</a><a id="234" href="Ledger.Dijkstra.Specification.Script.Validation.html#234" class="Bound">abs</a> <a id="238" class="Symbol">:</a> <a id="240" href="Ledger.Dijkstra.Specification.Abstract.html#845" class="Record">AbstractFunctions</a> <a id="258" href="Ledger.Dijkstra.Specification.Script.Validation.html#190" class="Bound">txs</a><a id="261" class="Symbol">)</a> <a id="263" class="Symbol">(</a><a id="264" class="Keyword">open</a> <a id="269" href="Ledger.Dijkstra.Specification.Abstract.html#845" class="Module">AbstractFunctions</a> <a id="287" href="Ledger.Dijkstra.Specification.Script.Validation.html#234" class="Bound">abs</a><a id="290" class="Symbol">)</a> <a id="292" class="Symbol">(</a><a id="293" class="Keyword">open</a> <a id="298" href="Ledger.Dijkstra.Specification.Abstract.html#290" class="Module">indexOf</a> <a id="306" href="Ledger.Dijkstra.Specification.Abstract.html#983" class="Field">indexOfImp</a><a id="316" class="Symbol">)</a>
  <a id="320" class="Keyword">where</a>

<a id="327" class="Keyword">open</a> <a id="332" class="Keyword">import</a> <a id="339" href="Ledger.Prelude.html" class="Module">Ledger.Prelude</a>
<a id="354" class="Keyword">open</a> <a id="359" class="Keyword">import</a> <a id="366" href="Ledger.Dijkstra.Specification.Certs.html" class="Module">Ledger.Dijkstra.Specification.Certs</a> <a id="402" href="Ledger.Dijkstra.Specification.Transaction.html#2455" class="Function">govStructure</a>


<a id="417" class="Keyword">data</a> <a id="ScriptPurpose"></a><a id="422" href="Ledger.Dijkstra.Specification.Script.Validation.html#422" class="Datatype">ScriptPurpose</a> <a id="436" class="Symbol">:</a> <a id="438" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="443" class="Keyword">where</a>
  <a id="ScriptPurpose.Cert"></a><a id="451" href="Ledger.Dijkstra.Specification.Script.Validation.html#451" class="InductiveConstructor">Cert</a>     <a id="460" class="Symbol">:</a> <a id="462" href="Ledger.Conway.Specification.Certs.html#2116" class="Datatype">DCert</a>          <a id="477" class="Symbol">→</a> <a id="479" href="Ledger.Dijkstra.Specification.Script.Validation.html#422" class="Datatype">ScriptPurpose</a>
  <a id="ScriptPurpose.Rwrd"></a><a id="495" href="Ledger.Dijkstra.Specification.Script.Validation.html#495" class="InductiveConstructor">Rwrd</a>     <a id="504" class="Symbol">:</a> <a id="506" href="Ledger.Dijkstra.Specification.Transaction.html#376" class="Record">RewardAddress</a>  <a id="521" class="Symbol">→</a> <a id="523" href="Ledger.Dijkstra.Specification.Script.Validation.html#422" class="Datatype">ScriptPurpose</a>
  <a id="ScriptPurpose.Mint"></a><a id="539" href="Ledger.Dijkstra.Specification.Script.Validation.html#539" class="InductiveConstructor">Mint</a>     <a id="548" class="Symbol">:</a> <a id="550" href="Ledger.Core.Specification.Crypto.html#1242" class="Function">ScriptHash</a>     <a id="565" class="Symbol">→</a> <a id="567" href="Ledger.Dijkstra.Specification.Script.Validation.html#422" class="Datatype">ScriptPurpose</a>
  <a id="ScriptPurpose.Spend"></a><a id="583" href="Ledger.Dijkstra.Specification.Script.Validation.html#583" class="InductiveConstructor">Spend</a>    <a id="592" class="Symbol">:</a> <a id="594" href="Ledger.Dijkstra.Specification.Transaction.html#2993" class="Function">TxIn</a>           <a id="609" class="Symbol">→</a> <a id="611" href="Ledger.Dijkstra.Specification.Script.Validation.html#422" class="Datatype">ScriptPurpose</a>
  <a id="ScriptPurpose.Vote"></a><a id="627" href="Ledger.Dijkstra.Specification.Script.Validation.html#627" class="InductiveConstructor">Vote</a>     <a id="636" class="Symbol">:</a> <a id="638" href="Ledger.Conway.Specification.Gov.Actions.html#2082" class="Record">GovVoter</a>       <a id="653" class="Symbol">→</a> <a id="655" href="Ledger.Dijkstra.Specification.Script.Validation.html#422" class="Datatype">ScriptPurpose</a>
  <a id="ScriptPurpose.Propose"></a><a id="671" href="Ledger.Dijkstra.Specification.Script.Validation.html#671" class="InductiveConstructor">Propose</a>  <a id="680" class="Symbol">:</a> <a id="682" href="Ledger.Conway.Specification.Gov.Actions.html#3603" class="Record">GovProposal</a>    <a id="697" class="Symbol">→</a> <a id="699" href="Ledger.Dijkstra.Specification.Script.Validation.html#422" class="Datatype">ScriptPurpose</a>
  <a id="ScriptPurpose.Guard"></a><a id="715" href="Ledger.Dijkstra.Specification.Script.Validation.html#715" class="InductiveConstructor">Guard</a>    <a id="724" class="Symbol">:</a> <a id="726" href="Ledger.Core.Specification.Address.html#259" class="Datatype">Credential</a>     <a id="741" class="Symbol">→</a> <a id="743" href="Ledger.Dijkstra.Specification.Script.Validation.html#422" class="Datatype">ScriptPurpose</a>


<a id="759" class="Keyword">private</a> <a id="767" class="Keyword">variable</a>
  <a id="778" href="Ledger.Dijkstra.Specification.Script.Validation.html#778" class="Generalizable">ℓ</a> <a id="780" class="Symbol">:</a> <a id="782" href="Ledger.Dijkstra.Specification.Transaction.html#718" class="Datatype">TxLevel</a>

<a id="rdptr"></a><a id="791" href="Ledger.Dijkstra.Specification.Script.Validation.html#791" class="Function">rdptr</a> <a id="797" class="Symbol">:</a> <a id="799" class="Symbol">(</a><a id="800" href="Ledger.Dijkstra.Specification.Transaction.html#3472" class="Record">Tx</a> <a id="803" href="Ledger.Dijkstra.Specification.Script.Validation.html#778" class="Generalizable">ℓ</a><a id="804" class="Symbol">)</a> <a id="806" class="Symbol">→</a> <a id="808" href="Ledger.Dijkstra.Specification.Script.Validation.html#422" class="Datatype">ScriptPurpose</a> <a id="822" class="Symbol">→</a> <a id="824" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="830" class="Symbol">(</a><a id="831" href="Ledger.Dijkstra.Specification.Transaction.html#3145" class="Function">RedeemerPtr</a> <a id="843" href="Ledger.Dijkstra.Specification.Script.Validation.html#778" class="Generalizable">ℓ</a><a id="844" class="Symbol">)</a>
<a id="846" href="Ledger.Dijkstra.Specification.Script.Validation.html#791" class="Function">rdptr</a> <a id="852" href="Ledger.Dijkstra.Specification.Script.Validation.html#852" class="Bound">tx</a> <a id="855" class="Symbol">=</a> <a id="857" class="Symbol">λ</a> <a id="859" class="Keyword">where</a>
  <a id="867" class="Symbol">(</a><a id="868" href="Ledger.Dijkstra.Specification.Script.Validation.html#451" class="InductiveConstructor">Cert</a> <a id="873" href="Ledger.Dijkstra.Specification.Script.Validation.html#873" class="Bound">h</a><a id="874" class="Symbol">)</a>     <a id="880" class="Symbol">→</a> <a id="882" href="Class.Functor.Core.html#272" class="Function">map</a> <a id="886" class="Symbol">(</a><a id="887" href="Ledger.Dijkstra.Specification.Transaction.html#1128" class="InductiveConstructor">Cert</a>     <a id="896" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,_</a><a id="898" class="Symbol">)</a> <a id="900" href="Function.Base.html#1993" class="Function Operator">$</a> <a id="902" href="Ledger.Dijkstra.Specification.Abstract.html#323" class="Function">indexOfDCert</a>          <a id="924" href="Ledger.Dijkstra.Specification.Script.Validation.html#873" class="Bound">h</a> <a id="926" href="Ledger.Dijkstra.Specification.Transaction.html#4008" class="Function">txCerts</a>
  <a id="936" class="Symbol">(</a><a id="937" href="Ledger.Dijkstra.Specification.Script.Validation.html#495" class="InductiveConstructor">Rwrd</a> <a id="942" href="Ledger.Dijkstra.Specification.Script.Validation.html#942" class="Bound">h</a><a id="943" class="Symbol">)</a>     <a id="949" class="Symbol">→</a> <a id="951" href="Class.Functor.Core.html#272" class="Function">map</a> <a id="955" class="Symbol">(</a><a id="956" href="Ledger.Dijkstra.Specification.Transaction.html#1133" class="InductiveConstructor">Reward</a>   <a id="965" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,_</a><a id="967" class="Symbol">)</a> <a id="969" href="Function.Base.html#1993" class="Function Operator">$</a> <a id="971" href="Ledger.Dijkstra.Specification.Abstract.html#397" class="Function">indexOfRewardAddress</a>  <a id="993" href="Ledger.Dijkstra.Specification.Script.Validation.html#942" class="Bound">h</a> <a id="995" href="Ledger.Dijkstra.Specification.Transaction.html#4105" class="Function">txWithdrawals</a>
  <a id="1011" class="Symbol">(</a><a id="1012" href="Ledger.Dijkstra.Specification.Script.Validation.html#539" class="InductiveConstructor">Mint</a> <a id="1017" href="Ledger.Dijkstra.Specification.Script.Validation.html#1017" class="Bound">h</a><a id="1018" class="Symbol">)</a>     <a id="1024" class="Symbol">→</a> <a id="1026" href="Class.Functor.Core.html#272" class="Function">map</a> <a id="1030" class="Symbol">(</a><a id="1031" href="Ledger.Dijkstra.Specification.Transaction.html#1123" class="InductiveConstructor">Mint</a>     <a id="1040" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,_</a><a id="1042" class="Symbol">)</a> <a id="1044" href="Function.Base.html#1993" class="Function Operator">$</a> <a id="1046" href="Ledger.Dijkstra.Specification.Abstract.html#545" class="Function">indexOfPolicyId</a>       <a id="1068" href="Ledger.Dijkstra.Specification.Script.Validation.html#1017" class="Bound">h</a> <a id="1070" class="Symbol">(</a><a id="1071" href="Ledger.Conway.Specification.TokenAlgebra.Base.html#927" class="Function">policies</a> <a id="1080" href="Ledger.Dijkstra.Specification.Transaction.html#4467" class="Function">mint</a><a id="1084" class="Symbol">)</a>
  <a id="1088" class="Symbol">(</a><a id="1089" href="Ledger.Dijkstra.Specification.Script.Validation.html#583" class="InductiveConstructor">Spend</a> <a id="1095" href="Ledger.Dijkstra.Specification.Script.Validation.html#1095" class="Bound">h</a><a id="1096" class="Symbol">)</a>    <a id="1101" class="Symbol">→</a> <a id="1103" href="Class.Functor.Core.html#272" class="Function">map</a> <a id="1107" class="Symbol">(</a><a id="1108" href="Ledger.Dijkstra.Specification.Transaction.html#1117" class="InductiveConstructor">Spend</a>    <a id="1117" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,_</a><a id="1119" class="Symbol">)</a> <a id="1121" href="Function.Base.html#1993" class="Function Operator">$</a> <a id="1123" href="Ledger.Dijkstra.Specification.Abstract.html#471" class="Function">indexOfTxIn</a>           <a id="1145" href="Ledger.Dijkstra.Specification.Script.Validation.html#1095" class="Bound">h</a> <a id="1147" href="Ledger.Dijkstra.Specification.Transaction.html#3795" class="Function">txIns</a>
  <a id="1155" class="Symbol">(</a><a id="1156" href="Ledger.Dijkstra.Specification.Script.Validation.html#627" class="InductiveConstructor">Vote</a> <a id="1161" href="Ledger.Dijkstra.Specification.Script.Validation.html#1161" class="Bound">h</a><a id="1162" class="Symbol">)</a>     <a id="1168" class="Symbol">→</a> <a id="1170" href="Class.Functor.Core.html#272" class="Function">map</a> <a id="1174" class="Symbol">(</a><a id="1175" href="Ledger.Dijkstra.Specification.Transaction.html#1140" class="InductiveConstructor">Vote</a>     <a id="1184" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,_</a><a id="1186" class="Symbol">)</a> <a id="1188" href="Function.Base.html#1993" class="Function Operator">$</a> <a id="1190" href="Ledger.Dijkstra.Specification.Abstract.html#619" class="Function">indexOfVote</a>           <a id="1212" href="Ledger.Dijkstra.Specification.Script.Validation.html#1161" class="Bound">h</a> <a id="1214" class="Symbol">(</a><a id="1215" href="Class.Functor.Core.html#272" class="Function">map</a> <a id="1219" href="Ledger.Conway.Specification.Gov.Actions.html#2357" class="Field">GovVote.voter</a> <a id="1233" href="Ledger.Dijkstra.Specification.Transaction.html#4288" class="Function">txGovVotes</a><a id="1243" class="Symbol">)</a>
  <a id="1247" class="Symbol">(</a><a id="1248" href="Ledger.Dijkstra.Specification.Script.Validation.html#671" class="InductiveConstructor">Propose</a> <a id="1256" href="Ledger.Dijkstra.Specification.Script.Validation.html#1256" class="Bound">h</a><a id="1257" class="Symbol">)</a>  <a id="1260" class="Symbol">→</a> <a id="1262" href="Class.Functor.Core.html#272" class="Function">map</a> <a id="1266" class="Symbol">(</a><a id="1267" href="Ledger.Dijkstra.Specification.Transaction.html#1145" class="InductiveConstructor">Propose</a>  <a id="1276" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,_</a><a id="1278" class="Symbol">)</a> <a id="1280" href="Function.Base.html#1993" class="Function Operator">$</a> <a id="1282" href="Ledger.Dijkstra.Specification.Abstract.html#693" class="Function">indexOfProposal</a>       <a id="1304" href="Ledger.Dijkstra.Specification.Script.Validation.html#1256" class="Bound">h</a> <a id="1306" href="Ledger.Dijkstra.Specification.Transaction.html#4332" class="Function">txGovProposals</a>
  <a id="1323" class="Symbol">(</a><a id="1324" href="Ledger.Dijkstra.Specification.Script.Validation.html#715" class="InductiveConstructor">Guard</a> <a id="1330" href="Ledger.Dijkstra.Specification.Script.Validation.html#1330" class="Bound">c</a><a id="1331" class="Symbol">)</a>    <a id="1336" class="Symbol">→</a> <a id="1338" href="Class.Functor.Core.html#272" class="Function">map</a> <a id="1342" class="Symbol">(</a><a id="1343" href="Ledger.Dijkstra.Specification.Transaction.html#1153" class="InductiveConstructor">Guard</a>    <a id="1352" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,_</a><a id="1354" class="Symbol">)</a> <a id="1356" href="Function.Base.html#1993" class="Function Operator">$</a> <a id="1358" href="Ledger.Dijkstra.Specification.Abstract.html#767" class="Function">indexOfGuard</a>          <a id="1380" href="Ledger.Dijkstra.Specification.Script.Validation.html#1330" class="Bound">c</a> <a id="1382" class="Symbol">(</a><a id="1383" href="abstract-set-theory.FiniteSetTheory.html#2617" class="Function">setToList</a> <a id="1393" href="Ledger.Dijkstra.Specification.Transaction.html#4661" class="Function">txGuards</a><a id="1401" class="Symbol">)</a>
    <a id="1407" class="Keyword">where</a> <a id="1413" class="Keyword">open</a> <a id="1418" href="Ledger.Dijkstra.Specification.Transaction.html#3719" class="Module">TxBody</a> <a id="1425" class="Symbol">(</a><a id="1426" href="Ledger.Dijkstra.Specification.Transaction.html#5475" class="Field">TxBodyOf</a> <a id="1435" href="Ledger.Dijkstra.Specification.Script.Validation.html#852" class="Bound">tx</a><a id="1437" class="Symbol">)</a>

<a id="1440" class="Comment">-- getSubTxScripts : TopLevelTx → ℙ (TxId × ScriptHash)</a>

<a id="indexedRdmrs"></a><a id="1497" href="Ledger.Dijkstra.Specification.Script.Validation.html#1497" class="Function">indexedRdmrs</a> <a id="1510" class="Symbol">:</a> <a id="1512" class="Symbol">(</a><a id="1513" href="Ledger.Dijkstra.Specification.Transaction.html#3472" class="Record">Tx</a> <a id="1516" href="Ledger.Dijkstra.Specification.Script.Validation.html#778" class="Generalizable">ℓ</a><a id="1517" class="Symbol">)</a> <a id="1519" class="Symbol">→</a> <a id="1521" href="Ledger.Dijkstra.Specification.Script.Validation.html#422" class="Datatype">ScriptPurpose</a> <a id="1535" class="Symbol">→</a> <a id="1537" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="1543" class="Symbol">(</a><a id="1544" href="Ledger.Conway.Specification.Script.Base.html#1788" class="Function">Redeemer</a> <a id="1553" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="1555" href="Ledger.Conway.Specification.Script.Base.html#1018" class="Function">ExUnits</a><a id="1562" class="Symbol">)</a>
<a id="1564" href="Ledger.Dijkstra.Specification.Script.Validation.html#1497" class="Function">indexedRdmrs</a> <a id="1577" href="Ledger.Dijkstra.Specification.Script.Validation.html#1577" class="Bound">tx</a> <a id="1580" href="Ledger.Dijkstra.Specification.Script.Validation.html#1580" class="Bound">sp</a> <a id="1583" class="Symbol">=</a> <a id="1585" href="Data.Maybe.Base.html#1276" class="Function">maybe</a> <a id="1591" class="Symbol">(λ</a> <a id="1594" href="Ledger.Dijkstra.Specification.Script.Validation.html#1594" class="Bound">x</a> <a id="1596" class="Symbol">→</a> <a id="1598" href="Axiom.Set.Map.html#17169" class="Function">lookupᵐ?</a> <a id="1607" href="Ledger.Dijkstra.Specification.Transaction.html#5110" class="Function">txRedeemers</a> <a id="1619" href="Ledger.Dijkstra.Specification.Script.Validation.html#1594" class="Bound">x</a><a id="1620" class="Symbol">)</a> <a id="1622" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a> <a id="1630" class="Symbol">(</a><a id="1631" href="Ledger.Dijkstra.Specification.Script.Validation.html#791" class="Function">rdptr</a> <a id="1637" href="Ledger.Dijkstra.Specification.Script.Validation.html#1577" class="Bound">tx</a> <a id="1640" href="Ledger.Dijkstra.Specification.Script.Validation.html#1580" class="Bound">sp</a><a id="1642" class="Symbol">)</a>
  <a id="1646" class="Keyword">where</a> <a id="1652" class="Keyword">open</a> <a id="1657" href="Ledger.Dijkstra.Specification.Transaction.html#3472" class="Module">Tx</a> <a id="1660" href="Ledger.Dijkstra.Specification.Script.Validation.html#1577" class="Bound">tx</a><a id="1662" class="Symbol">;</a> <a id="1664" class="Keyword">open</a> <a id="1669" href="Ledger.Dijkstra.Specification.Transaction.html#4923" class="Module">TxWitnesses</a> <a id="1681" href="Ledger.Dijkstra.Specification.Transaction.html#3582" class="Function">txWitnesses</a>

<a id="1694" class="Comment">-- Datum lookup for spent outputs (Spend txin). Uses initial UTxO snapshot, utxoSpend₀.</a>
<a id="getDatum"></a><a id="1782" href="Ledger.Dijkstra.Specification.Script.Validation.html#1782" class="Function">getDatum</a> <a id="1791" class="Symbol">:</a> <a id="1793" href="Ledger.Dijkstra.Specification.Transaction.html#3472" class="Record">Tx</a> <a id="1796" href="Ledger.Dijkstra.Specification.Script.Validation.html#778" class="Generalizable">ℓ</a> <a id="1798" class="Symbol">→</a> <a id="1800" href="Ledger.Dijkstra.Specification.Transaction.html#3108" class="Function">UTxO</a> <a id="1805" class="Symbol">→</a> <a id="1807" href="Ledger.Dijkstra.Specification.Script.Validation.html#422" class="Datatype">ScriptPurpose</a> <a id="1821" class="Symbol">→</a> <a id="1823" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="1829" href="Ledger.Conway.Specification.Script.Base.html#1770" class="Function">Datum</a>
<a id="1835" href="Ledger.Dijkstra.Specification.Script.Validation.html#1782" class="Function">getDatum</a> <a id="1844" href="Ledger.Dijkstra.Specification.Script.Validation.html#1844" class="Bound">tx</a> <a id="1847" href="Ledger.Dijkstra.Specification.Script.Validation.html#1847" class="Bound">utxoSpend₀</a> <a id="1858" class="Symbol">(</a><a id="1859" href="Ledger.Dijkstra.Specification.Script.Validation.html#583" class="InductiveConstructor">Spend</a> <a id="1865" href="Ledger.Dijkstra.Specification.Script.Validation.html#1865" class="Bound">txin</a><a id="1869" class="Symbol">)</a> <a id="1871" class="Symbol">=</a>
  <a id="1875" class="Keyword">do</a> <a id="1878" class="Symbol">(_</a> <a id="1881" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1883" class="Symbol">_</a> <a id="1885" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1887" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="1892" href="Ledger.Dijkstra.Specification.Script.Validation.html#1892" class="Bound">d</a> <a id="1894" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1896" class="Symbol">_)</a> <a id="1899" href="Class.Monad.Core.html#337" class="Field Operator">←</a> <a id="1901" href="Axiom.Set.Map.html#17169" class="Function">lookupᵐ?</a> <a id="1910" href="Ledger.Dijkstra.Specification.Script.Validation.html#1847" class="Bound">utxoSpend₀</a> <a id="1921" href="Ledger.Dijkstra.Specification.Script.Validation.html#1865" class="Bound">txin</a> <a id="1926" class="Keyword">where</a>
                            <a id="1960" class="Symbol">(_</a> <a id="1963" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1965" class="Symbol">_</a> <a id="1967" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1969" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a> <a id="1977" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1979" class="Symbol">_)</a> <a id="1982" class="Symbol">→</a> <a id="1984" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a>
     <a id="1997" href="Function.Base.html#4061" class="Function Operator">case</a> <a id="2002" href="Ledger.Dijkstra.Specification.Script.Validation.html#1892" class="Bound">d</a> <a id="2004" href="Function.Base.html#4061" class="Function Operator">of</a> <a id="2007" class="Symbol">λ</a> <a id="2009" class="Keyword">where</a>
       <a id="2022" class="Symbol">(</a><a id="2023" href="Data.Sum.Base.html#675" class="InductiveConstructor">inj₁</a> <a id="2028" href="Ledger.Dijkstra.Specification.Script.Validation.html#2028" class="Bound">d</a><a id="2029" class="Symbol">)</a> <a id="2031" class="Symbol">→</a> <a id="2033" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="2038" href="Ledger.Dijkstra.Specification.Script.Validation.html#2028" class="Bound">d</a>
       <a id="2047" class="Symbol">(</a><a id="2048" href="Data.Sum.Base.html#700" class="InductiveConstructor">inj₂</a> <a id="2053" href="Ledger.Dijkstra.Specification.Script.Validation.html#2053" class="Bound">h</a><a id="2054" class="Symbol">)</a> <a id="2056" class="Symbol">→</a> <a id="2058" href="Axiom.Set.Map.html#17169" class="Function">lookupᵐ?</a> <a id="2067" class="Symbol">(</a><a id="2068" href="Ledger.Prelude.html#1789" class="Function">setToMap</a> <a id="2077" class="Symbol">(</a><a id="2078" href="abstract-set-theory.FiniteSetTheory.html#519" class="Function">mapˢ</a> <a id="2083" href="Data.Product.Base.html#2000" class="Function Operator">&lt;</a> <a id="2085" href="Interface.TypeClasses.Hashable.html#219" class="Field">hash</a> <a id="2090" href="Data.Product.Base.html#2000" class="Function Operator">,</a> <a id="2092" href="Function.Base.html#704" class="Function">id</a> <a id="2095" href="Data.Product.Base.html#2000" class="Function Operator">&gt;</a> <a id="2097" class="Symbol">(</a><a id="2098" href="Ledger.Dijkstra.Specification.Transaction.html#6214" class="Field">DataOf</a> <a id="2105" href="Ledger.Dijkstra.Specification.Script.Validation.html#1844" class="Bound">tx</a><a id="2107" class="Symbol">)))</a> <a id="2111" href="Ledger.Dijkstra.Specification.Script.Validation.html#2053" class="Bound">h</a>
<a id="2113" href="Ledger.Dijkstra.Specification.Script.Validation.html#1782" class="CatchallClause Function">getDatum</a><a id="2121" class="CatchallClause"> </a><a id="2122" href="Ledger.Dijkstra.Specification.Script.Validation.html#2122" class="CatchallClause Bound">tx</a><a id="2124" class="CatchallClause"> </a><a id="2125" href="Ledger.Dijkstra.Specification.Script.Validation.html#2125" class="CatchallClause Bound">utxo</a><a id="2129" class="CatchallClause"> </a><a id="2130" class="CatchallClause Symbol">_</a> <a id="2132" class="Symbol">=</a> <a id="2134" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a>


<a id="2144" class="Keyword">mutual</a>
  <a id="2153" class="Keyword">record</a> <a id="TxInfo"></a><a id="2160" href="Ledger.Dijkstra.Specification.Script.Validation.html#2160" class="Record">TxInfo</a> <a id="2167" class="Symbol">:</a> <a id="2169" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="2174" class="Keyword">where</a>
    <a id="2184" class="Keyword">inductive</a>
    <a id="2198" class="Keyword">field</a>
      <a id="TxInfo.realizedInputs"></a><a id="2210" href="Ledger.Dijkstra.Specification.Script.Validation.html#2210" class="Field">realizedInputs</a> <a id="2225" class="Symbol">:</a> <a id="2227" href="Ledger.Dijkstra.Specification.Transaction.html#3108" class="Function">UTxO</a>
      <a id="TxInfo.txOuts"></a><a id="2238" href="Ledger.Dijkstra.Specification.Script.Validation.html#2238" class="Field">txOuts</a>         <a id="2253" class="Symbol">:</a> <a id="2255" href="Ledger.Dijkstra.Specification.Transaction.html#1326" class="Field">Ix</a> <a id="2258" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="2260" href="Ledger.Dijkstra.Specification.Transaction.html#3027" class="Function">TxOut</a>
      <a id="TxInfo.txFee"></a><a id="2272" href="Ledger.Dijkstra.Specification.Script.Validation.html#2272" class="Field">txFee</a>          <a id="2287" class="Symbol">:</a> <a id="2289" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="2295" href="Ledger.Prelude.Base.html#186" class="Function">Fees</a>
      <a id="TxInfo.mint"></a><a id="2306" href="Ledger.Dijkstra.Specification.Script.Validation.html#2306" class="Field">mint</a>           <a id="2321" class="Symbol">:</a> <a id="2323" href="Ledger.Conway.Specification.TokenAlgebra.Base.html#517" class="Function">Value</a>
      <a id="TxInfo.txCerts"></a><a id="2335" href="Ledger.Dijkstra.Specification.Script.Validation.html#2335" class="Field">txCerts</a>        <a id="2350" class="Symbol">:</a> <a id="2352" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="2357" href="Ledger.Conway.Specification.Certs.html#2116" class="Datatype">DCert</a>
      <a id="TxInfo.txWithdrawals"></a><a id="2369" href="Ledger.Dijkstra.Specification.Script.Validation.html#2369" class="Field">txWithdrawals</a>  <a id="2384" class="Symbol">:</a> <a id="2386" href="Ledger.Core.Specification.Address.html#1394" class="Function">Withdrawals</a>
      <a id="TxInfo.txVldt"></a><a id="2404" href="Ledger.Dijkstra.Specification.Script.Validation.html#2404" class="Field">txVldt</a>         <a id="2419" class="Symbol">:</a> <a id="2421" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="2427" href="Ledger.Core.Specification.Epoch.html#722" class="Function">Slot</a> <a id="2432" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="2434" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="2440" href="Ledger.Core.Specification.Epoch.html#722" class="Function">Slot</a>
      <a id="TxInfo.vkKey"></a><a id="2451" href="Ledger.Dijkstra.Specification.Script.Validation.html#2451" class="Field">vkKey</a>          <a id="2466" class="Symbol">:</a> <a id="2468" href="abstract-set-theory.FiniteSetTheory.html#488" class="Function Operator">ℙ</a> <a id="2470" href="Ledger.Core.Specification.Crypto.html#1386" class="Function">KeyHash</a>     <a id="2482" class="Comment">-- native/phase-1/timelock signers</a>
      <a id="TxInfo.txGuards"></a><a id="2523" href="Ledger.Dijkstra.Specification.Script.Validation.html#2523" class="Field">txGuards</a>       <a id="2538" class="Symbol">:</a> <a id="2540" href="abstract-set-theory.FiniteSetTheory.html#488" class="Function Operator">ℙ</a> <a id="2542" href="Ledger.Core.Specification.Address.html#259" class="Datatype">Credential</a>  <a id="2554" class="Comment">-- CIP-0112/0118 guards (required by tx body)</a>
      <a id="TxInfo.txData"></a><a id="2606" href="Ledger.Dijkstra.Specification.Script.Validation.html#2606" class="Field">txData</a>         <a id="2621" class="Symbol">:</a> <a id="2623" href="abstract-set-theory.FiniteSetTheory.html#488" class="Function Operator">ℙ</a> <a id="2625" href="Ledger.Conway.Specification.Script.Base.html#1770" class="Function">Datum</a>
      <a id="TxInfo.txId"></a><a id="2637" href="Ledger.Dijkstra.Specification.Script.Validation.html#2637" class="Field">txId</a>           <a id="2652" class="Symbol">:</a> <a id="2654" href="Ledger.Dijkstra.Specification.Transaction.html#1329" class="Field">TxId</a>
      <a id="TxInfo.txInfoSubTxs"></a><a id="2665" href="Ledger.Dijkstra.Specification.Script.Validation.html#2665" class="Field">txInfoSubTxs</a>   <a id="2680" class="Symbol">:</a> <a id="2682" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="2688" class="Symbol">(</a><a id="2689" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="2694" href="Ledger.Dijkstra.Specification.Script.Validation.html#2708" class="Function">SubTxInfo</a><a id="2703" class="Symbol">)</a>

  <a id="SubTxInfo"></a><a id="2708" href="Ledger.Dijkstra.Specification.Script.Validation.html#2708" class="Function">SubTxInfo</a> <a id="2718" class="Symbol">:</a> <a id="2720" href="Agda.Primitive.html#388" class="Primitive">Type</a>
  <a id="2727" href="Ledger.Dijkstra.Specification.Script.Validation.html#2708" class="Function">SubTxInfo</a> <a id="2737" class="Symbol">=</a> <a id="2739" href="Ledger.Dijkstra.Specification.Script.Validation.html#2160" class="Record">TxInfo</a>


<a id="txInfo"></a><a id="2748" href="Ledger.Dijkstra.Specification.Script.Validation.html#2748" class="Function">txInfo</a> <a id="2755" class="Symbol">:</a> <a id="2757" class="Symbol">(</a><a id="2758" href="Ledger.Dijkstra.Specification.Script.Validation.html#2758" class="Bound">ℓ</a> <a id="2760" class="Symbol">:</a> <a id="2762" href="Ledger.Dijkstra.Specification.Transaction.html#718" class="Datatype">TxLevel</a><a id="2769" class="Symbol">)</a> <a id="2771" class="Symbol">→</a> <a id="2773" href="Ledger.Dijkstra.Specification.Transaction.html#3108" class="Function">UTxO</a> <a id="2778" class="Symbol">→</a> <a id="2780" href="Ledger.Dijkstra.Specification.Transaction.html#3472" class="Record">Tx</a> <a id="2783" href="Ledger.Dijkstra.Specification.Script.Validation.html#2758" class="Bound">ℓ</a> <a id="2785" class="Symbol">→</a> <a id="2787" href="Ledger.Dijkstra.Specification.Script.Validation.html#2160" class="Record">TxInfo</a>

<a id="2795" href="Ledger.Dijkstra.Specification.Script.Validation.html#2748" class="Function">txInfo</a> <a id="2802" href="Ledger.Dijkstra.Specification.Transaction.html#741" class="InductiveConstructor">TxLevelTop</a> <a id="2813" href="Ledger.Dijkstra.Specification.Script.Validation.html#2813" class="Bound">utxo</a> <a id="2818" href="Ledger.Dijkstra.Specification.Script.Validation.html#2818" class="Bound">tx</a> <a id="2821" class="Symbol">=</a>
  <a id="2825" class="Keyword">record</a>  <a id="2833" class="Symbol">{</a> <a id="2835" href="Ledger.Dijkstra.Specification.Script.Validation.html#2210" class="Field">realizedInputs</a>  <a id="2851" class="Symbol">=</a> <a id="2853" href="Ledger.Dijkstra.Specification.Script.Validation.html#2813" class="Bound">utxo</a> <a id="2858" href="Axiom.Set.Map.html#13536" class="Function Operator">∣</a> <a id="2860" class="Symbol">(</a><a id="2861" href="Ledger.Dijkstra.Specification.Transaction.html#3795" class="Field">TxBody.txIns</a> <a id="2874" href="Ledger.Dijkstra.Specification.Transaction.html#3544" class="Field">txBody</a><a id="2880" class="Symbol">)</a>
          <a id="2892" class="Symbol">;</a> <a id="2894" href="Ledger.Dijkstra.Specification.Script.Validation.html#2238" class="Field">txOuts</a>          <a id="2910" class="Symbol">=</a> <a id="2912" href="Ledger.Dijkstra.Specification.Transaction.html#3930" class="Field">TxBody.txOuts</a> <a id="2926" href="Ledger.Dijkstra.Specification.Transaction.html#3544" class="Field">txBody</a>
          <a id="2943" class="Symbol">;</a> <a id="2945" href="Ledger.Dijkstra.Specification.Script.Validation.html#2272" class="Field">txFee</a>           <a id="2961" class="Symbol">=</a> <a id="2963" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="2968" class="Symbol">(</a><a id="2969" href="Ledger.Dijkstra.Specification.Transaction.html#4050" class="Field">TxBody.txFee</a> <a id="2982" href="Ledger.Dijkstra.Specification.Transaction.html#3544" class="Field">txBody</a><a id="2988" class="Symbol">)</a>
          <a id="3000" class="Symbol">;</a> <a id="3002" href="Ledger.Dijkstra.Specification.Script.Validation.html#2306" class="Field">mint</a>            <a id="3018" class="Symbol">=</a> <a id="3020" href="Ledger.Dijkstra.Specification.Transaction.html#4467" class="Field">TxBody.mint</a> <a id="3032" href="Ledger.Dijkstra.Specification.Transaction.html#3544" class="Field">txBody</a>
          <a id="3049" class="Symbol">;</a> <a id="3051" href="Ledger.Dijkstra.Specification.Script.Validation.html#2335" class="Field">txCerts</a>         <a id="3067" class="Symbol">=</a> <a id="3069" href="Ledger.Dijkstra.Specification.Transaction.html#4008" class="Field">TxBody.txCerts</a> <a id="3084" href="Ledger.Dijkstra.Specification.Transaction.html#3544" class="Field">txBody</a>
          <a id="3101" class="Symbol">;</a> <a id="3103" href="Ledger.Dijkstra.Specification.Script.Validation.html#2369" class="Field">txWithdrawals</a>   <a id="3119" class="Symbol">=</a> <a id="3121" href="Ledger.Dijkstra.Specification.Transaction.html#4105" class="Field">TxBody.txWithdrawals</a> <a id="3142" href="Ledger.Dijkstra.Specification.Transaction.html#3544" class="Field">txBody</a>
          <a id="3159" class="Symbol">;</a> <a id="3161" href="Ledger.Dijkstra.Specification.Script.Validation.html#2404" class="Field">txVldt</a>          <a id="3177" class="Symbol">=</a> <a id="3179" href="Ledger.Dijkstra.Specification.Transaction.html#4148" class="Field">TxBody.txVldt</a> <a id="3193" href="Ledger.Dijkstra.Specification.Transaction.html#3544" class="Field">txBody</a>
          <a id="3210" class="Symbol">;</a> <a id="3212" href="Ledger.Dijkstra.Specification.Script.Validation.html#2451" class="Field">vkKey</a>           <a id="3228" class="Symbol">=</a> <a id="3230" href="Ledger.Dijkstra.Specification.Transaction.html#4825" class="Function">TxBody.reqSignerHashes</a> <a id="3253" href="Ledger.Dijkstra.Specification.Transaction.html#3544" class="Field">txBody</a>
          <a id="3270" class="Symbol">;</a> <a id="3272" href="Ledger.Dijkstra.Specification.Script.Validation.html#2523" class="Field">txGuards</a>        <a id="3288" class="Symbol">=</a> <a id="3290" href="Ledger.Dijkstra.Specification.Transaction.html#4661" class="Field">TxBody.txGuards</a> <a id="3306" href="Ledger.Dijkstra.Specification.Transaction.html#3544" class="Field">txBody</a>
          <a id="3323" class="Symbol">;</a> <a id="3325" href="Ledger.Dijkstra.Specification.Script.Validation.html#2606" class="Field">txData</a>          <a id="3341" class="Symbol">=</a> <a id="3343" href="Ledger.Dijkstra.Specification.Transaction.html#6214" class="Field">DataOf</a> <a id="3350" href="Ledger.Dijkstra.Specification.Script.Validation.html#2818" class="Bound">tx</a>
          <a id="3363" class="Symbol">;</a> <a id="3365" href="Ledger.Dijkstra.Specification.Script.Validation.html#2637" class="Field">txId</a>            <a id="3381" class="Symbol">=</a> <a id="3383" href="Ledger.Dijkstra.Specification.Transaction.html#3972" class="Field">TxBody.txId</a> <a id="3395" href="Ledger.Dijkstra.Specification.Transaction.html#3544" class="Field">txBody</a>
          <a id="3412" class="Symbol">;</a> <a id="3414" href="Ledger.Dijkstra.Specification.Script.Validation.html#2665" class="Field">txInfoSubTxs</a>    <a id="3430" class="Symbol">=</a> <a id="3432" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a>
          <a id="3450" class="Symbol">}</a> <a id="3452" class="Keyword">where</a> <a id="3458" class="Keyword">open</a> <a id="3463" href="Ledger.Dijkstra.Specification.Transaction.html#3472" class="Module">Tx</a> <a id="3466" href="Ledger.Dijkstra.Specification.Script.Validation.html#2818" class="Bound">tx</a>

<a id="3470" href="Ledger.Dijkstra.Specification.Script.Validation.html#2748" class="Function">txInfo</a> <a id="3477" href="Ledger.Dijkstra.Specification.Transaction.html#752" class="InductiveConstructor">TxLevelSub</a> <a id="3488" href="Ledger.Dijkstra.Specification.Script.Validation.html#3488" class="Bound">utxo</a> <a id="3493" href="Ledger.Dijkstra.Specification.Script.Validation.html#3493" class="Bound">tx</a> <a id="3496" class="Symbol">=</a>
  <a id="3500" class="Keyword">record</a>  <a id="3508" class="Symbol">{</a> <a id="3510" href="Ledger.Dijkstra.Specification.Script.Validation.html#2210" class="Field">realizedInputs</a>  <a id="3526" class="Symbol">=</a> <a id="3528" href="Ledger.Dijkstra.Specification.Script.Validation.html#3488" class="Bound">utxo</a> <a id="3533" href="Axiom.Set.Map.html#13536" class="Function Operator">∣</a> <a id="3535" class="Symbol">(</a><a id="3536" href="Ledger.Dijkstra.Specification.Transaction.html#3795" class="Field">TxBody.txIns</a> <a id="3549" href="Ledger.Dijkstra.Specification.Transaction.html#3544" class="Field">txBody</a><a id="3555" class="Symbol">)</a>
          <a id="3567" class="Symbol">;</a> <a id="3569" href="Ledger.Dijkstra.Specification.Script.Validation.html#2238" class="Field">txOuts</a>          <a id="3585" class="Symbol">=</a> <a id="3587" href="Ledger.Dijkstra.Specification.Transaction.html#3930" class="Field">TxBody.txOuts</a> <a id="3601" href="Ledger.Dijkstra.Specification.Transaction.html#3544" class="Field">txBody</a>
          <a id="3618" class="Symbol">;</a> <a id="3620" href="Ledger.Dijkstra.Specification.Script.Validation.html#2272" class="Field">txFee</a>           <a id="3636" class="Symbol">=</a> <a id="3638" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a>
          <a id="3656" class="Symbol">;</a> <a id="3658" href="Ledger.Dijkstra.Specification.Script.Validation.html#2306" class="Field">mint</a>            <a id="3674" class="Symbol">=</a> <a id="3676" href="Ledger.Dijkstra.Specification.Transaction.html#4467" class="Field">TxBody.mint</a> <a id="3688" href="Ledger.Dijkstra.Specification.Transaction.html#3544" class="Field">txBody</a>
          <a id="3705" class="Symbol">;</a> <a id="3707" href="Ledger.Dijkstra.Specification.Script.Validation.html#2335" class="Field">txCerts</a>         <a id="3723" class="Symbol">=</a> <a id="3725" href="Ledger.Dijkstra.Specification.Transaction.html#4008" class="Field">TxBody.txCerts</a> <a id="3740" href="Ledger.Dijkstra.Specification.Transaction.html#3544" class="Field">txBody</a>
          <a id="3757" class="Symbol">;</a> <a id="3759" href="Ledger.Dijkstra.Specification.Script.Validation.html#2369" class="Field">txWithdrawals</a>   <a id="3775" class="Symbol">=</a> <a id="3777" href="Ledger.Dijkstra.Specification.Transaction.html#4105" class="Field">TxBody.txWithdrawals</a> <a id="3798" href="Ledger.Dijkstra.Specification.Transaction.html#3544" class="Field">txBody</a>
          <a id="3815" class="Symbol">;</a> <a id="3817" href="Ledger.Dijkstra.Specification.Script.Validation.html#2404" class="Field">txVldt</a>          <a id="3833" class="Symbol">=</a> <a id="3835" href="Ledger.Dijkstra.Specification.Transaction.html#4148" class="Field">TxBody.txVldt</a> <a id="3849" href="Ledger.Dijkstra.Specification.Transaction.html#3544" class="Field">txBody</a>
          <a id="3866" class="Symbol">;</a> <a id="3868" href="Ledger.Dijkstra.Specification.Script.Validation.html#2451" class="Field">vkKey</a>           <a id="3884" class="Symbol">=</a> <a id="3886" href="Ledger.Dijkstra.Specification.Transaction.html#4825" class="Function">TxBody.reqSignerHashes</a> <a id="3909" href="Ledger.Dijkstra.Specification.Transaction.html#3544" class="Field">txBody</a>
          <a id="3926" class="Symbol">;</a> <a id="3928" href="Ledger.Dijkstra.Specification.Script.Validation.html#2523" class="Field">txGuards</a>        <a id="3944" class="Symbol">=</a> <a id="3946" href="Ledger.Dijkstra.Specification.Transaction.html#4661" class="Field">TxBody.txGuards</a> <a id="3962" href="Ledger.Dijkstra.Specification.Transaction.html#3544" class="Field">txBody</a>
          <a id="3979" class="Symbol">;</a> <a id="3981" href="Ledger.Dijkstra.Specification.Script.Validation.html#2606" class="Field">txData</a>          <a id="3997" class="Symbol">=</a> <a id="3999" href="Ledger.Dijkstra.Specification.Transaction.html#6214" class="Field">DataOf</a> <a id="4006" href="Ledger.Dijkstra.Specification.Script.Validation.html#3493" class="Bound">tx</a>
          <a id="4019" class="Symbol">;</a> <a id="4021" href="Ledger.Dijkstra.Specification.Script.Validation.html#2637" class="Field">txId</a>            <a id="4037" class="Symbol">=</a> <a id="4039" href="Ledger.Dijkstra.Specification.Transaction.html#3972" class="Field">TxBody.txId</a> <a id="4051" href="Ledger.Dijkstra.Specification.Transaction.html#3544" class="Field">txBody</a>
          <a id="4068" class="Symbol">;</a> <a id="4070" href="Ledger.Dijkstra.Specification.Script.Validation.html#2665" class="Field">txInfoSubTxs</a>    <a id="4086" class="Symbol">=</a> <a id="4088" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a>
          <a id="4106" class="Symbol">}</a> <a id="4108" class="Keyword">where</a> <a id="4114" class="Keyword">open</a> <a id="4119" href="Ledger.Dijkstra.Specification.Transaction.html#3472" class="Module">Tx</a> <a id="4122" href="Ledger.Dijkstra.Specification.Script.Validation.html#3493" class="Bound">tx</a>

<a id="txInfoForPurpose"></a><a id="4126" href="Ledger.Dijkstra.Specification.Script.Validation.html#4126" class="Function">txInfoForPurpose</a> <a id="4143" class="Symbol">:</a> <a id="4145" class="Symbol">(</a><a id="4146" href="Ledger.Dijkstra.Specification.Script.Validation.html#4146" class="Bound">ℓ</a> <a id="4148" class="Symbol">:</a> <a id="4150" href="Ledger.Dijkstra.Specification.Transaction.html#718" class="Datatype">TxLevel</a><a id="4157" class="Symbol">)</a> <a id="4159" class="Symbol">→</a> <a id="4161" href="Ledger.Dijkstra.Specification.Transaction.html#3108" class="Function">UTxO</a> <a id="4166" class="Symbol">→</a> <a id="4168" href="Ledger.Dijkstra.Specification.Transaction.html#3472" class="Record">Tx</a> <a id="4171" href="Ledger.Dijkstra.Specification.Script.Validation.html#4146" class="Bound">ℓ</a> <a id="4173" class="Symbol">→</a> <a id="4175" href="Ledger.Dijkstra.Specification.Script.Validation.html#422" class="Datatype">ScriptPurpose</a> <a id="4189" class="Symbol">→</a> <a id="4191" href="Ledger.Dijkstra.Specification.Script.Validation.html#2160" class="Record">TxInfo</a>

<a id="4199" class="Comment">-- subtransactions: never get subTx infos (even if the ScriptPurpose is Guard).</a>
<a id="4279" href="Ledger.Dijkstra.Specification.Script.Validation.html#4126" class="Function">txInfoForPurpose</a> <a id="4296" href="Ledger.Dijkstra.Specification.Transaction.html#752" class="InductiveConstructor">TxLevelSub</a> <a id="4307" href="Ledger.Dijkstra.Specification.Script.Validation.html#4307" class="Bound">utxo</a> <a id="4312" href="Ledger.Dijkstra.Specification.Script.Validation.html#4312" class="Bound">tx</a> <a id="4315" class="Symbol">_</a> <a id="4317" class="Symbol">=</a> <a id="4319" href="Ledger.Dijkstra.Specification.Script.Validation.html#2748" class="Function">txInfo</a> <a id="4326" href="Ledger.Dijkstra.Specification.Transaction.html#752" class="InductiveConstructor">TxLevelSub</a> <a id="4337" href="Ledger.Dijkstra.Specification.Script.Validation.html#4307" class="Bound">utxo</a> <a id="4342" href="Ledger.Dijkstra.Specification.Script.Validation.html#4312" class="Bound">tx</a>

<a id="4346" class="Comment">-- top-level transactions:</a>
<a id="4373" href="Ledger.Dijkstra.Specification.Script.Validation.html#4126" class="Function">txInfoForPurpose</a> <a id="4390" href="Ledger.Dijkstra.Specification.Transaction.html#741" class="InductiveConstructor">TxLevelTop</a> <a id="4401" href="Ledger.Dijkstra.Specification.Script.Validation.html#4401" class="Bound">utxo</a> <a id="4406" href="Ledger.Dijkstra.Specification.Script.Validation.html#4406" class="Bound">tx</a> <a id="4409" href="Ledger.Dijkstra.Specification.Script.Validation.html#4409" class="Bound">sp</a> <a id="4412" class="Keyword">with</a> <a id="4417" href="Ledger.Dijkstra.Specification.Script.Validation.html#4409" class="Bound">sp</a>
   <a id="4423" class="Comment">-- · guard scripts see subTx infos</a>
<a id="4458" class="Symbol">...</a> <a id="4462" class="Symbol">|</a> <a id="4464" href="Ledger.Dijkstra.Specification.Script.Validation.html#715" class="InductiveConstructor">Guard</a> <a id="4470" class="Symbol">_</a> <a id="4472" class="Symbol">=</a>  <a id="4475" class="Keyword">record</a> <a id="4482" href="Ledger.Dijkstra.Specification.Script.Validation.html#4560" class="Function">base</a> <a id="4487" class="Symbol">{</a> <a id="4489" href="Ledger.Dijkstra.Specification.Script.Validation.html#2665" class="Field">txInfoSubTxs</a> <a id="4502" class="Symbol">=</a> <a id="4504" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="4509" href="Ledger.Dijkstra.Specification.Script.Validation.html#4641" class="Function">subInfos</a> <a id="4518" class="Symbol">}</a>
                 <a id="4537" class="Keyword">where</a>
                 <a id="4560" href="Ledger.Dijkstra.Specification.Script.Validation.html#4560" class="Function">base</a> <a id="4565" class="Symbol">:</a> <a id="4567" href="Ledger.Dijkstra.Specification.Script.Validation.html#2160" class="Record">TxInfo</a>
                 <a id="4591" href="Ledger.Dijkstra.Specification.Script.Validation.html#4560" class="Function">base</a> <a id="4596" class="Symbol">=</a> <a id="4598" href="Ledger.Dijkstra.Specification.Script.Validation.html#2748" class="Function">txInfo</a> <a id="4605" href="Ledger.Dijkstra.Specification.Transaction.html#741" class="InductiveConstructor">TxLevelTop</a> <a id="4616" class="Bound">utxo</a> <a id="4621" class="Bound">tx</a>
                 <a id="4641" href="Ledger.Dijkstra.Specification.Script.Validation.html#4641" class="Function">subInfos</a> <a id="4650" class="Symbol">:</a> <a id="4652" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="4657" href="Ledger.Dijkstra.Specification.Script.Validation.html#2708" class="Function">SubTxInfo</a>
                 <a id="4684" href="Ledger.Dijkstra.Specification.Script.Validation.html#4641" class="Function">subInfos</a> <a id="4693" class="Symbol">=</a> <a id="4695" href="Class.Functor.Core.html#272" class="Function">map</a> <a id="4699" class="Symbol">(</a><a id="4700" href="Ledger.Dijkstra.Specification.Script.Validation.html#2748" class="Function">txInfo</a> <a id="4707" href="Ledger.Dijkstra.Specification.Transaction.html#752" class="InductiveConstructor">TxLevelSub</a> <a id="4718" class="Bound">utxo</a><a id="4722" class="Symbol">)</a> <a id="4724" class="Symbol">(</a><a id="4725" href="Ledger.Dijkstra.Specification.Transaction.html#6606" class="Field">SubTransactionsOf</a> <a id="4743" class="Bound">tx</a><a id="4745" class="Symbol">)</a>
   <a id="4750" class="Comment">-- · other top-level scripts see no subTx infos</a>
<a id="4798" class="CatchallClause Symbol">...</a><a id="4801" class="CatchallClause"> </a><a id="4802" class="CatchallClause Symbol">|</a><a id="4803" class="CatchallClause"> </a><a id="4804" class="CatchallClause Symbol">_</a> <a id="4806" class="Symbol">=</a> <a id="4808" href="Ledger.Dijkstra.Specification.Script.Validation.html#2748" class="Function">txInfo</a> <a id="4815" href="Ledger.Dijkstra.Specification.Transaction.html#741" class="InductiveConstructor">TxLevelTop</a> <a id="4826" class="Bound">utxo</a> <a id="4831" class="Bound">tx</a>


<a id="credsNeededMinusCollateral"></a><a id="4836" href="Ledger.Dijkstra.Specification.Script.Validation.html#4836" class="Function">credsNeededMinusCollateral</a> <a id="4863" class="Symbol">:</a> <a id="4865" class="Symbol">{</a><a id="4866" href="Ledger.Dijkstra.Specification.Script.Validation.html#4866" class="Bound">ℓ</a> <a id="4868" class="Symbol">:</a> <a id="4870" href="Ledger.Dijkstra.Specification.Transaction.html#718" class="Datatype">TxLevel</a><a id="4877" class="Symbol">}</a> <a id="4879" class="Symbol">→</a> <a id="4881" href="Ledger.Dijkstra.Specification.Transaction.html#3719" class="Record">TxBody</a> <a id="4888" href="Ledger.Dijkstra.Specification.Script.Validation.html#4866" class="Bound">ℓ</a> <a id="4890" class="Symbol">→</a> <a id="4892" href="abstract-set-theory.FiniteSetTheory.html#488" class="Function Operator">ℙ</a> <a id="4894" class="Symbol">(</a><a id="4895" href="Ledger.Dijkstra.Specification.Script.Validation.html#422" class="Datatype">ScriptPurpose</a> <a id="4909" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="4911" href="Ledger.Core.Specification.Address.html#259" class="Datatype">Credential</a><a id="4921" class="Symbol">)</a>
<a id="4923" href="Ledger.Dijkstra.Specification.Script.Validation.html#4836" class="Function">credsNeededMinusCollateral</a> <a id="4950" href="Ledger.Dijkstra.Specification.Script.Validation.html#4950" class="Bound">txb</a> <a id="4954" class="Symbol">=</a> <a id="4956" href="Ledger.Dijkstra.Specification.Script.Validation.html#4984" class="Function">a</a> <a id="4958" href="Axiom.Set.html#9137" class="Function Operator">∪</a> <a id="4960" href="Ledger.Dijkstra.Specification.Script.Validation.html#4986" class="Function">b</a> <a id="4962" href="Axiom.Set.html#9137" class="Function Operator">∪</a> <a id="4964" href="Ledger.Dijkstra.Specification.Script.Validation.html#4988" class="Function">c</a> <a id="4966" href="Axiom.Set.html#9137" class="Function Operator">∪</a> <a id="4968" href="Ledger.Dijkstra.Specification.Script.Validation.html#4990" class="Function">d</a> <a id="4970" href="Axiom.Set.html#9137" class="Function Operator">∪</a> <a id="4972" href="Ledger.Dijkstra.Specification.Script.Validation.html#4992" class="Function">e</a>
  <a id="4976" class="Keyword">where</a>
  <a id="4984" href="Ledger.Dijkstra.Specification.Script.Validation.html#4984" class="Function">a</a> <a id="4986" href="Ledger.Dijkstra.Specification.Script.Validation.html#4986" class="Function">b</a> <a id="4988" href="Ledger.Dijkstra.Specification.Script.Validation.html#4988" class="Function">c</a> <a id="4990" href="Ledger.Dijkstra.Specification.Script.Validation.html#4990" class="Function">d</a> <a id="4992" href="Ledger.Dijkstra.Specification.Script.Validation.html#4992" class="Function">e</a> <a id="4994" class="Symbol">:</a> <a id="4996" href="abstract-set-theory.FiniteSetTheory.html#488" class="Function Operator">ℙ</a> <a id="4998" class="Symbol">(</a><a id="4999" href="Ledger.Dijkstra.Specification.Script.Validation.html#422" class="Datatype">ScriptPurpose</a> <a id="5013" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="5015" href="Ledger.Core.Specification.Address.html#259" class="Datatype">Credential</a><a id="5025" class="Symbol">)</a>
  <a id="5029" href="Ledger.Dijkstra.Specification.Script.Validation.html#4984" class="Function">a</a> <a id="5031" class="Symbol">=</a> <a id="5033" href="abstract-set-theory.FiniteSetTheory.html#519" class="Function">mapˢ</a> <a id="5038" class="Symbol">(λ</a> <a id="5041" href="Ledger.Dijkstra.Specification.Script.Validation.html#5041" class="Bound">a</a> <a id="5043" class="Symbol">→</a> <a id="5045" class="Symbol">(</a><a id="5046" href="Ledger.Dijkstra.Specification.Script.Validation.html#495" class="InductiveConstructor">Rwrd</a> <a id="5051" href="Ledger.Dijkstra.Specification.Script.Validation.html#5041" class="Bound">a</a> <a id="5053" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5055" href="Ledger.Core.Specification.Address.html#421" class="Field">CredentialOf</a> <a id="5068" href="Ledger.Dijkstra.Specification.Script.Validation.html#5041" class="Bound">a</a><a id="5069" class="Symbol">))</a> <a id="5072" class="Symbol">(</a><a id="5073" href="Class.IsSet.html#916" class="Function">dom</a> <a id="5077" href="Ledger.Prelude.html#2302" class="Function Operator">∣</a> <a id="5079" href="Ledger.Core.Specification.Address.html#1700" class="Field">WithdrawalsOf</a> <a id="5093" href="Ledger.Dijkstra.Specification.Script.Validation.html#4950" class="Bound">txb</a> <a id="5097" href="Ledger.Prelude.html#2302" class="Function Operator">∣</a><a id="5098" class="Symbol">)</a>
  <a id="5102" href="Ledger.Dijkstra.Specification.Script.Validation.html#4986" class="Function">b</a> <a id="5104" class="Symbol">=</a> <a id="5106" href="Axiom.Set.html#7990" class="Function">mapPartial</a> <a id="5117" class="Symbol">(λ</a> <a id="5120" href="Ledger.Dijkstra.Specification.Script.Validation.html#5120" class="Bound">c</a> <a id="5122" class="Symbol">→</a> <a id="5124" class="Symbol">(</a><a id="5125" href="Ledger.Dijkstra.Specification.Script.Validation.html#451" class="InductiveConstructor">Cert</a> <a id="5130" href="Ledger.Dijkstra.Specification.Script.Validation.html#5120" class="Bound">c</a> <a id="5132" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,_</a><a id="5134" class="Symbol">)</a> <a id="5136" href="Class.Functor.Core.html#242" class="Field Operator">&lt;$&gt;</a> <a id="5140" href="Ledger.Conway.Specification.Certs.html#2871" class="Function">cwitness</a> <a id="5149" href="Ledger.Dijkstra.Specification.Script.Validation.html#5120" class="Bound">c</a><a id="5150" class="Symbol">)</a> <a id="5152" class="Symbol">(</a><a id="5153" href="Axiom.Set.html#5903" class="Function">fromList</a> <a id="5162" class="Symbol">(</a><a id="5163" href="Ledger.Dijkstra.Specification.Transaction.html#6098" class="Field">DCertsOf</a> <a id="5172" href="Ledger.Dijkstra.Specification.Script.Validation.html#4950" class="Bound">txb</a><a id="5175" class="Symbol">))</a>
  <a id="5180" href="Ledger.Dijkstra.Specification.Script.Validation.html#4988" class="Function">c</a> <a id="5182" class="Symbol">=</a> <a id="5184" href="abstract-set-theory.FiniteSetTheory.html#519" class="Function">mapˢ</a> <a id="5189" class="Symbol">(λ</a> <a id="5192" href="Ledger.Dijkstra.Specification.Script.Validation.html#5192" class="Bound">x</a> <a id="5194" class="Symbol">→</a> <a id="5196" class="Symbol">(</a><a id="5197" href="Ledger.Dijkstra.Specification.Script.Validation.html#539" class="InductiveConstructor">Mint</a> <a id="5202" href="Ledger.Dijkstra.Specification.Script.Validation.html#5192" class="Bound">x</a> <a id="5204" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5206" href="Ledger.Core.Specification.Address.html#321" class="InductiveConstructor">ScriptObj</a> <a id="5216" href="Ledger.Dijkstra.Specification.Script.Validation.html#5192" class="Bound">x</a><a id="5217" class="Symbol">))</a> <a id="5220" class="Symbol">(</a><a id="5221" href="Ledger.Conway.Specification.TokenAlgebra.Base.html#927" class="Function">policies</a> <a id="5230" class="Symbol">(</a><a id="5231" href="Ledger.Dijkstra.Specification.Transaction.html#6476" class="Field">ValueOf</a> <a id="5239" href="Ledger.Dijkstra.Specification.Script.Validation.html#4950" class="Bound">txb</a><a id="5242" class="Symbol">))</a>
  <a id="5247" href="Ledger.Dijkstra.Specification.Script.Validation.html#4990" class="Function">d</a> <a id="5249" class="Symbol">=</a> <a id="5251" href="Axiom.Set.html#7990" class="Function">mapPartial</a> <a id="5262" class="Symbol">(λ</a> <a id="5265" href="Ledger.Dijkstra.Specification.Script.Validation.html#5265" class="Bound">v</a> <a id="5267" class="Symbol">→</a> <a id="5269" href="Class.ToBool.html#342" class="Function Operator">if</a> <a id="5272" href="Ledger.Conway.Specification.Gov.Actions.html#6713" class="Function">isGovVoterCredential</a> <a id="5293" href="Ledger.Dijkstra.Specification.Script.Validation.html#5265" class="Bound">v</a> <a id="5295" href="Class.ToBool.html#342" class="Function Operator">then</a> <a id="5300" class="Symbol">(λ</a> <a id="5303" class="Symbol">{</a><a id="5304" href="Ledger.Dijkstra.Specification.Script.Validation.html#5304" class="Bound">c</a><a id="5305" class="Symbol">}</a> <a id="5307" class="Symbol">→</a> <a id="5309" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="5314" class="Symbol">(</a><a id="5315" href="Ledger.Dijkstra.Specification.Script.Validation.html#627" class="InductiveConstructor">Vote</a> <a id="5320" href="Ledger.Dijkstra.Specification.Script.Validation.html#5265" class="Bound">v</a> <a id="5322" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5324" href="Ledger.Dijkstra.Specification.Script.Validation.html#5304" class="Bound">c</a><a id="5325" class="Symbol">))</a> <a id="5328" href="Class.ToBool.html#342" class="Function Operator">else</a> <a id="5333" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a><a id="5340" class="Symbol">)</a>
                 <a id="5359" class="Symbol">(</a><a id="5360" href="Axiom.Set.html#5903" class="Function">fromList</a> <a id="5369" class="Symbol">(</a><a id="5370" href="Class.Functor.Core.html#272" class="Function">map</a> <a id="5374" href="Ledger.Conway.Specification.Gov.Actions.html#4074" class="Field">GovVoterOf</a> <a id="5385" class="Symbol">(</a><a id="5386" href="Ledger.Dijkstra.Specification.Transaction.html#6917" class="Field">GovVotesOf</a> <a id="5397" href="Ledger.Dijkstra.Specification.Script.Validation.html#4950" class="Bound">txb</a><a id="5400" class="Symbol">)))</a>
  <a id="5406" href="Ledger.Dijkstra.Specification.Script.Validation.html#4992" class="Function">e</a> <a id="5408" class="Symbol">=</a> <a id="5410" href="Axiom.Set.html#7990" class="Function">mapPartial</a> <a id="5421" class="Symbol">(λ</a> <a id="5424" href="Ledger.Dijkstra.Specification.Script.Validation.html#5424" class="Bound">p</a> <a id="5426" class="Symbol">→</a> <a id="5428" href="Class.ToBool.html#342" class="Function Operator">if</a> <a id="5431" href="Ledger.Conway.Specification.Gov.Actions.html#4288" class="Field">PolicyOf</a> <a id="5440" href="Ledger.Dijkstra.Specification.Script.Validation.html#5424" class="Bound">p</a> <a id="5442" href="Class.ToBool.html#342" class="Function Operator">then</a> <a id="5447" class="Symbol">(λ</a> <a id="5450" class="Symbol">{</a><a id="5451" href="Ledger.Dijkstra.Specification.Script.Validation.html#5451" class="Bound">sh</a><a id="5453" class="Symbol">}</a> <a id="5455" class="Symbol">→</a> <a id="5457" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="5462" class="Symbol">(</a><a id="5463" href="Ledger.Dijkstra.Specification.Script.Validation.html#671" class="InductiveConstructor">Propose</a>  <a id="5472" href="Ledger.Dijkstra.Specification.Script.Validation.html#5424" class="Bound">p</a> <a id="5474" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5476" href="Ledger.Core.Specification.Address.html#321" class="InductiveConstructor">ScriptObj</a> <a id="5486" href="Ledger.Dijkstra.Specification.Script.Validation.html#5451" class="Bound">sh</a><a id="5488" class="Symbol">))</a> <a id="5491" href="Class.ToBool.html#342" class="Function Operator">else</a> <a id="5496" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a><a id="5503" class="Symbol">)</a>
                 <a id="5522" class="Symbol">(</a><a id="5523" href="Axiom.Set.html#5903" class="Function">fromList</a> <a id="5532" class="Symbol">(</a><a id="5533" href="Ledger.Dijkstra.Specification.Transaction.html#6779" class="Field">GovProposalsOf</a> <a id="5548" href="Ledger.Dijkstra.Specification.Script.Validation.html#4950" class="Bound">txb</a><a id="5551" class="Symbol">))</a>

<a id="credsNeeded"></a><a id="5555" href="Ledger.Dijkstra.Specification.Script.Validation.html#5555" class="Function">credsNeeded</a> <a id="5567" class="Symbol">:</a> <a id="5569" class="Symbol">(</a><a id="5570" href="Ledger.Dijkstra.Specification.Script.Validation.html#5570" class="Bound">ℓ</a> <a id="5572" class="Symbol">:</a> <a id="5574" href="Ledger.Dijkstra.Specification.Transaction.html#718" class="Datatype">TxLevel</a><a id="5581" class="Symbol">)</a> <a id="5583" class="Symbol">→</a> <a id="5585" href="Ledger.Dijkstra.Specification.Transaction.html#3108" class="Function">UTxO</a> <a id="5590" class="Symbol">→</a> <a id="5592" class="Symbol">(</a><a id="5593" href="Ledger.Dijkstra.Specification.Transaction.html#3719" class="Record">TxBody</a> <a id="5600" href="Ledger.Dijkstra.Specification.Script.Validation.html#5570" class="Bound">ℓ</a><a id="5601" class="Symbol">)</a> <a id="5603" class="Symbol">→</a> <a id="5605" href="abstract-set-theory.FiniteSetTheory.html#488" class="Function Operator">ℙ</a> <a id="5607" class="Symbol">(</a><a id="5608" href="Ledger.Dijkstra.Specification.Script.Validation.html#422" class="Datatype">ScriptPurpose</a> <a id="5622" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="5624" href="Ledger.Core.Specification.Address.html#259" class="Datatype">Credential</a><a id="5634" class="Symbol">)</a>
<a id="5636" href="Ledger.Dijkstra.Specification.Script.Validation.html#5555" class="Function">credsNeeded</a> <a id="5648" href="Ledger.Dijkstra.Specification.Transaction.html#741" class="InductiveConstructor">TxLevelTop</a> <a id="5659" href="Ledger.Dijkstra.Specification.Script.Validation.html#5659" class="Bound">utxo</a> <a id="5664" href="Ledger.Dijkstra.Specification.Script.Validation.html#5664" class="Bound">txb</a> <a id="5668" class="Symbol">=</a> <a id="5670" href="Ledger.Dijkstra.Specification.Script.Validation.html#4836" class="Function">credsNeededMinusCollateral</a> <a id="5697" href="Ledger.Dijkstra.Specification.Script.Validation.html#5664" class="Bound">txb</a>
  <a id="5703" href="Axiom.Set.html#9137" class="Function Operator">∪</a> <a id="5705" href="abstract-set-theory.FiniteSetTheory.html#519" class="Function">mapˢ</a> <a id="5710" class="Symbol">(λ</a> <a id="5713" class="Symbol">(</a><a id="5714" href="Ledger.Dijkstra.Specification.Script.Validation.html#5714" class="Bound">i</a> <a id="5716" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5718" href="Ledger.Dijkstra.Specification.Script.Validation.html#5718" class="Bound">o</a><a id="5719" class="Symbol">)</a> <a id="5721" class="Symbol">→</a> <a id="5723" class="Symbol">(</a><a id="5724" href="Ledger.Dijkstra.Specification.Script.Validation.html#583" class="InductiveConstructor">Spend</a>  <a id="5731" href="Ledger.Dijkstra.Specification.Script.Validation.html#5714" class="Bound">i</a> <a id="5733" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5735" href="Ledger.Core.Specification.Address.html#2685" class="Function">payCred</a> <a id="5743" class="Symbol">(</a><a id="5744" href="Data.Product.Base.html#636" class="Field">proj₁</a> <a id="5750" href="Ledger.Dijkstra.Specification.Script.Validation.html#5718" class="Bound">o</a><a id="5751" class="Symbol">)))</a> <a id="5755" class="Symbol">((</a><a id="5757" href="Ledger.Dijkstra.Specification.Script.Validation.html#5659" class="Bound">utxo</a> <a id="5762" href="Axiom.Set.Map.html#13536" class="Function Operator">∣</a> <a id="5764" class="Symbol">(</a><a id="5765" href="Ledger.Dijkstra.Specification.Transaction.html#3795" class="Field">txIns</a> <a id="5771" href="Axiom.Set.html#9137" class="Function Operator">∪</a> <a id="5773" href="Ledger.Dijkstra.Specification.Transaction.html#3871" class="Field">collateralInputs</a><a id="5789" class="Symbol">))</a> <a id="5792" href="Axiom.Set.Map.html#2293" class="Function Operator">ˢ</a><a id="5793" class="Symbol">)</a>
  <a id="5797" class="Keyword">where</a> <a id="5803" class="Keyword">open</a> <a id="5808" href="Ledger.Dijkstra.Specification.Transaction.html#3719" class="Module">TxBody</a> <a id="5815" href="Ledger.Dijkstra.Specification.Script.Validation.html#5664" class="Bound">txb</a>

<a id="5820" href="Ledger.Dijkstra.Specification.Script.Validation.html#5555" class="Function">credsNeeded</a> <a id="5832" href="Ledger.Dijkstra.Specification.Transaction.html#752" class="InductiveConstructor">TxLevelSub</a> <a id="5843" href="Ledger.Dijkstra.Specification.Script.Validation.html#5843" class="Bound">utxo</a> <a id="5848" href="Ledger.Dijkstra.Specification.Script.Validation.html#5848" class="Bound">txb</a> <a id="5852" class="Symbol">=</a> <a id="5854" href="Ledger.Dijkstra.Specification.Script.Validation.html#4836" class="Function">credsNeededMinusCollateral</a> <a id="5881" href="Ledger.Dijkstra.Specification.Script.Validation.html#5848" class="Bound">txb</a>
  <a id="5887" href="Axiom.Set.html#9137" class="Function Operator">∪</a> <a id="5889" href="abstract-set-theory.FiniteSetTheory.html#519" class="Function">mapˢ</a> <a id="5894" class="Symbol">(λ</a> <a id="5897" class="Symbol">(</a><a id="5898" href="Ledger.Dijkstra.Specification.Script.Validation.html#5898" class="Bound">i</a> <a id="5900" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5902" href="Ledger.Dijkstra.Specification.Script.Validation.html#5902" class="Bound">o</a><a id="5903" class="Symbol">)</a> <a id="5905" class="Symbol">→</a> <a id="5907" class="Symbol">(</a><a id="5908" href="Ledger.Dijkstra.Specification.Script.Validation.html#583" class="InductiveConstructor">Spend</a>  <a id="5915" href="Ledger.Dijkstra.Specification.Script.Validation.html#5898" class="Bound">i</a> <a id="5917" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5919" href="Ledger.Core.Specification.Address.html#2685" class="Function">payCred</a> <a id="5927" class="Symbol">(</a><a id="5928" href="Data.Product.Base.html#636" class="Field">proj₁</a> <a id="5934" href="Ledger.Dijkstra.Specification.Script.Validation.html#5902" class="Bound">o</a><a id="5935" class="Symbol">)))</a> <a id="5939" class="Symbol">((</a><a id="5941" href="Ledger.Dijkstra.Specification.Script.Validation.html#5843" class="Bound">utxo</a> <a id="5946" href="Axiom.Set.Map.html#13536" class="Function Operator">∣</a> <a id="5948" href="Ledger.Dijkstra.Specification.Transaction.html#3795" class="Field">txIns</a><a id="5953" class="Symbol">)</a> <a id="5955" href="Axiom.Set.Map.html#2293" class="Function Operator">ˢ</a><a id="5956" class="Symbol">)</a>
  <a id="5960" class="Keyword">where</a> <a id="5966" class="Keyword">open</a> <a id="5971" href="Ledger.Dijkstra.Specification.Transaction.html#3719" class="Module">TxBody</a> <a id="5978" href="Ledger.Dijkstra.Specification.Script.Validation.html#5848" class="Bound">txb</a>

<a id="5983" class="Comment">--valContext : TxInfo → ScriptPurpose → Data</a>
<a id="6028" class="Comment">--valContext txinfo sp = toData (txinfo , sp)</a>

<a id="txOutToDataHash"></a><a id="6075" href="Ledger.Dijkstra.Specification.Script.Validation.html#6075" class="Function">txOutToDataHash</a> <a id="6091" class="Symbol">:</a> <a id="6093" href="Ledger.Dijkstra.Specification.Transaction.html#3027" class="Function">TxOut</a> <a id="6099" class="Symbol">→</a> <a id="6101" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="6107" href="Ledger.Conway.Specification.Script.Base.html#1723" class="Function">DataHash</a>
<a id="6116" href="Ledger.Dijkstra.Specification.Script.Validation.html#6075" class="Function">txOutToDataHash</a> <a id="6132" class="Symbol">(_</a> <a id="6135" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="6137" class="Symbol">_</a> <a id="6139" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="6141" href="Ledger.Dijkstra.Specification.Script.Validation.html#6141" class="Bound">d</a> <a id="6143" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="6145" class="Symbol">_)</a> <a id="6148" class="Symbol">=</a> <a id="6150" href="Ledger.Dijkstra.Specification.Script.Validation.html#6141" class="Bound">d</a> <a id="6152" href="Class.Monad.Core.html#337" class="Field Operator">&gt;&gt;=</a> <a id="6156" href="Data.Sum.html#870" class="Function">isInj₂</a>

<a id="txOutToP2Script"></a><a id="6164" href="Ledger.Dijkstra.Specification.Script.Validation.html#6164" class="Function">txOutToP2Script</a> <a id="6180" class="Symbol">:</a> <a id="6182" href="Ledger.Dijkstra.Specification.Transaction.html#3108" class="Function">UTxO</a> <a id="6187" class="Symbol">→</a> <a id="6189" href="Ledger.Dijkstra.Specification.Transaction.html#3108" class="Function">UTxO</a> <a id="6194" class="Symbol">→</a> <a id="6196" class="Symbol">(</a><a id="6197" href="Ledger.Dijkstra.Specification.Transaction.html#3472" class="Record">Tx</a> <a id="6200" href="Ledger.Dijkstra.Specification.Script.Validation.html#778" class="Generalizable">ℓ</a><a id="6201" class="Symbol">)</a> <a id="6203" class="Symbol">→</a> <a id="6205" href="Ledger.Dijkstra.Specification.Transaction.html#3027" class="Function">TxOut</a> <a id="6211" class="Symbol">→</a> <a id="6213" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="6219" href="Ledger.Conway.Specification.Script.Base.html#2367" class="Function">P2Script</a>
<a id="6228" href="Ledger.Dijkstra.Specification.Script.Validation.html#6164" class="Function">txOutToP2Script</a> <a id="6244" href="Ledger.Dijkstra.Specification.Script.Validation.html#6244" class="Bound">utxoSpend₀</a> <a id="6255" href="Ledger.Dijkstra.Specification.Script.Validation.html#6255" class="Bound">utxoRefView</a> <a id="6267" href="Ledger.Dijkstra.Specification.Script.Validation.html#6267" class="Bound">tx</a> <a id="6270" class="Symbol">(</a><a id="6271" href="Ledger.Dijkstra.Specification.Script.Validation.html#6271" class="Bound">a</a> <a id="6273" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="6275" class="Symbol">_)</a> <a id="6278" class="Symbol">=</a>
  <a id="6282" class="Keyword">do</a> <a id="6285" href="Ledger.Dijkstra.Specification.Script.Validation.html#6285" class="Bound">sh</a> <a id="6288" href="Class.Monad.Core.html#337" class="Field Operator">←</a> <a id="6290" href="Ledger.Core.Specification.Address.html#765" class="Function">isScriptObj</a> <a id="6302" class="Symbol">(</a><a id="6303" href="Ledger.Core.Specification.Address.html#2685" class="Function">payCred</a> <a id="6311" href="Ledger.Dijkstra.Specification.Script.Validation.html#6271" class="Bound">a</a><a id="6312" class="Symbol">)</a>
     <a id="6319" href="Ledger.Dijkstra.Specification.Script.Validation.html#6319" class="Bound">s</a>  <a id="6322" href="Class.Monad.Core.html#337" class="Field Operator">←</a> <a id="6324" href="Ledger.Dijkstra.Specification.Transaction.html#10558" class="Function">lookupScriptHash</a> <a id="6341" href="Ledger.Dijkstra.Specification.Script.Validation.html#6285" class="Bound">sh</a> <a id="6344" href="Ledger.Dijkstra.Specification.Script.Validation.html#6267" class="Bound">tx</a> <a id="6347" href="Ledger.Dijkstra.Specification.Script.Validation.html#6244" class="Bound">utxoSpend₀</a> <a id="6358" href="Ledger.Dijkstra.Specification.Script.Validation.html#6255" class="Bound">utxoRefView</a>
     <a id="6375" href="Ledger.Conway.Specification.Script.Base.html#3220" class="Function">toP2Script</a> <a id="6386" href="Ledger.Dijkstra.Specification.Script.Validation.html#6319" class="Bound">s</a>
<a id="6388" class="Comment">-- opaque</a>
<a id="6398" class="Comment">--   collectP2ScriptsWithContext</a>
<a id="6431" class="Comment">--     : PParams → (Tx ℓ) → UTxO</a>
<a id="6464" class="Comment">--     → List (P2Script × List Data × ExUnits × CostModel)</a>
<a id="6523" class="Comment">--   collectP2ScriptsWithContext pp tx utxo</a>
<a id="6567" class="Comment">--     = setToList</a>
<a id="6586" class="Comment">--     $ mapPartial (λ (sp , c) → if isScriptObj c</a>
<a id="6637" class="Comment">--                                 then (λ {sh} → toScriptInput sp sh)</a>
<a id="6708" class="Comment">--                                 else nothing)</a>
<a id="6757" class="Comment">--     $ credsNeeded utxo (TxBodyOf tx)</a>
<a id="6797" class="Comment">--     where</a>
<a id="6810" class="Comment">--       toScriptInput</a>
<a id="6833" class="Comment">--         : ScriptPurpose → ScriptHash</a>
<a id="6873" class="Comment">--         → Maybe (P2Script × List Data × ExUnits × CostModel)</a>
<a id="6937" class="Comment">--       toScriptInput sp sh =</a>
<a id="6968" class="Comment">--         do s ← lookupScriptHash sh tx utxo</a>
<a id="7014" class="Comment">--            p2s ← toP2Script s</a>
<a id="7047" class="Comment">--            (rdmr , exunits) ← indexedRdmrs tx sp</a>
<a id="7099" class="Comment">--            let data&#39;     = maybe [_] [] (getDatum tx utxo sp) ++ rdmr ∷ [ valContext (txInfo (language p2s) pp utxo tx) sp ]</a>
<a id="7227" class="Comment">--                costModel = PParams.costmdls pp</a>
<a id="7277" class="Comment">--            just (p2s , data&#39; , exunits , costModel)</a>

<a id="evalP2Scripts"></a><a id="7333" href="Ledger.Dijkstra.Specification.Script.Validation.html#7333" class="Function">evalP2Scripts</a> <a id="7347" class="Symbol">:</a> <a id="7349" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="7354" class="Symbol">(</a><a id="7355" href="Ledger.Conway.Specification.Script.Base.html#2367" class="Function">P2Script</a> <a id="7364" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="7366" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="7371" href="Ledger.Conway.Specification.Script.Base.html#1708" class="Function">Data</a> <a id="7376" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="7378" href="Ledger.Conway.Specification.Script.Base.html#1018" class="Function">ExUnits</a> <a id="7386" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="7388" href="Ledger.Conway.Specification.Script.Base.html#989" class="Function">CostModel</a><a id="7397" class="Symbol">)</a> <a id="7399" class="Symbol">→</a> <a id="7401" href="Agda.Builtin.Bool.html#173" class="Datatype">Bool</a>
<a id="7406" href="Ledger.Dijkstra.Specification.Script.Validation.html#7333" class="Function">evalP2Scripts</a> <a id="7420" class="Symbol">=</a> <a id="7422" href="Data.Bool.ListAction.html#927" class="Function">all</a> <a id="7426" class="Symbol">(λ</a> <a id="7429" class="Symbol">(</a><a id="7430" href="Ledger.Dijkstra.Specification.Script.Validation.html#7430" class="Bound">s</a> <a id="7432" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="7434" href="Ledger.Dijkstra.Specification.Script.Validation.html#7434" class="Bound">d</a> <a id="7436" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="7438" href="Ledger.Dijkstra.Specification.Script.Validation.html#7438" class="Bound">eu</a> <a id="7441" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="7443" href="Ledger.Dijkstra.Specification.Script.Validation.html#7443" class="Bound">cm</a><a id="7445" class="Symbol">)</a> <a id="7447" class="Symbol">→</a> <a id="7449" href="Ledger.Dijkstra.Specification.Abstract.html#1017" class="Field">runPLCScript</a> <a id="7462" href="Ledger.Dijkstra.Specification.Script.Validation.html#7443" class="Bound">cm</a> <a id="7465" href="Ledger.Dijkstra.Specification.Script.Validation.html#7430" class="Bound">s</a> <a id="7467" href="Ledger.Dijkstra.Specification.Script.Validation.html#7438" class="Bound">eu</a> <a id="7470" href="Ledger.Dijkstra.Specification.Script.Validation.html#7434" class="Bound">d</a><a id="7471" class="Symbol">)</a>

</pre></body></html>