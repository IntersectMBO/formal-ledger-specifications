<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>Ledger.Dijkstra.Specification.Script.Validation</title><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.css"><link rel="stylesheet" href="Agda.css"><script src="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.js"></script><script src="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/contrib/auto-render.min.js"></script><script src="AgdaKaTeX.js" defer=""></script></head><body><pre class="Agda">
<a id="2" class="Symbol">{-#</a> <a id="6" class="Keyword">OPTIONS</a> <a id="14" class="Pragma">--safe</a> <a id="21" class="Symbol">#-}</a>

<a id="26" class="Keyword">open</a> <a id="31" class="Keyword">import</a> <a id="38" href="Ledger.Dijkstra.Specification.Transaction.html" class="Module">Ledger.Dijkstra.Specification.Transaction</a>
<a id="80" class="Keyword">open</a> <a id="85" class="Keyword">import</a> <a id="92" href="Ledger.Dijkstra.Specification.Abstract.html" class="Module">Ledger.Dijkstra.Specification.Abstract</a>

<a id="132" class="Keyword">module</a> <a id="139" href="Ledger.Dijkstra.Specification.Script.Validation.html" class="Module">Ledger.Dijkstra.Specification.Script.Validation</a>
  <a id="189" class="Symbol">(</a><a id="190" href="Ledger.Dijkstra.Specification.Script.Validation.html#190" class="Bound">txs</a> <a id="194" class="Symbol">:</a> <a id="196" class="Symbol">_)</a> <a id="199" class="Symbol">(</a><a id="200" class="Keyword">open</a> <a id="205" href="Ledger.Dijkstra.Specification.Transaction.html#1279" class="Module">TransactionStructure</a> <a id="226" href="Ledger.Dijkstra.Specification.Script.Validation.html#190" class="Bound">txs</a><a id="229" class="Symbol">)</a>
  <a id="233" class="Symbol">(</a><a id="234" href="Ledger.Dijkstra.Specification.Script.Validation.html#234" class="Bound">abs</a> <a id="238" class="Symbol">:</a> <a id="240" href="Ledger.Dijkstra.Specification.Abstract.html#908" class="Record">AbstractFunctions</a> <a id="258" href="Ledger.Dijkstra.Specification.Script.Validation.html#190" class="Bound">txs</a><a id="261" class="Symbol">)</a> <a id="263" class="Symbol">(</a><a id="264" class="Keyword">open</a> <a id="269" href="Ledger.Dijkstra.Specification.Abstract.html#908" class="Module">AbstractFunctions</a> <a id="287" href="Ledger.Dijkstra.Specification.Script.Validation.html#234" class="Bound">abs</a><a id="290" class="Symbol">)</a> <a id="292" class="Symbol">(</a><a id="293" class="Keyword">open</a> <a id="298" href="Ledger.Dijkstra.Specification.Abstract.html#290" class="Module">indexOf</a> <a id="306" href="Ledger.Dijkstra.Specification.Abstract.html#1046" class="Field">indexOfImp</a><a id="316" class="Symbol">)</a>
  <a id="320" class="Keyword">where</a>

<a id="327" class="Keyword">open</a> <a id="332" class="Keyword">import</a> <a id="339" href="Ledger.Prelude.html" class="Module">Ledger.Prelude</a>
<a id="354" class="Keyword">open</a> <a id="359" class="Keyword">import</a> <a id="366" href="Ledger.Dijkstra.Specification.Certs.html" class="Module">Ledger.Dijkstra.Specification.Certs</a> <a id="402" href="Ledger.Dijkstra.Specification.Transaction.html#2455" class="Function">govStructure</a>


<a id="417" class="Keyword">data</a> <a id="ScriptPurpose"></a><a id="422" href="Ledger.Dijkstra.Specification.Script.Validation.html#422" class="Datatype">ScriptPurpose</a> <a id="436" class="Symbol">:</a> <a id="438" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="443" class="Keyword">where</a>
  <a id="ScriptPurpose.Cert"></a><a id="451" href="Ledger.Dijkstra.Specification.Script.Validation.html#451" class="InductiveConstructor">Cert</a>     <a id="460" class="Symbol">:</a> <a id="462" href="Ledger.Conway.Specification.Certs.html#2116" class="Datatype">DCert</a>               <a id="482" class="Symbol">→</a> <a id="484" href="Ledger.Dijkstra.Specification.Script.Validation.html#422" class="Datatype">ScriptPurpose</a>
  <a id="ScriptPurpose.Rwrd"></a><a id="500" href="Ledger.Dijkstra.Specification.Script.Validation.html#500" class="InductiveConstructor">Rwrd</a>     <a id="509" class="Symbol">:</a> <a id="511" href="Ledger.Dijkstra.Specification.Transaction.html#376" class="Record">RewardAddress</a>       <a id="531" class="Symbol">→</a> <a id="533" href="Ledger.Dijkstra.Specification.Script.Validation.html#422" class="Datatype">ScriptPurpose</a>
  <a id="ScriptPurpose.Mint"></a><a id="549" href="Ledger.Dijkstra.Specification.Script.Validation.html#549" class="InductiveConstructor">Mint</a>     <a id="558" class="Symbol">:</a> <a id="560" href="Ledger.Core.Specification.Crypto.html#1242" class="Function">ScriptHash</a>          <a id="580" class="Symbol">→</a> <a id="582" href="Ledger.Dijkstra.Specification.Script.Validation.html#422" class="Datatype">ScriptPurpose</a>
  <a id="ScriptPurpose.Spend"></a><a id="598" href="Ledger.Dijkstra.Specification.Script.Validation.html#598" class="InductiveConstructor">Spend</a>    <a id="607" class="Symbol">:</a> <a id="609" href="Ledger.Dijkstra.Specification.Transaction.html#2993" class="Function">TxIn</a>                <a id="629" class="Symbol">→</a> <a id="631" href="Ledger.Dijkstra.Specification.Script.Validation.html#422" class="Datatype">ScriptPurpose</a>
  <a id="ScriptPurpose.Vote"></a><a id="647" href="Ledger.Dijkstra.Specification.Script.Validation.html#647" class="InductiveConstructor">Vote</a>     <a id="656" class="Symbol">:</a> <a id="658" href="Ledger.Conway.Specification.Gov.Actions.html#2082" class="Record">GovVoter</a>            <a id="678" class="Symbol">→</a> <a id="680" href="Ledger.Dijkstra.Specification.Script.Validation.html#422" class="Datatype">ScriptPurpose</a>
  <a id="ScriptPurpose.Propose"></a><a id="696" href="Ledger.Dijkstra.Specification.Script.Validation.html#696" class="InductiveConstructor">Propose</a>  <a id="705" class="Symbol">:</a> <a id="707" href="Ledger.Conway.Specification.Gov.Actions.html#3603" class="Record">GovProposal</a>         <a id="727" class="Symbol">→</a> <a id="729" href="Ledger.Dijkstra.Specification.Script.Validation.html#422" class="Datatype">ScriptPurpose</a>
  <a id="ScriptPurpose.Guard"></a><a id="745" href="Ledger.Dijkstra.Specification.Script.Validation.html#745" class="InductiveConstructor">Guard</a>    <a id="754" class="Symbol">:</a> <a id="756" class="Symbol">(</a><a id="757" href="Ledger.Dijkstra.Specification.Transaction.html#1329" class="Field">TxId</a> <a id="762" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="764" href="Ledger.Core.Specification.Crypto.html#1242" class="Function">ScriptHash</a><a id="774" class="Symbol">)</a> <a id="776" class="Symbol">→</a> <a id="778" href="Ledger.Dijkstra.Specification.Script.Validation.html#422" class="Datatype">ScriptPurpose</a>


<a id="794" class="Keyword">private</a> <a id="802" class="Keyword">variable</a>
  <a id="813" href="Ledger.Dijkstra.Specification.Script.Validation.html#813" class="Generalizable">ℓ</a> <a id="815" class="Symbol">:</a> <a id="817" href="Ledger.Dijkstra.Specification.Transaction.html#718" class="Datatype">TxLevel</a>

<a id="rdptr"></a><a id="826" href="Ledger.Dijkstra.Specification.Script.Validation.html#826" class="Function">rdptr</a> <a id="832" class="Symbol">:</a> <a id="834" class="Symbol">(</a><a id="835" href="Ledger.Dijkstra.Specification.Transaction.html#3472" class="Record">Tx</a> <a id="838" href="Ledger.Dijkstra.Specification.Script.Validation.html#813" class="Generalizable">ℓ</a><a id="839" class="Symbol">)</a> <a id="841" class="Symbol">→</a> <a id="843" href="Ledger.Dijkstra.Specification.Script.Validation.html#422" class="Datatype">ScriptPurpose</a> <a id="857" class="Symbol">→</a> <a id="859" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="865" class="Symbol">(</a><a id="866" href="Ledger.Dijkstra.Specification.Transaction.html#3145" class="Function">RedeemerPtr</a> <a id="878" href="Ledger.Dijkstra.Specification.Script.Validation.html#813" class="Generalizable">ℓ</a><a id="879" class="Symbol">)</a>
<a id="881" href="Ledger.Dijkstra.Specification.Script.Validation.html#826" class="Function">rdptr</a> <a id="887" href="Ledger.Dijkstra.Specification.Script.Validation.html#887" class="Bound">tx</a> <a id="890" class="Symbol">=</a> <a id="892" class="Symbol">λ</a> <a id="894" class="Keyword">where</a>
  <a id="902" class="Symbol">(</a><a id="903" href="Ledger.Dijkstra.Specification.Script.Validation.html#451" class="InductiveConstructor">Cert</a> <a id="908" href="Ledger.Dijkstra.Specification.Script.Validation.html#908" class="Bound">h</a><a id="909" class="Symbol">)</a>              <a id="924" class="Symbol">→</a> <a id="926" href="Class.Functor.Core.html#272" class="Function">map</a> <a id="930" class="Symbol">(</a><a id="931" href="Ledger.Dijkstra.Specification.Transaction.html#1128" class="InductiveConstructor">Cert</a>    <a id="939" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,_</a><a id="941" class="Symbol">)</a> <a id="943" href="Function.Base.html#1993" class="Function Operator">$</a> <a id="945" href="Ledger.Dijkstra.Specification.Abstract.html#323" class="Function">indexOfDCert</a>          <a id="967" href="Ledger.Dijkstra.Specification.Script.Validation.html#908" class="Bound">h</a> <a id="969" href="Ledger.Dijkstra.Specification.Transaction.html#4008" class="Function">txCerts</a>
  <a id="979" class="Symbol">(</a><a id="980" href="Ledger.Dijkstra.Specification.Script.Validation.html#500" class="InductiveConstructor">Rwrd</a> <a id="985" href="Ledger.Dijkstra.Specification.Script.Validation.html#985" class="Bound">h</a><a id="986" class="Symbol">)</a>              <a id="1001" class="Symbol">→</a> <a id="1003" href="Class.Functor.Core.html#272" class="Function">map</a> <a id="1007" class="Symbol">(</a><a id="1008" href="Ledger.Dijkstra.Specification.Transaction.html#1133" class="InductiveConstructor">Reward</a>  <a id="1016" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,_</a><a id="1018" class="Symbol">)</a> <a id="1020" href="Function.Base.html#1993" class="Function Operator">$</a> <a id="1022" href="Ledger.Dijkstra.Specification.Abstract.html#406" class="Function">indexOfRewardAddress</a>  <a id="1044" href="Ledger.Dijkstra.Specification.Script.Validation.html#985" class="Bound">h</a> <a id="1046" href="Ledger.Dijkstra.Specification.Transaction.html#4105" class="Function">txWithdrawals</a>
  <a id="1062" class="Symbol">(</a><a id="1063" href="Ledger.Dijkstra.Specification.Script.Validation.html#549" class="InductiveConstructor">Mint</a> <a id="1068" href="Ledger.Dijkstra.Specification.Script.Validation.html#1068" class="Bound">h</a><a id="1069" class="Symbol">)</a>              <a id="1084" class="Symbol">→</a> <a id="1086" href="Class.Functor.Core.html#272" class="Function">map</a> <a id="1090" class="Symbol">(</a><a id="1091" href="Ledger.Dijkstra.Specification.Transaction.html#1123" class="InductiveConstructor">Mint</a>    <a id="1099" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,_</a><a id="1101" class="Symbol">)</a> <a id="1103" href="Function.Base.html#1993" class="Function Operator">$</a> <a id="1105" href="Ledger.Dijkstra.Specification.Abstract.html#572" class="Function">indexOfPolicyId</a>       <a id="1127" href="Ledger.Dijkstra.Specification.Script.Validation.html#1068" class="Bound">h</a> <a id="1129" class="Symbol">(</a><a id="1130" href="Ledger.Conway.Specification.TokenAlgebra.Base.html#927" class="Function">policies</a> <a id="1139" href="Ledger.Dijkstra.Specification.Transaction.html#4467" class="Function">mint</a><a id="1143" class="Symbol">)</a>
  <a id="1147" class="Symbol">(</a><a id="1148" href="Ledger.Dijkstra.Specification.Script.Validation.html#598" class="InductiveConstructor">Spend</a> <a id="1154" href="Ledger.Dijkstra.Specification.Script.Validation.html#1154" class="Bound">h</a><a id="1155" class="Symbol">)</a>             <a id="1169" class="Symbol">→</a> <a id="1171" href="Class.Functor.Core.html#272" class="Function">map</a> <a id="1175" class="Symbol">(</a><a id="1176" href="Ledger.Dijkstra.Specification.Transaction.html#1117" class="InductiveConstructor">Spend</a>   <a id="1184" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,_</a><a id="1186" class="Symbol">)</a> <a id="1188" href="Function.Base.html#1993" class="Function Operator">$</a> <a id="1190" href="Ledger.Dijkstra.Specification.Abstract.html#489" class="Function">indexOfTxIn</a>           <a id="1212" href="Ledger.Dijkstra.Specification.Script.Validation.html#1154" class="Bound">h</a> <a id="1214" href="Ledger.Dijkstra.Specification.Transaction.html#3795" class="Function">txIns</a>
  <a id="1222" class="Symbol">(</a><a id="1223" href="Ledger.Dijkstra.Specification.Script.Validation.html#647" class="InductiveConstructor">Vote</a> <a id="1228" href="Ledger.Dijkstra.Specification.Script.Validation.html#1228" class="Bound">h</a><a id="1229" class="Symbol">)</a>              <a id="1244" class="Symbol">→</a> <a id="1246" href="Class.Functor.Core.html#272" class="Function">map</a> <a id="1250" class="Symbol">(</a><a id="1251" href="Ledger.Dijkstra.Specification.Transaction.html#1140" class="InductiveConstructor">Vote</a>    <a id="1259" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,_</a><a id="1261" class="Symbol">)</a> <a id="1263" href="Function.Base.html#1993" class="Function Operator">$</a> <a id="1265" href="Ledger.Dijkstra.Specification.Abstract.html#655" class="Function">indexOfVote</a>           <a id="1287" href="Ledger.Dijkstra.Specification.Script.Validation.html#1228" class="Bound">h</a> <a id="1289" class="Symbol">(</a><a id="1290" href="Class.Functor.Core.html#272" class="Function">map</a> <a id="1294" href="Ledger.Conway.Specification.Gov.Actions.html#2357" class="Field">GovVote.voter</a> <a id="1308" href="Ledger.Dijkstra.Specification.Transaction.html#4288" class="Function">txGovVotes</a><a id="1318" class="Symbol">)</a>
  <a id="1322" class="Symbol">(</a><a id="1323" href="Ledger.Dijkstra.Specification.Script.Validation.html#696" class="InductiveConstructor">Propose</a> <a id="1331" href="Ledger.Dijkstra.Specification.Script.Validation.html#1331" class="Bound">h</a><a id="1332" class="Symbol">)</a>           <a id="1344" class="Symbol">→</a> <a id="1346" href="Class.Functor.Core.html#272" class="Function">map</a> <a id="1350" class="Symbol">(</a><a id="1351" href="Ledger.Dijkstra.Specification.Transaction.html#1145" class="InductiveConstructor">Propose</a> <a id="1359" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,_</a><a id="1361" class="Symbol">)</a> <a id="1363" href="Function.Base.html#1993" class="Function Operator">$</a> <a id="1365" href="Ledger.Dijkstra.Specification.Abstract.html#738" class="Function">indexOfProposal</a>       <a id="1387" href="Ledger.Dijkstra.Specification.Script.Validation.html#1331" class="Bound">h</a> <a id="1389" href="Ledger.Dijkstra.Specification.Transaction.html#4332" class="Function">txGovProposals</a>
  <a id="1406" class="Symbol">(</a><a id="1407" href="Ledger.Dijkstra.Specification.Script.Validation.html#745" class="InductiveConstructor">Guard</a> <a id="1413" href="Ledger.Dijkstra.Specification.Script.Validation.html#1413" class="Bound">h</a><a id="1414" class="Symbol">)</a>             <a id="1428" class="Symbol">→</a> <a id="1430" href="Class.Functor.Core.html#272" class="Function">map</a> <a id="1434" class="Symbol">(</a><a id="1435" href="Ledger.Dijkstra.Specification.Transaction.html#1153" class="InductiveConstructor">Guard</a>   <a id="1443" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,_</a><a id="1445" class="Symbol">)</a> <a id="1447" href="Function.Base.html#1993" class="Function Operator">$</a> <a id="1449" href="Ledger.Dijkstra.Specification.Abstract.html#821" class="Function">indexOfGuard</a>          <a id="1471" href="Ledger.Dijkstra.Specification.Script.Validation.html#1413" class="Bound">h</a> <a id="1473" class="Symbol">(</a><a id="1474" href="Ledger.Dijkstra.Specification.Transaction.html#9844" class="Function">getTxScripts</a> <a id="1487" href="Ledger.Dijkstra.Specification.Script.Validation.html#887" class="Bound">tx</a><a id="1489" class="Symbol">)</a>
 <a id="1492" class="Keyword">where</a> <a id="1498" class="Keyword">open</a> <a id="1503" href="Ledger.Dijkstra.Specification.Transaction.html#3719" class="Module">TxBody</a> <a id="1510" class="Symbol">(</a><a id="1511" href="Ledger.Dijkstra.Specification.Transaction.html#5579" class="Field">TxBodyOf</a> <a id="1520" href="Ledger.Dijkstra.Specification.Script.Validation.html#887" class="Bound">tx</a><a id="1522" class="Symbol">)</a>
<a id="1524" class="Comment">-- getSubTxScripts : TopLevelTx → ℙ (TxId × ScriptHash)</a>

<a id="indexedRdmrs"></a><a id="1581" href="Ledger.Dijkstra.Specification.Script.Validation.html#1581" class="Function">indexedRdmrs</a> <a id="1594" class="Symbol">:</a> <a id="1596" class="Symbol">(</a><a id="1597" href="Ledger.Dijkstra.Specification.Transaction.html#3472" class="Record">Tx</a> <a id="1600" href="Ledger.Dijkstra.Specification.Script.Validation.html#813" class="Generalizable">ℓ</a><a id="1601" class="Symbol">)</a> <a id="1603" class="Symbol">→</a> <a id="1605" href="Ledger.Dijkstra.Specification.Script.Validation.html#422" class="Datatype">ScriptPurpose</a> <a id="1619" class="Symbol">→</a> <a id="1621" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="1627" class="Symbol">(</a><a id="1628" href="Ledger.Conway.Specification.Script.Base.html#1788" class="Function">Redeemer</a> <a id="1637" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="1639" href="Ledger.Conway.Specification.Script.Base.html#1018" class="Function">ExUnits</a><a id="1646" class="Symbol">)</a>
<a id="1648" href="Ledger.Dijkstra.Specification.Script.Validation.html#1581" class="Function">indexedRdmrs</a> <a id="1661" href="Ledger.Dijkstra.Specification.Script.Validation.html#1661" class="Bound">tx</a> <a id="1664" href="Ledger.Dijkstra.Specification.Script.Validation.html#1664" class="Bound">sp</a> <a id="1667" class="Symbol">=</a> <a id="1669" href="Data.Maybe.Base.html#1276" class="Function">maybe</a> <a id="1675" class="Symbol">(λ</a> <a id="1678" href="Ledger.Dijkstra.Specification.Script.Validation.html#1678" class="Bound">x</a> <a id="1680" class="Symbol">→</a> <a id="1682" href="Axiom.Set.Map.html#17169" class="Function">lookupᵐ?</a> <a id="1691" href="Ledger.Dijkstra.Specification.Transaction.html#5214" class="Function">txRedeemers</a> <a id="1703" href="Ledger.Dijkstra.Specification.Script.Validation.html#1678" class="Bound">x</a><a id="1704" class="Symbol">)</a> <a id="1706" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a> <a id="1714" class="Symbol">(</a><a id="1715" href="Ledger.Dijkstra.Specification.Script.Validation.html#826" class="Function">rdptr</a> <a id="1721" href="Ledger.Dijkstra.Specification.Script.Validation.html#1661" class="Bound">tx</a> <a id="1724" href="Ledger.Dijkstra.Specification.Script.Validation.html#1664" class="Bound">sp</a><a id="1726" class="Symbol">)</a>
  <a id="1730" class="Keyword">where</a> <a id="1736" class="Keyword">open</a> <a id="1741" href="Ledger.Dijkstra.Specification.Transaction.html#3472" class="Module">Tx</a> <a id="1744" href="Ledger.Dijkstra.Specification.Script.Validation.html#1661" class="Bound">tx</a><a id="1746" class="Symbol">;</a> <a id="1748" class="Keyword">open</a> <a id="1753" href="Ledger.Dijkstra.Specification.Transaction.html#5027" class="Module">TxWitnesses</a> <a id="1765" href="Ledger.Dijkstra.Specification.Transaction.html#3582" class="Function">txWitnesses</a>

<a id="getDatum"></a><a id="1778" href="Ledger.Dijkstra.Specification.Script.Validation.html#1778" class="Function">getDatum</a> <a id="1787" class="Symbol">:</a> <a id="1789" href="Ledger.Dijkstra.Specification.Transaction.html#3472" class="Record">Tx</a> <a id="1792" href="Ledger.Dijkstra.Specification.Script.Validation.html#813" class="Generalizable">ℓ</a> <a id="1794" class="Symbol">→</a> <a id="1796" href="Ledger.Dijkstra.Specification.Transaction.html#3108" class="Function">UTxO</a> <a id="1801" class="Symbol">→</a> <a id="1803" href="Ledger.Dijkstra.Specification.Script.Validation.html#422" class="Datatype">ScriptPurpose</a> <a id="1817" class="Symbol">→</a> <a id="1819" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="1825" href="Ledger.Conway.Specification.Script.Base.html#1770" class="Function">Datum</a>
<a id="1831" href="Ledger.Dijkstra.Specification.Script.Validation.html#1778" class="Function">getDatum</a> <a id="1840" href="Ledger.Dijkstra.Specification.Script.Validation.html#1840" class="Bound">tx</a> <a id="1843" href="Ledger.Dijkstra.Specification.Script.Validation.html#1843" class="Bound">utxo</a> <a id="1848" class="Symbol">(</a><a id="1849" href="Ledger.Dijkstra.Specification.Script.Validation.html#598" class="InductiveConstructor">Spend</a> <a id="1855" href="Ledger.Dijkstra.Specification.Script.Validation.html#1855" class="Bound">txin</a><a id="1859" class="Symbol">)</a> <a id="1861" class="Symbol">=</a>
  <a id="1865" class="Keyword">do</a> <a id="1868" class="Symbol">(_</a> <a id="1871" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1873" class="Symbol">_</a> <a id="1875" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1877" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="1882" href="Ledger.Dijkstra.Specification.Script.Validation.html#1882" class="Bound">d</a> <a id="1884" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1886" class="Symbol">_)</a> <a id="1889" href="Class.Monad.Core.html#337" class="Field Operator">←</a> <a id="1891" href="Axiom.Set.Map.html#17169" class="Function">lookupᵐ?</a> <a id="1900" href="Ledger.Dijkstra.Specification.Script.Validation.html#1843" class="Bound">utxo</a> <a id="1905" href="Ledger.Dijkstra.Specification.Script.Validation.html#1855" class="Bound">txin</a> <a id="1910" class="Keyword">where</a>
                            <a id="1944" class="Symbol">(_</a> <a id="1947" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1949" class="Symbol">_</a> <a id="1951" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1953" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a> <a id="1961" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1963" class="Symbol">_)</a> <a id="1966" class="Symbol">→</a> <a id="1968" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a>
     <a id="1981" href="Function.Base.html#4061" class="Function Operator">case</a> <a id="1986" href="Ledger.Dijkstra.Specification.Script.Validation.html#1882" class="Bound">d</a> <a id="1988" href="Function.Base.html#4061" class="Function Operator">of</a> <a id="1991" class="Symbol">λ</a> <a id="1993" class="Keyword">where</a>
       <a id="2006" class="Symbol">(</a><a id="2007" href="Data.Sum.Base.html#675" class="InductiveConstructor">inj₁</a> <a id="2012" href="Ledger.Dijkstra.Specification.Script.Validation.html#2012" class="Bound">d</a><a id="2013" class="Symbol">)</a> <a id="2015" class="Symbol">→</a> <a id="2017" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="2022" href="Ledger.Dijkstra.Specification.Script.Validation.html#2012" class="Bound">d</a>
       <a id="2031" class="Symbol">(</a><a id="2032" href="Data.Sum.Base.html#700" class="InductiveConstructor">inj₂</a> <a id="2037" href="Ledger.Dijkstra.Specification.Script.Validation.html#2037" class="Bound">h</a><a id="2038" class="Symbol">)</a> <a id="2040" class="Symbol">→</a> <a id="2042" href="Axiom.Set.Map.html#17169" class="Function">lookupᵐ?</a> <a id="2051" class="Symbol">(</a><a id="2052" href="Ledger.Prelude.html#1789" class="Function">setToMap</a> <a id="2061" class="Symbol">(</a><a id="2062" href="abstract-set-theory.FiniteSetTheory.html#519" class="Function">mapˢ</a> <a id="2067" href="Data.Product.Base.html#2000" class="Function Operator">&lt;</a> <a id="2069" href="Interface.TypeClasses.Hashable.html#219" class="Field">hash</a> <a id="2074" href="Data.Product.Base.html#2000" class="Function Operator">,</a> <a id="2076" href="Function.Base.html#704" class="Function">id</a> <a id="2079" href="Data.Product.Base.html#2000" class="Function Operator">&gt;</a> <a id="2081" class="Symbol">(</a><a id="2082" href="Ledger.Dijkstra.Specification.Transaction.html#6048" class="Field">DataOf</a> <a id="2089" href="Ledger.Dijkstra.Specification.Script.Validation.html#1840" class="Bound">tx</a><a id="2091" class="Symbol">)))</a> <a id="2095" href="Ledger.Dijkstra.Specification.Script.Validation.html#2037" class="Bound">h</a>
<a id="2097" href="Ledger.Dijkstra.Specification.Script.Validation.html#1778" class="CatchallClause Function">getDatum</a><a id="2105" class="CatchallClause"> </a><a id="2106" href="Ledger.Dijkstra.Specification.Script.Validation.html#2106" class="CatchallClause Bound">tx</a><a id="2108" class="CatchallClause"> </a><a id="2109" href="Ledger.Dijkstra.Specification.Script.Validation.html#2109" class="CatchallClause Bound">utxo</a><a id="2113" class="CatchallClause"> </a><a id="2114" class="CatchallClause Symbol">_</a> <a id="2116" class="Symbol">=</a> <a id="2118" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a>


<a id="2128" class="Keyword">record</a> <a id="TxInfo"></a><a id="2135" href="Ledger.Dijkstra.Specification.Script.Validation.html#2135" class="Record">TxInfo</a> <a id="2142" class="Symbol">:</a> <a id="2144" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="2149" class="Keyword">where</a>
  <a id="2157" class="Keyword">field</a> <a id="TxInfo.realizedInputs"></a><a id="2163" href="Ledger.Dijkstra.Specification.Script.Validation.html#2163" class="Field">realizedInputs</a> <a id="2178" class="Symbol">:</a> <a id="2180" href="Ledger.Dijkstra.Specification.Transaction.html#3108" class="Function">UTxO</a>
        <a id="TxInfo.txOuts"></a><a id="2193" href="Ledger.Dijkstra.Specification.Script.Validation.html#2193" class="Field">txOuts</a>         <a id="2208" class="Symbol">:</a> <a id="2210" href="Ledger.Dijkstra.Specification.Transaction.html#1326" class="Field">Ix</a> <a id="2213" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="2215" href="Ledger.Dijkstra.Specification.Transaction.html#3027" class="Function">TxOut</a>
        <a id="TxInfo.txFee"></a><a id="2229" href="Ledger.Dijkstra.Specification.Script.Validation.html#2229" class="Field">txFee</a>          <a id="2244" class="Symbol">:</a> <a id="2246" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="2252" href="Ledger.Prelude.Base.html#186" class="Function">Fees</a>
        <a id="TxInfo.mint"></a><a id="2265" href="Ledger.Dijkstra.Specification.Script.Validation.html#2265" class="Field">mint</a>           <a id="2280" class="Symbol">:</a> <a id="2282" href="Ledger.Conway.Specification.TokenAlgebra.Base.html#517" class="Function">Value</a>
        <a id="TxInfo.txCerts"></a><a id="2296" href="Ledger.Dijkstra.Specification.Script.Validation.html#2296" class="Field">txCerts</a>        <a id="2311" class="Symbol">:</a> <a id="2313" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="2318" href="Ledger.Conway.Specification.Certs.html#2116" class="Datatype">DCert</a>
        <a id="TxInfo.txWithdrawals"></a><a id="2332" href="Ledger.Dijkstra.Specification.Script.Validation.html#2332" class="Field">txWithdrawals</a>  <a id="2347" class="Symbol">:</a> <a id="2349" href="Ledger.Core.Specification.Address.html#1394" class="Function">Withdrawals</a>
        <a id="TxInfo.txVldt"></a><a id="2369" href="Ledger.Dijkstra.Specification.Script.Validation.html#2369" class="Field">txVldt</a>         <a id="2384" class="Symbol">:</a> <a id="2386" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="2392" href="Ledger.Core.Specification.Epoch.html#722" class="Function">Slot</a> <a id="2397" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="2399" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="2405" href="Ledger.Core.Specification.Epoch.html#722" class="Function">Slot</a>
        <a id="TxInfo.vkKey"></a><a id="2418" href="Ledger.Dijkstra.Specification.Script.Validation.html#2418" class="Field">vkKey</a>          <a id="2433" class="Symbol">:</a> <a id="2435" href="abstract-set-theory.FiniteSetTheory.html#488" class="Function Operator">ℙ</a> <a id="2437" href="Ledger.Core.Specification.Crypto.html#1386" class="Function">KeyHash</a>     <a id="2449" class="Comment">-- native/phase-1/timelock signers</a>
        <a id="TxInfo.txGuards"></a><a id="2492" href="Ledger.Dijkstra.Specification.Script.Validation.html#2492" class="Field">txGuards</a>       <a id="2507" class="Symbol">:</a> <a id="2509" href="abstract-set-theory.FiniteSetTheory.html#488" class="Function Operator">ℙ</a> <a id="2511" href="Ledger.Core.Specification.Address.html#259" class="Datatype">Credential</a>  <a id="2523" class="Comment">-- CIP-0112/0118 guards (required by tx body)</a>
        <a id="TxInfo.txData"></a><a id="2577" href="Ledger.Dijkstra.Specification.Script.Validation.html#2577" class="Field">txData</a>         <a id="2592" class="Symbol">:</a> <a id="2594" href="abstract-set-theory.FiniteSetTheory.html#488" class="Function Operator">ℙ</a> <a id="2596" href="Ledger.Conway.Specification.Script.Base.html#1770" class="Function">Datum</a>
        <a id="TxInfo.txId"></a><a id="2610" href="Ledger.Dijkstra.Specification.Script.Validation.html#2610" class="Field">txId</a>           <a id="2625" class="Symbol">:</a> <a id="2627" href="Ledger.Dijkstra.Specification.Transaction.html#1329" class="Field">TxId</a>


<a id="txInfo"></a><a id="2634" href="Ledger.Dijkstra.Specification.Script.Validation.html#2634" class="Function">txInfo</a> <a id="2641" class="Symbol">:</a> <a id="2643" class="Symbol">(</a><a id="2644" href="Ledger.Dijkstra.Specification.Script.Validation.html#2644" class="Bound">ℓ</a> <a id="2646" class="Symbol">:</a> <a id="2648" href="Ledger.Dijkstra.Specification.Transaction.html#718" class="Datatype">TxLevel</a><a id="2655" class="Symbol">)</a> <a id="2657" class="Symbol">→</a> <a id="2659" href="Ledger.Dijkstra.Specification.Transaction.html#3108" class="Function">UTxO</a> <a id="2664" class="Symbol">→</a> <a id="2666" href="Ledger.Dijkstra.Specification.Transaction.html#3472" class="Record">Tx</a> <a id="2669" href="Ledger.Dijkstra.Specification.Script.Validation.html#2644" class="Bound">ℓ</a> <a id="2671" class="Symbol">→</a> <a id="2673" href="Ledger.Dijkstra.Specification.Script.Validation.html#2135" class="Record">TxInfo</a>

<a id="2681" href="Ledger.Dijkstra.Specification.Script.Validation.html#2634" class="Function">txInfo</a> <a id="2688" href="Ledger.Dijkstra.Specification.Transaction.html#741" class="InductiveConstructor">TxLevelTop</a> <a id="2699" href="Ledger.Dijkstra.Specification.Script.Validation.html#2699" class="Bound">utxo</a> <a id="2704" href="Ledger.Dijkstra.Specification.Script.Validation.html#2704" class="Bound">tx</a> <a id="2707" class="Symbol">=</a>
  <a id="2711" class="Keyword">record</a>  <a id="2719" class="Symbol">{</a> <a id="2721" href="Ledger.Dijkstra.Specification.Script.Validation.html#2163" class="Field">realizedInputs</a> <a id="2736" class="Symbol">=</a> <a id="2738" href="Ledger.Dijkstra.Specification.Script.Validation.html#2699" class="Bound">utxo</a> <a id="2743" href="Axiom.Set.Map.html#13536" class="Function Operator">∣</a> <a id="2745" class="Symbol">(</a><a id="2746" href="Ledger.Dijkstra.Specification.Transaction.html#3795" class="Field">TxBody.txIns</a> <a id="2759" href="Ledger.Dijkstra.Specification.Transaction.html#3544" class="Field">txBody</a><a id="2765" class="Symbol">)</a>
          <a id="2777" class="Symbol">;</a> <a id="2779" href="Ledger.Dijkstra.Specification.Script.Validation.html#2193" class="Field">txOuts</a>         <a id="2794" class="Symbol">=</a> <a id="2796" href="Ledger.Dijkstra.Specification.Transaction.html#3930" class="Field">TxBody.txOuts</a> <a id="2810" href="Ledger.Dijkstra.Specification.Transaction.html#3544" class="Field">txBody</a>
          <a id="2827" class="Symbol">;</a> <a id="2829" href="Ledger.Dijkstra.Specification.Script.Validation.html#2229" class="Field">txFee</a>          <a id="2844" class="Symbol">=</a> <a id="2846" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="2851" class="Symbol">(</a><a id="2852" href="Ledger.Dijkstra.Specification.Transaction.html#4050" class="Field">TxBody.txFee</a> <a id="2865" href="Ledger.Dijkstra.Specification.Transaction.html#3544" class="Field">txBody</a><a id="2871" class="Symbol">)</a>
          <a id="2883" class="Symbol">;</a> <a id="2885" href="Ledger.Dijkstra.Specification.Script.Validation.html#2265" class="Field">mint</a>           <a id="2900" class="Symbol">=</a> <a id="2902" href="Ledger.Dijkstra.Specification.Transaction.html#4467" class="Field">TxBody.mint</a> <a id="2914" href="Ledger.Dijkstra.Specification.Transaction.html#3544" class="Field">txBody</a>
          <a id="2931" class="Symbol">;</a> <a id="2933" href="Ledger.Dijkstra.Specification.Script.Validation.html#2296" class="Field">txCerts</a>        <a id="2948" class="Symbol">=</a> <a id="2950" href="Ledger.Dijkstra.Specification.Transaction.html#4008" class="Field">TxBody.txCerts</a> <a id="2965" href="Ledger.Dijkstra.Specification.Transaction.html#3544" class="Field">txBody</a>
          <a id="2982" class="Symbol">;</a> <a id="2984" href="Ledger.Dijkstra.Specification.Script.Validation.html#2332" class="Field">txWithdrawals</a>  <a id="2999" class="Symbol">=</a> <a id="3001" href="Ledger.Dijkstra.Specification.Transaction.html#4105" class="Field">TxBody.txWithdrawals</a> <a id="3022" href="Ledger.Dijkstra.Specification.Transaction.html#3544" class="Field">txBody</a>
          <a id="3039" class="Symbol">;</a> <a id="3041" href="Ledger.Dijkstra.Specification.Script.Validation.html#2369" class="Field">txVldt</a>         <a id="3056" class="Symbol">=</a> <a id="3058" href="Ledger.Dijkstra.Specification.Transaction.html#4148" class="Field">TxBody.txVldt</a> <a id="3072" href="Ledger.Dijkstra.Specification.Transaction.html#3544" class="Field">txBody</a>
          <a id="3089" class="Symbol">;</a> <a id="3091" href="Ledger.Dijkstra.Specification.Script.Validation.html#2418" class="Field">vkKey</a>          <a id="3106" class="Symbol">=</a> <a id="3108" href="Ledger.Dijkstra.Specification.Transaction.html#4929" class="Function">TxBody.reqSignerHashes</a> <a id="3131" href="Ledger.Dijkstra.Specification.Transaction.html#3544" class="Field">txBody</a>
          <a id="3148" class="Symbol">;</a> <a id="3150" href="Ledger.Dijkstra.Specification.Script.Validation.html#2492" class="Field">txGuards</a>       <a id="3165" class="Symbol">=</a> <a id="3167" href="Ledger.Dijkstra.Specification.Transaction.html#4661" class="Field">TxBody.txGuards</a> <a id="3183" href="Ledger.Dijkstra.Specification.Transaction.html#3544" class="Field">txBody</a>
          <a id="3200" class="Symbol">;</a> <a id="3202" href="Ledger.Dijkstra.Specification.Script.Validation.html#2577" class="Field">txData</a>         <a id="3217" class="Symbol">=</a> <a id="3219" href="Ledger.Dijkstra.Specification.Transaction.html#6048" class="Field">DataOf</a> <a id="3226" href="Ledger.Dijkstra.Specification.Script.Validation.html#2704" class="Bound">tx</a>
          <a id="3239" class="Symbol">;</a> <a id="3241" href="Ledger.Dijkstra.Specification.Script.Validation.html#2610" class="Field">txId</a>           <a id="3256" class="Symbol">=</a> <a id="3258" href="Ledger.Dijkstra.Specification.Transaction.html#3972" class="Field">TxBody.txId</a> <a id="3270" href="Ledger.Dijkstra.Specification.Transaction.html#3544" class="Field">txBody</a>
          <a id="3287" class="Symbol">}</a> <a id="3289" class="Keyword">where</a> <a id="3295" class="Keyword">open</a> <a id="3300" href="Ledger.Dijkstra.Specification.Transaction.html#3472" class="Module">Tx</a> <a id="3303" href="Ledger.Dijkstra.Specification.Script.Validation.html#2704" class="Bound">tx</a>

<a id="3307" href="Ledger.Dijkstra.Specification.Script.Validation.html#2634" class="Function">txInfo</a> <a id="3314" href="Ledger.Dijkstra.Specification.Transaction.html#752" class="InductiveConstructor">TxLevelSub</a> <a id="3325" href="Ledger.Dijkstra.Specification.Script.Validation.html#3325" class="Bound">utxo</a> <a id="3330" href="Ledger.Dijkstra.Specification.Script.Validation.html#3330" class="Bound">tx</a> <a id="3333" class="Symbol">=</a>
  <a id="3337" class="Keyword">record</a>  <a id="3345" class="Symbol">{</a> <a id="3347" href="Ledger.Dijkstra.Specification.Script.Validation.html#2163" class="Field">realizedInputs</a> <a id="3362" class="Symbol">=</a> <a id="3364" href="Ledger.Dijkstra.Specification.Script.Validation.html#3325" class="Bound">utxo</a> <a id="3369" href="Axiom.Set.Map.html#13536" class="Function Operator">∣</a> <a id="3371" class="Symbol">(</a><a id="3372" href="Ledger.Dijkstra.Specification.Transaction.html#3795" class="Field">TxBody.txIns</a> <a id="3385" href="Ledger.Dijkstra.Specification.Transaction.html#3544" class="Field">txBody</a><a id="3391" class="Symbol">)</a>
          <a id="3403" class="Symbol">;</a> <a id="3405" href="Ledger.Dijkstra.Specification.Script.Validation.html#2193" class="Field">txOuts</a>         <a id="3420" class="Symbol">=</a> <a id="3422" href="Ledger.Dijkstra.Specification.Transaction.html#3930" class="Field">TxBody.txOuts</a> <a id="3436" href="Ledger.Dijkstra.Specification.Transaction.html#3544" class="Field">txBody</a>
          <a id="3453" class="Symbol">;</a> <a id="3455" href="Ledger.Dijkstra.Specification.Script.Validation.html#2229" class="Field">txFee</a>          <a id="3470" class="Symbol">=</a> <a id="3472" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a>
          <a id="3490" class="Symbol">;</a> <a id="3492" href="Ledger.Dijkstra.Specification.Script.Validation.html#2265" class="Field">mint</a>           <a id="3507" class="Symbol">=</a> <a id="3509" href="Ledger.Dijkstra.Specification.Transaction.html#4467" class="Field">TxBody.mint</a> <a id="3521" href="Ledger.Dijkstra.Specification.Transaction.html#3544" class="Field">txBody</a>
          <a id="3538" class="Symbol">;</a> <a id="3540" href="Ledger.Dijkstra.Specification.Script.Validation.html#2296" class="Field">txCerts</a>        <a id="3555" class="Symbol">=</a> <a id="3557" href="Ledger.Dijkstra.Specification.Transaction.html#4008" class="Field">TxBody.txCerts</a> <a id="3572" href="Ledger.Dijkstra.Specification.Transaction.html#3544" class="Field">txBody</a>
          <a id="3589" class="Symbol">;</a> <a id="3591" href="Ledger.Dijkstra.Specification.Script.Validation.html#2332" class="Field">txWithdrawals</a>  <a id="3606" class="Symbol">=</a> <a id="3608" href="Ledger.Dijkstra.Specification.Transaction.html#4105" class="Field">TxBody.txWithdrawals</a> <a id="3629" href="Ledger.Dijkstra.Specification.Transaction.html#3544" class="Field">txBody</a>
          <a id="3646" class="Symbol">;</a> <a id="3648" href="Ledger.Dijkstra.Specification.Script.Validation.html#2369" class="Field">txVldt</a>         <a id="3663" class="Symbol">=</a> <a id="3665" href="Ledger.Dijkstra.Specification.Transaction.html#4148" class="Field">TxBody.txVldt</a> <a id="3679" href="Ledger.Dijkstra.Specification.Transaction.html#3544" class="Field">txBody</a>
          <a id="3696" class="Symbol">;</a> <a id="3698" href="Ledger.Dijkstra.Specification.Script.Validation.html#2418" class="Field">vkKey</a>          <a id="3713" class="Symbol">=</a> <a id="3715" href="Ledger.Dijkstra.Specification.Transaction.html#4929" class="Function">TxBody.reqSignerHashes</a> <a id="3738" href="Ledger.Dijkstra.Specification.Transaction.html#3544" class="Field">txBody</a>
          <a id="3755" class="Symbol">;</a> <a id="3757" href="Ledger.Dijkstra.Specification.Script.Validation.html#2492" class="Field">txGuards</a>       <a id="3772" class="Symbol">=</a> <a id="3774" href="Ledger.Dijkstra.Specification.Transaction.html#4661" class="Field">TxBody.txGuards</a> <a id="3790" href="Ledger.Dijkstra.Specification.Transaction.html#3544" class="Field">txBody</a>
          <a id="3807" class="Symbol">;</a> <a id="3809" href="Ledger.Dijkstra.Specification.Script.Validation.html#2577" class="Field">txData</a>         <a id="3824" class="Symbol">=</a> <a id="3826" href="Ledger.Dijkstra.Specification.Transaction.html#6048" class="Field">DataOf</a> <a id="3833" href="Ledger.Dijkstra.Specification.Script.Validation.html#3330" class="Bound">tx</a>
          <a id="3846" class="Symbol">;</a> <a id="3848" href="Ledger.Dijkstra.Specification.Script.Validation.html#2610" class="Field">txId</a>           <a id="3863" class="Symbol">=</a> <a id="3865" href="Ledger.Dijkstra.Specification.Transaction.html#3972" class="Field">TxBody.txId</a> <a id="3877" href="Ledger.Dijkstra.Specification.Transaction.html#3544" class="Field">txBody</a>
          <a id="3894" class="Symbol">}</a> <a id="3896" class="Keyword">where</a> <a id="3902" class="Keyword">open</a> <a id="3907" href="Ledger.Dijkstra.Specification.Transaction.html#3472" class="Module">Tx</a> <a id="3910" href="Ledger.Dijkstra.Specification.Script.Validation.html#3330" class="Bound">tx</a>


<a id="credsNeededMinusCollateral"></a><a id="3915" href="Ledger.Dijkstra.Specification.Script.Validation.html#3915" class="Function">credsNeededMinusCollateral</a> <a id="3942" class="Symbol">:</a> <a id="3944" class="Symbol">{</a><a id="3945" href="Ledger.Dijkstra.Specification.Script.Validation.html#3945" class="Bound">ℓ</a> <a id="3947" class="Symbol">:</a> <a id="3949" href="Ledger.Dijkstra.Specification.Transaction.html#718" class="Datatype">TxLevel</a><a id="3956" class="Symbol">}</a> <a id="3958" class="Symbol">→</a> <a id="3960" href="Ledger.Dijkstra.Specification.Transaction.html#3719" class="Record">TxBody</a> <a id="3967" href="Ledger.Dijkstra.Specification.Script.Validation.html#3945" class="Bound">ℓ</a> <a id="3969" class="Symbol">→</a> <a id="3971" href="abstract-set-theory.FiniteSetTheory.html#488" class="Function Operator">ℙ</a> <a id="3973" class="Symbol">(</a><a id="3974" href="Ledger.Dijkstra.Specification.Script.Validation.html#422" class="Datatype">ScriptPurpose</a> <a id="3988" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="3990" href="Ledger.Core.Specification.Address.html#259" class="Datatype">Credential</a><a id="4000" class="Symbol">)</a>
<a id="4002" href="Ledger.Dijkstra.Specification.Script.Validation.html#3915" class="Function">credsNeededMinusCollateral</a> <a id="4029" href="Ledger.Dijkstra.Specification.Script.Validation.html#4029" class="Bound">txb</a> <a id="4033" class="Symbol">=</a> <a id="4035" href="Ledger.Dijkstra.Specification.Script.Validation.html#4063" class="Function">a</a> <a id="4037" href="Axiom.Set.html#9137" class="Function Operator">∪</a> <a id="4039" href="Ledger.Dijkstra.Specification.Script.Validation.html#4065" class="Function">b</a> <a id="4041" href="Axiom.Set.html#9137" class="Function Operator">∪</a> <a id="4043" href="Ledger.Dijkstra.Specification.Script.Validation.html#4067" class="Function">c</a> <a id="4045" href="Axiom.Set.html#9137" class="Function Operator">∪</a> <a id="4047" href="Ledger.Dijkstra.Specification.Script.Validation.html#4069" class="Function">d</a> <a id="4049" href="Axiom.Set.html#9137" class="Function Operator">∪</a> <a id="4051" href="Ledger.Dijkstra.Specification.Script.Validation.html#4071" class="Function">e</a>
  <a id="4055" class="Keyword">where</a>
  <a id="4063" href="Ledger.Dijkstra.Specification.Script.Validation.html#4063" class="Function">a</a> <a id="4065" href="Ledger.Dijkstra.Specification.Script.Validation.html#4065" class="Function">b</a> <a id="4067" href="Ledger.Dijkstra.Specification.Script.Validation.html#4067" class="Function">c</a> <a id="4069" href="Ledger.Dijkstra.Specification.Script.Validation.html#4069" class="Function">d</a> <a id="4071" href="Ledger.Dijkstra.Specification.Script.Validation.html#4071" class="Function">e</a> <a id="4073" class="Symbol">:</a> <a id="4075" href="abstract-set-theory.FiniteSetTheory.html#488" class="Function Operator">ℙ</a> <a id="4077" class="Symbol">(</a><a id="4078" href="Ledger.Dijkstra.Specification.Script.Validation.html#422" class="Datatype">ScriptPurpose</a> <a id="4092" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="4094" href="Ledger.Core.Specification.Address.html#259" class="Datatype">Credential</a><a id="4104" class="Symbol">)</a>
  <a id="4108" href="Ledger.Dijkstra.Specification.Script.Validation.html#4063" class="Function">a</a> <a id="4110" class="Symbol">=</a> <a id="4112" href="abstract-set-theory.FiniteSetTheory.html#519" class="Function">mapˢ</a> <a id="4117" class="Symbol">(λ</a> <a id="4120" href="Ledger.Dijkstra.Specification.Script.Validation.html#4120" class="Bound">a</a> <a id="4122" class="Symbol">→</a> <a id="4124" class="Symbol">(</a><a id="4125" href="Ledger.Dijkstra.Specification.Script.Validation.html#500" class="InductiveConstructor">Rwrd</a> <a id="4130" href="Ledger.Dijkstra.Specification.Script.Validation.html#4120" class="Bound">a</a> <a id="4132" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="4134" href="Ledger.Core.Specification.Address.html#421" class="Field">CredentialOf</a> <a id="4147" href="Ledger.Dijkstra.Specification.Script.Validation.html#4120" class="Bound">a</a><a id="4148" class="Symbol">))</a> <a id="4151" class="Symbol">(</a><a id="4152" href="Class.IsSet.html#916" class="Function">dom</a> <a id="4156" href="Ledger.Prelude.html#2302" class="Function Operator">∣</a> <a id="4158" href="Ledger.Core.Specification.Address.html#1700" class="Field">WithdrawalsOf</a> <a id="4172" href="Ledger.Dijkstra.Specification.Script.Validation.html#4029" class="Bound">txb</a> <a id="4176" href="Ledger.Prelude.html#2302" class="Function Operator">∣</a><a id="4177" class="Symbol">)</a>
  <a id="4181" href="Ledger.Dijkstra.Specification.Script.Validation.html#4065" class="Function">b</a> <a id="4183" class="Symbol">=</a> <a id="4185" href="Axiom.Set.html#7990" class="Function">mapPartial</a> <a id="4196" class="Symbol">(λ</a> <a id="4199" href="Ledger.Dijkstra.Specification.Script.Validation.html#4199" class="Bound">c</a> <a id="4201" class="Symbol">→</a> <a id="4203" class="Symbol">(</a><a id="4204" href="Ledger.Dijkstra.Specification.Script.Validation.html#451" class="InductiveConstructor">Cert</a> <a id="4209" href="Ledger.Dijkstra.Specification.Script.Validation.html#4199" class="Bound">c</a> <a id="4211" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,_</a><a id="4213" class="Symbol">)</a> <a id="4215" href="Class.Functor.Core.html#242" class="Field Operator">&lt;$&gt;</a> <a id="4219" href="Ledger.Conway.Specification.Certs.html#2871" class="Function">cwitness</a> <a id="4228" href="Ledger.Dijkstra.Specification.Script.Validation.html#4199" class="Bound">c</a><a id="4229" class="Symbol">)</a> <a id="4231" class="Symbol">(</a><a id="4232" href="Axiom.Set.html#5903" class="Function">fromList</a> <a id="4241" class="Symbol">(</a><a id="4242" href="Ledger.Dijkstra.Specification.Transaction.html#5932" class="Field">DCertsOf</a> <a id="4251" href="Ledger.Dijkstra.Specification.Script.Validation.html#4029" class="Bound">txb</a><a id="4254" class="Symbol">))</a>
  <a id="4259" href="Ledger.Dijkstra.Specification.Script.Validation.html#4067" class="Function">c</a> <a id="4261" class="Symbol">=</a> <a id="4263" href="abstract-set-theory.FiniteSetTheory.html#519" class="Function">mapˢ</a> <a id="4268" class="Symbol">(λ</a> <a id="4271" href="Ledger.Dijkstra.Specification.Script.Validation.html#4271" class="Bound">x</a> <a id="4273" class="Symbol">→</a> <a id="4275" class="Symbol">(</a><a id="4276" href="Ledger.Dijkstra.Specification.Script.Validation.html#549" class="InductiveConstructor">Mint</a> <a id="4281" href="Ledger.Dijkstra.Specification.Script.Validation.html#4271" class="Bound">x</a> <a id="4283" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="4285" href="Ledger.Core.Specification.Address.html#321" class="InductiveConstructor">ScriptObj</a> <a id="4295" href="Ledger.Dijkstra.Specification.Script.Validation.html#4271" class="Bound">x</a><a id="4296" class="Symbol">))</a> <a id="4299" class="Symbol">(</a><a id="4300" href="Ledger.Conway.Specification.TokenAlgebra.Base.html#927" class="Function">policies</a> <a id="4309" class="Symbol">(</a><a id="4310" href="Ledger.Dijkstra.Specification.Transaction.html#6310" class="Field">ValueOf</a> <a id="4318" href="Ledger.Dijkstra.Specification.Script.Validation.html#4029" class="Bound">txb</a><a id="4321" class="Symbol">))</a>
  <a id="4326" href="Ledger.Dijkstra.Specification.Script.Validation.html#4069" class="Function">d</a> <a id="4328" class="Symbol">=</a> <a id="4330" href="Axiom.Set.html#7990" class="Function">mapPartial</a> <a id="4341" class="Symbol">(λ</a> <a id="4344" href="Ledger.Dijkstra.Specification.Script.Validation.html#4344" class="Bound">v</a> <a id="4346" class="Symbol">→</a> <a id="4348" href="Class.ToBool.html#342" class="Function Operator">if</a> <a id="4351" href="Ledger.Conway.Specification.Gov.Actions.html#6713" class="Function">isGovVoterCredential</a> <a id="4372" href="Ledger.Dijkstra.Specification.Script.Validation.html#4344" class="Bound">v</a> <a id="4374" href="Class.ToBool.html#342" class="Function Operator">then</a> <a id="4379" class="Symbol">(λ</a> <a id="4382" class="Symbol">{</a><a id="4383" href="Ledger.Dijkstra.Specification.Script.Validation.html#4383" class="Bound">c</a><a id="4384" class="Symbol">}</a> <a id="4386" class="Symbol">→</a> <a id="4388" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="4393" class="Symbol">(</a><a id="4394" href="Ledger.Dijkstra.Specification.Script.Validation.html#647" class="InductiveConstructor">Vote</a> <a id="4399" href="Ledger.Dijkstra.Specification.Script.Validation.html#4344" class="Bound">v</a> <a id="4401" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="4403" href="Ledger.Dijkstra.Specification.Script.Validation.html#4383" class="Bound">c</a><a id="4404" class="Symbol">))</a> <a id="4407" href="Class.ToBool.html#342" class="Function Operator">else</a> <a id="4412" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a><a id="4419" class="Symbol">)</a>
                 <a id="4438" class="Symbol">(</a><a id="4439" href="Axiom.Set.html#5903" class="Function">fromList</a> <a id="4448" class="Symbol">(</a><a id="4449" href="Class.Functor.Core.html#272" class="Function">map</a> <a id="4453" href="Ledger.Conway.Specification.Gov.Actions.html#4074" class="Field">GovVoterOf</a> <a id="4464" class="Symbol">(</a><a id="4465" href="Ledger.Dijkstra.Specification.Transaction.html#6565" class="Field">GovVotesOf</a> <a id="4476" href="Ledger.Dijkstra.Specification.Script.Validation.html#4029" class="Bound">txb</a><a id="4479" class="Symbol">)))</a>
  <a id="4485" href="Ledger.Dijkstra.Specification.Script.Validation.html#4071" class="Function">e</a> <a id="4487" class="Symbol">=</a> <a id="4489" href="Axiom.Set.html#7990" class="Function">mapPartial</a> <a id="4500" class="Symbol">(λ</a> <a id="4503" href="Ledger.Dijkstra.Specification.Script.Validation.html#4503" class="Bound">p</a> <a id="4505" class="Symbol">→</a> <a id="4507" href="Class.ToBool.html#342" class="Function Operator">if</a> <a id="4510" href="Ledger.Conway.Specification.Gov.Actions.html#4288" class="Field">PolicyOf</a> <a id="4519" href="Ledger.Dijkstra.Specification.Script.Validation.html#4503" class="Bound">p</a> <a id="4521" href="Class.ToBool.html#342" class="Function Operator">then</a> <a id="4526" class="Symbol">(λ</a> <a id="4529" class="Symbol">{</a><a id="4530" href="Ledger.Dijkstra.Specification.Script.Validation.html#4530" class="Bound">sh</a><a id="4532" class="Symbol">}</a> <a id="4534" class="Symbol">→</a> <a id="4536" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="4541" class="Symbol">(</a><a id="4542" href="Ledger.Dijkstra.Specification.Script.Validation.html#696" class="InductiveConstructor">Propose</a>  <a id="4551" href="Ledger.Dijkstra.Specification.Script.Validation.html#4503" class="Bound">p</a> <a id="4553" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="4555" href="Ledger.Core.Specification.Address.html#321" class="InductiveConstructor">ScriptObj</a> <a id="4565" href="Ledger.Dijkstra.Specification.Script.Validation.html#4530" class="Bound">sh</a><a id="4567" class="Symbol">))</a> <a id="4570" href="Class.ToBool.html#342" class="Function Operator">else</a> <a id="4575" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a><a id="4582" class="Symbol">)</a>
                 <a id="4601" class="Symbol">(</a><a id="4602" href="Axiom.Set.html#5903" class="Function">fromList</a> <a id="4611" class="Symbol">(</a><a id="4612" href="Ledger.Dijkstra.Specification.Transaction.html#6427" class="Field">GovProposalsOf</a> <a id="4627" href="Ledger.Dijkstra.Specification.Script.Validation.html#4029" class="Bound">txb</a><a id="4630" class="Symbol">))</a>

<a id="credsNeeded"></a><a id="4634" href="Ledger.Dijkstra.Specification.Script.Validation.html#4634" class="Function">credsNeeded</a> <a id="4646" class="Symbol">:</a> <a id="4648" class="Symbol">(</a><a id="4649" href="Ledger.Dijkstra.Specification.Script.Validation.html#4649" class="Bound">ℓ</a> <a id="4651" class="Symbol">:</a> <a id="4653" href="Ledger.Dijkstra.Specification.Transaction.html#718" class="Datatype">TxLevel</a><a id="4660" class="Symbol">)</a> <a id="4662" class="Symbol">→</a> <a id="4664" href="Ledger.Dijkstra.Specification.Transaction.html#3108" class="Function">UTxO</a> <a id="4669" class="Symbol">→</a> <a id="4671" class="Symbol">(</a><a id="4672" href="Ledger.Dijkstra.Specification.Transaction.html#3719" class="Record">TxBody</a> <a id="4679" href="Ledger.Dijkstra.Specification.Script.Validation.html#4649" class="Bound">ℓ</a><a id="4680" class="Symbol">)</a> <a id="4682" class="Symbol">→</a> <a id="4684" href="abstract-set-theory.FiniteSetTheory.html#488" class="Function Operator">ℙ</a> <a id="4686" class="Symbol">(</a><a id="4687" href="Ledger.Dijkstra.Specification.Script.Validation.html#422" class="Datatype">ScriptPurpose</a> <a id="4701" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="4703" href="Ledger.Core.Specification.Address.html#259" class="Datatype">Credential</a><a id="4713" class="Symbol">)</a>
<a id="4715" href="Ledger.Dijkstra.Specification.Script.Validation.html#4634" class="Function">credsNeeded</a> <a id="4727" href="Ledger.Dijkstra.Specification.Transaction.html#741" class="InductiveConstructor">TxLevelTop</a> <a id="4738" href="Ledger.Dijkstra.Specification.Script.Validation.html#4738" class="Bound">utxo</a> <a id="4743" href="Ledger.Dijkstra.Specification.Script.Validation.html#4743" class="Bound">txb</a> <a id="4747" class="Symbol">=</a> <a id="4749" href="Ledger.Dijkstra.Specification.Script.Validation.html#3915" class="Function">credsNeededMinusCollateral</a> <a id="4776" href="Ledger.Dijkstra.Specification.Script.Validation.html#4743" class="Bound">txb</a>
  <a id="4782" href="Axiom.Set.html#9137" class="Function Operator">∪</a> <a id="4784" href="abstract-set-theory.FiniteSetTheory.html#519" class="Function">mapˢ</a> <a id="4789" class="Symbol">(λ</a> <a id="4792" class="Symbol">(</a><a id="4793" href="Ledger.Dijkstra.Specification.Script.Validation.html#4793" class="Bound">i</a> <a id="4795" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="4797" href="Ledger.Dijkstra.Specification.Script.Validation.html#4797" class="Bound">o</a><a id="4798" class="Symbol">)</a> <a id="4800" class="Symbol">→</a> <a id="4802" class="Symbol">(</a><a id="4803" href="Ledger.Dijkstra.Specification.Script.Validation.html#598" class="InductiveConstructor">Spend</a>  <a id="4810" href="Ledger.Dijkstra.Specification.Script.Validation.html#4793" class="Bound">i</a> <a id="4812" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="4814" href="Ledger.Core.Specification.Address.html#2685" class="Function">payCred</a> <a id="4822" class="Symbol">(</a><a id="4823" href="Data.Product.Base.html#636" class="Field">proj₁</a> <a id="4829" href="Ledger.Dijkstra.Specification.Script.Validation.html#4797" class="Bound">o</a><a id="4830" class="Symbol">)))</a> <a id="4834" class="Symbol">((</a><a id="4836" href="Ledger.Dijkstra.Specification.Script.Validation.html#4738" class="Bound">utxo</a> <a id="4841" href="Axiom.Set.Map.html#13536" class="Function Operator">∣</a> <a id="4843" class="Symbol">(</a><a id="4844" href="Ledger.Dijkstra.Specification.Transaction.html#3795" class="Field">txIns</a> <a id="4850" href="Axiom.Set.html#9137" class="Function Operator">∪</a> <a id="4852" href="Ledger.Dijkstra.Specification.Transaction.html#3871" class="Field">collateralInputs</a><a id="4868" class="Symbol">))</a> <a id="4871" href="Axiom.Set.Map.html#2293" class="Function Operator">ˢ</a><a id="4872" class="Symbol">)</a>
  <a id="4876" class="Keyword">where</a> <a id="4882" class="Keyword">open</a> <a id="4887" href="Ledger.Dijkstra.Specification.Transaction.html#3719" class="Module">TxBody</a> <a id="4894" href="Ledger.Dijkstra.Specification.Script.Validation.html#4743" class="Bound">txb</a>

<a id="4899" href="Ledger.Dijkstra.Specification.Script.Validation.html#4634" class="Function">credsNeeded</a> <a id="4911" href="Ledger.Dijkstra.Specification.Transaction.html#752" class="InductiveConstructor">TxLevelSub</a> <a id="4922" href="Ledger.Dijkstra.Specification.Script.Validation.html#4922" class="Bound">utxo</a> <a id="4927" href="Ledger.Dijkstra.Specification.Script.Validation.html#4927" class="Bound">txb</a> <a id="4931" class="Symbol">=</a> <a id="4933" href="Ledger.Dijkstra.Specification.Script.Validation.html#3915" class="Function">credsNeededMinusCollateral</a> <a id="4960" href="Ledger.Dijkstra.Specification.Script.Validation.html#4927" class="Bound">txb</a>
  <a id="4966" href="Axiom.Set.html#9137" class="Function Operator">∪</a> <a id="4968" href="abstract-set-theory.FiniteSetTheory.html#519" class="Function">mapˢ</a> <a id="4973" class="Symbol">(λ</a> <a id="4976" class="Symbol">(</a><a id="4977" href="Ledger.Dijkstra.Specification.Script.Validation.html#4977" class="Bound">i</a> <a id="4979" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="4981" href="Ledger.Dijkstra.Specification.Script.Validation.html#4981" class="Bound">o</a><a id="4982" class="Symbol">)</a> <a id="4984" class="Symbol">→</a> <a id="4986" class="Symbol">(</a><a id="4987" href="Ledger.Dijkstra.Specification.Script.Validation.html#598" class="InductiveConstructor">Spend</a>  <a id="4994" href="Ledger.Dijkstra.Specification.Script.Validation.html#4977" class="Bound">i</a> <a id="4996" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="4998" href="Ledger.Core.Specification.Address.html#2685" class="Function">payCred</a> <a id="5006" class="Symbol">(</a><a id="5007" href="Data.Product.Base.html#636" class="Field">proj₁</a> <a id="5013" href="Ledger.Dijkstra.Specification.Script.Validation.html#4981" class="Bound">o</a><a id="5014" class="Symbol">)))</a> <a id="5018" class="Symbol">((</a><a id="5020" href="Ledger.Dijkstra.Specification.Script.Validation.html#4922" class="Bound">utxo</a> <a id="5025" href="Axiom.Set.Map.html#13536" class="Function Operator">∣</a> <a id="5027" href="Ledger.Dijkstra.Specification.Transaction.html#3795" class="Field">txIns</a><a id="5032" class="Symbol">)</a> <a id="5034" href="Axiom.Set.Map.html#2293" class="Function Operator">ˢ</a><a id="5035" class="Symbol">)</a>
  <a id="5039" class="Keyword">where</a> <a id="5045" class="Keyword">open</a> <a id="5050" href="Ledger.Dijkstra.Specification.Transaction.html#3719" class="Module">TxBody</a> <a id="5057" href="Ledger.Dijkstra.Specification.Script.Validation.html#4927" class="Bound">txb</a>

<a id="5062" class="Comment">--valContext : TxInfo → ScriptPurpose → Data</a>
<a id="5107" class="Comment">--valContext txinfo sp = toData (txinfo , sp)</a>

<a id="txOutToDataHash"></a><a id="5154" href="Ledger.Dijkstra.Specification.Script.Validation.html#5154" class="Function">txOutToDataHash</a> <a id="5170" class="Symbol">:</a> <a id="5172" href="Ledger.Dijkstra.Specification.Transaction.html#3027" class="Function">TxOut</a> <a id="5178" class="Symbol">→</a> <a id="5180" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="5186" href="Ledger.Conway.Specification.Script.Base.html#1723" class="Function">DataHash</a>
<a id="5195" href="Ledger.Dijkstra.Specification.Script.Validation.html#5154" class="Function">txOutToDataHash</a> <a id="5211" class="Symbol">(_</a> <a id="5214" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5216" class="Symbol">_</a> <a id="5218" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5220" href="Ledger.Dijkstra.Specification.Script.Validation.html#5220" class="Bound">d</a> <a id="5222" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5224" class="Symbol">_)</a> <a id="5227" class="Symbol">=</a> <a id="5229" href="Ledger.Dijkstra.Specification.Script.Validation.html#5220" class="Bound">d</a> <a id="5231" href="Class.Monad.Core.html#337" class="Field Operator">&gt;&gt;=</a> <a id="5235" href="Data.Sum.html#870" class="Function">isInj₂</a>

<a id="txOutToP2Script"></a><a id="5243" href="Ledger.Dijkstra.Specification.Script.Validation.html#5243" class="Function">txOutToP2Script</a>
  <a id="5261" class="Symbol">:</a> <a id="5263" href="Ledger.Dijkstra.Specification.Transaction.html#3108" class="Function">UTxO</a> <a id="5268" class="Symbol">→</a> <a id="5270" class="Symbol">(</a><a id="5271" href="Ledger.Dijkstra.Specification.Transaction.html#3472" class="Record">Tx</a> <a id="5274" href="Ledger.Dijkstra.Specification.Script.Validation.html#813" class="Generalizable">ℓ</a><a id="5275" class="Symbol">)</a>
  <a id="5279" class="Symbol">→</a> <a id="5281" href="Ledger.Dijkstra.Specification.Transaction.html#3027" class="Function">TxOut</a> <a id="5287" class="Symbol">→</a> <a id="5289" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="5295" href="Ledger.Conway.Specification.Script.Base.html#2367" class="Function">P2Script</a>
<a id="5304" href="Ledger.Dijkstra.Specification.Script.Validation.html#5243" class="Function">txOutToP2Script</a> <a id="5320" href="Ledger.Dijkstra.Specification.Script.Validation.html#5320" class="Bound">utxo</a> <a id="5325" href="Ledger.Dijkstra.Specification.Script.Validation.html#5325" class="Bound">tx</a> <a id="5328" class="Symbol">(</a><a id="5329" href="Ledger.Dijkstra.Specification.Script.Validation.html#5329" class="Bound">a</a> <a id="5331" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5333" class="Symbol">_)</a> <a id="5336" class="Symbol">=</a>
  <a id="5340" class="Keyword">do</a> <a id="5343" href="Ledger.Dijkstra.Specification.Script.Validation.html#5343" class="Bound">sh</a> <a id="5346" href="Class.Monad.Core.html#337" class="Field Operator">←</a> <a id="5348" href="Ledger.Core.Specification.Address.html#765" class="Function">isScriptObj</a> <a id="5360" class="Symbol">(</a><a id="5361" href="Ledger.Core.Specification.Address.html#2685" class="Function">payCred</a> <a id="5369" href="Ledger.Dijkstra.Specification.Script.Validation.html#5329" class="Bound">a</a><a id="5370" class="Symbol">)</a>
     <a id="5377" href="Ledger.Dijkstra.Specification.Script.Validation.html#5377" class="Bound">s</a>  <a id="5380" href="Class.Monad.Core.html#337" class="Field Operator">←</a> <a id="5382" href="Ledger.Dijkstra.Specification.Transaction.html#9330" class="Function">lookupScriptHash</a> <a id="5399" href="Ledger.Dijkstra.Specification.Script.Validation.html#5343" class="Bound">sh</a> <a id="5402" href="Ledger.Dijkstra.Specification.Script.Validation.html#5325" class="Bound">tx</a> <a id="5405" href="Ledger.Dijkstra.Specification.Script.Validation.html#5320" class="Bound">utxo</a>
     <a id="5415" href="Ledger.Conway.Specification.Script.Base.html#3220" class="Function">toP2Script</a> <a id="5426" href="Ledger.Dijkstra.Specification.Script.Validation.html#5377" class="Bound">s</a>
<a id="5428" class="Comment">-- opaque</a>
<a id="5438" class="Comment">--   collectP2ScriptsWithContext</a>
<a id="5471" class="Comment">--     : PParams → (Tx ℓ) → UTxO</a>
<a id="5504" class="Comment">--     → List (P2Script × List Data × ExUnits × CostModel)</a>
<a id="5563" class="Comment">--   collectP2ScriptsWithContext pp tx utxo</a>
<a id="5607" class="Comment">--     = setToList</a>
<a id="5626" class="Comment">--     $ mapPartial (λ (sp , c) → if isScriptObj c</a>
<a id="5677" class="Comment">--                                 then (λ {sh} → toScriptInput sp sh)</a>
<a id="5748" class="Comment">--                                 else nothing)</a>
<a id="5797" class="Comment">--     $ credsNeeded utxo (TxBodyOf tx)</a>
<a id="5837" class="Comment">--     where</a>
<a id="5850" class="Comment">--       toScriptInput</a>
<a id="5873" class="Comment">--         : ScriptPurpose → ScriptHash</a>
<a id="5913" class="Comment">--         → Maybe (P2Script × List Data × ExUnits × CostModel)</a>
<a id="5977" class="Comment">--       toScriptInput sp sh =</a>
<a id="6008" class="Comment">--         do s ← lookupScriptHash sh tx utxo</a>
<a id="6054" class="Comment">--            p2s ← toP2Script s</a>
<a id="6087" class="Comment">--            (rdmr , exunits) ← indexedRdmrs tx sp</a>
<a id="6139" class="Comment">--            let data&#39;     = maybe [_] [] (getDatum tx utxo sp) ++ rdmr ∷ [ valContext (txInfo (language p2s) pp utxo tx) sp ]</a>
<a id="6267" class="Comment">--                costModel = PParams.costmdls pp</a>
<a id="6317" class="Comment">--            just (p2s , data&#39; , exunits , costModel)</a>

<a id="evalP2Scripts"></a><a id="6373" href="Ledger.Dijkstra.Specification.Script.Validation.html#6373" class="Function">evalP2Scripts</a> <a id="6387" class="Symbol">:</a> <a id="6389" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="6394" class="Symbol">(</a><a id="6395" href="Ledger.Conway.Specification.Script.Base.html#2367" class="Function">P2Script</a> <a id="6404" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="6406" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="6411" href="Ledger.Conway.Specification.Script.Base.html#1708" class="Function">Data</a> <a id="6416" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="6418" href="Ledger.Conway.Specification.Script.Base.html#1018" class="Function">ExUnits</a> <a id="6426" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="6428" href="Ledger.Conway.Specification.Script.Base.html#989" class="Function">CostModel</a><a id="6437" class="Symbol">)</a> <a id="6439" class="Symbol">→</a> <a id="6441" href="Agda.Builtin.Bool.html#173" class="Datatype">Bool</a>
<a id="6446" href="Ledger.Dijkstra.Specification.Script.Validation.html#6373" class="Function">evalP2Scripts</a> <a id="6460" class="Symbol">=</a> <a id="6462" href="Data.Bool.ListAction.html#927" class="Function">all</a> <a id="6466" class="Symbol">(λ</a> <a id="6469" class="Symbol">(</a><a id="6470" href="Ledger.Dijkstra.Specification.Script.Validation.html#6470" class="Bound">s</a> <a id="6472" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="6474" href="Ledger.Dijkstra.Specification.Script.Validation.html#6474" class="Bound">d</a> <a id="6476" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="6478" href="Ledger.Dijkstra.Specification.Script.Validation.html#6478" class="Bound">eu</a> <a id="6481" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="6483" href="Ledger.Dijkstra.Specification.Script.Validation.html#6483" class="Bound">cm</a><a id="6485" class="Symbol">)</a> <a id="6487" class="Symbol">→</a> <a id="6489" href="Ledger.Dijkstra.Specification.Abstract.html#1080" class="Field">runPLCScript</a> <a id="6502" href="Ledger.Dijkstra.Specification.Script.Validation.html#6483" class="Bound">cm</a> <a id="6505" href="Ledger.Dijkstra.Specification.Script.Validation.html#6470" class="Bound">s</a> <a id="6507" href="Ledger.Dijkstra.Specification.Script.Validation.html#6478" class="Bound">eu</a> <a id="6510" href="Ledger.Dijkstra.Specification.Script.Validation.html#6474" class="Bound">d</a><a id="6511" class="Symbol">)</a>

</pre></body></html>