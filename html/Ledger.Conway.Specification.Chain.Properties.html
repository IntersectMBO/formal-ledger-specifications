<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>Ledger.Conway.Specification.Chain.Properties</title><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.css"><link rel="stylesheet" href="Agda.css"><script src="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.js"></script><script src="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/contrib/auto-render.min.js"></script><script src="AgdaKaTeX.js" defer=""></script></head><body><pre class="Agda"><a id="1" class="Symbol">{-#</a> <a id="5" class="Keyword">OPTIONS</a> <a id="13" class="Pragma">--safe</a> <a id="20" class="Symbol">#-}</a>

<a id="25" class="Keyword">open</a> <a id="30" class="Keyword">import</a> <a id="37" href="Ledger.Conway.Specification.Transaction.html" class="Module">Ledger.Conway.Specification.Transaction</a> <a id="77" class="Keyword">using</a> <a id="83" class="Symbol">(</a><a id="84" href="Ledger.Conway.Specification.Transaction.html#1000" class="Record">TransactionStructure</a><a id="104" class="Symbol">)</a>
<a id="106" class="Keyword">open</a> <a id="111" class="Keyword">import</a> <a id="118" href="Ledger.Conway.Specification.Abstract.html" class="Module">Ledger.Conway.Specification.Abstract</a> <a id="155" class="Keyword">using</a> <a id="161" class="Symbol">(</a><a id="162" href="Ledger.Conway.Specification.Abstract.html#654" class="Record">AbstractFunctions</a><a id="179" class="Symbol">)</a>

<a id="182" class="Keyword">module</a> <a id="189" href="Ledger.Conway.Specification.Chain.Properties.html" class="Module">Ledger.Conway.Specification.Chain.Properties</a>
  <a id="236" class="Symbol">(</a><a id="237" href="Ledger.Conway.Specification.Chain.Properties.html#237" class="Bound">txs</a> <a id="241" class="Symbol">:</a> <a id="243" class="Symbol">_)</a> <a id="246" class="Symbol">(</a><a id="247" class="Keyword">open</a> <a id="252" href="Ledger.Conway.Specification.Transaction.html#1000" class="Module">TransactionStructure</a> <a id="273" href="Ledger.Conway.Specification.Chain.Properties.html#237" class="Bound">txs</a><a id="276" class="Symbol">)</a>
  <a id="280" class="Symbol">(</a><a id="281" href="Ledger.Conway.Specification.Chain.Properties.html#281" class="Bound">abs</a> <a id="285" class="Symbol">:</a> <a id="287" href="Ledger.Conway.Specification.Abstract.html#654" class="Record">AbstractFunctions</a> <a id="305" href="Ledger.Conway.Specification.Chain.Properties.html#237" class="Bound">txs</a><a id="308" class="Symbol">)</a> <a id="310" class="Symbol">(</a><a id="311" class="Keyword">open</a> <a id="316" href="Ledger.Conway.Specification.Abstract.html#654" class="Module">AbstractFunctions</a> <a id="334" href="Ledger.Conway.Specification.Chain.Properties.html#281" class="Bound">abs</a><a id="337" class="Symbol">)</a>
  <a id="341" class="Keyword">where</a>
<a id="347" class="Keyword">open</a> <a id="352" class="Keyword">import</a> <a id="359" href="Ledger.Conway.Specification.BlockBody.Properties.html" class="Module">Ledger.Conway.Specification.BlockBody.Properties</a> <a id="408" href="Ledger.Conway.Specification.Chain.Properties.html#237" class="Bound">txs</a> <a id="412" href="Ledger.Conway.Specification.Chain.Properties.html#281" class="Bound">abs</a>
<a id="416" class="Keyword">open</a> <a id="421" class="Keyword">import</a> <a id="428" href="Ledger.Conway.Specification.Chain.html" class="Module">Ledger.Conway.Specification.Chain</a> <a id="462" href="Ledger.Conway.Specification.Chain.Properties.html#237" class="Bound">txs</a> <a id="466" href="Ledger.Conway.Specification.Chain.Properties.html#281" class="Bound">abs</a>
<a id="470" class="Keyword">open</a> <a id="475" class="Keyword">import</a> <a id="482" href="Ledger.Conway.Specification.Enact.html" class="Module">Ledger.Conway.Specification.Enact</a> <a id="516" href="Ledger.Conway.Specification.Transaction.html#2079" class="Function">govStructure</a> <a id="529" class="Keyword">using</a> <a id="535" class="Symbol">(</a><a id="536" href="Ledger.Conway.Specification.Enact.html#448" class="Record">EnactState</a><a id="546" class="Symbol">)</a>
<a id="548" class="Keyword">open</a> <a id="553" class="Keyword">import</a> <a id="560" href="Ledger.Conway.Specification.Epoch.html" class="Module">Ledger.Conway.Specification.Epoch</a> <a id="594" href="Ledger.Conway.Specification.Chain.Properties.html#237" class="Bound">txs</a> <a id="598" href="Ledger.Conway.Specification.Chain.Properties.html#281" class="Bound">abs</a>
<a id="602" class="Keyword">open</a> <a id="607" class="Keyword">import</a> <a id="614" href="Ledger.Conway.Specification.Epoch.Properties.html" class="Module">Ledger.Conway.Specification.Epoch.Properties</a> <a id="659" href="Ledger.Conway.Specification.Chain.Properties.html#237" class="Bound">txs</a> <a id="663" href="Ledger.Conway.Specification.Chain.Properties.html#281" class="Bound">abs</a>
<a id="667" class="Keyword">open</a> <a id="672" class="Keyword">import</a> <a id="679" href="Ledger.Conway.Specification.Ledger.html" class="Module">Ledger.Conway.Specification.Ledger</a> <a id="714" href="Ledger.Conway.Specification.Chain.Properties.html#237" class="Bound">txs</a> <a id="718" href="Ledger.Conway.Specification.Chain.Properties.html#281" class="Bound">abs</a>
<a id="722" class="Keyword">open</a> <a id="727" class="Keyword">import</a> <a id="734" href="Ledger.Conway.Specification.RewardUpdate.html" class="Module">Ledger.Conway.Specification.RewardUpdate</a> <a id="775" href="Ledger.Conway.Specification.Chain.Properties.html#237" class="Bound">txs</a> <a id="779" href="Ledger.Conway.Specification.Chain.Properties.html#281" class="Bound">abs</a>
<a id="783" class="Keyword">open</a> <a id="788" class="Keyword">import</a> <a id="795" href="Ledger.Conway.Specification.RewardUpdate.Properties.html" class="Module">Ledger.Conway.Specification.RewardUpdate.Properties</a> <a id="847" href="Ledger.Conway.Specification.Chain.Properties.html#237" class="Bound">txs</a> <a id="851" href="Ledger.Conway.Specification.Chain.Properties.html#281" class="Bound">abs</a>
<a id="855" class="Keyword">open</a> <a id="860" class="Keyword">import</a> <a id="867" href="Ledger.Prelude.html" class="Module">Ledger.Prelude</a>

<a id="883" class="Keyword">open</a> <a id="888" href="Interface.ComputationalRelation.html#2799" class="Module">Computational</a> <a id="902" class="Symbol">⦃...⦄</a>

<a id="909" class="Keyword">module</a> <a id="916" href="Ledger.Conway.Specification.Chain.Properties.html#916" class="Module">_</a>
  <a id="920" class="Symbol">(</a><a id="921" href="Ledger.Conway.Specification.Chain.Properties.html#921" class="Bound">nes</a> <a id="925" class="Symbol">:</a> <a id="927" href="Ledger.Conway.Specification.Epoch.html#3119" class="Record">NewEpochState</a><a id="940" class="Symbol">)</a>
  <a id="944" class="Symbol">(</a><a id="945" class="Keyword">open</a> <a id="950" href="Ledger.Conway.Specification.Epoch.html#1703" class="Module">EpochState</a> <a id="961" class="Symbol">(</a><a id="962" href="Ledger.Conway.Specification.Epoch.html#3240" class="Field">NewEpochState.epochState</a> <a id="987" href="Ledger.Conway.Specification.Chain.Properties.html#921" class="Bound">nes</a><a id="990" class="Symbol">)</a> <a id="992" class="Keyword">using</a> <a id="998" class="Symbol">(</a><a id="999" href="Ledger.Conway.Specification.Epoch.html#1820" class="Field">ls</a><a id="1001" class="Symbol">)</a> <a id="1003" class="Keyword">renaming</a> <a id="1012" class="Symbol">(</a><a id="1013" href="Ledger.Conway.Specification.Epoch.html#1844" class="Field">es</a> <a id="1016" class="Symbol">to</a> <a id="1019" class="Field">es&#39;</a><a id="1022" class="Symbol">))</a>
  <a id="1027" class="Symbol">(</a><a id="1028" class="Keyword">open</a> <a id="1033" href="Ledger.Conway.Specification.Enact.html#448" class="Module">EnactState</a> <a id="1044" href="Ledger.Conway.Specification.Chain.Properties.html#1019" class="Function">es&#39;</a> <a id="1048" class="Keyword">using</a> <a id="1054" class="Symbol">(</a><a id="1055" href="Ledger.Conway.Specification.Enact.html#658" class="Field">pparams</a><a id="1062" class="Symbol">))</a>
  <a id="1067" class="Symbol">(</a><a id="1068" class="Keyword">open</a> <a id="1073" href="Ledger.Conway.Specification.PParams.html#1685" class="Module">PParams</a> <a id="1081" href="Ledger.Prelude.html#2253" class="Function Operator">∣</a> <a id="1083" href="Ledger.Conway.Specification.Enact.html#658" class="Function">pparams</a> <a id="1091" href="Ledger.Prelude.html#2253" class="Function Operator">∣</a> <a id="1093" class="Keyword">using</a> <a id="1099" class="Symbol">(</a><a id="1100" href="Ledger.Conway.Specification.PParams.html#2597" class="Field">maxRefScriptSizePerBlock</a><a id="1124" class="Symbol">))</a>
  <a id="1129" class="Symbol">(</a><a id="1130" href="Ledger.Conway.Specification.Chain.Properties.html#1130" class="Bound">ts</a> <a id="1133" class="Symbol">:</a> <a id="1135" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="1140" href="Ledger.Conway.Specification.Transaction.html#4684" class="Record">Tx</a><a id="1142" class="Symbol">)</a>
  <a id="1146" class="Keyword">where</a>
  <a id="1154" href="Ledger.Conway.Specification.Chain.Properties.html#1154" class="Function">refScriptSize≤?Bound</a> <a id="1175" class="Symbol">:</a> <a id="1177" href="Relation.Nullary.Decidable.Core.html#1966" class="Record">Dec</a> <a id="1181" class="Symbol">(</a><a id="1182" href="Ledger.Conway.Specification.Chain.html#2183" class="Function">totalRefScriptsSize</a> <a id="1202" href="Ledger.Conway.Specification.Epoch.html#1820" class="Function">ls</a> <a id="1205" href="Ledger.Conway.Specification.Chain.Properties.html#1130" class="Bound">ts</a> <a id="1208" href="Class.HasOrder.Core.html#613" class="Field Operator">≤</a> <a id="1210" href="Ledger.Conway.Specification.PParams.html#2597" class="Function">maxRefScriptSizePerBlock</a><a id="1234" class="Symbol">)</a>
  <a id="1238" href="Ledger.Conway.Specification.Chain.Properties.html#1154" class="Function">refScriptSize≤?Bound</a> <a id="1259" class="Symbol">=</a> <a id="1261" href="Ledger.Conway.Specification.Chain.html#2183" class="Function">totalRefScriptsSize</a> <a id="1281" href="Ledger.Conway.Specification.Epoch.html#1820" class="Function">ls</a> <a id="1284" href="Ledger.Conway.Specification.Chain.Properties.html#1130" class="Bound">ts</a> <a id="1287" href="Class.HasOrder.Core.html#1016" class="Function Operator">≤?</a> <a id="1290" href="Ledger.Conway.Specification.PParams.html#2597" class="Function">maxRefScriptSizePerBlock</a>

<a id="1316" class="Keyword">instance</a>
  <a id="Computational-CHAIN"></a><a id="1327" href="Ledger.Conway.Specification.Chain.Properties.html#1327" class="Function">Computational-CHAIN</a> <a id="1347" class="Symbol">:</a> <a id="1349" href="Interface.ComputationalRelation.html#2799" class="Record">Computational</a> <a id="1363" href="Ledger.Conway.Specification.Chain.html#2378" class="Datatype Operator">_⊢_⇀⦇_,CHAIN⦈_</a> <a id="1378" href="Agda.Builtin.String.html#335" class="Postulate">String</a>
  <a id="1387" href="Ledger.Conway.Specification.Chain.Properties.html#1327" class="Function">Computational-CHAIN</a> <a id="1407" class="Symbol">.</a><a id="1408" href="Interface.ComputationalRelation.html#2879" class="Field">computeProof</a> <a id="1421" href="Ledger.Conway.Specification.Chain.Properties.html#1421" class="Bound">Γ</a> <a id="1423" href="Ledger.Conway.Specification.Chain.Properties.html#1423" class="Bound">s</a> <a id="1425" href="Ledger.Conway.Specification.Chain.Properties.html#1425" class="Bound">b</a> <a id="1427" class="Symbol">=</a> <a id="1429" class="Keyword">do</a>
    <a id="1436" href="Ledger.Conway.Specification.Chain.Properties.html#1436" class="Bound">nes</a> <a id="1440" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1442" href="Ledger.Conway.Specification.Chain.Properties.html#1442" class="Bound">tickStep</a> <a id="1451" href="Class.Monad.Core.html#337" class="Field Operator">←</a> <a id="1453" href="Class.Bifunctor.html#1045" class="Function">map₁</a> <a id="1458" href="Data.Empty.html#1069" class="Function">⊥-elim</a> <a id="1465" href="Function.Base.html#1993" class="Function Operator">$</a> <a id="1467" href="Interface.ComputationalRelation.html#2879" class="Field">computeProof</a> <a id="1480" class="Symbol">{</a><a id="1481" class="Argument">STS</a> <a id="1485" class="Symbol">=</a> <a id="1487" href="Ledger.Conway.Specification.RewardUpdate.html#1176" class="Datatype Operator">_⊢_⇀⦇_,TICK⦈_</a><a id="1500" class="Symbol">}</a> <a id="1502" class="Symbol">_</a> <a id="1504" class="Symbol">_</a> <a id="1506" class="Symbol">_</a>
    <a id="1512" class="Symbol">(_</a> <a id="1515" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1517" class="Symbol">_)</a> <a id="1520" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1522" href="Ledger.Conway.Specification.Chain.Properties.html#1522" class="Bound">bbStep</a> <a id="1529" href="Class.Monad.Core.html#337" class="Field Operator">←</a> <a id="1531" href="Interface.ComputationalRelation.html#2879" class="Field">computeProof</a> <a id="1544" class="Symbol">_</a> <a id="1546" class="Symbol">(</a><a id="1547" href="Ledger.Conway.Specification.Ledger.html#1173" class="Field">LStateOf</a> <a id="1556" href="Ledger.Conway.Specification.Chain.Properties.html#1436" class="Bound">nes</a> <a id="1560" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1562" href="Ledger.Conway.Specification.Chain.Properties.html#1436" class="Bound">nes</a> <a id="1566" class="Symbol">.</a><a id="1567" href="Ledger.Conway.Specification.Epoch.html#3211" class="Field">NewEpochState.bcur</a><a id="1585" class="Symbol">)</a> <a id="1587" href="Ledger.Conway.Specification.Chain.Properties.html#1425" class="Bound">b</a>
    <a id="1593" href="Function.Base.html#4061" class="Function Operator">case</a> <a id="1598" href="Ledger.Conway.Specification.Chain.Properties.html#1154" class="Function">refScriptSize≤?Bound</a> <a id="1619" href="Ledger.Conway.Specification.Chain.Properties.html#1436" class="Bound">nes</a> <a id="1623" class="Symbol">(</a><a id="1624" href="Ledger.Conway.Specification.Chain.Properties.html#1425" class="Bound">b</a> <a id="1626" class="Symbol">.</a><a id="1627" href="Ledger.Conway.Specification.BlockBody.html#752" class="Field">Block.ts</a><a id="1635" class="Symbol">)</a> <a id="1637" href="Function.Base.html#4061" class="Function Operator">of</a> <a id="1640" class="Symbol">λ</a> <a id="1642" class="Keyword">where</a>
      <a id="1654" class="Symbol">(</a><a id="1655" href="Relation.Nullary.Decidable.Core.html#2136" class="InductiveConstructor">no</a> <a id="1658" href="Ledger.Conway.Specification.Chain.Properties.html#1658" class="Bound">¬p</a><a id="1660" class="Symbol">)</a> <a id="1662" class="Symbol">→</a> <a id="1664" href="Interface.ComputationalRelation.html#348" class="InductiveConstructor">failure</a> <a id="1672" class="String">&quot;totalRefScriptsSize &gt; maxRefScriptSizePerBlock&quot;</a>
      <a id="1727" class="Symbol">(</a><a id="1728" href="Relation.Nullary.Decidable.Core.html#2099" class="InductiveConstructor">yes</a> <a id="1732" href="Ledger.Conway.Specification.Chain.Properties.html#1732" class="Bound">p</a><a id="1733" class="Symbol">)</a> <a id="1735" class="Symbol">→</a> <a id="1737" href="Interface.ComputationalRelation.html#308" class="InductiveConstructor">success</a> <a id="1745" class="Symbol">(_</a> <a id="1748" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1750" href="Ledger.Conway.Specification.Chain.html#2452" class="InductiveConstructor">CHAIN</a> <a id="1756" class="Symbol">(</a><a id="1757" href="Ledger.Conway.Specification.Chain.Properties.html#1732" class="Bound">p</a> <a id="1759" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1761" href="Ledger.Conway.Specification.Chain.Properties.html#1442" class="Bound">tickStep</a> <a id="1770" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1772" href="Ledger.Conway.Specification.Chain.Properties.html#1522" class="Bound">bbStep</a><a id="1778" class="Symbol">))</a>

  <a id="1784" href="Ledger.Conway.Specification.Chain.Properties.html#1327" class="Function">Computational-CHAIN</a> <a id="1804" class="Symbol">.</a><a id="1805" href="Interface.ComputationalRelation.html#3096" class="Field">completeness</a> <a id="1818" class="Symbol">_</a> <a id="1820" href="Ledger.Conway.Specification.Chain.Properties.html#1820" class="Bound">s</a> <a id="1822" href="Ledger.Conway.Specification.Chain.Properties.html#1822" class="Bound">b</a> <a id="1824" class="Symbol">_</a> <a id="1826" class="Symbol">(</a><a id="1827" href="Ledger.Conway.Specification.Chain.html#2452" class="InductiveConstructor">CHAIN</a> <a id="1833" class="Symbol">{</a><a id="1834" class="Argument">nes</a> <a id="1838" class="Symbol">=</a> <a id="1840" href="Ledger.Conway.Specification.Chain.Properties.html#1840" class="Bound">nes</a><a id="1843" class="Symbol">}</a> <a id="1845" class="Symbol">(</a><a id="1846" href="Ledger.Conway.Specification.Chain.Properties.html#1846" class="Bound">p</a> <a id="1848" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1850" href="Ledger.Conway.Specification.Chain.Properties.html#1850" class="Bound">tickStep</a> <a id="1859" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1861" href="Ledger.Conway.Specification.Chain.Properties.html#1861" class="Bound">bbStep</a><a id="1867" class="Symbol">))</a>
    <a id="1874" class="Keyword">with</a> <a id="1879" href="Interface.ComputationalRelation.html#4350" class="Function">recomputeProof</a> <a id="1894" href="Ledger.Conway.Specification.Chain.Properties.html#1850" class="Bound">tickStep</a> <a id="1903" class="Symbol">|</a> <a id="1905" href="Interface.ComputationalRelation.html#3096" class="Field">completeness</a> <a id="1918" class="Symbol">_</a> <a id="1920" class="Symbol">_</a> <a id="1922" class="Symbol">_</a> <a id="1924" class="Symbol">_</a> <a id="1926" href="Ledger.Conway.Specification.Chain.Properties.html#1850" class="Bound">tickStep</a>
  <a id="1937" class="Symbol">...</a> <a id="1941" class="Symbol">|</a> <a id="1943" href="Interface.ComputationalRelation.html#308" class="InductiveConstructor">success</a> <a id="1951" class="Symbol">_</a> <a id="1953" class="Symbol">|</a> <a id="1955" href="Agda.Builtin.Equality.html#207" class="InductiveConstructor">refl</a>
    <a id="1964" class="Keyword">with</a> <a id="1969" href="Interface.ComputationalRelation.html#4350" class="Function">recomputeProof</a> <a id="1984" class="Bound">bbStep</a> <a id="1991" class="Symbol">|</a> <a id="1993" href="Interface.ComputationalRelation.html#3096" class="Field">completeness</a> <a id="2006" class="Symbol">_</a> <a id="2008" class="Symbol">_</a> <a id="2010" class="Symbol">_</a> <a id="2012" class="Symbol">_</a> <a id="2014" class="Bound">bbStep</a>
  <a id="2023" class="Symbol">...</a> <a id="2027" class="Symbol">|</a> <a id="2029" href="Interface.ComputationalRelation.html#308" class="InductiveConstructor">success</a> <a id="2037" class="Symbol">_</a> <a id="2039" class="Symbol">|</a> <a id="2041" href="Agda.Builtin.Equality.html#207" class="InductiveConstructor">refl</a>
    <a id="2050" class="Keyword">with</a> <a id="2055" href="Ledger.Conway.Specification.Chain.Properties.html#1154" class="Function">refScriptSize≤?Bound</a> <a id="2076" class="Bound">nes</a> <a id="2080" class="Symbol">(</a><a id="2081" href="Ledger.Conway.Specification.BlockBody.html#752" class="Field">Block.ts</a> <a id="2090" class="Bound">b</a><a id="2091" class="Symbol">)</a>
  <a id="2095" class="Symbol">...</a> <a id="2099" class="Symbol">|</a> <a id="2101" href="Relation.Nullary.Decidable.Core.html#2099" class="InductiveConstructor">yes</a> <a id="2105" href="Ledger.Conway.Specification.Chain.Properties.html#2105" class="Bound">p</a> <a id="2107" class="Symbol">=</a> <a id="2109" href="Agda.Builtin.Equality.html#207" class="InductiveConstructor">refl</a>
  <a id="2116" class="Symbol">...</a> <a id="2120" class="Symbol">|</a> <a id="2122" href="Relation.Nullary.Decidable.Core.html#2136" class="InductiveConstructor">no</a> <a id="2125" href="Ledger.Conway.Specification.Chain.Properties.html#2125" class="Bound">¬p</a> <a id="2128" class="Symbol">=</a> <a id="2130" href="Data.Empty.html#1069" class="Function">⊥-elim</a> <a id="2137" class="Symbol">(</a><a id="2138" href="Ledger.Conway.Specification.Chain.Properties.html#2125" class="Bound">¬p</a> <a id="2141" class="Bound">p</a><a id="2142" class="Symbol">)</a>
</pre></body></html>