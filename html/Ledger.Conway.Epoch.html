<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>Ledger.Conway.Epoch</title><link rel="stylesheet" href="Agda.css"></head><body><pre class="Agda">
<a id="2" class="Symbol">{-#</a> <a id="6" class="Keyword">OPTIONS</a> <a id="14" class="Pragma">--safe</a> <a id="21" class="Symbol">#-}</a>

<a id="26" class="Keyword">open</a> <a id="31" class="Keyword">import</a> <a id="38" href="Data.Integer.html" class="Module">Data.Integer</a> <a id="51" class="Keyword">using</a> <a id="57" class="Symbol">()</a> <a id="60" class="Keyword">renaming</a> <a id="69" class="Symbol">(</a><a id="70" href="Agda.Builtin.Int.html#263" class="InductiveConstructor">+_</a> <a id="73" class="Symbol">to</a> <a id="76" class="InductiveConstructor">pos</a><a id="79" class="Symbol">)</a>
<a id="81" class="Keyword">import</a>      <a id="93" href="Data.Integer.html" class="Module">Data.Integer</a> <a id="106" class="Symbol">as</a> <a id="109" class="Module">ℤ</a>
<a id="111" class="Keyword">open</a> <a id="116" class="Keyword">import</a> <a id="123" href="Data.Integer.Properties.html" class="Module">Data.Integer.Properties</a> <a id="147" class="Keyword">using</a> <a id="153" class="Symbol">(</a><a id="154" class="Keyword">module</a> <a id="161" href="Data.Integer.Properties.html#11677" class="Module">≤-Reasoning</a><a id="172" class="Symbol">;</a> <a id="174" href="Data.Integer.Properties.html#34659" class="Function">+-mono-≤</a><a id="182" class="Symbol">;</a> <a id="184" href="Data.Integer.Properties.html#13094" class="Function">neg-mono-≤</a><a id="194" class="Symbol">;</a> <a id="196" href="Data.Integer.Properties.html#26896" class="Function">+-identityˡ</a><a id="207" class="Symbol">)</a>
                                    <a id="245" class="Keyword">renaming</a> <a id="254" class="Symbol">(</a><a id="255" href="Data.Integer.Properties.html#12304" class="Function">nonNegative⁻¹</a> <a id="269" class="Symbol">to</a> <a id="272" class="Function">nonNegative⁻¹ℤ</a><a id="286" class="Symbol">)</a>
<a id="288" class="Keyword">open</a> <a id="293" class="Keyword">import</a> <a id="300" href="Data.Nat.GeneralisedArithmetic.html" class="Module">Data.Nat.GeneralisedArithmetic</a> <a id="331" class="Keyword">using</a> <a id="337" class="Symbol">(</a><a id="338" href="Data.Nat.GeneralisedArithmetic.html#866" class="Function">iterate</a><a id="345" class="Symbol">)</a>
<a id="347" class="Keyword">open</a> <a id="352" class="Keyword">import</a> <a id="359" href="Data.Rational.html" class="Module">Data.Rational</a> <a id="373" class="Keyword">using</a> <a id="379" class="Symbol">(</a><a id="380" href="Data.Rational.Base.html#1342" class="Record">ℚ</a><a id="381" class="Symbol">;</a> <a id="383" href="Data.Rational.Base.html#7116" class="Function">floor</a><a id="388" class="Symbol">;</a> <a id="390" href="Data.Rational.Base.html#6315" class="Function Operator">_*_</a><a id="393" class="Symbol">;</a> <a id="395" href="Data.Rational.Base.html#6708" class="Function Operator">_÷_</a><a id="398" class="Symbol">;</a> <a id="400" href="Data.Rational.Base.html#3884" class="Function Operator">_/_</a><a id="403" class="Symbol">;</a> <a id="405" href="Data.Rational.Base.html#6854" class="Function Operator">_⊓_</a><a id="408" class="Symbol">;</a> <a id="410" href="Data.Rational.Properties.html#3910" class="Function Operator">_≟_</a><a id="413" class="Symbol">;</a> <a id="415" href="Data.Rational.Base.html#4892" class="Function">≢-nonZero</a><a id="424" class="Symbol">)</a>
<a id="426" class="Keyword">open</a> <a id="431" class="Keyword">import</a> <a id="438" href="Data.Rational.Literals.html" class="Module">Data.Rational.Literals</a> <a id="461" class="Keyword">using</a> <a id="467" class="Symbol">(</a><a id="468" href="Data.Rational.Literals.html#740" class="Function">number</a><a id="474" class="Symbol">;</a> <a id="476" href="Data.Rational.Literals.html#613" class="Function">fromℤ</a><a id="481" class="Symbol">)</a>
<a id="483" class="Keyword">open</a> <a id="488" class="Keyword">import</a> <a id="495" href="Data.Rational.Properties.html" class="Module">Data.Rational.Properties</a> <a id="520" class="Keyword">using</a> <a id="526" class="Symbol">(</a><a id="527" href="Data.Rational.Properties.html#26823" class="Function">nonNegative⁻¹</a><a id="540" class="Symbol">;</a> <a id="542" href="Data.Rational.Properties.html#7313" class="Function">pos⇒nonNeg</a><a id="552" class="Symbol">;</a> <a id="554" href="Algebra.Construct.NaturalChoice.MinOp.html#7026" class="Function">⊓-glb</a><a id="559" class="Symbol">)</a>
<a id="561" class="Keyword">open</a> <a id="566" class="Keyword">import</a> <a id="573" href="stdlib.Data.Rational.Properties.html" class="Module">stdlib.Data.Rational.Properties</a> <a id="605" class="Keyword">using</a> <a id="611" class="Symbol">(</a><a id="612" href="stdlib.Data.Rational.Properties.html#1631" class="Function">0≤⇒0≤floor</a><a id="622" class="Symbol">;</a> <a id="624" href="stdlib.Data.Rational.Properties.html#2865" class="Function">÷-0≤⇒0≤</a><a id="631" class="Symbol">;</a> <a id="633" href="stdlib.Data.Rational.Properties.html#2275" class="Function">fromℕ-0≤</a><a id="641" class="Symbol">;</a> <a id="643" href="stdlib.Data.Rational.Properties.html#2409" class="Function">*-0≤⇒0≤</a><a id="650" class="Symbol">;</a> <a id="652" href="stdlib.Data.Rational.Properties.html#2013" class="Function">fromℤ-0≤</a><a id="660" class="Symbol">)</a>

<a id="663" class="Keyword">open</a> <a id="668" class="Keyword">import</a> <a id="675" href="Data.Integer.Tactic.RingSolver.html" class="Module">Data.Integer.Tactic.RingSolver</a> <a id="706" class="Keyword">using</a> <a id="712" class="Symbol">(</a><a id="713" href="Data.Integer.Tactic.RingSolver.html#1112" class="Function">solve-∀</a><a id="720" class="Symbol">)</a>

<a id="723" class="Keyword">open</a> <a id="728" class="Keyword">import</a> <a id="735" href="Agda.Builtin.FromNat.html" class="Module">Agda.Builtin.FromNat</a>

<a id="757" class="Keyword">open</a> <a id="762" class="Keyword">import</a> <a id="769" href="Ledger.Prelude.html" class="Module">Ledger.Prelude</a> <a id="784" class="Keyword">hiding</a> <a id="791" class="Symbol">(</a><a id="792" href="Data.List.Base.html#5412" class="Function">iterate</a><a id="799" class="Symbol">;</a> <a id="801" href="Data.Nat.Base.html#7102" class="Function Operator">_/_</a><a id="804" class="Symbol">;</a> <a id="806" href="Agda.Builtin.Nat.html#539" class="Primitive Operator">_*_</a><a id="809" class="Symbol">;</a> <a id="811" href="Data.Nat.Base.html#5851" class="Function Operator">_⊓_</a><a id="814" class="Symbol">;</a> <a id="816" href="Class.DecEq.Core.html#159" class="Field Operator">_≟_</a><a id="819" class="Symbol">;</a> <a id="821" href="Data.Nat.Base.html#3425" class="Function">≢-nonZero</a><a id="830" class="Symbol">)</a>
<a id="832" class="Keyword">open</a> <a id="837" href="Ledger.Prelude.html#2677" class="Module">Filter</a> <a id="844" class="Keyword">using</a> <a id="850" class="Symbol">(</a><a id="851" href="Ledger.Prelude.html#2692" class="Function">filter</a><a id="857" class="Symbol">)</a>
<a id="859" class="Keyword">open</a> <a id="864" class="Keyword">import</a> <a id="871" href="Ledger.Conway.Abstract.html" class="Module">Ledger.Conway.Abstract</a>
<a id="894" class="Keyword">open</a> <a id="899" class="Keyword">import</a> <a id="906" href="Ledger.Conway.Transaction.html" class="Module">Ledger.Conway.Transaction</a>
<a id="932" class="Keyword">open</a> <a id="937" class="Keyword">import</a> <a id="944" href="Ledger.Conway.Types.Numeric.UnitInterval.html" class="Module">Ledger.Conway.Types.Numeric.UnitInterval</a>

<a id="986" class="Keyword">open</a> <a id="991" href="Agda.Builtin.FromNat.html#196" class="Module">Number</a> <a id="998" href="Data.Rational.Literals.html#740" class="Function">number</a> <a id="1005" class="Keyword">renaming</a> <a id="1014" class="Symbol">(</a><a id="1015" href="Agda.Builtin.FromNat.html#281" class="Field">fromNat</a> <a id="1023" class="Symbol">to</a> <a id="1026" class="Field">fromℕ</a><a id="1031" class="Symbol">)</a>

<a id="1034" class="Keyword">module</a> <a id="1041" href="Ledger.Conway.Epoch.html" class="Module">Ledger.Conway.Epoch</a>
  <a id="1063" class="Symbol">(</a><a id="1064" href="Ledger.Conway.Epoch.html#1064" class="Bound">txs</a> <a id="1068" class="Symbol">:</a> <a id="1070" class="Symbol">_)</a> <a id="1073" class="Symbol">(</a><a id="1074" class="Keyword">open</a> <a id="1079" href="Ledger.Conway.Transaction.html#910" class="Module">TransactionStructure</a> <a id="1100" href="Ledger.Conway.Epoch.html#1064" class="Bound">txs</a><a id="1103" class="Symbol">)</a>
  <a id="1107" class="Symbol">(</a><a id="1108" href="Ledger.Conway.Epoch.html#1108" class="Bound">abs</a> <a id="1112" class="Symbol">:</a> <a id="1114" href="Ledger.Conway.Abstract.html#599" class="Record">AbstractFunctions</a> <a id="1132" href="Ledger.Conway.Epoch.html#1064" class="Bound">txs</a><a id="1135" class="Symbol">)</a> <a id="1137" class="Symbol">(</a><a id="1138" class="Keyword">open</a> <a id="1143" href="Ledger.Conway.Abstract.html#599" class="Module">AbstractFunctions</a> <a id="1161" href="Ledger.Conway.Epoch.html#1108" class="Bound">abs</a><a id="1164" class="Symbol">)</a>
  <a id="1168" class="Keyword">where</a>

<a id="1175" class="Keyword">open</a> <a id="1180" class="Keyword">import</a> <a id="1187" href="Ledger.Conway.Certs.html" class="Module">Ledger.Conway.Certs</a> <a id="1207" href="Ledger.Conway.Transaction.html#1880" class="Function">govStructure</a>
<a id="1220" class="Keyword">open</a> <a id="1225" class="Keyword">import</a> <a id="1232" href="Ledger.Conway.Enact.html" class="Module">Ledger.Conway.Enact</a> <a id="1252" href="Ledger.Conway.Transaction.html#1880" class="Function">govStructure</a>
<a id="1265" class="Keyword">open</a> <a id="1270" class="Keyword">import</a> <a id="1277" href="Ledger.Conway.Gov.html" class="Module">Ledger.Conway.Gov</a> <a id="1295" href="Ledger.Conway.Epoch.html#1064" class="Bound">txs</a>
<a id="1299" class="Keyword">open</a> <a id="1304" class="Keyword">import</a> <a id="1311" href="Ledger.Conway.Ledger.html" class="Module">Ledger.Conway.Ledger</a> <a id="1332" href="Ledger.Conway.Epoch.html#1064" class="Bound">txs</a> <a id="1336" href="Ledger.Conway.Epoch.html#1108" class="Bound">abs</a>
<a id="1340" class="Keyword">open</a> <a id="1345" class="Keyword">import</a> <a id="1352" href="Ledger.Conway.Ratify.html" class="Module">Ledger.Conway.Ratify</a> <a id="1373" href="Ledger.Conway.Epoch.html#1064" class="Bound">txs</a>
<a id="1377" class="Keyword">open</a> <a id="1382" class="Keyword">import</a> <a id="1389" href="Ledger.Conway.Rewards.html" class="Module">Ledger.Conway.Rewards</a> <a id="1411" href="Ledger.Conway.Epoch.html#1064" class="Bound">txs</a> <a id="1415" href="Ledger.Conway.Epoch.html#1108" class="Bound">abs</a>
<a id="1419" class="Keyword">open</a> <a id="1424" class="Keyword">import</a> <a id="1431" href="Ledger.Conway.Utxo.html" class="Module">Ledger.Conway.Utxo</a> <a id="1450" href="Ledger.Conway.Epoch.html#1064" class="Bound">txs</a> <a id="1454" href="Ledger.Conway.Epoch.html#1108" class="Bound">abs</a>




<a id="1462" class="Keyword">record</a> <a id="EpochState"></a><a id="1469" href="Ledger.Conway.Epoch.html#1469" class="Record">EpochState</a> <a id="1480" class="Symbol">:</a> <a id="1482" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="1487" class="Keyword">where</a>


  <a id="1497" class="Keyword">constructor</a> <a id="⟦_,_,_,_,_⟧ᵉ&#39;"></a><a id="1509" href="Ledger.Conway.Epoch.html#1509" class="InductiveConstructor Operator">⟦_,_,_,_,_⟧ᵉ&#39;</a>


  <a id="1527" class="Keyword">field</a>
    <a id="EpochState.acnt"></a><a id="1537" href="Ledger.Conway.Epoch.html#1537" class="Field">acnt</a>       <a id="1548" class="Symbol">:</a> <a id="1550" href="Ledger.Conway.PParams.html#709" class="Record">Acnt</a>
    <a id="EpochState.ss"></a><a id="1559" href="Ledger.Conway.Epoch.html#1559" class="Field">ss</a>         <a id="1570" class="Symbol">:</a> <a id="1572" href="Ledger.Conway.Rewards.html#6655" class="Record">Snapshots</a>
    <a id="EpochState.ls"></a><a id="1586" href="Ledger.Conway.Epoch.html#1586" class="Field">ls</a>         <a id="1597" class="Symbol">:</a> <a id="1599" href="Ledger.Conway.Ledger.html#865" class="Record">LState</a>
    <a id="EpochState.es"></a><a id="1610" href="Ledger.Conway.Epoch.html#1610" class="Field">es</a>         <a id="1621" class="Symbol">:</a> <a id="1623" href="Ledger.Conway.Enact.html#418" class="Record">EnactState</a>
    <a id="EpochState.fut"></a><a id="1638" href="Ledger.Conway.Epoch.html#1638" class="Field">fut</a>        <a id="1649" class="Symbol">:</a> <a id="1651" href="Ledger.Conway.Ratify.html#3314" class="Record">RatifyState</a>



<a id="1666" class="Keyword">record</a> <a id="HasEpochState"></a><a id="1673" href="Ledger.Conway.Epoch.html#1673" class="Record">HasEpochState</a> <a id="1687" class="Symbol">{</a><a id="1688" href="Ledger.Conway.Epoch.html#1688" class="Bound">a</a><a id="1689" class="Symbol">}</a> <a id="1691" class="Symbol">(</a><a id="1692" href="Ledger.Conway.Epoch.html#1692" class="Bound">A</a> <a id="1694" class="Symbol">:</a> <a id="1696" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="1701" href="Ledger.Conway.Epoch.html#1688" class="Bound">a</a><a id="1702" class="Symbol">)</a> <a id="1704" class="Symbol">:</a> <a id="1706" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="1711" href="Ledger.Conway.Epoch.html#1688" class="Bound">a</a> <a id="1713" class="Keyword">where</a>
  <a id="1721" class="Keyword">field</a> <a id="HasEpochState.EpochStateOf"></a><a id="1727" href="Ledger.Conway.Epoch.html#1727" class="Field">EpochStateOf</a> <a id="1740" class="Symbol">:</a> <a id="1742" href="Ledger.Conway.Epoch.html#1692" class="Bound">A</a> <a id="1744" class="Symbol">→</a> <a id="1746" href="Ledger.Conway.Epoch.html#1469" class="Record">EpochState</a>
<a id="1757" class="Keyword">open</a> <a id="1762" href="Ledger.Conway.Epoch.html#1673" class="Module">HasEpochState</a> <a id="1776" class="Symbol">⦃...⦄</a> <a id="1782" class="Keyword">public</a>

<a id="1790" class="Keyword">instance</a>
  <a id="HasLState-EpochState"></a><a id="1801" href="Ledger.Conway.Epoch.html#1801" class="Function">HasLState-EpochState</a> <a id="1822" class="Symbol">:</a> <a id="1824" href="Ledger.Conway.Ledger.html#1010" class="Record">HasLState</a> <a id="1834" href="Ledger.Conway.Epoch.html#1469" class="Record">EpochState</a>
  <a id="1847" href="Ledger.Conway.Epoch.html#1801" class="Function">HasLState-EpochState</a> <a id="1868" class="Symbol">.</a><a id="1869" href="Ledger.Conway.Ledger.html#1060" class="Field">LStateOf</a> <a id="1878" class="Symbol">=</a> <a id="1880" href="Ledger.Conway.Epoch.html#1586" class="Field">EpochState.ls</a>

  <a id="HasEnactState-EpochState"></a><a id="1897" href="Ledger.Conway.Epoch.html#1897" class="Function">HasEnactState-EpochState</a> <a id="1922" class="Symbol">:</a> <a id="1924" href="Ledger.Conway.Enact.html#710" class="Record">HasEnactState</a> <a id="1938" href="Ledger.Conway.Epoch.html#1469" class="Record">EpochState</a>
  <a id="1951" href="Ledger.Conway.Epoch.html#1897" class="Function">HasEnactState-EpochState</a> <a id="1976" class="Symbol">.</a><a id="1977" href="Ledger.Conway.Enact.html#764" class="Field">EnactStateOf</a> <a id="1990" class="Symbol">=</a> <a id="1992" href="Ledger.Conway.Epoch.html#1610" class="Field">EpochState.es</a>

  <a id="HasDeposits-EpochState"></a><a id="2009" href="Ledger.Conway.Epoch.html#2009" class="Function">HasDeposits-EpochState</a> <a id="2032" class="Symbol">:</a> <a id="2034" href="Ledger.Conway.Certs.html#705" class="Record">HasDeposits</a> <a id="2046" href="Ledger.Conway.Epoch.html#1469" class="Record">EpochState</a>
  <a id="2059" href="Ledger.Conway.Epoch.html#2009" class="Function">HasDeposits-EpochState</a> <a id="2082" class="Symbol">.</a><a id="2083" href="Ledger.Conway.Certs.html#757" class="Field">DepositsOf</a> <a id="2094" class="Symbol">=</a> <a id="2096" href="Ledger.Conway.Certs.html#757" class="Field">DepositsOf</a> <a id="2107" href="Function.Base.html#1115" class="Function Operator">∘</a> <a id="2109" href="Ledger.Conway.Ledger.html#1060" class="Field">LStateOf</a>

  <a id="Hastreasury-EpochState"></a><a id="2121" href="Ledger.Conway.Epoch.html#2121" class="Function">Hastreasury-EpochState</a> <a id="2144" class="Symbol">:</a> <a id="2146" href="Ledger.Conway.PParams.html#797" class="Record">Hastreasury</a> <a id="2158" href="Ledger.Conway.Epoch.html#1469" class="Record">EpochState</a>
  <a id="2171" href="Ledger.Conway.Epoch.html#2121" class="Function">Hastreasury-EpochState</a> <a id="2194" class="Symbol">.</a><a id="2195" href="Ledger.Conway.PParams.html#849" class="Field">treasuryOf</a> <a id="2206" class="Symbol">=</a> <a id="2208" href="Ledger.Conway.PParams.html#764" class="Field">Acnt.treasury</a> <a id="2222" href="Function.Base.html#1115" class="Function Operator">∘</a> <a id="2224" href="Ledger.Conway.Epoch.html#1537" class="Field">EpochState.acnt</a>

  <a id="Hasreserves-EpochState"></a><a id="2243" href="Ledger.Conway.Epoch.html#2243" class="Function">Hasreserves-EpochState</a> <a id="2266" class="Symbol">:</a> <a id="2268" href="Ledger.Conway.PParams.html#909" class="Record">Hasreserves</a> <a id="2280" href="Ledger.Conway.Epoch.html#1469" class="Record">EpochState</a>
  <a id="2293" href="Ledger.Conway.Epoch.html#2243" class="Function">Hasreserves-EpochState</a> <a id="2316" class="Symbol">.</a><a id="2317" href="Ledger.Conway.PParams.html#961" class="Field">reservesOf</a> <a id="2328" class="Symbol">=</a> <a id="2330" href="Ledger.Conway.PParams.html#773" class="Field">Acnt.reserves</a> <a id="2344" href="Function.Base.html#1115" class="Function Operator">∘</a> <a id="2346" href="Ledger.Conway.Epoch.html#1537" class="Field">EpochState.acnt</a>

  <a id="HasPParams-EpochState"></a><a id="2365" href="Ledger.Conway.Epoch.html#2365" class="Function">HasPParams-EpochState</a> <a id="2387" class="Symbol">:</a> <a id="2389" href="Ledger.Conway.PParams.html#3520" class="Record">HasPParams</a> <a id="2400" href="Ledger.Conway.Epoch.html#1469" class="Record">EpochState</a>
  <a id="2413" href="Ledger.Conway.Epoch.html#2365" class="Function">HasPParams-EpochState</a> <a id="2435" class="Symbol">.</a><a id="2436" href="Ledger.Conway.PParams.html#3571" class="Field">PParamsOf</a> <a id="2446" class="Symbol">=</a> <a id="2448" href="Ledger.Conway.PParams.html#3571" class="Field">PParamsOf</a> <a id="2458" href="Function.Base.html#1115" class="Function Operator">∘</a> <a id="2460" href="Ledger.Conway.Enact.html#764" class="Field">EnactStateOf</a>



<a id="2476" class="Keyword">record</a> <a id="NewEpochState"></a><a id="2483" href="Ledger.Conway.Epoch.html#2483" class="Record">NewEpochState</a> <a id="2497" class="Symbol">:</a> <a id="2499" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="2504" class="Keyword">where</a>
  <a id="2512" class="Keyword">field</a>
    <a id="NewEpochState.lastEpoch"></a><a id="2522" href="Ledger.Conway.Epoch.html#2522" class="Field">lastEpoch</a>   <a id="2534" class="Symbol">:</a> <a id="2536" href="Ledger.Conway.Types.Epoch.html#592" class="Function">Epoch</a>
    <a id="NewEpochState.epochState"></a><a id="2546" href="Ledger.Conway.Epoch.html#2546" class="Field">epochState</a>  <a id="2558" class="Symbol">:</a> <a id="2560" href="Ledger.Conway.Epoch.html#1469" class="Record">EpochState</a>
    <a id="NewEpochState.ru"></a><a id="2575" href="Ledger.Conway.Epoch.html#2575" class="Field">ru</a>          <a id="2587" class="Symbol">:</a> <a id="2589" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="2595" href="Ledger.Conway.Rewards.html#5689" class="Record">RewardUpdate</a>


<a id="2610" class="Keyword">record</a> <a id="HasNewEpochState"></a><a id="2617" href="Ledger.Conway.Epoch.html#2617" class="Record">HasNewEpochState</a> <a id="2634" class="Symbol">{</a><a id="2635" href="Ledger.Conway.Epoch.html#2635" class="Bound">a</a><a id="2636" class="Symbol">}</a> <a id="2638" class="Symbol">(</a><a id="2639" href="Ledger.Conway.Epoch.html#2639" class="Bound">A</a> <a id="2641" class="Symbol">:</a> <a id="2643" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="2648" href="Ledger.Conway.Epoch.html#2635" class="Bound">a</a><a id="2649" class="Symbol">)</a> <a id="2651" class="Symbol">:</a> <a id="2653" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="2658" href="Ledger.Conway.Epoch.html#2635" class="Bound">a</a> <a id="2660" class="Keyword">where</a>
  <a id="2668" class="Keyword">field</a> <a id="HasNewEpochState.NewEpochStateOf"></a><a id="2674" href="Ledger.Conway.Epoch.html#2674" class="Field">NewEpochStateOf</a> <a id="2690" class="Symbol">:</a> <a id="2692" href="Ledger.Conway.Epoch.html#2639" class="Bound">A</a> <a id="2694" class="Symbol">→</a> <a id="2696" href="Ledger.Conway.Epoch.html#2483" class="Record">NewEpochState</a>
<a id="2710" class="Keyword">open</a> <a id="2715" href="Ledger.Conway.Epoch.html#2617" class="Module">HasNewEpochState</a> <a id="2732" class="Symbol">⦃...⦄</a> <a id="2738" class="Keyword">public</a>
<a id="2745" class="Keyword">record</a> <a id="HasLastEpoch"></a><a id="2752" href="Ledger.Conway.Epoch.html#2752" class="Record">HasLastEpoch</a>     <a id="2769" class="Symbol">{</a><a id="2770" href="Ledger.Conway.Epoch.html#2770" class="Bound">a</a><a id="2771" class="Symbol">}</a> <a id="2773" class="Symbol">(</a><a id="2774" href="Ledger.Conway.Epoch.html#2774" class="Bound">A</a> <a id="2776" class="Symbol">:</a> <a id="2778" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="2783" href="Ledger.Conway.Epoch.html#2770" class="Bound">a</a><a id="2784" class="Symbol">)</a> <a id="2786" class="Symbol">:</a> <a id="2788" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="2793" href="Ledger.Conway.Epoch.html#2770" class="Bound">a</a> <a id="2795" class="Keyword">where</a> <a id="2801" class="Keyword">field</a> <a id="HasLastEpoch.LastEpochOf"></a><a id="2807" href="Ledger.Conway.Epoch.html#2807" class="Field">LastEpochOf</a>     <a id="2823" class="Symbol">:</a> <a id="2825" href="Ledger.Conway.Epoch.html#2774" class="Bound">A</a> <a id="2827" class="Symbol">→</a> <a id="2829" href="Ledger.Conway.Types.Epoch.html#592" class="Function">Epoch</a>
<a id="2835" class="Keyword">open</a> <a id="2840" href="Ledger.Conway.Epoch.html#2752" class="Module">HasLastEpoch</a>     <a id="2857" class="Symbol">⦃...⦄</a> <a id="2863" class="Keyword">public</a>

<a id="2871" class="Keyword">instance</a>
  <a id="HasLastEpoch-NewEpochState"></a><a id="2882" href="Ledger.Conway.Epoch.html#2882" class="Function">HasLastEpoch-NewEpochState</a> <a id="2909" class="Symbol">:</a> <a id="2911" href="Ledger.Conway.Epoch.html#2752" class="Record">HasLastEpoch</a> <a id="2924" href="Ledger.Conway.Epoch.html#2483" class="Record">NewEpochState</a>
  <a id="2940" href="Ledger.Conway.Epoch.html#2882" class="Function">HasLastEpoch-NewEpochState</a> <a id="2967" class="Symbol">.</a><a id="2968" href="Ledger.Conway.Epoch.html#2807" class="Field">LastEpochOf</a> <a id="2980" class="Symbol">=</a> <a id="2982" href="Ledger.Conway.Epoch.html#2522" class="Field">NewEpochState.lastEpoch</a>

  <a id="HasEpochState-NewEpochState"></a><a id="3009" href="Ledger.Conway.Epoch.html#3009" class="Function">HasEpochState-NewEpochState</a> <a id="3037" class="Symbol">:</a> <a id="3039" href="Ledger.Conway.Epoch.html#1673" class="Record">HasEpochState</a> <a id="3053" href="Ledger.Conway.Epoch.html#2483" class="Record">NewEpochState</a>
  <a id="3069" href="Ledger.Conway.Epoch.html#3009" class="Function">HasEpochState-NewEpochState</a> <a id="3097" class="Symbol">.</a><a id="3098" href="Ledger.Conway.Epoch.html#1727" class="Field">EpochStateOf</a> <a id="3111" class="Symbol">=</a> <a id="3113" href="Ledger.Conway.Epoch.html#2546" class="Field">NewEpochState.epochState</a>

  <a id="Hastreasury-NewEpochState"></a><a id="3141" href="Ledger.Conway.Epoch.html#3141" class="Function">Hastreasury-NewEpochState</a> <a id="3167" class="Symbol">:</a> <a id="3169" href="Ledger.Conway.PParams.html#797" class="Record">Hastreasury</a> <a id="3181" href="Ledger.Conway.Epoch.html#2483" class="Record">NewEpochState</a>
  <a id="3197" href="Ledger.Conway.Epoch.html#3141" class="Function">Hastreasury-NewEpochState</a> <a id="3223" class="Symbol">.</a><a id="3224" href="Ledger.Conway.PParams.html#849" class="Field">treasuryOf</a> <a id="3235" class="Symbol">=</a> <a id="3237" href="Ledger.Conway.PParams.html#849" class="Field">treasuryOf</a> <a id="3248" href="Function.Base.html#1115" class="Function Operator">∘</a> <a id="3250" href="Ledger.Conway.Epoch.html#1727" class="Field">EpochStateOf</a>

  <a id="HasLState-NewEpochState"></a><a id="3266" href="Ledger.Conway.Epoch.html#3266" class="Function">HasLState-NewEpochState</a> <a id="3290" class="Symbol">:</a> <a id="3292" href="Ledger.Conway.Ledger.html#1010" class="Record">HasLState</a> <a id="3302" href="Ledger.Conway.Epoch.html#2483" class="Record">NewEpochState</a>
  <a id="3318" href="Ledger.Conway.Epoch.html#3266" class="Function">HasLState-NewEpochState</a> <a id="3342" class="Symbol">.</a><a id="3343" href="Ledger.Conway.Ledger.html#1060" class="Field">LStateOf</a> <a id="3352" class="Symbol">=</a> <a id="3354" href="Ledger.Conway.Ledger.html#1060" class="Field">LStateOf</a> <a id="3363" href="Function.Base.html#1115" class="Function Operator">∘</a> <a id="3365" href="Ledger.Conway.Epoch.html#1727" class="Field">EpochStateOf</a>

  <a id="HasGovState-NewEpochState"></a><a id="3381" href="Ledger.Conway.Epoch.html#3381" class="Function">HasGovState-NewEpochState</a> <a id="3407" class="Symbol">:</a> <a id="3409" href="Ledger.Conway.Gov.html#1471" class="Record">HasGovState</a> <a id="3421" href="Ledger.Conway.Epoch.html#2483" class="Record">NewEpochState</a>
  <a id="3437" href="Ledger.Conway.Epoch.html#3381" class="Function">HasGovState-NewEpochState</a> <a id="3463" class="Symbol">.</a><a id="3464" href="Ledger.Conway.Gov.html#1523" class="Field">GovStateOf</a> <a id="3475" class="Symbol">=</a> <a id="3477" href="Ledger.Conway.Gov.html#1523" class="Field">GovStateOf</a> <a id="3488" href="Function.Base.html#1115" class="Function Operator">∘</a> <a id="3490" href="Ledger.Conway.Ledger.html#1060" class="Field">LStateOf</a>

  <a id="HasCertState-NewEpochState"></a><a id="3502" href="Ledger.Conway.Epoch.html#3502" class="Function">HasCertState-NewEpochState</a> <a id="3529" class="Symbol">:</a> <a id="3531" href="Ledger.Conway.Certs.html#4483" class="Record">HasCertState</a> <a id="3544" href="Ledger.Conway.Epoch.html#2483" class="Record">NewEpochState</a>
  <a id="3560" href="Ledger.Conway.Epoch.html#3502" class="Function">HasCertState-NewEpochState</a> <a id="3587" class="Symbol">.</a><a id="3588" href="Ledger.Conway.Certs.html#4536" class="Field">CertStateOf</a> <a id="3600" class="Symbol">=</a> <a id="3602" href="Ledger.Conway.Certs.html#4536" class="Field">CertStateOf</a> <a id="3614" href="Function.Base.html#1115" class="Function Operator">∘</a> <a id="3616" href="Ledger.Conway.Ledger.html#1060" class="Field">LStateOf</a>

  <a id="HasDReps-NewEpochState"></a><a id="3628" href="Ledger.Conway.Epoch.html#3628" class="Function">HasDReps-NewEpochState</a> <a id="3651" class="Symbol">:</a> <a id="3653" href="Ledger.Conway.Certs.html#934" class="Record">HasDReps</a> <a id="3662" href="Ledger.Conway.Epoch.html#2483" class="Record">NewEpochState</a> 
  <a id="3679" href="Ledger.Conway.Epoch.html#3628" class="Function">HasDReps-NewEpochState</a> <a id="3702" class="Symbol">.</a><a id="3703" href="Ledger.Conway.Certs.html#983" class="Field">DRepsOf</a> <a id="3711" class="Symbol">=</a> <a id="3713" href="Ledger.Conway.Certs.html#983" class="Field">DRepsOf</a> <a id="3721" href="Function.Base.html#1115" class="Function Operator">∘</a> <a id="3723" href="Ledger.Conway.Certs.html#4536" class="Field">CertStateOf</a>

  <a id="HasRewards-NewEpochState"></a><a id="3738" href="Ledger.Conway.Epoch.html#3738" class="Function">HasRewards-NewEpochState</a> <a id="3763" class="Symbol">:</a> <a id="3765" href="Ledger.Conway.Certs.html#821" class="Record">HasRewards</a> <a id="3776" href="Ledger.Conway.Epoch.html#2483" class="Record">NewEpochState</a>
  <a id="3792" href="Ledger.Conway.Epoch.html#3738" class="Function">HasRewards-NewEpochState</a> <a id="3817" class="Symbol">.</a><a id="3818" href="Ledger.Conway.Certs.html#872" class="Field">RewardsOf</a> <a id="3828" class="Symbol">=</a> <a id="3830" href="Ledger.Conway.Certs.html#872" class="Field">RewardsOf</a> <a id="3840" href="Function.Base.html#1115" class="Function Operator">∘</a> <a id="3842" href="Ledger.Conway.Certs.html#4536" class="Field">CertStateOf</a>

  <a id="3857" class="Keyword">unquoteDecl</a> <a id="HasCast-EpochState"></a><a id="3869" href="Ledger.Conway.Epoch.html#3869" class="Function">HasCast-EpochState</a> <a id="HasCast-NewEpochState"></a><a id="3888" href="Ledger.Conway.Epoch.html#3888" class="Function">HasCast-NewEpochState</a> <a id="3910" class="Symbol">=</a> <a id="3912" href="stdlib-classes.Class.HasCast.Derive.html#2690" class="Function">derive-HasCast</a>
    <a id="3931" class="Symbol">(</a> <a id="3933" class="Symbol">(</a><a id="3934" class="Keyword">quote</a> <a id="3940" href="Ledger.Conway.Epoch.html#1469" class="Record">EpochState</a>     <a id="3955" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="3957" href="Ledger.Conway.Epoch.html#3869" class="Function">HasCast-EpochState</a><a id="3975" class="Symbol">)</a>
    <a id="3981" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="3983" href="Data.List.Base.html#5205" class="Function Operator">[</a> <a id="3985" class="Symbol">(</a><a id="3986" class="Keyword">quote</a> <a id="3992" href="Ledger.Conway.Epoch.html#2483" class="Record">NewEpochState</a>  <a id="4007" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="4009" href="Ledger.Conway.Epoch.html#3888" class="Function">HasCast-NewEpochState</a><a id="4030" class="Symbol">)</a><a id="4031" href="Data.List.Base.html#5205" class="Function Operator">]</a><a id="4032" class="Symbol">)</a>

<a id="toRwdAddr"></a><a id="4035" href="Ledger.Conway.Epoch.html#4035" class="Function">toRwdAddr</a> <a id="4045" class="Symbol">:</a> <a id="4047" href="Ledger.Conway.Address.html#280" class="Datatype">Credential</a> <a id="4058" class="Symbol">→</a> <a id="4060" href="Ledger.Conway.Address.html#1344" class="Record">RwdAddr</a>
<a id="4068" href="Ledger.Conway.Epoch.html#4035" class="Function">toRwdAddr</a> <a id="4078" href="Ledger.Conway.Epoch.html#4078" class="Bound">x</a> <a id="4080" class="Symbol">=</a> <a id="4082" class="Keyword">record</a> <a id="4089" class="Symbol">{</a> <a id="4091" href="Ledger.Conway.Address.html#1373" class="Field">net</a> <a id="4095" class="Symbol">=</a> <a id="4097" href="Ledger.Conway.Types.Epoch.html#2361" class="Function">NetworkId</a> <a id="4107" class="Symbol">;</a> <a id="4109" href="Ledger.Conway.Address.html#1398" class="Field">stake</a> <a id="4115" class="Symbol">=</a> <a id="4117" href="Ledger.Conway.Epoch.html#4078" class="Bound">x</a> <a id="4119" class="Symbol">}</a>

<a id="getStakeCred"></a><a id="4122" href="Ledger.Conway.Epoch.html#4122" class="Function">getStakeCred</a> <a id="4135" class="Symbol">:</a> <a id="4137" href="Ledger.Conway.Transaction.html#2405" class="Function">TxOut</a> <a id="4143" class="Symbol">→</a> <a id="4145" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="4151" href="Ledger.Conway.Address.html#280" class="Datatype">Credential</a>
<a id="4162" href="Ledger.Conway.Epoch.html#4122" class="Function">getStakeCred</a> <a id="4175" class="Symbol">(</a><a id="4176" href="Ledger.Conway.Epoch.html#4176" class="Bound">a</a> <a id="4178" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="4180" class="Symbol">_</a> <a id="4182" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="4184" class="Symbol">_</a> <a id="4186" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="4188" class="Symbol">_)</a> <a id="4191" class="Symbol">=</a> <a id="4193" href="Ledger.Conway.Address.html#2516" class="Function">stakeCred</a> <a id="4203" href="Ledger.Conway.Epoch.html#4176" class="Bound">a</a>

<a id="4206" class="Keyword">open</a> <a id="4211" href="Ledger.Conway.GovernanceActions.html#2760" class="Module">GovActionState</a> <a id="4226" class="Keyword">using</a> <a id="4232" class="Symbol">(</a><a id="4233" href="Ledger.Conway.GovernanceActions.html#2831" class="Field">returnAddr</a><a id="4243" class="Symbol">)</a>


<a id="createRUpd"></a><a id="4247" href="Ledger.Conway.Epoch.html#4247" class="Function">createRUpd</a> <a id="4258" class="Symbol">:</a> <a id="4260" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a> <a id="4262" class="Symbol">→</a> <a id="4264" href="Ledger.Conway.Rewards.html#4406" class="Function">BlocksMade</a> <a id="4275" class="Symbol">→</a> <a id="4277" href="Ledger.Conway.Epoch.html#1469" class="Record">EpochState</a> <a id="4288" class="Symbol">→</a> <a id="4290" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a> <a id="4295" class="Symbol">→</a> <a id="4297" href="Ledger.Conway.Rewards.html#5689" class="Record">RewardUpdate</a>
<a id="4310" href="Ledger.Conway.Epoch.html#4247" class="Function">createRUpd</a> <a id="4321" href="Ledger.Conway.Epoch.html#4321" class="Bound">slotsPerEpoch</a> <a id="4335" href="Ledger.Conway.Epoch.html#4335" class="Bound">b</a> <a id="4337" href="Ledger.Conway.Epoch.html#4337" class="Bound">es</a> <a id="4340" href="Ledger.Conway.Epoch.html#4340" class="Bound">total</a> <a id="4346" class="Symbol">=</a>
  <a id="4350" class="Keyword">record</a>  <a id="4358" class="Symbol">{</a> <a id="4360" href="Ledger.Conway.Rewards.html#5726" class="Field">Δt</a> <a id="4363" class="Symbol">=</a> <a id="4365" href="Ledger.Conway.Epoch.html#5260" class="Function">Δt₁</a>
          <a id="4379" class="Symbol">;</a> <a id="4381" href="Ledger.Conway.Rewards.html#5729" class="Field">Δr</a> <a id="4384" class="Symbol">=</a> <a id="4386" class="Number">0</a> <a id="4388" href="Interface.HasSubtract.html#209" class="Field Operator">-</a> <a id="4390" href="Ledger.Conway.Epoch.html#5105" class="Function">Δr₁</a> <a id="4394" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="4396" href="Ledger.Conway.Epoch.html#5461" class="Function">Δr₂</a>
          <a id="4410" class="Symbol">;</a> <a id="4412" href="Ledger.Conway.Rewards.html#5732" class="Field">Δf</a> <a id="4415" class="Symbol">=</a> <a id="4417" class="Number">0</a> <a id="4419" href="Interface.HasSubtract.html#209" class="Field Operator">-</a> <a id="4421" href="Ledger.Conway.Epoch.html#76" class="InductiveConstructor">pos</a> <a id="4425" href="Ledger.Conway.Epoch.html#4721" class="Function">feeSS</a>
          <a id="4441" class="Symbol">;</a> <a id="4443" href="Ledger.Conway.Rewards.html#5752" class="Field">rs</a> <a id="4446" class="Symbol">=</a> <a id="4448" href="Ledger.Conway.Epoch.html#5378" class="Function">rs</a>


          <a id="4463" class="Symbol">;</a> <a id="4465" href="Ledger.Conway.Rewards.html#5794" class="Field">flowConservation</a> <a id="4482" class="Symbol">=</a> <a id="4484" href="Ledger.Conway.Epoch.html#5745" class="Function">flowConservation</a>
          <a id="4511" class="Symbol">;</a> <a id="4513" href="Ledger.Conway.Rewards.html#5857" class="Field">Δt-nonnegative</a> <a id="4528" class="Symbol">=</a> <a id="4530" href="Ledger.Conway.Epoch.html#6616" class="Function">Δt-nonneg</a>
          <a id="4550" class="Symbol">;</a> <a id="4552" href="Ledger.Conway.Rewards.html#5888" class="Field">Δf-nonpositive</a> <a id="4567" class="Symbol">=</a> <a id="4569" href="Ledger.Conway.Epoch.html#6790" class="Function">Δf-nonpos</a>


          <a id="4591" class="Symbol">}</a>
  <a id="4595" class="Keyword">where</a>
    <a id="4605" href="Ledger.Conway.Epoch.html#4605" class="Function">prevPp</a>       <a id="4618" class="Symbol">=</a> <a id="4620" href="Ledger.Conway.PParams.html#3571" class="Field">PParamsOf</a> <a id="4630" href="Ledger.Conway.Epoch.html#4337" class="Bound">es</a>
    <a id="4637" href="Ledger.Conway.Epoch.html#4637" class="Function">reserves</a>     <a id="4650" class="Symbol">=</a> <a id="4652" href="Ledger.Conway.PParams.html#961" class="Field">reservesOf</a> <a id="4663" href="Ledger.Conway.Epoch.html#4337" class="Bound">es</a>
    <a id="4670" href="Ledger.Conway.Epoch.html#4670" class="Function">pstakego</a>     <a id="4683" class="Symbol">=</a> <a id="4685" href="Ledger.Conway.Epoch.html#4337" class="Bound">es</a> <a id="4688" class="Symbol">.</a><a id="4689" href="Ledger.Conway.Epoch.html#1559" class="Field">EpochState.ss</a> <a id="4703" class="Symbol">.</a><a id="4704" href="Ledger.Conway.Rewards.html#6698" class="Field">Snapshots.go</a>
    <a id="4721" href="Ledger.Conway.Epoch.html#4721" class="Function">feeSS</a>        <a id="4734" class="Symbol">=</a> <a id="4736" href="Ledger.Conway.Epoch.html#4337" class="Bound">es</a> <a id="4739" class="Symbol">.</a><a id="4740" href="Ledger.Conway.Epoch.html#1559" class="Field">EpochState.ss</a> <a id="4754" class="Symbol">.</a><a id="4755" href="Ledger.Conway.Rewards.html#6717" class="Field">Snapshots.feeSS</a>
    <a id="4775" href="Ledger.Conway.Epoch.html#4775" class="Function">stake</a>        <a id="4788" class="Symbol">=</a> <a id="4790" href="Ledger.Conway.Epoch.html#4670" class="Function">pstakego</a> <a id="4799" class="Symbol">.</a><a id="4800" href="Ledger.Conway.Rewards.html#5958" class="Field">Snapshot.stake</a>
    <a id="4819" href="Ledger.Conway.Epoch.html#4819" class="Function">delegs</a>       <a id="4832" class="Symbol">=</a> <a id="4834" href="Ledger.Conway.Epoch.html#4670" class="Function">pstakego</a> <a id="4843" class="Symbol">.</a><a id="4844" href="Ledger.Conway.Rewards.html#5998" class="Field">Snapshot.delegations</a>
    <a id="4869" href="Ledger.Conway.Epoch.html#4869" class="Function">poolParams</a>   <a id="4882" class="Symbol">=</a> <a id="4884" href="Ledger.Conway.Epoch.html#4670" class="Function">pstakego</a> <a id="4893" class="Symbol">.</a><a id="4894" href="Ledger.Conway.Rewards.html#6041" class="Field">Snapshot.poolParameters</a>
    <a id="4922" href="Ledger.Conway.Epoch.html#4922" class="Function">blocksMade</a>   <a id="4935" class="Symbol">=</a> <a id="4937" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">∑[</a> <a id="4940" href="Ledger.Conway.Epoch.html#4940" class="Bound">m</a> <a id="4942" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">←</a> <a id="4944" href="Ledger.Conway.Epoch.html#4335" class="Bound">b</a> <a id="4946" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">]</a> <a id="4948" href="Ledger.Conway.Epoch.html#4940" class="Bound">m</a>
    <a id="4954" href="Ledger.Conway.Epoch.html#4954" class="Function">ρ</a>            <a id="4967" class="Symbol">=</a> <a id="4969" href="Ledger.Conway.Types.Numeric.UnitInterval.html#1993" class="Function">fromUnitInterval</a> <a id="4986" class="Symbol">(</a><a id="4987" href="Ledger.Conway.Epoch.html#4605" class="Function">prevPp</a> <a id="4994" class="Symbol">.</a><a id="4995" href="Ledger.Conway.PParams.html#2313" class="Field">PParams.monetaryExpansion</a><a id="5020" class="Symbol">)</a>
    <a id="5026" href="Ledger.Conway.Epoch.html#5026" class="Function">η</a>            <a id="5039" class="Symbol">=</a> <a id="5041" href="Ledger.Conway.Epoch.html#1026" class="Function">fromℕ</a> <a id="5047" href="Ledger.Conway.Epoch.html#4922" class="Function">blocksMade</a> <a id="5058" href="Ledger.Prelude.html#2305" class="Function Operator">÷₀</a> <a id="5061" class="Symbol">(</a><a id="5062" href="Ledger.Conway.Epoch.html#1026" class="Function">fromℕ</a> <a id="5068" href="Ledger.Conway.Epoch.html#4321" class="Bound">slotsPerEpoch</a> <a id="5082" href="Data.Rational.Base.html#6315" class="Function Operator">*</a> <a id="5084" href="Ledger.Conway.Types.Epoch.html#2222" class="Function">ActiveSlotCoeff</a><a id="5099" class="Symbol">)</a>
    <a id="5105" href="Ledger.Conway.Epoch.html#5105" class="Function">Δr₁</a>          <a id="5118" class="Symbol">=</a> <a id="5120" href="Data.Rational.Base.html#7116" class="Function">floor</a> <a id="5126" class="Symbol">(</a><a id="5127" class="Number">1</a> <a id="5129" href="Data.Rational.Base.html#6854" class="Function Operator">⊓</a> <a id="5131" href="Ledger.Conway.Epoch.html#5026" class="Function">η</a> <a id="5133" href="Data.Rational.Base.html#6315" class="Function Operator">*</a> <a id="5135" href="Ledger.Conway.Epoch.html#4954" class="Function">ρ</a> <a id="5137" href="Data.Rational.Base.html#6315" class="Function Operator">*</a> <a id="5139" href="Ledger.Conway.Epoch.html#1026" class="Function">fromℕ</a> <a id="5145" href="Ledger.Conway.Epoch.html#4637" class="Function">reserves</a><a id="5153" class="Symbol">)</a>
    <a id="5159" href="Ledger.Conway.Epoch.html#5159" class="Function">rewardPot</a>    <a id="5172" class="Symbol">=</a> <a id="5174" href="Ledger.Conway.Epoch.html#76" class="InductiveConstructor">pos</a> <a id="5178" href="Ledger.Conway.Epoch.html#4721" class="Function">feeSS</a> <a id="5184" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="5186" href="Ledger.Conway.Epoch.html#5105" class="Function">Δr₁</a>
    <a id="5194" href="Ledger.Conway.Epoch.html#5194" class="Function">τ</a>            <a id="5207" class="Symbol">=</a> <a id="5209" href="Ledger.Conway.Types.Numeric.UnitInterval.html#1993" class="Function">fromUnitInterval</a> <a id="5226" class="Symbol">(</a><a id="5227" href="Ledger.Conway.Epoch.html#4605" class="Function">prevPp</a> <a id="5234" class="Symbol">.</a><a id="5235" href="Ledger.Conway.PParams.html#2383" class="Field">PParams.treasuryCut</a><a id="5254" class="Symbol">)</a>
    <a id="5260" href="Ledger.Conway.Epoch.html#5260" class="Function">Δt₁</a>          <a id="5273" class="Symbol">=</a> <a id="5275" href="Data.Rational.Base.html#7116" class="Function">floor</a> <a id="5281" class="Symbol">(</a><a id="5282" href="Data.Rational.Literals.html#613" class="Function">fromℤ</a> <a id="5288" href="Ledger.Conway.Epoch.html#5159" class="Function">rewardPot</a> <a id="5298" href="Data.Rational.Base.html#6315" class="Function Operator">*</a> <a id="5300" href="Ledger.Conway.Epoch.html#5194" class="Function">τ</a><a id="5301" class="Symbol">)</a>
    <a id="5307" href="Ledger.Conway.Epoch.html#5307" class="Function">R</a>            <a id="5320" class="Symbol">=</a> <a id="5322" href="Ledger.Conway.Epoch.html#5159" class="Function">rewardPot</a> <a id="5332" href="Interface.HasSubtract.html#209" class="Field Operator">-</a> <a id="5334" href="Ledger.Conway.Epoch.html#5260" class="Function">Δt₁</a>
    <a id="5342" href="Ledger.Conway.Epoch.html#5342" class="Function">circulation</a>  <a id="5355" class="Symbol">=</a> <a id="5357" href="Ledger.Conway.Epoch.html#4340" class="Bound">total</a> <a id="5363" href="Interface.HasSubtract.html#209" class="Field Operator">-</a> <a id="5365" href="Ledger.Conway.Epoch.html#4637" class="Function">reserves</a>
    <a id="5378" href="Ledger.Conway.Epoch.html#5378" class="Function">rs</a>           <a id="5391" class="Symbol">=</a> <a id="5393" href="Ledger.Conway.Rewards.html#4880" class="Function">reward</a> <a id="5400" href="Ledger.Conway.Epoch.html#4605" class="Function">prevPp</a> <a id="5407" href="Ledger.Conway.Epoch.html#4335" class="Bound">b</a> <a id="5409" class="Symbol">(</a><a id="5410" href="Prelude.html#3167" class="Function">posPart</a> <a id="5418" href="Ledger.Conway.Epoch.html#5307" class="Function">R</a><a id="5419" class="Symbol">)</a> <a id="5421" href="Ledger.Conway.Epoch.html#4869" class="Function">poolParams</a> <a id="5432" href="Ledger.Conway.Epoch.html#4775" class="Function">stake</a> <a id="5438" href="Ledger.Conway.Epoch.html#4819" class="Function">delegs</a> <a id="5445" href="Ledger.Conway.Epoch.html#5342" class="Function">circulation</a>
    <a id="5461" href="Ledger.Conway.Epoch.html#5461" class="Function">Δr₂</a>          <a id="5474" class="Symbol">=</a> <a id="5476" href="Ledger.Conway.Epoch.html#5307" class="Function">R</a> <a id="5478" href="Interface.HasSubtract.html#209" class="Field Operator">-</a> <a id="5480" href="Ledger.Conway.Epoch.html#76" class="InductiveConstructor">pos</a> <a id="5484" class="Symbol">(</a><a id="5485" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">∑[</a> <a id="5488" href="Ledger.Conway.Epoch.html#5488" class="Bound">c</a> <a id="5490" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">←</a> <a id="5492" href="Ledger.Conway.Epoch.html#5378" class="Function">rs</a> <a id="5495" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">]</a> <a id="5497" href="Ledger.Conway.Epoch.html#5488" class="Bound">c</a><a id="5498" class="Symbol">)</a>



    <a id="5507" class="Comment">-- Proofs</a>
    <a id="5521" class="Comment">-- Note: Overloading of + and - seems to interfere with</a>
    <a id="5581" class="Comment">-- the ring solver.</a>
    <a id="5605" href="Ledger.Conway.Epoch.html#5605" class="Function">lemmaFlow</a> <a id="5615" class="Symbol">:</a> <a id="5617" class="Symbol">∀</a> <a id="5619" class="Symbol">(</a><a id="5620" href="Ledger.Conway.Epoch.html#5620" class="Bound">t₁</a> <a id="5623" href="Ledger.Conway.Epoch.html#5623" class="Bound">r₁</a> <a id="5626" href="Ledger.Conway.Epoch.html#5626" class="Bound">f</a> <a id="5628" href="Ledger.Conway.Epoch.html#5628" class="Bound">z</a> <a id="5630" class="Symbol">:</a> <a id="5632" href="Agda.Builtin.Int.html#245" class="Datatype">ℤ</a><a id="5633" class="Symbol">)</a>
      <a id="5641" class="Symbol">→</a> <a id="5643" class="Symbol">(</a><a id="5644" href="Ledger.Conway.Epoch.html#5620" class="Bound">t₁</a> <a id="5647" href="Data.Integer.Base.html#5064" class="Function Operator">ℤ.+</a> <a id="5651" class="Symbol">(</a><a id="5652" class="Number">0</a> <a id="5654" href="Data.Integer.Base.html#5245" class="Function Operator">ℤ.-</a> <a id="5658" href="Ledger.Conway.Epoch.html#5623" class="Bound">r₁</a> <a id="5661" href="Data.Integer.Base.html#5064" class="Function Operator">ℤ.+</a> <a id="5665" class="Symbol">((</a><a id="5667" href="Ledger.Conway.Epoch.html#5626" class="Bound">f</a> <a id="5669" href="Data.Integer.Base.html#5064" class="Function Operator">ℤ.+</a> <a id="5673" href="Ledger.Conway.Epoch.html#5623" class="Bound">r₁</a> <a id="5676" href="Data.Integer.Base.html#5245" class="Function Operator">ℤ.-</a> <a id="5680" href="Ledger.Conway.Epoch.html#5620" class="Bound">t₁</a><a id="5682" class="Symbol">)</a> <a id="5684" href="Data.Integer.Base.html#5245" class="Function Operator">ℤ.-</a> <a id="5688" href="Ledger.Conway.Epoch.html#5628" class="Bound">z</a><a id="5689" class="Symbol">))</a> <a id="5692" href="Data.Integer.Base.html#5064" class="Function Operator">ℤ.+</a> <a id="5696" class="Symbol">(</a><a id="5697" class="Number">0</a> <a id="5699" href="Data.Integer.Base.html#5245" class="Function Operator">ℤ.-</a> <a id="5703" href="Ledger.Conway.Epoch.html#5626" class="Bound">f</a><a id="5704" class="Symbol">)</a> <a id="5706" href="Data.Integer.Base.html#5064" class="Function Operator">ℤ.+</a> <a id="5710" href="Ledger.Conway.Epoch.html#5628" class="Bound">z</a><a id="5711" class="Symbol">)</a> <a id="5713" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="5715" class="Number">0</a>
    <a id="5721" href="Ledger.Conway.Epoch.html#5605" class="Function">lemmaFlow</a> <a id="5731" class="Symbol">=</a> <a id="5733" href="Data.Integer.Tactic.RingSolver.html#1112" class="Macro">solve-∀</a>
    <a id="5745" href="Ledger.Conway.Epoch.html#5745" class="Function">flowConservation</a> <a id="5762" class="Symbol">=</a> <a id="5764" href="Ledger.Conway.Epoch.html#5605" class="Function">lemmaFlow</a> <a id="5774" href="Ledger.Conway.Epoch.html#5260" class="Function">Δt₁</a> <a id="5778" href="Ledger.Conway.Epoch.html#5105" class="Function">Δr₁</a> <a id="5782" class="Symbol">(</a><a id="5783" href="Ledger.Conway.Epoch.html#76" class="InductiveConstructor">pos</a> <a id="5787" href="Ledger.Conway.Epoch.html#4721" class="Function">feeSS</a><a id="5792" class="Symbol">)</a> <a id="5794" class="Symbol">(</a><a id="5795" href="Ledger.Conway.Epoch.html#76" class="InductiveConstructor">pos</a> <a id="5799" class="Symbol">(</a><a id="5800" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">∑[</a> <a id="5803" href="Ledger.Conway.Epoch.html#5803" class="Bound">c</a> <a id="5805" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">←</a> <a id="5807" href="Ledger.Conway.Epoch.html#5378" class="Function">rs</a> <a id="5810" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">]</a> <a id="5812" href="Ledger.Conway.Epoch.html#5803" class="Bound">c</a><a id="5813" class="Symbol">))</a>

    <a id="5821" href="Ledger.Conway.Epoch.html#5821" class="Function">÷₀-0≤⇒0≤</a> <a id="5830" class="Symbol">:</a> <a id="5832" class="Symbol">∀</a> <a id="5834" class="Symbol">(</a><a id="5835" href="Ledger.Conway.Epoch.html#5835" class="Bound">x</a> <a id="5837" href="Ledger.Conway.Epoch.html#5837" class="Bound">y</a> <a id="5839" class="Symbol">:</a> <a id="5841" href="Data.Rational.Base.html#1342" class="Record">ℚ</a><a id="5842" class="Symbol">)</a> <a id="5844" class="Symbol">→</a> <a id="5846" class="Number">0</a> <a id="5848" href="Class.HasOrder.Core.html#608" class="Field Operator">≤</a> <a id="5850" href="Ledger.Conway.Epoch.html#5835" class="Bound">x</a> <a id="5852" class="Symbol">→</a> <a id="5854" class="Number">0</a> <a id="5856" href="Class.HasOrder.Core.html#608" class="Field Operator">≤</a> <a id="5858" href="Ledger.Conway.Epoch.html#5837" class="Bound">y</a> <a id="5860" class="Symbol">→</a> <a id="5862" class="Number">0</a> <a id="5864" href="Class.HasOrder.Core.html#608" class="Field Operator">≤</a> <a id="5866" class="Symbol">(</a><a id="5867" href="Ledger.Conway.Epoch.html#5835" class="Bound">x</a> <a id="5869" href="Ledger.Prelude.html#2305" class="Function Operator">÷₀</a> <a id="5872" href="Ledger.Conway.Epoch.html#5837" class="Bound">y</a><a id="5873" class="Symbol">)</a>
    <a id="5879" href="Ledger.Conway.Epoch.html#5821" class="Function">÷₀-0≤⇒0≤</a> <a id="5888" href="Ledger.Conway.Epoch.html#5888" class="Bound">x</a> <a id="5890" href="Ledger.Conway.Epoch.html#5890" class="Bound">y</a> <a id="5892" href="Ledger.Conway.Epoch.html#5892" class="Bound">0≤x</a> <a id="5896" href="Ledger.Conway.Epoch.html#5896" class="Bound">0≤y</a> <a id="5900" class="Keyword">with</a> <a id="5905" href="Ledger.Conway.Epoch.html#5890" class="Bound">y</a> <a id="5907" href="Data.Rational.Properties.html#3910" class="Function Operator">≟</a> <a id="5909" class="Number">0</a>
    <a id="5915" class="Symbol">...</a> <a id="5919" class="Symbol">|</a> <a id="5921" class="Symbol">(</a><a id="5922" href="Relation.Nullary.Decidable.Core.html#1994" class="InductiveConstructor">yes</a> <a id="5926" href="Ledger.Conway.Epoch.html#5926" class="Bound">y≡0</a><a id="5929" class="Symbol">)</a> <a id="5931" class="Symbol">=</a> <a id="5933" href="Data.Rational.Properties.html#26823" class="Function">nonNegative⁻¹</a> <a id="5947" class="Number">0</a>
    <a id="5953" class="Symbol">...</a> <a id="5957" class="Symbol">|</a> <a id="5959" class="Symbol">(</a><a id="5960" href="Relation.Nullary.Decidable.Core.html#2031" class="InductiveConstructor">no</a> <a id="5963" href="Ledger.Conway.Epoch.html#5963" class="Bound">y≢0</a><a id="5966" class="Symbol">)</a>  <a id="5969" class="Symbol">=</a> <a id="5971" href="stdlib.Data.Rational.Properties.html#2865" class="Function">÷-0≤⇒0≤</a> <a id="5979" class="Bound">x</a> <a id="5981" class="Bound">y</a> <a id="5983" class="Symbol">{{</a><a id="5985" href="Data.Rational.Base.html#4892" class="Function">≢-nonZero</a> <a id="5995" href="Ledger.Conway.Epoch.html#5963" class="Bound">y≢0</a><a id="5998" class="Symbol">}}</a> <a id="6001" class="Bound">0≤x</a> <a id="6005" class="Bound">0≤y</a>

    <a id="6014" href="Ledger.Conway.Epoch.html#6014" class="Function">η-nonneg</a> <a id="6023" class="Symbol">:</a> <a id="6025" class="Number">0</a> <a id="6027" href="Class.HasOrder.Core.html#608" class="Field Operator">≤</a> <a id="6029" href="Ledger.Conway.Epoch.html#5026" class="Function">η</a>
    <a id="6035" href="Ledger.Conway.Epoch.html#6014" class="Function">η-nonneg</a> <a id="6044" class="Symbol">=</a> <a id="6046" href="Ledger.Conway.Epoch.html#5821" class="Function">÷₀-0≤⇒0≤</a> <a id="6055" class="Symbol">_</a> <a id="6057" class="Symbol">_</a> <a id="6059" class="Symbol">(</a><a id="6060" href="stdlib.Data.Rational.Properties.html#2275" class="Function">fromℕ-0≤</a> <a id="6069" href="Ledger.Conway.Epoch.html#4922" class="Function">blocksMade</a><a id="6079" class="Symbol">)</a>
      <a id="6087" class="Symbol">(</a><a id="6088" href="stdlib.Data.Rational.Properties.html#2409" class="Function">*-0≤⇒0≤</a> <a id="6096" class="Symbol">_</a> <a id="6098" class="Symbol">_</a>
        <a id="6108" class="Symbol">(</a><a id="6109" href="stdlib.Data.Rational.Properties.html#2275" class="Function">fromℕ-0≤</a> <a id="6118" href="Ledger.Conway.Epoch.html#4321" class="Bound">slotsPerEpoch</a><a id="6131" class="Symbol">)</a>
        <a id="6141" class="Symbol">(</a><a id="6142" href="Data.Rational.Properties.html#26823" class="Function">nonNegative⁻¹</a> <a id="6156" href="Ledger.Conway.Types.Epoch.html#2222" class="Function">ActiveSlotCoeff</a> <a id="6172" class="Symbol">{{</a><a id="6174" href="Data.Rational.Properties.html#7313" class="Function">pos⇒nonNeg</a> <a id="6185" href="Ledger.Conway.Types.Epoch.html#2222" class="Function">ActiveSlotCoeff</a><a id="6200" class="Symbol">}}))</a>

    <a id="6210" href="Ledger.Conway.Epoch.html#6210" class="Function">min1η-nonneg</a> <a id="6223" class="Symbol">:</a> <a id="6225" class="Number">0</a> <a id="6227" href="Class.HasOrder.Core.html#608" class="Field Operator">≤</a> <a id="6229" class="Number">1</a> <a id="6231" href="Data.Rational.Base.html#6854" class="Function Operator">⊓</a> <a id="6233" href="Ledger.Conway.Epoch.html#5026" class="Function">η</a>
    <a id="6239" href="Ledger.Conway.Epoch.html#6210" class="Function">min1η-nonneg</a> <a id="6252" class="Symbol">=</a> <a id="6254" href="Algebra.Construct.NaturalChoice.MinOp.html#7026" class="Function">⊓-glb</a> <a id="6260" class="Symbol">(</a><a id="6261" href="Data.Rational.Properties.html#26823" class="Function">nonNegative⁻¹</a> <a id="6275" class="Number">1</a><a id="6276" class="Symbol">)</a> <a id="6278" href="Ledger.Conway.Epoch.html#6014" class="Function">η-nonneg</a>

    <a id="6292" href="Ledger.Conway.Epoch.html#6292" class="Function">Δr₁-nonneg</a> <a id="6303" class="Symbol">:</a> <a id="6305" class="Number">0</a> <a id="6307" href="Class.HasOrder.Core.html#608" class="Field Operator">≤</a> <a id="6309" href="Ledger.Conway.Epoch.html#5105" class="Function">Δr₁</a>
    <a id="6317" href="Ledger.Conway.Epoch.html#6292" class="Function">Δr₁-nonneg</a> <a id="6328" class="Symbol">=</a> <a id="6330" href="stdlib.Data.Rational.Properties.html#1631" class="Function">0≤⇒0≤floor</a> <a id="6341" class="Symbol">_</a>
      <a id="6349" class="Symbol">(</a><a id="6350" href="stdlib.Data.Rational.Properties.html#2409" class="Function">*-0≤⇒0≤</a> <a id="6358" class="Symbol">(</a><a id="6359" class="Number">1</a> <a id="6361" href="Data.Rational.Base.html#6854" class="Function Operator">⊓</a> <a id="6363" href="Ledger.Conway.Epoch.html#5026" class="Function">η</a> <a id="6365" href="Data.Rational.Base.html#6315" class="Function Operator">*</a> <a id="6367" href="Ledger.Conway.Epoch.html#4954" class="Function">ρ</a><a id="6368" class="Symbol">)</a> <a id="6370" class="Symbol">(</a><a id="6371" href="Ledger.Conway.Epoch.html#1026" class="Function">fromℕ</a> <a id="6377" href="Ledger.Conway.Epoch.html#4637" class="Function">reserves</a><a id="6385" class="Symbol">)</a>
        <a id="6395" class="Symbol">(</a><a id="6396" href="Ledger.Conway.Types.Numeric.UnitInterval.html#3341" class="Function">UnitInterval-*-0≤</a> <a id="6414" class="Symbol">(</a><a id="6415" class="Number">1</a> <a id="6417" href="Data.Rational.Base.html#6854" class="Function Operator">⊓</a> <a id="6419" href="Ledger.Conway.Epoch.html#5026" class="Function">η</a><a id="6420" class="Symbol">)</a> <a id="6422" class="Symbol">(</a><a id="6423" href="Ledger.Conway.Epoch.html#4605" class="Function">prevPp</a> <a id="6430" class="Symbol">.</a><a id="6431" href="Ledger.Conway.PParams.html#2313" class="Field">PParams.monetaryExpansion</a><a id="6456" class="Symbol">)</a> <a id="6458" href="Ledger.Conway.Epoch.html#6210" class="Function">min1η-nonneg</a><a id="6470" class="Symbol">)</a>
        <a id="6480" class="Symbol">(</a><a id="6481" href="stdlib.Data.Rational.Properties.html#2275" class="Function">fromℕ-0≤</a> <a id="6490" href="Ledger.Conway.Epoch.html#4637" class="Function">reserves</a><a id="6498" class="Symbol">))</a>

    <a id="6506" href="Ledger.Conway.Epoch.html#6506" class="Function">rewardPot-nonneg</a> <a id="6523" class="Symbol">:</a> <a id="6525" class="Number">0</a> <a id="6527" href="Class.HasOrder.Core.html#608" class="Field Operator">≤</a> <a id="6529" href="Ledger.Conway.Epoch.html#5159" class="Function">rewardPot</a>
    <a id="6543" href="Ledger.Conway.Epoch.html#6506" class="Function">rewardPot-nonneg</a> <a id="6560" class="Symbol">=</a> <a id="6562" href="Data.Integer.Properties.html#34659" class="Function">+-mono-≤</a> <a id="6571" class="Symbol">(</a><a id="6572" href="Ledger.Conway.Epoch.html#272" class="Function">nonNegative⁻¹ℤ</a> <a id="6587" class="Symbol">(</a><a id="6588" href="Ledger.Conway.Epoch.html#76" class="InductiveConstructor">pos</a> <a id="6592" href="Ledger.Conway.Epoch.html#4721" class="Function">feeSS</a><a id="6597" class="Symbol">))</a> <a id="6600" href="Ledger.Conway.Epoch.html#6292" class="Function">Δr₁-nonneg</a>

    <a id="6616" href="Ledger.Conway.Epoch.html#6616" class="Function">Δt-nonneg</a> <a id="6626" class="Symbol">:</a> <a id="6628" class="Number">0</a> <a id="6630" href="Class.HasOrder.Core.html#608" class="Field Operator">≤</a> <a id="6632" href="Ledger.Conway.Epoch.html#5260" class="Function">Δt₁</a>
    <a id="6640" href="Ledger.Conway.Epoch.html#6616" class="Function">Δt-nonneg</a> <a id="6650" class="Symbol">=</a> <a id="6652" href="stdlib.Data.Rational.Properties.html#1631" class="Function">0≤⇒0≤floor</a> <a id="6663" class="Symbol">_</a>
      <a id="6671" class="Symbol">(</a><a id="6672" href="Ledger.Conway.Types.Numeric.UnitInterval.html#3341" class="Function">UnitInterval-*-0≤</a> <a id="6690" class="Symbol">(</a><a id="6691" href="Data.Rational.Literals.html#613" class="Function">fromℤ</a> <a id="6697" href="Ledger.Conway.Epoch.html#5159" class="Function">rewardPot</a><a id="6706" class="Symbol">)</a> <a id="6708" class="Symbol">(</a><a id="6709" href="Ledger.Conway.Epoch.html#4605" class="Function">prevPp</a> <a id="6716" class="Symbol">.</a><a id="6717" href="Ledger.Conway.PParams.html#2383" class="Field">PParams.treasuryCut</a><a id="6736" class="Symbol">)</a>
        <a id="6746" class="Symbol">(</a><a id="6747" href="stdlib.Data.Rational.Properties.html#2013" class="Function">fromℤ-0≤</a> <a id="6756" href="Ledger.Conway.Epoch.html#5159" class="Function">rewardPot</a> <a id="6766" href="Ledger.Conway.Epoch.html#6506" class="Function">rewardPot-nonneg</a><a id="6782" class="Symbol">))</a>

    <a id="6790" href="Ledger.Conway.Epoch.html#6790" class="Function">Δf-nonpos</a> <a id="6800" class="Symbol">:</a> <a id="6802" class="Symbol">(</a><a id="6803" class="Number">0</a> <a id="6805" href="Interface.HasSubtract.html#209" class="Field Operator">-</a> <a id="6807" href="Ledger.Conway.Epoch.html#76" class="InductiveConstructor">pos</a> <a id="6811" href="Ledger.Conway.Epoch.html#4721" class="Function">feeSS</a><a id="6816" class="Symbol">)</a> <a id="6818" href="Class.HasOrder.Core.html#608" class="Field Operator">≤</a> <a id="6820" class="Number">0</a>
    <a id="6826" href="Ledger.Conway.Epoch.html#6790" class="Function">Δf-nonpos</a> <a id="6836" class="Symbol">=</a> <a id="6838" href="Relation.Binary.Reasoning.Syntax.html#1572" class="Function Operator">begin</a>
        <a id="6852" class="Number">0</a> <a id="6854" href="Interface.HasSubtract.html#209" class="Field Operator">-</a> <a id="6856" href="Ledger.Conway.Epoch.html#76" class="InductiveConstructor">pos</a> <a id="6860" href="Ledger.Conway.Epoch.html#4721" class="Function">feeSS</a> <a id="6866" href="Relation.Binary.Reasoning.Syntax.html#11048" class="Function">≡⟨</a> <a id="6869" href="Data.Integer.Properties.html#26896" class="Function">+-identityˡ</a> <a id="6881" class="Symbol">_</a> <a id="6883" href="Relation.Binary.Reasoning.Syntax.html#11048" class="Function">⟩</a>
        <a id="6893" href="Data.Integer.Base.html#4719" class="Function Operator">ℤ.-</a> <a id="6897" href="Ledger.Conway.Epoch.html#76" class="InductiveConstructor">pos</a> <a id="6901" href="Ledger.Conway.Epoch.html#4721" class="Function">feeSS</a> <a id="6907" href="Relation.Binary.Reasoning.Syntax.html#5544" class="Function">≤⟨</a> <a id="6910" href="Data.Integer.Properties.html#13094" class="Function">neg-mono-≤</a> <a id="6921" class="Symbol">(</a><a id="6922" href="Data.Integer.Base.html#2106" class="InductiveConstructor">ℤ.+≤+</a> <a id="6928" href="Data.Nat.Base.html#1720" class="InductiveConstructor">z≤n</a><a id="6931" class="Symbol">)</a> <a id="6933" href="Relation.Binary.Reasoning.Syntax.html#5544" class="Function">⟩</a>
        <a id="6943" class="Number">0</a>             <a id="6957" href="Relation.Binary.Reasoning.Syntax.html#12345" class="Function Operator">∎</a>
      <a id="6965" class="Keyword">where</a> <a id="6971" class="Keyword">open</a> <a id="6976" href="Data.Integer.Properties.html#11677" class="Module">≤-Reasoning</a>


<a id="applyRUpd"></a><a id="6990" href="Ledger.Conway.Epoch.html#6990" class="Function">applyRUpd</a> <a id="7000" class="Symbol">:</a> <a id="7002" href="Ledger.Conway.Rewards.html#5689" class="Record">RewardUpdate</a> <a id="7015" class="Symbol">→</a> <a id="7017" href="Ledger.Conway.Epoch.html#1469" class="Record">EpochState</a> <a id="7028" class="Symbol">→</a> <a id="7030" href="Ledger.Conway.Epoch.html#1469" class="Record">EpochState</a>
<a id="7041" href="Ledger.Conway.Epoch.html#6990" class="Function">applyRUpd</a> <a id="7051" href="Ledger.Conway.Epoch.html#7051" class="Bound">rewardUpdate</a>
  <a id="7066" href="Ledger.Conway.Epoch.html#1509" class="InductiveConstructor Operator">⟦</a> <a id="7068" href="Ledger.Conway.PParams.html#743" class="InductiveConstructor Operator">⟦</a> <a id="7070" href="Ledger.Conway.Epoch.html#7070" class="Bound">treasury</a> <a id="7079" href="Ledger.Conway.PParams.html#743" class="InductiveConstructor Operator">,</a> <a id="7081" href="Ledger.Conway.Epoch.html#7081" class="Bound">reserves</a> <a id="7090" href="Ledger.Conway.PParams.html#743" class="InductiveConstructor Operator">⟧ᵃ</a>
  <a id="7095" href="Ledger.Conway.Epoch.html#1509" class="InductiveConstructor Operator">,</a> <a id="7097" href="Ledger.Conway.Epoch.html#7097" class="Bound">ss</a>
  <a id="7102" href="Ledger.Conway.Epoch.html#1509" class="InductiveConstructor Operator">,</a> <a id="7104" href="Ledger.Conway.Ledger.html#901" class="InductiveConstructor Operator">⟦</a> <a id="7106" href="Ledger.Conway.Utxo.html#2786" class="InductiveConstructor Operator">⟦</a> <a id="7108" href="Ledger.Conway.Epoch.html#7108" class="Bound">utxo</a> <a id="7113" href="Ledger.Conway.Utxo.html#2786" class="InductiveConstructor Operator">,</a> <a id="7115" href="Ledger.Conway.Epoch.html#7115" class="Bound">fees</a> <a id="7120" href="Ledger.Conway.Utxo.html#2786" class="InductiveConstructor Operator">,</a> <a id="7122" href="Ledger.Conway.Epoch.html#7122" class="Bound">deposits</a> <a id="7131" href="Ledger.Conway.Utxo.html#2786" class="InductiveConstructor Operator">,</a> <a id="7133" href="Ledger.Conway.Epoch.html#7133" class="Bound">donations</a> <a id="7143" href="Ledger.Conway.Utxo.html#2786" class="InductiveConstructor Operator">⟧ᵘ</a>
    <a id="7150" href="Ledger.Conway.Ledger.html#901" class="InductiveConstructor Operator">,</a> <a id="7152" href="Ledger.Conway.Epoch.html#7152" class="Bound">govSt</a>
    <a id="7162" href="Ledger.Conway.Ledger.html#901" class="InductiveConstructor Operator">,</a> <a id="7164" href="Ledger.Conway.Certs.html#4394" class="InductiveConstructor Operator">⟦</a> <a id="7166" href="Ledger.Conway.Certs.html#3235" class="InductiveConstructor Operator">⟦</a> <a id="7168" href="Ledger.Conway.Epoch.html#7168" class="Bound">voteDelegs</a> <a id="7179" href="Ledger.Conway.Certs.html#3235" class="InductiveConstructor Operator">,</a> <a id="7181" href="Ledger.Conway.Epoch.html#7181" class="Bound">stakeDelegs</a> <a id="7193" href="Ledger.Conway.Certs.html#3235" class="InductiveConstructor Operator">,</a> <a id="7195" href="Ledger.Conway.Epoch.html#7195" class="Bound">rewards</a> <a id="7203" href="Ledger.Conway.Certs.html#3235" class="InductiveConstructor Operator">⟧ᵈ</a> <a id="7206" href="Ledger.Conway.Certs.html#4394" class="InductiveConstructor Operator">,</a> <a id="7208" href="Ledger.Conway.Epoch.html#7208" class="Bound">pState</a> <a id="7215" href="Ledger.Conway.Certs.html#4394" class="InductiveConstructor Operator">,</a> <a id="7217" href="Ledger.Conway.Epoch.html#7217" class="Bound">gState</a> <a id="7224" href="Ledger.Conway.Certs.html#4394" class="InductiveConstructor Operator">⟧ᶜˢ</a> <a id="7228" href="Ledger.Conway.Ledger.html#901" class="InductiveConstructor Operator">⟧ˡ</a>
  <a id="7233" href="Ledger.Conway.Epoch.html#1509" class="InductiveConstructor Operator">,</a> <a id="7235" href="Ledger.Conway.Epoch.html#7235" class="Bound">es</a>
  <a id="7240" href="Ledger.Conway.Epoch.html#1509" class="InductiveConstructor Operator">,</a> <a id="7242" href="Ledger.Conway.Epoch.html#7242" class="Bound">fut</a>
  <a id="7248" href="Ledger.Conway.Epoch.html#1509" class="InductiveConstructor Operator">⟧ᵉ&#39;</a> <a id="7252" class="Symbol">=</a>
  <a id="7256" href="Ledger.Prelude.html#2441" class="Function Operator">⟦</a> <a id="7258" href="Ledger.Prelude.html#2441" class="Function Operator">⟦</a> <a id="7260" href="Prelude.html#3167" class="Function">posPart</a> <a id="7268" class="Symbol">(</a><a id="7269" href="Ledger.Conway.Epoch.html#76" class="InductiveConstructor">pos</a> <a id="7273" href="Ledger.Conway.Epoch.html#7070" class="Bound">treasury</a> <a id="7282" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="7284" href="Ledger.Conway.Rewards.html#5726" class="Function">Δt</a> <a id="7287" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="7289" href="Ledger.Conway.Epoch.html#76" class="InductiveConstructor">pos</a> <a id="7293" href="Ledger.Conway.Epoch.html#7655" class="Function">unregRU&#39;</a><a id="7301" class="Symbol">)</a>
    <a id="7307" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="7309" href="Prelude.html#3167" class="Function">posPart</a> <a id="7317" class="Symbol">(</a><a id="7318" href="Ledger.Conway.Epoch.html#76" class="InductiveConstructor">pos</a> <a id="7322" href="Ledger.Conway.Epoch.html#7081" class="Bound">reserves</a> <a id="7331" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="7333" href="Ledger.Conway.Rewards.html#5729" class="Function">Δr</a><a id="7335" class="Symbol">)</a> <a id="7337" href="Ledger.Prelude.html#2441" class="Function Operator">⟧</a>
  <a id="7341" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="7343" href="Ledger.Conway.Epoch.html#7097" class="Bound">ss</a>
  <a id="7348" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="7350" href="Ledger.Prelude.html#2441" class="Function Operator">⟦</a> <a id="7352" href="Ledger.Prelude.html#2441" class="Function Operator">⟦</a> <a id="7354" href="Ledger.Conway.Epoch.html#7108" class="Bound">utxo</a> <a id="7359" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="7361" href="Prelude.html#3167" class="Function">posPart</a> <a id="7369" class="Symbol">(</a><a id="7370" href="Ledger.Conway.Epoch.html#76" class="InductiveConstructor">pos</a> <a id="7374" href="Ledger.Conway.Epoch.html#7115" class="Bound">fees</a> <a id="7379" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="7381" href="Ledger.Conway.Rewards.html#5732" class="Function">Δf</a><a id="7383" class="Symbol">)</a> <a id="7385" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="7387" href="Ledger.Conway.Epoch.html#7122" class="Bound">deposits</a> <a id="7396" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="7398" href="Ledger.Conway.Epoch.html#7133" class="Bound">donations</a> <a id="7408" href="Ledger.Prelude.html#2441" class="Function Operator">⟧</a>
    <a id="7414" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="7416" href="Ledger.Conway.Epoch.html#7152" class="Bound">govSt</a>
    <a id="7426" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="7428" href="Ledger.Prelude.html#2441" class="Function Operator">⟦</a> <a id="7430" href="Ledger.Prelude.html#2441" class="Function Operator">⟦</a> <a id="7432" href="Ledger.Conway.Epoch.html#7168" class="Bound">voteDelegs</a> <a id="7443" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="7445" href="Ledger.Conway.Epoch.html#7181" class="Bound">stakeDelegs</a> <a id="7457" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="7459" href="Ledger.Conway.Epoch.html#7195" class="Bound">rewards</a> <a id="7467" href="Axiom.Set.Map.Dec.html#1854" class="Function Operator">∪⁺</a> <a id="7470" href="Ledger.Conway.Epoch.html#7587" class="Function">regRU</a> <a id="7476" href="Ledger.Prelude.html#2441" class="Function Operator">⟧</a> <a id="7478" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="7480" href="Ledger.Conway.Epoch.html#7208" class="Bound">pState</a> <a id="7487" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="7489" href="Ledger.Conway.Epoch.html#7217" class="Bound">gState</a> <a id="7496" href="Ledger.Prelude.html#2441" class="Function Operator">⟧</a> <a id="7498" href="Ledger.Prelude.html#2441" class="Function Operator">⟧</a>
  <a id="7502" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="7504" href="Ledger.Conway.Epoch.html#7235" class="Bound">es</a>
  <a id="7509" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="7511" href="Ledger.Conway.Epoch.html#7242" class="Bound">fut</a> <a id="7515" href="Ledger.Prelude.html#2441" class="Function Operator">⟧</a>
  <a id="7519" class="Keyword">where</a>
    <a id="7529" class="Keyword">open</a> <a id="7534" href="Ledger.Conway.Rewards.html#5689" class="Module">RewardUpdate</a> <a id="7547" href="Ledger.Conway.Epoch.html#7051" class="Bound">rewardUpdate</a> <a id="7560" class="Keyword">using</a> <a id="7566" class="Symbol">(</a><a id="7567" href="Ledger.Conway.Rewards.html#5726" class="Field">Δt</a><a id="7569" class="Symbol">;</a> <a id="7571" href="Ledger.Conway.Rewards.html#5729" class="Field">Δr</a><a id="7573" class="Symbol">;</a> <a id="7575" href="Ledger.Conway.Rewards.html#5732" class="Field">Δf</a><a id="7577" class="Symbol">;</a> <a id="7579" href="Ledger.Conway.Rewards.html#5752" class="Field">rs</a><a id="7581" class="Symbol">)</a>
    <a id="7587" href="Ledger.Conway.Epoch.html#7587" class="Function">regRU</a>     <a id="7597" class="Symbol">=</a> <a id="7599" href="Ledger.Conway.Rewards.html#5752" class="Function">rs</a> <a id="7602" href="Axiom.Set.Map.html#10678" class="Function Operator">∣</a> <a id="7604" href="Class.IsSet.html#916" class="Function">dom</a> <a id="7608" href="Ledger.Conway.Epoch.html#7195" class="Bound">rewards</a>
    <a id="7620" href="Ledger.Conway.Epoch.html#7620" class="Function">unregRU</a>   <a id="7630" class="Symbol">=</a> <a id="7632" href="Ledger.Conway.Rewards.html#5752" class="Function">rs</a> <a id="7635" href="Axiom.Set.Map.html#10748" class="Function Operator">∣</a> <a id="7637" href="Class.IsSet.html#916" class="Function">dom</a> <a id="7641" href="Ledger.Conway.Epoch.html#7195" class="Bound">rewards</a> <a id="7649" href="Axiom.Set.Map.html#10748" class="Function Operator">ᶜ</a>
    <a id="7655" href="Ledger.Conway.Epoch.html#7655" class="Function">unregRU&#39;</a>  <a id="7665" class="Symbol">=</a> <a id="7667" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">∑[</a> <a id="7670" href="Ledger.Conway.Epoch.html#7670" class="Bound">x</a> <a id="7672" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">←</a> <a id="7674" href="Ledger.Conway.Epoch.html#7620" class="Function">unregRU</a> <a id="7682" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">]</a> <a id="7684" href="Ledger.Conway.Epoch.html#7670" class="Bound">x</a>

<a id="getOrphans"></a><a id="7687" href="Ledger.Conway.Epoch.html#7687" class="Function">getOrphans</a> <a id="7698" class="Symbol">:</a> <a id="7700" href="Ledger.Conway.Enact.html#418" class="Record">EnactState</a> <a id="7711" class="Symbol">→</a> <a id="7713" href="Ledger.Conway.Gov.html#1397" class="Function">GovState</a> <a id="7722" class="Symbol">→</a> <a id="7724" href="Ledger.Conway.Gov.html#1397" class="Function">GovState</a>
<a id="7733" href="Ledger.Conway.Epoch.html#7687" class="Function">getOrphans</a> <a id="7744" href="Ledger.Conway.Epoch.html#7744" class="Bound">es</a> <a id="7747" href="Ledger.Conway.Epoch.html#7747" class="Bound">govSt</a> <a id="7753" class="Symbol">=</a> <a id="7755" href="Data.Product.Base.html#636" class="Field">proj₁</a> <a id="7761" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="7763" href="Data.Nat.GeneralisedArithmetic.html#866" class="Function">iterate</a> <a id="7771" href="Ledger.Conway.Epoch.html#7816" class="Function">step</a> <a id="7776" class="Symbol">(</a><a id="7777" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a> <a id="7780" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="7782" href="Ledger.Conway.Epoch.html#7747" class="Bound">govSt</a><a id="7787" class="Symbol">)</a> <a id="7789" class="Symbol">(</a><a id="7790" href="Data.List.Base.html#5044" class="Function">length</a> <a id="7797" href="Ledger.Conway.Epoch.html#7747" class="Bound">govSt</a><a id="7802" class="Symbol">)</a>
  <a id="7806" class="Keyword">where</a>
    <a id="7816" href="Ledger.Conway.Epoch.html#7816" class="Function">step</a> <a id="7821" class="Symbol">:</a> <a id="7823" href="Ledger.Conway.Gov.html#1397" class="Function">GovState</a> <a id="7832" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="7834" href="Ledger.Conway.Gov.html#1397" class="Function">GovState</a> <a id="7843" class="Symbol">→</a> <a id="7845" href="Ledger.Conway.Gov.html#1397" class="Function">GovState</a> <a id="7854" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="7856" href="Ledger.Conway.Gov.html#1397" class="Function">GovState</a>
    <a id="7869" href="Ledger.Conway.Epoch.html#7816" class="Function">step</a> <a id="7874" class="Symbol">(</a><a id="7875" href="Ledger.Conway.Epoch.html#7875" class="Bound">orps</a> <a id="7880" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="7882" href="Ledger.Conway.Epoch.html#7882" class="Bound">govSt</a><a id="7887" class="Symbol">)</a> <a id="7889" class="Symbol">=</a>
      <a id="7897" class="Keyword">let</a>
        <a id="7909" href="Ledger.Conway.Epoch.html#7909" class="Bound">isOrphan?</a> <a id="7919" href="Ledger.Conway.Epoch.html#7919" class="Bound">a</a> <a id="7921" href="Ledger.Conway.Epoch.html#7921" class="Bound">prev</a> <a id="7926" class="Symbol">=</a> <a id="7928" href="Relation.Nullary.Decidable.Core.html#3011" class="Function">¬?</a> <a id="7931" class="Symbol">(</a><a id="7932" href="Ledger.Conway.Gov.html#8737" class="Function">hasParent?</a> <a id="7943" href="Ledger.Conway.Epoch.html#7744" class="Bound">es</a> <a id="7946" href="Ledger.Conway.Epoch.html#7882" class="Bound">govSt</a> <a id="7952" href="Ledger.Conway.Epoch.html#7919" class="Bound">a</a> <a id="7954" href="Ledger.Conway.Epoch.html#7921" class="Bound">prev</a><a id="7958" class="Symbol">)</a>
        <a id="7968" class="Symbol">(</a><a id="7969" href="Ledger.Conway.Epoch.html#7969" class="Bound">orps&#39;</a> <a id="7975" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="7977" href="Ledger.Conway.Epoch.html#7977" class="Bound">govSt&#39;</a><a id="7983" class="Symbol">)</a> <a id="7985" class="Symbol">=</a> <a id="7987" href="Data.List.Base.html#10926" class="Function">partition</a>
          <a id="8007" class="Symbol">(λ</a> <a id="8010" class="Symbol">(_</a> <a id="8013" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="8015" class="Keyword">record</a> <a id="8022" class="Symbol">{</a><a id="8023" href="Ledger.Conway.GovernanceActions.html#2881" class="Field">action</a> <a id="8030" class="Symbol">=</a> <a id="8032" href="Ledger.Conway.Epoch.html#8032" class="Bound">a</a> <a id="8034" class="Symbol">;</a> <a id="8036" href="Ledger.Conway.GovernanceActions.html#2909" class="Field">prevAction</a> <a id="8047" class="Symbol">=</a> <a id="8049" href="Ledger.Conway.Epoch.html#8049" class="Bound">prev</a><a id="8053" class="Symbol">})</a> <a id="8056" class="Symbol">→</a> <a id="8058" href="Ledger.Conway.Epoch.html#7909" class="Bound">isOrphan?</a> <a id="8068" class="Symbol">(</a><a id="8069" href="Ledger.Conway.Epoch.html#8032" class="Bound">a</a> <a id="8071" class="Symbol">.</a><a id="8072" href="Ledger.Conway.GovernanceActions.html#1447" class="Field">gaType</a><a id="8078" class="Symbol">)</a> <a id="8080" href="Ledger.Conway.Epoch.html#8049" class="Bound">prev</a><a id="8084" class="Symbol">)</a> <a id="8086" href="Ledger.Conway.Epoch.html#7882" class="Bound">govSt</a>
      <a id="8098" class="Keyword">in</a>
        <a id="8109" class="Symbol">(</a><a id="8110" href="Ledger.Conway.Epoch.html#7875" class="Bound">orps</a> <a id="8115" href="Data.List.Base.html#1734" class="Function Operator">++</a> <a id="8118" href="Ledger.Conway.Epoch.html#7969" class="Bound">orps&#39;</a> <a id="8124" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="8126" href="Ledger.Conway.Epoch.html#7977" class="Bound">govSt&#39;</a><a id="8132" class="Symbol">)</a>


<a id="8136" class="Keyword">open</a> <a id="8141" href="Ledger.Conway.Address.html#1344" class="Module">RwdAddr</a> <a id="8149" class="Keyword">using</a> <a id="8155" class="Symbol">(</a><a id="8156" href="Ledger.Conway.Address.html#1398" class="Field">stake</a><a id="8161" class="Symbol">)</a>


<a id="gaDepositStake"></a><a id="8165" href="Ledger.Conway.Epoch.html#8165" class="Function">gaDepositStake</a> <a id="8180" class="Symbol">:</a> <a id="8182" href="Ledger.Conway.Gov.html#1397" class="Function">GovState</a> <a id="8191" class="Symbol">→</a> <a id="8193" href="Ledger.Conway.Certs.html#601" class="Function">Deposits</a> <a id="8202" class="Symbol">→</a> <a id="8204" href="Ledger.Conway.Address.html#280" class="Datatype">Credential</a> <a id="8215" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="8217" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a>
<a id="8222" href="Ledger.Conway.Epoch.html#8165" class="Function">gaDepositStake</a> <a id="8237" href="Ledger.Conway.Epoch.html#8237" class="Bound">govSt</a> <a id="8243" href="Ledger.Conway.Epoch.html#8243" class="Bound">ds</a> <a id="8246" class="Symbol">=</a> <a id="8248" href="abstract-set-theory.FiniteSetTheory.html#3599" class="Function">aggregateBy</a>
  <a id="8262" class="Symbol">(</a><a id="8263" href="abstract-set-theory.FiniteSetTheory.html#519" class="Function">mapˢ</a> <a id="8268" class="Symbol">(λ</a> <a id="8271" class="Symbol">(</a><a id="8272" href="Ledger.Conway.Epoch.html#8272" class="Bound">gaid</a> <a id="8277" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="8279" href="Ledger.Conway.Epoch.html#8279" class="Bound">addr</a><a id="8283" class="Symbol">)</a> <a id="8285" class="Symbol">→</a> <a id="8287" class="Symbol">(</a><a id="8288" href="Ledger.Conway.Epoch.html#8272" class="Bound">gaid</a> <a id="8293" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="8295" href="Ledger.Conway.Epoch.html#8279" class="Bound">addr</a><a id="8299" class="Symbol">)</a> <a id="8301" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="8303" href="Ledger.Conway.Address.html#1398" class="Field">stake</a> <a id="8309" href="Ledger.Conway.Epoch.html#8279" class="Bound">addr</a><a id="8313" class="Symbol">)</a> <a id="8315" href="Ledger.Conway.Epoch.html#8413" class="Function">govSt&#39;</a><a id="8321" class="Symbol">)</a>
  <a id="8325" class="Symbol">(</a><a id="8326" href="Axiom.Set.Map.html#10460" class="Function">mapFromPartialFun</a> <a id="8344" class="Symbol">(λ</a> <a id="8347" class="Symbol">(</a><a id="8348" href="Ledger.Conway.Epoch.html#8348" class="Bound">gaid</a> <a id="8353" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="8355" class="Symbol">_)</a> <a id="8358" class="Symbol">→</a> <a id="8360" href="Axiom.Set.Map.html#13670" class="Function">lookupᵐ?</a> <a id="8369" href="Ledger.Conway.Epoch.html#8243" class="Bound">ds</a> <a id="8372" class="Symbol">(</a><a id="8373" href="Ledger.Conway.Certs.html#549" class="InductiveConstructor">GovActionDeposit</a> <a id="8390" href="Ledger.Conway.Epoch.html#8348" class="Bound">gaid</a><a id="8394" class="Symbol">))</a> <a id="8397" href="Ledger.Conway.Epoch.html#8413" class="Function">govSt&#39;</a><a id="8403" class="Symbol">)</a>
  <a id="8407" class="Keyword">where</a> <a id="8413" href="Ledger.Conway.Epoch.html#8413" class="Function">govSt&#39;</a> <a id="8420" class="Symbol">=</a> <a id="8422" href="abstract-set-theory.FiniteSetTheory.html#519" class="Function">mapˢ</a> <a id="8427" class="Symbol">(</a><a id="8428" href="Class.Bifunctor.html#1152" class="Function">map₂</a> <a id="8433" href="Ledger.Conway.GovernanceActions.html#2831" class="Field">returnAddr</a><a id="8443" class="Symbol">)</a> <a id="8445" class="Symbol">(</a><a id="8446" href="Axiom.Set.html#5718" class="Function">fromList</a> <a id="8455" href="Ledger.Conway.Epoch.html#8237" class="Bound">govSt</a><a id="8460" class="Symbol">)</a>



<a id="8465" class="Keyword">opaque</a>


  <a id="mkStakeDistrs"></a><a id="8476" href="Ledger.Conway.Epoch.html#8476" class="Function">mkStakeDistrs</a> <a id="8490" class="Symbol">:</a> <a id="8492" href="Ledger.Conway.Rewards.html#5925" class="Record">Snapshot</a> <a id="8501" class="Symbol">→</a> <a id="8503" href="Ledger.Conway.Gov.html#1397" class="Function">GovState</a> <a id="8512" class="Symbol">→</a> <a id="8514" href="Ledger.Conway.Certs.html#601" class="Function">Deposits</a> <a id="8523" class="Symbol">→</a> <a id="8525" class="Symbol">(</a><a id="8526" href="Ledger.Conway.Address.html#280" class="Datatype">Credential</a> <a id="8537" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="8539" href="Ledger.Conway.GovernanceActions.html#472" class="Datatype">VDeleg</a><a id="8545" class="Symbol">)</a> <a id="8547" class="Symbol">→</a> <a id="8549" href="Ledger.Conway.Ratify.html#2949" class="Record">StakeDistrs</a>
  <a id="8563" href="Ledger.Conway.Epoch.html#8476" class="Function">mkStakeDistrs</a> <a id="8577" href="Ledger.Conway.Epoch.html#8577" class="Bound">ss</a> <a id="8580" href="Ledger.Conway.Epoch.html#8580" class="Bound">govSt</a> <a id="8586" href="Ledger.Conway.Epoch.html#8586" class="Bound">ds</a> <a id="8589" href="Ledger.Conway.Epoch.html#8589" class="Bound">delegations</a> <a id="8601" class="Symbol">.</a><a id="8602" href="Ledger.Conway.Ratify.html#2986" class="Field">StakeDistrs.stakeDistr</a> <a id="8625" class="Symbol">=</a>
    <a id="8631" href="abstract-set-theory.FiniteSetTheory.html#3599" class="Function">aggregateBy</a> <a id="8643" href="Ledger.Prelude.html#2543" class="Function Operator">∣</a> <a id="8645" href="Ledger.Conway.Epoch.html#8589" class="Bound">delegations</a> <a id="8657" href="Ledger.Prelude.html#2543" class="Function Operator">∣</a> <a id="8659" class="Symbol">(</a><a id="8660" href="Ledger.Conway.Rewards.html#5958" class="Field">Snapshot.stake</a> <a id="8675" href="Ledger.Conway.Epoch.html#8577" class="Bound">ss</a> <a id="8678" href="Axiom.Set.Map.Dec.html#1854" class="Function Operator">∪⁺</a> <a id="8681" href="Ledger.Conway.Epoch.html#8165" class="Function">gaDepositStake</a> <a id="8696" href="Ledger.Conway.Epoch.html#8580" class="Bound">govSt</a> <a id="8702" href="Ledger.Conway.Epoch.html#8586" class="Bound">ds</a><a id="8704" class="Symbol">)</a>


<a id="8708" class="Keyword">private</a> <a id="8716" class="Keyword">variable</a>
  <a id="8727" href="Ledger.Conway.Epoch.html#8727" class="Generalizable">nes</a> <a id="8731" href="Ledger.Conway.Epoch.html#8731" class="Generalizable">nes&#39;</a> <a id="8736" class="Symbol">:</a> <a id="8738" href="Ledger.Conway.Epoch.html#2483" class="Record">NewEpochState</a>
  <a id="8754" href="Ledger.Conway.Epoch.html#8754" class="Generalizable">e</a> <a id="8756" href="Ledger.Conway.Epoch.html#8756" class="Generalizable">lastEpoch</a> <a id="8766" class="Symbol">:</a> <a id="8768" href="Ledger.Conway.Types.Epoch.html#592" class="Function">Epoch</a>
  <a id="8776" href="Ledger.Conway.Epoch.html#8776" class="Generalizable">fut</a> <a id="8780" href="Ledger.Conway.Epoch.html#8780" class="Generalizable">fut&#39;</a> <a id="8785" class="Symbol">:</a> <a id="8787" href="Ledger.Conway.Ratify.html#3314" class="Record">RatifyState</a>
  <a id="8801" href="Ledger.Conway.Epoch.html#8801" class="Generalizable">eps</a> <a id="8805" href="Ledger.Conway.Epoch.html#8805" class="Generalizable">eps&#39;</a> <a id="8810" href="Ledger.Conway.Epoch.html#8810" class="Generalizable">eps&#39;&#39;</a> <a id="8816" class="Symbol">:</a> <a id="8818" href="Ledger.Conway.Epoch.html#1469" class="Record">EpochState</a>
  <a id="8831" href="Ledger.Conway.Epoch.html#8831" class="Generalizable">ls</a> <a id="8834" class="Symbol">:</a> <a id="8836" href="Ledger.Conway.Ledger.html#865" class="Record">LState</a>
  <a id="8845" href="Ledger.Conway.Epoch.html#8845" class="Generalizable">acnt</a> <a id="8850" class="Symbol">:</a> <a id="8852" href="Ledger.Conway.PParams.html#709" class="Record">Acnt</a>
  <a id="8859" href="Ledger.Conway.Epoch.html#8859" class="Generalizable">es₀</a> <a id="8863" class="Symbol">:</a> <a id="8865" href="Ledger.Conway.Enact.html#418" class="Record">EnactState</a>
  <a id="8878" href="Ledger.Conway.Epoch.html#8878" class="Generalizable">mark</a> <a id="8883" href="Ledger.Conway.Epoch.html#8883" class="Generalizable">set</a> <a id="8887" href="Ledger.Conway.Epoch.html#8887" class="Generalizable">go</a> <a id="8890" class="Symbol">:</a> <a id="8892" href="Ledger.Conway.Rewards.html#5925" class="Record">Snapshot</a>
  <a id="8903" href="Ledger.Conway.Epoch.html#8903" class="Generalizable">feeSS</a> <a id="8909" class="Symbol">:</a> <a id="8911" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a>
  <a id="8918" href="Ledger.Conway.Epoch.html#8918" class="Generalizable">lstate</a> <a id="8925" class="Symbol">:</a> <a id="8927" href="Ledger.Conway.Ledger.html#865" class="Record">LState</a>
  <a id="8936" href="Ledger.Conway.Epoch.html#8936" class="Generalizable">ss</a> <a id="8939" href="Ledger.Conway.Epoch.html#8939" class="Generalizable">ss&#39;</a> <a id="8943" class="Symbol">:</a> <a id="8945" href="Ledger.Conway.Rewards.html#6655" class="Record">Snapshots</a>
  <a id="8957" href="Ledger.Conway.Epoch.html#8957" class="Generalizable">ru</a> <a id="8960" class="Symbol">:</a> <a id="8962" href="Ledger.Conway.Rewards.html#5689" class="Record">RewardUpdate</a>
  <a id="8977" href="Ledger.Conway.Epoch.html#8977" class="Generalizable">mru</a> <a id="8981" class="Symbol">:</a> <a id="8983" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="8989" href="Ledger.Conway.Rewards.html#5689" class="Record">RewardUpdate</a>


<a id="9004" class="Keyword">data</a> <a id="_⊢_⇀⦇_,EPOCH⦈_"></a><a id="9009" href="Ledger.Conway.Epoch.html#9009" class="Datatype Operator">_⊢_⇀⦇_,EPOCH⦈_</a> <a id="9024" class="Symbol">:</a> <a id="9026" href="Agda.Builtin.Unit.html#175" class="Record">⊤</a> <a id="9028" class="Symbol">→</a> <a id="9030" href="Ledger.Conway.Epoch.html#1469" class="Record">EpochState</a> <a id="9041" class="Symbol">→</a> <a id="9043" href="Ledger.Conway.Types.Epoch.html#592" class="Function">Epoch</a> <a id="9049" class="Symbol">→</a> <a id="9051" href="Ledger.Conway.Epoch.html#1469" class="Record">EpochState</a> <a id="9062" class="Symbol">→</a> <a id="9064" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="9069" class="Keyword">where</a>


  <a id="_⊢_⇀⦇_,EPOCH⦈_.EPOCH"></a><a id="9079" href="Ledger.Conway.Epoch.html#9079" class="InductiveConstructor">EPOCH</a> <a id="9085" class="Symbol">:</a> <a id="9087" class="Keyword">let</a>


      <a id="9099" class="Keyword">open</a> <a id="9104" href="Ledger.Conway.Ledger.html#865" class="Module">LState</a> <a id="9111" href="Ledger.Conway.Epoch.html#8831" class="Generalizable">ls</a>
      <a id="9120" class="Keyword">open</a> <a id="9125" href="Ledger.Conway.Certs.html#4355" class="Module">CertState</a> <a id="9135" href="Ledger.Conway.Ledger.html#977" class="Function">certState</a>
      <a id="9151" class="Keyword">open</a> <a id="9156" href="Ledger.Conway.Ratify.html#3314" class="Module">RatifyState</a> <a id="9168" href="Ledger.Conway.Epoch.html#8776" class="Generalizable">fut</a> <a id="9172" class="Keyword">hiding</a> <a id="9179" class="Symbol">(</a><a id="9180" href="Ledger.Conway.Ratify.html#3351" class="Field">es</a><a id="9182" class="Symbol">)</a>
      <a id="9190" class="Keyword">open</a> <a id="9195" href="Ledger.Conway.Utxo.html#2747" class="Module">UTxOState</a>
      <a id="9211" class="Keyword">open</a> <a id="9216" href="Ledger.Conway.Certs.html#3809" class="Module">PState</a><a id="9222" class="Symbol">;</a> <a id="9224" class="Keyword">open</a> <a id="9229" href="Ledger.Conway.Certs.html#3199" class="Module">DState</a><a id="9235" class="Symbol">;</a> <a id="9237" class="Keyword">open</a> <a id="9242" href="Ledger.Conway.Certs.html#4025" class="Module">GState</a>
      <a id="9255" class="Keyword">open</a> <a id="9260" href="Ledger.Conway.PParams.html#709" class="Module">Acnt</a><a id="9264" class="Symbol">;</a> <a id="9266" class="Keyword">open</a> <a id="9271" href="Ledger.Conway.Enact.html#418" class="Module">EnactState</a><a id="9281" class="Symbol">;</a> <a id="9283" class="Keyword">open</a> <a id="9288" href="Ledger.Conway.GovernanceActions.html#2760" class="Module">GovActionState</a>


      <a id="9311" href="Ledger.Conway.Epoch.html#9311" class="Bound">esW</a>               <a id="9329" class="Symbol">=</a> <a id="9331" href="Ledger.Conway.Ratify.html#3351" class="Field">RatifyState.es</a> <a id="9346" href="Ledger.Conway.Epoch.html#8776" class="Generalizable">fut</a>
      <a id="9356" href="Ledger.Conway.Epoch.html#9356" class="Bound">es</a>                <a id="9374" class="Symbol">=</a> <a id="9376" class="Keyword">record</a> <a id="9383" href="Ledger.Conway.Epoch.html#9311" class="Bound">esW</a> <a id="9387" class="Symbol">{</a> <a id="9389" href="Ledger.Conway.Enact.html#670" class="Field">withdrawals</a> <a id="9401" class="Symbol">=</a> <a id="9403" href="Class.HasEmptySet.html#287" class="Field">∅</a> <a id="9405" class="Symbol">}</a>
      <a id="9413" href="Ledger.Conway.Epoch.html#9413" class="Bound">tmpGovSt</a>          <a id="9431" class="Symbol">=</a> <a id="9433" href="Ledger.Prelude.html#2692" class="Function">filter</a> <a id="9440" class="Symbol">(λ</a> <a id="9443" href="Ledger.Conway.Epoch.html#9443" class="Bound">x</a> <a id="9445" class="Symbol">→</a> <a id="9447" href="Data.Product.Base.html#636" class="Field">proj₁</a> <a id="9453" href="Ledger.Conway.Epoch.html#9443" class="Bound">x</a> <a id="9455" href="Class.IsSet.html#462" class="Function Operator">∉</a> <a id="9457" href="abstract-set-theory.FiniteSetTheory.html#519" class="Function">mapˢ</a> <a id="9462" href="Data.Product.Base.html#636" class="Field">proj₁</a> <a id="9468" href="Ledger.Conway.Ratify.html#3384" class="Function">removed</a><a id="9475" class="Symbol">)</a> <a id="9477" href="Ledger.Conway.Ledger.html#951" class="Function">govSt</a>
      <a id="9489" href="Ledger.Conway.Epoch.html#9489" class="Bound">orphans</a>           <a id="9507" class="Symbol">=</a> <a id="9509" href="Axiom.Set.html#5718" class="Function">fromList</a> <a id="9518" class="Symbol">(</a><a id="9519" href="Ledger.Conway.Epoch.html#7687" class="Function">getOrphans</a> <a id="9530" href="Ledger.Conway.Epoch.html#9356" class="Bound">es</a> <a id="9533" href="Ledger.Conway.Epoch.html#9413" class="Bound">tmpGovSt</a><a id="9541" class="Symbol">)</a>
      <a id="9549" href="Ledger.Conway.Epoch.html#9549" class="Bound">removed&#39;</a>          <a id="9567" class="Symbol">=</a> <a id="9569" href="Ledger.Conway.Ratify.html#3384" class="Function">removed</a> <a id="9577" href="Axiom.Set.html#8952" class="Function Operator">∪</a> <a id="9579" href="Ledger.Conway.Epoch.html#9489" class="Bound">orphans</a>
      <a id="9593" href="Ledger.Conway.Epoch.html#9593" class="Bound">removedGovActions</a> <a id="9611" class="Symbol">=</a> <a id="9613" href="Function.Base.html#1638" class="Function">flip</a> <a id="9618" href="Axiom.Set.html#7022" class="Function">concatMapˢ</a> <a id="9629" href="Ledger.Conway.Epoch.html#9549" class="Bound">removed&#39;</a> <a id="9638" class="Symbol">λ</a> <a id="9640" class="Symbol">(</a><a id="9641" href="Ledger.Conway.Epoch.html#9641" class="Bound">gaid</a> <a id="9646" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="9648" href="Ledger.Conway.Epoch.html#9648" class="Bound">gaSt</a><a id="9652" class="Symbol">)</a> <a id="9654" class="Symbol">→</a>
        <a id="9664" href="abstract-set-theory.FiniteSetTheory.html#519" class="Function">mapˢ</a> <a id="9669" class="Symbol">(</a><a id="9670" href="Ledger.Conway.GovernanceActions.html#2831" class="Field">returnAddr</a> <a id="9681" href="Ledger.Conway.Epoch.html#9648" class="Bound">gaSt</a> <a id="9686" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,_</a><a id="9688" class="Symbol">)</a> <a id="9690" class="Symbol">((</a><a id="9692" href="Ledger.Conway.Ledger.html#924" class="Function">utxoSt</a> <a id="9699" class="Symbol">.</a><a id="9700" href="Ledger.Conway.Utxo.html#2855" class="Field">deposits</a> <a id="9709" href="Axiom.Set.Map.html#10678" class="Function Operator">∣</a> <a id="9711" href="Class.HasSingleton.html#288" class="Field Operator">❴</a> <a id="9713" href="Ledger.Conway.Certs.html#549" class="InductiveConstructor">GovActionDeposit</a> <a id="9730" href="Ledger.Conway.Epoch.html#9641" class="Bound">gaid</a> <a id="9735" href="Class.HasSingleton.html#288" class="Field Operator">❵</a><a id="9736" class="Symbol">)</a> <a id="9738" href="Axiom.Set.Map.html#2293" class="Function Operator">ˢ</a><a id="9739" class="Symbol">)</a>
      <a id="9747" href="Ledger.Conway.Epoch.html#9747" class="Bound">govActionReturns</a> <a id="9764" class="Symbol">=</a> <a id="9766" href="Axiom.Set.Map.Dec.html#1932" class="Function">aggregate₊</a> <a id="9777" class="Symbol">(</a><a id="9778" href="abstract-set-theory.FiniteSetTheory.html#519" class="Function">mapˢ</a> <a id="9783" class="Symbol">(λ</a> <a id="9786" class="Symbol">(</a><a id="9787" href="Ledger.Conway.Epoch.html#9787" class="Bound">a</a> <a id="9789" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="9791" class="Symbol">_</a> <a id="9793" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="9795" href="Ledger.Conway.Epoch.html#9795" class="Bound">d</a><a id="9796" class="Symbol">)</a> <a id="9798" class="Symbol">→</a> <a id="9800" href="Ledger.Conway.Epoch.html#9787" class="Bound">a</a> <a id="9802" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="9804" href="Ledger.Conway.Epoch.html#9795" class="Bound">d</a><a id="9805" class="Symbol">)</a> <a id="9807" href="Ledger.Conway.Epoch.html#9593" class="Bound">removedGovActions</a> <a id="9825" href="abstract-set-theory.FiniteSetTheory.html#2767" class="Function Operator">ᶠˢ</a><a id="9827" class="Symbol">)</a>

      <a id="9836" href="Ledger.Conway.Epoch.html#9836" class="Bound">trWithdrawals</a>   <a id="9852" class="Symbol">=</a> <a id="9854" href="Ledger.Conway.Epoch.html#9311" class="Bound">esW</a> <a id="9858" class="Symbol">.</a><a id="9859" href="Ledger.Conway.Enact.html#670" class="Field">withdrawals</a>
      <a id="9877" href="Ledger.Conway.Epoch.html#9877" class="Bound">totWithdrawals</a>  <a id="9893" class="Symbol">=</a> <a id="9895" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">∑[</a> <a id="9898" href="Ledger.Conway.Epoch.html#9898" class="Bound">x</a> <a id="9900" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">←</a> <a id="9902" href="Ledger.Conway.Epoch.html#9836" class="Bound">trWithdrawals</a> <a id="9916" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">]</a> <a id="9918" href="Ledger.Conway.Epoch.html#9898" class="Bound">x</a>

      <a id="9927" href="Ledger.Conway.Epoch.html#9927" class="Bound">retired</a>    <a id="9938" class="Symbol">=</a> <a id="9940" class="Symbol">(</a><a id="9941" href="Ledger.Conway.Certs.html#4438" class="Function">pState</a> <a id="9948" class="Symbol">.</a><a id="9949" href="Ledger.Conway.Certs.html#3878" class="Field">retiring</a><a id="9957" class="Symbol">)</a> <a id="9959" href="Axiom.Set.Map.html#14230" class="Function Operator">⁻¹</a> <a id="9962" href="Ledger.Conway.Epoch.html#8754" class="Generalizable">e</a>
      <a id="9970" href="Ledger.Conway.Epoch.html#9970" class="Bound">payout</a>     <a id="9981" class="Symbol">=</a> <a id="9983" href="Ledger.Conway.Epoch.html#9747" class="Bound">govActionReturns</a> <a id="10000" href="Axiom.Set.Map.Dec.html#1854" class="Function Operator">∪⁺</a> <a id="10003" href="Ledger.Conway.Epoch.html#9836" class="Bound">trWithdrawals</a>
      <a id="10023" href="Ledger.Conway.Epoch.html#10023" class="Bound">refunds</a>    <a id="10034" class="Symbol">=</a> <a id="10036" href="Axiom.Set.Map.html#13791" class="Function">pullbackMap</a> <a id="10048" href="Ledger.Conway.Epoch.html#9970" class="Bound">payout</a> <a id="10055" href="Ledger.Conway.Epoch.html#4035" class="Function">toRwdAddr</a> <a id="10065" class="Symbol">(</a><a id="10066" href="Class.IsSet.html#916" class="Function">dom</a> <a id="10070" class="Symbol">(</a><a id="10071" href="Ledger.Conway.Certs.html#4418" class="Function">dState</a> <a id="10078" class="Symbol">.</a><a id="10079" href="Ledger.Conway.Certs.html#3337" class="Field">rewards</a><a id="10086" class="Symbol">))</a>
      <a id="10095" href="Ledger.Conway.Epoch.html#10095" class="Bound">unclaimed</a>  <a id="10106" class="Symbol">=</a> <a id="10108" href="Ledger.Interface.HasCoin.html#172" class="Field">getCoin</a> <a id="10116" href="Ledger.Conway.Epoch.html#9970" class="Bound">payout</a> <a id="10123" href="Interface.HasSubtract.html#209" class="Field Operator">-</a> <a id="10125" href="Ledger.Interface.HasCoin.html#172" class="Field">getCoin</a> <a id="10133" href="Ledger.Conway.Epoch.html#10023" class="Bound">refunds</a>

      <a id="10148" href="Ledger.Conway.Epoch.html#10148" class="Bound">govSt&#39;</a> <a id="10155" class="Symbol">=</a> <a id="10157" href="Ledger.Prelude.html#2692" class="Function">filter</a> <a id="10164" class="Symbol">(λ</a> <a id="10167" href="Ledger.Conway.Epoch.html#10167" class="Bound">x</a> <a id="10169" class="Symbol">→</a> <a id="10171" href="Data.Product.Base.html#636" class="Field">proj₁</a> <a id="10177" href="Ledger.Conway.Epoch.html#10167" class="Bound">x</a> <a id="10179" href="Class.IsSet.html#462" class="Function Operator">∉</a> <a id="10181" href="abstract-set-theory.FiniteSetTheory.html#519" class="Function">mapˢ</a> <a id="10186" href="Data.Product.Base.html#636" class="Field">proj₁</a> <a id="10192" href="Ledger.Conway.Epoch.html#9549" class="Bound">removed&#39;</a><a id="10200" class="Symbol">)</a> <a id="10202" href="Ledger.Conway.Ledger.html#951" class="Function">govSt</a>

      <a id="10215" href="Ledger.Conway.Epoch.html#10215" class="Bound">dState&#39;</a> <a id="10223" class="Symbol">=</a> <a id="10225" href="Ledger.Prelude.html#2441" class="Function Operator">⟦</a> <a id="10227" href="Ledger.Conway.Certs.html#4418" class="Function">dState</a> <a id="10234" class="Symbol">.</a><a id="10235" href="Ledger.Conway.Certs.html#3258" class="Field">voteDelegs</a> <a id="10246" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="10248" href="Ledger.Conway.Certs.html#4418" class="Function">dState</a> <a id="10255" class="Symbol">.</a><a id="10256" href="Ledger.Conway.Certs.html#3297" class="Field">stakeDelegs</a> <a id="10268" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a>  <a id="10271" href="Ledger.Conway.Certs.html#4418" class="Function">dState</a> <a id="10278" class="Symbol">.</a><a id="10279" href="Ledger.Conway.Certs.html#3337" class="Field">rewards</a> <a id="10287" href="Axiom.Set.Map.Dec.html#1854" class="Function Operator">∪⁺</a> <a id="10290" href="Ledger.Conway.Epoch.html#10023" class="Bound">refunds</a> <a id="10298" href="Ledger.Prelude.html#2441" class="Function Operator">⟧</a>

      <a id="10307" href="Ledger.Conway.Epoch.html#10307" class="Bound">pState&#39;</a> <a id="10315" class="Symbol">=</a> <a id="10317" href="Ledger.Prelude.html#2441" class="Function Operator">⟦</a> <a id="10319" href="Ledger.Conway.Certs.html#4438" class="Function">pState</a> <a id="10326" class="Symbol">.</a><a id="10327" href="Ledger.Conway.Certs.html#3841" class="Field">pools</a> <a id="10333" href="Axiom.Set.Map.html#10748" class="Function Operator">∣</a> <a id="10335" href="Ledger.Conway.Epoch.html#9927" class="Bound">retired</a> <a id="10343" href="Axiom.Set.Map.html#10748" class="Function Operator">ᶜ</a> <a id="10345" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="10347" href="Ledger.Conway.Certs.html#4438" class="Function">pState</a> <a id="10354" class="Symbol">.</a><a id="10355" href="Ledger.Conway.Certs.html#3878" class="Field">retiring</a> <a id="10364" href="Axiom.Set.Map.html#10748" class="Function Operator">∣</a> <a id="10366" href="Ledger.Conway.Epoch.html#9927" class="Bound">retired</a> <a id="10374" href="Axiom.Set.Map.html#10748" class="Function Operator">ᶜ</a> <a id="10376" href="Ledger.Prelude.html#2441" class="Function Operator">⟧</a>

      <a id="10385" href="Ledger.Conway.Epoch.html#10385" class="Bound">gState&#39;</a> <a id="10393" class="Symbol">=</a> <a id="10395" href="Ledger.Prelude.html#2441" class="Function Operator">⟦</a> <a id="10397" class="Symbol">(</a><a id="10398" href="Class.ToBool.html#389" class="Function Operator">if</a> <a id="10401" href="Data.List.Base.html#4703" class="Function">null</a> <a id="10406" href="Ledger.Conway.Epoch.html#10148" class="Bound">govSt&#39;</a> <a id="10413" href="Class.ToBool.html#389" class="Function Operator">then</a> <a id="10418" href="Axiom.Set.Map.html#6068" class="Function">mapValues</a> <a id="10428" class="Symbol">(</a><a id="10429" class="Number">1</a> <a id="10431" href="Class.HasAdd.Core.html#162" class="Field Operator">+_</a><a id="10433" class="Symbol">)</a> <a id="10435" class="Symbol">(</a><a id="10436" href="Ledger.Conway.Certs.html#4458" class="Function">gState</a> <a id="10443" class="Symbol">.</a><a id="10444" href="Ledger.Conway.Certs.html#4082" class="Field">dreps</a><a id="10449" class="Symbol">)</a> <a id="10451" href="Class.ToBool.html#389" class="Function Operator">else</a> <a id="10456" class="Symbol">(</a><a id="10457" href="Ledger.Conway.Certs.html#4458" class="Function">gState</a> <a id="10464" class="Symbol">.</a><a id="10465" href="Ledger.Conway.Certs.html#4082" class="Field">dreps</a><a id="10470" class="Symbol">))</a>
                <a id="10489" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="10491" href="Ledger.Conway.Certs.html#4458" class="Function">gState</a> <a id="10498" class="Symbol">.</a><a id="10499" href="Ledger.Conway.Certs.html#4105" class="Field">ccHotKeys</a> <a id="10509" href="Axiom.Set.Map.html#10678" class="Function Operator">∣</a> <a id="10511" href="Ledger.Conway.Enact.html#1215" class="Function">ccCreds</a> <a id="10519" class="Symbol">(</a><a id="10520" href="Ledger.Conway.Epoch.html#9356" class="Bound">es</a> <a id="10523" class="Symbol">.</a><a id="10524" href="Ledger.Conway.Enact.html#454" class="Field">cc</a><a id="10526" class="Symbol">)</a> <a id="10528" href="Ledger.Prelude.html#2441" class="Function Operator">⟧</a>

      <a id="10537" href="Ledger.Conway.Epoch.html#10537" class="Bound">certState&#39;</a> <a id="10548" class="Symbol">:</a> <a id="10550" href="Ledger.Conway.Certs.html#4355" class="Record">CertState</a>
      <a id="10566" href="Ledger.Conway.Epoch.html#10537" class="Bound">certState&#39;</a> <a id="10577" class="Symbol">=</a> <a id="10579" href="Ledger.Prelude.html#2441" class="Function Operator">⟦</a> <a id="10581" href="Ledger.Conway.Epoch.html#10215" class="Bound">dState&#39;</a> <a id="10589" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="10591" href="Ledger.Conway.Epoch.html#10307" class="Bound">pState&#39;</a> <a id="10599" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="10601" href="Ledger.Conway.Epoch.html#10385" class="Bound">gState&#39;</a> <a id="10609" href="Ledger.Prelude.html#2441" class="Function Operator">⟧</a>

      <a id="10618" href="Ledger.Conway.Epoch.html#10618" class="Bound">utxoSt&#39;</a> <a id="10626" class="Symbol">=</a> <a id="10628" href="Ledger.Prelude.html#2441" class="Function Operator">⟦</a> <a id="10630" href="Ledger.Conway.Ledger.html#924" class="Function">utxoSt</a> <a id="10637" class="Symbol">.</a><a id="10638" href="Ledger.Conway.Utxo.html#2811" class="Field">utxo</a> <a id="10643" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="10645" href="Ledger.Conway.Ledger.html#924" class="Function">utxoSt</a> <a id="10652" class="Symbol">.</a><a id="10653" href="Ledger.Conway.Utxo.html#2833" class="Field">fees</a> <a id="10658" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="10660" href="Ledger.Conway.Ledger.html#924" class="Function">utxoSt</a> <a id="10667" class="Symbol">.</a><a id="10668" href="Ledger.Conway.Utxo.html#2855" class="Field">deposits</a> <a id="10677" href="Axiom.Set.Map.html#10748" class="Function Operator">∣</a> <a id="10679" href="abstract-set-theory.FiniteSetTheory.html#519" class="Function">mapˢ</a> <a id="10684" class="Symbol">(</a><a id="10685" href="Data.Product.Base.html#636" class="Field">proj₁</a> <a id="10691" href="Function.Base.html#1115" class="Function Operator">∘</a> <a id="10693" href="Data.Product.Base.html#650" class="Field">proj₂</a><a id="10698" class="Symbol">)</a> <a id="10700" href="Ledger.Conway.Epoch.html#9593" class="Bound">removedGovActions</a> <a id="10718" href="Axiom.Set.Map.html#10748" class="Function Operator">ᶜ</a> <a id="10720" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="10722" class="Number">0</a> <a id="10724" href="Ledger.Prelude.html#2441" class="Function Operator">⟧</a>

      <a id="10733" href="Ledger.Conway.Epoch.html#10733" class="Bound">acnt&#39;</a> <a id="10739" class="Symbol">=</a> <a id="10741" class="Keyword">record</a> <a id="10748" href="Ledger.Conway.Epoch.html#8845" class="Generalizable">acnt</a>
        <a id="10761" class="Symbol">{</a> <a id="10763" href="Ledger.Conway.PParams.html#764" class="Field">treasury</a>  <a id="10773" class="Symbol">=</a> <a id="10775" href="Ledger.Conway.Epoch.html#8845" class="Generalizable">acnt</a> <a id="10780" class="Symbol">.</a><a id="10781" href="Ledger.Conway.PParams.html#764" class="Field">treasury</a> <a id="10790" href="Data.Nat.Base.html#4462" class="Primitive Operator">∸</a> <a id="10792" href="Ledger.Conway.Epoch.html#9877" class="Bound">totWithdrawals</a> <a id="10807" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="10809" href="Ledger.Conway.Ledger.html#924" class="Function">utxoSt</a> <a id="10816" class="Symbol">.</a><a id="10817" href="Ledger.Conway.Utxo.html#2881" class="Field">donations</a> <a id="10827" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="10829" href="Ledger.Conway.Epoch.html#10095" class="Bound">unclaimed</a> <a id="10839" class="Symbol">}</a>
    <a id="10845" class="Keyword">in</a>
    <a id="10852" class="Keyword">record</a> <a id="10859" class="Symbol">{</a> <a id="10861" href="Ledger.Conway.Ratify.html#3089" class="Field">currentEpoch</a> <a id="10874" class="Symbol">=</a> <a id="10876" href="Ledger.Conway.Epoch.html#8754" class="Generalizable">e</a>
           <a id="10889" class="Symbol">;</a> <a id="10891" href="Ledger.Conway.Ratify.html#3057" class="Field">stakeDistrs</a> <a id="10903" class="Symbol">=</a> <a id="10905" href="Ledger.Conway.Epoch.html#8476" class="Function">mkStakeDistrs</a>  <a id="10920" class="Symbol">(</a><a id="10921" href="Ledger.Conway.Rewards.html#6689" class="Field">Snapshots.mark</a> <a id="10936" href="Ledger.Conway.Epoch.html#8939" class="Generalizable">ss&#39;</a><a id="10939" class="Symbol">)</a> <a id="10941" href="Ledger.Conway.Epoch.html#10148" class="Bound">govSt&#39;</a>
                                          <a id="10990" class="Symbol">(</a><a id="10991" href="Ledger.Conway.Epoch.html#10618" class="Bound">utxoSt&#39;</a> <a id="10999" class="Symbol">.</a><a id="11000" href="Ledger.Conway.Utxo.html#2855" class="Field">deposits</a><a id="11008" class="Symbol">)</a> <a id="11010" class="Symbol">(</a><a id="11011" href="Ledger.Conway.Certs.html#3258" class="Field">voteDelegs</a> <a id="11022" href="Ledger.Conway.Certs.html#4418" class="Function">dState</a><a id="11028" class="Symbol">)</a>
           <a id="11041" class="Symbol">;</a> <a id="11043" href="Ledger.Conway.Ratify.html#3204" class="Field">treasury</a> <a id="11052" class="Symbol">=</a> <a id="11054" href="Ledger.Conway.Epoch.html#8845" class="Generalizable">acnt</a> <a id="11059" class="Symbol">.</a><a id="11060" href="Ledger.Conway.PParams.html#764" class="Field">treasury</a> <a id="11069" class="Symbol">;</a> <a id="11071" href="Ledger.Conway.Epoch.html#11071" class="Module">GState</a> <a id="11078" href="Ledger.Conway.Certs.html#4458" class="Function">gState</a>
           <a id="11096" class="Symbol">;</a> <a id="11098" href="Ledger.Conway.Ratify.html#3229" class="Field">pools</a> <a id="11104" class="Symbol">=</a> <a id="11106" href="Ledger.Conway.Certs.html#4438" class="Function">pState</a> <a id="11113" class="Symbol">.</a><a id="11114" href="Ledger.Conway.Certs.html#3841" class="Field">pools</a> <a id="11120" class="Symbol">;</a> <a id="11122" href="Ledger.Conway.Ratify.html#3270" class="Field">delegatees</a> <a id="11133" class="Symbol">=</a> <a id="11135" href="Ledger.Conway.Certs.html#4418" class="Function">dState</a> <a id="11142" class="Symbol">.</a><a id="11143" href="Ledger.Conway.Certs.html#3258" class="Field">voteDelegs</a> <a id="11154" class="Symbol">}</a>
        <a id="11164" href="Ledger.Conway.Ratify.html#11107" class="Function Operator">⊢</a> <a id="11166" href="Ledger.Prelude.html#2441" class="Function Operator">⟦</a> <a id="11168" href="Ledger.Conway.Epoch.html#9356" class="Bound">es</a> <a id="11171" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="11173" href="Class.HasEmptySet.html#287" class="Field">∅</a> <a id="11175" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="11177" href="Agda.Builtin.Bool.html#192" class="InductiveConstructor">false</a> <a id="11183" href="Ledger.Prelude.html#2441" class="Function Operator">⟧</a> <a id="11185" href="Ledger.Conway.Ratify.html#11107" class="Function Operator">⇀⦇</a> <a id="11188" href="Ledger.Conway.Epoch.html#10148" class="Bound">govSt&#39;</a> <a id="11195" href="Ledger.Conway.Ratify.html#11107" class="Function Operator">,RATIFIES⦈</a> <a id="11206" href="Ledger.Conway.Epoch.html#8780" class="Generalizable">fut&#39;</a>
      <a id="11217" class="Symbol">→</a> <a id="11219" href="Ledger.Conway.Epoch.html#8831" class="Generalizable">ls</a> <a id="11222" href="Ledger.Conway.Rewards.html#6928" class="Datatype Operator">⊢</a> <a id="11224" href="Ledger.Conway.Epoch.html#8936" class="Generalizable">ss</a> <a id="11227" href="Ledger.Conway.Rewards.html#6928" class="Datatype Operator">⇀⦇</a> <a id="11230" href="Agda.Builtin.Unit.html#212" class="InductiveConstructor">tt</a> <a id="11233" href="Ledger.Conway.Rewards.html#6928" class="Datatype Operator">,SNAP⦈</a> <a id="11240" href="Ledger.Conway.Epoch.html#8939" class="Generalizable">ss&#39;</a>
    <a id="11248" href="iog-prelude.Prelude.InferenceRules.html#217" class="Function Operator">────────────────────────────────</a>
    <a id="11285" class="Symbol">_</a> <a id="11287" href="Ledger.Conway.Epoch.html#9009" class="Datatype Operator">⊢</a> <a id="11289" href="Ledger.Prelude.html#2441" class="Function Operator">⟦</a> <a id="11291" href="Ledger.Conway.Epoch.html#8845" class="Generalizable">acnt</a> <a id="11296" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="11298" href="Ledger.Conway.Epoch.html#8936" class="Generalizable">ss</a> <a id="11301" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="11303" href="Ledger.Conway.Epoch.html#8831" class="Generalizable">ls</a> <a id="11306" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="11308" href="Ledger.Conway.Epoch.html#8859" class="Generalizable">es₀</a> <a id="11312" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="11314" href="Ledger.Conway.Epoch.html#8776" class="Generalizable">fut</a> <a id="11318" href="Ledger.Prelude.html#2441" class="Function Operator">⟧</a> <a id="11320" href="Ledger.Conway.Epoch.html#9009" class="Datatype Operator">⇀⦇</a> <a id="11323" href="Ledger.Conway.Epoch.html#8754" class="Generalizable">e</a> <a id="11325" href="Ledger.Conway.Epoch.html#9009" class="Datatype Operator">,EPOCH⦈</a>
        <a id="11341" href="Ledger.Prelude.html#2441" class="Function Operator">⟦</a> <a id="11343" href="Ledger.Conway.Epoch.html#10733" class="Bound">acnt&#39;</a> <a id="11349" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="11351" href="Ledger.Conway.Epoch.html#8939" class="Generalizable">ss&#39;</a> <a id="11355" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="11357" href="Ledger.Prelude.html#2441" class="Function Operator">⟦</a> <a id="11359" href="Ledger.Conway.Epoch.html#10618" class="Bound">utxoSt&#39;</a> <a id="11367" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="11369" href="Ledger.Conway.Epoch.html#10148" class="Bound">govSt&#39;</a> <a id="11376" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="11378" href="Ledger.Conway.Epoch.html#10537" class="Bound">certState&#39;</a> <a id="11389" href="Ledger.Prelude.html#2441" class="Function Operator">⟧</a> <a id="11391" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="11393" href="Ledger.Conway.Epoch.html#9356" class="Bound">es</a> <a id="11396" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="11398" href="Ledger.Conway.Epoch.html#8780" class="Generalizable">fut&#39;</a> <a id="11403" href="Ledger.Prelude.html#2441" class="Function Operator">⟧</a>


<a id="11407" class="Keyword">data</a>


  <a id="_⊢_⇀⦇_,NEWEPOCH⦈_"></a><a id="11416" href="Ledger.Conway.Epoch.html#11416" class="Datatype Operator">_⊢_⇀⦇_,NEWEPOCH⦈_</a> <a id="11434" class="Symbol">:</a> <a id="11436" href="Agda.Builtin.Unit.html#175" class="Record">⊤</a> <a id="11438" class="Symbol">→</a> <a id="11440" href="Ledger.Conway.Epoch.html#2483" class="Record">NewEpochState</a> <a id="11454" class="Symbol">→</a> <a id="11456" href="Ledger.Conway.Types.Epoch.html#592" class="Function">Epoch</a> <a id="11462" class="Symbol">→</a> <a id="11464" href="Ledger.Conway.Epoch.html#2483" class="Record">NewEpochState</a> <a id="11478" class="Symbol">→</a> <a id="11480" href="Agda.Primitive.html#388" class="Primitive">Type</a>


  <a id="11489" class="Keyword">where</a>


  <a id="_⊢_⇀⦇_,NEWEPOCH⦈_.NEWEPOCH-New"></a><a id="11499" href="Ledger.Conway.Epoch.html#11499" class="InductiveConstructor">NEWEPOCH-New</a> <a id="11512" class="Symbol">:</a> <a id="11514" class="Keyword">let</a>
      <a id="11524" href="Ledger.Conway.Epoch.html#11524" class="Bound">eps&#39;</a> <a id="11529" class="Symbol">=</a> <a id="11531" href="Ledger.Conway.Epoch.html#6990" class="Function">applyRUpd</a> <a id="11541" href="Ledger.Conway.Epoch.html#8957" class="Generalizable">ru</a> <a id="11544" href="Ledger.Conway.Epoch.html#8801" class="Generalizable">eps</a>
    <a id="11552" class="Keyword">in</a>
    <a id="11559" href="Prelude.InferenceRules.html#56074" class="Function Operator">∙</a> <a id="11561" href="Ledger.Conway.Epoch.html#8754" class="Generalizable">e</a> <a id="11563" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="11565" href="Ledger.Conway.Epoch.html#8756" class="Generalizable">lastEpoch</a> <a id="11575" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="11577" class="Number">1</a>
    <a id="11583" href="iog-prelude.Prelude.InferenceRules.html#583" class="Function Operator">∙</a> <a id="11585" class="Symbol">_</a> <a id="11587" href="Ledger.Conway.Epoch.html#9009" class="Datatype Operator">⊢</a> <a id="11589" href="Ledger.Conway.Epoch.html#11524" class="Bound">eps&#39;</a> <a id="11594" href="Ledger.Conway.Epoch.html#9009" class="Datatype Operator">⇀⦇</a> <a id="11597" href="Ledger.Conway.Epoch.html#8754" class="Generalizable">e</a> <a id="11599" href="Ledger.Conway.Epoch.html#9009" class="Datatype Operator">,EPOCH⦈</a> <a id="11607" href="Ledger.Conway.Epoch.html#8810" class="Generalizable">eps&#39;&#39;</a>
      <a id="11619" href="iog-prelude.Prelude.InferenceRules.html#217" class="Function Operator">────────────────────────────────</a>
      <a id="11658" class="Symbol">_</a> <a id="11660" href="Ledger.Conway.Epoch.html#11416" class="Datatype Operator">⊢</a> <a id="11662" href="Ledger.Prelude.html#2441" class="Function Operator">⟦</a> <a id="11664" href="Ledger.Conway.Epoch.html#8756" class="Generalizable">lastEpoch</a> <a id="11674" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="11676" href="Ledger.Conway.Epoch.html#8801" class="Generalizable">eps</a> <a id="11680" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="11682" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="11687" href="Ledger.Conway.Epoch.html#8957" class="Generalizable">ru</a> <a id="11690" href="Ledger.Prelude.html#2441" class="Function Operator">⟧</a> <a id="11692" href="Ledger.Conway.Epoch.html#11416" class="Datatype Operator">⇀⦇</a> <a id="11695" href="Ledger.Conway.Epoch.html#8754" class="Generalizable">e</a> <a id="11697" href="Ledger.Conway.Epoch.html#11416" class="Datatype Operator">,NEWEPOCH⦈</a> <a id="11708" href="Ledger.Prelude.html#2441" class="Function Operator">⟦</a> <a id="11710" href="Ledger.Conway.Epoch.html#8754" class="Generalizable">e</a> <a id="11712" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="11714" href="Ledger.Conway.Epoch.html#8810" class="Generalizable">eps&#39;&#39;</a> <a id="11720" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="11722" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a> <a id="11730" href="Ledger.Prelude.html#2441" class="Function Operator">⟧</a>

  <a id="_⊢_⇀⦇_,NEWEPOCH⦈_.NEWEPOCH-Not-New"></a><a id="11735" href="Ledger.Conway.Epoch.html#11735" class="InductiveConstructor">NEWEPOCH-Not-New</a> <a id="11752" class="Symbol">:</a>
    <a id="11758" href="Prelude.InferenceRules.html#56074" class="Function Operator">∙</a> <a id="11760" href="Ledger.Conway.Epoch.html#8754" class="Generalizable">e</a> <a id="11762" href="Relation.Binary.PropositionalEquality.Core.html#858" class="Function Operator">≢</a> <a id="11764" href="Ledger.Conway.Epoch.html#8756" class="Generalizable">lastEpoch</a> <a id="11774" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="11776" class="Number">1</a>
      <a id="11784" href="iog-prelude.Prelude.InferenceRules.html#217" class="Function Operator">────────────────────────────────</a>
      <a id="11823" class="Symbol">_</a> <a id="11825" href="Ledger.Conway.Epoch.html#11416" class="Datatype Operator">⊢</a> <a id="11827" href="Ledger.Prelude.html#2441" class="Function Operator">⟦</a> <a id="11829" href="Ledger.Conway.Epoch.html#8756" class="Generalizable">lastEpoch</a> <a id="11839" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="11841" href="Ledger.Conway.Epoch.html#8801" class="Generalizable">eps</a> <a id="11845" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="11847" href="Ledger.Conway.Epoch.html#8977" class="Generalizable">mru</a> <a id="11851" href="Ledger.Prelude.html#2441" class="Function Operator">⟧</a> <a id="11853" href="Ledger.Conway.Epoch.html#11416" class="Datatype Operator">⇀⦇</a> <a id="11856" href="Ledger.Conway.Epoch.html#8754" class="Generalizable">e</a> <a id="11858" href="Ledger.Conway.Epoch.html#11416" class="Datatype Operator">,NEWEPOCH⦈</a> <a id="11869" href="Ledger.Prelude.html#2441" class="Function Operator">⟦</a> <a id="11871" href="Ledger.Conway.Epoch.html#8756" class="Generalizable">lastEpoch</a> <a id="11881" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="11883" href="Ledger.Conway.Epoch.html#8801" class="Generalizable">eps</a> <a id="11887" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="11889" href="Ledger.Conway.Epoch.html#8977" class="Generalizable">mru</a> <a id="11893" href="Ledger.Prelude.html#2441" class="Function Operator">⟧</a>

  <a id="_⊢_⇀⦇_,NEWEPOCH⦈_.NEWEPOCH-No-Reward-Update"></a><a id="11898" href="Ledger.Conway.Epoch.html#11898" class="InductiveConstructor">NEWEPOCH-No-Reward-Update</a> <a id="11924" class="Symbol">:</a>
    <a id="11930" href="Prelude.InferenceRules.html#56074" class="Function Operator">∙</a> <a id="11932" href="Ledger.Conway.Epoch.html#8754" class="Generalizable">e</a> <a id="11934" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="11936" href="Ledger.Conway.Epoch.html#8756" class="Generalizable">lastEpoch</a> <a id="11946" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="11948" class="Number">1</a>
    <a id="11954" href="iog-prelude.Prelude.InferenceRules.html#583" class="Function Operator">∙</a> <a id="11956" class="Symbol">_</a> <a id="11958" href="Ledger.Conway.Epoch.html#9009" class="Datatype Operator">⊢</a> <a id="11960" href="Ledger.Conway.Epoch.html#8801" class="Generalizable">eps</a> <a id="11964" href="Ledger.Conway.Epoch.html#9009" class="Datatype Operator">⇀⦇</a> <a id="11967" href="Ledger.Conway.Epoch.html#8754" class="Generalizable">e</a> <a id="11969" href="Ledger.Conway.Epoch.html#9009" class="Datatype Operator">,EPOCH⦈</a> <a id="11977" href="Ledger.Conway.Epoch.html#8805" class="Generalizable">eps&#39;</a>
      <a id="11988" href="iog-prelude.Prelude.InferenceRules.html#217" class="Function Operator">────────────────────────────────</a>
      <a id="12027" class="Symbol">_</a> <a id="12029" href="Ledger.Conway.Epoch.html#11416" class="Datatype Operator">⊢</a> <a id="12031" href="Ledger.Prelude.html#2441" class="Function Operator">⟦</a> <a id="12033" href="Ledger.Conway.Epoch.html#8756" class="Generalizable">lastEpoch</a> <a id="12043" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="12045" href="Ledger.Conway.Epoch.html#8801" class="Generalizable">eps</a> <a id="12049" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="12051" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a> <a id="12059" href="Ledger.Prelude.html#2441" class="Function Operator">⟧</a> <a id="12061" href="Ledger.Conway.Epoch.html#11416" class="Datatype Operator">⇀⦇</a> <a id="12064" href="Ledger.Conway.Epoch.html#8754" class="Generalizable">e</a> <a id="12066" href="Ledger.Conway.Epoch.html#11416" class="Datatype Operator">,NEWEPOCH⦈</a> <a id="12077" href="Ledger.Prelude.html#2441" class="Function Operator">⟦</a> <a id="12079" href="Ledger.Conway.Epoch.html#8754" class="Generalizable">e</a> <a id="12081" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="12083" href="Ledger.Conway.Epoch.html#8805" class="Generalizable">eps&#39;</a> <a id="12088" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="12090" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a> <a id="12098" href="Ledger.Prelude.html#2441" class="Function Operator">⟧</a>

</pre></body></html>