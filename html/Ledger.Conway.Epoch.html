<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>Ledger.Conway.Epoch</title><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.css"><link rel="stylesheet" href="Agda.css"><script src="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.js"></script><script src="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/contrib/auto-render.min.js"></script><script src="AgdaKaTeX.js" defer=""></script></head><body><pre class="Agda">
<a id="2" class="Symbol">{-#</a> <a id="6" class="Keyword">OPTIONS</a> <a id="14" class="Pragma">--safe</a> <a id="21" class="Symbol">#-}</a>

<a id="26" class="Keyword">open</a> <a id="31" class="Keyword">import</a> <a id="38" href="Data.Integer.html" class="Module">Data.Integer</a> <a id="51" class="Keyword">using</a> <a id="57" class="Symbol">()</a> <a id="60" class="Keyword">renaming</a> <a id="69" class="Symbol">(</a><a id="70" href="Agda.Builtin.Int.html#263" class="InductiveConstructor">+_</a> <a id="73" class="Symbol">to</a> <a id="76" class="InductiveConstructor">pos</a><a id="79" class="Symbol">)</a>
<a id="81" class="Keyword">import</a>      <a id="93" href="Data.Integer.html" class="Module">Data.Integer</a> <a id="106" class="Symbol">as</a> <a id="109" class="Module">ℤ</a>
<a id="111" class="Keyword">open</a> <a id="116" class="Keyword">import</a> <a id="123" href="Data.Integer.Properties.html" class="Module">Data.Integer.Properties</a> <a id="147" class="Keyword">using</a> <a id="153" class="Symbol">(</a><a id="154" class="Keyword">module</a> <a id="161" href="Data.Integer.Properties.html#11677" class="Module">≤-Reasoning</a><a id="172" class="Symbol">;</a> <a id="174" href="Data.Integer.Properties.html#34659" class="Function">+-mono-≤</a><a id="182" class="Symbol">;</a> <a id="184" href="Data.Integer.Properties.html#13094" class="Function">neg-mono-≤</a><a id="194" class="Symbol">;</a> <a id="196" href="Data.Integer.Properties.html#26896" class="Function">+-identityˡ</a><a id="207" class="Symbol">)</a>
                                    <a id="245" class="Keyword">renaming</a> <a id="254" class="Symbol">(</a><a id="255" href="Data.Integer.Properties.html#12304" class="Function">nonNegative⁻¹</a> <a id="269" class="Symbol">to</a> <a id="272" class="Function">nonNegative⁻¹ℤ</a><a id="286" class="Symbol">)</a>
<a id="288" class="Keyword">open</a> <a id="293" class="Keyword">import</a> <a id="300" href="Data.Nat.GeneralisedArithmetic.html" class="Module">Data.Nat.GeneralisedArithmetic</a> <a id="331" class="Keyword">using</a> <a id="337" class="Symbol">(</a><a id="338" href="Data.Nat.GeneralisedArithmetic.html#866" class="Function">iterate</a><a id="345" class="Symbol">)</a>
<a id="347" class="Keyword">open</a> <a id="352" class="Keyword">import</a> <a id="359" href="Data.Rational.html" class="Module">Data.Rational</a> <a id="373" class="Keyword">using</a> <a id="379" class="Symbol">(</a><a id="380" href="Data.Rational.Base.html#1342" class="Record">ℚ</a><a id="381" class="Symbol">;</a> <a id="383" href="Data.Rational.Base.html#7116" class="Function">floor</a><a id="388" class="Symbol">;</a> <a id="390" href="Data.Rational.Base.html#6315" class="Function Operator">_*_</a><a id="393" class="Symbol">;</a> <a id="395" href="Data.Rational.Base.html#6708" class="Function Operator">_÷_</a><a id="398" class="Symbol">;</a> <a id="400" href="Data.Rational.Base.html#3884" class="Function Operator">_/_</a><a id="403" class="Symbol">;</a> <a id="405" href="Data.Rational.Base.html#6854" class="Function Operator">_⊓_</a><a id="408" class="Symbol">;</a> <a id="410" href="Data.Rational.Properties.html#3910" class="Function Operator">_≟_</a><a id="413" class="Symbol">;</a> <a id="415" href="Data.Rational.Base.html#4892" class="Function">≢-nonZero</a><a id="424" class="Symbol">)</a>
<a id="426" class="Keyword">open</a> <a id="431" class="Keyword">import</a> <a id="438" href="Data.Rational.Literals.html" class="Module">Data.Rational.Literals</a> <a id="461" class="Keyword">using</a> <a id="467" class="Symbol">(</a><a id="468" href="Data.Rational.Literals.html#740" class="Function">number</a><a id="474" class="Symbol">;</a> <a id="476" href="Data.Rational.Literals.html#613" class="Function">fromℤ</a><a id="481" class="Symbol">)</a>
<a id="483" class="Keyword">open</a> <a id="488" class="Keyword">import</a> <a id="495" href="Data.Rational.Properties.html" class="Module">Data.Rational.Properties</a> <a id="520" class="Keyword">using</a> <a id="526" class="Symbol">(</a><a id="527" href="Data.Rational.Properties.html#26823" class="Function">nonNegative⁻¹</a><a id="540" class="Symbol">;</a> <a id="542" href="Data.Rational.Properties.html#7313" class="Function">pos⇒nonNeg</a><a id="552" class="Symbol">;</a> <a id="554" href="Algebra.Construct.NaturalChoice.MinOp.html#7026" class="Function">⊓-glb</a><a id="559" class="Symbol">)</a>
<a id="561" class="Keyword">open</a> <a id="566" class="Keyword">import</a> <a id="573" href="stdlib.Data.Rational.Properties.html" class="Module">stdlib.Data.Rational.Properties</a> <a id="605" class="Keyword">using</a> <a id="611" class="Symbol">(</a><a id="612" href="stdlib.Data.Rational.Properties.html#1631" class="Function">0≤⇒0≤floor</a><a id="622" class="Symbol">;</a> <a id="624" href="stdlib.Data.Rational.Properties.html#2865" class="Function">÷-0≤⇒0≤</a><a id="631" class="Symbol">;</a> <a id="633" href="stdlib.Data.Rational.Properties.html#2275" class="Function">fromℕ-0≤</a><a id="641" class="Symbol">;</a> <a id="643" href="stdlib.Data.Rational.Properties.html#2409" class="Function">*-0≤⇒0≤</a><a id="650" class="Symbol">;</a> <a id="652" href="stdlib.Data.Rational.Properties.html#2013" class="Function">fromℤ-0≤</a><a id="660" class="Symbol">)</a>

<a id="663" class="Keyword">open</a> <a id="668" class="Keyword">import</a> <a id="675" href="Data.Integer.Tactic.RingSolver.html" class="Module">Data.Integer.Tactic.RingSolver</a> <a id="706" class="Keyword">using</a> <a id="712" class="Symbol">(</a><a id="713" href="Data.Integer.Tactic.RingSolver.html#1112" class="Function">solve-∀</a><a id="720" class="Symbol">)</a>

<a id="723" class="Keyword">open</a> <a id="728" class="Keyword">import</a> <a id="735" href="Agda.Builtin.FromNat.html" class="Module">Agda.Builtin.FromNat</a>

<a id="757" class="Keyword">open</a> <a id="762" class="Keyword">import</a> <a id="769" href="Ledger.Prelude.html" class="Module">Ledger.Prelude</a> <a id="784" class="Keyword">hiding</a> <a id="791" class="Symbol">(</a><a id="792" href="Data.List.Base.html#5412" class="Function">iterate</a><a id="799" class="Symbol">;</a> <a id="801" href="Data.Nat.Base.html#7102" class="Function Operator">_/_</a><a id="804" class="Symbol">;</a> <a id="806" href="Agda.Builtin.Nat.html#539" class="Primitive Operator">_*_</a><a id="809" class="Symbol">;</a> <a id="811" href="Data.Nat.Base.html#5851" class="Function Operator">_⊓_</a><a id="814" class="Symbol">;</a> <a id="816" href="Class.DecEq.Core.html#159" class="Field Operator">_≟_</a><a id="819" class="Symbol">;</a> <a id="821" href="Data.Nat.Base.html#3425" class="Function">≢-nonZero</a><a id="830" class="Symbol">)</a>
<a id="832" class="Keyword">open</a> <a id="837" href="Ledger.Prelude.html#2438" class="Module">Filter</a> <a id="844" class="Keyword">using</a> <a id="850" class="Symbol">(</a><a id="851" href="Ledger.Prelude.html#2453" class="Function">filter</a><a id="857" class="Symbol">)</a>
<a id="859" class="Keyword">open</a> <a id="864" class="Keyword">import</a> <a id="871" href="Ledger.Conway.Abstract.html" class="Module">Ledger.Conway.Abstract</a>
<a id="894" class="Keyword">open</a> <a id="899" class="Keyword">import</a> <a id="906" href="Ledger.Conway.Transaction.html" class="Module">Ledger.Conway.Transaction</a>
<a id="932" class="Keyword">open</a> <a id="937" class="Keyword">import</a> <a id="944" href="Ledger.Conway.Types.Numeric.UnitInterval.html" class="Module">Ledger.Conway.Types.Numeric.UnitInterval</a>

<a id="986" class="Keyword">open</a> <a id="991" href="Agda.Builtin.FromNat.html#196" class="Module">Number</a> <a id="998" href="Data.Rational.Literals.html#740" class="Function">number</a> <a id="1005" class="Keyword">renaming</a> <a id="1014" class="Symbol">(</a><a id="1015" href="Agda.Builtin.FromNat.html#281" class="Field">fromNat</a> <a id="1023" class="Symbol">to</a> <a id="1026" class="Field">fromℕ</a><a id="1031" class="Symbol">)</a>

<a id="1034" class="Keyword">module</a> <a id="1041" href="Ledger.Conway.Epoch.html" class="Module">Ledger.Conway.Epoch</a>
  <a id="1063" class="Symbol">(</a><a id="1064" href="Ledger.Conway.Epoch.html#1064" class="Bound">txs</a> <a id="1068" class="Symbol">:</a> <a id="1070" class="Symbol">_)</a> <a id="1073" class="Symbol">(</a><a id="1074" class="Keyword">open</a> <a id="1079" href="Ledger.Conway.Transaction.html#872" class="Module">TransactionStructure</a> <a id="1100" href="Ledger.Conway.Epoch.html#1064" class="Bound">txs</a><a id="1103" class="Symbol">)</a>
  <a id="1107" class="Symbol">(</a><a id="1108" href="Ledger.Conway.Epoch.html#1108" class="Bound">abs</a> <a id="1112" class="Symbol">:</a> <a id="1114" href="Ledger.Conway.Abstract.html#599" class="Record">AbstractFunctions</a> <a id="1132" href="Ledger.Conway.Epoch.html#1064" class="Bound">txs</a><a id="1135" class="Symbol">)</a> <a id="1137" class="Symbol">(</a><a id="1138" class="Keyword">open</a> <a id="1143" href="Ledger.Conway.Abstract.html#599" class="Module">AbstractFunctions</a> <a id="1161" href="Ledger.Conway.Epoch.html#1108" class="Bound">abs</a><a id="1164" class="Symbol">)</a>
  <a id="1168" class="Keyword">where</a>

<a id="1175" class="Keyword">open</a> <a id="1180" class="Keyword">import</a> <a id="1187" href="Ledger.Conway.Certs.html" class="Module">Ledger.Conway.Certs</a> <a id="1207" href="Ledger.Conway.Transaction.html#1852" class="Function">govStructure</a>
<a id="1220" class="Keyword">open</a> <a id="1225" class="Keyword">import</a> <a id="1232" href="Ledger.Conway.Enact.html" class="Module">Ledger.Conway.Enact</a> <a id="1252" href="Ledger.Conway.Transaction.html#1852" class="Function">govStructure</a>
<a id="1265" class="Keyword">open</a> <a id="1270" class="Keyword">import</a> <a id="1277" href="Ledger.Conway.Gov.html" class="Module">Ledger.Conway.Gov</a> <a id="1295" href="Ledger.Conway.Epoch.html#1064" class="Bound">txs</a>
<a id="1299" class="Keyword">open</a> <a id="1304" class="Keyword">import</a> <a id="1311" href="Ledger.Conway.Ledger.html" class="Module">Ledger.Conway.Ledger</a> <a id="1332" href="Ledger.Conway.Epoch.html#1064" class="Bound">txs</a> <a id="1336" href="Ledger.Conway.Epoch.html#1108" class="Bound">abs</a>
<a id="1340" class="Keyword">open</a> <a id="1345" class="Keyword">import</a> <a id="1352" href="Ledger.Conway.PoolReap.html" class="Module">Ledger.Conway.PoolReap</a> <a id="1375" href="Ledger.Conway.Epoch.html#1064" class="Bound">txs</a> <a id="1379" href="Ledger.Conway.Epoch.html#1108" class="Bound">abs</a>
<a id="1383" class="Keyword">open</a> <a id="1388" class="Keyword">import</a> <a id="1395" href="Ledger.Conway.Ratify.html" class="Module">Ledger.Conway.Ratify</a> <a id="1416" href="Ledger.Conway.Epoch.html#1064" class="Bound">txs</a>
<a id="1420" class="Keyword">open</a> <a id="1425" class="Keyword">import</a> <a id="1432" href="Ledger.Conway.Rewards.html" class="Module">Ledger.Conway.Rewards</a> <a id="1454" href="Ledger.Conway.Epoch.html#1064" class="Bound">txs</a> <a id="1458" href="Ledger.Conway.Epoch.html#1108" class="Bound">abs</a>
<a id="1462" class="Keyword">open</a> <a id="1467" class="Keyword">import</a> <a id="1474" href="Ledger.Conway.Utxo.html" class="Module">Ledger.Conway.Utxo</a> <a id="1493" href="Ledger.Conway.Epoch.html#1064" class="Bound">txs</a> <a id="1497" href="Ledger.Conway.Epoch.html#1108" class="Bound">abs</a>




<a id="1505" class="Keyword">record</a> <a id="EpochState"></a><a id="1512" href="Ledger.Conway.Epoch.html#1512" class="Record">EpochState</a> <a id="1523" class="Symbol">:</a> <a id="1525" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="1530" class="Keyword">where</a>


  <a id="1540" class="Keyword">constructor</a> <a id="⟦_,_,_,_,_⟧ᵉ&#39;"></a><a id="1552" href="Ledger.Conway.Epoch.html#1552" class="InductiveConstructor Operator">⟦_,_,_,_,_⟧ᵉ&#39;</a>


  <a id="1570" class="Keyword">field</a>
    <a id="EpochState.acnt"></a><a id="1580" href="Ledger.Conway.Epoch.html#1580" class="Field">acnt</a>       <a id="1591" class="Symbol">:</a> <a id="1593" href="Ledger.Conway.PParams.html#686" class="Record">Acnt</a>
    <a id="EpochState.ss"></a><a id="1602" href="Ledger.Conway.Epoch.html#1602" class="Field">ss</a>         <a id="1613" class="Symbol">:</a> <a id="1615" href="Ledger.Conway.Rewards.html#6655" class="Record">Snapshots</a>
    <a id="EpochState.ls"></a><a id="1629" href="Ledger.Conway.Epoch.html#1629" class="Field">ls</a>         <a id="1640" class="Symbol">:</a> <a id="1642" href="Ledger.Conway.Ledger.html#865" class="Record">LState</a>
    <a id="EpochState.es"></a><a id="1653" href="Ledger.Conway.Epoch.html#1653" class="Field">es</a>         <a id="1664" class="Symbol">:</a> <a id="1666" href="Ledger.Conway.Enact.html#402" class="Record">EnactState</a>
    <a id="EpochState.fut"></a><a id="1681" href="Ledger.Conway.Epoch.html#1681" class="Field">fut</a>        <a id="1692" class="Symbol">:</a> <a id="1694" href="Ledger.Conway.Ratify.html#3308" class="Record">RatifyState</a>



<a id="1709" class="Keyword">record</a> <a id="HasEpochState"></a><a id="1716" href="Ledger.Conway.Epoch.html#1716" class="Record">HasEpochState</a> <a id="1730" class="Symbol">{</a><a id="1731" href="Ledger.Conway.Epoch.html#1731" class="Bound">a</a><a id="1732" class="Symbol">}</a> <a id="1734" class="Symbol">(</a><a id="1735" href="Ledger.Conway.Epoch.html#1735" class="Bound">A</a> <a id="1737" class="Symbol">:</a> <a id="1739" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="1744" href="Ledger.Conway.Epoch.html#1731" class="Bound">a</a><a id="1745" class="Symbol">)</a> <a id="1747" class="Symbol">:</a> <a id="1749" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="1754" href="Ledger.Conway.Epoch.html#1731" class="Bound">a</a> <a id="1756" class="Keyword">where</a>
  <a id="1764" class="Keyword">field</a> <a id="HasEpochState.EpochStateOf"></a><a id="1770" href="Ledger.Conway.Epoch.html#1770" class="Field">EpochStateOf</a> <a id="1783" class="Symbol">:</a> <a id="1785" href="Ledger.Conway.Epoch.html#1735" class="Bound">A</a> <a id="1787" class="Symbol">→</a> <a id="1789" href="Ledger.Conway.Epoch.html#1512" class="Record">EpochState</a>
<a id="1800" class="Keyword">open</a> <a id="1805" href="Ledger.Conway.Epoch.html#1716" class="Module">HasEpochState</a> <a id="1819" class="Symbol">⦃...⦄</a> <a id="1825" class="Keyword">public</a>

<a id="1833" class="Keyword">instance</a>
  <a id="HasLState-EpochState"></a><a id="1844" href="Ledger.Conway.Epoch.html#1844" class="Function">HasLState-EpochState</a> <a id="1865" class="Symbol">:</a> <a id="1867" href="Ledger.Conway.Ledger.html#1010" class="Record">HasLState</a> <a id="1877" href="Ledger.Conway.Epoch.html#1512" class="Record">EpochState</a>
  <a id="1890" href="Ledger.Conway.Epoch.html#1844" class="Function">HasLState-EpochState</a> <a id="1911" class="Symbol">.</a><a id="1912" href="Ledger.Conway.Ledger.html#1060" class="Field">LStateOf</a> <a id="1921" class="Symbol">=</a> <a id="1923" href="Ledger.Conway.Epoch.html#1629" class="Field">EpochState.ls</a>

  <a id="HasEnactState-EpochState"></a><a id="1940" href="Ledger.Conway.Epoch.html#1940" class="Function">HasEnactState-EpochState</a> <a id="1965" class="Symbol">:</a> <a id="1967" href="Ledger.Conway.Enact.html#694" class="Record">HasEnactState</a> <a id="1981" href="Ledger.Conway.Epoch.html#1512" class="Record">EpochState</a>
  <a id="1994" href="Ledger.Conway.Epoch.html#1940" class="Function">HasEnactState-EpochState</a> <a id="2019" class="Symbol">.</a><a id="2020" href="Ledger.Conway.Enact.html#748" class="Field">EnactStateOf</a> <a id="2033" class="Symbol">=</a> <a id="2035" href="Ledger.Conway.Epoch.html#1653" class="Field">EpochState.es</a>

  <a id="HasDeposits-EpochState"></a><a id="2052" href="Ledger.Conway.Epoch.html#2052" class="Function">HasDeposits-EpochState</a> <a id="2075" class="Symbol">:</a> <a id="2077" href="Ledger.Conway.Certs.html#657" class="Record">HasDeposits</a> <a id="2089" href="Ledger.Conway.Epoch.html#1512" class="Record">EpochState</a>
  <a id="2102" href="Ledger.Conway.Epoch.html#2052" class="Function">HasDeposits-EpochState</a> <a id="2125" class="Symbol">.</a><a id="2126" href="Ledger.Conway.Certs.html#709" class="Field">DepositsOf</a> <a id="2137" class="Symbol">=</a> <a id="2139" href="Ledger.Conway.Certs.html#709" class="Field">DepositsOf</a> <a id="2150" href="Function.Base.html#1115" class="Function Operator">∘</a> <a id="2152" href="Ledger.Conway.Ledger.html#1060" class="Field">LStateOf</a>

  <a id="Hastreasury-EpochState"></a><a id="2164" href="Ledger.Conway.Epoch.html#2164" class="Function">Hastreasury-EpochState</a> <a id="2187" class="Symbol">:</a> <a id="2189" href="Ledger.Conway.PParams.html#774" class="Record">Hastreasury</a> <a id="2201" href="Ledger.Conway.Epoch.html#1512" class="Record">EpochState</a>
  <a id="2214" href="Ledger.Conway.Epoch.html#2164" class="Function">Hastreasury-EpochState</a> <a id="2237" class="Symbol">.</a><a id="2238" href="Ledger.Conway.PParams.html#826" class="Field">treasuryOf</a> <a id="2249" class="Symbol">=</a> <a id="2251" href="Ledger.Conway.PParams.html#741" class="Field">Acnt.treasury</a> <a id="2265" href="Function.Base.html#1115" class="Function Operator">∘</a> <a id="2267" href="Ledger.Conway.Epoch.html#1580" class="Field">EpochState.acnt</a>

  <a id="Hasreserves-EpochState"></a><a id="2286" href="Ledger.Conway.Epoch.html#2286" class="Function">Hasreserves-EpochState</a> <a id="2309" class="Symbol">:</a> <a id="2311" href="Ledger.Conway.PParams.html#886" class="Record">Hasreserves</a> <a id="2323" href="Ledger.Conway.Epoch.html#1512" class="Record">EpochState</a>
  <a id="2336" href="Ledger.Conway.Epoch.html#2286" class="Function">Hasreserves-EpochState</a> <a id="2359" class="Symbol">.</a><a id="2360" href="Ledger.Conway.PParams.html#938" class="Field">reservesOf</a> <a id="2371" class="Symbol">=</a> <a id="2373" href="Ledger.Conway.PParams.html#750" class="Field">Acnt.reserves</a> <a id="2387" href="Function.Base.html#1115" class="Function Operator">∘</a> <a id="2389" href="Ledger.Conway.Epoch.html#1580" class="Field">EpochState.acnt</a>

  <a id="HasPParams-EpochState"></a><a id="2408" href="Ledger.Conway.Epoch.html#2408" class="Function">HasPParams-EpochState</a> <a id="2430" class="Symbol">:</a> <a id="2432" href="Ledger.Conway.PParams.html#3498" class="Record">HasPParams</a> <a id="2443" href="Ledger.Conway.Epoch.html#1512" class="Record">EpochState</a>
  <a id="2456" href="Ledger.Conway.Epoch.html#2408" class="Function">HasPParams-EpochState</a> <a id="2478" class="Symbol">.</a><a id="2479" href="Ledger.Conway.PParams.html#3549" class="Field">PParamsOf</a> <a id="2489" class="Symbol">=</a> <a id="2491" href="Ledger.Conway.PParams.html#3549" class="Field">PParamsOf</a> <a id="2501" href="Function.Base.html#1115" class="Function Operator">∘</a> <a id="2503" href="Ledger.Conway.Enact.html#748" class="Field">EnactStateOf</a>



<a id="2519" class="Keyword">record</a> <a id="NewEpochState"></a><a id="2526" href="Ledger.Conway.Epoch.html#2526" class="Record">NewEpochState</a> <a id="2540" class="Symbol">:</a> <a id="2542" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="2547" class="Keyword">where</a>
  <a id="2555" class="Keyword">field</a>
    <a id="NewEpochState.lastEpoch"></a><a id="2565" href="Ledger.Conway.Epoch.html#2565" class="Field">lastEpoch</a>   <a id="2577" class="Symbol">:</a> <a id="2579" href="Ledger.Conway.Types.Epoch.html#592" class="Function">Epoch</a>
    <a id="NewEpochState.epochState"></a><a id="2589" href="Ledger.Conway.Epoch.html#2589" class="Field">epochState</a>  <a id="2601" class="Symbol">:</a> <a id="2603" href="Ledger.Conway.Epoch.html#1512" class="Record">EpochState</a>
    <a id="NewEpochState.ru"></a><a id="2618" href="Ledger.Conway.Epoch.html#2618" class="Field">ru</a>          <a id="2630" class="Symbol">:</a> <a id="2632" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="2638" href="Ledger.Conway.Rewards.html#5689" class="Record">RewardUpdate</a>


<a id="2653" class="Keyword">record</a> <a id="HasNewEpochState"></a><a id="2660" href="Ledger.Conway.Epoch.html#2660" class="Record">HasNewEpochState</a> <a id="2677" class="Symbol">{</a><a id="2678" href="Ledger.Conway.Epoch.html#2678" class="Bound">a</a><a id="2679" class="Symbol">}</a> <a id="2681" class="Symbol">(</a><a id="2682" href="Ledger.Conway.Epoch.html#2682" class="Bound">A</a> <a id="2684" class="Symbol">:</a> <a id="2686" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="2691" href="Ledger.Conway.Epoch.html#2678" class="Bound">a</a><a id="2692" class="Symbol">)</a> <a id="2694" class="Symbol">:</a> <a id="2696" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="2701" href="Ledger.Conway.Epoch.html#2678" class="Bound">a</a> <a id="2703" class="Keyword">where</a>
  <a id="2711" class="Keyword">field</a> <a id="HasNewEpochState.NewEpochStateOf"></a><a id="2717" href="Ledger.Conway.Epoch.html#2717" class="Field">NewEpochStateOf</a> <a id="2733" class="Symbol">:</a> <a id="2735" href="Ledger.Conway.Epoch.html#2682" class="Bound">A</a> <a id="2737" class="Symbol">→</a> <a id="2739" href="Ledger.Conway.Epoch.html#2526" class="Record">NewEpochState</a>
<a id="2753" class="Keyword">open</a> <a id="2758" href="Ledger.Conway.Epoch.html#2660" class="Module">HasNewEpochState</a> <a id="2775" class="Symbol">⦃...⦄</a> <a id="2781" class="Keyword">public</a>
<a id="2788" class="Keyword">record</a> <a id="HasLastEpoch"></a><a id="2795" href="Ledger.Conway.Epoch.html#2795" class="Record">HasLastEpoch</a>     <a id="2812" class="Symbol">{</a><a id="2813" href="Ledger.Conway.Epoch.html#2813" class="Bound">a</a><a id="2814" class="Symbol">}</a> <a id="2816" class="Symbol">(</a><a id="2817" href="Ledger.Conway.Epoch.html#2817" class="Bound">A</a> <a id="2819" class="Symbol">:</a> <a id="2821" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="2826" href="Ledger.Conway.Epoch.html#2813" class="Bound">a</a><a id="2827" class="Symbol">)</a> <a id="2829" class="Symbol">:</a> <a id="2831" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="2836" href="Ledger.Conway.Epoch.html#2813" class="Bound">a</a> <a id="2838" class="Keyword">where</a> <a id="2844" class="Keyword">field</a> <a id="HasLastEpoch.LastEpochOf"></a><a id="2850" href="Ledger.Conway.Epoch.html#2850" class="Field">LastEpochOf</a>     <a id="2866" class="Symbol">:</a> <a id="2868" href="Ledger.Conway.Epoch.html#2817" class="Bound">A</a> <a id="2870" class="Symbol">→</a> <a id="2872" href="Ledger.Conway.Types.Epoch.html#592" class="Function">Epoch</a>
<a id="2878" class="Keyword">open</a> <a id="2883" href="Ledger.Conway.Epoch.html#2795" class="Module">HasLastEpoch</a>     <a id="2900" class="Symbol">⦃...⦄</a> <a id="2906" class="Keyword">public</a>

<a id="2914" class="Keyword">instance</a>
  <a id="HasLastEpoch-NewEpochState"></a><a id="2925" href="Ledger.Conway.Epoch.html#2925" class="Function">HasLastEpoch-NewEpochState</a> <a id="2952" class="Symbol">:</a> <a id="2954" href="Ledger.Conway.Epoch.html#2795" class="Record">HasLastEpoch</a> <a id="2967" href="Ledger.Conway.Epoch.html#2526" class="Record">NewEpochState</a>
  <a id="2983" href="Ledger.Conway.Epoch.html#2925" class="Function">HasLastEpoch-NewEpochState</a> <a id="3010" class="Symbol">.</a><a id="3011" href="Ledger.Conway.Epoch.html#2850" class="Field">LastEpochOf</a> <a id="3023" class="Symbol">=</a> <a id="3025" href="Ledger.Conway.Epoch.html#2565" class="Field">NewEpochState.lastEpoch</a>

  <a id="HasEpochState-NewEpochState"></a><a id="3052" href="Ledger.Conway.Epoch.html#3052" class="Function">HasEpochState-NewEpochState</a> <a id="3080" class="Symbol">:</a> <a id="3082" href="Ledger.Conway.Epoch.html#1716" class="Record">HasEpochState</a> <a id="3096" href="Ledger.Conway.Epoch.html#2526" class="Record">NewEpochState</a>
  <a id="3112" href="Ledger.Conway.Epoch.html#3052" class="Function">HasEpochState-NewEpochState</a> <a id="3140" class="Symbol">.</a><a id="3141" href="Ledger.Conway.Epoch.html#1770" class="Field">EpochStateOf</a> <a id="3154" class="Symbol">=</a> <a id="3156" href="Ledger.Conway.Epoch.html#2589" class="Field">NewEpochState.epochState</a>

  <a id="Hastreasury-NewEpochState"></a><a id="3184" href="Ledger.Conway.Epoch.html#3184" class="Function">Hastreasury-NewEpochState</a> <a id="3210" class="Symbol">:</a> <a id="3212" href="Ledger.Conway.PParams.html#774" class="Record">Hastreasury</a> <a id="3224" href="Ledger.Conway.Epoch.html#2526" class="Record">NewEpochState</a>
  <a id="3240" href="Ledger.Conway.Epoch.html#3184" class="Function">Hastreasury-NewEpochState</a> <a id="3266" class="Symbol">.</a><a id="3267" href="Ledger.Conway.PParams.html#826" class="Field">treasuryOf</a> <a id="3278" class="Symbol">=</a> <a id="3280" href="Ledger.Conway.PParams.html#826" class="Field">treasuryOf</a> <a id="3291" href="Function.Base.html#1115" class="Function Operator">∘</a> <a id="3293" href="Ledger.Conway.Epoch.html#1770" class="Field">EpochStateOf</a>

  <a id="HasLState-NewEpochState"></a><a id="3309" href="Ledger.Conway.Epoch.html#3309" class="Function">HasLState-NewEpochState</a> <a id="3333" class="Symbol">:</a> <a id="3335" href="Ledger.Conway.Ledger.html#1010" class="Record">HasLState</a> <a id="3345" href="Ledger.Conway.Epoch.html#2526" class="Record">NewEpochState</a>
  <a id="3361" href="Ledger.Conway.Epoch.html#3309" class="Function">HasLState-NewEpochState</a> <a id="3385" class="Symbol">.</a><a id="3386" href="Ledger.Conway.Ledger.html#1060" class="Field">LStateOf</a> <a id="3395" class="Symbol">=</a> <a id="3397" href="Ledger.Conway.Ledger.html#1060" class="Field">LStateOf</a> <a id="3406" href="Function.Base.html#1115" class="Function Operator">∘</a> <a id="3408" href="Ledger.Conway.Epoch.html#1770" class="Field">EpochStateOf</a>

  <a id="HasGovState-NewEpochState"></a><a id="3424" href="Ledger.Conway.Epoch.html#3424" class="Function">HasGovState-NewEpochState</a> <a id="3450" class="Symbol">:</a> <a id="3452" href="Ledger.Conway.Gov.html#1455" class="Record">HasGovState</a> <a id="3464" href="Ledger.Conway.Epoch.html#2526" class="Record">NewEpochState</a>
  <a id="3480" href="Ledger.Conway.Epoch.html#3424" class="Function">HasGovState-NewEpochState</a> <a id="3506" class="Symbol">.</a><a id="3507" href="Ledger.Conway.Gov.html#1507" class="Field">GovStateOf</a> <a id="3518" class="Symbol">=</a> <a id="3520" href="Ledger.Conway.Gov.html#1507" class="Field">GovStateOf</a> <a id="3531" href="Function.Base.html#1115" class="Function Operator">∘</a> <a id="3533" href="Ledger.Conway.Ledger.html#1060" class="Field">LStateOf</a>

  <a id="HasCertState-NewEpochState"></a><a id="3545" href="Ledger.Conway.Epoch.html#3545" class="Function">HasCertState-NewEpochState</a> <a id="3572" class="Symbol">:</a> <a id="3574" href="Ledger.Conway.Certs.html#4435" class="Record">HasCertState</a> <a id="3587" href="Ledger.Conway.Epoch.html#2526" class="Record">NewEpochState</a>
  <a id="3603" href="Ledger.Conway.Epoch.html#3545" class="Function">HasCertState-NewEpochState</a> <a id="3630" class="Symbol">.</a><a id="3631" href="Ledger.Conway.Certs.html#4488" class="Field">CertStateOf</a> <a id="3643" class="Symbol">=</a> <a id="3645" href="Ledger.Conway.Certs.html#4488" class="Field">CertStateOf</a> <a id="3657" href="Function.Base.html#1115" class="Function Operator">∘</a> <a id="3659" href="Ledger.Conway.Ledger.html#1060" class="Field">LStateOf</a>

  <a id="HasDReps-NewEpochState"></a><a id="3671" href="Ledger.Conway.Epoch.html#3671" class="Function">HasDReps-NewEpochState</a> <a id="3694" class="Symbol">:</a> <a id="3696" href="Ledger.Conway.Certs.html#886" class="Record">HasDReps</a> <a id="3705" href="Ledger.Conway.Epoch.html#2526" class="Record">NewEpochState</a>
  <a id="3721" href="Ledger.Conway.Epoch.html#3671" class="Function">HasDReps-NewEpochState</a> <a id="3744" class="Symbol">.</a><a id="3745" href="Ledger.Conway.Certs.html#935" class="Field">DRepsOf</a> <a id="3753" class="Symbol">=</a> <a id="3755" href="Ledger.Conway.Certs.html#935" class="Field">DRepsOf</a> <a id="3763" href="Function.Base.html#1115" class="Function Operator">∘</a> <a id="3765" href="Ledger.Conway.Certs.html#4488" class="Field">CertStateOf</a>

  <a id="HasRewards-NewEpochState"></a><a id="3780" href="Ledger.Conway.Epoch.html#3780" class="Function">HasRewards-NewEpochState</a> <a id="3805" class="Symbol">:</a> <a id="3807" href="Ledger.Conway.Certs.html#773" class="Record">HasRewards</a> <a id="3818" href="Ledger.Conway.Epoch.html#2526" class="Record">NewEpochState</a>
  <a id="3834" href="Ledger.Conway.Epoch.html#3780" class="Function">HasRewards-NewEpochState</a> <a id="3859" class="Symbol">.</a><a id="3860" href="Ledger.Conway.Certs.html#824" class="Field">RewardsOf</a> <a id="3870" class="Symbol">=</a> <a id="3872" href="Ledger.Conway.Certs.html#824" class="Field">RewardsOf</a> <a id="3882" href="Function.Base.html#1115" class="Function Operator">∘</a> <a id="3884" href="Ledger.Conway.Certs.html#4488" class="Field">CertStateOf</a>

  <a id="3899" class="Keyword">unquoteDecl</a> <a id="HasCast-EpochState"></a><a id="3911" href="Ledger.Conway.Epoch.html#3911" class="Function">HasCast-EpochState</a> <a id="HasCast-NewEpochState"></a><a id="3930" href="Ledger.Conway.Epoch.html#3930" class="Function">HasCast-NewEpochState</a> <a id="HasCast-PlReapState"></a><a id="3952" href="Ledger.Conway.Epoch.html#3952" class="Function">HasCast-PlReapState</a> <a id="3972" class="Symbol">=</a> <a id="3974" href="stdlib-classes.Class.HasCast.Derive.html#2690" class="Function">derive-HasCast</a>
    <a id="3993" class="Symbol">(</a> <a id="3995" class="Symbol">(</a><a id="3996" class="Keyword">quote</a> <a id="4002" href="Ledger.Conway.Epoch.html#1512" class="Record">EpochState</a>     <a id="4017" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="4019" href="Ledger.Conway.Epoch.html#3911" class="Function">HasCast-EpochState</a><a id="4037" class="Symbol">)</a>
    <a id="4043" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="4045" class="Symbol">(</a><a id="4046" class="Keyword">quote</a> <a id="4052" href="Ledger.Conway.PoolReap.html#369" class="Record">PlReapState</a>    <a id="4067" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="4069" href="Ledger.Conway.Epoch.html#3952" class="Function">HasCast-PlReapState</a><a id="4088" class="Symbol">)</a>
    <a id="4094" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="4096" href="Data.List.Base.html#5205" class="Function Operator">[</a> <a id="4098" class="Symbol">(</a><a id="4099" class="Keyword">quote</a> <a id="4105" href="Ledger.Conway.Epoch.html#2526" class="Record">NewEpochState</a>  <a id="4120" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="4122" href="Ledger.Conway.Epoch.html#3930" class="Function">HasCast-NewEpochState</a><a id="4143" class="Symbol">)</a><a id="4144" href="Data.List.Base.html#5205" class="Function Operator">]</a><a id="4145" class="Symbol">)</a>

<a id="toRwdAddr"></a><a id="4148" href="Ledger.Conway.Epoch.html#4148" class="Function">toRwdAddr</a> <a id="4158" class="Symbol">:</a> <a id="4160" href="Ledger.Conway.Address.html#248" class="Datatype">Credential</a> <a id="4171" class="Symbol">→</a> <a id="4173" href="Ledger.Conway.Address.html#1312" class="Record">RwdAddr</a>
<a id="4181" href="Ledger.Conway.Epoch.html#4148" class="Function">toRwdAddr</a> <a id="4191" href="Ledger.Conway.Epoch.html#4191" class="Bound">x</a> <a id="4193" class="Symbol">=</a> <a id="4195" class="Keyword">record</a> <a id="4202" class="Symbol">{</a> <a id="4204" href="Ledger.Conway.Address.html#1341" class="Field">net</a> <a id="4208" class="Symbol">=</a> <a id="4210" href="Ledger.Conway.Types.Epoch.html#2361" class="Function">NetworkId</a> <a id="4220" class="Symbol">;</a> <a id="4222" href="Ledger.Conway.Address.html#1366" class="Field">stake</a> <a id="4228" class="Symbol">=</a> <a id="4230" href="Ledger.Conway.Epoch.html#4191" class="Bound">x</a> <a id="4232" class="Symbol">}</a>

<a id="getStakeCred"></a><a id="4235" href="Ledger.Conway.Epoch.html#4235" class="Function">getStakeCred</a> <a id="4248" class="Symbol">:</a> <a id="4250" href="Ledger.Conway.Transaction.html#2357" class="Function">TxOut</a> <a id="4256" class="Symbol">→</a> <a id="4258" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="4264" href="Ledger.Conway.Address.html#248" class="Datatype">Credential</a>
<a id="4275" href="Ledger.Conway.Epoch.html#4235" class="Function">getStakeCred</a> <a id="4288" class="Symbol">(</a><a id="4289" href="Ledger.Conway.Epoch.html#4289" class="Bound">a</a> <a id="4291" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="4293" class="Symbol">_</a> <a id="4295" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="4297" class="Symbol">_</a> <a id="4299" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="4301" class="Symbol">_)</a> <a id="4304" class="Symbol">=</a> <a id="4306" href="Ledger.Conway.Address.html#2484" class="Function">stakeCred</a> <a id="4316" href="Ledger.Conway.Epoch.html#4289" class="Bound">a</a>

<a id="4319" class="Keyword">open</a> <a id="4324" href="Ledger.Conway.Gov.Actions.html#2712" class="Module">GovActionState</a> <a id="4339" class="Keyword">using</a> <a id="4345" class="Symbol">(</a><a id="4346" href="Ledger.Conway.Gov.Actions.html#2783" class="Field">returnAddr</a><a id="4356" class="Symbol">)</a>


<a id="createRUpd"></a><a id="4360" href="Ledger.Conway.Epoch.html#4360" class="Function">createRUpd</a> <a id="4371" class="Symbol">:</a> <a id="4373" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a> <a id="4375" class="Symbol">→</a> <a id="4377" href="Ledger.Conway.Rewards.html#4406" class="Function">BlocksMade</a> <a id="4388" class="Symbol">→</a> <a id="4390" href="Ledger.Conway.Epoch.html#1512" class="Record">EpochState</a> <a id="4401" class="Symbol">→</a> <a id="4403" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a> <a id="4408" class="Symbol">→</a> <a id="4410" href="Ledger.Conway.Rewards.html#5689" class="Record">RewardUpdate</a>
<a id="4423" href="Ledger.Conway.Epoch.html#4360" class="Function">createRUpd</a> <a id="4434" href="Ledger.Conway.Epoch.html#4434" class="Bound">slotsPerEpoch</a> <a id="4448" href="Ledger.Conway.Epoch.html#4448" class="Bound">b</a> <a id="4450" href="Ledger.Conway.Epoch.html#4450" class="Bound">es</a> <a id="4453" href="Ledger.Conway.Epoch.html#4453" class="Bound">total</a> <a id="4459" class="Symbol">=</a>
  <a id="4463" class="Keyword">record</a>  <a id="4471" class="Symbol">{</a> <a id="4473" href="Ledger.Conway.Rewards.html#5726" class="Field">Δt</a> <a id="4476" class="Symbol">=</a> <a id="4478" href="Ledger.Conway.Epoch.html#5373" class="Function">Δt₁</a>
          <a id="4492" class="Symbol">;</a> <a id="4494" href="Ledger.Conway.Rewards.html#5729" class="Field">Δr</a> <a id="4497" class="Symbol">=</a> <a id="4499" class="Number">0</a> <a id="4501" href="Interface.HasSubtract.html#209" class="Field Operator">-</a> <a id="4503" href="Ledger.Conway.Epoch.html#5218" class="Function">Δr₁</a> <a id="4507" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="4509" href="Ledger.Conway.Epoch.html#5574" class="Function">Δr₂</a>
          <a id="4523" class="Symbol">;</a> <a id="4525" href="Ledger.Conway.Rewards.html#5732" class="Field">Δf</a> <a id="4528" class="Symbol">=</a> <a id="4530" class="Number">0</a> <a id="4532" href="Interface.HasSubtract.html#209" class="Field Operator">-</a> <a id="4534" href="Ledger.Conway.Epoch.html#76" class="InductiveConstructor">pos</a> <a id="4538" href="Ledger.Conway.Epoch.html#4834" class="Function">feeSS</a>
          <a id="4554" class="Symbol">;</a> <a id="4556" href="Ledger.Conway.Rewards.html#5752" class="Field">rs</a> <a id="4559" class="Symbol">=</a> <a id="4561" href="Ledger.Conway.Epoch.html#5491" class="Function">rs</a>


          <a id="4576" class="Symbol">;</a> <a id="4578" href="Ledger.Conway.Rewards.html#5794" class="Field">flowConservation</a> <a id="4595" class="Symbol">=</a> <a id="4597" href="Ledger.Conway.Epoch.html#5858" class="Function">flowConservation</a>
          <a id="4624" class="Symbol">;</a> <a id="4626" href="Ledger.Conway.Rewards.html#5857" class="Field">Δt-nonnegative</a> <a id="4641" class="Symbol">=</a> <a id="4643" href="Ledger.Conway.Epoch.html#6729" class="Function">Δt-nonneg</a>
          <a id="4663" class="Symbol">;</a> <a id="4665" href="Ledger.Conway.Rewards.html#5888" class="Field">Δf-nonpositive</a> <a id="4680" class="Symbol">=</a> <a id="4682" href="Ledger.Conway.Epoch.html#6903" class="Function">Δf-nonpos</a>


          <a id="4704" class="Symbol">}</a>
  <a id="4708" class="Keyword">where</a>
    <a id="4718" href="Ledger.Conway.Epoch.html#4718" class="Function">prevPp</a>       <a id="4731" class="Symbol">=</a> <a id="4733" href="Ledger.Conway.PParams.html#3549" class="Field">PParamsOf</a> <a id="4743" href="Ledger.Conway.Epoch.html#4450" class="Bound">es</a>
    <a id="4750" href="Ledger.Conway.Epoch.html#4750" class="Function">reserves</a>     <a id="4763" class="Symbol">=</a> <a id="4765" href="Ledger.Conway.PParams.html#938" class="Field">reservesOf</a> <a id="4776" href="Ledger.Conway.Epoch.html#4450" class="Bound">es</a>
    <a id="4783" href="Ledger.Conway.Epoch.html#4783" class="Function">pstakego</a>     <a id="4796" class="Symbol">=</a> <a id="4798" href="Ledger.Conway.Epoch.html#4450" class="Bound">es</a> <a id="4801" class="Symbol">.</a><a id="4802" href="Ledger.Conway.Epoch.html#1602" class="Field">EpochState.ss</a> <a id="4816" class="Symbol">.</a><a id="4817" href="Ledger.Conway.Rewards.html#6698" class="Field">Snapshots.go</a>
    <a id="4834" href="Ledger.Conway.Epoch.html#4834" class="Function">feeSS</a>        <a id="4847" class="Symbol">=</a> <a id="4849" href="Ledger.Conway.Epoch.html#4450" class="Bound">es</a> <a id="4852" class="Symbol">.</a><a id="4853" href="Ledger.Conway.Epoch.html#1602" class="Field">EpochState.ss</a> <a id="4867" class="Symbol">.</a><a id="4868" href="Ledger.Conway.Rewards.html#6717" class="Field">Snapshots.feeSS</a>
    <a id="4888" href="Ledger.Conway.Epoch.html#4888" class="Function">stake</a>        <a id="4901" class="Symbol">=</a> <a id="4903" href="Ledger.Conway.Epoch.html#4783" class="Function">pstakego</a> <a id="4912" class="Symbol">.</a><a id="4913" href="Ledger.Conway.Rewards.html#5958" class="Field">Snapshot.stake</a>
    <a id="4932" href="Ledger.Conway.Epoch.html#4932" class="Function">delegs</a>       <a id="4945" class="Symbol">=</a> <a id="4947" href="Ledger.Conway.Epoch.html#4783" class="Function">pstakego</a> <a id="4956" class="Symbol">.</a><a id="4957" href="Ledger.Conway.Rewards.html#5998" class="Field">Snapshot.delegations</a>
    <a id="4982" href="Ledger.Conway.Epoch.html#4982" class="Function">poolParams</a>   <a id="4995" class="Symbol">=</a> <a id="4997" href="Ledger.Conway.Epoch.html#4783" class="Function">pstakego</a> <a id="5006" class="Symbol">.</a><a id="5007" href="Ledger.Conway.Rewards.html#6041" class="Field">Snapshot.poolParameters</a>
    <a id="5035" href="Ledger.Conway.Epoch.html#5035" class="Function">blocksMade</a>   <a id="5048" class="Symbol">=</a> <a id="5050" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">∑[</a> <a id="5053" href="Ledger.Conway.Epoch.html#5053" class="Bound">m</a> <a id="5055" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">←</a> <a id="5057" href="Ledger.Conway.Epoch.html#4448" class="Bound">b</a> <a id="5059" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">]</a> <a id="5061" href="Ledger.Conway.Epoch.html#5053" class="Bound">m</a>
    <a id="5067" href="Ledger.Conway.Epoch.html#5067" class="Function">ρ</a>            <a id="5080" class="Symbol">=</a> <a id="5082" href="Ledger.Conway.Types.Numeric.UnitInterval.html#1993" class="Function">fromUnitInterval</a> <a id="5099" class="Symbol">(</a><a id="5100" href="Ledger.Conway.Epoch.html#4718" class="Function">prevPp</a> <a id="5107" class="Symbol">.</a><a id="5108" href="Ledger.Conway.PParams.html#2290" class="Field">PParams.monetaryExpansion</a><a id="5133" class="Symbol">)</a>
    <a id="5139" href="Ledger.Conway.Epoch.html#5139" class="Function">η</a>            <a id="5152" class="Symbol">=</a> <a id="5154" href="Ledger.Conway.Epoch.html#1026" class="Function">fromℕ</a> <a id="5160" href="Ledger.Conway.Epoch.html#5035" class="Function">blocksMade</a> <a id="5171" href="Ledger.Prelude.html#2066" class="Function Operator">÷₀</a> <a id="5174" class="Symbol">(</a><a id="5175" href="Ledger.Conway.Epoch.html#1026" class="Function">fromℕ</a> <a id="5181" href="Ledger.Conway.Epoch.html#4434" class="Bound">slotsPerEpoch</a> <a id="5195" href="Data.Rational.Base.html#6315" class="Function Operator">*</a> <a id="5197" href="Ledger.Conway.Types.Epoch.html#2222" class="Function">ActiveSlotCoeff</a><a id="5212" class="Symbol">)</a>
    <a id="5218" href="Ledger.Conway.Epoch.html#5218" class="Function">Δr₁</a>          <a id="5231" class="Symbol">=</a> <a id="5233" href="Data.Rational.Base.html#7116" class="Function">floor</a> <a id="5239" class="Symbol">(</a><a id="5240" class="Number">1</a> <a id="5242" href="Data.Rational.Base.html#6854" class="Function Operator">⊓</a> <a id="5244" href="Ledger.Conway.Epoch.html#5139" class="Function">η</a> <a id="5246" href="Data.Rational.Base.html#6315" class="Function Operator">*</a> <a id="5248" href="Ledger.Conway.Epoch.html#5067" class="Function">ρ</a> <a id="5250" href="Data.Rational.Base.html#6315" class="Function Operator">*</a> <a id="5252" href="Ledger.Conway.Epoch.html#1026" class="Function">fromℕ</a> <a id="5258" href="Ledger.Conway.Epoch.html#4750" class="Function">reserves</a><a id="5266" class="Symbol">)</a>
    <a id="5272" href="Ledger.Conway.Epoch.html#5272" class="Function">rewardPot</a>    <a id="5285" class="Symbol">=</a> <a id="5287" href="Ledger.Conway.Epoch.html#76" class="InductiveConstructor">pos</a> <a id="5291" href="Ledger.Conway.Epoch.html#4834" class="Function">feeSS</a> <a id="5297" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="5299" href="Ledger.Conway.Epoch.html#5218" class="Function">Δr₁</a>
    <a id="5307" href="Ledger.Conway.Epoch.html#5307" class="Function">τ</a>            <a id="5320" class="Symbol">=</a> <a id="5322" href="Ledger.Conway.Types.Numeric.UnitInterval.html#1993" class="Function">fromUnitInterval</a> <a id="5339" class="Symbol">(</a><a id="5340" href="Ledger.Conway.Epoch.html#4718" class="Function">prevPp</a> <a id="5347" class="Symbol">.</a><a id="5348" href="Ledger.Conway.PParams.html#2360" class="Field">PParams.treasuryCut</a><a id="5367" class="Symbol">)</a>
    <a id="5373" href="Ledger.Conway.Epoch.html#5373" class="Function">Δt₁</a>          <a id="5386" class="Symbol">=</a> <a id="5388" href="Data.Rational.Base.html#7116" class="Function">floor</a> <a id="5394" class="Symbol">(</a><a id="5395" href="Data.Rational.Literals.html#613" class="Function">fromℤ</a> <a id="5401" href="Ledger.Conway.Epoch.html#5272" class="Function">rewardPot</a> <a id="5411" href="Data.Rational.Base.html#6315" class="Function Operator">*</a> <a id="5413" href="Ledger.Conway.Epoch.html#5307" class="Function">τ</a><a id="5414" class="Symbol">)</a>
    <a id="5420" href="Ledger.Conway.Epoch.html#5420" class="Function">R</a>            <a id="5433" class="Symbol">=</a> <a id="5435" href="Ledger.Conway.Epoch.html#5272" class="Function">rewardPot</a> <a id="5445" href="Interface.HasSubtract.html#209" class="Field Operator">-</a> <a id="5447" href="Ledger.Conway.Epoch.html#5373" class="Function">Δt₁</a>
    <a id="5455" href="Ledger.Conway.Epoch.html#5455" class="Function">circulation</a>  <a id="5468" class="Symbol">=</a> <a id="5470" href="Ledger.Conway.Epoch.html#4453" class="Bound">total</a> <a id="5476" href="Interface.HasSubtract.html#209" class="Field Operator">-</a> <a id="5478" href="Ledger.Conway.Epoch.html#4750" class="Function">reserves</a>
    <a id="5491" href="Ledger.Conway.Epoch.html#5491" class="Function">rs</a>           <a id="5504" class="Symbol">=</a> <a id="5506" href="Ledger.Conway.Rewards.html#4880" class="Function">reward</a> <a id="5513" href="Ledger.Conway.Epoch.html#4718" class="Function">prevPp</a> <a id="5520" href="Ledger.Conway.Epoch.html#4448" class="Bound">b</a> <a id="5522" class="Symbol">(</a><a id="5523" href="Prelude.html#3167" class="Function">posPart</a> <a id="5531" href="Ledger.Conway.Epoch.html#5420" class="Function">R</a><a id="5532" class="Symbol">)</a> <a id="5534" href="Ledger.Conway.Epoch.html#4982" class="Function">poolParams</a> <a id="5545" href="Ledger.Conway.Epoch.html#4888" class="Function">stake</a> <a id="5551" href="Ledger.Conway.Epoch.html#4932" class="Function">delegs</a> <a id="5558" href="Ledger.Conway.Epoch.html#5455" class="Function">circulation</a>
    <a id="5574" href="Ledger.Conway.Epoch.html#5574" class="Function">Δr₂</a>          <a id="5587" class="Symbol">=</a> <a id="5589" href="Ledger.Conway.Epoch.html#5420" class="Function">R</a> <a id="5591" href="Interface.HasSubtract.html#209" class="Field Operator">-</a> <a id="5593" href="Ledger.Conway.Epoch.html#76" class="InductiveConstructor">pos</a> <a id="5597" class="Symbol">(</a><a id="5598" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">∑[</a> <a id="5601" href="Ledger.Conway.Epoch.html#5601" class="Bound">c</a> <a id="5603" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">←</a> <a id="5605" href="Ledger.Conway.Epoch.html#5491" class="Function">rs</a> <a id="5608" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">]</a> <a id="5610" href="Ledger.Conway.Epoch.html#5601" class="Bound">c</a><a id="5611" class="Symbol">)</a>



    <a id="5620" class="Comment">-- Proofs</a>
    <a id="5634" class="Comment">-- Note: Overloading of + and - seems to interfere with</a>
    <a id="5694" class="Comment">-- the ring solver.</a>
    <a id="5718" href="Ledger.Conway.Epoch.html#5718" class="Function">lemmaFlow</a> <a id="5728" class="Symbol">:</a> <a id="5730" class="Symbol">∀</a> <a id="5732" class="Symbol">(</a><a id="5733" href="Ledger.Conway.Epoch.html#5733" class="Bound">t₁</a> <a id="5736" href="Ledger.Conway.Epoch.html#5736" class="Bound">r₁</a> <a id="5739" href="Ledger.Conway.Epoch.html#5739" class="Bound">f</a> <a id="5741" href="Ledger.Conway.Epoch.html#5741" class="Bound">z</a> <a id="5743" class="Symbol">:</a> <a id="5745" href="Agda.Builtin.Int.html#245" class="Datatype">ℤ</a><a id="5746" class="Symbol">)</a>
      <a id="5754" class="Symbol">→</a> <a id="5756" class="Symbol">(</a><a id="5757" href="Ledger.Conway.Epoch.html#5733" class="Bound">t₁</a> <a id="5760" href="Data.Integer.Base.html#5064" class="Function Operator">ℤ.+</a> <a id="5764" class="Symbol">(</a><a id="5765" class="Number">0</a> <a id="5767" href="Data.Integer.Base.html#5245" class="Function Operator">ℤ.-</a> <a id="5771" href="Ledger.Conway.Epoch.html#5736" class="Bound">r₁</a> <a id="5774" href="Data.Integer.Base.html#5064" class="Function Operator">ℤ.+</a> <a id="5778" class="Symbol">((</a><a id="5780" href="Ledger.Conway.Epoch.html#5739" class="Bound">f</a> <a id="5782" href="Data.Integer.Base.html#5064" class="Function Operator">ℤ.+</a> <a id="5786" href="Ledger.Conway.Epoch.html#5736" class="Bound">r₁</a> <a id="5789" href="Data.Integer.Base.html#5245" class="Function Operator">ℤ.-</a> <a id="5793" href="Ledger.Conway.Epoch.html#5733" class="Bound">t₁</a><a id="5795" class="Symbol">)</a> <a id="5797" href="Data.Integer.Base.html#5245" class="Function Operator">ℤ.-</a> <a id="5801" href="Ledger.Conway.Epoch.html#5741" class="Bound">z</a><a id="5802" class="Symbol">))</a> <a id="5805" href="Data.Integer.Base.html#5064" class="Function Operator">ℤ.+</a> <a id="5809" class="Symbol">(</a><a id="5810" class="Number">0</a> <a id="5812" href="Data.Integer.Base.html#5245" class="Function Operator">ℤ.-</a> <a id="5816" href="Ledger.Conway.Epoch.html#5739" class="Bound">f</a><a id="5817" class="Symbol">)</a> <a id="5819" href="Data.Integer.Base.html#5064" class="Function Operator">ℤ.+</a> <a id="5823" href="Ledger.Conway.Epoch.html#5741" class="Bound">z</a><a id="5824" class="Symbol">)</a> <a id="5826" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="5828" class="Number">0</a>
    <a id="5834" href="Ledger.Conway.Epoch.html#5718" class="Function">lemmaFlow</a> <a id="5844" class="Symbol">=</a> <a id="5846" href="Data.Integer.Tactic.RingSolver.html#1112" class="Macro">solve-∀</a>
    <a id="5858" href="Ledger.Conway.Epoch.html#5858" class="Function">flowConservation</a> <a id="5875" class="Symbol">=</a> <a id="5877" href="Ledger.Conway.Epoch.html#5718" class="Function">lemmaFlow</a> <a id="5887" href="Ledger.Conway.Epoch.html#5373" class="Function">Δt₁</a> <a id="5891" href="Ledger.Conway.Epoch.html#5218" class="Function">Δr₁</a> <a id="5895" class="Symbol">(</a><a id="5896" href="Ledger.Conway.Epoch.html#76" class="InductiveConstructor">pos</a> <a id="5900" href="Ledger.Conway.Epoch.html#4834" class="Function">feeSS</a><a id="5905" class="Symbol">)</a> <a id="5907" class="Symbol">(</a><a id="5908" href="Ledger.Conway.Epoch.html#76" class="InductiveConstructor">pos</a> <a id="5912" class="Symbol">(</a><a id="5913" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">∑[</a> <a id="5916" href="Ledger.Conway.Epoch.html#5916" class="Bound">c</a> <a id="5918" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">←</a> <a id="5920" href="Ledger.Conway.Epoch.html#5491" class="Function">rs</a> <a id="5923" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">]</a> <a id="5925" href="Ledger.Conway.Epoch.html#5916" class="Bound">c</a><a id="5926" class="Symbol">))</a>

    <a id="5934" href="Ledger.Conway.Epoch.html#5934" class="Function">÷₀-0≤⇒0≤</a> <a id="5943" class="Symbol">:</a> <a id="5945" class="Symbol">∀</a> <a id="5947" class="Symbol">(</a><a id="5948" href="Ledger.Conway.Epoch.html#5948" class="Bound">x</a> <a id="5950" href="Ledger.Conway.Epoch.html#5950" class="Bound">y</a> <a id="5952" class="Symbol">:</a> <a id="5954" href="Data.Rational.Base.html#1342" class="Record">ℚ</a><a id="5955" class="Symbol">)</a> <a id="5957" class="Symbol">→</a> <a id="5959" class="Number">0</a> <a id="5961" href="Class.HasOrder.Core.html#608" class="Field Operator">≤</a> <a id="5963" href="Ledger.Conway.Epoch.html#5948" class="Bound">x</a> <a id="5965" class="Symbol">→</a> <a id="5967" class="Number">0</a> <a id="5969" href="Class.HasOrder.Core.html#608" class="Field Operator">≤</a> <a id="5971" href="Ledger.Conway.Epoch.html#5950" class="Bound">y</a> <a id="5973" class="Symbol">→</a> <a id="5975" class="Number">0</a> <a id="5977" href="Class.HasOrder.Core.html#608" class="Field Operator">≤</a> <a id="5979" class="Symbol">(</a><a id="5980" href="Ledger.Conway.Epoch.html#5948" class="Bound">x</a> <a id="5982" href="Ledger.Prelude.html#2066" class="Function Operator">÷₀</a> <a id="5985" href="Ledger.Conway.Epoch.html#5950" class="Bound">y</a><a id="5986" class="Symbol">)</a>
    <a id="5992" href="Ledger.Conway.Epoch.html#5934" class="Function">÷₀-0≤⇒0≤</a> <a id="6001" href="Ledger.Conway.Epoch.html#6001" class="Bound">x</a> <a id="6003" href="Ledger.Conway.Epoch.html#6003" class="Bound">y</a> <a id="6005" href="Ledger.Conway.Epoch.html#6005" class="Bound">0≤x</a> <a id="6009" href="Ledger.Conway.Epoch.html#6009" class="Bound">0≤y</a> <a id="6013" class="Keyword">with</a> <a id="6018" href="Ledger.Conway.Epoch.html#6003" class="Bound">y</a> <a id="6020" href="Data.Rational.Properties.html#3910" class="Function Operator">≟</a> <a id="6022" class="Number">0</a>
    <a id="6028" class="Symbol">...</a> <a id="6032" class="Symbol">|</a> <a id="6034" class="Symbol">(</a><a id="6035" href="Relation.Nullary.Decidable.Core.html#1994" class="InductiveConstructor">yes</a> <a id="6039" href="Ledger.Conway.Epoch.html#6039" class="Bound">y≡0</a><a id="6042" class="Symbol">)</a> <a id="6044" class="Symbol">=</a> <a id="6046" href="Data.Rational.Properties.html#26823" class="Function">nonNegative⁻¹</a> <a id="6060" class="Number">0</a>
    <a id="6066" class="Symbol">...</a> <a id="6070" class="Symbol">|</a> <a id="6072" class="Symbol">(</a><a id="6073" href="Relation.Nullary.Decidable.Core.html#2031" class="InductiveConstructor">no</a> <a id="6076" href="Ledger.Conway.Epoch.html#6076" class="Bound">y≢0</a><a id="6079" class="Symbol">)</a>  <a id="6082" class="Symbol">=</a> <a id="6084" href="stdlib.Data.Rational.Properties.html#2865" class="Function">÷-0≤⇒0≤</a> <a id="6092" class="Bound">x</a> <a id="6094" class="Bound">y</a> <a id="6096" class="Symbol">{{</a><a id="6098" href="Data.Rational.Base.html#4892" class="Function">≢-nonZero</a> <a id="6108" href="Ledger.Conway.Epoch.html#6076" class="Bound">y≢0</a><a id="6111" class="Symbol">}}</a> <a id="6114" class="Bound">0≤x</a> <a id="6118" class="Bound">0≤y</a>

    <a id="6127" href="Ledger.Conway.Epoch.html#6127" class="Function">η-nonneg</a> <a id="6136" class="Symbol">:</a> <a id="6138" class="Number">0</a> <a id="6140" href="Class.HasOrder.Core.html#608" class="Field Operator">≤</a> <a id="6142" href="Ledger.Conway.Epoch.html#5139" class="Function">η</a>
    <a id="6148" href="Ledger.Conway.Epoch.html#6127" class="Function">η-nonneg</a> <a id="6157" class="Symbol">=</a> <a id="6159" href="Ledger.Conway.Epoch.html#5934" class="Function">÷₀-0≤⇒0≤</a> <a id="6168" class="Symbol">_</a> <a id="6170" class="Symbol">_</a> <a id="6172" class="Symbol">(</a><a id="6173" href="stdlib.Data.Rational.Properties.html#2275" class="Function">fromℕ-0≤</a> <a id="6182" href="Ledger.Conway.Epoch.html#5035" class="Function">blocksMade</a><a id="6192" class="Symbol">)</a>
      <a id="6200" class="Symbol">(</a><a id="6201" href="stdlib.Data.Rational.Properties.html#2409" class="Function">*-0≤⇒0≤</a> <a id="6209" class="Symbol">_</a> <a id="6211" class="Symbol">_</a>
        <a id="6221" class="Symbol">(</a><a id="6222" href="stdlib.Data.Rational.Properties.html#2275" class="Function">fromℕ-0≤</a> <a id="6231" href="Ledger.Conway.Epoch.html#4434" class="Bound">slotsPerEpoch</a><a id="6244" class="Symbol">)</a>
        <a id="6254" class="Symbol">(</a><a id="6255" href="Data.Rational.Properties.html#26823" class="Function">nonNegative⁻¹</a> <a id="6269" href="Ledger.Conway.Types.Epoch.html#2222" class="Function">ActiveSlotCoeff</a> <a id="6285" class="Symbol">{{</a><a id="6287" href="Data.Rational.Properties.html#7313" class="Function">pos⇒nonNeg</a> <a id="6298" href="Ledger.Conway.Types.Epoch.html#2222" class="Function">ActiveSlotCoeff</a><a id="6313" class="Symbol">}}))</a>

    <a id="6323" href="Ledger.Conway.Epoch.html#6323" class="Function">min1η-nonneg</a> <a id="6336" class="Symbol">:</a> <a id="6338" class="Number">0</a> <a id="6340" href="Class.HasOrder.Core.html#608" class="Field Operator">≤</a> <a id="6342" class="Number">1</a> <a id="6344" href="Data.Rational.Base.html#6854" class="Function Operator">⊓</a> <a id="6346" href="Ledger.Conway.Epoch.html#5139" class="Function">η</a>
    <a id="6352" href="Ledger.Conway.Epoch.html#6323" class="Function">min1η-nonneg</a> <a id="6365" class="Symbol">=</a> <a id="6367" href="Algebra.Construct.NaturalChoice.MinOp.html#7026" class="Function">⊓-glb</a> <a id="6373" class="Symbol">(</a><a id="6374" href="Data.Rational.Properties.html#26823" class="Function">nonNegative⁻¹</a> <a id="6388" class="Number">1</a><a id="6389" class="Symbol">)</a> <a id="6391" href="Ledger.Conway.Epoch.html#6127" class="Function">η-nonneg</a>

    <a id="6405" href="Ledger.Conway.Epoch.html#6405" class="Function">Δr₁-nonneg</a> <a id="6416" class="Symbol">:</a> <a id="6418" class="Number">0</a> <a id="6420" href="Class.HasOrder.Core.html#608" class="Field Operator">≤</a> <a id="6422" href="Ledger.Conway.Epoch.html#5218" class="Function">Δr₁</a>
    <a id="6430" href="Ledger.Conway.Epoch.html#6405" class="Function">Δr₁-nonneg</a> <a id="6441" class="Symbol">=</a> <a id="6443" href="stdlib.Data.Rational.Properties.html#1631" class="Function">0≤⇒0≤floor</a> <a id="6454" class="Symbol">_</a>
      <a id="6462" class="Symbol">(</a><a id="6463" href="stdlib.Data.Rational.Properties.html#2409" class="Function">*-0≤⇒0≤</a> <a id="6471" class="Symbol">(</a><a id="6472" class="Number">1</a> <a id="6474" href="Data.Rational.Base.html#6854" class="Function Operator">⊓</a> <a id="6476" href="Ledger.Conway.Epoch.html#5139" class="Function">η</a> <a id="6478" href="Data.Rational.Base.html#6315" class="Function Operator">*</a> <a id="6480" href="Ledger.Conway.Epoch.html#5067" class="Function">ρ</a><a id="6481" class="Symbol">)</a> <a id="6483" class="Symbol">(</a><a id="6484" href="Ledger.Conway.Epoch.html#1026" class="Function">fromℕ</a> <a id="6490" href="Ledger.Conway.Epoch.html#4750" class="Function">reserves</a><a id="6498" class="Symbol">)</a>
        <a id="6508" class="Symbol">(</a><a id="6509" href="Ledger.Conway.Types.Numeric.UnitInterval.html#3341" class="Function">UnitInterval-*-0≤</a> <a id="6527" class="Symbol">(</a><a id="6528" class="Number">1</a> <a id="6530" href="Data.Rational.Base.html#6854" class="Function Operator">⊓</a> <a id="6532" href="Ledger.Conway.Epoch.html#5139" class="Function">η</a><a id="6533" class="Symbol">)</a> <a id="6535" class="Symbol">(</a><a id="6536" href="Ledger.Conway.Epoch.html#4718" class="Function">prevPp</a> <a id="6543" class="Symbol">.</a><a id="6544" href="Ledger.Conway.PParams.html#2290" class="Field">PParams.monetaryExpansion</a><a id="6569" class="Symbol">)</a> <a id="6571" href="Ledger.Conway.Epoch.html#6323" class="Function">min1η-nonneg</a><a id="6583" class="Symbol">)</a>
        <a id="6593" class="Symbol">(</a><a id="6594" href="stdlib.Data.Rational.Properties.html#2275" class="Function">fromℕ-0≤</a> <a id="6603" href="Ledger.Conway.Epoch.html#4750" class="Function">reserves</a><a id="6611" class="Symbol">))</a>

    <a id="6619" href="Ledger.Conway.Epoch.html#6619" class="Function">rewardPot-nonneg</a> <a id="6636" class="Symbol">:</a> <a id="6638" class="Number">0</a> <a id="6640" href="Class.HasOrder.Core.html#608" class="Field Operator">≤</a> <a id="6642" href="Ledger.Conway.Epoch.html#5272" class="Function">rewardPot</a>
    <a id="6656" href="Ledger.Conway.Epoch.html#6619" class="Function">rewardPot-nonneg</a> <a id="6673" class="Symbol">=</a> <a id="6675" href="Data.Integer.Properties.html#34659" class="Function">+-mono-≤</a> <a id="6684" class="Symbol">(</a><a id="6685" href="Ledger.Conway.Epoch.html#272" class="Function">nonNegative⁻¹ℤ</a> <a id="6700" class="Symbol">(</a><a id="6701" href="Ledger.Conway.Epoch.html#76" class="InductiveConstructor">pos</a> <a id="6705" href="Ledger.Conway.Epoch.html#4834" class="Function">feeSS</a><a id="6710" class="Symbol">))</a> <a id="6713" href="Ledger.Conway.Epoch.html#6405" class="Function">Δr₁-nonneg</a>

    <a id="6729" href="Ledger.Conway.Epoch.html#6729" class="Function">Δt-nonneg</a> <a id="6739" class="Symbol">:</a> <a id="6741" class="Number">0</a> <a id="6743" href="Class.HasOrder.Core.html#608" class="Field Operator">≤</a> <a id="6745" href="Ledger.Conway.Epoch.html#5373" class="Function">Δt₁</a>
    <a id="6753" href="Ledger.Conway.Epoch.html#6729" class="Function">Δt-nonneg</a> <a id="6763" class="Symbol">=</a> <a id="6765" href="stdlib.Data.Rational.Properties.html#1631" class="Function">0≤⇒0≤floor</a> <a id="6776" class="Symbol">_</a>
      <a id="6784" class="Symbol">(</a><a id="6785" href="Ledger.Conway.Types.Numeric.UnitInterval.html#3341" class="Function">UnitInterval-*-0≤</a> <a id="6803" class="Symbol">(</a><a id="6804" href="Data.Rational.Literals.html#613" class="Function">fromℤ</a> <a id="6810" href="Ledger.Conway.Epoch.html#5272" class="Function">rewardPot</a><a id="6819" class="Symbol">)</a> <a id="6821" class="Symbol">(</a><a id="6822" href="Ledger.Conway.Epoch.html#4718" class="Function">prevPp</a> <a id="6829" class="Symbol">.</a><a id="6830" href="Ledger.Conway.PParams.html#2360" class="Field">PParams.treasuryCut</a><a id="6849" class="Symbol">)</a>
        <a id="6859" class="Symbol">(</a><a id="6860" href="stdlib.Data.Rational.Properties.html#2013" class="Function">fromℤ-0≤</a> <a id="6869" href="Ledger.Conway.Epoch.html#5272" class="Function">rewardPot</a> <a id="6879" href="Ledger.Conway.Epoch.html#6619" class="Function">rewardPot-nonneg</a><a id="6895" class="Symbol">))</a>

    <a id="6903" href="Ledger.Conway.Epoch.html#6903" class="Function">Δf-nonpos</a> <a id="6913" class="Symbol">:</a> <a id="6915" class="Symbol">(</a><a id="6916" class="Number">0</a> <a id="6918" href="Interface.HasSubtract.html#209" class="Field Operator">-</a> <a id="6920" href="Ledger.Conway.Epoch.html#76" class="InductiveConstructor">pos</a> <a id="6924" href="Ledger.Conway.Epoch.html#4834" class="Function">feeSS</a><a id="6929" class="Symbol">)</a> <a id="6931" href="Class.HasOrder.Core.html#608" class="Field Operator">≤</a> <a id="6933" class="Number">0</a>
    <a id="6939" href="Ledger.Conway.Epoch.html#6903" class="Function">Δf-nonpos</a> <a id="6949" class="Symbol">=</a> <a id="6951" href="Relation.Binary.Reasoning.Syntax.html#1572" class="Function Operator">begin</a>
        <a id="6965" class="Number">0</a> <a id="6967" href="Interface.HasSubtract.html#209" class="Field Operator">-</a> <a id="6969" href="Ledger.Conway.Epoch.html#76" class="InductiveConstructor">pos</a> <a id="6973" href="Ledger.Conway.Epoch.html#4834" class="Function">feeSS</a> <a id="6979" href="Relation.Binary.Reasoning.Syntax.html#11048" class="Function">≡⟨</a> <a id="6982" href="Data.Integer.Properties.html#26896" class="Function">+-identityˡ</a> <a id="6994" class="Symbol">_</a> <a id="6996" href="Relation.Binary.Reasoning.Syntax.html#11048" class="Function">⟩</a>
        <a id="7006" href="Data.Integer.Base.html#4719" class="Function Operator">ℤ.-</a> <a id="7010" href="Ledger.Conway.Epoch.html#76" class="InductiveConstructor">pos</a> <a id="7014" href="Ledger.Conway.Epoch.html#4834" class="Function">feeSS</a> <a id="7020" href="Relation.Binary.Reasoning.Syntax.html#5544" class="Function">≤⟨</a> <a id="7023" href="Data.Integer.Properties.html#13094" class="Function">neg-mono-≤</a> <a id="7034" class="Symbol">(</a><a id="7035" href="Data.Integer.Base.html#2106" class="InductiveConstructor">ℤ.+≤+</a> <a id="7041" href="Data.Nat.Base.html#1720" class="InductiveConstructor">z≤n</a><a id="7044" class="Symbol">)</a> <a id="7046" href="Relation.Binary.Reasoning.Syntax.html#5544" class="Function">⟩</a>
        <a id="7056" class="Number">0</a>             <a id="7070" href="Relation.Binary.Reasoning.Syntax.html#12345" class="Function Operator">∎</a>
      <a id="7078" class="Keyword">where</a> <a id="7084" class="Keyword">open</a> <a id="7089" href="Data.Integer.Properties.html#11677" class="Module">≤-Reasoning</a>


<a id="applyRUpd"></a><a id="7103" href="Ledger.Conway.Epoch.html#7103" class="Function">applyRUpd</a> <a id="7113" class="Symbol">:</a> <a id="7115" href="Ledger.Conway.Rewards.html#5689" class="Record">RewardUpdate</a> <a id="7128" class="Symbol">→</a> <a id="7130" href="Ledger.Conway.Epoch.html#1512" class="Record">EpochState</a> <a id="7141" class="Symbol">→</a> <a id="7143" href="Ledger.Conway.Epoch.html#1512" class="Record">EpochState</a>
<a id="7154" href="Ledger.Conway.Epoch.html#7103" class="Function">applyRUpd</a> <a id="7164" href="Ledger.Conway.Epoch.html#7164" class="Bound">rewardUpdate</a>
  <a class="AgdaKaTeX">$\begin{pmatrix} \begin{pmatrix} \,\href{Ledger.Conway.Epoch.html#7183}{\htmlId{7183}{\htmlClass{Bound}{\text{treasury}}}}\, \\ \,\href{Ledger.Conway.Epoch.html#7194}{\htmlId{7194}{\htmlClass{Bound}{\text{reserves}}}}\, \end{pmatrix}
  \\ \,\href{Ledger.Conway.Epoch.html#7210}{\htmlId{7210}{\htmlClass{Bound}{\text{ss}}}}\,
  \\ \begin{pmatrix} \begin{pmatrix} \,\href{Ledger.Conway.Epoch.html#7221}{\htmlId{7221}{\htmlClass{Bound}{\text{utxo}}}}\, \\ \,\href{Ledger.Conway.Epoch.html#7228}{\htmlId{7228}{\htmlClass{Bound}{\text{fees}}}}\, \\ \,\href{Ledger.Conway.Epoch.html#7235}{\htmlId{7235}{\htmlClass{Bound}{\text{deposits}}}}\, \\ \,\href{Ledger.Conway.Epoch.html#7246}{\htmlId{7246}{\htmlClass{Bound}{\text{donations}}}}\, \end{pmatrix}
    \\ \,\href{Ledger.Conway.Epoch.html#7265}{\htmlId{7265}{\htmlClass{Bound}{\text{govSt}}}}\,
    \\ \begin{pmatrix} \begin{pmatrix} \,\href{Ledger.Conway.Epoch.html#7281}{\htmlId{7281}{\htmlClass{Bound}{\text{voteDelegs}}}}\, \\ \,\href{Ledger.Conway.Epoch.html#7294}{\htmlId{7294}{\htmlClass{Bound}{\text{stakeDelegs}}}}\, \\ \,\href{Ledger.Conway.Epoch.html#7308}{\htmlId{7308}{\htmlClass{Bound}{\text{rewards}}}}\, \end{pmatrix} \\ \,\href{Ledger.Conway.Epoch.html#7321}{\htmlId{7321}{\htmlClass{Bound}{\text{pState}}}}\, \\ \,\href{Ledger.Conway.Epoch.html#7330}{\htmlId{7330}{\htmlClass{Bound}{\text{gState}}}}\, \end{pmatrix} \end{pmatrix}
  \\ \,\href{Ledger.Conway.Epoch.html#7348}{\htmlId{7348}{\htmlClass{Bound}{\text{es}}}}\,
  \\ \,\href{Ledger.Conway.Epoch.html#7355}{\htmlId{7355}{\htmlClass{Bound}{\text{fut}}}}\,
  \end{pmatrix}$</a> <a id="7365" class="Symbol">=</a>
  <a class="AgdaKaTeX">$\begin{pmatrix} \begin{pmatrix} \,\href{Prelude.html#3167}{\htmlId{7373}{\htmlClass{Function}{\text{posPart}}}}\, (\,\href{Ledger.Conway.Epoch.html#76}{\htmlId{7382}{\htmlClass{InductiveConstructor}{\text{pos}}}}\, \,\href{Ledger.Conway.Epoch.html#7183}{\htmlId{7386}{\htmlClass{Bound}{\text{treasury}}}}\, \,\href{Class.HasAdd.Core.html#162}{\htmlId{7395}{\htmlClass{Field Operator}{\text{+}}}}\, \,\href{Ledger.Conway.Rewards.html#5726}{\htmlId{7397}{\htmlClass{Function}{\text{Δt}}}}\, \,\href{Class.HasAdd.Core.html#162}{\htmlId{7400}{\htmlClass{Field Operator}{\text{+}}}}\, \,\href{Ledger.Conway.Epoch.html#76}{\htmlId{7402}{\htmlClass{InductiveConstructor}{\text{pos}}}}\, \,\href{Ledger.Conway.Epoch.html#7768}{\htmlId{7406}{\htmlClass{Function}{\text{unregRU&#39;}}}}\,)
    \\ \,\href{Prelude.html#3167}{\htmlId{7422}{\htmlClass{Function}{\text{posPart}}}}\, (\,\href{Ledger.Conway.Epoch.html#76}{\htmlId{7431}{\htmlClass{InductiveConstructor}{\text{pos}}}}\, \,\href{Ledger.Conway.Epoch.html#7194}{\htmlId{7435}{\htmlClass{Bound}{\text{reserves}}}}\, \,\href{Class.HasAdd.Core.html#162}{\htmlId{7444}{\htmlClass{Field Operator}{\text{+}}}}\, \,\href{Ledger.Conway.Rewards.html#5729}{\htmlId{7446}{\htmlClass{Function}{\text{Δr}}}}\,) \end{pmatrix}
  \\ \,\href{Ledger.Conway.Epoch.html#7210}{\htmlId{7456}{\htmlClass{Bound}{\text{ss}}}}\,
  \\ \begin{pmatrix} \begin{pmatrix} \,\href{Ledger.Conway.Epoch.html#7221}{\htmlId{7467}{\htmlClass{Bound}{\text{utxo}}}}\, \\ \,\href{Prelude.html#3167}{\htmlId{7474}{\htmlClass{Function}{\text{posPart}}}}\, (\,\href{Ledger.Conway.Epoch.html#76}{\htmlId{7483}{\htmlClass{InductiveConstructor}{\text{pos}}}}\, \,\href{Ledger.Conway.Epoch.html#7228}{\htmlId{7487}{\htmlClass{Bound}{\text{fees}}}}\, \,\href{Class.HasAdd.Core.html#162}{\htmlId{7492}{\htmlClass{Field Operator}{\text{+}}}}\, \,\href{Ledger.Conway.Rewards.html#5732}{\htmlId{7494}{\htmlClass{Function}{\text{Δf}}}}\,) \\ \,\href{Ledger.Conway.Epoch.html#7235}{\htmlId{7500}{\htmlClass{Bound}{\text{deposits}}}}\, \\ \,\href{Ledger.Conway.Epoch.html#7246}{\htmlId{7511}{\htmlClass{Bound}{\text{donations}}}}\, \end{pmatrix}
    \\ \,\href{Ledger.Conway.Epoch.html#7265}{\htmlId{7529}{\htmlClass{Bound}{\text{govSt}}}}\,
    \\ \begin{pmatrix} \begin{pmatrix} \,\href{Ledger.Conway.Epoch.html#7281}{\htmlId{7545}{\htmlClass{Bound}{\text{voteDelegs}}}}\, \\ \,\href{Ledger.Conway.Epoch.html#7294}{\htmlId{7558}{\htmlClass{Bound}{\text{stakeDelegs}}}}\, \\ \,\href{Ledger.Conway.Epoch.html#7308}{\htmlId{7572}{\htmlClass{Bound}{\text{rewards}}}}\, \,\href{Axiom.Set.Map.Dec.html#1854}{\htmlId{7580}{\htmlClass{Function Operator}{\text{∪⁺}}}}\, \,\href{Ledger.Conway.Epoch.html#7700}{\htmlId{7583}{\htmlClass{Function}{\text{regRU}}}}\, \end{pmatrix} \\ \,\href{Ledger.Conway.Epoch.html#7321}{\htmlId{7593}{\htmlClass{Bound}{\text{pState}}}}\, \\ \,\href{Ledger.Conway.Epoch.html#7330}{\htmlId{7602}{\htmlClass{Bound}{\text{gState}}}}\, \end{pmatrix} \end{pmatrix}
  \\ \,\href{Ledger.Conway.Epoch.html#7348}{\htmlId{7617}{\htmlClass{Bound}{\text{es}}}}\,
  \\ \,\href{Ledger.Conway.Epoch.html#7355}{\htmlId{7624}{\htmlClass{Bound}{\text{fut}}}}\, \end{pmatrix}$</a>
  <a id="7632" class="Keyword">where</a>
    <a id="7642" class="Keyword">open</a> <a id="7647" href="Ledger.Conway.Rewards.html#5689" class="Module">RewardUpdate</a> <a id="7660" href="Ledger.Conway.Epoch.html#7164" class="Bound">rewardUpdate</a> <a id="7673" class="Keyword">using</a> <a id="7679" class="Symbol">(</a><a id="7680" href="Ledger.Conway.Rewards.html#5726" class="Field">Δt</a><a id="7682" class="Symbol">;</a> <a id="7684" href="Ledger.Conway.Rewards.html#5729" class="Field">Δr</a><a id="7686" class="Symbol">;</a> <a id="7688" href="Ledger.Conway.Rewards.html#5732" class="Field">Δf</a><a id="7690" class="Symbol">;</a> <a id="7692" href="Ledger.Conway.Rewards.html#5752" class="Field">rs</a><a id="7694" class="Symbol">)</a>
    <a id="7700" href="Ledger.Conway.Epoch.html#7700" class="Function">regRU</a>     <a id="7710" class="Symbol">=</a> <a id="7712" href="Ledger.Conway.Rewards.html#5752" class="Function">rs</a> <a id="7715" href="Axiom.Set.Map.html#10678" class="Function Operator">∣</a> <a id="7717" href="Class.IsSet.html#916" class="Function">dom</a> <a id="7721" href="Ledger.Conway.Epoch.html#7308" class="Bound">rewards</a>
    <a id="7733" href="Ledger.Conway.Epoch.html#7733" class="Function">unregRU</a>   <a id="7743" class="Symbol">=</a> <a id="7745" href="Ledger.Conway.Rewards.html#5752" class="Function">rs</a> <a id="7748" href="Axiom.Set.Map.html#10748" class="Function Operator">∣</a> <a id="7750" href="Class.IsSet.html#916" class="Function">dom</a> <a id="7754" href="Ledger.Conway.Epoch.html#7308" class="Bound">rewards</a> <a id="7762" href="Axiom.Set.Map.html#10748" class="Function Operator">ᶜ</a>
    <a id="7768" href="Ledger.Conway.Epoch.html#7768" class="Function">unregRU&#39;</a>  <a id="7778" class="Symbol">=</a> <a id="7780" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">∑[</a> <a id="7783" href="Ledger.Conway.Epoch.html#7783" class="Bound">x</a> <a id="7785" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">←</a> <a id="7787" href="Ledger.Conway.Epoch.html#7733" class="Function">unregRU</a> <a id="7795" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">]</a> <a id="7797" href="Ledger.Conway.Epoch.html#7783" class="Bound">x</a>

<a id="getOrphans"></a><a id="7800" href="Ledger.Conway.Epoch.html#7800" class="Function">getOrphans</a> <a id="7811" class="Symbol">:</a> <a id="7813" href="Ledger.Conway.Enact.html#402" class="Record">EnactState</a> <a id="7824" class="Symbol">→</a> <a id="7826" href="Ledger.Conway.Gov.html#1381" class="Function">GovState</a> <a id="7835" class="Symbol">→</a> <a id="7837" href="Ledger.Conway.Gov.html#1381" class="Function">GovState</a>
<a id="7846" href="Ledger.Conway.Epoch.html#7800" class="Function">getOrphans</a> <a id="7857" href="Ledger.Conway.Epoch.html#7857" class="Bound">es</a> <a id="7860" href="Ledger.Conway.Epoch.html#7860" class="Bound">govSt</a> <a id="7866" class="Symbol">=</a> <a id="7868" href="Data.Product.Base.html#636" class="Field">proj₁</a> <a id="7874" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="7876" href="Data.Nat.GeneralisedArithmetic.html#866" class="Function">iterate</a> <a id="7884" href="Ledger.Conway.Epoch.html#7929" class="Function">step</a> <a id="7889" class="Symbol">(</a><a id="7890" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a> <a id="7893" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="7895" href="Ledger.Conway.Epoch.html#7860" class="Bound">govSt</a><a id="7900" class="Symbol">)</a> <a id="7902" class="Symbol">(</a><a id="7903" href="Data.List.Base.html#5044" class="Function">length</a> <a id="7910" href="Ledger.Conway.Epoch.html#7860" class="Bound">govSt</a><a id="7915" class="Symbol">)</a>
  <a id="7919" class="Keyword">where</a>
    <a id="7929" href="Ledger.Conway.Epoch.html#7929" class="Function">step</a> <a id="7934" class="Symbol">:</a> <a id="7936" href="Ledger.Conway.Gov.html#1381" class="Function">GovState</a> <a id="7945" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="7947" href="Ledger.Conway.Gov.html#1381" class="Function">GovState</a> <a id="7956" class="Symbol">→</a> <a id="7958" href="Ledger.Conway.Gov.html#1381" class="Function">GovState</a> <a id="7967" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="7969" href="Ledger.Conway.Gov.html#1381" class="Function">GovState</a>
    <a id="7982" href="Ledger.Conway.Epoch.html#7929" class="Function">step</a> <a id="7987" class="Symbol">(</a><a id="7988" href="Ledger.Conway.Epoch.html#7988" class="Bound">orps</a> <a id="7993" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="7995" href="Ledger.Conway.Epoch.html#7995" class="Bound">govSt</a><a id="8000" class="Symbol">)</a> <a id="8002" class="Symbol">=</a>
      <a id="8010" class="Keyword">let</a>
        <a id="8022" href="Ledger.Conway.Epoch.html#8022" class="Bound">isOrphan?</a> <a id="8032" href="Ledger.Conway.Epoch.html#8032" class="Bound">a</a> <a id="8034" href="Ledger.Conway.Epoch.html#8034" class="Bound">prev</a> <a id="8039" class="Symbol">=</a> <a id="8041" href="Relation.Nullary.Decidable.Core.html#3011" class="Function">¬?</a> <a id="8044" class="Symbol">(</a><a id="8045" href="Ledger.Conway.Gov.html#8721" class="Function">hasParent?</a> <a id="8056" href="Ledger.Conway.Epoch.html#7857" class="Bound">es</a> <a id="8059" href="Ledger.Conway.Epoch.html#7995" class="Bound">govSt</a> <a id="8065" href="Ledger.Conway.Epoch.html#8032" class="Bound">a</a> <a id="8067" href="Ledger.Conway.Epoch.html#8034" class="Bound">prev</a><a id="8071" class="Symbol">)</a>
        <a id="8081" class="Symbol">(</a><a id="8082" href="Ledger.Conway.Epoch.html#8082" class="Bound">orps&#39;</a> <a id="8088" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="8090" href="Ledger.Conway.Epoch.html#8090" class="Bound">govSt&#39;</a><a id="8096" class="Symbol">)</a> <a id="8098" class="Symbol">=</a> <a id="8100" href="Data.List.Base.html#10926" class="Function">partition</a>
          <a id="8120" class="Symbol">(λ</a> <a id="8123" class="Symbol">(_</a> <a id="8126" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="8128" class="Keyword">record</a> <a id="8135" class="Symbol">{</a><a id="8136" href="Ledger.Conway.Gov.Actions.html#2833" class="Field">action</a> <a id="8143" class="Symbol">=</a> <a id="8145" href="Ledger.Conway.Epoch.html#8145" class="Bound">a</a> <a id="8147" class="Symbol">;</a> <a id="8149" href="Ledger.Conway.Gov.Actions.html#2861" class="Field">prevAction</a> <a id="8160" class="Symbol">=</a> <a id="8162" href="Ledger.Conway.Epoch.html#8162" class="Bound">prev</a><a id="8166" class="Symbol">})</a> <a id="8169" class="Symbol">→</a> <a id="8171" href="Ledger.Conway.Epoch.html#8022" class="Bound">isOrphan?</a> <a id="8181" class="Symbol">(</a><a id="8182" href="Ledger.Conway.Epoch.html#8145" class="Bound">a</a> <a id="8184" class="Symbol">.</a><a id="8185" href="Ledger.Conway.Gov.Actions.html#1399" class="Field">gaType</a><a id="8191" class="Symbol">)</a> <a id="8193" href="Ledger.Conway.Epoch.html#8162" class="Bound">prev</a><a id="8197" class="Symbol">)</a> <a id="8199" href="Ledger.Conway.Epoch.html#7995" class="Bound">govSt</a>
      <a id="8211" class="Keyword">in</a>
        <a id="8222" class="Symbol">(</a><a id="8223" href="Ledger.Conway.Epoch.html#7988" class="Bound">orps</a> <a id="8228" href="Data.List.Base.html#1734" class="Function Operator">++</a> <a id="8231" href="Ledger.Conway.Epoch.html#8082" class="Bound">orps&#39;</a> <a id="8237" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="8239" href="Ledger.Conway.Epoch.html#8090" class="Bound">govSt&#39;</a><a id="8245" class="Symbol">)</a>


<a id="8249" class="Keyword">open</a> <a id="8254" href="Ledger.Conway.Address.html#1312" class="Module">RwdAddr</a> <a id="8262" class="Keyword">using</a> <a id="8268" class="Symbol">(</a><a id="8269" href="Ledger.Conway.Address.html#1366" class="Field">stake</a><a id="8274" class="Symbol">)</a>


<a id="gaDepositStake"></a><a id="8278" href="Ledger.Conway.Epoch.html#8278" class="Function">gaDepositStake</a> <a id="8293" class="Symbol">:</a> <a id="8295" href="Ledger.Conway.Gov.html#1381" class="Function">GovState</a> <a id="8304" class="Symbol">→</a> <a id="8306" href="Ledger.Conway.Certs.html#553" class="Function">Deposits</a> <a id="8315" class="Symbol">→</a> <a id="8317" href="Ledger.Conway.Address.html#248" class="Datatype">Credential</a> <a id="8328" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="8330" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a>
<a id="8335" href="Ledger.Conway.Epoch.html#8278" class="Function">gaDepositStake</a> <a id="8350" href="Ledger.Conway.Epoch.html#8350" class="Bound">govSt</a> <a id="8356" href="Ledger.Conway.Epoch.html#8356" class="Bound">ds</a> <a id="8359" class="Symbol">=</a> <a id="8361" href="abstract-set-theory.FiniteSetTheory.html#3599" class="Function">aggregateBy</a>
  <a id="8375" class="Symbol">(</a><a id="8376" href="abstract-set-theory.FiniteSetTheory.html#519" class="Function">mapˢ</a> <a id="8381" class="Symbol">(λ</a> <a id="8384" class="Symbol">(</a><a id="8385" href="Ledger.Conway.Epoch.html#8385" class="Bound">gaid</a> <a id="8390" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="8392" href="Ledger.Conway.Epoch.html#8392" class="Bound">addr</a><a id="8396" class="Symbol">)</a> <a id="8398" class="Symbol">→</a> <a id="8400" class="Symbol">(</a><a id="8401" href="Ledger.Conway.Epoch.html#8385" class="Bound">gaid</a> <a id="8406" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="8408" href="Ledger.Conway.Epoch.html#8392" class="Bound">addr</a><a id="8412" class="Symbol">)</a> <a id="8414" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="8416" href="Ledger.Conway.Address.html#1366" class="Field">stake</a> <a id="8422" href="Ledger.Conway.Epoch.html#8392" class="Bound">addr</a><a id="8426" class="Symbol">)</a> <a id="8428" href="Ledger.Conway.Epoch.html#8526" class="Function">govSt&#39;</a><a id="8434" class="Symbol">)</a>
  <a id="8438" class="Symbol">(</a><a id="8439" href="Axiom.Set.Map.html#10460" class="Function">mapFromPartialFun</a> <a id="8457" class="Symbol">(λ</a> <a id="8460" class="Symbol">(</a><a id="8461" href="Ledger.Conway.Epoch.html#8461" class="Bound">gaid</a> <a id="8466" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="8468" class="Symbol">_)</a> <a id="8471" class="Symbol">→</a> <a id="8473" href="Axiom.Set.Map.html#13670" class="Function">lookupᵐ?</a> <a id="8482" href="Ledger.Conway.Epoch.html#8356" class="Bound">ds</a> <a id="8485" class="Symbol">(</a><a id="8486" href="Ledger.Conway.Certs.html#501" class="InductiveConstructor">GovActionDeposit</a> <a id="8503" href="Ledger.Conway.Epoch.html#8461" class="Bound">gaid</a><a id="8507" class="Symbol">))</a> <a id="8510" href="Ledger.Conway.Epoch.html#8526" class="Function">govSt&#39;</a><a id="8516" class="Symbol">)</a>
  <a id="8520" class="Keyword">where</a> <a id="8526" href="Ledger.Conway.Epoch.html#8526" class="Function">govSt&#39;</a> <a id="8533" class="Symbol">=</a> <a id="8535" href="abstract-set-theory.FiniteSetTheory.html#519" class="Function">mapˢ</a> <a id="8540" class="Symbol">(</a><a id="8541" href="Class.Bifunctor.html#1152" class="Function">map₂</a> <a id="8546" href="Ledger.Conway.Gov.Actions.html#2783" class="Field">returnAddr</a><a id="8556" class="Symbol">)</a> <a id="8558" class="Symbol">(</a><a id="8559" href="Axiom.Set.html#5718" class="Function">fromList</a> <a id="8568" href="Ledger.Conway.Epoch.html#8350" class="Bound">govSt</a><a id="8573" class="Symbol">)</a>



<a id="8578" class="Keyword">opaque</a>


  <a id="mkStakeDistrs"></a><a id="8589" href="Ledger.Conway.Epoch.html#8589" class="Function">mkStakeDistrs</a> <a id="8603" class="Symbol">:</a> <a id="8605" href="Ledger.Conway.Rewards.html#5925" class="Record">Snapshot</a> <a id="8614" class="Symbol">→</a> <a id="8616" href="Ledger.Conway.Gov.html#1381" class="Function">GovState</a> <a id="8625" class="Symbol">→</a> <a id="8627" href="Ledger.Conway.Certs.html#553" class="Function">Deposits</a> <a id="8636" class="Symbol">→</a> <a id="8638" class="Symbol">(</a><a id="8639" href="Ledger.Conway.Address.html#248" class="Datatype">Credential</a> <a id="8650" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="8652" href="Ledger.Conway.Gov.Actions.html#424" class="Datatype">VDeleg</a><a id="8658" class="Symbol">)</a> <a id="8660" class="Symbol">→</a> <a id="8662" href="Ledger.Conway.Ratify.html#2943" class="Record">StakeDistrs</a>
  <a id="8676" href="Ledger.Conway.Epoch.html#8589" class="Function">mkStakeDistrs</a> <a id="8690" href="Ledger.Conway.Epoch.html#8690" class="Bound">ss</a> <a id="8693" href="Ledger.Conway.Epoch.html#8693" class="Bound">govSt</a> <a id="8699" href="Ledger.Conway.Epoch.html#8699" class="Bound">ds</a> <a id="8702" href="Ledger.Conway.Epoch.html#8702" class="Bound">delegations</a> <a id="8714" class="Symbol">.</a><a id="8715" href="Ledger.Conway.Ratify.html#2980" class="Field">StakeDistrs.stakeDistr</a> <a id="8738" class="Symbol">=</a>
    <a id="8744" href="abstract-set-theory.FiniteSetTheory.html#3599" class="Function">aggregateBy</a> <a id="8756" href="Ledger.Prelude.html#2304" class="Function Operator">∣</a> <a id="8758" href="Ledger.Conway.Epoch.html#8702" class="Bound">delegations</a> <a id="8770" href="Ledger.Prelude.html#2304" class="Function Operator">∣</a> <a id="8772" class="Symbol">(</a><a id="8773" href="Ledger.Conway.Rewards.html#5958" class="Field">Snapshot.stake</a> <a id="8788" href="Ledger.Conway.Epoch.html#8690" class="Bound">ss</a> <a id="8791" href="Axiom.Set.Map.Dec.html#1854" class="Function Operator">∪⁺</a> <a id="8794" href="Ledger.Conway.Epoch.html#8278" class="Function">gaDepositStake</a> <a id="8809" href="Ledger.Conway.Epoch.html#8693" class="Bound">govSt</a> <a id="8815" href="Ledger.Conway.Epoch.html#8699" class="Bound">ds</a><a id="8817" class="Symbol">)</a>


<a id="8821" class="Keyword">private</a> <a id="8829" class="Keyword">variable</a>
  <a id="8840" href="Ledger.Conway.Epoch.html#8840" class="Generalizable">nes</a> <a id="8844" href="Ledger.Conway.Epoch.html#8844" class="Generalizable">nes&#39;</a> <a id="8849" class="Symbol">:</a> <a id="8851" href="Ledger.Conway.Epoch.html#2526" class="Record">NewEpochState</a>
  <a id="8867" href="Ledger.Conway.Epoch.html#8867" class="Generalizable">e</a> <a id="8869" href="Ledger.Conway.Epoch.html#8869" class="Generalizable">lastEpoch</a> <a id="8879" class="Symbol">:</a> <a id="8881" href="Ledger.Conway.Types.Epoch.html#592" class="Function">Epoch</a>
  <a id="8889" href="Ledger.Conway.Epoch.html#8889" class="Generalizable">fut</a> <a id="8893" href="Ledger.Conway.Epoch.html#8893" class="Generalizable">fut&#39;</a> <a id="8898" class="Symbol">:</a> <a id="8900" href="Ledger.Conway.Ratify.html#3308" class="Record">RatifyState</a>
  <a id="8914" href="Ledger.Conway.Epoch.html#8914" class="Generalizable">plReapState</a> <a id="8926" class="Symbol">:</a> <a id="8928" href="Ledger.Conway.PoolReap.html#369" class="Record">PlReapState</a>
  <a id="8942" href="Ledger.Conway.Epoch.html#8942" class="Generalizable">eps</a> <a id="8946" href="Ledger.Conway.Epoch.html#8946" class="Generalizable">eps&#39;</a> <a id="8951" href="Ledger.Conway.Epoch.html#8951" class="Generalizable">eps&#39;&#39;</a> <a id="8957" class="Symbol">:</a> <a id="8959" href="Ledger.Conway.Epoch.html#1512" class="Record">EpochState</a>
  <a id="8972" href="Ledger.Conway.Epoch.html#8972" class="Generalizable">ls</a> <a id="8975" class="Symbol">:</a> <a id="8977" href="Ledger.Conway.Ledger.html#865" class="Record">LState</a>
  <a id="8986" href="Ledger.Conway.Epoch.html#8986" class="Generalizable">es₀</a> <a id="8990" class="Symbol">:</a> <a id="8992" href="Ledger.Conway.Enact.html#402" class="Record">EnactState</a>
  <a id="9005" href="Ledger.Conway.Epoch.html#9005" class="Generalizable">mark</a> <a id="9010" href="Ledger.Conway.Epoch.html#9010" class="Generalizable">set</a> <a id="9014" href="Ledger.Conway.Epoch.html#9014" class="Generalizable">go</a> <a id="9017" class="Symbol">:</a> <a id="9019" href="Ledger.Conway.Rewards.html#5925" class="Record">Snapshot</a>
  <a id="9030" href="Ledger.Conway.Epoch.html#9030" class="Generalizable">feeSS</a> <a id="9036" class="Symbol">:</a> <a id="9038" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a>
  <a id="9045" href="Ledger.Conway.Epoch.html#9045" class="Generalizable">lstate</a> <a id="9052" class="Symbol">:</a> <a id="9054" href="Ledger.Conway.Ledger.html#865" class="Record">LState</a>
  <a id="9063" href="Ledger.Conway.Epoch.html#9063" class="Generalizable">ss</a> <a id="9066" href="Ledger.Conway.Epoch.html#9066" class="Generalizable">ss&#39;</a> <a id="9070" class="Symbol">:</a> <a id="9072" href="Ledger.Conway.Rewards.html#6655" class="Record">Snapshots</a>
  <a id="9084" href="Ledger.Conway.Epoch.html#9084" class="Generalizable">ru</a> <a id="9087" class="Symbol">:</a> <a id="9089" href="Ledger.Conway.Rewards.html#5689" class="Record">RewardUpdate</a>
  <a id="9104" href="Ledger.Conway.Epoch.html#9104" class="Generalizable">mru</a> <a id="9108" class="Symbol">:</a> <a id="9110" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="9116" href="Ledger.Conway.Rewards.html#5689" class="Record">RewardUpdate</a>
  <a id="9131" href="Ledger.Conway.Epoch.html#9131" class="Generalizable">pp</a> <a id="9134" class="Symbol">:</a> <a id="9136" href="Ledger.Conway.PParams.html#1694" class="Record">PParams</a>


<a id="9146" class="Keyword">data</a> <a id="_⊢_⇀⦇_,POOLREAP⦈_"></a><a id="9151" href="Ledger.Conway.Epoch.html#9151" class="Datatype Operator">_⊢_⇀⦇_,POOLREAP⦈_</a> <a id="9169" class="Symbol">:</a> <a id="9171" href="Ledger.Conway.PParams.html#1694" class="Record">PParams</a> <a id="9179" class="Symbol">→</a> <a id="9181" href="Ledger.Conway.PoolReap.html#369" class="Record">PlReapState</a> <a id="9193" class="Symbol">→</a> <a id="9195" href="Ledger.Conway.Types.Epoch.html#592" class="Function">Epoch</a> <a id="9201" class="Symbol">→</a> <a id="9203" href="Ledger.Conway.PoolReap.html#369" class="Record">PlReapState</a> <a id="9215" class="Symbol">→</a> <a id="9217" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="9222" class="Keyword">where</a>
  <a id="_⊢_⇀⦇_,POOLREAP⦈_.REAP"></a><a id="9230" href="Ledger.Conway.Epoch.html#9230" class="InductiveConstructor">REAP</a> <a id="9235" class="Symbol">:</a> <a id="9237" class="Keyword">let</a>
    <a id="9245" class="Comment">-- open LState ls</a>
    <a id="9267" class="Keyword">open</a> <a id="9272" href="Ledger.Conway.PoolReap.html#369" class="Module">PlReapState</a> <a id="9284" href="Ledger.Conway.Epoch.html#8914" class="Generalizable">plReapState</a>
    <a id="9300" class="Keyword">open</a> <a id="9305" href="Ledger.Conway.Ratify.html#3308" class="Module">RatifyState</a> <a id="9317" href="Ledger.Conway.Epoch.html#8889" class="Generalizable">fut</a> <a id="9321" class="Keyword">renaming</a> <a id="9330" class="Symbol">(</a><a id="9331" href="Ledger.Conway.Ratify.html#3345" class="Field">es</a> <a id="9334" class="Symbol">to</a> <a id="9337" class="Field">esW</a><a id="9340" class="Symbol">)</a>
    <a id="9346" class="Keyword">open</a> <a id="9351" href="Ledger.Conway.Utxo.html#1390" class="Module">UTxOState</a>
    <a id="9365" class="Keyword">open</a> <a id="9370" href="Ledger.Conway.Certs.html#3761" class="Module">PState</a><a id="9376" class="Symbol">;</a> <a id="9378" class="Keyword">open</a> <a id="9383" href="Ledger.Conway.Certs.html#3151" class="Module">DState</a>
    <a id="9394" class="Keyword">open</a> <a id="9399" href="Ledger.Conway.PParams.html#686" class="Module">Acnt</a><a id="9403" class="Symbol">;</a> <a id="9405" class="Keyword">open</a> <a id="9410" href="Ledger.Conway.Enact.html#402" class="Module">EnactState</a>
    <a id="9425" class="Keyword">open</a> <a id="9430" href="Ledger.Conway.PParams.html#1694" class="Module">PParams</a>

    <a id="9443" href="Ledger.Conway.Epoch.html#9443" class="Bound">trWithdrawals</a> <a id="9457" class="Symbol">:</a> <a id="9459" href="Ledger.Conway.Address.html#1312" class="Record">RwdAddr</a> <a id="9467" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="9469" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a>
    <a id="9478" href="Ledger.Conway.Epoch.html#9443" class="Bound">trWithdrawals</a> <a id="9492" class="Symbol">=</a> <a id="9494" href="Ledger.Conway.Epoch.html#9337" class="Function">esW</a> <a id="9498" class="Symbol">.</a><a id="9499" href="Ledger.Conway.Enact.html#654" class="Field">withdrawals</a>

    <a id="9516" href="Ledger.Conway.Epoch.html#9516" class="Bound">totWithdrawals</a> <a id="9531" class="Symbol">:</a> <a id="9533" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a>
    <a id="9542" href="Ledger.Conway.Epoch.html#9516" class="Bound">totWithdrawals</a> <a id="9557" class="Symbol">=</a> <a id="9559" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">∑[</a> <a id="9562" href="Ledger.Conway.Epoch.html#9562" class="Bound">x</a> <a id="9564" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">←</a> <a id="9566" href="Ledger.Conway.Epoch.html#9443" class="Bound">trWithdrawals</a> <a id="9580" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">]</a> <a id="9582" href="Ledger.Conway.Epoch.html#9562" class="Bound">x</a>

    <a id="9589" class="Comment">-- retired := dom (retiring⁻¹ e) = { hk : (hk , e) ∈ retiring }  (Shelley Fig 41)</a>
    <a id="9675" href="Ledger.Conway.Epoch.html#9675" class="Bound">retired</a>    <a id="9686" class="Symbol">=</a> <a id="9688" class="Symbol">(</a><a id="9689" href="Ledger.Conway.PoolReap.html#570" class="Function">pState</a> <a id="9696" class="Symbol">.</a><a id="9697" href="Ledger.Conway.Certs.html#3830" class="Field">retiring</a><a id="9705" class="Symbol">)</a> <a id="9707" href="Axiom.Set.Map.html#14230" class="Function Operator">⁻¹</a> <a id="9710" href="Ledger.Conway.Epoch.html#8867" class="Generalizable">e</a>


    <a id="9718" class="Comment">-- pr = { hk ↦ (poolDeposit pp) | hk ∈ retired }</a>
    <a id="9771" class="Comment">--    = { (hk , poolDeposit pp) ∈ KeyHash × Coin | hk ∈ retired }  (Shelley Fig 41)</a>
    <a id="9859" href="Ledger.Conway.Epoch.html#9859" class="Bound">pr</a> <a id="9862" class="Symbol">=</a> <a id="9864" href="Axiom.Set.Map.html#9130" class="Function">constMap</a> <a id="9873" href="Ledger.Conway.Epoch.html#9675" class="Bound">retired</a>  <a id="9882" class="Symbol">(</a><a id="9883" href="Ledger.Conway.Epoch.html#9131" class="Generalizable">pp</a> <a id="9886" class="Symbol">.</a><a id="9887" href="Ledger.Conway.PParams.html#2245" class="Field">poolDeposit</a><a id="9898" class="Symbol">)</a>

    <a id="9905" class="Comment">-- rewardAcnts := { (hk , poolRAcnt pool) ∈ KeyHash × Credential | (hk , pool) ∈ poolParams ↾ retired }  (Shelley Fig 41)</a>
    <a id="10031" class="Comment">-- rewardAcnts : KeyHash ⇀ Credential</a>
    <a id="10073" href="Ledger.Conway.Epoch.html#10073" class="Bound">rewardAcnts</a> <a id="10085" class="Symbol">=</a> <a id="10087" class="Symbol">(</a><a id="10088" href="Ledger.Conway.PoolReap.html#570" class="Function">pState</a> <a id="10095" class="Symbol">.</a><a id="10096" href="Ledger.Conway.Certs.html#3793" class="Field">pools</a><a id="10101" class="Symbol">)</a> <a id="10103" href="Axiom.Set.Map.html#10678" class="Function Operator">∣</a> <a id="10105" href="Ledger.Conway.Epoch.html#9675" class="Bound">retired</a>

    <a id="10118" class="Comment">-- rewardAcnts&#39; : RwdAddr ⇀ Coin</a>
    <a id="10155" class="Comment">-- rewardAcnts&#39; =?= constMap (range (rewardAcnts ˢ)) (pp .poolDeposit)</a>



    <a id="10233" class="Comment">-- refunds := rewardAcnts&#39; ↾ dom rewards         (recall, rewards : Credential ⇀ Coin is stored in DState))</a>
    <a id="10345" href="Ledger.Conway.Epoch.html#10345" class="Bound">refunds</a>    <a id="10356" class="Symbol">=</a> <a id="10358" href="Axiom.Set.Map.html#13791" class="Function">pullbackMap</a> <a id="10370" class="Symbol">(</a><a id="10371" href="Ledger.Conway.Epoch.html#9337" class="Function">esW</a> <a id="10375" class="Symbol">.</a><a id="10376" href="Ledger.Conway.Enact.html#654" class="Field">withdrawals</a><a id="10387" class="Symbol">)</a> <a id="10389" href="Ledger.Conway.Epoch.html#4148" class="Function">toRwdAddr</a> <a id="10399" class="Symbol">(</a><a id="10400" href="Class.IsSet.html#916" class="Function">dom</a> <a id="10404" class="Symbol">(</a><a id="10405" href="Ledger.Conway.PoolReap.html#521" class="Function">dState</a> <a id="10412" class="Symbol">.</a><a id="10413" href="Ledger.Conway.Certs.html#3289" class="Field">rewards</a><a id="10420" class="Symbol">))</a>
    <a id="10427" class="Comment">--(recall, pullbackMap : (m : Map A B) → ⦃ ∀ {x} → (x ∈ dom (m ˢ)) ⁇ ⦄ → (A&#39; → A) → Set A&#39; → Map A&#39; B)</a>

    <a id="10535" class="Comment">-- refunds =?= rewardAcnts&#39; ∣ (dom (dState .rewards))</a>

    <a id="10594" class="Comment">-- mRefunds := rewardAcnts&#39; ↾ (dom rewards)ᶜ</a>

    <a id="10644" href="Ledger.Conway.Epoch.html#10644" class="Bound">unclaimed</a>  <a id="10655" class="Symbol">=</a> <a id="10657" href="Ledger.Interface.HasCoin.html#172" class="Field">getCoin</a> <a id="10665" class="Symbol">(</a><a id="10666" href="Ledger.Conway.Epoch.html#9337" class="Function">esW</a> <a id="10670" class="Symbol">.</a><a id="10671" href="Ledger.Conway.Enact.html#654" class="Field">withdrawals</a><a id="10682" class="Symbol">)</a> <a id="10684" href="Interface.HasSubtract.html#209" class="Field Operator">-</a> <a id="10686" href="Ledger.Interface.HasCoin.html#172" class="Field">getCoin</a> <a id="10694" href="Ledger.Conway.Epoch.html#10345" class="Bound">refunds</a>
    <a id="10706" class="Comment">-- cf. Shelley Fig 41: unclaimed := ∑ {c | ∃ hk (hk , c) ∈ mRefunds }</a>

    <a id="10781" href="Ledger.Conway.Epoch.html#10781" class="Bound">utxoSt&#39;</a> <a id="10789" class="Symbol">=</a> <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.Conway.PoolReap.html#435}{\htmlId{10793}{\htmlClass{Function}{\text{utxoSt}}}}\, \,\htmlId{10800}{\htmlClass{Symbol}{\text{.}}}\,\,\href{Ledger.Conway.Utxo.html#1454}{\htmlId{10801}{\htmlClass{Field}{\text{utxo}}}}\, \\ \,\href{Ledger.Conway.PoolReap.html#435}{\htmlId{10808}{\htmlClass{Function}{\text{utxoSt}}}}\, \,\htmlId{10815}{\htmlClass{Symbol}{\text{.}}}\,\,\href{Ledger.Conway.Utxo.html#1476}{\htmlId{10816}{\htmlClass{Field}{\text{fees}}}}\, \\ \,\href{Ledger.Conway.PoolReap.html#435}{\htmlId{10823}{\htmlClass{Function}{\text{utxoSt}}}}\, \,\htmlId{10830}{\htmlClass{Symbol}{\text{.}}}\,\,\href{Ledger.Conway.Utxo.html#1498}{\htmlId{10831}{\htmlClass{Field}{\text{deposits}}}}\, \\ \,\htmlId{10842}{\htmlClass{Number}{\text{0}}}\, \end{pmatrix}$</a>
    <a id="10850" class="Comment">-- cf. Shelley Fig 41: utxoSt&#39; .deposits = utxoSt .deposits - (unclaimed + getCoin refunds)</a>
    <a id="10946" class="Comment">--                                       = utxoSt .deposits - getCoin (esW .withdrawals)</a>

    <a id="11040" href="Ledger.Conway.Epoch.html#11040" class="Bound">acnt&#39;</a> <a id="11046" class="Symbol">=</a> <a id="11048" class="Keyword">record</a> <a id="11055" href="Ledger.Conway.PoolReap.html#478" class="Function">acnt</a>
      <a id="11066" class="Symbol">{</a> <a id="11068" href="Ledger.Conway.PParams.html#741" class="Field">treasury</a>  <a id="11078" class="Symbol">=</a> <a id="11080" href="Ledger.Conway.PoolReap.html#478" class="Function">acnt</a> <a id="11085" class="Symbol">.</a><a id="11086" href="Ledger.Conway.PParams.html#741" class="Field">treasury</a> <a id="11095" href="Data.Nat.Base.html#4462" class="Primitive Operator">∸</a> <a id="11097" href="Ledger.Conway.Epoch.html#9516" class="Bound">totWithdrawals</a> <a id="11112" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="11114" href="Ledger.Conway.PoolReap.html#435" class="Function">utxoSt</a> <a id="11121" class="Symbol">.</a><a id="11122" href="Ledger.Conway.Utxo.html#1524" class="Field">donations</a> <a id="11132" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="11134" href="Ledger.Conway.Epoch.html#10644" class="Bound">unclaimed</a> <a id="11144" class="Symbol">}</a>
    <a id="11150" class="Comment">-- cf. Shelley spec fig 41: acnt&#39; = acnt .treasury + utxoSt .donations + unclaimed</a>

    <a id="11238" href="Ledger.Conway.Epoch.html#11238" class="Bound">dState&#39;</a> <a id="11246" class="Symbol">=</a> <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.Conway.PoolReap.html#521}{\htmlId{11250}{\htmlClass{Function}{\text{dState}}}}\, \,\htmlId{11257}{\htmlClass{Symbol}{\text{.}}}\,\,\href{Ledger.Conway.Certs.html#3210}{\htmlId{11258}{\htmlClass{Field}{\text{voteDelegs}}}}\, \\ \,\href{Ledger.Conway.PoolReap.html#521}{\htmlId{11271}{\htmlClass{Function}{\text{dState}}}}\, \,\htmlId{11278}{\htmlClass{Symbol}{\text{.}}}\,\,\href{Ledger.Conway.Certs.html#3249}{\htmlId{11279}{\htmlClass{Field}{\text{stakeDelegs}}}}\, \\  \,\href{Ledger.Conway.PoolReap.html#521}{\htmlId{11294}{\htmlClass{Function}{\text{dState}}}}\, \,\htmlId{11301}{\htmlClass{Symbol}{\text{.}}}\,\,\href{Ledger.Conway.Certs.html#3289}{\htmlId{11302}{\htmlClass{Field}{\text{rewards}}}}\, \,\href{Axiom.Set.Map.Dec.html#1854}{\htmlId{11310}{\htmlClass{Function Operator}{\text{∪⁺}}}}\, \,\href{Ledger.Conway.Epoch.html#10345}{\htmlId{11313}{\htmlClass{Bound}{\text{refunds}}}}\, \end{pmatrix}$</a>

    <a id="11328" href="Ledger.Conway.Epoch.html#11328" class="Bound">pState&#39;</a> <a id="11336" class="Symbol">=</a> <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.Conway.PoolReap.html#570}{\htmlId{11340}{\htmlClass{Function}{\text{pState}}}}\, \,\htmlId{11347}{\htmlClass{Symbol}{\text{.}}}\,\,\href{Ledger.Conway.Certs.html#3793}{\htmlId{11348}{\htmlClass{Field}{\text{pools}}}}\, \,\href{Axiom.Set.Map.html#10748}{\htmlId{11354}{\htmlClass{Function Operator}{\text{∣}}}}\, \,\href{Ledger.Conway.Epoch.html#9675}{\htmlId{11356}{\htmlClass{Bound}{\text{retired}}}}\, \,\href{Axiom.Set.Map.html#10748}{\htmlId{11364}{\htmlClass{Function Operator}{\text{ᶜ}}}}\, \\ \,\href{Ledger.Conway.PoolReap.html#570}{\htmlId{11368}{\htmlClass{Function}{\text{pState}}}}\, \,\htmlId{11375}{\htmlClass{Symbol}{\text{.}}}\,\,\href{Ledger.Conway.Certs.html#3830}{\htmlId{11376}{\htmlClass{Field}{\text{retiring}}}}\, \,\href{Axiom.Set.Map.html#10748}{\htmlId{11385}{\htmlClass{Function Operator}{\text{∣}}}}\, \,\href{Ledger.Conway.Epoch.html#9675}{\htmlId{11387}{\htmlClass{Bound}{\text{retired}}}}\, \,\href{Axiom.Set.Map.html#10748}{\htmlId{11395}{\htmlClass{Function Operator}{\text{ᶜ}}}}\, \end{pmatrix}$</a>

    <a id="11404" class="Keyword">in</a>
    <a id="11411" href="iog-prelude.Prelude.InferenceRules.html#422" class="Function Operator">────────────────────────────────</a>
    <a id="11448" href="Ledger.Conway.Epoch.html#9131" class="Generalizable">pp</a> <a id="11451" href="Ledger.Conway.Epoch.html#9151" class="Datatype Operator">⊢</a> <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.Conway.PoolReap.html#435}{\htmlId{11455}{\htmlClass{Function}{\text{utxoSt}}}}\, \\ \,\href{Ledger.Conway.PoolReap.html#478}{\htmlId{11464}{\htmlClass{Function}{\text{acnt}}}}\, \\ \,\href{Ledger.Conway.PoolReap.html#521}{\htmlId{11471}{\htmlClass{Function}{\text{dState}}}}\, \\ \,\href{Ledger.Conway.PoolReap.html#570}{\htmlId{11480}{\htmlClass{Function}{\text{pState}}}}\, \end{pmatrix}$</a> <a id="11489" href="Ledger.Conway.Epoch.html#9151" class="Datatype Operator">⇀⦇</a> <a id="11492" href="Ledger.Conway.Epoch.html#8867" class="Generalizable">e</a> <a id="11494" href="Ledger.Conway.Epoch.html#9151" class="Datatype Operator">,POOLREAP⦈</a> <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.Conway.Epoch.html#10781}{\htmlId{11507}{\htmlClass{Bound}{\text{utxoSt&#39;}}}}\, \\ \,\href{Ledger.Conway.Epoch.html#11040}{\htmlId{11517}{\htmlClass{Bound}{\text{acnt&#39;}}}}\, \\ \,\href{Ledger.Conway.Epoch.html#11238}{\htmlId{11525}{\htmlClass{Bound}{\text{dState&#39;}}}}\, \\ \,\href{Ledger.Conway.Epoch.html#11328}{\htmlId{11535}{\htmlClass{Bound}{\text{pState&#39;}}}}\, \end{pmatrix}$</a>


<a id="11547" class="Keyword">private</a> <a id="11555" class="Keyword">variable</a>
  <a id="11566" href="Ledger.Conway.Epoch.html#11566" class="Generalizable">acnt</a> <a id="11571" href="Ledger.Conway.Epoch.html#11571" class="Generalizable">acnt&#39;</a> <a id="11577" class="Symbol">:</a> <a id="11579" href="Ledger.Conway.PParams.html#686" class="Record">Acnt</a>
  <a id="11586" href="Ledger.Conway.Epoch.html#11586" class="Generalizable">utxoSt&#39;</a>    <a id="11597" class="Symbol">:</a> <a id="11599" href="Ledger.Conway.Utxo.html#1390" class="Record">UTxOState</a>
  <a id="11611" href="Ledger.Conway.Epoch.html#11611" class="Generalizable">dState&#39;</a>    <a id="11622" class="Symbol">:</a> <a id="11624" href="Ledger.Conway.Certs.html#3151" class="Record">DState</a>
  <a id="11633" href="Ledger.Conway.Epoch.html#11633" class="Generalizable">gState&#39;</a>    <a id="11644" class="Symbol">:</a> <a id="11646" href="Ledger.Conway.Certs.html#3977" class="Record">GState</a>
  <a id="11655" href="Ledger.Conway.Epoch.html#11655" class="Generalizable">pState&#39;</a>    <a id="11666" class="Symbol">:</a> <a id="11668" href="Ledger.Conway.Certs.html#3761" class="Record">PState</a>
  <a id="11677" href="Ledger.Conway.Epoch.html#11677" class="Generalizable">govSt&#39;</a>     <a id="11688" class="Symbol">:</a> <a id="11690" href="Ledger.Conway.Gov.html#1381" class="Function">GovState</a>


<a id="11701" class="Keyword">data</a> <a id="_⊢_⇀⦇_,EPOCH⦈_"></a><a id="11706" href="Ledger.Conway.Epoch.html#11706" class="Datatype Operator">_⊢_⇀⦇_,EPOCH⦈_</a> <a id="11721" class="Symbol">:</a> <a id="11723" href="Agda.Builtin.Unit.html#175" class="Record">⊤</a> <a id="11725" class="Symbol">→</a> <a id="11727" href="Ledger.Conway.Epoch.html#1512" class="Record">EpochState</a> <a id="11738" class="Symbol">→</a> <a id="11740" href="Ledger.Conway.Types.Epoch.html#592" class="Function">Epoch</a> <a id="11746" class="Symbol">→</a> <a id="11748" href="Ledger.Conway.Epoch.html#1512" class="Record">EpochState</a> <a id="11759" class="Symbol">→</a> <a id="11761" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="11766" class="Keyword">where</a>


  <a id="_⊢_⇀⦇_,EPOCH⦈_.EPOCH"></a><a id="11776" href="Ledger.Conway.Epoch.html#11776" class="InductiveConstructor">EPOCH</a> <a id="11782" class="Symbol">:</a> <a id="11784" class="Keyword">let</a>


      <a id="11796" class="Keyword">open</a> <a id="11801" href="Ledger.Conway.Ledger.html#865" class="Module">LState</a> <a id="11808" href="Ledger.Conway.Epoch.html#8972" class="Generalizable">ls</a>
      <a id="11817" class="Keyword">open</a> <a id="11822" href="Ledger.Conway.Certs.html#4307" class="Module">CertState</a> <a id="11832" href="Ledger.Conway.Ledger.html#977" class="Function">certState</a>
      <a id="11848" class="Keyword">open</a> <a id="11853" href="Ledger.Conway.Ratify.html#3308" class="Module">RatifyState</a> <a id="11865" href="Ledger.Conway.Epoch.html#8889" class="Generalizable">fut</a> <a id="11869" class="Keyword">hiding</a> <a id="11876" class="Symbol">(</a><a id="11877" href="Ledger.Conway.Ratify.html#3345" class="Field">es</a><a id="11879" class="Symbol">)</a>
      <a id="11887" class="Keyword">open</a> <a id="11892" href="Ledger.Conway.Utxo.html#1390" class="Module">UTxOState</a>
      <a id="11908" class="Keyword">open</a> <a id="11913" href="Ledger.Conway.Certs.html#3761" class="Module">PState</a><a id="11919" class="Symbol">;</a> <a id="11921" class="Keyword">open</a> <a id="11926" href="Ledger.Conway.Certs.html#3151" class="Module">DState</a><a id="11932" class="Symbol">;</a> <a id="11934" class="Keyword">open</a> <a id="11939" href="Ledger.Conway.Certs.html#3977" class="Module">GState</a>
      <a id="11952" class="Keyword">open</a> <a id="11957" href="Ledger.Conway.PParams.html#686" class="Module">Acnt</a><a id="11961" class="Symbol">;</a> <a id="11963" class="Keyword">open</a> <a id="11968" href="Ledger.Conway.Enact.html#402" class="Module">EnactState</a><a id="11978" class="Symbol">;</a> <a id="11980" class="Keyword">open</a> <a id="11985" href="Ledger.Conway.Gov.Actions.html#2712" class="Module">GovActionState</a>


      <a id="12008" href="Ledger.Conway.Epoch.html#12008" class="Bound">esW</a>               <a id="12026" class="Symbol">=</a> <a id="12028" href="Ledger.Conway.Ratify.html#3345" class="Field">RatifyState.es</a> <a id="12043" href="Ledger.Conway.Epoch.html#8889" class="Generalizable">fut</a>
      <a id="12053" href="Ledger.Conway.Epoch.html#12053" class="Bound">es</a>                <a id="12071" class="Symbol">=</a> <a id="12073" class="Keyword">record</a> <a id="12080" href="Ledger.Conway.Epoch.html#12008" class="Bound">esW</a> <a id="12084" class="Symbol">{</a> <a id="12086" href="Ledger.Conway.Enact.html#654" class="Field">withdrawals</a> <a id="12098" class="Symbol">=</a> <a id="12100" href="Class.HasEmptySet.html#287" class="Field">∅</a> <a id="12102" class="Symbol">}</a>
      <a id="12110" href="Ledger.Conway.Epoch.html#12110" class="Bound">tmpGovSt</a>          <a id="12128" class="Symbol">=</a> <a id="12130" href="Ledger.Prelude.html#2453" class="Function">filter</a> <a id="12137" class="Symbol">(λ</a> <a id="12140" href="Ledger.Conway.Epoch.html#12140" class="Bound">x</a> <a id="12142" class="Symbol">→</a> <a id="12144" href="Data.Product.Base.html#636" class="Field">proj₁</a> <a id="12150" href="Ledger.Conway.Epoch.html#12140" class="Bound">x</a> <a id="12152" href="Class.IsSet.html#462" class="Function Operator">∉</a> <a id="12154" href="abstract-set-theory.FiniteSetTheory.html#519" class="Function">mapˢ</a> <a id="12159" href="Data.Product.Base.html#636" class="Field">proj₁</a> <a id="12165" href="Ledger.Conway.Ratify.html#3378" class="Function">removed</a><a id="12172" class="Symbol">)</a> <a id="12174" href="Ledger.Conway.Ledger.html#951" class="Function">govSt</a>
      <a id="12186" href="Ledger.Conway.Epoch.html#12186" class="Bound">orphans</a>           <a id="12204" class="Symbol">=</a> <a id="12206" href="Axiom.Set.html#5718" class="Function">fromList</a> <a id="12215" class="Symbol">(</a><a id="12216" href="Ledger.Conway.Epoch.html#7800" class="Function">getOrphans</a> <a id="12227" href="Ledger.Conway.Epoch.html#12053" class="Bound">es</a> <a id="12230" href="Ledger.Conway.Epoch.html#12110" class="Bound">tmpGovSt</a><a id="12238" class="Symbol">)</a>
      <a id="12246" href="Ledger.Conway.Epoch.html#12246" class="Bound">removed&#39;</a>          <a id="12264" class="Symbol">=</a> <a id="12266" href="Ledger.Conway.Ratify.html#3378" class="Function">removed</a> <a id="12274" href="Axiom.Set.html#8952" class="Function Operator">∪</a> <a id="12276" href="Ledger.Conway.Epoch.html#12186" class="Bound">orphans</a>
      <a id="12290" href="Ledger.Conway.Epoch.html#12290" class="Bound">removedGovActions</a> <a id="12308" class="Symbol">=</a> <a id="12310" href="Function.Base.html#1638" class="Function">flip</a> <a id="12315" href="Axiom.Set.html#7022" class="Function">concatMapˢ</a> <a id="12326" href="Ledger.Conway.Epoch.html#12246" class="Bound">removed&#39;</a> <a id="12335" class="Symbol">λ</a> <a id="12337" class="Symbol">(</a><a id="12338" href="Ledger.Conway.Epoch.html#12338" class="Bound">gaid</a> <a id="12343" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="12345" href="Ledger.Conway.Epoch.html#12345" class="Bound">gaSt</a><a id="12349" class="Symbol">)</a> <a id="12351" class="Symbol">→</a>
        <a id="12361" href="abstract-set-theory.FiniteSetTheory.html#519" class="Function">mapˢ</a> <a id="12366" class="Symbol">(</a><a id="12367" href="Ledger.Conway.Gov.Actions.html#2783" class="Field">returnAddr</a> <a id="12378" href="Ledger.Conway.Epoch.html#12345" class="Bound">gaSt</a> <a id="12383" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,_</a><a id="12385" class="Symbol">)</a> <a id="12387" class="Symbol">((</a><a id="12389" href="Ledger.Conway.Ledger.html#924" class="Function">utxoSt</a> <a id="12396" class="Symbol">.</a><a id="12397" href="Ledger.Conway.Utxo.html#1498" class="Field">deposits</a> <a id="12406" href="Axiom.Set.Map.html#10678" class="Function Operator">∣</a> <a id="12408" href="Class.HasSingleton.html#288" class="Field Operator">❴</a> <a id="12410" href="Ledger.Conway.Certs.html#501" class="InductiveConstructor">GovActionDeposit</a> <a id="12427" href="Ledger.Conway.Epoch.html#12338" class="Bound">gaid</a> <a id="12432" href="Class.HasSingleton.html#288" class="Field Operator">❵</a><a id="12433" class="Symbol">)</a> <a id="12435" href="Axiom.Set.Map.html#2293" class="Function Operator">ˢ</a><a id="12436" class="Symbol">)</a>
      <a id="12444" href="Ledger.Conway.Epoch.html#12444" class="Bound">govActionReturns</a> <a id="12461" class="Symbol">=</a> <a id="12463" href="Axiom.Set.Map.Dec.html#1932" class="Function">aggregate₊</a> <a id="12474" class="Symbol">(</a><a id="12475" href="abstract-set-theory.FiniteSetTheory.html#519" class="Function">mapˢ</a> <a id="12480" class="Symbol">(λ</a> <a id="12483" class="Symbol">(</a><a id="12484" href="Ledger.Conway.Epoch.html#12484" class="Bound">a</a> <a id="12486" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="12488" class="Symbol">_</a> <a id="12490" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="12492" href="Ledger.Conway.Epoch.html#12492" class="Bound">d</a><a id="12493" class="Symbol">)</a> <a id="12495" class="Symbol">→</a> <a id="12497" href="Ledger.Conway.Epoch.html#12484" class="Bound">a</a> <a id="12499" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="12501" href="Ledger.Conway.Epoch.html#12492" class="Bound">d</a><a id="12502" class="Symbol">)</a> <a id="12504" href="Ledger.Conway.Epoch.html#12290" class="Bound">removedGovActions</a> <a id="12522" href="abstract-set-theory.FiniteSetTheory.html#2767" class="Function Operator">ᶠˢ</a><a id="12524" class="Symbol">)</a>

      <a id="12533" href="Ledger.Conway.Epoch.html#12533" class="Bound">trWithdrawals</a>   <a id="12549" class="Symbol">=</a> <a id="12551" href="Ledger.Conway.Epoch.html#12008" class="Bound">esW</a> <a id="12555" class="Symbol">.</a><a id="12556" href="Ledger.Conway.Enact.html#654" class="Field">withdrawals</a>
      <a id="12574" href="Ledger.Conway.Epoch.html#12574" class="Bound">totWithdrawals</a>  <a id="12590" class="Symbol">=</a> <a id="12592" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">∑[</a> <a id="12595" href="Ledger.Conway.Epoch.html#12595" class="Bound">x</a> <a id="12597" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">←</a> <a id="12599" href="Ledger.Conway.Epoch.html#12533" class="Bound">trWithdrawals</a> <a id="12613" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">]</a> <a id="12615" href="Ledger.Conway.Epoch.html#12595" class="Bound">x</a>

      <a id="12624" href="Ledger.Conway.Epoch.html#12624" class="Bound">retired</a>    <a id="12635" class="Symbol">=</a> <a id="12637" class="Symbol">(</a><a id="12638" href="Ledger.Conway.Certs.html#4390" class="Function">pState</a> <a id="12645" class="Symbol">.</a><a id="12646" href="Ledger.Conway.Certs.html#3830" class="Field">retiring</a><a id="12654" class="Symbol">)</a> <a id="12656" href="Axiom.Set.Map.html#14230" class="Function Operator">⁻¹</a> <a id="12659" href="Ledger.Conway.Epoch.html#8867" class="Generalizable">e</a>
      <a id="12667" href="Ledger.Conway.Epoch.html#12667" class="Bound">payout</a>     <a id="12678" class="Symbol">=</a> <a id="12680" href="Ledger.Conway.Epoch.html#12444" class="Bound">govActionReturns</a> <a id="12697" href="Axiom.Set.Map.Dec.html#1854" class="Function Operator">∪⁺</a> <a id="12700" href="Ledger.Conway.Epoch.html#12533" class="Bound">trWithdrawals</a>
      <a id="12720" href="Ledger.Conway.Epoch.html#12720" class="Bound">refunds</a>    <a id="12731" class="Symbol">=</a> <a id="12733" href="Axiom.Set.Map.html#13791" class="Function">pullbackMap</a> <a id="12745" href="Ledger.Conway.Epoch.html#12667" class="Bound">payout</a> <a id="12752" href="Ledger.Conway.Epoch.html#4148" class="Function">toRwdAddr</a> <a id="12762" class="Symbol">(</a><a id="12763" href="Class.IsSet.html#916" class="Function">dom</a> <a id="12767" class="Symbol">(</a><a id="12768" href="Ledger.Conway.Certs.html#4370" class="Function">dState</a> <a id="12775" class="Symbol">.</a><a id="12776" href="Ledger.Conway.Certs.html#3289" class="Field">rewards</a><a id="12783" class="Symbol">))</a>
      <a id="12792" href="Ledger.Conway.Epoch.html#12792" class="Bound">unclaimed</a>  <a id="12803" class="Symbol">=</a> <a id="12805" href="Ledger.Interface.HasCoin.html#172" class="Field">getCoin</a> <a id="12813" href="Ledger.Conway.Epoch.html#12667" class="Bound">payout</a> <a id="12820" href="Interface.HasSubtract.html#209" class="Field Operator">-</a> <a id="12822" href="Ledger.Interface.HasCoin.html#172" class="Field">getCoin</a> <a id="12830" href="Ledger.Conway.Epoch.html#12720" class="Bound">refunds</a>

      <a id="12845" href="Ledger.Conway.Epoch.html#12845" class="Bound">govSt&#39;</a> <a id="12852" class="Symbol">=</a> <a id="12854" href="Ledger.Prelude.html#2453" class="Function">filter</a> <a id="12861" class="Symbol">(λ</a> <a id="12864" href="Ledger.Conway.Epoch.html#12864" class="Bound">x</a> <a id="12866" class="Symbol">→</a> <a id="12868" href="Data.Product.Base.html#636" class="Field">proj₁</a> <a id="12874" href="Ledger.Conway.Epoch.html#12864" class="Bound">x</a> <a id="12876" href="Class.IsSet.html#462" class="Function Operator">∉</a> <a id="12878" href="abstract-set-theory.FiniteSetTheory.html#519" class="Function">mapˢ</a> <a id="12883" href="Data.Product.Base.html#636" class="Field">proj₁</a> <a id="12889" href="Ledger.Conway.Epoch.html#12246" class="Bound">removed&#39;</a><a id="12897" class="Symbol">)</a> <a id="12899" href="Ledger.Conway.Ledger.html#951" class="Function">govSt</a>

      <a id="12912" href="Ledger.Conway.Epoch.html#12912" class="Bound">dState&#39;</a> <a id="12920" class="Symbol">=</a> <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.Conway.Certs.html#4370}{\htmlId{12924}{\htmlClass{Function}{\text{dState}}}}\, \,\htmlId{12931}{\htmlClass{Symbol}{\text{.}}}\,\,\href{Ledger.Conway.Certs.html#3210}{\htmlId{12932}{\htmlClass{Field}{\text{voteDelegs}}}}\, \\ \,\href{Ledger.Conway.Certs.html#4370}{\htmlId{12945}{\htmlClass{Function}{\text{dState}}}}\, \,\htmlId{12952}{\htmlClass{Symbol}{\text{.}}}\,\,\href{Ledger.Conway.Certs.html#3249}{\htmlId{12953}{\htmlClass{Field}{\text{stakeDelegs}}}}\, \\  \,\href{Ledger.Conway.Certs.html#4370}{\htmlId{12968}{\htmlClass{Function}{\text{dState}}}}\, \,\htmlId{12975}{\htmlClass{Symbol}{\text{.}}}\,\,\href{Ledger.Conway.Certs.html#3289}{\htmlId{12976}{\htmlClass{Field}{\text{rewards}}}}\, \,\href{Axiom.Set.Map.Dec.html#1854}{\htmlId{12984}{\htmlClass{Function Operator}{\text{∪⁺}}}}\, \,\href{Ledger.Conway.Epoch.html#12720}{\htmlId{12987}{\htmlClass{Bound}{\text{refunds}}}}\, \end{pmatrix}$</a>

      <a id="13004" href="Ledger.Conway.Epoch.html#13004" class="Bound">pState&#39;</a> <a id="13012" class="Symbol">=</a> <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.Conway.Certs.html#4390}{\htmlId{13016}{\htmlClass{Function}{\text{pState}}}}\, \,\htmlId{13023}{\htmlClass{Symbol}{\text{.}}}\,\,\href{Ledger.Conway.Certs.html#3793}{\htmlId{13024}{\htmlClass{Field}{\text{pools}}}}\, \,\href{Axiom.Set.Map.html#10748}{\htmlId{13030}{\htmlClass{Function Operator}{\text{∣}}}}\, \,\href{Ledger.Conway.Epoch.html#12624}{\htmlId{13032}{\htmlClass{Bound}{\text{retired}}}}\, \,\href{Axiom.Set.Map.html#10748}{\htmlId{13040}{\htmlClass{Function Operator}{\text{ᶜ}}}}\, \\ \,\href{Ledger.Conway.Certs.html#4390}{\htmlId{13044}{\htmlClass{Function}{\text{pState}}}}\, \,\htmlId{13051}{\htmlClass{Symbol}{\text{.}}}\,\,\href{Ledger.Conway.Certs.html#3830}{\htmlId{13052}{\htmlClass{Field}{\text{retiring}}}}\, \,\href{Axiom.Set.Map.html#10748}{\htmlId{13061}{\htmlClass{Function Operator}{\text{∣}}}}\, \,\href{Ledger.Conway.Epoch.html#12624}{\htmlId{13063}{\htmlClass{Bound}{\text{retired}}}}\, \,\href{Axiom.Set.Map.html#10748}{\htmlId{13071}{\htmlClass{Function Operator}{\text{ᶜ}}}}\, \end{pmatrix}$</a>

      <a id="13082" href="Ledger.Conway.Epoch.html#13082" class="Bound">gState&#39;</a> <a id="13090" class="Symbol">=</a> <a class="AgdaKaTeX">$\begin{pmatrix} (\,\href{Class.ToBool.html#389}{\htmlId{13095}{\htmlClass{Function Operator}{\text{if}}}}\, \,\href{Data.List.Base.html#4703}{\htmlId{13098}{\htmlClass{Function}{\text{null}}}}\, \,\href{Ledger.Conway.Epoch.html#12845}{\htmlId{13103}{\htmlClass{Bound}{\text{govSt&#39;}}}}\, \,\href{Class.ToBool.html#389}{\htmlId{13110}{\htmlClass{Function Operator}{\text{then}}}}\, \,\href{Axiom.Set.Map.html#6068}{\htmlId{13115}{\htmlClass{Function}{\text{mapValues}}}}\, (\,\htmlId{13126}{\htmlClass{Number}{\text{1}}}\, \,\href{Class.HasAdd.Core.html#162}{\htmlId{13128}{\htmlClass{Field Operator}{\text{+\_}}}}\,) (\,\href{Ledger.Conway.Certs.html#4410}{\htmlId{13133}{\htmlClass{Function}{\text{gState}}}}\, \,\htmlId{13140}{\htmlClass{Symbol}{\text{.}}}\,\,\href{Ledger.Conway.Certs.html#4034}{\htmlId{13141}{\htmlClass{Field}{\text{dreps}}}}\,) \,\href{Class.ToBool.html#389}{\htmlId{13148}{\htmlClass{Function Operator}{\text{else}}}}\, (\,\href{Ledger.Conway.Certs.html#4410}{\htmlId{13154}{\htmlClass{Function}{\text{gState}}}}\, \,\htmlId{13161}{\htmlClass{Symbol}{\text{.}}}\,\,\href{Ledger.Conway.Certs.html#4034}{\htmlId{13162}{\htmlClass{Field}{\text{dreps}}}}\,)
                , \,\href{Ledger.Conway.Certs.html#4410}{\htmlId{13188}{\htmlClass{Function}{\text{gState}}}}\, \,\htmlId{13195}{\htmlClass{Symbol}{\text{.}}}\,\,\href{Ledger.Conway.Certs.html#4057}{\htmlId{13196}{\htmlClass{Field}{\text{ccHotKeys}}}}\, \,\href{Axiom.Set.Map.html#10678}{\htmlId{13206}{\htmlClass{Function Operator}{\text{∣}}}}\, \,\href{Ledger.Conway.Enact.html#1199}{\htmlId{13208}{\htmlClass{Function}{\text{ccCreds}}}}\, (\,\href{Ledger.Conway.Epoch.html#12053}{\htmlId{13217}{\htmlClass{Bound}{\text{es}}}}\, \,\htmlId{13220}{\htmlClass{Symbol}{\text{.}}}\,\,\href{Ledger.Conway.Enact.html#438}{\htmlId{13221}{\htmlClass{Field}{\text{cc}}}}\,) \end{pmatrix}$</a>

      <a id="13234" href="Ledger.Conway.Epoch.html#13234" class="Bound">certState&#39;</a> <a id="13245" class="Symbol">:</a> <a id="13247" href="Ledger.Conway.Certs.html#4307" class="Record">CertState</a>
      <a id="13263" href="Ledger.Conway.Epoch.html#13234" class="Bound">certState&#39;</a> <a id="13274" class="Symbol">=</a> <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.Conway.Epoch.html#12912}{\htmlId{13278}{\htmlClass{Bound}{\text{dState&#39;}}}}\, \\ \,\href{Ledger.Conway.Epoch.html#13004}{\htmlId{13288}{\htmlClass{Bound}{\text{pState&#39;}}}}\, \\ \,\href{Ledger.Conway.Epoch.html#13082}{\htmlId{13298}{\htmlClass{Bound}{\text{gState&#39;}}}}\, \end{pmatrix}$</a>

      <a id="13315" href="Ledger.Conway.Epoch.html#13315" class="Bound">utxoSt&#39;</a> <a id="13323" class="Symbol">=</a> <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.Conway.Ledger.html#924}{\htmlId{13327}{\htmlClass{Function}{\text{utxoSt}}}}\, \,\htmlId{13334}{\htmlClass{Symbol}{\text{.}}}\,\,\href{Ledger.Conway.Utxo.html#1454}{\htmlId{13335}{\htmlClass{Field}{\text{utxo}}}}\, \\ \,\href{Ledger.Conway.Ledger.html#924}{\htmlId{13342}{\htmlClass{Function}{\text{utxoSt}}}}\, \,\htmlId{13349}{\htmlClass{Symbol}{\text{.}}}\,\,\href{Ledger.Conway.Utxo.html#1476}{\htmlId{13350}{\htmlClass{Field}{\text{fees}}}}\, \\ \,\href{Ledger.Conway.Ledger.html#924}{\htmlId{13357}{\htmlClass{Function}{\text{utxoSt}}}}\, \,\htmlId{13364}{\htmlClass{Symbol}{\text{.}}}\,\,\href{Ledger.Conway.Utxo.html#1498}{\htmlId{13365}{\htmlClass{Field}{\text{deposits}}}}\, \,\href{Axiom.Set.Map.html#10748}{\htmlId{13374}{\htmlClass{Function Operator}{\text{∣}}}}\, \,\href{abstract-set-theory.FiniteSetTheory.html#519}{\htmlId{13376}{\htmlClass{Function}{\text{mapˢ}}}}\, (\,\href{Data.Product.Base.html#636}{\htmlId{13382}{\htmlClass{Field}{\text{proj₁}}}}\, \,\href{Function.Base.html#1115}{\htmlId{13388}{\htmlClass{Function Operator}{\text{∘}}}}\, \,\href{Data.Product.Base.html#650}{\htmlId{13390}{\htmlClass{Field}{\text{proj₂}}}}\,) \,\href{Ledger.Conway.Epoch.html#12290}{\htmlId{13397}{\htmlClass{Bound}{\text{removedGovActions}}}}\, \,\href{Axiom.Set.Map.html#10748}{\htmlId{13415}{\htmlClass{Function Operator}{\text{ᶜ}}}}\, \\ \,\htmlId{13419}{\htmlClass{Number}{\text{0}}}\, \end{pmatrix}$</a>

      <a id="13430" href="Ledger.Conway.Epoch.html#13430" class="Bound">acnt&#39;</a> <a id="13436" class="Symbol">=</a> <a id="13438" class="Keyword">record</a> <a id="13445" href="Ledger.Conway.Epoch.html#11566" class="Generalizable">acnt</a>
        <a id="13458" class="Symbol">{</a> <a id="13460" href="Ledger.Conway.PParams.html#741" class="Field">treasury</a>  <a id="13470" class="Symbol">=</a> <a id="13472" href="Ledger.Conway.Epoch.html#11566" class="Generalizable">acnt</a> <a id="13477" class="Symbol">.</a><a id="13478" href="Ledger.Conway.PParams.html#741" class="Field">treasury</a> <a id="13487" href="Data.Nat.Base.html#4462" class="Primitive Operator">∸</a> <a id="13489" href="Ledger.Conway.Epoch.html#12574" class="Bound">totWithdrawals</a> <a id="13504" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="13506" href="Ledger.Conway.Ledger.html#924" class="Function">utxoSt</a> <a id="13513" class="Symbol">.</a><a id="13514" href="Ledger.Conway.Utxo.html#1524" class="Field">donations</a> <a id="13524" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="13526" href="Ledger.Conway.Epoch.html#12792" class="Bound">unclaimed</a> <a id="13536" class="Symbol">}</a>
    <a id="13542" class="Keyword">in</a>
    <a id="13549" class="Keyword">record</a> <a id="13556" class="Symbol">{</a> <a id="13558" href="Ledger.Conway.Ratify.html#3083" class="Field">currentEpoch</a> <a id="13571" class="Symbol">=</a> <a id="13573" href="Ledger.Conway.Epoch.html#8867" class="Generalizable">e</a>
           <a id="13586" class="Symbol">;</a> <a id="13588" href="Ledger.Conway.Ratify.html#3051" class="Field">stakeDistrs</a> <a id="13600" class="Symbol">=</a> <a id="13602" href="Ledger.Conway.Epoch.html#8589" class="Function">mkStakeDistrs</a>  <a id="13617" class="Symbol">(</a><a id="13618" href="Ledger.Conway.Rewards.html#6689" class="Field">Snapshots.mark</a> <a id="13633" href="Ledger.Conway.Epoch.html#9066" class="Generalizable">ss&#39;</a><a id="13636" class="Symbol">)</a> <a id="13638" href="Ledger.Conway.Epoch.html#12845" class="Bound">govSt&#39;</a>
                                          <a id="13687" class="Symbol">(</a><a id="13688" href="Ledger.Conway.Epoch.html#13315" class="Bound">utxoSt&#39;</a> <a id="13696" class="Symbol">.</a><a id="13697" href="Ledger.Conway.Utxo.html#1498" class="Field">deposits</a><a id="13705" class="Symbol">)</a> <a id="13707" class="Symbol">(</a><a id="13708" href="Ledger.Conway.Certs.html#3210" class="Field">voteDelegs</a> <a id="13719" href="Ledger.Conway.Certs.html#4370" class="Function">dState</a><a id="13725" class="Symbol">)</a>
           <a id="13738" class="Symbol">;</a> <a id="13740" href="Ledger.Conway.Ratify.html#3198" class="Field">treasury</a> <a id="13749" class="Symbol">=</a> <a id="13751" href="Ledger.Conway.Epoch.html#11566" class="Generalizable">acnt</a> <a id="13756" class="Symbol">.</a><a id="13757" href="Ledger.Conway.PParams.html#741" class="Field">treasury</a> <a id="13766" class="Symbol">;</a> <a id="13768" href="Ledger.Conway.Epoch.html#13768" class="Module">GState</a> <a id="13775" href="Ledger.Conway.Certs.html#4410" class="Function">gState</a>
           <a id="13793" class="Symbol">;</a> <a id="13795" href="Ledger.Conway.Ratify.html#3223" class="Field">pools</a> <a id="13801" class="Symbol">=</a> <a id="13803" href="Ledger.Conway.Certs.html#4390" class="Function">pState</a> <a id="13810" class="Symbol">.</a><a id="13811" href="Ledger.Conway.Certs.html#3793" class="Field">pools</a> <a id="13817" class="Symbol">;</a> <a id="13819" href="Ledger.Conway.Ratify.html#3264" class="Field">delegatees</a> <a id="13830" class="Symbol">=</a> <a id="13832" href="Ledger.Conway.Certs.html#4370" class="Function">dState</a> <a id="13839" class="Symbol">.</a><a id="13840" href="Ledger.Conway.Certs.html#3210" class="Field">voteDelegs</a> <a id="13851" class="Symbol">}</a>
        <a id="13861" href="Ledger.Conway.Ratify.html#11101" class="Function Operator">⊢</a> <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.Conway.Epoch.html#12053}{\htmlId{13865}{\htmlClass{Bound}{\text{es}}}}\, \\ \,\href{Class.HasEmptySet.html#287}{\htmlId{13870}{\htmlClass{Field}{\text{∅}}}}\, \\ \,\href{Agda.Builtin.Bool.html#192}{\htmlId{13874}{\htmlClass{InductiveConstructor}{\text{false}}}}\, \end{pmatrix}$</a> <a id="13882" href="Ledger.Conway.Ratify.html#11101" class="Function Operator">⇀⦇</a> <a id="13885" href="Ledger.Conway.Epoch.html#12845" class="Bound">govSt&#39;</a> <a id="13892" href="Ledger.Conway.Ratify.html#11101" class="Function Operator">,RATIFIES⦈</a> <a id="13903" href="Ledger.Conway.Epoch.html#8893" class="Generalizable">fut&#39;</a>
      <a id="13914" class="Symbol">→</a> <a id="13916" href="Ledger.Conway.Epoch.html#8972" class="Generalizable">ls</a> <a id="13919" href="Ledger.Conway.Rewards.html#6928" class="Datatype Operator">⊢</a> <a id="13921" href="Ledger.Conway.Epoch.html#9063" class="Generalizable">ss</a> <a id="13924" href="Ledger.Conway.Rewards.html#6928" class="Datatype Operator">⇀⦇</a> <a id="13927" href="Agda.Builtin.Unit.html#212" class="InductiveConstructor">tt</a> <a id="13930" href="Ledger.Conway.Rewards.html#6928" class="Datatype Operator">,SNAP⦈</a> <a id="13937" href="Ledger.Conway.Epoch.html#9066" class="Generalizable">ss&#39;</a>
    <a id="13945" href="iog-prelude.Prelude.InferenceRules.html#217" class="Function Operator">────────────────────────────────</a>
    <a id="13982" class="Symbol">_</a> <a id="13984" href="Ledger.Conway.Epoch.html#11706" class="Datatype Operator">⊢</a> <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.Conway.Epoch.html#11566}{\htmlId{13988}{\htmlClass{Generalizable}{\text{acnt}}}}\, \\ \,\href{Ledger.Conway.Epoch.html#9063}{\htmlId{13995}{\htmlClass{Generalizable}{\text{ss}}}}\, \\ \,\href{Ledger.Conway.Epoch.html#8972}{\htmlId{14000}{\htmlClass{Generalizable}{\text{ls}}}}\, \\ \,\href{Ledger.Conway.Epoch.html#8986}{\htmlId{14005}{\htmlClass{Generalizable}{\text{es₀}}}}\, \\ \,\href{Ledger.Conway.Epoch.html#8889}{\htmlId{14011}{\htmlClass{Generalizable}{\text{fut}}}}\, \end{pmatrix}$</a> <a id="14017" href="Ledger.Conway.Epoch.html#11706" class="Datatype Operator">⇀⦇</a> <a id="14020" href="Ledger.Conway.Epoch.html#8867" class="Generalizable">e</a> <a id="14022" href="Ledger.Conway.Epoch.html#11706" class="Datatype Operator">,EPOCH⦈</a>
        <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.Conway.Epoch.html#13430}{\htmlId{14040}{\htmlClass{Bound}{\text{acnt&#39;}}}}\, \\ \,\href{Ledger.Conway.Epoch.html#9066}{\htmlId{14048}{\htmlClass{Generalizable}{\text{ss&#39;}}}}\, \\ \begin{pmatrix} \,\href{Ledger.Conway.Epoch.html#13315}{\htmlId{14056}{\htmlClass{Bound}{\text{utxoSt&#39;}}}}\, \\ \,\href{Ledger.Conway.Epoch.html#12845}{\htmlId{14066}{\htmlClass{Bound}{\text{govSt&#39;}}}}\, \\ \,\href{Ledger.Conway.Epoch.html#13234}{\htmlId{14075}{\htmlClass{Bound}{\text{certState&#39;}}}}\, \end{pmatrix} \\ \,\href{Ledger.Conway.Epoch.html#12053}{\htmlId{14090}{\htmlClass{Bound}{\text{es}}}}\, \\ \,\href{Ledger.Conway.Epoch.html#8893}{\htmlId{14095}{\htmlClass{Generalizable}{\text{fut&#39;}}}}\, \end{pmatrix}$</a>


<a id="14104" class="Keyword">data</a>


  <a id="_⊢_⇀⦇_,NEWEPOCH⦈_"></a><a id="14113" href="Ledger.Conway.Epoch.html#14113" class="Datatype Operator">_⊢_⇀⦇_,NEWEPOCH⦈_</a> <a id="14131" class="Symbol">:</a> <a id="14133" href="Agda.Builtin.Unit.html#175" class="Record">⊤</a> <a id="14135" class="Symbol">→</a> <a id="14137" href="Ledger.Conway.Epoch.html#2526" class="Record">NewEpochState</a> <a id="14151" class="Symbol">→</a> <a id="14153" href="Ledger.Conway.Types.Epoch.html#592" class="Function">Epoch</a> <a id="14159" class="Symbol">→</a> <a id="14161" href="Ledger.Conway.Epoch.html#2526" class="Record">NewEpochState</a> <a id="14175" class="Symbol">→</a> <a id="14177" href="Agda.Primitive.html#388" class="Primitive">Type</a>


  <a id="14186" class="Keyword">where</a>


  <a id="_⊢_⇀⦇_,NEWEPOCH⦈_.NEWEPOCH-New"></a><a id="14196" href="Ledger.Conway.Epoch.html#14196" class="InductiveConstructor">NEWEPOCH-New</a> <a id="14209" class="Symbol">:</a> <a id="14211" class="Keyword">let</a>
      <a id="14221" href="Ledger.Conway.Epoch.html#14221" class="Bound">eps&#39;</a> <a id="14226" class="Symbol">=</a> <a id="14228" href="Ledger.Conway.Epoch.html#7103" class="Function">applyRUpd</a> <a id="14238" href="Ledger.Conway.Epoch.html#9084" class="Generalizable">ru</a> <a id="14241" href="Ledger.Conway.Epoch.html#8942" class="Generalizable">eps</a>
    <a id="14249" class="Keyword">in</a>
    <a id="14256" href="Prelude.InferenceRules.html#56074" class="Function Operator">∙</a> <a id="14258" href="Ledger.Conway.Epoch.html#8867" class="Generalizable">e</a> <a id="14260" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="14262" href="Ledger.Conway.Epoch.html#8869" class="Generalizable">lastEpoch</a> <a id="14272" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="14274" class="Number">1</a>
    <a id="14280" href="iog-prelude.Prelude.InferenceRules.html#583" class="Function Operator">∙</a> <a id="14282" class="Symbol">_</a> <a id="14284" href="Ledger.Conway.Epoch.html#11706" class="Datatype Operator">⊢</a> <a id="14286" href="Ledger.Conway.Epoch.html#14221" class="Bound">eps&#39;</a> <a id="14291" href="Ledger.Conway.Epoch.html#11706" class="Datatype Operator">⇀⦇</a> <a id="14294" href="Ledger.Conway.Epoch.html#8867" class="Generalizable">e</a> <a id="14296" href="Ledger.Conway.Epoch.html#11706" class="Datatype Operator">,EPOCH⦈</a> <a id="14304" href="Ledger.Conway.Epoch.html#8951" class="Generalizable">eps&#39;&#39;</a>
      <a id="14316" href="iog-prelude.Prelude.InferenceRules.html#217" class="Function Operator">────────────────────────────────</a>
      <a id="14355" class="Symbol">_</a> <a id="14357" href="Ledger.Conway.Epoch.html#14113" class="Datatype Operator">⊢</a> <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.Conway.Epoch.html#8869}{\htmlId{14361}{\htmlClass{Generalizable}{\text{lastEpoch}}}}\, \\ \,\href{Ledger.Conway.Epoch.html#8942}{\htmlId{14373}{\htmlClass{Generalizable}{\text{eps}}}}\, \\ \,\href{Agda.Builtin.Maybe.html#173}{\htmlId{14379}{\htmlClass{InductiveConstructor}{\text{just}}}}\, \,\href{Ledger.Conway.Epoch.html#9084}{\htmlId{14384}{\htmlClass{Generalizable}{\text{ru}}}}\, \end{pmatrix}$</a> <a id="14389" href="Ledger.Conway.Epoch.html#14113" class="Datatype Operator">⇀⦇</a> <a id="14392" href="Ledger.Conway.Epoch.html#8867" class="Generalizable">e</a> <a id="14394" href="Ledger.Conway.Epoch.html#14113" class="Datatype Operator">,NEWEPOCH⦈</a> <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.Conway.Epoch.html#8867}{\htmlId{14407}{\htmlClass{Generalizable}{\text{e}}}}\, \\ \,\href{Ledger.Conway.Epoch.html#8951}{\htmlId{14411}{\htmlClass{Generalizable}{\text{eps&#39;&#39;}}}}\, \\ \,\href{Agda.Builtin.Maybe.html#194}{\htmlId{14419}{\htmlClass{InductiveConstructor}{\text{nothing}}}}\, \end{pmatrix}$</a>

  <a id="_⊢_⇀⦇_,NEWEPOCH⦈_.NEWEPOCH-Not-New"></a><a id="14432" href="Ledger.Conway.Epoch.html#14432" class="InductiveConstructor">NEWEPOCH-Not-New</a> <a id="14449" class="Symbol">:</a>
    <a id="14455" href="Prelude.InferenceRules.html#56074" class="Function Operator">∙</a> <a id="14457" href="Ledger.Conway.Epoch.html#8867" class="Generalizable">e</a> <a id="14459" href="Relation.Binary.PropositionalEquality.Core.html#858" class="Function Operator">≢</a> <a id="14461" href="Ledger.Conway.Epoch.html#8869" class="Generalizable">lastEpoch</a> <a id="14471" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="14473" class="Number">1</a>
      <a id="14481" href="iog-prelude.Prelude.InferenceRules.html#217" class="Function Operator">────────────────────────────────</a>
      <a id="14520" class="Symbol">_</a> <a id="14522" href="Ledger.Conway.Epoch.html#14113" class="Datatype Operator">⊢</a> <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.Conway.Epoch.html#8869}{\htmlId{14526}{\htmlClass{Generalizable}{\text{lastEpoch}}}}\, \\ \,\href{Ledger.Conway.Epoch.html#8942}{\htmlId{14538}{\htmlClass{Generalizable}{\text{eps}}}}\, \\ \,\href{Ledger.Conway.Epoch.html#9104}{\htmlId{14544}{\htmlClass{Generalizable}{\text{mru}}}}\, \end{pmatrix}$</a> <a id="14550" href="Ledger.Conway.Epoch.html#14113" class="Datatype Operator">⇀⦇</a> <a id="14553" href="Ledger.Conway.Epoch.html#8867" class="Generalizable">e</a> <a id="14555" href="Ledger.Conway.Epoch.html#14113" class="Datatype Operator">,NEWEPOCH⦈</a> <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.Conway.Epoch.html#8869}{\htmlId{14568}{\htmlClass{Generalizable}{\text{lastEpoch}}}}\, \\ \,\href{Ledger.Conway.Epoch.html#8942}{\htmlId{14580}{\htmlClass{Generalizable}{\text{eps}}}}\, \\ \,\href{Ledger.Conway.Epoch.html#9104}{\htmlId{14586}{\htmlClass{Generalizable}{\text{mru}}}}\, \end{pmatrix}$</a>

  <a id="_⊢_⇀⦇_,NEWEPOCH⦈_.NEWEPOCH-No-Reward-Update"></a><a id="14595" href="Ledger.Conway.Epoch.html#14595" class="InductiveConstructor">NEWEPOCH-No-Reward-Update</a> <a id="14621" class="Symbol">:</a>
    <a id="14627" href="Prelude.InferenceRules.html#56074" class="Function Operator">∙</a> <a id="14629" href="Ledger.Conway.Epoch.html#8867" class="Generalizable">e</a> <a id="14631" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="14633" href="Ledger.Conway.Epoch.html#8869" class="Generalizable">lastEpoch</a> <a id="14643" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="14645" class="Number">1</a>
    <a id="14651" href="iog-prelude.Prelude.InferenceRules.html#583" class="Function Operator">∙</a> <a id="14653" class="Symbol">_</a> <a id="14655" href="Ledger.Conway.Epoch.html#11706" class="Datatype Operator">⊢</a> <a id="14657" href="Ledger.Conway.Epoch.html#8942" class="Generalizable">eps</a> <a id="14661" href="Ledger.Conway.Epoch.html#11706" class="Datatype Operator">⇀⦇</a> <a id="14664" href="Ledger.Conway.Epoch.html#8867" class="Generalizable">e</a> <a id="14666" href="Ledger.Conway.Epoch.html#11706" class="Datatype Operator">,EPOCH⦈</a> <a id="14674" href="Ledger.Conway.Epoch.html#8946" class="Generalizable">eps&#39;</a>
      <a id="14685" href="iog-prelude.Prelude.InferenceRules.html#217" class="Function Operator">────────────────────────────────</a>
      <a id="14724" class="Symbol">_</a> <a id="14726" href="Ledger.Conway.Epoch.html#14113" class="Datatype Operator">⊢</a> <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.Conway.Epoch.html#8869}{\htmlId{14730}{\htmlClass{Generalizable}{\text{lastEpoch}}}}\, \\ \,\href{Ledger.Conway.Epoch.html#8942}{\htmlId{14742}{\htmlClass{Generalizable}{\text{eps}}}}\, \\ \,\href{Agda.Builtin.Maybe.html#194}{\htmlId{14748}{\htmlClass{InductiveConstructor}{\text{nothing}}}}\, \end{pmatrix}$</a> <a id="14758" href="Ledger.Conway.Epoch.html#14113" class="Datatype Operator">⇀⦇</a> <a id="14761" href="Ledger.Conway.Epoch.html#8867" class="Generalizable">e</a> <a id="14763" href="Ledger.Conway.Epoch.html#14113" class="Datatype Operator">,NEWEPOCH⦈</a> <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.Conway.Epoch.html#8867}{\htmlId{14776}{\htmlClass{Generalizable}{\text{e}}}}\, \\ \,\href{Ledger.Conway.Epoch.html#8946}{\htmlId{14780}{\htmlClass{Generalizable}{\text{eps&#39;}}}}\, \\ \,\href{Agda.Builtin.Maybe.html#194}{\htmlId{14787}{\htmlClass{InductiveConstructor}{\text{nothing}}}}\, \end{pmatrix}$</a>

</pre></body></html>