<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>Test.Examples.MultiSigV2.OffChain.Cleanup</title><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.css"><link rel="stylesheet" href="Agda.css"><script src="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.js"></script><script src="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/contrib/auto-render.min.js"></script><script src="AgdaKaTeX.js" defer=""></script></head><body><pre class="Agda"><a id="1" class="Symbol">{-#</a> <a id="5" class="Keyword">OPTIONS</a> <a id="13" class="Pragma">--safe</a> <a id="20" class="Symbol">#-}</a>

<a id="25" class="Keyword">module</a> <a id="32" href="Test.Examples.MultiSigV2.OffChain.Cleanup.html" class="Module">Test.Examples.MultiSigV2.OffChain.Cleanup</a> <a id="74" class="Keyword">where</a>

<a id="81" class="Keyword">open</a> <a id="86" class="Keyword">import</a> <a id="93" href="Ledger.Prelude.html" class="Module">Ledger.Prelude</a>
<a id="108" class="Keyword">open</a> <a id="113" class="Keyword">import</a> <a id="120" href="Ledger.Core.Specification.Transaction.html" class="Module">Ledger.Core.Specification.Transaction</a>

<a id="159" class="Keyword">open</a> <a id="164" class="Keyword">import</a> <a id="171" href="Test.Examples.MultiSigV2.Datum.html" class="Module">Test.Examples.MultiSigV2.Datum</a>
<a id="202" class="Keyword">open</a> <a id="207" class="Keyword">import</a> <a id="214" href="Test.Examples.MultiSigV2.OffChain.Lib.html" class="Module">Test.Examples.MultiSigV2.OffChain.Lib</a>
<a id="252" class="Keyword">open</a> <a id="257" class="Keyword">import</a> <a id="264" href="Test.Examples.MultiSigV2.Validator.html" class="Module">Test.Examples.MultiSigV2.Validator</a>
<a id="299" class="Keyword">open</a> <a id="304" class="Keyword">import</a> <a id="311" href="Test.Prelude.html" class="Module">Test.Prelude</a> <a id="324" href="Test.Examples.MultiSigV2.Datum.html#572" class="Function">MultiSigData</a>
<a id="337" class="Keyword">open</a> <a id="342" class="Keyword">import</a> <a id="349" href="Test.SymbolicData.html" class="Module">Test.SymbolicData</a> <a id="367" href="Test.Examples.MultiSigV2.Datum.html#572" class="Function">MultiSigData</a>
<a id="380" class="Keyword">open</a> <a id="385" class="Keyword">import</a> <a id="392" href="Test.LedgerImplementation.html" class="Module">Test.LedgerImplementation</a> <a id="418" href="Test.SymbolicData.html#240" class="Function">SData</a> <a id="424" href="Test.SymbolicData.html#240" class="Function">SData</a>
<a id="430" class="Keyword">open</a> <a id="435" class="Keyword">import</a> <a id="442" href="Test.AbstractImplementation.html" class="Module">Test.AbstractImplementation</a> <a id="470" href="Test.SymbolicData.html#2902" class="Function">valContext</a>
<a id="481" class="Keyword">open</a> <a id="486" class="Keyword">import</a> <a id="493" href="Test.Lib.html" class="Module">Test.Lib</a> <a id="502" href="Test.SymbolicData.html#2902" class="Function">valContext</a>

<a id="514" class="Keyword">open</a> <a id="519" class="Keyword">import</a> <a id="526" href="Ledger.Conway.Specification.Script.Validation.html" class="Module">Ledger.Conway.Specification.Script.Validation</a> <a id="572" href="Test.LedgerImplementation.html#4275" class="Function">SVTransactionStructure</a> <a id="595" href="Test.AbstractImplementation.html#673" class="Function">SVAbstractFunctions</a>
<a id="615" class="Keyword">open</a> <a id="620" class="Keyword">import</a> <a id="627" href="Ledger.Conway.Specification.Transaction.html" class="Module">Ledger.Conway.Specification.Transaction</a> <a id="667" href="Test.LedgerImplementation.html#4275" class="Function">SVTransactionStructure</a> <a id="690" href="Test.AbstractImplementation.html#673" class="Function">SVAbstractFunctions</a>
<a id="710" class="Keyword">open</a> <a id="715" class="Keyword">import</a> <a id="722" href="Ledger.Conway.Specification.Utxo.html" class="Module">Ledger.Conway.Specification.Utxo</a> <a id="755" href="Test.LedgerImplementation.html#4275" class="Function">SVTransactionStructure</a> <a id="778" href="Test.AbstractImplementation.html#673" class="Function">SVAbstractFunctions</a>

<a id="799" class="Keyword">open</a> <a id="804" href="Ledger.Core.Specification.Transaction.html#896" class="Module">TransactionStructure</a> <a id="825" href="Test.LedgerImplementation.html#4275" class="Function">SVTransactionStructure</a>
<a id="848" class="Keyword">open</a> <a id="853" href="Test.LedgerImplementation.html#1056" class="Module">Implementation</a>

<a id="makeCleanupTx"></a><a id="869" href="Test.Examples.MultiSigV2.OffChain.Cleanup.html#869" class="Function">makeCleanupTx</a> <a id="883" class="Symbol">:</a> <a id="885" class="Symbol">(</a><a id="886" href="Test.Examples.MultiSigV2.OffChain.Cleanup.html#886" class="Bound">id</a> <a id="889" class="Symbol">:</a> <a id="891" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a><a id="892" class="Symbol">)</a> <a id="894" class="Symbol">→</a> <a id="896" href="Ledger.Conway.Specification.Utxo.html#1306" class="Record">UTxOState</a> <a id="906" class="Symbol">→</a> <a id="908" href="Test.LedgerImplementation.html#1450" class="Function">PlutusScript</a> <a id="921" class="Symbol">→</a> <a id="923" class="Symbol">(</a><a id="924" href="Test.Examples.MultiSigV2.OffChain.Cleanup.html#924" class="Bound">w</a> <a id="926" class="Symbol">:</a> <a id="928" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a><a id="929" class="Symbol">)</a> <a id="931" class="Symbol">→</a> <a id="933" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="939" href="Ledger.Conway.Specification.Transaction.html#1719" class="Record">Tx</a>
<a id="942" href="Test.Examples.MultiSigV2.OffChain.Cleanup.html#869" class="Function">makeCleanupTx</a> <a id="956" href="Test.Examples.MultiSigV2.OffChain.Cleanup.html#956" class="Bound">id</a> <a id="959" href="Test.Examples.MultiSigV2.OffChain.Cleanup.html#959" class="Bound">state</a> <a id="965" href="Test.Examples.MultiSigV2.OffChain.Cleanup.html#965" class="Bound">script</a><a id="971" class="Symbol">@(</a><a id="973" href="Test.Examples.MultiSigV2.OffChain.Cleanup.html#973" class="Bound">sh</a> <a id="976" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="978" class="Symbol">_)</a> <a id="981" href="Test.Examples.MultiSigV2.OffChain.Cleanup.html#981" class="Bound">w</a> <a id="983" class="Symbol">=</a> 
  <a id="988" class="Keyword">let</a>
    <a id="996" href="Test.Examples.MultiSigV2.OffChain.Cleanup.html#996" class="Bound">wutxo</a> <a id="1002" class="Symbol">=</a> <a id="1004" href="Test.Examples.MultiSigV2.OffChain.Lib.html#2482" class="Function">getWalletUTxO</a> <a id="1018" href="Test.Examples.MultiSigV2.OffChain.Cleanup.html#981" class="Bound">w</a> <a id="1020" class="Symbol">(</a><a id="1021" href="Ledger.Conway.Specification.Utxo.html#1370" class="Field">UTxOState.utxo</a> <a id="1036" href="Test.Examples.MultiSigV2.OffChain.Cleanup.html#959" class="Bound">state</a><a id="1041" class="Symbol">)</a>
  <a id="1045" class="Keyword">in</a>
    <a id="1052" href="Data.Maybe.Base.html#1276" class="Function">maybe</a> <a id="1058" class="Symbol">(λ</a> <a id="1061" class="Symbol">{</a> <a id="1063" class="Symbol">(</a><a id="1064" href="Test.Examples.MultiSigV2.OffChain.Cleanup.html#1064" class="Bound">scIn</a> <a id="1069" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1071" class="Symbol">(</a><a id="1072" href="Test.Examples.MultiSigV2.OffChain.Cleanup.html#1072" class="Bound">fst</a> <a id="1076" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1078" href="Test.Examples.MultiSigV2.OffChain.Cleanup.html#1078" class="Bound">txValue</a> <a id="1086" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1088" href="Test.Examples.MultiSigV2.OffChain.Cleanup.html#1088" class="Bound">snd</a><a id="1091" class="Symbol">))</a> <a id="1094" class="Symbol">→</a>
    <a id="1100" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="1105" class="Symbol">(</a>
          <a id="1117" class="Keyword">record</a> <a id="1124" class="Symbol">{</a> <a id="1126" href="Ledger.Conway.Specification.Transaction.html#1747" class="Field">body</a> <a id="1131" class="Symbol">=</a> <a id="1133" class="Keyword">record</a> <a id="1140" href="Test.Examples.MultiSigV2.OffChain.Lib.html#882" class="Function">defaultTxBody</a>
                         <a id="1179" class="Symbol">{</a> <a id="1181" href="Ledger.Conway.Specification.Transaction.html#382" class="Field">txIns</a> <a id="1187" class="Symbol">=</a> <a id="1189" href="Axiom.Set.html#5903" class="Function">Ledger.Prelude.fromList</a> <a id="1213" class="Symbol">((</a><a id="1215" href="Test.Examples.MultiSigV2.OffChain.Cleanup.html#1064" class="Bound">scIn</a> <a id="1220" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="1222" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a><a id="1224" class="Symbol">)</a> <a id="1226" href="Data.List.Base.html#1712" class="Function Operator">++</a> <a id="1229" class="Symbol">(</a><a id="1230" href="Class.Functor.Core.html#272" class="Function">map</a> <a id="1234" href="Data.Product.Base.html#636" class="Field">proj₁</a> <a id="1240" href="Test.Examples.MultiSigV2.OffChain.Cleanup.html#996" class="Bound">wutxo</a><a id="1245" class="Symbol">))</a>
                         <a id="1273" class="Symbol">;</a> <a id="1275" href="Ledger.Conway.Specification.Transaction.html#484" class="Field">txOuts</a> <a id="1282" class="Symbol">=</a> <a id="1284" href="Test.Lib.html#5513" class="Function">fromListIx</a> <a id="1295" class="Symbol">(</a><a id="1296" href="Test.Examples.MultiSigV2.OffChain.Lib.html#3533" class="Function">makeFeeUnPaymentTxOut</a> <a id="1318" href="Test.Examples.MultiSigV2.OffChain.Cleanup.html#996" class="Bound">wutxo</a> <a id="1324" href="Test.Examples.MultiSigV2.OffChain.Cleanup.html#1078" class="Bound">txValue</a><a id="1331" class="Symbol">)</a>
                         <a id="1358" class="Symbol">;</a> <a id="1360" href="Ledger.Conway.Specification.Transaction.html#522" class="Field">txId</a> <a id="1365" class="Symbol">=</a> <a id="1367" href="Test.Examples.MultiSigV2.OffChain.Cleanup.html#956" class="Bound">id</a>
                         <a id="1395" class="Symbol">;</a> <a id="1397" href="Ledger.Conway.Specification.Transaction.html#450" class="Field">collateralInputs</a> <a id="1414" class="Symbol">=</a> <a id="1416" href="Axiom.Set.html#5903" class="Function">Ledger.Prelude.fromList</a> <a id="1440" class="Symbol">(</a><a id="1441" href="Class.Functor.Core.html#272" class="Function">map</a> <a id="1445" href="Data.Product.Base.html#636" class="Field">proj₁</a> <a id="1451" href="Test.Examples.MultiSigV2.OffChain.Cleanup.html#996" class="Bound">wutxo</a><a id="1456" class="Symbol">)</a>
                         <a id="1483" class="Symbol">;</a> <a id="1485" href="Ledger.Conway.Specification.Transaction.html#991" class="Field">reqSignerHashes</a> <a id="1501" class="Symbol">=</a> <a id="1503" href="Axiom.Set.html#5903" class="Function">Ledger.Prelude.fromList</a> <a id="1527" class="Symbol">(</a><a id="1528" href="Test.Examples.MultiSigV2.OffChain.Cleanup.html#981" class="Bound">w</a> <a id="1530" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="1532" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a><a id="1534" class="Symbol">)</a>
                         <a id="1561" class="Symbol">}</a> <a id="1563" class="Symbol">;</a>
                <a id="1581" href="Ledger.Conway.Specification.Transaction.html#1769" class="Field">wits</a> <a id="1586" class="Symbol">=</a> <a id="1588" class="Keyword">record</a> <a id="1595" class="Symbol">{</a> <a id="1597" href="Ledger.Core.Specification.Transaction.html#2928" class="Field">vkSigs</a> <a id="1604" class="Symbol">=</a> <a id="1606" href="Axiom.Set.Map.html#2713" class="Function">fromListᵐ</a> <a id="1616" class="Symbol">((</a><a id="1618" href="Test.Examples.MultiSigV2.OffChain.Cleanup.html#981" class="Bound">w</a> <a id="1620" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1622" class="Symbol">(</a><a id="1623" href="Class.HasAdd.Core.html#162" class="Field Operator">_+_</a> <a id="1627" class="Symbol">{{</a><a id="1629" href="Class.HasAdd.Instances.html#143" class="Function">addNat</a><a id="1635" class="Symbol">}}</a> <a id="1638" class="Symbol">(</a><a id="1639" href="Test.Examples.MultiSigV2.OffChain.Lib.html#4029" class="Function">getTxId</a> <a id="1647" href="Test.Examples.MultiSigV2.OffChain.Cleanup.html#996" class="Bound">wutxo</a><a id="1652" class="Symbol">)</a> <a id="1654" href="Test.Examples.MultiSigV2.OffChain.Cleanup.html#981" class="Bound">w</a><a id="1655" class="Symbol">)</a> <a id="1657" class="Symbol">)</a> <a id="1659" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="1661" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a><a id="1663" class="Symbol">)</a> <a id="1665" class="Symbol">;</a> 
                                <a id="1700" href="Ledger.Core.Specification.Transaction.html#2956" class="Field">scripts</a> <a id="1708" class="Symbol">=</a> <a id="1710" href="Axiom.Set.html#5903" class="Function">Ledger.Prelude.fromList</a> <a id="1734" class="Symbol">((</a><a id="1736" href="Data.Sum.Base.html#700" class="InductiveConstructor">inj₂</a> <a id="1741" href="Test.Examples.MultiSigV2.OffChain.Cleanup.html#965" class="Bound">script</a><a id="1747" class="Symbol">)</a> <a id="1749" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="1751" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a><a id="1753" class="Symbol">)</a> <a id="1755" class="Symbol">;</a>
                                <a id="1789" href="Ledger.Core.Specification.Transaction.html#2982" class="Field">txdats</a> <a id="1796" class="Symbol">=</a> <a id="1798" href="Class.HasEmptySet.html#287" class="Field">∅</a> <a id="1800" class="Symbol">;</a>
                                <a id="1834" href="Ledger.Core.Specification.Transaction.html#3007" class="Field">txrdmrs</a> <a id="1842" class="Symbol">=</a> <a id="1844" href="Axiom.Set.Map.html#2713" class="Function">fromListᵐ</a> <a id="1854" class="Symbol">(((</a><a id="1857" href="Ledger.Core.Specification.Transaction.html#778" class="InductiveConstructor">Spend</a> <a id="1863" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1865" class="Symbol">(</a><a id="1866" href="Data.Product.Base.html#650" class="Field">proj₂</a> <a id="1872" href="Test.Examples.MultiSigV2.OffChain.Cleanup.html#1064" class="Bound">scIn</a><a id="1876" class="Symbol">))</a> <a id="1879" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a>
                                                      <a id="1935" href="Data.Sum.Base.html#675" class="InductiveConstructor">inj₁</a> <a id="1940" class="Symbol">(</a><a id="1941" href="Data.Sum.Base.html#700" class="InductiveConstructor">inj₂</a> <a id="1946" href="Test.Examples.MultiSigV2.Datum.html#466" class="InductiveConstructor">Cleanup</a><a id="1953" class="Symbol">)</a> <a id="1955" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> 
                                                      <a id="2012" class="Symbol">((</a><a id="2014" href="Test.Examples.MultiSigV2.OffChain.Lib.html#4029" class="Function">getTxId</a> <a id="2022" href="Test.Examples.MultiSigV2.OffChain.Cleanup.html#996" class="Bound">wutxo</a><a id="2027" class="Symbol">)</a> <a id="2029" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="2031" href="Test.Examples.MultiSigV2.OffChain.Cleanup.html#981" class="Bound">w</a><a id="2032" class="Symbol">))</a> <a id="2035" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="2037" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a><a id="2039" class="Symbol">)</a> <a id="2041" class="Symbol">}</a> <a id="2043" class="Symbol">;</a>
                <a id="2061" href="Ledger.Conway.Specification.Transaction.html#1796" class="Field">txsize</a> <a id="2068" class="Symbol">=</a> <a id="2070" class="Number">10</a> <a id="2073" class="Symbol">;</a>
                <a id="2091" href="Ledger.Conway.Specification.Transaction.html#1813" class="Field">isValid</a> <a id="2099" class="Symbol">=</a> <a id="2101" href="Agda.Builtin.Bool.html#198" class="InductiveConstructor">true</a> <a id="2106" class="Symbol">;</a>
                <a id="2124" href="Ledger.Conway.Specification.Transaction.html#1833" class="Field">txAD</a> <a id="2129" class="Symbol">=</a> <a id="2131" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a> <a id="2139" class="Symbol">}</a>
                <a id="2157" class="Symbol">)</a>
            <a id="2171" class="Symbol">})</a>
          <a id="2184" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a>
          <a id="2202" class="Symbol">(</a><a id="2203" href="Test.Examples.MultiSigV2.OffChain.Lib.html#1973" class="Function">getScriptUTxO</a> <a id="2217" href="Test.Examples.MultiSigV2.OffChain.Cleanup.html#973" class="Bound">sh</a> <a id="2220" class="Symbol">(</a><a id="2221" href="Ledger.Conway.Specification.Utxo.html#1370" class="Field">UTxOState.utxo</a> <a id="2236" href="Test.Examples.MultiSigV2.OffChain.Cleanup.html#959" class="Bound">state</a><a id="2241" class="Symbol">))</a>

</pre></body></html>