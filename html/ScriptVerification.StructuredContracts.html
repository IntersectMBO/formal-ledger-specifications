<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>ScriptVerification.StructuredContracts</title><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.css"><link rel="stylesheet" href="Agda.css"><script src="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.js"></script><script src="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/contrib/auto-render.min.js"></script><script src="AgdaKaTeX.js" defer=""></script></head><body><pre class="Agda">
<a id="2" class="Symbol">{-#</a> <a id="6" class="Keyword">OPTIONS</a> <a id="14" class="Pragma">--safe</a> <a id="21" class="Symbol">#-}</a>

<a id="26" class="Keyword">open</a> <a id="31" class="Keyword">import</a> <a id="38" href="Algebra.html" class="Module">Algebra</a>
<a id="46" class="Keyword">open</a> <a id="51" class="Keyword">import</a> <a id="58" href="Data.Nat.Properties.html" class="Module">Data.Nat.Properties</a> <a id="78" class="Keyword">using</a> <a id="84" class="Symbol">(</a><a id="85" href="Data.Nat.Properties.html#17252" class="Function">+-0-monoid</a><a id="95" class="Symbol">)</a>

<a id="98" class="Keyword">open</a> <a id="103" class="Keyword">import</a> <a id="110" href="Ledger.Prelude.html" class="Module">Ledger.Prelude</a><a id="124" class="Symbol">;</a> <a id="126" class="Keyword">open</a> <a id="131" href="Function.Bundles.html#4752" class="Module">Equivalence</a>
<a id="143" class="Keyword">open</a> <a id="148" class="Keyword">import</a> <a id="155" href="Ledger.Conway.Transaction.html" class="Module">Ledger.Conway.Transaction</a>
<a id="181" class="Keyword">open</a> <a id="186" class="Keyword">import</a> <a id="193" href="Ledger.Conway.Abstract.html" class="Module">Ledger.Conway.Abstract</a>
<a id="216" class="Keyword">open</a> <a id="221" class="Keyword">import</a> <a id="228" href="Ledger.Conway.TokenAlgebra.Base.html" class="Module">Ledger.Conway.TokenAlgebra.Base</a>
<a id="260" class="Keyword">open</a> <a id="265" class="Keyword">import</a> <a id="272" href="Ledger.Conway.TokenAlgebra.ValueSet.html" class="Module">Ledger.Conway.TokenAlgebra.ValueSet</a>


<a id="310" class="Keyword">module</a> <a id="317" href="ScriptVerification.StructuredContracts.html" class="Module">ScriptVerification.StructuredContracts</a>
  <a id="358" class="Symbol">(</a><a id="359" href="ScriptVerification.StructuredContracts.html#359" class="Bound">txs</a> <a id="363" class="Symbol">:</a> <a id="365" class="Symbol">_)</a> <a id="368" class="Symbol">(</a><a id="369" class="Keyword">open</a> <a id="374" href="Ledger.Conway.Transaction.html#888" class="Module">TransactionStructure</a> <a id="395" href="ScriptVerification.StructuredContracts.html#359" class="Bound">txs</a><a id="398" class="Symbol">)</a>
  <a id="402" class="Symbol">(</a><a id="403" href="ScriptVerification.StructuredContracts.html#403" class="Bound">abs</a> <a id="407" class="Symbol">:</a> <a id="409" href="Ledger.Conway.Abstract.html#599" class="Record">AbstractFunctions</a> <a id="427" href="ScriptVerification.StructuredContracts.html#359" class="Bound">txs</a><a id="430" class="Symbol">)</a> <a id="432" class="Symbol">(</a><a id="433" class="Keyword">open</a> <a id="438" href="Ledger.Conway.Abstract.html#599" class="Module">AbstractFunctions</a> <a id="456" href="ScriptVerification.StructuredContracts.html#403" class="Bound">abs</a><a id="459" class="Symbol">)</a>
  <a id="463" class="Keyword">where</a>

<a id="470" class="Keyword">open</a> <a id="475" class="Keyword">import</a> <a id="482" href="Ledger.Conway.Ledger.html" class="Module">Ledger.Conway.Ledger</a> <a id="503" href="ScriptVerification.StructuredContracts.html#359" class="Bound">txs</a> <a id="507" href="ScriptVerification.StructuredContracts.html#403" class="Bound">abs</a>
<a id="511" class="Keyword">open</a> <a id="516" class="Keyword">import</a> <a id="523" href="Ledger.Conway.ScriptValidation.html" class="Module">Ledger.Conway.ScriptValidation</a> <a id="554" href="ScriptVerification.StructuredContracts.html#359" class="Bound">txs</a> <a id="558" href="ScriptVerification.StructuredContracts.html#403" class="Bound">abs</a>
<a id="562" class="Keyword">open</a> <a id="567" class="Keyword">import</a> <a id="574" href="Ledger.Conway.Utxo.html" class="Module">Ledger.Conway.Utxo</a> <a id="593" href="ScriptVerification.StructuredContracts.html#359" class="Bound">txs</a> <a id="597" href="ScriptVerification.StructuredContracts.html#403" class="Bound">abs</a>


<a id="SSRel"></a><a id="603" href="ScriptVerification.StructuredContracts.html#603" class="Function">SSRel</a> <a id="609" class="Symbol">:</a> <a id="611" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="616" class="Symbol">→</a> <a id="618" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="623" class="Symbol">→</a> <a id="625" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="630" class="Symbol">→</a> <a id="632" href="Agda.Primitive.html#388" class="Primitive">Type₁</a>
<a id="638" href="ScriptVerification.StructuredContracts.html#603" class="Function">SSRel</a> <a id="644" href="ScriptVerification.StructuredContracts.html#644" class="Bound">Env</a> <a id="648" href="ScriptVerification.StructuredContracts.html#648" class="Bound">State</a> <a id="654" href="ScriptVerification.StructuredContracts.html#654" class="Bound">Input</a> <a id="660" class="Symbol">=</a> <a id="662" href="ScriptVerification.StructuredContracts.html#644" class="Bound">Env</a> <a id="666" class="Symbol">→</a> <a id="668" href="ScriptVerification.StructuredContracts.html#648" class="Bound">State</a> <a id="674" class="Symbol">→</a> <a id="676" href="ScriptVerification.StructuredContracts.html#654" class="Bound">Input</a> <a id="682" class="Symbol">→</a> <a id="684" href="ScriptVerification.StructuredContracts.html#648" class="Bound">State</a> <a id="690" class="Symbol">→</a> <a id="692" href="Agda.Primitive.html#388" class="Primitive">Type</a>

<a id="698" class="Keyword">record</a> <a id="StrucSimulation"></a><a id="705" href="ScriptVerification.StructuredContracts.html#705" class="Record">StrucSimulation</a> <a id="721" href="ScriptVerification.StructuredContracts.html#721" class="Bound">S</a> <a id="723" href="ScriptVerification.StructuredContracts.html#723" class="Bound">I</a> <a id="725" class="Symbol">(</a><a id="726" href="ScriptVerification.StructuredContracts.html#726" class="Bound Operator">_⊢_⇀⦇_,STRUC⦈_</a> <a id="741" class="Symbol">:</a> <a id="743" href="ScriptVerification.StructuredContracts.html#603" class="Function">SSRel</a> <a id="749" href="Agda.Builtin.Unit.html#175" class="Record">⊤</a> <a id="751" href="ScriptVerification.StructuredContracts.html#721" class="Bound">S</a> <a id="753" href="ScriptVerification.StructuredContracts.html#723" class="Bound">I</a><a id="754" class="Symbol">)</a> <a id="756" class="Symbol">:</a> <a id="758" href="Agda.Primitive.html#388" class="Primitive">Type₁</a> <a id="764" class="Keyword">where</a>
  <a id="772" class="Keyword">field</a>
    <a id="StrucSimulation.πˢ"></a><a id="782" href="ScriptVerification.StructuredContracts.html#782" class="Field">πˢ</a> <a id="785" class="Symbol">:</a> <a id="787" href="Ledger.Conway.Ledger.html#865" class="Record">LState</a> <a id="794" class="Symbol">→</a> <a id="796" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="802" href="ScriptVerification.StructuredContracts.html#721" class="Bound">S</a>
    <a id="StrucSimulation.πⁱ"></a><a id="808" href="ScriptVerification.StructuredContracts.html#808" class="Field">πⁱ</a> <a id="811" class="Symbol">:</a> <a id="813" href="Ledger.Conway.ScriptValidation.html#1857" class="Record">TxInfo</a> <a id="820" class="Symbol">→</a> <a id="822" href="ScriptVerification.StructuredContracts.html#723" class="Bound">I</a>
    <a id="828" class="Comment">-- here, add optional extra assumptions about ledger state, env, and transaction that may be too difficult to prove without reasoning about complete ledger traces</a>
    <a id="995" class="Comment">-- e.g. transaction does not re-add a UTxO entry it spends</a>
    <a id="1058" class="Comment">-- e.g. current Slot is after the validity interval of some previous transaction</a>
    <a id="StrucSimulation.extraAssmp"></a><a id="1143" href="ScriptVerification.StructuredContracts.html#1143" class="Field">extraAssmp</a> <a id="1154" class="Symbol">:</a> <a id="1156" href="Ledger.Conway.Ledger.html#601" class="Record">LEnv</a> <a id="1161" class="Symbol">→</a> <a id="1163" href="Ledger.Conway.Ledger.html#865" class="Record">LState</a> <a id="1170" class="Symbol">→</a> <a id="1172" href="Ledger.Conway.Transaction.html#4298" class="Record">Tx</a> <a id="1175" class="Symbol">→</a> <a id="1177" href="Agda.Primitive.html#388" class="Primitive">Type</a> 

  <a id="StrucSimulation._~ˢ_"></a><a id="1186" href="ScriptVerification.StructuredContracts.html#1186" class="Function Operator">_~ˢ_</a> <a id="1191" class="Symbol">:</a> <a id="1193" href="Ledger.Conway.Ledger.html#865" class="Record">LState</a> <a id="1200" class="Symbol">→</a> <a id="1202" href="ScriptVerification.StructuredContracts.html#721" class="Bound">S</a> <a id="1204" class="Symbol">→</a> <a id="1206" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="1211" class="Comment">-- R</a>
  <a id="1218" href="ScriptVerification.StructuredContracts.html#1218" class="Bound">u</a> <a id="1220" href="ScriptVerification.StructuredContracts.html#1186" class="Function Operator">~ˢ</a> <a id="1223" href="ScriptVerification.StructuredContracts.html#1223" class="Bound">s</a> <a id="1225" class="Symbol">=</a> <a id="1227" href="ScriptVerification.StructuredContracts.html#782" class="Field">πˢ</a> <a id="1230" href="ScriptVerification.StructuredContracts.html#1218" class="Bound">u</a> <a id="1232" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="1234" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="1239" href="ScriptVerification.StructuredContracts.html#1223" class="Bound">s</a>

    <a id="1246" class="Comment">-- only for PlutusV3</a>
  <a id="StrucSimulation._~ᵉ_"></a><a id="1269" href="ScriptVerification.StructuredContracts.html#1269" class="Function Operator">_~ᵉ_</a> <a id="1274" class="Symbol">:</a> <a id="1276" href="Ledger.Conway.Ledger.html#601" class="Record">LEnv</a> <a id="1281" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="1283" href="Ledger.Conway.Transaction.html#4298" class="Record">Tx</a> <a id="1286" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="1288" href="Ledger.Conway.Ledger.html#865" class="Record">LState</a> <a id="1295" class="Symbol">→</a> <a id="1297" href="Agda.Builtin.Unit.html#175" class="Record">⊤</a> <a id="1299" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="1301" href="ScriptVerification.StructuredContracts.html#723" class="Bound">I</a> <a id="1303" class="Symbol">→</a> <a id="1305" href="Agda.Primitive.html#388" class="Primitive">Type</a>
  <a id="1312" href="ScriptVerification.StructuredContracts.html#1269" class="Function Operator">_~ᵉ_</a> <a id="1317" class="Symbol">=</a> <a id="1319" class="Symbol">λ</a> <a id="1321" class="Symbol">(</a><a id="1322" href="ScriptVerification.StructuredContracts.html#1322" class="Bound">le</a> <a id="1325" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1327" href="ScriptVerification.StructuredContracts.html#1327" class="Bound">tx</a> <a id="1330" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1332" href="ScriptVerification.StructuredContracts.html#1332" class="Bound">u</a><a id="1333" class="Symbol">)</a> <a id="1335" class="Symbol">(</a><a id="1336" href="Agda.Builtin.Unit.html#212" class="InductiveConstructor">tt</a> <a id="1339" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1341" href="ScriptVerification.StructuredContracts.html#1341" class="Bound">i</a><a id="1342" class="Symbol">)</a> <a id="1344" class="Symbol">→</a> <a id="1346" href="ScriptVerification.StructuredContracts.html#808" class="Field">πⁱ</a> <a id="1349" class="Symbol">(</a><a id="1350" href="Ledger.Conway.ScriptValidation.html#2165" class="Function">txInfo</a> <a id="1357" href="Ledger.Conway.Script.Base.html#1029" class="Function">PlutusV3</a> <a id="1366" class="Symbol">(</a><a id="1367" href="Ledger.Conway.PParams.html#3549" class="Field">PParamsOf</a> <a id="1377" href="ScriptVerification.StructuredContracts.html#1322" class="Bound">le</a><a id="1379" class="Symbol">)</a> <a id="1381" class="Symbol">(</a><a id="1382" href="Ledger.Conway.Transaction.html#2693" class="Field">UTxOOf</a> <a id="1389" href="ScriptVerification.StructuredContracts.html#1332" class="Bound">u</a><a id="1390" class="Symbol">)</a> <a id="1392" href="ScriptVerification.StructuredContracts.html#1327" class="Bound">tx</a><a id="1394" class="Symbol">)</a> <a id="1396" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="1398" href="ScriptVerification.StructuredContracts.html#1341" class="Bound">i</a>

  <a id="1403" class="Keyword">field</a>
    <a id="StrucSimulation.simulates"></a><a id="1413" href="ScriptVerification.StructuredContracts.html#1413" class="Field">simulates</a> <a id="1423" class="Symbol">:</a> <a id="1425" class="Symbol">∀</a> <a id="1427" href="ScriptVerification.StructuredContracts.html#1427" class="Bound">Γ</a> <a id="1429" href="ScriptVerification.StructuredContracts.html#1429" class="Bound">s</a> <a id="1431" href="ScriptVerification.StructuredContracts.html#1431" class="Bound">u</a> <a id="1433" href="ScriptVerification.StructuredContracts.html#1433" class="Bound">tx</a> <a id="1436" href="ScriptVerification.StructuredContracts.html#1436" class="Bound">i′</a> <a id="1439" href="ScriptVerification.StructuredContracts.html#1439" class="Bound">u′</a> <a id="1442" class="Symbol">→</a> <a id="1444" href="ScriptVerification.StructuredContracts.html#1143" class="Field">extraAssmp</a> <a id="1455" href="ScriptVerification.StructuredContracts.html#1427" class="Bound">Γ</a> <a id="1457" href="ScriptVerification.StructuredContracts.html#1431" class="Bound">u</a> <a id="1459" href="ScriptVerification.StructuredContracts.html#1433" class="Bound">tx</a> <a id="1462" class="Symbol">→</a>
      <a id="1470" href="Prelude.InferenceRules.html#56074" class="Function Operator">∙</a> <a id="1472" href="ScriptVerification.StructuredContracts.html#1427" class="Bound">Γ</a> <a id="1474" href="Ledger.Conway.Ledger.html#2637" class="Datatype Operator">⊢</a> <a id="1476" href="ScriptVerification.StructuredContracts.html#1431" class="Bound">u</a> <a id="1478" href="Ledger.Conway.Ledger.html#2637" class="Datatype Operator">⇀⦇</a> <a id="1481" href="ScriptVerification.StructuredContracts.html#1433" class="Bound">tx</a> <a id="1484" href="Ledger.Conway.Ledger.html#2637" class="Datatype Operator">,LEDGER⦈</a> <a id="1493" href="ScriptVerification.StructuredContracts.html#1439" class="Bound">u′</a>
      <a id="1502" href="iog-prelude.Prelude.InferenceRules.html#583" class="Function Operator">∙</a> <a id="1504" class="Symbol">(</a><a id="1505" href="ScriptVerification.StructuredContracts.html#1427" class="Bound">Γ</a> <a id="1507" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1509" href="ScriptVerification.StructuredContracts.html#1433" class="Bound">tx</a> <a id="1512" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1514" href="ScriptVerification.StructuredContracts.html#1431" class="Bound">u</a><a id="1515" class="Symbol">)</a> <a id="1517" href="ScriptVerification.StructuredContracts.html#1269" class="Function Operator">~ᵉ</a> <a id="1520" class="Symbol">(</a><a id="1521" href="Agda.Builtin.Unit.html#212" class="InductiveConstructor">tt</a> <a id="1524" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1526" href="ScriptVerification.StructuredContracts.html#1436" class="Bound">i′</a><a id="1528" class="Symbol">)</a>
      <a id="1536" href="iog-prelude.Prelude.InferenceRules.html#583" class="Function Operator">∙</a> <a id="1538" href="ScriptVerification.StructuredContracts.html#1431" class="Bound">u</a> <a id="1540" href="ScriptVerification.StructuredContracts.html#1186" class="Function Operator">~ˢ</a> <a id="1543" href="ScriptVerification.StructuredContracts.html#1429" class="Bound">s</a>
      <a id="1551" href="iog-prelude.Prelude.InferenceRules.html#217" class="Function Operator">────────────────────────────────</a>
        <a id="1592" href="Data.Product.Base.html#1371" class="Function">∃[</a> <a id="1595" href="ScriptVerification.StructuredContracts.html#1595" class="Bound">s′</a> <a id="1598" href="Data.Product.Base.html#1371" class="Function">]</a> <a id="1600" href="ScriptVerification.StructuredContracts.html#1439" class="Bound">u′</a> <a id="1603" href="ScriptVerification.StructuredContracts.html#1186" class="Function Operator">~ˢ</a> <a id="1606" href="ScriptVerification.StructuredContracts.html#1595" class="Bound">s′</a>
               <a id="1624" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="1626" href="Agda.Builtin.Unit.html#212" class="InductiveConstructor">tt</a> <a id="1629" href="ScriptVerification.StructuredContracts.html#726" class="Bound Operator">⊢</a> <a id="1631" href="ScriptVerification.StructuredContracts.html#1429" class="Bound">s</a> <a id="1633" href="ScriptVerification.StructuredContracts.html#726" class="Bound Operator">⇀⦇</a> <a id="1636" href="ScriptVerification.StructuredContracts.html#1436" class="Bound">i′</a> <a id="1639" href="ScriptVerification.StructuredContracts.html#726" class="Bound Operator">,STRUC⦈</a> <a id="1647" href="ScriptVerification.StructuredContracts.html#1595" class="Bound">s′</a>

</pre></body></html>