<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>ScriptVerification.StructuredContracts</title><link rel="stylesheet" href="Agda.css"></head><body><pre class="Agda">
<a id="2" class="Symbol">{-#</a> <a id="6" class="Keyword">OPTIONS</a> <a id="14" class="Pragma">--safe</a> <a id="21" class="Symbol">#-}</a>

<a id="26" class="Keyword">open</a> <a id="31" class="Keyword">import</a> <a id="38" href="Algebra.html" class="Module">Algebra</a>
<a id="46" class="Keyword">open</a> <a id="51" class="Keyword">import</a> <a id="58" href="Data.Nat.Properties.html" class="Module">Data.Nat.Properties</a> <a id="78" class="Keyword">using</a> <a id="84" class="Symbol">(</a><a id="85" href="Data.Nat.Properties.html#17252" class="Function">+-0-monoid</a><a id="95" class="Symbol">)</a>

<a id="98" class="Keyword">open</a> <a id="103" class="Keyword">import</a> <a id="110" href="Ledger.Prelude.html" class="Module">Ledger.Prelude</a><a id="124" class="Symbol">;</a> <a id="126" class="Keyword">open</a> <a id="131" href="Function.Bundles.html#4752" class="Module">Equivalence</a>
<a id="143" class="Keyword">open</a> <a id="148" class="Keyword">import</a> <a id="155" href="Ledger.Transaction.html" class="Module">Ledger.Transaction</a>
<a id="174" class="Keyword">open</a> <a id="179" class="Keyword">import</a> <a id="186" href="Ledger.Abstract.html" class="Module">Ledger.Abstract</a>
<a id="202" class="Keyword">open</a> <a id="207" class="Keyword">import</a> <a id="214" href="Ledger.TokenAlgebra.html" class="Module">Ledger.TokenAlgebra</a> 
<a id="235" class="Keyword">open</a> <a id="240" class="Keyword">import</a> <a id="247" href="Ledger.TokenAlgebra.ValueSet.html" class="Module">Ledger.TokenAlgebra.ValueSet</a>


<a id="278" class="Keyword">module</a> <a id="285" href="ScriptVerification.StructuredContracts.html" class="Module">ScriptVerification.StructuredContracts</a>
  <a id="326" class="Symbol">(</a><a id="327" href="ScriptVerification.StructuredContracts.html#327" class="Bound">txs</a> <a id="331" class="Symbol">:</a> <a id="333" class="Symbol">_)</a> <a id="336" class="Symbol">(</a><a id="337" class="Keyword">open</a> <a id="342" href="Ledger.Transaction.html#867" class="Module">TransactionStructure</a> <a id="363" href="ScriptVerification.StructuredContracts.html#327" class="Bound">txs</a><a id="366" class="Symbol">)</a>
  <a id="370" class="Symbol">(</a><a id="371" href="ScriptVerification.StructuredContracts.html#371" class="Bound">abs</a> <a id="375" class="Symbol">:</a> <a id="377" href="Ledger.Abstract.html#578" class="Record">AbstractFunctions</a> <a id="395" href="ScriptVerification.StructuredContracts.html#327" class="Bound">txs</a><a id="398" class="Symbol">)</a> <a id="400" class="Symbol">(</a><a id="401" class="Keyword">open</a> <a id="406" href="Ledger.Abstract.html#578" class="Module">AbstractFunctions</a> <a id="424" href="ScriptVerification.StructuredContracts.html#371" class="Bound">abs</a><a id="427" class="Symbol">)</a>
  <a id="431" class="Keyword">where</a>

<a id="438" class="Keyword">open</a> <a id="443" class="Keyword">import</a> <a id="450" href="Ledger.Ledger.html" class="Module">Ledger.Ledger</a> <a id="464" href="ScriptVerification.StructuredContracts.html#327" class="Bound">txs</a> <a id="468" href="ScriptVerification.StructuredContracts.html#371" class="Bound">abs</a>
<a id="472" class="Keyword">open</a> <a id="477" class="Keyword">import</a> <a id="484" href="Ledger.ScriptValidation.html" class="Module">Ledger.ScriptValidation</a> <a id="508" href="ScriptVerification.StructuredContracts.html#327" class="Bound">txs</a> <a id="512" href="ScriptVerification.StructuredContracts.html#371" class="Bound">abs</a>
<a id="516" class="Keyword">open</a> <a id="521" class="Keyword">import</a> <a id="528" href="Ledger.Utxo.html" class="Module">Ledger.Utxo</a> <a id="540" href="ScriptVerification.StructuredContracts.html#327" class="Bound">txs</a> <a id="544" href="ScriptVerification.StructuredContracts.html#371" class="Bound">abs</a>


<a id="SSRel"></a><a id="550" href="ScriptVerification.StructuredContracts.html#550" class="Function">SSRel</a> <a id="556" class="Symbol">:</a> <a id="558" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="563" class="Symbol">→</a> <a id="565" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="570" class="Symbol">→</a> <a id="572" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="577" class="Symbol">→</a> <a id="579" href="Agda.Primitive.html#388" class="Primitive">Type₁</a>
<a id="585" href="ScriptVerification.StructuredContracts.html#550" class="Function">SSRel</a> <a id="591" href="ScriptVerification.StructuredContracts.html#591" class="Bound">Env</a> <a id="595" href="ScriptVerification.StructuredContracts.html#595" class="Bound">State</a> <a id="601" href="ScriptVerification.StructuredContracts.html#601" class="Bound">Input</a> <a id="607" class="Symbol">=</a> <a id="609" href="ScriptVerification.StructuredContracts.html#591" class="Bound">Env</a> <a id="613" class="Symbol">→</a> <a id="615" href="ScriptVerification.StructuredContracts.html#595" class="Bound">State</a> <a id="621" class="Symbol">→</a> <a id="623" href="ScriptVerification.StructuredContracts.html#601" class="Bound">Input</a> <a id="629" class="Symbol">→</a> <a id="631" href="ScriptVerification.StructuredContracts.html#595" class="Bound">State</a> <a id="637" class="Symbol">→</a> <a id="639" href="Agda.Primitive.html#388" class="Primitive">Type</a>

<a id="645" class="Keyword">record</a> <a id="StrucSimulation"></a><a id="652" href="ScriptVerification.StructuredContracts.html#652" class="Record">StrucSimulation</a> <a id="668" href="ScriptVerification.StructuredContracts.html#668" class="Bound">S</a> <a id="670" href="ScriptVerification.StructuredContracts.html#670" class="Bound">I</a> <a id="672" class="Symbol">(</a><a id="673" href="ScriptVerification.StructuredContracts.html#673" class="Bound Operator">_⊢_⇀⦇_,STRUC⦈_</a> <a id="688" class="Symbol">:</a> <a id="690" href="ScriptVerification.StructuredContracts.html#550" class="Function">SSRel</a> <a id="696" href="Agda.Builtin.Unit.html#175" class="Record">⊤</a> <a id="698" href="ScriptVerification.StructuredContracts.html#668" class="Bound">S</a> <a id="700" href="ScriptVerification.StructuredContracts.html#670" class="Bound">I</a><a id="701" class="Symbol">)</a> <a id="703" class="Symbol">:</a> <a id="705" href="Agda.Primitive.html#388" class="Primitive">Type₁</a> <a id="711" class="Keyword">where</a>
  <a id="719" class="Keyword">field</a>
    <a id="StrucSimulation.πˢ"></a><a id="729" href="ScriptVerification.StructuredContracts.html#729" class="Field">πˢ</a> <a id="732" class="Symbol">:</a> <a id="734" href="Ledger.Ledger.html#809" class="Record">LState</a> <a id="741" class="Symbol">→</a> <a id="743" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="749" href="ScriptVerification.StructuredContracts.html#668" class="Bound">S</a>
    <a id="StrucSimulation.πⁱ"></a><a id="755" href="ScriptVerification.StructuredContracts.html#755" class="Field">πⁱ</a> <a id="758" class="Symbol">:</a> <a id="760" href="Ledger.ScriptValidation.html#1822" class="Record">TxInfo</a> <a id="767" class="Symbol">→</a> <a id="769" href="ScriptVerification.StructuredContracts.html#670" class="Bound">I</a>
    <a id="775" class="Comment">-- here, add optional extra assumptions about ledger state, env, and transaction that may be too difficult to prove without reasoning about complete ledger traces</a>
    <a id="942" class="Comment">-- e.g. transaction does not re-add a UTxO entry it spends</a>
    <a id="1005" class="Comment">-- e.g. current Slot is after the validity interval of some previous transaction</a>
    <a id="StrucSimulation.extraAssmp"></a><a id="1090" href="ScriptVerification.StructuredContracts.html#1090" class="Field">extraAssmp</a> <a id="1101" class="Symbol">:</a> <a id="1103" href="Ledger.Ledger.html#545" class="Record">LEnv</a> <a id="1108" class="Symbol">→</a> <a id="1110" href="Ledger.Ledger.html#809" class="Record">LState</a> <a id="1117" class="Symbol">→</a> <a id="1119" href="Ledger.Transaction.html#4234" class="Record">Tx</a> <a id="1122" class="Symbol">→</a> <a id="1124" href="Agda.Primitive.html#388" class="Primitive">Type</a> 

  <a id="StrucSimulation._~ˢ_"></a><a id="1133" href="ScriptVerification.StructuredContracts.html#1133" class="Function Operator">_~ˢ_</a> <a id="1138" class="Symbol">:</a> <a id="1140" href="Ledger.Ledger.html#809" class="Record">LState</a> <a id="1147" class="Symbol">→</a> <a id="1149" href="ScriptVerification.StructuredContracts.html#668" class="Bound">S</a> <a id="1151" class="Symbol">→</a> <a id="1153" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="1158" class="Comment">-- R</a>
  <a id="1165" href="ScriptVerification.StructuredContracts.html#1165" class="Bound">u</a> <a id="1167" href="ScriptVerification.StructuredContracts.html#1133" class="Function Operator">~ˢ</a> <a id="1170" href="ScriptVerification.StructuredContracts.html#1170" class="Bound">s</a> <a id="1172" class="Symbol">=</a> <a id="1174" href="ScriptVerification.StructuredContracts.html#729" class="Field">πˢ</a> <a id="1177" href="ScriptVerification.StructuredContracts.html#1165" class="Bound">u</a> <a id="1179" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="1181" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="1186" href="ScriptVerification.StructuredContracts.html#1170" class="Bound">s</a>

    <a id="1193" class="Comment">-- only for PlutusV3</a>
  <a id="StrucSimulation._~ᵉ_"></a><a id="1216" href="ScriptVerification.StructuredContracts.html#1216" class="Function Operator">_~ᵉ_</a> <a id="1221" class="Symbol">:</a> <a id="1223" href="Ledger.Ledger.html#545" class="Record">LEnv</a> <a id="1228" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="1230" href="Ledger.Transaction.html#4234" class="Record">Tx</a> <a id="1233" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="1235" href="Ledger.Ledger.html#809" class="Record">LState</a> <a id="1242" class="Symbol">→</a> <a id="1244" href="Agda.Builtin.Unit.html#175" class="Record">⊤</a> <a id="1246" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="1248" href="ScriptVerification.StructuredContracts.html#670" class="Bound">I</a> <a id="1250" class="Symbol">→</a> <a id="1252" href="Agda.Primitive.html#388" class="Primitive">Type</a>
  <a id="1259" href="ScriptVerification.StructuredContracts.html#1216" class="Function Operator">_~ᵉ_</a> <a id="1264" class="Symbol">=</a> <a id="1266" class="Symbol">λ</a> <a id="1268" class="Symbol">(</a><a id="1269" href="ScriptVerification.StructuredContracts.html#1269" class="Bound">le</a> <a id="1272" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1274" href="ScriptVerification.StructuredContracts.html#1274" class="Bound">tx</a> <a id="1277" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1279" href="ScriptVerification.StructuredContracts.html#1279" class="Bound">u</a><a id="1280" class="Symbol">)</a> <a id="1282" class="Symbol">(</a><a id="1283" href="Agda.Builtin.Unit.html#212" class="InductiveConstructor">tt</a> <a id="1286" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1288" href="ScriptVerification.StructuredContracts.html#1288" class="Bound">i</a><a id="1289" class="Symbol">)</a> <a id="1291" class="Symbol">→</a> <a id="1293" href="ScriptVerification.StructuredContracts.html#755" class="Field">πⁱ</a> <a id="1296" class="Symbol">(</a><a id="1297" href="Ledger.ScriptValidation.html#2130" class="Function">txInfo</a> <a id="1304" href="Ledger.Script.html#1055" class="Function">PlutusV3</a> <a id="1313" class="Symbol">(</a><a id="1314" href="Ledger.PParams.html#3424" class="Field">PParamsOf</a> <a id="1324" href="ScriptVerification.StructuredContracts.html#1269" class="Bound">le</a><a id="1326" class="Symbol">)</a> <a id="1328" class="Symbol">(</a><a id="1329" href="Ledger.Transaction.html#2634" class="Field">UTxOOf</a> <a id="1336" href="ScriptVerification.StructuredContracts.html#1279" class="Bound">u</a><a id="1337" class="Symbol">)</a> <a id="1339" href="ScriptVerification.StructuredContracts.html#1274" class="Bound">tx</a><a id="1341" class="Symbol">)</a> <a id="1343" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="1345" href="ScriptVerification.StructuredContracts.html#1288" class="Bound">i</a>

  <a id="1350" class="Keyword">field</a>
    <a id="StrucSimulation.simulates"></a><a id="1360" href="ScriptVerification.StructuredContracts.html#1360" class="Field">simulates</a> <a id="1370" class="Symbol">:</a> <a id="1372" class="Symbol">∀</a> <a id="1374" href="ScriptVerification.StructuredContracts.html#1374" class="Bound">Γ</a> <a id="1376" href="ScriptVerification.StructuredContracts.html#1376" class="Bound">s</a> <a id="1378" href="ScriptVerification.StructuredContracts.html#1378" class="Bound">u</a> <a id="1380" href="ScriptVerification.StructuredContracts.html#1380" class="Bound">tx</a> <a id="1383" href="ScriptVerification.StructuredContracts.html#1383" class="Bound">i′</a> <a id="1386" href="ScriptVerification.StructuredContracts.html#1386" class="Bound">u′</a> <a id="1389" class="Symbol">→</a> <a id="1391" href="ScriptVerification.StructuredContracts.html#1090" class="Field">extraAssmp</a> <a id="1402" href="ScriptVerification.StructuredContracts.html#1374" class="Bound">Γ</a> <a id="1404" href="ScriptVerification.StructuredContracts.html#1378" class="Bound">u</a> <a id="1406" href="ScriptVerification.StructuredContracts.html#1380" class="Bound">tx</a> <a id="1409" class="Symbol">→</a>
      <a id="1417" href="Interface.STS.html#105" class="Function Operator">∙</a> <a id="1419" href="ScriptVerification.StructuredContracts.html#1374" class="Bound">Γ</a> <a id="1421" href="Ledger.Ledger.html#2581" class="Datatype Operator">⊢</a> <a id="1423" href="ScriptVerification.StructuredContracts.html#1378" class="Bound">u</a> <a id="1425" href="Ledger.Ledger.html#2581" class="Datatype Operator">⇀⦇</a> <a id="1428" href="ScriptVerification.StructuredContracts.html#1380" class="Bound">tx</a> <a id="1431" href="Ledger.Ledger.html#2581" class="Datatype Operator">,LEDGER⦈</a> <a id="1440" href="ScriptVerification.StructuredContracts.html#1386" class="Bound">u′</a>
      <a id="1449" href="Interface.STS.html#131" class="Function Operator">∙</a> <a id="1451" class="Symbol">(</a><a id="1452" href="ScriptVerification.StructuredContracts.html#1374" class="Bound">Γ</a> <a id="1454" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1456" href="ScriptVerification.StructuredContracts.html#1380" class="Bound">tx</a> <a id="1459" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1461" href="ScriptVerification.StructuredContracts.html#1378" class="Bound">u</a><a id="1462" class="Symbol">)</a> <a id="1464" href="ScriptVerification.StructuredContracts.html#1216" class="Function Operator">~ᵉ</a> <a id="1467" class="Symbol">(</a><a id="1468" href="Agda.Builtin.Unit.html#212" class="InductiveConstructor">tt</a> <a id="1471" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1473" href="ScriptVerification.StructuredContracts.html#1383" class="Bound">i′</a><a id="1475" class="Symbol">)</a>
      <a id="1483" href="Interface.STS.html#131" class="Function Operator">∙</a> <a id="1485" href="ScriptVerification.StructuredContracts.html#1378" class="Bound">u</a> <a id="1487" href="ScriptVerification.StructuredContracts.html#1133" class="Function Operator">~ˢ</a> <a id="1490" href="ScriptVerification.StructuredContracts.html#1376" class="Bound">s</a>
      <a id="1498" href="Interface.STS.html#350" class="Function Operator">────────────────────────────────</a>
        <a id="1539" href="Data.Product.Base.html#1371" class="Function">∃[</a> <a id="1542" href="ScriptVerification.StructuredContracts.html#1542" class="Bound">s′</a> <a id="1545" href="Data.Product.Base.html#1371" class="Function">]</a> <a id="1547" href="ScriptVerification.StructuredContracts.html#1386" class="Bound">u′</a> <a id="1550" href="ScriptVerification.StructuredContracts.html#1133" class="Function Operator">~ˢ</a> <a id="1553" href="ScriptVerification.StructuredContracts.html#1542" class="Bound">s′</a>
               <a id="1571" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="1573" href="Agda.Builtin.Unit.html#212" class="InductiveConstructor">tt</a> <a id="1576" href="ScriptVerification.StructuredContracts.html#673" class="Bound Operator">⊢</a> <a id="1578" href="ScriptVerification.StructuredContracts.html#1376" class="Bound">s</a> <a id="1580" href="ScriptVerification.StructuredContracts.html#673" class="Bound Operator">⇀⦇</a> <a id="1583" href="ScriptVerification.StructuredContracts.html#1383" class="Bound">i′</a> <a id="1586" href="ScriptVerification.StructuredContracts.html#673" class="Bound Operator">,STRUC⦈</a> <a id="1594" href="ScriptVerification.StructuredContracts.html#1542" class="Bound">s′</a>

</pre></body></html>