<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>ScriptVerification.StructuredContracts</title><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.css"><link rel="stylesheet" href="Agda.css"><script src="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.js"></script><script src="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/contrib/auto-render.min.js"></script><script src="AgdaKaTeX.js" defer=""></script></head><body><pre class="Agda">
<a id="2" class="Symbol">{-#</a> <a id="6" class="Keyword">OPTIONS</a> <a id="14" class="Pragma">--safe</a> <a id="21" class="Symbol">#-}</a>

<a id="26" class="Keyword">open</a> <a id="31" class="Keyword">import</a> <a id="38" href="Algebra.html" class="Module">Algebra</a>
<a id="46" class="Keyword">open</a> <a id="51" class="Keyword">import</a> <a id="58" href="Data.Nat.Properties.html" class="Module">Data.Nat.Properties</a> <a id="78" class="Keyword">using</a> <a id="84" class="Symbol">(</a><a id="85" href="Data.Nat.Properties.html#17252" class="Function">+-0-monoid</a><a id="95" class="Symbol">)</a>

<a id="98" class="Keyword">open</a> <a id="103" class="Keyword">import</a> <a id="110" href="Ledger.Prelude.html" class="Module">Ledger.Prelude</a><a id="124" class="Symbol">;</a> <a id="126" class="Keyword">open</a> <a id="131" href="Function.Bundles.html#4752" class="Module">Equivalence</a>
<a id="143" class="Keyword">open</a> <a id="148" class="Keyword">import</a> <a id="155" href="Ledger.Conway.Transaction.html" class="Module">Ledger.Conway.Transaction</a>
<a id="181" class="Keyword">open</a> <a id="186" class="Keyword">import</a> <a id="193" href="Ledger.Conway.Abstract.html" class="Module">Ledger.Conway.Abstract</a>
<a id="216" class="Keyword">open</a> <a id="221" class="Keyword">import</a> <a id="228" href="Ledger.Conway.TokenAlgebra.html" class="Module">Ledger.Conway.TokenAlgebra</a> 
<a id="256" class="Keyword">open</a> <a id="261" class="Keyword">import</a> <a id="268" href="Ledger.Conway.TokenAlgebra.ValueSet.html" class="Module">Ledger.Conway.TokenAlgebra.ValueSet</a>


<a id="306" class="Keyword">module</a> <a id="313" href="ScriptVerification.StructuredContracts.html" class="Module">ScriptVerification.StructuredContracts</a>
  <a id="354" class="Symbol">(</a><a id="355" href="ScriptVerification.StructuredContracts.html#355" class="Bound">txs</a> <a id="359" class="Symbol">:</a> <a id="361" class="Symbol">_)</a> <a id="364" class="Symbol">(</a><a id="365" class="Keyword">open</a> <a id="370" href="Ledger.Conway.Transaction.html#910" class="Module">TransactionStructure</a> <a id="391" href="ScriptVerification.StructuredContracts.html#355" class="Bound">txs</a><a id="394" class="Symbol">)</a>
  <a id="398" class="Symbol">(</a><a id="399" href="ScriptVerification.StructuredContracts.html#399" class="Bound">abs</a> <a id="403" class="Symbol">:</a> <a id="405" href="Ledger.Conway.Abstract.html#599" class="Record">AbstractFunctions</a> <a id="423" href="ScriptVerification.StructuredContracts.html#355" class="Bound">txs</a><a id="426" class="Symbol">)</a> <a id="428" class="Symbol">(</a><a id="429" class="Keyword">open</a> <a id="434" href="Ledger.Conway.Abstract.html#599" class="Module">AbstractFunctions</a> <a id="452" href="ScriptVerification.StructuredContracts.html#399" class="Bound">abs</a><a id="455" class="Symbol">)</a>
  <a id="459" class="Keyword">where</a>

<a id="466" class="Keyword">open</a> <a id="471" class="Keyword">import</a> <a id="478" href="Ledger.Conway.Ledger.html" class="Module">Ledger.Conway.Ledger</a> <a id="499" href="ScriptVerification.StructuredContracts.html#355" class="Bound">txs</a> <a id="503" href="ScriptVerification.StructuredContracts.html#399" class="Bound">abs</a>
<a id="507" class="Keyword">open</a> <a id="512" class="Keyword">import</a> <a id="519" href="Ledger.Conway.ScriptValidation.html" class="Module">Ledger.Conway.ScriptValidation</a> <a id="550" href="ScriptVerification.StructuredContracts.html#355" class="Bound">txs</a> <a id="554" href="ScriptVerification.StructuredContracts.html#399" class="Bound">abs</a>
<a id="558" class="Keyword">open</a> <a id="563" class="Keyword">import</a> <a id="570" href="Ledger.Conway.Utxo.html" class="Module">Ledger.Conway.Utxo</a> <a id="589" href="ScriptVerification.StructuredContracts.html#355" class="Bound">txs</a> <a id="593" href="ScriptVerification.StructuredContracts.html#399" class="Bound">abs</a>


<a id="SSRel"></a><a id="599" href="ScriptVerification.StructuredContracts.html#599" class="Function">SSRel</a> <a id="605" class="Symbol">:</a> <a id="607" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="612" class="Symbol">→</a> <a id="614" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="619" class="Symbol">→</a> <a id="621" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="626" class="Symbol">→</a> <a id="628" href="Agda.Primitive.html#388" class="Primitive">Type₁</a>
<a id="634" href="ScriptVerification.StructuredContracts.html#599" class="Function">SSRel</a> <a id="640" href="ScriptVerification.StructuredContracts.html#640" class="Bound">Env</a> <a id="644" href="ScriptVerification.StructuredContracts.html#644" class="Bound">State</a> <a id="650" href="ScriptVerification.StructuredContracts.html#650" class="Bound">Input</a> <a id="656" class="Symbol">=</a> <a id="658" href="ScriptVerification.StructuredContracts.html#640" class="Bound">Env</a> <a id="662" class="Symbol">→</a> <a id="664" href="ScriptVerification.StructuredContracts.html#644" class="Bound">State</a> <a id="670" class="Symbol">→</a> <a id="672" href="ScriptVerification.StructuredContracts.html#650" class="Bound">Input</a> <a id="678" class="Symbol">→</a> <a id="680" href="ScriptVerification.StructuredContracts.html#644" class="Bound">State</a> <a id="686" class="Symbol">→</a> <a id="688" href="Agda.Primitive.html#388" class="Primitive">Type</a>

<a id="694" class="Keyword">record</a> <a id="StrucSimulation"></a><a id="701" href="ScriptVerification.StructuredContracts.html#701" class="Record">StrucSimulation</a> <a id="717" href="ScriptVerification.StructuredContracts.html#717" class="Bound">S</a> <a id="719" href="ScriptVerification.StructuredContracts.html#719" class="Bound">I</a> <a id="721" class="Symbol">(</a><a id="722" href="ScriptVerification.StructuredContracts.html#722" class="Bound Operator">_⊢_⇀⦇_,STRUC⦈_</a> <a id="737" class="Symbol">:</a> <a id="739" href="ScriptVerification.StructuredContracts.html#599" class="Function">SSRel</a> <a id="745" href="Agda.Builtin.Unit.html#175" class="Record">⊤</a> <a id="747" href="ScriptVerification.StructuredContracts.html#717" class="Bound">S</a> <a id="749" href="ScriptVerification.StructuredContracts.html#719" class="Bound">I</a><a id="750" class="Symbol">)</a> <a id="752" class="Symbol">:</a> <a id="754" href="Agda.Primitive.html#388" class="Primitive">Type₁</a> <a id="760" class="Keyword">where</a>
  <a id="768" class="Keyword">field</a>
    <a id="StrucSimulation.πˢ"></a><a id="778" href="ScriptVerification.StructuredContracts.html#778" class="Field">πˢ</a> <a id="781" class="Symbol">:</a> <a id="783" href="Ledger.Conway.Ledger.html#865" class="Record">LState</a> <a id="790" class="Symbol">→</a> <a id="792" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="798" href="ScriptVerification.StructuredContracts.html#717" class="Bound">S</a>
    <a id="StrucSimulation.πⁱ"></a><a id="804" href="ScriptVerification.StructuredContracts.html#804" class="Field">πⁱ</a> <a id="807" class="Symbol">:</a> <a id="809" href="Ledger.Conway.ScriptValidation.html#1857" class="Record">TxInfo</a> <a id="816" class="Symbol">→</a> <a id="818" href="ScriptVerification.StructuredContracts.html#719" class="Bound">I</a>
    <a id="824" class="Comment">-- here, add optional extra assumptions about ledger state, env, and transaction that may be too difficult to prove without reasoning about complete ledger traces</a>
    <a id="991" class="Comment">-- e.g. transaction does not re-add a UTxO entry it spends</a>
    <a id="1054" class="Comment">-- e.g. current Slot is after the validity interval of some previous transaction</a>
    <a id="StrucSimulation.extraAssmp"></a><a id="1139" href="ScriptVerification.StructuredContracts.html#1139" class="Field">extraAssmp</a> <a id="1150" class="Symbol">:</a> <a id="1152" href="Ledger.Conway.Ledger.html#601" class="Record">LEnv</a> <a id="1157" class="Symbol">→</a> <a id="1159" href="Ledger.Conway.Ledger.html#865" class="Record">LState</a> <a id="1166" class="Symbol">→</a> <a id="1168" href="Ledger.Conway.Transaction.html#4306" class="Record">Tx</a> <a id="1171" class="Symbol">→</a> <a id="1173" href="Agda.Primitive.html#388" class="Primitive">Type</a> 

  <a id="StrucSimulation._~ˢ_"></a><a id="1182" href="ScriptVerification.StructuredContracts.html#1182" class="Function Operator">_~ˢ_</a> <a id="1187" class="Symbol">:</a> <a id="1189" href="Ledger.Conway.Ledger.html#865" class="Record">LState</a> <a id="1196" class="Symbol">→</a> <a id="1198" href="ScriptVerification.StructuredContracts.html#717" class="Bound">S</a> <a id="1200" class="Symbol">→</a> <a id="1202" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="1207" class="Comment">-- R</a>
  <a id="1214" href="ScriptVerification.StructuredContracts.html#1214" class="Bound">u</a> <a id="1216" href="ScriptVerification.StructuredContracts.html#1182" class="Function Operator">~ˢ</a> <a id="1219" href="ScriptVerification.StructuredContracts.html#1219" class="Bound">s</a> <a id="1221" class="Symbol">=</a> <a id="1223" href="ScriptVerification.StructuredContracts.html#778" class="Field">πˢ</a> <a id="1226" href="ScriptVerification.StructuredContracts.html#1214" class="Bound">u</a> <a id="1228" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="1230" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="1235" href="ScriptVerification.StructuredContracts.html#1219" class="Bound">s</a>

    <a id="1242" class="Comment">-- only for PlutusV3</a>
  <a id="StrucSimulation._~ᵉ_"></a><a id="1265" href="ScriptVerification.StructuredContracts.html#1265" class="Function Operator">_~ᵉ_</a> <a id="1270" class="Symbol">:</a> <a id="1272" href="Ledger.Conway.Ledger.html#601" class="Record">LEnv</a> <a id="1277" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="1279" href="Ledger.Conway.Transaction.html#4306" class="Record">Tx</a> <a id="1282" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="1284" href="Ledger.Conway.Ledger.html#865" class="Record">LState</a> <a id="1291" class="Symbol">→</a> <a id="1293" href="Agda.Builtin.Unit.html#175" class="Record">⊤</a> <a id="1295" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="1297" href="ScriptVerification.StructuredContracts.html#719" class="Bound">I</a> <a id="1299" class="Symbol">→</a> <a id="1301" href="Agda.Primitive.html#388" class="Primitive">Type</a>
  <a id="1308" href="ScriptVerification.StructuredContracts.html#1265" class="Function Operator">_~ᵉ_</a> <a id="1313" class="Symbol">=</a> <a id="1315" class="Symbol">λ</a> <a id="1317" class="Symbol">(</a><a id="1318" href="ScriptVerification.StructuredContracts.html#1318" class="Bound">le</a> <a id="1321" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1323" href="ScriptVerification.StructuredContracts.html#1323" class="Bound">tx</a> <a id="1326" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1328" href="ScriptVerification.StructuredContracts.html#1328" class="Bound">u</a><a id="1329" class="Symbol">)</a> <a id="1331" class="Symbol">(</a><a id="1332" href="Agda.Builtin.Unit.html#212" class="InductiveConstructor">tt</a> <a id="1335" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1337" href="ScriptVerification.StructuredContracts.html#1337" class="Bound">i</a><a id="1338" class="Symbol">)</a> <a id="1340" class="Symbol">→</a> <a id="1342" href="ScriptVerification.StructuredContracts.html#804" class="Field">πⁱ</a> <a id="1345" class="Symbol">(</a><a id="1346" href="Ledger.Conway.ScriptValidation.html#2165" class="Function">txInfo</a> <a id="1353" href="Ledger.Conway.Script.html#1083" class="Function">PlutusV3</a> <a id="1362" class="Symbol">(</a><a id="1363" href="Ledger.Conway.PParams.html#3576" class="Field">PParamsOf</a> <a id="1373" href="ScriptVerification.StructuredContracts.html#1318" class="Bound">le</a><a id="1375" class="Symbol">)</a> <a id="1377" class="Symbol">(</a><a id="1378" href="Ledger.Conway.Transaction.html#2705" class="Field">UTxOOf</a> <a id="1385" href="ScriptVerification.StructuredContracts.html#1328" class="Bound">u</a><a id="1386" class="Symbol">)</a> <a id="1388" href="ScriptVerification.StructuredContracts.html#1323" class="Bound">tx</a><a id="1390" class="Symbol">)</a> <a id="1392" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="1394" href="ScriptVerification.StructuredContracts.html#1337" class="Bound">i</a>

  <a id="1399" class="Keyword">field</a>
    <a id="StrucSimulation.simulates"></a><a id="1409" href="ScriptVerification.StructuredContracts.html#1409" class="Field">simulates</a> <a id="1419" class="Symbol">:</a> <a id="1421" class="Symbol">∀</a> <a id="1423" href="ScriptVerification.StructuredContracts.html#1423" class="Bound">Γ</a> <a id="1425" href="ScriptVerification.StructuredContracts.html#1425" class="Bound">s</a> <a id="1427" href="ScriptVerification.StructuredContracts.html#1427" class="Bound">u</a> <a id="1429" href="ScriptVerification.StructuredContracts.html#1429" class="Bound">tx</a> <a id="1432" href="ScriptVerification.StructuredContracts.html#1432" class="Bound">i′</a> <a id="1435" href="ScriptVerification.StructuredContracts.html#1435" class="Bound">u′</a> <a id="1438" class="Symbol">→</a> <a id="1440" href="ScriptVerification.StructuredContracts.html#1139" class="Field">extraAssmp</a> <a id="1451" href="ScriptVerification.StructuredContracts.html#1423" class="Bound">Γ</a> <a id="1453" href="ScriptVerification.StructuredContracts.html#1427" class="Bound">u</a> <a id="1455" href="ScriptVerification.StructuredContracts.html#1429" class="Bound">tx</a> <a id="1458" class="Symbol">→</a>
      <a id="1466" href="Prelude.InferenceRules.html#56074" class="Function Operator">∙</a> <a id="1468" href="ScriptVerification.StructuredContracts.html#1423" class="Bound">Γ</a> <a id="1470" href="Ledger.Conway.Ledger.html#2637" class="Datatype Operator">⊢</a> <a id="1472" href="ScriptVerification.StructuredContracts.html#1427" class="Bound">u</a> <a id="1474" href="Ledger.Conway.Ledger.html#2637" class="Datatype Operator">⇀⦇</a> <a id="1477" href="ScriptVerification.StructuredContracts.html#1429" class="Bound">tx</a> <a id="1480" href="Ledger.Conway.Ledger.html#2637" class="Datatype Operator">,LEDGER⦈</a> <a id="1489" href="ScriptVerification.StructuredContracts.html#1435" class="Bound">u′</a>
      <a id="1498" href="iog-prelude.Prelude.InferenceRules.html#583" class="Function Operator">∙</a> <a id="1500" class="Symbol">(</a><a id="1501" href="ScriptVerification.StructuredContracts.html#1423" class="Bound">Γ</a> <a id="1503" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1505" href="ScriptVerification.StructuredContracts.html#1429" class="Bound">tx</a> <a id="1508" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1510" href="ScriptVerification.StructuredContracts.html#1427" class="Bound">u</a><a id="1511" class="Symbol">)</a> <a id="1513" href="ScriptVerification.StructuredContracts.html#1265" class="Function Operator">~ᵉ</a> <a id="1516" class="Symbol">(</a><a id="1517" href="Agda.Builtin.Unit.html#212" class="InductiveConstructor">tt</a> <a id="1520" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1522" href="ScriptVerification.StructuredContracts.html#1432" class="Bound">i′</a><a id="1524" class="Symbol">)</a>
      <a id="1532" href="iog-prelude.Prelude.InferenceRules.html#583" class="Function Operator">∙</a> <a id="1534" href="ScriptVerification.StructuredContracts.html#1427" class="Bound">u</a> <a id="1536" href="ScriptVerification.StructuredContracts.html#1182" class="Function Operator">~ˢ</a> <a id="1539" href="ScriptVerification.StructuredContracts.html#1425" class="Bound">s</a>
      <a id="1547" href="iog-prelude.Prelude.InferenceRules.html#217" class="Function Operator">────────────────────────────────</a>
        <a id="1588" href="Data.Product.Base.html#1371" class="Function">∃[</a> <a id="1591" href="ScriptVerification.StructuredContracts.html#1591" class="Bound">s′</a> <a id="1594" href="Data.Product.Base.html#1371" class="Function">]</a> <a id="1596" href="ScriptVerification.StructuredContracts.html#1435" class="Bound">u′</a> <a id="1599" href="ScriptVerification.StructuredContracts.html#1182" class="Function Operator">~ˢ</a> <a id="1602" href="ScriptVerification.StructuredContracts.html#1591" class="Bound">s′</a>
               <a id="1620" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="1622" href="Agda.Builtin.Unit.html#212" class="InductiveConstructor">tt</a> <a id="1625" href="ScriptVerification.StructuredContracts.html#722" class="Bound Operator">⊢</a> <a id="1627" href="ScriptVerification.StructuredContracts.html#1425" class="Bound">s</a> <a id="1629" href="ScriptVerification.StructuredContracts.html#722" class="Bound Operator">⇀⦇</a> <a id="1632" href="ScriptVerification.StructuredContracts.html#1432" class="Bound">i′</a> <a id="1635" href="ScriptVerification.StructuredContracts.html#722" class="Bound Operator">,STRUC⦈</a> <a id="1643" href="ScriptVerification.StructuredContracts.html#1591" class="Bound">s′</a>

</pre></body></html>