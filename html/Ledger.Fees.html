<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>Ledger.Fees</title><link rel="stylesheet" href="Agda.css"></head><body><pre class="Agda">
<a id="2" class="Symbol">{-#</a> <a id="6" class="Keyword">OPTIONS</a> <a id="14" class="Pragma">--safe</a> <a id="21" class="Symbol">#-}</a>

<a id="26" class="Keyword">open</a> <a id="31" class="Keyword">import</a> <a id="38" href="Ledger.Prelude.html" class="Module">Ledger.Prelude</a> <a id="53" class="Keyword">hiding</a> <a id="60" class="Symbol">(</a><a id="61" href="Data.Nat.Base.html#7285" class="Function Operator">_%_</a><a id="64" class="Symbol">;</a> <a id="66" href="Agda.Builtin.Nat.html#539" class="Primitive Operator">_*_</a><a id="69" class="Symbol">;</a> <a id="71" href="Class.HasOrder.Core.html#995" class="Function">≤-trans</a><a id="78" class="Symbol">)</a>
<a id="80" class="Keyword">open</a> <a id="85" class="Keyword">import</a> <a id="92" href="Ledger.Abstract.html" class="Module">Ledger.Abstract</a>
<a id="108" class="Keyword">open</a> <a id="113" class="Keyword">import</a> <a id="120" href="Ledger.Transaction.html" class="Module">Ledger.Transaction</a>

<a id="140" class="Keyword">module</a> <a id="147" href="Ledger.Fees.html" class="Module">Ledger.Fees</a>
  <a id="161" class="Symbol">(</a><a id="162" href="Ledger.Fees.html#162" class="Bound">txs</a> <a id="166" class="Symbol">:</a> <a id="168" class="Symbol">_)</a> <a id="171" class="Symbol">(</a><a id="172" class="Keyword">open</a> <a id="177" href="Ledger.Transaction.html#867" class="Module">TransactionStructure</a> <a id="198" href="Ledger.Fees.html#162" class="Bound">txs</a><a id="201" class="Symbol">)</a>
  <a id="205" class="Keyword">where</a>

<a id="212" class="Keyword">open</a> <a id="217" class="Keyword">import</a> <a id="224" href="Data.Rational.html" class="Module">Data.Rational</a> <a id="238" class="Keyword">using</a> <a id="244" class="Symbol">(</a><a id="245" href="Data.Rational.Base.html#4325" class="Function">0ℚ</a><a id="247" class="Symbol">;</a> <a id="249" href="Data.Rational.Base.html#1342" class="Record">ℚ</a><a id="250" class="Symbol">;</a> <a id="252" href="Data.Rational.Base.html#1960" class="Function">mkℚ+</a><a id="256" class="Symbol">;</a> <a id="258" href="Data.Rational.Base.html#6315" class="Function Operator">_*_</a><a id="261" class="Symbol">;</a> <a id="263" href="Data.Rational.Base.html#7116" class="Function">floor</a><a id="268" class="Symbol">)</a>
<a id="270" class="Keyword">open</a> <a id="275" class="Keyword">import</a> <a id="282" href="Data.Rational.Literals.html" class="Module">Data.Rational.Literals</a> <a id="305" class="Keyword">using</a> <a id="311" class="Symbol">(</a><a id="312" href="Data.Rational.Literals.html#740" class="Function">number</a><a id="318" class="Symbol">)</a>
<a id="320" class="Keyword">open</a> <a id="325" class="Keyword">import</a> <a id="332" href="Data.Nat.Induction.html" class="Module">Data.Nat.Induction</a> <a id="351" class="Keyword">using</a> <a id="357" class="Symbol">(</a><a id="358" href="Data.Nat.Induction.html#1604" class="Function">&lt;′-wellFounded</a><a id="372" class="Symbol">)</a>
<a id="374" class="Keyword">open</a> <a id="379" class="Keyword">import</a> <a id="386" href="Data.Nat.Properties.html" class="Module">Data.Nat.Properties</a> <a id="406" class="Keyword">using</a> <a id="412" class="Symbol">(</a><a id="413" href="Data.Nat.Properties.html#65066" class="Function">&lt;⇒&lt;′</a><a id="417" class="Symbol">;</a> <a id="419" href="Data.Nat.Properties.html#9553" class="Function">≰⇒&gt;</a><a id="422" class="Symbol">;</a> <a id="424" href="Data.Nat.Properties.html#47496" class="Function">∸-monoʳ-≤</a><a id="433" class="Symbol">;</a> <a id="435" href="Data.Nat.Properties.html#19842" class="Function">+-monoʳ-≤</a><a id="444" class="Symbol">;</a> <a id="446" href="Data.Nat.Properties.html#8707" class="Function">n≤1+n</a><a id="451" class="Symbol">;</a> <a id="453" href="Data.Nat.Properties.html#51744" class="Function">m+[n∸m]≡n</a><a id="462" class="Symbol">;</a> <a id="464" href="Data.Nat.Properties.html#5699" class="Function">≤-reflexive</a><a id="475" class="Symbol">;</a> <a id="477" href="Data.Nat.Properties.html#5988" class="Function">≤-trans</a><a id="484" class="Symbol">)</a>
<a id="486" class="Keyword">open</a> <a id="491" class="Keyword">import</a> <a id="498" href="Data.Integer.html" class="Module">Data.Integer</a> <a id="511" class="Keyword">using</a> <a id="517" class="Symbol">(</a><a id="518" href="Data.Integer.Base.html#1715" class="Function Operator">∣_∣</a><a id="521" class="Symbol">)</a>
<a id="523" class="Keyword">open</a> <a id="528" class="Keyword">import</a> <a id="535" href="Induction.WellFounded.html" class="Module">Induction.WellFounded</a> <a id="557" class="Keyword">using</a> <a id="563" class="Symbol">(</a><a id="564" href="Induction.WellFounded.html#1356" class="Datatype">Acc</a><a id="567" class="Symbol">;</a> <a id="569" href="Induction.WellFounded.html#1418" class="InductiveConstructor">acc</a><a id="572" class="Symbol">)</a>
<a id="574" class="Keyword">open</a> <a id="579" class="Keyword">import</a> <a id="586" href="Agda.Builtin.FromNat.html" class="Module">Agda.Builtin.FromNat</a> <a id="607" class="Keyword">using</a> <a id="613" class="Symbol">(</a><a id="614" href="Agda.Builtin.FromNat.html#196" class="Record">Number</a><a id="620" class="Symbol">)</a>

<a id="623" class="Keyword">open</a> <a id="628" href="Agda.Builtin.FromNat.html#196" class="Module">Number</a> <a id="635" href="Data.Rational.Literals.html#740" class="Function">number</a> <a id="642" class="Keyword">renaming</a> <a id="651" class="Symbol">(</a><a id="652" href="Agda.Builtin.FromNat.html#281" class="Field">fromNat</a> <a id="660" class="Symbol">to</a> <a id="663" class="Field">fromℕ</a><a id="668" class="Symbol">)</a>


<a id="scriptsCost"></a><a id="672" href="Ledger.Fees.html#672" class="Function">scriptsCost</a> <a id="684" class="Symbol">:</a> <a id="686" class="Symbol">(</a><a id="687" href="Ledger.Fees.html#687" class="Bound">pp</a> <a id="690" class="Symbol">:</a> <a id="692" href="Ledger.PParams.html#1443" class="Record">PParams</a><a id="699" class="Symbol">)</a> <a id="701" class="Symbol">→</a> <a id="703" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a> <a id="705" class="Symbol">→</a> <a id="707" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a>
<a id="712" href="Ledger.Fees.html#672" class="Function">scriptsCost</a> <a id="724" href="Ledger.Fees.html#724" class="Bound">pp</a> <a id="727" href="Ledger.Fees.html#727" class="Bound">scriptSize</a>


  <a id="742" class="Keyword">with</a> <a id="747" class="Symbol">(</a><a id="748" href="Ledger.PParams.html#2397" class="Field">PParams.refScriptCostStride</a> <a id="776" href="Ledger.Fees.html#724" class="Bound">pp</a><a id="778" class="Symbol">)</a>
<a id="780" class="Symbol">...</a> <a id="784" class="Symbol">|</a> <a id="786" class="Number">0</a> <a id="788" class="Symbol">=</a> <a id="790" class="Number">0</a>  <a id="793" class="Comment">-- This case should never occur; refScriptCostStride should always be &gt; 0.</a>
<a id="868" class="Symbol">...</a> <a id="872" class="Symbol">|</a> <a id="874" href="Agda.Builtin.Nat.html#234" class="InductiveConstructor">suc</a> <a id="878" href="Ledger.Fees.html#878" class="Bound">m</a>


  <a id="884" class="Symbol">=</a> <a id="886" href="Ledger.Fees.html#1088" class="Function">scriptsCostAux</a> <a id="901" href="Data.Rational.Base.html#4325" class="Function">0ℚ</a> <a id="904" href="Ledger.PParams.html#2271" class="Function">minFeeRefScriptCoinsPerByte</a> <a id="932" class="Bound">scriptSize</a>


                  <a id="963" class="Symbol">(</a><a id="964" href="Data.Nat.Induction.html#1604" class="Function">&lt;′-wellFounded</a> <a id="979" class="Bound">scriptSize</a><a id="989" class="Symbol">)</a>


  <a id="995" class="Keyword">where</a>
    <a id="1005" class="Keyword">open</a> <a id="1010" href="Ledger.PParams.html#1443" class="Module">PParams</a> <a id="1018" class="Bound">pp</a> <a id="1021" class="Keyword">hiding</a> <a id="1028" class="Symbol">(</a><a id="1029" href="Ledger.PParams.html#2397" class="Field">refScriptCostStride</a><a id="1048" class="Symbol">)</a>
    <a id="1054" href="Ledger.Fees.html#1054" class="Function">refScriptCostStride</a> <a id="1074" class="Symbol">=</a> <a id="1076" href="Agda.Builtin.Nat.html#234" class="InductiveConstructor">suc</a> <a id="1080" href="Ledger.Fees.html#878" class="Bound">m</a>


    <a id="1088" href="Ledger.Fees.html#1088" class="Function">scriptsCostAux</a> <a id="1103" class="Symbol">:</a> <a id="1105" href="Data.Rational.Base.html#1342" class="Record">ℚ</a>        <a id="1114" class="Comment">-- accumulator</a>
                   <a id="1148" class="Symbol">→</a> <a id="1150" href="Data.Rational.Base.html#1342" class="Record">ℚ</a>        <a id="1159" class="Comment">-- current tier price</a>
                   <a id="1200" class="Symbol">→</a> <a id="1202" class="Symbol">(</a><a id="1203" href="Ledger.Fees.html#1203" class="Bound">n</a> <a id="1205" class="Symbol">:</a> <a id="1207" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a><a id="1208" class="Symbol">)</a>  <a id="1211" class="Comment">-- remaining script size</a>


                   <a id="1257" class="Symbol">→</a> <a id="1259" href="Induction.WellFounded.html#1356" class="Datatype">Acc</a> <a id="1263" href="Data.Nat.Base.html#7870" class="Function Operator">_&lt;′_</a> <a id="1268" href="Ledger.Fees.html#1203" class="Bound">n</a>


                   <a id="1291" class="Symbol">→</a> <a id="1293" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a>
    <a id="1302" href="Ledger.Fees.html#1088" class="Function">scriptsCostAux</a> <a id="1317" href="Ledger.Fees.html#1317" class="Bound">acl</a> <a id="1321" href="Ledger.Fees.html#1321" class="Bound">curTierPrice</a> <a id="1334" href="Ledger.Fees.html#1334" class="Bound">n</a>


      <a id="1344" class="Symbol">(</a><a id="1345" href="Induction.WellFounded.html#1418" class="InductiveConstructor">acc</a> <a id="1349" href="Ledger.Fees.html#1349" class="Bound">rs</a><a id="1351" class="Symbol">)</a>


        <a id="1363" class="Symbol">=</a> <a id="1365" href="Function.Base.html#4042" class="Function Operator">case</a> <a id="1370" href="Ledger.Fees.html#1334" class="Bound">n</a> <a id="1372" href="Class.HasOrder.Core.html#1011" class="Function Operator">≤?</a> <a id="1375" href="Ledger.Fees.html#1054" class="Function">refScriptCostStride</a> <a id="1395" href="Function.Base.html#4042" class="Function Operator">of</a> <a id="1398" class="Symbol">λ</a> <a id="1400" class="Keyword">where</a>
            <a id="1418" class="Symbol">(</a><a id="1419" href="Relation.Nullary.Decidable.Core.html#1994" class="InductiveConstructor">yes</a> <a id="1423" class="Symbol">_)</a>  <a id="1427" class="Symbol">→</a> <a id="1429" href="Data.Integer.Base.html#1715" class="Function Operator">∣</a> <a id="1431" href="Data.Rational.Base.html#7116" class="Function">floor</a> <a id="1437" class="Symbol">(</a><a id="1438" href="Ledger.Fees.html#1317" class="Bound">acl</a> <a id="1442" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="1444" class="Symbol">(</a><a id="1445" href="Ledger.Fees.html#663" class="Function">fromℕ</a> <a id="1451" href="Ledger.Fees.html#1334" class="Bound">n</a> <a id="1453" href="Data.Rational.Base.html#6315" class="Function Operator">*</a> <a id="1455" href="Ledger.Fees.html#1321" class="Bound">curTierPrice</a><a id="1467" class="Symbol">))</a> <a id="1470" href="Data.Integer.Base.html#1715" class="Function Operator">∣</a>
            <a id="1484" class="Symbol">(</a><a id="1485" href="Relation.Nullary.Decidable.Core.html#2031" class="InductiveConstructor">no</a>  <a id="1489" href="Ledger.Fees.html#1489" class="Bound">p</a><a id="1490" class="Symbol">)</a>  <a id="1493" class="Symbol">→</a> <a id="1495" href="Ledger.Fees.html#1088" class="Function">scriptsCostAux</a> <a id="1510" class="Symbol">(</a><a id="1511" href="Ledger.Fees.html#1317" class="Bound">acl</a> <a id="1515" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="1517" class="Symbol">(</a><a id="1518" href="Ledger.Fees.html#663" class="Function">fromℕ</a> <a id="1524" href="Ledger.Fees.html#1054" class="Function">refScriptCostStride</a> <a id="1544" href="Data.Rational.Base.html#6315" class="Function Operator">*</a> <a id="1546" href="Ledger.Fees.html#1321" class="Bound">curTierPrice</a><a id="1558" class="Symbol">))</a>
                                      <a id="1599" class="Symbol">(</a><a id="1600" href="Ledger.PParams.html#2439" class="Function">refScriptCostMultiplier</a> <a id="1624" href="Data.Rational.Base.html#6315" class="Function Operator">*</a> <a id="1626" href="Ledger.Fees.html#1321" class="Bound">curTierPrice</a><a id="1638" class="Symbol">)</a>
                                      <a id="1678" class="Symbol">(</a><a id="1679" href="Ledger.Fees.html#1334" class="Bound">n</a> <a id="1681" href="Interface.HasSubtract.html#209" class="Field Operator">-</a> <a id="1683" href="Ledger.Fees.html#1054" class="Function">refScriptCostStride</a><a id="1702" class="Symbol">)</a>


                                     <a id="1743" class="Symbol">(</a><a id="1744" href="Ledger.Fees.html#1349" class="Bound">rs</a> <a id="1747" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="1749" href="Data.Nat.Properties.html#65066" class="Function">&lt;⇒&lt;′</a> <a id="1754" class="Symbol">(</a><a id="1755" href="Ledger.Fees.html#1823" class="Function">suc∸≤</a> <a id="1761" class="Symbol">(</a><a id="1762" href="Data.Nat.Properties.html#5988" class="Function">≤-trans</a> <a id="1770" class="Symbol">(</a><a id="1771" href="Data.Nat.Base.html#1919" class="InductiveConstructor">s&lt;s</a> <a id="1775" href="Data.Nat.Base.html#1720" class="InductiveConstructor">z≤n</a><a id="1778" class="Symbol">)</a> <a id="1780" class="Symbol">(</a><a id="1781" href="Data.Nat.Properties.html#9553" class="Function">≰⇒&gt;</a> <a id="1785" href="Ledger.Fees.html#1489" class="Bound">p</a><a id="1786" class="Symbol">))</a> <a id="1789" class="Symbol">(</a><a id="1790" href="Data.Nat.Base.html#1762" class="InductiveConstructor">s≤s</a> <a id="1794" href="Data.Nat.Base.html#1720" class="InductiveConstructor">z≤n</a><a id="1797" class="Symbol">)))</a>


      <a id="1809" class="Keyword">where</a>
        <a id="1823" href="Ledger.Fees.html#1823" class="Function">suc∸≤</a> <a id="1829" class="Symbol">:</a> <a id="1831" class="Symbol">∀</a> <a id="1833" class="Symbol">{</a><a id="1834" href="Ledger.Fees.html#1834" class="Bound">n</a> <a id="1836" href="Ledger.Fees.html#1836" class="Bound">m</a> <a id="1838" class="Symbol">:</a> <a id="1840" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a><a id="1841" class="Symbol">}</a> <a id="1843" class="Symbol">→</a> <a id="1845" href="Ledger.Fees.html#1834" class="Bound">n</a> <a id="1847" href="Class.HasOrder.Core.html#843" class="Function Operator">&gt;</a> <a id="1849" class="Number">0</a> <a id="1851" class="Symbol">→</a> <a id="1853" href="Ledger.Fees.html#1836" class="Bound">m</a> <a id="1855" href="Class.HasOrder.Core.html#843" class="Function Operator">&gt;</a> <a id="1857" class="Number">0</a> <a id="1859" class="Symbol">→</a> <a id="1861" href="Ledger.Fees.html#1834" class="Bound">n</a> <a id="1863" href="Data.Nat.Base.html#4462" class="Primitive Operator">∸</a> <a id="1865" href="Ledger.Fees.html#1836" class="Bound">m</a> <a id="1867" href="Class.HasOrder.Core.html#641" class="Field Operator">&lt;</a> <a id="1869" href="Ledger.Fees.html#1834" class="Bound">n</a>
        <a id="1879" href="Ledger.Fees.html#1823" class="Function">suc∸≤</a> <a id="1885" class="Symbol">{</a><a id="1886" href="Ledger.Fees.html#1886" class="Bound">n</a><a id="1887" class="Symbol">}</a> <a id="1889" class="Symbol">{.</a><a id="1891" href="Agda.Builtin.Nat.html#234" class="InductiveConstructor">suc</a> <a id="1895" href="Ledger.Fees.html#1895" class="Bound">m</a><a id="1896" class="Symbol">}</a> <a id="1898" href="Ledger.Fees.html#1898" class="Bound">p</a> <a id="1900" class="Symbol">(</a><a id="1901" href="Data.Nat.Base.html#1762" class="InductiveConstructor">s≤s</a> <a id="1905" href="Ledger.Fees.html#1905" class="Bound">q</a><a id="1906" class="Symbol">)</a> <a id="1908" class="Symbol">=</a> <a id="1910" href="Data.Nat.Properties.html#5988" class="Function">≤-trans</a> <a id="1918" class="Symbol">(</a><a id="1919" href="Data.Nat.Properties.html#19842" class="Function">+-monoʳ-≤</a> <a id="1929" class="Number">1</a> <a id="1931" class="Symbol">(</a><a id="1932" href="Data.Nat.Properties.html#47496" class="Function">∸-monoʳ-≤</a> <a id="1942" href="Ledger.Fees.html#1886" class="Bound">n</a> <a id="1944" class="Symbol">(</a><a id="1945" href="Data.Nat.Base.html#1919" class="InductiveConstructor">s&lt;s</a> <a id="1949" href="Ledger.Fees.html#1905" class="Bound">q</a><a id="1950" class="Symbol">)))</a>
                                               <a id="2001" class="Symbol">(</a><a id="2002" href="Data.Nat.Properties.html#5699" class="Function">≤-reflexive</a> <a id="2014" class="Symbol">(</a><a id="2015" href="Data.Nat.Properties.html#51744" class="Function">m+[n∸m]≡n</a> <a id="2025" href="Ledger.Fees.html#1898" class="Bound">p</a><a id="2026" class="Symbol">))</a>

</pre></body></html>