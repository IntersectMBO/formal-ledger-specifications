<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>Ledger.Fees</title><link rel="stylesheet" href="Agda.css"></head><body><pre class="Agda">
<a id="2" class="Symbol">{-#</a> <a id="6" class="Keyword">OPTIONS</a> <a id="14" class="Pragma">--safe</a> <a id="21" class="Symbol">#-}</a>

<a id="26" class="Keyword">open</a> <a id="31" class="Keyword">import</a> <a id="38" href="Ledger.Prelude.html" class="Module">Ledger.Prelude</a> <a id="53" class="Keyword">hiding</a> <a id="60" class="Symbol">(</a><a id="61" href="Data.Nat.Base.html#7285" class="Function Operator">_%_</a><a id="64" class="Symbol">;</a> <a id="66" href="Agda.Builtin.Nat.html#539" class="Primitive Operator">_*_</a><a id="69" class="Symbol">;</a> <a id="71" href="Class.HasOrder.Core.html#995" class="Function">≤-trans</a><a id="78" class="Symbol">;</a> <a id="80" href="Ledger.Prelude.html#2543" class="Function Operator">∣_∣</a><a id="83" class="Symbol">)</a>
<a id="85" class="Keyword">open</a> <a id="90" class="Keyword">import</a> <a id="97" href="Ledger.Abstract.html" class="Module">Ledger.Abstract</a>
<a id="113" class="Keyword">open</a> <a id="118" class="Keyword">import</a> <a id="125" href="Ledger.Transaction.html" class="Module">Ledger.Transaction</a>

<a id="145" class="Keyword">module</a> <a id="152" href="Ledger.Fees.html" class="Module">Ledger.Fees</a>
  <a id="166" class="Symbol">(</a><a id="167" href="Ledger.Fees.html#167" class="Bound">txs</a> <a id="171" class="Symbol">:</a> <a id="173" class="Symbol">_)</a> <a id="176" class="Symbol">(</a><a id="177" class="Keyword">open</a> <a id="182" href="Ledger.Transaction.html#840" class="Module">TransactionStructure</a> <a id="203" href="Ledger.Fees.html#167" class="Bound">txs</a><a id="206" class="Symbol">)</a>
  <a id="210" class="Keyword">where</a>

<a id="217" class="Keyword">open</a> <a id="222" class="Keyword">import</a> <a id="229" href="Data.Rational.html" class="Module">Data.Rational</a> <a id="243" class="Keyword">using</a> <a id="249" class="Symbol">(</a><a id="250" href="Data.Rational.Base.html#4325" class="Function">0ℚ</a><a id="252" class="Symbol">;</a> <a id="254" href="Data.Rational.Base.html#1342" class="Record">ℚ</a><a id="255" class="Symbol">;</a> <a id="257" href="Data.Rational.Base.html#1960" class="Function">mkℚ+</a><a id="261" class="Symbol">;</a> <a id="263" href="Data.Rational.Base.html#6315" class="Function Operator">_*_</a><a id="266" class="Symbol">;</a> <a id="268" href="Data.Rational.Base.html#7116" class="Function">floor</a><a id="273" class="Symbol">)</a>
<a id="275" class="Keyword">open</a> <a id="280" class="Keyword">import</a> <a id="287" href="Data.Rational.Literals.html" class="Module">Data.Rational.Literals</a> <a id="310" class="Keyword">using</a> <a id="316" class="Symbol">(</a><a id="317" href="Data.Rational.Literals.html#740" class="Function">number</a><a id="323" class="Symbol">)</a>
<a id="325" class="Keyword">open</a> <a id="330" class="Keyword">import</a> <a id="337" href="Data.Nat.Induction.html" class="Module">Data.Nat.Induction</a> <a id="356" class="Keyword">using</a> <a id="362" class="Symbol">(</a><a id="363" href="Data.Nat.Induction.html#1604" class="Function">&lt;′-wellFounded</a><a id="377" class="Symbol">)</a>
<a id="379" class="Keyword">open</a> <a id="384" class="Keyword">import</a> <a id="391" href="Data.Nat.Properties.html" class="Module">Data.Nat.Properties</a> <a id="411" class="Keyword">using</a> <a id="417" class="Symbol">(</a><a id="418" href="Data.Nat.Properties.html#65066" class="Function">&lt;⇒&lt;′</a><a id="422" class="Symbol">;</a> <a id="424" href="Data.Nat.Properties.html#9553" class="Function">≰⇒&gt;</a><a id="427" class="Symbol">;</a> <a id="429" href="Data.Nat.Properties.html#47496" class="Function">∸-monoʳ-≤</a><a id="438" class="Symbol">;</a> <a id="440" href="Data.Nat.Properties.html#19842" class="Function">+-monoʳ-≤</a><a id="449" class="Symbol">;</a> <a id="451" href="Data.Nat.Properties.html#8707" class="Function">n≤1+n</a><a id="456" class="Symbol">;</a> <a id="458" href="Data.Nat.Properties.html#51744" class="Function">m+[n∸m]≡n</a><a id="467" class="Symbol">;</a> <a id="469" href="Data.Nat.Properties.html#5699" class="Function">≤-reflexive</a><a id="480" class="Symbol">;</a> <a id="482" href="Data.Nat.Properties.html#5988" class="Function">≤-trans</a><a id="489" class="Symbol">)</a>
<a id="491" class="Keyword">open</a> <a id="496" class="Keyword">import</a> <a id="503" href="Data.Integer.html" class="Module">Data.Integer</a> <a id="516" class="Keyword">using</a> <a id="522" class="Symbol">(</a><a id="523" href="Data.Integer.Base.html#1715" class="Function Operator">∣_∣</a><a id="526" class="Symbol">)</a>
<a id="528" class="Keyword">open</a> <a id="533" class="Keyword">import</a> <a id="540" href="Induction.WellFounded.html" class="Module">Induction.WellFounded</a> <a id="562" class="Keyword">using</a> <a id="568" class="Symbol">(</a><a id="569" href="Induction.WellFounded.html#1356" class="Datatype">Acc</a><a id="572" class="Symbol">;</a> <a id="574" href="Induction.WellFounded.html#1418" class="InductiveConstructor">acc</a><a id="577" class="Symbol">)</a>
<a id="579" class="Keyword">open</a> <a id="584" class="Keyword">import</a> <a id="591" href="Agda.Builtin.FromNat.html" class="Module">Agda.Builtin.FromNat</a> <a id="612" class="Keyword">using</a> <a id="618" class="Symbol">(</a><a id="619" href="Agda.Builtin.FromNat.html#196" class="Record">Number</a><a id="625" class="Symbol">)</a>

<a id="628" class="Keyword">open</a> <a id="633" href="Agda.Builtin.FromNat.html#196" class="Module">Number</a> <a id="640" href="Data.Rational.Literals.html#740" class="Function">number</a> <a id="647" class="Keyword">renaming</a> <a id="656" class="Symbol">(</a><a id="657" href="Agda.Builtin.FromNat.html#281" class="Field">fromNat</a> <a id="665" class="Symbol">to</a> <a id="668" class="Field">fromℕ</a><a id="673" class="Symbol">)</a>


<a id="scriptsCost"></a><a id="677" href="Ledger.Fees.html#677" class="Function">scriptsCost</a> <a id="689" class="Symbol">:</a> <a id="691" class="Symbol">(</a><a id="692" href="Ledger.Fees.html#692" class="Bound">pp</a> <a id="695" class="Symbol">:</a> <a id="697" href="Ledger.PParams.html#1570" class="Record">PParams</a><a id="704" class="Symbol">)</a> <a id="706" class="Symbol">→</a> <a id="708" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a> <a id="710" class="Symbol">→</a> <a id="712" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a>
<a id="717" href="Ledger.Fees.html#677" class="Function">scriptsCost</a> <a id="729" href="Ledger.Fees.html#729" class="Bound">pp</a> <a id="732" href="Ledger.Fees.html#732" class="Bound">scriptSize</a>


  <a id="747" class="Keyword">with</a> <a id="752" class="Symbol">(</a><a id="753" href="Ledger.PParams.html#2524" class="Field">PParams.refScriptCostStride</a> <a id="781" href="Ledger.Fees.html#729" class="Bound">pp</a><a id="783" class="Symbol">)</a>
<a id="785" class="Symbol">...</a> <a id="789" class="Symbol">|</a> <a id="791" class="Number">0</a> <a id="793" class="Symbol">=</a> <a id="795" class="Number">0</a>  <a id="798" class="Comment">-- This case should never occur; refScriptCostStride should always be &gt; 0.</a>
<a id="873" class="Symbol">...</a> <a id="877" class="Symbol">|</a> <a id="879" href="Agda.Builtin.Nat.html#234" class="InductiveConstructor">suc</a> <a id="883" href="Ledger.Fees.html#883" class="Bound">m</a>


  <a id="889" class="Symbol">=</a> <a id="891" href="Ledger.Fees.html#1093" class="Function">scriptsCostAux</a> <a id="906" href="Data.Rational.Base.html#4325" class="Function">0ℚ</a> <a id="909" href="Ledger.PParams.html#2398" class="Function">minFeeRefScriptCoinsPerByte</a> <a id="937" class="Bound">scriptSize</a>


                  <a id="968" class="Symbol">(</a><a id="969" href="Data.Nat.Induction.html#1604" class="Function">&lt;′-wellFounded</a> <a id="984" class="Bound">scriptSize</a><a id="994" class="Symbol">)</a>


  <a id="1000" class="Keyword">where</a>
    <a id="1010" class="Keyword">open</a> <a id="1015" href="Ledger.PParams.html#1570" class="Module">PParams</a> <a id="1023" class="Bound">pp</a> <a id="1026" class="Keyword">hiding</a> <a id="1033" class="Symbol">(</a><a id="1034" href="Ledger.PParams.html#2524" class="Field">refScriptCostStride</a><a id="1053" class="Symbol">)</a>
    <a id="1059" href="Ledger.Fees.html#1059" class="Function">refScriptCostStride</a> <a id="1079" class="Symbol">=</a> <a id="1081" href="Agda.Builtin.Nat.html#234" class="InductiveConstructor">suc</a> <a id="1085" href="Ledger.Fees.html#883" class="Bound">m</a>


    <a id="1093" href="Ledger.Fees.html#1093" class="Function">scriptsCostAux</a> <a id="1108" class="Symbol">:</a> <a id="1110" href="Data.Rational.Base.html#1342" class="Record">ℚ</a>        <a id="1119" class="Comment">-- accumulator</a>
                   <a id="1153" class="Symbol">→</a> <a id="1155" href="Data.Rational.Base.html#1342" class="Record">ℚ</a>        <a id="1164" class="Comment">-- current tier price</a>
                   <a id="1205" class="Symbol">→</a> <a id="1207" class="Symbol">(</a><a id="1208" href="Ledger.Fees.html#1208" class="Bound">n</a> <a id="1210" class="Symbol">:</a> <a id="1212" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a><a id="1213" class="Symbol">)</a>  <a id="1216" class="Comment">-- remaining script size</a>


                   <a id="1262" class="Symbol">→</a> <a id="1264" href="Induction.WellFounded.html#1356" class="Datatype">Acc</a> <a id="1268" href="Data.Nat.Base.html#7870" class="Function Operator">_&lt;′_</a> <a id="1273" href="Ledger.Fees.html#1208" class="Bound">n</a>


                   <a id="1296" class="Symbol">→</a> <a id="1298" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a>
    <a id="1307" href="Ledger.Fees.html#1093" class="Function">scriptsCostAux</a> <a id="1322" href="Ledger.Fees.html#1322" class="Bound">acl</a> <a id="1326" href="Ledger.Fees.html#1326" class="Bound">curTierPrice</a> <a id="1339" href="Ledger.Fees.html#1339" class="Bound">n</a>


      <a id="1349" class="Symbol">(</a><a id="1350" href="Induction.WellFounded.html#1418" class="InductiveConstructor">acc</a> <a id="1354" href="Ledger.Fees.html#1354" class="Bound">rs</a><a id="1356" class="Symbol">)</a>


        <a id="1368" class="Symbol">=</a> <a id="1370" href="Function.Base.html#4042" class="Function Operator">case</a>  <a id="1376" href="Ledger.Fees.html#1339" class="Bound">n</a> <a id="1378" href="Class.HasOrder.Core.html#1011" class="Function Operator">≤?</a> <a id="1381" href="Ledger.Fees.html#1059" class="Function">refScriptCostStride</a> <a id="1401" href="Function.Base.html#4042" class="Function Operator">of</a>


                <a id="1422" class="Symbol">λ</a> <a id="1424" class="Keyword">where</a>


                <a id="1448" class="Symbol">(</a><a id="1449" href="Relation.Nullary.Decidable.Core.html#1994" class="InductiveConstructor">yes</a> <a id="1453" class="Symbol">_)</a>  <a id="1457" class="Symbol">→</a> <a id="1459" href="Data.Integer.Base.html#1715" class="Function Operator">∣</a> <a id="1461" href="Data.Rational.Base.html#7116" class="Function">floor</a> <a id="1467" class="Symbol">(</a><a id="1468" href="Ledger.Fees.html#1322" class="Bound">acl</a> <a id="1472" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="1474" class="Symbol">(</a><a id="1475" href="Ledger.Fees.html#668" class="Function">fromℕ</a> <a id="1481" href="Ledger.Fees.html#1339" class="Bound">n</a> <a id="1483" href="Data.Rational.Base.html#6315" class="Function Operator">*</a> <a id="1485" href="Ledger.Fees.html#1326" class="Bound">curTierPrice</a><a id="1497" class="Symbol">))</a> <a id="1500" href="Data.Integer.Base.html#1715" class="Function Operator">∣</a>
                <a id="1518" class="Symbol">(</a><a id="1519" href="Relation.Nullary.Decidable.Core.html#2031" class="InductiveConstructor">no</a>  <a id="1523" href="Ledger.Fees.html#1523" class="Bound">p</a><a id="1524" class="Symbol">)</a>  <a id="1527" class="Symbol">→</a> <a id="1529" href="Ledger.Fees.html#1093" class="Function">scriptsCostAux</a> <a id="1544" class="Symbol">(</a><a id="1545" href="Ledger.Fees.html#1322" class="Bound">acl</a> <a id="1549" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="1551" class="Symbol">(</a><a id="1552" href="Ledger.Fees.html#668" class="Function">fromℕ</a> <a id="1558" href="Ledger.Fees.html#1059" class="Function">refScriptCostStride</a> <a id="1578" href="Data.Rational.Base.html#6315" class="Function Operator">*</a> <a id="1580" href="Ledger.Fees.html#1326" class="Bound">curTierPrice</a><a id="1592" class="Symbol">))</a>
                                          <a id="1637" class="Symbol">(</a><a id="1638" href="Ledger.PParams.html#2566" class="Function">refScriptCostMultiplier</a> <a id="1662" href="Data.Rational.Base.html#6315" class="Function Operator">*</a> <a id="1664" href="Ledger.Fees.html#1326" class="Bound">curTierPrice</a><a id="1676" class="Symbol">)</a>
                                          <a id="1720" class="Symbol">(</a><a id="1721" href="Ledger.Fees.html#1339" class="Bound">n</a> <a id="1723" href="Interface.HasSubtract.html#209" class="Field Operator">-</a> <a id="1725" href="Ledger.Fees.html#1059" class="Function">refScriptCostStride</a><a id="1744" class="Symbol">)</a>


                                          <a id="1790" class="Symbol">(</a><a id="1791" href="Ledger.Fees.html#1354" class="Bound">rs</a> <a id="1794" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="1796" href="Data.Nat.Properties.html#65066" class="Function">&lt;⇒&lt;′</a> <a id="1801" class="Symbol">(</a><a id="1802" href="Ledger.Fees.html#1870" class="Function">suc∸≤</a> <a id="1808" class="Symbol">(</a><a id="1809" href="Data.Nat.Properties.html#5988" class="Function">≤-trans</a> <a id="1817" class="Symbol">(</a><a id="1818" href="Data.Nat.Base.html#1919" class="InductiveConstructor">s&lt;s</a> <a id="1822" href="Data.Nat.Base.html#1720" class="InductiveConstructor">z≤n</a><a id="1825" class="Symbol">)</a> <a id="1827" class="Symbol">(</a><a id="1828" href="Data.Nat.Properties.html#9553" class="Function">≰⇒&gt;</a> <a id="1832" href="Ledger.Fees.html#1523" class="Bound">p</a><a id="1833" class="Symbol">))</a> <a id="1836" class="Symbol">(</a><a id="1837" href="Data.Nat.Base.html#1762" class="InductiveConstructor">s≤s</a> <a id="1841" href="Data.Nat.Base.html#1720" class="InductiveConstructor">z≤n</a><a id="1844" class="Symbol">)))</a>


      <a id="1856" class="Keyword">where</a>
        <a id="1870" href="Ledger.Fees.html#1870" class="Function">suc∸≤</a> <a id="1876" class="Symbol">:</a> <a id="1878" class="Symbol">∀</a> <a id="1880" class="Symbol">{</a><a id="1881" href="Ledger.Fees.html#1881" class="Bound">n</a> <a id="1883" href="Ledger.Fees.html#1883" class="Bound">m</a> <a id="1885" class="Symbol">:</a> <a id="1887" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a><a id="1888" class="Symbol">}</a> <a id="1890" class="Symbol">→</a> <a id="1892" href="Ledger.Fees.html#1881" class="Bound">n</a> <a id="1894" href="Class.HasOrder.Core.html#843" class="Function Operator">&gt;</a> <a id="1896" class="Number">0</a> <a id="1898" class="Symbol">→</a> <a id="1900" href="Ledger.Fees.html#1883" class="Bound">m</a> <a id="1902" href="Class.HasOrder.Core.html#843" class="Function Operator">&gt;</a> <a id="1904" class="Number">0</a> <a id="1906" class="Symbol">→</a> <a id="1908" href="Ledger.Fees.html#1881" class="Bound">n</a> <a id="1910" href="Data.Nat.Base.html#4462" class="Primitive Operator">∸</a> <a id="1912" href="Ledger.Fees.html#1883" class="Bound">m</a> <a id="1914" href="Class.HasOrder.Core.html#641" class="Field Operator">&lt;</a> <a id="1916" href="Ledger.Fees.html#1881" class="Bound">n</a>
        <a id="1926" href="Ledger.Fees.html#1870" class="Function">suc∸≤</a> <a id="1932" class="Symbol">{</a><a id="1933" href="Ledger.Fees.html#1933" class="Bound">n</a><a id="1934" class="Symbol">}</a> <a id="1936" class="Symbol">{.</a><a id="1938" href="Agda.Builtin.Nat.html#234" class="InductiveConstructor">suc</a> <a id="1942" href="Ledger.Fees.html#1942" class="Bound">m</a><a id="1943" class="Symbol">}</a> <a id="1945" href="Ledger.Fees.html#1945" class="Bound">p</a> <a id="1947" class="Symbol">(</a><a id="1948" href="Data.Nat.Base.html#1762" class="InductiveConstructor">s≤s</a> <a id="1952" href="Ledger.Fees.html#1952" class="Bound">q</a><a id="1953" class="Symbol">)</a> <a id="1955" class="Symbol">=</a> <a id="1957" href="Data.Nat.Properties.html#5988" class="Function">≤-trans</a> <a id="1965" class="Symbol">(</a><a id="1966" href="Data.Nat.Properties.html#19842" class="Function">+-monoʳ-≤</a> <a id="1976" class="Number">1</a> <a id="1978" class="Symbol">(</a><a id="1979" href="Data.Nat.Properties.html#47496" class="Function">∸-monoʳ-≤</a> <a id="1989" href="Ledger.Fees.html#1933" class="Bound">n</a> <a id="1991" class="Symbol">(</a><a id="1992" href="Data.Nat.Base.html#1919" class="InductiveConstructor">s&lt;s</a> <a id="1996" href="Ledger.Fees.html#1952" class="Bound">q</a><a id="1997" class="Symbol">)))</a>
                                               <a id="2048" class="Symbol">(</a><a id="2049" href="Data.Nat.Properties.html#5699" class="Function">≤-reflexive</a> <a id="2061" class="Symbol">(</a><a id="2062" href="Data.Nat.Properties.html#51744" class="Function">m+[n∸m]≡n</a> <a id="2072" href="Ledger.Fees.html#1945" class="Bound">p</a><a id="2073" class="Symbol">))</a>

</pre></body></html>