<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>Ledger.Conway.Conformance.Chain</title><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.css"><link rel="stylesheet" href="Agda.css"><script src="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.js"></script><script src="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/contrib/auto-render.min.js"></script><script src="AgdaKaTeX.js" defer=""></script></head><body><pre class="Agda">
<a id="2" class="Symbol">{-#</a> <a id="6" class="Keyword">OPTIONS</a> <a id="14" class="Pragma">--safe</a> <a id="21" class="Symbol">#-}</a>

<a id="26" class="Keyword">open</a> <a id="31" class="Keyword">import</a> <a id="38" href="Algebra.html" class="Module">Algebra</a>
<a id="46" class="Keyword">open</a> <a id="51" class="Keyword">import</a> <a id="58" href="Data.Nat.Properties.html" class="Module">Data.Nat.Properties</a> <a id="78" class="Keyword">using</a> <a id="84" class="Symbol">(</a><a id="85" href="Data.Nat.Properties.html#17252" class="Function">+-0-monoid</a><a id="95" class="Symbol">)</a>

<a id="98" class="Keyword">open</a> <a id="103" class="Keyword">import</a> <a id="110" href="Ledger.Prelude.html" class="Module">Ledger.Prelude</a><a id="124" class="Symbol">;</a> <a id="126" class="Keyword">open</a> <a id="131" href="Function.Bundles.html#4752" class="Module">Equivalence</a>
<a id="143" class="Keyword">open</a> <a id="148" class="Keyword">import</a> <a id="155" href="Ledger.Conway.Specification.Transaction.html" class="Module">Ledger.Conway.Specification.Transaction</a>
<a id="195" class="Keyword">open</a> <a id="200" class="Keyword">import</a> <a id="207" href="Ledger.Conway.Specification.Abstract.html" class="Module">Ledger.Conway.Specification.Abstract</a>

<a id="245" class="Keyword">module</a> <a id="252" href="Ledger.Conway.Conformance.Chain.html" class="Module">Ledger.Conway.Conformance.Chain</a>
  <a id="286" class="Symbol">(</a><a id="287" href="Ledger.Conway.Conformance.Chain.html#287" class="Bound">txs</a> <a id="291" class="Symbol">:</a> <a id="293" class="Symbol">_)</a> <a id="296" class="Symbol">(</a><a id="297" class="Keyword">open</a> <a id="302" href="Ledger.Conway.Specification.Transaction.html#1000" class="Module">TransactionStructure</a> <a id="323" href="Ledger.Conway.Conformance.Chain.html#287" class="Bound">txs</a><a id="326" class="Symbol">)</a>
  <a id="330" class="Symbol">(</a><a id="331" href="Ledger.Conway.Conformance.Chain.html#331" class="Bound">abs</a> <a id="335" class="Symbol">:</a> <a id="337" href="Ledger.Conway.Specification.Abstract.html#641" class="Record">AbstractFunctions</a> <a id="355" href="Ledger.Conway.Conformance.Chain.html#287" class="Bound">txs</a><a id="358" class="Symbol">)</a> <a id="360" class="Symbol">(</a><a id="361" class="Keyword">open</a> <a id="366" href="Ledger.Conway.Specification.Abstract.html#641" class="Module">AbstractFunctions</a> <a id="384" href="Ledger.Conway.Conformance.Chain.html#331" class="Bound">abs</a><a id="387" class="Symbol">)</a>
  <a id="391" class="Keyword">where</a>

<a id="398" class="Keyword">open</a> <a id="403" class="Keyword">import</a> <a id="410" href="Ledger.Conway.Specification.Enact.html" class="Module">Ledger.Conway.Specification.Enact</a> <a id="444" href="Ledger.Conway.Specification.Transaction.html#2079" class="Function">govStructure</a>
<a id="457" class="Keyword">open</a> <a id="462" class="Keyword">import</a> <a id="469" href="Ledger.Conway.Conformance.Ledger.html" class="Module">Ledger.Conway.Conformance.Ledger</a> <a id="502" href="Ledger.Conway.Conformance.Chain.html#287" class="Bound">txs</a> <a id="506" href="Ledger.Conway.Conformance.Chain.html#331" class="Bound">abs</a>
<a id="510" class="Keyword">open</a> <a id="515" class="Keyword">import</a> <a id="522" href="Ledger.Conway.Specification.Ratify.html" class="Module">Ledger.Conway.Specification.Ratify</a> <a id="557" href="Ledger.Conway.Conformance.Chain.html#287" class="Bound">txs</a>
<a id="561" class="Keyword">open</a> <a id="566" class="Keyword">import</a> <a id="573" href="Ledger.Conway.Conformance.Utxo.html" class="Module">Ledger.Conway.Conformance.Utxo</a> <a id="604" href="Ledger.Conway.Conformance.Chain.html#287" class="Bound">txs</a> <a id="608" href="Ledger.Conway.Conformance.Chain.html#331" class="Bound">abs</a>
<a id="612" class="Keyword">open</a> <a id="617" class="Keyword">import</a> <a id="624" href="Ledger.Conway.Conformance.Epoch.html" class="Module">Ledger.Conway.Conformance.Epoch</a> <a id="656" href="Ledger.Conway.Conformance.Chain.html#287" class="Bound">txs</a> <a id="660" href="Ledger.Conway.Conformance.Chain.html#331" class="Bound">abs</a>
<a id="664" class="Keyword">open</a> <a id="669" class="Keyword">import</a> <a id="676" href="Ledger.Conway.Conformance.Certs.html" class="Module">Ledger.Conway.Conformance.Certs</a> <a id="708" href="Ledger.Conway.Specification.Transaction.html#2079" class="Function">govStructure</a>

<a id="722" class="Keyword">record</a> <a id="ChainState"></a><a id="729" href="Ledger.Conway.Conformance.Chain.html#729" class="Record">ChainState</a> <a id="740" class="Symbol">:</a> <a id="742" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="747" class="Keyword">where</a>

  <a id="756" class="Keyword">field</a>

    <a id="ChainState.newEpochState"></a><a id="767" href="Ledger.Conway.Conformance.Chain.html#767" class="Field">newEpochState</a>  <a id="782" class="Symbol">:</a> <a id="784" href="Ledger.Conway.Conformance.Epoch.html#1175" class="Record">NewEpochState</a>

<a id="799" class="Keyword">record</a> <a id="Block"></a><a id="806" href="Ledger.Conway.Conformance.Chain.html#806" class="Record">Block</a> <a id="812" class="Symbol">:</a> <a id="814" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="819" class="Keyword">where</a>

  <a id="828" class="Keyword">field</a>

    <a id="Block.ts"></a><a id="839" href="Ledger.Conway.Conformance.Chain.html#839" class="Field">ts</a>    <a id="845" class="Symbol">:</a> <a id="847" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="852" href="Ledger.Conway.Specification.Transaction.html#4500" class="Record">Tx</a>
    <a id="Block.slot"></a><a id="859" href="Ledger.Conway.Conformance.Chain.html#859" class="Field">slot</a>  <a id="865" class="Symbol">:</a> <a id="867" href="Ledger.Core.Specification.Epoch.html#674" class="Function">Slot</a>

<a id="873" class="Keyword">private</a> <a id="881" class="Keyword">variable</a>
  <a id="892" href="Ledger.Conway.Conformance.Chain.html#892" class="Generalizable">s</a> <a id="894" class="Symbol">:</a> <a id="896" href="Ledger.Conway.Conformance.Chain.html#729" class="Record">ChainState</a>
  <a id="909" href="Ledger.Conway.Conformance.Chain.html#909" class="Generalizable">b</a> <a id="911" class="Symbol">:</a> <a id="913" href="Ledger.Conway.Conformance.Chain.html#806" class="Record">Block</a>
  <a id="921" href="Ledger.Conway.Conformance.Chain.html#921" class="Generalizable">ls&#39;</a> <a id="925" class="Symbol">:</a> <a id="927" href="Ledger.Conway.Conformance.Ledger.html#779" class="Record">LState</a>
  <a id="936" href="Ledger.Conway.Conformance.Chain.html#936" class="Generalizable">nes</a> <a id="940" class="Symbol">:</a> <a id="942" href="Ledger.Conway.Conformance.Epoch.html#1175" class="Record">NewEpochState</a>

<a id="957" class="Keyword">instance</a> <a id="966" href="Ledger.Conway.Conformance.Chain.html#966" class="Function">_</a> <a id="968" class="Symbol">=</a> <a id="970" href="Data.Nat.Properties.html#17252" class="Function">+-0-monoid</a>

<a id="982" class="Comment">-- TODO: do we still need this for anything?</a>
<a id="maybePurpose"></a><a id="1027" href="Ledger.Conway.Conformance.Chain.html#1027" class="Function">maybePurpose</a> <a id="1040" class="Symbol">:</a> <a id="1042" href="Ledger.Conway.Specification.Certs.html#349" class="Datatype">DepositPurpose</a> <a id="1057" class="Symbol">→</a> <a id="1059" class="Symbol">(</a><a id="1060" href="Ledger.Conway.Specification.Certs.html#349" class="Datatype">DepositPurpose</a> <a id="1075" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="1077" href="Ledger.Core.Specification.Address.html#260" class="Datatype">Credential</a><a id="1087" class="Symbol">)</a> <a id="1089" class="Symbol">→</a> <a id="1091" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a> <a id="1096" class="Symbol">→</a> <a id="1098" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="1104" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a>
<a id="1109" href="Ledger.Conway.Conformance.Chain.html#1027" class="Function">maybePurpose</a> <a id="1122" href="Ledger.Conway.Conformance.Chain.html#1122" class="Bound">prps</a> <a id="1127" class="Symbol">(</a><a id="1128" href="Ledger.Conway.Conformance.Chain.html#1128" class="Bound">prps&#39;</a> <a id="1134" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1136" class="Symbol">_)</a> <a id="1139" href="Ledger.Conway.Conformance.Chain.html#1139" class="Bound">c</a> <a id="1141" class="Keyword">with</a> <a id="1146" href="Ledger.Conway.Conformance.Chain.html#1122" class="Bound">prps</a> <a id="1151" href="Class.DecEq.Core.html#159" class="Field Operator">≟</a> <a id="1153" href="Ledger.Conway.Conformance.Chain.html#1128" class="Bound">prps&#39;</a>
<a id="1159" class="Symbol">...</a> <a id="1163" class="Symbol">|</a> <a id="1165" href="Relation.Nullary.Decidable.Core.html#1994" class="InductiveConstructor">yes</a> <a id="1169" class="Symbol">_</a> <a id="1171" class="Symbol">=</a> <a id="1173" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="1178" class="Bound">c</a>
<a id="1180" class="Symbol">...</a> <a id="1184" class="Symbol">|</a> <a id="1186" href="Relation.Nullary.Decidable.Core.html#2031" class="InductiveConstructor">no</a> <a id="1189" class="Symbol">_</a> <a id="1191" class="Symbol">=</a> <a id="1193" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a>

<a id="maybePurpose-prop"></a><a id="1202" href="Ledger.Conway.Conformance.Chain.html#1202" class="Function">maybePurpose-prop</a> <a id="1220" class="Symbol">:</a> <a id="1222" class="Symbol">∀</a> <a id="1224" class="Symbol">{</a><a id="1225" href="Ledger.Conway.Conformance.Chain.html#1225" class="Bound">prps</a><a id="1229" class="Symbol">}</a> <a id="1231" class="Symbol">{</a><a id="1232" href="Ledger.Conway.Conformance.Chain.html#1232" class="Bound">x</a><a id="1233" class="Symbol">}</a> <a id="1235" class="Symbol">{</a><a id="1236" href="Ledger.Conway.Conformance.Chain.html#1236" class="Bound">y</a><a id="1237" class="Symbol">}</a>
  <a id="1241" class="Symbol">→</a> <a id="1243" class="Symbol">(</a><a id="1244" href="Ledger.Conway.Conformance.Chain.html#1244" class="Bound">m</a> <a id="1246" class="Symbol">:</a> <a id="1248" class="Symbol">(</a><a id="1249" href="Ledger.Conway.Specification.Certs.html#349" class="Datatype">DepositPurpose</a> <a id="1264" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="1266" href="Ledger.Core.Specification.Address.html#260" class="Datatype">Credential</a><a id="1276" class="Symbol">)</a> <a id="1278" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="1280" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a><a id="1284" class="Symbol">)</a>
  <a id="1288" class="Symbol">→</a> <a id="1290" class="Symbol">(</a><a id="1291" href="Ledger.Conway.Conformance.Chain.html#1232" class="Bound">x</a> <a id="1293" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1295" href="Ledger.Conway.Conformance.Chain.html#1236" class="Bound">y</a><a id="1296" class="Symbol">)</a> <a id="1298" href="Class.IsSet.html#458" class="Function Operator">∈</a> <a id="1300" href="Class.IsSet.html#916" class="Function">dom</a> <a id="1304" class="Symbol">((</a><a id="1306" href="Axiom.Set.Map.html#10313" class="Function">mapMaybeWithKeyᵐ</a> <a id="1323" class="Symbol">(</a><a id="1324" href="Ledger.Conway.Conformance.Chain.html#1027" class="Function">maybePurpose</a> <a id="1337" href="Ledger.Conway.Conformance.Chain.html#1225" class="Bound">prps</a><a id="1341" class="Symbol">)</a> <a id="1343" href="Ledger.Conway.Conformance.Chain.html#1244" class="Bound">m</a><a id="1344" class="Symbol">)</a> <a id="1346" href="Axiom.Set.Map.html#2293" class="Function Operator">ˢ</a><a id="1347" class="Symbol">)</a>
  <a id="1351" class="Symbol">→</a> <a id="1353" href="Ledger.Conway.Conformance.Chain.html#1232" class="Bound">x</a> <a id="1355" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="1357" href="Ledger.Conway.Conformance.Chain.html#1225" class="Bound">prps</a>
<a id="1362" href="Ledger.Conway.Conformance.Chain.html#1202" class="Function">maybePurpose-prop</a> <a id="1380" class="Symbol">{</a><a id="1381" class="Argument">prps</a> <a id="1386" class="Symbol">=</a> <a id="1388" href="Ledger.Conway.Conformance.Chain.html#1388" class="Bound">prps</a><a id="1392" class="Symbol">}</a> <a id="1394" class="Symbol">{</a><a id="1395" href="Ledger.Conway.Conformance.Chain.html#1395" class="Bound">x</a><a id="1396" class="Symbol">}</a> <a id="1398" class="Symbol">{</a><a id="1399" href="Ledger.Conway.Conformance.Chain.html#1399" class="Bound">y</a><a id="1400" class="Symbol">}</a> <a id="1402" class="Symbol">_</a> <a id="1404" href="Ledger.Conway.Conformance.Chain.html#1404" class="Bound">xy∈dom</a> <a id="1411" class="Keyword">with</a> <a id="1416" href="Function.Bundles.html#4834" class="Field">from</a> <a id="1421" href="Axiom.Set.Rel.html#2472" class="Function">dom∈</a> <a id="1426" href="Ledger.Conway.Conformance.Chain.html#1404" class="Bound">xy∈dom</a>
<a id="1433" class="Symbol">...</a> <a id="1437" class="Symbol">|</a> <a id="1439" href="Ledger.Conway.Conformance.Chain.html#1439" class="Bound">z</a> <a id="1441" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1443" href="Ledger.Conway.Conformance.Chain.html#1443" class="Bound">∈mmwk</a> <a id="1449" class="Keyword">with</a> <a id="1454" class="Bound">prps</a> <a id="1459" href="Class.DecEq.Core.html#159" class="Field Operator">≟</a> <a id="1461" class="Bound">x</a> <a id="1463" class="Symbol">|</a> <a id="1465" href="Axiom.Set.Rel.html#5977" class="Function">∈-mapMaybeWithKey</a> <a id="1483" class="Symbol">{</a><a id="1484" class="Argument">f</a> <a id="1486" class="Symbol">=</a> <a id="1488" href="Ledger.Conway.Conformance.Chain.html#1027" class="Function">maybePurpose</a> <a id="1501" class="Bound">prps</a><a id="1505" class="Symbol">}</a> <a id="1507" href="Ledger.Conway.Conformance.Chain.html#1443" class="Bound">∈mmwk</a>
<a id="1513" class="Symbol">...</a> <a id="1517" class="Symbol">|</a> <a id="1519" href="Relation.Nullary.Decidable.Core.html#1994" class="InductiveConstructor">yes</a> <a id="1523" href="Agda.Builtin.Equality.html#207" class="InductiveConstructor">refl</a> <a id="1528" class="Symbol">|</a> <a id="1530" class="Symbol">_</a> <a id="1532" class="Symbol">=</a> <a id="1534" href="Agda.Builtin.Equality.html#207" class="InductiveConstructor">refl</a>

<a id="filterPurpose"></a><a id="1540" href="Ledger.Conway.Conformance.Chain.html#1540" class="Function">filterPurpose</a> <a id="1554" class="Symbol">:</a> <a id="1556" href="Ledger.Conway.Specification.Certs.html#349" class="Datatype">DepositPurpose</a> <a id="1571" class="Symbol">→</a> <a id="1573" class="Symbol">(</a><a id="1574" href="Ledger.Conway.Specification.Certs.html#349" class="Datatype">DepositPurpose</a> <a id="1589" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="1591" href="Ledger.Core.Specification.Address.html#260" class="Datatype">Credential</a><a id="1601" class="Symbol">)</a> <a id="1603" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="1605" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a> <a id="1610" class="Symbol">→</a> <a id="1612" href="Ledger.Core.Specification.Address.html#260" class="Datatype">Credential</a> <a id="1623" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="1625" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a>
<a id="1630" href="Ledger.Conway.Conformance.Chain.html#1540" class="Function">filterPurpose</a> <a id="1644" href="Ledger.Conway.Conformance.Chain.html#1644" class="Bound">prps</a> <a id="1649" href="Ledger.Conway.Conformance.Chain.html#1649" class="Bound">m</a> <a id="1651" class="Symbol">=</a> <a id="1653" href="Axiom.Set.Map.html#5896" class="Function">mapKeys</a> <a id="1661" href="Data.Product.Base.html#650" class="Field">proj₂</a> <a id="1667" class="Symbol">(</a><a id="1668" href="Axiom.Set.Map.html#10313" class="Function">mapMaybeWithKeyᵐ</a> <a id="1685" class="Symbol">(</a><a id="1686" href="Ledger.Conway.Conformance.Chain.html#1027" class="Function">maybePurpose</a> <a id="1699" href="Ledger.Conway.Conformance.Chain.html#1644" class="Bound">prps</a><a id="1703" class="Symbol">)</a> <a id="1705" href="Ledger.Conway.Conformance.Chain.html#1649" class="Bound">m</a><a id="1706" class="Symbol">)</a>
  <a id="1710" class="Symbol">{λ</a> <a id="1713" class="Keyword">where</a> <a id="1719" href="Ledger.Conway.Conformance.Chain.html#1719" class="Bound">x∈dom</a> <a id="1725" href="Ledger.Conway.Conformance.Chain.html#1725" class="Bound">y∈dom</a> <a id="1731" href="Agda.Builtin.Equality.html#207" class="InductiveConstructor">refl</a> <a id="1736" class="Symbol">→</a> <a id="1738" href="Relation.Binary.PropositionalEquality.Core.html#1339" class="Function">cong</a> <a id="1743" class="Symbol">(</a><a id="1744" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">_,</a> <a id="1747" class="Symbol">_)</a>
                            <a id="1778" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="1780" href="Relation.Binary.PropositionalEquality.Core.html#1938" class="Function">trans</a> <a id="1786" class="Symbol">(</a><a id="1787" href="Ledger.Conway.Conformance.Chain.html#1202" class="Function">maybePurpose-prop</a> <a id="1805" class="Symbol">{</a><a id="1806" class="Argument">prps</a> <a id="1811" class="Symbol">=</a> <a id="1813" href="Ledger.Conway.Conformance.Chain.html#1644" class="Bound">prps</a><a id="1817" class="Symbol">}</a> <a id="1819" href="Ledger.Conway.Conformance.Chain.html#1649" class="Bound">m</a> <a id="1821" href="Ledger.Conway.Conformance.Chain.html#1719" class="Bound">x∈dom</a><a id="1826" class="Symbol">)</a>
                            <a id="1856" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="1858" href="Relation.Binary.PropositionalEquality.Core.html#1893" class="Function">sym</a>   <a id="1864" class="Symbol">(</a><a id="1865" href="Ledger.Conway.Conformance.Chain.html#1202" class="Function">maybePurpose-prop</a> <a id="1883" class="Symbol">{</a><a id="1884" class="Argument">prps</a> <a id="1889" class="Symbol">=</a> <a id="1891" href="Ledger.Conway.Conformance.Chain.html#1644" class="Bound">prps</a><a id="1895" class="Symbol">}</a> <a id="1897" href="Ledger.Conway.Conformance.Chain.html#1649" class="Bound">m</a> <a id="1899" href="Ledger.Conway.Conformance.Chain.html#1725" class="Bound">y∈dom</a><a id="1904" class="Symbol">)}</a>

<a id="govActionDeposits"></a><a id="1908" href="Ledger.Conway.Conformance.Chain.html#1908" class="Function">govActionDeposits</a> <a id="1926" class="Symbol">:</a> <a id="1928" href="Ledger.Conway.Conformance.Ledger.html#779" class="Record">LState</a> <a id="1935" class="Symbol">→</a> <a id="1937" href="Ledger.Conway.Specification.Gov.Actions.html#452" class="Datatype">VDeleg</a> <a id="1944" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="1946" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a>
<a id="1951" href="Ledger.Conway.Conformance.Chain.html#1908" class="Function">govActionDeposits</a> <a id="1969" href="Ledger.Conway.Conformance.Chain.html#1969" class="Bound">ls</a> <a id="1972" class="Symbol">=</a>
  <a id="1976" class="Keyword">let</a> <a id="1980" class="Keyword">open</a> <a id="1985" href="Ledger.Conway.Conformance.Ledger.html#779" class="Module">LState</a> <a id="1992" href="Ledger.Conway.Conformance.Chain.html#1969" class="Bound">ls</a><a id="1994" class="Symbol">;</a> <a id="1996" class="Keyword">open</a> <a id="2001" href="Ledger.Conway.Conformance.Certs.html#970" class="Module">CertState</a> <a id="2011" href="Ledger.Conway.Conformance.Ledger.html#887" class="Field">certState</a><a id="2020" class="Symbol">;</a> <a id="2022" class="Keyword">open</a> <a id="2027" href="Ledger.Conway.Specification.Certs.html#3808" class="Module">PState</a> <a id="2034" href="Ledger.Conway.Conformance.Certs.html#1049" class="Function">pState</a>
      <a id="2047" class="Keyword">open</a> <a id="2052" href="Ledger.Conway.Specification.Utxo.html#1473" class="Module">UTxOState</a> <a id="2062" href="Ledger.Conway.Conformance.Ledger.html#834" class="Field">utxoSt</a><a id="2068" class="Symbol">;</a> <a id="2070" class="Keyword">open</a> <a id="2075" href="Ledger.Conway.Conformance.Certs.html#597" class="Module">DState</a> <a id="2082" href="Ledger.Conway.Conformance.Certs.html#1029" class="Function">dState</a>
   <a id="2092" class="Keyword">in</a> <a id="2095" href="Data.List.Base.html#4249" class="Function">foldl</a> <a id="2101" href="Axiom.Set.Map.Dec.html#1854" class="Function Operator">_∪⁺_</a> <a id="2106" href="Class.HasEmptySet.html#287" class="Field">∅</a> <a id="2108" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="2110" href="abstract-set-theory.FiniteSetTheory.html#2463" class="Function">setToList</a> <a id="2120" href="Function.Base.html#1974" class="Function Operator">$</a>
    <a id="2126" href="Axiom.Set.html#7805" class="Function">mapPartial</a>
      <a id="2143" class="Symbol">(λ</a> <a id="2146" class="Keyword">where</a> <a id="2152" class="Symbol">(</a><a id="2153" href="Ledger.Conway.Conformance.Chain.html#2153" class="Bound">gaid</a> <a id="2158" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="2160" class="Keyword">record</a> <a id="2167" class="Symbol">{</a> <a id="2169" href="Ledger.Conway.Specification.Gov.Actions.html#2811" class="Field">returnAddr</a> <a id="2180" class="Symbol">=</a> <a id="2182" class="Keyword">record</a> <a id="2189" class="Symbol">{</a><a id="2190" href="Ledger.Core.Specification.Address.html#1378" class="Field">stake</a> <a id="2196" class="Symbol">=</a> <a id="2198" href="Ledger.Conway.Conformance.Chain.html#2198" class="Bound">c</a><a id="2199" class="Symbol">}</a> <a id="2201" class="Symbol">})</a> <a id="2204" class="Symbol">→</a> <a id="2206" class="Keyword">do</a>
        <a id="2217" href="Ledger.Conway.Conformance.Chain.html#2217" class="Bound">vd</a> <a id="2220" href="Class.Monad.Core.html#299" class="Field Operator">←</a> <a id="2222" href="Axiom.Set.Map.html#13670" class="Function">lookupᵐ?</a> <a id="2231" href="Ledger.Conway.Conformance.Certs.html#654" class="Function">voteDelegs</a> <a id="2242" href="Ledger.Conway.Conformance.Chain.html#2198" class="Bound">c</a>
        <a id="2252" href="Ledger.Conway.Conformance.Chain.html#2252" class="Bound">dep</a> <a id="2256" href="Class.Monad.Core.html#299" class="Field Operator">←</a> <a id="2258" href="Axiom.Set.Map.html#13670" class="Function">lookupᵐ?</a> <a id="2267" class="Symbol">(</a><a id="2268" href="Ledger.Conway.Conformance.Certs.html#770" class="Field">DState.deposits</a> <a id="2284" href="Ledger.Conway.Conformance.Certs.html#1029" class="Function">dState</a><a id="2290" class="Symbol">)</a> <a id="2292" class="Symbol">(</a><a id="2293" href="Ledger.Conway.Specification.Certs.html#538" class="InductiveConstructor">GovActionDeposit</a> <a id="2310" href="Ledger.Conway.Conformance.Chain.html#2153" class="Bound">gaid</a><a id="2314" class="Symbol">)</a>
        <a id="2324" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="2329" href="Class.HasSingleton.html#288" class="Field Operator">❴</a> <a id="2331" href="Ledger.Conway.Conformance.Chain.html#2217" class="Bound">vd</a> <a id="2334" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="2336" href="Ledger.Conway.Conformance.Chain.html#2252" class="Bound">dep</a> <a id="2340" href="Class.HasSingleton.html#288" class="Field Operator">❵</a> <a id="2342" class="Symbol">)</a>
      <a id="2350" class="Symbol">(</a><a id="2351" href="Axiom.Set.html#5718" class="Function">fromList</a> <a id="2360" href="Ledger.Conway.Conformance.Ledger.html#861" class="Field">govSt</a><a id="2365" class="Symbol">)</a>

<a id="calculateStakeDistrs"></a><a id="2368" href="Ledger.Conway.Conformance.Chain.html#2368" class="Function">calculateStakeDistrs</a> <a id="2389" class="Symbol">:</a> <a id="2391" href="Ledger.Conway.Conformance.Ledger.html#779" class="Record">LState</a> <a id="2398" class="Symbol">→</a> <a id="2400" href="Ledger.Conway.Specification.Ratify.html#3013" class="Record">StakeDistrs</a>
<a id="2412" href="Ledger.Conway.Conformance.Chain.html#2368" class="Function">calculateStakeDistrs</a> <a id="2433" href="Ledger.Conway.Conformance.Chain.html#2433" class="Bound">ls</a> <a id="2436" class="Symbol">=</a>
  <a id="2440" class="Keyword">let</a> <a id="2444" class="Keyword">open</a> <a id="2449" href="Ledger.Conway.Conformance.Ledger.html#779" class="Module">LState</a> <a id="2456" href="Ledger.Conway.Conformance.Chain.html#2433" class="Bound">ls</a><a id="2458" class="Symbol">;</a> <a id="2460" class="Keyword">open</a> <a id="2465" href="Ledger.Conway.Conformance.Certs.html#970" class="Module">CertState</a> <a id="2475" href="Ledger.Conway.Conformance.Ledger.html#887" class="Field">certState</a><a id="2484" class="Symbol">;</a> <a id="2486" class="Keyword">open</a> <a id="2491" href="Ledger.Conway.Specification.Certs.html#3808" class="Module">PState</a> <a id="2498" href="Ledger.Conway.Conformance.Certs.html#1049" class="Function">pState</a>
      <a id="2511" class="Keyword">open</a> <a id="2516" href="Ledger.Conway.Specification.Utxo.html#1473" class="Module">UTxOState</a> <a id="2526" href="Ledger.Conway.Conformance.Ledger.html#834" class="Field">utxoSt</a><a id="2532" class="Symbol">;</a> <a id="2534" class="Keyword">open</a> <a id="2539" href="Ledger.Conway.Conformance.Certs.html#597" class="Module">DState</a> <a id="2546" href="Ledger.Conway.Conformance.Certs.html#1029" class="Function">dState</a>
      <a id="2559" href="Ledger.Conway.Conformance.Chain.html#2559" class="Bound">spoDelegs</a> <a id="2569" class="Symbol">=</a> <a id="2571" href="Class.HasEmptySet.html#287" class="Field">∅</a> <a id="2573" class="Comment">-- TODO</a>
      <a id="2587" href="Ledger.Conway.Conformance.Chain.html#2587" class="Bound">drepDelegs</a> <a id="2598" class="Symbol">=</a> <a id="2600" href="Class.HasEmptySet.html#287" class="Field">∅</a> <a id="2602" class="Comment">-- TODO</a>
  <a id="2612" class="Keyword">in</a>
  <a id="2617" class="Keyword">record</a>
    <a id="2628" class="Symbol">{</a> <a id="2630" href="Ledger.Conway.Specification.Ratify.html#3050" class="Field">stakeDistr</a> <a id="2641" class="Symbol">=</a> <a id="2643" href="Ledger.Conway.Conformance.Chain.html#1908" class="Function">govActionDeposits</a> <a id="2661" href="Ledger.Conway.Conformance.Chain.html#2433" class="Bound">ls</a>
    <a id="2668" class="Symbol">}</a>


<a id="2672" class="Keyword">data</a>

  <a id="_⊢_⇀⦇_,CHAIN⦈_"></a><a id="2680" href="Ledger.Conway.Conformance.Chain.html#2680" class="Datatype Operator">_⊢_⇀⦇_,CHAIN⦈_</a> <a id="2695" class="Symbol">:</a> <a id="2697" href="Agda.Builtin.Unit.html#175" class="Record">⊤</a> <a id="2699" class="Symbol">→</a> <a id="2701" href="Ledger.Conway.Conformance.Chain.html#729" class="Record">ChainState</a> <a id="2712" class="Symbol">→</a> <a id="2714" href="Ledger.Conway.Conformance.Chain.html#806" class="Record">Block</a> <a id="2720" class="Symbol">→</a> <a id="2722" href="Ledger.Conway.Conformance.Chain.html#729" class="Record">ChainState</a> <a id="2733" class="Symbol">→</a> <a id="2735" href="Agda.Primitive.html#388" class="Primitive">Type</a>

  <a id="2743" class="Keyword">where</a>

  <a id="_⊢_⇀⦇_,CHAIN⦈_.CHAIN"></a><a id="2752" href="Ledger.Conway.Conformance.Chain.html#2752" class="InductiveConstructor">CHAIN</a> <a id="2758" class="Symbol">:</a>
    <a id="2764" class="Keyword">let</a> <a id="2768" class="Keyword">open</a> <a id="2773" href="Ledger.Conway.Conformance.Chain.html#729" class="Module">ChainState</a> <a id="2784" href="Ledger.Conway.Conformance.Chain.html#892" class="Generalizable">s</a><a id="2785" class="Symbol">;</a> <a id="2787" class="Keyword">open</a> <a id="2792" href="Ledger.Conway.Conformance.Chain.html#806" class="Module">Block</a> <a id="2798" href="Ledger.Conway.Conformance.Chain.html#909" class="Generalizable">b</a><a id="2799" class="Symbol">;</a> <a id="2801" class="Keyword">open</a> <a id="2806" href="Ledger.Conway.Conformance.Epoch.html#1175" class="Module">NewEpochState</a> <a id="2820" href="Ledger.Conway.Conformance.Chain.html#936" class="Generalizable">nes</a>
        <a id="2832" class="Keyword">open</a> <a id="2837" href="Ledger.Conway.Conformance.Epoch.html#977" class="Module">EpochState</a> <a id="2848" href="Ledger.Conway.Conformance.Epoch.html#1238" class="Function">epochState</a><a id="2858" class="Symbol">;</a> <a id="2860" class="Keyword">open</a> <a id="2865" href="Ledger.Conway.Specification.Enact.html#444" class="Module">EnactState</a> <a id="2876" href="Ledger.Conway.Conformance.Epoch.html#1114" class="Function">es</a>
    <a id="2883" class="Keyword">in</a>
       <a id="2893" class="Symbol">_</a> <a id="2895" href="Ledger.Conway.Conformance.Epoch.html#4860" class="Datatype Operator">⊢</a> <a id="2897" href="Ledger.Conway.Conformance.Chain.html#767" class="Function">newEpochState</a> <a id="2911" href="Ledger.Conway.Conformance.Epoch.html#4860" class="Datatype Operator">⇀⦇</a> <a id="2914" href="Ledger.Core.Specification.Epoch.html#810" class="Function">epoch</a> <a id="2920" href="Ledger.Conway.Conformance.Chain.html#859" class="Function">slot</a> <a id="2925" href="Ledger.Conway.Conformance.Epoch.html#4860" class="Datatype Operator">,NEWEPOCH⦈</a> <a id="2936" href="Ledger.Conway.Conformance.Chain.html#936" class="Generalizable">nes</a>
    <a id="2944" class="Symbol">→</a>  <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.Conway.Conformance.Chain.html#859}{\htmlId{2949}{\htmlClass{Function}{\text{slot}}}}\, \\ \,\href{Ledger.Prelude.html#2302}{\htmlId{2956}{\htmlClass{Function Operator}{\text{∣}}}}\, \,\href{Ledger.Conway.Specification.Enact.html#549}{\htmlId{2958}{\htmlClass{Function}{\text{constitution}}}}\, \,\href{Ledger.Prelude.html#2302}{\htmlId{2971}{\htmlClass{Function Operator}{\text{∣}}}}\, \\ \,\href{Ledger.Prelude.html#2302}{\htmlId{2975}{\htmlClass{Function Operator}{\text{∣}}}}\, \,\href{Ledger.Conway.Specification.Enact.html#654}{\htmlId{2977}{\htmlClass{Function}{\text{pparams}}}}\, \,\href{Ledger.Prelude.html#2302}{\htmlId{2985}{\htmlClass{Function Operator}{\text{∣}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#1114}{\htmlId{2989}{\htmlClass{Function}{\text{es}}}}\, \\ \,\href{Ledger.Conway.Specification.PParams.html#775}{\htmlId{2994}{\htmlClass{Field}{\text{Acnt.treasury}}}}\, \,\href{Ledger.Conway.Conformance.Epoch.html#1041}{\htmlId{3008}{\htmlClass{Function}{\text{acnt}}}}\,
       \end{pmatrix}$</a> <a id="3022" href="Ledger.Conway.Conformance.Ledger.html#2259" class="Function Operator">⊢</a> <a id="3024" href="Ledger.Conway.Conformance.Epoch.html#1090" class="Function">ls</a> <a id="3027" href="Ledger.Conway.Conformance.Ledger.html#2259" class="Function Operator">⇀⦇</a> <a id="3030" href="Ledger.Conway.Conformance.Chain.html#839" class="Function">ts</a> <a id="3033" href="Ledger.Conway.Conformance.Ledger.html#2259" class="Function Operator">,LEDGERS⦈</a> <a id="3043" href="Ledger.Conway.Conformance.Chain.html#921" class="Generalizable">ls&#39;</a>
    <a id="3051" href="iog-prelude.Prelude.InferenceRules.html#217" class="Function Operator">────────────────────────────────</a>
    <a id="3088" class="Symbol">_</a> <a id="3090" href="Ledger.Conway.Conformance.Chain.html#2680" class="Datatype Operator">⊢</a> <a id="3092" href="Ledger.Conway.Conformance.Chain.html#892" class="Generalizable">s</a> <a id="3094" href="Ledger.Conway.Conformance.Chain.html#2680" class="Datatype Operator">⇀⦇</a> <a id="3097" href="Ledger.Conway.Conformance.Chain.html#909" class="Generalizable">b</a> <a id="3099" href="Ledger.Conway.Conformance.Chain.html#2680" class="Datatype Operator">,CHAIN⦈</a>
        <a id="3115" class="Keyword">record</a> <a id="3122" href="Ledger.Conway.Conformance.Chain.html#892" class="Generalizable">s</a> <a id="3124" class="Symbol">{</a> <a id="3126" href="Ledger.Conway.Conformance.Chain.html#767" class="Field">newEpochState</a> <a id="3140" class="Symbol">=</a> <a id="3142" class="Keyword">record</a> <a id="3149" href="Ledger.Conway.Conformance.Chain.html#936" class="Generalizable">nes</a> <a id="3153" class="Symbol">{</a> <a id="3155" href="Ledger.Conway.Conformance.Epoch.html#1238" class="Field">epochState</a> <a id="3166" class="Symbol">=</a> <a id="3168" class="Keyword">record</a> <a id="3175" href="Ledger.Conway.Conformance.Epoch.html#1238" class="Function">epochState</a> <a id="3186" class="Symbol">{</a> <a id="3188" href="Ledger.Conway.Conformance.Epoch.html#1090" class="Field">ls</a> <a id="3191" class="Symbol">=</a> <a id="3193" href="Ledger.Conway.Conformance.Chain.html#921" class="Generalizable">ls&#39;</a><a id="3196" class="Symbol">}</a> <a id="3198" class="Symbol">}</a> <a id="3200" class="Symbol">}</a>
</pre></body></html>