<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>Ledger.Conway.Conformance.Chain</title><link rel="stylesheet" href="Agda.css"></head><body><pre class="Agda">
<a id="2" class="Symbol">{-#</a> <a id="6" class="Keyword">OPTIONS</a> <a id="14" class="Pragma">--safe</a> <a id="21" class="Symbol">#-}</a>

<a id="26" class="Keyword">open</a> <a id="31" class="Keyword">import</a> <a id="38" href="Algebra.html" class="Module">Algebra</a>
<a id="46" class="Keyword">open</a> <a id="51" class="Keyword">import</a> <a id="58" href="Data.Nat.Properties.html" class="Module">Data.Nat.Properties</a> <a id="78" class="Keyword">using</a> <a id="84" class="Symbol">(</a><a id="85" href="Data.Nat.Properties.html#17056" class="Function">+-0-monoid</a><a id="95" class="Symbol">)</a>

<a id="98" class="Keyword">open</a> <a id="103" class="Keyword">import</a> <a id="110" href="Ledger.Prelude.html" class="Module">Ledger.Prelude</a><a id="124" class="Symbol">;</a> <a id="126" class="Keyword">open</a> <a id="131" href="Function.Bundles.html#4752" class="Module">Equivalence</a>
<a id="143" class="Keyword">open</a> <a id="148" class="Keyword">import</a> <a id="155" href="Ledger.Transaction.html" class="Module">Ledger.Transaction</a>
<a id="174" class="Keyword">open</a> <a id="179" class="Keyword">import</a> <a id="186" href="Ledger.Abstract.html" class="Module">Ledger.Abstract</a>

<a id="203" class="Keyword">module</a> <a id="210" href="Ledger.Conway.Conformance.Chain.html" class="Module">Ledger.Conway.Conformance.Chain</a>
  <a id="244" class="Symbol">(</a><a id="245" href="Ledger.Conway.Conformance.Chain.html#245" class="Bound">txs</a> <a id="249" class="Symbol">:</a> <a id="251" class="Symbol">_)</a> <a id="254" class="Symbol">(</a><a id="255" class="Keyword">open</a> <a id="260" href="Ledger.Transaction.html#867" class="Module">TransactionStructure</a> <a id="281" href="Ledger.Conway.Conformance.Chain.html#245" class="Bound">txs</a><a id="284" class="Symbol">)</a>
  <a id="288" class="Symbol">(</a><a id="289" href="Ledger.Conway.Conformance.Chain.html#289" class="Bound">abs</a> <a id="293" class="Symbol">:</a> <a id="295" href="Ledger.Abstract.html#578" class="Record">AbstractFunctions</a> <a id="313" href="Ledger.Conway.Conformance.Chain.html#245" class="Bound">txs</a><a id="316" class="Symbol">)</a> <a id="318" class="Symbol">(</a><a id="319" class="Keyword">open</a> <a id="324" href="Ledger.Abstract.html#578" class="Module">AbstractFunctions</a> <a id="342" href="Ledger.Conway.Conformance.Chain.html#289" class="Bound">abs</a><a id="345" class="Symbol">)</a>
  <a id="349" class="Keyword">where</a>

<a id="356" class="Keyword">open</a> <a id="361" class="Keyword">import</a> <a id="368" href="Ledger.Enact.html" class="Module">Ledger.Enact</a> <a id="381" href="Ledger.Transaction.html#1809" class="Function">govStructure</a>
<a id="394" class="Keyword">open</a> <a id="399" class="Keyword">import</a> <a id="406" href="Ledger.Conway.Conformance.Ledger.html" class="Module">Ledger.Conway.Conformance.Ledger</a> <a id="439" href="Ledger.Conway.Conformance.Chain.html#245" class="Bound">txs</a> <a id="443" href="Ledger.Conway.Conformance.Chain.html#289" class="Bound">abs</a>
<a id="447" class="Keyword">open</a> <a id="452" class="Keyword">import</a> <a id="459" href="Ledger.Ratify.html" class="Module">Ledger.Ratify</a> <a id="473" href="Ledger.Conway.Conformance.Chain.html#245" class="Bound">txs</a>
<a id="477" class="Keyword">open</a> <a id="482" class="Keyword">import</a> <a id="489" href="Ledger.Conway.Conformance.Utxo.html" class="Module">Ledger.Conway.Conformance.Utxo</a> <a id="520" href="Ledger.Conway.Conformance.Chain.html#245" class="Bound">txs</a> <a id="524" href="Ledger.Conway.Conformance.Chain.html#289" class="Bound">abs</a>
<a id="528" class="Keyword">open</a> <a id="533" class="Keyword">import</a> <a id="540" href="Ledger.Conway.Conformance.Epoch.html" class="Module">Ledger.Conway.Conformance.Epoch</a> <a id="572" href="Ledger.Conway.Conformance.Chain.html#245" class="Bound">txs</a> <a id="576" href="Ledger.Conway.Conformance.Chain.html#289" class="Bound">abs</a>
<a id="580" class="Keyword">open</a> <a id="585" class="Keyword">import</a> <a id="592" href="Ledger.Conway.Conformance.Certs.html" class="Module">Ledger.Conway.Conformance.Certs</a> <a id="624" href="Ledger.Transaction.html#1809" class="Function">govStructure</a>

<a id="638" class="Keyword">record</a> <a id="ChainState"></a><a id="645" href="Ledger.Conway.Conformance.Chain.html#645" class="Record">ChainState</a> <a id="656" class="Symbol">:</a> <a id="658" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="663" class="Keyword">where</a>

  <a id="672" class="Keyword">field</a>

    <a id="ChainState.newEpochState"></a><a id="683" href="Ledger.Conway.Conformance.Chain.html#683" class="Field">newEpochState</a>  <a id="698" class="Symbol">:</a> <a id="700" href="Ledger.Conway.Conformance.Epoch.html#1287" class="Record">NewEpochState</a>

<a id="715" class="Keyword">record</a> <a id="Block"></a><a id="722" href="Ledger.Conway.Conformance.Chain.html#722" class="Record">Block</a> <a id="728" class="Symbol">:</a> <a id="730" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="735" class="Keyword">where</a>

  <a id="744" class="Keyword">field</a>

    <a id="Block.ts"></a><a id="755" href="Ledger.Conway.Conformance.Chain.html#755" class="Field">ts</a>    <a id="761" class="Symbol">:</a> <a id="763" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="768" href="Ledger.Transaction.html#3538" class="Record">Tx</a>
    <a id="Block.slot"></a><a id="775" href="Ledger.Conway.Conformance.Chain.html#775" class="Field">slot</a>  <a id="781" class="Symbol">:</a> <a id="783" href="Ledger.Types.Epoch.html#552" class="Function">Slot</a>

<a id="789" class="Keyword">private</a> <a id="797" class="Keyword">variable</a>
  <a id="808" href="Ledger.Conway.Conformance.Chain.html#808" class="Generalizable">s</a> <a id="810" class="Symbol">:</a> <a id="812" href="Ledger.Conway.Conformance.Chain.html#645" class="Record">ChainState</a>
  <a id="825" href="Ledger.Conway.Conformance.Chain.html#825" class="Generalizable">b</a> <a id="827" class="Symbol">:</a> <a id="829" href="Ledger.Conway.Conformance.Chain.html#722" class="Record">Block</a>
  <a id="837" href="Ledger.Conway.Conformance.Chain.html#837" class="Generalizable">ls&#39;</a> <a id="841" class="Symbol">:</a> <a id="843" href="Ledger.Conway.Conformance.Ledger.html#690" class="Record">LState</a>
  <a id="852" href="Ledger.Conway.Conformance.Chain.html#852" class="Generalizable">nes</a> <a id="856" class="Symbol">:</a> <a id="858" href="Ledger.Conway.Conformance.Epoch.html#1287" class="Record">NewEpochState</a>

<a id="873" class="Keyword">instance</a> <a id="882" href="Ledger.Conway.Conformance.Chain.html#882" class="Function">_</a> <a id="884" class="Symbol">=</a> <a id="886" href="Data.Nat.Properties.html#17056" class="Function">+-0-monoid</a>

<a id="898" class="Comment">-- TODO: do we still need this for anything?</a>
<a id="maybePurpose"></a><a id="943" href="Ledger.Conway.Conformance.Chain.html#943" class="Function">maybePurpose</a> <a id="956" class="Symbol">:</a> <a id="958" href="Ledger.Certs.html#286" class="Datatype">DepositPurpose</a> <a id="973" class="Symbol">→</a> <a id="975" class="Symbol">(</a><a id="976" href="Ledger.Certs.html#286" class="Datatype">DepositPurpose</a> <a id="991" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="993" href="Ledger.Address.html#273" class="Datatype">Credential</a><a id="1003" class="Symbol">)</a> <a id="1005" class="Symbol">→</a> <a id="1007" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a> <a id="1012" class="Symbol">→</a> <a id="1014" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="1020" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a>
<a id="1025" href="Ledger.Conway.Conformance.Chain.html#943" class="Function">maybePurpose</a> <a id="1038" href="Ledger.Conway.Conformance.Chain.html#1038" class="Bound">prps</a> <a id="1043" class="Symbol">(</a><a id="1044" href="Ledger.Conway.Conformance.Chain.html#1044" class="Bound">prps&#39;</a> <a id="1050" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1052" class="Symbol">_)</a> <a id="1055" href="Ledger.Conway.Conformance.Chain.html#1055" class="Bound">c</a> <a id="1057" class="Keyword">with</a> <a id="1062" href="Ledger.Conway.Conformance.Chain.html#1038" class="Bound">prps</a> <a id="1067" href="Class.DecEq.Core.html#159" class="Field Operator">≟</a> <a id="1069" href="Ledger.Conway.Conformance.Chain.html#1044" class="Bound">prps&#39;</a>
<a id="1075" class="Symbol">...</a> <a id="1079" class="Symbol">|</a> <a id="1081" href="Relation.Nullary.Decidable.Core.html#1994" class="InductiveConstructor">yes</a> <a id="1085" class="Symbol">_</a> <a id="1087" class="Symbol">=</a> <a id="1089" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="1094" class="Bound">c</a>
<a id="1096" class="Symbol">...</a> <a id="1100" class="Symbol">|</a> <a id="1102" href="Relation.Nullary.Decidable.Core.html#2031" class="InductiveConstructor">no</a> <a id="1105" class="Symbol">_</a> <a id="1107" class="Symbol">=</a> <a id="1109" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a>

<a id="maybePurpose-prop"></a><a id="1118" href="Ledger.Conway.Conformance.Chain.html#1118" class="Function">maybePurpose-prop</a> <a id="1136" class="Symbol">:</a> <a id="1138" class="Symbol">∀</a> <a id="1140" class="Symbol">{</a><a id="1141" href="Ledger.Conway.Conformance.Chain.html#1141" class="Bound">prps</a><a id="1145" class="Symbol">}</a> <a id="1147" class="Symbol">{</a><a id="1148" href="Ledger.Conway.Conformance.Chain.html#1148" class="Bound">x</a><a id="1149" class="Symbol">}</a> <a id="1151" class="Symbol">{</a><a id="1152" href="Ledger.Conway.Conformance.Chain.html#1152" class="Bound">y</a><a id="1153" class="Symbol">}</a>
  <a id="1157" class="Symbol">→</a> <a id="1159" class="Symbol">(</a><a id="1160" href="Ledger.Conway.Conformance.Chain.html#1160" class="Bound">m</a> <a id="1162" class="Symbol">:</a> <a id="1164" class="Symbol">(</a><a id="1165" href="Ledger.Certs.html#286" class="Datatype">DepositPurpose</a> <a id="1180" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="1182" href="Ledger.Address.html#273" class="Datatype">Credential</a><a id="1192" class="Symbol">)</a> <a id="1194" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="1196" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a><a id="1200" class="Symbol">)</a>
  <a id="1204" class="Symbol">→</a> <a id="1206" class="Symbol">(</a><a id="1207" href="Ledger.Conway.Conformance.Chain.html#1148" class="Bound">x</a> <a id="1209" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1211" href="Ledger.Conway.Conformance.Chain.html#1152" class="Bound">y</a><a id="1212" class="Symbol">)</a> <a id="1214" href="Class.IsSet.html#458" class="Function Operator">∈</a> <a id="1216" href="Class.IsSet.html#916" class="Function">dom</a> <a id="1220" class="Symbol">((</a><a id="1222" href="Axiom.Set.Map.html#10313" class="Function">mapMaybeWithKeyᵐ</a> <a id="1239" class="Symbol">(</a><a id="1240" href="Ledger.Conway.Conformance.Chain.html#943" class="Function">maybePurpose</a> <a id="1253" href="Ledger.Conway.Conformance.Chain.html#1141" class="Bound">prps</a><a id="1257" class="Symbol">)</a> <a id="1259" href="Ledger.Conway.Conformance.Chain.html#1160" class="Bound">m</a><a id="1260" class="Symbol">)</a> <a id="1262" href="Axiom.Set.Map.html#2293" class="Function Operator">ˢ</a><a id="1263" class="Symbol">)</a>
  <a id="1267" class="Symbol">→</a> <a id="1269" href="Ledger.Conway.Conformance.Chain.html#1148" class="Bound">x</a> <a id="1271" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="1273" href="Ledger.Conway.Conformance.Chain.html#1141" class="Bound">prps</a>
<a id="1278" href="Ledger.Conway.Conformance.Chain.html#1118" class="Function">maybePurpose-prop</a> <a id="1296" class="Symbol">{</a><a id="1297" class="Argument">prps</a> <a id="1302" class="Symbol">=</a> <a id="1304" href="Ledger.Conway.Conformance.Chain.html#1304" class="Bound">prps</a><a id="1308" class="Symbol">}</a> <a id="1310" class="Symbol">{</a><a id="1311" href="Ledger.Conway.Conformance.Chain.html#1311" class="Bound">x</a><a id="1312" class="Symbol">}</a> <a id="1314" class="Symbol">{</a><a id="1315" href="Ledger.Conway.Conformance.Chain.html#1315" class="Bound">y</a><a id="1316" class="Symbol">}</a> <a id="1318" class="Symbol">_</a> <a id="1320" href="Ledger.Conway.Conformance.Chain.html#1320" class="Bound">xy∈dom</a> <a id="1327" class="Keyword">with</a> <a id="1332" href="Function.Bundles.html#4834" class="Field">from</a> <a id="1337" href="Axiom.Set.Rel.html#2472" class="Function">dom∈</a> <a id="1342" href="Ledger.Conway.Conformance.Chain.html#1320" class="Bound">xy∈dom</a>
<a id="1349" class="Symbol">...</a> <a id="1353" class="Symbol">|</a> <a id="1355" href="Ledger.Conway.Conformance.Chain.html#1355" class="Bound">z</a> <a id="1357" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1359" href="Ledger.Conway.Conformance.Chain.html#1359" class="Bound">∈mmwk</a> <a id="1365" class="Keyword">with</a> <a id="1370" class="Bound">prps</a> <a id="1375" href="Class.DecEq.Core.html#159" class="Field Operator">≟</a> <a id="1377" class="Bound">x</a> <a id="1379" class="Symbol">|</a> <a id="1381" href="Axiom.Set.Rel.html#5977" class="Function">∈-mapMaybeWithKey</a> <a id="1399" class="Symbol">{</a><a id="1400" class="Argument">f</a> <a id="1402" class="Symbol">=</a> <a id="1404" href="Ledger.Conway.Conformance.Chain.html#943" class="Function">maybePurpose</a> <a id="1417" class="Bound">prps</a><a id="1421" class="Symbol">}</a> <a id="1423" href="Ledger.Conway.Conformance.Chain.html#1359" class="Bound">∈mmwk</a>
<a id="1429" class="Symbol">...</a> <a id="1433" class="Symbol">|</a> <a id="1435" href="Relation.Nullary.Decidable.Core.html#1994" class="InductiveConstructor">yes</a> <a id="1439" href="Agda.Builtin.Equality.html#207" class="InductiveConstructor">refl</a> <a id="1444" class="Symbol">|</a> <a id="1446" class="Symbol">_</a> <a id="1448" class="Symbol">=</a> <a id="1450" href="Agda.Builtin.Equality.html#207" class="InductiveConstructor">refl</a>

<a id="filterPurpose"></a><a id="1456" href="Ledger.Conway.Conformance.Chain.html#1456" class="Function">filterPurpose</a> <a id="1470" class="Symbol">:</a> <a id="1472" href="Ledger.Certs.html#286" class="Datatype">DepositPurpose</a> <a id="1487" class="Symbol">→</a> <a id="1489" class="Symbol">(</a><a id="1490" href="Ledger.Certs.html#286" class="Datatype">DepositPurpose</a> <a id="1505" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="1507" href="Ledger.Address.html#273" class="Datatype">Credential</a><a id="1517" class="Symbol">)</a> <a id="1519" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="1521" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a> <a id="1526" class="Symbol">→</a> <a id="1528" href="Ledger.Address.html#273" class="Datatype">Credential</a> <a id="1539" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="1541" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a>
<a id="1546" href="Ledger.Conway.Conformance.Chain.html#1456" class="Function">filterPurpose</a> <a id="1560" href="Ledger.Conway.Conformance.Chain.html#1560" class="Bound">prps</a> <a id="1565" href="Ledger.Conway.Conformance.Chain.html#1565" class="Bound">m</a> <a id="1567" class="Symbol">=</a> <a id="1569" href="Axiom.Set.Map.html#5896" class="Function">mapKeys</a> <a id="1577" href="Data.Product.Base.html#650" class="Field">proj₂</a> <a id="1583" class="Symbol">(</a><a id="1584" href="Axiom.Set.Map.html#10313" class="Function">mapMaybeWithKeyᵐ</a> <a id="1601" class="Symbol">(</a><a id="1602" href="Ledger.Conway.Conformance.Chain.html#943" class="Function">maybePurpose</a> <a id="1615" href="Ledger.Conway.Conformance.Chain.html#1560" class="Bound">prps</a><a id="1619" class="Symbol">)</a> <a id="1621" href="Ledger.Conway.Conformance.Chain.html#1565" class="Bound">m</a><a id="1622" class="Symbol">)</a>
  <a id="1626" class="Symbol">{λ</a> <a id="1629" class="Keyword">where</a> <a id="1635" href="Ledger.Conway.Conformance.Chain.html#1635" class="Bound">x∈dom</a> <a id="1641" href="Ledger.Conway.Conformance.Chain.html#1641" class="Bound">y∈dom</a> <a id="1647" href="Agda.Builtin.Equality.html#207" class="InductiveConstructor">refl</a> <a id="1652" class="Symbol">→</a> <a id="1654" href="Relation.Binary.PropositionalEquality.Core.html#1339" class="Function">cong</a> <a id="1659" class="Symbol">(</a><a id="1660" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">_,</a> <a id="1663" class="Symbol">_)</a>
                            <a id="1694" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="1696" href="Relation.Binary.PropositionalEquality.Core.html#1938" class="Function">trans</a> <a id="1702" class="Symbol">(</a><a id="1703" href="Ledger.Conway.Conformance.Chain.html#1118" class="Function">maybePurpose-prop</a> <a id="1721" class="Symbol">{</a><a id="1722" class="Argument">prps</a> <a id="1727" class="Symbol">=</a> <a id="1729" href="Ledger.Conway.Conformance.Chain.html#1560" class="Bound">prps</a><a id="1733" class="Symbol">}</a> <a id="1735" href="Ledger.Conway.Conformance.Chain.html#1565" class="Bound">m</a> <a id="1737" href="Ledger.Conway.Conformance.Chain.html#1635" class="Bound">x∈dom</a><a id="1742" class="Symbol">)</a>
                            <a id="1772" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="1774" href="Relation.Binary.PropositionalEquality.Core.html#1893" class="Function">sym</a>   <a id="1780" class="Symbol">(</a><a id="1781" href="Ledger.Conway.Conformance.Chain.html#1118" class="Function">maybePurpose-prop</a> <a id="1799" class="Symbol">{</a><a id="1800" class="Argument">prps</a> <a id="1805" class="Symbol">=</a> <a id="1807" href="Ledger.Conway.Conformance.Chain.html#1560" class="Bound">prps</a><a id="1811" class="Symbol">}</a> <a id="1813" href="Ledger.Conway.Conformance.Chain.html#1565" class="Bound">m</a> <a id="1815" href="Ledger.Conway.Conformance.Chain.html#1641" class="Bound">y∈dom</a><a id="1820" class="Symbol">)}</a>

<a id="govActionDeposits"></a><a id="1824" href="Ledger.Conway.Conformance.Chain.html#1824" class="Function">govActionDeposits</a> <a id="1842" class="Symbol">:</a> <a id="1844" href="Ledger.Conway.Conformance.Ledger.html#690" class="Record">LState</a> <a id="1851" class="Symbol">→</a> <a id="1853" href="Ledger.GovernanceActions.html#458" class="Datatype">VDeleg</a> <a id="1860" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="1862" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a>
<a id="1867" href="Ledger.Conway.Conformance.Chain.html#1824" class="Function">govActionDeposits</a> <a id="1885" href="Ledger.Conway.Conformance.Chain.html#1885" class="Bound">ls</a> <a id="1888" class="Symbol">=</a>
  <a id="1892" class="Keyword">let</a> <a id="1896" class="Keyword">open</a> <a id="1901" href="Ledger.Conway.Conformance.Ledger.html#690" class="Module">LState</a> <a id="1908" href="Ledger.Conway.Conformance.Chain.html#1885" class="Bound">ls</a><a id="1910" class="Symbol">;</a> <a id="1912" class="Keyword">open</a> <a id="1917" href="Ledger.Conway.Conformance.Certs.html#919" class="Module">CertState</a> <a id="1927" href="Ledger.Conway.Conformance.Ledger.html#798" class="Field">certState</a><a id="1936" class="Symbol">;</a> <a id="1938" class="Keyword">open</a> <a id="1943" href="Ledger.Certs.html#2574" class="Module">PState</a> <a id="1950" href="Ledger.Conway.Conformance.Certs.html#998" class="Function">pState</a>
      <a id="1963" class="Keyword">open</a> <a id="1968" href="Ledger.Utxo.html#2516" class="Module">UTxOState</a> <a id="1978" href="Ledger.Conway.Conformance.Ledger.html#745" class="Field">utxoSt</a><a id="1984" class="Symbol">;</a> <a id="1986" class="Keyword">open</a> <a id="1991" href="Ledger.Conway.Conformance.Certs.html#546" class="Module">DState</a> <a id="1998" href="Ledger.Conway.Conformance.Certs.html#978" class="Function">dState</a>
   <a id="2008" class="Keyword">in</a> <a id="2011" href="Data.List.Base.html#4249" class="Function">foldl</a> <a id="2017" href="Axiom.Set.Map.Dec.html#1854" class="Function Operator">_∪⁺_</a> <a id="2022" href="Class.HasEmptySet.html#287" class="Field">∅</a> <a id="2024" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="2026" href="abstract-set-theory.FiniteSetTheory.html#2463" class="Function">setToList</a> <a id="2036" href="Function.Base.html#1974" class="Function Operator">$</a>
    <a id="2042" href="Axiom.Set.html#7805" class="Function">mapPartial</a>
      <a id="2059" class="Symbol">(λ</a> <a id="2062" class="Keyword">where</a> <a id="2068" class="Symbol">(</a><a id="2069" href="Ledger.Conway.Conformance.Chain.html#2069" class="Bound">gaid</a> <a id="2074" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="2076" class="Keyword">record</a> <a id="2083" class="Symbol">{</a> <a id="2085" href="Ledger.GovernanceActions.html#2167" class="Field">returnAddr</a> <a id="2096" class="Symbol">=</a> <a id="2098" class="Keyword">record</a> <a id="2105" class="Symbol">{</a><a id="2106" href="Ledger.Address.html#1265" class="Field">stake</a> <a id="2112" class="Symbol">=</a> <a id="2114" href="Ledger.Conway.Conformance.Chain.html#2114" class="Bound">c</a><a id="2115" class="Symbol">}</a> <a id="2117" class="Symbol">})</a> <a id="2120" class="Symbol">→</a> <a id="2122" class="Keyword">do</a>
        <a id="2133" href="Ledger.Conway.Conformance.Chain.html#2133" class="Bound">vd</a> <a id="2136" href="Class.Monad.Core.html#290" class="Field Operator">←</a> <a id="2138" href="Axiom.Set.Map.html#13670" class="Function">lookupᵐ?</a> <a id="2147" href="Ledger.Conway.Conformance.Certs.html#603" class="Function">voteDelegs</a> <a id="2158" href="Ledger.Conway.Conformance.Chain.html#2114" class="Bound">c</a>
        <a id="2168" href="Ledger.Conway.Conformance.Chain.html#2168" class="Bound">dep</a> <a id="2172" href="Class.Monad.Core.html#290" class="Field Operator">←</a> <a id="2174" href="Axiom.Set.Map.html#13670" class="Function">lookupᵐ?</a> <a id="2183" class="Symbol">(</a><a id="2184" href="Ledger.Conway.Conformance.Certs.html#719" class="Field">DState.deposits</a> <a id="2200" href="Ledger.Conway.Conformance.Certs.html#978" class="Function">dState</a><a id="2206" class="Symbol">)</a> <a id="2208" class="Symbol">(</a><a id="2209" href="Ledger.Certs.html#475" class="InductiveConstructor">GovActionDeposit</a> <a id="2226" href="Ledger.Conway.Conformance.Chain.html#2069" class="Bound">gaid</a><a id="2230" class="Symbol">)</a>
        <a id="2240" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="2245" href="Class.HasSingleton.html#288" class="Field Operator">❴</a> <a id="2247" href="Ledger.Conway.Conformance.Chain.html#2133" class="Bound">vd</a> <a id="2250" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="2252" href="Ledger.Conway.Conformance.Chain.html#2168" class="Bound">dep</a> <a id="2256" href="Class.HasSingleton.html#288" class="Field Operator">❵</a> <a id="2258" class="Symbol">)</a>
      <a id="2266" class="Symbol">(</a><a id="2267" href="Axiom.Set.html#5718" class="Function">fromList</a> <a id="2276" href="Ledger.Conway.Conformance.Ledger.html#772" class="Field">govSt</a><a id="2281" class="Symbol">)</a>

<a id="calculateStakeDistrs"></a><a id="2284" href="Ledger.Conway.Conformance.Chain.html#2284" class="Function">calculateStakeDistrs</a> <a id="2305" class="Symbol">:</a> <a id="2307" href="Ledger.Conway.Conformance.Ledger.html#690" class="Record">LState</a> <a id="2314" class="Symbol">→</a> <a id="2316" href="Ledger.Ratify.html#2876" class="Record">StakeDistrs</a>
<a id="2328" href="Ledger.Conway.Conformance.Chain.html#2284" class="Function">calculateStakeDistrs</a> <a id="2349" href="Ledger.Conway.Conformance.Chain.html#2349" class="Bound">ls</a> <a id="2352" class="Symbol">=</a>
  <a id="2356" class="Keyword">let</a> <a id="2360" class="Keyword">open</a> <a id="2365" href="Ledger.Conway.Conformance.Ledger.html#690" class="Module">LState</a> <a id="2372" href="Ledger.Conway.Conformance.Chain.html#2349" class="Bound">ls</a><a id="2374" class="Symbol">;</a> <a id="2376" class="Keyword">open</a> <a id="2381" href="Ledger.Conway.Conformance.Certs.html#919" class="Module">CertState</a> <a id="2391" href="Ledger.Conway.Conformance.Ledger.html#798" class="Field">certState</a><a id="2400" class="Symbol">;</a> <a id="2402" class="Keyword">open</a> <a id="2407" href="Ledger.Certs.html#2574" class="Module">PState</a> <a id="2414" href="Ledger.Conway.Conformance.Certs.html#998" class="Function">pState</a>
      <a id="2427" class="Keyword">open</a> <a id="2432" href="Ledger.Utxo.html#2516" class="Module">UTxOState</a> <a id="2442" href="Ledger.Conway.Conformance.Ledger.html#745" class="Field">utxoSt</a><a id="2448" class="Symbol">;</a> <a id="2450" class="Keyword">open</a> <a id="2455" href="Ledger.Conway.Conformance.Certs.html#546" class="Module">DState</a> <a id="2462" href="Ledger.Conway.Conformance.Certs.html#978" class="Function">dState</a>
      <a id="2475" href="Ledger.Conway.Conformance.Chain.html#2475" class="Bound">spoDelegs</a> <a id="2485" class="Symbol">=</a> <a id="2487" href="Class.HasEmptySet.html#287" class="Field">∅</a> <a id="2489" class="Comment">-- TODO</a>
      <a id="2503" href="Ledger.Conway.Conformance.Chain.html#2503" class="Bound">drepDelegs</a> <a id="2514" class="Symbol">=</a> <a id="2516" href="Class.HasEmptySet.html#287" class="Field">∅</a> <a id="2518" class="Comment">-- TODO</a>
  <a id="2528" class="Keyword">in</a>
  <a id="2533" class="Keyword">record</a>
    <a id="2544" class="Symbol">{</a> <a id="2546" href="Ledger.Ratify.html#2913" class="Field">stakeDistr</a> <a id="2557" class="Symbol">=</a> <a id="2559" href="Ledger.Conway.Conformance.Chain.html#1824" class="Function">govActionDeposits</a> <a id="2577" href="Ledger.Conway.Conformance.Chain.html#2349" class="Bound">ls</a>
    <a id="2584" class="Symbol">}</a>


<a id="2588" class="Keyword">data</a>

  <a id="_⊢_⇀⦇_,CHAIN⦈_"></a><a id="2596" href="Ledger.Conway.Conformance.Chain.html#2596" class="Datatype Operator">_⊢_⇀⦇_,CHAIN⦈_</a> <a id="2611" class="Symbol">:</a> <a id="2613" href="Agda.Builtin.Unit.html#175" class="Record">⊤</a> <a id="2615" class="Symbol">→</a> <a id="2617" href="Ledger.Conway.Conformance.Chain.html#645" class="Record">ChainState</a> <a id="2628" class="Symbol">→</a> <a id="2630" href="Ledger.Conway.Conformance.Chain.html#722" class="Record">Block</a> <a id="2636" class="Symbol">→</a> <a id="2638" href="Ledger.Conway.Conformance.Chain.html#645" class="Record">ChainState</a> <a id="2649" class="Symbol">→</a> <a id="2651" href="Agda.Primitive.html#388" class="Primitive">Type</a>

  <a id="2659" class="Keyword">where</a>

  <a id="_⊢_⇀⦇_,CHAIN⦈_.CHAIN"></a><a id="2668" href="Ledger.Conway.Conformance.Chain.html#2668" class="InductiveConstructor">CHAIN</a> <a id="2674" class="Symbol">:</a>
    <a id="2680" class="Keyword">let</a> <a id="2684" class="Keyword">open</a> <a id="2689" href="Ledger.Conway.Conformance.Chain.html#645" class="Module">ChainState</a> <a id="2700" href="Ledger.Conway.Conformance.Chain.html#808" class="Generalizable">s</a><a id="2701" class="Symbol">;</a> <a id="2703" class="Keyword">open</a> <a id="2708" href="Ledger.Conway.Conformance.Chain.html#722" class="Module">Block</a> <a id="2714" href="Ledger.Conway.Conformance.Chain.html#825" class="Generalizable">b</a><a id="2715" class="Symbol">;</a> <a id="2717" class="Keyword">open</a> <a id="2722" href="Ledger.Conway.Conformance.Epoch.html#1287" class="Module">NewEpochState</a> <a id="2736" href="Ledger.Conway.Conformance.Chain.html#852" class="Generalizable">nes</a>
        <a id="2748" class="Keyword">open</a> <a id="2753" href="Ledger.Conway.Conformance.Epoch.html#1089" class="Module">EpochState</a> <a id="2764" href="Ledger.Conway.Conformance.Epoch.html#1350" class="Function">epochState</a><a id="2774" class="Symbol">;</a> <a id="2776" class="Keyword">open</a> <a id="2781" href="Ledger.Enact.html#397" class="Module">EnactState</a> <a id="2792" href="Ledger.Conway.Conformance.Epoch.html#1226" class="Function">es</a>
    <a id="2799" class="Keyword">in</a>
       <a id="2809" class="Symbol">_</a> <a id="2811" href="Ledger.Conway.Conformance.Epoch.html#6522" class="Datatype Operator">⊢</a> <a id="2813" href="Ledger.Conway.Conformance.Chain.html#683" class="Function">newEpochState</a> <a id="2827" href="Ledger.Conway.Conformance.Epoch.html#6522" class="Datatype Operator">⇀⦇</a> <a id="2830" href="Ledger.Types.Epoch.html#688" class="Function">epoch</a> <a id="2836" href="Ledger.Conway.Conformance.Chain.html#775" class="Function">slot</a> <a id="2841" href="Ledger.Conway.Conformance.Epoch.html#6522" class="Datatype Operator">,NEWEPOCH⦈</a> <a id="2852" href="Ledger.Conway.Conformance.Chain.html#852" class="Generalizable">nes</a>
    <a id="2860" class="Symbol">→</a>  <a id="2863" href="Class.To.html#102" class="Field Operator">⟦</a> <a id="2865" href="Ledger.Conway.Conformance.Chain.html#775" class="Function">slot</a> <a id="2870" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="2872" href="Ledger.Enact.html#502" class="Function">constitution</a> <a id="2885" class="Symbol">.</a><a id="2886" href="Data.Product.Base.html#636" class="Field">proj₁</a> <a id="2892" class="Symbol">.</a><a id="2893" href="Data.Product.Base.html#650" class="Field">proj₂</a> <a id="2899" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="2901" href="Ledger.Enact.html#607" class="Function">pparams</a> <a id="2909" class="Symbol">.</a><a id="2910" href="Data.Product.Base.html#636" class="Field">proj₁</a> <a id="2916" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="2918" href="Ledger.Conway.Conformance.Epoch.html#1226" class="Function">es</a> <a id="2921" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="2923" href="Ledger.PParams.html#729" class="Field">Acnt.treasury</a> <a id="2937" href="Ledger.Conway.Conformance.Epoch.html#1153" class="Function">acnt</a>
       <a id="2949" href="Class.To.html#102" class="Field Operator">⟧</a> <a id="2951" href="Ledger.Conway.Conformance.Ledger.html#2155" class="Function Operator">⊢</a> <a id="2953" href="Ledger.Conway.Conformance.Epoch.html#1202" class="Function">ls</a> <a id="2956" href="Ledger.Conway.Conformance.Ledger.html#2155" class="Function Operator">⇀⦇</a> <a id="2959" href="Ledger.Conway.Conformance.Chain.html#755" class="Function">ts</a> <a id="2962" href="Ledger.Conway.Conformance.Ledger.html#2155" class="Function Operator">,LEDGERS⦈</a> <a id="2972" href="Ledger.Conway.Conformance.Chain.html#837" class="Generalizable">ls&#39;</a>
    <a id="2980" href="Interface.STS.html#350" class="Function Operator">────────────────────────────────</a>
    <a id="3017" class="Symbol">_</a> <a id="3019" href="Ledger.Conway.Conformance.Chain.html#2596" class="Datatype Operator">⊢</a> <a id="3021" href="Ledger.Conway.Conformance.Chain.html#808" class="Generalizable">s</a> <a id="3023" href="Ledger.Conway.Conformance.Chain.html#2596" class="Datatype Operator">⇀⦇</a> <a id="3026" href="Ledger.Conway.Conformance.Chain.html#825" class="Generalizable">b</a> <a id="3028" href="Ledger.Conway.Conformance.Chain.html#2596" class="Datatype Operator">,CHAIN⦈</a>
        <a id="3044" class="Keyword">record</a> <a id="3051" href="Ledger.Conway.Conformance.Chain.html#808" class="Generalizable">s</a> <a id="3053" class="Symbol">{</a> <a id="3055" href="Ledger.Conway.Conformance.Chain.html#683" class="Field">newEpochState</a> <a id="3069" class="Symbol">=</a> <a id="3071" class="Keyword">record</a> <a id="3078" href="Ledger.Conway.Conformance.Chain.html#852" class="Generalizable">nes</a> <a id="3082" class="Symbol">{</a> <a id="3084" href="Ledger.Conway.Conformance.Epoch.html#1350" class="Field">epochState</a> <a id="3095" class="Symbol">=</a> <a id="3097" class="Keyword">record</a> <a id="3104" href="Ledger.Conway.Conformance.Epoch.html#1350" class="Function">epochState</a> <a id="3115" class="Symbol">{</a> <a id="3117" href="Ledger.Conway.Conformance.Epoch.html#1202" class="Field">ls</a> <a id="3120" class="Symbol">=</a> <a id="3122" href="Ledger.Conway.Conformance.Chain.html#837" class="Generalizable">ls&#39;</a><a id="3125" class="Symbol">}</a> <a id="3127" class="Symbol">}</a> <a id="3129" class="Symbol">}</a>
</pre></body></html>