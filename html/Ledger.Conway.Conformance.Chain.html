<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>Ledger.Conway.Conformance.Chain</title><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.css"><link rel="stylesheet" href="Agda.css"><script src="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.js"></script><script src="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/contrib/auto-render.min.js"></script><script src="AgdaKaTeX.js" defer=""></script></head><body><pre class="Agda">
<a id="2" class="Symbol">{-#</a> <a id="6" class="Keyword">OPTIONS</a> <a id="14" class="Pragma">--safe</a> <a id="21" class="Symbol">#-}</a>

<a id="26" class="Keyword">open</a> <a id="31" class="Keyword">import</a> <a id="38" href="Algebra.html" class="Module">Algebra</a>
<a id="46" class="Keyword">open</a> <a id="51" class="Keyword">import</a> <a id="58" href="Data.Nat.Properties.html" class="Module">Data.Nat.Properties</a> <a id="78" class="Keyword">using</a> <a id="84" class="Symbol">(</a><a id="85" href="Data.Nat.Properties.html#17252" class="Function">+-0-monoid</a><a id="95" class="Symbol">)</a>

<a id="98" class="Keyword">open</a> <a id="103" class="Keyword">import</a> <a id="110" href="Ledger.Prelude.html" class="Module">Ledger.Prelude</a><a id="124" class="Symbol">;</a> <a id="126" class="Keyword">open</a> <a id="131" href="Function.Bundles.html#4752" class="Module">Equivalence</a>
<a id="143" class="Keyword">open</a> <a id="148" class="Keyword">import</a> <a id="155" href="Ledger.Conway.Transaction.html" class="Module">Ledger.Conway.Transaction</a>
<a id="181" class="Keyword">open</a> <a id="186" class="Keyword">import</a> <a id="193" href="Ledger.Conway.Abstract.html" class="Module">Ledger.Conway.Abstract</a>

<a id="217" class="Keyword">module</a> <a id="224" href="Ledger.Conway.Conformance.Chain.html" class="Module">Ledger.Conway.Conformance.Chain</a>
  <a id="258" class="Symbol">(</a><a id="259" href="Ledger.Conway.Conformance.Chain.html#259" class="Bound">txs</a> <a id="263" class="Symbol">:</a> <a id="265" class="Symbol">_)</a> <a id="268" class="Symbol">(</a><a id="269" class="Keyword">open</a> <a id="274" href="Ledger.Conway.Transaction.html#888" class="Module">TransactionStructure</a> <a id="295" href="Ledger.Conway.Conformance.Chain.html#259" class="Bound">txs</a><a id="298" class="Symbol">)</a>
  <a id="302" class="Symbol">(</a><a id="303" href="Ledger.Conway.Conformance.Chain.html#303" class="Bound">abs</a> <a id="307" class="Symbol">:</a> <a id="309" href="Ledger.Conway.Abstract.html#599" class="Record">AbstractFunctions</a> <a id="327" href="Ledger.Conway.Conformance.Chain.html#259" class="Bound">txs</a><a id="330" class="Symbol">)</a> <a id="332" class="Symbol">(</a><a id="333" class="Keyword">open</a> <a id="338" href="Ledger.Conway.Abstract.html#599" class="Module">AbstractFunctions</a> <a id="356" href="Ledger.Conway.Conformance.Chain.html#303" class="Bound">abs</a><a id="359" class="Symbol">)</a>
  <a id="363" class="Keyword">where</a>

<a id="370" class="Keyword">open</a> <a id="375" class="Keyword">import</a> <a id="382" href="Ledger.Conway.Enact.html" class="Module">Ledger.Conway.Enact</a> <a id="402" href="Ledger.Conway.Transaction.html#1868" class="Function">govStructure</a>
<a id="415" class="Keyword">open</a> <a id="420" class="Keyword">import</a> <a id="427" href="Ledger.Conway.Conformance.Ledger.html" class="Module">Ledger.Conway.Conformance.Ledger</a> <a id="460" href="Ledger.Conway.Conformance.Chain.html#259" class="Bound">txs</a> <a id="464" href="Ledger.Conway.Conformance.Chain.html#303" class="Bound">abs</a>
<a id="468" class="Keyword">open</a> <a id="473" class="Keyword">import</a> <a id="480" href="Ledger.Conway.Ratify.html" class="Module">Ledger.Conway.Ratify</a> <a id="501" href="Ledger.Conway.Conformance.Chain.html#259" class="Bound">txs</a>
<a id="505" class="Keyword">open</a> <a id="510" class="Keyword">import</a> <a id="517" href="Ledger.Conway.Conformance.Utxo.html" class="Module">Ledger.Conway.Conformance.Utxo</a> <a id="548" href="Ledger.Conway.Conformance.Chain.html#259" class="Bound">txs</a> <a id="552" href="Ledger.Conway.Conformance.Chain.html#303" class="Bound">abs</a>
<a id="556" class="Keyword">open</a> <a id="561" class="Keyword">import</a> <a id="568" href="Ledger.Conway.Conformance.Epoch.html" class="Module">Ledger.Conway.Conformance.Epoch</a> <a id="600" href="Ledger.Conway.Conformance.Chain.html#259" class="Bound">txs</a> <a id="604" href="Ledger.Conway.Conformance.Chain.html#303" class="Bound">abs</a>
<a id="608" class="Keyword">open</a> <a id="613" class="Keyword">import</a> <a id="620" href="Ledger.Conway.Conformance.Certs.html" class="Module">Ledger.Conway.Conformance.Certs</a> <a id="652" href="Ledger.Conway.Transaction.html#1868" class="Function">govStructure</a>

<a id="666" class="Keyword">record</a> <a id="ChainState"></a><a id="673" href="Ledger.Conway.Conformance.Chain.html#673" class="Record">ChainState</a> <a id="684" class="Symbol">:</a> <a id="686" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="691" class="Keyword">where</a>

  <a id="700" class="Keyword">field</a>

    <a id="ChainState.newEpochState"></a><a id="711" href="Ledger.Conway.Conformance.Chain.html#711" class="Field">newEpochState</a>  <a id="726" class="Symbol">:</a> <a id="728" href="Ledger.Conway.Conformance.Epoch.html#1293" class="Record">NewEpochState</a>

<a id="743" class="Keyword">record</a> <a id="Block"></a><a id="750" href="Ledger.Conway.Conformance.Chain.html#750" class="Record">Block</a> <a id="756" class="Symbol">:</a> <a id="758" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="763" class="Keyword">where</a>

  <a id="772" class="Keyword">field</a>

    <a id="Block.ts"></a><a id="783" href="Ledger.Conway.Conformance.Chain.html#783" class="Field">ts</a>    <a id="789" class="Symbol">:</a> <a id="791" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="796" href="Ledger.Conway.Transaction.html#4298" class="Record">Tx</a>
    <a id="Block.slot"></a><a id="803" href="Ledger.Conway.Conformance.Chain.html#803" class="Field">slot</a>  <a id="809" class="Symbol">:</a> <a id="811" href="Ledger.Conway.Types.Epoch.html#668" class="Function">Slot</a>

<a id="817" class="Keyword">private</a> <a id="825" class="Keyword">variable</a>
  <a id="836" href="Ledger.Conway.Conformance.Chain.html#836" class="Generalizable">s</a> <a id="838" class="Symbol">:</a> <a id="840" href="Ledger.Conway.Conformance.Chain.html#673" class="Record">ChainState</a>
  <a id="853" href="Ledger.Conway.Conformance.Chain.html#853" class="Generalizable">b</a> <a id="855" class="Symbol">:</a> <a id="857" href="Ledger.Conway.Conformance.Chain.html#750" class="Record">Block</a>
  <a id="865" href="Ledger.Conway.Conformance.Chain.html#865" class="Generalizable">ls&#39;</a> <a id="869" class="Symbol">:</a> <a id="871" href="Ledger.Conway.Conformance.Ledger.html#723" class="Record">LState</a>
  <a id="880" href="Ledger.Conway.Conformance.Chain.html#880" class="Generalizable">nes</a> <a id="884" class="Symbol">:</a> <a id="886" href="Ledger.Conway.Conformance.Epoch.html#1293" class="Record">NewEpochState</a>

<a id="901" class="Keyword">instance</a> <a id="910" href="Ledger.Conway.Conformance.Chain.html#910" class="Function">_</a> <a id="912" class="Symbol">=</a> <a id="914" href="Data.Nat.Properties.html#17252" class="Function">+-0-monoid</a>

<a id="926" class="Comment">-- TODO: do we still need this for anything?</a>
<a id="maybePurpose"></a><a id="971" href="Ledger.Conway.Conformance.Chain.html#971" class="Function">maybePurpose</a> <a id="984" class="Symbol">:</a> <a id="986" href="Ledger.Conway.Certs.html#328" class="Datatype">DepositPurpose</a> <a id="1001" class="Symbol">→</a> <a id="1003" class="Symbol">(</a><a id="1004" href="Ledger.Conway.Certs.html#328" class="Datatype">DepositPurpose</a> <a id="1019" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="1021" href="Ledger.Conway.Address.html#248" class="Datatype">Credential</a><a id="1031" class="Symbol">)</a> <a id="1033" class="Symbol">→</a> <a id="1035" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a> <a id="1040" class="Symbol">→</a> <a id="1042" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="1048" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a>
<a id="1053" href="Ledger.Conway.Conformance.Chain.html#971" class="Function">maybePurpose</a> <a id="1066" href="Ledger.Conway.Conformance.Chain.html#1066" class="Bound">prps</a> <a id="1071" class="Symbol">(</a><a id="1072" href="Ledger.Conway.Conformance.Chain.html#1072" class="Bound">prps&#39;</a> <a id="1078" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1080" class="Symbol">_)</a> <a id="1083" href="Ledger.Conway.Conformance.Chain.html#1083" class="Bound">c</a> <a id="1085" class="Keyword">with</a> <a id="1090" href="Ledger.Conway.Conformance.Chain.html#1066" class="Bound">prps</a> <a id="1095" href="Class.DecEq.Core.html#159" class="Field Operator">≟</a> <a id="1097" href="Ledger.Conway.Conformance.Chain.html#1072" class="Bound">prps&#39;</a>
<a id="1103" class="Symbol">...</a> <a id="1107" class="Symbol">|</a> <a id="1109" href="Relation.Nullary.Decidable.Core.html#1994" class="InductiveConstructor">yes</a> <a id="1113" class="Symbol">_</a> <a id="1115" class="Symbol">=</a> <a id="1117" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="1122" class="Bound">c</a>
<a id="1124" class="Symbol">...</a> <a id="1128" class="Symbol">|</a> <a id="1130" href="Relation.Nullary.Decidable.Core.html#2031" class="InductiveConstructor">no</a> <a id="1133" class="Symbol">_</a> <a id="1135" class="Symbol">=</a> <a id="1137" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a>

<a id="maybePurpose-prop"></a><a id="1146" href="Ledger.Conway.Conformance.Chain.html#1146" class="Function">maybePurpose-prop</a> <a id="1164" class="Symbol">:</a> <a id="1166" class="Symbol">∀</a> <a id="1168" class="Symbol">{</a><a id="1169" href="Ledger.Conway.Conformance.Chain.html#1169" class="Bound">prps</a><a id="1173" class="Symbol">}</a> <a id="1175" class="Symbol">{</a><a id="1176" href="Ledger.Conway.Conformance.Chain.html#1176" class="Bound">x</a><a id="1177" class="Symbol">}</a> <a id="1179" class="Symbol">{</a><a id="1180" href="Ledger.Conway.Conformance.Chain.html#1180" class="Bound">y</a><a id="1181" class="Symbol">}</a>
  <a id="1185" class="Symbol">→</a> <a id="1187" class="Symbol">(</a><a id="1188" href="Ledger.Conway.Conformance.Chain.html#1188" class="Bound">m</a> <a id="1190" class="Symbol">:</a> <a id="1192" class="Symbol">(</a><a id="1193" href="Ledger.Conway.Certs.html#328" class="Datatype">DepositPurpose</a> <a id="1208" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="1210" href="Ledger.Conway.Address.html#248" class="Datatype">Credential</a><a id="1220" class="Symbol">)</a> <a id="1222" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="1224" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a><a id="1228" class="Symbol">)</a>
  <a id="1232" class="Symbol">→</a> <a id="1234" class="Symbol">(</a><a id="1235" href="Ledger.Conway.Conformance.Chain.html#1176" class="Bound">x</a> <a id="1237" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1239" href="Ledger.Conway.Conformance.Chain.html#1180" class="Bound">y</a><a id="1240" class="Symbol">)</a> <a id="1242" href="Class.IsSet.html#458" class="Function Operator">∈</a> <a id="1244" href="Class.IsSet.html#916" class="Function">dom</a> <a id="1248" class="Symbol">((</a><a id="1250" href="Axiom.Set.Map.html#10313" class="Function">mapMaybeWithKeyᵐ</a> <a id="1267" class="Symbol">(</a><a id="1268" href="Ledger.Conway.Conformance.Chain.html#971" class="Function">maybePurpose</a> <a id="1281" href="Ledger.Conway.Conformance.Chain.html#1169" class="Bound">prps</a><a id="1285" class="Symbol">)</a> <a id="1287" href="Ledger.Conway.Conformance.Chain.html#1188" class="Bound">m</a><a id="1288" class="Symbol">)</a> <a id="1290" href="Axiom.Set.Map.html#2293" class="Function Operator">ˢ</a><a id="1291" class="Symbol">)</a>
  <a id="1295" class="Symbol">→</a> <a id="1297" href="Ledger.Conway.Conformance.Chain.html#1176" class="Bound">x</a> <a id="1299" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="1301" href="Ledger.Conway.Conformance.Chain.html#1169" class="Bound">prps</a>
<a id="1306" href="Ledger.Conway.Conformance.Chain.html#1146" class="Function">maybePurpose-prop</a> <a id="1324" class="Symbol">{</a><a id="1325" class="Argument">prps</a> <a id="1330" class="Symbol">=</a> <a id="1332" href="Ledger.Conway.Conformance.Chain.html#1332" class="Bound">prps</a><a id="1336" class="Symbol">}</a> <a id="1338" class="Symbol">{</a><a id="1339" href="Ledger.Conway.Conformance.Chain.html#1339" class="Bound">x</a><a id="1340" class="Symbol">}</a> <a id="1342" class="Symbol">{</a><a id="1343" href="Ledger.Conway.Conformance.Chain.html#1343" class="Bound">y</a><a id="1344" class="Symbol">}</a> <a id="1346" class="Symbol">_</a> <a id="1348" href="Ledger.Conway.Conformance.Chain.html#1348" class="Bound">xy∈dom</a> <a id="1355" class="Keyword">with</a> <a id="1360" href="Function.Bundles.html#4834" class="Field">from</a> <a id="1365" href="Axiom.Set.Rel.html#2472" class="Function">dom∈</a> <a id="1370" href="Ledger.Conway.Conformance.Chain.html#1348" class="Bound">xy∈dom</a>
<a id="1377" class="Symbol">...</a> <a id="1381" class="Symbol">|</a> <a id="1383" href="Ledger.Conway.Conformance.Chain.html#1383" class="Bound">z</a> <a id="1385" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1387" href="Ledger.Conway.Conformance.Chain.html#1387" class="Bound">∈mmwk</a> <a id="1393" class="Keyword">with</a> <a id="1398" class="Bound">prps</a> <a id="1403" href="Class.DecEq.Core.html#159" class="Field Operator">≟</a> <a id="1405" class="Bound">x</a> <a id="1407" class="Symbol">|</a> <a id="1409" href="Axiom.Set.Rel.html#5977" class="Function">∈-mapMaybeWithKey</a> <a id="1427" class="Symbol">{</a><a id="1428" class="Argument">f</a> <a id="1430" class="Symbol">=</a> <a id="1432" href="Ledger.Conway.Conformance.Chain.html#971" class="Function">maybePurpose</a> <a id="1445" class="Bound">prps</a><a id="1449" class="Symbol">}</a> <a id="1451" href="Ledger.Conway.Conformance.Chain.html#1387" class="Bound">∈mmwk</a>
<a id="1457" class="Symbol">...</a> <a id="1461" class="Symbol">|</a> <a id="1463" href="Relation.Nullary.Decidable.Core.html#1994" class="InductiveConstructor">yes</a> <a id="1467" href="Agda.Builtin.Equality.html#207" class="InductiveConstructor">refl</a> <a id="1472" class="Symbol">|</a> <a id="1474" class="Symbol">_</a> <a id="1476" class="Symbol">=</a> <a id="1478" href="Agda.Builtin.Equality.html#207" class="InductiveConstructor">refl</a>

<a id="filterPurpose"></a><a id="1484" href="Ledger.Conway.Conformance.Chain.html#1484" class="Function">filterPurpose</a> <a id="1498" class="Symbol">:</a> <a id="1500" href="Ledger.Conway.Certs.html#328" class="Datatype">DepositPurpose</a> <a id="1515" class="Symbol">→</a> <a id="1517" class="Symbol">(</a><a id="1518" href="Ledger.Conway.Certs.html#328" class="Datatype">DepositPurpose</a> <a id="1533" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="1535" href="Ledger.Conway.Address.html#248" class="Datatype">Credential</a><a id="1545" class="Symbol">)</a> <a id="1547" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="1549" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a> <a id="1554" class="Symbol">→</a> <a id="1556" href="Ledger.Conway.Address.html#248" class="Datatype">Credential</a> <a id="1567" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="1569" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a>
<a id="1574" href="Ledger.Conway.Conformance.Chain.html#1484" class="Function">filterPurpose</a> <a id="1588" href="Ledger.Conway.Conformance.Chain.html#1588" class="Bound">prps</a> <a id="1593" href="Ledger.Conway.Conformance.Chain.html#1593" class="Bound">m</a> <a id="1595" class="Symbol">=</a> <a id="1597" href="Axiom.Set.Map.html#5896" class="Function">mapKeys</a> <a id="1605" href="Data.Product.Base.html#650" class="Field">proj₂</a> <a id="1611" class="Symbol">(</a><a id="1612" href="Axiom.Set.Map.html#10313" class="Function">mapMaybeWithKeyᵐ</a> <a id="1629" class="Symbol">(</a><a id="1630" href="Ledger.Conway.Conformance.Chain.html#971" class="Function">maybePurpose</a> <a id="1643" href="Ledger.Conway.Conformance.Chain.html#1588" class="Bound">prps</a><a id="1647" class="Symbol">)</a> <a id="1649" href="Ledger.Conway.Conformance.Chain.html#1593" class="Bound">m</a><a id="1650" class="Symbol">)</a>
  <a id="1654" class="Symbol">{λ</a> <a id="1657" class="Keyword">where</a> <a id="1663" href="Ledger.Conway.Conformance.Chain.html#1663" class="Bound">x∈dom</a> <a id="1669" href="Ledger.Conway.Conformance.Chain.html#1669" class="Bound">y∈dom</a> <a id="1675" href="Agda.Builtin.Equality.html#207" class="InductiveConstructor">refl</a> <a id="1680" class="Symbol">→</a> <a id="1682" href="Relation.Binary.PropositionalEquality.Core.html#1339" class="Function">cong</a> <a id="1687" class="Symbol">(</a><a id="1688" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">_,</a> <a id="1691" class="Symbol">_)</a>
                            <a id="1722" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="1724" href="Relation.Binary.PropositionalEquality.Core.html#1938" class="Function">trans</a> <a id="1730" class="Symbol">(</a><a id="1731" href="Ledger.Conway.Conformance.Chain.html#1146" class="Function">maybePurpose-prop</a> <a id="1749" class="Symbol">{</a><a id="1750" class="Argument">prps</a> <a id="1755" class="Symbol">=</a> <a id="1757" href="Ledger.Conway.Conformance.Chain.html#1588" class="Bound">prps</a><a id="1761" class="Symbol">}</a> <a id="1763" href="Ledger.Conway.Conformance.Chain.html#1593" class="Bound">m</a> <a id="1765" href="Ledger.Conway.Conformance.Chain.html#1663" class="Bound">x∈dom</a><a id="1770" class="Symbol">)</a>
                            <a id="1800" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="1802" href="Relation.Binary.PropositionalEquality.Core.html#1893" class="Function">sym</a>   <a id="1808" class="Symbol">(</a><a id="1809" href="Ledger.Conway.Conformance.Chain.html#1146" class="Function">maybePurpose-prop</a> <a id="1827" class="Symbol">{</a><a id="1828" class="Argument">prps</a> <a id="1833" class="Symbol">=</a> <a id="1835" href="Ledger.Conway.Conformance.Chain.html#1588" class="Bound">prps</a><a id="1839" class="Symbol">}</a> <a id="1841" href="Ledger.Conway.Conformance.Chain.html#1593" class="Bound">m</a> <a id="1843" href="Ledger.Conway.Conformance.Chain.html#1669" class="Bound">y∈dom</a><a id="1848" class="Symbol">)}</a>

<a id="govActionDeposits"></a><a id="1852" href="Ledger.Conway.Conformance.Chain.html#1852" class="Function">govActionDeposits</a> <a id="1870" class="Symbol">:</a> <a id="1872" href="Ledger.Conway.Conformance.Ledger.html#723" class="Record">LState</a> <a id="1879" class="Symbol">→</a> <a id="1881" href="Ledger.Conway.GovernanceActions.html#440" class="Datatype">VDeleg</a> <a id="1888" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="1890" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a>
<a id="1895" href="Ledger.Conway.Conformance.Chain.html#1852" class="Function">govActionDeposits</a> <a id="1913" href="Ledger.Conway.Conformance.Chain.html#1913" class="Bound">ls</a> <a id="1916" class="Symbol">=</a>
  <a id="1920" class="Keyword">let</a> <a id="1924" class="Keyword">open</a> <a id="1929" href="Ledger.Conway.Conformance.Ledger.html#723" class="Module">LState</a> <a id="1936" href="Ledger.Conway.Conformance.Chain.html#1913" class="Bound">ls</a><a id="1938" class="Symbol">;</a> <a id="1940" class="Keyword">open</a> <a id="1945" href="Ledger.Conway.Conformance.Certs.html#930" class="Module">CertState</a> <a id="1955" href="Ledger.Conway.Conformance.Ledger.html#831" class="Field">certState</a><a id="1964" class="Symbol">;</a> <a id="1966" class="Keyword">open</a> <a id="1971" href="Ledger.Conway.Certs.html#3777" class="Module">PState</a> <a id="1978" href="Ledger.Conway.Conformance.Certs.html#1009" class="Function">pState</a>
      <a id="1991" class="Keyword">open</a> <a id="1996" href="Ledger.Conway.Utxo.html#2715" class="Module">UTxOState</a> <a id="2006" href="Ledger.Conway.Conformance.Ledger.html#778" class="Field">utxoSt</a><a id="2012" class="Symbol">;</a> <a id="2014" class="Keyword">open</a> <a id="2019" href="Ledger.Conway.Conformance.Certs.html#557" class="Module">DState</a> <a id="2026" href="Ledger.Conway.Conformance.Certs.html#989" class="Function">dState</a>
   <a id="2036" class="Keyword">in</a> <a id="2039" href="Data.List.Base.html#4249" class="Function">foldl</a> <a id="2045" href="Axiom.Set.Map.Dec.html#1854" class="Function Operator">_∪⁺_</a> <a id="2050" href="Class.HasEmptySet.html#287" class="Field">∅</a> <a id="2052" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="2054" href="abstract-set-theory.FiniteSetTheory.html#2463" class="Function">setToList</a> <a id="2064" href="Function.Base.html#1974" class="Function Operator">$</a>
    <a id="2070" href="Axiom.Set.html#7805" class="Function">mapPartial</a>
      <a id="2087" class="Symbol">(λ</a> <a id="2090" class="Keyword">where</a> <a id="2096" class="Symbol">(</a><a id="2097" href="Ledger.Conway.Conformance.Chain.html#2097" class="Bound">gaid</a> <a id="2102" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="2104" class="Keyword">record</a> <a id="2111" class="Symbol">{</a> <a id="2113" href="Ledger.Conway.GovernanceActions.html#2799" class="Field">returnAddr</a> <a id="2124" class="Symbol">=</a> <a id="2126" class="Keyword">record</a> <a id="2133" class="Symbol">{</a><a id="2134" href="Ledger.Conway.Address.html#1366" class="Field">stake</a> <a id="2140" class="Symbol">=</a> <a id="2142" href="Ledger.Conway.Conformance.Chain.html#2142" class="Bound">c</a><a id="2143" class="Symbol">}</a> <a id="2145" class="Symbol">})</a> <a id="2148" class="Symbol">→</a> <a id="2150" class="Keyword">do</a>
        <a id="2161" href="Ledger.Conway.Conformance.Chain.html#2161" class="Bound">vd</a> <a id="2164" href="Class.Monad.Core.html#299" class="Field Operator">←</a> <a id="2166" href="Axiom.Set.Map.html#13670" class="Function">lookupᵐ?</a> <a id="2175" href="Ledger.Conway.Conformance.Certs.html#614" class="Function">voteDelegs</a> <a id="2186" href="Ledger.Conway.Conformance.Chain.html#2142" class="Bound">c</a>
        <a id="2196" href="Ledger.Conway.Conformance.Chain.html#2196" class="Bound">dep</a> <a id="2200" href="Class.Monad.Core.html#299" class="Field Operator">←</a> <a id="2202" href="Axiom.Set.Map.html#13670" class="Function">lookupᵐ?</a> <a id="2211" class="Symbol">(</a><a id="2212" href="Ledger.Conway.Conformance.Certs.html#730" class="Field">DState.deposits</a> <a id="2228" href="Ledger.Conway.Conformance.Certs.html#989" class="Function">dState</a><a id="2234" class="Symbol">)</a> <a id="2236" class="Symbol">(</a><a id="2237" href="Ledger.Conway.Certs.html#517" class="InductiveConstructor">GovActionDeposit</a> <a id="2254" href="Ledger.Conway.Conformance.Chain.html#2097" class="Bound">gaid</a><a id="2258" class="Symbol">)</a>
        <a id="2268" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="2273" href="Class.HasSingleton.html#288" class="Field Operator">❴</a> <a id="2275" href="Ledger.Conway.Conformance.Chain.html#2161" class="Bound">vd</a> <a id="2278" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="2280" href="Ledger.Conway.Conformance.Chain.html#2196" class="Bound">dep</a> <a id="2284" href="Class.HasSingleton.html#288" class="Field Operator">❵</a> <a id="2286" class="Symbol">)</a>
      <a id="2294" class="Symbol">(</a><a id="2295" href="Axiom.Set.html#5718" class="Function">fromList</a> <a id="2304" href="Ledger.Conway.Conformance.Ledger.html#805" class="Field">govSt</a><a id="2309" class="Symbol">)</a>

<a id="calculateStakeDistrs"></a><a id="2312" href="Ledger.Conway.Conformance.Chain.html#2312" class="Function">calculateStakeDistrs</a> <a id="2333" class="Symbol">:</a> <a id="2335" href="Ledger.Conway.Conformance.Ledger.html#723" class="Record">LState</a> <a id="2342" class="Symbol">→</a> <a id="2344" href="Ledger.Conway.Ratify.html#2949" class="Record">StakeDistrs</a>
<a id="2356" href="Ledger.Conway.Conformance.Chain.html#2312" class="Function">calculateStakeDistrs</a> <a id="2377" href="Ledger.Conway.Conformance.Chain.html#2377" class="Bound">ls</a> <a id="2380" class="Symbol">=</a>
  <a id="2384" class="Keyword">let</a> <a id="2388" class="Keyword">open</a> <a id="2393" href="Ledger.Conway.Conformance.Ledger.html#723" class="Module">LState</a> <a id="2400" href="Ledger.Conway.Conformance.Chain.html#2377" class="Bound">ls</a><a id="2402" class="Symbol">;</a> <a id="2404" class="Keyword">open</a> <a id="2409" href="Ledger.Conway.Conformance.Certs.html#930" class="Module">CertState</a> <a id="2419" href="Ledger.Conway.Conformance.Ledger.html#831" class="Field">certState</a><a id="2428" class="Symbol">;</a> <a id="2430" class="Keyword">open</a> <a id="2435" href="Ledger.Conway.Certs.html#3777" class="Module">PState</a> <a id="2442" href="Ledger.Conway.Conformance.Certs.html#1009" class="Function">pState</a>
      <a id="2455" class="Keyword">open</a> <a id="2460" href="Ledger.Conway.Utxo.html#2715" class="Module">UTxOState</a> <a id="2470" href="Ledger.Conway.Conformance.Ledger.html#778" class="Field">utxoSt</a><a id="2476" class="Symbol">;</a> <a id="2478" class="Keyword">open</a> <a id="2483" href="Ledger.Conway.Conformance.Certs.html#557" class="Module">DState</a> <a id="2490" href="Ledger.Conway.Conformance.Certs.html#989" class="Function">dState</a>
      <a id="2503" href="Ledger.Conway.Conformance.Chain.html#2503" class="Bound">spoDelegs</a> <a id="2513" class="Symbol">=</a> <a id="2515" href="Class.HasEmptySet.html#287" class="Field">∅</a> <a id="2517" class="Comment">-- TODO</a>
      <a id="2531" href="Ledger.Conway.Conformance.Chain.html#2531" class="Bound">drepDelegs</a> <a id="2542" class="Symbol">=</a> <a id="2544" href="Class.HasEmptySet.html#287" class="Field">∅</a> <a id="2546" class="Comment">-- TODO</a>
  <a id="2556" class="Keyword">in</a>
  <a id="2561" class="Keyword">record</a>
    <a id="2572" class="Symbol">{</a> <a id="2574" href="Ledger.Conway.Ratify.html#2986" class="Field">stakeDistr</a> <a id="2585" class="Symbol">=</a> <a id="2587" href="Ledger.Conway.Conformance.Chain.html#1852" class="Function">govActionDeposits</a> <a id="2605" href="Ledger.Conway.Conformance.Chain.html#2377" class="Bound">ls</a>
    <a id="2612" class="Symbol">}</a>


<a id="2616" class="Keyword">data</a>

  <a id="_⊢_⇀⦇_,CHAIN⦈_"></a><a id="2624" href="Ledger.Conway.Conformance.Chain.html#2624" class="Datatype Operator">_⊢_⇀⦇_,CHAIN⦈_</a> <a id="2639" class="Symbol">:</a> <a id="2641" href="Agda.Builtin.Unit.html#175" class="Record">⊤</a> <a id="2643" class="Symbol">→</a> <a id="2645" href="Ledger.Conway.Conformance.Chain.html#673" class="Record">ChainState</a> <a id="2656" class="Symbol">→</a> <a id="2658" href="Ledger.Conway.Conformance.Chain.html#750" class="Record">Block</a> <a id="2664" class="Symbol">→</a> <a id="2666" href="Ledger.Conway.Conformance.Chain.html#673" class="Record">ChainState</a> <a id="2677" class="Symbol">→</a> <a id="2679" href="Agda.Primitive.html#388" class="Primitive">Type</a>

  <a id="2687" class="Keyword">where</a>

  <a id="_⊢_⇀⦇_,CHAIN⦈_.CHAIN"></a><a id="2696" href="Ledger.Conway.Conformance.Chain.html#2696" class="InductiveConstructor">CHAIN</a> <a id="2702" class="Symbol">:</a>
    <a id="2708" class="Keyword">let</a> <a id="2712" class="Keyword">open</a> <a id="2717" href="Ledger.Conway.Conformance.Chain.html#673" class="Module">ChainState</a> <a id="2728" href="Ledger.Conway.Conformance.Chain.html#836" class="Generalizable">s</a><a id="2729" class="Symbol">;</a> <a id="2731" class="Keyword">open</a> <a id="2736" href="Ledger.Conway.Conformance.Chain.html#750" class="Module">Block</a> <a id="2742" href="Ledger.Conway.Conformance.Chain.html#853" class="Generalizable">b</a><a id="2743" class="Symbol">;</a> <a id="2745" class="Keyword">open</a> <a id="2750" href="Ledger.Conway.Conformance.Epoch.html#1293" class="Module">NewEpochState</a> <a id="2764" href="Ledger.Conway.Conformance.Chain.html#880" class="Generalizable">nes</a>
        <a id="2776" class="Keyword">open</a> <a id="2781" href="Ledger.Conway.Conformance.Epoch.html#1095" class="Module">EpochState</a> <a id="2792" href="Ledger.Conway.Conformance.Epoch.html#1356" class="Function">epochState</a><a id="2802" class="Symbol">;</a> <a id="2804" class="Keyword">open</a> <a id="2809" href="Ledger.Conway.Enact.html#418" class="Module">EnactState</a> <a id="2820" href="Ledger.Conway.Conformance.Epoch.html#1232" class="Function">es</a>
    <a id="2827" class="Keyword">in</a>
       <a id="2837" class="Symbol">_</a> <a id="2839" href="Ledger.Conway.Conformance.Epoch.html#6577" class="Datatype Operator">⊢</a> <a id="2841" href="Ledger.Conway.Conformance.Chain.html#711" class="Function">newEpochState</a> <a id="2855" href="Ledger.Conway.Conformance.Epoch.html#6577" class="Datatype Operator">⇀⦇</a> <a id="2858" href="Ledger.Conway.Types.Epoch.html#804" class="Function">epoch</a> <a id="2864" href="Ledger.Conway.Conformance.Chain.html#803" class="Function">slot</a> <a id="2869" href="Ledger.Conway.Conformance.Epoch.html#6577" class="Datatype Operator">,NEWEPOCH⦈</a> <a id="2880" href="Ledger.Conway.Conformance.Chain.html#880" class="Generalizable">nes</a>
    <a id="2888" class="Symbol">→</a>  <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.Conway.Conformance.Chain.html#803}{\htmlId{2893}{\htmlClass{Function}{\text{slot}}}}\, \\ \,\href{Ledger.Prelude.html#2648}{\htmlId{2900}{\htmlClass{Function Operator}{\text{∣}}}}\, \,\href{Ledger.Conway.Enact.html#523}{\htmlId{2902}{\htmlClass{Function}{\text{constitution}}}}\, \,\href{Ledger.Prelude.html#2648}{\htmlId{2915}{\htmlClass{Function Operator}{\text{∣}}}}\, \\ \,\href{Ledger.Prelude.html#2648}{\htmlId{2919}{\htmlClass{Function Operator}{\text{∣}}}}\, \,\href{Ledger.Conway.Enact.html#628}{\htmlId{2921}{\htmlClass{Function}{\text{pparams}}}}\, \,\href{Ledger.Prelude.html#2648}{\htmlId{2929}{\htmlClass{Function Operator}{\text{∣}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#1232}{\htmlId{2933}{\htmlClass{Function}{\text{es}}}}\, \\ \,\href{Ledger.Conway.PParams.html#741}{\htmlId{2938}{\htmlClass{Field}{\text{Acnt.treasury}}}}\, \,\href{Ledger.Conway.Conformance.Epoch.html#1159}{\htmlId{2952}{\htmlClass{Function}{\text{acnt}}}}\,
       \end{pmatrix}$</a> <a id="2966" href="Ledger.Conway.Conformance.Ledger.html#2203" class="Function Operator">⊢</a> <a id="2968" href="Ledger.Conway.Conformance.Epoch.html#1208" class="Function">ls</a> <a id="2971" href="Ledger.Conway.Conformance.Ledger.html#2203" class="Function Operator">⇀⦇</a> <a id="2974" href="Ledger.Conway.Conformance.Chain.html#783" class="Function">ts</a> <a id="2977" href="Ledger.Conway.Conformance.Ledger.html#2203" class="Function Operator">,LEDGERS⦈</a> <a id="2987" href="Ledger.Conway.Conformance.Chain.html#865" class="Generalizable">ls&#39;</a>
    <a id="2995" href="iog-prelude.Prelude.InferenceRules.html#217" class="Function Operator">────────────────────────────────</a>
    <a id="3032" class="Symbol">_</a> <a id="3034" href="Ledger.Conway.Conformance.Chain.html#2624" class="Datatype Operator">⊢</a> <a id="3036" href="Ledger.Conway.Conformance.Chain.html#836" class="Generalizable">s</a> <a id="3038" href="Ledger.Conway.Conformance.Chain.html#2624" class="Datatype Operator">⇀⦇</a> <a id="3041" href="Ledger.Conway.Conformance.Chain.html#853" class="Generalizable">b</a> <a id="3043" href="Ledger.Conway.Conformance.Chain.html#2624" class="Datatype Operator">,CHAIN⦈</a>
        <a id="3059" class="Keyword">record</a> <a id="3066" href="Ledger.Conway.Conformance.Chain.html#836" class="Generalizable">s</a> <a id="3068" class="Symbol">{</a> <a id="3070" href="Ledger.Conway.Conformance.Chain.html#711" class="Field">newEpochState</a> <a id="3084" class="Symbol">=</a> <a id="3086" class="Keyword">record</a> <a id="3093" href="Ledger.Conway.Conformance.Chain.html#880" class="Generalizable">nes</a> <a id="3097" class="Symbol">{</a> <a id="3099" href="Ledger.Conway.Conformance.Epoch.html#1356" class="Field">epochState</a> <a id="3110" class="Symbol">=</a> <a id="3112" class="Keyword">record</a> <a id="3119" href="Ledger.Conway.Conformance.Epoch.html#1356" class="Function">epochState</a> <a id="3130" class="Symbol">{</a> <a id="3132" href="Ledger.Conway.Conformance.Epoch.html#1208" class="Field">ls</a> <a id="3135" class="Symbol">=</a> <a id="3137" href="Ledger.Conway.Conformance.Chain.html#865" class="Generalizable">ls&#39;</a><a id="3140" class="Symbol">}</a> <a id="3142" class="Symbol">}</a> <a id="3144" class="Symbol">}</a>
</pre></body></html>