<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>Ledger.Conway.Conformance.Chain</title><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.css"><link rel="stylesheet" href="Agda.css"><script src="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.js"></script><script src="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/contrib/auto-render.min.js"></script><script src="AgdaKaTeX.js" defer=""></script></head><body><pre class="Agda">
<a id="2" class="Symbol">{-#</a> <a id="6" class="Keyword">OPTIONS</a> <a id="14" class="Pragma">--safe</a> <a id="21" class="Symbol">#-}</a>

<a id="26" class="Keyword">open</a> <a id="31" class="Keyword">import</a> <a id="38" href="Ledger.Core.Specification.Abstract.html" class="Module">Ledger.Core.Specification.Abstract</a>
<a id="73" class="Keyword">open</a> <a id="78" class="Keyword">import</a> <a id="85" href="Ledger.Core.Specification.Transaction.html" class="Module">Ledger.Core.Specification.Transaction</a>

<a id="124" class="Keyword">module</a> <a id="131" href="Ledger.Conway.Conformance.Chain.html" class="Module">Ledger.Conway.Conformance.Chain</a>
  <a id="165" class="Symbol">(</a><a id="166" href="Ledger.Conway.Conformance.Chain.html#166" class="Bound">txs</a> <a id="170" class="Symbol">:</a> <a id="172" href="Ledger.Core.Specification.Transaction.html#896" class="Record">TransactionStructure</a><a id="192" class="Symbol">)</a> <a id="194" class="Symbol">(</a><a id="195" class="Keyword">open</a> <a id="200" href="Ledger.Core.Specification.Transaction.html#896" class="Module">TransactionStructure</a> <a id="221" href="Ledger.Conway.Conformance.Chain.html#166" class="Bound">txs</a><a id="224" class="Symbol">)</a>
  <a id="228" class="Symbol">(</a><a id="229" href="Ledger.Conway.Conformance.Chain.html#229" class="Bound">abs</a> <a id="233" class="Symbol">:</a> <a id="235" href="Ledger.Core.Specification.Abstract.html#826" class="Record">AbstractFunctions</a> <a id="253" href="Ledger.Conway.Conformance.Chain.html#166" class="Bound">txs</a><a id="256" class="Symbol">)</a>
  <a id="260" class="Keyword">where</a>

<a id="267" class="Keyword">open</a> <a id="272" class="Keyword">import</a> <a id="279" href="Data.Nat.Properties.html" class="Module">Data.Nat.Properties</a> <a id="299" class="Keyword">using</a> <a id="305" class="Symbol">(</a><a id="306" href="Data.Nat.Properties.html#17566" class="Function">+-0-monoid</a><a id="316" class="Symbol">)</a>

<a id="319" class="Keyword">open</a> <a id="324" class="Keyword">import</a> <a id="331" href="Ledger.Prelude.html" class="Module">Ledger.Prelude</a>

<a id="347" class="Keyword">open</a> <a id="352" class="Keyword">import</a> <a id="359" href="Ledger.Conway.Conformance.Certs.html" class="Module">Ledger.Conway.Conformance.Certs</a> <a id="391" href="Ledger.Core.Specification.Transaction.html#1970" class="Function">govStructure</a>
<a id="404" class="Keyword">open</a> <a id="409" class="Keyword">import</a> <a id="416" href="Ledger.Conway.Conformance.Epoch.html" class="Module">Ledger.Conway.Conformance.Epoch</a> <a id="448" href="Ledger.Conway.Conformance.Chain.html#166" class="Bound">txs</a> <a id="452" href="Ledger.Conway.Conformance.Chain.html#229" class="Bound">abs</a>
<a id="456" class="Keyword">open</a> <a id="461" class="Keyword">import</a> <a id="468" href="Ledger.Conway.Conformance.Ledger.html" class="Module">Ledger.Conway.Conformance.Ledger</a> <a id="501" href="Ledger.Conway.Conformance.Chain.html#166" class="Bound">txs</a> <a id="505" href="Ledger.Conway.Conformance.Chain.html#229" class="Bound">abs</a>
<a id="509" class="Keyword">open</a> <a id="514" class="Keyword">import</a> <a id="521" href="Ledger.Conway.Conformance.Utxo.html" class="Module">Ledger.Conway.Conformance.Utxo</a> <a id="552" href="Ledger.Conway.Conformance.Chain.html#166" class="Bound">txs</a> <a id="556" href="Ledger.Conway.Conformance.Chain.html#229" class="Bound">abs</a>

<a id="561" class="Keyword">open</a> <a id="566" class="Keyword">import</a> <a id="573" href="Ledger.Conway.Specification.Enact.html" class="Module">Ledger.Conway.Specification.Enact</a> <a id="607" href="Ledger.Core.Specification.Transaction.html#1970" class="Function">govStructure</a>
<a id="620" class="Keyword">open</a> <a id="625" class="Keyword">import</a> <a id="632" href="Ledger.Conway.Specification.Transaction.html" class="Module">Ledger.Conway.Specification.Transaction</a> <a id="672" href="Ledger.Conway.Conformance.Chain.html#166" class="Bound">txs</a> <a id="676" href="Ledger.Conway.Conformance.Chain.html#229" class="Bound">abs</a>

<a id="681" class="Keyword">open</a> <a id="686" href="Function.Bundles.html#4750" class="Module">Equivalence</a>

<a id="699" class="Keyword">record</a> <a id="ChainState"></a><a id="706" href="Ledger.Conway.Conformance.Chain.html#706" class="Record">ChainState</a> <a id="717" class="Symbol">:</a> <a id="719" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="724" class="Keyword">where</a>

  <a id="733" class="Keyword">field</a>

    <a id="ChainState.newEpochState"></a><a id="744" href="Ledger.Conway.Conformance.Chain.html#744" class="Field">newEpochState</a>  <a id="759" class="Symbol">:</a> <a id="761" href="Ledger.Conway.Conformance.Epoch.html#1388" class="Record">NewEpochState</a>

<a id="776" class="Keyword">record</a> <a id="Block"></a><a id="783" href="Ledger.Conway.Conformance.Chain.html#783" class="Record">Block</a> <a id="789" class="Symbol">:</a> <a id="791" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="796" class="Keyword">where</a>

  <a id="805" class="Keyword">field</a>

    <a id="Block.ts"></a><a id="816" href="Ledger.Conway.Conformance.Chain.html#816" class="Field">ts</a>    <a id="822" class="Symbol">:</a> <a id="824" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="829" href="Ledger.Conway.Specification.Transaction.html#1719" class="Record">Tx</a>
    <a id="Block.slot"></a><a id="836" href="Ledger.Conway.Conformance.Chain.html#836" class="Field">slot</a>  <a id="842" class="Symbol">:</a> <a id="844" href="Ledger.Core.Specification.Epoch.html#722" class="Function">Slot</a>

<a id="850" class="Keyword">private</a> <a id="858" class="Keyword">variable</a>
  <a id="869" href="Ledger.Conway.Conformance.Chain.html#869" class="Generalizable">s</a> <a id="871" class="Symbol">:</a> <a id="873" href="Ledger.Conway.Conformance.Chain.html#706" class="Record">ChainState</a>
  <a id="886" href="Ledger.Conway.Conformance.Chain.html#886" class="Generalizable">b</a> <a id="888" class="Symbol">:</a> <a id="890" href="Ledger.Conway.Conformance.Chain.html#783" class="Record">Block</a>
  <a id="898" href="Ledger.Conway.Conformance.Chain.html#898" class="Generalizable">ls&#39;</a> <a id="902" class="Symbol">:</a> <a id="904" href="Ledger.Conway.Conformance.Ledger.html#738" class="Record">LState</a>
  <a id="913" href="Ledger.Conway.Conformance.Chain.html#913" class="Generalizable">nes</a> <a id="917" class="Symbol">:</a> <a id="919" href="Ledger.Conway.Conformance.Epoch.html#1388" class="Record">NewEpochState</a>

<a id="934" class="Keyword">instance</a> <a id="943" href="Ledger.Conway.Conformance.Chain.html#943" class="Function">_</a> <a id="945" class="Symbol">=</a> <a id="947" href="Data.Nat.Properties.html#17566" class="Function">+-0-monoid</a>

<a id="959" class="Comment">-- TODO: do we still need this for anything?</a>
<a id="maybePurpose"></a><a id="1004" href="Ledger.Conway.Conformance.Chain.html#1004" class="Function">maybePurpose</a> <a id="1017" class="Symbol">:</a> <a id="1019" href="Ledger.Core.Specification.Certs.html#534" class="Datatype">DepositPurpose</a> <a id="1034" class="Symbol">→</a> <a id="1036" class="Symbol">(</a><a id="1037" href="Ledger.Core.Specification.Certs.html#534" class="Datatype">DepositPurpose</a> <a id="1052" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="1054" href="Ledger.Core.Specification.Address.html#259" class="Datatype">Credential</a><a id="1064" class="Symbol">)</a> <a id="1066" class="Symbol">→</a> <a id="1068" href="Ledger.Prelude.Base.html#154" class="Function">Coin</a> <a id="1073" class="Symbol">→</a> <a id="1075" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="1081" href="Ledger.Prelude.Base.html#154" class="Function">Coin</a>
<a id="1086" href="Ledger.Conway.Conformance.Chain.html#1004" class="Function">maybePurpose</a> <a id="1099" href="Ledger.Conway.Conformance.Chain.html#1099" class="Bound">prps</a> <a id="1104" class="Symbol">(</a><a id="1105" href="Ledger.Conway.Conformance.Chain.html#1105" class="Bound">prps&#39;</a> <a id="1111" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1113" class="Symbol">_)</a> <a id="1116" href="Ledger.Conway.Conformance.Chain.html#1116" class="Bound">c</a> <a id="1118" class="Keyword">with</a> <a id="1123" href="Ledger.Conway.Conformance.Chain.html#1099" class="Bound">prps</a> <a id="1128" href="Class.DecEq.Core.html#168" class="Field Operator">≟</a> <a id="1130" href="Ledger.Conway.Conformance.Chain.html#1105" class="Bound">prps&#39;</a>
<a id="1136" class="Symbol">...</a> <a id="1140" class="Symbol">|</a> <a id="1142" href="Relation.Nullary.Decidable.Core.html#2099" class="InductiveConstructor">yes</a> <a id="1146" class="Symbol">_</a> <a id="1148" class="Symbol">=</a> <a id="1150" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="1155" class="Bound">c</a>
<a id="1157" class="Symbol">...</a> <a id="1161" class="Symbol">|</a> <a id="1163" href="Relation.Nullary.Decidable.Core.html#2136" class="InductiveConstructor">no</a> <a id="1166" class="Symbol">_</a> <a id="1168" class="Symbol">=</a> <a id="1170" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a>

<a id="maybePurpose-prop"></a><a id="1179" href="Ledger.Conway.Conformance.Chain.html#1179" class="Function">maybePurpose-prop</a> <a id="1197" class="Symbol">:</a> <a id="1199" class="Symbol">∀</a> <a id="1201" class="Symbol">{</a><a id="1202" href="Ledger.Conway.Conformance.Chain.html#1202" class="Bound">prps</a><a id="1206" class="Symbol">}</a> <a id="1208" class="Symbol">{</a><a id="1209" href="Ledger.Conway.Conformance.Chain.html#1209" class="Bound">x</a><a id="1210" class="Symbol">}</a> <a id="1212" class="Symbol">{</a><a id="1213" href="Ledger.Conway.Conformance.Chain.html#1213" class="Bound">y</a><a id="1214" class="Symbol">}</a>
  <a id="1218" class="Symbol">→</a> <a id="1220" class="Symbol">(</a><a id="1221" href="Ledger.Conway.Conformance.Chain.html#1221" class="Bound">m</a> <a id="1223" class="Symbol">:</a> <a id="1225" class="Symbol">(</a><a id="1226" href="Ledger.Core.Specification.Certs.html#534" class="Datatype">DepositPurpose</a> <a id="1241" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="1243" href="Ledger.Core.Specification.Address.html#259" class="Datatype">Credential</a><a id="1253" class="Symbol">)</a> <a id="1255" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="1257" href="Ledger.Prelude.Base.html#154" class="Function">Coin</a><a id="1261" class="Symbol">)</a>
  <a id="1265" class="Symbol">→</a> <a id="1267" class="Symbol">(</a><a id="1268" href="Ledger.Conway.Conformance.Chain.html#1209" class="Bound">x</a> <a id="1270" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1272" href="Ledger.Conway.Conformance.Chain.html#1213" class="Bound">y</a><a id="1273" class="Symbol">)</a> <a id="1275" href="Class.IsSet.html#458" class="Function Operator">∈</a> <a id="1277" href="Class.IsSet.html#916" class="Function">dom</a> <a id="1281" class="Symbol">((</a><a id="1283" href="Axiom.Set.Map.html#13171" class="Function">mapMaybeWithKeyᵐ</a> <a id="1300" class="Symbol">(</a><a id="1301" href="Ledger.Conway.Conformance.Chain.html#1004" class="Function">maybePurpose</a> <a id="1314" href="Ledger.Conway.Conformance.Chain.html#1202" class="Bound">prps</a><a id="1318" class="Symbol">)</a> <a id="1320" href="Ledger.Conway.Conformance.Chain.html#1221" class="Bound">m</a><a id="1321" class="Symbol">)</a> <a id="1323" href="Axiom.Set.Map.html#2293" class="Function Operator">ˢ</a><a id="1324" class="Symbol">)</a>
  <a id="1328" class="Symbol">→</a> <a id="1330" href="Ledger.Conway.Conformance.Chain.html#1209" class="Bound">x</a> <a id="1332" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="1334" href="Ledger.Conway.Conformance.Chain.html#1202" class="Bound">prps</a>
<a id="1339" href="Ledger.Conway.Conformance.Chain.html#1179" class="Function">maybePurpose-prop</a> <a id="1357" class="Symbol">{</a><a id="1358" class="Argument">prps</a> <a id="1363" class="Symbol">=</a> <a id="1365" href="Ledger.Conway.Conformance.Chain.html#1365" class="Bound">prps</a><a id="1369" class="Symbol">}</a> <a id="1371" class="Symbol">{</a><a id="1372" href="Ledger.Conway.Conformance.Chain.html#1372" class="Bound">x</a><a id="1373" class="Symbol">}</a> <a id="1375" class="Symbol">{</a><a id="1376" href="Ledger.Conway.Conformance.Chain.html#1376" class="Bound">y</a><a id="1377" class="Symbol">}</a> <a id="1379" class="Symbol">_</a> <a id="1381" href="Ledger.Conway.Conformance.Chain.html#1381" class="Bound">xy∈dom</a> <a id="1388" class="Keyword">with</a> <a id="1393" href="Function.Bundles.html#4832" class="Field">from</a> <a id="1398" href="Axiom.Set.Rel.html#2687" class="Function">dom∈</a> <a id="1403" href="Ledger.Conway.Conformance.Chain.html#1381" class="Bound">xy∈dom</a>
<a id="1410" class="Symbol">...</a> <a id="1414" class="Symbol">|</a> <a id="1416" href="Ledger.Conway.Conformance.Chain.html#1416" class="Bound">z</a> <a id="1418" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1420" href="Ledger.Conway.Conformance.Chain.html#1420" class="Bound">∈mmwk</a> <a id="1426" class="Keyword">with</a> <a id="1431" class="Bound">prps</a> <a id="1436" href="Class.DecEq.Core.html#168" class="Field Operator">≟</a> <a id="1438" class="Bound">x</a> <a id="1440" class="Symbol">|</a> <a id="1442" href="Axiom.Set.Rel.html#6192" class="Function">∈-mapMaybeWithKey</a> <a id="1460" class="Symbol">{</a><a id="1461" class="Argument">f</a> <a id="1463" class="Symbol">=</a> <a id="1465" href="Ledger.Conway.Conformance.Chain.html#1004" class="Function">maybePurpose</a> <a id="1478" class="Bound">prps</a><a id="1482" class="Symbol">}</a> <a id="1484" href="Ledger.Conway.Conformance.Chain.html#1420" class="Bound">∈mmwk</a>
<a id="1490" class="Symbol">...</a> <a id="1494" class="Symbol">|</a> <a id="1496" href="Relation.Nullary.Decidable.Core.html#2099" class="InductiveConstructor">yes</a> <a id="1500" href="Agda.Builtin.Equality.html#207" class="InductiveConstructor">refl</a> <a id="1505" class="Symbol">|</a> <a id="1507" class="Symbol">_</a> <a id="1509" class="Symbol">=</a> <a id="1511" href="Agda.Builtin.Equality.html#207" class="InductiveConstructor">refl</a>

<a id="filterPurpose"></a><a id="1517" href="Ledger.Conway.Conformance.Chain.html#1517" class="Function">filterPurpose</a> <a id="1531" class="Symbol">:</a> <a id="1533" href="Ledger.Core.Specification.Certs.html#534" class="Datatype">DepositPurpose</a> <a id="1548" class="Symbol">→</a> <a id="1550" class="Symbol">(</a><a id="1551" href="Ledger.Core.Specification.Certs.html#534" class="Datatype">DepositPurpose</a> <a id="1566" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="1568" href="Ledger.Core.Specification.Address.html#259" class="Datatype">Credential</a><a id="1578" class="Symbol">)</a> <a id="1580" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="1582" href="Ledger.Prelude.Base.html#154" class="Function">Coin</a> <a id="1587" class="Symbol">→</a> <a id="1589" href="Ledger.Core.Specification.Address.html#259" class="Datatype">Credential</a> <a id="1600" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="1602" href="Ledger.Prelude.Base.html#154" class="Function">Coin</a>
<a id="1607" href="Ledger.Conway.Conformance.Chain.html#1517" class="Function">filterPurpose</a> <a id="1621" href="Ledger.Conway.Conformance.Chain.html#1621" class="Bound">prps</a> <a id="1626" href="Ledger.Conway.Conformance.Chain.html#1626" class="Bound">m</a> <a id="1628" class="Symbol">=</a> <a id="1630" href="Axiom.Set.Map.html#6936" class="Function">mapKeys</a> <a id="1638" href="Data.Product.Base.html#650" class="Field">proj₂</a> <a id="1644" class="Symbol">(</a><a id="1645" href="Axiom.Set.Map.html#13171" class="Function">mapMaybeWithKeyᵐ</a> <a id="1662" class="Symbol">(</a><a id="1663" href="Ledger.Conway.Conformance.Chain.html#1004" class="Function">maybePurpose</a> <a id="1676" href="Ledger.Conway.Conformance.Chain.html#1621" class="Bound">prps</a><a id="1680" class="Symbol">)</a> <a id="1682" href="Ledger.Conway.Conformance.Chain.html#1626" class="Bound">m</a><a id="1683" class="Symbol">)</a>
  <a id="1687" class="Symbol">{λ</a> <a id="1690" class="Keyword">where</a> <a id="1696" href="Ledger.Conway.Conformance.Chain.html#1696" class="Bound">x∈dom</a> <a id="1702" href="Ledger.Conway.Conformance.Chain.html#1702" class="Bound">y∈dom</a> <a id="1708" href="Agda.Builtin.Equality.html#207" class="InductiveConstructor">refl</a> <a id="1713" class="Symbol">→</a> <a id="1715" href="Relation.Binary.PropositionalEquality.Core.html#1481" class="Function">cong</a> <a id="1720" class="Symbol">(</a><a id="1721" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">_,</a> <a id="1724" class="Symbol">_)</a>
                            <a id="1755" href="Function.Base.html#1993" class="Function Operator">$</a> <a id="1757" href="Relation.Binary.PropositionalEquality.Core.html#2080" class="Function">trans</a> <a id="1763" class="Symbol">(</a><a id="1764" href="Ledger.Conway.Conformance.Chain.html#1179" class="Function">maybePurpose-prop</a> <a id="1782" class="Symbol">{</a><a id="1783" class="Argument">prps</a> <a id="1788" class="Symbol">=</a> <a id="1790" href="Ledger.Conway.Conformance.Chain.html#1621" class="Bound">prps</a><a id="1794" class="Symbol">}</a> <a id="1796" href="Ledger.Conway.Conformance.Chain.html#1626" class="Bound">m</a> <a id="1798" href="Ledger.Conway.Conformance.Chain.html#1696" class="Bound">x∈dom</a><a id="1803" class="Symbol">)</a>
                            <a id="1833" href="Function.Base.html#1993" class="Function Operator">$</a> <a id="1835" href="Relation.Binary.PropositionalEquality.Core.html#2035" class="Function">sym</a>   <a id="1841" class="Symbol">(</a><a id="1842" href="Ledger.Conway.Conformance.Chain.html#1179" class="Function">maybePurpose-prop</a> <a id="1860" class="Symbol">{</a><a id="1861" class="Argument">prps</a> <a id="1866" class="Symbol">=</a> <a id="1868" href="Ledger.Conway.Conformance.Chain.html#1621" class="Bound">prps</a><a id="1872" class="Symbol">}</a> <a id="1874" href="Ledger.Conway.Conformance.Chain.html#1626" class="Bound">m</a> <a id="1876" href="Ledger.Conway.Conformance.Chain.html#1702" class="Bound">y∈dom</a><a id="1881" class="Symbol">)}</a>

<a id="govActionDeposits"></a><a id="1885" href="Ledger.Conway.Conformance.Chain.html#1885" class="Function">govActionDeposits</a> <a id="1903" class="Symbol">:</a> <a id="1905" href="Ledger.Conway.Conformance.Ledger.html#738" class="Record">LState</a> <a id="1912" class="Symbol">→</a> <a id="1914" href="Ledger.Core.Specification.Gov.Actions.html#2566" class="Datatype">VDeleg</a> <a id="1921" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="1923" href="Ledger.Prelude.Base.html#154" class="Function">Coin</a>
<a id="1928" href="Ledger.Conway.Conformance.Chain.html#1885" class="Function">govActionDeposits</a> <a id="1946" href="Ledger.Conway.Conformance.Chain.html#1946" class="Bound">ls</a> <a id="1949" class="Symbol">=</a>
  <a id="1953" class="Keyword">let</a> <a id="1957" class="Keyword">open</a> <a id="1962" href="Ledger.Conway.Conformance.Ledger.html#738" class="Module">LState</a> <a id="1969" href="Ledger.Conway.Conformance.Chain.html#1946" class="Bound">ls</a><a id="1971" class="Symbol">;</a> <a id="1973" class="Keyword">open</a> <a id="1978" href="Ledger.Conway.Conformance.Certs.html#958" class="Module">CertState</a> <a id="1988" href="Ledger.Conway.Conformance.Ledger.html#846" class="Field">certState</a><a id="1997" class="Symbol">;</a> <a id="1999" class="Keyword">open</a> <a id="2004" href="Ledger.Core.Specification.Certs.html#3872" class="Module">PState</a> <a id="2011" href="Ledger.Conway.Conformance.Certs.html#1037" class="Function">pState</a>
      <a id="2024" class="Keyword">open</a> <a id="2029" href="Ledger.Conway.Specification.Utxo.html#1306" class="Module">UTxOState</a> <a id="2039" href="Ledger.Conway.Conformance.Ledger.html#793" class="Field">utxoSt</a><a id="2045" class="Symbol">;</a> <a id="2047" class="Keyword">open</a> <a id="2052" href="Ledger.Conway.Conformance.Certs.html#604" class="Module">DState</a> <a id="2059" href="Ledger.Conway.Conformance.Certs.html#1017" class="Function">dState</a>
   <a id="2069" class="Keyword">in</a> <a id="2072" href="Data.List.Base.html#4227" class="Function">foldl</a> <a id="2078" href="Axiom.Set.Map.Dec.html#2149" class="Function Operator">_∪⁺_</a> <a id="2083" href="Class.HasEmptySet.html#287" class="Field">∅</a> <a id="2085" href="Function.Base.html#1993" class="Function Operator">$</a> <a id="2087" href="abstract-set-theory.FiniteSetTheory.html#2617" class="Function">setToList</a> <a id="2097" href="Function.Base.html#1993" class="Function Operator">$</a>
    <a id="2103" href="Axiom.Set.html#7990" class="Function">mapPartial</a>
      <a id="2120" class="Symbol">(λ</a> <a id="2123" class="Keyword">where</a> <a id="2129" class="Symbol">(</a><a id="2130" href="Ledger.Conway.Conformance.Chain.html#2130" class="Bound">gaid</a> <a id="2135" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="2137" class="Keyword">record</a> <a id="2144" class="Symbol">{</a> <a id="2146" href="Ledger.Core.Specification.Gov.Actions.html#3885" class="Field">returnAddr</a> <a id="2157" class="Symbol">=</a> <a id="2159" class="Keyword">record</a> <a id="2166" class="Symbol">{</a><a id="2167" href="Ledger.Core.Specification.Address.html#1373" class="Field">stake</a> <a id="2173" class="Symbol">=</a> <a id="2175" href="Ledger.Conway.Conformance.Chain.html#2175" class="Bound">c</a><a id="2176" class="Symbol">}</a> <a id="2178" class="Symbol">})</a> <a id="2181" class="Symbol">→</a> <a id="2183" class="Keyword">do</a>
        <a id="2194" href="Ledger.Conway.Conformance.Chain.html#2194" class="Bound">vd</a> <a id="2197" href="Class.Monad.Core.html#337" class="Field Operator">←</a> <a id="2199" href="Axiom.Set.Map.html#17169" class="Function">lookupᵐ?</a> <a id="2208" href="Ledger.Conway.Conformance.Certs.html#661" class="Function">voteDelegs</a> <a id="2219" href="Ledger.Conway.Conformance.Chain.html#2175" class="Bound">c</a>
        <a id="2229" href="Ledger.Conway.Conformance.Chain.html#2229" class="Bound">dep</a> <a id="2233" href="Class.Monad.Core.html#337" class="Field Operator">←</a> <a id="2235" href="Axiom.Set.Map.html#17169" class="Function">lookupᵐ?</a> <a id="2244" class="Symbol">(</a><a id="2245" href="Ledger.Conway.Conformance.Certs.html#758" class="Field">DState.deposits</a> <a id="2261" href="Ledger.Conway.Conformance.Certs.html#1017" class="Function">dState</a><a id="2267" class="Symbol">)</a> <a id="2269" class="Symbol">(</a><a id="2270" href="Ledger.Core.Specification.Certs.html#723" class="InductiveConstructor">GovActionDeposit</a> <a id="2287" href="Ledger.Conway.Conformance.Chain.html#2130" class="Bound">gaid</a><a id="2291" class="Symbol">)</a>
        <a id="2301" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="2306" href="Class.HasSingleton.html#288" class="Field Operator">❴</a> <a id="2308" href="Ledger.Conway.Conformance.Chain.html#2194" class="Bound">vd</a> <a id="2311" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="2313" href="Ledger.Conway.Conformance.Chain.html#2229" class="Bound">dep</a> <a id="2317" href="Class.HasSingleton.html#288" class="Field Operator">❵</a> <a id="2319" class="Symbol">)</a>
      <a id="2327" class="Symbol">(</a><a id="2328" href="Axiom.Set.html#5903" class="Function">fromList</a> <a id="2337" href="Ledger.Conway.Conformance.Ledger.html#820" class="Field">govSt</a><a id="2342" class="Symbol">)</a>

<a id="2345" class="Keyword">data</a>

  <a id="_⊢_⇀⦇_,CHAIN⦈_"></a><a id="2353" href="Ledger.Conway.Conformance.Chain.html#2353" class="Datatype Operator">_⊢_⇀⦇_,CHAIN⦈_</a> <a id="2368" class="Symbol">:</a> <a id="2370" href="Agda.Builtin.Unit.html#175" class="Record">⊤</a> <a id="2372" class="Symbol">→</a> <a id="2374" href="Ledger.Conway.Conformance.Chain.html#706" class="Record">ChainState</a> <a id="2385" class="Symbol">→</a> <a id="2387" href="Ledger.Conway.Conformance.Chain.html#783" class="Record">Block</a> <a id="2393" class="Symbol">→</a> <a id="2395" href="Ledger.Conway.Conformance.Chain.html#706" class="Record">ChainState</a> <a id="2406" class="Symbol">→</a> <a id="2408" href="Agda.Primitive.html#388" class="Primitive">Type</a>

  <a id="2416" class="Keyword">where</a>

  <a id="_⊢_⇀⦇_,CHAIN⦈_.CHAIN"></a><a id="2425" href="Ledger.Conway.Conformance.Chain.html#2425" class="InductiveConstructor">CHAIN</a> <a id="2431" class="Symbol">:</a>
    <a id="2437" class="Keyword">let</a> <a id="2441" class="Keyword">open</a> <a id="2446" href="Ledger.Conway.Conformance.Chain.html#706" class="Module">ChainState</a> <a id="2457" href="Ledger.Conway.Conformance.Chain.html#869" class="Generalizable">s</a><a id="2458" class="Symbol">;</a> <a id="2460" class="Keyword">open</a> <a id="2465" href="Ledger.Conway.Conformance.Chain.html#783" class="Module">Block</a> <a id="2471" href="Ledger.Conway.Conformance.Chain.html#886" class="Generalizable">b</a><a id="2472" class="Symbol">;</a> <a id="2474" class="Keyword">open</a> <a id="2479" href="Ledger.Conway.Conformance.Epoch.html#1388" class="Module">NewEpochState</a> <a id="2493" href="Ledger.Conway.Conformance.Chain.html#913" class="Generalizable">nes</a>
        <a id="2505" class="Keyword">open</a> <a id="2510" href="Ledger.Conway.Conformance.Epoch.html#1127" class="Module">EpochState</a> <a id="2521" href="Ledger.Conway.Conformance.Epoch.html#1509" class="Function">epochState</a><a id="2531" class="Symbol">;</a> <a id="2533" class="Keyword">open</a> <a id="2538" href="Ledger.Conway.Specification.Enact.html#444" class="Module">EnactState</a> <a id="2549" href="Ledger.Conway.Conformance.Epoch.html#1264" class="Function">es</a>
    <a id="2556" class="Keyword">in</a>
       <a id="2566" class="Symbol">_</a> <a id="2568" href="Ledger.Conway.Conformance.Epoch.html#7297" class="Datatype Operator">⊢</a> <a id="2570" href="Ledger.Conway.Conformance.Chain.html#744" class="Function">newEpochState</a> <a id="2584" href="Ledger.Conway.Conformance.Epoch.html#7297" class="Datatype Operator">⇀⦇</a> <a id="2587" href="Ledger.Core.Specification.Epoch.html#858" class="Function">epoch</a> <a id="2593" href="Ledger.Conway.Conformance.Chain.html#836" class="Function">slot</a> <a id="2598" href="Ledger.Conway.Conformance.Epoch.html#7297" class="Datatype Operator">,NEWEPOCH⦈</a> <a id="2609" href="Ledger.Conway.Conformance.Chain.html#913" class="Generalizable">nes</a>
    <a id="2617" class="Symbol">→</a>  <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.Conway.Conformance.Chain.html#836}{\htmlId{2622}{\htmlClass{Function}{\text{slot}}}}\, \\ \,\href{Ledger.Prelude.html#2302}{\htmlId{2629}{\htmlClass{Function Operator}{\text{∣}}}}\, \,\href{Ledger.Conway.Specification.Enact.html#549}{\htmlId{2631}{\htmlClass{Function}{\text{constitution}}}}\, \,\href{Ledger.Prelude.html#2302}{\htmlId{2644}{\htmlClass{Function Operator}{\text{∣}}}}\, \\ \,\href{Ledger.Prelude.html#2302}{\htmlId{2648}{\htmlClass{Function Operator}{\text{∣}}}}\, \,\href{Ledger.Conway.Specification.Enact.html#654}{\htmlId{2650}{\htmlClass{Function}{\text{pparams}}}}\, \,\href{Ledger.Prelude.html#2302}{\htmlId{2658}{\htmlClass{Function Operator}{\text{∣}}}}\, \\ \,\href{Ledger.Conway.Conformance.Epoch.html#1264}{\htmlId{2662}{\htmlClass{Function}{\text{es}}}}\, \\ \,\href{Ledger.Conway.Specification.PParams.html#773}{\htmlId{2667}{\htmlClass{Field}{\text{Acnt.treasury}}}}\, \,\href{Ledger.Conway.Conformance.Epoch.html#1191}{\htmlId{2681}{\htmlClass{Function}{\text{acnt}}}}\,
       \end{pmatrix}$</a> <a id="2695" href="Ledger.Conway.Conformance.Ledger.html#2228" class="Function Operator">⊢</a> <a id="2697" href="Ledger.Conway.Conformance.Epoch.html#1240" class="Function">ls</a> <a id="2700" href="Ledger.Conway.Conformance.Ledger.html#2228" class="Function Operator">⇀⦇</a> <a id="2703" href="Ledger.Conway.Conformance.Chain.html#816" class="Function">ts</a> <a id="2706" href="Ledger.Conway.Conformance.Ledger.html#2228" class="Function Operator">,LEDGERS⦈</a> <a id="2716" href="Ledger.Conway.Conformance.Chain.html#898" class="Generalizable">ls&#39;</a>
    <a id="2724" href="Prelude.InferenceRules.html#13694" class="Function Operator">────────────────────────────────</a>
    <a id="2761" class="Symbol">_</a> <a id="2763" href="Ledger.Conway.Conformance.Chain.html#2353" class="Datatype Operator">⊢</a> <a id="2765" href="Ledger.Conway.Conformance.Chain.html#869" class="Generalizable">s</a> <a id="2767" href="Ledger.Conway.Conformance.Chain.html#2353" class="Datatype Operator">⇀⦇</a> <a id="2770" href="Ledger.Conway.Conformance.Chain.html#886" class="Generalizable">b</a> <a id="2772" href="Ledger.Conway.Conformance.Chain.html#2353" class="Datatype Operator">,CHAIN⦈</a>
        <a id="2788" class="Keyword">record</a> <a id="2795" href="Ledger.Conway.Conformance.Chain.html#869" class="Generalizable">s</a> <a id="2797" class="Symbol">{</a> <a id="2799" href="Ledger.Conway.Conformance.Chain.html#744" class="Field">newEpochState</a> <a id="2813" class="Symbol">=</a> <a id="2815" class="Keyword">record</a> <a id="2822" href="Ledger.Conway.Conformance.Chain.html#913" class="Generalizable">nes</a> <a id="2826" class="Symbol">{</a> <a id="2828" href="Ledger.Conway.Conformance.Epoch.html#1509" class="Field">epochState</a> <a id="2839" class="Symbol">=</a> <a id="2841" class="Keyword">record</a> <a id="2848" href="Ledger.Conway.Conformance.Epoch.html#1509" class="Function">epochState</a> <a id="2859" class="Symbol">{</a> <a id="2861" href="Ledger.Conway.Conformance.Epoch.html#1240" class="Field">ls</a> <a id="2864" class="Symbol">=</a> <a id="2866" href="Ledger.Conway.Conformance.Chain.html#898" class="Generalizable">ls&#39;</a><a id="2869" class="Symbol">}</a> <a id="2871" class="Symbol">}</a> <a id="2873" class="Symbol">}</a>
</pre></body></html>