<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>Ledger.Conway.Specification.Fees</title><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.css"><link rel="stylesheet" href="Agda.css"><script src="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.js"></script><script src="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/contrib/auto-render.min.js"></script><script src="AgdaKaTeX.js" defer=""></script></head><body><pre class="Agda">
<a id="2" class="Symbol">{-#</a> <a id="6" class="Keyword">OPTIONS</a> <a id="14" class="Pragma">--safe</a> <a id="21" class="Symbol">#-}</a>

<a id="26" class="Keyword">open</a> <a id="31" class="Keyword">import</a> <a id="38" href="Ledger.Prelude.html" class="Module">Ledger.Prelude</a> <a id="53" class="Keyword">hiding</a> <a id="60" class="Symbol">(</a><a id="61" href="Data.Nat.Base.html#7285" class="Function Operator">_%_</a><a id="64" class="Symbol">;</a> <a id="66" href="Agda.Builtin.Nat.html#539" class="Primitive Operator">_*_</a><a id="69" class="Symbol">;</a> <a id="71" href="Class.HasOrder.Core.html#1000" class="Function">≤-trans</a><a id="78" class="Symbol">;</a> <a id="80" href="Ledger.Prelude.html#2407" class="Function Operator">∣_∣</a><a id="83" class="Symbol">)</a>

<a id="86" class="Keyword">open</a> <a id="91" class="Keyword">import</a> <a id="98" href="Ledger.Core.Specification.Crypto.html" class="Module">Ledger.Core.Specification.Crypto</a>
<a id="131" class="Keyword">open</a> <a id="136" class="Keyword">import</a> <a id="143" href="Ledger.Core.Specification.Epoch.html" class="Module">Ledger.Core.Specification.Epoch</a>
<a id="175" class="Keyword">open</a> <a id="180" class="Keyword">import</a> <a id="187" href="Ledger.Conway.Specification.Script.Base.html" class="Module">Ledger.Conway.Specification.Script.Base</a>
<a id="227" class="Keyword">open</a> <a id="232" class="Keyword">import</a> <a id="239" href="Ledger.Conway.Specification.PParams.html" class="Module">Ledger.Conway.Specification.PParams</a>

<a id="276" class="Keyword">module</a> <a id="283" href="Ledger.Conway.Specification.Fees.html" class="Module">Ledger.Conway.Specification.Fees</a>
  <a id="318" class="Symbol">{</a><a id="319" href="Ledger.Conway.Specification.Fees.html#319" class="Bound">cryptoStructure</a> <a id="335" class="Symbol">:</a> <a id="337" class="Symbol">_}</a> <a id="340" class="Symbol">{</a><a id="341" href="Ledger.Conway.Specification.Fees.html#341" class="Bound">epochStructure</a> <a id="356" class="Symbol">:</a> <a id="358" class="Symbol">_}</a>
  <a id="363" class="Symbol">{</a><a id="364" href="Ledger.Conway.Specification.Fees.html#364" class="Bound">scriptStructure</a> <a id="380" class="Symbol">:</a> <a id="382" href="Ledger.Conway.Specification.Script.Base.html#2140" class="Record">ScriptStructure</a> <a id="398" href="Ledger.Conway.Specification.Fees.html#319" class="Bound">cryptoStructure</a> <a id="414" href="Ledger.Conway.Specification.Fees.html#341" class="Bound">epochStructure</a><a id="428" class="Symbol">}</a>
  <a id="432" class="Symbol">(</a><a id="433" href="Ledger.Conway.Specification.Fees.html#433" class="Bound">pp</a> <a id="436" class="Symbol">:</a> <a id="438" href="Ledger.Conway.Specification.PParams.html#1779" class="Record">PParams</a> <a id="446" href="Ledger.Conway.Specification.Fees.html#319" class="Bound">cryptoStructure</a> <a id="462" href="Ledger.Conway.Specification.Fees.html#341" class="Bound">epochStructure</a> <a id="477" href="Ledger.Conway.Specification.Fees.html#364" class="Bound">scriptStructure</a><a id="492" class="Symbol">)</a>
  <a id="496" class="Keyword">where</a>

<a id="503" class="Keyword">open</a> <a id="508" class="Keyword">import</a> <a id="515" href="Data.Rational.html" class="Module">Data.Rational</a> <a id="529" class="Keyword">using</a> <a id="535" class="Symbol">(</a><a id="536" href="Data.Rational.Base.html#4404" class="Function">0ℚ</a><a id="538" class="Symbol">;</a> <a id="540" href="Data.Rational.Base.html#1421" class="Record">ℚ</a><a id="541" class="Symbol">;</a> <a id="543" href="Data.Rational.Base.html#2039" class="Function">mkℚ+</a><a id="547" class="Symbol">;</a> <a id="549" href="Data.Rational.Base.html#6394" class="Function Operator">_*_</a><a id="552" class="Symbol">;</a> <a id="554" href="Data.Rational.Base.html#7195" class="Function">floor</a><a id="559" class="Symbol">)</a>
<a id="561" class="Keyword">open</a> <a id="566" class="Keyword">import</a> <a id="573" href="Data.Rational.Literals.html" class="Module">Data.Rational.Literals</a> <a id="596" class="Keyword">using</a> <a id="602" class="Symbol">(</a><a id="603" href="Data.Rational.Literals.html#740" class="Function">number</a><a id="609" class="Symbol">)</a>
<a id="611" class="Keyword">open</a> <a id="616" class="Keyword">import</a> <a id="623" href="Ledger.Prelude.Numeric.html" class="Module">Ledger.Prelude.Numeric</a>
<a id="646" class="Keyword">open</a> <a id="651" class="Keyword">import</a> <a id="658" href="Data.Nat.Induction.html" class="Module">Data.Nat.Induction</a> <a id="677" class="Keyword">using</a> <a id="683" class="Symbol">(</a><a id="684" href="Data.Nat.Induction.html#1666" class="Function">&lt;′-wellFounded</a><a id="698" class="Symbol">)</a>
<a id="700" class="Keyword">open</a> <a id="705" class="Keyword">import</a> <a id="712" href="Data.Nat.Properties.html" class="Module">Data.Nat.Properties</a> <a id="732" class="Keyword">using</a> <a id="738" class="Symbol">(</a><a id="739" href="Data.Nat.Properties.html#65000" class="Function">&lt;⇒&lt;′</a><a id="743" class="Symbol">;</a> <a id="745" href="Data.Nat.Properties.html#9900" class="Function">≰⇒&gt;</a><a id="748" class="Symbol">;</a> <a id="750" href="Data.Nat.Properties.html#47756" class="Function">∸-monoʳ-≤</a><a id="759" class="Symbol">;</a> <a id="761" href="Data.Nat.Properties.html#20150" class="Function">+-monoʳ-≤</a><a id="770" class="Symbol">;</a> <a id="772" href="Data.Nat.Properties.html#9054" class="Function">n≤1+n</a><a id="777" class="Symbol">;</a> <a id="779" href="Data.Nat.Properties.html#52004" class="Function">m+[n∸m]≡n</a><a id="788" class="Symbol">;</a> <a id="790" href="Data.Nat.Properties.html#6055" class="Function">≤-reflexive</a><a id="801" class="Symbol">;</a> <a id="803" href="Data.Nat.Properties.html#6344" class="Function">≤-trans</a><a id="810" class="Symbol">)</a>
<a id="812" class="Keyword">open</a> <a id="817" class="Keyword">import</a> <a id="824" href="Data.Integer.html" class="Module">Data.Integer</a> <a id="837" class="Keyword">using</a> <a id="843" class="Symbol">(</a><a id="844" href="Data.Integer.Base.html#1715" class="Function Operator">∣_∣</a><a id="847" class="Symbol">)</a>
<a id="849" class="Keyword">open</a> <a id="854" class="Keyword">import</a> <a id="861" href="Induction.WellFounded.html" class="Module">Induction.WellFounded</a> <a id="883" class="Keyword">using</a> <a id="889" class="Symbol">(</a><a id="890" href="Induction.WellFounded.html#1545" class="Datatype">Acc</a><a id="893" class="Symbol">;</a> <a id="895" href="Induction.WellFounded.html#1607" class="InductiveConstructor">acc</a><a id="898" class="Symbol">)</a>
<a id="900" class="Keyword">open</a> <a id="905" class="Keyword">import</a> <a id="912" href="Agda.Builtin.FromNat.html" class="Module">Agda.Builtin.FromNat</a> <a id="933" class="Keyword">using</a> <a id="939" class="Symbol">(</a><a id="940" href="Agda.Builtin.FromNat.html#196" class="Record">Number</a><a id="946" class="Symbol">)</a>

<a id="949" class="Keyword">open</a> <a id="954" href="Agda.Builtin.FromNat.html#196" class="Module">Number</a> <a id="961" href="Data.Rational.Literals.html#740" class="Function">number</a> <a id="968" class="Keyword">renaming</a> <a id="977" class="Symbol">(</a><a id="978" href="Agda.Builtin.FromNat.html#281" class="Field">fromNat</a> <a id="986" class="Symbol">to</a> <a id="989" class="Field">fromℕ</a><a id="994" class="Symbol">)</a>


<a id="scriptsCost"></a><a id="998" href="Ledger.Conway.Specification.Fees.html#998" class="Function">scriptsCost</a> <a id="1010" class="Symbol">:</a> <a id="1012" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a> <a id="1014" class="Symbol">→</a> <a id="1016" href="Ledger.Prelude.Base.html#154" class="Function">Coin</a>
<a id="1021" href="Ledger.Conway.Specification.Fees.html#998" class="Function">scriptsCost</a> <a id="1033" href="Ledger.Conway.Specification.Fees.html#1033" class="Bound">scriptSize</a>
  <a id="1046" class="Symbol">=</a> <a id="1048" href="Ledger.Conway.Specification.Fees.html#1433" class="Function">scriptsCostAux</a> <a id="1063" href="Data.Rational.Base.html#4404" class="Function">0ℚ</a> <a id="1066" href="Ledger.Conway.Specification.Fees.html#1147" class="Function">minFeeRefScriptCoinsPerByte</a> <a id="1094" href="Ledger.Conway.Specification.Fees.html#1033" class="Bound">scriptSize</a> <a id="1105" class="Symbol">(</a><a id="1106" href="Data.Nat.Induction.html#1666" class="Function">&lt;′-wellFounded</a> <a id="1121" href="Ledger.Conway.Specification.Fees.html#1033" class="Bound">scriptSize</a><a id="1131" class="Symbol">)</a>
    <a id="1137" class="Keyword">where</a>
    <a id="1147" href="Ledger.Conway.Specification.Fees.html#1147" class="Function">minFeeRefScriptCoinsPerByte</a> <a id="1175" href="Ledger.Conway.Specification.Fees.html#1175" class="Function">refScriptCostMultiplier</a> <a id="1199" class="Symbol">:</a> <a id="1201" href="Data.Rational.Base.html#1421" class="Record">ℚ</a>
    <a id="1207" href="Ledger.Conway.Specification.Fees.html#1147" class="Function">minFeeRefScriptCoinsPerByte</a> <a id="1235" class="Symbol">=</a> <a id="1237" href="Ledger.Conway.Specification.PParams.html#2607" class="Field">PParams.minFeeRefScriptCoinsPerByte</a> <a id="1273" href="Ledger.Conway.Specification.Fees.html#433" class="Bound">pp</a>
    <a id="1280" href="Ledger.Conway.Specification.Fees.html#1175" class="Function">refScriptCostMultiplier</a> <a id="1304" class="Symbol">=</a> <a id="1306" href="Ledger.Conway.Specification.PParams.html#2776" class="Field">PParams.refScriptCostMultiplier</a> <a id="1338" href="Ledger.Conway.Specification.Fees.html#433" class="Bound">pp</a>

    <a id="1346" href="Ledger.Conway.Specification.Fees.html#1346" class="Function">refScriptCostStride</a> <a id="1366" class="Symbol">:</a> <a id="1368" href="Ledger.Prelude.Numeric.html#203" class="Function">ℕ⁺</a>
    <a id="1375" href="Ledger.Conway.Specification.Fees.html#1346" class="Function">refScriptCostStride</a> <a id="1395" class="Symbol">=</a> <a id="1397" href="Ledger.Conway.Specification.PParams.html#2733" class="Field">PParams.refScriptCostStride</a> <a id="1425" href="Ledger.Conway.Specification.Fees.html#433" class="Bound">pp</a>

    <a id="1433" href="Ledger.Conway.Specification.Fees.html#1433" class="Function">scriptsCostAux</a> <a id="1448" class="Symbol">:</a> <a id="1450" href="Data.Rational.Base.html#1421" class="Record">ℚ</a>        <a id="1459" class="Comment">-- accumulator</a>
                   <a id="1493" class="Symbol">→</a> <a id="1495" href="Data.Rational.Base.html#1421" class="Record">ℚ</a>        <a id="1504" class="Comment">-- current tier price</a>
                   <a id="1545" class="Symbol">→</a> <a id="1547" class="Symbol">(</a><a id="1548" href="Ledger.Conway.Specification.Fees.html#1548" class="Bound">n</a> <a id="1550" class="Symbol">:</a> <a id="1552" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a><a id="1553" class="Symbol">)</a>  <a id="1556" class="Comment">-- remaining script size</a>
                   <a id="1600" class="Symbol">→</a> <a id="1602" href="Induction.WellFounded.html#1545" class="Datatype">Acc</a> <a id="1606" href="Data.Nat.Base.html#7870" class="Function Operator">_&lt;′_</a> <a id="1611" href="Ledger.Conway.Specification.Fees.html#1548" class="Bound">n</a>
                   <a id="1632" class="Symbol">→</a> <a id="1634" href="Ledger.Prelude.Base.html#154" class="Function">Coin</a>
    <a id="1643" href="Ledger.Conway.Specification.Fees.html#1433" class="Function">scriptsCostAux</a> <a id="1658" href="Ledger.Conway.Specification.Fees.html#1658" class="Bound">acl</a> <a id="1662" href="Ledger.Conway.Specification.Fees.html#1662" class="Bound">curTierPrice</a> <a id="1675" href="Ledger.Conway.Specification.Fees.html#1675" class="Bound">n</a> <a id="1677" class="Symbol">(</a><a id="1678" href="Induction.WellFounded.html#1607" class="InductiveConstructor">acc</a> <a id="1682" href="Ledger.Conway.Specification.Fees.html#1682" class="Bound">rs</a><a id="1684" class="Symbol">)</a> <a id="1686" class="Symbol">=</a> <a id="1688" href="Function.Base.html#4061" class="Function Operator">case</a>  <a id="1694" href="Ledger.Conway.Specification.Fees.html#1675" class="Bound">n</a> <a id="1696" href="Class.HasOrder.Core.html#1016" class="Function Operator">≤?</a> <a id="1699" href="Ledger.Prelude.Numeric.html#221" class="Function">fromℕ⁺</a> <a id="1706" href="Ledger.Conway.Specification.Fees.html#1346" class="Function">refScriptCostStride</a> <a id="1726" href="Function.Base.html#4061" class="Function Operator">of</a> <a id="1729" class="Symbol">λ</a> <a id="1731" class="Keyword">where</a>
      <a id="1743" class="Symbol">(</a><a id="1744" href="Relation.Nullary.Decidable.Core.html#2099" class="InductiveConstructor">yes</a> <a id="1748" class="Symbol">_)</a>  <a id="1752" class="Symbol">→</a> <a id="1754" href="Data.Integer.Base.html#1715" class="Function Operator">∣</a> <a id="1756" href="Data.Rational.Base.html#7195" class="Function">floor</a> <a id="1762" class="Symbol">(</a><a id="1763" href="Ledger.Conway.Specification.Fees.html#1658" class="Bound">acl</a> <a id="1767" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="1769" class="Symbol">(</a><a id="1770" href="Ledger.Conway.Specification.Fees.html#989" class="Function">fromℕ</a> <a id="1776" href="Ledger.Conway.Specification.Fees.html#1675" class="Bound">n</a> <a id="1778" href="Data.Rational.Base.html#6394" class="Function Operator">*</a> <a id="1780" href="Ledger.Conway.Specification.Fees.html#1662" class="Bound">curTierPrice</a><a id="1792" class="Symbol">))</a> <a id="1795" href="Data.Integer.Base.html#1715" class="Function Operator">∣</a>
      <a id="1803" class="Symbol">(</a><a id="1804" href="Relation.Nullary.Decidable.Core.html#2136" class="InductiveConstructor">no</a>  <a id="1808" href="Ledger.Conway.Specification.Fees.html#1808" class="Bound">p</a><a id="1809" class="Symbol">)</a>  <a id="1812" class="Symbol">→</a> <a id="1814" href="Ledger.Conway.Specification.Fees.html#1433" class="Function">scriptsCostAux</a>
                   <a id="1848" class="Symbol">(</a><a id="1849" href="Ledger.Conway.Specification.Fees.html#1658" class="Bound">acl</a> <a id="1853" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="1855" class="Symbol">(</a><a id="1856" href="Ledger.Conway.Specification.Fees.html#989" class="Function">fromℕ</a> <a id="1862" class="Symbol">(</a><a id="1863" href="Ledger.Prelude.Numeric.html#221" class="Function">fromℕ⁺</a> <a id="1870" href="Ledger.Conway.Specification.Fees.html#1346" class="Function">refScriptCostStride</a><a id="1889" class="Symbol">)</a> <a id="1891" href="Data.Rational.Base.html#6394" class="Function Operator">*</a> <a id="1893" href="Ledger.Conway.Specification.Fees.html#1662" class="Bound">curTierPrice</a><a id="1905" class="Symbol">))</a>
                   <a id="1927" class="Symbol">(</a><a id="1928" href="Ledger.Conway.Specification.Fees.html#1175" class="Function">refScriptCostMultiplier</a> <a id="1952" href="Data.Rational.Base.html#6394" class="Function Operator">*</a> <a id="1954" href="Ledger.Conway.Specification.Fees.html#1662" class="Bound">curTierPrice</a><a id="1966" class="Symbol">)</a>
                   <a id="1987" class="Symbol">(</a><a id="1988" href="Ledger.Conway.Specification.Fees.html#1675" class="Bound">n</a> <a id="1990" href="Interface.TypeClasses.HasSubtract.html#223" class="Field Operator">-</a> <a id="1992" href="Ledger.Prelude.Numeric.html#221" class="Function">fromℕ⁺</a> <a id="1999" href="Ledger.Conway.Specification.Fees.html#1346" class="Function">refScriptCostStride</a><a id="2018" class="Symbol">)</a>
                   <a id="2039" class="Symbol">(</a><a id="2040" href="Ledger.Conway.Specification.Fees.html#1682" class="Bound">rs</a> <a id="2043" href="Function.Base.html#1993" class="Function Operator">$</a> <a id="2045" href="Data.Nat.Properties.html#65000" class="Function">&lt;⇒&lt;′</a> <a id="2050" class="Symbol">(</a><a id="2051" href="Ledger.Conway.Specification.Fees.html#2137" class="Function">suc∸≤</a> <a id="2057" class="Symbol">(</a><a id="2058" href="Data.Nat.Properties.html#6344" class="Function">≤-trans</a> <a id="2066" class="Symbol">(</a><a id="2067" href="Data.Nat.Base.html#1919" class="InductiveConstructor">s&lt;s</a> <a id="2071" href="Data.Nat.Base.html#1720" class="InductiveConstructor">z≤n</a><a id="2074" class="Symbol">)</a> <a id="2076" class="Symbol">(</a><a id="2077" href="Data.Nat.Properties.html#9900" class="Function">≰⇒&gt;</a> <a id="2081" href="Ledger.Conway.Specification.Fees.html#1808" class="Bound">p</a><a id="2082" class="Symbol">))</a> <a id="2085" class="Symbol">(</a><a id="2086" href="Ledger.Prelude.Numeric.html#274" class="Function">ℕ⁺-&gt;0</a> <a id="2092" href="Ledger.Conway.Specification.Fees.html#1346" class="Function">refScriptCostStride</a><a id="2111" class="Symbol">)))</a>
        <a id="2123" class="Keyword">where</a>
        <a id="2137" href="Ledger.Conway.Specification.Fees.html#2137" class="Function">suc∸≤</a> <a id="2143" class="Symbol">:</a> <a id="2145" class="Symbol">∀</a> <a id="2147" class="Symbol">{</a><a id="2148" href="Ledger.Conway.Specification.Fees.html#2148" class="Bound">n</a> <a id="2150" href="Ledger.Conway.Specification.Fees.html#2150" class="Bound">m</a> <a id="2152" class="Symbol">:</a> <a id="2154" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a><a id="2155" class="Symbol">}</a> <a id="2157" class="Symbol">→</a> <a id="2159" href="Ledger.Conway.Specification.Fees.html#2148" class="Bound">n</a> <a id="2161" href="Class.HasOrder.Core.html#848" class="Function Operator">&gt;</a> <a id="2163" class="Number">0</a> <a id="2165" class="Symbol">→</a> <a id="2167" href="Ledger.Conway.Specification.Fees.html#2150" class="Bound">m</a> <a id="2169" href="Class.HasOrder.Core.html#848" class="Function Operator">&gt;</a> <a id="2171" class="Number">0</a> <a id="2173" class="Symbol">→</a> <a id="2175" href="Ledger.Conway.Specification.Fees.html#2148" class="Bound">n</a> <a id="2177" href="Data.Nat.Base.html#4462" class="Primitive Operator">∸</a> <a id="2179" href="Ledger.Conway.Specification.Fees.html#2150" class="Bound">m</a> <a id="2181" href="Class.HasOrder.Core.html#646" class="Field Operator">&lt;</a> <a id="2183" href="Ledger.Conway.Specification.Fees.html#2148" class="Bound">n</a>
        <a id="2193" href="Ledger.Conway.Specification.Fees.html#2137" class="Function">suc∸≤</a> <a id="2199" class="Symbol">{</a><a id="2200" href="Ledger.Conway.Specification.Fees.html#2200" class="Bound">n</a><a id="2201" class="Symbol">}</a> <a id="2203" class="Symbol">{.</a><a id="2205" href="Agda.Builtin.Nat.html#234" class="InductiveConstructor">suc</a> <a id="2209" href="Ledger.Conway.Specification.Fees.html#2209" class="Bound">m</a><a id="2210" class="Symbol">}</a> <a id="2212" href="Ledger.Conway.Specification.Fees.html#2212" class="Bound">p</a> <a id="2214" class="Symbol">(</a><a id="2215" href="Data.Nat.Base.html#1762" class="InductiveConstructor">s≤s</a> <a id="2219" href="Ledger.Conway.Specification.Fees.html#2219" class="Bound">q</a><a id="2220" class="Symbol">)</a> <a id="2222" class="Symbol">=</a> <a id="2224" href="Data.Nat.Properties.html#6344" class="Function">≤-trans</a> <a id="2232" class="Symbol">(</a><a id="2233" href="Data.Nat.Properties.html#20150" class="Function">+-monoʳ-≤</a> <a id="2243" class="Number">1</a> <a id="2245" class="Symbol">(</a><a id="2246" href="Data.Nat.Properties.html#47756" class="Function">∸-monoʳ-≤</a> <a id="2256" href="Ledger.Conway.Specification.Fees.html#2200" class="Bound">n</a> <a id="2258" class="Symbol">(</a><a id="2259" href="Data.Nat.Base.html#1919" class="InductiveConstructor">s&lt;s</a> <a id="2263" href="Ledger.Conway.Specification.Fees.html#2219" class="Bound">q</a><a id="2264" class="Symbol">)))</a>
                                               <a id="2315" class="Symbol">(</a><a id="2316" href="Data.Nat.Properties.html#6055" class="Function">≤-reflexive</a> <a id="2328" class="Symbol">(</a><a id="2329" href="Data.Nat.Properties.html#52004" class="Function">m+[n∸m]≡n</a> <a id="2339" href="Ledger.Conway.Specification.Fees.html#2212" class="Bound">p</a><a id="2340" class="Symbol">))</a>

</pre></body></html>