<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>Ledger.Conway.Specification.Fees</title><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.css"><link rel="stylesheet" href="Agda.css"><script src="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.js"></script><script src="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/contrib/auto-render.min.js"></script><script src="AgdaKaTeX.js" defer=""></script></head><body><pre class="Agda">
<a id="2" class="Symbol">{-#</a> <a id="6" class="Keyword">OPTIONS</a> <a id="14" class="Pragma">--safe</a> <a id="21" class="Symbol">#-}</a>

<a id="26" class="Keyword">open</a> <a id="31" class="Keyword">import</a> <a id="38" href="Ledger.Prelude.html" class="Module">Ledger.Prelude</a> <a id="53" class="Keyword">hiding</a> <a id="60" class="Symbol">(</a><a id="61" href="Data.Nat.Base.html#7285" class="Function Operator">_%_</a><a id="64" class="Symbol">;</a> <a id="66" href="Agda.Builtin.Nat.html#539" class="Primitive Operator">_*_</a><a id="69" class="Symbol">;</a> <a id="71" href="Class.HasOrder.Core.html#1000" class="Function">≤-trans</a><a id="78" class="Symbol">;</a> <a id="80" href="Ledger.Prelude.html#2253" class="Function Operator">∣_∣</a><a id="83" class="Symbol">)</a>
<a id="85" class="Keyword">open</a> <a id="90" class="Keyword">import</a> <a id="97" href="Ledger.Conway.Specification.Abstract.html" class="Module">Ledger.Conway.Specification.Abstract</a>
<a id="134" class="Keyword">open</a> <a id="139" class="Keyword">import</a> <a id="146" href="Ledger.Conway.Specification.Transaction.html" class="Module">Ledger.Conway.Specification.Transaction</a>

<a id="187" class="Keyword">module</a> <a id="194" href="Ledger.Conway.Specification.Fees.html" class="Module">Ledger.Conway.Specification.Fees</a>
  <a id="229" class="Symbol">(</a><a id="230" href="Ledger.Conway.Specification.Fees.html#230" class="Bound">txs</a> <a id="234" class="Symbol">:</a> <a id="236" class="Symbol">_)</a> <a id="239" class="Symbol">(</a><a id="240" class="Keyword">open</a> <a id="245" href="Ledger.Conway.Specification.Transaction.html#1000" class="Module">TransactionStructure</a> <a id="266" href="Ledger.Conway.Specification.Fees.html#230" class="Bound">txs</a><a id="269" class="Symbol">)</a>
  <a id="273" class="Keyword">where</a>

<a id="280" class="Keyword">open</a> <a id="285" class="Keyword">import</a> <a id="292" href="Data.Rational.html" class="Module">Data.Rational</a> <a id="306" class="Keyword">using</a> <a id="312" class="Symbol">(</a><a id="313" href="Data.Rational.Base.html#4404" class="Function">0ℚ</a><a id="315" class="Symbol">;</a> <a id="317" href="Data.Rational.Base.html#1421" class="Record">ℚ</a><a id="318" class="Symbol">;</a> <a id="320" href="Data.Rational.Base.html#2039" class="Function">mkℚ+</a><a id="324" class="Symbol">;</a> <a id="326" href="Data.Rational.Base.html#6394" class="Function Operator">_*_</a><a id="329" class="Symbol">;</a> <a id="331" href="Data.Rational.Base.html#7195" class="Function">floor</a><a id="336" class="Symbol">)</a>
<a id="338" class="Keyword">open</a> <a id="343" class="Keyword">import</a> <a id="350" href="Data.Rational.Literals.html" class="Module">Data.Rational.Literals</a> <a id="373" class="Keyword">using</a> <a id="379" class="Symbol">(</a><a id="380" href="Data.Rational.Literals.html#740" class="Function">number</a><a id="386" class="Symbol">)</a>
<a id="388" class="Keyword">open</a> <a id="393" class="Keyword">import</a> <a id="400" href="Ledger.Prelude.Numeric.html" class="Module">Ledger.Prelude.Numeric</a>
<a id="423" class="Keyword">open</a> <a id="428" class="Keyword">import</a> <a id="435" href="Data.Nat.Induction.html" class="Module">Data.Nat.Induction</a> <a id="454" class="Keyword">using</a> <a id="460" class="Symbol">(</a><a id="461" href="Data.Nat.Induction.html#1666" class="Function">&lt;′-wellFounded</a><a id="475" class="Symbol">)</a>
<a id="477" class="Keyword">open</a> <a id="482" class="Keyword">import</a> <a id="489" href="Data.Nat.Properties.html" class="Module">Data.Nat.Properties</a> <a id="509" class="Keyword">using</a> <a id="515" class="Symbol">(</a><a id="516" href="Data.Nat.Properties.html#65000" class="Function">&lt;⇒&lt;′</a><a id="520" class="Symbol">;</a> <a id="522" href="Data.Nat.Properties.html#9900" class="Function">≰⇒&gt;</a><a id="525" class="Symbol">;</a> <a id="527" href="Data.Nat.Properties.html#47756" class="Function">∸-monoʳ-≤</a><a id="536" class="Symbol">;</a> <a id="538" href="Data.Nat.Properties.html#20150" class="Function">+-monoʳ-≤</a><a id="547" class="Symbol">;</a> <a id="549" href="Data.Nat.Properties.html#9054" class="Function">n≤1+n</a><a id="554" class="Symbol">;</a> <a id="556" href="Data.Nat.Properties.html#52004" class="Function">m+[n∸m]≡n</a><a id="565" class="Symbol">;</a> <a id="567" href="Data.Nat.Properties.html#6055" class="Function">≤-reflexive</a><a id="578" class="Symbol">;</a> <a id="580" href="Data.Nat.Properties.html#6344" class="Function">≤-trans</a><a id="587" class="Symbol">)</a>
<a id="589" class="Keyword">open</a> <a id="594" class="Keyword">import</a> <a id="601" href="Data.Integer.html" class="Module">Data.Integer</a> <a id="614" class="Keyword">using</a> <a id="620" class="Symbol">(</a><a id="621" href="Data.Integer.Base.html#1715" class="Function Operator">∣_∣</a><a id="624" class="Symbol">)</a>
<a id="626" class="Keyword">open</a> <a id="631" class="Keyword">import</a> <a id="638" href="Induction.WellFounded.html" class="Module">Induction.WellFounded</a> <a id="660" class="Keyword">using</a> <a id="666" class="Symbol">(</a><a id="667" href="Induction.WellFounded.html#1545" class="Datatype">Acc</a><a id="670" class="Symbol">;</a> <a id="672" href="Induction.WellFounded.html#1607" class="InductiveConstructor">acc</a><a id="675" class="Symbol">)</a>
<a id="677" class="Keyword">open</a> <a id="682" class="Keyword">import</a> <a id="689" href="Agda.Builtin.FromNat.html" class="Module">Agda.Builtin.FromNat</a> <a id="710" class="Keyword">using</a> <a id="716" class="Symbol">(</a><a id="717" href="Agda.Builtin.FromNat.html#196" class="Record">Number</a><a id="723" class="Symbol">)</a>

<a id="726" class="Keyword">open</a> <a id="731" href="Agda.Builtin.FromNat.html#196" class="Module">Number</a> <a id="738" href="Data.Rational.Literals.html#740" class="Function">number</a> <a id="745" class="Keyword">renaming</a> <a id="754" class="Symbol">(</a><a id="755" href="Agda.Builtin.FromNat.html#281" class="Field">fromNat</a> <a id="763" class="Symbol">to</a> <a id="766" class="Field">fromℕ</a><a id="771" class="Symbol">)</a>


<a id="scriptsCost"></a><a id="775" href="Ledger.Conway.Specification.Fees.html#775" class="Function">scriptsCost</a> <a id="787" class="Symbol">:</a> <a id="789" class="Symbol">(</a><a id="790" href="Ledger.Conway.Specification.Fees.html#790" class="Bound">pp</a> <a id="793" class="Symbol">:</a> <a id="795" href="Ledger.Conway.Specification.PParams.html#1685" class="Record">PParams</a><a id="802" class="Symbol">)</a> <a id="804" class="Symbol">→</a> <a id="806" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a> <a id="808" class="Symbol">→</a> <a id="810" href="Ledger.Prelude.Base.html#154" class="Function">Coin</a>
<a id="815" href="Ledger.Conway.Specification.Fees.html#775" class="Function">scriptsCost</a> <a id="827" href="Ledger.Conway.Specification.Fees.html#827" class="Bound">pp</a> <a id="830" href="Ledger.Conway.Specification.Fees.html#830" class="Bound">scriptSize</a>
  <a id="843" class="Symbol">=</a> <a id="845" href="Ledger.Conway.Specification.Fees.html#1159" class="Function">scriptsCostAux</a> <a id="860" href="Data.Rational.Base.html#4404" class="Function">0ℚ</a> <a id="863" href="Ledger.Conway.Specification.Fees.html#964" class="Function">minFeeRefScriptCoinsPerByte</a> <a id="891" href="Ledger.Conway.Specification.Fees.html#830" class="Bound">scriptSize</a>


                  <a id="922" class="Symbol">(</a><a id="923" href="Data.Nat.Induction.html#1666" class="Function">&lt;′-wellFounded</a> <a id="938" href="Ledger.Conway.Specification.Fees.html#830" class="Bound">scriptSize</a><a id="948" class="Symbol">)</a>


  <a id="954" class="Keyword">where</a>
    <a id="964" href="Ledger.Conway.Specification.Fees.html#964" class="Function">minFeeRefScriptCoinsPerByte</a> <a id="992" class="Symbol">=</a> <a id="994" href="Ledger.Conway.Specification.PParams.html#2513" class="Field">PParams.minFeeRefScriptCoinsPerByte</a> <a id="1030" href="Ledger.Conway.Specification.Fees.html#827" class="Bound">pp</a>
    <a id="1037" href="Ledger.Conway.Specification.Fees.html#1037" class="Function">refScriptCostMultiplier</a> <a id="1061" class="Symbol">=</a> <a id="1063" href="Ledger.Conway.Specification.PParams.html#2682" class="Field">PParams.refScriptCostMultiplier</a> <a id="1095" href="Ledger.Conway.Specification.Fees.html#827" class="Bound">pp</a>
    <a id="1102" href="Ledger.Conway.Specification.Fees.html#1102" class="Function">refScriptCostStride</a> <a id="1122" class="Symbol">=</a> <a id="1124" href="Ledger.Conway.Specification.PParams.html#2639" class="Field">PParams.refScriptCostStride</a> <a id="1152" href="Ledger.Conway.Specification.Fees.html#827" class="Bound">pp</a>
    <a id="1159" href="Ledger.Conway.Specification.Fees.html#1159" class="Function">scriptsCostAux</a> <a id="1174" class="Symbol">:</a> <a id="1176" href="Data.Rational.Base.html#1421" class="Record">ℚ</a>        <a id="1185" class="Comment">-- accumulator</a>
                   <a id="1219" class="Symbol">→</a> <a id="1221" href="Data.Rational.Base.html#1421" class="Record">ℚ</a>        <a id="1230" class="Comment">-- current tier price</a>
                   <a id="1271" class="Symbol">→</a> <a id="1273" class="Symbol">(</a><a id="1274" href="Ledger.Conway.Specification.Fees.html#1274" class="Bound">n</a> <a id="1276" class="Symbol">:</a> <a id="1278" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a><a id="1279" class="Symbol">)</a>  <a id="1282" class="Comment">-- remaining script size</a>


                   <a id="1328" class="Symbol">→</a> <a id="1330" href="Induction.WellFounded.html#1545" class="Datatype">Acc</a> <a id="1334" href="Data.Nat.Base.html#7870" class="Function Operator">_&lt;′_</a> <a id="1339" href="Ledger.Conway.Specification.Fees.html#1274" class="Bound">n</a>


                   <a id="1362" class="Symbol">→</a> <a id="1364" href="Ledger.Prelude.Base.html#154" class="Function">Coin</a>
    <a id="1373" href="Ledger.Conway.Specification.Fees.html#1159" class="Function">scriptsCostAux</a> <a id="1388" href="Ledger.Conway.Specification.Fees.html#1388" class="Bound">acl</a> <a id="1392" href="Ledger.Conway.Specification.Fees.html#1392" class="Bound">curTierPrice</a> <a id="1405" href="Ledger.Conway.Specification.Fees.html#1405" class="Bound">n</a>


       <a id="1416" class="Symbol">(</a><a id="1417" href="Induction.WellFounded.html#1607" class="InductiveConstructor">acc</a> <a id="1421" href="Ledger.Conway.Specification.Fees.html#1421" class="Bound">rs</a><a id="1423" class="Symbol">)</a>


       <a id="1434" class="Symbol">=</a> <a id="1436" href="Function.Base.html#4061" class="Function Operator">case</a>  <a id="1442" href="Ledger.Conway.Specification.Fees.html#1405" class="Bound">n</a> <a id="1444" href="Class.HasOrder.Core.html#1016" class="Function Operator">≤?</a> <a id="1447" href="Ledger.Prelude.Numeric.html#220" class="Function">fromℕ⁺</a> <a id="1454" href="Ledger.Conway.Specification.Fees.html#1102" class="Function">refScriptCostStride</a> <a id="1474" href="Function.Base.html#4061" class="Function Operator">of</a>


                <a id="1495" class="Symbol">λ</a> <a id="1497" class="Keyword">where</a>


                <a id="1521" class="Symbol">(</a><a id="1522" href="Relation.Nullary.Decidable.Core.html#2099" class="InductiveConstructor">yes</a> <a id="1526" class="Symbol">_)</a>  <a id="1530" class="Symbol">→</a> <a id="1532" href="Data.Integer.Base.html#1715" class="Function Operator">∣</a> <a id="1534" href="Data.Rational.Base.html#7195" class="Function">floor</a> <a id="1540" class="Symbol">(</a><a id="1541" href="Ledger.Conway.Specification.Fees.html#1388" class="Bound">acl</a> <a id="1545" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="1547" class="Symbol">(</a><a id="1548" href="Ledger.Conway.Specification.Fees.html#766" class="Function">fromℕ</a> <a id="1554" href="Ledger.Conway.Specification.Fees.html#1405" class="Bound">n</a> <a id="1556" href="Data.Rational.Base.html#6394" class="Function Operator">*</a> <a id="1558" href="Ledger.Conway.Specification.Fees.html#1392" class="Bound">curTierPrice</a><a id="1570" class="Symbol">))</a> <a id="1573" href="Data.Integer.Base.html#1715" class="Function Operator">∣</a>
                <a id="1591" class="Symbol">(</a><a id="1592" href="Relation.Nullary.Decidable.Core.html#2136" class="InductiveConstructor">no</a>  <a id="1596" href="Ledger.Conway.Specification.Fees.html#1596" class="Bound">p</a><a id="1597" class="Symbol">)</a>  <a id="1600" class="Symbol">→</a> <a id="1602" href="Ledger.Conway.Specification.Fees.html#1159" class="Function">scriptsCostAux</a>
                             <a id="1646" class="Symbol">(</a><a id="1647" href="Ledger.Conway.Specification.Fees.html#1388" class="Bound">acl</a> <a id="1651" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="1653" class="Symbol">(</a><a id="1654" href="Ledger.Conway.Specification.Fees.html#766" class="Function">fromℕ</a> <a id="1660" class="Symbol">(</a><a id="1661" href="Ledger.Prelude.Numeric.html#220" class="Function">fromℕ⁺</a> <a id="1668" href="Ledger.Conway.Specification.Fees.html#1102" class="Function">refScriptCostStride</a><a id="1687" class="Symbol">)</a> <a id="1689" href="Data.Rational.Base.html#6394" class="Function Operator">*</a> <a id="1691" href="Ledger.Conway.Specification.Fees.html#1392" class="Bound">curTierPrice</a><a id="1703" class="Symbol">))</a>
                             <a id="1735" class="Symbol">(</a><a id="1736" href="Ledger.Conway.Specification.Fees.html#1037" class="Function">refScriptCostMultiplier</a> <a id="1760" href="Data.Rational.Base.html#6394" class="Function Operator">*</a> <a id="1762" href="Ledger.Conway.Specification.Fees.html#1392" class="Bound">curTierPrice</a><a id="1774" class="Symbol">)</a>
                             <a id="1805" class="Symbol">(</a><a id="1806" href="Ledger.Conway.Specification.Fees.html#1405" class="Bound">n</a> <a id="1808" href="Interface.HasSubtract.html#209" class="Field Operator">-</a> <a id="1810" href="Ledger.Prelude.Numeric.html#220" class="Function">fromℕ⁺</a> <a id="1817" href="Ledger.Conway.Specification.Fees.html#1102" class="Function">refScriptCostStride</a><a id="1836" class="Symbol">)</a>


                             <a id="1869" class="Symbol">(</a><a id="1870" href="Ledger.Conway.Specification.Fees.html#1421" class="Bound">rs</a> <a id="1873" href="Function.Base.html#1993" class="Function Operator">$</a> <a id="1875" href="Data.Nat.Properties.html#65000" class="Function">&lt;⇒&lt;′</a> <a id="1880" class="Symbol">(</a><a id="1881" href="Ledger.Conway.Specification.Fees.html#1965" class="Function">suc∸≤</a> <a id="1887" class="Symbol">(</a><a id="1888" href="Data.Nat.Properties.html#6344" class="Function">≤-trans</a> <a id="1896" class="Symbol">(</a><a id="1897" href="Data.Nat.Base.html#1919" class="InductiveConstructor">s&lt;s</a> <a id="1901" href="Data.Nat.Base.html#1720" class="InductiveConstructor">z≤n</a><a id="1904" class="Symbol">)</a> <a id="1906" class="Symbol">(</a><a id="1907" href="Data.Nat.Properties.html#9900" class="Function">≰⇒&gt;</a> <a id="1911" href="Ledger.Conway.Specification.Fees.html#1596" class="Bound">p</a><a id="1912" class="Symbol">))</a> <a id="1915" class="Symbol">(</a><a id="1916" href="Ledger.Prelude.Numeric.html#273" class="Function">ℕ⁺-&gt;0</a> <a id="1922" href="Ledger.Conway.Specification.Fees.html#1102" class="Function">refScriptCostStride</a><a id="1941" class="Symbol">)))</a>
      <a id="1951" class="Keyword">where</a>
        <a id="1965" href="Ledger.Conway.Specification.Fees.html#1965" class="Function">suc∸≤</a> <a id="1971" class="Symbol">:</a> <a id="1973" class="Symbol">∀</a> <a id="1975" class="Symbol">{</a><a id="1976" href="Ledger.Conway.Specification.Fees.html#1976" class="Bound">n</a> <a id="1978" href="Ledger.Conway.Specification.Fees.html#1978" class="Bound">m</a> <a id="1980" class="Symbol">:</a> <a id="1982" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a><a id="1983" class="Symbol">}</a> <a id="1985" class="Symbol">→</a> <a id="1987" href="Ledger.Conway.Specification.Fees.html#1976" class="Bound">n</a> <a id="1989" href="Class.HasOrder.Core.html#848" class="Function Operator">&gt;</a> <a id="1991" class="Number">0</a> <a id="1993" class="Symbol">→</a> <a id="1995" href="Ledger.Conway.Specification.Fees.html#1978" class="Bound">m</a> <a id="1997" href="Class.HasOrder.Core.html#848" class="Function Operator">&gt;</a> <a id="1999" class="Number">0</a> <a id="2001" class="Symbol">→</a> <a id="2003" href="Ledger.Conway.Specification.Fees.html#1976" class="Bound">n</a> <a id="2005" href="Data.Nat.Base.html#4462" class="Primitive Operator">∸</a> <a id="2007" href="Ledger.Conway.Specification.Fees.html#1978" class="Bound">m</a> <a id="2009" href="Class.HasOrder.Core.html#646" class="Field Operator">&lt;</a> <a id="2011" href="Ledger.Conway.Specification.Fees.html#1976" class="Bound">n</a>
        <a id="2021" href="Ledger.Conway.Specification.Fees.html#1965" class="Function">suc∸≤</a> <a id="2027" class="Symbol">{</a><a id="2028" href="Ledger.Conway.Specification.Fees.html#2028" class="Bound">n</a><a id="2029" class="Symbol">}</a> <a id="2031" class="Symbol">{.</a><a id="2033" href="Agda.Builtin.Nat.html#234" class="InductiveConstructor">suc</a> <a id="2037" href="Ledger.Conway.Specification.Fees.html#2037" class="Bound">m</a><a id="2038" class="Symbol">}</a> <a id="2040" href="Ledger.Conway.Specification.Fees.html#2040" class="Bound">p</a> <a id="2042" class="Symbol">(</a><a id="2043" href="Data.Nat.Base.html#1762" class="InductiveConstructor">s≤s</a> <a id="2047" href="Ledger.Conway.Specification.Fees.html#2047" class="Bound">q</a><a id="2048" class="Symbol">)</a> <a id="2050" class="Symbol">=</a> <a id="2052" href="Data.Nat.Properties.html#6344" class="Function">≤-trans</a> <a id="2060" class="Symbol">(</a><a id="2061" href="Data.Nat.Properties.html#20150" class="Function">+-monoʳ-≤</a> <a id="2071" class="Number">1</a> <a id="2073" class="Symbol">(</a><a id="2074" href="Data.Nat.Properties.html#47756" class="Function">∸-monoʳ-≤</a> <a id="2084" href="Ledger.Conway.Specification.Fees.html#2028" class="Bound">n</a> <a id="2086" class="Symbol">(</a><a id="2087" href="Data.Nat.Base.html#1919" class="InductiveConstructor">s&lt;s</a> <a id="2091" href="Ledger.Conway.Specification.Fees.html#2047" class="Bound">q</a><a id="2092" class="Symbol">)))</a>
                                               <a id="2143" class="Symbol">(</a><a id="2144" href="Data.Nat.Properties.html#6055" class="Function">≤-reflexive</a> <a id="2156" class="Symbol">(</a><a id="2157" href="Data.Nat.Properties.html#52004" class="Function">m+[n∸m]≡n</a> <a id="2167" href="Ledger.Conway.Specification.Fees.html#2040" class="Bound">p</a><a id="2168" class="Symbol">))</a>

</pre></body></html>