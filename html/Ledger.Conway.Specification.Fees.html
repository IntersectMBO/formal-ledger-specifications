<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>Ledger.Conway.Specification.Fees</title><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.css"><link rel="stylesheet" href="Agda.css"><script src="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.js"></script><script src="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/contrib/auto-render.min.js"></script><script src="AgdaKaTeX.js" defer=""></script></head><body><pre class="Agda">

<a id="3" class="Symbol">{-#</a> <a id="7" class="Keyword">OPTIONS</a> <a id="15" class="Pragma">--safe</a> <a id="22" class="Symbol">#-}</a>

<a id="27" class="Keyword">open</a> <a id="32" class="Keyword">import</a> <a id="39" href="Ledger.Prelude.html" class="Module">Ledger.Prelude</a> <a id="54" class="Keyword">hiding</a> <a id="61" class="Symbol">(</a><a id="62" href="Data.Nat.Base.html#7285" class="Function Operator">_%_</a><a id="65" class="Symbol">;</a> <a id="67" href="Agda.Builtin.Nat.html#539" class="Primitive Operator">_*_</a><a id="70" class="Symbol">;</a> <a id="72" href="Class.HasOrder.Core.html#995" class="Function">≤-trans</a><a id="79" class="Symbol">;</a> <a id="81" href="Ledger.Prelude.html#2302" class="Function Operator">∣_∣</a><a id="84" class="Symbol">)</a>
<a id="86" class="Keyword">open</a> <a id="91" class="Keyword">import</a> <a id="98" href="Ledger.Conway.Specification.Abstract.html" class="Module">Ledger.Conway.Specification.Abstract</a>
<a id="135" class="Keyword">open</a> <a id="140" class="Keyword">import</a> <a id="147" href="Ledger.Conway.Specification.Transaction.html" class="Module">Ledger.Conway.Specification.Transaction</a>

<a id="188" class="Keyword">module</a> <a id="195" href="Ledger.Conway.Specification.Fees.html" class="Module">Ledger.Conway.Specification.Fees</a>
  <a id="230" class="Symbol">(</a><a id="231" href="Ledger.Conway.Specification.Fees.html#231" class="Bound">txs</a> <a id="235" class="Symbol">:</a> <a id="237" class="Symbol">_)</a> <a id="240" class="Symbol">(</a><a id="241" class="Keyword">open</a> <a id="246" href="Ledger.Conway.Specification.Transaction.html#1000" class="Module">TransactionStructure</a> <a id="267" href="Ledger.Conway.Specification.Fees.html#231" class="Bound">txs</a><a id="270" class="Symbol">)</a>
  <a id="274" class="Keyword">where</a>

<a id="281" class="Keyword">open</a> <a id="286" class="Keyword">import</a> <a id="293" href="Data.Rational.html" class="Module">Data.Rational</a> <a id="307" class="Keyword">using</a> <a id="313" class="Symbol">(</a><a id="314" href="Data.Rational.Base.html#4325" class="Function">0ℚ</a><a id="316" class="Symbol">;</a> <a id="318" href="Data.Rational.Base.html#1342" class="Record">ℚ</a><a id="319" class="Symbol">;</a> <a id="321" href="Data.Rational.Base.html#1960" class="Function">mkℚ+</a><a id="325" class="Symbol">;</a> <a id="327" href="Data.Rational.Base.html#6315" class="Function Operator">_*_</a><a id="330" class="Symbol">;</a> <a id="332" href="Data.Rational.Base.html#7116" class="Function">floor</a><a id="337" class="Symbol">)</a>
<a id="339" class="Keyword">open</a> <a id="344" class="Keyword">import</a> <a id="351" href="Data.Rational.Literals.html" class="Module">Data.Rational.Literals</a> <a id="374" class="Keyword">using</a> <a id="380" class="Symbol">(</a><a id="381" href="Data.Rational.Literals.html#740" class="Function">number</a><a id="387" class="Symbol">)</a>
<a id="389" class="Keyword">open</a> <a id="394" class="Keyword">import</a> <a id="401" href="Ledger.Prelude.Numeric.html" class="Module">Ledger.Prelude.Numeric</a>
<a id="424" class="Keyword">open</a> <a id="429" class="Keyword">import</a> <a id="436" href="Data.Nat.Induction.html" class="Module">Data.Nat.Induction</a> <a id="455" class="Keyword">using</a> <a id="461" class="Symbol">(</a><a id="462" href="Data.Nat.Induction.html#1604" class="Function">&lt;′-wellFounded</a><a id="476" class="Symbol">)</a>
<a id="478" class="Keyword">open</a> <a id="483" class="Keyword">import</a> <a id="490" href="Data.Nat.Properties.html" class="Module">Data.Nat.Properties</a> <a id="510" class="Keyword">using</a> <a id="516" class="Symbol">(</a><a id="517" href="Data.Nat.Properties.html#65066" class="Function">&lt;⇒&lt;′</a><a id="521" class="Symbol">;</a> <a id="523" href="Data.Nat.Properties.html#9553" class="Function">≰⇒&gt;</a><a id="526" class="Symbol">;</a> <a id="528" href="Data.Nat.Properties.html#47496" class="Function">∸-monoʳ-≤</a><a id="537" class="Symbol">;</a> <a id="539" href="Data.Nat.Properties.html#19842" class="Function">+-monoʳ-≤</a><a id="548" class="Symbol">;</a> <a id="550" href="Data.Nat.Properties.html#8707" class="Function">n≤1+n</a><a id="555" class="Symbol">;</a> <a id="557" href="Data.Nat.Properties.html#51744" class="Function">m+[n∸m]≡n</a><a id="566" class="Symbol">;</a> <a id="568" href="Data.Nat.Properties.html#5699" class="Function">≤-reflexive</a><a id="579" class="Symbol">;</a> <a id="581" href="Data.Nat.Properties.html#5988" class="Function">≤-trans</a><a id="588" class="Symbol">)</a>
<a id="590" class="Keyword">open</a> <a id="595" class="Keyword">import</a> <a id="602" href="Data.Integer.html" class="Module">Data.Integer</a> <a id="615" class="Keyword">using</a> <a id="621" class="Symbol">(</a><a id="622" href="Data.Integer.Base.html#1715" class="Function Operator">∣_∣</a><a id="625" class="Symbol">)</a>
<a id="627" class="Keyword">open</a> <a id="632" class="Keyword">import</a> <a id="639" href="Induction.WellFounded.html" class="Module">Induction.WellFounded</a> <a id="661" class="Keyword">using</a> <a id="667" class="Symbol">(</a><a id="668" href="Induction.WellFounded.html#1356" class="Datatype">Acc</a><a id="671" class="Symbol">;</a> <a id="673" href="Induction.WellFounded.html#1418" class="InductiveConstructor">acc</a><a id="676" class="Symbol">)</a>
<a id="678" class="Keyword">open</a> <a id="683" class="Keyword">import</a> <a id="690" href="Agda.Builtin.FromNat.html" class="Module">Agda.Builtin.FromNat</a> <a id="711" class="Keyword">using</a> <a id="717" class="Symbol">(</a><a id="718" href="Agda.Builtin.FromNat.html#196" class="Record">Number</a><a id="724" class="Symbol">)</a>

<a id="727" class="Keyword">open</a> <a id="732" href="Agda.Builtin.FromNat.html#196" class="Module">Number</a> <a id="739" href="Data.Rational.Literals.html#740" class="Function">number</a> <a id="746" class="Keyword">renaming</a> <a id="755" class="Symbol">(</a><a id="756" href="Agda.Builtin.FromNat.html#281" class="Field">fromNat</a> <a id="764" class="Symbol">to</a> <a id="767" class="Field">fromℕ</a><a id="772" class="Symbol">)</a>



<a id="scriptsCost"></a><a id="777" href="Ledger.Conway.Specification.Fees.html#777" class="Function">scriptsCost</a> <a id="789" class="Symbol">:</a> <a id="791" class="Symbol">(</a><a id="792" href="Ledger.Conway.Specification.Fees.html#792" class="Bound">pp</a> <a id="795" class="Symbol">:</a> <a id="797" href="Ledger.Conway.Specification.PParams.html#1728" class="Record">PParams</a><a id="804" class="Symbol">)</a> <a id="806" class="Symbol">→</a> <a id="808" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a> <a id="810" class="Symbol">→</a> <a id="812" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a>
<a id="817" href="Ledger.Conway.Specification.Fees.html#777" class="Function">scriptsCost</a> <a id="829" href="Ledger.Conway.Specification.Fees.html#829" class="Bound">pp</a> <a id="832" href="Ledger.Conway.Specification.Fees.html#832" class="Bound">scriptSize</a>
  <a id="845" class="Symbol">=</a> <a id="847" href="Ledger.Conway.Specification.Fees.html#1161" class="Function">scriptsCostAux</a> <a id="862" href="Data.Rational.Base.html#4325" class="Function">0ℚ</a> <a id="865" href="Ledger.Conway.Specification.Fees.html#966" class="Function">minFeeRefScriptCoinsPerByte</a> <a id="893" href="Ledger.Conway.Specification.Fees.html#832" class="Bound">scriptSize</a>


                  <a id="924" class="Symbol">(</a><a id="925" href="Data.Nat.Induction.html#1604" class="Function">&lt;′-wellFounded</a> <a id="940" href="Ledger.Conway.Specification.Fees.html#832" class="Bound">scriptSize</a><a id="950" class="Symbol">)</a>


  <a id="956" class="Keyword">where</a>
    <a id="966" href="Ledger.Conway.Specification.Fees.html#966" class="Function">minFeeRefScriptCoinsPerByte</a> <a id="994" class="Symbol">=</a> <a id="996" href="Ledger.Conway.Specification.PParams.html#2556" class="Field">PParams.minFeeRefScriptCoinsPerByte</a> <a id="1032" href="Ledger.Conway.Specification.Fees.html#829" class="Bound">pp</a>
    <a id="1039" href="Ledger.Conway.Specification.Fees.html#1039" class="Function">refScriptCostMultiplier</a> <a id="1063" class="Symbol">=</a> <a id="1065" href="Ledger.Conway.Specification.PParams.html#2725" class="Field">PParams.refScriptCostMultiplier</a> <a id="1097" href="Ledger.Conway.Specification.Fees.html#829" class="Bound">pp</a>
    <a id="1104" href="Ledger.Conway.Specification.Fees.html#1104" class="Function">refScriptCostStride</a> <a id="1124" class="Symbol">=</a> <a id="1126" href="Ledger.Conway.Specification.PParams.html#2682" class="Field">PParams.refScriptCostStride</a> <a id="1154" href="Ledger.Conway.Specification.Fees.html#829" class="Bound">pp</a>
    <a id="1161" href="Ledger.Conway.Specification.Fees.html#1161" class="Function">scriptsCostAux</a> <a id="1176" class="Symbol">:</a> <a id="1178" href="Data.Rational.Base.html#1342" class="Record">ℚ</a>        <a id="1187" class="Comment">-- accumulator</a>
                   <a id="1221" class="Symbol">→</a> <a id="1223" href="Data.Rational.Base.html#1342" class="Record">ℚ</a>        <a id="1232" class="Comment">-- current tier price</a>
                   <a id="1273" class="Symbol">→</a> <a id="1275" class="Symbol">(</a><a id="1276" href="Ledger.Conway.Specification.Fees.html#1276" class="Bound">n</a> <a id="1278" class="Symbol">:</a> <a id="1280" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a><a id="1281" class="Symbol">)</a>  <a id="1284" class="Comment">-- remaining script size</a>


                   <a id="1330" class="Symbol">→</a> <a id="1332" href="Induction.WellFounded.html#1356" class="Datatype">Acc</a> <a id="1336" href="Data.Nat.Base.html#7870" class="Function Operator">_&lt;′_</a> <a id="1341" href="Ledger.Conway.Specification.Fees.html#1276" class="Bound">n</a>



                   <a id="1365" class="Symbol">→</a> <a id="1367" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a>
    <a id="1376" href="Ledger.Conway.Specification.Fees.html#1161" class="Function">scriptsCostAux</a> <a id="1391" href="Ledger.Conway.Specification.Fees.html#1391" class="Bound">acl</a> <a id="1395" href="Ledger.Conway.Specification.Fees.html#1395" class="Bound">curTierPrice</a> <a id="1408" href="Ledger.Conway.Specification.Fees.html#1408" class="Bound">n</a>



       <a id="1420" class="Symbol">(</a><a id="1421" href="Induction.WellFounded.html#1418" class="InductiveConstructor">acc</a> <a id="1425" href="Ledger.Conway.Specification.Fees.html#1425" class="Bound">rs</a><a id="1427" class="Symbol">)</a>



       <a id="1439" class="Symbol">=</a> <a id="1441" href="Function.Base.html#4042" class="Function Operator">case</a>  <a id="1447" href="Ledger.Conway.Specification.Fees.html#1408" class="Bound">n</a> <a id="1449" href="Class.HasOrder.Core.html#1011" class="Function Operator">≤?</a> <a id="1452" href="Ledger.Prelude.Numeric.html#220" class="Function">fromℕ⁺</a> <a id="1459" href="Ledger.Conway.Specification.Fees.html#1104" class="Function">refScriptCostStride</a> <a id="1479" href="Function.Base.html#4042" class="Function Operator">of</a>


                <a id="1500" class="Symbol">λ</a> <a id="1502" class="Keyword">where</a>



                <a id="1527" class="Symbol">(</a><a id="1528" href="Relation.Nullary.Decidable.Core.html#1994" class="InductiveConstructor">yes</a> <a id="1532" class="Symbol">_)</a>  <a id="1536" class="Symbol">→</a> <a id="1538" href="Data.Integer.Base.html#1715" class="Function Operator">∣</a> <a id="1540" href="Data.Rational.Base.html#7116" class="Function">floor</a> <a id="1546" class="Symbol">(</a><a id="1547" href="Ledger.Conway.Specification.Fees.html#1391" class="Bound">acl</a> <a id="1551" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="1553" class="Symbol">(</a><a id="1554" href="Ledger.Conway.Specification.Fees.html#767" class="Function">fromℕ</a> <a id="1560" href="Ledger.Conway.Specification.Fees.html#1408" class="Bound">n</a> <a id="1562" href="Data.Rational.Base.html#6315" class="Function Operator">*</a> <a id="1564" href="Ledger.Conway.Specification.Fees.html#1395" class="Bound">curTierPrice</a><a id="1576" class="Symbol">))</a> <a id="1579" href="Data.Integer.Base.html#1715" class="Function Operator">∣</a>
                <a id="1597" class="Symbol">(</a><a id="1598" href="Relation.Nullary.Decidable.Core.html#2031" class="InductiveConstructor">no</a>  <a id="1602" href="Ledger.Conway.Specification.Fees.html#1602" class="Bound">p</a><a id="1603" class="Symbol">)</a>  <a id="1606" class="Symbol">→</a> <a id="1608" href="Ledger.Conway.Specification.Fees.html#1161" class="Function">scriptsCostAux</a>
                             <a id="1652" class="Symbol">(</a><a id="1653" href="Ledger.Conway.Specification.Fees.html#1391" class="Bound">acl</a> <a id="1657" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="1659" class="Symbol">(</a><a id="1660" href="Ledger.Conway.Specification.Fees.html#767" class="Function">fromℕ</a> <a id="1666" class="Symbol">(</a><a id="1667" href="Ledger.Prelude.Numeric.html#220" class="Function">fromℕ⁺</a> <a id="1674" href="Ledger.Conway.Specification.Fees.html#1104" class="Function">refScriptCostStride</a><a id="1693" class="Symbol">)</a> <a id="1695" href="Data.Rational.Base.html#6315" class="Function Operator">*</a> <a id="1697" href="Ledger.Conway.Specification.Fees.html#1395" class="Bound">curTierPrice</a><a id="1709" class="Symbol">))</a>
                             <a id="1741" class="Symbol">(</a><a id="1742" href="Ledger.Conway.Specification.Fees.html#1039" class="Function">refScriptCostMultiplier</a> <a id="1766" href="Data.Rational.Base.html#6315" class="Function Operator">*</a> <a id="1768" href="Ledger.Conway.Specification.Fees.html#1395" class="Bound">curTierPrice</a><a id="1780" class="Symbol">)</a>
                             <a id="1811" class="Symbol">(</a><a id="1812" href="Ledger.Conway.Specification.Fees.html#1408" class="Bound">n</a> <a id="1814" href="Interface.HasSubtract.html#209" class="Field Operator">-</a> <a id="1816" href="Ledger.Prelude.Numeric.html#220" class="Function">fromℕ⁺</a> <a id="1823" href="Ledger.Conway.Specification.Fees.html#1104" class="Function">refScriptCostStride</a><a id="1842" class="Symbol">)</a>



                             <a id="1876" class="Symbol">(</a><a id="1877" href="Ledger.Conway.Specification.Fees.html#1425" class="Bound">rs</a> <a id="1880" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="1882" href="Data.Nat.Properties.html#65066" class="Function">&lt;⇒&lt;′</a> <a id="1887" class="Symbol">(</a><a id="1888" href="Ledger.Conway.Specification.Fees.html#1974" class="Function">suc∸≤</a> <a id="1894" class="Symbol">(</a><a id="1895" href="Data.Nat.Properties.html#5988" class="Function">≤-trans</a> <a id="1903" class="Symbol">(</a><a id="1904" href="Data.Nat.Base.html#1919" class="InductiveConstructor">s&lt;s</a> <a id="1908" href="Data.Nat.Base.html#1720" class="InductiveConstructor">z≤n</a><a id="1911" class="Symbol">)</a> <a id="1913" class="Symbol">(</a><a id="1914" href="Data.Nat.Properties.html#9553" class="Function">≰⇒&gt;</a> <a id="1918" href="Ledger.Conway.Specification.Fees.html#1602" class="Bound">p</a><a id="1919" class="Symbol">))</a> <a id="1922" class="Symbol">(</a><a id="1923" href="Ledger.Prelude.Numeric.html#273" class="Function">ℕ⁺-&gt;0</a> <a id="1929" href="Ledger.Conway.Specification.Fees.html#1104" class="Function">refScriptCostStride</a><a id="1948" class="Symbol">)))</a>


      <a id="1960" class="Keyword">where</a>
        <a id="1974" href="Ledger.Conway.Specification.Fees.html#1974" class="Function">suc∸≤</a> <a id="1980" class="Symbol">:</a> <a id="1982" class="Symbol">∀</a> <a id="1984" class="Symbol">{</a><a id="1985" href="Ledger.Conway.Specification.Fees.html#1985" class="Bound">n</a> <a id="1987" href="Ledger.Conway.Specification.Fees.html#1987" class="Bound">m</a> <a id="1989" class="Symbol">:</a> <a id="1991" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a><a id="1992" class="Symbol">}</a> <a id="1994" class="Symbol">→</a> <a id="1996" href="Ledger.Conway.Specification.Fees.html#1985" class="Bound">n</a> <a id="1998" href="Class.HasOrder.Core.html#843" class="Function Operator">&gt;</a> <a id="2000" class="Number">0</a> <a id="2002" class="Symbol">→</a> <a id="2004" href="Ledger.Conway.Specification.Fees.html#1987" class="Bound">m</a> <a id="2006" href="Class.HasOrder.Core.html#843" class="Function Operator">&gt;</a> <a id="2008" class="Number">0</a> <a id="2010" class="Symbol">→</a> <a id="2012" href="Ledger.Conway.Specification.Fees.html#1985" class="Bound">n</a> <a id="2014" href="Data.Nat.Base.html#4462" class="Primitive Operator">∸</a> <a id="2016" href="Ledger.Conway.Specification.Fees.html#1987" class="Bound">m</a> <a id="2018" href="Class.HasOrder.Core.html#641" class="Field Operator">&lt;</a> <a id="2020" href="Ledger.Conway.Specification.Fees.html#1985" class="Bound">n</a>
        <a id="2030" href="Ledger.Conway.Specification.Fees.html#1974" class="Function">suc∸≤</a> <a id="2036" class="Symbol">{</a><a id="2037" href="Ledger.Conway.Specification.Fees.html#2037" class="Bound">n</a><a id="2038" class="Symbol">}</a> <a id="2040" class="Symbol">{.</a><a id="2042" href="Agda.Builtin.Nat.html#234" class="InductiveConstructor">suc</a> <a id="2046" href="Ledger.Conway.Specification.Fees.html#2046" class="Bound">m</a><a id="2047" class="Symbol">}</a> <a id="2049" href="Ledger.Conway.Specification.Fees.html#2049" class="Bound">p</a> <a id="2051" class="Symbol">(</a><a id="2052" href="Data.Nat.Base.html#1762" class="InductiveConstructor">s≤s</a> <a id="2056" href="Ledger.Conway.Specification.Fees.html#2056" class="Bound">q</a><a id="2057" class="Symbol">)</a> <a id="2059" class="Symbol">=</a> <a id="2061" href="Data.Nat.Properties.html#5988" class="Function">≤-trans</a> <a id="2069" class="Symbol">(</a><a id="2070" href="Data.Nat.Properties.html#19842" class="Function">+-monoʳ-≤</a> <a id="2080" class="Number">1</a> <a id="2082" class="Symbol">(</a><a id="2083" href="Data.Nat.Properties.html#47496" class="Function">∸-monoʳ-≤</a> <a id="2093" href="Ledger.Conway.Specification.Fees.html#2037" class="Bound">n</a> <a id="2095" class="Symbol">(</a><a id="2096" href="Data.Nat.Base.html#1919" class="InductiveConstructor">s&lt;s</a> <a id="2100" href="Ledger.Conway.Specification.Fees.html#2056" class="Bound">q</a><a id="2101" class="Symbol">)))</a>
                                               <a id="2152" class="Symbol">(</a><a id="2153" href="Data.Nat.Properties.html#5699" class="Function">≤-reflexive</a> <a id="2165" class="Symbol">(</a><a id="2166" href="Data.Nat.Properties.html#51744" class="Function">m+[n∸m]≡n</a> <a id="2176" href="Ledger.Conway.Specification.Fees.html#2049" class="Bound">p</a><a id="2177" class="Symbol">))</a>

</pre></body></html>