<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>Ledger.Conway.Specification.Epoch</title><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.css"><link rel="stylesheet" href="Agda.css"><script src="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.js"></script><script src="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/contrib/auto-render.min.js"></script><script src="AgdaKaTeX.js" defer=""></script></head><body><pre class="Agda">
<a id="2" class="Symbol">{-#</a> <a id="6" class="Keyword">OPTIONS</a> <a id="14" class="Pragma">--safe</a> <a id="21" class="Symbol">#-}</a>

<a id="26" class="Keyword">open</a> <a id="31" class="Keyword">import</a> <a id="38" href="Data.Integer.html" class="Module">Data.Integer</a> <a id="51" class="Keyword">using</a> <a id="57" class="Symbol">()</a> <a id="60" class="Keyword">renaming</a> <a id="69" class="Symbol">(</a><a id="70" href="Agda.Builtin.Int.html#263" class="InductiveConstructor">+_</a> <a id="73" class="Symbol">to</a> <a id="76" class="InductiveConstructor">pos</a><a id="79" class="Symbol">)</a>
<a id="81" class="Keyword">import</a>      <a id="93" href="Data.Integer.html" class="Module">Data.Integer</a> <a id="106" class="Symbol">as</a> <a id="109" class="Module">ℤ</a>
<a id="111" class="Keyword">open</a> <a id="116" class="Keyword">import</a> <a id="123" href="Data.Integer.Properties.html" class="Module">Data.Integer.Properties</a> <a id="147" class="Keyword">using</a> <a id="153" class="Symbol">(</a><a id="154" class="Keyword">module</a> <a id="161" href="Data.Integer.Properties.html#11881" class="Module">≤-Reasoning</a><a id="172" class="Symbol">;</a> <a id="174" href="Data.Integer.Properties.html#34810" class="Function">+-mono-≤</a><a id="182" class="Symbol">;</a> <a id="184" href="Data.Integer.Properties.html#13298" class="Function">neg-mono-≤</a><a id="194" class="Symbol">;</a> <a id="196" href="Data.Integer.Properties.html#27061" class="Function">+-identityˡ</a><a id="207" class="Symbol">)</a>
                                    <a id="245" class="Keyword">renaming</a> <a id="254" class="Symbol">(</a><a id="255" href="Data.Integer.Properties.html#12508" class="Function">nonNegative⁻¹</a> <a id="269" class="Symbol">to</a> <a id="272" class="Function">nonNegative⁻¹ℤ</a><a id="286" class="Symbol">)</a>
<a id="288" class="Keyword">open</a> <a id="293" class="Keyword">import</a> <a id="300" href="Data.Nat.GeneralisedArithmetic.html" class="Module">Data.Nat.GeneralisedArithmetic</a> <a id="331" class="Keyword">using</a> <a id="337" class="Symbol">(</a><a id="338" href="Data.Nat.GeneralisedArithmetic.html#866" class="Function">iterate</a><a id="345" class="Symbol">)</a>
<a id="347" class="Keyword">open</a> <a id="352" class="Keyword">import</a> <a id="359" href="Data.Rational.html" class="Module">Data.Rational</a> <a id="373" class="Keyword">using</a> <a id="379" class="Symbol">(</a><a id="380" href="Data.Rational.Base.html#1421" class="Record">ℚ</a><a id="381" class="Symbol">;</a> <a id="383" href="Data.Rational.Base.html#7195" class="Function">floor</a><a id="388" class="Symbol">;</a> <a id="390" href="Data.Rational.Base.html#6394" class="Function Operator">_*_</a><a id="393" class="Symbol">;</a> <a id="395" href="Data.Rational.Base.html#6787" class="Function Operator">_÷_</a><a id="398" class="Symbol">;</a> <a id="400" href="Data.Rational.Base.html#3963" class="Function Operator">_/_</a><a id="403" class="Symbol">;</a> <a id="405" href="Data.Rational.Base.html#6933" class="Function Operator">_⊓_</a><a id="408" class="Symbol">;</a> <a id="410" href="Data.Rational.Properties.html#4152" class="Function Operator">_≟_</a><a id="413" class="Symbol">;</a> <a id="415" href="Data.Rational.Base.html#4971" class="Function">≢-nonZero</a><a id="424" class="Symbol">)</a>
<a id="426" class="Keyword">open</a> <a id="431" class="Keyword">import</a> <a id="438" href="Data.Rational.Literals.html" class="Module">Data.Rational.Literals</a> <a id="461" class="Keyword">using</a> <a id="467" class="Symbol">(</a><a id="468" href="Data.Rational.Literals.html#740" class="Function">number</a><a id="474" class="Symbol">;</a> <a id="476" href="Data.Rational.Literals.html#613" class="Function">fromℤ</a><a id="481" class="Symbol">)</a>
<a id="483" class="Keyword">open</a> <a id="488" class="Keyword">import</a> <a id="495" href="Data.Rational.Properties.html" class="Module">Data.Rational.Properties</a> <a id="520" class="Keyword">using</a> <a id="526" class="Symbol">(</a><a id="527" href="Data.Rational.Properties.html#27061" class="Function">nonNegative⁻¹</a><a id="540" class="Symbol">;</a> <a id="542" href="Data.Rational.Properties.html#7555" class="Function">pos⇒nonNeg</a><a id="552" class="Symbol">;</a> <a id="554" href="Algebra.Construct.NaturalChoice.MinOp.html#7120" class="Function">⊓-glb</a><a id="559" class="Symbol">)</a>
<a id="561" class="Keyword">open</a> <a id="566" class="Keyword">import</a> <a id="573" href="stdlib.Data.Rational.Properties.html" class="Module">stdlib.Data.Rational.Properties</a> <a id="605" class="Keyword">using</a> <a id="611" class="Symbol">(</a><a id="612" href="stdlib.Data.Rational.Properties.html#1631" class="Function">0≤⇒0≤floor</a><a id="622" class="Symbol">;</a> <a id="624" href="stdlib.Data.Rational.Properties.html#2865" class="Function">÷-0≤⇒0≤</a><a id="631" class="Symbol">;</a> <a id="633" href="stdlib.Data.Rational.Properties.html#2275" class="Function">fromℕ-0≤</a><a id="641" class="Symbol">;</a> <a id="643" href="stdlib.Data.Rational.Properties.html#2409" class="Function">*-0≤⇒0≤</a><a id="650" class="Symbol">;</a> <a id="652" href="stdlib.Data.Rational.Properties.html#2013" class="Function">fromℤ-0≤</a><a id="660" class="Symbol">)</a>

<a id="663" class="Keyword">open</a> <a id="668" class="Keyword">import</a> <a id="675" href="Data.Integer.Tactic.RingSolver.html" class="Module">Data.Integer.Tactic.RingSolver</a> <a id="706" class="Keyword">using</a> <a id="712" class="Symbol">(</a><a id="713" href="Data.Integer.Tactic.RingSolver.html#1200" class="Macro">solve-∀</a><a id="720" class="Symbol">)</a>

<a id="723" class="Keyword">open</a> <a id="728" class="Keyword">import</a> <a id="735" href="Agda.Builtin.FromNat.html" class="Module">Agda.Builtin.FromNat</a>

<a id="757" class="Keyword">open</a> <a id="762" class="Keyword">import</a> <a id="769" href="Ledger.Prelude.html" class="Module">Ledger.Prelude</a> <a id="784" class="Keyword">hiding</a> <a id="791" class="Symbol">(</a><a id="792" href="Data.List.Base.html#5114" class="Function">iterate</a><a id="799" class="Symbol">;</a> <a id="801" href="Data.Nat.Base.html#7102" class="Function Operator">_/_</a><a id="804" class="Symbol">;</a> <a id="806" href="Agda.Builtin.Nat.html#539" class="Primitive Operator">_*_</a><a id="809" class="Symbol">;</a> <a id="811" href="Data.Nat.Base.html#5851" class="Function Operator">_⊓_</a><a id="814" class="Symbol">;</a> <a id="816" href="Class.DecEq.Core.html#168" class="Field Operator">_≟_</a><a id="819" class="Symbol">;</a> <a id="821" href="Data.Nat.Base.html#3425" class="Function">≢-nonZero</a><a id="830" class="Symbol">)</a>
<a id="832" class="Keyword">open</a> <a id="837" href="Ledger.Prelude.html#2387" class="Module">Filter</a> <a id="844" class="Keyword">using</a> <a id="850" class="Symbol">(</a><a id="851" href="Ledger.Prelude.html#2402" class="Function">filter</a><a id="857" class="Symbol">)</a>
<a id="859" class="Keyword">open</a> <a id="864" class="Keyword">import</a> <a id="871" href="Ledger.Conway.Specification.Abstract.html" class="Module">Ledger.Conway.Specification.Abstract</a>
<a id="908" class="Keyword">open</a> <a id="913" class="Keyword">import</a> <a id="920" href="Ledger.Conway.Specification.Transaction.html" class="Module">Ledger.Conway.Specification.Transaction</a>
<a id="960" class="Keyword">open</a> <a id="965" class="Keyword">import</a> <a id="972" href="Ledger.Prelude.Numeric.UnitInterval.html" class="Module">Ledger.Prelude.Numeric.UnitInterval</a> <a id="1008" class="Keyword">using</a> <a id="1014" class="Symbol">(</a><a id="1015" href="Ledger.Prelude.Numeric.UnitInterval.html#1988" class="Function">fromUnitInterval</a><a id="1031" class="Symbol">;</a> <a id="1033" href="Ledger.Prelude.Numeric.UnitInterval.html#3336" class="Function">UnitInterval-*-0≤</a><a id="1050" class="Symbol">)</a>

<a id="1053" class="Keyword">open</a> <a id="1058" href="Agda.Builtin.FromNat.html#196" class="Module">Number</a> <a id="1065" href="Data.Rational.Literals.html#740" class="Function">number</a> <a id="1072" class="Keyword">renaming</a> <a id="1081" class="Symbol">(</a><a id="1082" href="Agda.Builtin.FromNat.html#281" class="Field">fromNat</a> <a id="1090" class="Symbol">to</a> <a id="1093" class="Field">fromℕ</a><a id="1098" class="Symbol">)</a>

<a id="1101" class="Keyword">module</a> <a id="1108" href="Ledger.Conway.Specification.Epoch.html" class="Module">Ledger.Conway.Specification.Epoch</a>
  <a id="1144" class="Symbol">(</a><a id="1145" href="Ledger.Conway.Specification.Epoch.html#1145" class="Bound">txs</a> <a id="1149" class="Symbol">:</a> <a id="1151" class="Symbol">_)</a> <a id="1154" class="Symbol">(</a><a id="1155" class="Keyword">open</a> <a id="1160" href="Ledger.Conway.Specification.Transaction.html#1000" class="Module">TransactionStructure</a> <a id="1181" href="Ledger.Conway.Specification.Epoch.html#1145" class="Bound">txs</a><a id="1184" class="Symbol">)</a>
  <a id="1188" class="Symbol">(</a><a id="1189" href="Ledger.Conway.Specification.Epoch.html#1189" class="Bound">abs</a> <a id="1193" class="Symbol">:</a> <a id="1195" href="Ledger.Conway.Specification.Abstract.html#654" class="Record">AbstractFunctions</a> <a id="1213" href="Ledger.Conway.Specification.Epoch.html#1145" class="Bound">txs</a><a id="1216" class="Symbol">)</a> <a id="1218" class="Symbol">(</a><a id="1219" class="Keyword">open</a> <a id="1224" href="Ledger.Conway.Specification.Abstract.html#654" class="Module">AbstractFunctions</a> <a id="1242" href="Ledger.Conway.Specification.Epoch.html#1189" class="Bound">abs</a><a id="1245" class="Symbol">)</a>
  <a id="1249" class="Keyword">where</a>

<a id="1256" class="Keyword">open</a> <a id="1261" class="Keyword">import</a> <a id="1268" href="Ledger.Conway.Specification.Certs.html" class="Module">Ledger.Conway.Specification.Certs</a> <a id="1302" href="Ledger.Conway.Specification.Transaction.html#2079" class="Function">govStructure</a>
<a id="1315" class="Keyword">open</a> <a id="1320" class="Keyword">import</a> <a id="1327" href="Ledger.Conway.Specification.Enact.html" class="Module">Ledger.Conway.Specification.Enact</a> <a id="1361" href="Ledger.Conway.Specification.Transaction.html#2079" class="Function">govStructure</a>
<a id="1374" class="Keyword">open</a> <a id="1379" class="Keyword">import</a> <a id="1386" href="Ledger.Conway.Specification.Gov.html" class="Module">Ledger.Conway.Specification.Gov</a> <a id="1418" href="Ledger.Conway.Specification.Epoch.html#1145" class="Bound">txs</a>
<a id="1422" class="Keyword">open</a> <a id="1427" class="Keyword">import</a> <a id="1434" href="Ledger.Conway.Specification.Ledger.html" class="Module">Ledger.Conway.Specification.Ledger</a> <a id="1469" href="Ledger.Conway.Specification.Epoch.html#1145" class="Bound">txs</a> <a id="1473" href="Ledger.Conway.Specification.Epoch.html#1189" class="Bound">abs</a>
<a id="1477" class="Keyword">open</a> <a id="1482" class="Keyword">import</a> <a id="1489" href="Ledger.Conway.Specification.PoolReap.html" class="Module">Ledger.Conway.Specification.PoolReap</a> <a id="1526" href="Ledger.Conway.Specification.Epoch.html#1145" class="Bound">txs</a> <a id="1530" href="Ledger.Conway.Specification.Epoch.html#1189" class="Bound">abs</a>
<a id="1534" class="Keyword">open</a> <a id="1539" class="Keyword">import</a> <a id="1546" href="Ledger.Conway.Specification.Ratify.html" class="Module">Ledger.Conway.Specification.Ratify</a> <a id="1581" href="Ledger.Conway.Specification.Epoch.html#1145" class="Bound">txs</a>
<a id="1585" class="Keyword">open</a> <a id="1590" class="Keyword">import</a> <a id="1597" href="Ledger.Conway.Specification.Rewards.html" class="Module">Ledger.Conway.Specification.Rewards</a> <a id="1633" href="Ledger.Conway.Specification.Epoch.html#1145" class="Bound">txs</a> <a id="1637" href="Ledger.Conway.Specification.Epoch.html#1189" class="Bound">abs</a>
<a id="1641" class="Keyword">open</a> <a id="1646" class="Keyword">import</a> <a id="1653" href="Ledger.Conway.Specification.Utxo.html" class="Module">Ledger.Conway.Specification.Utxo</a> <a id="1686" href="Ledger.Conway.Specification.Epoch.html#1145" class="Bound">txs</a> <a id="1690" href="Ledger.Conway.Specification.Epoch.html#1189" class="Bound">abs</a>


<a id="1696" class="Keyword">record</a> <a id="EpochState"></a><a id="1703" href="Ledger.Conway.Specification.Epoch.html#1703" class="Record">EpochState</a> <a id="1714" class="Symbol">:</a> <a id="1716" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="1721" class="Keyword">where</a>


  <a id="1731" class="Keyword">constructor</a> <a id="⟦_,_,_,_,_⟧ᵉ&#39;"></a><a id="1743" href="Ledger.Conway.Specification.Epoch.html#1743" class="InductiveConstructor Operator">⟦_,_,_,_,_⟧ᵉ&#39;</a>


  <a id="1761" class="Keyword">field</a>
    <a id="EpochState.acnt"></a><a id="1771" href="Ledger.Conway.Specification.Epoch.html#1771" class="Field">acnt</a>       <a id="1782" class="Symbol">:</a> <a id="1784" href="Ledger.Conway.Specification.PParams.html#720" class="Record">Acnt</a>
    <a id="EpochState.ss"></a><a id="1793" href="Ledger.Conway.Specification.Epoch.html#1793" class="Field">ss</a>         <a id="1804" class="Symbol">:</a> <a id="1806" href="Ledger.Conway.Specification.Rewards.html#7745" class="Record">Snapshots</a>
    <a id="EpochState.ls"></a><a id="1820" href="Ledger.Conway.Specification.Epoch.html#1820" class="Field">ls</a>         <a id="1831" class="Symbol">:</a> <a id="1833" href="Ledger.Conway.Specification.Ledger.html#979" class="Record">LState</a>
    <a id="EpochState.es"></a><a id="1844" href="Ledger.Conway.Specification.Epoch.html#1844" class="Field">es</a>         <a id="1855" class="Symbol">:</a> <a id="1857" href="Ledger.Conway.Specification.Enact.html#448" class="Record">EnactState</a>
    <a id="EpochState.fut"></a><a id="1872" href="Ledger.Conway.Specification.Epoch.html#1872" class="Field">fut</a>        <a id="1883" class="Symbol">:</a> <a id="1885" href="Ledger.Conway.Specification.Ratify.html#3374" class="Record">RatifyState</a>


<a id="1899" class="Keyword">record</a> <a id="HasEpochState"></a><a id="1906" href="Ledger.Conway.Specification.Epoch.html#1906" class="Record">HasEpochState</a> <a id="1920" class="Symbol">{</a><a id="1921" href="Ledger.Conway.Specification.Epoch.html#1921" class="Bound">a</a><a id="1922" class="Symbol">}</a> <a id="1924" class="Symbol">(</a><a id="1925" href="Ledger.Conway.Specification.Epoch.html#1925" class="Bound">A</a> <a id="1927" class="Symbol">:</a> <a id="1929" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="1934" href="Ledger.Conway.Specification.Epoch.html#1921" class="Bound">a</a><a id="1935" class="Symbol">)</a> <a id="1937" class="Symbol">:</a> <a id="1939" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="1944" href="Ledger.Conway.Specification.Epoch.html#1921" class="Bound">a</a> <a id="1946" class="Keyword">where</a>
  <a id="1954" class="Keyword">field</a> <a id="HasEpochState.EpochStateOf"></a><a id="1960" href="Ledger.Conway.Specification.Epoch.html#1960" class="Field">EpochStateOf</a> <a id="1973" class="Symbol">:</a> <a id="1975" href="Ledger.Conway.Specification.Epoch.html#1925" class="Bound">A</a> <a id="1977" class="Symbol">→</a> <a id="1979" href="Ledger.Conway.Specification.Epoch.html#1703" class="Record">EpochState</a>
<a id="1990" class="Keyword">open</a> <a id="1995" href="Ledger.Conway.Specification.Epoch.html#1906" class="Module">HasEpochState</a> <a id="2009" class="Symbol">⦃...⦄</a> <a id="2015" class="Keyword">public</a>

<a id="2023" class="Keyword">instance</a>
  <a id="HasSnapshots-EpochState"></a><a id="2034" href="Ledger.Conway.Specification.Epoch.html#2034" class="Function">HasSnapshots-EpochState</a> <a id="2058" class="Symbol">:</a> <a id="2060" href="Ledger.Conway.Specification.Rewards.html#7836" class="Record">HasSnapshots</a> <a id="2073" href="Ledger.Conway.Specification.Epoch.html#1703" class="Record">EpochState</a>
  <a id="2086" href="Ledger.Conway.Specification.Epoch.html#2034" class="Function">HasSnapshots-EpochState</a> <a id="2110" class="Symbol">.</a><a id="2111" href="Ledger.Conway.Specification.Rewards.html#7889" class="Field">SnapshotsOf</a> <a id="2123" class="Symbol">=</a> <a id="2125" href="Ledger.Conway.Specification.Epoch.html#1793" class="Field">EpochState.ss</a>

  <a id="HasLState-EpochState"></a><a id="2142" href="Ledger.Conway.Specification.Epoch.html#2142" class="Function">HasLState-EpochState</a> <a id="2163" class="Symbol">:</a> <a id="2165" href="Ledger.Conway.Specification.Ledger.html#1123" class="Record">HasLState</a> <a id="2175" href="Ledger.Conway.Specification.Epoch.html#1703" class="Record">EpochState</a>
  <a id="2188" href="Ledger.Conway.Specification.Epoch.html#2142" class="Function">HasLState-EpochState</a> <a id="2209" class="Symbol">.</a><a id="2210" href="Ledger.Conway.Specification.Ledger.html#1173" class="Field">LStateOf</a> <a id="2219" class="Symbol">=</a> <a id="2221" href="Ledger.Conway.Specification.Epoch.html#1820" class="Field">EpochState.ls</a>

  <a id="HasEnactState-EpochState"></a><a id="2238" href="Ledger.Conway.Specification.Epoch.html#2238" class="Function">HasEnactState-EpochState</a> <a id="2263" class="Symbol">:</a> <a id="2265" href="Ledger.Conway.Specification.Enact.html#737" class="Record">HasEnactState</a> <a id="2279" href="Ledger.Conway.Specification.Epoch.html#1703" class="Record">EpochState</a>
  <a id="2292" href="Ledger.Conway.Specification.Epoch.html#2238" class="Function">HasEnactState-EpochState</a> <a id="2317" class="Symbol">.</a><a id="2318" href="Ledger.Conway.Specification.Enact.html#791" class="Field">EnactStateOf</a> <a id="2331" class="Symbol">=</a> <a id="2333" href="Ledger.Conway.Specification.Epoch.html#1844" class="Field">EpochState.es</a>

  <a id="HasDeposits-EpochState"></a><a id="2350" href="Ledger.Conway.Specification.Epoch.html#2350" class="Function">HasDeposits-EpochState</a> <a id="2373" class="Symbol">:</a> <a id="2375" href="Ledger.Conway.Specification.Certs.html#847" class="Record">HasDeposits</a> <a id="2387" href="Ledger.Conway.Specification.Epoch.html#1703" class="Record">EpochState</a>
  <a id="2400" href="Ledger.Conway.Specification.Epoch.html#2350" class="Function">HasDeposits-EpochState</a> <a id="2423" class="Symbol">.</a><a id="2424" href="Ledger.Conway.Specification.Certs.html#899" class="Field">DepositsOf</a> <a id="2435" class="Symbol">=</a> <a id="2437" href="Ledger.Conway.Specification.Certs.html#899" class="Field">DepositsOf</a> <a id="2448" href="Function.Base.html#1134" class="Function Operator">∘</a> <a id="2450" href="Ledger.Conway.Specification.Ledger.html#1173" class="Field">LStateOf</a>

  <a id="HasTreasury-EpochState"></a><a id="2462" href="Ledger.Conway.Specification.Epoch.html#2462" class="Function">HasTreasury-EpochState</a> <a id="2485" class="Symbol">:</a> <a id="2487" href="Ledger.Prelude.Base.html#837" class="Record">HasTreasury</a> <a id="2499" href="Ledger.Conway.Specification.Epoch.html#1703" class="Record">EpochState</a>
  <a id="2512" href="Ledger.Conway.Specification.Epoch.html#2462" class="Function">HasTreasury-EpochState</a> <a id="2535" class="Symbol">.</a><a id="2536" href="Ledger.Prelude.Base.html#889" class="Field">TreasuryOf</a> <a id="2547" class="Symbol">=</a> <a id="2549" href="Ledger.Conway.Specification.PParams.html#775" class="Field">Acnt.treasury</a> <a id="2563" href="Function.Base.html#1134" class="Function Operator">∘</a> <a id="2565" href="Ledger.Conway.Specification.Epoch.html#1771" class="Field">EpochState.acnt</a>

  <a id="HasReserves-EpochState"></a><a id="2584" href="Ledger.Conway.Specification.Epoch.html#2584" class="Function">HasReserves-EpochState</a> <a id="2607" class="Symbol">:</a> <a id="2609" href="Ledger.Prelude.Base.html#721" class="Record">HasReserves</a> <a id="2621" href="Ledger.Conway.Specification.Epoch.html#1703" class="Record">EpochState</a>
  <a id="2634" href="Ledger.Conway.Specification.Epoch.html#2584" class="Function">HasReserves-EpochState</a> <a id="2657" class="Symbol">.</a><a id="2658" href="Ledger.Prelude.Base.html#773" class="Field">ReservesOf</a> <a id="2669" class="Symbol">=</a> <a id="2671" href="Ledger.Conway.Specification.PParams.html#784" class="Field">Acnt.reserves</a> <a id="2685" href="Function.Base.html#1134" class="Function Operator">∘</a> <a id="2687" href="Ledger.Conway.Specification.Epoch.html#1771" class="Field">EpochState.acnt</a>

  <a id="HasPParams-EpochState"></a><a id="2706" href="Ledger.Conway.Specification.Epoch.html#2706" class="Function">HasPParams-EpochState</a> <a id="2728" class="Symbol">:</a> <a id="2730" href="Ledger.Conway.Specification.PParams.html#3489" class="Record">HasPParams</a> <a id="2741" href="Ledger.Conway.Specification.Epoch.html#1703" class="Record">EpochState</a>
  <a id="2754" href="Ledger.Conway.Specification.Epoch.html#2706" class="Function">HasPParams-EpochState</a> <a id="2776" class="Symbol">.</a><a id="2777" href="Ledger.Conway.Specification.PParams.html#3540" class="Field">PParamsOf</a> <a id="2787" class="Symbol">=</a> <a id="2789" href="Ledger.Conway.Specification.PParams.html#3540" class="Field">PParamsOf</a> <a id="2799" href="Function.Base.html#1134" class="Function Operator">∘</a> <a id="2801" href="Ledger.Conway.Specification.Enact.html#791" class="Field">EnactStateOf</a>

  <a id="HasRatifyState-EpochState"></a><a id="2817" href="Ledger.Conway.Specification.Epoch.html#2817" class="Function">HasRatifyState-EpochState</a> <a id="2843" class="Symbol">:</a> <a id="2845" href="Ledger.Conway.Specification.Ratify.html#3531" class="Record">HasRatifyState</a> <a id="2860" href="Ledger.Conway.Specification.Epoch.html#1703" class="Record">EpochState</a>
  <a id="2873" href="Ledger.Conway.Specification.Epoch.html#2817" class="Function">HasRatifyState-EpochState</a> <a id="2899" class="Symbol">.</a><a id="2900" href="Ledger.Conway.Specification.Ratify.html#3586" class="Field">RatifyStateOf</a> <a id="2914" class="Symbol">=</a> <a id="2916" href="Ledger.Conway.Specification.Epoch.html#1872" class="Field">EpochState.fut</a>

  <a id="HasPState-EpochState"></a><a id="2934" href="Ledger.Conway.Specification.Epoch.html#2934" class="Function">HasPState-EpochState</a> <a id="2955" class="Symbol">:</a> <a id="2957" href="Ledger.Conway.Specification.Certs.html#4595" class="Record">HasPState</a> <a id="2967" href="Ledger.Conway.Specification.Epoch.html#1703" class="Record">EpochState</a>
  <a id="2980" href="Ledger.Conway.Specification.Epoch.html#2934" class="Function">HasPState-EpochState</a> <a id="3001" class="Symbol">.</a><a id="3002" href="Ledger.Conway.Specification.Certs.html#4645" class="Field">PStateOf</a> <a id="3011" class="Symbol">=</a> <a id="3013" href="Ledger.Conway.Specification.Certs.html#4645" class="Field">PStateOf</a> <a id="3022" href="Function.Base.html#1134" class="Function Operator">∘</a> <a id="3024" href="Ledger.Conway.Specification.Certs.html#4864" class="Field">CertStateOf</a> <a id="3036" href="Function.Base.html#1134" class="Function Operator">∘</a> <a id="3038" href="Ledger.Conway.Specification.Ledger.html#1173" class="Field">LStateOf</a>


<a id="PoolDelegatedStake"></a><a id="3049" href="Ledger.Conway.Specification.Epoch.html#3049" class="Function">PoolDelegatedStake</a> <a id="3068" class="Symbol">:</a> <a id="3070" href="Agda.Primitive.html#388" class="Primitive">Type</a>
<a id="3075" href="Ledger.Conway.Specification.Epoch.html#3049" class="Function">PoolDelegatedStake</a> <a id="3094" class="Symbol">=</a> <a id="3096" href="Ledger.Core.Specification.Crypto.html#1386" class="Function">KeyHash</a> <a id="3104" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="3106" href="Ledger.Prelude.Base.html#154" class="Function">Coin</a>

<a id="3112" class="Keyword">record</a> <a id="NewEpochState"></a><a id="3119" href="Ledger.Conway.Specification.Epoch.html#3119" class="Record">NewEpochState</a> <a id="3133" class="Symbol">:</a> <a id="3135" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="3140" class="Keyword">where</a>
  <a id="3148" class="Keyword">field</a>
    <a id="NewEpochState.lastEpoch"></a><a id="3158" href="Ledger.Conway.Specification.Epoch.html#3158" class="Field">lastEpoch</a>   <a id="3170" class="Symbol">:</a> <a id="3172" href="Ledger.Core.Specification.Epoch.html#598" class="Function">Epoch</a>
    <a id="NewEpochState.bprev"></a><a id="3182" href="Ledger.Conway.Specification.Epoch.html#3182" class="Field">bprev</a>       <a id="3194" class="Symbol">:</a> <a id="3196" href="Ledger.Conway.Specification.Rewards.html#4867" class="Function">BlocksMade</a>
    <a id="NewEpochState.bcur"></a><a id="3211" href="Ledger.Conway.Specification.Epoch.html#3211" class="Field">bcur</a>        <a id="3223" class="Symbol">:</a> <a id="3225" href="Ledger.Conway.Specification.Rewards.html#4867" class="Function">BlocksMade</a>
    <a id="NewEpochState.epochState"></a><a id="3240" href="Ledger.Conway.Specification.Epoch.html#3240" class="Field">epochState</a>  <a id="3252" class="Symbol">:</a> <a id="3254" href="Ledger.Conway.Specification.Epoch.html#1703" class="Record">EpochState</a>
    <a id="NewEpochState.ru"></a><a id="3269" href="Ledger.Conway.Specification.Epoch.html#3269" class="Field">ru</a>          <a id="3281" class="Symbol">:</a> <a id="3283" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="3289" href="Ledger.Conway.Specification.Rewards.html#6210" class="Record">RewardUpdate</a>
    <a id="NewEpochState.pd"></a><a id="3306" href="Ledger.Conway.Specification.Epoch.html#3306" class="Field">pd</a>          <a id="3318" class="Symbol">:</a> <a id="3320" href="Ledger.Conway.Specification.Epoch.html#3049" class="Function">PoolDelegatedStake</a>


<a id="3341" class="Keyword">record</a> <a id="HasNewEpochState"></a><a id="3348" href="Ledger.Conway.Specification.Epoch.html#3348" class="Record">HasNewEpochState</a> <a id="3365" class="Symbol">{</a><a id="3366" href="Ledger.Conway.Specification.Epoch.html#3366" class="Bound">a</a><a id="3367" class="Symbol">}</a> <a id="3369" class="Symbol">(</a><a id="3370" href="Ledger.Conway.Specification.Epoch.html#3370" class="Bound">A</a> <a id="3372" class="Symbol">:</a> <a id="3374" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="3379" href="Ledger.Conway.Specification.Epoch.html#3366" class="Bound">a</a><a id="3380" class="Symbol">)</a> <a id="3382" class="Symbol">:</a> <a id="3384" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="3389" href="Ledger.Conway.Specification.Epoch.html#3366" class="Bound">a</a> <a id="3391" class="Keyword">where</a>
  <a id="3399" class="Keyword">field</a> <a id="HasNewEpochState.NewEpochStateOf"></a><a id="3405" href="Ledger.Conway.Specification.Epoch.html#3405" class="Field">NewEpochStateOf</a> <a id="3421" class="Symbol">:</a> <a id="3423" href="Ledger.Conway.Specification.Epoch.html#3370" class="Bound">A</a> <a id="3425" class="Symbol">→</a> <a id="3427" href="Ledger.Conway.Specification.Epoch.html#3119" class="Record">NewEpochState</a>
<a id="3441" class="Keyword">open</a> <a id="3446" href="Ledger.Conway.Specification.Epoch.html#3348" class="Module">HasNewEpochState</a> <a id="3463" class="Symbol">⦃...⦄</a> <a id="3469" class="Keyword">public</a>
<a id="3476" class="Keyword">record</a> <a id="HasLastEpoch"></a><a id="3483" href="Ledger.Conway.Specification.Epoch.html#3483" class="Record">HasLastEpoch</a>     <a id="3500" class="Symbol">{</a><a id="3501" href="Ledger.Conway.Specification.Epoch.html#3501" class="Bound">a</a><a id="3502" class="Symbol">}</a> <a id="3504" class="Symbol">(</a><a id="3505" href="Ledger.Conway.Specification.Epoch.html#3505" class="Bound">A</a> <a id="3507" class="Symbol">:</a> <a id="3509" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="3514" href="Ledger.Conway.Specification.Epoch.html#3501" class="Bound">a</a><a id="3515" class="Symbol">)</a> <a id="3517" class="Symbol">:</a> <a id="3519" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="3524" href="Ledger.Conway.Specification.Epoch.html#3501" class="Bound">a</a> <a id="3526" class="Keyword">where</a> <a id="3532" class="Keyword">field</a> <a id="HasLastEpoch.LastEpochOf"></a><a id="3538" href="Ledger.Conway.Specification.Epoch.html#3538" class="Field">LastEpochOf</a>     <a id="3554" class="Symbol">:</a> <a id="3556" href="Ledger.Conway.Specification.Epoch.html#3505" class="Bound">A</a> <a id="3558" class="Symbol">→</a> <a id="3560" href="Ledger.Core.Specification.Epoch.html#598" class="Function">Epoch</a>
<a id="3566" class="Keyword">open</a> <a id="3571" href="Ledger.Conway.Specification.Epoch.html#3483" class="Module">HasLastEpoch</a>     <a id="3588" class="Symbol">⦃...⦄</a> <a id="3594" class="Keyword">public</a>

<a id="3602" class="Keyword">instance</a>
  <a id="HasLastEpoch-NewEpochState"></a><a id="3613" href="Ledger.Conway.Specification.Epoch.html#3613" class="Function">HasLastEpoch-NewEpochState</a> <a id="3640" class="Symbol">:</a> <a id="3642" href="Ledger.Conway.Specification.Epoch.html#3483" class="Record">HasLastEpoch</a> <a id="3655" href="Ledger.Conway.Specification.Epoch.html#3119" class="Record">NewEpochState</a>
  <a id="3671" href="Ledger.Conway.Specification.Epoch.html#3613" class="Function">HasLastEpoch-NewEpochState</a> <a id="3698" class="Symbol">.</a><a id="3699" href="Ledger.Conway.Specification.Epoch.html#3538" class="Field">LastEpochOf</a> <a id="3711" class="Symbol">=</a> <a id="3713" href="Ledger.Conway.Specification.Epoch.html#3158" class="Field">NewEpochState.lastEpoch</a>

  <a id="HasEpochState-NewEpochState"></a><a id="3740" href="Ledger.Conway.Specification.Epoch.html#3740" class="Function">HasEpochState-NewEpochState</a> <a id="3768" class="Symbol">:</a> <a id="3770" href="Ledger.Conway.Specification.Epoch.html#1906" class="Record">HasEpochState</a> <a id="3784" href="Ledger.Conway.Specification.Epoch.html#3119" class="Record">NewEpochState</a>
  <a id="3800" href="Ledger.Conway.Specification.Epoch.html#3740" class="Function">HasEpochState-NewEpochState</a> <a id="3828" class="Symbol">.</a><a id="3829" href="Ledger.Conway.Specification.Epoch.html#1960" class="Field">EpochStateOf</a> <a id="3842" class="Symbol">=</a> <a id="3844" href="Ledger.Conway.Specification.Epoch.html#3240" class="Field">NewEpochState.epochState</a>

  <a id="HasEnactState-NewEpochState"></a><a id="3872" href="Ledger.Conway.Specification.Epoch.html#3872" class="Function">HasEnactState-NewEpochState</a> <a id="3900" class="Symbol">:</a> <a id="3902" href="Ledger.Conway.Specification.Enact.html#737" class="Record">HasEnactState</a> <a id="3916" href="Ledger.Conway.Specification.Epoch.html#3119" class="Record">NewEpochState</a>
  <a id="3932" href="Ledger.Conway.Specification.Epoch.html#3872" class="Function">HasEnactState-NewEpochState</a> <a id="3960" class="Symbol">.</a><a id="3961" href="Ledger.Conway.Specification.Enact.html#791" class="Field">EnactStateOf</a> <a id="3974" class="Symbol">=</a> <a id="3976" href="Ledger.Conway.Specification.Enact.html#791" class="Field">EnactStateOf</a> <a id="3989" href="Function.Base.html#1134" class="Function Operator">∘</a> <a id="3991" href="Ledger.Conway.Specification.Epoch.html#1960" class="Field">EpochStateOf</a>

  <a id="Hastreasury-NewEpochState"></a><a id="4007" href="Ledger.Conway.Specification.Epoch.html#4007" class="Function">Hastreasury-NewEpochState</a> <a id="4033" class="Symbol">:</a> <a id="4035" href="Ledger.Prelude.Base.html#837" class="Record">HasTreasury</a> <a id="4047" href="Ledger.Conway.Specification.Epoch.html#3119" class="Record">NewEpochState</a>
  <a id="4063" href="Ledger.Conway.Specification.Epoch.html#4007" class="Function">Hastreasury-NewEpochState</a> <a id="4089" class="Symbol">.</a><a id="4090" href="Ledger.Prelude.Base.html#889" class="Field">TreasuryOf</a> <a id="4101" class="Symbol">=</a> <a id="4103" href="Ledger.Prelude.Base.html#889" class="Field">TreasuryOf</a> <a id="4114" href="Function.Base.html#1134" class="Function Operator">∘</a> <a id="4116" href="Ledger.Conway.Specification.Epoch.html#1960" class="Field">EpochStateOf</a>

  <a id="HasLState-NewEpochState"></a><a id="4132" href="Ledger.Conway.Specification.Epoch.html#4132" class="Function">HasLState-NewEpochState</a> <a id="4156" class="Symbol">:</a> <a id="4158" href="Ledger.Conway.Specification.Ledger.html#1123" class="Record">HasLState</a> <a id="4168" href="Ledger.Conway.Specification.Epoch.html#3119" class="Record">NewEpochState</a>
  <a id="4184" href="Ledger.Conway.Specification.Epoch.html#4132" class="Function">HasLState-NewEpochState</a> <a id="4208" class="Symbol">.</a><a id="4209" href="Ledger.Conway.Specification.Ledger.html#1173" class="Field">LStateOf</a> <a id="4218" class="Symbol">=</a> <a id="4220" href="Ledger.Conway.Specification.Ledger.html#1173" class="Field">LStateOf</a> <a id="4229" href="Function.Base.html#1134" class="Function Operator">∘</a> <a id="4231" href="Ledger.Conway.Specification.Epoch.html#1960" class="Field">EpochStateOf</a>

  <a id="HasGovState-NewEpochState"></a><a id="4247" href="Ledger.Conway.Specification.Epoch.html#4247" class="Function">HasGovState-NewEpochState</a> <a id="4273" class="Symbol">:</a> <a id="4275" href="Ledger.Conway.Specification.Gov.html#1553" class="Record">HasGovState</a> <a id="4287" href="Ledger.Conway.Specification.Epoch.html#3119" class="Record">NewEpochState</a>
  <a id="4303" href="Ledger.Conway.Specification.Epoch.html#4247" class="Function">HasGovState-NewEpochState</a> <a id="4329" class="Symbol">.</a><a id="4330" href="Ledger.Conway.Specification.Gov.html#1605" class="Field">GovStateOf</a> <a id="4341" class="Symbol">=</a> <a id="4343" href="Ledger.Conway.Specification.Gov.html#1605" class="Field">GovStateOf</a> <a id="4354" href="Function.Base.html#1134" class="Function Operator">∘</a> <a id="4356" href="Ledger.Conway.Specification.Ledger.html#1173" class="Field">LStateOf</a>

  <a id="HasCertState-NewEpochState"></a><a id="4368" href="Ledger.Conway.Specification.Epoch.html#4368" class="Function">HasCertState-NewEpochState</a> <a id="4395" class="Symbol">:</a> <a id="4397" href="Ledger.Conway.Specification.Certs.html#4811" class="Record">HasCertState</a> <a id="4410" href="Ledger.Conway.Specification.Epoch.html#3119" class="Record">NewEpochState</a>
  <a id="4426" href="Ledger.Conway.Specification.Epoch.html#4368" class="Function">HasCertState-NewEpochState</a> <a id="4453" class="Symbol">.</a><a id="4454" href="Ledger.Conway.Specification.Certs.html#4864" class="Field">CertStateOf</a> <a id="4466" class="Symbol">=</a> <a id="4468" href="Ledger.Conway.Specification.Certs.html#4864" class="Field">CertStateOf</a> <a id="4480" href="Function.Base.html#1134" class="Function Operator">∘</a> <a id="4482" href="Ledger.Conway.Specification.Ledger.html#1173" class="Field">LStateOf</a>

  <a id="HasDReps-NewEpochState"></a><a id="4494" href="Ledger.Conway.Specification.Epoch.html#4494" class="Function">HasDReps-NewEpochState</a> <a id="4517" class="Symbol">:</a> <a id="4519" href="Ledger.Conway.Specification.Certs.html#1520" class="Record">HasDReps</a> <a id="4528" href="Ledger.Conway.Specification.Epoch.html#3119" class="Record">NewEpochState</a>
  <a id="4544" href="Ledger.Conway.Specification.Epoch.html#4494" class="Function">HasDReps-NewEpochState</a> <a id="4567" class="Symbol">.</a><a id="4568" href="Ledger.Conway.Specification.Certs.html#1569" class="Field">DRepsOf</a> <a id="4576" class="Symbol">=</a> <a id="4578" href="Ledger.Conway.Specification.Certs.html#1569" class="Field">DRepsOf</a> <a id="4586" href="Function.Base.html#1134" class="Function Operator">∘</a> <a id="4588" href="Ledger.Conway.Specification.Certs.html#4864" class="Field">CertStateOf</a>

  <a id="HasRewards-NewEpochState"></a><a id="4603" href="Ledger.Conway.Specification.Epoch.html#4603" class="Function">HasRewards-NewEpochState</a> <a id="4628" class="Symbol">:</a> <a id="4630" href="Ledger.Conway.Specification.Certs.html#1760" class="Record">HasRewards</a> <a id="4641" href="Ledger.Conway.Specification.Epoch.html#3119" class="Record">NewEpochState</a>
  <a id="4657" href="Ledger.Conway.Specification.Epoch.html#4603" class="Function">HasRewards-NewEpochState</a> <a id="4682" class="Symbol">.</a><a id="4683" href="Ledger.Conway.Specification.Certs.html#1811" class="Field">RewardsOf</a> <a id="4693" class="Symbol">=</a> <a id="4695" href="Ledger.Conway.Specification.Certs.html#1811" class="Field">RewardsOf</a> <a id="4705" href="Function.Base.html#1134" class="Function Operator">∘</a> <a id="4707" href="Ledger.Conway.Specification.Certs.html#4864" class="Field">CertStateOf</a>

  <a id="HasPParams-NewEpochState"></a><a id="4722" href="Ledger.Conway.Specification.Epoch.html#4722" class="Function">HasPParams-NewEpochState</a> <a id="4747" class="Symbol">:</a> <a id="4749" href="Ledger.Conway.Specification.PParams.html#3489" class="Record">HasPParams</a> <a id="4760" href="Ledger.Conway.Specification.Epoch.html#3119" class="Record">NewEpochState</a>
  <a id="4776" href="Ledger.Conway.Specification.Epoch.html#4722" class="Function">HasPParams-NewEpochState</a> <a id="4801" class="Symbol">.</a><a id="4802" href="Ledger.Conway.Specification.PParams.html#3540" class="Field">PParamsOf</a> <a id="4812" class="Symbol">=</a> <a id="4814" href="Ledger.Conway.Specification.PParams.html#3540" class="Field">PParamsOf</a> <a id="4824" href="Function.Base.html#1134" class="Function Operator">∘</a> <a id="4826" href="Ledger.Conway.Specification.Epoch.html#1960" class="Field">EpochStateOf</a>

  <a id="4842" class="Keyword">unquoteDecl</a> <a id="HasCast-EpochState"></a><a id="4854" href="Ledger.Conway.Specification.Epoch.html#4854" class="Function">HasCast-EpochState</a> <a id="HasCast-NewEpochState"></a><a id="4873" href="Ledger.Conway.Specification.Epoch.html#4873" class="Function">HasCast-NewEpochState</a> <a id="4895" class="Symbol">=</a> <a id="4897" href="stdlib-classes.Class.HasCast.Derive.html#2690" class="Function">derive-HasCast</a>
    <a id="4916" class="Symbol">(</a> <a id="4918" class="Symbol">(</a><a id="4919" class="Keyword">quote</a> <a id="4925" href="Ledger.Conway.Specification.Epoch.html#1703" class="Record">EpochState</a>     <a id="4940" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="4942" href="Ledger.Conway.Specification.Epoch.html#4854" class="Function">HasCast-EpochState</a><a id="4960" class="Symbol">)</a>
    <a id="4966" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="4968" href="Data.List.Base.html#4907" class="Function Operator">[</a> <a id="4970" class="Symbol">(</a><a id="4971" class="Keyword">quote</a> <a id="4977" href="Ledger.Conway.Specification.Epoch.html#3119" class="Record">NewEpochState</a>  <a id="4992" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="4994" href="Ledger.Conway.Specification.Epoch.html#4873" class="Function">HasCast-NewEpochState</a><a id="5015" class="Symbol">)</a><a id="5016" href="Data.List.Base.html#4907" class="Function Operator">]</a><a id="5017" class="Symbol">)</a>

<a id="toRwdAddr"></a><a id="5020" href="Ledger.Conway.Specification.Epoch.html#5020" class="Function">toRwdAddr</a> <a id="5030" class="Symbol">:</a> <a id="5032" href="Ledger.Core.Specification.Address.html#260" class="Datatype">Credential</a> <a id="5043" class="Symbol">→</a> <a id="5045" href="Ledger.Core.Specification.Address.html#1324" class="Record">RwdAddr</a>
<a id="5053" href="Ledger.Conway.Specification.Epoch.html#5020" class="Function">toRwdAddr</a> <a id="5063" href="Ledger.Conway.Specification.Epoch.html#5063" class="Bound">x</a> <a id="5065" class="Symbol">=</a> <a id="5067" class="Keyword">record</a> <a id="5074" class="Symbol">{</a> <a id="5076" href="Ledger.Core.Specification.Address.html#1353" class="Field">net</a> <a id="5080" class="Symbol">=</a> <a id="5082" href="Ledger.Core.Specification.Epoch.html#2547" class="Function">NetworkId</a> <a id="5092" class="Symbol">;</a> <a id="5094" href="Ledger.Core.Specification.Address.html#1378" class="Field">stake</a> <a id="5100" class="Symbol">=</a> <a id="5102" href="Ledger.Conway.Specification.Epoch.html#5063" class="Bound">x</a> <a id="5104" class="Symbol">}</a>

<a id="getStakeCred"></a><a id="5107" href="Ledger.Conway.Specification.Epoch.html#5107" class="Function">getStakeCred</a> <a id="5120" class="Symbol">:</a> <a id="5122" href="Ledger.Conway.Specification.Transaction.html#2640" class="Function">TxOut</a> <a id="5128" class="Symbol">→</a> <a id="5130" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="5136" href="Ledger.Core.Specification.Address.html#260" class="Datatype">Credential</a>
<a id="5147" href="Ledger.Conway.Specification.Epoch.html#5107" class="Function">getStakeCred</a> <a id="5160" class="Symbol">(</a><a id="5161" href="Ledger.Conway.Specification.Epoch.html#5161" class="Bound">a</a> <a id="5163" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5165" class="Symbol">_</a> <a id="5167" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5169" class="Symbol">_</a> <a id="5171" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5173" class="Symbol">_)</a> <a id="5176" class="Symbol">=</a> <a id="5178" href="Ledger.Core.Specification.Address.html#2673" class="Function">stakeCred</a> <a id="5188" href="Ledger.Conway.Specification.Epoch.html#5161" class="Bound">a</a>

<a id="5191" class="Keyword">open</a> <a id="5196" href="Ledger.Conway.Specification.Gov.Actions.html#3768" class="Module">GovActionState</a> <a id="5211" class="Keyword">using</a> <a id="5217" class="Symbol">(</a><a id="5218" href="Ledger.Conway.Specification.Gov.Actions.html#3835" class="Field">returnAddr</a><a id="5228" class="Symbol">)</a>

<a id="5231" class="Keyword">opaque</a>


  <a id="createRUpd"></a><a id="5242" href="Ledger.Conway.Specification.Epoch.html#5242" class="Function">createRUpd</a> <a id="5253" class="Symbol">:</a> <a id="5255" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a> <a id="5257" class="Symbol">→</a> <a id="5259" href="Ledger.Conway.Specification.Rewards.html#4867" class="Function">BlocksMade</a> <a id="5270" class="Symbol">→</a> <a id="5272" href="Ledger.Conway.Specification.Epoch.html#1703" class="Record">EpochState</a> <a id="5283" class="Symbol">→</a> <a id="5285" href="Ledger.Prelude.Base.html#154" class="Function">Coin</a> <a id="5290" class="Symbol">→</a> <a id="5292" href="Ledger.Conway.Specification.Rewards.html#6210" class="Record">RewardUpdate</a>
  <a id="5307" href="Ledger.Conway.Specification.Epoch.html#5242" class="Function">createRUpd</a> <a id="5318" href="Ledger.Conway.Specification.Epoch.html#5318" class="Bound">slotsPerEpoch</a> <a id="5332" href="Ledger.Conway.Specification.Epoch.html#5332" class="Bound">b</a> <a id="5334" href="Ledger.Conway.Specification.Epoch.html#5334" class="Bound">es</a> <a id="5337" href="Ledger.Conway.Specification.Epoch.html#5337" class="Bound">total</a> <a id="5343" class="Symbol">=</a>
    <a id="5349" class="Keyword">record</a>  <a id="5357" class="Symbol">{</a> <a id="5359" href="Ledger.Conway.Specification.Rewards.html#6247" class="Field">Δt</a> <a id="5362" class="Symbol">=</a> <a id="5364" href="Ledger.Conway.Specification.Epoch.html#6321" class="Function">Δt₁</a>
            <a id="5380" class="Symbol">;</a> <a id="5382" href="Ledger.Conway.Specification.Rewards.html#6250" class="Field">Δr</a> <a id="5385" class="Symbol">=</a> <a id="5387" class="Number">0</a> <a id="5389" href="Interface.HasSubtract.html#209" class="Field Operator">-</a> <a id="5391" href="Ledger.Conway.Specification.Epoch.html#6307" class="Function">Δr₁</a> <a id="5395" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="5397" href="Ledger.Conway.Specification.Epoch.html#6643" class="Function">Δr₂</a>
            <a id="5413" class="Symbol">;</a> <a id="5415" href="Ledger.Conway.Specification.Rewards.html#6253" class="Field">Δf</a> <a id="5418" class="Symbol">=</a> <a id="5420" class="Number">0</a> <a id="5422" href="Interface.HasSubtract.html#209" class="Field Operator">-</a> <a id="5424" href="Ledger.Conway.Specification.Epoch.html#76" class="InductiveConstructor">pos</a> <a id="5428" href="Ledger.Conway.Specification.Epoch.html#5808" class="Function">feeSS</a>
            <a id="5446" class="Symbol">;</a> <a id="5448" href="Ledger.Conway.Specification.Rewards.html#6273" class="Field">rs</a> <a id="5451" class="Symbol">=</a> <a id="5453" href="Ledger.Conway.Specification.Epoch.html#6548" class="Function">rs</a>



            <a id="5471" class="Symbol">;</a> <a id="5473" href="Ledger.Conway.Specification.Rewards.html#6303" class="Field">flowConservation</a> <a id="5490" class="Symbol">=</a> <a id="5492" href="Ledger.Conway.Specification.Epoch.html#6945" class="Function">flowConservation</a>
            <a id="5521" class="Symbol">;</a> <a id="5523" href="Ledger.Conway.Specification.Rewards.html#6366" class="Field">Δt-nonnegative</a> <a id="5538" class="Symbol">=</a> <a id="5540" href="Ledger.Conway.Specification.Epoch.html#8083" class="Function">Δt-nonneg</a>
            <a id="5562" class="Symbol">;</a> <a id="5564" href="Ledger.Conway.Specification.Rewards.html#6397" class="Field">Δf-nonpositive</a> <a id="5579" class="Symbol">=</a> <a id="5581" href="Ledger.Conway.Specification.Epoch.html#8265" class="Function">Δf-nonpos</a>


            <a id="5605" class="Symbol">}</a>
    <a id="5611" class="Keyword">where</a>
      <a id="5623" href="Ledger.Conway.Specification.Epoch.html#5623" class="Function">prevPp</a> <a id="5630" class="Symbol">:</a> <a id="5632" href="Ledger.Conway.Specification.PParams.html#1685" class="Record">PParams</a>
      <a id="5646" href="Ledger.Conway.Specification.Epoch.html#5623" class="Function">prevPp</a> <a id="5653" class="Symbol">=</a> <a id="5655" href="Ledger.Conway.Specification.PParams.html#3540" class="Field">PParamsOf</a> <a id="5665" href="Ledger.Conway.Specification.Epoch.html#5334" class="Bound">es</a>

      <a id="5675" href="Ledger.Conway.Specification.Epoch.html#5675" class="Function">reserves</a> <a id="5684" class="Symbol">:</a> <a id="5686" href="Ledger.Prelude.Base.html#191" class="Function">Reserves</a>
      <a id="5701" href="Ledger.Conway.Specification.Epoch.html#5675" class="Function">reserves</a> <a id="5710" class="Symbol">=</a> <a id="5712" href="Ledger.Prelude.Base.html#773" class="Field">ReservesOf</a> <a id="5723" href="Ledger.Conway.Specification.Epoch.html#5334" class="Bound">es</a>

      <a id="5733" href="Ledger.Conway.Specification.Epoch.html#5733" class="Function">pstakego</a> <a id="5742" class="Symbol">:</a> <a id="5744" href="Ledger.Conway.Specification.Rewards.html#6433" class="Record">Snapshot</a>
      <a id="5759" href="Ledger.Conway.Specification.Epoch.html#5733" class="Function">pstakego</a> <a id="5768" class="Symbol">=</a> <a id="5770" class="Symbol">(</a><a id="5771" href="Ledger.Conway.Specification.Rewards.html#7889" class="Field">SnapshotsOf</a> <a id="5783" href="Ledger.Conway.Specification.Epoch.html#5334" class="Bound">es</a><a id="5785" class="Symbol">)</a> <a id="5787" class="Symbol">.</a><a id="5788" href="Ledger.Conway.Specification.Rewards.html#7788" class="Field">Snapshots.go</a>

      <a id="5808" href="Ledger.Conway.Specification.Epoch.html#5808" class="Function">feeSS</a> <a id="5814" class="Symbol">:</a> <a id="5816" href="Ledger.Prelude.Base.html#186" class="Function">Fees</a>
      <a id="5827" href="Ledger.Conway.Specification.Epoch.html#5808" class="Function">feeSS</a> <a id="5833" class="Symbol">=</a> <a id="5835" href="Ledger.Prelude.Base.html#669" class="Field">FeesOf</a> <a id="5842" class="Symbol">(</a><a id="5843" href="Ledger.Conway.Specification.Rewards.html#7889" class="Field">SnapshotsOf</a> <a id="5855" href="Ledger.Conway.Specification.Epoch.html#5334" class="Bound">es</a><a id="5857" class="Symbol">)</a>

      <a id="5866" href="Ledger.Conway.Specification.Epoch.html#5866" class="Function">stake</a> <a id="5872" class="Symbol">:</a> <a id="5874" href="Ledger.Conway.Specification.Certs.html#1121" class="Function">Stake</a>
      <a id="5886" href="Ledger.Conway.Specification.Epoch.html#5866" class="Function">stake</a> <a id="5892" class="Symbol">=</a> <a id="5894" href="Ledger.Conway.Specification.Certs.html#1892" class="Field">StakeOf</a> <a id="5902" href="Ledger.Conway.Specification.Epoch.html#5733" class="Function">pstakego</a>

      <a id="5918" href="Ledger.Conway.Specification.Epoch.html#5918" class="Function">delegs</a> <a id="5925" class="Symbol">:</a> <a id="5927" href="Ledger.Conway.Specification.Certs.html#1127" class="Function">StakeDelegs</a>
      <a id="5945" href="Ledger.Conway.Specification.Epoch.html#5918" class="Function">delegs</a> <a id="5952" class="Symbol">=</a> <a id="5954" href="Ledger.Conway.Specification.Certs.html#1976" class="Field">StakeDelegsOf</a> <a id="5968" href="Ledger.Conway.Specification.Epoch.html#5733" class="Function">pstakego</a>

      <a id="5984" href="Ledger.Conway.Specification.Epoch.html#5984" class="Function">poolParams</a> <a id="5995" class="Symbol">:</a> <a id="5997" href="Ledger.Conway.Specification.Certs.html#1098" class="Function">Pools</a>
      <a id="6009" href="Ledger.Conway.Specification.Epoch.html#5984" class="Function">poolParams</a> <a id="6020" class="Symbol">=</a> <a id="6022" href="Ledger.Conway.Specification.Certs.html#1646" class="Field">PoolsOf</a> <a id="6030" href="Ledger.Conway.Specification.Epoch.html#5733" class="Function">pstakego</a>

      <a id="6046" href="Ledger.Conway.Specification.Epoch.html#6046" class="Function">blocksMade</a> <a id="6057" class="Symbol">:</a> <a id="6059" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a>
      <a id="6067" href="Ledger.Conway.Specification.Epoch.html#6046" class="Function">blocksMade</a> <a id="6078" class="Symbol">=</a> <a id="6080" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">∑[</a> <a id="6083" href="Ledger.Conway.Specification.Epoch.html#6083" class="Bound">m</a> <a id="6085" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">←</a> <a id="6087" href="Ledger.Conway.Specification.Epoch.html#5332" class="Bound">b</a> <a id="6089" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">]</a> <a id="6091" href="Ledger.Conway.Specification.Epoch.html#6083" class="Bound">m</a>

      <a id="6100" href="Ledger.Conway.Specification.Epoch.html#6100" class="Function">ρ</a> <a id="6102" href="Ledger.Conway.Specification.Epoch.html#6102" class="Function">η</a> <a id="6104" href="Ledger.Conway.Specification.Epoch.html#6104" class="Function">τ</a> <a id="6106" class="Symbol">:</a> <a id="6108" href="Data.Rational.Base.html#1421" class="Record">ℚ</a>
      <a id="6116" href="Ledger.Conway.Specification.Epoch.html#6100" class="Function">ρ</a> <a id="6118" class="Symbol">=</a> <a id="6120" href="Ledger.Prelude.Numeric.UnitInterval.html#1988" class="Function">fromUnitInterval</a> <a id="6137" class="Symbol">(</a><a id="6138" href="Ledger.Conway.Specification.Epoch.html#5623" class="Function">prevPp</a> <a id="6145" class="Symbol">.</a><a id="6146" href="Ledger.Conway.Specification.PParams.html#2281" class="Field">PParams.monetaryExpansion</a><a id="6171" class="Symbol">)</a>
      <a id="6179" href="Ledger.Conway.Specification.Epoch.html#6102" class="Function">η</a> <a id="6181" class="Symbol">=</a> <a id="6183" href="Ledger.Conway.Specification.Epoch.html#1093" class="Function">fromℕ</a> <a id="6189" href="Ledger.Conway.Specification.Epoch.html#6046" class="Function">blocksMade</a> <a id="6200" href="Ledger.Prelude.html#2015" class="Function Operator">÷₀</a> <a id="6203" class="Symbol">(</a><a id="6204" href="Ledger.Conway.Specification.Epoch.html#1093" class="Function">fromℕ</a> <a id="6210" href="Ledger.Conway.Specification.Epoch.html#5318" class="Bound">slotsPerEpoch</a> <a id="6224" href="Data.Rational.Base.html#6394" class="Function Operator">*</a> <a id="6226" href="Ledger.Core.Specification.Epoch.html#2329" class="Function">ActiveSlotCoeff</a><a id="6241" class="Symbol">)</a>
      <a id="6249" href="Ledger.Conway.Specification.Epoch.html#6104" class="Function">τ</a> <a id="6251" class="Symbol">=</a> <a id="6253" href="Ledger.Prelude.Numeric.UnitInterval.html#1988" class="Function">fromUnitInterval</a> <a id="6270" class="Symbol">(</a><a id="6271" href="Ledger.Conway.Specification.Epoch.html#5623" class="Function">prevPp</a> <a id="6278" class="Symbol">.</a><a id="6279" href="Ledger.Conway.Specification.PParams.html#2351" class="Field">PParams.treasuryCut</a><a id="6298" class="Symbol">)</a>

      <a id="6307" href="Ledger.Conway.Specification.Epoch.html#6307" class="Function">Δr₁</a> <a id="6311" href="Ledger.Conway.Specification.Epoch.html#6311" class="Function">rewardPot</a> <a id="6321" href="Ledger.Conway.Specification.Epoch.html#6321" class="Function">Δt₁</a> <a id="6325" href="Ledger.Conway.Specification.Epoch.html#6325" class="Function">R</a> <a id="6327" class="Symbol">:</a> <a id="6329" href="Agda.Builtin.Int.html#245" class="Datatype">ℤ</a>
      <a id="6337" href="Ledger.Conway.Specification.Epoch.html#6307" class="Function">Δr₁</a> <a id="6341" class="Symbol">=</a> <a id="6343" href="Data.Rational.Base.html#7195" class="Function">floor</a> <a id="6349" class="Symbol">(</a><a id="6350" class="Number">1</a> <a id="6352" href="Data.Rational.Base.html#6933" class="Function Operator">⊓</a> <a id="6354" href="Ledger.Conway.Specification.Epoch.html#6102" class="Function">η</a> <a id="6356" href="Data.Rational.Base.html#6394" class="Function Operator">*</a> <a id="6358" href="Ledger.Conway.Specification.Epoch.html#6100" class="Function">ρ</a> <a id="6360" href="Data.Rational.Base.html#6394" class="Function Operator">*</a> <a id="6362" href="Ledger.Conway.Specification.Epoch.html#1093" class="Function">fromℕ</a> <a id="6368" href="Ledger.Conway.Specification.Epoch.html#5675" class="Function">reserves</a><a id="6376" class="Symbol">)</a>
      <a id="6384" href="Ledger.Conway.Specification.Epoch.html#6311" class="Function">rewardPot</a> <a id="6394" class="Symbol">=</a> <a id="6396" href="Ledger.Conway.Specification.Epoch.html#76" class="InductiveConstructor">pos</a> <a id="6400" href="Ledger.Conway.Specification.Epoch.html#5808" class="Function">feeSS</a> <a id="6406" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="6408" href="Ledger.Conway.Specification.Epoch.html#6307" class="Function">Δr₁</a>
      <a id="6418" href="Ledger.Conway.Specification.Epoch.html#6321" class="Function">Δt₁</a> <a id="6422" class="Symbol">=</a> <a id="6424" href="Data.Rational.Base.html#7195" class="Function">floor</a> <a id="6430" class="Symbol">(</a><a id="6431" href="Data.Rational.Literals.html#613" class="Function">fromℤ</a> <a id="6437" href="Ledger.Conway.Specification.Epoch.html#6311" class="Function">rewardPot</a> <a id="6447" href="Data.Rational.Base.html#6394" class="Function Operator">*</a> <a id="6449" href="Ledger.Conway.Specification.Epoch.html#6104" class="Function">τ</a><a id="6450" class="Symbol">)</a>
      <a id="6458" href="Ledger.Conway.Specification.Epoch.html#6325" class="Function">R</a> <a id="6460" class="Symbol">=</a> <a id="6462" href="Ledger.Conway.Specification.Epoch.html#6311" class="Function">rewardPot</a> <a id="6472" href="Interface.HasSubtract.html#209" class="Field Operator">-</a> <a id="6474" href="Ledger.Conway.Specification.Epoch.html#6321" class="Function">Δt₁</a>

      <a id="6485" href="Ledger.Conway.Specification.Epoch.html#6485" class="Function">circulation</a> <a id="6497" class="Symbol">:</a> <a id="6499" href="Ledger.Prelude.Base.html#154" class="Function">Coin</a>
      <a id="6510" href="Ledger.Conway.Specification.Epoch.html#6485" class="Function">circulation</a> <a id="6522" class="Symbol">=</a> <a id="6524" href="Ledger.Conway.Specification.Epoch.html#5337" class="Bound">total</a> <a id="6530" href="Interface.HasSubtract.html#209" class="Field Operator">-</a> <a id="6532" href="Ledger.Conway.Specification.Epoch.html#5675" class="Function">reserves</a>

      <a id="6548" href="Ledger.Conway.Specification.Epoch.html#6548" class="Function">rs</a> <a id="6551" class="Symbol">:</a> <a id="6553" href="Ledger.Conway.Specification.Certs.html#1113" class="Function">Rewards</a>
      <a id="6567" href="Ledger.Conway.Specification.Epoch.html#6548" class="Function">rs</a> <a id="6570" class="Symbol">=</a> <a id="6572" href="Ledger.Conway.Specification.Rewards.html#5358" class="Function">reward</a> <a id="6579" href="Ledger.Conway.Specification.Epoch.html#5623" class="Function">prevPp</a> <a id="6586" href="Ledger.Conway.Specification.Epoch.html#5332" class="Bound">b</a> <a id="6588" class="Symbol">(</a><a id="6589" href="Prelude.html#3279" class="Function">posPart</a> <a id="6597" href="Ledger.Conway.Specification.Epoch.html#6325" class="Function">R</a><a id="6598" class="Symbol">)</a> <a id="6600" href="Ledger.Conway.Specification.Epoch.html#5984" class="Function">poolParams</a> <a id="6611" href="Ledger.Conway.Specification.Epoch.html#5866" class="Function">stake</a> <a id="6617" href="Ledger.Conway.Specification.Epoch.html#5918" class="Function">delegs</a> <a id="6624" href="Ledger.Conway.Specification.Epoch.html#6485" class="Function">circulation</a>

      <a id="6643" href="Ledger.Conway.Specification.Epoch.html#6643" class="Function">Δr₂</a> <a id="6647" class="Symbol">:</a> <a id="6649" href="Agda.Builtin.Int.html#245" class="Datatype">ℤ</a>
      <a id="6657" href="Ledger.Conway.Specification.Epoch.html#6643" class="Function">Δr₂</a> <a id="6661" class="Symbol">=</a> <a id="6663" href="Ledger.Conway.Specification.Epoch.html#6325" class="Function">R</a> <a id="6665" href="Interface.HasSubtract.html#209" class="Field Operator">-</a> <a id="6667" href="Ledger.Conway.Specification.Epoch.html#76" class="InductiveConstructor">pos</a> <a id="6671" class="Symbol">(</a><a id="6672" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">∑[</a> <a id="6675" href="Ledger.Conway.Specification.Epoch.html#6675" class="Bound">c</a> <a id="6677" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">←</a> <a id="6679" href="Ledger.Conway.Specification.Epoch.html#6548" class="Function">rs</a> <a id="6682" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">]</a> <a id="6684" href="Ledger.Conway.Specification.Epoch.html#6675" class="Bound">c</a><a id="6685" class="Symbol">)</a>


      <a id="6695" class="Comment">-- Proofs</a>
      <a id="6711" class="Comment">-- Note: Overloading of + and - seems to interfere with</a>
      <a id="6773" class="Comment">-- the ring solver.</a>
      <a id="6799" href="Ledger.Conway.Specification.Epoch.html#6799" class="Function">lemmaFlow</a> <a id="6809" class="Symbol">:</a> <a id="6811" class="Symbol">∀</a> <a id="6813" class="Symbol">(</a><a id="6814" href="Ledger.Conway.Specification.Epoch.html#6814" class="Bound">t₁</a> <a id="6817" href="Ledger.Conway.Specification.Epoch.html#6817" class="Bound">r₁</a> <a id="6820" href="Ledger.Conway.Specification.Epoch.html#6820" class="Bound">f</a> <a id="6822" href="Ledger.Conway.Specification.Epoch.html#6822" class="Bound">z</a> <a id="6824" class="Symbol">:</a> <a id="6826" href="Agda.Builtin.Int.html#245" class="Datatype">ℤ</a><a id="6827" class="Symbol">)</a>
        <a id="6837" class="Symbol">→</a> <a id="6839" class="Symbol">(</a><a id="6840" href="Ledger.Conway.Specification.Epoch.html#6814" class="Bound">t₁</a> <a id="6843" href="Data.Integer.Base.html#5064" class="Function Operator">ℤ.+</a> <a id="6847" class="Symbol">(</a><a id="6848" class="Number">0</a> <a id="6850" href="Data.Integer.Base.html#5245" class="Function Operator">ℤ.-</a> <a id="6854" href="Ledger.Conway.Specification.Epoch.html#6817" class="Bound">r₁</a> <a id="6857" href="Data.Integer.Base.html#5064" class="Function Operator">ℤ.+</a> <a id="6861" class="Symbol">((</a><a id="6863" href="Ledger.Conway.Specification.Epoch.html#6820" class="Bound">f</a> <a id="6865" href="Data.Integer.Base.html#5064" class="Function Operator">ℤ.+</a> <a id="6869" href="Ledger.Conway.Specification.Epoch.html#6817" class="Bound">r₁</a> <a id="6872" href="Data.Integer.Base.html#5245" class="Function Operator">ℤ.-</a> <a id="6876" href="Ledger.Conway.Specification.Epoch.html#6814" class="Bound">t₁</a><a id="6878" class="Symbol">)</a> <a id="6880" href="Data.Integer.Base.html#5245" class="Function Operator">ℤ.-</a> <a id="6884" href="Ledger.Conway.Specification.Epoch.html#6822" class="Bound">z</a><a id="6885" class="Symbol">))</a> <a id="6888" href="Data.Integer.Base.html#5064" class="Function Operator">ℤ.+</a> <a id="6892" class="Symbol">(</a><a id="6893" class="Number">0</a> <a id="6895" href="Data.Integer.Base.html#5245" class="Function Operator">ℤ.-</a> <a id="6899" href="Ledger.Conway.Specification.Epoch.html#6820" class="Bound">f</a><a id="6900" class="Symbol">)</a> <a id="6902" href="Data.Integer.Base.html#5064" class="Function Operator">ℤ.+</a> <a id="6906" href="Ledger.Conway.Specification.Epoch.html#6822" class="Bound">z</a><a id="6907" class="Symbol">)</a> <a id="6909" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="6911" class="Number">0</a>
      <a id="6919" href="Ledger.Conway.Specification.Epoch.html#6799" class="Function">lemmaFlow</a> <a id="6929" class="Symbol">=</a> <a id="6931" href="Data.Integer.Tactic.RingSolver.html#1200" class="Macro">solve-∀</a>
      <a id="6945" href="Ledger.Conway.Specification.Epoch.html#6945" class="Function">flowConservation</a> <a id="6962" class="Symbol">:</a>
        <a id="6972" class="Keyword">let</a> <a id="6976" href="Ledger.Conway.Specification.Epoch.html#6976" class="Bound">t₁</a> <a id="6979" class="Symbol">=</a> <a id="6981" href="Ledger.Conway.Specification.Epoch.html#6321" class="Function">Δt₁</a>
            <a id="6997" href="Ledger.Conway.Specification.Epoch.html#6997" class="Bound">r₁</a> <a id="7000" class="Symbol">=</a> <a id="7002" href="Ledger.Conway.Specification.Epoch.html#6307" class="Function">Δr₁</a>
            <a id="7018" href="Ledger.Conway.Specification.Epoch.html#7018" class="Bound">f</a>  <a id="7021" class="Symbol">=</a> <a id="7023" href="Ledger.Conway.Specification.Epoch.html#76" class="InductiveConstructor">pos</a> <a id="7027" href="Ledger.Conway.Specification.Epoch.html#5808" class="Function">feeSS</a>
            <a id="7045" href="Ledger.Conway.Specification.Epoch.html#7045" class="Bound">z</a>  <a id="7048" class="Symbol">=</a> <a id="7050" href="Ledger.Conway.Specification.Epoch.html#76" class="InductiveConstructor">pos</a> <a id="7054" class="Symbol">(</a><a id="7055" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">∑[</a> <a id="7058" href="Ledger.Conway.Specification.Epoch.html#7058" class="Bound">c</a> <a id="7060" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">←</a> <a id="7062" href="Ledger.Conway.Specification.Epoch.html#6548" class="Function">rs</a> <a id="7065" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">]</a> <a id="7067" href="Ledger.Conway.Specification.Epoch.html#7058" class="Bound">c</a><a id="7068" class="Symbol">)</a>
         <a id="7079" class="Keyword">in</a>
            <a id="7094" class="Symbol">(</a><a id="7095" href="Ledger.Conway.Specification.Epoch.html#6976" class="Bound">t₁</a> <a id="7098" href="Data.Integer.Base.html#5064" class="Function Operator">ℤ.+</a> <a id="7102" class="Symbol">(</a><a id="7103" class="Number">0</a> <a id="7105" href="Data.Integer.Base.html#5245" class="Function Operator">ℤ.-</a> <a id="7109" href="Ledger.Conway.Specification.Epoch.html#6997" class="Bound">r₁</a> <a id="7112" href="Data.Integer.Base.html#5064" class="Function Operator">ℤ.+</a> <a id="7116" class="Symbol">((</a><a id="7118" href="Ledger.Conway.Specification.Epoch.html#7018" class="Bound">f</a> <a id="7120" href="Data.Integer.Base.html#5064" class="Function Operator">ℤ.+</a> <a id="7124" href="Ledger.Conway.Specification.Epoch.html#6997" class="Bound">r₁</a> <a id="7127" href="Data.Integer.Base.html#5245" class="Function Operator">ℤ.-</a> <a id="7131" href="Ledger.Conway.Specification.Epoch.html#6976" class="Bound">t₁</a><a id="7133" class="Symbol">)</a> <a id="7135" href="Data.Integer.Base.html#5245" class="Function Operator">ℤ.-</a> <a id="7139" href="Ledger.Conway.Specification.Epoch.html#7045" class="Bound">z</a><a id="7140" class="Symbol">))</a> <a id="7143" href="Data.Integer.Base.html#5064" class="Function Operator">ℤ.+</a> <a id="7147" class="Symbol">(</a><a id="7148" class="Number">0</a> <a id="7150" href="Data.Integer.Base.html#5245" class="Function Operator">ℤ.-</a> <a id="7154" href="Ledger.Conway.Specification.Epoch.html#7018" class="Bound">f</a><a id="7155" class="Symbol">)</a> <a id="7157" href="Data.Integer.Base.html#5064" class="Function Operator">ℤ.+</a> <a id="7161" href="Ledger.Conway.Specification.Epoch.html#7045" class="Bound">z</a><a id="7162" class="Symbol">)</a> <a id="7164" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="7166" class="Number">0</a>
      <a id="7174" href="Ledger.Conway.Specification.Epoch.html#6945" class="Function">flowConservation</a> <a id="7191" class="Symbol">=</a> <a id="7193" href="Ledger.Conway.Specification.Epoch.html#6799" class="Function">lemmaFlow</a> <a id="7203" href="Ledger.Conway.Specification.Epoch.html#6321" class="Function">Δt₁</a> <a id="7207" href="Ledger.Conway.Specification.Epoch.html#6307" class="Function">Δr₁</a> <a id="7211" class="Symbol">(</a><a id="7212" href="Ledger.Conway.Specification.Epoch.html#76" class="InductiveConstructor">pos</a> <a id="7216" href="Ledger.Conway.Specification.Epoch.html#5808" class="Function">feeSS</a><a id="7221" class="Symbol">)</a> <a id="7223" class="Symbol">(</a><a id="7224" href="Ledger.Conway.Specification.Epoch.html#76" class="InductiveConstructor">pos</a> <a id="7228" class="Symbol">(</a><a id="7229" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">∑[</a> <a id="7232" href="Ledger.Conway.Specification.Epoch.html#7232" class="Bound">c</a> <a id="7234" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">←</a> <a id="7236" href="Ledger.Conway.Specification.Epoch.html#6548" class="Function">rs</a> <a id="7239" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">]</a> <a id="7241" href="Ledger.Conway.Specification.Epoch.html#7232" class="Bound">c</a><a id="7242" class="Symbol">))</a>

      <a id="7252" href="Ledger.Conway.Specification.Epoch.html#7252" class="Function">÷₀-0≤⇒0≤</a> <a id="7261" class="Symbol">:</a> <a id="7263" class="Symbol">∀</a> <a id="7265" class="Symbol">(</a><a id="7266" href="Ledger.Conway.Specification.Epoch.html#7266" class="Bound">x</a> <a id="7268" href="Ledger.Conway.Specification.Epoch.html#7268" class="Bound">y</a> <a id="7270" class="Symbol">:</a> <a id="7272" href="Data.Rational.Base.html#1421" class="Record">ℚ</a><a id="7273" class="Symbol">)</a> <a id="7275" class="Symbol">→</a> <a id="7277" class="Number">0</a> <a id="7279" href="Class.HasOrder.Core.html#613" class="Field Operator">≤</a> <a id="7281" href="Ledger.Conway.Specification.Epoch.html#7266" class="Bound">x</a> <a id="7283" class="Symbol">→</a> <a id="7285" class="Number">0</a> <a id="7287" href="Class.HasOrder.Core.html#613" class="Field Operator">≤</a> <a id="7289" href="Ledger.Conway.Specification.Epoch.html#7268" class="Bound">y</a> <a id="7291" class="Symbol">→</a> <a id="7293" class="Number">0</a> <a id="7295" href="Class.HasOrder.Core.html#613" class="Field Operator">≤</a> <a id="7297" class="Symbol">(</a><a id="7298" href="Ledger.Conway.Specification.Epoch.html#7266" class="Bound">x</a> <a id="7300" href="Ledger.Prelude.html#2015" class="Function Operator">÷₀</a> <a id="7303" href="Ledger.Conway.Specification.Epoch.html#7268" class="Bound">y</a><a id="7304" class="Symbol">)</a>
      <a id="7312" href="Ledger.Conway.Specification.Epoch.html#7252" class="Function">÷₀-0≤⇒0≤</a> <a id="7321" href="Ledger.Conway.Specification.Epoch.html#7321" class="Bound">x</a> <a id="7323" href="Ledger.Conway.Specification.Epoch.html#7323" class="Bound">y</a> <a id="7325" href="Ledger.Conway.Specification.Epoch.html#7325" class="Bound">0≤x</a> <a id="7329" href="Ledger.Conway.Specification.Epoch.html#7329" class="Bound">0≤y</a> <a id="7333" class="Keyword">with</a> <a id="7338" href="Ledger.Conway.Specification.Epoch.html#7323" class="Bound">y</a> <a id="7340" href="Data.Rational.Properties.html#4152" class="Function Operator">≟</a> <a id="7342" class="Number">0</a>
      <a id="7350" class="Symbol">...</a> <a id="7354" class="Symbol">|</a> <a id="7356" class="Symbol">(</a><a id="7357" href="Relation.Nullary.Decidable.Core.html#2099" class="InductiveConstructor">yes</a> <a id="7361" href="Ledger.Conway.Specification.Epoch.html#7361" class="Bound">y≡0</a><a id="7364" class="Symbol">)</a> <a id="7366" class="Symbol">=</a> <a id="7368" href="Data.Rational.Properties.html#27061" class="Function">nonNegative⁻¹</a> <a id="7382" class="Number">0</a>
      <a id="7390" class="Symbol">...</a> <a id="7394" class="Symbol">|</a> <a id="7396" class="Symbol">(</a><a id="7397" href="Relation.Nullary.Decidable.Core.html#2136" class="InductiveConstructor">no</a> <a id="7400" href="Ledger.Conway.Specification.Epoch.html#7400" class="Bound">y≢0</a><a id="7403" class="Symbol">)</a>  <a id="7406" class="Symbol">=</a> <a id="7408" href="stdlib.Data.Rational.Properties.html#2865" class="Function">÷-0≤⇒0≤</a> <a id="7416" class="Bound">x</a> <a id="7418" class="Bound">y</a> <a id="7420" class="Symbol">{{</a><a id="7422" href="Data.Rational.Base.html#4971" class="Function">≢-nonZero</a> <a id="7432" href="Ledger.Conway.Specification.Epoch.html#7400" class="Bound">y≢0</a><a id="7435" class="Symbol">}}</a> <a id="7438" class="Bound">0≤x</a> <a id="7442" class="Bound">0≤y</a>

      <a id="7453" href="Ledger.Conway.Specification.Epoch.html#7453" class="Function">η-nonneg</a> <a id="7462" class="Symbol">:</a> <a id="7464" class="Number">0</a> <a id="7466" href="Class.HasOrder.Core.html#613" class="Field Operator">≤</a> <a id="7468" href="Ledger.Conway.Specification.Epoch.html#6102" class="Function">η</a>
      <a id="7476" href="Ledger.Conway.Specification.Epoch.html#7453" class="Function">η-nonneg</a> <a id="7485" class="Symbol">=</a> <a id="7487" href="Ledger.Conway.Specification.Epoch.html#7252" class="Function">÷₀-0≤⇒0≤</a> <a id="7496" class="Symbol">_</a> <a id="7498" class="Symbol">_</a> <a id="7500" class="Symbol">(</a><a id="7501" href="stdlib.Data.Rational.Properties.html#2275" class="Function">fromℕ-0≤</a> <a id="7510" href="Ledger.Conway.Specification.Epoch.html#6046" class="Function">blocksMade</a><a id="7520" class="Symbol">)</a>
        <a id="7530" class="Symbol">(</a><a id="7531" href="stdlib.Data.Rational.Properties.html#2409" class="Function">*-0≤⇒0≤</a> <a id="7539" class="Symbol">_</a> <a id="7541" class="Symbol">_</a>
          <a id="7553" class="Symbol">(</a><a id="7554" href="stdlib.Data.Rational.Properties.html#2275" class="Function">fromℕ-0≤</a> <a id="7563" href="Ledger.Conway.Specification.Epoch.html#5318" class="Bound">slotsPerEpoch</a><a id="7576" class="Symbol">)</a>
          <a id="7588" class="Symbol">(</a><a id="7589" href="Data.Rational.Properties.html#27061" class="Function">nonNegative⁻¹</a> <a id="7603" href="Ledger.Core.Specification.Epoch.html#2329" class="Function">ActiveSlotCoeff</a> <a id="7619" class="Symbol">{{</a><a id="7621" href="Data.Rational.Properties.html#7555" class="Function">pos⇒nonNeg</a> <a id="7632" href="Ledger.Core.Specification.Epoch.html#2329" class="Function">ActiveSlotCoeff</a><a id="7647" class="Symbol">}}))</a>

      <a id="7659" href="Ledger.Conway.Specification.Epoch.html#7659" class="Function">min1η-nonneg</a> <a id="7672" class="Symbol">:</a> <a id="7674" class="Number">0</a> <a id="7676" href="Class.HasOrder.Core.html#613" class="Field Operator">≤</a> <a id="7678" class="Number">1</a> <a id="7680" href="Data.Rational.Base.html#6933" class="Function Operator">⊓</a> <a id="7682" href="Ledger.Conway.Specification.Epoch.html#6102" class="Function">η</a>
      <a id="7690" href="Ledger.Conway.Specification.Epoch.html#7659" class="Function">min1η-nonneg</a> <a id="7703" class="Symbol">=</a> <a id="7705" href="Algebra.Construct.NaturalChoice.MinOp.html#7120" class="Function">⊓-glb</a> <a id="7711" class="Symbol">(</a><a id="7712" href="Data.Rational.Properties.html#27061" class="Function">nonNegative⁻¹</a> <a id="7726" class="Number">1</a><a id="7727" class="Symbol">)</a> <a id="7729" href="Ledger.Conway.Specification.Epoch.html#7453" class="Function">η-nonneg</a>

      <a id="7745" href="Ledger.Conway.Specification.Epoch.html#7745" class="Function">Δr₁-nonneg</a> <a id="7756" class="Symbol">:</a> <a id="7758" class="Number">0</a> <a id="7760" href="Class.HasOrder.Core.html#613" class="Field Operator">≤</a> <a id="7762" href="Ledger.Conway.Specification.Epoch.html#6307" class="Function">Δr₁</a>
      <a id="7772" href="Ledger.Conway.Specification.Epoch.html#7745" class="Function">Δr₁-nonneg</a> <a id="7783" class="Symbol">=</a> <a id="7785" href="stdlib.Data.Rational.Properties.html#1631" class="Function">0≤⇒0≤floor</a> <a id="7796" class="Symbol">_</a>
        <a id="7806" class="Symbol">(</a><a id="7807" href="stdlib.Data.Rational.Properties.html#2409" class="Function">*-0≤⇒0≤</a> <a id="7815" class="Symbol">(</a><a id="7816" class="Number">1</a> <a id="7818" href="Data.Rational.Base.html#6933" class="Function Operator">⊓</a> <a id="7820" href="Ledger.Conway.Specification.Epoch.html#6102" class="Function">η</a> <a id="7822" href="Data.Rational.Base.html#6394" class="Function Operator">*</a> <a id="7824" href="Ledger.Conway.Specification.Epoch.html#6100" class="Function">ρ</a><a id="7825" class="Symbol">)</a> <a id="7827" class="Symbol">(</a><a id="7828" href="Ledger.Conway.Specification.Epoch.html#1093" class="Function">fromℕ</a> <a id="7834" href="Ledger.Conway.Specification.Epoch.html#5675" class="Function">reserves</a><a id="7842" class="Symbol">)</a>
          <a id="7854" class="Symbol">(</a><a id="7855" href="Ledger.Prelude.Numeric.UnitInterval.html#3336" class="Function">UnitInterval-*-0≤</a> <a id="7873" class="Symbol">(</a><a id="7874" class="Number">1</a> <a id="7876" href="Data.Rational.Base.html#6933" class="Function Operator">⊓</a> <a id="7878" href="Ledger.Conway.Specification.Epoch.html#6102" class="Function">η</a><a id="7879" class="Symbol">)</a> <a id="7881" class="Symbol">(</a><a id="7882" href="Ledger.Conway.Specification.Epoch.html#5623" class="Function">prevPp</a> <a id="7889" class="Symbol">.</a><a id="7890" href="Ledger.Conway.Specification.PParams.html#2281" class="Field">PParams.monetaryExpansion</a><a id="7915" class="Symbol">)</a> <a id="7917" href="Ledger.Conway.Specification.Epoch.html#7659" class="Function">min1η-nonneg</a><a id="7929" class="Symbol">)</a>
          <a id="7941" class="Symbol">(</a><a id="7942" href="stdlib.Data.Rational.Properties.html#2275" class="Function">fromℕ-0≤</a> <a id="7951" href="Ledger.Conway.Specification.Epoch.html#5675" class="Function">reserves</a><a id="7959" class="Symbol">))</a>

      <a id="7969" href="Ledger.Conway.Specification.Epoch.html#7969" class="Function">rewardPot-nonneg</a> <a id="7986" class="Symbol">:</a> <a id="7988" class="Number">0</a> <a id="7990" href="Class.HasOrder.Core.html#613" class="Field Operator">≤</a> <a id="7992" href="Ledger.Conway.Specification.Epoch.html#6311" class="Function">rewardPot</a>
      <a id="8008" href="Ledger.Conway.Specification.Epoch.html#7969" class="Function">rewardPot-nonneg</a> <a id="8025" class="Symbol">=</a> <a id="8027" href="Data.Integer.Properties.html#34810" class="Function">+-mono-≤</a> <a id="8036" class="Symbol">(</a><a id="8037" href="Ledger.Conway.Specification.Epoch.html#272" class="Function">nonNegative⁻¹ℤ</a> <a id="8052" class="Symbol">(</a><a id="8053" href="Ledger.Conway.Specification.Epoch.html#76" class="InductiveConstructor">pos</a> <a id="8057" href="Ledger.Conway.Specification.Epoch.html#5808" class="Function">feeSS</a><a id="8062" class="Symbol">))</a> <a id="8065" href="Ledger.Conway.Specification.Epoch.html#7745" class="Function">Δr₁-nonneg</a>

      <a id="8083" href="Ledger.Conway.Specification.Epoch.html#8083" class="Function">Δt-nonneg</a> <a id="8093" class="Symbol">:</a> <a id="8095" class="Number">0</a> <a id="8097" href="Class.HasOrder.Core.html#613" class="Field Operator">≤</a> <a id="8099" href="Ledger.Conway.Specification.Epoch.html#6321" class="Function">Δt₁</a>
      <a id="8109" href="Ledger.Conway.Specification.Epoch.html#8083" class="Function">Δt-nonneg</a> <a id="8119" class="Symbol">=</a> <a id="8121" href="stdlib.Data.Rational.Properties.html#1631" class="Function">0≤⇒0≤floor</a> <a id="8132" class="Symbol">_</a>
        <a id="8142" class="Symbol">(</a><a id="8143" href="Ledger.Prelude.Numeric.UnitInterval.html#3336" class="Function">UnitInterval-*-0≤</a> <a id="8161" class="Symbol">(</a><a id="8162" href="Data.Rational.Literals.html#613" class="Function">fromℤ</a> <a id="8168" href="Ledger.Conway.Specification.Epoch.html#6311" class="Function">rewardPot</a><a id="8177" class="Symbol">)</a> <a id="8179" class="Symbol">(</a><a id="8180" href="Ledger.Conway.Specification.Epoch.html#5623" class="Function">prevPp</a> <a id="8187" class="Symbol">.</a><a id="8188" href="Ledger.Conway.Specification.PParams.html#2351" class="Field">PParams.treasuryCut</a><a id="8207" class="Symbol">)</a>
          <a id="8219" class="Symbol">(</a><a id="8220" href="stdlib.Data.Rational.Properties.html#2013" class="Function">fromℤ-0≤</a> <a id="8229" href="Ledger.Conway.Specification.Epoch.html#6311" class="Function">rewardPot</a> <a id="8239" href="Ledger.Conway.Specification.Epoch.html#7969" class="Function">rewardPot-nonneg</a><a id="8255" class="Symbol">))</a>

      <a id="8265" href="Ledger.Conway.Specification.Epoch.html#8265" class="Function">Δf-nonpos</a> <a id="8275" class="Symbol">:</a> <a id="8277" class="Symbol">(</a><a id="8278" class="Number">0</a> <a id="8280" href="Interface.HasSubtract.html#209" class="Field Operator">-</a> <a id="8282" href="Ledger.Conway.Specification.Epoch.html#76" class="InductiveConstructor">pos</a> <a id="8286" href="Ledger.Conway.Specification.Epoch.html#5808" class="Function">feeSS</a><a id="8291" class="Symbol">)</a> <a id="8293" href="Class.HasOrder.Core.html#613" class="Field Operator">≤</a> <a id="8295" class="Number">0</a>
      <a id="8303" href="Ledger.Conway.Specification.Epoch.html#8265" class="Function">Δf-nonpos</a> <a id="8313" class="Symbol">=</a> <a id="8315" href="Relation.Binary.Reasoning.Syntax.html#1572" class="Function Operator">begin</a>
          <a id="8331" class="Number">0</a> <a id="8333" href="Interface.HasSubtract.html#209" class="Field Operator">-</a> <a id="8335" href="Ledger.Conway.Specification.Epoch.html#76" class="InductiveConstructor">pos</a> <a id="8339" href="Ledger.Conway.Specification.Epoch.html#5808" class="Function">feeSS</a> <a id="8345" href="Relation.Binary.Reasoning.Syntax.html#11048" class="Function">≡⟨</a> <a id="8348" href="Data.Integer.Properties.html#27061" class="Function">+-identityˡ</a> <a id="8360" class="Symbol">_</a> <a id="8362" href="Relation.Binary.Reasoning.Syntax.html#11048" class="Function">⟩</a>
          <a id="8374" href="Data.Integer.Base.html#4719" class="Function Operator">ℤ.-</a> <a id="8378" href="Ledger.Conway.Specification.Epoch.html#76" class="InductiveConstructor">pos</a> <a id="8382" href="Ledger.Conway.Specification.Epoch.html#5808" class="Function">feeSS</a> <a id="8388" href="Relation.Binary.Reasoning.Syntax.html#5544" class="Function">≤⟨</a> <a id="8391" href="Data.Integer.Properties.html#13298" class="Function">neg-mono-≤</a> <a id="8402" class="Symbol">(</a><a id="8403" href="Data.Integer.Base.html#2106" class="InductiveConstructor">ℤ.+≤+</a> <a id="8409" href="Data.Nat.Base.html#1720" class="InductiveConstructor">z≤n</a><a id="8412" class="Symbol">)</a> <a id="8414" href="Relation.Binary.Reasoning.Syntax.html#5544" class="Function">⟩</a>
          <a id="8426" class="Number">0</a>             <a id="8440" href="Relation.Binary.Reasoning.Syntax.html#12345" class="Function Operator">∎</a>
        <a id="8450" class="Keyword">where</a> <a id="8456" class="Keyword">open</a> <a id="8461" href="Data.Integer.Properties.html#11881" class="Module">≤-Reasoning</a>


<a id="applyRUpd"></a><a id="8475" href="Ledger.Conway.Specification.Epoch.html#8475" class="Function">applyRUpd</a> <a id="8485" class="Symbol">:</a> <a id="8487" href="Ledger.Conway.Specification.Rewards.html#6210" class="Record">RewardUpdate</a> <a id="8500" class="Symbol">→</a> <a id="8502" href="Ledger.Conway.Specification.Epoch.html#1703" class="Record">EpochState</a> <a id="8513" class="Symbol">→</a> <a id="8515" href="Ledger.Conway.Specification.Epoch.html#1703" class="Record">EpochState</a>
<a id="8526" href="Ledger.Conway.Specification.Epoch.html#8475" class="Function">applyRUpd</a> <a id="8536" href="Ledger.Conway.Specification.Epoch.html#8536" class="Bound">rewardUpdate</a> <a class="AgdaKaTeX">$\begin{pmatrix} \begin{pmatrix} \,\href{Ledger.Conway.Specification.Epoch.html#8553}{\htmlId{8553}{\htmlClass{Bound}{\text{treasury}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#8564}{\htmlId{8564}{\htmlClass{Bound}{\text{reserves}}}}\, \end{pmatrix}
                       \\ \,\href{Ledger.Conway.Specification.Epoch.html#8601}{\htmlId{8601}{\htmlClass{Bound}{\text{ss}}}}\,
                       \\ \begin{pmatrix} \begin{pmatrix} \,\href{Ledger.Conway.Specification.Epoch.html#8633}{\htmlId{8633}{\htmlClass{Bound}{\text{utxo}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#8640}{\htmlId{8640}{\htmlClass{Bound}{\text{fees}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#8647}{\htmlId{8647}{\htmlClass{Bound}{\text{deposits}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#8658}{\htmlId{8658}{\htmlClass{Bound}{\text{donations}}}}\, \end{pmatrix}
                         \\ \,\href{Ledger.Conway.Specification.Epoch.html#8698}{\htmlId{8698}{\htmlClass{Bound}{\text{govSt}}}}\,
                         \\ \begin{pmatrix} \begin{pmatrix} \,\href{Ledger.Conway.Specification.Epoch.html#8735}{\htmlId{8735}{\htmlClass{Bound}{\text{voteDelegs}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#8748}{\htmlId{8748}{\htmlClass{Bound}{\text{stakeDelegs}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#8762}{\htmlId{8762}{\htmlClass{Bound}{\text{rewards}}}}\, \end{pmatrix} \\ \,\href{Ledger.Conway.Specification.Epoch.html#8775}{\htmlId{8775}{\htmlClass{Bound}{\text{pState}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#8784}{\htmlId{8784}{\htmlClass{Bound}{\text{gState}}}}\, \end{pmatrix} \end{pmatrix}
                       \\ \,\href{Ledger.Conway.Specification.Epoch.html#8823}{\htmlId{8823}{\htmlClass{Bound}{\text{es}}}}\,
                       \\ \,\href{Ledger.Conway.Specification.Epoch.html#8851}{\htmlId{8851}{\htmlClass{Bound}{\text{fut}}}}\,
                       \end{pmatrix}$</a> <a id="8882" class="Symbol">=</a> <a class="AgdaKaTeX">$\begin{pmatrix} \begin{pmatrix} \,\href{Prelude.html#3279}{\htmlId{8888}{\htmlClass{Function}{\text{posPart}}}}\, \,\htmlId{8896}{\htmlClass{Symbol}{\text{(}}}\,\,\href{Ledger.Conway.Specification.Epoch.html#76}{\htmlId{8897}{\htmlClass{InductiveConstructor}{\text{pos}}}}\, \,\href{Ledger.Conway.Specification.Epoch.html#8553}{\htmlId{8901}{\htmlClass{Bound}{\text{treasury}}}}\, \,\href{Class.HasAdd.Core.html#162}{\htmlId{8910}{\htmlClass{Field Operator}{\text{+}}}}\, \,\href{Ledger.Conway.Specification.Rewards.html#6247}{\htmlId{8912}{\htmlClass{Function}{\text{Δt}}}}\, \,\href{Class.HasAdd.Core.html#162}{\htmlId{8915}{\htmlClass{Field Operator}{\text{+}}}}\, \,\href{Ledger.Conway.Specification.Epoch.html#76}{\htmlId{8917}{\htmlClass{InductiveConstructor}{\text{pos}}}}\, \,\href{Ledger.Conway.Specification.Epoch.html#9472}{\htmlId{8921}{\htmlClass{Function}{\text{unregRU&#39;}}}}\,\,\htmlId{8929}{\htmlClass{Symbol}{\text{)}}}\,
                               \\ \,\href{Prelude.html#3279}{\htmlId{8964}{\htmlClass{Function}{\text{posPart}}}}\, \,\htmlId{8972}{\htmlClass{Symbol}{\text{(}}}\,\,\href{Ledger.Conway.Specification.Epoch.html#76}{\htmlId{8973}{\htmlClass{InductiveConstructor}{\text{pos}}}}\, \,\href{Ledger.Conway.Specification.Epoch.html#8564}{\htmlId{8977}{\htmlClass{Bound}{\text{reserves}}}}\, \,\href{Class.HasAdd.Core.html#162}{\htmlId{8986}{\htmlClass{Field Operator}{\text{+}}}}\, \,\href{Ledger.Conway.Specification.Rewards.html#6250}{\htmlId{8988}{\htmlClass{Function}{\text{Δr}}}}\,\,\htmlId{8990}{\htmlClass{Symbol}{\text{)}}}\, \end{pmatrix}
                             \\ \,\href{Ledger.Conway.Specification.Epoch.html#8601}{\htmlId{9025}{\htmlClass{Bound}{\text{ss}}}}\,
                             \\ \begin{pmatrix} \begin{pmatrix} \,\href{Ledger.Conway.Specification.Epoch.html#8633}{\htmlId{9063}{\htmlClass{Bound}{\text{utxo}}}}\, \\ \,\href{Prelude.html#3279}{\htmlId{9070}{\htmlClass{Function}{\text{posPart}}}}\, \,\htmlId{9078}{\htmlClass{Symbol}{\text{(}}}\,\,\href{Ledger.Conway.Specification.Epoch.html#76}{\htmlId{9079}{\htmlClass{InductiveConstructor}{\text{pos}}}}\, \,\href{Ledger.Conway.Specification.Epoch.html#8640}{\htmlId{9083}{\htmlClass{Bound}{\text{fees}}}}\, \,\href{Class.HasAdd.Core.html#162}{\htmlId{9088}{\htmlClass{Field Operator}{\text{+}}}}\, \,\href{Ledger.Conway.Specification.Rewards.html#6253}{\htmlId{9090}{\htmlClass{Function}{\text{Δf}}}}\,\,\htmlId{9092}{\htmlClass{Symbol}{\text{)}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#8647}{\htmlId{9096}{\htmlClass{Bound}{\text{deposits}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#8658}{\htmlId{9107}{\htmlClass{Bound}{\text{donations}}}}\, \end{pmatrix}
                               \\ \,\href{Ledger.Conway.Specification.Epoch.html#8698}{\htmlId{9152}{\htmlClass{Bound}{\text{govSt}}}}\,
                               \\ \begin{pmatrix} \begin{pmatrix} \,\href{Ledger.Conway.Specification.Epoch.html#8735}{\htmlId{9195}{\htmlClass{Bound}{\text{voteDelegs}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#8748}{\htmlId{9208}{\htmlClass{Bound}{\text{stakeDelegs}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#8762}{\htmlId{9222}{\htmlClass{Bound}{\text{rewards}}}}\, \,\href{Axiom.Set.Map.Dec.html#2046}{\htmlId{9230}{\htmlClass{Function Operator}{\text{∪⁺}}}}\, \,\href{Ledger.Conway.Specification.Epoch.html#9404}{\htmlId{9233}{\htmlClass{Function}{\text{regRU}}}}\, \end{pmatrix} \\ \,\href{Ledger.Conway.Specification.Epoch.html#8775}{\htmlId{9243}{\htmlClass{Bound}{\text{pState}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#8784}{\htmlId{9252}{\htmlClass{Bound}{\text{gState}}}}\, \end{pmatrix} \end{pmatrix}
                             \\ \,\href{Ledger.Conway.Specification.Epoch.html#8823}{\htmlId{9294}{\htmlClass{Bound}{\text{es}}}}\,
                             \\ \,\href{Ledger.Conway.Specification.Epoch.html#8851}{\htmlId{9328}{\htmlClass{Bound}{\text{fut}}}}\, \end{pmatrix}$</a>
  <a id="9336" class="Keyword">where</a>
    <a id="9346" class="Keyword">open</a> <a id="9351" href="Ledger.Conway.Specification.Rewards.html#6210" class="Module">RewardUpdate</a> <a id="9364" href="Ledger.Conway.Specification.Epoch.html#8536" class="Bound">rewardUpdate</a> <a id="9377" class="Keyword">using</a> <a id="9383" class="Symbol">(</a><a id="9384" href="Ledger.Conway.Specification.Rewards.html#6247" class="Field">Δt</a><a id="9386" class="Symbol">;</a> <a id="9388" href="Ledger.Conway.Specification.Rewards.html#6250" class="Field">Δr</a><a id="9390" class="Symbol">;</a> <a id="9392" href="Ledger.Conway.Specification.Rewards.html#6253" class="Field">Δf</a><a id="9394" class="Symbol">;</a> <a id="9396" href="Ledger.Conway.Specification.Rewards.html#6273" class="Field">rs</a><a id="9398" class="Symbol">)</a>
    <a id="9404" href="Ledger.Conway.Specification.Epoch.html#9404" class="Function">regRU</a>     <a id="9414" class="Symbol">=</a> <a id="9416" href="Ledger.Conway.Specification.Rewards.html#6273" class="Function">rs</a> <a id="9419" href="Axiom.Set.Map.html#10678" class="Function Operator">∣</a> <a id="9421" href="Class.IsSet.html#916" class="Function">dom</a> <a id="9425" href="Ledger.Conway.Specification.Epoch.html#8762" class="Bound">rewards</a>
    <a id="9437" href="Ledger.Conway.Specification.Epoch.html#9437" class="Function">unregRU</a>   <a id="9447" class="Symbol">=</a> <a id="9449" href="Ledger.Conway.Specification.Rewards.html#6273" class="Function">rs</a> <a id="9452" href="Axiom.Set.Map.html#10748" class="Function Operator">∣</a> <a id="9454" href="Class.IsSet.html#916" class="Function">dom</a> <a id="9458" href="Ledger.Conway.Specification.Epoch.html#8762" class="Bound">rewards</a> <a id="9466" href="Axiom.Set.Map.html#10748" class="Function Operator">ᶜ</a>
    <a id="9472" href="Ledger.Conway.Specification.Epoch.html#9472" class="Function">unregRU&#39;</a>  <a id="9482" class="Symbol">=</a> <a id="9484" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">∑[</a> <a id="9487" href="Ledger.Conway.Specification.Epoch.html#9487" class="Bound">x</a> <a id="9489" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">←</a> <a id="9491" href="Ledger.Conway.Specification.Epoch.html#9437" class="Function">unregRU</a> <a id="9499" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">]</a> <a id="9501" href="Ledger.Conway.Specification.Epoch.html#9487" class="Bound">x</a>


<a id="9505" class="Keyword">open</a> <a id="9510" href="Ledger.Core.Specification.Address.html#1324" class="Module">RwdAddr</a> <a id="9518" class="Keyword">using</a> <a id="9524" class="Symbol">(</a><a id="9525" href="Ledger.Core.Specification.Address.html#1378" class="Field">stake</a><a id="9530" class="Symbol">)</a>
<a id="9532" class="Keyword">opaque</a>


  <a id="calculatePoolDelegatedStake"></a><a id="9543" href="Ledger.Conway.Specification.Epoch.html#9543" class="Function">calculatePoolDelegatedStake</a> <a id="9571" class="Symbol">:</a> <a id="9573" href="Ledger.Conway.Specification.Rewards.html#6433" class="Record">Snapshot</a> <a id="9582" class="Symbol">→</a> <a id="9584" href="Ledger.Conway.Specification.Epoch.html#3049" class="Function">PoolDelegatedStake</a>
  <a id="9605" href="Ledger.Conway.Specification.Epoch.html#9543" class="Function">calculatePoolDelegatedStake</a> <a id="9633" href="Ledger.Conway.Specification.Epoch.html#9633" class="Bound">ss</a> <a id="9636" class="Symbol">=</a>
      <a id="9644" class="Comment">-- Shelley spec: the output map must contain keys appearing in both</a>
      <a id="9718" class="Comment">-- sd and the pool parameters.</a>
      <a id="9755" href="Ledger.Conway.Specification.Epoch.html#10011" class="Function">sd</a> <a id="9758" href="Axiom.Set.Map.html#10678" class="Function Operator">∣</a> <a id="9760" href="Class.IsSet.html#916" class="Function">dom</a> <a id="9764" class="Symbol">(</a><a id="9765" href="Ledger.Conway.Specification.Epoch.html#9633" class="Bound">ss</a> <a id="9768" class="Symbol">.</a><a id="9769" href="Ledger.Conway.Specification.Rewards.html#6522" class="Field">pools</a><a id="9774" class="Symbol">)</a>
    <a id="9780" class="Keyword">where</a>
      <a id="9792" class="Keyword">open</a> <a id="9797" href="Ledger.Conway.Specification.Rewards.html#6433" class="Module">Snapshot</a>

      <a id="9813" class="Comment">-- stake credentials delegating to each pool</a>
      <a id="9864" href="Ledger.Conway.Specification.Epoch.html#9864" class="Function">stakeCredentialsPerPool</a> <a id="9888" class="Symbol">:</a> <a id="9890" href="Axiom.Set.Rel.html#1297" class="Function">Rel</a> <a id="9894" href="Ledger.Core.Specification.Crypto.html#1386" class="Function">KeyHash</a> <a id="9902" href="Ledger.Core.Specification.Address.html#260" class="Datatype">Credential</a>
      <a id="9919" href="Ledger.Conway.Specification.Epoch.html#9864" class="Function">stakeCredentialsPerPool</a> <a id="9943" class="Symbol">=</a> <a id="9945" class="Symbol">(</a><a id="9946" href="Ledger.Conway.Specification.Certs.html#1976" class="Field">StakeDelegsOf</a> <a id="9960" href="Ledger.Conway.Specification.Epoch.html#9633" class="Bound">ss</a> <a id="9963" href="Axiom.Set.Map.html#2293" class="Function Operator">ˢ</a><a id="9964" class="Symbol">)</a> <a id="9966" href="Ledger.Prelude.html#2638" class="Function Operator">⁻¹ʳ</a>

      <a id="9977" class="Comment">-- delegated stake per pool</a>
      <a id="10011" href="Ledger.Conway.Specification.Epoch.html#10011" class="Function">sd</a> <a id="10014" class="Symbol">:</a> <a id="10016" href="Ledger.Core.Specification.Crypto.html#1386" class="Function">KeyHash</a> <a id="10024" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="10026" href="Ledger.Prelude.Base.html#154" class="Function">Coin</a>
      <a id="10037" href="Ledger.Conway.Specification.Epoch.html#10011" class="Function">sd</a> <a id="10040" class="Symbol">=</a> <a id="10042" href="Axiom.Set.Map.Dec.html#2124" class="Function">aggregate₊</a> <a id="10053" class="Symbol">((</a><a id="10055" href="Ledger.Conway.Specification.Epoch.html#9864" class="Function">stakeCredentialsPerPool</a> <a id="10079" href="Ledger.Prelude.html#2751" class="Function Operator">∘ʳ</a> <a id="10082" class="Symbol">(</a><a id="10083" href="Ledger.Conway.Specification.Certs.html#1892" class="Field">StakeOf</a> <a id="10091" href="Ledger.Conway.Specification.Epoch.html#9633" class="Bound">ss</a> <a id="10094" href="Axiom.Set.Map.html#2293" class="Function Operator">ˢ</a><a id="10095" class="Symbol">))</a> <a id="10098" href="abstract-set-theory.FiniteSetTheory.html#2767" class="Function Operator">ᶠˢ</a><a id="10100" class="Symbol">)</a>

  <a id="calculateVDelegDelegatedStake"></a><a id="10105" href="Ledger.Conway.Specification.Epoch.html#10105" class="Function">calculateVDelegDelegatedStake</a>
    <a id="10139" class="Symbol">:</a> <a id="10141" href="Ledger.Core.Specification.Epoch.html#598" class="Function">Epoch</a>
    <a id="10151" class="Symbol">→</a> <a id="10153" href="Ledger.Conway.Specification.Utxo.html#1230" class="Record">UTxOState</a>
    <a id="10167" class="Symbol">→</a> <a id="10169" href="Ledger.Conway.Specification.Gov.html#1479" class="Function">GovState</a>
    <a id="10182" class="Symbol">→</a> <a id="10184" href="Ledger.Conway.Specification.Certs.html#4103" class="Record">GState</a>
    <a id="10195" class="Symbol">→</a> <a id="10197" href="Ledger.Conway.Specification.Certs.html#3862" class="Record">DState</a>
    <a id="10208" class="Symbol">→</a> <a id="10210" href="Ledger.Conway.Specification.Gov.Actions.html#674" class="Datatype">VDeleg</a> <a id="10217" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="10219" href="Ledger.Prelude.Base.html#154" class="Function">Coin</a>
  <a id="10226" href="Ledger.Conway.Specification.Epoch.html#10105" class="Function">calculateVDelegDelegatedStake</a> <a id="10256" href="Ledger.Conway.Specification.Epoch.html#10256" class="Bound">currentEpoch</a> <a id="10269" href="Ledger.Conway.Specification.Epoch.html#10269" class="Bound">utxoSt</a> <a id="10276" href="Ledger.Conway.Specification.Epoch.html#10276" class="Bound">govSt</a> <a id="10282" href="Ledger.Conway.Specification.Epoch.html#10282" class="Bound">gState</a> <a id="10289" href="Ledger.Conway.Specification.Epoch.html#10289" class="Bound">dState</a>
    <a id="10300" class="Symbol">=</a> <a id="10302" href="Axiom.Set.Map.Dec.html#2124" class="Function">aggregate₊</a> <a id="10313" class="Symbol">(((</a><a id="10316" href="Ledger.Conway.Specification.Epoch.html#10687" class="Function">activeVoteDelegs</a> <a id="10333" href="Axiom.Set.Map.html#2293" class="Function Operator">ˢ</a><a id="10334" class="Symbol">)</a> <a id="10336" href="Ledger.Prelude.html#2638" class="Function Operator">⁻¹ʳ</a>
                  <a id="10358" href="Ledger.Prelude.html#2751" class="Function Operator">∘ʳ</a> <a id="10361" class="Symbol">(</a><a id="10362" href="Ledger.Conway.Specification.Epoch.html#10926" class="Function">stakePerCredential</a> <a id="10381" href="Axiom.Set.Map.Dec.html#2046" class="Function Operator">∪⁺</a> <a id="10384" href="Ledger.Conway.Specification.Epoch.html#11556" class="Function">stakeFromRewards</a> <a id="10401" href="Axiom.Set.Map.Dec.html#2046" class="Function Operator">∪⁺</a> <a id="10404" href="Ledger.Conway.Specification.Epoch.html#11172" class="Function">stakeFromGADeposits</a><a id="10423" class="Symbol">)</a> <a id="10425" href="Axiom.Set.Map.html#2293" class="Function Operator">ˢ</a><a id="10426" class="Symbol">)</a> <a id="10428" href="abstract-set-theory.FiniteSetTheory.html#2767" class="Function Operator">ᶠˢ</a><a id="10430" class="Symbol">)</a>
    <a id="10436" class="Keyword">where</a>
      <a id="10448" class="Keyword">open</a> <a id="10453" href="Ledger.Conway.Specification.Utxo.html#1230" class="Module">UTxOState</a> <a id="10463" href="Ledger.Conway.Specification.Epoch.html#10269" class="Bound">utxoSt</a>
      <a id="10476" class="Keyword">open</a> <a id="10481" href="Ledger.Conway.Specification.Certs.html#3862" class="Module">DState</a> <a id="10488" href="Ledger.Conway.Specification.Epoch.html#10289" class="Bound">dState</a>
      <a id="10501" class="Keyword">open</a> <a id="10506" href="Ledger.Conway.Specification.Certs.html#4103" class="Module">GState</a> <a id="10513" href="Ledger.Conway.Specification.Epoch.html#10282" class="Bound">gState</a>

      <a id="10527" class="Comment">-- active DReps</a>
      <a id="10549" href="Ledger.Conway.Specification.Epoch.html#10549" class="Function">activeDReps</a> <a id="10561" class="Symbol">:</a> <a id="10563" href="abstract-set-theory.FiniteSetTheory.html#488" class="Function Operator">ℙ</a> <a id="10565" href="Ledger.Core.Specification.Address.html#260" class="Datatype">Credential</a>
      <a id="10582" href="Ledger.Conway.Specification.Epoch.html#10549" class="Function">activeDReps</a> <a id="10594" class="Symbol">=</a> <a id="10596" href="Class.IsSet.html#916" class="Function">dom</a> <a id="10600" class="Symbol">(</a><a id="10601" href="abstract-set-theory.FiniteSetTheory.html#2895" class="Function">filterᵐ</a> <a id="10609" class="Symbol">(λ</a> <a id="10612" class="Symbol">(_</a> <a id="10615" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="10617" href="Ledger.Conway.Specification.Epoch.html#10617" class="Bound">e</a><a id="10618" class="Symbol">)</a> <a id="10620" class="Symbol">→</a> <a id="10622" href="Ledger.Conway.Specification.Epoch.html#10256" class="Bound">currentEpoch</a> <a id="10635" href="Class.HasOrder.Core.html#613" class="Field Operator">≤</a> <a id="10637" href="Ledger.Conway.Specification.Epoch.html#10617" class="Bound">e</a><a id="10638" class="Symbol">)</a> <a id="10640" href="Ledger.Conway.Specification.Certs.html#4160" class="Function">dreps</a><a id="10645" class="Symbol">)</a>

      <a id="10654" class="Comment">-- active vote delegations</a>
      <a id="10687" href="Ledger.Conway.Specification.Epoch.html#10687" class="Function">activeVoteDelegs</a> <a id="10704" class="Symbol">:</a> <a id="10706" href="Ledger.Conway.Specification.Gov.Actions.html#810" class="Function">VoteDelegs</a>
      <a id="10723" href="Ledger.Conway.Specification.Epoch.html#10687" class="Function">activeVoteDelegs</a> <a id="10740" class="Symbol">=</a> <a id="10742" href="Ledger.Conway.Specification.Certs.html#3921" class="Field">voteDelegs</a> <a id="10753" href="Axiom.Set.Map.html#14434" class="Function Operator">∣^</a> <a id="10756" class="Symbol">((</a><a id="10758" href="abstract-set-theory.FiniteSetTheory.html#519" class="Function">mapˢ</a> <a id="10763" href="Ledger.Conway.Specification.Gov.Actions.html#696" class="InductiveConstructor">vDelegCredential</a> <a id="10780" href="Ledger.Conway.Specification.Epoch.html#10549" class="Function">activeDReps</a><a id="10791" class="Symbol">)</a>
                                        <a id="10833" href="Axiom.Set.html#8952" class="Function Operator">∪</a> <a id="10835" href="Class.HasSingleton.html#288" class="Field Operator">❴</a> <a id="10837" href="Ledger.Conway.Specification.Gov.Actions.html#769" class="InductiveConstructor">vDelegNoConfidence</a> <a id="10856" href="Class.HasSingleton.html#288" class="Field Operator">❵</a> <a id="10858" href="Axiom.Set.html#8952" class="Function Operator">∪</a> <a id="10860" href="Class.HasSingleton.html#288" class="Field Operator">❴</a> <a id="10862" href="Ledger.Conway.Specification.Gov.Actions.html#739" class="InductiveConstructor">vDelegAbstain</a> <a id="10876" href="Class.HasSingleton.html#288" class="Field Operator">❵</a><a id="10877" class="Symbol">)</a>

      <a id="10886" class="Comment">-- stake per delegated credential</a>
      <a id="10926" href="Ledger.Conway.Specification.Epoch.html#10926" class="Function">stakePerCredential</a> <a id="10945" class="Symbol">:</a> <a id="10947" href="Ledger.Conway.Specification.Certs.html#1121" class="Function">Stake</a>
      <a id="10959" href="Ledger.Conway.Specification.Epoch.html#10926" class="Function">stakePerCredential</a> <a id="10978" class="Symbol">=</a> <a id="10980" href="Axiom.Set.Map.html#8368" class="Function">mapFromFun</a> <a id="10991" class="Symbol">(λ</a> <a id="10994" href="Ledger.Conway.Specification.Epoch.html#10994" class="Bound">c</a> <a id="10996" class="Symbol">→</a> <a id="10998" href="Ledger.Conway.Specification.Utxo.html#2456" class="Function">cbalance</a> <a id="11007" class="Symbol">(</a><a id="11008" href="Ledger.Conway.Specification.Utxo.html#1294" class="Function">utxo</a> <a id="11013" href="abstract-set-theory.FiniteSetTheory.html#3088" class="Function Operator">∣^&#39;</a> <a id="11017" class="Symbol">λ</a> <a id="11019" href="Ledger.Conway.Specification.Epoch.html#11019" class="Bound">txout</a> <a id="11025" class="Symbol">→</a> <a id="11027" href="Ledger.Conway.Specification.Epoch.html#5107" class="Function">getStakeCred</a> <a id="11040" href="Ledger.Conway.Specification.Epoch.html#11019" class="Bound">txout</a> <a id="11046" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="11048" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="11053" href="Ledger.Conway.Specification.Epoch.html#10994" class="Bound">c</a><a id="11054" class="Symbol">))</a>
                                      <a id="11095" class="Symbol">(</a><a id="11096" href="Class.IsSet.html#916" class="Function">dom</a> <a id="11100" href="Ledger.Conway.Specification.Epoch.html#10687" class="Function">activeVoteDelegs</a><a id="11116" class="Symbol">)</a>

      <a id="11125" class="Comment">-- stake from governance action deposits</a>
      <a id="11172" href="Ledger.Conway.Specification.Epoch.html#11172" class="Function">stakeFromGADeposits</a> <a id="11192" class="Symbol">:</a> <a id="11194" href="Ledger.Conway.Specification.Certs.html#1121" class="Function">Stake</a>
      <a id="11206" href="Ledger.Conway.Specification.Epoch.html#11172" class="Function">stakeFromGADeposits</a> <a id="11226" class="Symbol">=</a> <a id="11228" href="abstract-set-theory.FiniteSetTheory.html#3599" class="Function">aggregateBy</a>
        <a id="11248" class="Symbol">(</a><a id="11249" href="abstract-set-theory.FiniteSetTheory.html#519" class="Function">mapˢ</a> <a id="11254" class="Symbol">(λ</a> <a id="11257" class="Symbol">(</a><a id="11258" href="Ledger.Conway.Specification.Epoch.html#11258" class="Bound">gaid</a> <a id="11263" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="11265" href="Ledger.Conway.Specification.Epoch.html#11265" class="Bound">addr</a><a id="11269" class="Symbol">)</a> <a id="11271" class="Symbol">→</a> <a id="11273" class="Symbol">(</a><a id="11274" href="Ledger.Conway.Specification.Epoch.html#11258" class="Bound">gaid</a> <a id="11279" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="11281" href="Ledger.Conway.Specification.Epoch.html#11265" class="Bound">addr</a><a id="11285" class="Symbol">)</a> <a id="11287" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="11289" href="Ledger.Core.Specification.Address.html#1378" class="Field">stake</a> <a id="11295" href="Ledger.Conway.Specification.Epoch.html#11265" class="Bound">addr</a><a id="11299" class="Symbol">)</a> <a id="11301" href="Ledger.Conway.Specification.Epoch.html#11427" class="Function">govSt&#39;</a><a id="11307" class="Symbol">)</a>
        <a id="11317" class="Symbol">(</a><a id="11318" href="Axiom.Set.Map.html#10460" class="Function">mapFromPartialFun</a> <a id="11336" class="Symbol">(λ</a> <a id="11339" class="Symbol">(</a><a id="11340" href="Ledger.Conway.Specification.Epoch.html#11340" class="Bound">gaid</a> <a id="11345" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="11347" class="Symbol">_)</a> <a id="11350" class="Symbol">→</a> <a id="11352" href="Axiom.Set.Map.html#13828" class="Function">lookupᵐ?</a> <a id="11361" href="Ledger.Conway.Specification.Utxo.html#1338" class="Function">deposits</a> <a id="11370" class="Symbol">(</a><a id="11371" href="Ledger.Conway.Specification.Certs.html#737" class="InductiveConstructor">GovActionDeposit</a> <a id="11388" href="Ledger.Conway.Specification.Epoch.html#11340" class="Bound">gaid</a><a id="11392" class="Symbol">))</a> <a id="11395" href="Ledger.Conway.Specification.Epoch.html#11427" class="Function">govSt&#39;</a><a id="11401" class="Symbol">)</a>
        <a id="11411" class="Keyword">where</a>
          <a id="11427" href="Ledger.Conway.Specification.Epoch.html#11427" class="Function">govSt&#39;</a> <a id="11434" class="Symbol">:</a> <a id="11436" href="abstract-set-theory.FiniteSetTheory.html#488" class="Function Operator">ℙ</a> <a id="11438" class="Symbol">(</a><a id="11439" href="Ledger.Conway.Specification.Gov.Actions.html#798" class="Function">GovActionID</a> <a id="11451" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="11453" href="Ledger.Core.Specification.Address.html#1324" class="Record">RwdAddr</a><a id="11460" class="Symbol">)</a>
          <a id="11472" href="Ledger.Conway.Specification.Epoch.html#11427" class="Function">govSt&#39;</a> <a id="11479" class="Symbol">=</a> <a id="11481" href="abstract-set-theory.FiniteSetTheory.html#519" class="Function">mapˢ</a> <a id="11486" class="Symbol">(</a><a id="11487" href="Class.Bifunctor.html#1152" class="Function">map₂</a> <a id="11492" href="Ledger.Conway.Specification.Gov.Actions.html#3835" class="Field">returnAddr</a><a id="11502" class="Symbol">)</a> <a id="11504" class="Symbol">(</a><a id="11505" href="Axiom.Set.html#5718" class="Function">fromList</a> <a id="11514" href="Ledger.Conway.Specification.Epoch.html#10276" class="Bound">govSt</a><a id="11519" class="Symbol">)</a>

      <a id="11528" class="Comment">-- stake from rewards</a>
      <a id="11556" href="Ledger.Conway.Specification.Epoch.html#11556" class="Function">stakeFromRewards</a> <a id="11573" class="Symbol">:</a> <a id="11575" href="Ledger.Conway.Specification.Certs.html#1121" class="Function">Stake</a>
      <a id="11587" href="Ledger.Conway.Specification.Epoch.html#11556" class="Function">stakeFromRewards</a> <a id="11604" class="Symbol">=</a> <a id="11606" href="Ledger.Conway.Specification.Certs.html#1811" class="Field">RewardsOf</a> <a id="11616" href="Ledger.Conway.Specification.Epoch.html#10289" class="Bound">dState</a>

  <a id="mkStakeDistrs"></a><a id="11626" href="Ledger.Conway.Specification.Epoch.html#11626" class="Function">mkStakeDistrs</a>
    <a id="11644" class="Symbol">:</a> <a id="11646" href="Ledger.Conway.Specification.Rewards.html#6433" class="Record">Snapshot</a>
    <a id="11659" class="Symbol">→</a> <a id="11661" href="Ledger.Core.Specification.Epoch.html#598" class="Function">Epoch</a>
    <a id="11671" class="Symbol">→</a> <a id="11673" href="Ledger.Conway.Specification.Utxo.html#1230" class="Record">UTxOState</a>
    <a id="11687" class="Symbol">→</a> <a id="11689" href="Ledger.Conway.Specification.Gov.html#1479" class="Function">GovState</a>
    <a id="11702" class="Symbol">→</a> <a id="11704" href="Ledger.Conway.Specification.Certs.html#4103" class="Record">GState</a>
    <a id="11715" class="Symbol">→</a> <a id="11717" href="Ledger.Conway.Specification.Certs.html#3862" class="Record">DState</a>
    <a id="11728" class="Symbol">→</a> <a id="11730" href="Ledger.Conway.Specification.Ratify.html#2963" class="Record">StakeDistrs</a>
  <a id="11744" href="Ledger.Conway.Specification.Epoch.html#11626" class="Function">mkStakeDistrs</a> <a id="11758" href="Ledger.Conway.Specification.Epoch.html#11758" class="Bound">ss</a> <a id="11761" href="Ledger.Conway.Specification.Epoch.html#11761" class="Bound">currentEpoch</a> <a id="11774" href="Ledger.Conway.Specification.Epoch.html#11774" class="Bound">utxoSt</a> <a id="11781" href="Ledger.Conway.Specification.Epoch.html#11781" class="Bound">govSt</a> <a id="11787" href="Ledger.Conway.Specification.Epoch.html#11787" class="Bound">gState</a> <a id="11794" href="Ledger.Conway.Specification.Epoch.html#11794" class="Bound">dState</a> <a id="11801" class="Symbol">=</a>
    <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.Conway.Specification.Epoch.html#10105}{\htmlId{11809}{\htmlClass{Function}{\text{calculateVDelegDelegatedStake}}}}\, \,\href{Ledger.Conway.Specification.Epoch.html#11761}{\htmlId{11839}{\htmlClass{Bound}{\text{currentEpoch}}}}\, \,\href{Ledger.Conway.Specification.Epoch.html#11774}{\htmlId{11852}{\htmlClass{Bound}{\text{utxoSt}}}}\, \,\href{Ledger.Conway.Specification.Epoch.html#11781}{\htmlId{11859}{\htmlClass{Bound}{\text{govSt}}}}\, \,\href{Ledger.Conway.Specification.Epoch.html#11787}{\htmlId{11865}{\htmlClass{Bound}{\text{gState}}}}\, \,\href{Ledger.Conway.Specification.Epoch.html#11794}{\htmlId{11872}{\htmlClass{Bound}{\text{dState}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#11918}{\htmlId{11881}{\htmlClass{Function}{\text{poolDelegatedStake}}}}\, \end{pmatrix}$</a>
    <a id="11906" class="Keyword">where</a>
      <a id="11918" href="Ledger.Conway.Specification.Epoch.html#11918" class="Function">poolDelegatedStake</a> <a id="11937" class="Symbol">:</a> <a id="11939" href="Ledger.Conway.Specification.Epoch.html#3049" class="Function">PoolDelegatedStake</a>
      <a id="11964" href="Ledger.Conway.Specification.Epoch.html#11918" class="Function">poolDelegatedStake</a> <a id="11983" class="Symbol">=</a>
        <a id="11993" href="Axiom.Set.Map.html#8706" class="Function">mapWithKey</a> <a id="12004" class="Symbol">(λ</a> <a id="12007" href="Ledger.Conway.Specification.Epoch.html#12007" class="Bound">kh</a> <a id="12010" href="Ledger.Conway.Specification.Epoch.html#12010" class="Bound">c</a> <a id="12012" class="Symbol">→</a> <a id="12014" href="Data.Maybe.Base.html#1276" class="Function">maybe</a> <a id="12020" class="Symbol">(</a><a id="12021" href="Ledger.Conway.Specification.Epoch.html#12010" class="Bound">c</a> <a id="12023" href="Class.HasAdd.Core.html#162" class="Field Operator">+_</a><a id="12025" class="Symbol">)</a> <a id="12027" href="Ledger.Conway.Specification.Epoch.html#12010" class="Bound">c</a> <a id="12029" class="Symbol">(</a><a id="12030" href="Axiom.Set.Map.html#13828" class="Function">lookupᵐ?</a> <a id="12039" class="Symbol">(</a><a id="12040" href="Ledger.Conway.Specification.Certs.html#1811" class="Field">RewardsOf</a> <a id="12050" href="Ledger.Conway.Specification.Epoch.html#11794" class="Bound">dState</a><a id="12056" class="Symbol">)</a> <a id="12058" class="Symbol">(</a><a id="12059" href="Ledger.Core.Specification.Address.html#286" class="InductiveConstructor">KeyHashObj</a> <a id="12070" href="Ledger.Conway.Specification.Epoch.html#12007" class="Bound">kh</a><a id="12072" class="Symbol">)))</a>
                   <a id="12095" class="Symbol">(</a><a id="12096" href="Ledger.Conway.Specification.Epoch.html#9543" class="Function">calculatePoolDelegatedStake</a> <a id="12124" href="Ledger.Conway.Specification.Epoch.html#11758" class="Bound">ss</a><a id="12126" class="Symbol">)</a>


<a id="12130" class="Keyword">private</a> <a id="12138" class="Keyword">variable</a>
  <a id="12149" href="Ledger.Conway.Specification.Epoch.html#12149" class="Generalizable">e</a> <a id="12151" href="Ledger.Conway.Specification.Epoch.html#12151" class="Generalizable">lastEpoch</a> <a id="12161" class="Symbol">:</a> <a id="12163" href="Ledger.Core.Specification.Epoch.html#598" class="Function">Epoch</a>
  <a id="12171" href="Ledger.Conway.Specification.Epoch.html#12171" class="Generalizable">fut</a> <a id="12175" href="Ledger.Conway.Specification.Epoch.html#12175" class="Generalizable">fut&#39;</a> <a id="12180" class="Symbol">:</a> <a id="12182" href="Ledger.Conway.Specification.Ratify.html#3374" class="Record">RatifyState</a>
  <a id="12196" href="Ledger.Conway.Specification.Epoch.html#12196" class="Generalizable">poolReapState</a> <a id="12210" class="Symbol">:</a> <a id="12212" href="Ledger.Conway.Specification.PoolReap.html#404" class="Record">PoolReapState</a>
  <a id="12228" href="Ledger.Conway.Specification.Epoch.html#12228" class="Generalizable">eps</a> <a id="12232" href="Ledger.Conway.Specification.Epoch.html#12232" class="Generalizable">eps&#39;</a> <a id="12237" href="Ledger.Conway.Specification.Epoch.html#12237" class="Generalizable">eps&#39;&#39;</a> <a id="12243" class="Symbol">:</a> <a id="12245" href="Ledger.Conway.Specification.Epoch.html#1703" class="Record">EpochState</a>
  <a id="12258" href="Ledger.Conway.Specification.Epoch.html#12258" class="Generalizable">ls</a> <a id="12261" class="Symbol">:</a> <a id="12263" href="Ledger.Conway.Specification.Ledger.html#979" class="Record">LState</a>
  <a id="12272" href="Ledger.Conway.Specification.Epoch.html#12272" class="Generalizable">es₀</a> <a id="12276" class="Symbol">:</a> <a id="12278" href="Ledger.Conway.Specification.Enact.html#448" class="Record">EnactState</a>
  <a id="12291" href="Ledger.Conway.Specification.Epoch.html#12291" class="Generalizable">mark</a> <a id="12296" href="Ledger.Conway.Specification.Epoch.html#12296" class="Generalizable">set</a> <a id="12300" href="Ledger.Conway.Specification.Epoch.html#12300" class="Generalizable">go</a> <a id="12303" class="Symbol">:</a> <a id="12305" href="Ledger.Conway.Specification.Rewards.html#6433" class="Record">Snapshot</a>
  <a id="12316" href="Ledger.Conway.Specification.Epoch.html#12316" class="Generalizable">feeSS</a> <a id="12322" class="Symbol">:</a> <a id="12324" href="Ledger.Prelude.Base.html#186" class="Function">Fees</a>
  <a id="12331" href="Ledger.Conway.Specification.Epoch.html#12331" class="Generalizable">lstate</a> <a id="12338" class="Symbol">:</a> <a id="12340" href="Ledger.Conway.Specification.Ledger.html#979" class="Record">LState</a>
  <a id="12349" href="Ledger.Conway.Specification.Epoch.html#12349" class="Generalizable">ss</a> <a id="12352" href="Ledger.Conway.Specification.Epoch.html#12352" class="Generalizable">ss&#39;</a> <a id="12356" class="Symbol">:</a> <a id="12358" href="Ledger.Conway.Specification.Rewards.html#7745" class="Record">Snapshots</a>
  <a id="12370" href="Ledger.Conway.Specification.Epoch.html#12370" class="Generalizable">ru</a> <a id="12373" class="Symbol">:</a> <a id="12375" href="Ledger.Conway.Specification.Rewards.html#6210" class="Record">RewardUpdate</a>
  <a id="12390" href="Ledger.Conway.Specification.Epoch.html#12390" class="Generalizable">mru</a> <a id="12394" class="Symbol">:</a> <a id="12396" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="12402" href="Ledger.Conway.Specification.Rewards.html#6210" class="Record">RewardUpdate</a>
  <a id="12417" href="Ledger.Conway.Specification.Epoch.html#12417" class="Generalizable">pd</a> <a id="12420" class="Symbol">:</a> <a id="12422" href="Ledger.Conway.Specification.Epoch.html#3049" class="Function">PoolDelegatedStake</a>


<a id="getOrphans"></a><a id="12443" href="Ledger.Conway.Specification.Epoch.html#12443" class="Function">getOrphans</a> <a id="12454" class="Symbol">:</a> <a id="12456" href="Ledger.Conway.Specification.Enact.html#448" class="Record">EnactState</a> <a id="12467" class="Symbol">→</a> <a id="12469" href="Ledger.Conway.Specification.Gov.html#1479" class="Function">GovState</a> <a id="12478" class="Symbol">→</a> <a id="12480" href="Ledger.Conway.Specification.Gov.html#1479" class="Function">GovState</a>
<a id="12489" href="Ledger.Conway.Specification.Epoch.html#12443" class="Function">getOrphans</a> <a id="12500" href="Ledger.Conway.Specification.Epoch.html#12500" class="Bound">es</a> <a id="12503" href="Ledger.Conway.Specification.Epoch.html#12503" class="Bound">govSt</a> <a id="12509" class="Symbol">=</a> <a id="12511" href="Data.Product.Base.html#636" class="Field">proj₁</a> <a id="12517" href="Function.Base.html#1993" class="Function Operator">$</a> <a id="12519" href="Data.Nat.GeneralisedArithmetic.html#866" class="Function">iterate</a> <a id="12527" href="Ledger.Conway.Specification.Epoch.html#12572" class="Function">step</a> <a id="12532" class="Symbol">(</a><a id="12533" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a> <a id="12536" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="12538" href="Ledger.Conway.Specification.Epoch.html#12503" class="Bound">govSt</a><a id="12543" class="Symbol">)</a> <a id="12545" class="Symbol">(</a><a id="12546" href="Data.List.Base.html#4746" class="Function">length</a> <a id="12553" href="Ledger.Conway.Specification.Epoch.html#12503" class="Bound">govSt</a><a id="12558" class="Symbol">)</a>
  <a id="12562" class="Keyword">where</a>
    <a id="12572" href="Ledger.Conway.Specification.Epoch.html#12572" class="Function">step</a> <a id="12577" class="Symbol">:</a> <a id="12579" href="Ledger.Conway.Specification.Gov.html#1479" class="Function">GovState</a> <a id="12588" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="12590" href="Ledger.Conway.Specification.Gov.html#1479" class="Function">GovState</a> <a id="12599" class="Symbol">→</a> <a id="12601" href="Ledger.Conway.Specification.Gov.html#1479" class="Function">GovState</a> <a id="12610" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="12612" href="Ledger.Conway.Specification.Gov.html#1479" class="Function">GovState</a>
    <a id="12625" href="Ledger.Conway.Specification.Epoch.html#12572" class="Function">step</a> <a id="12630" class="Symbol">(</a><a id="12631" href="Ledger.Conway.Specification.Epoch.html#12631" class="Bound">orps</a> <a id="12636" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="12638" href="Ledger.Conway.Specification.Epoch.html#12638" class="Bound">govSt</a><a id="12643" class="Symbol">)</a> <a id="12645" class="Symbol">=</a>
      <a id="12653" class="Keyword">let</a>
        <a id="12665" href="Ledger.Conway.Specification.Epoch.html#12665" class="Bound">isOrphan?</a> <a id="12675" href="Ledger.Conway.Specification.Epoch.html#12675" class="Bound">a</a> <a id="12677" href="Ledger.Conway.Specification.Epoch.html#12677" class="Bound">prev</a> <a id="12682" class="Symbol">=</a> <a id="12684" href="Relation.Nullary.Decidable.Core.html#3277" class="Function">¬?</a> <a id="12687" class="Symbol">(</a><a id="12688" href="Ledger.Conway.Specification.Gov.html#9834" class="Function">hasParent?</a> <a id="12699" href="Ledger.Conway.Specification.Epoch.html#12500" class="Bound">es</a> <a id="12702" href="Ledger.Conway.Specification.Epoch.html#12638" class="Bound">govSt</a> <a id="12708" href="Ledger.Conway.Specification.Epoch.html#12675" class="Bound">a</a> <a id="12710" href="Ledger.Conway.Specification.Epoch.html#12677" class="Bound">prev</a><a id="12714" class="Symbol">)</a>
        <a id="12724" class="Symbol">(</a><a id="12725" href="Ledger.Conway.Specification.Epoch.html#12725" class="Bound">orps&#39;</a> <a id="12731" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="12733" href="Ledger.Conway.Specification.Epoch.html#12733" class="Bound">govSt&#39;</a><a id="12739" class="Symbol">)</a> <a id="12741" class="Symbol">=</a> <a id="12743" href="Data.List.Base.html#10628" class="Function">partition</a>
          <a id="12763" class="Symbol">(λ</a> <a id="12766" class="Symbol">(_</a> <a id="12769" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="12771" class="Keyword">record</a> <a id="12778" class="Symbol">{</a><a id="12779" href="Ledger.Conway.Specification.Gov.Actions.html#3885" class="Field">action</a> <a id="12786" class="Symbol">=</a> <a id="12788" href="Ledger.Conway.Specification.Epoch.html#12788" class="Bound">a</a> <a id="12790" class="Symbol">;</a> <a id="12792" href="Ledger.Conway.Specification.Gov.Actions.html#3913" class="Field">prevAction</a> <a id="12803" class="Symbol">=</a> <a id="12805" href="Ledger.Conway.Specification.Epoch.html#12805" class="Bound">prev</a><a id="12809" class="Symbol">})</a> <a id="12812" class="Symbol">→</a> <a id="12814" href="Ledger.Conway.Specification.Epoch.html#12665" class="Bound">isOrphan?</a> <a id="12824" class="Symbol">(</a><a id="12825" href="Ledger.Conway.Specification.Epoch.html#12788" class="Bound">a</a> <a id="12827" class="Symbol">.</a><a id="12828" href="Ledger.Conway.Specification.Gov.Actions.html#1981" class="Field">gaType</a><a id="12834" class="Symbol">)</a> <a id="12836" href="Ledger.Conway.Specification.Epoch.html#12805" class="Bound">prev</a><a id="12840" class="Symbol">)</a>
          <a id="12852" href="Ledger.Conway.Specification.Epoch.html#12638" class="Bound">govSt</a>
      <a id="12864" class="Keyword">in</a>
        <a id="12875" class="Symbol">(</a><a id="12876" href="Ledger.Conway.Specification.Epoch.html#12631" class="Bound">orps</a> <a id="12881" href="Data.List.Base.html#1712" class="Function Operator">++</a> <a id="12884" href="Ledger.Conway.Specification.Epoch.html#12725" class="Bound">orps&#39;</a> <a id="12890" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="12892" href="Ledger.Conway.Specification.Epoch.html#12733" class="Bound">govSt&#39;</a><a id="12898" class="Symbol">)</a>


<a id="12902" class="Keyword">record</a> <a id="EPOCH-Updates0"></a><a id="12909" href="Ledger.Conway.Specification.Epoch.html#12909" class="Record">EPOCH-Updates0</a> <a id="12924" class="Symbol">:</a> <a id="12926" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="12931" class="Keyword">where</a>
  <a id="12939" class="Keyword">constructor</a> <a id="EPOCHUpdates0"></a><a id="12951" href="Ledger.Conway.Specification.Epoch.html#12951" class="InductiveConstructor">EPOCHUpdates0</a>
  <a id="12967" class="Keyword">field</a>
    <a id="EPOCH-Updates0.es"></a><a id="12977" href="Ledger.Conway.Specification.Epoch.html#12977" class="Field">es</a>             <a id="12992" class="Symbol">:</a> <a id="12994" href="Ledger.Conway.Specification.Enact.html#448" class="Record">EnactState</a>
    <a id="EPOCH-Updates0.govSt&#39;"></a><a id="13009" href="Ledger.Conway.Specification.Epoch.html#13009" class="Field">govSt&#39;</a>         <a id="13024" class="Symbol">:</a> <a id="13026" href="Ledger.Conway.Specification.Gov.html#1479" class="Function">GovState</a>
    <a id="EPOCH-Updates0.payout"></a><a id="13039" href="Ledger.Conway.Specification.Epoch.html#13039" class="Field">payout</a>         <a id="13054" class="Symbol">:</a> <a id="13056" href="Ledger.Core.Specification.Address.html#1399" class="Function">Withdrawals</a>
    <a id="EPOCH-Updates0.gState&#39;"></a><a id="13072" href="Ledger.Conway.Specification.Epoch.html#13072" class="Field">gState&#39;</a>        <a id="13087" class="Symbol">:</a> <a id="13089" href="Ledger.Conway.Specification.Certs.html#4103" class="Record">GState</a>
    <a id="EPOCH-Updates0.utxoSt&#39;"></a><a id="13100" href="Ledger.Conway.Specification.Epoch.html#13100" class="Field">utxoSt&#39;</a>        <a id="13115" class="Symbol">:</a> <a id="13117" href="Ledger.Conway.Specification.Utxo.html#1230" class="Record">UTxOState</a>
    <a id="EPOCH-Updates0.totWithdrawals"></a><a id="13131" href="Ledger.Conway.Specification.Epoch.html#13131" class="Field">totWithdrawals</a> <a id="13146" class="Symbol">:</a> <a id="13148" href="Ledger.Prelude.Base.html#154" class="Function">Coin</a>

<a id="EPOCH-updates0"></a><a id="13154" href="Ledger.Conway.Specification.Epoch.html#13154" class="Function">EPOCH-updates0</a> <a id="13169" class="Symbol">:</a> <a id="13171" href="Ledger.Conway.Specification.Ratify.html#3374" class="Record">RatifyState</a> <a id="13183" class="Symbol">→</a> <a id="13185" href="Ledger.Conway.Specification.Ledger.html#979" class="Record">LState</a> <a id="13192" class="Symbol">→</a> <a id="13194" href="Ledger.Conway.Specification.Epoch.html#12909" class="Record">EPOCH-Updates0</a>
<a id="13209" href="Ledger.Conway.Specification.Epoch.html#13154" class="Function">EPOCH-updates0</a> <a id="13224" href="Ledger.Conway.Specification.Epoch.html#13224" class="Bound">fut</a> <a id="13228" href="Ledger.Conway.Specification.Epoch.html#13228" class="Bound">ls</a> <a id="13231" class="Symbol">=</a>
    <a id="13237" href="Ledger.Conway.Specification.Epoch.html#12951" class="InductiveConstructor">EPOCHUpdates0</a> <a id="13251" href="Ledger.Conway.Specification.Epoch.html#13435" class="Function">es</a> <a id="13254" href="Ledger.Conway.Specification.Epoch.html#13765" class="Function">govSt&#39;</a> <a id="13261" href="Ledger.Conway.Specification.Epoch.html#14223" class="Function">payout</a> <a id="13268" href="Ledger.Conway.Specification.Epoch.html#14303" class="Function">gState&#39;</a> <a id="13276" href="Ledger.Conway.Specification.Epoch.html#14487" class="Function">utxoSt&#39;</a> <a id="13284" href="Ledger.Conway.Specification.Epoch.html#14650" class="Function">totWithdrawals</a>
  <a id="13301" class="Keyword">where</a>
    <a id="13311" class="Keyword">open</a> <a id="13316" href="Ledger.Conway.Specification.Ledger.html#979" class="Module">LState</a> <a id="13323" href="Ledger.Conway.Specification.Epoch.html#13228" class="Bound">ls</a> <a id="13326" class="Keyword">public</a>
    <a id="13337" class="Keyword">open</a> <a id="13342" href="Ledger.Conway.Specification.Certs.html#4234" class="Module">CertState</a> <a id="13352" href="Ledger.Conway.Specification.Ledger.html#1091" class="Field">certState</a> <a id="13362" class="Keyword">using</a> <a id="13368" class="Symbol">(</a><a id="13369" href="Ledger.Conway.Specification.Certs.html#4337" class="Field">gState</a><a id="13375" class="Symbol">)</a> <a id="13377" class="Keyword">public</a>
    <a id="13388" class="Keyword">open</a> <a id="13393" href="Ledger.Conway.Specification.Ratify.html#3374" class="Module">RatifyState</a> <a id="13405" href="Ledger.Conway.Specification.Epoch.html#13224" class="Bound">fut</a> <a id="13409" class="Keyword">renaming</a> <a id="13418" class="Symbol">(</a><a id="13419" href="Ledger.Conway.Specification.Ratify.html#3411" class="Field">es</a> <a id="13422" class="Symbol">to</a> <a id="13425" class="Field">esW</a><a id="13428" class="Symbol">)</a>

    <a id="13435" href="Ledger.Conway.Specification.Epoch.html#13435" class="Function">es</a> <a id="13438" class="Symbol">:</a> <a id="13440" href="Ledger.Conway.Specification.Enact.html#448" class="Record">EnactState</a>
    <a id="13455" href="Ledger.Conway.Specification.Epoch.html#13435" class="Function">es</a> <a id="13458" class="Symbol">=</a> <a id="13460" class="Keyword">record</a> <a id="13467" href="Ledger.Conway.Specification.Epoch.html#13425" class="Function">esW</a> <a id="13471" class="Symbol">{</a> <a id="13473" href="Ledger.Conway.Specification.Enact.html#700" class="Field">withdrawals</a> <a id="13485" class="Symbol">=</a> <a id="13487" href="Class.HasEmptySet.html#287" class="Field">∅</a> <a id="13489" class="Symbol">}</a>

    <a id="13496" href="Ledger.Conway.Specification.Epoch.html#13496" class="Function">tmpGovSt</a> <a id="13505" class="Symbol">:</a> <a id="13507" href="Ledger.Conway.Specification.Gov.html#1479" class="Function">GovState</a>
    <a id="13520" href="Ledger.Conway.Specification.Epoch.html#13496" class="Function">tmpGovSt</a> <a id="13529" class="Symbol">=</a> <a id="13531" href="Ledger.Prelude.html#2402" class="Function">filter</a> <a id="13538" class="Symbol">(λ</a> <a id="13541" href="Ledger.Conway.Specification.Epoch.html#13541" class="Bound">x</a> <a id="13543" class="Symbol">→</a> <a id="13545" href="Data.Product.Base.html#636" class="Field">proj₁</a> <a id="13551" href="Ledger.Conway.Specification.Epoch.html#13541" class="Bound">x</a> <a id="13553" href="Class.IsSet.html#462" class="Function Operator">∉</a> <a id="13555" href="abstract-set-theory.FiniteSetTheory.html#519" class="Function">mapˢ</a> <a id="13560" href="Data.Product.Base.html#636" class="Field">proj₁</a> <a id="13566" href="Ledger.Conway.Specification.Ratify.html#3444" class="Function">removed</a><a id="13573" class="Symbol">)</a> <a id="13575" href="Ledger.Conway.Specification.Ledger.html#1065" class="Field">govSt</a>

    <a id="13586" href="Ledger.Conway.Specification.Epoch.html#13586" class="Function">orphans</a> <a id="13594" class="Symbol">:</a> <a id="13596" href="abstract-set-theory.FiniteSetTheory.html#488" class="Function Operator">ℙ</a> <a id="13598" class="Symbol">(</a><a id="13599" href="Ledger.Conway.Specification.Gov.Actions.html#798" class="Function">GovActionID</a> <a id="13611" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="13613" href="Ledger.Conway.Specification.Gov.Actions.html#3768" class="Record">GovActionState</a><a id="13627" class="Symbol">)</a>
    <a id="13633" href="Ledger.Conway.Specification.Epoch.html#13586" class="Function">orphans</a>  <a id="13642" class="Symbol">=</a> <a id="13644" href="Axiom.Set.html#5718" class="Function">fromList</a> <a id="13653" class="Symbol">(</a><a id="13654" href="Ledger.Conway.Specification.Epoch.html#12443" class="Function">getOrphans</a> <a id="13665" href="Ledger.Conway.Specification.Epoch.html#13435" class="Function">es</a> <a id="13668" href="Ledger.Conway.Specification.Epoch.html#13496" class="Function">tmpGovSt</a><a id="13676" class="Symbol">)</a>

    <a id="13683" href="Ledger.Conway.Specification.Epoch.html#13683" class="Function">removed&#39;</a> <a id="13692" class="Symbol">:</a> <a id="13694" href="abstract-set-theory.FiniteSetTheory.html#488" class="Function Operator">ℙ</a> <a id="13696" class="Symbol">(</a><a id="13697" href="Ledger.Conway.Specification.Gov.Actions.html#798" class="Function">GovActionID</a> <a id="13709" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="13711" href="Ledger.Conway.Specification.Gov.Actions.html#3768" class="Record">GovActionState</a><a id="13725" class="Symbol">)</a>
    <a id="13731" href="Ledger.Conway.Specification.Epoch.html#13683" class="Function">removed&#39;</a> <a id="13740" class="Symbol">=</a> <a id="13742" href="Ledger.Conway.Specification.Ratify.html#3444" class="Function">removed</a> <a id="13750" href="Axiom.Set.html#8952" class="Function Operator">∪</a> <a id="13752" href="Ledger.Conway.Specification.Epoch.html#13586" class="Function">orphans</a>

    <a id="13765" href="Ledger.Conway.Specification.Epoch.html#13765" class="Function">govSt&#39;</a> <a id="13772" class="Symbol">:</a> <a id="13774" href="Ledger.Conway.Specification.Gov.html#1479" class="Function">GovState</a>
    <a id="13787" href="Ledger.Conway.Specification.Epoch.html#13765" class="Function">govSt&#39;</a> <a id="13794" class="Symbol">=</a> <a id="13796" href="Ledger.Prelude.html#2402" class="Function">filter</a> <a id="13803" class="Symbol">(λ</a> <a id="13806" href="Ledger.Conway.Specification.Epoch.html#13806" class="Bound">x</a> <a id="13808" class="Symbol">→</a> <a id="13810" href="Data.Product.Base.html#636" class="Field">proj₁</a> <a id="13816" href="Ledger.Conway.Specification.Epoch.html#13806" class="Bound">x</a> <a id="13818" href="Class.IsSet.html#462" class="Function Operator">∉</a> <a id="13820" href="abstract-set-theory.FiniteSetTheory.html#519" class="Function">mapˢ</a> <a id="13825" href="Data.Product.Base.html#636" class="Field">proj₁</a> <a id="13831" href="Ledger.Conway.Specification.Epoch.html#13683" class="Function">removed&#39;</a><a id="13839" class="Symbol">)</a> <a id="13841" href="Ledger.Conway.Specification.Ledger.html#1065" class="Field">govSt</a>

    <a id="13852" href="Ledger.Conway.Specification.Epoch.html#13852" class="Function">removedGovActions</a> <a id="13870" class="Symbol">:</a> <a id="13872" href="abstract-set-theory.FiniteSetTheory.html#488" class="Function Operator">ℙ</a> <a id="13874" class="Symbol">(</a><a id="13875" href="Ledger.Core.Specification.Address.html#1324" class="Record">RwdAddr</a> <a id="13883" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="13885" href="Ledger.Conway.Specification.Certs.html#548" class="Datatype">DepositPurpose</a> <a id="13900" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="13902" href="Ledger.Prelude.Base.html#154" class="Function">Coin</a><a id="13906" class="Symbol">)</a>
    <a id="13912" href="Ledger.Conway.Specification.Epoch.html#13852" class="Function">removedGovActions</a> <a id="13930" class="Symbol">=</a>
      <a id="13938" href="Function.Base.html#1657" class="Function">flip</a> <a id="13943" href="Axiom.Set.html#7022" class="Function">concatMapˢ</a> <a id="13954" href="Ledger.Conway.Specification.Epoch.html#13683" class="Function">removed&#39;</a> <a id="13963" class="Symbol">λ</a> <a id="13965" class="Symbol">(</a><a id="13966" href="Ledger.Conway.Specification.Epoch.html#13966" class="Bound">gaid</a> <a id="13971" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="13973" href="Ledger.Conway.Specification.Epoch.html#13973" class="Bound">gaSt</a><a id="13977" class="Symbol">)</a> <a id="13979" class="Symbol">→</a>
        <a id="13989" href="abstract-set-theory.FiniteSetTheory.html#519" class="Function">mapˢ</a>
          <a id="14004" class="Symbol">(</a><a id="14005" href="Ledger.Conway.Specification.Gov.Actions.html#3835" class="Field">returnAddr</a> <a id="14016" href="Ledger.Conway.Specification.Epoch.html#13973" class="Bound">gaSt</a> <a id="14021" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,_</a><a id="14023" class="Symbol">)</a>
          <a id="14035" class="Symbol">((</a><a id="14037" href="Ledger.Conway.Specification.Certs.html#899" class="Field">DepositsOf</a> <a id="14048" href="Ledger.Conway.Specification.Ledger.html#1038" class="Field">utxoSt</a> <a id="14055" href="Axiom.Set.Map.html#10678" class="Function Operator">∣</a> <a id="14057" href="Class.HasSingleton.html#288" class="Field Operator">❴</a> <a id="14059" href="Ledger.Conway.Specification.Certs.html#737" class="InductiveConstructor">GovActionDeposit</a> <a id="14076" href="Ledger.Conway.Specification.Epoch.html#13966" class="Bound">gaid</a> <a id="14081" href="Class.HasSingleton.html#288" class="Field Operator">❵</a><a id="14082" class="Symbol">)</a> <a id="14084" href="Axiom.Set.Map.html#2293" class="Function Operator">ˢ</a><a id="14085" class="Symbol">)</a>

    <a id="14092" href="Ledger.Conway.Specification.Epoch.html#14092" class="Function">govActionReturns</a> <a id="14109" class="Symbol">:</a> <a id="14111" href="Ledger.Core.Specification.Address.html#1324" class="Record">RwdAddr</a> <a id="14119" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="14121" href="Ledger.Prelude.Base.html#154" class="Function">Coin</a>
    <a id="14130" href="Ledger.Conway.Specification.Epoch.html#14092" class="Function">govActionReturns</a> <a id="14147" class="Symbol">=</a>
      <a id="14155" href="Axiom.Set.Map.Dec.html#2124" class="Function">aggregate₊</a> <a id="14166" class="Symbol">(</a><a id="14167" href="abstract-set-theory.FiniteSetTheory.html#519" class="Function">mapˢ</a> <a id="14172" class="Symbol">(λ</a> <a id="14175" class="Symbol">(</a><a id="14176" href="Ledger.Conway.Specification.Epoch.html#14176" class="Bound">a</a> <a id="14178" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="14180" class="Symbol">_</a> <a id="14182" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="14184" href="Ledger.Conway.Specification.Epoch.html#14184" class="Bound">d</a><a id="14185" class="Symbol">)</a> <a id="14187" class="Symbol">→</a> <a id="14189" href="Ledger.Conway.Specification.Epoch.html#14176" class="Bound">a</a> <a id="14191" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="14193" href="Ledger.Conway.Specification.Epoch.html#14184" class="Bound">d</a><a id="14194" class="Symbol">)</a> <a id="14196" href="Ledger.Conway.Specification.Epoch.html#13852" class="Function">removedGovActions</a> <a id="14214" href="abstract-set-theory.FiniteSetTheory.html#2767" class="Function Operator">ᶠˢ</a><a id="14216" class="Symbol">)</a>

    <a id="14223" href="Ledger.Conway.Specification.Epoch.html#14223" class="Function">payout</a> <a id="14230" class="Symbol">:</a> <a id="14232" href="Ledger.Core.Specification.Address.html#1324" class="Record">RwdAddr</a> <a id="14240" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="14242" href="Ledger.Prelude.Base.html#154" class="Function">Coin</a>
    <a id="14251" href="Ledger.Conway.Specification.Epoch.html#14223" class="Function">payout</a> <a id="14258" class="Symbol">=</a> <a id="14260" href="Ledger.Conway.Specification.Epoch.html#14092" class="Function">govActionReturns</a> <a id="14277" href="Axiom.Set.Map.Dec.html#2046" class="Function Operator">∪⁺</a> <a id="14280" href="Ledger.Core.Specification.Address.html#1701" class="Field">WithdrawalsOf</a> <a id="14294" href="Ledger.Conway.Specification.Epoch.html#13425" class="Function">esW</a>

    <a id="14303" href="Ledger.Conway.Specification.Epoch.html#14303" class="Function">gState&#39;</a> <a id="14311" class="Symbol">:</a> <a id="14313" href="Ledger.Conway.Specification.Certs.html#4103" class="Record">GState</a>
    <a id="14324" href="Ledger.Conway.Specification.Epoch.html#14303" class="Function">gState&#39;</a> <a id="14332" class="Symbol">=</a>
      <a class="AgdaKaTeX">$\begin{pmatrix} \,\htmlId{14342}{\htmlClass{Symbol}{\text{(}}}\,\,\href{Class.ToBool.html#342}{\htmlId{14343}{\htmlClass{Function Operator}{\text{if}}}}\, \,\href{Data.List.Base.html#4681}{\htmlId{14346}{\htmlClass{Function}{\text{null}}}}\, \,\href{Ledger.Conway.Specification.Epoch.html#13765}{\htmlId{14351}{\htmlClass{Function}{\text{govSt&#39;}}}}\, \,\href{Class.ToBool.html#342}{\htmlId{14358}{\htmlClass{Function Operator}{\text{then}}}}\, \,\href{Axiom.Set.Map.html#6068}{\htmlId{14363}{\htmlClass{Function}{\text{mapValues}}}}\, \,\htmlId{14373}{\htmlClass{Symbol}{\text{(}}}\,\,\htmlId{14374}{\htmlClass{Number}{\text{1}}}\, \,\href{Class.HasAdd.Core.html#162}{\htmlId{14376}{\htmlClass{Field Operator}{\text{+\_}}}}\,\,\htmlId{14378}{\htmlClass{Symbol}{\text{)}}}\, \,\htmlId{14380}{\htmlClass{Symbol}{\text{(}}}\,\,\href{Ledger.Conway.Specification.Certs.html#1569}{\htmlId{14381}{\htmlClass{Field}{\text{DRepsOf}}}}\, \,\href{Ledger.Conway.Specification.Certs.html#4337}{\htmlId{14389}{\htmlClass{Function}{\text{gState}}}}\,\,\htmlId{14395}{\htmlClass{Symbol}{\text{)}}}\, \,\href{Class.ToBool.html#342}{\htmlId{14397}{\htmlClass{Function Operator}{\text{else}}}}\, \,\href{Ledger.Conway.Specification.Certs.html#1569}{\htmlId{14402}{\htmlClass{Field}{\text{DRepsOf}}}}\, \,\href{Ledger.Conway.Specification.Certs.html#4337}{\htmlId{14410}{\htmlClass{Function}{\text{gState}}}}\,\,\htmlId{14416}{\htmlClass{Symbol}{\text{)}}}\,
      \\ \,\href{Ledger.Conway.Specification.Certs.html#1484}{\htmlId{14426}{\htmlClass{Field}{\text{CCHotKeysOf}}}}\, \,\href{Ledger.Conway.Specification.Certs.html#4337}{\htmlId{14438}{\htmlClass{Function}{\text{gState}}}}\, \,\href{Axiom.Set.Map.html#10678}{\htmlId{14445}{\htmlClass{Function Operator}{\text{∣}}}}\, \,\href{Ledger.Conway.Specification.Enact.html#1367}{\htmlId{14447}{\htmlClass{Function}{\text{ccCreds}}}}\, \,\htmlId{14455}{\htmlClass{Symbol}{\text{(}}}\,\,\href{Ledger.Conway.Specification.Enact.html#484}{\htmlId{14456}{\htmlClass{Field}{\text{EnactState.cc}}}}\, \,\href{Ledger.Conway.Specification.Epoch.html#13435}{\htmlId{14470}{\htmlClass{Function}{\text{es}}}}\,\,\htmlId{14472}{\htmlClass{Symbol}{\text{)}}}\,
      \end{pmatrix}$</a>

    <a id="14487" href="Ledger.Conway.Specification.Epoch.html#14487" class="Function">utxoSt&#39;</a> <a id="14495" class="Symbol">:</a> <a id="14497" href="Ledger.Conway.Specification.Utxo.html#1230" class="Record">UTxOState</a>
    <a id="14511" href="Ledger.Conway.Specification.Epoch.html#14487" class="Function">utxoSt&#39;</a> <a id="14519" class="Symbol">=</a> <a id="14521" class="Keyword">record</a> <a id="14528" href="Ledger.Conway.Specification.Ledger.html#1038" class="Field">utxoSt</a>
      <a id="14541" class="Symbol">{</a> <a id="14543" href="Ledger.Conway.Specification.Utxo.html#1338" class="Field">deposits</a> <a id="14552" class="Symbol">=</a> <a id="14554" href="Ledger.Conway.Specification.Certs.html#899" class="Field">DepositsOf</a> <a id="14565" href="Ledger.Conway.Specification.Ledger.html#1038" class="Field">utxoSt</a> <a id="14572" href="Axiom.Set.Map.html#10748" class="Function Operator">∣</a> <a id="14574" href="abstract-set-theory.FiniteSetTheory.html#519" class="Function">mapˢ</a> <a id="14579" class="Symbol">(</a><a id="14580" href="Data.Product.Base.html#636" class="Field">proj₁</a> <a id="14586" href="Function.Base.html#1134" class="Function Operator">∘</a> <a id="14588" href="Data.Product.Base.html#650" class="Field">proj₂</a><a id="14593" class="Symbol">)</a> <a id="14595" href="Ledger.Conway.Specification.Epoch.html#13852" class="Function">removedGovActions</a> <a id="14613" href="Axiom.Set.Map.html#10748" class="Function Operator">ᶜ</a>
      <a id="14621" class="Symbol">;</a> <a id="14623" href="Ledger.Conway.Specification.Utxo.html#1364" class="Field">donations</a> <a id="14633" class="Symbol">=</a> <a id="14635" class="Number">0</a>
      <a id="14643" class="Symbol">}</a>

    <a id="14650" href="Ledger.Conway.Specification.Epoch.html#14650" class="Function">totWithdrawals</a> <a id="14665" class="Symbol">:</a> <a id="14667" href="Ledger.Prelude.Base.html#154" class="Function">Coin</a>
    <a id="14676" href="Ledger.Conway.Specification.Epoch.html#14650" class="Function">totWithdrawals</a> <a id="14691" class="Symbol">=</a> <a id="14693" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">∑[</a> <a id="14696" href="Ledger.Conway.Specification.Epoch.html#14696" class="Bound">x</a> <a id="14698" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">←</a> <a id="14700" href="Ledger.Core.Specification.Address.html#1701" class="Field">WithdrawalsOf</a> <a id="14714" href="Ledger.Conway.Specification.Epoch.html#13425" class="Function">esW</a> <a id="14718" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">]</a> <a id="14720" href="Ledger.Conway.Specification.Epoch.html#14696" class="Bound">x</a>

<a id="14723" class="Keyword">record</a> <a id="EPOCH-Updates"></a><a id="14730" href="Ledger.Conway.Specification.Epoch.html#14730" class="Record">EPOCH-Updates</a> <a id="14744" class="Symbol">:</a> <a id="14746" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="14751" class="Keyword">where</a>
  <a id="14759" class="Keyword">constructor</a> <a id="EPOCHUpdates"></a><a id="14771" href="Ledger.Conway.Specification.Epoch.html#14771" class="InductiveConstructor">EPOCHUpdates</a>
  <a id="14786" class="Keyword">field</a>
    <a id="EPOCH-Updates.es"></a><a id="14796" href="Ledger.Conway.Specification.Epoch.html#14796" class="Field">es</a>             <a id="14811" class="Symbol">:</a> <a id="14813" href="Ledger.Conway.Specification.Enact.html#448" class="Record">EnactState</a>
    <a id="EPOCH-Updates.govSt&#39;"></a><a id="14828" href="Ledger.Conway.Specification.Epoch.html#14828" class="Field">govSt&#39;</a>         <a id="14843" class="Symbol">:</a> <a id="14845" href="Ledger.Conway.Specification.Gov.html#1479" class="Function">GovState</a>
    <a id="EPOCH-Updates.dState&#39;&#39;"></a><a id="14858" href="Ledger.Conway.Specification.Epoch.html#14858" class="Field">dState&#39;&#39;</a>       <a id="14873" class="Symbol">:</a> <a id="14875" href="Ledger.Conway.Specification.Certs.html#3862" class="Record">DState</a>
    <a id="EPOCH-Updates.gState&#39;"></a><a id="14886" href="Ledger.Conway.Specification.Epoch.html#14886" class="Field">gState&#39;</a>        <a id="14901" class="Symbol">:</a> <a id="14903" href="Ledger.Conway.Specification.Certs.html#4103" class="Record">GState</a>
    <a id="EPOCH-Updates.utxoSt&#39;"></a><a id="14914" href="Ledger.Conway.Specification.Epoch.html#14914" class="Field">utxoSt&#39;</a>        <a id="14929" class="Symbol">:</a> <a id="14931" href="Ledger.Conway.Specification.Utxo.html#1230" class="Record">UTxOState</a>
    <a id="EPOCH-Updates.acnt&#39;&#39;"></a><a id="14945" href="Ledger.Conway.Specification.Epoch.html#14945" class="Field">acnt&#39;&#39;</a>         <a id="14960" class="Symbol">:</a> <a id="14962" href="Ledger.Conway.Specification.PParams.html#720" class="Record">Acnt</a>

<a id="EPOCH-updates"></a><a id="14968" href="Ledger.Conway.Specification.Epoch.html#14968" class="Function">EPOCH-updates</a>
  <a id="14984" class="Symbol">:</a> <a id="14986" href="Ledger.Conway.Specification.Ratify.html#3374" class="Record">RatifyState</a> <a id="14998" class="Symbol">→</a> <a id="15000" href="Ledger.Conway.Specification.Ledger.html#979" class="Record">LState</a> <a id="15007" class="Symbol">→</a> <a id="15009" href="Ledger.Conway.Specification.Certs.html#3862" class="Record">DState</a> <a id="15016" class="Symbol">→</a> <a id="15018" href="Ledger.Conway.Specification.PParams.html#720" class="Record">Acnt</a> <a id="15023" class="Symbol">→</a> <a id="15025" href="Ledger.Conway.Specification.Epoch.html#14730" class="Record">EPOCH-Updates</a>
<a id="15039" href="Ledger.Conway.Specification.Epoch.html#14968" class="Function">EPOCH-updates</a> <a id="15053" href="Ledger.Conway.Specification.Epoch.html#15053" class="Bound">fut</a> <a id="15057" href="Ledger.Conway.Specification.Epoch.html#15057" class="Bound">ls</a> <a id="15060" href="Ledger.Conway.Specification.Epoch.html#15060" class="Bound">dState&#39;</a> <a id="15068" href="Ledger.Conway.Specification.Epoch.html#15068" class="Bound">acnt&#39;</a> <a id="15074" class="Symbol">=</a>
    <a id="15080" href="Ledger.Conway.Specification.Epoch.html#14771" class="InductiveConstructor">EPOCHUpdates</a> <a id="15093" class="Symbol">(</a><a id="15094" href="Ledger.Conway.Specification.Epoch.html#15212" class="Function">u0</a> <a id="15097" class="Symbol">.</a><a id="15098" href="Ledger.Conway.Specification.Epoch.html#12977" class="Field">es</a><a id="15100" class="Symbol">)</a> <a id="15102" class="Symbol">(</a><a id="15103" href="Ledger.Conway.Specification.Epoch.html#15212" class="Function">u0</a> <a id="15106" class="Symbol">.</a><a id="15107" href="Ledger.Conway.Specification.Epoch.html#13009" class="Field">govSt&#39;</a><a id="15113" class="Symbol">)</a> <a id="15115" href="Ledger.Conway.Specification.Epoch.html#15352" class="Function">dState&#39;&#39;</a> <a id="15124" class="Symbol">(</a><a id="15125" href="Ledger.Conway.Specification.Epoch.html#15212" class="Function">u0</a> <a id="15128" class="Symbol">.</a><a id="15129" href="Ledger.Conway.Specification.Epoch.html#13072" class="Field">gState&#39;</a><a id="15136" class="Symbol">)</a> <a id="15138" class="Symbol">(</a><a id="15139" href="Ledger.Conway.Specification.Epoch.html#15212" class="Function">u0</a> <a id="15142" class="Symbol">.</a><a id="15143" href="Ledger.Conway.Specification.Epoch.html#13100" class="Field">utxoSt&#39;</a><a id="15150" class="Symbol">)</a> <a id="15152" href="Ledger.Conway.Specification.Epoch.html#15525" class="Function">acnt&#39;&#39;</a>
  <a id="15161" class="Keyword">where</a>
    <a id="15171" class="Keyword">open</a> <a id="15176" href="Ledger.Conway.Specification.Ledger.html#979" class="Module">LState</a>
    <a id="15187" class="Keyword">open</a> <a id="15192" href="Ledger.Conway.Specification.Epoch.html#12909" class="Module">EPOCH-Updates0</a>

    <a id="15212" href="Ledger.Conway.Specification.Epoch.html#15212" class="Function">u0</a> <a id="15215" class="Symbol">=</a> <a id="15217" href="Ledger.Conway.Specification.Epoch.html#13154" class="Function">EPOCH-updates0</a> <a id="15232" href="Ledger.Conway.Specification.Epoch.html#15053" class="Bound">fut</a> <a id="15236" href="Ledger.Conway.Specification.Epoch.html#15057" class="Bound">ls</a>

    <a id="15244" href="Ledger.Conway.Specification.Epoch.html#15244" class="Function">refunds</a> <a id="15252" class="Symbol">:</a> <a id="15254" href="Ledger.Core.Specification.Address.html#260" class="Datatype">Credential</a> <a id="15265" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="15267" href="Ledger.Prelude.Base.html#154" class="Function">Coin</a>
    <a id="15276" href="Ledger.Conway.Specification.Epoch.html#15244" class="Function">refunds</a> <a id="15284" class="Symbol">=</a> <a id="15286" href="Axiom.Set.Map.html#14177" class="Function">pullbackMap</a> <a id="15298" class="Symbol">(</a><a id="15299" href="Ledger.Conway.Specification.Epoch.html#15212" class="Function">u0</a> <a id="15302" class="Symbol">.</a><a id="15303" href="Ledger.Conway.Specification.Epoch.html#13039" class="Field">payout</a><a id="15309" class="Symbol">)</a> <a id="15311" href="Ledger.Conway.Specification.Epoch.html#5020" class="Function">toRwdAddr</a> <a id="15321" class="Symbol">(</a><a id="15322" href="Class.IsSet.html#916" class="Function">dom</a> <a id="15326" class="Symbol">(</a><a id="15327" href="Ledger.Conway.Specification.Certs.html#1811" class="Field">RewardsOf</a> <a id="15337" href="Ledger.Conway.Specification.Epoch.html#15060" class="Bound">dState&#39;</a><a id="15344" class="Symbol">))</a>

    <a id="15352" href="Ledger.Conway.Specification.Epoch.html#15352" class="Function">dState&#39;&#39;</a> <a id="15361" class="Symbol">:</a> <a id="15363" href="Ledger.Conway.Specification.Certs.html#3862" class="Record">DState</a>
    <a id="15374" href="Ledger.Conway.Specification.Epoch.html#15352" class="Function">dState&#39;&#39;</a> <a id="15383" class="Symbol">=</a> <a id="15385" class="Keyword">record</a> <a id="15392" href="Ledger.Conway.Specification.Epoch.html#15060" class="Bound">dState&#39;</a> <a id="15400" class="Symbol">{</a> <a id="15402" href="Ledger.Conway.Specification.Certs.html#3982" class="Field">rewards</a> <a id="15410" class="Symbol">=</a> <a id="15412" href="Ledger.Conway.Specification.Certs.html#1811" class="Field">RewardsOf</a> <a id="15422" href="Ledger.Conway.Specification.Epoch.html#15060" class="Bound">dState&#39;</a> <a id="15430" href="Axiom.Set.Map.Dec.html#2046" class="Function Operator">∪⁺</a> <a id="15433" href="Ledger.Conway.Specification.Epoch.html#15244" class="Function">refunds</a> <a id="15441" class="Symbol">}</a>

    <a id="15448" href="Ledger.Conway.Specification.Epoch.html#15448" class="Function">unclaimed</a> <a id="15458" class="Symbol">:</a> <a id="15460" href="Ledger.Prelude.Base.html#154" class="Function">Coin</a>
    <a id="15469" href="Ledger.Conway.Specification.Epoch.html#15448" class="Function">unclaimed</a> <a id="15479" class="Symbol">=</a> <a id="15481" href="Ledger.Prelude.HasCoin.html#170" class="Field">getCoin</a> <a id="15489" class="Symbol">(</a><a id="15490" href="Ledger.Conway.Specification.Epoch.html#15212" class="Function">u0</a> <a id="15493" class="Symbol">.</a><a id="15494" href="Ledger.Conway.Specification.Epoch.html#13039" class="Field">payout</a><a id="15500" class="Symbol">)</a> <a id="15502" href="Interface.HasSubtract.html#209" class="Field Operator">-</a> <a id="15504" href="Ledger.Prelude.HasCoin.html#170" class="Field">getCoin</a> <a id="15512" href="Ledger.Conway.Specification.Epoch.html#15244" class="Function">refunds</a>

    <a id="15525" href="Ledger.Conway.Specification.Epoch.html#15525" class="Function">acnt&#39;&#39;</a> <a id="15532" class="Symbol">:</a> <a id="15534" href="Ledger.Conway.Specification.PParams.html#720" class="Record">Acnt</a>
    <a id="15543" href="Ledger.Conway.Specification.Epoch.html#15525" class="Function">acnt&#39;&#39;</a> <a id="15550" class="Symbol">=</a> <a id="15552" class="Keyword">record</a> <a id="15559" href="Ledger.Conway.Specification.Epoch.html#15068" class="Bound">acnt&#39;</a>
      <a id="15571" class="Symbol">{</a> <a id="15573" href="Ledger.Conway.Specification.PParams.html#775" class="Field">treasury</a> <a id="15582" class="Symbol">=</a>
          <a id="15594" href="Ledger.Prelude.Base.html#889" class="Field">TreasuryOf</a> <a id="15605" href="Ledger.Conway.Specification.Epoch.html#15068" class="Bound">acnt&#39;</a> <a id="15611" href="Data.Nat.Base.html#4462" class="Primitive Operator">∸</a> <a id="15613" href="Ledger.Conway.Specification.Epoch.html#15212" class="Function">u0</a> <a id="15616" class="Symbol">.</a><a id="15617" href="Ledger.Conway.Specification.Epoch.html#13131" class="Field">totWithdrawals</a> <a id="15632" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="15634" href="Ledger.Prelude.Base.html#554" class="Field">DonationsOf</a> <a id="15646" href="Ledger.Conway.Specification.Epoch.html#15057" class="Bound">ls</a> <a id="15649" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="15651" href="Ledger.Conway.Specification.Epoch.html#15448" class="Function">unclaimed</a>
      <a id="15667" class="Symbol">}</a>


<a id="15671" class="Keyword">data</a> <a id="_⊢_⇀⦇_,EPOCH⦈_"></a><a id="15676" href="Ledger.Conway.Specification.Epoch.html#15676" class="Datatype Operator">_⊢_⇀⦇_,EPOCH⦈_</a> <a id="15691" class="Symbol">:</a> <a id="15693" href="Agda.Builtin.Unit.html#175" class="Record">⊤</a> <a id="15695" class="Symbol">→</a> <a id="15697" href="Ledger.Conway.Specification.Epoch.html#1703" class="Record">EpochState</a> <a id="15708" class="Symbol">→</a> <a id="15710" href="Ledger.Core.Specification.Epoch.html#598" class="Function">Epoch</a> <a id="15716" class="Symbol">→</a> <a id="15718" href="Ledger.Conway.Specification.Epoch.html#1703" class="Record">EpochState</a> <a id="15729" class="Symbol">→</a> <a id="15731" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="15736" class="Keyword">where</a>


  <a id="_⊢_⇀⦇_,EPOCH⦈_.EPOCH"></a><a id="15746" href="Ledger.Conway.Specification.Epoch.html#15746" class="InductiveConstructor">EPOCH</a> <a id="15752" class="Symbol">:</a>


    <a id="15760" class="Symbol">∀</a> <a id="15762" class="Symbol">{</a><a id="15763" href="Ledger.Conway.Specification.Epoch.html#15763" class="Bound">acnt</a> <a id="15768" class="Symbol">:</a> <a id="15770" href="Ledger.Conway.Specification.PParams.html#720" class="Record">Acnt</a><a id="15774" class="Symbol">}</a> <a id="15776" class="Symbol">{</a><a id="15777" href="Ledger.Conway.Specification.Epoch.html#15777" class="Bound">utxoSt&#39;&#39;</a> <a id="15786" class="Symbol">:</a> <a id="15788" href="Ledger.Conway.Specification.Utxo.html#1230" class="Record">UTxOState</a><a id="15797" class="Symbol">}</a> <a id="15799" class="Symbol">{</a><a id="15800" href="Ledger.Conway.Specification.Epoch.html#15800" class="Bound">acnt&#39;</a> <a id="15806" href="Ledger.Conway.Specification.Epoch.html#15806" class="Bound">dState&#39;</a> <a id="15814" href="Ledger.Conway.Specification.Epoch.html#15814" class="Bound">pState&#39;</a><a id="15821" class="Symbol">}</a> <a id="15823" class="Symbol">→</a>


    <a id="15831" class="Keyword">let</a>
      <a id="15841" href="Ledger.Conway.Specification.Epoch.html#14771" class="InductiveConstructor">EPOCHUpdates</a> <a id="15854" href="Ledger.Conway.Specification.Epoch.html#15854" class="Bound">es</a> <a id="15857" href="Ledger.Conway.Specification.Epoch.html#15857" class="Bound">govSt&#39;</a> <a id="15864" href="Ledger.Conway.Specification.Epoch.html#15864" class="Bound">dState&#39;&#39;</a> <a id="15873" href="Ledger.Conway.Specification.Epoch.html#15873" class="Bound">gState&#39;</a> <a id="15881" href="Ledger.Conway.Specification.Epoch.html#15881" class="Bound">utxoSt&#39;</a> <a id="15889" href="Ledger.Conway.Specification.Epoch.html#15889" class="Bound">acnt&#39;&#39;</a> <a id="15896" class="Symbol">=</a>
        <a id="15906" href="Ledger.Conway.Specification.Epoch.html#14968" class="Function">EPOCH-updates</a> <a id="15920" href="Ledger.Conway.Specification.Epoch.html#12171" class="Generalizable">fut</a> <a id="15924" href="Ledger.Conway.Specification.Epoch.html#12258" class="Generalizable">ls</a> <a id="15927" href="Ledger.Conway.Specification.Epoch.html#15806" class="Bound">dState&#39;</a> <a id="15935" href="Ledger.Conway.Specification.Epoch.html#15800" class="Bound">acnt&#39;</a>

      <a id="15948" href="Ledger.Conway.Specification.Epoch.html#15948" class="Bound">stakeDistrs</a> <a id="15960" class="Symbol">:</a> <a id="15962" href="Ledger.Conway.Specification.Ratify.html#2963" class="Record">StakeDistrs</a>
      <a id="15980" href="Ledger.Conway.Specification.Epoch.html#15948" class="Bound">stakeDistrs</a> <a id="15992" class="Symbol">=</a> <a id="15994" href="Ledger.Conway.Specification.Epoch.html#11626" class="Function">mkStakeDistrs</a> <a id="16008" class="Symbol">(</a><a id="16009" href="Ledger.Conway.Specification.Rewards.html#7779" class="Field">Snapshots.mark</a> <a id="16024" href="Ledger.Conway.Specification.Epoch.html#12352" class="Generalizable">ss&#39;</a><a id="16027" class="Symbol">)</a> <a id="16029" href="Ledger.Conway.Specification.Epoch.html#12149" class="Generalizable">e</a> <a id="16031" href="Ledger.Conway.Specification.Epoch.html#15881" class="Bound">utxoSt&#39;</a>
                                  <a id="16073" href="Ledger.Conway.Specification.Epoch.html#15857" class="Bound">govSt&#39;</a> <a id="16080" class="Symbol">(</a><a id="16081" href="Ledger.Conway.Specification.Certs.html#4753" class="Field">GStateOf</a> <a id="16090" href="Ledger.Conway.Specification.Epoch.html#12258" class="Generalizable">ls</a><a id="16092" class="Symbol">)</a> <a id="16094" class="Symbol">(</a><a id="16095" href="Ledger.Conway.Specification.Certs.html#4537" class="Field">DStateOf</a> <a id="16104" href="Ledger.Conway.Specification.Epoch.html#12258" class="Generalizable">ls</a><a id="16106" class="Symbol">)</a>

      <a id="16115" href="Ledger.Conway.Specification.Epoch.html#16115" class="Bound">Γ</a> <a id="16117" class="Symbol">:</a> <a id="16119" href="Ledger.Conway.Specification.Ratify.html#3082" class="Record">RatifyEnv</a>
      <a id="16135" href="Ledger.Conway.Specification.Epoch.html#16115" class="Bound">Γ</a> <a id="16137" class="Symbol">=</a> <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.Conway.Specification.Epoch.html#15948}{\htmlId{16141}{\htmlClass{Bound}{\text{stakeDistrs}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#12149}{\htmlId{16155}{\htmlClass{Generalizable}{\text{e}}}}\, \\ \,\href{Ledger.Conway.Specification.Certs.html#1569}{\htmlId{16159}{\htmlClass{Field}{\text{DRepsOf}}}}\, \,\href{Ledger.Conway.Specification.Epoch.html#12258}{\htmlId{16167}{\htmlClass{Generalizable}{\text{ls}}}}\, \\ \,\href{Ledger.Conway.Specification.Certs.html#1484}{\htmlId{16172}{\htmlClass{Field}{\text{CCHotKeysOf}}}}\, \,\href{Ledger.Conway.Specification.Epoch.html#12258}{\htmlId{16184}{\htmlClass{Generalizable}{\text{ls}}}}\, \\ \,\href{Ledger.Prelude.Base.html#889}{\htmlId{16189}{\htmlClass{Field}{\text{TreasuryOf}}}}\, \,\href{Ledger.Conway.Specification.Epoch.html#15763}{\htmlId{16200}{\htmlClass{Bound}{\text{acnt}}}}\, \\ \,\href{Ledger.Conway.Specification.Certs.html#1646}{\htmlId{16207}{\htmlClass{Field}{\text{PoolsOf}}}}\, \,\href{Ledger.Conway.Specification.Epoch.html#12258}{\htmlId{16215}{\htmlClass{Generalizable}{\text{ls}}}}\, \\ \,\href{Ledger.Conway.Specification.Gov.Actions.html#1325}{\htmlId{16220}{\htmlClass{Field}{\text{VoteDelegsOf}}}}\, \,\href{Ledger.Conway.Specification.Epoch.html#12258}{\htmlId{16233}{\htmlClass{Generalizable}{\text{ls}}}}\, \end{pmatrix}$</a>

    <a id="16243" class="Keyword">in</a>
        <a id="16254" href="Ledger.Conway.Specification.Epoch.html#12258" class="Generalizable">ls</a> <a id="16257" href="Ledger.Conway.Specification.Rewards.html#8220" class="Datatype Operator">⊢</a> <a id="16259" href="Ledger.Conway.Specification.Epoch.html#12349" class="Generalizable">ss</a> <a id="16262" href="Ledger.Conway.Specification.Rewards.html#8220" class="Datatype Operator">⇀⦇</a> <a id="16265" href="Agda.Builtin.Unit.html#212" class="InductiveConstructor">tt</a> <a id="16268" href="Ledger.Conway.Specification.Rewards.html#8220" class="Datatype Operator">,SNAP⦈</a> <a id="16275" href="Ledger.Conway.Specification.Epoch.html#12352" class="Generalizable">ss&#39;</a>
      <a id="16285" href="Prelude.InferenceRules.html#56006" class="Function Operator">∙</a> <a id="16287" href="Ledger.Conway.Specification.Epoch.html#16115" class="Bound">Γ</a>  <a id="16290" href="Ledger.Conway.Specification.Ratify.html#11729" class="Function Operator">⊢</a> <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.Conway.Specification.Epoch.html#15854}{\htmlId{16294}{\htmlClass{Bound}{\text{es}}}}\, \\ \,\href{Class.HasEmptySet.html#287}{\htmlId{16299}{\htmlClass{Field}{\text{∅}}}}\, \\ \,\href{Agda.Builtin.Bool.html#192}{\htmlId{16303}{\htmlClass{InductiveConstructor}{\text{false}}}}\, \end{pmatrix}$</a> <a id="16311" href="Ledger.Conway.Specification.Ratify.html#11729" class="Function Operator">⇀⦇</a> <a id="16314" href="Ledger.Conway.Specification.Epoch.html#15857" class="Bound">govSt&#39;</a> <a id="16321" href="Ledger.Conway.Specification.Ratify.html#11729" class="Function Operator">,RATIFIES⦈</a> <a id="16332" href="Ledger.Conway.Specification.Epoch.html#12175" class="Generalizable">fut&#39;</a>
      <a id="16343" href="Prelude.InferenceRules.html#56006" class="Function Operator">∙</a> <a id="16345" class="Symbol">_</a>  <a id="16348" href="Ledger.Conway.Specification.PoolReap.html#858" class="Datatype Operator">⊢</a> <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.Conway.Specification.Epoch.html#15881}{\htmlId{16352}{\htmlClass{Bound}{\text{utxoSt&#39;}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#15763}{\htmlId{16362}{\htmlClass{Bound}{\text{acnt}}}}\, \\ \,\href{Ledger.Conway.Specification.Certs.html#4537}{\htmlId{16369}{\htmlClass{Field}{\text{DStateOf}}}}\, \,\href{Ledger.Conway.Specification.Epoch.html#12258}{\htmlId{16378}{\htmlClass{Generalizable}{\text{ls}}}}\, \\ \,\href{Ledger.Conway.Specification.Certs.html#4645}{\htmlId{16383}{\htmlClass{Field}{\text{PStateOf}}}}\, \,\href{Ledger.Conway.Specification.Epoch.html#12258}{\htmlId{16392}{\htmlClass{Generalizable}{\text{ls}}}}\, \end{pmatrix}$</a> <a id="16397" href="Ledger.Conway.Specification.PoolReap.html#858" class="Datatype Operator">⇀⦇</a> <a id="16400" href="Ledger.Conway.Specification.Epoch.html#12149" class="Generalizable">e</a> <a id="16402" href="Ledger.Conway.Specification.PoolReap.html#858" class="Datatype Operator">,POOLREAP⦈</a> <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.Conway.Specification.Epoch.html#15777}{\htmlId{16415}{\htmlClass{Bound}{\text{utxoSt&#39;&#39;}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#15800}{\htmlId{16426}{\htmlClass{Bound}{\text{acnt&#39;}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#15806}{\htmlId{16434}{\htmlClass{Bound}{\text{dState&#39;}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#15814}{\htmlId{16444}{\htmlClass{Bound}{\text{pState&#39;}}}}\, \end{pmatrix}$</a>
      <a id="16460" href="Prelude.InferenceRules.html#13071" class="Function Operator">──────────────────────────────────────────────</a>
      <a id="16513" class="Symbol">_</a> <a id="16515" href="Ledger.Conway.Specification.Epoch.html#15676" class="Datatype Operator">⊢</a> <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.Conway.Specification.Epoch.html#15763}{\htmlId{16519}{\htmlClass{Bound}{\text{acnt}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#12349}{\htmlId{16526}{\htmlClass{Generalizable}{\text{ss}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#12258}{\htmlId{16531}{\htmlClass{Generalizable}{\text{ls}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#12272}{\htmlId{16536}{\htmlClass{Generalizable}{\text{es₀}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#12171}{\htmlId{16542}{\htmlClass{Generalizable}{\text{fut}}}}\, \end{pmatrix}$</a> <a id="16548" href="Ledger.Conway.Specification.Epoch.html#15676" class="Datatype Operator">⇀⦇</a> <a id="16551" href="Ledger.Conway.Specification.Epoch.html#12149" class="Generalizable">e</a> <a id="16553" href="Ledger.Conway.Specification.Epoch.html#15676" class="Datatype Operator">,EPOCH⦈</a> <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.Conway.Specification.Epoch.html#15889}{\htmlId{16563}{\htmlClass{Bound}{\text{acnt&#39;&#39;}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#12352}{\htmlId{16572}{\htmlClass{Generalizable}{\text{ss&#39;}}}}\, \\ \begin{pmatrix} \,\href{Ledger.Conway.Specification.Epoch.html#15777}{\htmlId{16580}{\htmlClass{Bound}{\text{utxoSt&#39;&#39;}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#15857}{\htmlId{16591}{\htmlClass{Bound}{\text{govSt&#39;}}}}\, \\ \begin{pmatrix} \,\href{Ledger.Conway.Specification.Epoch.html#15864}{\htmlId{16602}{\htmlClass{Bound}{\text{dState&#39;&#39;}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#15814}{\htmlId{16613}{\htmlClass{Bound}{\text{pState&#39;}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#15873}{\htmlId{16623}{\htmlClass{Bound}{\text{gState&#39;}}}}\, \end{pmatrix} \end{pmatrix} \\ \,\href{Ledger.Conway.Specification.Epoch.html#15854}{\htmlId{16639}{\htmlClass{Bound}{\text{es}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#12175}{\htmlId{16644}{\htmlClass{Generalizable}{\text{fut&#39;}}}}\, \end{pmatrix}$</a>


<a id="16653" class="Keyword">data</a>


  <a id="_⊢_⇀⦇_,NEWEPOCH⦈_"></a><a id="16662" href="Ledger.Conway.Specification.Epoch.html#16662" class="Datatype Operator">_⊢_⇀⦇_,NEWEPOCH⦈_</a> <a id="16680" class="Symbol">:</a> <a id="16682" href="Agda.Builtin.Unit.html#175" class="Record">⊤</a> <a id="16684" class="Symbol">→</a> <a id="16686" href="Ledger.Conway.Specification.Epoch.html#3119" class="Record">NewEpochState</a> <a id="16700" class="Symbol">→</a> <a id="16702" href="Ledger.Core.Specification.Epoch.html#598" class="Function">Epoch</a> <a id="16708" class="Symbol">→</a> <a id="16710" href="Ledger.Conway.Specification.Epoch.html#3119" class="Record">NewEpochState</a> <a id="16724" class="Symbol">→</a> <a id="16726" href="Agda.Primitive.html#388" class="Primitive">Type</a>


  <a id="16735" class="Keyword">where</a>


  <a id="_⊢_⇀⦇_,NEWEPOCH⦈_.NEWEPOCH-New"></a><a id="16745" href="Ledger.Conway.Specification.Epoch.html#16745" class="InductiveConstructor">NEWEPOCH-New</a> <a id="16758" class="Symbol">:</a> 


    <a id="16767" class="Symbol">∀</a> <a id="16769" class="Symbol">{</a><a id="16770" href="Ledger.Conway.Specification.Epoch.html#16770" class="Bound">bprev</a> <a id="16776" href="Ledger.Conway.Specification.Epoch.html#16776" class="Bound">bcur</a> <a id="16781" class="Symbol">:</a> <a id="16783" href="Ledger.Conway.Specification.Rewards.html#4867" class="Function">BlocksMade</a><a id="16793" class="Symbol">}</a> <a id="16795" class="Symbol">→</a>


    <a id="16803" class="Keyword">let</a>
      <a id="16813" href="Ledger.Conway.Specification.Epoch.html#16813" class="Bound">eps&#39;</a> <a id="16818" class="Symbol">=</a> <a id="16820" href="Ledger.Conway.Specification.Epoch.html#8475" class="Function">applyRUpd</a> <a id="16830" href="Ledger.Conway.Specification.Epoch.html#12370" class="Generalizable">ru</a> <a id="16833" href="Ledger.Conway.Specification.Epoch.html#12228" class="Generalizable">eps</a>
      <a id="16843" href="Ledger.Conway.Specification.Epoch.html#16843" class="Bound">ss</a>   <a id="16848" class="Symbol">=</a> <a id="16850" href="Ledger.Conway.Specification.Epoch.html#1793" class="Field">EpochState.ss</a> <a id="16864" href="Ledger.Conway.Specification.Epoch.html#12237" class="Generalizable">eps&#39;&#39;</a>
      <a id="16876" href="Ledger.Conway.Specification.Epoch.html#16876" class="Bound">pd&#39;</a>  <a id="16881" class="Symbol">=</a> <a id="16883" href="Ledger.Conway.Specification.Epoch.html#9543" class="Function">calculatePoolDelegatedStake</a> <a id="16911" class="Symbol">(</a><a id="16912" href="Ledger.Conway.Specification.Rewards.html#7784" class="Field">Snapshots.set</a> <a id="16926" href="Ledger.Conway.Specification.Epoch.html#16843" class="Bound">ss</a><a id="16928" class="Symbol">)</a>
    <a id="16934" class="Keyword">in</a>
      <a id="16943" href="Prelude.InferenceRules.html#56075" class="Function Operator">∙</a> <a id="16945" href="Ledger.Conway.Specification.Epoch.html#12149" class="Generalizable">e</a> <a id="16947" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="16949" href="Ledger.Conway.Specification.Epoch.html#12151" class="Generalizable">lastEpoch</a> <a id="16959" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="16961" class="Number">1</a>
      <a id="16969" href="Prelude.InferenceRules.html#56006" class="Function Operator">∙</a> <a id="16971" class="Symbol">_</a> <a id="16973" href="Ledger.Conway.Specification.Epoch.html#15676" class="Datatype Operator">⊢</a> <a id="16975" href="Ledger.Conway.Specification.Epoch.html#16813" class="Bound">eps&#39;</a> <a id="16980" href="Ledger.Conway.Specification.Epoch.html#15676" class="Datatype Operator">⇀⦇</a> <a id="16983" href="Ledger.Conway.Specification.Epoch.html#12149" class="Generalizable">e</a> <a id="16985" href="Ledger.Conway.Specification.Epoch.html#15676" class="Datatype Operator">,EPOCH⦈</a> <a id="16993" href="Ledger.Conway.Specification.Epoch.html#12237" class="Generalizable">eps&#39;&#39;</a>
      <a id="17005" href="Prelude.InferenceRules.html#13071" class="Function Operator">──────────────────────────────────────────────</a>
      <a id="17058" class="Symbol">_</a> <a id="17060" href="Ledger.Conway.Specification.Epoch.html#16662" class="Datatype Operator">⊢</a> <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.Conway.Specification.Epoch.html#12151}{\htmlId{17064}{\htmlClass{Generalizable}{\text{lastEpoch}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#16770}{\htmlId{17076}{\htmlClass{Bound}{\text{bprev}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#16776}{\htmlId{17084}{\htmlClass{Bound}{\text{bcur}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#12228}{\htmlId{17091}{\htmlClass{Generalizable}{\text{eps}}}}\, \\ \,\href{Agda.Builtin.Maybe.html#173}{\htmlId{17097}{\htmlClass{InductiveConstructor}{\text{just}}}}\, \,\href{Ledger.Conway.Specification.Epoch.html#12370}{\htmlId{17102}{\htmlClass{Generalizable}{\text{ru}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#12417}{\htmlId{17107}{\htmlClass{Generalizable}{\text{pd}}}}\, \end{pmatrix}$</a> <a id="17112" href="Ledger.Conway.Specification.Epoch.html#16662" class="Datatype Operator">⇀⦇</a> <a id="17115" href="Ledger.Conway.Specification.Epoch.html#12149" class="Generalizable">e</a> <a id="17117" href="Ledger.Conway.Specification.Epoch.html#16662" class="Datatype Operator">,NEWEPOCH⦈</a> <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.Conway.Specification.Epoch.html#12149}{\htmlId{17130}{\htmlClass{Generalizable}{\text{e}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#16776}{\htmlId{17134}{\htmlClass{Bound}{\text{bcur}}}}\, \\ \,\href{Axiom.Set.Map.html#2671}{\htmlId{17141}{\htmlClass{Function}{\text{∅ᵐ}}}}\,  \\ \,\href{Ledger.Conway.Specification.Epoch.html#12237}{\htmlId{17147}{\htmlClass{Generalizable}{\text{eps&#39;&#39;}}}}\, \\ \,\href{Agda.Builtin.Maybe.html#194}{\htmlId{17155}{\htmlClass{InductiveConstructor}{\text{nothing}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#16876}{\htmlId{17165}{\htmlClass{Bound}{\text{pd&#39;}}}}\, \end{pmatrix}$</a>

  <a id="_⊢_⇀⦇_,NEWEPOCH⦈_.NEWEPOCH-Not-New"></a><a id="17174" href="Ledger.Conway.Specification.Epoch.html#17174" class="InductiveConstructor">NEWEPOCH-Not-New</a> <a id="17191" class="Symbol">:</a> <a id="17193" class="Symbol">∀</a> <a id="17195" class="Symbol">{</a><a id="17196" href="Ledger.Conway.Specification.Epoch.html#17196" class="Bound">bprev</a> <a id="17202" href="Ledger.Conway.Specification.Epoch.html#17202" class="Bound">bcur</a> <a id="17207" class="Symbol">:</a> <a id="17209" href="Ledger.Conway.Specification.Rewards.html#4867" class="Function">BlocksMade</a><a id="17219" class="Symbol">}</a> <a id="17221" class="Symbol">→</a>
    <a id="17227" href="Prelude.InferenceRules.html#56075" class="Function Operator">∙</a> <a id="17229" href="Ledger.Conway.Specification.Epoch.html#12149" class="Generalizable">e</a> <a id="17231" href="Relation.Binary.PropositionalEquality.Core.html#1000" class="Function Operator">≢</a> <a id="17233" href="Ledger.Conway.Specification.Epoch.html#12151" class="Generalizable">lastEpoch</a> <a id="17243" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="17245" class="Number">1</a>
      <a id="17253" href="Prelude.InferenceRules.html#13071" class="Function Operator">──────────────────────────────────────────────</a>
      <a id="17306" class="Symbol">_</a> <a id="17308" href="Ledger.Conway.Specification.Epoch.html#16662" class="Datatype Operator">⊢</a> <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.Conway.Specification.Epoch.html#12151}{\htmlId{17312}{\htmlClass{Generalizable}{\text{lastEpoch}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#17196}{\htmlId{17324}{\htmlClass{Bound}{\text{bprev}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#17202}{\htmlId{17332}{\htmlClass{Bound}{\text{bcur}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#12228}{\htmlId{17339}{\htmlClass{Generalizable}{\text{eps}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#12390}{\htmlId{17345}{\htmlClass{Generalizable}{\text{mru}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#12417}{\htmlId{17351}{\htmlClass{Generalizable}{\text{pd}}}}\, \end{pmatrix}$</a> <a id="17356" href="Ledger.Conway.Specification.Epoch.html#16662" class="Datatype Operator">⇀⦇</a> <a id="17359" href="Ledger.Conway.Specification.Epoch.html#12149" class="Generalizable">e</a> <a id="17361" href="Ledger.Conway.Specification.Epoch.html#16662" class="Datatype Operator">,NEWEPOCH⦈</a> <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.Conway.Specification.Epoch.html#12151}{\htmlId{17374}{\htmlClass{Generalizable}{\text{lastEpoch}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#17196}{\htmlId{17386}{\htmlClass{Bound}{\text{bprev}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#17202}{\htmlId{17394}{\htmlClass{Bound}{\text{bcur}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#12228}{\htmlId{17401}{\htmlClass{Generalizable}{\text{eps}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#12390}{\htmlId{17407}{\htmlClass{Generalizable}{\text{mru}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#12417}{\htmlId{17413}{\htmlClass{Generalizable}{\text{pd}}}}\, \end{pmatrix}$</a>

  <a id="_⊢_⇀⦇_,NEWEPOCH⦈_.NEWEPOCH-No-Reward-Update"></a><a id="17421" href="Ledger.Conway.Specification.Epoch.html#17421" class="InductiveConstructor">NEWEPOCH-No-Reward-Update</a> <a id="17447" class="Symbol">:</a> 


    <a id="17456" class="Symbol">∀</a> <a id="17458" class="Symbol">{</a><a id="17459" href="Ledger.Conway.Specification.Epoch.html#17459" class="Bound">bprev</a> <a id="17465" href="Ledger.Conway.Specification.Epoch.html#17465" class="Bound">bcur</a> <a id="17470" class="Symbol">:</a> <a id="17472" href="Ledger.Conway.Specification.Rewards.html#4867" class="Function">BlocksMade</a><a id="17482" class="Symbol">}</a> <a id="17484" class="Symbol">→</a>


    <a id="17492" class="Keyword">let</a>
      <a id="17502" href="Ledger.Conway.Specification.Epoch.html#17502" class="Bound">ss</a>  <a id="17506" class="Symbol">=</a> <a id="17508" href="Ledger.Conway.Specification.Epoch.html#1793" class="Field">EpochState.ss</a> <a id="17522" href="Ledger.Conway.Specification.Epoch.html#12232" class="Generalizable">eps&#39;</a>
      <a id="17533" href="Ledger.Conway.Specification.Epoch.html#17533" class="Bound">pd&#39;</a> <a id="17537" class="Symbol">=</a> <a id="17539" href="Ledger.Conway.Specification.Epoch.html#9543" class="Function">calculatePoolDelegatedStake</a> <a id="17567" class="Symbol">(</a><a id="17568" href="Ledger.Conway.Specification.Rewards.html#7784" class="Field">Snapshots.set</a> <a id="17582" href="Ledger.Conway.Specification.Epoch.html#17502" class="Bound">ss</a><a id="17584" class="Symbol">)</a>
    <a id="17590" class="Keyword">in</a>
      <a id="17599" href="Prelude.InferenceRules.html#56075" class="Function Operator">∙</a> <a id="17601" href="Ledger.Conway.Specification.Epoch.html#12149" class="Generalizable">e</a> <a id="17603" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="17605" href="Ledger.Conway.Specification.Epoch.html#12151" class="Generalizable">lastEpoch</a> <a id="17615" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="17617" class="Number">1</a>
      <a id="17625" href="Prelude.InferenceRules.html#56006" class="Function Operator">∙</a> <a id="17627" class="Symbol">_</a> <a id="17629" href="Ledger.Conway.Specification.Epoch.html#15676" class="Datatype Operator">⊢</a> <a id="17631" href="Ledger.Conway.Specification.Epoch.html#12228" class="Generalizable">eps</a> <a id="17635" href="Ledger.Conway.Specification.Epoch.html#15676" class="Datatype Operator">⇀⦇</a> <a id="17638" href="Ledger.Conway.Specification.Epoch.html#12149" class="Generalizable">e</a> <a id="17640" href="Ledger.Conway.Specification.Epoch.html#15676" class="Datatype Operator">,EPOCH⦈</a> <a id="17648" href="Ledger.Conway.Specification.Epoch.html#12232" class="Generalizable">eps&#39;</a>
      <a id="17659" href="Prelude.InferenceRules.html#13071" class="Function Operator">──────────────────────────────────────────────</a>
      <a id="17712" class="Symbol">_</a> <a id="17714" href="Ledger.Conway.Specification.Epoch.html#16662" class="Datatype Operator">⊢</a> <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.Conway.Specification.Epoch.html#12151}{\htmlId{17718}{\htmlClass{Generalizable}{\text{lastEpoch}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#17459}{\htmlId{17730}{\htmlClass{Bound}{\text{bprev}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#17465}{\htmlId{17738}{\htmlClass{Bound}{\text{bcur}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#12228}{\htmlId{17745}{\htmlClass{Generalizable}{\text{eps}}}}\, \\ \,\href{Agda.Builtin.Maybe.html#194}{\htmlId{17751}{\htmlClass{InductiveConstructor}{\text{nothing}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#12417}{\htmlId{17761}{\htmlClass{Generalizable}{\text{pd}}}}\, \end{pmatrix}$</a> <a id="17766" href="Ledger.Conway.Specification.Epoch.html#16662" class="Datatype Operator">⇀⦇</a> <a id="17769" href="Ledger.Conway.Specification.Epoch.html#12149" class="Generalizable">e</a> <a id="17771" href="Ledger.Conway.Specification.Epoch.html#16662" class="Datatype Operator">,NEWEPOCH⦈</a> <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.Conway.Specification.Epoch.html#12149}{\htmlId{17784}{\htmlClass{Generalizable}{\text{e}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#17465}{\htmlId{17788}{\htmlClass{Bound}{\text{bcur}}}}\, \\ \,\href{Axiom.Set.Map.html#2671}{\htmlId{17795}{\htmlClass{Function}{\text{∅ᵐ}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#12232}{\htmlId{17800}{\htmlClass{Generalizable}{\text{eps&#39;}}}}\, \\ \,\href{Agda.Builtin.Maybe.html#194}{\htmlId{17807}{\htmlClass{InductiveConstructor}{\text{nothing}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#17533}{\htmlId{17817}{\htmlClass{Bound}{\text{pd&#39;}}}}\, \end{pmatrix}$</a>

</pre></body></html>