<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>Ledger.Conway.Specification.Epoch</title><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.css"><link rel="stylesheet" href="Agda.css"><script src="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.js"></script><script src="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/contrib/auto-render.min.js"></script><script src="AgdaKaTeX.js" defer=""></script></head><body><pre class="Agda">
<a id="2" class="Symbol">{-#</a> <a id="6" class="Keyword">OPTIONS</a> <a id="14" class="Pragma">--safe</a> <a id="21" class="Symbol">#-}</a>

<a id="26" class="Keyword">open</a> <a id="31" class="Keyword">import</a> <a id="38" href="Ledger.Conway.Specification.Abstract.html" class="Module">Ledger.Conway.Specification.Abstract</a>
<a id="75" class="Keyword">open</a> <a id="80" class="Keyword">import</a> <a id="87" href="Ledger.Core.Specification.Transaction.html" class="Module">Ledger.Core.Specification.Transaction</a>

<a id="126" class="Keyword">module</a> <a id="133" href="Ledger.Conway.Specification.Epoch.html" class="Module">Ledger.Conway.Specification.Epoch</a>
  <a id="169" class="Symbol">(</a><a id="170" href="Ledger.Conway.Specification.Epoch.html#170" class="Bound">txs</a> <a id="174" class="Symbol">:</a> <a id="176" class="Symbol">_)</a> <a id="179" class="Symbol">(</a><a id="180" class="Keyword">open</a> <a id="185" href="Ledger.Core.Specification.Transaction.html#896" class="Module">TransactionStructure</a> <a id="206" href="Ledger.Conway.Specification.Epoch.html#170" class="Bound">txs</a><a id="209" class="Symbol">)</a>
  <a id="213" class="Symbol">(</a><a id="214" href="Ledger.Conway.Specification.Epoch.html#214" class="Bound">abs</a> <a id="218" class="Symbol">:</a> <a id="220" href="Ledger.Conway.Specification.Abstract.html#653" class="Record">AbstractFunctions</a> <a id="238" href="Ledger.Conway.Specification.Epoch.html#170" class="Bound">txs</a><a id="241" class="Symbol">)</a> <a id="243" class="Symbol">(</a><a id="244" class="Keyword">open</a> <a id="249" href="Ledger.Conway.Specification.Abstract.html#653" class="Module">AbstractFunctions</a> <a id="267" href="Ledger.Conway.Specification.Epoch.html#214" class="Bound">abs</a><a id="270" class="Symbol">)</a>
  <a id="274" class="Keyword">where</a>

<a id="281" class="Keyword">open</a> <a id="286" class="Keyword">import</a> <a id="293" href="Agda.Builtin.FromNat.html" class="Module">Agda.Builtin.FromNat</a>

<a id="315" class="Keyword">import</a>      <a id="327" href="Data.Integer.html" class="Module">Data.Integer</a> <a id="340" class="Symbol">as</a> <a id="343" class="Module">ℤ</a>
<a id="345" class="Keyword">open</a> <a id="350" class="Keyword">import</a> <a id="357" href="Data.Integer.html" class="Module">Data.Integer</a>                    <a id="389" class="Keyword">using</a> <a id="395" class="Symbol">()</a> <a id="398" class="Keyword">renaming</a> <a id="407" class="Symbol">(</a><a id="408" href="Agda.Builtin.Int.html#263" class="InductiveConstructor">+_</a> <a id="411" class="Symbol">to</a> <a id="414" class="InductiveConstructor">pos</a><a id="417" class="Symbol">)</a>
<a id="419" class="Keyword">open</a> <a id="424" class="Keyword">import</a> <a id="431" href="Data.Integer.Properties.html" class="Module">Data.Integer.Properties</a>         <a id="463" class="Keyword">using</a> <a id="469" class="Symbol">(</a><a id="470" class="Keyword">module</a> <a id="477" href="Data.Integer.Properties.html#11881" class="Module">≤-Reasoning</a><a id="488" class="Symbol">;</a> <a id="490" href="Data.Integer.Properties.html#34810" class="Function">+-mono-≤</a><a id="498" class="Symbol">;</a> <a id="500" href="Data.Integer.Properties.html#13298" class="Function">neg-mono-≤</a><a id="510" class="Symbol">;</a> <a id="512" href="Data.Integer.Properties.html#27061" class="Function">+-identityˡ</a><a id="523" class="Symbol">)</a>
                                            <a id="569" class="Keyword">renaming</a> <a id="578" class="Symbol">(</a><a id="579" href="Data.Integer.Properties.html#12508" class="Function">nonNegative⁻¹</a> <a id="593" class="Symbol">to</a> <a id="596" class="Function">nonNegative⁻¹ℤ</a><a id="610" class="Symbol">)</a>
<a id="612" class="Keyword">open</a> <a id="617" class="Keyword">import</a> <a id="624" href="Data.Integer.Tactic.RingSolver.html" class="Module">Data.Integer.Tactic.RingSolver</a>  <a id="656" class="Keyword">using</a> <a id="662" class="Symbol">(</a><a id="663" href="Data.Integer.Tactic.RingSolver.html#1200" class="Macro">solve-∀</a><a id="670" class="Symbol">)</a>
<a id="672" class="Keyword">open</a> <a id="677" class="Keyword">import</a> <a id="684" href="Data.Maybe.html" class="Module">Data.Maybe</a>                      <a id="716" class="Keyword">using</a> <a id="722" class="Symbol">(</a><a id="723" href="Data.Maybe.Base.html#1546" class="Function">fromMaybe</a><a id="732" class="Symbol">)</a>
<a id="734" class="Keyword">open</a> <a id="739" class="Keyword">import</a> <a id="746" href="Data.Nat.GeneralisedArithmetic.html" class="Module">Data.Nat.GeneralisedArithmetic</a>  <a id="778" class="Keyword">using</a> <a id="784" class="Symbol">(</a><a id="785" href="Data.Nat.GeneralisedArithmetic.html#866" class="Function">iterate</a><a id="792" class="Symbol">)</a>
<a id="794" class="Keyword">open</a> <a id="799" class="Keyword">import</a> <a id="806" href="Data.Rational.html" class="Module">Data.Rational</a>                   <a id="838" class="Keyword">using</a> <a id="844" class="Symbol">(</a><a id="845" href="Data.Rational.Base.html#1421" class="Record">ℚ</a><a id="846" class="Symbol">;</a> <a id="848" href="Data.Rational.Base.html#7195" class="Function">floor</a><a id="853" class="Symbol">;</a> <a id="855" href="Data.Rational.Base.html#6394" class="Function Operator">_*_</a><a id="858" class="Symbol">;</a> <a id="860" href="Data.Rational.Base.html#6787" class="Function Operator">_÷_</a><a id="863" class="Symbol">;</a> <a id="865" href="Data.Rational.Base.html#3963" class="Function Operator">_/_</a><a id="868" class="Symbol">;</a> <a id="870" href="Data.Rational.Base.html#6933" class="Function Operator">_⊓_</a><a id="873" class="Symbol">;</a> <a id="875" href="Data.Rational.Properties.html#4152" class="Function Operator">_≟_</a><a id="878" class="Symbol">;</a> <a id="880" href="Data.Rational.Base.html#4971" class="Function">≢-nonZero</a><a id="889" class="Symbol">)</a>
<a id="891" class="Keyword">open</a> <a id="896" class="Keyword">import</a> <a id="903" href="Data.Rational.Literals.html" class="Module">Data.Rational.Literals</a>          <a id="935" class="Keyword">using</a> <a id="941" class="Symbol">(</a><a id="942" href="Data.Rational.Literals.html#740" class="Function">number</a><a id="948" class="Symbol">;</a> <a id="950" href="Data.Rational.Literals.html#613" class="Function">fromℤ</a><a id="955" class="Symbol">)</a>
<a id="957" class="Keyword">open</a> <a id="962" class="Keyword">import</a> <a id="969" href="Data.Rational.Properties.html" class="Module">Data.Rational.Properties</a>        <a id="1001" class="Keyword">using</a> <a id="1007" class="Symbol">(</a><a id="1008" href="Data.Rational.Properties.html#27061" class="Function">nonNegative⁻¹</a><a id="1021" class="Symbol">;</a> <a id="1023" href="Data.Rational.Properties.html#7555" class="Function">pos⇒nonNeg</a><a id="1033" class="Symbol">;</a> <a id="1035" href="Algebra.Construct.NaturalChoice.MinOp.html#7120" class="Function">⊓-glb</a><a id="1040" class="Symbol">)</a>

<a id="1043" class="Keyword">open</a> <a id="1048" class="Keyword">import</a> <a id="1055" href="stdlib.Data.Rational.Properties.html" class="Module">stdlib.Data.Rational.Properties</a> <a id="1087" class="Keyword">using</a> <a id="1093" class="Symbol">(</a><a id="1094" href="stdlib.Data.Rational.Properties.html#1631" class="Function">0≤⇒0≤floor</a><a id="1104" class="Symbol">;</a> <a id="1106" href="stdlib.Data.Rational.Properties.html#2865" class="Function">÷-0≤⇒0≤</a><a id="1113" class="Symbol">;</a> <a id="1115" href="stdlib.Data.Rational.Properties.html#2275" class="Function">fromℕ-0≤</a><a id="1123" class="Symbol">;</a> <a id="1125" href="stdlib.Data.Rational.Properties.html#2409" class="Function">*-0≤⇒0≤</a><a id="1132" class="Symbol">;</a> <a id="1134" href="stdlib.Data.Rational.Properties.html#2013" class="Function">fromℤ-0≤</a><a id="1142" class="Symbol">)</a>

<a id="1145" class="Keyword">open</a> <a id="1150" class="Keyword">import</a> <a id="1157" href="Ledger.Prelude.html" class="Module">Ledger.Prelude</a> <a id="1172" class="Keyword">hiding</a> <a id="1179" class="Symbol">(</a><a id="1180" href="Data.List.Base.html#5114" class="Function">iterate</a><a id="1187" class="Symbol">;</a> <a id="1189" href="Data.Nat.Base.html#7102" class="Function Operator">_/_</a><a id="1192" class="Symbol">;</a> <a id="1194" href="Agda.Builtin.Nat.html#539" class="Primitive Operator">_*_</a><a id="1197" class="Symbol">;</a> <a id="1199" href="Data.Nat.Base.html#5851" class="Function Operator">_⊓_</a><a id="1202" class="Symbol">;</a> <a id="1204" href="Class.DecEq.Core.html#168" class="Field Operator">_≟_</a><a id="1207" class="Symbol">;</a> <a id="1209" href="Data.Nat.Base.html#3425" class="Function">≢-nonZero</a><a id="1218" class="Symbol">)</a>
<a id="1220" class="Keyword">open</a> <a id="1225" class="Keyword">import</a> <a id="1232" href="Ledger.Prelude.Numeric.UnitInterval.html" class="Module">Ledger.Prelude.Numeric.UnitInterval</a> <a id="1268" class="Keyword">using</a> <a id="1274" class="Symbol">(</a><a id="1275" href="Ledger.Prelude.Numeric.UnitInterval.html#1989" class="Function">fromUnitInterval</a><a id="1291" class="Symbol">;</a> <a id="1293" href="Ledger.Prelude.Numeric.UnitInterval.html#3337" class="Function">UnitInterval-*-0≤</a><a id="1310" class="Symbol">)</a>

<a id="1313" class="Keyword">open</a> <a id="1318" class="Keyword">import</a> <a id="1325" href="Ledger.Conway.Specification.Certs.html" class="Module">Ledger.Conway.Specification.Certs</a> <a id="1359" href="Ledger.Core.Specification.Transaction.html#1970" class="Function">govStructure</a>
<a id="1372" class="Keyword">open</a> <a id="1377" class="Keyword">import</a> <a id="1384" href="Ledger.Conway.Specification.Enact.html" class="Module">Ledger.Conway.Specification.Enact</a> <a id="1418" href="Ledger.Core.Specification.Transaction.html#1970" class="Function">govStructure</a>
<a id="1431" class="Keyword">open</a> <a id="1436" class="Keyword">import</a> <a id="1443" href="Ledger.Conway.Specification.Gov.html" class="Module">Ledger.Conway.Specification.Gov</a> <a id="1475" href="Ledger.Conway.Specification.Epoch.html#170" class="Bound">txs</a>
<a id="1479" class="Keyword">open</a> <a id="1484" class="Keyword">import</a> <a id="1491" href="Ledger.Conway.Specification.Ledger.html" class="Module">Ledger.Conway.Specification.Ledger</a> <a id="1526" href="Ledger.Conway.Specification.Epoch.html#170" class="Bound">txs</a> <a id="1530" href="Ledger.Conway.Specification.Epoch.html#214" class="Bound">abs</a>
<a id="1534" class="Keyword">open</a> <a id="1539" class="Keyword">import</a> <a id="1546" href="Ledger.Conway.Specification.PoolReap.html" class="Module">Ledger.Conway.Specification.PoolReap</a> <a id="1583" href="Ledger.Conway.Specification.Epoch.html#170" class="Bound">txs</a> <a id="1587" href="Ledger.Conway.Specification.Epoch.html#214" class="Bound">abs</a>
<a id="1591" class="Keyword">open</a> <a id="1596" class="Keyword">import</a> <a id="1603" href="Ledger.Conway.Specification.Ratify.html" class="Module">Ledger.Conway.Specification.Ratify</a> <a id="1638" href="Ledger.Conway.Specification.Epoch.html#170" class="Bound">txs</a>
<a id="1642" class="Keyword">open</a> <a id="1647" class="Keyword">import</a> <a id="1654" href="Ledger.Conway.Specification.Rewards.html" class="Module">Ledger.Conway.Specification.Rewards</a> <a id="1690" href="Ledger.Conway.Specification.Epoch.html#170" class="Bound">txs</a> <a id="1694" href="Ledger.Conway.Specification.Epoch.html#214" class="Bound">abs</a>
<a id="1698" class="Keyword">open</a> <a id="1703" class="Keyword">import</a> <a id="1710" href="Ledger.Conway.Specification.Utxo.html" class="Module">Ledger.Conway.Specification.Utxo</a> <a id="1743" href="Ledger.Conway.Specification.Epoch.html#170" class="Bound">txs</a> <a id="1747" href="Ledger.Conway.Specification.Epoch.html#214" class="Bound">abs</a>

<a id="1752" class="Keyword">open</a> <a id="1757" href="Ledger.Prelude.html#2436" class="Module">Filter</a> <a id="1764" class="Keyword">using</a> <a id="1770" class="Symbol">(</a><a id="1771" href="Ledger.Prelude.html#2451" class="Function">filter</a><a id="1777" class="Symbol">)</a>
<a id="1779" class="Keyword">open</a> <a id="1784" href="Agda.Builtin.FromNat.html#196" class="Module">Number</a> <a id="1791" href="Data.Rational.Literals.html#740" class="Function">number</a> <a id="1798" class="Keyword">renaming</a> <a id="1807" class="Symbol">(</a><a id="1808" href="Agda.Builtin.FromNat.html#281" class="Field">fromNat</a> <a id="1816" class="Symbol">to</a> <a id="1819" class="Field">fromℕ</a><a id="1824" class="Symbol">)</a>


<a id="1828" class="Keyword">record</a> <a id="EpochState"></a><a id="1835" href="Ledger.Conway.Specification.Epoch.html#1835" class="Record">EpochState</a> <a id="1846" class="Symbol">:</a> <a id="1848" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="1853" class="Keyword">where</a>


  <a id="1863" class="Keyword">constructor</a> <a id="⟦_,_,_,_,_⟧ᵉ&#39;"></a><a id="1875" href="Ledger.Conway.Specification.Epoch.html#1875" class="InductiveConstructor Operator">⟦_,_,_,_,_⟧ᵉ&#39;</a>


  <a id="1893" class="Keyword">field</a>
    <a id="EpochState.acnt"></a><a id="1903" href="Ledger.Conway.Specification.Epoch.html#1903" class="Field">acnt</a>       <a id="1914" class="Symbol">:</a> <a id="1916" href="Ledger.Conway.Specification.PParams.html#718" class="Record">Acnt</a>
    <a id="EpochState.ss"></a><a id="1925" href="Ledger.Conway.Specification.Epoch.html#1925" class="Field">ss</a>         <a id="1936" class="Symbol">:</a> <a id="1938" href="Ledger.Conway.Specification.Rewards.html#7746" class="Record">Snapshots</a>
    <a id="EpochState.ls"></a><a id="1952" href="Ledger.Conway.Specification.Epoch.html#1952" class="Field">ls</a>         <a id="1963" class="Symbol">:</a> <a id="1965" href="Ledger.Conway.Specification.Ledger.html#999" class="Record">LState</a>
    <a id="EpochState.es"></a><a id="1976" href="Ledger.Conway.Specification.Epoch.html#1976" class="Field">es</a>         <a id="1987" class="Symbol">:</a> <a id="1989" href="Ledger.Conway.Specification.Enact.html#444" class="Record">EnactState</a>
    <a id="EpochState.fut"></a><a id="2004" href="Ledger.Conway.Specification.Epoch.html#2004" class="Field">fut</a>        <a id="2015" class="Symbol">:</a> <a id="2017" href="Ledger.Conway.Specification.Ratify.html#3526" class="Record">RatifyState</a>


<a id="2031" class="Keyword">record</a> <a id="HasEpochState"></a><a id="2038" href="Ledger.Conway.Specification.Epoch.html#2038" class="Record">HasEpochState</a> <a id="2052" class="Symbol">{</a><a id="2053" href="Ledger.Conway.Specification.Epoch.html#2053" class="Bound">a</a><a id="2054" class="Symbol">}</a> <a id="2056" class="Symbol">(</a><a id="2057" href="Ledger.Conway.Specification.Epoch.html#2057" class="Bound">A</a> <a id="2059" class="Symbol">:</a> <a id="2061" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="2066" href="Ledger.Conway.Specification.Epoch.html#2053" class="Bound">a</a><a id="2067" class="Symbol">)</a> <a id="2069" class="Symbol">:</a> <a id="2071" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="2076" href="Ledger.Conway.Specification.Epoch.html#2053" class="Bound">a</a> <a id="2078" class="Keyword">where</a>
  <a id="2086" class="Keyword">field</a> <a id="HasEpochState.EpochStateOf"></a><a id="2092" href="Ledger.Conway.Specification.Epoch.html#2092" class="Field">EpochStateOf</a> <a id="2105" class="Symbol">:</a> <a id="2107" href="Ledger.Conway.Specification.Epoch.html#2057" class="Bound">A</a> <a id="2109" class="Symbol">→</a> <a id="2111" href="Ledger.Conway.Specification.Epoch.html#1835" class="Record">EpochState</a>
<a id="2122" class="Keyword">open</a> <a id="2127" href="Ledger.Conway.Specification.Epoch.html#2038" class="Module">HasEpochState</a> <a id="2141" class="Symbol">⦃...⦄</a> <a id="2147" class="Keyword">public</a>

<a id="2155" class="Keyword">instance</a>
  <a id="HasSnapshots-EpochState"></a><a id="2166" href="Ledger.Conway.Specification.Epoch.html#2166" class="Function">HasSnapshots-EpochState</a> <a id="2190" class="Symbol">:</a> <a id="2192" href="Ledger.Conway.Specification.Rewards.html#7837" class="Record">HasSnapshots</a> <a id="2205" href="Ledger.Conway.Specification.Epoch.html#1835" class="Record">EpochState</a>
  <a id="2218" href="Ledger.Conway.Specification.Epoch.html#2166" class="Function">HasSnapshots-EpochState</a> <a id="2242" class="Symbol">.</a><a id="2243" href="Ledger.Conway.Specification.Rewards.html#7890" class="Field">SnapshotsOf</a> <a id="2255" class="Symbol">=</a> <a id="2257" href="Ledger.Conway.Specification.Epoch.html#1925" class="Field">EpochState.ss</a>

  <a id="HasLState-EpochState"></a><a id="2274" href="Ledger.Conway.Specification.Epoch.html#2274" class="Function">HasLState-EpochState</a> <a id="2295" class="Symbol">:</a> <a id="2297" href="Ledger.Conway.Specification.Ledger.html#1143" class="Record">HasLState</a> <a id="2307" href="Ledger.Conway.Specification.Epoch.html#1835" class="Record">EpochState</a>
  <a id="2320" href="Ledger.Conway.Specification.Epoch.html#2274" class="Function">HasLState-EpochState</a> <a id="2341" class="Symbol">.</a><a id="2342" href="Ledger.Conway.Specification.Ledger.html#1193" class="Field">LStateOf</a> <a id="2351" class="Symbol">=</a> <a id="2353" href="Ledger.Conway.Specification.Epoch.html#1952" class="Field">EpochState.ls</a>

  <a id="HasEnactState-EpochState"></a><a id="2370" href="Ledger.Conway.Specification.Epoch.html#2370" class="Function">HasEnactState-EpochState</a> <a id="2395" class="Symbol">:</a> <a id="2397" href="Ledger.Conway.Specification.Enact.html#733" class="Record">HasEnactState</a> <a id="2411" href="Ledger.Conway.Specification.Epoch.html#1835" class="Record">EpochState</a>
  <a id="2424" href="Ledger.Conway.Specification.Epoch.html#2370" class="Function">HasEnactState-EpochState</a> <a id="2449" class="Symbol">.</a><a id="2450" href="Ledger.Conway.Specification.Enact.html#787" class="Field">EnactStateOf</a> <a id="2463" class="Symbol">=</a> <a id="2465" href="Ledger.Conway.Specification.Epoch.html#1976" class="Field">EpochState.es</a>

  <a id="HasDeposits-EpochState"></a><a id="2482" href="Ledger.Conway.Specification.Epoch.html#2482" class="Function">HasDeposits-EpochState</a> <a id="2505" class="Symbol">:</a> <a id="2507" href="Ledger.Conway.Specification.Certs.html#860" class="Record">HasDeposits</a> <a id="2519" href="Ledger.Conway.Specification.Epoch.html#1835" class="Record">EpochState</a>
  <a id="2532" href="Ledger.Conway.Specification.Epoch.html#2482" class="Function">HasDeposits-EpochState</a> <a id="2555" class="Symbol">.</a><a id="2556" href="Ledger.Conway.Specification.Certs.html#912" class="Field">DepositsOf</a> <a id="2567" class="Symbol">=</a> <a id="2569" href="Ledger.Conway.Specification.Certs.html#912" class="Field">DepositsOf</a> <a id="2580" href="Function.Base.html#1134" class="Function Operator">∘</a> <a id="2582" href="Ledger.Conway.Specification.Ledger.html#1193" class="Field">LStateOf</a>

  <a id="HasDReps-EpochState"></a><a id="2594" href="Ledger.Conway.Specification.Epoch.html#2594" class="Function">HasDReps-EpochState</a> <a id="2614" class="Symbol">:</a> <a id="2616" href="Ledger.Conway.Specification.Certs.html#1550" class="Record">HasDReps</a> <a id="2625" href="Ledger.Conway.Specification.Epoch.html#1835" class="Record">EpochState</a>
  <a id="2638" href="Ledger.Conway.Specification.Epoch.html#2594" class="Function">HasDReps-EpochState</a> <a id="2658" class="Symbol">.</a><a id="2659" href="Ledger.Conway.Specification.Certs.html#1599" class="Field">DRepsOf</a> <a id="2667" class="Symbol">=</a> <a id="2669" href="Ledger.Conway.Specification.Certs.html#1599" class="Field">DRepsOf</a> <a id="2677" href="Function.Base.html#1134" class="Function Operator">∘</a> <a id="2679" href="Ledger.Conway.Specification.Certs.html#4917" class="Field">CertStateOf</a> <a id="2691" href="Function.Base.html#1134" class="Function Operator">∘</a> <a id="2693" href="Ledger.Conway.Specification.Ledger.html#1193" class="Field">LStateOf</a>

  <a id="HasTreasury-EpochState"></a><a id="2705" href="Ledger.Conway.Specification.Epoch.html#2705" class="Function">HasTreasury-EpochState</a> <a id="2728" class="Symbol">:</a> <a id="2730" href="Ledger.Prelude.Base.html#837" class="Record">HasTreasury</a> <a id="2742" href="Ledger.Conway.Specification.Epoch.html#1835" class="Record">EpochState</a>
  <a id="2755" href="Ledger.Conway.Specification.Epoch.html#2705" class="Function">HasTreasury-EpochState</a> <a id="2778" class="Symbol">.</a><a id="2779" href="Ledger.Prelude.Base.html#889" class="Field">TreasuryOf</a> <a id="2790" class="Symbol">=</a> <a id="2792" href="Ledger.Conway.Specification.PParams.html#773" class="Field">Acnt.treasury</a> <a id="2806" href="Function.Base.html#1134" class="Function Operator">∘</a> <a id="2808" href="Ledger.Conway.Specification.Epoch.html#1903" class="Field">EpochState.acnt</a>

  <a id="HasReserves-EpochState"></a><a id="2827" href="Ledger.Conway.Specification.Epoch.html#2827" class="Function">HasReserves-EpochState</a> <a id="2850" class="Symbol">:</a> <a id="2852" href="Ledger.Prelude.Base.html#721" class="Record">HasReserves</a> <a id="2864" href="Ledger.Conway.Specification.Epoch.html#1835" class="Record">EpochState</a>
  <a id="2877" href="Ledger.Conway.Specification.Epoch.html#2827" class="Function">HasReserves-EpochState</a> <a id="2900" class="Symbol">.</a><a id="2901" href="Ledger.Prelude.Base.html#773" class="Field">ReservesOf</a> <a id="2912" class="Symbol">=</a> <a id="2914" href="Ledger.Conway.Specification.PParams.html#782" class="Field">Acnt.reserves</a> <a id="2928" href="Function.Base.html#1134" class="Function Operator">∘</a> <a id="2930" href="Ledger.Conway.Specification.Epoch.html#1903" class="Field">EpochState.acnt</a>

  <a id="HasPParams-EpochState"></a><a id="2949" href="Ledger.Conway.Specification.Epoch.html#2949" class="Function">HasPParams-EpochState</a> <a id="2971" class="Symbol">:</a> <a id="2973" href="Ledger.Conway.Specification.PParams.html#3491" class="Record">HasPParams</a> <a id="2984" href="Ledger.Conway.Specification.Epoch.html#1835" class="Record">EpochState</a>
  <a id="2997" href="Ledger.Conway.Specification.Epoch.html#2949" class="Function">HasPParams-EpochState</a> <a id="3019" class="Symbol">.</a><a id="3020" href="Ledger.Conway.Specification.PParams.html#3542" class="Field">PParamsOf</a> <a id="3030" class="Symbol">=</a> <a id="3032" href="Ledger.Conway.Specification.PParams.html#3542" class="Field">PParamsOf</a> <a id="3042" href="Function.Base.html#1134" class="Function Operator">∘</a> <a id="3044" href="Ledger.Conway.Specification.Enact.html#787" class="Field">EnactStateOf</a>

  <a id="HasRatifyState-EpochState"></a><a id="3060" href="Ledger.Conway.Specification.Epoch.html#3060" class="Function">HasRatifyState-EpochState</a> <a id="3086" class="Symbol">:</a> <a id="3088" href="Ledger.Conway.Specification.Ratify.html#3662" class="Record">HasRatifyState</a> <a id="3103" href="Ledger.Conway.Specification.Epoch.html#1835" class="Record">EpochState</a>
  <a id="3116" href="Ledger.Conway.Specification.Epoch.html#3060" class="Function">HasRatifyState-EpochState</a> <a id="3142" class="Symbol">.</a><a id="3143" href="Ledger.Conway.Specification.Ratify.html#3717" class="Field">RatifyStateOf</a> <a id="3157" class="Symbol">=</a> <a id="3159" href="Ledger.Conway.Specification.Epoch.html#2004" class="Field">EpochState.fut</a>

  <a id="HasPState-EpochState"></a><a id="3177" href="Ledger.Conway.Specification.Epoch.html#3177" class="Function">HasPState-EpochState</a> <a id="3198" class="Symbol">:</a> <a id="3200" href="Ledger.Conway.Specification.Certs.html#4648" class="Record">HasPState</a> <a id="3210" href="Ledger.Conway.Specification.Epoch.html#1835" class="Record">EpochState</a>
  <a id="3223" href="Ledger.Conway.Specification.Epoch.html#3177" class="Function">HasPState-EpochState</a> <a id="3244" class="Symbol">.</a><a id="3245" href="Ledger.Conway.Specification.Certs.html#4698" class="Field">PStateOf</a> <a id="3254" class="Symbol">=</a> <a id="3256" href="Ledger.Conway.Specification.Certs.html#4698" class="Field">PStateOf</a> <a id="3265" href="Function.Base.html#1134" class="Function Operator">∘</a> <a id="3267" href="Ledger.Conway.Specification.Certs.html#4917" class="Field">CertStateOf</a> <a id="3279" href="Function.Base.html#1134" class="Function Operator">∘</a> <a id="3281" href="Ledger.Conway.Specification.Ledger.html#1193" class="Field">LStateOf</a>


<a id="PoolDelegatedStake"></a><a id="3292" href="Ledger.Conway.Specification.Epoch.html#3292" class="Function">PoolDelegatedStake</a> <a id="3311" class="Symbol">:</a> <a id="3313" href="Agda.Primitive.html#388" class="Primitive">Type</a>
<a id="3318" href="Ledger.Conway.Specification.Epoch.html#3292" class="Function">PoolDelegatedStake</a> <a id="3337" class="Symbol">=</a> <a id="3339" href="Ledger.Core.Specification.Crypto.html#1386" class="Function">KeyHash</a> <a id="3347" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="3349" href="Ledger.Prelude.Base.html#154" class="Function">Coin</a>

<a id="3355" class="Keyword">record</a> <a id="NewEpochState"></a><a id="3362" href="Ledger.Conway.Specification.Epoch.html#3362" class="Record">NewEpochState</a> <a id="3376" class="Symbol">:</a> <a id="3378" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="3383" class="Keyword">where</a>
  <a id="3391" class="Keyword">field</a>
    <a id="NewEpochState.lastEpoch"></a><a id="3401" href="Ledger.Conway.Specification.Epoch.html#3401" class="Field">lastEpoch</a>   <a id="3413" class="Symbol">:</a> <a id="3415" href="Ledger.Core.Specification.Epoch.html#646" class="Function">Epoch</a>
    <a id="NewEpochState.bprev"></a><a id="3425" href="Ledger.Conway.Specification.Epoch.html#3425" class="Field">bprev</a>       <a id="3437" class="Symbol">:</a> <a id="3439" href="Ledger.Conway.Specification.Rewards.html#4933" class="Function">BlocksMade</a>
    <a id="NewEpochState.bcur"></a><a id="3454" href="Ledger.Conway.Specification.Epoch.html#3454" class="Field">bcur</a>        <a id="3466" class="Symbol">:</a> <a id="3468" href="Ledger.Conway.Specification.Rewards.html#4933" class="Function">BlocksMade</a>
    <a id="NewEpochState.epochState"></a><a id="3483" href="Ledger.Conway.Specification.Epoch.html#3483" class="Field">epochState</a>  <a id="3495" class="Symbol">:</a> <a id="3497" href="Ledger.Conway.Specification.Epoch.html#1835" class="Record">EpochState</a>
    <a id="NewEpochState.ru"></a><a id="3512" href="Ledger.Conway.Specification.Epoch.html#3512" class="Field">ru</a>          <a id="3524" class="Symbol">:</a> <a id="3526" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="3532" href="Ledger.Conway.Specification.Rewards.html#6276" class="Record">RewardUpdate</a>
    <a id="NewEpochState.pd"></a><a id="3549" href="Ledger.Conway.Specification.Epoch.html#3549" class="Field">pd</a>          <a id="3561" class="Symbol">:</a> <a id="3563" href="Ledger.Conway.Specification.Epoch.html#3292" class="Function">PoolDelegatedStake</a>


<a id="3584" class="Keyword">record</a> <a id="HasNewEpochState"></a><a id="3591" href="Ledger.Conway.Specification.Epoch.html#3591" class="Record">HasNewEpochState</a> <a id="3608" class="Symbol">{</a><a id="3609" href="Ledger.Conway.Specification.Epoch.html#3609" class="Bound">a</a><a id="3610" class="Symbol">}</a> <a id="3612" class="Symbol">(</a><a id="3613" href="Ledger.Conway.Specification.Epoch.html#3613" class="Bound">A</a> <a id="3615" class="Symbol">:</a> <a id="3617" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="3622" href="Ledger.Conway.Specification.Epoch.html#3609" class="Bound">a</a><a id="3623" class="Symbol">)</a> <a id="3625" class="Symbol">:</a> <a id="3627" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="3632" href="Ledger.Conway.Specification.Epoch.html#3609" class="Bound">a</a> <a id="3634" class="Keyword">where</a>
  <a id="3642" class="Keyword">field</a> <a id="HasNewEpochState.NewEpochStateOf"></a><a id="3648" href="Ledger.Conway.Specification.Epoch.html#3648" class="Field">NewEpochStateOf</a> <a id="3664" class="Symbol">:</a> <a id="3666" href="Ledger.Conway.Specification.Epoch.html#3613" class="Bound">A</a> <a id="3668" class="Symbol">→</a> <a id="3670" href="Ledger.Conway.Specification.Epoch.html#3362" class="Record">NewEpochState</a>
<a id="3684" class="Keyword">open</a> <a id="3689" href="Ledger.Conway.Specification.Epoch.html#3591" class="Module">HasNewEpochState</a> <a id="3706" class="Symbol">⦃...⦄</a> <a id="3712" class="Keyword">public</a>
<a id="3719" class="Keyword">record</a> <a id="HasLastEpoch"></a><a id="3726" href="Ledger.Conway.Specification.Epoch.html#3726" class="Record">HasLastEpoch</a>     <a id="3743" class="Symbol">{</a><a id="3744" href="Ledger.Conway.Specification.Epoch.html#3744" class="Bound">a</a><a id="3745" class="Symbol">}</a> <a id="3747" class="Symbol">(</a><a id="3748" href="Ledger.Conway.Specification.Epoch.html#3748" class="Bound">A</a> <a id="3750" class="Symbol">:</a> <a id="3752" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="3757" href="Ledger.Conway.Specification.Epoch.html#3744" class="Bound">a</a><a id="3758" class="Symbol">)</a> <a id="3760" class="Symbol">:</a> <a id="3762" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="3767" href="Ledger.Conway.Specification.Epoch.html#3744" class="Bound">a</a> <a id="3769" class="Keyword">where</a> <a id="3775" class="Keyword">field</a> <a id="HasLastEpoch.LastEpochOf"></a><a id="3781" href="Ledger.Conway.Specification.Epoch.html#3781" class="Field">LastEpochOf</a>     <a id="3797" class="Symbol">:</a> <a id="3799" href="Ledger.Conway.Specification.Epoch.html#3748" class="Bound">A</a> <a id="3801" class="Symbol">→</a> <a id="3803" href="Ledger.Core.Specification.Epoch.html#646" class="Function">Epoch</a>
<a id="3809" class="Keyword">open</a> <a id="3814" href="Ledger.Conway.Specification.Epoch.html#3726" class="Module">HasLastEpoch</a>     <a id="3831" class="Symbol">⦃...⦄</a> <a id="3837" class="Keyword">public</a>

<a id="3845" class="Keyword">instance</a>
  <a id="HasLastEpoch-NewEpochState"></a><a id="3856" href="Ledger.Conway.Specification.Epoch.html#3856" class="Function">HasLastEpoch-NewEpochState</a> <a id="3883" class="Symbol">:</a> <a id="3885" href="Ledger.Conway.Specification.Epoch.html#3726" class="Record">HasLastEpoch</a> <a id="3898" href="Ledger.Conway.Specification.Epoch.html#3362" class="Record">NewEpochState</a>
  <a id="3914" href="Ledger.Conway.Specification.Epoch.html#3856" class="Function">HasLastEpoch-NewEpochState</a> <a id="3941" class="Symbol">.</a><a id="3942" href="Ledger.Conway.Specification.Epoch.html#3781" class="Field">LastEpochOf</a> <a id="3954" class="Symbol">=</a> <a id="3956" href="Ledger.Conway.Specification.Epoch.html#3401" class="Field">NewEpochState.lastEpoch</a>

  <a id="HasEpochState-NewEpochState"></a><a id="3983" href="Ledger.Conway.Specification.Epoch.html#3983" class="Function">HasEpochState-NewEpochState</a> <a id="4011" class="Symbol">:</a> <a id="4013" href="Ledger.Conway.Specification.Epoch.html#2038" class="Record">HasEpochState</a> <a id="4027" href="Ledger.Conway.Specification.Epoch.html#3362" class="Record">NewEpochState</a>
  <a id="4043" href="Ledger.Conway.Specification.Epoch.html#3983" class="Function">HasEpochState-NewEpochState</a> <a id="4071" class="Symbol">.</a><a id="4072" href="Ledger.Conway.Specification.Epoch.html#2092" class="Field">EpochStateOf</a> <a id="4085" class="Symbol">=</a> <a id="4087" href="Ledger.Conway.Specification.Epoch.html#3483" class="Field">NewEpochState.epochState</a>

  <a id="HasEnactState-NewEpochState"></a><a id="4115" href="Ledger.Conway.Specification.Epoch.html#4115" class="Function">HasEnactState-NewEpochState</a> <a id="4143" class="Symbol">:</a> <a id="4145" href="Ledger.Conway.Specification.Enact.html#733" class="Record">HasEnactState</a> <a id="4159" href="Ledger.Conway.Specification.Epoch.html#3362" class="Record">NewEpochState</a>
  <a id="4175" href="Ledger.Conway.Specification.Epoch.html#4115" class="Function">HasEnactState-NewEpochState</a> <a id="4203" class="Symbol">.</a><a id="4204" href="Ledger.Conway.Specification.Enact.html#787" class="Field">EnactStateOf</a> <a id="4217" class="Symbol">=</a> <a id="4219" href="Ledger.Conway.Specification.Enact.html#787" class="Field">EnactStateOf</a> <a id="4232" href="Function.Base.html#1134" class="Function Operator">∘</a> <a id="4234" href="Ledger.Conway.Specification.Epoch.html#2092" class="Field">EpochStateOf</a>

  <a id="Hastreasury-NewEpochState"></a><a id="4250" href="Ledger.Conway.Specification.Epoch.html#4250" class="Function">Hastreasury-NewEpochState</a> <a id="4276" class="Symbol">:</a> <a id="4278" href="Ledger.Prelude.Base.html#837" class="Record">HasTreasury</a> <a id="4290" href="Ledger.Conway.Specification.Epoch.html#3362" class="Record">NewEpochState</a>
  <a id="4306" href="Ledger.Conway.Specification.Epoch.html#4250" class="Function">Hastreasury-NewEpochState</a> <a id="4332" class="Symbol">.</a><a id="4333" href="Ledger.Prelude.Base.html#889" class="Field">TreasuryOf</a> <a id="4344" class="Symbol">=</a> <a id="4346" href="Ledger.Prelude.Base.html#889" class="Field">TreasuryOf</a> <a id="4357" href="Function.Base.html#1134" class="Function Operator">∘</a> <a id="4359" href="Ledger.Conway.Specification.Epoch.html#2092" class="Field">EpochStateOf</a>

  <a id="HasLState-NewEpochState"></a><a id="4375" href="Ledger.Conway.Specification.Epoch.html#4375" class="Function">HasLState-NewEpochState</a> <a id="4399" class="Symbol">:</a> <a id="4401" href="Ledger.Conway.Specification.Ledger.html#1143" class="Record">HasLState</a> <a id="4411" href="Ledger.Conway.Specification.Epoch.html#3362" class="Record">NewEpochState</a>
  <a id="4427" href="Ledger.Conway.Specification.Epoch.html#4375" class="Function">HasLState-NewEpochState</a> <a id="4451" class="Symbol">.</a><a id="4452" href="Ledger.Conway.Specification.Ledger.html#1193" class="Field">LStateOf</a> <a id="4461" class="Symbol">=</a> <a id="4463" href="Ledger.Conway.Specification.Ledger.html#1193" class="Field">LStateOf</a> <a id="4472" href="Function.Base.html#1134" class="Function Operator">∘</a> <a id="4474" href="Ledger.Conway.Specification.Epoch.html#2092" class="Field">EpochStateOf</a>

  <a id="HasGovState-NewEpochState"></a><a id="4490" href="Ledger.Conway.Specification.Epoch.html#4490" class="Function">HasGovState-NewEpochState</a> <a id="4516" class="Symbol">:</a> <a id="4518" href="Ledger.Conway.Specification.Gov.html#1531" class="Record">HasGovState</a> <a id="4530" href="Ledger.Conway.Specification.Epoch.html#3362" class="Record">NewEpochState</a>
  <a id="4546" href="Ledger.Conway.Specification.Epoch.html#4490" class="Function">HasGovState-NewEpochState</a> <a id="4572" class="Symbol">.</a><a id="4573" href="Ledger.Conway.Specification.Gov.html#1583" class="Field">GovStateOf</a> <a id="4584" class="Symbol">=</a> <a id="4586" href="Ledger.Conway.Specification.Gov.html#1583" class="Field">GovStateOf</a> <a id="4597" href="Function.Base.html#1134" class="Function Operator">∘</a> <a id="4599" href="Ledger.Conway.Specification.Ledger.html#1193" class="Field">LStateOf</a>

  <a id="HasCertState-NewEpochState"></a><a id="4611" href="Ledger.Conway.Specification.Epoch.html#4611" class="Function">HasCertState-NewEpochState</a> <a id="4638" class="Symbol">:</a> <a id="4640" href="Ledger.Conway.Specification.Certs.html#4864" class="Record">HasCertState</a> <a id="4653" href="Ledger.Conway.Specification.Epoch.html#3362" class="Record">NewEpochState</a>
  <a id="4669" href="Ledger.Conway.Specification.Epoch.html#4611" class="Function">HasCertState-NewEpochState</a> <a id="4696" class="Symbol">.</a><a id="4697" href="Ledger.Conway.Specification.Certs.html#4917" class="Field">CertStateOf</a> <a id="4709" class="Symbol">=</a> <a id="4711" href="Ledger.Conway.Specification.Certs.html#4917" class="Field">CertStateOf</a> <a id="4723" href="Function.Base.html#1134" class="Function Operator">∘</a> <a id="4725" href="Ledger.Conway.Specification.Ledger.html#1193" class="Field">LStateOf</a>

  <a id="HasDReps-NewEpochState"></a><a id="4737" href="Ledger.Conway.Specification.Epoch.html#4737" class="Function">HasDReps-NewEpochState</a> <a id="4760" class="Symbol">:</a> <a id="4762" href="Ledger.Conway.Specification.Certs.html#1550" class="Record">HasDReps</a> <a id="4771" href="Ledger.Conway.Specification.Epoch.html#3362" class="Record">NewEpochState</a>
  <a id="4787" href="Ledger.Conway.Specification.Epoch.html#4737" class="Function">HasDReps-NewEpochState</a> <a id="4810" class="Symbol">.</a><a id="4811" href="Ledger.Conway.Specification.Certs.html#1599" class="Field">DRepsOf</a> <a id="4819" class="Symbol">=</a> <a id="4821" href="Ledger.Conway.Specification.Certs.html#1599" class="Field">DRepsOf</a> <a id="4829" href="Function.Base.html#1134" class="Function Operator">∘</a> <a id="4831" href="Ledger.Conway.Specification.Certs.html#4917" class="Field">CertStateOf</a>

  <a id="HasRewards-NewEpochState"></a><a id="4846" href="Ledger.Conway.Specification.Epoch.html#4846" class="Function">HasRewards-NewEpochState</a> <a id="4871" class="Symbol">:</a> <a id="4873" href="Ledger.Conway.Specification.Certs.html#1790" class="Record">HasRewards</a> <a id="4884" href="Ledger.Conway.Specification.Epoch.html#3362" class="Record">NewEpochState</a>
  <a id="4900" href="Ledger.Conway.Specification.Epoch.html#4846" class="Function">HasRewards-NewEpochState</a> <a id="4925" class="Symbol">.</a><a id="4926" href="Ledger.Conway.Specification.Certs.html#1841" class="Field">RewardsOf</a> <a id="4936" class="Symbol">=</a> <a id="4938" href="Ledger.Conway.Specification.Certs.html#1841" class="Field">RewardsOf</a> <a id="4948" href="Function.Base.html#1134" class="Function Operator">∘</a> <a id="4950" href="Ledger.Conway.Specification.Certs.html#4917" class="Field">CertStateOf</a>

  <a id="HasPParams-NewEpochState"></a><a id="4965" href="Ledger.Conway.Specification.Epoch.html#4965" class="Function">HasPParams-NewEpochState</a> <a id="4990" class="Symbol">:</a> <a id="4992" href="Ledger.Conway.Specification.PParams.html#3491" class="Record">HasPParams</a> <a id="5003" href="Ledger.Conway.Specification.Epoch.html#3362" class="Record">NewEpochState</a>
  <a id="5019" href="Ledger.Conway.Specification.Epoch.html#4965" class="Function">HasPParams-NewEpochState</a> <a id="5044" class="Symbol">.</a><a id="5045" href="Ledger.Conway.Specification.PParams.html#3542" class="Field">PParamsOf</a> <a id="5055" class="Symbol">=</a> <a id="5057" href="Ledger.Conway.Specification.PParams.html#3542" class="Field">PParamsOf</a> <a id="5067" href="Function.Base.html#1134" class="Function Operator">∘</a> <a id="5069" href="Ledger.Conway.Specification.Epoch.html#2092" class="Field">EpochStateOf</a>

  <a id="5085" class="Keyword">unquoteDecl</a> <a id="HasCast-EpochState"></a><a id="5097" href="Ledger.Conway.Specification.Epoch.html#5097" class="Function">HasCast-EpochState</a> <a id="HasCast-NewEpochState"></a><a id="5116" href="Ledger.Conway.Specification.Epoch.html#5116" class="Function">HasCast-NewEpochState</a> <a id="5138" class="Symbol">=</a> <a id="5140" href="stdlib-classes.Class.HasCast.Derive.html#2690" class="Function">derive-HasCast</a>
    <a id="5159" class="Symbol">(</a> <a id="5161" class="Symbol">(</a><a id="5162" class="Keyword">quote</a> <a id="5168" href="Ledger.Conway.Specification.Epoch.html#1835" class="Record">EpochState</a>     <a id="5183" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5185" href="Ledger.Conway.Specification.Epoch.html#5097" class="Function">HasCast-EpochState</a><a id="5203" class="Symbol">)</a>
    <a id="5209" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="5211" href="Data.List.Base.html#4907" class="Function Operator">[</a> <a id="5213" class="Symbol">(</a><a id="5214" class="Keyword">quote</a> <a id="5220" href="Ledger.Conway.Specification.Epoch.html#3362" class="Record">NewEpochState</a>  <a id="5235" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5237" href="Ledger.Conway.Specification.Epoch.html#5116" class="Function">HasCast-NewEpochState</a><a id="5258" class="Symbol">)</a><a id="5259" href="Data.List.Base.html#4907" class="Function Operator">]</a><a id="5260" class="Symbol">)</a>

<a id="toRwdAddr"></a><a id="5263" href="Ledger.Conway.Specification.Epoch.html#5263" class="Function">toRwdAddr</a> <a id="5273" class="Symbol">:</a> <a id="5275" href="Ledger.Core.Specification.Address.html#259" class="Datatype">Credential</a> <a id="5286" class="Symbol">→</a> <a id="5288" href="Ledger.Core.Specification.Address.html#1313" class="Record">RwdAddr</a>
<a id="5296" href="Ledger.Conway.Specification.Epoch.html#5263" class="Function">toRwdAddr</a> <a id="5306" href="Ledger.Conway.Specification.Epoch.html#5306" class="Bound">x</a> <a id="5308" class="Symbol">=</a> <a id="5310" class="Keyword">record</a> <a id="5317" class="Symbol">{</a> <a id="5319" href="Ledger.Core.Specification.Address.html#1346" class="Field">net</a> <a id="5323" class="Symbol">=</a> <a id="5325" href="Ledger.Core.Specification.Epoch.html#2703" class="Function">NetworkId</a> <a id="5335" class="Symbol">;</a> <a id="5337" href="Ledger.Core.Specification.Address.html#1367" class="Field">stake</a> <a id="5343" class="Symbol">=</a> <a id="5345" href="Ledger.Conway.Specification.Epoch.html#5306" class="Bound">x</a> <a id="5347" class="Symbol">}</a>

<a id="getStakeCred"></a><a id="5350" href="Ledger.Conway.Specification.Epoch.html#5350" class="Function">getStakeCred</a> <a id="5363" class="Symbol">:</a> <a id="5365" href="Ledger.Core.Specification.Transaction.html#2529" class="Function">TxOut</a> <a id="5371" class="Symbol">→</a> <a id="5373" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="5379" href="Ledger.Core.Specification.Address.html#259" class="Datatype">Credential</a>
<a id="5390" href="Ledger.Conway.Specification.Epoch.html#5350" class="Function">getStakeCred</a> <a id="5403" class="Symbol">(</a><a id="5404" href="Ledger.Conway.Specification.Epoch.html#5404" class="Bound">a</a> <a id="5406" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5408" class="Symbol">_</a> <a id="5410" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5412" class="Symbol">_</a> <a id="5414" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5416" class="Symbol">_)</a> <a id="5419" class="Symbol">=</a> <a id="5421" href="Ledger.Core.Specification.Address.html#2659" class="Function">stakeCred</a> <a id="5431" href="Ledger.Conway.Specification.Epoch.html#5404" class="Bound">a</a>

<a id="5434" class="Keyword">open</a> <a id="5439" href="Ledger.Core.Specification.Gov.Actions.html#3811" class="Module">GovActionState</a> <a id="5454" class="Keyword">using</a> <a id="5460" class="Symbol">(</a><a id="5461" href="Ledger.Core.Specification.Gov.Actions.html#3878" class="Field">returnAddr</a><a id="5471" class="Symbol">)</a>

<a id="5474" class="Keyword">opaque</a>


  <a id="createRUpd"></a><a id="5485" href="Ledger.Conway.Specification.Epoch.html#5485" class="Function">createRUpd</a> <a id="5496" class="Symbol">:</a> <a id="5498" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a> <a id="5500" class="Symbol">→</a> <a id="5502" href="Ledger.Conway.Specification.Rewards.html#4933" class="Function">BlocksMade</a> <a id="5513" class="Symbol">→</a> <a id="5515" href="Ledger.Conway.Specification.Epoch.html#1835" class="Record">EpochState</a> <a id="5526" class="Symbol">→</a> <a id="5528" href="Ledger.Prelude.Base.html#154" class="Function">Coin</a> <a id="5533" class="Symbol">→</a> <a id="5535" href="Ledger.Conway.Specification.Rewards.html#6276" class="Record">RewardUpdate</a>
  <a id="5550" href="Ledger.Conway.Specification.Epoch.html#5485" class="Function">createRUpd</a> <a id="5561" href="Ledger.Conway.Specification.Epoch.html#5561" class="Bound">slotsPerEpoch</a> <a id="5575" href="Ledger.Conway.Specification.Epoch.html#5575" class="Bound">b</a> <a id="5577" href="Ledger.Conway.Specification.Epoch.html#5577" class="Bound">es</a> <a id="5580" href="Ledger.Conway.Specification.Epoch.html#5580" class="Bound">total</a> <a id="5586" class="Symbol">=</a>
    <a id="5592" class="Keyword">record</a>  <a id="5600" class="Symbol">{</a> <a id="5602" href="Ledger.Conway.Specification.Rewards.html#6313" class="Field">Δt</a> <a id="5605" class="Symbol">=</a> <a id="5607" href="Ledger.Conway.Specification.Epoch.html#6563" class="Function">Δt₁</a>
            <a id="5623" class="Symbol">;</a> <a id="5625" href="Ledger.Conway.Specification.Rewards.html#6316" class="Field">Δr</a> <a id="5628" class="Symbol">=</a> <a id="5630" class="Number">0</a> <a id="5632" href="Interface.TypeClasses.HasSubtract.html#223" class="Field Operator">-</a> <a id="5634" href="Ledger.Conway.Specification.Epoch.html#6549" class="Function">Δr₁</a> <a id="5638" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="5640" href="Ledger.Conway.Specification.Epoch.html#6885" class="Function">Δr₂</a>
            <a id="5656" class="Symbol">;</a> <a id="5658" href="Ledger.Conway.Specification.Rewards.html#6319" class="Field">Δf</a> <a id="5661" class="Symbol">=</a> <a id="5663" class="Number">0</a> <a id="5665" href="Interface.TypeClasses.HasSubtract.html#223" class="Field Operator">-</a> <a id="5667" href="Ledger.Conway.Specification.Epoch.html#414" class="InductiveConstructor">pos</a> <a id="5671" href="Ledger.Conway.Specification.Epoch.html#6050" class="Function">feeSS</a>
            <a id="5689" class="Symbol">;</a> <a id="5691" href="Ledger.Conway.Specification.Rewards.html#6339" class="Field">rs</a> <a id="5694" class="Symbol">=</a> <a id="5696" href="Ledger.Conway.Specification.Epoch.html#6790" class="Function">rs</a>


            <a id="5713" class="Symbol">;</a> <a id="5715" href="Ledger.Conway.Specification.Rewards.html#6369" class="Field">flowConservation</a> <a id="5732" class="Symbol">=</a> <a id="5734" href="Ledger.Conway.Specification.Epoch.html#7178" class="Function">flowConservation</a>
            <a id="5763" class="Symbol">;</a> <a id="5765" href="Ledger.Conway.Specification.Rewards.html#6432" class="Field">Δt-nonnegative</a> <a id="5780" class="Symbol">=</a> <a id="5782" href="Ledger.Conway.Specification.Epoch.html#8316" class="Function">Δt-nonneg</a>
            <a id="5804" class="Symbol">;</a> <a id="5806" href="Ledger.Conway.Specification.Rewards.html#6463" class="Field">Δf-nonpositive</a> <a id="5821" class="Symbol">=</a> <a id="5823" href="Ledger.Conway.Specification.Epoch.html#8498" class="Function">Δf-nonpos</a>


            <a id="5847" class="Symbol">}</a>
    <a id="5853" class="Keyword">where</a>
      <a id="5865" href="Ledger.Conway.Specification.Epoch.html#5865" class="Function">prevPp</a> <a id="5872" class="Symbol">:</a> <a id="5874" href="Ledger.Conway.Specification.PParams.html#1687" class="Record">PParams</a>
      <a id="5888" href="Ledger.Conway.Specification.Epoch.html#5865" class="Function">prevPp</a> <a id="5895" class="Symbol">=</a> <a id="5897" href="Ledger.Conway.Specification.PParams.html#3542" class="Field">PParamsOf</a> <a id="5907" href="Ledger.Conway.Specification.Epoch.html#5577" class="Bound">es</a>

      <a id="5917" href="Ledger.Conway.Specification.Epoch.html#5917" class="Function">reserves</a> <a id="5926" class="Symbol">:</a> <a id="5928" href="Ledger.Prelude.Base.html#191" class="Function">Reserves</a>
      <a id="5943" href="Ledger.Conway.Specification.Epoch.html#5917" class="Function">reserves</a> <a id="5952" class="Symbol">=</a> <a id="5954" href="Ledger.Prelude.Base.html#773" class="Field">ReservesOf</a> <a id="5965" href="Ledger.Conway.Specification.Epoch.html#5577" class="Bound">es</a>

      <a id="5975" href="Ledger.Conway.Specification.Epoch.html#5975" class="Function">pstakego</a> <a id="5984" class="Symbol">:</a> <a id="5986" href="Ledger.Conway.Specification.Rewards.html#6499" class="Record">Snapshot</a>
      <a id="6001" href="Ledger.Conway.Specification.Epoch.html#5975" class="Function">pstakego</a> <a id="6010" class="Symbol">=</a> <a id="6012" class="Symbol">(</a><a id="6013" href="Ledger.Conway.Specification.Rewards.html#7890" class="Field">SnapshotsOf</a> <a id="6025" href="Ledger.Conway.Specification.Epoch.html#5577" class="Bound">es</a><a id="6027" class="Symbol">)</a> <a id="6029" class="Symbol">.</a><a id="6030" href="Ledger.Conway.Specification.Rewards.html#7789" class="Field">Snapshots.go</a>

      <a id="6050" href="Ledger.Conway.Specification.Epoch.html#6050" class="Function">feeSS</a> <a id="6056" class="Symbol">:</a> <a id="6058" href="Ledger.Prelude.Base.html#186" class="Function">Fees</a>
      <a id="6069" href="Ledger.Conway.Specification.Epoch.html#6050" class="Function">feeSS</a> <a id="6075" class="Symbol">=</a> <a id="6077" href="Ledger.Prelude.Base.html#669" class="Field">FeesOf</a> <a id="6084" class="Symbol">(</a><a id="6085" href="Ledger.Conway.Specification.Rewards.html#7890" class="Field">SnapshotsOf</a> <a id="6097" href="Ledger.Conway.Specification.Epoch.html#5577" class="Bound">es</a><a id="6099" class="Symbol">)</a>

      <a id="6108" href="Ledger.Conway.Specification.Epoch.html#6108" class="Function">stake</a> <a id="6114" class="Symbol">:</a> <a id="6116" href="Ledger.Conway.Specification.Certs.html#1358" class="Function">Stake</a>
      <a id="6128" href="Ledger.Conway.Specification.Epoch.html#6108" class="Function">stake</a> <a id="6134" class="Symbol">=</a> <a id="6136" href="Ledger.Conway.Specification.Certs.html#1922" class="Field">StakeOf</a> <a id="6144" href="Ledger.Conway.Specification.Epoch.html#5975" class="Function">pstakego</a>

      <a id="6160" href="Ledger.Conway.Specification.Epoch.html#6160" class="Function">delegs</a> <a id="6167" class="Symbol">:</a> <a id="6169" href="Ledger.Conway.Specification.Certs.html#1398" class="Function">StakeDelegs</a>
      <a id="6187" href="Ledger.Conway.Specification.Epoch.html#6160" class="Function">delegs</a> <a id="6194" class="Symbol">=</a> <a id="6196" href="Ledger.Conway.Specification.Certs.html#2006" class="Field">StakeDelegsOf</a> <a id="6210" href="Ledger.Conway.Specification.Epoch.html#5975" class="Function">pstakego</a>

      <a id="6226" href="Ledger.Conway.Specification.Epoch.html#6226" class="Function">poolParams</a> <a id="6237" class="Symbol">:</a> <a id="6239" href="Ledger.Conway.Specification.Certs.html#1222" class="Function">Pools</a>
      <a id="6251" href="Ledger.Conway.Specification.Epoch.html#6226" class="Function">poolParams</a> <a id="6262" class="Symbol">=</a> <a id="6264" href="Ledger.Conway.Specification.Certs.html#1676" class="Field">PoolsOf</a> <a id="6272" href="Ledger.Conway.Specification.Epoch.html#5975" class="Function">pstakego</a>

      <a id="6288" href="Ledger.Conway.Specification.Epoch.html#6288" class="Function">blocksMade</a> <a id="6299" class="Symbol">:</a> <a id="6301" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a>
      <a id="6309" href="Ledger.Conway.Specification.Epoch.html#6288" class="Function">blocksMade</a> <a id="6320" class="Symbol">=</a> <a id="6322" href="abstract-set-theory.FiniteSetTheory.html#4312" class="Function">∑[</a> <a id="6325" href="Ledger.Conway.Specification.Epoch.html#6325" class="Bound">m</a> <a id="6327" href="abstract-set-theory.FiniteSetTheory.html#4312" class="Function">←</a> <a id="6329" href="Ledger.Conway.Specification.Epoch.html#5575" class="Bound">b</a> <a id="6331" href="abstract-set-theory.FiniteSetTheory.html#4312" class="Function">]</a> <a id="6333" href="Ledger.Conway.Specification.Epoch.html#6325" class="Bound">m</a>

      <a id="6342" href="Ledger.Conway.Specification.Epoch.html#6342" class="Function">ρ</a> <a id="6344" href="Ledger.Conway.Specification.Epoch.html#6344" class="Function">η</a> <a id="6346" href="Ledger.Conway.Specification.Epoch.html#6346" class="Function">τ</a> <a id="6348" class="Symbol">:</a> <a id="6350" href="Data.Rational.Base.html#1421" class="Record">ℚ</a>
      <a id="6358" href="Ledger.Conway.Specification.Epoch.html#6342" class="Function">ρ</a> <a id="6360" class="Symbol">=</a> <a id="6362" href="Ledger.Prelude.Numeric.UnitInterval.html#1989" class="Function">fromUnitInterval</a> <a id="6379" class="Symbol">(</a><a id="6380" href="Ledger.Conway.Specification.Epoch.html#5865" class="Function">prevPp</a> <a id="6387" class="Symbol">.</a><a id="6388" href="Ledger.Conway.Specification.PParams.html#2283" class="Field">PParams.monetaryExpansion</a><a id="6413" class="Symbol">)</a>
      <a id="6421" href="Ledger.Conway.Specification.Epoch.html#6344" class="Function">η</a> <a id="6423" class="Symbol">=</a> <a id="6425" href="Ledger.Conway.Specification.Epoch.html#1819" class="Function">fromℕ</a> <a id="6431" href="Ledger.Conway.Specification.Epoch.html#6288" class="Function">blocksMade</a> <a id="6442" href="Ledger.Prelude.html#2064" class="Function Operator">÷₀</a> <a id="6445" class="Symbol">(</a><a id="6446" href="Ledger.Conway.Specification.Epoch.html#1819" class="Function">fromℕ</a> <a id="6452" href="Ledger.Conway.Specification.Epoch.html#5561" class="Bound">slotsPerEpoch</a> <a id="6466" href="Data.Rational.Base.html#6394" class="Function Operator">*</a> <a id="6468" href="Ledger.Core.Specification.Epoch.html#2485" class="Function">ActiveSlotCoeff</a><a id="6483" class="Symbol">)</a>
      <a id="6491" href="Ledger.Conway.Specification.Epoch.html#6346" class="Function">τ</a> <a id="6493" class="Symbol">=</a> <a id="6495" href="Ledger.Prelude.Numeric.UnitInterval.html#1989" class="Function">fromUnitInterval</a> <a id="6512" class="Symbol">(</a><a id="6513" href="Ledger.Conway.Specification.Epoch.html#5865" class="Function">prevPp</a> <a id="6520" class="Symbol">.</a><a id="6521" href="Ledger.Conway.Specification.PParams.html#2353" class="Field">PParams.treasuryCut</a><a id="6540" class="Symbol">)</a>

      <a id="6549" href="Ledger.Conway.Specification.Epoch.html#6549" class="Function">Δr₁</a> <a id="6553" href="Ledger.Conway.Specification.Epoch.html#6553" class="Function">rewardPot</a> <a id="6563" href="Ledger.Conway.Specification.Epoch.html#6563" class="Function">Δt₁</a> <a id="6567" href="Ledger.Conway.Specification.Epoch.html#6567" class="Function">R</a> <a id="6569" class="Symbol">:</a> <a id="6571" href="Agda.Builtin.Int.html#245" class="Datatype">ℤ</a>
      <a id="6579" href="Ledger.Conway.Specification.Epoch.html#6549" class="Function">Δr₁</a> <a id="6583" class="Symbol">=</a> <a id="6585" href="Data.Rational.Base.html#7195" class="Function">floor</a> <a id="6591" class="Symbol">(</a><a id="6592" class="Number">1</a> <a id="6594" href="Data.Rational.Base.html#6933" class="Function Operator">⊓</a> <a id="6596" href="Ledger.Conway.Specification.Epoch.html#6344" class="Function">η</a> <a id="6598" href="Data.Rational.Base.html#6394" class="Function Operator">*</a> <a id="6600" href="Ledger.Conway.Specification.Epoch.html#6342" class="Function">ρ</a> <a id="6602" href="Data.Rational.Base.html#6394" class="Function Operator">*</a> <a id="6604" href="Ledger.Conway.Specification.Epoch.html#1819" class="Function">fromℕ</a> <a id="6610" href="Ledger.Conway.Specification.Epoch.html#5917" class="Function">reserves</a><a id="6618" class="Symbol">)</a>
      <a id="6626" href="Ledger.Conway.Specification.Epoch.html#6553" class="Function">rewardPot</a> <a id="6636" class="Symbol">=</a> <a id="6638" href="Ledger.Conway.Specification.Epoch.html#414" class="InductiveConstructor">pos</a> <a id="6642" href="Ledger.Conway.Specification.Epoch.html#6050" class="Function">feeSS</a> <a id="6648" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="6650" href="Ledger.Conway.Specification.Epoch.html#6549" class="Function">Δr₁</a>
      <a id="6660" href="Ledger.Conway.Specification.Epoch.html#6563" class="Function">Δt₁</a> <a id="6664" class="Symbol">=</a> <a id="6666" href="Data.Rational.Base.html#7195" class="Function">floor</a> <a id="6672" class="Symbol">(</a><a id="6673" href="Data.Rational.Literals.html#613" class="Function">fromℤ</a> <a id="6679" href="Ledger.Conway.Specification.Epoch.html#6553" class="Function">rewardPot</a> <a id="6689" href="Data.Rational.Base.html#6394" class="Function Operator">*</a> <a id="6691" href="Ledger.Conway.Specification.Epoch.html#6346" class="Function">τ</a><a id="6692" class="Symbol">)</a>
      <a id="6700" href="Ledger.Conway.Specification.Epoch.html#6567" class="Function">R</a> <a id="6702" class="Symbol">=</a> <a id="6704" href="Ledger.Conway.Specification.Epoch.html#6553" class="Function">rewardPot</a> <a id="6714" href="Interface.TypeClasses.HasSubtract.html#223" class="Field Operator">-</a> <a id="6716" href="Ledger.Conway.Specification.Epoch.html#6563" class="Function">Δt₁</a>

      <a id="6727" href="Ledger.Conway.Specification.Epoch.html#6727" class="Function">circulation</a> <a id="6739" class="Symbol">:</a> <a id="6741" href="Ledger.Prelude.Base.html#154" class="Function">Coin</a>
      <a id="6752" href="Ledger.Conway.Specification.Epoch.html#6727" class="Function">circulation</a> <a id="6764" class="Symbol">=</a> <a id="6766" href="Ledger.Conway.Specification.Epoch.html#5580" class="Bound">total</a> <a id="6772" href="Interface.TypeClasses.HasSubtract.html#223" class="Field Operator">-</a> <a id="6774" href="Ledger.Conway.Specification.Epoch.html#5917" class="Function">reserves</a>

      <a id="6790" href="Ledger.Conway.Specification.Epoch.html#6790" class="Function">rs</a> <a id="6793" class="Symbol">:</a> <a id="6795" href="Ledger.Conway.Specification.Certs.html#1314" class="Function">Rewards</a>
      <a id="6809" href="Ledger.Conway.Specification.Epoch.html#6790" class="Function">rs</a> <a id="6812" class="Symbol">=</a> <a id="6814" href="Ledger.Conway.Specification.Rewards.html#5424" class="Function">reward</a> <a id="6821" href="Ledger.Conway.Specification.Epoch.html#5865" class="Function">prevPp</a> <a id="6828" href="Ledger.Conway.Specification.Epoch.html#5575" class="Bound">b</a> <a id="6830" class="Symbol">(</a><a id="6831" href="Prelude.html#3280" class="Function">posPart</a> <a id="6839" href="Ledger.Conway.Specification.Epoch.html#6567" class="Function">R</a><a id="6840" class="Symbol">)</a> <a id="6842" href="Ledger.Conway.Specification.Epoch.html#6226" class="Function">poolParams</a> <a id="6853" href="Ledger.Conway.Specification.Epoch.html#6108" class="Function">stake</a> <a id="6859" href="Ledger.Conway.Specification.Epoch.html#6160" class="Function">delegs</a> <a id="6866" href="Ledger.Conway.Specification.Epoch.html#6727" class="Function">circulation</a>

      <a id="6885" href="Ledger.Conway.Specification.Epoch.html#6885" class="Function">Δr₂</a> <a id="6889" class="Symbol">:</a> <a id="6891" href="Agda.Builtin.Int.html#245" class="Datatype">ℤ</a>
      <a id="6899" href="Ledger.Conway.Specification.Epoch.html#6885" class="Function">Δr₂</a> <a id="6903" class="Symbol">=</a> <a id="6905" href="Ledger.Conway.Specification.Epoch.html#6567" class="Function">R</a> <a id="6907" href="Interface.TypeClasses.HasSubtract.html#223" class="Field Operator">-</a> <a id="6909" href="Ledger.Conway.Specification.Epoch.html#414" class="InductiveConstructor">pos</a> <a id="6913" class="Symbol">(</a><a id="6914" href="abstract-set-theory.FiniteSetTheory.html#4312" class="Function">∑[</a> <a id="6917" href="Ledger.Conway.Specification.Epoch.html#6917" class="Bound">c</a> <a id="6919" href="abstract-set-theory.FiniteSetTheory.html#4312" class="Function">←</a> <a id="6921" href="Ledger.Conway.Specification.Epoch.html#6790" class="Function">rs</a> <a id="6924" href="abstract-set-theory.FiniteSetTheory.html#4312" class="Function">]</a> <a id="6926" href="Ledger.Conway.Specification.Epoch.html#6917" class="Bound">c</a><a id="6927" class="Symbol">)</a>


      <a id="6937" class="Comment">-- Proofs</a>
      <a id="6953" class="Comment">-- Note: Overloading of + and - seems to interfere with the ring solver.</a>
      <a id="7032" href="Ledger.Conway.Specification.Epoch.html#7032" class="Function">lemmaFlow</a> <a id="7042" class="Symbol">:</a> <a id="7044" class="Symbol">∀</a> <a id="7046" class="Symbol">(</a><a id="7047" href="Ledger.Conway.Specification.Epoch.html#7047" class="Bound">t₁</a> <a id="7050" href="Ledger.Conway.Specification.Epoch.html#7050" class="Bound">r₁</a> <a id="7053" href="Ledger.Conway.Specification.Epoch.html#7053" class="Bound">f</a> <a id="7055" href="Ledger.Conway.Specification.Epoch.html#7055" class="Bound">z</a> <a id="7057" class="Symbol">:</a> <a id="7059" href="Agda.Builtin.Int.html#245" class="Datatype">ℤ</a><a id="7060" class="Symbol">)</a>
        <a id="7070" class="Symbol">→</a> <a id="7072" class="Symbol">(</a><a id="7073" href="Ledger.Conway.Specification.Epoch.html#7047" class="Bound">t₁</a> <a id="7076" href="Data.Integer.Base.html#5064" class="Function Operator">ℤ.+</a> <a id="7080" class="Symbol">(</a><a id="7081" class="Number">0</a> <a id="7083" href="Data.Integer.Base.html#5245" class="Function Operator">ℤ.-</a> <a id="7087" href="Ledger.Conway.Specification.Epoch.html#7050" class="Bound">r₁</a> <a id="7090" href="Data.Integer.Base.html#5064" class="Function Operator">ℤ.+</a> <a id="7094" class="Symbol">((</a><a id="7096" href="Ledger.Conway.Specification.Epoch.html#7053" class="Bound">f</a> <a id="7098" href="Data.Integer.Base.html#5064" class="Function Operator">ℤ.+</a> <a id="7102" href="Ledger.Conway.Specification.Epoch.html#7050" class="Bound">r₁</a> <a id="7105" href="Data.Integer.Base.html#5245" class="Function Operator">ℤ.-</a> <a id="7109" href="Ledger.Conway.Specification.Epoch.html#7047" class="Bound">t₁</a><a id="7111" class="Symbol">)</a> <a id="7113" href="Data.Integer.Base.html#5245" class="Function Operator">ℤ.-</a> <a id="7117" href="Ledger.Conway.Specification.Epoch.html#7055" class="Bound">z</a><a id="7118" class="Symbol">))</a> <a id="7121" href="Data.Integer.Base.html#5064" class="Function Operator">ℤ.+</a> <a id="7125" class="Symbol">(</a><a id="7126" class="Number">0</a> <a id="7128" href="Data.Integer.Base.html#5245" class="Function Operator">ℤ.-</a> <a id="7132" href="Ledger.Conway.Specification.Epoch.html#7053" class="Bound">f</a><a id="7133" class="Symbol">)</a> <a id="7135" href="Data.Integer.Base.html#5064" class="Function Operator">ℤ.+</a> <a id="7139" href="Ledger.Conway.Specification.Epoch.html#7055" class="Bound">z</a><a id="7140" class="Symbol">)</a> <a id="7142" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="7144" class="Number">0</a>
      <a id="7152" href="Ledger.Conway.Specification.Epoch.html#7032" class="Function">lemmaFlow</a> <a id="7162" class="Symbol">=</a> <a id="7164" href="Data.Integer.Tactic.RingSolver.html#1200" class="Macro">solve-∀</a>
      <a id="7178" href="Ledger.Conway.Specification.Epoch.html#7178" class="Function">flowConservation</a> <a id="7195" class="Symbol">:</a>
        <a id="7205" class="Keyword">let</a> <a id="7209" href="Ledger.Conway.Specification.Epoch.html#7209" class="Bound">t₁</a> <a id="7212" class="Symbol">=</a> <a id="7214" href="Ledger.Conway.Specification.Epoch.html#6563" class="Function">Δt₁</a>
            <a id="7230" href="Ledger.Conway.Specification.Epoch.html#7230" class="Bound">r₁</a> <a id="7233" class="Symbol">=</a> <a id="7235" href="Ledger.Conway.Specification.Epoch.html#6549" class="Function">Δr₁</a>
            <a id="7251" href="Ledger.Conway.Specification.Epoch.html#7251" class="Bound">f</a>  <a id="7254" class="Symbol">=</a> <a id="7256" href="Ledger.Conway.Specification.Epoch.html#414" class="InductiveConstructor">pos</a> <a id="7260" href="Ledger.Conway.Specification.Epoch.html#6050" class="Function">feeSS</a>
            <a id="7278" href="Ledger.Conway.Specification.Epoch.html#7278" class="Bound">z</a>  <a id="7281" class="Symbol">=</a> <a id="7283" href="Ledger.Conway.Specification.Epoch.html#414" class="InductiveConstructor">pos</a> <a id="7287" class="Symbol">(</a><a id="7288" href="abstract-set-theory.FiniteSetTheory.html#4312" class="Function">∑[</a> <a id="7291" href="Ledger.Conway.Specification.Epoch.html#7291" class="Bound">c</a> <a id="7293" href="abstract-set-theory.FiniteSetTheory.html#4312" class="Function">←</a> <a id="7295" href="Ledger.Conway.Specification.Epoch.html#6790" class="Function">rs</a> <a id="7298" href="abstract-set-theory.FiniteSetTheory.html#4312" class="Function">]</a> <a id="7300" href="Ledger.Conway.Specification.Epoch.html#7291" class="Bound">c</a><a id="7301" class="Symbol">)</a>
         <a id="7312" class="Keyword">in</a>
            <a id="7327" class="Symbol">(</a><a id="7328" href="Ledger.Conway.Specification.Epoch.html#7209" class="Bound">t₁</a> <a id="7331" href="Data.Integer.Base.html#5064" class="Function Operator">ℤ.+</a> <a id="7335" class="Symbol">(</a><a id="7336" class="Number">0</a> <a id="7338" href="Data.Integer.Base.html#5245" class="Function Operator">ℤ.-</a> <a id="7342" href="Ledger.Conway.Specification.Epoch.html#7230" class="Bound">r₁</a> <a id="7345" href="Data.Integer.Base.html#5064" class="Function Operator">ℤ.+</a> <a id="7349" class="Symbol">((</a><a id="7351" href="Ledger.Conway.Specification.Epoch.html#7251" class="Bound">f</a> <a id="7353" href="Data.Integer.Base.html#5064" class="Function Operator">ℤ.+</a> <a id="7357" href="Ledger.Conway.Specification.Epoch.html#7230" class="Bound">r₁</a> <a id="7360" href="Data.Integer.Base.html#5245" class="Function Operator">ℤ.-</a> <a id="7364" href="Ledger.Conway.Specification.Epoch.html#7209" class="Bound">t₁</a><a id="7366" class="Symbol">)</a> <a id="7368" href="Data.Integer.Base.html#5245" class="Function Operator">ℤ.-</a> <a id="7372" href="Ledger.Conway.Specification.Epoch.html#7278" class="Bound">z</a><a id="7373" class="Symbol">))</a> <a id="7376" href="Data.Integer.Base.html#5064" class="Function Operator">ℤ.+</a> <a id="7380" class="Symbol">(</a><a id="7381" class="Number">0</a> <a id="7383" href="Data.Integer.Base.html#5245" class="Function Operator">ℤ.-</a> <a id="7387" href="Ledger.Conway.Specification.Epoch.html#7251" class="Bound">f</a><a id="7388" class="Symbol">)</a> <a id="7390" href="Data.Integer.Base.html#5064" class="Function Operator">ℤ.+</a> <a id="7394" href="Ledger.Conway.Specification.Epoch.html#7278" class="Bound">z</a><a id="7395" class="Symbol">)</a> <a id="7397" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="7399" class="Number">0</a>
      <a id="7407" href="Ledger.Conway.Specification.Epoch.html#7178" class="Function">flowConservation</a> <a id="7424" class="Symbol">=</a> <a id="7426" href="Ledger.Conway.Specification.Epoch.html#7032" class="Function">lemmaFlow</a> <a id="7436" href="Ledger.Conway.Specification.Epoch.html#6563" class="Function">Δt₁</a> <a id="7440" href="Ledger.Conway.Specification.Epoch.html#6549" class="Function">Δr₁</a> <a id="7444" class="Symbol">(</a><a id="7445" href="Ledger.Conway.Specification.Epoch.html#414" class="InductiveConstructor">pos</a> <a id="7449" href="Ledger.Conway.Specification.Epoch.html#6050" class="Function">feeSS</a><a id="7454" class="Symbol">)</a> <a id="7456" class="Symbol">(</a><a id="7457" href="Ledger.Conway.Specification.Epoch.html#414" class="InductiveConstructor">pos</a> <a id="7461" class="Symbol">(</a><a id="7462" href="abstract-set-theory.FiniteSetTheory.html#4312" class="Function">∑[</a> <a id="7465" href="Ledger.Conway.Specification.Epoch.html#7465" class="Bound">c</a> <a id="7467" href="abstract-set-theory.FiniteSetTheory.html#4312" class="Function">←</a> <a id="7469" href="Ledger.Conway.Specification.Epoch.html#6790" class="Function">rs</a> <a id="7472" href="abstract-set-theory.FiniteSetTheory.html#4312" class="Function">]</a> <a id="7474" href="Ledger.Conway.Specification.Epoch.html#7465" class="Bound">c</a><a id="7475" class="Symbol">))</a>

      <a id="7485" href="Ledger.Conway.Specification.Epoch.html#7485" class="Function">÷₀-0≤⇒0≤</a> <a id="7494" class="Symbol">:</a> <a id="7496" class="Symbol">∀</a> <a id="7498" class="Symbol">(</a><a id="7499" href="Ledger.Conway.Specification.Epoch.html#7499" class="Bound">x</a> <a id="7501" href="Ledger.Conway.Specification.Epoch.html#7501" class="Bound">y</a> <a id="7503" class="Symbol">:</a> <a id="7505" href="Data.Rational.Base.html#1421" class="Record">ℚ</a><a id="7506" class="Symbol">)</a> <a id="7508" class="Symbol">→</a> <a id="7510" class="Number">0</a> <a id="7512" href="Class.HasOrder.Core.html#613" class="Field Operator">≤</a> <a id="7514" href="Ledger.Conway.Specification.Epoch.html#7499" class="Bound">x</a> <a id="7516" class="Symbol">→</a> <a id="7518" class="Number">0</a> <a id="7520" href="Class.HasOrder.Core.html#613" class="Field Operator">≤</a> <a id="7522" href="Ledger.Conway.Specification.Epoch.html#7501" class="Bound">y</a> <a id="7524" class="Symbol">→</a> <a id="7526" class="Number">0</a> <a id="7528" href="Class.HasOrder.Core.html#613" class="Field Operator">≤</a> <a id="7530" class="Symbol">(</a><a id="7531" href="Ledger.Conway.Specification.Epoch.html#7499" class="Bound">x</a> <a id="7533" href="Ledger.Prelude.html#2064" class="Function Operator">÷₀</a> <a id="7536" href="Ledger.Conway.Specification.Epoch.html#7501" class="Bound">y</a><a id="7537" class="Symbol">)</a>
      <a id="7545" href="Ledger.Conway.Specification.Epoch.html#7485" class="Function">÷₀-0≤⇒0≤</a> <a id="7554" href="Ledger.Conway.Specification.Epoch.html#7554" class="Bound">x</a> <a id="7556" href="Ledger.Conway.Specification.Epoch.html#7556" class="Bound">y</a> <a id="7558" href="Ledger.Conway.Specification.Epoch.html#7558" class="Bound">0≤x</a> <a id="7562" href="Ledger.Conway.Specification.Epoch.html#7562" class="Bound">0≤y</a> <a id="7566" class="Keyword">with</a> <a id="7571" href="Ledger.Conway.Specification.Epoch.html#7556" class="Bound">y</a> <a id="7573" href="Data.Rational.Properties.html#4152" class="Function Operator">≟</a> <a id="7575" class="Number">0</a>
      <a id="7583" class="Symbol">...</a> <a id="7587" class="Symbol">|</a> <a id="7589" class="Symbol">(</a><a id="7590" href="Relation.Nullary.Decidable.Core.html#2099" class="InductiveConstructor">yes</a> <a id="7594" href="Ledger.Conway.Specification.Epoch.html#7594" class="Bound">y≡0</a><a id="7597" class="Symbol">)</a> <a id="7599" class="Symbol">=</a> <a id="7601" href="Data.Rational.Properties.html#27061" class="Function">nonNegative⁻¹</a> <a id="7615" class="Number">0</a>
      <a id="7623" class="Symbol">...</a> <a id="7627" class="Symbol">|</a> <a id="7629" class="Symbol">(</a><a id="7630" href="Relation.Nullary.Decidable.Core.html#2136" class="InductiveConstructor">no</a> <a id="7633" href="Ledger.Conway.Specification.Epoch.html#7633" class="Bound">y≢0</a><a id="7636" class="Symbol">)</a>  <a id="7639" class="Symbol">=</a> <a id="7641" href="stdlib.Data.Rational.Properties.html#2865" class="Function">÷-0≤⇒0≤</a> <a id="7649" class="Bound">x</a> <a id="7651" class="Bound">y</a> <a id="7653" class="Symbol">{{</a><a id="7655" href="Data.Rational.Base.html#4971" class="Function">≢-nonZero</a> <a id="7665" href="Ledger.Conway.Specification.Epoch.html#7633" class="Bound">y≢0</a><a id="7668" class="Symbol">}}</a> <a id="7671" class="Bound">0≤x</a> <a id="7675" class="Bound">0≤y</a>

      <a id="7686" href="Ledger.Conway.Specification.Epoch.html#7686" class="Function">η-nonneg</a> <a id="7695" class="Symbol">:</a> <a id="7697" class="Number">0</a> <a id="7699" href="Class.HasOrder.Core.html#613" class="Field Operator">≤</a> <a id="7701" href="Ledger.Conway.Specification.Epoch.html#6344" class="Function">η</a>
      <a id="7709" href="Ledger.Conway.Specification.Epoch.html#7686" class="Function">η-nonneg</a> <a id="7718" class="Symbol">=</a> <a id="7720" href="Ledger.Conway.Specification.Epoch.html#7485" class="Function">÷₀-0≤⇒0≤</a> <a id="7729" class="Symbol">_</a> <a id="7731" class="Symbol">_</a> <a id="7733" class="Symbol">(</a><a id="7734" href="stdlib.Data.Rational.Properties.html#2275" class="Function">fromℕ-0≤</a> <a id="7743" href="Ledger.Conway.Specification.Epoch.html#6288" class="Function">blocksMade</a><a id="7753" class="Symbol">)</a>
        <a id="7763" class="Symbol">(</a><a id="7764" href="stdlib.Data.Rational.Properties.html#2409" class="Function">*-0≤⇒0≤</a> <a id="7772" class="Symbol">_</a> <a id="7774" class="Symbol">_</a>
          <a id="7786" class="Symbol">(</a><a id="7787" href="stdlib.Data.Rational.Properties.html#2275" class="Function">fromℕ-0≤</a> <a id="7796" href="Ledger.Conway.Specification.Epoch.html#5561" class="Bound">slotsPerEpoch</a><a id="7809" class="Symbol">)</a>
          <a id="7821" class="Symbol">(</a><a id="7822" href="Data.Rational.Properties.html#27061" class="Function">nonNegative⁻¹</a> <a id="7836" href="Ledger.Core.Specification.Epoch.html#2485" class="Function">ActiveSlotCoeff</a> <a id="7852" class="Symbol">{{</a><a id="7854" href="Data.Rational.Properties.html#7555" class="Function">pos⇒nonNeg</a> <a id="7865" href="Ledger.Core.Specification.Epoch.html#2485" class="Function">ActiveSlotCoeff</a><a id="7880" class="Symbol">}}))</a>

      <a id="7892" href="Ledger.Conway.Specification.Epoch.html#7892" class="Function">min1η-nonneg</a> <a id="7905" class="Symbol">:</a> <a id="7907" class="Number">0</a> <a id="7909" href="Class.HasOrder.Core.html#613" class="Field Operator">≤</a> <a id="7911" class="Number">1</a> <a id="7913" href="Data.Rational.Base.html#6933" class="Function Operator">⊓</a> <a id="7915" href="Ledger.Conway.Specification.Epoch.html#6344" class="Function">η</a>
      <a id="7923" href="Ledger.Conway.Specification.Epoch.html#7892" class="Function">min1η-nonneg</a> <a id="7936" class="Symbol">=</a> <a id="7938" href="Algebra.Construct.NaturalChoice.MinOp.html#7120" class="Function">⊓-glb</a> <a id="7944" class="Symbol">(</a><a id="7945" href="Data.Rational.Properties.html#27061" class="Function">nonNegative⁻¹</a> <a id="7959" class="Number">1</a><a id="7960" class="Symbol">)</a> <a id="7962" href="Ledger.Conway.Specification.Epoch.html#7686" class="Function">η-nonneg</a>

      <a id="7978" href="Ledger.Conway.Specification.Epoch.html#7978" class="Function">Δr₁-nonneg</a> <a id="7989" class="Symbol">:</a> <a id="7991" class="Number">0</a> <a id="7993" href="Class.HasOrder.Core.html#613" class="Field Operator">≤</a> <a id="7995" href="Ledger.Conway.Specification.Epoch.html#6549" class="Function">Δr₁</a>
      <a id="8005" href="Ledger.Conway.Specification.Epoch.html#7978" class="Function">Δr₁-nonneg</a> <a id="8016" class="Symbol">=</a> <a id="8018" href="stdlib.Data.Rational.Properties.html#1631" class="Function">0≤⇒0≤floor</a> <a id="8029" class="Symbol">_</a>
        <a id="8039" class="Symbol">(</a><a id="8040" href="stdlib.Data.Rational.Properties.html#2409" class="Function">*-0≤⇒0≤</a> <a id="8048" class="Symbol">(</a><a id="8049" class="Number">1</a> <a id="8051" href="Data.Rational.Base.html#6933" class="Function Operator">⊓</a> <a id="8053" href="Ledger.Conway.Specification.Epoch.html#6344" class="Function">η</a> <a id="8055" href="Data.Rational.Base.html#6394" class="Function Operator">*</a> <a id="8057" href="Ledger.Conway.Specification.Epoch.html#6342" class="Function">ρ</a><a id="8058" class="Symbol">)</a> <a id="8060" class="Symbol">(</a><a id="8061" href="Ledger.Conway.Specification.Epoch.html#1819" class="Function">fromℕ</a> <a id="8067" href="Ledger.Conway.Specification.Epoch.html#5917" class="Function">reserves</a><a id="8075" class="Symbol">)</a>
          <a id="8087" class="Symbol">(</a><a id="8088" href="Ledger.Prelude.Numeric.UnitInterval.html#3337" class="Function">UnitInterval-*-0≤</a> <a id="8106" class="Symbol">(</a><a id="8107" class="Number">1</a> <a id="8109" href="Data.Rational.Base.html#6933" class="Function Operator">⊓</a> <a id="8111" href="Ledger.Conway.Specification.Epoch.html#6344" class="Function">η</a><a id="8112" class="Symbol">)</a> <a id="8114" class="Symbol">(</a><a id="8115" href="Ledger.Conway.Specification.Epoch.html#5865" class="Function">prevPp</a> <a id="8122" class="Symbol">.</a><a id="8123" href="Ledger.Conway.Specification.PParams.html#2283" class="Field">PParams.monetaryExpansion</a><a id="8148" class="Symbol">)</a> <a id="8150" href="Ledger.Conway.Specification.Epoch.html#7892" class="Function">min1η-nonneg</a><a id="8162" class="Symbol">)</a>
          <a id="8174" class="Symbol">(</a><a id="8175" href="stdlib.Data.Rational.Properties.html#2275" class="Function">fromℕ-0≤</a> <a id="8184" href="Ledger.Conway.Specification.Epoch.html#5917" class="Function">reserves</a><a id="8192" class="Symbol">))</a>

      <a id="8202" href="Ledger.Conway.Specification.Epoch.html#8202" class="Function">rewardPot-nonneg</a> <a id="8219" class="Symbol">:</a> <a id="8221" class="Number">0</a> <a id="8223" href="Class.HasOrder.Core.html#613" class="Field Operator">≤</a> <a id="8225" href="Ledger.Conway.Specification.Epoch.html#6553" class="Function">rewardPot</a>
      <a id="8241" href="Ledger.Conway.Specification.Epoch.html#8202" class="Function">rewardPot-nonneg</a> <a id="8258" class="Symbol">=</a> <a id="8260" href="Data.Integer.Properties.html#34810" class="Function">+-mono-≤</a> <a id="8269" class="Symbol">(</a><a id="8270" href="Ledger.Conway.Specification.Epoch.html#596" class="Function">nonNegative⁻¹ℤ</a> <a id="8285" class="Symbol">(</a><a id="8286" href="Ledger.Conway.Specification.Epoch.html#414" class="InductiveConstructor">pos</a> <a id="8290" href="Ledger.Conway.Specification.Epoch.html#6050" class="Function">feeSS</a><a id="8295" class="Symbol">))</a> <a id="8298" href="Ledger.Conway.Specification.Epoch.html#7978" class="Function">Δr₁-nonneg</a>

      <a id="8316" href="Ledger.Conway.Specification.Epoch.html#8316" class="Function">Δt-nonneg</a> <a id="8326" class="Symbol">:</a> <a id="8328" class="Number">0</a> <a id="8330" href="Class.HasOrder.Core.html#613" class="Field Operator">≤</a> <a id="8332" href="Ledger.Conway.Specification.Epoch.html#6563" class="Function">Δt₁</a>
      <a id="8342" href="Ledger.Conway.Specification.Epoch.html#8316" class="Function">Δt-nonneg</a> <a id="8352" class="Symbol">=</a> <a id="8354" href="stdlib.Data.Rational.Properties.html#1631" class="Function">0≤⇒0≤floor</a> <a id="8365" class="Symbol">_</a>
        <a id="8375" class="Symbol">(</a><a id="8376" href="Ledger.Prelude.Numeric.UnitInterval.html#3337" class="Function">UnitInterval-*-0≤</a> <a id="8394" class="Symbol">(</a><a id="8395" href="Data.Rational.Literals.html#613" class="Function">fromℤ</a> <a id="8401" href="Ledger.Conway.Specification.Epoch.html#6553" class="Function">rewardPot</a><a id="8410" class="Symbol">)</a> <a id="8412" class="Symbol">(</a><a id="8413" href="Ledger.Conway.Specification.Epoch.html#5865" class="Function">prevPp</a> <a id="8420" class="Symbol">.</a><a id="8421" href="Ledger.Conway.Specification.PParams.html#2353" class="Field">PParams.treasuryCut</a><a id="8440" class="Symbol">)</a>
          <a id="8452" class="Symbol">(</a><a id="8453" href="stdlib.Data.Rational.Properties.html#2013" class="Function">fromℤ-0≤</a> <a id="8462" href="Ledger.Conway.Specification.Epoch.html#6553" class="Function">rewardPot</a> <a id="8472" href="Ledger.Conway.Specification.Epoch.html#8202" class="Function">rewardPot-nonneg</a><a id="8488" class="Symbol">))</a>

      <a id="8498" href="Ledger.Conway.Specification.Epoch.html#8498" class="Function">Δf-nonpos</a> <a id="8508" class="Symbol">:</a> <a id="8510" class="Symbol">(</a><a id="8511" class="Number">0</a> <a id="8513" href="Interface.TypeClasses.HasSubtract.html#223" class="Field Operator">-</a> <a id="8515" href="Ledger.Conway.Specification.Epoch.html#414" class="InductiveConstructor">pos</a> <a id="8519" href="Ledger.Conway.Specification.Epoch.html#6050" class="Function">feeSS</a><a id="8524" class="Symbol">)</a> <a id="8526" href="Class.HasOrder.Core.html#613" class="Field Operator">≤</a> <a id="8528" class="Number">0</a>
      <a id="8536" href="Ledger.Conway.Specification.Epoch.html#8498" class="Function">Δf-nonpos</a> <a id="8546" class="Symbol">=</a> <a id="8548" href="Relation.Binary.Reasoning.Syntax.html#1572" class="Function Operator">begin</a>
          <a id="8564" class="Number">0</a> <a id="8566" href="Interface.TypeClasses.HasSubtract.html#223" class="Field Operator">-</a> <a id="8568" href="Ledger.Conway.Specification.Epoch.html#414" class="InductiveConstructor">pos</a> <a id="8572" href="Ledger.Conway.Specification.Epoch.html#6050" class="Function">feeSS</a> <a id="8578" href="Relation.Binary.Reasoning.Syntax.html#11048" class="Function">≡⟨</a> <a id="8581" href="Data.Integer.Properties.html#27061" class="Function">+-identityˡ</a> <a id="8593" class="Symbol">_</a> <a id="8595" href="Relation.Binary.Reasoning.Syntax.html#11048" class="Function">⟩</a>
          <a id="8607" href="Data.Integer.Base.html#4719" class="Function Operator">ℤ.-</a> <a id="8611" href="Ledger.Conway.Specification.Epoch.html#414" class="InductiveConstructor">pos</a> <a id="8615" href="Ledger.Conway.Specification.Epoch.html#6050" class="Function">feeSS</a> <a id="8621" href="Relation.Binary.Reasoning.Syntax.html#5544" class="Function">≤⟨</a> <a id="8624" href="Data.Integer.Properties.html#13298" class="Function">neg-mono-≤</a> <a id="8635" class="Symbol">(</a><a id="8636" href="Data.Integer.Base.html#2106" class="InductiveConstructor">ℤ.+≤+</a> <a id="8642" href="Data.Nat.Base.html#1720" class="InductiveConstructor">z≤n</a><a id="8645" class="Symbol">)</a> <a id="8647" href="Relation.Binary.Reasoning.Syntax.html#5544" class="Function">⟩</a>
          <a id="8659" class="Number">0</a>             <a id="8673" href="Relation.Binary.Reasoning.Syntax.html#12345" class="Function Operator">∎</a>
        <a id="8683" class="Keyword">where</a> <a id="8689" class="Keyword">open</a> <a id="8694" href="Data.Integer.Properties.html#11881" class="Module">≤-Reasoning</a>


<a id="applyRUpd"></a><a id="8708" href="Ledger.Conway.Specification.Epoch.html#8708" class="Function">applyRUpd</a> <a id="8718" class="Symbol">:</a> <a id="8720" href="Ledger.Conway.Specification.Rewards.html#6276" class="Record">RewardUpdate</a> <a id="8733" class="Symbol">→</a> <a id="8735" href="Ledger.Conway.Specification.Epoch.html#1835" class="Record">EpochState</a> <a id="8746" class="Symbol">→</a> <a id="8748" href="Ledger.Conway.Specification.Epoch.html#1835" class="Record">EpochState</a>
<a id="8759" href="Ledger.Conway.Specification.Epoch.html#8708" class="Function">applyRUpd</a> <a id="8769" href="Ledger.Conway.Specification.Epoch.html#8769" class="Bound">rewardUpdate</a> <a class="AgdaKaTeX">$\begin{pmatrix} \begin{pmatrix} \,\href{Ledger.Conway.Specification.Epoch.html#8786}{\htmlId{8786}{\htmlClass{Bound}{\text{treasury}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#8797}{\htmlId{8797}{\htmlClass{Bound}{\text{reserves}}}}\, \end{pmatrix}
                       \\ \,\href{Ledger.Conway.Specification.Epoch.html#8834}{\htmlId{8834}{\htmlClass{Bound}{\text{ss}}}}\,
                       \\ \begin{pmatrix} \begin{pmatrix} \,\href{Ledger.Conway.Specification.Epoch.html#8866}{\htmlId{8866}{\htmlClass{Bound}{\text{utxo}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#8873}{\htmlId{8873}{\htmlClass{Bound}{\text{fees}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#8880}{\htmlId{8880}{\htmlClass{Bound}{\text{deposits}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#8891}{\htmlId{8891}{\htmlClass{Bound}{\text{donations}}}}\, \end{pmatrix}
                         \\ \,\href{Ledger.Conway.Specification.Epoch.html#8931}{\htmlId{8931}{\htmlClass{Bound}{\text{govSt}}}}\,
                         \\ \begin{pmatrix} \begin{pmatrix} \,\href{Ledger.Conway.Specification.Epoch.html#8968}{\htmlId{8968}{\htmlClass{Bound}{\text{voteDelegs}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#8981}{\htmlId{8981}{\htmlClass{Bound}{\text{stakeDelegs}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#8995}{\htmlId{8995}{\htmlClass{Bound}{\text{rewards}}}}\, \end{pmatrix} \\ \,\href{Ledger.Conway.Specification.Epoch.html#9008}{\htmlId{9008}{\htmlClass{Bound}{\text{pState}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#9017}{\htmlId{9017}{\htmlClass{Bound}{\text{gState}}}}\, \end{pmatrix} \end{pmatrix}
                       \\ \,\href{Ledger.Conway.Specification.Epoch.html#9056}{\htmlId{9056}{\htmlClass{Bound}{\text{es}}}}\,
                       \\ \,\href{Ledger.Conway.Specification.Epoch.html#9084}{\htmlId{9084}{\htmlClass{Bound}{\text{fut}}}}\,
                       \end{pmatrix}$</a> <a id="9115" class="Symbol">=</a> <a class="AgdaKaTeX">$\begin{pmatrix} \begin{pmatrix} \,\href{Prelude.html#3280}{\htmlId{9121}{\htmlClass{Function}{\text{posPart}}}}\, \,\htmlId{9129}{\htmlClass{Symbol}{\text{(}}}\,\,\href{Ledger.Conway.Specification.Epoch.html#414}{\htmlId{9130}{\htmlClass{InductiveConstructor}{\text{pos}}}}\, \,\href{Ledger.Conway.Specification.Epoch.html#8786}{\htmlId{9134}{\htmlClass{Bound}{\text{treasury}}}}\, \,\href{Class.HasAdd.Core.html#162}{\htmlId{9143}{\htmlClass{Field Operator}{\text{+}}}}\, \,\href{Ledger.Conway.Specification.Rewards.html#6313}{\htmlId{9145}{\htmlClass{Function}{\text{Δt}}}}\, \,\href{Class.HasAdd.Core.html#162}{\htmlId{9148}{\htmlClass{Field Operator}{\text{+}}}}\, \,\href{Ledger.Conway.Specification.Epoch.html#414}{\htmlId{9150}{\htmlClass{InductiveConstructor}{\text{pos}}}}\, \,\href{Ledger.Conway.Specification.Epoch.html#9705}{\htmlId{9154}{\htmlClass{Function}{\text{unregRU&#39;}}}}\,\,\htmlId{9162}{\htmlClass{Symbol}{\text{)}}}\,
                               \\ \,\href{Prelude.html#3280}{\htmlId{9197}{\htmlClass{Function}{\text{posPart}}}}\, \,\htmlId{9205}{\htmlClass{Symbol}{\text{(}}}\,\,\href{Ledger.Conway.Specification.Epoch.html#414}{\htmlId{9206}{\htmlClass{InductiveConstructor}{\text{pos}}}}\, \,\href{Ledger.Conway.Specification.Epoch.html#8797}{\htmlId{9210}{\htmlClass{Bound}{\text{reserves}}}}\, \,\href{Class.HasAdd.Core.html#162}{\htmlId{9219}{\htmlClass{Field Operator}{\text{+}}}}\, \,\href{Ledger.Conway.Specification.Rewards.html#6316}{\htmlId{9221}{\htmlClass{Function}{\text{Δr}}}}\,\,\htmlId{9223}{\htmlClass{Symbol}{\text{)}}}\, \end{pmatrix}
                             \\ \,\href{Ledger.Conway.Specification.Epoch.html#8834}{\htmlId{9258}{\htmlClass{Bound}{\text{ss}}}}\,
                             \\ \begin{pmatrix} \begin{pmatrix} \,\href{Ledger.Conway.Specification.Epoch.html#8866}{\htmlId{9296}{\htmlClass{Bound}{\text{utxo}}}}\, \\ \,\href{Prelude.html#3280}{\htmlId{9303}{\htmlClass{Function}{\text{posPart}}}}\, \,\htmlId{9311}{\htmlClass{Symbol}{\text{(}}}\,\,\href{Ledger.Conway.Specification.Epoch.html#414}{\htmlId{9312}{\htmlClass{InductiveConstructor}{\text{pos}}}}\, \,\href{Ledger.Conway.Specification.Epoch.html#8873}{\htmlId{9316}{\htmlClass{Bound}{\text{fees}}}}\, \,\href{Class.HasAdd.Core.html#162}{\htmlId{9321}{\htmlClass{Field Operator}{\text{+}}}}\, \,\href{Ledger.Conway.Specification.Rewards.html#6319}{\htmlId{9323}{\htmlClass{Function}{\text{Δf}}}}\,\,\htmlId{9325}{\htmlClass{Symbol}{\text{)}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#8880}{\htmlId{9329}{\htmlClass{Bound}{\text{deposits}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#8891}{\htmlId{9340}{\htmlClass{Bound}{\text{donations}}}}\, \end{pmatrix}
                               \\ \,\href{Ledger.Conway.Specification.Epoch.html#8931}{\htmlId{9385}{\htmlClass{Bound}{\text{govSt}}}}\,
                               \\ \begin{pmatrix} \begin{pmatrix} \,\href{Ledger.Conway.Specification.Epoch.html#8968}{\htmlId{9428}{\htmlClass{Bound}{\text{voteDelegs}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#8981}{\htmlId{9441}{\htmlClass{Bound}{\text{stakeDelegs}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#8995}{\htmlId{9455}{\htmlClass{Bound}{\text{rewards}}}}\, \,\href{Axiom.Set.Map.Dec.html#2052}{\htmlId{9463}{\htmlClass{Function Operator}{\text{∪⁺}}}}\, \,\href{Ledger.Conway.Specification.Epoch.html#9637}{\htmlId{9466}{\htmlClass{Function}{\text{regRU}}}}\, \end{pmatrix} \\ \,\href{Ledger.Conway.Specification.Epoch.html#9008}{\htmlId{9476}{\htmlClass{Bound}{\text{pState}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#9017}{\htmlId{9485}{\htmlClass{Bound}{\text{gState}}}}\, \end{pmatrix} \end{pmatrix}
                             \\ \,\href{Ledger.Conway.Specification.Epoch.html#9056}{\htmlId{9527}{\htmlClass{Bound}{\text{es}}}}\,
                             \\ \,\href{Ledger.Conway.Specification.Epoch.html#9084}{\htmlId{9561}{\htmlClass{Bound}{\text{fut}}}}\, \end{pmatrix}$</a>
  <a id="9569" class="Keyword">where</a>
    <a id="9579" class="Keyword">open</a> <a id="9584" href="Ledger.Conway.Specification.Rewards.html#6276" class="Module">RewardUpdate</a> <a id="9597" href="Ledger.Conway.Specification.Epoch.html#8769" class="Bound">rewardUpdate</a> <a id="9610" class="Keyword">using</a> <a id="9616" class="Symbol">(</a><a id="9617" href="Ledger.Conway.Specification.Rewards.html#6313" class="Field">Δt</a><a id="9619" class="Symbol">;</a> <a id="9621" href="Ledger.Conway.Specification.Rewards.html#6316" class="Field">Δr</a><a id="9623" class="Symbol">;</a> <a id="9625" href="Ledger.Conway.Specification.Rewards.html#6319" class="Field">Δf</a><a id="9627" class="Symbol">;</a> <a id="9629" href="Ledger.Conway.Specification.Rewards.html#6339" class="Field">rs</a><a id="9631" class="Symbol">)</a>
    <a id="9637" href="Ledger.Conway.Specification.Epoch.html#9637" class="Function">regRU</a>     <a id="9647" class="Symbol">=</a> <a id="9649" href="Ledger.Conway.Specification.Rewards.html#6339" class="Function">rs</a> <a id="9652" href="Axiom.Set.Map.html#13534" class="Function Operator">∣</a> <a id="9654" href="Class.IsSet.html#916" class="Function">dom</a> <a id="9658" href="Ledger.Conway.Specification.Epoch.html#8995" class="Bound">rewards</a>
    <a id="9670" href="Ledger.Conway.Specification.Epoch.html#9670" class="Function">unregRU</a>   <a id="9680" class="Symbol">=</a> <a id="9682" href="Ledger.Conway.Specification.Rewards.html#6339" class="Function">rs</a> <a id="9685" href="Axiom.Set.Map.html#13604" class="Function Operator">∣</a> <a id="9687" href="Class.IsSet.html#916" class="Function">dom</a> <a id="9691" href="Ledger.Conway.Specification.Epoch.html#8995" class="Bound">rewards</a> <a id="9699" href="Axiom.Set.Map.html#13604" class="Function Operator">ᶜ</a>
    <a id="9705" href="Ledger.Conway.Specification.Epoch.html#9705" class="Function">unregRU&#39;</a>  <a id="9715" class="Symbol">=</a> <a id="9717" href="abstract-set-theory.FiniteSetTheory.html#4312" class="Function">∑[</a> <a id="9720" href="Ledger.Conway.Specification.Epoch.html#9720" class="Bound">x</a> <a id="9722" href="abstract-set-theory.FiniteSetTheory.html#4312" class="Function">←</a> <a id="9724" href="Ledger.Conway.Specification.Epoch.html#9670" class="Function">unregRU</a> <a id="9732" href="abstract-set-theory.FiniteSetTheory.html#4312" class="Function">]</a> <a id="9734" href="Ledger.Conway.Specification.Epoch.html#9720" class="Bound">x</a>


<a id="9738" class="Keyword">open</a> <a id="9743" href="Ledger.Core.Specification.Address.html#1313" class="Module">RwdAddr</a> <a id="9751" class="Keyword">using</a> <a id="9757" class="Symbol">(</a><a id="9758" href="Ledger.Core.Specification.Address.html#1367" class="Field">stake</a><a id="9763" class="Symbol">)</a>
<a id="9765" class="Keyword">opaque</a>


  <a id="calculatePoolDelegatedStake"></a><a id="9776" href="Ledger.Conway.Specification.Epoch.html#9776" class="Function">calculatePoolDelegatedStake</a>
    <a id="9808" class="Symbol">:</a> <a id="9810" href="Ledger.Conway.Specification.Rewards.html#6499" class="Record">Snapshot</a>
    <a id="9823" class="Symbol">→</a> <a id="9825" href="Ledger.Conway.Specification.Epoch.html#3292" class="Function">PoolDelegatedStake</a>
  <a id="9846" href="Ledger.Conway.Specification.Epoch.html#9776" class="Function">calculatePoolDelegatedStake</a> <a id="9874" href="Ledger.Conway.Specification.Epoch.html#9874" class="Bound">ss</a> <a id="9877" class="Symbol">=</a>
      <a id="9885" class="Comment">-- Shelley spec: the output map must contain keys appearing in both</a>
      <a id="9959" class="Comment">-- sd and the pool parameters.</a>
      <a id="9996" href="Ledger.Conway.Specification.Epoch.html#10232" class="Function">sd</a> <a id="9999" href="Axiom.Set.Map.html#13534" class="Function Operator">∣</a> <a id="10001" href="Class.IsSet.html#916" class="Function">dom</a> <a id="10005" class="Symbol">(</a><a id="10006" href="Ledger.Conway.Specification.Certs.html#1676" class="Field">PoolsOf</a> <a id="10014" href="Ledger.Conway.Specification.Epoch.html#9874" class="Bound">ss</a><a id="10016" class="Symbol">)</a>
    <a id="10022" class="Keyword">where</a>
      <a id="10034" class="Comment">-- stake credentials delegating to each pool</a>
      <a id="10085" href="Ledger.Conway.Specification.Epoch.html#10085" class="Function">stakeCredentialsPerPool</a> <a id="10109" class="Symbol">:</a> <a id="10111" href="Axiom.Set.Rel.html#1312" class="Function">Rel</a> <a id="10115" href="Ledger.Core.Specification.Crypto.html#1386" class="Function">KeyHash</a> <a id="10123" href="Ledger.Core.Specification.Address.html#259" class="Datatype">Credential</a>
      <a id="10140" href="Ledger.Conway.Specification.Epoch.html#10085" class="Function">stakeCredentialsPerPool</a> <a id="10164" class="Symbol">=</a> <a id="10166" class="Symbol">(</a><a id="10167" href="Ledger.Conway.Specification.Certs.html#2006" class="Field">StakeDelegsOf</a> <a id="10181" href="Ledger.Conway.Specification.Epoch.html#9874" class="Bound">ss</a> <a id="10184" href="Axiom.Set.Map.html#2293" class="Function Operator">ˢ</a><a id="10185" class="Symbol">)</a> <a id="10187" href="Axiom.Set.Rel.html#1608" class="Function Operator">⁻¹ʳ</a>

      <a id="10198" class="Comment">-- delegated stake per pool</a>
      <a id="10232" href="Ledger.Conway.Specification.Epoch.html#10232" class="Function">sd</a> <a id="10235" class="Symbol">:</a> <a id="10237" href="Ledger.Core.Specification.Crypto.html#1386" class="Function">KeyHash</a> <a id="10245" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="10247" href="Ledger.Prelude.Base.html#154" class="Function">Coin</a>
      <a id="10258" href="Ledger.Conway.Specification.Epoch.html#10232" class="Function">sd</a> <a id="10261" class="Symbol">=</a> <a id="10263" href="Axiom.Set.Map.Dec.html#2130" class="Function">aggregate₊</a> <a id="10274" class="Symbol">((</a><a id="10276" href="Ledger.Conway.Specification.Epoch.html#10085" class="Function">stakeCredentialsPerPool</a> <a id="10300" href="abstract-set-theory.FiniteSetTheory.html#3050" class="Function Operator">∘ʳ</a> <a id="10303" class="Symbol">(</a><a id="10304" href="Ledger.Conway.Specification.Certs.html#1922" class="Field">StakeOf</a> <a id="10312" href="Ledger.Conway.Specification.Epoch.html#9874" class="Bound">ss</a> <a id="10315" href="Axiom.Set.Map.html#2293" class="Function Operator">ˢ</a><a id="10316" class="Symbol">))</a> <a id="10319" href="abstract-set-theory.FiniteSetTheory.html#2860" class="Function Operator">ᶠˢ</a><a id="10321" class="Symbol">)</a>


  <a id="stakeFromGADeposits"></a><a id="10327" href="Ledger.Conway.Specification.Epoch.html#10327" class="Function">stakeFromGADeposits</a>
    <a id="10351" class="Symbol">:</a> <a id="10353" href="Ledger.Conway.Specification.Gov.html#1459" class="Function">GovState</a>
    <a id="10366" class="Symbol">→</a> <a id="10368" href="Ledger.Conway.Specification.Utxo.html#1308" class="Record">UTxOState</a>
    <a id="10382" class="Symbol">→</a> <a id="10384" href="Ledger.Conway.Specification.Certs.html#1358" class="Function">Stake</a>
  <a id="10392" href="Ledger.Conway.Specification.Epoch.html#10327" class="Function">stakeFromGADeposits</a> <a id="10412" href="Ledger.Conway.Specification.Epoch.html#10412" class="Bound">govSt</a> <a id="10418" href="Ledger.Conway.Specification.Epoch.html#10418" class="Bound">utxoSt</a> <a id="10425" class="Symbol">=</a> <a id="10427" href="abstract-set-theory.FiniteSetTheory.html#4745" class="Function">aggregateBy</a>
     <a id="10444" class="Symbol">(</a><a id="10445" href="abstract-set-theory.FiniteSetTheory.html#519" class="Function">mapˢ</a> <a id="10450" class="Symbol">(λ</a> <a id="10453" class="Symbol">(</a><a id="10454" href="Ledger.Conway.Specification.Epoch.html#10454" class="Bound">gaid</a> <a id="10459" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="10461" href="Ledger.Conway.Specification.Epoch.html#10461" class="Bound">addr</a><a id="10465" class="Symbol">)</a> <a id="10467" class="Symbol">→</a> <a id="10469" class="Symbol">(</a><a id="10470" href="Ledger.Conway.Specification.Epoch.html#10454" class="Bound">gaid</a> <a id="10475" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="10477" href="Ledger.Conway.Specification.Epoch.html#10461" class="Bound">addr</a><a id="10481" class="Symbol">)</a> <a id="10483" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="10485" href="Ledger.Core.Specification.Address.html#1367" class="Field">stake</a> <a id="10491" href="Ledger.Conway.Specification.Epoch.html#10461" class="Bound">addr</a><a id="10495" class="Symbol">)</a> <a id="10497" href="Ledger.Conway.Specification.Epoch.html#10644" class="Function">govSt&#39;</a><a id="10503" class="Symbol">)</a>
     <a id="10510" class="Symbol">(</a><a id="10511" href="Axiom.Set.Map.html#13316" class="Function">mapFromPartialFun</a> <a id="10529" class="Symbol">(λ</a> <a id="10532" class="Symbol">(</a><a id="10533" href="Ledger.Conway.Specification.Epoch.html#10533" class="Bound">gaid</a> <a id="10538" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="10540" class="Symbol">_)</a> <a id="10543" class="Symbol">→</a> <a id="10545" href="Axiom.Set.Map.html#17167" class="Function">lookupᵐ?</a> <a id="10554" href="Ledger.Conway.Specification.Utxo.html#1416" class="Field">deposits</a> <a id="10563" class="Symbol">(</a><a id="10564" href="Ledger.Conway.Specification.Certs.html#750" class="InductiveConstructor">GovActionDeposit</a> <a id="10581" href="Ledger.Conway.Specification.Epoch.html#10533" class="Bound">gaid</a><a id="10585" class="Symbol">))</a> <a id="10588" href="Ledger.Conway.Specification.Epoch.html#10644" class="Function">govSt&#39;</a><a id="10594" class="Symbol">)</a>
     <a id="10601" class="Keyword">where</a>
       <a id="10614" class="Keyword">open</a> <a id="10619" href="Ledger.Conway.Specification.Utxo.html#1308" class="Module">UTxOState</a> <a id="10629" href="Ledger.Conway.Specification.Epoch.html#10418" class="Bound">utxoSt</a>

       <a id="10644" href="Ledger.Conway.Specification.Epoch.html#10644" class="Function">govSt&#39;</a> <a id="10651" class="Symbol">:</a> <a id="10653" href="abstract-set-theory.FiniteSetTheory.html#488" class="Function Operator">ℙ</a> <a id="10655" class="Symbol">(</a><a id="10656" href="Ledger.Core.Specification.Gov.Actions.html#1975" class="Function">GovActionID</a> <a id="10668" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="10670" href="Ledger.Core.Specification.Address.html#1313" class="Record">RwdAddr</a><a id="10677" class="Symbol">)</a>
       <a id="10686" href="Ledger.Conway.Specification.Epoch.html#10644" class="Function">govSt&#39;</a> <a id="10693" class="Symbol">=</a> <a id="10695" href="abstract-set-theory.FiniteSetTheory.html#519" class="Function">mapˢ</a> <a id="10700" class="Symbol">(</a><a id="10701" href="Class.Bifunctor.html#1152" class="Function">map₂</a> <a id="10706" href="Ledger.Core.Specification.Gov.Actions.html#3878" class="Field">returnAddr</a><a id="10716" class="Symbol">)</a> <a id="10718" class="Symbol">(</a><a id="10719" href="Axiom.Set.html#5903" class="Function">fromList</a> <a id="10728" href="Ledger.Conway.Specification.Epoch.html#10412" class="Bound">govSt</a><a id="10733" class="Symbol">)</a>


<a id="10737" class="Keyword">module</a> <a id="VDelegDelegatedStake"></a><a id="10744" href="Ledger.Conway.Specification.Epoch.html#10744" class="Module">VDelegDelegatedStake</a>
  <a id="10767" class="Symbol">(</a><a id="10768" href="Ledger.Conway.Specification.Epoch.html#10768" class="Bound">currentEpoch</a> <a id="10781" class="Symbol">:</a> <a id="10783" href="Ledger.Core.Specification.Epoch.html#646" class="Function">Epoch</a><a id="10788" class="Symbol">)</a>
  <a id="10792" class="Symbol">(</a><a id="10793" href="Ledger.Conway.Specification.Epoch.html#10793" class="Bound">utxoSt</a>       <a id="10806" class="Symbol">:</a> <a id="10808" href="Ledger.Conway.Specification.Utxo.html#1308" class="Record">UTxOState</a><a id="10817" class="Symbol">)</a>
  <a id="10821" class="Symbol">(</a><a id="10822" href="Ledger.Conway.Specification.Epoch.html#10822" class="Bound">govSt</a>        <a id="10835" class="Symbol">:</a> <a id="10837" href="Ledger.Conway.Specification.Gov.html#1459" class="Function">GovState</a><a id="10845" class="Symbol">)</a>
  <a id="10849" class="Symbol">(</a><a id="10850" href="Ledger.Conway.Specification.Epoch.html#10850" class="Bound">gState</a>       <a id="10863" class="Symbol">:</a> <a id="10865" href="Ledger.Conway.Specification.Certs.html#4156" class="Record">GState</a><a id="10871" class="Symbol">)</a>
  <a id="10875" class="Symbol">(</a><a id="10876" href="Ledger.Conway.Specification.Epoch.html#10876" class="Bound">dState</a>       <a id="10889" class="Symbol">:</a> <a id="10891" href="Ledger.Conway.Specification.Certs.html#3893" class="Record">DState</a><a id="10897" class="Symbol">)</a>
  <a id="10901" class="Keyword">where</a>


  <a id="10911" class="Keyword">open</a> <a id="10916" href="Ledger.Conway.Specification.Utxo.html#1308" class="Module">UTxOState</a> <a id="10926" href="Ledger.Conway.Specification.Epoch.html#10793" class="Bound">utxoSt</a>
  <a id="10935" class="Keyword">open</a> <a id="10940" href="Ledger.Conway.Specification.Certs.html#3893" class="Module">DState</a> <a id="10947" href="Ledger.Conway.Specification.Epoch.html#10876" class="Bound">dState</a>
  <a id="10956" class="Keyword">open</a> <a id="10961" href="Ledger.Conway.Specification.Certs.html#4156" class="Module">GState</a> <a id="10968" href="Ledger.Conway.Specification.Epoch.html#10850" class="Bound">gState</a>


  <a id="10979" class="Comment">-- active DReps</a>
  <a id="VDelegDelegatedStake.activeDReps"></a><a id="10997" href="Ledger.Conway.Specification.Epoch.html#10997" class="Function">activeDReps</a> <a id="11009" class="Symbol">:</a> <a id="11011" href="abstract-set-theory.FiniteSetTheory.html#488" class="Function Operator">ℙ</a> <a id="11013" href="Ledger.Core.Specification.Address.html#259" class="Datatype">Credential</a>
  <a id="11026" href="Ledger.Conway.Specification.Epoch.html#10997" class="Function">activeDReps</a> <a id="11038" class="Symbol">=</a> <a id="11040" href="Class.IsSet.html#916" class="Function">dom</a> <a id="11044" class="Symbol">(</a><a id="11045" href="abstract-set-theory.FiniteSetTheory.html#4041" class="Function">filterᵐ</a> <a id="11053" class="Symbol">(λ</a> <a id="11056" class="Symbol">(_</a> <a id="11059" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="11061" href="Ledger.Conway.Specification.Epoch.html#11061" class="Bound">e</a><a id="11062" class="Symbol">)</a> <a id="11064" class="Symbol">→</a> <a id="11066" href="Ledger.Conway.Specification.Epoch.html#10768" class="Bound">currentEpoch</a> <a id="11079" href="Class.HasOrder.Core.html#613" class="Field Operator">≤</a> <a id="11081" href="Ledger.Conway.Specification.Epoch.html#11061" class="Bound">e</a><a id="11082" class="Symbol">)</a> <a id="11084" href="Ledger.Conway.Specification.Certs.html#4213" class="Function">dreps</a><a id="11089" class="Symbol">)</a>

  <a id="11094" class="Comment">-- active vote delegations</a>
  <a id="VDelegDelegatedStake.activeVDelegs"></a><a id="11123" href="Ledger.Conway.Specification.Epoch.html#11123" class="Function">activeVDelegs</a> <a id="11137" class="Symbol">:</a> <a id="11139" href="abstract-set-theory.FiniteSetTheory.html#488" class="Function Operator">ℙ</a> <a id="11141" href="Ledger.Core.Specification.Gov.Actions.html#2565" class="Datatype">VDeleg</a>
  <a id="11150" href="Ledger.Conway.Specification.Epoch.html#11123" class="Function">activeVDelegs</a> <a id="11164" class="Symbol">=</a> <a id="11166" href="abstract-set-theory.FiniteSetTheory.html#519" class="Function">mapˢ</a> <a id="11171" href="Ledger.Core.Specification.Gov.Actions.html#2587" class="InductiveConstructor">vDelegCredential</a> <a id="11188" href="Ledger.Conway.Specification.Epoch.html#10997" class="Function">activeDReps</a> <a id="11200" href="Axiom.Set.html#9137" class="Function Operator">∪</a> <a id="11202" href="Class.HasSingleton.html#288" class="Field Operator">❴</a> <a id="11204" href="Ledger.Core.Specification.Gov.Actions.html#2660" class="InductiveConstructor">vDelegNoConfidence</a> <a id="11223" href="Class.HasSingleton.html#288" class="Field Operator">❵</a> <a id="11225" href="Axiom.Set.html#9137" class="Function Operator">∪</a> <a id="11227" href="Class.HasSingleton.html#288" class="Field Operator">❴</a> <a id="11229" href="Ledger.Core.Specification.Gov.Actions.html#2630" class="InductiveConstructor">vDelegAbstain</a> <a id="11243" href="Class.HasSingleton.html#288" class="Field Operator">❵</a>

  <a id="11248" class="Comment">-- compute the stake for a credential</a>
  <a id="VDelegDelegatedStake.stakePerCredential"></a><a id="11288" href="Ledger.Conway.Specification.Epoch.html#11288" class="Function">stakePerCredential</a> <a id="11307" class="Symbol">:</a> <a id="11309" href="Ledger.Core.Specification.Address.html#259" class="Datatype">Credential</a> <a id="11320" class="Symbol">→</a> <a id="11322" href="Ledger.Prelude.Base.html#154" class="Function">Coin</a>
  <a id="11329" href="Ledger.Conway.Specification.Epoch.html#11288" class="Function">stakePerCredential</a> <a id="11348" href="Ledger.Conway.Specification.Epoch.html#11348" class="Bound">c</a> <a id="11350" class="Symbol">=</a> <a id="11352" href="Ledger.Conway.Specification.Utxo.html#2534" class="Function">cbalance</a> <a id="11361" class="Symbol">(</a><a id="11362" href="Ledger.Conway.Specification.Utxo.html#1372" class="Function">utxo</a> <a id="11367" href="abstract-set-theory.FiniteSetTheory.html#4234" class="Function Operator">∣^&#39;</a> <a id="11371" class="Symbol">λ</a> <a id="11373" href="Ledger.Conway.Specification.Epoch.html#11373" class="Bound">txout</a> <a id="11379" class="Symbol">→</a> <a id="11381" href="Ledger.Conway.Specification.Epoch.html#5350" class="Function">getStakeCred</a> <a id="11394" href="Ledger.Conway.Specification.Epoch.html#11373" class="Bound">txout</a> <a id="11400" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="11402" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="11407" href="Ledger.Conway.Specification.Epoch.html#11348" class="Bound">c</a><a id="11408" class="Symbol">)</a>
                         <a id="11435" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="11437" href="Data.Maybe.Base.html#1546" class="Function">fromMaybe</a> <a id="11447" class="Number">0</a> <a id="11449" class="Symbol">(</a><a id="11450" href="Axiom.Set.Map.html#17167" class="Function">lookupᵐ?</a> <a id="11459" class="Symbol">(</a><a id="11460" href="Ledger.Conway.Specification.Epoch.html#10327" class="Function">stakeFromGADeposits</a> <a id="11480" href="Ledger.Conway.Specification.Epoch.html#10822" class="Bound">govSt</a> <a id="11486" href="Ledger.Conway.Specification.Epoch.html#10793" class="Bound">utxoSt</a><a id="11492" class="Symbol">)</a> <a id="11494" href="Ledger.Conway.Specification.Epoch.html#11348" class="Bound">c</a><a id="11495" class="Symbol">)</a>
                         <a id="11522" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="11524" href="Data.Maybe.Base.html#1546" class="Function">fromMaybe</a> <a id="11534" class="Number">0</a> <a id="11536" class="Symbol">(</a><a id="11537" href="Axiom.Set.Map.html#17167" class="Function">lookupᵐ?</a> <a id="11546" class="Symbol">(</a><a id="11547" href="Ledger.Conway.Specification.Certs.html#1841" class="Field">RewardsOf</a> <a id="11557" href="Ledger.Conway.Specification.Epoch.html#10876" class="Bound">dState</a><a id="11563" class="Symbol">)</a> <a id="11565" href="Ledger.Conway.Specification.Epoch.html#11348" class="Bound">c</a><a id="11566" class="Symbol">)</a>

  <a id="VDelegDelegatedStake.calculate"></a><a id="11571" href="Ledger.Conway.Specification.Epoch.html#11571" class="Function">calculate</a> <a id="11581" class="Symbol">:</a> <a id="11583" href="Ledger.Core.Specification.Gov.Actions.html#2565" class="Datatype">VDeleg</a> <a id="11590" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="11592" href="Ledger.Prelude.Base.html#154" class="Function">Coin</a>
  <a id="11599" href="Ledger.Conway.Specification.Epoch.html#11571" class="Function">calculate</a> <a id="11609" class="Symbol">=</a> <a id="11611" href="Axiom.Set.Map.html#10460" class="Function">mapFromFun</a> <a id="11622" class="Symbol">(λ</a> <a id="11625" href="Ledger.Conway.Specification.Epoch.html#11625" class="Bound">vd</a> <a id="11628" class="Symbol">→</a> <a id="11630" href="abstract-set-theory.FiniteSetTheory.html#4448" class="Function">∑ˢ[</a> <a id="11634" href="Ledger.Conway.Specification.Epoch.html#11634" class="Bound">c</a> <a id="11636" href="abstract-set-theory.FiniteSetTheory.html#4448" class="Function">←</a> <a id="11638" href="Ledger.Conway.Specification.Certs.html#3952" class="Field">voteDelegs</a> <a id="11649" href="Axiom.Set.Map.html#17955" class="Function Operator">⁻¹</a> <a id="11652" href="Ledger.Conway.Specification.Epoch.html#11625" class="Bound">vd</a> <a id="11655" href="abstract-set-theory.FiniteSetTheory.html#4448" class="Function">]</a> <a id="11657" class="Symbol">(</a><a id="11658" href="Ledger.Conway.Specification.Epoch.html#11288" class="Function">stakePerCredential</a> <a id="11677" href="Ledger.Conway.Specification.Epoch.html#11634" class="Bound">c</a><a id="11678" class="Symbol">))</a>
                         <a id="11706" href="Ledger.Conway.Specification.Epoch.html#11123" class="Function">activeVDelegs</a>


<a id="11722" class="Keyword">opaque</a>


  <a id="calculateVDelegDelegatedStake"></a><a id="11733" href="Ledger.Conway.Specification.Epoch.html#11733" class="Function">calculateVDelegDelegatedStake</a>
    <a id="11767" class="Symbol">:</a> <a id="11769" href="Ledger.Core.Specification.Epoch.html#646" class="Function">Epoch</a>
    <a id="11779" class="Symbol">→</a> <a id="11781" href="Ledger.Conway.Specification.Utxo.html#1308" class="Record">UTxOState</a>
    <a id="11795" class="Symbol">→</a> <a id="11797" href="Ledger.Conway.Specification.Gov.html#1459" class="Function">GovState</a>
    <a id="11810" class="Symbol">→</a> <a id="11812" href="Ledger.Conway.Specification.Certs.html#4156" class="Record">GState</a>
    <a id="11823" class="Symbol">→</a> <a id="11825" href="Ledger.Conway.Specification.Certs.html#3893" class="Record">DState</a>
    <a id="11836" class="Symbol">→</a> <a id="11838" href="Ledger.Core.Specification.Gov.Actions.html#2565" class="Datatype">VDeleg</a> <a id="11845" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="11847" href="Ledger.Prelude.Base.html#154" class="Function">Coin</a>
  <a id="11854" href="Ledger.Conway.Specification.Epoch.html#11733" class="Function">calculateVDelegDelegatedStake</a> <a id="11884" class="Symbol">=</a> <a id="11886" href="Ledger.Conway.Specification.Epoch.html#11571" class="Function">VDelegDelegatedStake.calculate</a>


<a id="11919" class="Keyword">opaque</a>


  <a id="calculatePoolDelegatedStakeForVoting"></a><a id="11930" href="Ledger.Conway.Specification.Epoch.html#11930" class="Function">calculatePoolDelegatedStakeForVoting</a>
    <a id="11971" class="Symbol">:</a> <a id="11973" href="Ledger.Conway.Specification.Rewards.html#6499" class="Record">Snapshot</a>
    <a id="11986" class="Symbol">→</a> <a id="11988" href="Ledger.Conway.Specification.Utxo.html#1308" class="Record">UTxOState</a>
    <a id="12002" class="Symbol">→</a> <a id="12004" href="Ledger.Conway.Specification.Gov.html#1459" class="Function">GovState</a>
    <a id="12017" class="Symbol">→</a> <a id="12019" href="Ledger.Core.Specification.Crypto.html#1386" class="Function">KeyHash</a> <a id="12027" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="12029" href="Ledger.Prelude.Base.html#154" class="Function">Coin</a>
  <a id="12036" href="Ledger.Conway.Specification.Epoch.html#11930" class="Function">calculatePoolDelegatedStakeForVoting</a> <a id="12073" href="Ledger.Conway.Specification.Epoch.html#12073" class="Bound">ss</a> <a id="12076" href="Ledger.Conway.Specification.Epoch.html#12076" class="Bound">utxoSt</a> <a id="12083" href="Ledger.Conway.Specification.Epoch.html#12083" class="Bound">govSt</a>
    <a id="12093" class="Symbol">=</a> <a id="12095" href="Ledger.Conway.Specification.Epoch.html#9776" class="Function">calculatePoolDelegatedStake</a> <a id="12123" href="Ledger.Conway.Specification.Epoch.html#12073" class="Bound">ss</a> <a id="12126" href="Axiom.Set.Map.Dec.html#2052" class="Function Operator">∪⁺</a> <a id="12129" class="Symbol">(</a><a id="12130" href="Ledger.Conway.Specification.Epoch.html#12184" class="Function">stakeFromDeposits</a> <a id="12148" href="Axiom.Set.Map.html#13534" class="Function Operator">∣</a> <a id="12150" href="Class.IsSet.html#916" class="Function">dom</a> <a id="12154" class="Symbol">(</a><a id="12155" href="Ledger.Conway.Specification.Certs.html#1676" class="Field">PoolsOf</a> <a id="12163" href="Ledger.Conway.Specification.Epoch.html#12073" class="Bound">ss</a><a id="12165" class="Symbol">))</a>
    <a id="12172" class="Keyword">where</a>
      <a id="12184" href="Ledger.Conway.Specification.Epoch.html#12184" class="Function">stakeFromDeposits</a> <a id="12202" class="Symbol">:</a> <a id="12204" href="Ledger.Core.Specification.Crypto.html#1386" class="Function">KeyHash</a> <a id="12212" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="12214" href="Ledger.Prelude.Base.html#154" class="Function">Coin</a>
      <a id="12225" href="Ledger.Conway.Specification.Epoch.html#12184" class="Function">stakeFromDeposits</a> <a id="12243" class="Symbol">=</a> <a id="12245" href="Axiom.Set.Map.Dec.html#2130" class="Function">aggregate₊</a> <a id="12256" class="Symbol">(((</a><a id="12259" href="Ledger.Conway.Specification.Certs.html#2006" class="Field">StakeDelegsOf</a> <a id="12273" href="Ledger.Conway.Specification.Epoch.html#12073" class="Bound">ss</a> <a id="12276" href="Axiom.Set.Map.html#2293" class="Function Operator">ˢ</a><a id="12277" class="Symbol">)</a> <a id="12279" href="Axiom.Set.Rel.html#1608" class="Function Operator">⁻¹ʳ</a>
                                      <a id="12321" href="abstract-set-theory.FiniteSetTheory.html#3050" class="Function Operator">∘ʳ</a> <a id="12324" class="Symbol">(</a><a id="12325" href="Ledger.Conway.Specification.Epoch.html#10327" class="Function">stakeFromGADeposits</a> <a id="12345" href="Ledger.Conway.Specification.Epoch.html#12083" class="Bound">govSt</a> <a id="12351" href="Ledger.Conway.Specification.Epoch.html#12076" class="Bound">utxoSt</a> <a id="12358" href="Axiom.Set.Map.html#2293" class="Function Operator">ˢ</a><a id="12359" class="Symbol">))</a> <a id="12362" href="abstract-set-theory.FiniteSetTheory.html#2860" class="Function Operator">ᶠˢ</a><a id="12364" class="Symbol">)</a>


<a id="mkStakeDistrs"></a><a id="12368" href="Ledger.Conway.Specification.Epoch.html#12368" class="Function">mkStakeDistrs</a>
  <a id="12384" class="Symbol">:</a> <a id="12386" href="Ledger.Conway.Specification.Rewards.html#6499" class="Record">Snapshot</a>
  <a id="12397" class="Symbol">→</a> <a id="12399" href="Ledger.Core.Specification.Epoch.html#646" class="Function">Epoch</a>
  <a id="12407" class="Symbol">→</a> <a id="12409" href="Ledger.Conway.Specification.Utxo.html#1308" class="Record">UTxOState</a>
  <a id="12421" class="Symbol">→</a> <a id="12423" href="Ledger.Conway.Specification.Gov.html#1459" class="Function">GovState</a>
  <a id="12434" class="Symbol">→</a> <a id="12436" href="Ledger.Conway.Specification.Certs.html#4156" class="Record">GState</a>
  <a id="12445" class="Symbol">→</a> <a id="12447" href="Ledger.Conway.Specification.Certs.html#3893" class="Record">DState</a>
  <a id="12456" class="Symbol">→</a> <a id="12458" href="Ledger.Conway.Specification.Ratify.html#3115" class="Record">StakeDistrs</a>
<a id="12470" href="Ledger.Conway.Specification.Epoch.html#12368" class="Function">mkStakeDistrs</a> <a id="12484" href="Ledger.Conway.Specification.Epoch.html#12484" class="Bound">ss</a> <a id="12487" href="Ledger.Conway.Specification.Epoch.html#12487" class="Bound">currentEpoch</a> <a id="12500" href="Ledger.Conway.Specification.Epoch.html#12500" class="Bound">utxoSt</a> <a id="12507" href="Ledger.Conway.Specification.Epoch.html#12507" class="Bound">govSt</a> <a id="12513" href="Ledger.Conway.Specification.Epoch.html#12513" class="Bound">gState</a> <a id="12520" href="Ledger.Conway.Specification.Epoch.html#12520" class="Bound">dState</a> <a id="12527" class="Symbol">=</a>
  <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.Conway.Specification.Epoch.html#11733}{\htmlId{12533}{\htmlClass{Function}{\text{calculateVDelegDelegatedStake}}}}\, \,\href{Ledger.Conway.Specification.Epoch.html#12487}{\htmlId{12563}{\htmlClass{Bound}{\text{currentEpoch}}}}\, \,\href{Ledger.Conway.Specification.Epoch.html#12500}{\htmlId{12576}{\htmlClass{Bound}{\text{utxoSt}}}}\, \,\href{Ledger.Conway.Specification.Epoch.html#12507}{\htmlId{12583}{\htmlClass{Bound}{\text{govSt}}}}\, \,\href{Ledger.Conway.Specification.Epoch.html#12513}{\htmlId{12589}{\htmlClass{Bound}{\text{gState}}}}\, \,\href{Ledger.Conway.Specification.Epoch.html#12520}{\htmlId{12596}{\htmlClass{Bound}{\text{dState}}}}\,
  \\ \,\href{Ledger.Conway.Specification.Epoch.html#11930}{\htmlId{12607}{\htmlClass{Function}{\text{calculatePoolDelegatedStakeForVoting}}}}\, \,\href{Ledger.Conway.Specification.Epoch.html#12484}{\htmlId{12644}{\htmlClass{Bound}{\text{ss}}}}\, \,\href{Ledger.Conway.Specification.Epoch.html#12500}{\htmlId{12647}{\htmlClass{Bound}{\text{utxoSt}}}}\, \,\href{Ledger.Conway.Specification.Epoch.html#12507}{\htmlId{12654}{\htmlClass{Bound}{\text{govSt}}}}\, \end{pmatrix}$</a>


<a id="12664" class="Keyword">private</a> <a id="12672" class="Keyword">variable</a>
  <a id="12683" href="Ledger.Conway.Specification.Epoch.html#12683" class="Generalizable">e</a> <a id="12685" href="Ledger.Conway.Specification.Epoch.html#12685" class="Generalizable">lastEpoch</a> <a id="12695" class="Symbol">:</a> <a id="12697" href="Ledger.Core.Specification.Epoch.html#646" class="Function">Epoch</a>
  <a id="12705" href="Ledger.Conway.Specification.Epoch.html#12705" class="Generalizable">fut</a> <a id="12709" href="Ledger.Conway.Specification.Epoch.html#12709" class="Generalizable">fut&#39;</a> <a id="12714" class="Symbol">:</a> <a id="12716" href="Ledger.Conway.Specification.Ratify.html#3526" class="Record">RatifyState</a>
  <a id="12730" href="Ledger.Conway.Specification.Epoch.html#12730" class="Generalizable">poolReapState</a> <a id="12744" class="Symbol">:</a> <a id="12746" href="Ledger.Conway.Specification.PoolReap.html#402" class="Record">PoolReapState</a>
  <a id="12762" href="Ledger.Conway.Specification.Epoch.html#12762" class="Generalizable">eps</a> <a id="12766" href="Ledger.Conway.Specification.Epoch.html#12766" class="Generalizable">eps&#39;</a> <a id="12771" href="Ledger.Conway.Specification.Epoch.html#12771" class="Generalizable">eps&#39;&#39;</a> <a id="12777" class="Symbol">:</a> <a id="12779" href="Ledger.Conway.Specification.Epoch.html#1835" class="Record">EpochState</a>
  <a id="12792" href="Ledger.Conway.Specification.Epoch.html#12792" class="Generalizable">ls</a> <a id="12795" class="Symbol">:</a> <a id="12797" href="Ledger.Conway.Specification.Ledger.html#999" class="Record">LState</a>
  <a id="12806" href="Ledger.Conway.Specification.Epoch.html#12806" class="Generalizable">es₀</a> <a id="12810" class="Symbol">:</a> <a id="12812" href="Ledger.Conway.Specification.Enact.html#444" class="Record">EnactState</a>
  <a id="12825" href="Ledger.Conway.Specification.Epoch.html#12825" class="Generalizable">mark</a> <a id="12830" href="Ledger.Conway.Specification.Epoch.html#12830" class="Generalizable">set</a> <a id="12834" href="Ledger.Conway.Specification.Epoch.html#12834" class="Generalizable">go</a> <a id="12837" class="Symbol">:</a> <a id="12839" href="Ledger.Conway.Specification.Rewards.html#6499" class="Record">Snapshot</a>
  <a id="12850" href="Ledger.Conway.Specification.Epoch.html#12850" class="Generalizable">feeSS</a> <a id="12856" class="Symbol">:</a> <a id="12858" href="Ledger.Prelude.Base.html#186" class="Function">Fees</a>
  <a id="12865" href="Ledger.Conway.Specification.Epoch.html#12865" class="Generalizable">lstate</a> <a id="12872" class="Symbol">:</a> <a id="12874" href="Ledger.Conway.Specification.Ledger.html#999" class="Record">LState</a>
  <a id="12883" href="Ledger.Conway.Specification.Epoch.html#12883" class="Generalizable">pState&#39;&#39;</a> <a id="12892" class="Symbol">:</a> <a id="12894" href="Ledger.Conway.Specification.Certs.html#4044" class="Record">PState</a>
  <a id="12903" href="Ledger.Conway.Specification.Epoch.html#12903" class="Generalizable">dState&#39;</a> <a id="12911" class="Symbol">:</a> <a id="12913" href="Ledger.Conway.Specification.Certs.html#3893" class="Record">DState</a>
  <a id="12922" href="Ledger.Conway.Specification.Epoch.html#12922" class="Generalizable">acnt</a> <a id="12927" href="Ledger.Conway.Specification.Epoch.html#12927" class="Generalizable">acnt&#39;</a> <a id="12933" class="Symbol">:</a> <a id="12935" href="Ledger.Conway.Specification.PParams.html#718" class="Record">Acnt</a>
  <a id="12942" href="Ledger.Conway.Specification.Epoch.html#12942" class="Generalizable">utxoSt&#39;&#39;</a> <a id="12951" class="Symbol">:</a> <a id="12953" href="Ledger.Conway.Specification.Utxo.html#1308" class="Record">UTxOState</a>
  <a id="12965" href="Ledger.Conway.Specification.Epoch.html#12965" class="Generalizable">ss</a> <a id="12968" href="Ledger.Conway.Specification.Epoch.html#12968" class="Generalizable">ss&#39;</a> <a id="12972" class="Symbol">:</a> <a id="12974" href="Ledger.Conway.Specification.Rewards.html#7746" class="Record">Snapshots</a>
  <a id="12986" href="Ledger.Conway.Specification.Epoch.html#12986" class="Generalizable">ru</a> <a id="12989" class="Symbol">:</a> <a id="12991" href="Ledger.Conway.Specification.Rewards.html#6276" class="Record">RewardUpdate</a>
  <a id="13006" href="Ledger.Conway.Specification.Epoch.html#13006" class="Generalizable">mru</a> <a id="13010" class="Symbol">:</a> <a id="13012" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="13018" href="Ledger.Conway.Specification.Rewards.html#6276" class="Record">RewardUpdate</a>
  <a id="13033" href="Ledger.Conway.Specification.Epoch.html#13033" class="Generalizable">pd</a> <a id="13036" class="Symbol">:</a> <a id="13038" href="Ledger.Conway.Specification.Epoch.html#3292" class="Function">PoolDelegatedStake</a>


<a id="getOrphans"></a><a id="13059" href="Ledger.Conway.Specification.Epoch.html#13059" class="Function">getOrphans</a> <a id="13070" class="Symbol">:</a> <a id="13072" href="Ledger.Conway.Specification.Enact.html#444" class="Record">EnactState</a> <a id="13083" class="Symbol">→</a> <a id="13085" href="Ledger.Conway.Specification.Gov.html#1459" class="Function">GovState</a> <a id="13094" class="Symbol">→</a> <a id="13096" href="Ledger.Conway.Specification.Gov.html#1459" class="Function">GovState</a>
<a id="13105" href="Ledger.Conway.Specification.Epoch.html#13059" class="Function">getOrphans</a> <a id="13116" href="Ledger.Conway.Specification.Epoch.html#13116" class="Bound">es</a> <a id="13119" href="Ledger.Conway.Specification.Epoch.html#13119" class="Bound">govSt</a> <a id="13125" class="Symbol">=</a> <a id="13127" href="Data.Product.Base.html#636" class="Field">proj₁</a> <a id="13133" href="Function.Base.html#1993" class="Function Operator">$</a> <a id="13135" href="Data.Nat.GeneralisedArithmetic.html#866" class="Function">iterate</a> <a id="13143" href="Ledger.Conway.Specification.Epoch.html#13188" class="Function">step</a> <a id="13148" class="Symbol">(</a><a id="13149" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a> <a id="13152" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="13154" href="Ledger.Conway.Specification.Epoch.html#13119" class="Bound">govSt</a><a id="13159" class="Symbol">)</a> <a id="13161" class="Symbol">(</a><a id="13162" href="Data.List.Base.html#4746" class="Function">length</a> <a id="13169" href="Ledger.Conway.Specification.Epoch.html#13119" class="Bound">govSt</a><a id="13174" class="Symbol">)</a>
  <a id="13178" class="Keyword">where</a>
    <a id="13188" href="Ledger.Conway.Specification.Epoch.html#13188" class="Function">step</a> <a id="13193" class="Symbol">:</a> <a id="13195" href="Ledger.Conway.Specification.Gov.html#1459" class="Function">GovState</a> <a id="13204" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="13206" href="Ledger.Conway.Specification.Gov.html#1459" class="Function">GovState</a> <a id="13215" class="Symbol">→</a> <a id="13217" href="Ledger.Conway.Specification.Gov.html#1459" class="Function">GovState</a> <a id="13226" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="13228" href="Ledger.Conway.Specification.Gov.html#1459" class="Function">GovState</a>
    <a id="13241" href="Ledger.Conway.Specification.Epoch.html#13188" class="Function">step</a> <a id="13246" class="Symbol">(</a><a id="13247" href="Ledger.Conway.Specification.Epoch.html#13247" class="Bound">orps</a> <a id="13252" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="13254" href="Ledger.Conway.Specification.Epoch.html#13254" class="Bound">govSt</a><a id="13259" class="Symbol">)</a> <a id="13261" class="Symbol">=</a>
      <a id="13269" class="Keyword">let</a>
        <a id="13281" href="Ledger.Conway.Specification.Epoch.html#13281" class="Bound">isOrphan?</a> <a id="13291" href="Ledger.Conway.Specification.Epoch.html#13291" class="Bound">a</a> <a id="13293" href="Ledger.Conway.Specification.Epoch.html#13293" class="Bound">prev</a> <a id="13298" class="Symbol">=</a> <a id="13300" href="Relation.Nullary.Decidable.Core.html#3277" class="Function">¬?</a> <a id="13303" class="Symbol">(</a><a id="13304" href="Ledger.Conway.Specification.Gov.html#9825" class="Function">hasParent?</a> <a id="13315" href="Ledger.Conway.Specification.Epoch.html#13116" class="Bound">es</a> <a id="13318" href="Ledger.Conway.Specification.Epoch.html#13254" class="Bound">govSt</a> <a id="13324" href="Ledger.Conway.Specification.Epoch.html#13291" class="Bound">a</a> <a id="13326" href="Ledger.Conway.Specification.Epoch.html#13293" class="Bound">prev</a><a id="13330" class="Symbol">)</a>
        <a id="13340" class="Symbol">(</a><a id="13341" href="Ledger.Conway.Specification.Epoch.html#13341" class="Bound">orps&#39;</a> <a id="13347" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="13349" href="Ledger.Conway.Specification.Epoch.html#13349" class="Bound">govSt&#39;</a><a id="13355" class="Symbol">)</a> <a id="13357" class="Symbol">=</a> <a id="13359" href="Data.List.Base.html#10628" class="Function">partition</a>
          <a id="13379" class="Symbol">(λ</a> <a id="13382" class="Symbol">(_</a> <a id="13385" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="13387" class="Keyword">record</a> <a id="13394" class="Symbol">{</a><a id="13395" href="Ledger.Core.Specification.Gov.Actions.html#3928" class="Field">action</a> <a id="13402" class="Symbol">=</a> <a id="13404" href="Ledger.Conway.Specification.Epoch.html#13404" class="Bound">a</a> <a id="13406" class="Symbol">;</a> <a id="13408" href="Ledger.Core.Specification.Gov.Actions.html#3956" class="Field">prevAction</a> <a id="13419" class="Symbol">=</a> <a id="13421" href="Ledger.Conway.Specification.Epoch.html#13421" class="Bound">prev</a><a id="13425" class="Symbol">})</a> <a id="13428" class="Symbol">→</a> <a id="13430" href="Ledger.Conway.Specification.Epoch.html#13281" class="Bound">isOrphan?</a> <a id="13440" class="Symbol">(</a><a id="13441" href="Ledger.Conway.Specification.Epoch.html#13404" class="Bound">a</a> <a id="13443" class="Symbol">.</a><a id="13444" href="Ledger.Core.Specification.Gov.Actions.html#1510" class="Field">gaType</a><a id="13450" class="Symbol">)</a> <a id="13452" href="Ledger.Conway.Specification.Epoch.html#13421" class="Bound">prev</a><a id="13456" class="Symbol">)</a>
          <a id="13468" href="Ledger.Conway.Specification.Epoch.html#13254" class="Bound">govSt</a>
      <a id="13480" class="Keyword">in</a>
        <a id="13491" class="Symbol">(</a><a id="13492" href="Ledger.Conway.Specification.Epoch.html#13247" class="Bound">orps</a> <a id="13497" href="Data.List.Base.html#1712" class="Function Operator">++</a> <a id="13500" href="Ledger.Conway.Specification.Epoch.html#13341" class="Bound">orps&#39;</a> <a id="13506" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="13508" href="Ledger.Conway.Specification.Epoch.html#13349" class="Bound">govSt&#39;</a><a id="13514" class="Symbol">)</a>

<a id="13517" class="Keyword">record</a> <a id="Governance-Update"></a><a id="13524" href="Ledger.Conway.Specification.Epoch.html#13524" class="Record">Governance-Update</a> <a id="13542" class="Symbol">:</a> <a id="13544" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="13549" class="Keyword">where</a>
  <a id="13557" class="Keyword">constructor</a> <a id="GovernanceUpdate"></a><a id="13569" href="Ledger.Conway.Specification.Epoch.html#13569" class="InductiveConstructor">GovernanceUpdate</a>
  <a id="13588" class="Keyword">field</a>
    <a id="Governance-Update.removedGovActions"></a><a id="13598" href="Ledger.Conway.Specification.Epoch.html#13598" class="Field">removedGovActions</a> <a id="13616" class="Symbol">:</a> <a id="13618" href="abstract-set-theory.FiniteSetTheory.html#488" class="Function Operator">ℙ</a> <a id="13620" class="Symbol">(</a><a id="13621" href="Ledger.Core.Specification.Address.html#1313" class="Record">RwdAddr</a> <a id="13629" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="13631" href="Ledger.Conway.Specification.Certs.html#561" class="Datatype">DepositPurpose</a> <a id="13646" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="13648" href="Ledger.Prelude.Base.html#154" class="Function">Coin</a><a id="13652" class="Symbol">)</a>
    <a id="Governance-Update.govSt&#39;"></a><a id="13658" href="Ledger.Conway.Specification.Epoch.html#13658" class="Field">govSt&#39;</a>            <a id="13676" class="Symbol">:</a> <a id="13678" href="Ledger.Conway.Specification.Gov.html#1459" class="Function">GovState</a>

<a id="13688" class="Keyword">module</a> <a id="GovernanceUpdate"></a><a id="13695" href="Ledger.Conway.Specification.Epoch.html#13695" class="Module">GovernanceUpdate</a> <a id="13712" class="Symbol">(</a><a id="13713" href="Ledger.Conway.Specification.Epoch.html#13713" class="Bound">ls</a> <a id="13716" class="Symbol">:</a> <a id="13718" href="Ledger.Conway.Specification.Ledger.html#999" class="Record">LState</a><a id="13724" class="Symbol">)</a>
                        <a id="13750" class="Symbol">(</a><a id="13751" href="Ledger.Conway.Specification.Epoch.html#13751" class="Bound">fut</a> <a id="13755" class="Symbol">:</a> <a id="13757" href="Ledger.Conway.Specification.Ratify.html#3526" class="Record">RatifyState</a><a id="13768" class="Symbol">)</a>
                        <a id="13794" class="Keyword">where</a>


  <a id="13804" class="Keyword">open</a> <a id="13809" href="Ledger.Conway.Specification.Ledger.html#999" class="Module">LState</a> <a id="13816" href="Ledger.Conway.Specification.Epoch.html#13713" class="Bound">ls</a>
  <a id="13821" class="Keyword">open</a> <a id="13826" href="Ledger.Conway.Specification.Ratify.html#3526" class="Module">RatifyState</a> <a id="13838" href="Ledger.Conway.Specification.Epoch.html#13751" class="Bound">fut</a>


  <a id="GovernanceUpdate.tmpGovSt"></a><a id="13846" href="Ledger.Conway.Specification.Epoch.html#13846" class="Function">tmpGovSt</a> <a id="13855" class="Symbol">:</a> <a id="13857" href="Ledger.Conway.Specification.Gov.html#1459" class="Function">GovState</a>
  <a id="13868" href="Ledger.Conway.Specification.Epoch.html#13846" class="Function">tmpGovSt</a> <a id="13877" class="Symbol">=</a> <a id="13879" href="Ledger.Prelude.html#2451" class="Function">filter</a> <a id="13886" class="Symbol">(λ</a> <a id="13889" href="Ledger.Conway.Specification.Epoch.html#13889" class="Bound">x</a> <a id="13891" class="Symbol">→</a> <a id="13893" href="Data.Product.Base.html#636" class="Field">proj₁</a> <a id="13899" href="Ledger.Conway.Specification.Epoch.html#13889" class="Bound">x</a> <a id="13901" href="Class.IsSet.html#462" class="Function Operator">∉</a> <a id="13903" href="abstract-set-theory.FiniteSetTheory.html#519" class="Function">mapˢ</a> <a id="13908" href="Data.Product.Base.html#636" class="Field">proj₁</a> <a id="13914" href="Ledger.Conway.Specification.Ratify.html#3589" class="Field">removed</a><a id="13921" class="Symbol">)</a> <a id="13923" href="Ledger.Conway.Specification.Ledger.html#1085" class="Function">govSt</a>

  <a id="GovernanceUpdate.orphans"></a><a id="13932" href="Ledger.Conway.Specification.Epoch.html#13932" class="Function">orphans</a> <a id="13940" class="Symbol">:</a> <a id="13942" href="abstract-set-theory.FiniteSetTheory.html#488" class="Function Operator">ℙ</a> <a id="13944" class="Symbol">(</a><a id="13945" href="Ledger.Core.Specification.Gov.Actions.html#1975" class="Function">GovActionID</a> <a id="13957" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="13959" href="Ledger.Core.Specification.Gov.Actions.html#3811" class="Record">GovActionState</a><a id="13973" class="Symbol">)</a>
  <a id="13977" href="Ledger.Conway.Specification.Epoch.html#13932" class="Function">orphans</a>  <a id="13986" class="Symbol">=</a> <a id="13988" href="Axiom.Set.html#5903" class="Function">fromList</a> <a id="13997" class="Symbol">(</a><a id="13998" href="Ledger.Conway.Specification.Epoch.html#13059" class="Function">getOrphans</a> <a id="14009" href="Ledger.Conway.Specification.Ratify.html#3563" class="Field">es</a> <a id="14012" href="Ledger.Conway.Specification.Epoch.html#13846" class="Function">tmpGovSt</a><a id="14020" class="Symbol">)</a>

  <a id="GovernanceUpdate.removed&#39;"></a><a id="14025" href="Ledger.Conway.Specification.Epoch.html#14025" class="Function">removed&#39;</a> <a id="14034" class="Symbol">:</a> <a id="14036" href="abstract-set-theory.FiniteSetTheory.html#488" class="Function Operator">ℙ</a> <a id="14038" class="Symbol">(</a><a id="14039" href="Ledger.Core.Specification.Gov.Actions.html#1975" class="Function">GovActionID</a> <a id="14051" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="14053" href="Ledger.Core.Specification.Gov.Actions.html#3811" class="Record">GovActionState</a><a id="14067" class="Symbol">)</a>
  <a id="14071" href="Ledger.Conway.Specification.Epoch.html#14025" class="Function">removed&#39;</a> <a id="14080" class="Symbol">=</a> <a id="14082" href="Ledger.Conway.Specification.Ratify.html#3589" class="Field">removed</a> <a id="14090" href="Axiom.Set.html#9137" class="Function Operator">∪</a> <a id="14092" href="Ledger.Conway.Specification.Epoch.html#13932" class="Function">orphans</a>

  <a id="GovernanceUpdate.removedGovActions"></a><a id="14103" href="Ledger.Conway.Specification.Epoch.html#14103" class="Function">removedGovActions</a> <a id="14121" class="Symbol">:</a> <a id="14123" href="abstract-set-theory.FiniteSetTheory.html#488" class="Function Operator">ℙ</a> <a id="14125" class="Symbol">(</a><a id="14126" href="Ledger.Core.Specification.Address.html#1313" class="Record">RwdAddr</a> <a id="14134" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="14136" href="Ledger.Conway.Specification.Certs.html#561" class="Datatype">DepositPurpose</a> <a id="14151" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="14153" href="Ledger.Prelude.Base.html#154" class="Function">Coin</a><a id="14157" class="Symbol">)</a>
  <a id="14161" href="Ledger.Conway.Specification.Epoch.html#14103" class="Function">removedGovActions</a> <a id="14179" class="Symbol">=</a>
    <a id="14185" href="Function.Base.html#1657" class="Function">flip</a> <a id="14190" href="Axiom.Set.html#7207" class="Function">concatMapˢ</a> <a id="14201" href="Ledger.Conway.Specification.Epoch.html#14025" class="Function">removed&#39;</a> <a id="14210" class="Symbol">λ</a> <a id="14212" class="Symbol">(</a><a id="14213" href="Ledger.Conway.Specification.Epoch.html#14213" class="Bound">gaid</a> <a id="14218" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="14220" href="Ledger.Conway.Specification.Epoch.html#14220" class="Bound">gaSt</a><a id="14224" class="Symbol">)</a> <a id="14226" class="Symbol">→</a>
      <a id="14234" href="abstract-set-theory.FiniteSetTheory.html#519" class="Function">mapˢ</a>
        <a id="14247" class="Symbol">(</a><a id="14248" href="Ledger.Core.Specification.Gov.Actions.html#3878" class="Field">returnAddr</a> <a id="14259" href="Ledger.Conway.Specification.Epoch.html#14220" class="Bound">gaSt</a> <a id="14264" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,_</a><a id="14266" class="Symbol">)</a>
        <a id="14276" class="Symbol">((</a><a id="14278" href="Ledger.Conway.Specification.Certs.html#912" class="Field">DepositsOf</a> <a id="14289" href="Ledger.Conway.Specification.Ledger.html#1058" class="Function">utxoSt</a> <a id="14296" href="Axiom.Set.Map.html#13534" class="Function Operator">∣</a> <a id="14298" href="Class.HasSingleton.html#288" class="Field Operator">❴</a> <a id="14300" href="Ledger.Conway.Specification.Certs.html#750" class="InductiveConstructor">GovActionDeposit</a> <a id="14317" href="Ledger.Conway.Specification.Epoch.html#14213" class="Bound">gaid</a> <a id="14322" href="Class.HasSingleton.html#288" class="Field Operator">❵</a><a id="14323" class="Symbol">)</a> <a id="14325" href="Axiom.Set.Map.html#2293" class="Function Operator">ˢ</a><a id="14326" class="Symbol">)</a>

  <a id="GovernanceUpdate.govSt&#39;"></a><a id="14331" href="Ledger.Conway.Specification.Epoch.html#14331" class="Function">govSt&#39;</a> <a id="14338" class="Symbol">:</a> <a id="14340" href="Ledger.Conway.Specification.Gov.html#1459" class="Function">GovState</a>
  <a id="14351" href="Ledger.Conway.Specification.Epoch.html#14331" class="Function">govSt&#39;</a> <a id="14358" class="Symbol">=</a> <a id="14360" href="Ledger.Prelude.html#2451" class="Function">filter</a> <a id="14367" class="Symbol">(λ</a> <a id="14370" href="Ledger.Conway.Specification.Epoch.html#14370" class="Bound">x</a> <a id="14372" class="Symbol">→</a> <a id="14374" href="Data.Product.Base.html#636" class="Field">proj₁</a> <a id="14380" href="Ledger.Conway.Specification.Epoch.html#14370" class="Bound">x</a> <a id="14382" href="Class.IsSet.html#462" class="Function Operator">∉</a> <a id="14384" href="abstract-set-theory.FiniteSetTheory.html#519" class="Function">mapˢ</a> <a id="14389" href="Data.Product.Base.html#636" class="Field">proj₁</a> <a id="14395" href="Ledger.Conway.Specification.Epoch.html#14025" class="Function">removed&#39;</a><a id="14403" class="Symbol">)</a> <a id="14405" href="Ledger.Conway.Specification.Ledger.html#1085" class="Function">govSt</a>

  <a id="GovernanceUpdate.updates"></a><a id="14414" href="Ledger.Conway.Specification.Epoch.html#14414" class="Function">updates</a> <a id="14422" class="Symbol">:</a> <a id="14424" href="Ledger.Conway.Specification.Epoch.html#13524" class="Record">Governance-Update</a>
  <a id="14444" href="Ledger.Conway.Specification.Epoch.html#14414" class="Function">updates</a> <a id="14452" class="Symbol">=</a> <a id="14454" href="Ledger.Conway.Specification.Epoch.html#13569" class="InductiveConstructor">GovernanceUpdate</a> <a id="14471" href="Ledger.Conway.Specification.Epoch.html#14103" class="Function">removedGovActions</a> <a id="14489" href="Ledger.Conway.Specification.Epoch.html#14331" class="Function">govSt&#39;</a>

<a id="14497" class="Keyword">record</a> <a id="Pre-POOLREAP-Update"></a><a id="14504" href="Ledger.Conway.Specification.Epoch.html#14504" class="Record">Pre-POOLREAP-Update</a> <a id="14524" class="Symbol">:</a> <a id="14526" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="14531" class="Keyword">where</a>
  <a id="14539" class="Keyword">inductive</a>
  <a id="14551" class="Keyword">constructor</a> <a id="Pre-POOLREAPUpdate"></a><a id="14563" href="Ledger.Conway.Specification.Epoch.html#14563" class="InductiveConstructor">Pre-POOLREAPUpdate</a>
  <a id="14584" class="Keyword">field</a>
    <a id="Pre-POOLREAP-Update.pState&#39;"></a><a id="14594" href="Ledger.Conway.Specification.Epoch.html#14594" class="Field">pState&#39;</a> <a id="14602" class="Symbol">:</a> <a id="14604" href="Ledger.Conway.Specification.Certs.html#4044" class="Record">PState</a>
    <a id="Pre-POOLREAP-Update.gState&#39;"></a><a id="14615" href="Ledger.Conway.Specification.Epoch.html#14615" class="Field">gState&#39;</a> <a id="14623" class="Symbol">:</a> <a id="14625" href="Ledger.Conway.Specification.Certs.html#4156" class="Record">GState</a>
    <a id="Pre-POOLREAP-Update.utxoSt&#39;"></a><a id="14636" href="Ledger.Conway.Specification.Epoch.html#14636" class="Field">utxoSt&#39;</a> <a id="14644" class="Symbol">:</a> <a id="14646" href="Ledger.Conway.Specification.Utxo.html#1308" class="Record">UTxOState</a>

<a id="14657" class="Keyword">module</a> <a id="Pre-POOLREAPUpdate"></a><a id="14664" href="Ledger.Conway.Specification.Epoch.html#14664" class="Module">Pre-POOLREAPUpdate</a> <a id="14683" class="Symbol">(</a><a id="14684" href="Ledger.Conway.Specification.Epoch.html#14684" class="Bound">ls</a> <a id="14687" class="Symbol">:</a> <a id="14689" href="Ledger.Conway.Specification.Ledger.html#999" class="Record">LState</a><a id="14695" class="Symbol">)</a>
                          <a id="14723" class="Symbol">(</a><a id="14724" href="Ledger.Conway.Specification.Epoch.html#14724" class="Bound">es</a> <a id="14727" class="Symbol">:</a> <a id="14729" href="Ledger.Conway.Specification.Enact.html#444" class="Record">EnactState</a><a id="14739" class="Symbol">)</a>
                          <a id="14767" class="Symbol">(</a><a id="14768" href="Ledger.Conway.Specification.Epoch.html#14768" class="Bound">govUpdate</a> <a id="14778" class="Symbol">:</a> <a id="14780" href="Ledger.Conway.Specification.Epoch.html#13524" class="Record">Governance-Update</a><a id="14797" class="Symbol">)</a>
                          <a id="14825" class="Keyword">where</a>


  <a id="14835" class="Keyword">open</a> <a id="14840" href="Ledger.Conway.Specification.Ledger.html#999" class="Module">LState</a> <a id="14847" href="Ledger.Conway.Specification.Epoch.html#14684" class="Bound">ls</a>
  <a id="14852" class="Keyword">open</a> <a id="14857" href="Ledger.Conway.Specification.Certs.html#4287" class="Module">CertState</a> <a id="14867" href="Ledger.Conway.Specification.Ledger.html#1111" class="Function">certState</a> <a id="14877" class="Keyword">using</a> <a id="14883" class="Symbol">(</a><a id="14884" href="Ledger.Conway.Specification.Certs.html#4370" class="Field">pState</a><a id="14890" class="Symbol">;</a> <a id="14892" href="Ledger.Conway.Specification.Certs.html#4390" class="Field">gState</a><a id="14898" class="Symbol">)</a>
  <a id="14902" class="Keyword">open</a> <a id="14907" href="Ledger.Conway.Specification.Certs.html#4044" class="Module">PState</a> <a id="14914" href="Ledger.Conway.Specification.Certs.html#4370" class="Function">pState</a>
  <a id="14923" class="Keyword">open</a> <a id="14928" href="Ledger.Conway.Specification.Epoch.html#13524" class="Module">Governance-Update</a> <a id="14946" href="Ledger.Conway.Specification.Epoch.html#14768" class="Bound">govUpdate</a>


  <a id="Pre-POOLREAPUpdate.utxoSt&#39;"></a><a id="14960" href="Ledger.Conway.Specification.Epoch.html#14960" class="Function">utxoSt&#39;</a> <a id="14968" class="Symbol">:</a> <a id="14970" href="Ledger.Conway.Specification.Utxo.html#1308" class="Record">UTxOState</a>
  <a id="14982" href="Ledger.Conway.Specification.Epoch.html#14960" class="Function">utxoSt&#39;</a> <a id="14990" class="Symbol">=</a> <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.Core.Specification.Transaction.html#2830}{\htmlId{14994}{\htmlClass{Field}{\text{UTxOOf}}}}\, \,\href{Ledger.Conway.Specification.Ledger.html#1058}{\htmlId{15001}{\htmlClass{Function}{\text{utxoSt}}}}\, \\ \,\href{Ledger.Prelude.Base.html#669}{\htmlId{15010}{\htmlClass{Field}{\text{FeesOf}}}}\, \,\href{Ledger.Conway.Specification.Ledger.html#1058}{\htmlId{15017}{\htmlClass{Function}{\text{utxoSt}}}}\, \\ \,\href{Ledger.Conway.Specification.Certs.html#912}{\htmlId{15026}{\htmlClass{Field}{\text{DepositsOf}}}}\, \,\href{Ledger.Conway.Specification.Ledger.html#1058}{\htmlId{15037}{\htmlClass{Function}{\text{utxoSt}}}}\, \,\href{Axiom.Set.Map.html#13604}{\htmlId{15044}{\htmlClass{Function Operator}{\text{∣}}}}\, \,\href{abstract-set-theory.FiniteSetTheory.html#519}{\htmlId{15046}{\htmlClass{Function}{\text{mapˢ}}}}\, \,\htmlId{15051}{\htmlClass{Symbol}{\text{(}}}\,\,\href{Data.Product.Base.html#636}{\htmlId{15052}{\htmlClass{Field}{\text{proj₁}}}}\, \,\href{Function.Base.html#1134}{\htmlId{15058}{\htmlClass{Function Operator}{\text{∘}}}}\, \,\href{Data.Product.Base.html#650}{\htmlId{15060}{\htmlClass{Field}{\text{proj₂}}}}\,\,\htmlId{15065}{\htmlClass{Symbol}{\text{)}}}\, \,\href{Ledger.Conway.Specification.Epoch.html#13598}{\htmlId{15067}{\htmlClass{Field}{\text{removedGovActions}}}}\, \,\href{Axiom.Set.Map.html#13604}{\htmlId{15085}{\htmlClass{Function Operator}{\text{ᶜ}}}}\, \\ \,\htmlId{15089}{\htmlClass{Number}{\text{0}}}\, \end{pmatrix}$</a>

  <a id="Pre-POOLREAPUpdate.pState&#39;"></a><a id="15096" href="Ledger.Conway.Specification.Epoch.html#15096" class="Function">pState&#39;</a> <a id="15104" class="Symbol">:</a> <a id="15106" href="Ledger.Conway.Specification.Certs.html#4044" class="Record">PState</a>
  <a id="15115" href="Ledger.Conway.Specification.Epoch.html#15096" class="Function">pState&#39;</a> <a id="15123" class="Symbol">=</a> <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.Conway.Specification.Certs.html#4098}{\htmlId{15127}{\htmlClass{Function}{\text{fPools}}}}\, \,\href{Axiom.Set.Map.html#7638}{\htmlId{15134}{\htmlClass{Function Operator}{\text{∪ˡ}}}}\, \,\href{Ledger.Conway.Specification.Certs.html#4076}{\htmlId{15137}{\htmlClass{Function}{\text{pools}}}}\, \\ \,\href{Class.HasEmptySet.html#287}{\htmlId{15145}{\htmlClass{Field}{\text{∅}}}}\, \\ \,\href{Ledger.Conway.Specification.Certs.html#4120}{\htmlId{15149}{\htmlClass{Function}{\text{retiring}}}}\, \end{pmatrix}$</a>

  <a id="Pre-POOLREAPUpdate.gState&#39;"></a><a id="15163" href="Ledger.Conway.Specification.Epoch.html#15163" class="Function">gState&#39;</a> <a id="15171" class="Symbol">:</a> <a id="15173" href="Ledger.Conway.Specification.Certs.html#4156" class="Record">GState</a>
  <a id="15182" href="Ledger.Conway.Specification.Epoch.html#15163" class="Function">gState&#39;</a> <a id="15190" class="Symbol">=</a>
    <a class="AgdaKaTeX">$\begin{pmatrix} \,\htmlId{15198}{\htmlClass{Symbol}{\text{(}}}\,\,\href{Class.ToBool.html#342}{\htmlId{15199}{\htmlClass{Function Operator}{\text{if}}}}\, \,\href{Data.List.Base.html#4681}{\htmlId{15202}{\htmlClass{Function}{\text{null}}}}\, \,\href{Ledger.Conway.Specification.Epoch.html#13658}{\htmlId{15207}{\htmlClass{Field}{\text{govSt&#39;}}}}\, \,\href{Class.ToBool.html#342}{\htmlId{15214}{\htmlClass{Function Operator}{\text{then}}}}\, \,\href{Axiom.Set.Map.html#7106}{\htmlId{15219}{\htmlClass{Function}{\text{mapValues}}}}\, \,\href{Ledger.Core.Specification.Epoch.html#1054}{\htmlId{15229}{\htmlClass{Function}{\text{sucᵉ}}}}\, \,\htmlId{15234}{\htmlClass{Symbol}{\text{(}}}\,\,\href{Ledger.Conway.Specification.Certs.html#1599}{\htmlId{15235}{\htmlClass{Field}{\text{DRepsOf}}}}\, \,\href{Ledger.Conway.Specification.Certs.html#4390}{\htmlId{15243}{\htmlClass{Function}{\text{gState}}}}\,\,\htmlId{15249}{\htmlClass{Symbol}{\text{)}}}\, \,\href{Class.ToBool.html#342}{\htmlId{15251}{\htmlClass{Function Operator}{\text{else}}}}\, \,\href{Ledger.Conway.Specification.Certs.html#1599}{\htmlId{15256}{\htmlClass{Field}{\text{DRepsOf}}}}\, \,\href{Ledger.Conway.Specification.Certs.html#4390}{\htmlId{15264}{\htmlClass{Function}{\text{gState}}}}\,\,\htmlId{15270}{\htmlClass{Symbol}{\text{)}}}\,
    \\ \,\href{Ledger.Conway.Specification.Certs.html#1514}{\htmlId{15278}{\htmlClass{Field}{\text{CCHotKeysOf}}}}\, \,\href{Ledger.Conway.Specification.Certs.html#4390}{\htmlId{15290}{\htmlClass{Function}{\text{gState}}}}\, \,\href{Axiom.Set.Map.html#13534}{\htmlId{15297}{\htmlClass{Function Operator}{\text{∣}}}}\, \,\href{Ledger.Conway.Specification.Enact.html#1362}{\htmlId{15299}{\htmlClass{Function}{\text{ccCreds}}}}\, \,\htmlId{15307}{\htmlClass{Symbol}{\text{(}}}\,\,\href{Ledger.Conway.Specification.Enact.html#480}{\htmlId{15308}{\htmlClass{Field}{\text{EnactState.cc}}}}\, \,\href{Ledger.Conway.Specification.Epoch.html#14724}{\htmlId{15322}{\htmlClass{Bound}{\text{es}}}}\,\,\htmlId{15324}{\htmlClass{Symbol}{\text{)}}}\,
    \end{pmatrix}$</a>

  <a id="Pre-POOLREAPUpdate.updates"></a><a id="15335" href="Ledger.Conway.Specification.Epoch.html#15335" class="Function">updates</a> <a id="15343" class="Symbol">:</a> <a id="15345" href="Ledger.Conway.Specification.Epoch.html#14504" class="Record">Pre-POOLREAP-Update</a>
  <a id="15367" href="Ledger.Conway.Specification.Epoch.html#15335" class="Function">updates</a> <a id="15375" class="Symbol">=</a> <a id="15377" href="Ledger.Conway.Specification.Epoch.html#14563" class="InductiveConstructor">Pre-POOLREAPUpdate</a> <a id="15396" href="Ledger.Conway.Specification.Epoch.html#15096" class="Function">pState&#39;</a> <a id="15404" href="Ledger.Conway.Specification.Epoch.html#15163" class="Function">gState&#39;</a> <a id="15412" href="Ledger.Conway.Specification.Epoch.html#14960" class="Function">utxoSt&#39;</a>

<a id="15421" class="Keyword">record</a> <a id="Post-POOLREAP-Update"></a><a id="15428" href="Ledger.Conway.Specification.Epoch.html#15428" class="Record">Post-POOLREAP-Update</a> <a id="15449" class="Symbol">:</a> <a id="15451" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="15456" class="Keyword">where</a>
  <a id="15464" class="Keyword">inductive</a>
  <a id="15476" class="Keyword">constructor</a> <a id="Post-POOLREAPUpdate"></a><a id="15488" href="Ledger.Conway.Specification.Epoch.html#15488" class="InductiveConstructor">Post-POOLREAPUpdate</a>
  <a id="15510" class="Keyword">field</a>
    <a id="Post-POOLREAP-Update.dState&#39;&#39;"></a><a id="15520" href="Ledger.Conway.Specification.Epoch.html#15520" class="Field">dState&#39;&#39;</a>       <a id="15535" class="Symbol">:</a> <a id="15537" href="Ledger.Conway.Specification.Certs.html#3893" class="Record">DState</a>
    <a id="Post-POOLREAP-Update.acnt&#39;&#39;"></a><a id="15548" href="Ledger.Conway.Specification.Epoch.html#15548" class="Field">acnt&#39;&#39;</a>         <a id="15563" class="Symbol">:</a> <a id="15565" href="Ledger.Conway.Specification.PParams.html#718" class="Record">Acnt</a>

<a id="15571" class="Keyword">module</a> <a id="Post-POOLREAPUpdate"></a><a id="15578" href="Ledger.Conway.Specification.Epoch.html#15578" class="Module">Post-POOLREAPUpdate</a> <a id="15598" class="Symbol">(</a><a id="15599" href="Ledger.Conway.Specification.Epoch.html#15599" class="Bound">es</a> <a id="15602" class="Symbol">:</a> <a id="15604" href="Ledger.Conway.Specification.Enact.html#444" class="Record">EnactState</a><a id="15614" class="Symbol">)</a>
                           <a id="15643" class="Symbol">(</a><a id="15644" href="Ledger.Conway.Specification.Epoch.html#15644" class="Bound">ls</a> <a id="15647" class="Symbol">:</a> <a id="15649" href="Ledger.Conway.Specification.Ledger.html#999" class="Record">LState</a><a id="15655" class="Symbol">)</a>
                           <a id="15684" class="Symbol">(</a><a id="15685" href="Ledger.Conway.Specification.Epoch.html#15685" class="Bound">dState&#39;</a> <a id="15693" class="Symbol">:</a> <a id="15695" href="Ledger.Conway.Specification.Certs.html#3893" class="Record">DState</a><a id="15701" class="Symbol">)</a>
                           <a id="15730" class="Symbol">(</a><a id="15731" href="Ledger.Conway.Specification.Epoch.html#15731" class="Bound">acnt&#39;</a> <a id="15737" class="Symbol">:</a> <a id="15739" href="Ledger.Conway.Specification.PParams.html#718" class="Record">Acnt</a><a id="15743" class="Symbol">)</a>
                           <a id="15772" class="Symbol">(</a><a id="15773" href="Ledger.Conway.Specification.Epoch.html#15773" class="Bound">govUpd</a> <a id="15780" class="Symbol">:</a> <a id="15782" href="Ledger.Conway.Specification.Epoch.html#13524" class="Record">Governance-Update</a><a id="15799" class="Symbol">)</a>
                           <a id="15828" class="Keyword">where</a>


  <a id="15838" class="Keyword">open</a> <a id="15843" href="Ledger.Conway.Specification.Ledger.html#999" class="Module">LState</a>
  <a id="15852" class="Keyword">open</a> <a id="15857" href="Ledger.Conway.Specification.Epoch.html#13524" class="Module">Governance-Update</a> <a id="15875" href="Ledger.Conway.Specification.Epoch.html#15773" class="Bound">govUpd</a>


  <a id="15886" class="Keyword">opaque</a>
    <a id="Post-POOLREAPUpdate.govActionReturns"></a><a id="15897" href="Ledger.Conway.Specification.Epoch.html#15897" class="Function">govActionReturns</a> <a id="15914" class="Symbol">:</a> <a id="15916" href="Ledger.Core.Specification.Address.html#1313" class="Record">RwdAddr</a> <a id="15924" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="15926" href="Ledger.Prelude.Base.html#154" class="Function">Coin</a>
    <a id="15935" href="Ledger.Conway.Specification.Epoch.html#15897" class="Function">govActionReturns</a> <a id="15952" class="Symbol">=</a>
      <a id="15960" href="Axiom.Set.Map.Dec.html#2130" class="Function">aggregate₊</a> <a id="15971" class="Symbol">(</a><a id="15972" href="abstract-set-theory.FiniteSetTheory.html#519" class="Function">mapˢ</a> <a id="15977" class="Symbol">(λ</a> <a id="15980" class="Symbol">(</a><a id="15981" href="Ledger.Conway.Specification.Epoch.html#15981" class="Bound">a</a> <a id="15983" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="15985" class="Symbol">_</a> <a id="15987" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="15989" href="Ledger.Conway.Specification.Epoch.html#15989" class="Bound">d</a><a id="15990" class="Symbol">)</a> <a id="15992" class="Symbol">→</a> <a id="15994" href="Ledger.Conway.Specification.Epoch.html#15981" class="Bound">a</a> <a id="15996" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="15998" href="Ledger.Conway.Specification.Epoch.html#15989" class="Bound">d</a><a id="15999" class="Symbol">)</a> <a id="16001" href="Ledger.Conway.Specification.Epoch.html#13598" class="Field">removedGovActions</a> <a id="16019" href="abstract-set-theory.FiniteSetTheory.html#2860" class="Function Operator">ᶠˢ</a><a id="16021" class="Symbol">)</a>

    <a id="Post-POOLREAPUpdate.payout"></a><a id="16028" href="Ledger.Conway.Specification.Epoch.html#16028" class="Function">payout</a> <a id="16035" class="Symbol">:</a> <a id="16037" href="Ledger.Core.Specification.Address.html#1313" class="Record">RwdAddr</a> <a id="16045" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="16047" href="Ledger.Prelude.Base.html#154" class="Function">Coin</a>
    <a id="16056" href="Ledger.Conway.Specification.Epoch.html#16028" class="Function">payout</a> <a id="16063" class="Symbol">=</a> <a id="16065" href="Ledger.Conway.Specification.Epoch.html#15897" class="Function">govActionReturns</a> <a id="16082" href="Axiom.Set.Map.Dec.html#2052" class="Function Operator">∪⁺</a> <a id="16085" href="Ledger.Core.Specification.Address.html#1688" class="Field">WithdrawalsOf</a> <a id="16099" href="Ledger.Conway.Specification.Epoch.html#15599" class="Bound">es</a>

  <a id="16105" class="Keyword">opaque</a>
    <a id="Post-POOLREAPUpdate.refunds"></a><a id="16116" href="Ledger.Conway.Specification.Epoch.html#16116" class="Function">refunds</a> <a id="16124" class="Symbol">:</a> <a id="16126" href="Ledger.Core.Specification.Address.html#259" class="Datatype">Credential</a> <a id="16137" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="16139" href="Ledger.Prelude.Base.html#154" class="Function">Coin</a>
    <a id="16148" href="Ledger.Conway.Specification.Epoch.html#16116" class="Function">refunds</a> <a id="16156" class="Symbol">=</a> <a id="16158" href="Axiom.Set.Map.html#17516" class="Function">pullbackMap</a> <a id="16170" href="Ledger.Conway.Specification.Epoch.html#16028" class="Function">payout</a> <a id="16177" href="Ledger.Conway.Specification.Epoch.html#5263" class="Function">toRwdAddr</a> <a id="16187" class="Symbol">(</a><a id="16188" href="Class.IsSet.html#916" class="Function">dom</a> <a id="16192" class="Symbol">(</a><a id="16193" href="Ledger.Conway.Specification.Certs.html#1841" class="Field">RewardsOf</a> <a id="16203" href="Ledger.Conway.Specification.Epoch.html#15685" class="Bound">dState&#39;</a><a id="16210" class="Symbol">))</a>

  <a id="Post-POOLREAPUpdate.dState&#39;&#39;"></a><a id="16216" href="Ledger.Conway.Specification.Epoch.html#16216" class="Function">dState&#39;&#39;</a> <a id="16225" class="Symbol">:</a> <a id="16227" href="Ledger.Conway.Specification.Certs.html#3893" class="Record">DState</a>
  <a id="16236" href="Ledger.Conway.Specification.Epoch.html#16216" class="Function">dState&#39;&#39;</a> <a id="16245" class="Symbol">=</a> <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.Core.Specification.Gov.Actions.html#2805}{\htmlId{16249}{\htmlClass{Field}{\text{VoteDelegsOf}}}}\, \,\href{Ledger.Conway.Specification.Epoch.html#15685}{\htmlId{16262}{\htmlClass{Bound}{\text{dState&#39;}}}}\, \\ \,\href{Ledger.Conway.Specification.Certs.html#2006}{\htmlId{16272}{\htmlClass{Field}{\text{StakeDelegsOf}}}}\, \,\href{Ledger.Conway.Specification.Epoch.html#15685}{\htmlId{16286}{\htmlClass{Bound}{\text{dState&#39;}}}}\, \\ \,\href{Ledger.Conway.Specification.Certs.html#1841}{\htmlId{16296}{\htmlClass{Field}{\text{RewardsOf}}}}\, \,\href{Ledger.Conway.Specification.Epoch.html#15685}{\htmlId{16306}{\htmlClass{Bound}{\text{dState&#39;}}}}\, \,\href{Axiom.Set.Map.Dec.html#2052}{\htmlId{16314}{\htmlClass{Function Operator}{\text{∪⁺}}}}\, \,\href{Ledger.Conway.Specification.Epoch.html#16116}{\htmlId{16317}{\htmlClass{Function}{\text{refunds}}}}\, \end{pmatrix}$</a>

  <a id="Post-POOLREAPUpdate.unclaimed"></a><a id="16330" href="Ledger.Conway.Specification.Epoch.html#16330" class="Function">unclaimed</a> <a id="16340" class="Symbol">:</a> <a id="16342" href="Ledger.Prelude.Base.html#154" class="Function">Coin</a>
  <a id="16349" href="Ledger.Conway.Specification.Epoch.html#16330" class="Function">unclaimed</a> <a id="16359" class="Symbol">=</a> <a id="16361" href="Ledger.Prelude.HasCoin.html#171" class="Field">getCoin</a> <a id="16369" href="Ledger.Conway.Specification.Epoch.html#16028" class="Function">payout</a> <a id="16376" href="Interface.TypeClasses.HasSubtract.html#223" class="Field Operator">-</a> <a id="16378" href="Ledger.Prelude.HasCoin.html#171" class="Field">getCoin</a> <a id="16386" href="Ledger.Conway.Specification.Epoch.html#16116" class="Function">refunds</a>

  <a id="Post-POOLREAPUpdate.totWithdrawals"></a><a id="16397" href="Ledger.Conway.Specification.Epoch.html#16397" class="Function">totWithdrawals</a> <a id="16412" class="Symbol">:</a> <a id="16414" href="Ledger.Prelude.Base.html#154" class="Function">Coin</a>
  <a id="16421" href="Ledger.Conway.Specification.Epoch.html#16397" class="Function">totWithdrawals</a> <a id="16436" class="Symbol">=</a> <a id="16438" href="abstract-set-theory.FiniteSetTheory.html#4312" class="Function">∑[</a> <a id="16441" href="Ledger.Conway.Specification.Epoch.html#16441" class="Bound">x</a> <a id="16443" href="abstract-set-theory.FiniteSetTheory.html#4312" class="Function">←</a> <a id="16445" href="Ledger.Core.Specification.Address.html#1688" class="Field">WithdrawalsOf</a> <a id="16459" href="Ledger.Conway.Specification.Epoch.html#15599" class="Bound">es</a> <a id="16462" href="abstract-set-theory.FiniteSetTheory.html#4312" class="Function">]</a> <a id="16464" href="Ledger.Conway.Specification.Epoch.html#16441" class="Bound">x</a>

  <a id="Post-POOLREAPUpdate.acnt&#39;&#39;"></a><a id="16469" href="Ledger.Conway.Specification.Epoch.html#16469" class="Function">acnt&#39;&#39;</a> <a id="16476" class="Symbol">:</a> <a id="16478" href="Ledger.Conway.Specification.PParams.html#718" class="Record">Acnt</a>
  <a id="16485" href="Ledger.Conway.Specification.Epoch.html#16469" class="Function">acnt&#39;&#39;</a> <a id="16492" class="Symbol">=</a> <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.Prelude.Base.html#889}{\htmlId{16496}{\htmlClass{Field}{\text{TreasuryOf}}}}\, \,\href{Ledger.Conway.Specification.Epoch.html#15731}{\htmlId{16507}{\htmlClass{Bound}{\text{acnt&#39;}}}}\, \,\href{Data.Nat.Base.html#4462}{\htmlId{16513}{\htmlClass{Primitive Operator}{\text{∸}}}}\, \,\href{Ledger.Conway.Specification.Epoch.html#16397}{\htmlId{16515}{\htmlClass{Function}{\text{totWithdrawals}}}}\, \,\href{Class.HasAdd.Core.html#162}{\htmlId{16530}{\htmlClass{Field Operator}{\text{+}}}}\, \,\href{Ledger.Prelude.Base.html#554}{\htmlId{16532}{\htmlClass{Field}{\text{DonationsOf}}}}\, \,\href{Ledger.Conway.Specification.Epoch.html#15644}{\htmlId{16544}{\htmlClass{Bound}{\text{ls}}}}\, \,\href{Class.HasAdd.Core.html#162}{\htmlId{16547}{\htmlClass{Field Operator}{\text{+}}}}\, \,\href{Ledger.Conway.Specification.Epoch.html#16330}{\htmlId{16549}{\htmlClass{Function}{\text{unclaimed}}}}\, \\ \,\href{Ledger.Prelude.Base.html#773}{\htmlId{16561}{\htmlClass{Field}{\text{ReservesOf}}}}\, \,\href{Ledger.Conway.Specification.Epoch.html#15731}{\htmlId{16572}{\htmlClass{Bound}{\text{acnt&#39;}}}}\, \end{pmatrix}$</a>

  <a id="Post-POOLREAPUpdate.updates"></a><a id="16583" href="Ledger.Conway.Specification.Epoch.html#16583" class="Function">updates</a> <a id="16591" class="Symbol">:</a> <a id="16593" href="Ledger.Conway.Specification.Epoch.html#15428" class="Record">Post-POOLREAP-Update</a>
  <a id="16616" href="Ledger.Conway.Specification.Epoch.html#16583" class="Function">updates</a> <a id="16624" class="Symbol">=</a> <a id="16626" href="Ledger.Conway.Specification.Epoch.html#15488" class="InductiveConstructor">Post-POOLREAPUpdate</a> <a id="16646" href="Ledger.Conway.Specification.Epoch.html#16216" class="Function">dState&#39;&#39;</a> <a id="16655" href="Ledger.Conway.Specification.Epoch.html#16469" class="Function">acnt&#39;&#39;</a>


<a id="16664" class="Keyword">data</a> <a id="_⊢_⇀⦇_,EPOCH⦈_"></a><a id="16669" href="Ledger.Conway.Specification.Epoch.html#16669" class="Datatype Operator">_⊢_⇀⦇_,EPOCH⦈_</a> <a id="16684" class="Symbol">:</a> <a id="16686" href="Agda.Builtin.Unit.html#175" class="Record">⊤</a> <a id="16688" class="Symbol">→</a> <a id="16690" href="Ledger.Conway.Specification.Epoch.html#1835" class="Record">EpochState</a> <a id="16701" class="Symbol">→</a> <a id="16703" href="Ledger.Core.Specification.Epoch.html#646" class="Function">Epoch</a> <a id="16709" class="Symbol">→</a> <a id="16711" href="Ledger.Conway.Specification.Epoch.html#1835" class="Record">EpochState</a> <a id="16722" class="Symbol">→</a> <a id="16724" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="16729" class="Keyword">where</a>


  <a id="_⊢_⇀⦇_,EPOCH⦈_.EPOCH"></a><a id="16739" href="Ledger.Conway.Specification.Epoch.html#16739" class="InductiveConstructor">EPOCH</a> <a id="16745" class="Symbol">:</a>
    <a id="16751" class="Keyword">let</a>
      <a id="16761" href="Ledger.Conway.Specification.Epoch.html#16761" class="Bound">es</a> <a id="16764" class="Symbol">=</a> <a id="16766" href="Ledger.Conway.Specification.Enact.html#787" class="Field">EnactStateOf</a> <a id="16779" href="Ledger.Conway.Specification.Epoch.html#12705" class="Generalizable">fut</a>

      <a id="16790" href="Ledger.Conway.Specification.Epoch.html#16790" class="Bound">govUpd</a> <a id="16797" class="Symbol">:</a> <a id="16799" href="Ledger.Conway.Specification.Epoch.html#13524" class="Record">Governance-Update</a>
      <a id="16823" href="Ledger.Conway.Specification.Epoch.html#16790" class="Bound">govUpd</a> <a id="16830" class="Symbol">=</a> <a id="16832" href="Ledger.Conway.Specification.Epoch.html#14414" class="Function">GovernanceUpdate.updates</a> <a id="16857" href="Ledger.Conway.Specification.Epoch.html#12792" class="Generalizable">ls</a> <a id="16860" href="Ledger.Conway.Specification.Epoch.html#12705" class="Generalizable">fut</a>

      <a id="16871" href="Ledger.Conway.Specification.Epoch.html#14563" class="InductiveConstructor">Pre-POOLREAPUpdate</a> <a id="16890" href="Ledger.Conway.Specification.Epoch.html#16890" class="Bound">pState&#39;</a> <a id="16898" href="Ledger.Conway.Specification.Epoch.html#16898" class="Bound">gState&#39;</a> <a id="16906" href="Ledger.Conway.Specification.Epoch.html#16906" class="Bound">utxoSt&#39;</a> <a id="16914" class="Symbol">=</a> <a id="16916" href="Ledger.Conway.Specification.Epoch.html#15335" class="Function">Pre-POOLREAPUpdate.updates</a> <a id="16943" href="Ledger.Conway.Specification.Epoch.html#12792" class="Generalizable">ls</a> <a id="16946" href="Ledger.Conway.Specification.Epoch.html#16761" class="Bound">es</a> <a id="16949" href="Ledger.Conway.Specification.Epoch.html#16790" class="Bound">govUpd</a>
      <a id="16962" href="Ledger.Conway.Specification.Epoch.html#15488" class="InductiveConstructor">Post-POOLREAPUpdate</a> <a id="16982" href="Ledger.Conway.Specification.Epoch.html#16982" class="Bound">dState&#39;&#39;</a> <a id="16991" href="Ledger.Conway.Specification.Epoch.html#16991" class="Bound">acnt&#39;&#39;</a> <a id="16998" class="Symbol">=</a> <a id="17000" href="Ledger.Conway.Specification.Epoch.html#16583" class="Function">Post-POOLREAPUpdate.updates</a> <a id="17028" href="Ledger.Conway.Specification.Epoch.html#16761" class="Bound">es</a> <a id="17031" href="Ledger.Conway.Specification.Epoch.html#12792" class="Generalizable">ls</a> <a id="17034" href="Ledger.Conway.Specification.Epoch.html#12903" class="Generalizable">dState&#39;</a> <a id="17042" href="Ledger.Conway.Specification.Epoch.html#12927" class="Generalizable">acnt&#39;</a> <a id="17048" href="Ledger.Conway.Specification.Epoch.html#16790" class="Bound">govUpd</a>

      <a id="17062" href="Ledger.Conway.Specification.Epoch.html#17062" class="Bound">es&#39;</a> <a id="17066" class="Symbol">:</a> <a id="17068" href="Ledger.Conway.Specification.Enact.html#444" class="Record">EnactState</a>
      <a id="17085" href="Ledger.Conway.Specification.Epoch.html#17062" class="Bound">es&#39;</a> <a id="17089" class="Symbol">=</a> <a id="17091" class="Keyword">record</a> <a id="17098" href="Ledger.Conway.Specification.Epoch.html#16761" class="Bound">es</a> <a id="17101" class="Symbol">{</a> <a id="17103" href="Ledger.Conway.Specification.Enact.html#696" class="Field">withdrawals</a> <a id="17115" class="Symbol">=</a> <a id="17117" href="Class.HasEmptySet.html#287" class="Field">∅</a> <a id="17119" class="Symbol">}</a>

      <a id="17128" href="Ledger.Conway.Specification.Epoch.html#17128" class="Bound">govSt&#39;</a> <a id="17135" class="Symbol">:</a> <a id="17137" href="Ledger.Conway.Specification.Gov.html#1459" class="Function">GovState</a>
      <a id="17152" href="Ledger.Conway.Specification.Epoch.html#17128" class="Bound">govSt&#39;</a> <a id="17159" class="Symbol">=</a> <a id="17161" href="Ledger.Conway.Specification.Epoch.html#13658" class="Field">Governance-Update.govSt&#39;</a> <a id="17186" href="Ledger.Conway.Specification.Epoch.html#16790" class="Bound">govUpd</a>

      <a id="17200" href="Ledger.Conway.Specification.Epoch.html#17200" class="Bound">stakeDistrs</a> <a id="17212" class="Symbol">:</a> <a id="17214" href="Ledger.Conway.Specification.Ratify.html#3115" class="Record">StakeDistrs</a>
      <a id="17232" href="Ledger.Conway.Specification.Epoch.html#17200" class="Bound">stakeDistrs</a> <a id="17244" class="Symbol">=</a> <a id="17246" href="Ledger.Conway.Specification.Epoch.html#12368" class="Function">mkStakeDistrs</a> <a id="17260" class="Symbol">(</a><a id="17261" href="Ledger.Conway.Specification.Rewards.html#7780" class="Field">Snapshots.mark</a> <a id="17276" href="Ledger.Conway.Specification.Epoch.html#12968" class="Generalizable">ss&#39;</a><a id="17279" class="Symbol">)</a> <a id="17281" href="Ledger.Conway.Specification.Epoch.html#12683" class="Generalizable">e</a> <a id="17283" href="Ledger.Conway.Specification.Epoch.html#16906" class="Bound">utxoSt&#39;</a>
                                  <a id="17325" href="Ledger.Conway.Specification.Epoch.html#17128" class="Bound">govSt&#39;</a> <a id="17332" class="Symbol">(</a><a id="17333" href="Ledger.Conway.Specification.Certs.html#4806" class="Field">GStateOf</a> <a id="17342" href="Ledger.Conway.Specification.Epoch.html#12792" class="Generalizable">ls</a><a id="17344" class="Symbol">)</a> <a id="17346" class="Symbol">(</a><a id="17347" href="Ledger.Conway.Specification.Certs.html#4590" class="Field">DStateOf</a> <a id="17356" href="Ledger.Conway.Specification.Epoch.html#12792" class="Generalizable">ls</a><a id="17358" class="Symbol">)</a>

      <a id="17367" href="Ledger.Conway.Specification.Epoch.html#17367" class="Bound">Γ</a> <a id="17369" class="Symbol">:</a> <a id="17371" href="Ledger.Conway.Specification.Ratify.html#3234" class="Record">RatifyEnv</a>
      <a id="17387" href="Ledger.Conway.Specification.Epoch.html#17367" class="Bound">Γ</a> <a id="17389" class="Symbol">=</a> <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.Conway.Specification.Epoch.html#17200}{\htmlId{17393}{\htmlClass{Bound}{\text{stakeDistrs}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#12683}{\htmlId{17407}{\htmlClass{Generalizable}{\text{e}}}}\, \\ \,\href{Ledger.Conway.Specification.Certs.html#1599}{\htmlId{17411}{\htmlClass{Field}{\text{DRepsOf}}}}\, \,\href{Ledger.Conway.Specification.Epoch.html#12792}{\htmlId{17419}{\htmlClass{Generalizable}{\text{ls}}}}\, \\ \,\href{Ledger.Conway.Specification.Certs.html#1514}{\htmlId{17424}{\htmlClass{Field}{\text{CCHotKeysOf}}}}\, \,\href{Ledger.Conway.Specification.Epoch.html#12792}{\htmlId{17436}{\htmlClass{Generalizable}{\text{ls}}}}\, \\ \,\href{Ledger.Prelude.Base.html#889}{\htmlId{17441}{\htmlClass{Field}{\text{TreasuryOf}}}}\, \,\href{Ledger.Conway.Specification.Epoch.html#16991}{\htmlId{17452}{\htmlClass{Bound}{\text{acnt&#39;&#39;}}}}\, \\ \,\href{Ledger.Conway.Specification.Certs.html#1676}{\htmlId{17461}{\htmlClass{Field}{\text{PoolsOf}}}}\, \,\href{Ledger.Conway.Specification.Epoch.html#12792}{\htmlId{17469}{\htmlClass{Generalizable}{\text{ls}}}}\, \\ \,\href{Ledger.Core.Specification.Gov.Actions.html#2805}{\htmlId{17474}{\htmlClass{Field}{\text{VoteDelegsOf}}}}\, \,\href{Ledger.Conway.Specification.Epoch.html#12792}{\htmlId{17487}{\htmlClass{Generalizable}{\text{ls}}}}\, \end{pmatrix}$</a>

    <a id="17497" class="Keyword">in</a>
        <a id="17508" href="Ledger.Conway.Specification.Epoch.html#12792" class="Generalizable">ls</a> <a id="17511" href="Ledger.Conway.Specification.Rewards.html#8221" class="Datatype Operator">⊢</a> <a id="17513" href="Ledger.Conway.Specification.Epoch.html#12965" class="Generalizable">ss</a> <a id="17516" href="Ledger.Conway.Specification.Rewards.html#8221" class="Datatype Operator">⇀⦇</a> <a id="17519" href="Agda.Builtin.Unit.html#212" class="InductiveConstructor">tt</a> <a id="17522" href="Ledger.Conway.Specification.Rewards.html#8221" class="Datatype Operator">,SNAP⦈</a> <a id="17529" href="Ledger.Conway.Specification.Epoch.html#12968" class="Generalizable">ss&#39;</a>
      <a id="17539" href="Prelude.InferenceRules.html#56006" class="Function Operator">∙</a> <a id="17541" class="Symbol">_</a>  <a id="17544" href="Ledger.Conway.Specification.PoolReap.html#868" class="Datatype Operator">⊢</a> <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.Conway.Specification.Epoch.html#16906}{\htmlId{17548}{\htmlClass{Bound}{\text{utxoSt&#39;}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#12922}{\htmlId{17558}{\htmlClass{Generalizable}{\text{acnt}}}}\, \\ \,\href{Ledger.Conway.Specification.Certs.html#4590}{\htmlId{17565}{\htmlClass{Field}{\text{DStateOf}}}}\, \,\href{Ledger.Conway.Specification.Epoch.html#12792}{\htmlId{17574}{\htmlClass{Generalizable}{\text{ls}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#16890}{\htmlId{17579}{\htmlClass{Bound}{\text{pState&#39;}}}}\, \end{pmatrix}$</a> <a id="17589" href="Ledger.Conway.Specification.PoolReap.html#868" class="Datatype Operator">⇀⦇</a> <a id="17592" href="Ledger.Conway.Specification.Epoch.html#12683" class="Generalizable">e</a> <a id="17594" href="Ledger.Conway.Specification.PoolReap.html#868" class="Datatype Operator">,POOLREAP⦈</a> <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.Conway.Specification.Epoch.html#12942}{\htmlId{17607}{\htmlClass{Generalizable}{\text{utxoSt&#39;&#39;}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#12927}{\htmlId{17618}{\htmlClass{Generalizable}{\text{acnt&#39;}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#12903}{\htmlId{17626}{\htmlClass{Generalizable}{\text{dState&#39;}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#12883}{\htmlId{17636}{\htmlClass{Generalizable}{\text{pState&#39;&#39;}}}}\, \end{pmatrix}$</a>
      <a id="17653" href="Prelude.InferenceRules.html#56006" class="Function Operator">∙</a> <a id="17655" href="Ledger.Conway.Specification.Epoch.html#17367" class="Bound">Γ</a>  <a id="17658" href="Ledger.Conway.Specification.Ratify.html#13443" class="Function Operator">⊢</a> <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.Conway.Specification.Epoch.html#16761}{\htmlId{17662}{\htmlClass{Bound}{\text{es}}}}\, \\ \,\href{Class.HasEmptySet.html#287}{\htmlId{17667}{\htmlClass{Field}{\text{∅}}}}\, \\ \,\href{Agda.Builtin.Bool.html#192}{\htmlId{17671}{\htmlClass{InductiveConstructor}{\text{false}}}}\, \end{pmatrix}$</a> <a id="17679" href="Ledger.Conway.Specification.Ratify.html#13443" class="Function Operator">⇀⦇</a> <a id="17682" href="Ledger.Conway.Specification.Epoch.html#17128" class="Bound">govSt&#39;</a> <a id="17689" href="Ledger.Conway.Specification.Ratify.html#13443" class="Function Operator">,RATIFIES⦈</a> <a id="17700" href="Ledger.Conway.Specification.Epoch.html#12709" class="Generalizable">fut&#39;</a>
      <a id="17711" href="Prelude.InferenceRules.html#13071" class="Function Operator">──────────────────────────────────────────────</a>
      <a id="17764" class="Symbol">_</a> <a id="17766" href="Ledger.Conway.Specification.Epoch.html#16669" class="Datatype Operator">⊢</a> <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.Conway.Specification.Epoch.html#12922}{\htmlId{17770}{\htmlClass{Generalizable}{\text{acnt}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#12965}{\htmlId{17777}{\htmlClass{Generalizable}{\text{ss}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#12792}{\htmlId{17782}{\htmlClass{Generalizable}{\text{ls}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#12806}{\htmlId{17787}{\htmlClass{Generalizable}{\text{es₀}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#12705}{\htmlId{17793}{\htmlClass{Generalizable}{\text{fut}}}}\, \end{pmatrix}$</a> <a id="17799" href="Ledger.Conway.Specification.Epoch.html#16669" class="Datatype Operator">⇀⦇</a> <a id="17802" href="Ledger.Conway.Specification.Epoch.html#12683" class="Generalizable">e</a> <a id="17804" href="Ledger.Conway.Specification.Epoch.html#16669" class="Datatype Operator">,EPOCH⦈</a> <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.Conway.Specification.Epoch.html#16991}{\htmlId{17814}{\htmlClass{Bound}{\text{acnt&#39;&#39;}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#12968}{\htmlId{17823}{\htmlClass{Generalizable}{\text{ss&#39;}}}}\, \\ \begin{pmatrix} \,\href{Ledger.Conway.Specification.Epoch.html#12942}{\htmlId{17831}{\htmlClass{Generalizable}{\text{utxoSt&#39;&#39;}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#17128}{\htmlId{17842}{\htmlClass{Bound}{\text{govSt&#39;}}}}\, \\ \begin{pmatrix} \,\href{Ledger.Conway.Specification.Epoch.html#16982}{\htmlId{17853}{\htmlClass{Bound}{\text{dState&#39;&#39;}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#12883}{\htmlId{17864}{\htmlClass{Generalizable}{\text{pState&#39;&#39;}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#16898}{\htmlId{17875}{\htmlClass{Bound}{\text{gState&#39;}}}}\, \end{pmatrix} \end{pmatrix} \\ \,\href{Ledger.Conway.Specification.Epoch.html#17062}{\htmlId{17891}{\htmlClass{Bound}{\text{es&#39;}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#12709}{\htmlId{17897}{\htmlClass{Generalizable}{\text{fut&#39;}}}}\, \end{pmatrix}$</a>


<a id="17906" class="Keyword">data</a> <a id="_⊢_⇀⦇_,NEWEPOCH⦈_"></a><a id="17911" href="Ledger.Conway.Specification.Epoch.html#17911" class="Datatype Operator">_⊢_⇀⦇_,NEWEPOCH⦈_</a> <a id="17929" class="Symbol">:</a> <a id="17931" href="Agda.Builtin.Unit.html#175" class="Record">⊤</a> <a id="17933" class="Symbol">→</a> <a id="17935" href="Ledger.Conway.Specification.Epoch.html#3362" class="Record">NewEpochState</a> <a id="17949" class="Symbol">→</a> <a id="17951" href="Ledger.Core.Specification.Epoch.html#646" class="Function">Epoch</a> <a id="17957" class="Symbol">→</a> <a id="17959" href="Ledger.Conway.Specification.Epoch.html#3362" class="Record">NewEpochState</a> <a id="17973" class="Symbol">→</a> <a id="17975" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="17980" class="Keyword">where</a>

  <a id="_⊢_⇀⦇_,NEWEPOCH⦈_.NEWEPOCH-New"></a><a id="17989" href="Ledger.Conway.Specification.Epoch.html#17989" class="InductiveConstructor">NEWEPOCH-New</a> <a id="18002" class="Symbol">:</a> <a id="18004" class="Symbol">∀</a> <a id="18006" class="Symbol">{</a><a id="18007" href="Ledger.Conway.Specification.Epoch.html#18007" class="Bound">bprev</a> <a id="18013" href="Ledger.Conway.Specification.Epoch.html#18013" class="Bound">bcur</a> <a id="18018" class="Symbol">:</a> <a id="18020" href="Ledger.Conway.Specification.Rewards.html#4933" class="Function">BlocksMade</a><a id="18030" class="Symbol">}</a> <a id="18032" class="Symbol">→</a>
    <a id="18038" class="Keyword">let</a>
      <a id="18048" href="Ledger.Conway.Specification.Epoch.html#18048" class="Bound">eps&#39;</a> <a id="18053" class="Symbol">=</a> <a id="18055" href="Ledger.Conway.Specification.Epoch.html#8708" class="Function">applyRUpd</a> <a id="18065" href="Ledger.Conway.Specification.Epoch.html#12986" class="Generalizable">ru</a> <a id="18068" href="Ledger.Conway.Specification.Epoch.html#12762" class="Generalizable">eps</a>
      <a id="18078" href="Ledger.Conway.Specification.Epoch.html#18078" class="Bound">ss</a>   <a id="18083" class="Symbol">=</a> <a id="18085" href="Ledger.Conway.Specification.Epoch.html#1925" class="Field">EpochState.ss</a> <a id="18099" href="Ledger.Conway.Specification.Epoch.html#12771" class="Generalizable">eps&#39;&#39;</a>
      <a id="18111" href="Ledger.Conway.Specification.Epoch.html#18111" class="Bound">pd&#39;</a>  <a id="18116" class="Symbol">=</a> <a id="18118" href="Ledger.Conway.Specification.Epoch.html#9776" class="Function">calculatePoolDelegatedStake</a> <a id="18146" class="Symbol">(</a><a id="18147" href="Ledger.Conway.Specification.Rewards.html#7785" class="Field">Snapshots.set</a> <a id="18161" href="Ledger.Conway.Specification.Epoch.html#18078" class="Bound">ss</a><a id="18163" class="Symbol">)</a>
    <a id="18169" class="Keyword">in</a>
      <a id="18178" href="Prelude.InferenceRules.html#56075" class="Function Operator">∙</a> <a id="18180" href="Ledger.Conway.Specification.Epoch.html#12683" class="Generalizable">e</a> <a id="18182" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="18184" href="Ledger.Conway.Specification.Epoch.html#12685" class="Generalizable">lastEpoch</a> <a id="18194" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="18196" class="Number">1</a>
      <a id="18204" href="Prelude.InferenceRules.html#56006" class="Function Operator">∙</a> <a id="18206" class="Symbol">_</a> <a id="18208" href="Ledger.Conway.Specification.Epoch.html#16669" class="Datatype Operator">⊢</a> <a id="18210" href="Ledger.Conway.Specification.Epoch.html#18048" class="Bound">eps&#39;</a> <a id="18215" href="Ledger.Conway.Specification.Epoch.html#16669" class="Datatype Operator">⇀⦇</a> <a id="18218" href="Ledger.Conway.Specification.Epoch.html#12683" class="Generalizable">e</a> <a id="18220" href="Ledger.Conway.Specification.Epoch.html#16669" class="Datatype Operator">,EPOCH⦈</a> <a id="18228" href="Ledger.Conway.Specification.Epoch.html#12771" class="Generalizable">eps&#39;&#39;</a>
      <a id="18240" href="Prelude.InferenceRules.html#13071" class="Function Operator">──────────────────────────────────────────────</a>
      <a id="18293" class="Symbol">_</a> <a id="18295" href="Ledger.Conway.Specification.Epoch.html#17911" class="Datatype Operator">⊢</a> <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.Conway.Specification.Epoch.html#12685}{\htmlId{18299}{\htmlClass{Generalizable}{\text{lastEpoch}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#18007}{\htmlId{18311}{\htmlClass{Bound}{\text{bprev}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#18013}{\htmlId{18319}{\htmlClass{Bound}{\text{bcur}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#12762}{\htmlId{18326}{\htmlClass{Generalizable}{\text{eps}}}}\, \\ \,\href{Agda.Builtin.Maybe.html#173}{\htmlId{18332}{\htmlClass{InductiveConstructor}{\text{just}}}}\, \,\href{Ledger.Conway.Specification.Epoch.html#12986}{\htmlId{18337}{\htmlClass{Generalizable}{\text{ru}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#13033}{\htmlId{18342}{\htmlClass{Generalizable}{\text{pd}}}}\, \end{pmatrix}$</a> <a id="18347" href="Ledger.Conway.Specification.Epoch.html#17911" class="Datatype Operator">⇀⦇</a> <a id="18350" href="Ledger.Conway.Specification.Epoch.html#12683" class="Generalizable">e</a> <a id="18352" href="Ledger.Conway.Specification.Epoch.html#17911" class="Datatype Operator">,NEWEPOCH⦈</a> <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.Conway.Specification.Epoch.html#12683}{\htmlId{18365}{\htmlClass{Generalizable}{\text{e}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#18013}{\htmlId{18369}{\htmlClass{Bound}{\text{bcur}}}}\, \\ \,\href{Axiom.Set.Map.html#2671}{\htmlId{18376}{\htmlClass{Function}{\text{∅ᵐ}}}}\,  \\ \,\href{Ledger.Conway.Specification.Epoch.html#12771}{\htmlId{18382}{\htmlClass{Generalizable}{\text{eps&#39;&#39;}}}}\, \\ \,\href{Agda.Builtin.Maybe.html#194}{\htmlId{18390}{\htmlClass{InductiveConstructor}{\text{nothing}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#18111}{\htmlId{18400}{\htmlClass{Bound}{\text{pd&#39;}}}}\, \end{pmatrix}$</a>

  <a id="_⊢_⇀⦇_,NEWEPOCH⦈_.NEWEPOCH-Not-New"></a><a id="18409" href="Ledger.Conway.Specification.Epoch.html#18409" class="InductiveConstructor">NEWEPOCH-Not-New</a> <a id="18426" class="Symbol">:</a> <a id="18428" class="Symbol">∀</a> <a id="18430" class="Symbol">{</a><a id="18431" href="Ledger.Conway.Specification.Epoch.html#18431" class="Bound">bprev</a> <a id="18437" href="Ledger.Conway.Specification.Epoch.html#18437" class="Bound">bcur</a> <a id="18442" class="Symbol">:</a> <a id="18444" href="Ledger.Conway.Specification.Rewards.html#4933" class="Function">BlocksMade</a><a id="18454" class="Symbol">}</a> <a id="18456" class="Symbol">→</a>
    <a id="18462" href="Prelude.InferenceRules.html#56075" class="Function Operator">∙</a> <a id="18464" href="Ledger.Conway.Specification.Epoch.html#12683" class="Generalizable">e</a> <a id="18466" href="Relation.Binary.PropositionalEquality.Core.html#1000" class="Function Operator">≢</a> <a id="18468" href="Ledger.Conway.Specification.Epoch.html#12685" class="Generalizable">lastEpoch</a> <a id="18478" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="18480" class="Number">1</a>
      <a id="18488" href="Prelude.InferenceRules.html#13071" class="Function Operator">──────────────────────────────────────────────</a>
      <a id="18541" class="Symbol">_</a> <a id="18543" href="Ledger.Conway.Specification.Epoch.html#17911" class="Datatype Operator">⊢</a> <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.Conway.Specification.Epoch.html#12685}{\htmlId{18547}{\htmlClass{Generalizable}{\text{lastEpoch}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#18431}{\htmlId{18559}{\htmlClass{Bound}{\text{bprev}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#18437}{\htmlId{18567}{\htmlClass{Bound}{\text{bcur}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#12762}{\htmlId{18574}{\htmlClass{Generalizable}{\text{eps}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#13006}{\htmlId{18580}{\htmlClass{Generalizable}{\text{mru}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#13033}{\htmlId{18586}{\htmlClass{Generalizable}{\text{pd}}}}\, \end{pmatrix}$</a> <a id="18591" href="Ledger.Conway.Specification.Epoch.html#17911" class="Datatype Operator">⇀⦇</a> <a id="18594" href="Ledger.Conway.Specification.Epoch.html#12683" class="Generalizable">e</a> <a id="18596" href="Ledger.Conway.Specification.Epoch.html#17911" class="Datatype Operator">,NEWEPOCH⦈</a> <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.Conway.Specification.Epoch.html#12685}{\htmlId{18609}{\htmlClass{Generalizable}{\text{lastEpoch}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#18431}{\htmlId{18621}{\htmlClass{Bound}{\text{bprev}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#18437}{\htmlId{18629}{\htmlClass{Bound}{\text{bcur}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#12762}{\htmlId{18636}{\htmlClass{Generalizable}{\text{eps}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#13006}{\htmlId{18642}{\htmlClass{Generalizable}{\text{mru}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#13033}{\htmlId{18648}{\htmlClass{Generalizable}{\text{pd}}}}\, \end{pmatrix}$</a>

  <a id="_⊢_⇀⦇_,NEWEPOCH⦈_.NEWEPOCH-No-Reward-Update"></a><a id="18656" href="Ledger.Conway.Specification.Epoch.html#18656" class="InductiveConstructor">NEWEPOCH-No-Reward-Update</a> <a id="18682" class="Symbol">:</a> <a id="18684" class="Symbol">∀</a> <a id="18686" class="Symbol">{</a><a id="18687" href="Ledger.Conway.Specification.Epoch.html#18687" class="Bound">bprev</a> <a id="18693" href="Ledger.Conway.Specification.Epoch.html#18693" class="Bound">bcur</a> <a id="18698" class="Symbol">:</a> <a id="18700" href="Ledger.Conway.Specification.Rewards.html#4933" class="Function">BlocksMade</a><a id="18710" class="Symbol">}</a> <a id="18712" class="Symbol">→</a>
    <a id="18718" class="Keyword">let</a>
      <a id="18728" href="Ledger.Conway.Specification.Epoch.html#18728" class="Bound">ss</a>  <a id="18732" class="Symbol">=</a> <a id="18734" href="Ledger.Conway.Specification.Epoch.html#1925" class="Field">EpochState.ss</a> <a id="18748" href="Ledger.Conway.Specification.Epoch.html#12766" class="Generalizable">eps&#39;</a>
      <a id="18759" href="Ledger.Conway.Specification.Epoch.html#18759" class="Bound">pd&#39;</a> <a id="18763" class="Symbol">=</a> <a id="18765" href="Ledger.Conway.Specification.Epoch.html#9776" class="Function">calculatePoolDelegatedStake</a> <a id="18793" class="Symbol">(</a><a id="18794" href="Ledger.Conway.Specification.Rewards.html#7785" class="Field">Snapshots.set</a> <a id="18808" href="Ledger.Conway.Specification.Epoch.html#18728" class="Bound">ss</a><a id="18810" class="Symbol">)</a>
    <a id="18816" class="Keyword">in</a>
      <a id="18825" href="Prelude.InferenceRules.html#56075" class="Function Operator">∙</a> <a id="18827" href="Ledger.Conway.Specification.Epoch.html#12683" class="Generalizable">e</a> <a id="18829" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="18831" href="Ledger.Conway.Specification.Epoch.html#12685" class="Generalizable">lastEpoch</a> <a id="18841" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="18843" class="Number">1</a>
      <a id="18851" href="Prelude.InferenceRules.html#56006" class="Function Operator">∙</a> <a id="18853" class="Symbol">_</a> <a id="18855" href="Ledger.Conway.Specification.Epoch.html#16669" class="Datatype Operator">⊢</a> <a id="18857" href="Ledger.Conway.Specification.Epoch.html#12762" class="Generalizable">eps</a> <a id="18861" href="Ledger.Conway.Specification.Epoch.html#16669" class="Datatype Operator">⇀⦇</a> <a id="18864" href="Ledger.Conway.Specification.Epoch.html#12683" class="Generalizable">e</a> <a id="18866" href="Ledger.Conway.Specification.Epoch.html#16669" class="Datatype Operator">,EPOCH⦈</a> <a id="18874" href="Ledger.Conway.Specification.Epoch.html#12766" class="Generalizable">eps&#39;</a>
      <a id="18885" href="Prelude.InferenceRules.html#13071" class="Function Operator">──────────────────────────────────────────────</a>
      <a id="18938" class="Symbol">_</a> <a id="18940" href="Ledger.Conway.Specification.Epoch.html#17911" class="Datatype Operator">⊢</a> <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.Conway.Specification.Epoch.html#12685}{\htmlId{18944}{\htmlClass{Generalizable}{\text{lastEpoch}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#18687}{\htmlId{18956}{\htmlClass{Bound}{\text{bprev}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#18693}{\htmlId{18964}{\htmlClass{Bound}{\text{bcur}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#12762}{\htmlId{18971}{\htmlClass{Generalizable}{\text{eps}}}}\, \\ \,\href{Agda.Builtin.Maybe.html#194}{\htmlId{18977}{\htmlClass{InductiveConstructor}{\text{nothing}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#13033}{\htmlId{18987}{\htmlClass{Generalizable}{\text{pd}}}}\, \end{pmatrix}$</a> <a id="18992" href="Ledger.Conway.Specification.Epoch.html#17911" class="Datatype Operator">⇀⦇</a> <a id="18995" href="Ledger.Conway.Specification.Epoch.html#12683" class="Generalizable">e</a> <a id="18997" href="Ledger.Conway.Specification.Epoch.html#17911" class="Datatype Operator">,NEWEPOCH⦈</a> <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.Conway.Specification.Epoch.html#12683}{\htmlId{19010}{\htmlClass{Generalizable}{\text{e}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#18693}{\htmlId{19014}{\htmlClass{Bound}{\text{bcur}}}}\, \\ \,\href{Axiom.Set.Map.html#2671}{\htmlId{19021}{\htmlClass{Function}{\text{∅ᵐ}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#12766}{\htmlId{19026}{\htmlClass{Generalizable}{\text{eps&#39;}}}}\, \\ \,\href{Agda.Builtin.Maybe.html#194}{\htmlId{19033}{\htmlClass{InductiveConstructor}{\text{nothing}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#18759}{\htmlId{19043}{\htmlClass{Bound}{\text{pd&#39;}}}}\, \end{pmatrix}$</a>

</pre></body></html>