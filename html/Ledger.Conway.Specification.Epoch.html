<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>Ledger.Conway.Specification.Epoch</title><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.css"><link rel="stylesheet" href="Agda.css"><script src="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.js"></script><script src="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/contrib/auto-render.min.js"></script><script src="AgdaKaTeX.js" defer=""></script></head><body><pre class="Agda">
<a id="2" class="Symbol">{-#</a> <a id="6" class="Keyword">OPTIONS</a> <a id="14" class="Pragma">--safe</a> <a id="21" class="Symbol">#-}</a>

<a id="26" class="Keyword">open</a> <a id="31" class="Keyword">import</a> <a id="38" href="Ledger.Core.Specification.Abstract.html" class="Module">Ledger.Core.Specification.Abstract</a>
<a id="73" class="Keyword">open</a> <a id="78" class="Keyword">import</a> <a id="85" href="Ledger.Core.Specification.Transaction.html" class="Module">Ledger.Core.Specification.Transaction</a>

<a id="124" class="Keyword">module</a> <a id="131" href="Ledger.Conway.Specification.Epoch.html" class="Module">Ledger.Conway.Specification.Epoch</a>
  <a id="167" class="Symbol">(</a><a id="168" href="Ledger.Conway.Specification.Epoch.html#168" class="Bound">txs</a> <a id="172" class="Symbol">:</a> <a id="174" class="Symbol">_)</a> <a id="177" class="Symbol">(</a><a id="178" class="Keyword">open</a> <a id="183" href="Ledger.Core.Specification.Transaction.html#896" class="Module">TransactionStructure</a> <a id="204" href="Ledger.Conway.Specification.Epoch.html#168" class="Bound">txs</a><a id="207" class="Symbol">)</a>
  <a id="211" class="Symbol">(</a><a id="212" href="Ledger.Conway.Specification.Epoch.html#212" class="Bound">abs</a> <a id="216" class="Symbol">:</a> <a id="218" href="Ledger.Core.Specification.Abstract.html#651" class="Record">AbstractFunctions</a> <a id="236" href="Ledger.Conway.Specification.Epoch.html#168" class="Bound">txs</a><a id="239" class="Symbol">)</a> <a id="241" class="Symbol">(</a><a id="242" class="Keyword">open</a> <a id="247" href="Ledger.Core.Specification.Abstract.html#651" class="Module">AbstractFunctions</a> <a id="265" href="Ledger.Conway.Specification.Epoch.html#212" class="Bound">abs</a><a id="268" class="Symbol">)</a>
  <a id="272" class="Keyword">where</a>

<a id="279" class="Keyword">open</a> <a id="284" class="Keyword">import</a> <a id="291" href="Agda.Builtin.FromNat.html" class="Module">Agda.Builtin.FromNat</a>

<a id="313" class="Keyword">import</a>      <a id="325" href="Data.Integer.html" class="Module">Data.Integer</a> <a id="338" class="Symbol">as</a> <a id="341" class="Module">ℤ</a>
<a id="343" class="Keyword">open</a> <a id="348" class="Keyword">import</a> <a id="355" href="Data.Integer.html" class="Module">Data.Integer</a>                    <a id="387" class="Keyword">using</a> <a id="393" class="Symbol">()</a> <a id="396" class="Keyword">renaming</a> <a id="405" class="Symbol">(</a><a id="406" href="Agda.Builtin.Int.html#263" class="InductiveConstructor">+_</a> <a id="409" class="Symbol">to</a> <a id="412" class="InductiveConstructor">pos</a><a id="415" class="Symbol">)</a>
<a id="417" class="Keyword">open</a> <a id="422" class="Keyword">import</a> <a id="429" href="Data.Integer.Properties.html" class="Module">Data.Integer.Properties</a>         <a id="461" class="Keyword">using</a> <a id="467" class="Symbol">(</a><a id="468" class="Keyword">module</a> <a id="475" href="Data.Integer.Properties.html#11881" class="Module">≤-Reasoning</a><a id="486" class="Symbol">;</a> <a id="488" href="Data.Integer.Properties.html#34810" class="Function">+-mono-≤</a><a id="496" class="Symbol">;</a> <a id="498" href="Data.Integer.Properties.html#13298" class="Function">neg-mono-≤</a><a id="508" class="Symbol">;</a> <a id="510" href="Data.Integer.Properties.html#27061" class="Function">+-identityˡ</a><a id="521" class="Symbol">)</a>
                                            <a id="567" class="Keyword">renaming</a> <a id="576" class="Symbol">(</a><a id="577" href="Data.Integer.Properties.html#12508" class="Function">nonNegative⁻¹</a> <a id="591" class="Symbol">to</a> <a id="594" class="Function">nonNegative⁻¹ℤ</a><a id="608" class="Symbol">)</a>
<a id="610" class="Keyword">open</a> <a id="615" class="Keyword">import</a> <a id="622" href="Data.Integer.Tactic.RingSolver.html" class="Module">Data.Integer.Tactic.RingSolver</a>  <a id="654" class="Keyword">using</a> <a id="660" class="Symbol">(</a><a id="661" href="Data.Integer.Tactic.RingSolver.html#1200" class="Macro">solve-∀</a><a id="668" class="Symbol">)</a>
<a id="670" class="Keyword">open</a> <a id="675" class="Keyword">import</a> <a id="682" href="Data.Maybe.html" class="Module">Data.Maybe</a>                      <a id="714" class="Keyword">using</a> <a id="720" class="Symbol">(</a><a id="721" href="Data.Maybe.Base.html#1546" class="Function">fromMaybe</a><a id="730" class="Symbol">)</a>
<a id="732" class="Keyword">open</a> <a id="737" class="Keyword">import</a> <a id="744" href="Data.Nat.GeneralisedArithmetic.html" class="Module">Data.Nat.GeneralisedArithmetic</a>  <a id="776" class="Keyword">using</a> <a id="782" class="Symbol">(</a><a id="783" href="Data.Nat.GeneralisedArithmetic.html#866" class="Function">iterate</a><a id="790" class="Symbol">)</a>
<a id="792" class="Keyword">open</a> <a id="797" class="Keyword">import</a> <a id="804" href="Data.Rational.html" class="Module">Data.Rational</a>                   <a id="836" class="Keyword">using</a> <a id="842" class="Symbol">(</a><a id="843" href="Data.Rational.Base.html#1421" class="Record">ℚ</a><a id="844" class="Symbol">;</a> <a id="846" href="Data.Rational.Base.html#7195" class="Function">floor</a><a id="851" class="Symbol">;</a> <a id="853" href="Data.Rational.Base.html#6394" class="Function Operator">_*_</a><a id="856" class="Symbol">;</a> <a id="858" href="Data.Rational.Base.html#6787" class="Function Operator">_÷_</a><a id="861" class="Symbol">;</a> <a id="863" href="Data.Rational.Base.html#3963" class="Function Operator">_/_</a><a id="866" class="Symbol">;</a> <a id="868" href="Data.Rational.Base.html#6933" class="Function Operator">_⊓_</a><a id="871" class="Symbol">;</a> <a id="873" href="Data.Rational.Properties.html#4152" class="Function Operator">_≟_</a><a id="876" class="Symbol">;</a> <a id="878" href="Data.Rational.Base.html#4971" class="Function">≢-nonZero</a><a id="887" class="Symbol">)</a>
<a id="889" class="Keyword">open</a> <a id="894" class="Keyword">import</a> <a id="901" href="Data.Rational.Literals.html" class="Module">Data.Rational.Literals</a>          <a id="933" class="Keyword">using</a> <a id="939" class="Symbol">(</a><a id="940" href="Data.Rational.Literals.html#740" class="Function">number</a><a id="946" class="Symbol">;</a> <a id="948" href="Data.Rational.Literals.html#613" class="Function">fromℤ</a><a id="953" class="Symbol">)</a>
<a id="955" class="Keyword">open</a> <a id="960" class="Keyword">import</a> <a id="967" href="Data.Rational.Properties.html" class="Module">Data.Rational.Properties</a>        <a id="999" class="Keyword">using</a> <a id="1005" class="Symbol">(</a><a id="1006" href="Data.Rational.Properties.html#27061" class="Function">nonNegative⁻¹</a><a id="1019" class="Symbol">;</a> <a id="1021" href="Data.Rational.Properties.html#7555" class="Function">pos⇒nonNeg</a><a id="1031" class="Symbol">;</a> <a id="1033" href="Algebra.Construct.NaturalChoice.MinOp.html#7120" class="Function">⊓-glb</a><a id="1038" class="Symbol">)</a>

<a id="1041" class="Keyword">open</a> <a id="1046" class="Keyword">import</a> <a id="1053" href="stdlib.Data.Rational.Properties.html" class="Module">stdlib.Data.Rational.Properties</a> <a id="1085" class="Keyword">using</a> <a id="1091" class="Symbol">(</a><a id="1092" href="stdlib.Data.Rational.Properties.html#1631" class="Function">0≤⇒0≤floor</a><a id="1102" class="Symbol">;</a> <a id="1104" href="stdlib.Data.Rational.Properties.html#2865" class="Function">÷-0≤⇒0≤</a><a id="1111" class="Symbol">;</a> <a id="1113" href="stdlib.Data.Rational.Properties.html#2275" class="Function">fromℕ-0≤</a><a id="1121" class="Symbol">;</a> <a id="1123" href="stdlib.Data.Rational.Properties.html#2409" class="Function">*-0≤⇒0≤</a><a id="1130" class="Symbol">;</a> <a id="1132" href="stdlib.Data.Rational.Properties.html#2013" class="Function">fromℤ-0≤</a><a id="1140" class="Symbol">)</a>

<a id="1143" class="Keyword">open</a> <a id="1148" class="Keyword">import</a> <a id="1155" href="Ledger.Prelude.html" class="Module">Ledger.Prelude</a> <a id="1170" class="Keyword">hiding</a> <a id="1177" class="Symbol">(</a><a id="1178" href="Data.List.Base.html#5114" class="Function">iterate</a><a id="1185" class="Symbol">;</a> <a id="1187" href="Data.Nat.Base.html#7102" class="Function Operator">_/_</a><a id="1190" class="Symbol">;</a> <a id="1192" href="Agda.Builtin.Nat.html#539" class="Primitive Operator">_*_</a><a id="1195" class="Symbol">;</a> <a id="1197" href="Data.Nat.Base.html#5851" class="Function Operator">_⊓_</a><a id="1200" class="Symbol">;</a> <a id="1202" href="Class.DecEq.Core.html#168" class="Field Operator">_≟_</a><a id="1205" class="Symbol">;</a> <a id="1207" href="Data.Nat.Base.html#3425" class="Function">≢-nonZero</a><a id="1216" class="Symbol">)</a>
<a id="1218" class="Keyword">open</a> <a id="1223" class="Keyword">import</a> <a id="1230" href="Ledger.Prelude.Numeric.UnitInterval.html" class="Module">Ledger.Prelude.Numeric.UnitInterval</a> <a id="1266" class="Keyword">using</a> <a id="1272" class="Symbol">(</a><a id="1273" href="Ledger.Prelude.Numeric.UnitInterval.html#1989" class="Function">fromUnitInterval</a><a id="1289" class="Symbol">;</a> <a id="1291" href="Ledger.Prelude.Numeric.UnitInterval.html#3337" class="Function">UnitInterval-*-0≤</a><a id="1308" class="Symbol">)</a>

<a id="1311" class="Keyword">open</a> <a id="1316" class="Keyword">import</a> <a id="1323" href="Ledger.Conway.Specification.Certs.html" class="Module">Ledger.Conway.Specification.Certs</a> <a id="1357" href="Ledger.Core.Specification.Transaction.html#1970" class="Function">govStructure</a>
<a id="1370" class="Keyword">open</a> <a id="1375" class="Keyword">import</a> <a id="1382" href="Ledger.Conway.Specification.Enact.html" class="Module">Ledger.Conway.Specification.Enact</a> <a id="1416" href="Ledger.Core.Specification.Transaction.html#1970" class="Function">govStructure</a>
<a id="1429" class="Keyword">open</a> <a id="1434" class="Keyword">import</a> <a id="1441" href="Ledger.Conway.Specification.Gov.html" class="Module">Ledger.Conway.Specification.Gov</a> <a id="1473" href="Ledger.Conway.Specification.Epoch.html#168" class="Bound">txs</a>
<a id="1477" class="Keyword">open</a> <a id="1482" class="Keyword">import</a> <a id="1489" href="Ledger.Conway.Specification.Ledger.html" class="Module">Ledger.Conway.Specification.Ledger</a> <a id="1524" href="Ledger.Conway.Specification.Epoch.html#168" class="Bound">txs</a> <a id="1528" href="Ledger.Conway.Specification.Epoch.html#212" class="Bound">abs</a>
<a id="1532" class="Keyword">open</a> <a id="1537" class="Keyword">import</a> <a id="1544" href="Ledger.Conway.Specification.PoolReap.html" class="Module">Ledger.Conway.Specification.PoolReap</a> <a id="1581" href="Ledger.Conway.Specification.Epoch.html#168" class="Bound">txs</a> <a id="1585" href="Ledger.Conway.Specification.Epoch.html#212" class="Bound">abs</a>
<a id="1589" class="Keyword">open</a> <a id="1594" class="Keyword">import</a> <a id="1601" href="Ledger.Conway.Specification.Ratify.html" class="Module">Ledger.Conway.Specification.Ratify</a> <a id="1636" href="Ledger.Conway.Specification.Epoch.html#168" class="Bound">txs</a>
<a id="1640" class="Keyword">open</a> <a id="1645" class="Keyword">import</a> <a id="1652" href="Ledger.Conway.Specification.Rewards.html" class="Module">Ledger.Conway.Specification.Rewards</a> <a id="1688" href="Ledger.Conway.Specification.Epoch.html#168" class="Bound">txs</a> <a id="1692" href="Ledger.Conway.Specification.Epoch.html#212" class="Bound">abs</a>
<a id="1696" class="Keyword">open</a> <a id="1701" class="Keyword">import</a> <a id="1708" href="Ledger.Conway.Specification.Utxo.html" class="Module">Ledger.Conway.Specification.Utxo</a> <a id="1741" href="Ledger.Conway.Specification.Epoch.html#168" class="Bound">txs</a> <a id="1745" href="Ledger.Conway.Specification.Epoch.html#212" class="Bound">abs</a>

<a id="1750" class="Keyword">open</a> <a id="1755" href="Ledger.Prelude.html#2436" class="Module">Filter</a> <a id="1762" class="Keyword">using</a> <a id="1768" class="Symbol">(</a><a id="1769" href="Ledger.Prelude.html#2451" class="Function">filter</a><a id="1775" class="Symbol">)</a>
<a id="1777" class="Keyword">open</a> <a id="1782" href="Agda.Builtin.FromNat.html#196" class="Module">Number</a> <a id="1789" href="Data.Rational.Literals.html#740" class="Function">number</a> <a id="1796" class="Keyword">renaming</a> <a id="1805" class="Symbol">(</a><a id="1806" href="Agda.Builtin.FromNat.html#281" class="Field">fromNat</a> <a id="1814" class="Symbol">to</a> <a id="1817" class="Field">fromℕ</a><a id="1822" class="Symbol">)</a>


<a id="1826" class="Keyword">record</a> <a id="EpochState"></a><a id="1833" href="Ledger.Conway.Specification.Epoch.html#1833" class="Record">EpochState</a> <a id="1844" class="Symbol">:</a> <a id="1846" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="1851" class="Keyword">where</a>


  <a id="1861" class="Keyword">constructor</a> <a id="⟦_,_,_,_,_⟧ᵉ&#39;"></a><a id="1873" href="Ledger.Conway.Specification.Epoch.html#1873" class="InductiveConstructor Operator">⟦_,_,_,_,_⟧ᵉ&#39;</a>


  <a id="1891" class="Keyword">field</a>
    <a id="EpochState.acnt"></a><a id="1901" href="Ledger.Conway.Specification.Epoch.html#1901" class="Field">acnt</a>       <a id="1912" class="Symbol">:</a> <a id="1914" href="Ledger.Conway.Specification.PParams.html#718" class="Record">Acnt</a>
    <a id="EpochState.ss"></a><a id="1923" href="Ledger.Conway.Specification.Epoch.html#1923" class="Field">ss</a>         <a id="1934" class="Symbol">:</a> <a id="1936" href="Ledger.Conway.Specification.Rewards.html#7734" class="Record">Snapshots</a>
    <a id="EpochState.ls"></a><a id="1950" href="Ledger.Conway.Specification.Epoch.html#1950" class="Field">ls</a>         <a id="1961" class="Symbol">:</a> <a id="1963" href="Ledger.Conway.Specification.Ledger.html#997" class="Record">LState</a>
    <a id="EpochState.es"></a><a id="1974" href="Ledger.Conway.Specification.Epoch.html#1974" class="Field">es</a>         <a id="1985" class="Symbol">:</a> <a id="1987" href="Ledger.Conway.Specification.Enact.html#444" class="Record">EnactState</a>
    <a id="EpochState.fut"></a><a id="2002" href="Ledger.Conway.Specification.Epoch.html#2002" class="Field">fut</a>        <a id="2013" class="Symbol">:</a> <a id="2015" href="Ledger.Conway.Specification.Ratify.html#3526" class="Record">RatifyState</a>


<a id="2029" class="Keyword">record</a> <a id="HasEpochState"></a><a id="2036" href="Ledger.Conway.Specification.Epoch.html#2036" class="Record">HasEpochState</a> <a id="2050" class="Symbol">{</a><a id="2051" href="Ledger.Conway.Specification.Epoch.html#2051" class="Bound">a</a><a id="2052" class="Symbol">}</a> <a id="2054" class="Symbol">(</a><a id="2055" href="Ledger.Conway.Specification.Epoch.html#2055" class="Bound">A</a> <a id="2057" class="Symbol">:</a> <a id="2059" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="2064" href="Ledger.Conway.Specification.Epoch.html#2051" class="Bound">a</a><a id="2065" class="Symbol">)</a> <a id="2067" class="Symbol">:</a> <a id="2069" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="2074" href="Ledger.Conway.Specification.Epoch.html#2051" class="Bound">a</a> <a id="2076" class="Keyword">where</a>
  <a id="2084" class="Keyword">field</a> <a id="HasEpochState.EpochStateOf"></a><a id="2090" href="Ledger.Conway.Specification.Epoch.html#2090" class="Field">EpochStateOf</a> <a id="2103" class="Symbol">:</a> <a id="2105" href="Ledger.Conway.Specification.Epoch.html#2055" class="Bound">A</a> <a id="2107" class="Symbol">→</a> <a id="2109" href="Ledger.Conway.Specification.Epoch.html#1833" class="Record">EpochState</a>
<a id="2120" class="Keyword">open</a> <a id="2125" href="Ledger.Conway.Specification.Epoch.html#2036" class="Module">HasEpochState</a> <a id="2139" class="Symbol">⦃...⦄</a> <a id="2145" class="Keyword">public</a>

<a id="2153" class="Keyword">instance</a>
  <a id="HasSnapshots-EpochState"></a><a id="2164" href="Ledger.Conway.Specification.Epoch.html#2164" class="Function">HasSnapshots-EpochState</a> <a id="2188" class="Symbol">:</a> <a id="2190" href="Ledger.Conway.Specification.Rewards.html#7825" class="Record">HasSnapshots</a> <a id="2203" href="Ledger.Conway.Specification.Epoch.html#1833" class="Record">EpochState</a>
  <a id="2216" href="Ledger.Conway.Specification.Epoch.html#2164" class="Function">HasSnapshots-EpochState</a> <a id="2240" class="Symbol">.</a><a id="2241" href="Ledger.Conway.Specification.Rewards.html#7878" class="Field">SnapshotsOf</a> <a id="2253" class="Symbol">=</a> <a id="2255" href="Ledger.Conway.Specification.Epoch.html#1923" class="Field">EpochState.ss</a>

  <a id="HasLState-EpochState"></a><a id="2272" href="Ledger.Conway.Specification.Epoch.html#2272" class="Function">HasLState-EpochState</a> <a id="2293" class="Symbol">:</a> <a id="2295" href="Ledger.Conway.Specification.Ledger.html#1141" class="Record">HasLState</a> <a id="2305" href="Ledger.Conway.Specification.Epoch.html#1833" class="Record">EpochState</a>
  <a id="2318" href="Ledger.Conway.Specification.Epoch.html#2272" class="Function">HasLState-EpochState</a> <a id="2339" class="Symbol">.</a><a id="2340" href="Ledger.Conway.Specification.Ledger.html#1191" class="Field">LStateOf</a> <a id="2349" class="Symbol">=</a> <a id="2351" href="Ledger.Conway.Specification.Epoch.html#1950" class="Field">EpochState.ls</a>

  <a id="HasEnactState-EpochState"></a><a id="2368" href="Ledger.Conway.Specification.Epoch.html#2368" class="Function">HasEnactState-EpochState</a> <a id="2393" class="Symbol">:</a> <a id="2395" href="Ledger.Conway.Specification.Enact.html#733" class="Record">HasEnactState</a> <a id="2409" href="Ledger.Conway.Specification.Epoch.html#1833" class="Record">EpochState</a>
  <a id="2422" href="Ledger.Conway.Specification.Epoch.html#2368" class="Function">HasEnactState-EpochState</a> <a id="2447" class="Symbol">.</a><a id="2448" href="Ledger.Conway.Specification.Enact.html#787" class="Field">EnactStateOf</a> <a id="2461" class="Symbol">=</a> <a id="2463" href="Ledger.Conway.Specification.Epoch.html#1974" class="Field">EpochState.es</a>

  <a id="HasDeposits-EpochState"></a><a id="2480" href="Ledger.Conway.Specification.Epoch.html#2480" class="Function">HasDeposits-EpochState</a> <a id="2503" class="Symbol">:</a> <a id="2505" href="Ledger.Core.Specification.Certs.html#833" class="Record">HasDeposits</a> <a id="2517" href="Ledger.Conway.Specification.Epoch.html#1833" class="Record">EpochState</a>
  <a id="2530" href="Ledger.Conway.Specification.Epoch.html#2480" class="Function">HasDeposits-EpochState</a> <a id="2553" class="Symbol">.</a><a id="2554" href="Ledger.Core.Specification.Certs.html#885" class="Field">DepositsOf</a> <a id="2565" class="Symbol">=</a> <a id="2567" href="Ledger.Core.Specification.Certs.html#885" class="Field">DepositsOf</a> <a id="2578" href="Function.Base.html#1134" class="Function Operator">∘</a> <a id="2580" href="Ledger.Conway.Specification.Ledger.html#1191" class="Field">LStateOf</a>

  <a id="HasDReps-EpochState"></a><a id="2592" href="Ledger.Conway.Specification.Epoch.html#2592" class="Function">HasDReps-EpochState</a> <a id="2612" class="Symbol">:</a> <a id="2614" href="Ledger.Core.Specification.Certs.html#1523" class="Record">HasDReps</a> <a id="2623" href="Ledger.Conway.Specification.Epoch.html#1833" class="Record">EpochState</a>
  <a id="2636" href="Ledger.Conway.Specification.Epoch.html#2592" class="Function">HasDReps-EpochState</a> <a id="2656" class="Symbol">.</a><a id="2657" href="Ledger.Core.Specification.Certs.html#1572" class="Field">DRepsOf</a> <a id="2665" class="Symbol">=</a> <a id="2667" href="Ledger.Core.Specification.Certs.html#1572" class="Field">DRepsOf</a> <a id="2675" href="Function.Base.html#1134" class="Function Operator">∘</a> <a id="2677" href="Ledger.Core.Specification.Certs.html#4890" class="Field">CertStateOf</a> <a id="2689" href="Function.Base.html#1134" class="Function Operator">∘</a> <a id="2691" href="Ledger.Conway.Specification.Ledger.html#1191" class="Field">LStateOf</a>

  <a id="HasTreasury-EpochState"></a><a id="2703" href="Ledger.Conway.Specification.Epoch.html#2703" class="Function">HasTreasury-EpochState</a> <a id="2726" class="Symbol">:</a> <a id="2728" href="Ledger.Prelude.Base.html#837" class="Record">HasTreasury</a> <a id="2740" href="Ledger.Conway.Specification.Epoch.html#1833" class="Record">EpochState</a>
  <a id="2753" href="Ledger.Conway.Specification.Epoch.html#2703" class="Function">HasTreasury-EpochState</a> <a id="2776" class="Symbol">.</a><a id="2777" href="Ledger.Prelude.Base.html#889" class="Field">TreasuryOf</a> <a id="2788" class="Symbol">=</a> <a id="2790" href="Ledger.Conway.Specification.PParams.html#773" class="Field">Acnt.treasury</a> <a id="2804" href="Function.Base.html#1134" class="Function Operator">∘</a> <a id="2806" href="Ledger.Conway.Specification.Epoch.html#1901" class="Field">EpochState.acnt</a>

  <a id="HasReserves-EpochState"></a><a id="2825" href="Ledger.Conway.Specification.Epoch.html#2825" class="Function">HasReserves-EpochState</a> <a id="2848" class="Symbol">:</a> <a id="2850" href="Ledger.Prelude.Base.html#721" class="Record">HasReserves</a> <a id="2862" href="Ledger.Conway.Specification.Epoch.html#1833" class="Record">EpochState</a>
  <a id="2875" href="Ledger.Conway.Specification.Epoch.html#2825" class="Function">HasReserves-EpochState</a> <a id="2898" class="Symbol">.</a><a id="2899" href="Ledger.Prelude.Base.html#773" class="Field">ReservesOf</a> <a id="2910" class="Symbol">=</a> <a id="2912" href="Ledger.Conway.Specification.PParams.html#782" class="Field">Acnt.reserves</a> <a id="2926" href="Function.Base.html#1134" class="Function Operator">∘</a> <a id="2928" href="Ledger.Conway.Specification.Epoch.html#1901" class="Field">EpochState.acnt</a>

  <a id="HasPParams-EpochState"></a><a id="2947" href="Ledger.Conway.Specification.Epoch.html#2947" class="Function">HasPParams-EpochState</a> <a id="2969" class="Symbol">:</a> <a id="2971" href="Ledger.Conway.Specification.PParams.html#3491" class="Record">HasPParams</a> <a id="2982" href="Ledger.Conway.Specification.Epoch.html#1833" class="Record">EpochState</a>
  <a id="2995" href="Ledger.Conway.Specification.Epoch.html#2947" class="Function">HasPParams-EpochState</a> <a id="3017" class="Symbol">.</a><a id="3018" href="Ledger.Conway.Specification.PParams.html#3542" class="Field">PParamsOf</a> <a id="3028" class="Symbol">=</a> <a id="3030" href="Ledger.Conway.Specification.PParams.html#3542" class="Field">PParamsOf</a> <a id="3040" href="Function.Base.html#1134" class="Function Operator">∘</a> <a id="3042" href="Ledger.Conway.Specification.Enact.html#787" class="Field">EnactStateOf</a>

  <a id="HasRatifyState-EpochState"></a><a id="3058" href="Ledger.Conway.Specification.Epoch.html#3058" class="Function">HasRatifyState-EpochState</a> <a id="3084" class="Symbol">:</a> <a id="3086" href="Ledger.Conway.Specification.Ratify.html#3662" class="Record">HasRatifyState</a> <a id="3101" href="Ledger.Conway.Specification.Epoch.html#1833" class="Record">EpochState</a>
  <a id="3114" href="Ledger.Conway.Specification.Epoch.html#3058" class="Function">HasRatifyState-EpochState</a> <a id="3140" class="Symbol">.</a><a id="3141" href="Ledger.Conway.Specification.Ratify.html#3717" class="Field">RatifyStateOf</a> <a id="3155" class="Symbol">=</a> <a id="3157" href="Ledger.Conway.Specification.Epoch.html#2002" class="Field">EpochState.fut</a>

  <a id="HasPState-EpochState"></a><a id="3175" href="Ledger.Conway.Specification.Epoch.html#3175" class="Function">HasPState-EpochState</a> <a id="3196" class="Symbol">:</a> <a id="3198" href="Ledger.Core.Specification.Certs.html#4621" class="Record">HasPState</a> <a id="3208" href="Ledger.Conway.Specification.Epoch.html#1833" class="Record">EpochState</a>
  <a id="3221" href="Ledger.Conway.Specification.Epoch.html#3175" class="Function">HasPState-EpochState</a> <a id="3242" class="Symbol">.</a><a id="3243" href="Ledger.Core.Specification.Certs.html#4671" class="Field">PStateOf</a> <a id="3252" class="Symbol">=</a> <a id="3254" href="Ledger.Core.Specification.Certs.html#4671" class="Field">PStateOf</a> <a id="3263" href="Function.Base.html#1134" class="Function Operator">∘</a> <a id="3265" href="Ledger.Core.Specification.Certs.html#4890" class="Field">CertStateOf</a> <a id="3277" href="Function.Base.html#1134" class="Function Operator">∘</a> <a id="3279" href="Ledger.Conway.Specification.Ledger.html#1191" class="Field">LStateOf</a>


<a id="PoolDelegatedStake"></a><a id="3290" href="Ledger.Conway.Specification.Epoch.html#3290" class="Function">PoolDelegatedStake</a> <a id="3309" class="Symbol">:</a> <a id="3311" href="Agda.Primitive.html#388" class="Primitive">Type</a>
<a id="3316" href="Ledger.Conway.Specification.Epoch.html#3290" class="Function">PoolDelegatedStake</a> <a id="3335" class="Symbol">=</a> <a id="3337" href="Ledger.Core.Specification.Crypto.html#1386" class="Function">KeyHash</a> <a id="3345" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="3347" href="Ledger.Prelude.Base.html#154" class="Function">Coin</a>

<a id="3353" class="Keyword">record</a> <a id="NewEpochState"></a><a id="3360" href="Ledger.Conway.Specification.Epoch.html#3360" class="Record">NewEpochState</a> <a id="3374" class="Symbol">:</a> <a id="3376" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="3381" class="Keyword">where</a>
  <a id="3389" class="Keyword">field</a>
    <a id="NewEpochState.lastEpoch"></a><a id="3399" href="Ledger.Conway.Specification.Epoch.html#3399" class="Field">lastEpoch</a>   <a id="3411" class="Symbol">:</a> <a id="3413" href="Ledger.Core.Specification.Epoch.html#646" class="Function">Epoch</a>
    <a id="NewEpochState.bprev"></a><a id="3423" href="Ledger.Conway.Specification.Epoch.html#3423" class="Field">bprev</a>       <a id="3435" class="Symbol">:</a> <a id="3437" href="Ledger.Conway.Specification.Rewards.html#4921" class="Function">BlocksMade</a>
    <a id="NewEpochState.bcur"></a><a id="3452" href="Ledger.Conway.Specification.Epoch.html#3452" class="Field">bcur</a>        <a id="3464" class="Symbol">:</a> <a id="3466" href="Ledger.Conway.Specification.Rewards.html#4921" class="Function">BlocksMade</a>
    <a id="NewEpochState.epochState"></a><a id="3481" href="Ledger.Conway.Specification.Epoch.html#3481" class="Field">epochState</a>  <a id="3493" class="Symbol">:</a> <a id="3495" href="Ledger.Conway.Specification.Epoch.html#1833" class="Record">EpochState</a>
    <a id="NewEpochState.ru"></a><a id="3510" href="Ledger.Conway.Specification.Epoch.html#3510" class="Field">ru</a>          <a id="3522" class="Symbol">:</a> <a id="3524" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="3530" href="Ledger.Conway.Specification.Rewards.html#6264" class="Record">RewardUpdate</a>
    <a id="NewEpochState.pd"></a><a id="3547" href="Ledger.Conway.Specification.Epoch.html#3547" class="Field">pd</a>          <a id="3559" class="Symbol">:</a> <a id="3561" href="Ledger.Conway.Specification.Epoch.html#3290" class="Function">PoolDelegatedStake</a>


<a id="3582" class="Keyword">record</a> <a id="HasNewEpochState"></a><a id="3589" href="Ledger.Conway.Specification.Epoch.html#3589" class="Record">HasNewEpochState</a> <a id="3606" class="Symbol">{</a><a id="3607" href="Ledger.Conway.Specification.Epoch.html#3607" class="Bound">a</a><a id="3608" class="Symbol">}</a> <a id="3610" class="Symbol">(</a><a id="3611" href="Ledger.Conway.Specification.Epoch.html#3611" class="Bound">A</a> <a id="3613" class="Symbol">:</a> <a id="3615" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="3620" href="Ledger.Conway.Specification.Epoch.html#3607" class="Bound">a</a><a id="3621" class="Symbol">)</a> <a id="3623" class="Symbol">:</a> <a id="3625" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="3630" href="Ledger.Conway.Specification.Epoch.html#3607" class="Bound">a</a> <a id="3632" class="Keyword">where</a>
  <a id="3640" class="Keyword">field</a> <a id="HasNewEpochState.NewEpochStateOf"></a><a id="3646" href="Ledger.Conway.Specification.Epoch.html#3646" class="Field">NewEpochStateOf</a> <a id="3662" class="Symbol">:</a> <a id="3664" href="Ledger.Conway.Specification.Epoch.html#3611" class="Bound">A</a> <a id="3666" class="Symbol">→</a> <a id="3668" href="Ledger.Conway.Specification.Epoch.html#3360" class="Record">NewEpochState</a>
<a id="3682" class="Keyword">open</a> <a id="3687" href="Ledger.Conway.Specification.Epoch.html#3589" class="Module">HasNewEpochState</a> <a id="3704" class="Symbol">⦃...⦄</a> <a id="3710" class="Keyword">public</a>
<a id="3717" class="Keyword">record</a> <a id="HasLastEpoch"></a><a id="3724" href="Ledger.Conway.Specification.Epoch.html#3724" class="Record">HasLastEpoch</a>     <a id="3741" class="Symbol">{</a><a id="3742" href="Ledger.Conway.Specification.Epoch.html#3742" class="Bound">a</a><a id="3743" class="Symbol">}</a> <a id="3745" class="Symbol">(</a><a id="3746" href="Ledger.Conway.Specification.Epoch.html#3746" class="Bound">A</a> <a id="3748" class="Symbol">:</a> <a id="3750" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="3755" href="Ledger.Conway.Specification.Epoch.html#3742" class="Bound">a</a><a id="3756" class="Symbol">)</a> <a id="3758" class="Symbol">:</a> <a id="3760" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="3765" href="Ledger.Conway.Specification.Epoch.html#3742" class="Bound">a</a> <a id="3767" class="Keyword">where</a> <a id="3773" class="Keyword">field</a> <a id="HasLastEpoch.LastEpochOf"></a><a id="3779" href="Ledger.Conway.Specification.Epoch.html#3779" class="Field">LastEpochOf</a>     <a id="3795" class="Symbol">:</a> <a id="3797" href="Ledger.Conway.Specification.Epoch.html#3746" class="Bound">A</a> <a id="3799" class="Symbol">→</a> <a id="3801" href="Ledger.Core.Specification.Epoch.html#646" class="Function">Epoch</a>
<a id="3807" class="Keyword">open</a> <a id="3812" href="Ledger.Conway.Specification.Epoch.html#3724" class="Module">HasLastEpoch</a>     <a id="3829" class="Symbol">⦃...⦄</a> <a id="3835" class="Keyword">public</a>

<a id="3843" class="Keyword">instance</a>
  <a id="HasLastEpoch-NewEpochState"></a><a id="3854" href="Ledger.Conway.Specification.Epoch.html#3854" class="Function">HasLastEpoch-NewEpochState</a> <a id="3881" class="Symbol">:</a> <a id="3883" href="Ledger.Conway.Specification.Epoch.html#3724" class="Record">HasLastEpoch</a> <a id="3896" href="Ledger.Conway.Specification.Epoch.html#3360" class="Record">NewEpochState</a>
  <a id="3912" href="Ledger.Conway.Specification.Epoch.html#3854" class="Function">HasLastEpoch-NewEpochState</a> <a id="3939" class="Symbol">.</a><a id="3940" href="Ledger.Conway.Specification.Epoch.html#3779" class="Field">LastEpochOf</a> <a id="3952" class="Symbol">=</a> <a id="3954" href="Ledger.Conway.Specification.Epoch.html#3399" class="Field">NewEpochState.lastEpoch</a>

  <a id="HasEpochState-NewEpochState"></a><a id="3981" href="Ledger.Conway.Specification.Epoch.html#3981" class="Function">HasEpochState-NewEpochState</a> <a id="4009" class="Symbol">:</a> <a id="4011" href="Ledger.Conway.Specification.Epoch.html#2036" class="Record">HasEpochState</a> <a id="4025" href="Ledger.Conway.Specification.Epoch.html#3360" class="Record">NewEpochState</a>
  <a id="4041" href="Ledger.Conway.Specification.Epoch.html#3981" class="Function">HasEpochState-NewEpochState</a> <a id="4069" class="Symbol">.</a><a id="4070" href="Ledger.Conway.Specification.Epoch.html#2090" class="Field">EpochStateOf</a> <a id="4083" class="Symbol">=</a> <a id="4085" href="Ledger.Conway.Specification.Epoch.html#3481" class="Field">NewEpochState.epochState</a>

  <a id="HasEnactState-NewEpochState"></a><a id="4113" href="Ledger.Conway.Specification.Epoch.html#4113" class="Function">HasEnactState-NewEpochState</a> <a id="4141" class="Symbol">:</a> <a id="4143" href="Ledger.Conway.Specification.Enact.html#733" class="Record">HasEnactState</a> <a id="4157" href="Ledger.Conway.Specification.Epoch.html#3360" class="Record">NewEpochState</a>
  <a id="4173" href="Ledger.Conway.Specification.Epoch.html#4113" class="Function">HasEnactState-NewEpochState</a> <a id="4201" class="Symbol">.</a><a id="4202" href="Ledger.Conway.Specification.Enact.html#787" class="Field">EnactStateOf</a> <a id="4215" class="Symbol">=</a> <a id="4217" href="Ledger.Conway.Specification.Enact.html#787" class="Field">EnactStateOf</a> <a id="4230" href="Function.Base.html#1134" class="Function Operator">∘</a> <a id="4232" href="Ledger.Conway.Specification.Epoch.html#2090" class="Field">EpochStateOf</a>

  <a id="Hastreasury-NewEpochState"></a><a id="4248" href="Ledger.Conway.Specification.Epoch.html#4248" class="Function">Hastreasury-NewEpochState</a> <a id="4274" class="Symbol">:</a> <a id="4276" href="Ledger.Prelude.Base.html#837" class="Record">HasTreasury</a> <a id="4288" href="Ledger.Conway.Specification.Epoch.html#3360" class="Record">NewEpochState</a>
  <a id="4304" href="Ledger.Conway.Specification.Epoch.html#4248" class="Function">Hastreasury-NewEpochState</a> <a id="4330" class="Symbol">.</a><a id="4331" href="Ledger.Prelude.Base.html#889" class="Field">TreasuryOf</a> <a id="4342" class="Symbol">=</a> <a id="4344" href="Ledger.Prelude.Base.html#889" class="Field">TreasuryOf</a> <a id="4355" href="Function.Base.html#1134" class="Function Operator">∘</a> <a id="4357" href="Ledger.Conway.Specification.Epoch.html#2090" class="Field">EpochStateOf</a>

  <a id="HasLState-NewEpochState"></a><a id="4373" href="Ledger.Conway.Specification.Epoch.html#4373" class="Function">HasLState-NewEpochState</a> <a id="4397" class="Symbol">:</a> <a id="4399" href="Ledger.Conway.Specification.Ledger.html#1141" class="Record">HasLState</a> <a id="4409" href="Ledger.Conway.Specification.Epoch.html#3360" class="Record">NewEpochState</a>
  <a id="4425" href="Ledger.Conway.Specification.Epoch.html#4373" class="Function">HasLState-NewEpochState</a> <a id="4449" class="Symbol">.</a><a id="4450" href="Ledger.Conway.Specification.Ledger.html#1191" class="Field">LStateOf</a> <a id="4459" class="Symbol">=</a> <a id="4461" href="Ledger.Conway.Specification.Ledger.html#1191" class="Field">LStateOf</a> <a id="4470" href="Function.Base.html#1134" class="Function Operator">∘</a> <a id="4472" href="Ledger.Conway.Specification.Epoch.html#2090" class="Field">EpochStateOf</a>

  <a id="HasGovState-NewEpochState"></a><a id="4488" href="Ledger.Conway.Specification.Epoch.html#4488" class="Function">HasGovState-NewEpochState</a> <a id="4514" class="Symbol">:</a> <a id="4516" href="Ledger.Conway.Specification.Gov.html#1531" class="Record">HasGovState</a> <a id="4528" href="Ledger.Conway.Specification.Epoch.html#3360" class="Record">NewEpochState</a>
  <a id="4544" href="Ledger.Conway.Specification.Epoch.html#4488" class="Function">HasGovState-NewEpochState</a> <a id="4570" class="Symbol">.</a><a id="4571" href="Ledger.Conway.Specification.Gov.html#1583" class="Field">GovStateOf</a> <a id="4582" class="Symbol">=</a> <a id="4584" href="Ledger.Conway.Specification.Gov.html#1583" class="Field">GovStateOf</a> <a id="4595" href="Function.Base.html#1134" class="Function Operator">∘</a> <a id="4597" href="Ledger.Conway.Specification.Ledger.html#1191" class="Field">LStateOf</a>

  <a id="HasCertState-NewEpochState"></a><a id="4609" href="Ledger.Conway.Specification.Epoch.html#4609" class="Function">HasCertState-NewEpochState</a> <a id="4636" class="Symbol">:</a> <a id="4638" href="Ledger.Core.Specification.Certs.html#4837" class="Record">HasCertState</a> <a id="4651" href="Ledger.Conway.Specification.Epoch.html#3360" class="Record">NewEpochState</a>
  <a id="4667" href="Ledger.Conway.Specification.Epoch.html#4609" class="Function">HasCertState-NewEpochState</a> <a id="4694" class="Symbol">.</a><a id="4695" href="Ledger.Core.Specification.Certs.html#4890" class="Field">CertStateOf</a> <a id="4707" class="Symbol">=</a> <a id="4709" href="Ledger.Core.Specification.Certs.html#4890" class="Field">CertStateOf</a> <a id="4721" href="Function.Base.html#1134" class="Function Operator">∘</a> <a id="4723" href="Ledger.Conway.Specification.Ledger.html#1191" class="Field">LStateOf</a>

  <a id="HasDReps-NewEpochState"></a><a id="4735" href="Ledger.Conway.Specification.Epoch.html#4735" class="Function">HasDReps-NewEpochState</a> <a id="4758" class="Symbol">:</a> <a id="4760" href="Ledger.Core.Specification.Certs.html#1523" class="Record">HasDReps</a> <a id="4769" href="Ledger.Conway.Specification.Epoch.html#3360" class="Record">NewEpochState</a>
  <a id="4785" href="Ledger.Conway.Specification.Epoch.html#4735" class="Function">HasDReps-NewEpochState</a> <a id="4808" class="Symbol">.</a><a id="4809" href="Ledger.Core.Specification.Certs.html#1572" class="Field">DRepsOf</a> <a id="4817" class="Symbol">=</a> <a id="4819" href="Ledger.Core.Specification.Certs.html#1572" class="Field">DRepsOf</a> <a id="4827" href="Function.Base.html#1134" class="Function Operator">∘</a> <a id="4829" href="Ledger.Core.Specification.Certs.html#4890" class="Field">CertStateOf</a>

  <a id="HasRewards-NewEpochState"></a><a id="4844" href="Ledger.Conway.Specification.Epoch.html#4844" class="Function">HasRewards-NewEpochState</a> <a id="4869" class="Symbol">:</a> <a id="4871" href="Ledger.Core.Specification.Certs.html#1763" class="Record">HasRewards</a> <a id="4882" href="Ledger.Conway.Specification.Epoch.html#3360" class="Record">NewEpochState</a>
  <a id="4898" href="Ledger.Conway.Specification.Epoch.html#4844" class="Function">HasRewards-NewEpochState</a> <a id="4923" class="Symbol">.</a><a id="4924" href="Ledger.Core.Specification.Certs.html#1814" class="Field">RewardsOf</a> <a id="4934" class="Symbol">=</a> <a id="4936" href="Ledger.Core.Specification.Certs.html#1814" class="Field">RewardsOf</a> <a id="4946" href="Function.Base.html#1134" class="Function Operator">∘</a> <a id="4948" href="Ledger.Core.Specification.Certs.html#4890" class="Field">CertStateOf</a>

  <a id="HasPParams-NewEpochState"></a><a id="4963" href="Ledger.Conway.Specification.Epoch.html#4963" class="Function">HasPParams-NewEpochState</a> <a id="4988" class="Symbol">:</a> <a id="4990" href="Ledger.Conway.Specification.PParams.html#3491" class="Record">HasPParams</a> <a id="5001" href="Ledger.Conway.Specification.Epoch.html#3360" class="Record">NewEpochState</a>
  <a id="5017" href="Ledger.Conway.Specification.Epoch.html#4963" class="Function">HasPParams-NewEpochState</a> <a id="5042" class="Symbol">.</a><a id="5043" href="Ledger.Conway.Specification.PParams.html#3542" class="Field">PParamsOf</a> <a id="5053" class="Symbol">=</a> <a id="5055" href="Ledger.Conway.Specification.PParams.html#3542" class="Field">PParamsOf</a> <a id="5065" href="Function.Base.html#1134" class="Function Operator">∘</a> <a id="5067" href="Ledger.Conway.Specification.Epoch.html#2090" class="Field">EpochStateOf</a>

  <a id="5083" class="Keyword">unquoteDecl</a> <a id="HasCast-EpochState"></a><a id="5095" href="Ledger.Conway.Specification.Epoch.html#5095" class="Function">HasCast-EpochState</a> <a id="HasCast-NewEpochState"></a><a id="5114" href="Ledger.Conway.Specification.Epoch.html#5114" class="Function">HasCast-NewEpochState</a> <a id="5136" class="Symbol">=</a> <a id="5138" href="stdlib-classes.Class.HasCast.Derive.html#2690" class="Function">derive-HasCast</a>
    <a id="5157" class="Symbol">(</a> <a id="5159" class="Symbol">(</a><a id="5160" class="Keyword">quote</a> <a id="5166" href="Ledger.Conway.Specification.Epoch.html#1833" class="Record">EpochState</a>     <a id="5181" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5183" href="Ledger.Conway.Specification.Epoch.html#5095" class="Function">HasCast-EpochState</a><a id="5201" class="Symbol">)</a>
    <a id="5207" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="5209" href="Data.List.Base.html#4907" class="Function Operator">[</a> <a id="5211" class="Symbol">(</a><a id="5212" class="Keyword">quote</a> <a id="5218" href="Ledger.Conway.Specification.Epoch.html#3360" class="Record">NewEpochState</a>  <a id="5233" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5235" href="Ledger.Conway.Specification.Epoch.html#5114" class="Function">HasCast-NewEpochState</a><a id="5256" class="Symbol">)</a><a id="5257" href="Data.List.Base.html#4907" class="Function Operator">]</a><a id="5258" class="Symbol">)</a>

<a id="toRwdAddr"></a><a id="5261" href="Ledger.Conway.Specification.Epoch.html#5261" class="Function">toRwdAddr</a> <a id="5271" class="Symbol">:</a> <a id="5273" href="Ledger.Core.Specification.Address.html#259" class="Datatype">Credential</a> <a id="5284" class="Symbol">→</a> <a id="5286" href="Ledger.Core.Specification.Address.html#1313" class="Record">RwdAddr</a>
<a id="5294" href="Ledger.Conway.Specification.Epoch.html#5261" class="Function">toRwdAddr</a> <a id="5304" href="Ledger.Conway.Specification.Epoch.html#5304" class="Bound">x</a> <a id="5306" class="Symbol">=</a> <a id="5308" class="Keyword">record</a> <a id="5315" class="Symbol">{</a> <a id="5317" href="Ledger.Core.Specification.Address.html#1346" class="Field">net</a> <a id="5321" class="Symbol">=</a> <a id="5323" href="Ledger.Core.Specification.Epoch.html#2703" class="Function">NetworkId</a> <a id="5333" class="Symbol">;</a> <a id="5335" href="Ledger.Core.Specification.Address.html#1367" class="Field">stake</a> <a id="5341" class="Symbol">=</a> <a id="5343" href="Ledger.Conway.Specification.Epoch.html#5304" class="Bound">x</a> <a id="5345" class="Symbol">}</a>

<a id="getStakeCred"></a><a id="5348" href="Ledger.Conway.Specification.Epoch.html#5348" class="Function">getStakeCred</a> <a id="5361" class="Symbol">:</a> <a id="5363" href="Ledger.Core.Specification.Transaction.html#2529" class="Function">TxOut</a> <a id="5369" class="Symbol">→</a> <a id="5371" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="5377" href="Ledger.Core.Specification.Address.html#259" class="Datatype">Credential</a>
<a id="5388" href="Ledger.Conway.Specification.Epoch.html#5348" class="Function">getStakeCred</a> <a id="5401" class="Symbol">(</a><a id="5402" href="Ledger.Conway.Specification.Epoch.html#5402" class="Bound">a</a> <a id="5404" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5406" class="Symbol">_</a> <a id="5408" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5410" class="Symbol">_</a> <a id="5412" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5414" class="Symbol">_)</a> <a id="5417" class="Symbol">=</a> <a id="5419" href="Ledger.Core.Specification.Address.html#2659" class="Function">stakeCred</a> <a id="5429" href="Ledger.Conway.Specification.Epoch.html#5402" class="Bound">a</a>

<a id="5432" class="Keyword">open</a> <a id="5437" href="Ledger.Core.Specification.Gov.Actions.html#3811" class="Module">GovActionState</a> <a id="5452" class="Keyword">using</a> <a id="5458" class="Symbol">(</a><a id="5459" href="Ledger.Core.Specification.Gov.Actions.html#3878" class="Field">returnAddr</a><a id="5469" class="Symbol">)</a>

<a id="5472" class="Keyword">opaque</a>


  <a id="createRUpd"></a><a id="5483" href="Ledger.Conway.Specification.Epoch.html#5483" class="Function">createRUpd</a> <a id="5494" class="Symbol">:</a> <a id="5496" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a> <a id="5498" class="Symbol">→</a> <a id="5500" href="Ledger.Conway.Specification.Rewards.html#4921" class="Function">BlocksMade</a> <a id="5511" class="Symbol">→</a> <a id="5513" href="Ledger.Conway.Specification.Epoch.html#1833" class="Record">EpochState</a> <a id="5524" class="Symbol">→</a> <a id="5526" href="Ledger.Prelude.Base.html#154" class="Function">Coin</a> <a id="5531" class="Symbol">→</a> <a id="5533" href="Ledger.Conway.Specification.Rewards.html#6264" class="Record">RewardUpdate</a>
  <a id="5548" href="Ledger.Conway.Specification.Epoch.html#5483" class="Function">createRUpd</a> <a id="5559" href="Ledger.Conway.Specification.Epoch.html#5559" class="Bound">slotsPerEpoch</a> <a id="5573" href="Ledger.Conway.Specification.Epoch.html#5573" class="Bound">b</a> <a id="5575" href="Ledger.Conway.Specification.Epoch.html#5575" class="Bound">es</a> <a id="5578" href="Ledger.Conway.Specification.Epoch.html#5578" class="Bound">total</a> <a id="5584" class="Symbol">=</a>
    <a id="5590" class="Keyword">record</a>  <a id="5598" class="Symbol">{</a> <a id="5600" href="Ledger.Conway.Specification.Rewards.html#6301" class="Field">Δt</a> <a id="5603" class="Symbol">=</a> <a id="5605" href="Ledger.Conway.Specification.Epoch.html#6561" class="Function">Δt₁</a>
            <a id="5621" class="Symbol">;</a> <a id="5623" href="Ledger.Conway.Specification.Rewards.html#6304" class="Field">Δr</a> <a id="5626" class="Symbol">=</a> <a id="5628" class="Number">0</a> <a id="5630" href="Interface.TypeClasses.HasSubtract.html#223" class="Field Operator">-</a> <a id="5632" href="Ledger.Conway.Specification.Epoch.html#6547" class="Function">Δr₁</a> <a id="5636" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="5638" href="Ledger.Conway.Specification.Epoch.html#6883" class="Function">Δr₂</a>
            <a id="5654" class="Symbol">;</a> <a id="5656" href="Ledger.Conway.Specification.Rewards.html#6307" class="Field">Δf</a> <a id="5659" class="Symbol">=</a> <a id="5661" class="Number">0</a> <a id="5663" href="Interface.TypeClasses.HasSubtract.html#223" class="Field Operator">-</a> <a id="5665" href="Ledger.Conway.Specification.Epoch.html#412" class="InductiveConstructor">pos</a> <a id="5669" href="Ledger.Conway.Specification.Epoch.html#6048" class="Function">feeSS</a>
            <a id="5687" class="Symbol">;</a> <a id="5689" href="Ledger.Conway.Specification.Rewards.html#6327" class="Field">rs</a> <a id="5692" class="Symbol">=</a> <a id="5694" href="Ledger.Conway.Specification.Epoch.html#6788" class="Function">rs</a>


            <a id="5711" class="Symbol">;</a> <a id="5713" href="Ledger.Conway.Specification.Rewards.html#6357" class="Field">flowConservation</a> <a id="5730" class="Symbol">=</a> <a id="5732" href="Ledger.Conway.Specification.Epoch.html#7176" class="Function">flowConservation</a>
            <a id="5761" class="Symbol">;</a> <a id="5763" href="Ledger.Conway.Specification.Rewards.html#6420" class="Field">Δt-nonnegative</a> <a id="5778" class="Symbol">=</a> <a id="5780" href="Ledger.Conway.Specification.Epoch.html#8314" class="Function">Δt-nonneg</a>
            <a id="5802" class="Symbol">;</a> <a id="5804" href="Ledger.Conway.Specification.Rewards.html#6451" class="Field">Δf-nonpositive</a> <a id="5819" class="Symbol">=</a> <a id="5821" href="Ledger.Conway.Specification.Epoch.html#8496" class="Function">Δf-nonpos</a>


            <a id="5845" class="Symbol">}</a>
    <a id="5851" class="Keyword">where</a>
      <a id="5863" href="Ledger.Conway.Specification.Epoch.html#5863" class="Function">prevPp</a> <a id="5870" class="Symbol">:</a> <a id="5872" href="Ledger.Conway.Specification.PParams.html#1687" class="Record">PParams</a>
      <a id="5886" href="Ledger.Conway.Specification.Epoch.html#5863" class="Function">prevPp</a> <a id="5893" class="Symbol">=</a> <a id="5895" href="Ledger.Conway.Specification.PParams.html#3542" class="Field">PParamsOf</a> <a id="5905" href="Ledger.Conway.Specification.Epoch.html#5575" class="Bound">es</a>

      <a id="5915" href="Ledger.Conway.Specification.Epoch.html#5915" class="Function">reserves</a> <a id="5924" class="Symbol">:</a> <a id="5926" href="Ledger.Prelude.Base.html#191" class="Function">Reserves</a>
      <a id="5941" href="Ledger.Conway.Specification.Epoch.html#5915" class="Function">reserves</a> <a id="5950" class="Symbol">=</a> <a id="5952" href="Ledger.Prelude.Base.html#773" class="Field">ReservesOf</a> <a id="5963" href="Ledger.Conway.Specification.Epoch.html#5575" class="Bound">es</a>

      <a id="5973" href="Ledger.Conway.Specification.Epoch.html#5973" class="Function">pstakego</a> <a id="5982" class="Symbol">:</a> <a id="5984" href="Ledger.Conway.Specification.Rewards.html#6487" class="Record">Snapshot</a>
      <a id="5999" href="Ledger.Conway.Specification.Epoch.html#5973" class="Function">pstakego</a> <a id="6008" class="Symbol">=</a> <a id="6010" class="Symbol">(</a><a id="6011" href="Ledger.Conway.Specification.Rewards.html#7878" class="Field">SnapshotsOf</a> <a id="6023" href="Ledger.Conway.Specification.Epoch.html#5575" class="Bound">es</a><a id="6025" class="Symbol">)</a> <a id="6027" class="Symbol">.</a><a id="6028" href="Ledger.Conway.Specification.Rewards.html#7777" class="Field">Snapshots.go</a>

      <a id="6048" href="Ledger.Conway.Specification.Epoch.html#6048" class="Function">feeSS</a> <a id="6054" class="Symbol">:</a> <a id="6056" href="Ledger.Prelude.Base.html#186" class="Function">Fees</a>
      <a id="6067" href="Ledger.Conway.Specification.Epoch.html#6048" class="Function">feeSS</a> <a id="6073" class="Symbol">=</a> <a id="6075" href="Ledger.Prelude.Base.html#669" class="Field">FeesOf</a> <a id="6082" class="Symbol">(</a><a id="6083" href="Ledger.Conway.Specification.Rewards.html#7878" class="Field">SnapshotsOf</a> <a id="6095" href="Ledger.Conway.Specification.Epoch.html#5575" class="Bound">es</a><a id="6097" class="Symbol">)</a>

      <a id="6106" href="Ledger.Conway.Specification.Epoch.html#6106" class="Function">stake</a> <a id="6112" class="Symbol">:</a> <a id="6114" href="Ledger.Core.Specification.Certs.html#1331" class="Function">Stake</a>
      <a id="6126" href="Ledger.Conway.Specification.Epoch.html#6106" class="Function">stake</a> <a id="6132" class="Symbol">=</a> <a id="6134" href="Ledger.Core.Specification.Certs.html#1895" class="Field">StakeOf</a> <a id="6142" href="Ledger.Conway.Specification.Epoch.html#5973" class="Function">pstakego</a>

      <a id="6158" href="Ledger.Conway.Specification.Epoch.html#6158" class="Function">delegs</a> <a id="6165" class="Symbol">:</a> <a id="6167" href="Ledger.Core.Specification.Certs.html#1371" class="Function">StakeDelegs</a>
      <a id="6185" href="Ledger.Conway.Specification.Epoch.html#6158" class="Function">delegs</a> <a id="6192" class="Symbol">=</a> <a id="6194" href="Ledger.Core.Specification.Certs.html#1979" class="Field">StakeDelegsOf</a> <a id="6208" href="Ledger.Conway.Specification.Epoch.html#5973" class="Function">pstakego</a>

      <a id="6224" href="Ledger.Conway.Specification.Epoch.html#6224" class="Function">poolParams</a> <a id="6235" class="Symbol">:</a> <a id="6237" href="Ledger.Core.Specification.Certs.html#1195" class="Function">Pools</a>
      <a id="6249" href="Ledger.Conway.Specification.Epoch.html#6224" class="Function">poolParams</a> <a id="6260" class="Symbol">=</a> <a id="6262" href="Ledger.Core.Specification.Certs.html#1649" class="Field">PoolsOf</a> <a id="6270" href="Ledger.Conway.Specification.Epoch.html#5973" class="Function">pstakego</a>

      <a id="6286" href="Ledger.Conway.Specification.Epoch.html#6286" class="Function">blocksMade</a> <a id="6297" class="Symbol">:</a> <a id="6299" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a>
      <a id="6307" href="Ledger.Conway.Specification.Epoch.html#6286" class="Function">blocksMade</a> <a id="6318" class="Symbol">=</a> <a id="6320" href="abstract-set-theory.FiniteSetTheory.html#4312" class="Function">∑[</a> <a id="6323" href="Ledger.Conway.Specification.Epoch.html#6323" class="Bound">m</a> <a id="6325" href="abstract-set-theory.FiniteSetTheory.html#4312" class="Function">←</a> <a id="6327" href="Ledger.Conway.Specification.Epoch.html#5573" class="Bound">b</a> <a id="6329" href="abstract-set-theory.FiniteSetTheory.html#4312" class="Function">]</a> <a id="6331" href="Ledger.Conway.Specification.Epoch.html#6323" class="Bound">m</a>

      <a id="6340" href="Ledger.Conway.Specification.Epoch.html#6340" class="Function">ρ</a> <a id="6342" href="Ledger.Conway.Specification.Epoch.html#6342" class="Function">η</a> <a id="6344" href="Ledger.Conway.Specification.Epoch.html#6344" class="Function">τ</a> <a id="6346" class="Symbol">:</a> <a id="6348" href="Data.Rational.Base.html#1421" class="Record">ℚ</a>
      <a id="6356" href="Ledger.Conway.Specification.Epoch.html#6340" class="Function">ρ</a> <a id="6358" class="Symbol">=</a> <a id="6360" href="Ledger.Prelude.Numeric.UnitInterval.html#1989" class="Function">fromUnitInterval</a> <a id="6377" class="Symbol">(</a><a id="6378" href="Ledger.Conway.Specification.Epoch.html#5863" class="Function">prevPp</a> <a id="6385" class="Symbol">.</a><a id="6386" href="Ledger.Conway.Specification.PParams.html#2283" class="Field">PParams.monetaryExpansion</a><a id="6411" class="Symbol">)</a>
      <a id="6419" href="Ledger.Conway.Specification.Epoch.html#6342" class="Function">η</a> <a id="6421" class="Symbol">=</a> <a id="6423" href="Ledger.Conway.Specification.Epoch.html#1817" class="Function">fromℕ</a> <a id="6429" href="Ledger.Conway.Specification.Epoch.html#6286" class="Function">blocksMade</a> <a id="6440" href="Ledger.Prelude.html#2064" class="Function Operator">÷₀</a> <a id="6443" class="Symbol">(</a><a id="6444" href="Ledger.Conway.Specification.Epoch.html#1817" class="Function">fromℕ</a> <a id="6450" href="Ledger.Conway.Specification.Epoch.html#5559" class="Bound">slotsPerEpoch</a> <a id="6464" href="Data.Rational.Base.html#6394" class="Function Operator">*</a> <a id="6466" href="Ledger.Core.Specification.Epoch.html#2485" class="Function">ActiveSlotCoeff</a><a id="6481" class="Symbol">)</a>
      <a id="6489" href="Ledger.Conway.Specification.Epoch.html#6344" class="Function">τ</a> <a id="6491" class="Symbol">=</a> <a id="6493" href="Ledger.Prelude.Numeric.UnitInterval.html#1989" class="Function">fromUnitInterval</a> <a id="6510" class="Symbol">(</a><a id="6511" href="Ledger.Conway.Specification.Epoch.html#5863" class="Function">prevPp</a> <a id="6518" class="Symbol">.</a><a id="6519" href="Ledger.Conway.Specification.PParams.html#2353" class="Field">PParams.treasuryCut</a><a id="6538" class="Symbol">)</a>

      <a id="6547" href="Ledger.Conway.Specification.Epoch.html#6547" class="Function">Δr₁</a> <a id="6551" href="Ledger.Conway.Specification.Epoch.html#6551" class="Function">rewardPot</a> <a id="6561" href="Ledger.Conway.Specification.Epoch.html#6561" class="Function">Δt₁</a> <a id="6565" href="Ledger.Conway.Specification.Epoch.html#6565" class="Function">R</a> <a id="6567" class="Symbol">:</a> <a id="6569" href="Agda.Builtin.Int.html#245" class="Datatype">ℤ</a>
      <a id="6577" href="Ledger.Conway.Specification.Epoch.html#6547" class="Function">Δr₁</a> <a id="6581" class="Symbol">=</a> <a id="6583" href="Data.Rational.Base.html#7195" class="Function">floor</a> <a id="6589" class="Symbol">(</a><a id="6590" class="Number">1</a> <a id="6592" href="Data.Rational.Base.html#6933" class="Function Operator">⊓</a> <a id="6594" href="Ledger.Conway.Specification.Epoch.html#6342" class="Function">η</a> <a id="6596" href="Data.Rational.Base.html#6394" class="Function Operator">*</a> <a id="6598" href="Ledger.Conway.Specification.Epoch.html#6340" class="Function">ρ</a> <a id="6600" href="Data.Rational.Base.html#6394" class="Function Operator">*</a> <a id="6602" href="Ledger.Conway.Specification.Epoch.html#1817" class="Function">fromℕ</a> <a id="6608" href="Ledger.Conway.Specification.Epoch.html#5915" class="Function">reserves</a><a id="6616" class="Symbol">)</a>
      <a id="6624" href="Ledger.Conway.Specification.Epoch.html#6551" class="Function">rewardPot</a> <a id="6634" class="Symbol">=</a> <a id="6636" href="Ledger.Conway.Specification.Epoch.html#412" class="InductiveConstructor">pos</a> <a id="6640" href="Ledger.Conway.Specification.Epoch.html#6048" class="Function">feeSS</a> <a id="6646" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="6648" href="Ledger.Conway.Specification.Epoch.html#6547" class="Function">Δr₁</a>
      <a id="6658" href="Ledger.Conway.Specification.Epoch.html#6561" class="Function">Δt₁</a> <a id="6662" class="Symbol">=</a> <a id="6664" href="Data.Rational.Base.html#7195" class="Function">floor</a> <a id="6670" class="Symbol">(</a><a id="6671" href="Data.Rational.Literals.html#613" class="Function">fromℤ</a> <a id="6677" href="Ledger.Conway.Specification.Epoch.html#6551" class="Function">rewardPot</a> <a id="6687" href="Data.Rational.Base.html#6394" class="Function Operator">*</a> <a id="6689" href="Ledger.Conway.Specification.Epoch.html#6344" class="Function">τ</a><a id="6690" class="Symbol">)</a>
      <a id="6698" href="Ledger.Conway.Specification.Epoch.html#6565" class="Function">R</a> <a id="6700" class="Symbol">=</a> <a id="6702" href="Ledger.Conway.Specification.Epoch.html#6551" class="Function">rewardPot</a> <a id="6712" href="Interface.TypeClasses.HasSubtract.html#223" class="Field Operator">-</a> <a id="6714" href="Ledger.Conway.Specification.Epoch.html#6561" class="Function">Δt₁</a>

      <a id="6725" href="Ledger.Conway.Specification.Epoch.html#6725" class="Function">circulation</a> <a id="6737" class="Symbol">:</a> <a id="6739" href="Ledger.Prelude.Base.html#154" class="Function">Coin</a>
      <a id="6750" href="Ledger.Conway.Specification.Epoch.html#6725" class="Function">circulation</a> <a id="6762" class="Symbol">=</a> <a id="6764" href="Ledger.Conway.Specification.Epoch.html#5578" class="Bound">total</a> <a id="6770" href="Interface.TypeClasses.HasSubtract.html#223" class="Field Operator">-</a> <a id="6772" href="Ledger.Conway.Specification.Epoch.html#5915" class="Function">reserves</a>

      <a id="6788" href="Ledger.Conway.Specification.Epoch.html#6788" class="Function">rs</a> <a id="6791" class="Symbol">:</a> <a id="6793" href="Ledger.Core.Specification.Certs.html#1287" class="Function">Rewards</a>
      <a id="6807" href="Ledger.Conway.Specification.Epoch.html#6788" class="Function">rs</a> <a id="6810" class="Symbol">=</a> <a id="6812" href="Ledger.Conway.Specification.Rewards.html#5412" class="Function">reward</a> <a id="6819" href="Ledger.Conway.Specification.Epoch.html#5863" class="Function">prevPp</a> <a id="6826" href="Ledger.Conway.Specification.Epoch.html#5573" class="Bound">b</a> <a id="6828" class="Symbol">(</a><a id="6829" href="Prelude.html#3280" class="Function">posPart</a> <a id="6837" href="Ledger.Conway.Specification.Epoch.html#6565" class="Function">R</a><a id="6838" class="Symbol">)</a> <a id="6840" href="Ledger.Conway.Specification.Epoch.html#6224" class="Function">poolParams</a> <a id="6851" href="Ledger.Conway.Specification.Epoch.html#6106" class="Function">stake</a> <a id="6857" href="Ledger.Conway.Specification.Epoch.html#6158" class="Function">delegs</a> <a id="6864" href="Ledger.Conway.Specification.Epoch.html#6725" class="Function">circulation</a>

      <a id="6883" href="Ledger.Conway.Specification.Epoch.html#6883" class="Function">Δr₂</a> <a id="6887" class="Symbol">:</a> <a id="6889" href="Agda.Builtin.Int.html#245" class="Datatype">ℤ</a>
      <a id="6897" href="Ledger.Conway.Specification.Epoch.html#6883" class="Function">Δr₂</a> <a id="6901" class="Symbol">=</a> <a id="6903" href="Ledger.Conway.Specification.Epoch.html#6565" class="Function">R</a> <a id="6905" href="Interface.TypeClasses.HasSubtract.html#223" class="Field Operator">-</a> <a id="6907" href="Ledger.Conway.Specification.Epoch.html#412" class="InductiveConstructor">pos</a> <a id="6911" class="Symbol">(</a><a id="6912" href="abstract-set-theory.FiniteSetTheory.html#4312" class="Function">∑[</a> <a id="6915" href="Ledger.Conway.Specification.Epoch.html#6915" class="Bound">c</a> <a id="6917" href="abstract-set-theory.FiniteSetTheory.html#4312" class="Function">←</a> <a id="6919" href="Ledger.Conway.Specification.Epoch.html#6788" class="Function">rs</a> <a id="6922" href="abstract-set-theory.FiniteSetTheory.html#4312" class="Function">]</a> <a id="6924" href="Ledger.Conway.Specification.Epoch.html#6915" class="Bound">c</a><a id="6925" class="Symbol">)</a>


      <a id="6935" class="Comment">-- Proofs</a>
      <a id="6951" class="Comment">-- Note: Overloading of + and - seems to interfere with the ring solver.</a>
      <a id="7030" href="Ledger.Conway.Specification.Epoch.html#7030" class="Function">lemmaFlow</a> <a id="7040" class="Symbol">:</a> <a id="7042" class="Symbol">∀</a> <a id="7044" class="Symbol">(</a><a id="7045" href="Ledger.Conway.Specification.Epoch.html#7045" class="Bound">t₁</a> <a id="7048" href="Ledger.Conway.Specification.Epoch.html#7048" class="Bound">r₁</a> <a id="7051" href="Ledger.Conway.Specification.Epoch.html#7051" class="Bound">f</a> <a id="7053" href="Ledger.Conway.Specification.Epoch.html#7053" class="Bound">z</a> <a id="7055" class="Symbol">:</a> <a id="7057" href="Agda.Builtin.Int.html#245" class="Datatype">ℤ</a><a id="7058" class="Symbol">)</a>
        <a id="7068" class="Symbol">→</a> <a id="7070" class="Symbol">(</a><a id="7071" href="Ledger.Conway.Specification.Epoch.html#7045" class="Bound">t₁</a> <a id="7074" href="Data.Integer.Base.html#5064" class="Function Operator">ℤ.+</a> <a id="7078" class="Symbol">(</a><a id="7079" class="Number">0</a> <a id="7081" href="Data.Integer.Base.html#5245" class="Function Operator">ℤ.-</a> <a id="7085" href="Ledger.Conway.Specification.Epoch.html#7048" class="Bound">r₁</a> <a id="7088" href="Data.Integer.Base.html#5064" class="Function Operator">ℤ.+</a> <a id="7092" class="Symbol">((</a><a id="7094" href="Ledger.Conway.Specification.Epoch.html#7051" class="Bound">f</a> <a id="7096" href="Data.Integer.Base.html#5064" class="Function Operator">ℤ.+</a> <a id="7100" href="Ledger.Conway.Specification.Epoch.html#7048" class="Bound">r₁</a> <a id="7103" href="Data.Integer.Base.html#5245" class="Function Operator">ℤ.-</a> <a id="7107" href="Ledger.Conway.Specification.Epoch.html#7045" class="Bound">t₁</a><a id="7109" class="Symbol">)</a> <a id="7111" href="Data.Integer.Base.html#5245" class="Function Operator">ℤ.-</a> <a id="7115" href="Ledger.Conway.Specification.Epoch.html#7053" class="Bound">z</a><a id="7116" class="Symbol">))</a> <a id="7119" href="Data.Integer.Base.html#5064" class="Function Operator">ℤ.+</a> <a id="7123" class="Symbol">(</a><a id="7124" class="Number">0</a> <a id="7126" href="Data.Integer.Base.html#5245" class="Function Operator">ℤ.-</a> <a id="7130" href="Ledger.Conway.Specification.Epoch.html#7051" class="Bound">f</a><a id="7131" class="Symbol">)</a> <a id="7133" href="Data.Integer.Base.html#5064" class="Function Operator">ℤ.+</a> <a id="7137" href="Ledger.Conway.Specification.Epoch.html#7053" class="Bound">z</a><a id="7138" class="Symbol">)</a> <a id="7140" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="7142" class="Number">0</a>
      <a id="7150" href="Ledger.Conway.Specification.Epoch.html#7030" class="Function">lemmaFlow</a> <a id="7160" class="Symbol">=</a> <a id="7162" href="Data.Integer.Tactic.RingSolver.html#1200" class="Macro">solve-∀</a>
      <a id="7176" href="Ledger.Conway.Specification.Epoch.html#7176" class="Function">flowConservation</a> <a id="7193" class="Symbol">:</a>
        <a id="7203" class="Keyword">let</a> <a id="7207" href="Ledger.Conway.Specification.Epoch.html#7207" class="Bound">t₁</a> <a id="7210" class="Symbol">=</a> <a id="7212" href="Ledger.Conway.Specification.Epoch.html#6561" class="Function">Δt₁</a>
            <a id="7228" href="Ledger.Conway.Specification.Epoch.html#7228" class="Bound">r₁</a> <a id="7231" class="Symbol">=</a> <a id="7233" href="Ledger.Conway.Specification.Epoch.html#6547" class="Function">Δr₁</a>
            <a id="7249" href="Ledger.Conway.Specification.Epoch.html#7249" class="Bound">f</a>  <a id="7252" class="Symbol">=</a> <a id="7254" href="Ledger.Conway.Specification.Epoch.html#412" class="InductiveConstructor">pos</a> <a id="7258" href="Ledger.Conway.Specification.Epoch.html#6048" class="Function">feeSS</a>
            <a id="7276" href="Ledger.Conway.Specification.Epoch.html#7276" class="Bound">z</a>  <a id="7279" class="Symbol">=</a> <a id="7281" href="Ledger.Conway.Specification.Epoch.html#412" class="InductiveConstructor">pos</a> <a id="7285" class="Symbol">(</a><a id="7286" href="abstract-set-theory.FiniteSetTheory.html#4312" class="Function">∑[</a> <a id="7289" href="Ledger.Conway.Specification.Epoch.html#7289" class="Bound">c</a> <a id="7291" href="abstract-set-theory.FiniteSetTheory.html#4312" class="Function">←</a> <a id="7293" href="Ledger.Conway.Specification.Epoch.html#6788" class="Function">rs</a> <a id="7296" href="abstract-set-theory.FiniteSetTheory.html#4312" class="Function">]</a> <a id="7298" href="Ledger.Conway.Specification.Epoch.html#7289" class="Bound">c</a><a id="7299" class="Symbol">)</a>
         <a id="7310" class="Keyword">in</a>
            <a id="7325" class="Symbol">(</a><a id="7326" href="Ledger.Conway.Specification.Epoch.html#7207" class="Bound">t₁</a> <a id="7329" href="Data.Integer.Base.html#5064" class="Function Operator">ℤ.+</a> <a id="7333" class="Symbol">(</a><a id="7334" class="Number">0</a> <a id="7336" href="Data.Integer.Base.html#5245" class="Function Operator">ℤ.-</a> <a id="7340" href="Ledger.Conway.Specification.Epoch.html#7228" class="Bound">r₁</a> <a id="7343" href="Data.Integer.Base.html#5064" class="Function Operator">ℤ.+</a> <a id="7347" class="Symbol">((</a><a id="7349" href="Ledger.Conway.Specification.Epoch.html#7249" class="Bound">f</a> <a id="7351" href="Data.Integer.Base.html#5064" class="Function Operator">ℤ.+</a> <a id="7355" href="Ledger.Conway.Specification.Epoch.html#7228" class="Bound">r₁</a> <a id="7358" href="Data.Integer.Base.html#5245" class="Function Operator">ℤ.-</a> <a id="7362" href="Ledger.Conway.Specification.Epoch.html#7207" class="Bound">t₁</a><a id="7364" class="Symbol">)</a> <a id="7366" href="Data.Integer.Base.html#5245" class="Function Operator">ℤ.-</a> <a id="7370" href="Ledger.Conway.Specification.Epoch.html#7276" class="Bound">z</a><a id="7371" class="Symbol">))</a> <a id="7374" href="Data.Integer.Base.html#5064" class="Function Operator">ℤ.+</a> <a id="7378" class="Symbol">(</a><a id="7379" class="Number">0</a> <a id="7381" href="Data.Integer.Base.html#5245" class="Function Operator">ℤ.-</a> <a id="7385" href="Ledger.Conway.Specification.Epoch.html#7249" class="Bound">f</a><a id="7386" class="Symbol">)</a> <a id="7388" href="Data.Integer.Base.html#5064" class="Function Operator">ℤ.+</a> <a id="7392" href="Ledger.Conway.Specification.Epoch.html#7276" class="Bound">z</a><a id="7393" class="Symbol">)</a> <a id="7395" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="7397" class="Number">0</a>
      <a id="7405" href="Ledger.Conway.Specification.Epoch.html#7176" class="Function">flowConservation</a> <a id="7422" class="Symbol">=</a> <a id="7424" href="Ledger.Conway.Specification.Epoch.html#7030" class="Function">lemmaFlow</a> <a id="7434" href="Ledger.Conway.Specification.Epoch.html#6561" class="Function">Δt₁</a> <a id="7438" href="Ledger.Conway.Specification.Epoch.html#6547" class="Function">Δr₁</a> <a id="7442" class="Symbol">(</a><a id="7443" href="Ledger.Conway.Specification.Epoch.html#412" class="InductiveConstructor">pos</a> <a id="7447" href="Ledger.Conway.Specification.Epoch.html#6048" class="Function">feeSS</a><a id="7452" class="Symbol">)</a> <a id="7454" class="Symbol">(</a><a id="7455" href="Ledger.Conway.Specification.Epoch.html#412" class="InductiveConstructor">pos</a> <a id="7459" class="Symbol">(</a><a id="7460" href="abstract-set-theory.FiniteSetTheory.html#4312" class="Function">∑[</a> <a id="7463" href="Ledger.Conway.Specification.Epoch.html#7463" class="Bound">c</a> <a id="7465" href="abstract-set-theory.FiniteSetTheory.html#4312" class="Function">←</a> <a id="7467" href="Ledger.Conway.Specification.Epoch.html#6788" class="Function">rs</a> <a id="7470" href="abstract-set-theory.FiniteSetTheory.html#4312" class="Function">]</a> <a id="7472" href="Ledger.Conway.Specification.Epoch.html#7463" class="Bound">c</a><a id="7473" class="Symbol">))</a>

      <a id="7483" href="Ledger.Conway.Specification.Epoch.html#7483" class="Function">÷₀-0≤⇒0≤</a> <a id="7492" class="Symbol">:</a> <a id="7494" class="Symbol">∀</a> <a id="7496" class="Symbol">(</a><a id="7497" href="Ledger.Conway.Specification.Epoch.html#7497" class="Bound">x</a> <a id="7499" href="Ledger.Conway.Specification.Epoch.html#7499" class="Bound">y</a> <a id="7501" class="Symbol">:</a> <a id="7503" href="Data.Rational.Base.html#1421" class="Record">ℚ</a><a id="7504" class="Symbol">)</a> <a id="7506" class="Symbol">→</a> <a id="7508" class="Number">0</a> <a id="7510" href="Class.HasOrder.Core.html#613" class="Field Operator">≤</a> <a id="7512" href="Ledger.Conway.Specification.Epoch.html#7497" class="Bound">x</a> <a id="7514" class="Symbol">→</a> <a id="7516" class="Number">0</a> <a id="7518" href="Class.HasOrder.Core.html#613" class="Field Operator">≤</a> <a id="7520" href="Ledger.Conway.Specification.Epoch.html#7499" class="Bound">y</a> <a id="7522" class="Symbol">→</a> <a id="7524" class="Number">0</a> <a id="7526" href="Class.HasOrder.Core.html#613" class="Field Operator">≤</a> <a id="7528" class="Symbol">(</a><a id="7529" href="Ledger.Conway.Specification.Epoch.html#7497" class="Bound">x</a> <a id="7531" href="Ledger.Prelude.html#2064" class="Function Operator">÷₀</a> <a id="7534" href="Ledger.Conway.Specification.Epoch.html#7499" class="Bound">y</a><a id="7535" class="Symbol">)</a>
      <a id="7543" href="Ledger.Conway.Specification.Epoch.html#7483" class="Function">÷₀-0≤⇒0≤</a> <a id="7552" href="Ledger.Conway.Specification.Epoch.html#7552" class="Bound">x</a> <a id="7554" href="Ledger.Conway.Specification.Epoch.html#7554" class="Bound">y</a> <a id="7556" href="Ledger.Conway.Specification.Epoch.html#7556" class="Bound">0≤x</a> <a id="7560" href="Ledger.Conway.Specification.Epoch.html#7560" class="Bound">0≤y</a> <a id="7564" class="Keyword">with</a> <a id="7569" href="Ledger.Conway.Specification.Epoch.html#7554" class="Bound">y</a> <a id="7571" href="Data.Rational.Properties.html#4152" class="Function Operator">≟</a> <a id="7573" class="Number">0</a>
      <a id="7581" class="Symbol">...</a> <a id="7585" class="Symbol">|</a> <a id="7587" class="Symbol">(</a><a id="7588" href="Relation.Nullary.Decidable.Core.html#2099" class="InductiveConstructor">yes</a> <a id="7592" href="Ledger.Conway.Specification.Epoch.html#7592" class="Bound">y≡0</a><a id="7595" class="Symbol">)</a> <a id="7597" class="Symbol">=</a> <a id="7599" href="Data.Rational.Properties.html#27061" class="Function">nonNegative⁻¹</a> <a id="7613" class="Number">0</a>
      <a id="7621" class="Symbol">...</a> <a id="7625" class="Symbol">|</a> <a id="7627" class="Symbol">(</a><a id="7628" href="Relation.Nullary.Decidable.Core.html#2136" class="InductiveConstructor">no</a> <a id="7631" href="Ledger.Conway.Specification.Epoch.html#7631" class="Bound">y≢0</a><a id="7634" class="Symbol">)</a>  <a id="7637" class="Symbol">=</a> <a id="7639" href="stdlib.Data.Rational.Properties.html#2865" class="Function">÷-0≤⇒0≤</a> <a id="7647" class="Bound">x</a> <a id="7649" class="Bound">y</a> <a id="7651" class="Symbol">{{</a><a id="7653" href="Data.Rational.Base.html#4971" class="Function">≢-nonZero</a> <a id="7663" href="Ledger.Conway.Specification.Epoch.html#7631" class="Bound">y≢0</a><a id="7666" class="Symbol">}}</a> <a id="7669" class="Bound">0≤x</a> <a id="7673" class="Bound">0≤y</a>

      <a id="7684" href="Ledger.Conway.Specification.Epoch.html#7684" class="Function">η-nonneg</a> <a id="7693" class="Symbol">:</a> <a id="7695" class="Number">0</a> <a id="7697" href="Class.HasOrder.Core.html#613" class="Field Operator">≤</a> <a id="7699" href="Ledger.Conway.Specification.Epoch.html#6342" class="Function">η</a>
      <a id="7707" href="Ledger.Conway.Specification.Epoch.html#7684" class="Function">η-nonneg</a> <a id="7716" class="Symbol">=</a> <a id="7718" href="Ledger.Conway.Specification.Epoch.html#7483" class="Function">÷₀-0≤⇒0≤</a> <a id="7727" class="Symbol">_</a> <a id="7729" class="Symbol">_</a> <a id="7731" class="Symbol">(</a><a id="7732" href="stdlib.Data.Rational.Properties.html#2275" class="Function">fromℕ-0≤</a> <a id="7741" href="Ledger.Conway.Specification.Epoch.html#6286" class="Function">blocksMade</a><a id="7751" class="Symbol">)</a>
        <a id="7761" class="Symbol">(</a><a id="7762" href="stdlib.Data.Rational.Properties.html#2409" class="Function">*-0≤⇒0≤</a> <a id="7770" class="Symbol">_</a> <a id="7772" class="Symbol">_</a>
          <a id="7784" class="Symbol">(</a><a id="7785" href="stdlib.Data.Rational.Properties.html#2275" class="Function">fromℕ-0≤</a> <a id="7794" href="Ledger.Conway.Specification.Epoch.html#5559" class="Bound">slotsPerEpoch</a><a id="7807" class="Symbol">)</a>
          <a id="7819" class="Symbol">(</a><a id="7820" href="Data.Rational.Properties.html#27061" class="Function">nonNegative⁻¹</a> <a id="7834" href="Ledger.Core.Specification.Epoch.html#2485" class="Function">ActiveSlotCoeff</a> <a id="7850" class="Symbol">{{</a><a id="7852" href="Data.Rational.Properties.html#7555" class="Function">pos⇒nonNeg</a> <a id="7863" href="Ledger.Core.Specification.Epoch.html#2485" class="Function">ActiveSlotCoeff</a><a id="7878" class="Symbol">}}))</a>

      <a id="7890" href="Ledger.Conway.Specification.Epoch.html#7890" class="Function">min1η-nonneg</a> <a id="7903" class="Symbol">:</a> <a id="7905" class="Number">0</a> <a id="7907" href="Class.HasOrder.Core.html#613" class="Field Operator">≤</a> <a id="7909" class="Number">1</a> <a id="7911" href="Data.Rational.Base.html#6933" class="Function Operator">⊓</a> <a id="7913" href="Ledger.Conway.Specification.Epoch.html#6342" class="Function">η</a>
      <a id="7921" href="Ledger.Conway.Specification.Epoch.html#7890" class="Function">min1η-nonneg</a> <a id="7934" class="Symbol">=</a> <a id="7936" href="Algebra.Construct.NaturalChoice.MinOp.html#7120" class="Function">⊓-glb</a> <a id="7942" class="Symbol">(</a><a id="7943" href="Data.Rational.Properties.html#27061" class="Function">nonNegative⁻¹</a> <a id="7957" class="Number">1</a><a id="7958" class="Symbol">)</a> <a id="7960" href="Ledger.Conway.Specification.Epoch.html#7684" class="Function">η-nonneg</a>

      <a id="7976" href="Ledger.Conway.Specification.Epoch.html#7976" class="Function">Δr₁-nonneg</a> <a id="7987" class="Symbol">:</a> <a id="7989" class="Number">0</a> <a id="7991" href="Class.HasOrder.Core.html#613" class="Field Operator">≤</a> <a id="7993" href="Ledger.Conway.Specification.Epoch.html#6547" class="Function">Δr₁</a>
      <a id="8003" href="Ledger.Conway.Specification.Epoch.html#7976" class="Function">Δr₁-nonneg</a> <a id="8014" class="Symbol">=</a> <a id="8016" href="stdlib.Data.Rational.Properties.html#1631" class="Function">0≤⇒0≤floor</a> <a id="8027" class="Symbol">_</a>
        <a id="8037" class="Symbol">(</a><a id="8038" href="stdlib.Data.Rational.Properties.html#2409" class="Function">*-0≤⇒0≤</a> <a id="8046" class="Symbol">(</a><a id="8047" class="Number">1</a> <a id="8049" href="Data.Rational.Base.html#6933" class="Function Operator">⊓</a> <a id="8051" href="Ledger.Conway.Specification.Epoch.html#6342" class="Function">η</a> <a id="8053" href="Data.Rational.Base.html#6394" class="Function Operator">*</a> <a id="8055" href="Ledger.Conway.Specification.Epoch.html#6340" class="Function">ρ</a><a id="8056" class="Symbol">)</a> <a id="8058" class="Symbol">(</a><a id="8059" href="Ledger.Conway.Specification.Epoch.html#1817" class="Function">fromℕ</a> <a id="8065" href="Ledger.Conway.Specification.Epoch.html#5915" class="Function">reserves</a><a id="8073" class="Symbol">)</a>
          <a id="8085" class="Symbol">(</a><a id="8086" href="Ledger.Prelude.Numeric.UnitInterval.html#3337" class="Function">UnitInterval-*-0≤</a> <a id="8104" class="Symbol">(</a><a id="8105" class="Number">1</a> <a id="8107" href="Data.Rational.Base.html#6933" class="Function Operator">⊓</a> <a id="8109" href="Ledger.Conway.Specification.Epoch.html#6342" class="Function">η</a><a id="8110" class="Symbol">)</a> <a id="8112" class="Symbol">(</a><a id="8113" href="Ledger.Conway.Specification.Epoch.html#5863" class="Function">prevPp</a> <a id="8120" class="Symbol">.</a><a id="8121" href="Ledger.Conway.Specification.PParams.html#2283" class="Field">PParams.monetaryExpansion</a><a id="8146" class="Symbol">)</a> <a id="8148" href="Ledger.Conway.Specification.Epoch.html#7890" class="Function">min1η-nonneg</a><a id="8160" class="Symbol">)</a>
          <a id="8172" class="Symbol">(</a><a id="8173" href="stdlib.Data.Rational.Properties.html#2275" class="Function">fromℕ-0≤</a> <a id="8182" href="Ledger.Conway.Specification.Epoch.html#5915" class="Function">reserves</a><a id="8190" class="Symbol">))</a>

      <a id="8200" href="Ledger.Conway.Specification.Epoch.html#8200" class="Function">rewardPot-nonneg</a> <a id="8217" class="Symbol">:</a> <a id="8219" class="Number">0</a> <a id="8221" href="Class.HasOrder.Core.html#613" class="Field Operator">≤</a> <a id="8223" href="Ledger.Conway.Specification.Epoch.html#6551" class="Function">rewardPot</a>
      <a id="8239" href="Ledger.Conway.Specification.Epoch.html#8200" class="Function">rewardPot-nonneg</a> <a id="8256" class="Symbol">=</a> <a id="8258" href="Data.Integer.Properties.html#34810" class="Function">+-mono-≤</a> <a id="8267" class="Symbol">(</a><a id="8268" href="Ledger.Conway.Specification.Epoch.html#594" class="Function">nonNegative⁻¹ℤ</a> <a id="8283" class="Symbol">(</a><a id="8284" href="Ledger.Conway.Specification.Epoch.html#412" class="InductiveConstructor">pos</a> <a id="8288" href="Ledger.Conway.Specification.Epoch.html#6048" class="Function">feeSS</a><a id="8293" class="Symbol">))</a> <a id="8296" href="Ledger.Conway.Specification.Epoch.html#7976" class="Function">Δr₁-nonneg</a>

      <a id="8314" href="Ledger.Conway.Specification.Epoch.html#8314" class="Function">Δt-nonneg</a> <a id="8324" class="Symbol">:</a> <a id="8326" class="Number">0</a> <a id="8328" href="Class.HasOrder.Core.html#613" class="Field Operator">≤</a> <a id="8330" href="Ledger.Conway.Specification.Epoch.html#6561" class="Function">Δt₁</a>
      <a id="8340" href="Ledger.Conway.Specification.Epoch.html#8314" class="Function">Δt-nonneg</a> <a id="8350" class="Symbol">=</a> <a id="8352" href="stdlib.Data.Rational.Properties.html#1631" class="Function">0≤⇒0≤floor</a> <a id="8363" class="Symbol">_</a>
        <a id="8373" class="Symbol">(</a><a id="8374" href="Ledger.Prelude.Numeric.UnitInterval.html#3337" class="Function">UnitInterval-*-0≤</a> <a id="8392" class="Symbol">(</a><a id="8393" href="Data.Rational.Literals.html#613" class="Function">fromℤ</a> <a id="8399" href="Ledger.Conway.Specification.Epoch.html#6551" class="Function">rewardPot</a><a id="8408" class="Symbol">)</a> <a id="8410" class="Symbol">(</a><a id="8411" href="Ledger.Conway.Specification.Epoch.html#5863" class="Function">prevPp</a> <a id="8418" class="Symbol">.</a><a id="8419" href="Ledger.Conway.Specification.PParams.html#2353" class="Field">PParams.treasuryCut</a><a id="8438" class="Symbol">)</a>
          <a id="8450" class="Symbol">(</a><a id="8451" href="stdlib.Data.Rational.Properties.html#2013" class="Function">fromℤ-0≤</a> <a id="8460" href="Ledger.Conway.Specification.Epoch.html#6551" class="Function">rewardPot</a> <a id="8470" href="Ledger.Conway.Specification.Epoch.html#8200" class="Function">rewardPot-nonneg</a><a id="8486" class="Symbol">))</a>

      <a id="8496" href="Ledger.Conway.Specification.Epoch.html#8496" class="Function">Δf-nonpos</a> <a id="8506" class="Symbol">:</a> <a id="8508" class="Symbol">(</a><a id="8509" class="Number">0</a> <a id="8511" href="Interface.TypeClasses.HasSubtract.html#223" class="Field Operator">-</a> <a id="8513" href="Ledger.Conway.Specification.Epoch.html#412" class="InductiveConstructor">pos</a> <a id="8517" href="Ledger.Conway.Specification.Epoch.html#6048" class="Function">feeSS</a><a id="8522" class="Symbol">)</a> <a id="8524" href="Class.HasOrder.Core.html#613" class="Field Operator">≤</a> <a id="8526" class="Number">0</a>
      <a id="8534" href="Ledger.Conway.Specification.Epoch.html#8496" class="Function">Δf-nonpos</a> <a id="8544" class="Symbol">=</a> <a id="8546" href="Relation.Binary.Reasoning.Syntax.html#1572" class="Function Operator">begin</a>
          <a id="8562" class="Number">0</a> <a id="8564" href="Interface.TypeClasses.HasSubtract.html#223" class="Field Operator">-</a> <a id="8566" href="Ledger.Conway.Specification.Epoch.html#412" class="InductiveConstructor">pos</a> <a id="8570" href="Ledger.Conway.Specification.Epoch.html#6048" class="Function">feeSS</a> <a id="8576" href="Relation.Binary.Reasoning.Syntax.html#11048" class="Function">≡⟨</a> <a id="8579" href="Data.Integer.Properties.html#27061" class="Function">+-identityˡ</a> <a id="8591" class="Symbol">_</a> <a id="8593" href="Relation.Binary.Reasoning.Syntax.html#11048" class="Function">⟩</a>
          <a id="8605" href="Data.Integer.Base.html#4719" class="Function Operator">ℤ.-</a> <a id="8609" href="Ledger.Conway.Specification.Epoch.html#412" class="InductiveConstructor">pos</a> <a id="8613" href="Ledger.Conway.Specification.Epoch.html#6048" class="Function">feeSS</a> <a id="8619" href="Relation.Binary.Reasoning.Syntax.html#5544" class="Function">≤⟨</a> <a id="8622" href="Data.Integer.Properties.html#13298" class="Function">neg-mono-≤</a> <a id="8633" class="Symbol">(</a><a id="8634" href="Data.Integer.Base.html#2106" class="InductiveConstructor">ℤ.+≤+</a> <a id="8640" href="Data.Nat.Base.html#1720" class="InductiveConstructor">z≤n</a><a id="8643" class="Symbol">)</a> <a id="8645" href="Relation.Binary.Reasoning.Syntax.html#5544" class="Function">⟩</a>
          <a id="8657" class="Number">0</a>             <a id="8671" href="Relation.Binary.Reasoning.Syntax.html#12345" class="Function Operator">∎</a>
        <a id="8681" class="Keyword">where</a> <a id="8687" class="Keyword">open</a> <a id="8692" href="Data.Integer.Properties.html#11881" class="Module">≤-Reasoning</a>


<a id="applyRUpd"></a><a id="8706" href="Ledger.Conway.Specification.Epoch.html#8706" class="Function">applyRUpd</a> <a id="8716" class="Symbol">:</a> <a id="8718" href="Ledger.Conway.Specification.Rewards.html#6264" class="Record">RewardUpdate</a> <a id="8731" class="Symbol">→</a> <a id="8733" href="Ledger.Conway.Specification.Epoch.html#1833" class="Record">EpochState</a> <a id="8744" class="Symbol">→</a> <a id="8746" href="Ledger.Conway.Specification.Epoch.html#1833" class="Record">EpochState</a>
<a id="8757" href="Ledger.Conway.Specification.Epoch.html#8706" class="Function">applyRUpd</a> <a id="8767" href="Ledger.Conway.Specification.Epoch.html#8767" class="Bound">rewardUpdate</a> <a class="AgdaKaTeX">$\begin{pmatrix} \begin{pmatrix} \,\href{Ledger.Conway.Specification.Epoch.html#8784}{\htmlId{8784}{\htmlClass{Bound}{\text{treasury}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#8795}{\htmlId{8795}{\htmlClass{Bound}{\text{reserves}}}}\, \end{pmatrix}
                       \\ \,\href{Ledger.Conway.Specification.Epoch.html#8832}{\htmlId{8832}{\htmlClass{Bound}{\text{ss}}}}\,
                       \\ \begin{pmatrix} \begin{pmatrix} \,\href{Ledger.Conway.Specification.Epoch.html#8864}{\htmlId{8864}{\htmlClass{Bound}{\text{utxo}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#8871}{\htmlId{8871}{\htmlClass{Bound}{\text{fees}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#8878}{\htmlId{8878}{\htmlClass{Bound}{\text{deposits}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#8889}{\htmlId{8889}{\htmlClass{Bound}{\text{donations}}}}\, \end{pmatrix}
                         \\ \,\href{Ledger.Conway.Specification.Epoch.html#8929}{\htmlId{8929}{\htmlClass{Bound}{\text{govSt}}}}\,
                         \\ \begin{pmatrix} \begin{pmatrix} \,\href{Ledger.Conway.Specification.Epoch.html#8966}{\htmlId{8966}{\htmlClass{Bound}{\text{voteDelegs}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#8979}{\htmlId{8979}{\htmlClass{Bound}{\text{stakeDelegs}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#8993}{\htmlId{8993}{\htmlClass{Bound}{\text{rewards}}}}\, \end{pmatrix} \\ \,\href{Ledger.Conway.Specification.Epoch.html#9006}{\htmlId{9006}{\htmlClass{Bound}{\text{pState}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#9015}{\htmlId{9015}{\htmlClass{Bound}{\text{gState}}}}\, \end{pmatrix} \end{pmatrix}
                       \\ \,\href{Ledger.Conway.Specification.Epoch.html#9054}{\htmlId{9054}{\htmlClass{Bound}{\text{es}}}}\,
                       \\ \,\href{Ledger.Conway.Specification.Epoch.html#9082}{\htmlId{9082}{\htmlClass{Bound}{\text{fut}}}}\,
                       \end{pmatrix}$</a> <a id="9113" class="Symbol">=</a> <a class="AgdaKaTeX">$\begin{pmatrix} \begin{pmatrix} \,\href{Prelude.html#3280}{\htmlId{9119}{\htmlClass{Function}{\text{posPart}}}}\, \,\htmlId{9127}{\htmlClass{Symbol}{\text{(}}}\,\,\href{Ledger.Conway.Specification.Epoch.html#412}{\htmlId{9128}{\htmlClass{InductiveConstructor}{\text{pos}}}}\, \,\href{Ledger.Conway.Specification.Epoch.html#8784}{\htmlId{9132}{\htmlClass{Bound}{\text{treasury}}}}\, \,\href{Class.HasAdd.Core.html#162}{\htmlId{9141}{\htmlClass{Field Operator}{\text{+}}}}\, \,\href{Ledger.Conway.Specification.Rewards.html#6301}{\htmlId{9143}{\htmlClass{Function}{\text{Δt}}}}\, \,\href{Class.HasAdd.Core.html#162}{\htmlId{9146}{\htmlClass{Field Operator}{\text{+}}}}\, \,\href{Ledger.Conway.Specification.Epoch.html#412}{\htmlId{9148}{\htmlClass{InductiveConstructor}{\text{pos}}}}\, \,\href{Ledger.Conway.Specification.Epoch.html#9703}{\htmlId{9152}{\htmlClass{Function}{\text{unregRU&#39;}}}}\,\,\htmlId{9160}{\htmlClass{Symbol}{\text{)}}}\,
                               \\ \,\href{Prelude.html#3280}{\htmlId{9195}{\htmlClass{Function}{\text{posPart}}}}\, \,\htmlId{9203}{\htmlClass{Symbol}{\text{(}}}\,\,\href{Ledger.Conway.Specification.Epoch.html#412}{\htmlId{9204}{\htmlClass{InductiveConstructor}{\text{pos}}}}\, \,\href{Ledger.Conway.Specification.Epoch.html#8795}{\htmlId{9208}{\htmlClass{Bound}{\text{reserves}}}}\, \,\href{Class.HasAdd.Core.html#162}{\htmlId{9217}{\htmlClass{Field Operator}{\text{+}}}}\, \,\href{Ledger.Conway.Specification.Rewards.html#6304}{\htmlId{9219}{\htmlClass{Function}{\text{Δr}}}}\,\,\htmlId{9221}{\htmlClass{Symbol}{\text{)}}}\, \end{pmatrix}
                             \\ \,\href{Ledger.Conway.Specification.Epoch.html#8832}{\htmlId{9256}{\htmlClass{Bound}{\text{ss}}}}\,
                             \\ \begin{pmatrix} \begin{pmatrix} \,\href{Ledger.Conway.Specification.Epoch.html#8864}{\htmlId{9294}{\htmlClass{Bound}{\text{utxo}}}}\, \\ \,\href{Prelude.html#3280}{\htmlId{9301}{\htmlClass{Function}{\text{posPart}}}}\, \,\htmlId{9309}{\htmlClass{Symbol}{\text{(}}}\,\,\href{Ledger.Conway.Specification.Epoch.html#412}{\htmlId{9310}{\htmlClass{InductiveConstructor}{\text{pos}}}}\, \,\href{Ledger.Conway.Specification.Epoch.html#8871}{\htmlId{9314}{\htmlClass{Bound}{\text{fees}}}}\, \,\href{Class.HasAdd.Core.html#162}{\htmlId{9319}{\htmlClass{Field Operator}{\text{+}}}}\, \,\href{Ledger.Conway.Specification.Rewards.html#6307}{\htmlId{9321}{\htmlClass{Function}{\text{Δf}}}}\,\,\htmlId{9323}{\htmlClass{Symbol}{\text{)}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#8878}{\htmlId{9327}{\htmlClass{Bound}{\text{deposits}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#8889}{\htmlId{9338}{\htmlClass{Bound}{\text{donations}}}}\, \end{pmatrix}
                               \\ \,\href{Ledger.Conway.Specification.Epoch.html#8929}{\htmlId{9383}{\htmlClass{Bound}{\text{govSt}}}}\,
                               \\ \begin{pmatrix} \begin{pmatrix} \,\href{Ledger.Conway.Specification.Epoch.html#8966}{\htmlId{9426}{\htmlClass{Bound}{\text{voteDelegs}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#8979}{\htmlId{9439}{\htmlClass{Bound}{\text{stakeDelegs}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#8993}{\htmlId{9453}{\htmlClass{Bound}{\text{rewards}}}}\, \,\href{Axiom.Set.Map.Dec.html#2052}{\htmlId{9461}{\htmlClass{Function Operator}{\text{∪⁺}}}}\, \,\href{Ledger.Conway.Specification.Epoch.html#9635}{\htmlId{9464}{\htmlClass{Function}{\text{regRU}}}}\, \end{pmatrix} \\ \,\href{Ledger.Conway.Specification.Epoch.html#9006}{\htmlId{9474}{\htmlClass{Bound}{\text{pState}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#9015}{\htmlId{9483}{\htmlClass{Bound}{\text{gState}}}}\, \end{pmatrix} \end{pmatrix}
                             \\ \,\href{Ledger.Conway.Specification.Epoch.html#9054}{\htmlId{9525}{\htmlClass{Bound}{\text{es}}}}\,
                             \\ \,\href{Ledger.Conway.Specification.Epoch.html#9082}{\htmlId{9559}{\htmlClass{Bound}{\text{fut}}}}\, \end{pmatrix}$</a>
  <a id="9567" class="Keyword">where</a>
    <a id="9577" class="Keyword">open</a> <a id="9582" href="Ledger.Conway.Specification.Rewards.html#6264" class="Module">RewardUpdate</a> <a id="9595" href="Ledger.Conway.Specification.Epoch.html#8767" class="Bound">rewardUpdate</a> <a id="9608" class="Keyword">using</a> <a id="9614" class="Symbol">(</a><a id="9615" href="Ledger.Conway.Specification.Rewards.html#6301" class="Field">Δt</a><a id="9617" class="Symbol">;</a> <a id="9619" href="Ledger.Conway.Specification.Rewards.html#6304" class="Field">Δr</a><a id="9621" class="Symbol">;</a> <a id="9623" href="Ledger.Conway.Specification.Rewards.html#6307" class="Field">Δf</a><a id="9625" class="Symbol">;</a> <a id="9627" href="Ledger.Conway.Specification.Rewards.html#6327" class="Field">rs</a><a id="9629" class="Symbol">)</a>
    <a id="9635" href="Ledger.Conway.Specification.Epoch.html#9635" class="Function">regRU</a>     <a id="9645" class="Symbol">=</a> <a id="9647" href="Ledger.Conway.Specification.Rewards.html#6327" class="Function">rs</a> <a id="9650" href="Axiom.Set.Map.html#13534" class="Function Operator">∣</a> <a id="9652" href="Class.IsSet.html#916" class="Function">dom</a> <a id="9656" href="Ledger.Conway.Specification.Epoch.html#8993" class="Bound">rewards</a>
    <a id="9668" href="Ledger.Conway.Specification.Epoch.html#9668" class="Function">unregRU</a>   <a id="9678" class="Symbol">=</a> <a id="9680" href="Ledger.Conway.Specification.Rewards.html#6327" class="Function">rs</a> <a id="9683" href="Axiom.Set.Map.html#13604" class="Function Operator">∣</a> <a id="9685" href="Class.IsSet.html#916" class="Function">dom</a> <a id="9689" href="Ledger.Conway.Specification.Epoch.html#8993" class="Bound">rewards</a> <a id="9697" href="Axiom.Set.Map.html#13604" class="Function Operator">ᶜ</a>
    <a id="9703" href="Ledger.Conway.Specification.Epoch.html#9703" class="Function">unregRU&#39;</a>  <a id="9713" class="Symbol">=</a> <a id="9715" href="abstract-set-theory.FiniteSetTheory.html#4312" class="Function">∑[</a> <a id="9718" href="Ledger.Conway.Specification.Epoch.html#9718" class="Bound">x</a> <a id="9720" href="abstract-set-theory.FiniteSetTheory.html#4312" class="Function">←</a> <a id="9722" href="Ledger.Conway.Specification.Epoch.html#9668" class="Function">unregRU</a> <a id="9730" href="abstract-set-theory.FiniteSetTheory.html#4312" class="Function">]</a> <a id="9732" href="Ledger.Conway.Specification.Epoch.html#9718" class="Bound">x</a>


<a id="9736" class="Keyword">open</a> <a id="9741" href="Ledger.Core.Specification.Address.html#1313" class="Module">RwdAddr</a> <a id="9749" class="Keyword">using</a> <a id="9755" class="Symbol">(</a><a id="9756" href="Ledger.Core.Specification.Address.html#1367" class="Field">stake</a><a id="9761" class="Symbol">)</a>
<a id="9763" class="Keyword">opaque</a>


  <a id="calculatePoolDelegatedStake"></a><a id="9774" href="Ledger.Conway.Specification.Epoch.html#9774" class="Function">calculatePoolDelegatedStake</a>
    <a id="9806" class="Symbol">:</a> <a id="9808" href="Ledger.Conway.Specification.Rewards.html#6487" class="Record">Snapshot</a>
    <a id="9821" class="Symbol">→</a> <a id="9823" href="Ledger.Conway.Specification.Epoch.html#3290" class="Function">PoolDelegatedStake</a>
  <a id="9844" href="Ledger.Conway.Specification.Epoch.html#9774" class="Function">calculatePoolDelegatedStake</a> <a id="9872" href="Ledger.Conway.Specification.Epoch.html#9872" class="Bound">ss</a> <a id="9875" class="Symbol">=</a>
      <a id="9883" class="Comment">-- Shelley spec: the output map must contain keys appearing in both</a>
      <a id="9957" class="Comment">-- sd and the pool parameters.</a>
      <a id="9994" href="Ledger.Conway.Specification.Epoch.html#10230" class="Function">sd</a> <a id="9997" href="Axiom.Set.Map.html#13534" class="Function Operator">∣</a> <a id="9999" href="Class.IsSet.html#916" class="Function">dom</a> <a id="10003" class="Symbol">(</a><a id="10004" href="Ledger.Core.Specification.Certs.html#1649" class="Field">PoolsOf</a> <a id="10012" href="Ledger.Conway.Specification.Epoch.html#9872" class="Bound">ss</a><a id="10014" class="Symbol">)</a>
    <a id="10020" class="Keyword">where</a>
      <a id="10032" class="Comment">-- stake credentials delegating to each pool</a>
      <a id="10083" href="Ledger.Conway.Specification.Epoch.html#10083" class="Function">stakeCredentialsPerPool</a> <a id="10107" class="Symbol">:</a> <a id="10109" href="Axiom.Set.Rel.html#1312" class="Function">Rel</a> <a id="10113" href="Ledger.Core.Specification.Crypto.html#1386" class="Function">KeyHash</a> <a id="10121" href="Ledger.Core.Specification.Address.html#259" class="Datatype">Credential</a>
      <a id="10138" href="Ledger.Conway.Specification.Epoch.html#10083" class="Function">stakeCredentialsPerPool</a> <a id="10162" class="Symbol">=</a> <a id="10164" class="Symbol">(</a><a id="10165" href="Ledger.Core.Specification.Certs.html#1979" class="Field">StakeDelegsOf</a> <a id="10179" href="Ledger.Conway.Specification.Epoch.html#9872" class="Bound">ss</a> <a id="10182" href="Axiom.Set.Map.html#2293" class="Function Operator">ˢ</a><a id="10183" class="Symbol">)</a> <a id="10185" href="Axiom.Set.Rel.html#1608" class="Function Operator">⁻¹ʳ</a>

      <a id="10196" class="Comment">-- delegated stake per pool</a>
      <a id="10230" href="Ledger.Conway.Specification.Epoch.html#10230" class="Function">sd</a> <a id="10233" class="Symbol">:</a> <a id="10235" href="Ledger.Core.Specification.Crypto.html#1386" class="Function">KeyHash</a> <a id="10243" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="10245" href="Ledger.Prelude.Base.html#154" class="Function">Coin</a>
      <a id="10256" href="Ledger.Conway.Specification.Epoch.html#10230" class="Function">sd</a> <a id="10259" class="Symbol">=</a> <a id="10261" href="Axiom.Set.Map.Dec.html#2130" class="Function">aggregate₊</a> <a id="10272" class="Symbol">((</a><a id="10274" href="Ledger.Conway.Specification.Epoch.html#10083" class="Function">stakeCredentialsPerPool</a> <a id="10298" href="abstract-set-theory.FiniteSetTheory.html#3050" class="Function Operator">∘ʳ</a> <a id="10301" class="Symbol">(</a><a id="10302" href="Ledger.Core.Specification.Certs.html#1895" class="Field">StakeOf</a> <a id="10310" href="Ledger.Conway.Specification.Epoch.html#9872" class="Bound">ss</a> <a id="10313" href="Axiom.Set.Map.html#2293" class="Function Operator">ˢ</a><a id="10314" class="Symbol">))</a> <a id="10317" href="abstract-set-theory.FiniteSetTheory.html#2860" class="Function Operator">ᶠˢ</a><a id="10319" class="Symbol">)</a>


  <a id="stakeFromGADeposits"></a><a id="10325" href="Ledger.Conway.Specification.Epoch.html#10325" class="Function">stakeFromGADeposits</a>
    <a id="10349" class="Symbol">:</a> <a id="10351" href="Ledger.Conway.Specification.Gov.html#1459" class="Function">GovState</a>
    <a id="10364" class="Symbol">→</a> <a id="10366" href="Ledger.Conway.Specification.Utxo.html#1306" class="Record">UTxOState</a>
    <a id="10380" class="Symbol">→</a> <a id="10382" href="Ledger.Core.Specification.Certs.html#1331" class="Function">Stake</a>
  <a id="10390" href="Ledger.Conway.Specification.Epoch.html#10325" class="Function">stakeFromGADeposits</a> <a id="10410" href="Ledger.Conway.Specification.Epoch.html#10410" class="Bound">govSt</a> <a id="10416" href="Ledger.Conway.Specification.Epoch.html#10416" class="Bound">utxoSt</a> <a id="10423" class="Symbol">=</a> <a id="10425" href="abstract-set-theory.FiniteSetTheory.html#4745" class="Function">aggregateBy</a>
     <a id="10442" class="Symbol">(</a><a id="10443" href="abstract-set-theory.FiniteSetTheory.html#519" class="Function">mapˢ</a> <a id="10448" class="Symbol">(λ</a> <a id="10451" class="Symbol">(</a><a id="10452" href="Ledger.Conway.Specification.Epoch.html#10452" class="Bound">gaid</a> <a id="10457" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="10459" href="Ledger.Conway.Specification.Epoch.html#10459" class="Bound">addr</a><a id="10463" class="Symbol">)</a> <a id="10465" class="Symbol">→</a> <a id="10467" class="Symbol">(</a><a id="10468" href="Ledger.Conway.Specification.Epoch.html#10452" class="Bound">gaid</a> <a id="10473" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="10475" href="Ledger.Conway.Specification.Epoch.html#10459" class="Bound">addr</a><a id="10479" class="Symbol">)</a> <a id="10481" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="10483" href="Ledger.Core.Specification.Address.html#1367" class="Field">stake</a> <a id="10489" href="Ledger.Conway.Specification.Epoch.html#10459" class="Bound">addr</a><a id="10493" class="Symbol">)</a> <a id="10495" href="Ledger.Conway.Specification.Epoch.html#10642" class="Function">govSt&#39;</a><a id="10501" class="Symbol">)</a>
     <a id="10508" class="Symbol">(</a><a id="10509" href="Axiom.Set.Map.html#13316" class="Function">mapFromPartialFun</a> <a id="10527" class="Symbol">(λ</a> <a id="10530" class="Symbol">(</a><a id="10531" href="Ledger.Conway.Specification.Epoch.html#10531" class="Bound">gaid</a> <a id="10536" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="10538" class="Symbol">_)</a> <a id="10541" class="Symbol">→</a> <a id="10543" href="Axiom.Set.Map.html#17167" class="Function">lookupᵐ?</a> <a id="10552" href="Ledger.Conway.Specification.Utxo.html#1414" class="Field">deposits</a> <a id="10561" class="Symbol">(</a><a id="10562" href="Ledger.Core.Specification.Certs.html#723" class="InductiveConstructor">GovActionDeposit</a> <a id="10579" href="Ledger.Conway.Specification.Epoch.html#10531" class="Bound">gaid</a><a id="10583" class="Symbol">))</a> <a id="10586" href="Ledger.Conway.Specification.Epoch.html#10642" class="Function">govSt&#39;</a><a id="10592" class="Symbol">)</a>
     <a id="10599" class="Keyword">where</a>
       <a id="10612" class="Keyword">open</a> <a id="10617" href="Ledger.Conway.Specification.Utxo.html#1306" class="Module">UTxOState</a> <a id="10627" href="Ledger.Conway.Specification.Epoch.html#10416" class="Bound">utxoSt</a>

       <a id="10642" href="Ledger.Conway.Specification.Epoch.html#10642" class="Function">govSt&#39;</a> <a id="10649" class="Symbol">:</a> <a id="10651" href="abstract-set-theory.FiniteSetTheory.html#488" class="Function Operator">ℙ</a> <a id="10653" class="Symbol">(</a><a id="10654" href="Ledger.Core.Specification.Gov.Actions.html#1975" class="Function">GovActionID</a> <a id="10666" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="10668" href="Ledger.Core.Specification.Address.html#1313" class="Record">RwdAddr</a><a id="10675" class="Symbol">)</a>
       <a id="10684" href="Ledger.Conway.Specification.Epoch.html#10642" class="Function">govSt&#39;</a> <a id="10691" class="Symbol">=</a> <a id="10693" href="abstract-set-theory.FiniteSetTheory.html#519" class="Function">mapˢ</a> <a id="10698" class="Symbol">(</a><a id="10699" href="Class.Bifunctor.html#1152" class="Function">map₂</a> <a id="10704" href="Ledger.Core.Specification.Gov.Actions.html#3878" class="Field">returnAddr</a><a id="10714" class="Symbol">)</a> <a id="10716" class="Symbol">(</a><a id="10717" href="Axiom.Set.html#5903" class="Function">fromList</a> <a id="10726" href="Ledger.Conway.Specification.Epoch.html#10410" class="Bound">govSt</a><a id="10731" class="Symbol">)</a>


<a id="10735" class="Keyword">module</a> <a id="VDelegDelegatedStake"></a><a id="10742" href="Ledger.Conway.Specification.Epoch.html#10742" class="Module">VDelegDelegatedStake</a>
  <a id="10765" class="Symbol">(</a><a id="10766" href="Ledger.Conway.Specification.Epoch.html#10766" class="Bound">currentEpoch</a> <a id="10779" class="Symbol">:</a> <a id="10781" href="Ledger.Core.Specification.Epoch.html#646" class="Function">Epoch</a><a id="10786" class="Symbol">)</a>
  <a id="10790" class="Symbol">(</a><a id="10791" href="Ledger.Conway.Specification.Epoch.html#10791" class="Bound">utxoSt</a>       <a id="10804" class="Symbol">:</a> <a id="10806" href="Ledger.Conway.Specification.Utxo.html#1306" class="Record">UTxOState</a><a id="10815" class="Symbol">)</a>
  <a id="10819" class="Symbol">(</a><a id="10820" href="Ledger.Conway.Specification.Epoch.html#10820" class="Bound">govSt</a>        <a id="10833" class="Symbol">:</a> <a id="10835" href="Ledger.Conway.Specification.Gov.html#1459" class="Function">GovState</a><a id="10843" class="Symbol">)</a>
  <a id="10847" class="Symbol">(</a><a id="10848" href="Ledger.Conway.Specification.Epoch.html#10848" class="Bound">gState</a>       <a id="10861" class="Symbol">:</a> <a id="10863" href="Ledger.Core.Specification.Certs.html#4129" class="Record">GState</a><a id="10869" class="Symbol">)</a>
  <a id="10873" class="Symbol">(</a><a id="10874" href="Ledger.Conway.Specification.Epoch.html#10874" class="Bound">dState</a>       <a id="10887" class="Symbol">:</a> <a id="10889" href="Ledger.Core.Specification.Certs.html#3866" class="Record">DState</a><a id="10895" class="Symbol">)</a>
  <a id="10899" class="Keyword">where</a>


  <a id="10909" class="Keyword">open</a> <a id="10914" href="Ledger.Conway.Specification.Utxo.html#1306" class="Module">UTxOState</a> <a id="10924" href="Ledger.Conway.Specification.Epoch.html#10791" class="Bound">utxoSt</a>
  <a id="10933" class="Keyword">open</a> <a id="10938" href="Ledger.Core.Specification.Certs.html#3866" class="Module">DState</a> <a id="10945" href="Ledger.Conway.Specification.Epoch.html#10874" class="Bound">dState</a>
  <a id="10954" class="Keyword">open</a> <a id="10959" href="Ledger.Core.Specification.Certs.html#4129" class="Module">GState</a> <a id="10966" href="Ledger.Conway.Specification.Epoch.html#10848" class="Bound">gState</a>


  <a id="10977" class="Comment">-- active DReps</a>
  <a id="VDelegDelegatedStake.activeDReps"></a><a id="10995" href="Ledger.Conway.Specification.Epoch.html#10995" class="Function">activeDReps</a> <a id="11007" class="Symbol">:</a> <a id="11009" href="abstract-set-theory.FiniteSetTheory.html#488" class="Function Operator">ℙ</a> <a id="11011" href="Ledger.Core.Specification.Address.html#259" class="Datatype">Credential</a>
  <a id="11024" href="Ledger.Conway.Specification.Epoch.html#10995" class="Function">activeDReps</a> <a id="11036" class="Symbol">=</a> <a id="11038" href="Class.IsSet.html#916" class="Function">dom</a> <a id="11042" class="Symbol">(</a><a id="11043" href="abstract-set-theory.FiniteSetTheory.html#4041" class="Function">filterᵐ</a> <a id="11051" class="Symbol">(λ</a> <a id="11054" class="Symbol">(_</a> <a id="11057" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="11059" href="Ledger.Conway.Specification.Epoch.html#11059" class="Bound">e</a><a id="11060" class="Symbol">)</a> <a id="11062" class="Symbol">→</a> <a id="11064" href="Ledger.Conway.Specification.Epoch.html#10766" class="Bound">currentEpoch</a> <a id="11077" href="Class.HasOrder.Core.html#613" class="Field Operator">≤</a> <a id="11079" href="Ledger.Conway.Specification.Epoch.html#11059" class="Bound">e</a><a id="11080" class="Symbol">)</a> <a id="11082" href="Ledger.Core.Specification.Certs.html#4186" class="Function">dreps</a><a id="11087" class="Symbol">)</a>

  <a id="11092" class="Comment">-- active vote delegations</a>
  <a id="VDelegDelegatedStake.activeVDelegs"></a><a id="11121" href="Ledger.Conway.Specification.Epoch.html#11121" class="Function">activeVDelegs</a> <a id="11135" class="Symbol">:</a> <a id="11137" href="abstract-set-theory.FiniteSetTheory.html#488" class="Function Operator">ℙ</a> <a id="11139" href="Ledger.Core.Specification.Gov.Actions.html#2565" class="Datatype">VDeleg</a>
  <a id="11148" href="Ledger.Conway.Specification.Epoch.html#11121" class="Function">activeVDelegs</a> <a id="11162" class="Symbol">=</a> <a id="11164" href="abstract-set-theory.FiniteSetTheory.html#519" class="Function">mapˢ</a> <a id="11169" href="Ledger.Core.Specification.Gov.Actions.html#2587" class="InductiveConstructor">vDelegCredential</a> <a id="11186" href="Ledger.Conway.Specification.Epoch.html#10995" class="Function">activeDReps</a> <a id="11198" href="Axiom.Set.html#9137" class="Function Operator">∪</a> <a id="11200" href="Class.HasSingleton.html#288" class="Field Operator">❴</a> <a id="11202" href="Ledger.Core.Specification.Gov.Actions.html#2660" class="InductiveConstructor">vDelegNoConfidence</a> <a id="11221" href="Class.HasSingleton.html#288" class="Field Operator">❵</a> <a id="11223" href="Axiom.Set.html#9137" class="Function Operator">∪</a> <a id="11225" href="Class.HasSingleton.html#288" class="Field Operator">❴</a> <a id="11227" href="Ledger.Core.Specification.Gov.Actions.html#2630" class="InductiveConstructor">vDelegAbstain</a> <a id="11241" href="Class.HasSingleton.html#288" class="Field Operator">❵</a>

  <a id="11246" class="Comment">-- compute the stake for a credential</a>
  <a id="VDelegDelegatedStake.stakePerCredential"></a><a id="11286" href="Ledger.Conway.Specification.Epoch.html#11286" class="Function">stakePerCredential</a> <a id="11305" class="Symbol">:</a> <a id="11307" href="Ledger.Core.Specification.Address.html#259" class="Datatype">Credential</a> <a id="11318" class="Symbol">→</a> <a id="11320" href="Ledger.Prelude.Base.html#154" class="Function">Coin</a>
  <a id="11327" href="Ledger.Conway.Specification.Epoch.html#11286" class="Function">stakePerCredential</a> <a id="11346" href="Ledger.Conway.Specification.Epoch.html#11346" class="Bound">c</a> <a id="11348" class="Symbol">=</a> <a id="11350" href="Ledger.Conway.Specification.Utxo.html#2532" class="Function">cbalance</a> <a id="11359" class="Symbol">(</a><a id="11360" href="Ledger.Conway.Specification.Utxo.html#1370" class="Function">utxo</a> <a id="11365" href="abstract-set-theory.FiniteSetTheory.html#4234" class="Function Operator">∣^&#39;</a> <a id="11369" class="Symbol">λ</a> <a id="11371" href="Ledger.Conway.Specification.Epoch.html#11371" class="Bound">txout</a> <a id="11377" class="Symbol">→</a> <a id="11379" href="Ledger.Conway.Specification.Epoch.html#5348" class="Function">getStakeCred</a> <a id="11392" href="Ledger.Conway.Specification.Epoch.html#11371" class="Bound">txout</a> <a id="11398" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="11400" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="11405" href="Ledger.Conway.Specification.Epoch.html#11346" class="Bound">c</a><a id="11406" class="Symbol">)</a>
                         <a id="11433" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="11435" href="Data.Maybe.Base.html#1546" class="Function">fromMaybe</a> <a id="11445" class="Number">0</a> <a id="11447" class="Symbol">(</a><a id="11448" href="Axiom.Set.Map.html#17167" class="Function">lookupᵐ?</a> <a id="11457" class="Symbol">(</a><a id="11458" href="Ledger.Conway.Specification.Epoch.html#10325" class="Function">stakeFromGADeposits</a> <a id="11478" href="Ledger.Conway.Specification.Epoch.html#10820" class="Bound">govSt</a> <a id="11484" href="Ledger.Conway.Specification.Epoch.html#10791" class="Bound">utxoSt</a><a id="11490" class="Symbol">)</a> <a id="11492" href="Ledger.Conway.Specification.Epoch.html#11346" class="Bound">c</a><a id="11493" class="Symbol">)</a>
                         <a id="11520" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="11522" href="Data.Maybe.Base.html#1546" class="Function">fromMaybe</a> <a id="11532" class="Number">0</a> <a id="11534" class="Symbol">(</a><a id="11535" href="Axiom.Set.Map.html#17167" class="Function">lookupᵐ?</a> <a id="11544" class="Symbol">(</a><a id="11545" href="Ledger.Core.Specification.Certs.html#1814" class="Field">RewardsOf</a> <a id="11555" href="Ledger.Conway.Specification.Epoch.html#10874" class="Bound">dState</a><a id="11561" class="Symbol">)</a> <a id="11563" href="Ledger.Conway.Specification.Epoch.html#11346" class="Bound">c</a><a id="11564" class="Symbol">)</a>

  <a id="VDelegDelegatedStake.calculate"></a><a id="11569" href="Ledger.Conway.Specification.Epoch.html#11569" class="Function">calculate</a> <a id="11579" class="Symbol">:</a> <a id="11581" href="Ledger.Core.Specification.Gov.Actions.html#2565" class="Datatype">VDeleg</a> <a id="11588" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="11590" href="Ledger.Prelude.Base.html#154" class="Function">Coin</a>
  <a id="11597" href="Ledger.Conway.Specification.Epoch.html#11569" class="Function">calculate</a> <a id="11607" class="Symbol">=</a> <a id="11609" href="Axiom.Set.Map.html#10460" class="Function">mapFromFun</a> <a id="11620" class="Symbol">(λ</a> <a id="11623" href="Ledger.Conway.Specification.Epoch.html#11623" class="Bound">vd</a> <a id="11626" class="Symbol">→</a> <a id="11628" href="abstract-set-theory.FiniteSetTheory.html#4448" class="Function">∑ˢ[</a> <a id="11632" href="Ledger.Conway.Specification.Epoch.html#11632" class="Bound">c</a> <a id="11634" href="abstract-set-theory.FiniteSetTheory.html#4448" class="Function">←</a> <a id="11636" href="Ledger.Core.Specification.Certs.html#3925" class="Field">voteDelegs</a> <a id="11647" href="Axiom.Set.Map.html#17955" class="Function Operator">⁻¹</a> <a id="11650" href="Ledger.Conway.Specification.Epoch.html#11623" class="Bound">vd</a> <a id="11653" href="abstract-set-theory.FiniteSetTheory.html#4448" class="Function">]</a> <a id="11655" class="Symbol">(</a><a id="11656" href="Ledger.Conway.Specification.Epoch.html#11286" class="Function">stakePerCredential</a> <a id="11675" href="Ledger.Conway.Specification.Epoch.html#11632" class="Bound">c</a><a id="11676" class="Symbol">))</a>
                         <a id="11704" href="Ledger.Conway.Specification.Epoch.html#11121" class="Function">activeVDelegs</a>


<a id="11720" class="Keyword">opaque</a>


  <a id="calculateVDelegDelegatedStake"></a><a id="11731" href="Ledger.Conway.Specification.Epoch.html#11731" class="Function">calculateVDelegDelegatedStake</a>
    <a id="11765" class="Symbol">:</a> <a id="11767" href="Ledger.Core.Specification.Epoch.html#646" class="Function">Epoch</a>
    <a id="11777" class="Symbol">→</a> <a id="11779" href="Ledger.Conway.Specification.Utxo.html#1306" class="Record">UTxOState</a>
    <a id="11793" class="Symbol">→</a> <a id="11795" href="Ledger.Conway.Specification.Gov.html#1459" class="Function">GovState</a>
    <a id="11808" class="Symbol">→</a> <a id="11810" href="Ledger.Core.Specification.Certs.html#4129" class="Record">GState</a>
    <a id="11821" class="Symbol">→</a> <a id="11823" href="Ledger.Core.Specification.Certs.html#3866" class="Record">DState</a>
    <a id="11834" class="Symbol">→</a> <a id="11836" href="Ledger.Core.Specification.Gov.Actions.html#2565" class="Datatype">VDeleg</a> <a id="11843" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="11845" href="Ledger.Prelude.Base.html#154" class="Function">Coin</a>
  <a id="11852" href="Ledger.Conway.Specification.Epoch.html#11731" class="Function">calculateVDelegDelegatedStake</a> <a id="11882" class="Symbol">=</a> <a id="11884" href="Ledger.Conway.Specification.Epoch.html#11569" class="Function">VDelegDelegatedStake.calculate</a>


<a id="11917" class="Keyword">opaque</a>


  <a id="calculatePoolDelegatedStakeForVoting"></a><a id="11928" href="Ledger.Conway.Specification.Epoch.html#11928" class="Function">calculatePoolDelegatedStakeForVoting</a>
    <a id="11969" class="Symbol">:</a> <a id="11971" href="Ledger.Conway.Specification.Rewards.html#6487" class="Record">Snapshot</a>
    <a id="11984" class="Symbol">→</a> <a id="11986" href="Ledger.Conway.Specification.Utxo.html#1306" class="Record">UTxOState</a>
    <a id="12000" class="Symbol">→</a> <a id="12002" href="Ledger.Conway.Specification.Gov.html#1459" class="Function">GovState</a>
    <a id="12015" class="Symbol">→</a> <a id="12017" href="Ledger.Core.Specification.Crypto.html#1386" class="Function">KeyHash</a> <a id="12025" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="12027" href="Ledger.Prelude.Base.html#154" class="Function">Coin</a>
  <a id="12034" href="Ledger.Conway.Specification.Epoch.html#11928" class="Function">calculatePoolDelegatedStakeForVoting</a> <a id="12071" href="Ledger.Conway.Specification.Epoch.html#12071" class="Bound">ss</a> <a id="12074" href="Ledger.Conway.Specification.Epoch.html#12074" class="Bound">utxoSt</a> <a id="12081" href="Ledger.Conway.Specification.Epoch.html#12081" class="Bound">govSt</a>
    <a id="12091" class="Symbol">=</a> <a id="12093" href="Ledger.Conway.Specification.Epoch.html#9774" class="Function">calculatePoolDelegatedStake</a> <a id="12121" href="Ledger.Conway.Specification.Epoch.html#12071" class="Bound">ss</a> <a id="12124" href="Axiom.Set.Map.Dec.html#2052" class="Function Operator">∪⁺</a> <a id="12127" class="Symbol">(</a><a id="12128" href="Ledger.Conway.Specification.Epoch.html#12182" class="Function">stakeFromDeposits</a> <a id="12146" href="Axiom.Set.Map.html#13534" class="Function Operator">∣</a> <a id="12148" href="Class.IsSet.html#916" class="Function">dom</a> <a id="12152" class="Symbol">(</a><a id="12153" href="Ledger.Core.Specification.Certs.html#1649" class="Field">PoolsOf</a> <a id="12161" href="Ledger.Conway.Specification.Epoch.html#12071" class="Bound">ss</a><a id="12163" class="Symbol">))</a>
    <a id="12170" class="Keyword">where</a>
      <a id="12182" href="Ledger.Conway.Specification.Epoch.html#12182" class="Function">stakeFromDeposits</a> <a id="12200" class="Symbol">:</a> <a id="12202" href="Ledger.Core.Specification.Crypto.html#1386" class="Function">KeyHash</a> <a id="12210" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="12212" href="Ledger.Prelude.Base.html#154" class="Function">Coin</a>
      <a id="12223" href="Ledger.Conway.Specification.Epoch.html#12182" class="Function">stakeFromDeposits</a> <a id="12241" class="Symbol">=</a> <a id="12243" href="Axiom.Set.Map.Dec.html#2130" class="Function">aggregate₊</a> <a id="12254" class="Symbol">(((</a><a id="12257" href="Ledger.Core.Specification.Certs.html#1979" class="Field">StakeDelegsOf</a> <a id="12271" href="Ledger.Conway.Specification.Epoch.html#12071" class="Bound">ss</a> <a id="12274" href="Axiom.Set.Map.html#2293" class="Function Operator">ˢ</a><a id="12275" class="Symbol">)</a> <a id="12277" href="Axiom.Set.Rel.html#1608" class="Function Operator">⁻¹ʳ</a>
                                      <a id="12319" href="abstract-set-theory.FiniteSetTheory.html#3050" class="Function Operator">∘ʳ</a> <a id="12322" class="Symbol">(</a><a id="12323" href="Ledger.Conway.Specification.Epoch.html#10325" class="Function">stakeFromGADeposits</a> <a id="12343" href="Ledger.Conway.Specification.Epoch.html#12081" class="Bound">govSt</a> <a id="12349" href="Ledger.Conway.Specification.Epoch.html#12074" class="Bound">utxoSt</a> <a id="12356" href="Axiom.Set.Map.html#2293" class="Function Operator">ˢ</a><a id="12357" class="Symbol">))</a> <a id="12360" href="abstract-set-theory.FiniteSetTheory.html#2860" class="Function Operator">ᶠˢ</a><a id="12362" class="Symbol">)</a>


<a id="mkStakeDistrs"></a><a id="12366" href="Ledger.Conway.Specification.Epoch.html#12366" class="Function">mkStakeDistrs</a>
  <a id="12382" class="Symbol">:</a> <a id="12384" href="Ledger.Conway.Specification.Rewards.html#6487" class="Record">Snapshot</a>
  <a id="12395" class="Symbol">→</a> <a id="12397" href="Ledger.Core.Specification.Epoch.html#646" class="Function">Epoch</a>
  <a id="12405" class="Symbol">→</a> <a id="12407" href="Ledger.Conway.Specification.Utxo.html#1306" class="Record">UTxOState</a>
  <a id="12419" class="Symbol">→</a> <a id="12421" href="Ledger.Conway.Specification.Gov.html#1459" class="Function">GovState</a>
  <a id="12432" class="Symbol">→</a> <a id="12434" href="Ledger.Core.Specification.Certs.html#4129" class="Record">GState</a>
  <a id="12443" class="Symbol">→</a> <a id="12445" href="Ledger.Core.Specification.Certs.html#3866" class="Record">DState</a>
  <a id="12454" class="Symbol">→</a> <a id="12456" href="Ledger.Conway.Specification.Ratify.html#3115" class="Record">StakeDistrs</a>
<a id="12468" href="Ledger.Conway.Specification.Epoch.html#12366" class="Function">mkStakeDistrs</a> <a id="12482" href="Ledger.Conway.Specification.Epoch.html#12482" class="Bound">ss</a> <a id="12485" href="Ledger.Conway.Specification.Epoch.html#12485" class="Bound">currentEpoch</a> <a id="12498" href="Ledger.Conway.Specification.Epoch.html#12498" class="Bound">utxoSt</a> <a id="12505" href="Ledger.Conway.Specification.Epoch.html#12505" class="Bound">govSt</a> <a id="12511" href="Ledger.Conway.Specification.Epoch.html#12511" class="Bound">gState</a> <a id="12518" href="Ledger.Conway.Specification.Epoch.html#12518" class="Bound">dState</a> <a id="12525" class="Symbol">=</a>
  <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.Conway.Specification.Epoch.html#11731}{\htmlId{12531}{\htmlClass{Function}{\text{calculateVDelegDelegatedStake}}}}\, \,\href{Ledger.Conway.Specification.Epoch.html#12485}{\htmlId{12561}{\htmlClass{Bound}{\text{currentEpoch}}}}\, \,\href{Ledger.Conway.Specification.Epoch.html#12498}{\htmlId{12574}{\htmlClass{Bound}{\text{utxoSt}}}}\, \,\href{Ledger.Conway.Specification.Epoch.html#12505}{\htmlId{12581}{\htmlClass{Bound}{\text{govSt}}}}\, \,\href{Ledger.Conway.Specification.Epoch.html#12511}{\htmlId{12587}{\htmlClass{Bound}{\text{gState}}}}\, \,\href{Ledger.Conway.Specification.Epoch.html#12518}{\htmlId{12594}{\htmlClass{Bound}{\text{dState}}}}\,
  \\ \,\href{Ledger.Conway.Specification.Epoch.html#11928}{\htmlId{12605}{\htmlClass{Function}{\text{calculatePoolDelegatedStakeForVoting}}}}\, \,\href{Ledger.Conway.Specification.Epoch.html#12482}{\htmlId{12642}{\htmlClass{Bound}{\text{ss}}}}\, \,\href{Ledger.Conway.Specification.Epoch.html#12498}{\htmlId{12645}{\htmlClass{Bound}{\text{utxoSt}}}}\, \,\href{Ledger.Conway.Specification.Epoch.html#12505}{\htmlId{12652}{\htmlClass{Bound}{\text{govSt}}}}\, \end{pmatrix}$</a>


<a id="12662" class="Keyword">private</a> <a id="12670" class="Keyword">variable</a>
  <a id="12681" href="Ledger.Conway.Specification.Epoch.html#12681" class="Generalizable">e</a> <a id="12683" href="Ledger.Conway.Specification.Epoch.html#12683" class="Generalizable">lastEpoch</a> <a id="12693" class="Symbol">:</a> <a id="12695" href="Ledger.Core.Specification.Epoch.html#646" class="Function">Epoch</a>
  <a id="12703" href="Ledger.Conway.Specification.Epoch.html#12703" class="Generalizable">fut</a> <a id="12707" href="Ledger.Conway.Specification.Epoch.html#12707" class="Generalizable">fut&#39;</a> <a id="12712" class="Symbol">:</a> <a id="12714" href="Ledger.Conway.Specification.Ratify.html#3526" class="Record">RatifyState</a>
  <a id="12728" href="Ledger.Conway.Specification.Epoch.html#12728" class="Generalizable">poolReapState</a> <a id="12742" class="Symbol">:</a> <a id="12744" href="Ledger.Conway.Specification.PoolReap.html#400" class="Record">PoolReapState</a>
  <a id="12760" href="Ledger.Conway.Specification.Epoch.html#12760" class="Generalizable">eps</a> <a id="12764" href="Ledger.Conway.Specification.Epoch.html#12764" class="Generalizable">eps&#39;</a> <a id="12769" href="Ledger.Conway.Specification.Epoch.html#12769" class="Generalizable">eps&#39;&#39;</a> <a id="12775" class="Symbol">:</a> <a id="12777" href="Ledger.Conway.Specification.Epoch.html#1833" class="Record">EpochState</a>
  <a id="12790" href="Ledger.Conway.Specification.Epoch.html#12790" class="Generalizable">ls</a> <a id="12793" class="Symbol">:</a> <a id="12795" href="Ledger.Conway.Specification.Ledger.html#997" class="Record">LState</a>
  <a id="12804" href="Ledger.Conway.Specification.Epoch.html#12804" class="Generalizable">es₀</a> <a id="12808" class="Symbol">:</a> <a id="12810" href="Ledger.Conway.Specification.Enact.html#444" class="Record">EnactState</a>
  <a id="12823" href="Ledger.Conway.Specification.Epoch.html#12823" class="Generalizable">mark</a> <a id="12828" href="Ledger.Conway.Specification.Epoch.html#12828" class="Generalizable">set</a> <a id="12832" href="Ledger.Conway.Specification.Epoch.html#12832" class="Generalizable">go</a> <a id="12835" class="Symbol">:</a> <a id="12837" href="Ledger.Conway.Specification.Rewards.html#6487" class="Record">Snapshot</a>
  <a id="12848" href="Ledger.Conway.Specification.Epoch.html#12848" class="Generalizable">feeSS</a> <a id="12854" class="Symbol">:</a> <a id="12856" href="Ledger.Prelude.Base.html#186" class="Function">Fees</a>
  <a id="12863" href="Ledger.Conway.Specification.Epoch.html#12863" class="Generalizable">lstate</a> <a id="12870" class="Symbol">:</a> <a id="12872" href="Ledger.Conway.Specification.Ledger.html#997" class="Record">LState</a>
  <a id="12881" href="Ledger.Conway.Specification.Epoch.html#12881" class="Generalizable">pState&#39;&#39;</a> <a id="12890" class="Symbol">:</a> <a id="12892" href="Ledger.Core.Specification.Certs.html#4017" class="Record">PState</a>
  <a id="12901" href="Ledger.Conway.Specification.Epoch.html#12901" class="Generalizable">dState&#39;</a> <a id="12909" class="Symbol">:</a> <a id="12911" href="Ledger.Core.Specification.Certs.html#3866" class="Record">DState</a>
  <a id="12920" href="Ledger.Conway.Specification.Epoch.html#12920" class="Generalizable">acnt</a> <a id="12925" href="Ledger.Conway.Specification.Epoch.html#12925" class="Generalizable">acnt&#39;</a> <a id="12931" class="Symbol">:</a> <a id="12933" href="Ledger.Conway.Specification.PParams.html#718" class="Record">Acnt</a>
  <a id="12940" href="Ledger.Conway.Specification.Epoch.html#12940" class="Generalizable">utxoSt&#39;&#39;</a> <a id="12949" class="Symbol">:</a> <a id="12951" href="Ledger.Conway.Specification.Utxo.html#1306" class="Record">UTxOState</a>
  <a id="12963" href="Ledger.Conway.Specification.Epoch.html#12963" class="Generalizable">ss</a> <a id="12966" href="Ledger.Conway.Specification.Epoch.html#12966" class="Generalizable">ss&#39;</a> <a id="12970" class="Symbol">:</a> <a id="12972" href="Ledger.Conway.Specification.Rewards.html#7734" class="Record">Snapshots</a>
  <a id="12984" href="Ledger.Conway.Specification.Epoch.html#12984" class="Generalizable">ru</a> <a id="12987" class="Symbol">:</a> <a id="12989" href="Ledger.Conway.Specification.Rewards.html#6264" class="Record">RewardUpdate</a>
  <a id="13004" href="Ledger.Conway.Specification.Epoch.html#13004" class="Generalizable">mru</a> <a id="13008" class="Symbol">:</a> <a id="13010" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="13016" href="Ledger.Conway.Specification.Rewards.html#6264" class="Record">RewardUpdate</a>
  <a id="13031" href="Ledger.Conway.Specification.Epoch.html#13031" class="Generalizable">pd</a> <a id="13034" class="Symbol">:</a> <a id="13036" href="Ledger.Conway.Specification.Epoch.html#3290" class="Function">PoolDelegatedStake</a>


<a id="getOrphans"></a><a id="13057" href="Ledger.Conway.Specification.Epoch.html#13057" class="Function">getOrphans</a> <a id="13068" class="Symbol">:</a> <a id="13070" href="Ledger.Conway.Specification.Enact.html#444" class="Record">EnactState</a> <a id="13081" class="Symbol">→</a> <a id="13083" href="Ledger.Conway.Specification.Gov.html#1459" class="Function">GovState</a> <a id="13092" class="Symbol">→</a> <a id="13094" href="Ledger.Conway.Specification.Gov.html#1459" class="Function">GovState</a>
<a id="13103" href="Ledger.Conway.Specification.Epoch.html#13057" class="Function">getOrphans</a> <a id="13114" href="Ledger.Conway.Specification.Epoch.html#13114" class="Bound">es</a> <a id="13117" href="Ledger.Conway.Specification.Epoch.html#13117" class="Bound">govSt</a> <a id="13123" class="Symbol">=</a> <a id="13125" href="Data.Product.Base.html#636" class="Field">proj₁</a> <a id="13131" href="Function.Base.html#1993" class="Function Operator">$</a> <a id="13133" href="Data.Nat.GeneralisedArithmetic.html#866" class="Function">iterate</a> <a id="13141" href="Ledger.Conway.Specification.Epoch.html#13186" class="Function">step</a> <a id="13146" class="Symbol">(</a><a id="13147" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a> <a id="13150" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="13152" href="Ledger.Conway.Specification.Epoch.html#13117" class="Bound">govSt</a><a id="13157" class="Symbol">)</a> <a id="13159" class="Symbol">(</a><a id="13160" href="Data.List.Base.html#4746" class="Function">length</a> <a id="13167" href="Ledger.Conway.Specification.Epoch.html#13117" class="Bound">govSt</a><a id="13172" class="Symbol">)</a>
  <a id="13176" class="Keyword">where</a>
    <a id="13186" href="Ledger.Conway.Specification.Epoch.html#13186" class="Function">step</a> <a id="13191" class="Symbol">:</a> <a id="13193" href="Ledger.Conway.Specification.Gov.html#1459" class="Function">GovState</a> <a id="13202" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="13204" href="Ledger.Conway.Specification.Gov.html#1459" class="Function">GovState</a> <a id="13213" class="Symbol">→</a> <a id="13215" href="Ledger.Conway.Specification.Gov.html#1459" class="Function">GovState</a> <a id="13224" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="13226" href="Ledger.Conway.Specification.Gov.html#1459" class="Function">GovState</a>
    <a id="13239" href="Ledger.Conway.Specification.Epoch.html#13186" class="Function">step</a> <a id="13244" class="Symbol">(</a><a id="13245" href="Ledger.Conway.Specification.Epoch.html#13245" class="Bound">orps</a> <a id="13250" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="13252" href="Ledger.Conway.Specification.Epoch.html#13252" class="Bound">govSt</a><a id="13257" class="Symbol">)</a> <a id="13259" class="Symbol">=</a>
      <a id="13267" class="Keyword">let</a>
        <a id="13279" href="Ledger.Conway.Specification.Epoch.html#13279" class="Bound">isOrphan?</a> <a id="13289" href="Ledger.Conway.Specification.Epoch.html#13289" class="Bound">a</a> <a id="13291" href="Ledger.Conway.Specification.Epoch.html#13291" class="Bound">prev</a> <a id="13296" class="Symbol">=</a> <a id="13298" href="Relation.Nullary.Decidable.Core.html#3277" class="Function">¬?</a> <a id="13301" class="Symbol">(</a><a id="13302" href="Ledger.Conway.Specification.Gov.html#9825" class="Function">hasParent?</a> <a id="13313" href="Ledger.Conway.Specification.Epoch.html#13114" class="Bound">es</a> <a id="13316" href="Ledger.Conway.Specification.Epoch.html#13252" class="Bound">govSt</a> <a id="13322" href="Ledger.Conway.Specification.Epoch.html#13289" class="Bound">a</a> <a id="13324" href="Ledger.Conway.Specification.Epoch.html#13291" class="Bound">prev</a><a id="13328" class="Symbol">)</a>
        <a id="13338" class="Symbol">(</a><a id="13339" href="Ledger.Conway.Specification.Epoch.html#13339" class="Bound">orps&#39;</a> <a id="13345" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="13347" href="Ledger.Conway.Specification.Epoch.html#13347" class="Bound">govSt&#39;</a><a id="13353" class="Symbol">)</a> <a id="13355" class="Symbol">=</a> <a id="13357" href="Data.List.Base.html#10628" class="Function">partition</a>
          <a id="13377" class="Symbol">(λ</a> <a id="13380" class="Symbol">(_</a> <a id="13383" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="13385" class="Keyword">record</a> <a id="13392" class="Symbol">{</a><a id="13393" href="Ledger.Core.Specification.Gov.Actions.html#3928" class="Field">action</a> <a id="13400" class="Symbol">=</a> <a id="13402" href="Ledger.Conway.Specification.Epoch.html#13402" class="Bound">a</a> <a id="13404" class="Symbol">;</a> <a id="13406" href="Ledger.Core.Specification.Gov.Actions.html#3956" class="Field">prevAction</a> <a id="13417" class="Symbol">=</a> <a id="13419" href="Ledger.Conway.Specification.Epoch.html#13419" class="Bound">prev</a><a id="13423" class="Symbol">})</a> <a id="13426" class="Symbol">→</a> <a id="13428" href="Ledger.Conway.Specification.Epoch.html#13279" class="Bound">isOrphan?</a> <a id="13438" class="Symbol">(</a><a id="13439" href="Ledger.Conway.Specification.Epoch.html#13402" class="Bound">a</a> <a id="13441" class="Symbol">.</a><a id="13442" href="Ledger.Core.Specification.Gov.Actions.html#1510" class="Field">gaType</a><a id="13448" class="Symbol">)</a> <a id="13450" href="Ledger.Conway.Specification.Epoch.html#13419" class="Bound">prev</a><a id="13454" class="Symbol">)</a>
          <a id="13466" href="Ledger.Conway.Specification.Epoch.html#13252" class="Bound">govSt</a>
      <a id="13478" class="Keyword">in</a>
        <a id="13489" class="Symbol">(</a><a id="13490" href="Ledger.Conway.Specification.Epoch.html#13245" class="Bound">orps</a> <a id="13495" href="Data.List.Base.html#1712" class="Function Operator">++</a> <a id="13498" href="Ledger.Conway.Specification.Epoch.html#13339" class="Bound">orps&#39;</a> <a id="13504" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="13506" href="Ledger.Conway.Specification.Epoch.html#13347" class="Bound">govSt&#39;</a><a id="13512" class="Symbol">)</a>

<a id="13515" class="Keyword">record</a> <a id="Governance-Update"></a><a id="13522" href="Ledger.Conway.Specification.Epoch.html#13522" class="Record">Governance-Update</a> <a id="13540" class="Symbol">:</a> <a id="13542" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="13547" class="Keyword">where</a>
  <a id="13555" class="Keyword">constructor</a> <a id="GovernanceUpdate"></a><a id="13567" href="Ledger.Conway.Specification.Epoch.html#13567" class="InductiveConstructor">GovernanceUpdate</a>
  <a id="13586" class="Keyword">field</a>
    <a id="Governance-Update.removedGovActions"></a><a id="13596" href="Ledger.Conway.Specification.Epoch.html#13596" class="Field">removedGovActions</a> <a id="13614" class="Symbol">:</a> <a id="13616" href="abstract-set-theory.FiniteSetTheory.html#488" class="Function Operator">ℙ</a> <a id="13618" class="Symbol">(</a><a id="13619" href="Ledger.Core.Specification.Address.html#1313" class="Record">RwdAddr</a> <a id="13627" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="13629" href="Ledger.Core.Specification.Certs.html#534" class="Datatype">DepositPurpose</a> <a id="13644" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="13646" href="Ledger.Prelude.Base.html#154" class="Function">Coin</a><a id="13650" class="Symbol">)</a>
    <a id="Governance-Update.govSt&#39;"></a><a id="13656" href="Ledger.Conway.Specification.Epoch.html#13656" class="Field">govSt&#39;</a>            <a id="13674" class="Symbol">:</a> <a id="13676" href="Ledger.Conway.Specification.Gov.html#1459" class="Function">GovState</a>

<a id="13686" class="Keyword">module</a> <a id="GovernanceUpdate"></a><a id="13693" href="Ledger.Conway.Specification.Epoch.html#13693" class="Module">GovernanceUpdate</a> <a id="13710" class="Symbol">(</a><a id="13711" href="Ledger.Conway.Specification.Epoch.html#13711" class="Bound">ls</a> <a id="13714" class="Symbol">:</a> <a id="13716" href="Ledger.Conway.Specification.Ledger.html#997" class="Record">LState</a><a id="13722" class="Symbol">)</a>
                        <a id="13748" class="Symbol">(</a><a id="13749" href="Ledger.Conway.Specification.Epoch.html#13749" class="Bound">fut</a> <a id="13753" class="Symbol">:</a> <a id="13755" href="Ledger.Conway.Specification.Ratify.html#3526" class="Record">RatifyState</a><a id="13766" class="Symbol">)</a>
                        <a id="13792" class="Keyword">where</a>


  <a id="13802" class="Keyword">open</a> <a id="13807" href="Ledger.Conway.Specification.Ledger.html#997" class="Module">LState</a> <a id="13814" href="Ledger.Conway.Specification.Epoch.html#13711" class="Bound">ls</a>
  <a id="13819" class="Keyword">open</a> <a id="13824" href="Ledger.Conway.Specification.Ratify.html#3526" class="Module">RatifyState</a> <a id="13836" href="Ledger.Conway.Specification.Epoch.html#13749" class="Bound">fut</a>


  <a id="GovernanceUpdate.tmpGovSt"></a><a id="13844" href="Ledger.Conway.Specification.Epoch.html#13844" class="Function">tmpGovSt</a> <a id="13853" class="Symbol">:</a> <a id="13855" href="Ledger.Conway.Specification.Gov.html#1459" class="Function">GovState</a>
  <a id="13866" href="Ledger.Conway.Specification.Epoch.html#13844" class="Function">tmpGovSt</a> <a id="13875" class="Symbol">=</a> <a id="13877" href="Ledger.Prelude.html#2451" class="Function">filter</a> <a id="13884" class="Symbol">(λ</a> <a id="13887" href="Ledger.Conway.Specification.Epoch.html#13887" class="Bound">x</a> <a id="13889" class="Symbol">→</a> <a id="13891" href="Data.Product.Base.html#636" class="Field">proj₁</a> <a id="13897" href="Ledger.Conway.Specification.Epoch.html#13887" class="Bound">x</a> <a id="13899" href="Class.IsSet.html#462" class="Function Operator">∉</a> <a id="13901" href="abstract-set-theory.FiniteSetTheory.html#519" class="Function">mapˢ</a> <a id="13906" href="Data.Product.Base.html#636" class="Field">proj₁</a> <a id="13912" href="Ledger.Conway.Specification.Ratify.html#3589" class="Field">removed</a><a id="13919" class="Symbol">)</a> <a id="13921" href="Ledger.Conway.Specification.Ledger.html#1083" class="Function">govSt</a>

  <a id="GovernanceUpdate.orphans"></a><a id="13930" href="Ledger.Conway.Specification.Epoch.html#13930" class="Function">orphans</a> <a id="13938" class="Symbol">:</a> <a id="13940" href="abstract-set-theory.FiniteSetTheory.html#488" class="Function Operator">ℙ</a> <a id="13942" class="Symbol">(</a><a id="13943" href="Ledger.Core.Specification.Gov.Actions.html#1975" class="Function">GovActionID</a> <a id="13955" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="13957" href="Ledger.Core.Specification.Gov.Actions.html#3811" class="Record">GovActionState</a><a id="13971" class="Symbol">)</a>
  <a id="13975" href="Ledger.Conway.Specification.Epoch.html#13930" class="Function">orphans</a>  <a id="13984" class="Symbol">=</a> <a id="13986" href="Axiom.Set.html#5903" class="Function">fromList</a> <a id="13995" class="Symbol">(</a><a id="13996" href="Ledger.Conway.Specification.Epoch.html#13057" class="Function">getOrphans</a> <a id="14007" href="Ledger.Conway.Specification.Ratify.html#3563" class="Field">es</a> <a id="14010" href="Ledger.Conway.Specification.Epoch.html#13844" class="Function">tmpGovSt</a><a id="14018" class="Symbol">)</a>

  <a id="GovernanceUpdate.removed&#39;"></a><a id="14023" href="Ledger.Conway.Specification.Epoch.html#14023" class="Function">removed&#39;</a> <a id="14032" class="Symbol">:</a> <a id="14034" href="abstract-set-theory.FiniteSetTheory.html#488" class="Function Operator">ℙ</a> <a id="14036" class="Symbol">(</a><a id="14037" href="Ledger.Core.Specification.Gov.Actions.html#1975" class="Function">GovActionID</a> <a id="14049" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="14051" href="Ledger.Core.Specification.Gov.Actions.html#3811" class="Record">GovActionState</a><a id="14065" class="Symbol">)</a>
  <a id="14069" href="Ledger.Conway.Specification.Epoch.html#14023" class="Function">removed&#39;</a> <a id="14078" class="Symbol">=</a> <a id="14080" href="Ledger.Conway.Specification.Ratify.html#3589" class="Field">removed</a> <a id="14088" href="Axiom.Set.html#9137" class="Function Operator">∪</a> <a id="14090" href="Ledger.Conway.Specification.Epoch.html#13930" class="Function">orphans</a>

  <a id="GovernanceUpdate.removedGovActions"></a><a id="14101" href="Ledger.Conway.Specification.Epoch.html#14101" class="Function">removedGovActions</a> <a id="14119" class="Symbol">:</a> <a id="14121" href="abstract-set-theory.FiniteSetTheory.html#488" class="Function Operator">ℙ</a> <a id="14123" class="Symbol">(</a><a id="14124" href="Ledger.Core.Specification.Address.html#1313" class="Record">RwdAddr</a> <a id="14132" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="14134" href="Ledger.Core.Specification.Certs.html#534" class="Datatype">DepositPurpose</a> <a id="14149" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="14151" href="Ledger.Prelude.Base.html#154" class="Function">Coin</a><a id="14155" class="Symbol">)</a>
  <a id="14159" href="Ledger.Conway.Specification.Epoch.html#14101" class="Function">removedGovActions</a> <a id="14177" class="Symbol">=</a>
    <a id="14183" href="Function.Base.html#1657" class="Function">flip</a> <a id="14188" href="Axiom.Set.html#7207" class="Function">concatMapˢ</a> <a id="14199" href="Ledger.Conway.Specification.Epoch.html#14023" class="Function">removed&#39;</a> <a id="14208" class="Symbol">λ</a> <a id="14210" class="Symbol">(</a><a id="14211" href="Ledger.Conway.Specification.Epoch.html#14211" class="Bound">gaid</a> <a id="14216" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="14218" href="Ledger.Conway.Specification.Epoch.html#14218" class="Bound">gaSt</a><a id="14222" class="Symbol">)</a> <a id="14224" class="Symbol">→</a>
      <a id="14232" href="abstract-set-theory.FiniteSetTheory.html#519" class="Function">mapˢ</a>
        <a id="14245" class="Symbol">(</a><a id="14246" href="Ledger.Core.Specification.Gov.Actions.html#3878" class="Field">returnAddr</a> <a id="14257" href="Ledger.Conway.Specification.Epoch.html#14218" class="Bound">gaSt</a> <a id="14262" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,_</a><a id="14264" class="Symbol">)</a>
        <a id="14274" class="Symbol">((</a><a id="14276" href="Ledger.Core.Specification.Certs.html#885" class="Field">DepositsOf</a> <a id="14287" href="Ledger.Conway.Specification.Ledger.html#1056" class="Function">utxoSt</a> <a id="14294" href="Axiom.Set.Map.html#13534" class="Function Operator">∣</a> <a id="14296" href="Class.HasSingleton.html#288" class="Field Operator">❴</a> <a id="14298" href="Ledger.Core.Specification.Certs.html#723" class="InductiveConstructor">GovActionDeposit</a> <a id="14315" href="Ledger.Conway.Specification.Epoch.html#14211" class="Bound">gaid</a> <a id="14320" href="Class.HasSingleton.html#288" class="Field Operator">❵</a><a id="14321" class="Symbol">)</a> <a id="14323" href="Axiom.Set.Map.html#2293" class="Function Operator">ˢ</a><a id="14324" class="Symbol">)</a>

  <a id="GovernanceUpdate.govSt&#39;"></a><a id="14329" href="Ledger.Conway.Specification.Epoch.html#14329" class="Function">govSt&#39;</a> <a id="14336" class="Symbol">:</a> <a id="14338" href="Ledger.Conway.Specification.Gov.html#1459" class="Function">GovState</a>
  <a id="14349" href="Ledger.Conway.Specification.Epoch.html#14329" class="Function">govSt&#39;</a> <a id="14356" class="Symbol">=</a> <a id="14358" href="Ledger.Prelude.html#2451" class="Function">filter</a> <a id="14365" class="Symbol">(λ</a> <a id="14368" href="Ledger.Conway.Specification.Epoch.html#14368" class="Bound">x</a> <a id="14370" class="Symbol">→</a> <a id="14372" href="Data.Product.Base.html#636" class="Field">proj₁</a> <a id="14378" href="Ledger.Conway.Specification.Epoch.html#14368" class="Bound">x</a> <a id="14380" href="Class.IsSet.html#462" class="Function Operator">∉</a> <a id="14382" href="abstract-set-theory.FiniteSetTheory.html#519" class="Function">mapˢ</a> <a id="14387" href="Data.Product.Base.html#636" class="Field">proj₁</a> <a id="14393" href="Ledger.Conway.Specification.Epoch.html#14023" class="Function">removed&#39;</a><a id="14401" class="Symbol">)</a> <a id="14403" href="Ledger.Conway.Specification.Ledger.html#1083" class="Function">govSt</a>

  <a id="GovernanceUpdate.updates"></a><a id="14412" href="Ledger.Conway.Specification.Epoch.html#14412" class="Function">updates</a> <a id="14420" class="Symbol">:</a> <a id="14422" href="Ledger.Conway.Specification.Epoch.html#13522" class="Record">Governance-Update</a>
  <a id="14442" href="Ledger.Conway.Specification.Epoch.html#14412" class="Function">updates</a> <a id="14450" class="Symbol">=</a> <a id="14452" href="Ledger.Conway.Specification.Epoch.html#13567" class="InductiveConstructor">GovernanceUpdate</a> <a id="14469" href="Ledger.Conway.Specification.Epoch.html#14101" class="Function">removedGovActions</a> <a id="14487" href="Ledger.Conway.Specification.Epoch.html#14329" class="Function">govSt&#39;</a>

<a id="14495" class="Keyword">record</a> <a id="Pre-POOLREAP-Update"></a><a id="14502" href="Ledger.Conway.Specification.Epoch.html#14502" class="Record">Pre-POOLREAP-Update</a> <a id="14522" class="Symbol">:</a> <a id="14524" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="14529" class="Keyword">where</a>
  <a id="14537" class="Keyword">inductive</a>
  <a id="14549" class="Keyword">constructor</a> <a id="Pre-POOLREAPUpdate"></a><a id="14561" href="Ledger.Conway.Specification.Epoch.html#14561" class="InductiveConstructor">Pre-POOLREAPUpdate</a>
  <a id="14582" class="Keyword">field</a>
    <a id="Pre-POOLREAP-Update.pState&#39;"></a><a id="14592" href="Ledger.Conway.Specification.Epoch.html#14592" class="Field">pState&#39;</a> <a id="14600" class="Symbol">:</a> <a id="14602" href="Ledger.Core.Specification.Certs.html#4017" class="Record">PState</a>
    <a id="Pre-POOLREAP-Update.gState&#39;"></a><a id="14613" href="Ledger.Conway.Specification.Epoch.html#14613" class="Field">gState&#39;</a> <a id="14621" class="Symbol">:</a> <a id="14623" href="Ledger.Core.Specification.Certs.html#4129" class="Record">GState</a>
    <a id="Pre-POOLREAP-Update.utxoSt&#39;"></a><a id="14634" href="Ledger.Conway.Specification.Epoch.html#14634" class="Field">utxoSt&#39;</a> <a id="14642" class="Symbol">:</a> <a id="14644" href="Ledger.Conway.Specification.Utxo.html#1306" class="Record">UTxOState</a>

<a id="14655" class="Keyword">module</a> <a id="Pre-POOLREAPUpdate"></a><a id="14662" href="Ledger.Conway.Specification.Epoch.html#14662" class="Module">Pre-POOLREAPUpdate</a> <a id="14681" class="Symbol">(</a><a id="14682" href="Ledger.Conway.Specification.Epoch.html#14682" class="Bound">ls</a> <a id="14685" class="Symbol">:</a> <a id="14687" href="Ledger.Conway.Specification.Ledger.html#997" class="Record">LState</a><a id="14693" class="Symbol">)</a>
                          <a id="14721" class="Symbol">(</a><a id="14722" href="Ledger.Conway.Specification.Epoch.html#14722" class="Bound">es</a> <a id="14725" class="Symbol">:</a> <a id="14727" href="Ledger.Conway.Specification.Enact.html#444" class="Record">EnactState</a><a id="14737" class="Symbol">)</a>
                          <a id="14765" class="Symbol">(</a><a id="14766" href="Ledger.Conway.Specification.Epoch.html#14766" class="Bound">govUpdate</a> <a id="14776" class="Symbol">:</a> <a id="14778" href="Ledger.Conway.Specification.Epoch.html#13522" class="Record">Governance-Update</a><a id="14795" class="Symbol">)</a>
                          <a id="14823" class="Keyword">where</a>


  <a id="14833" class="Keyword">open</a> <a id="14838" href="Ledger.Conway.Specification.Ledger.html#997" class="Module">LState</a> <a id="14845" href="Ledger.Conway.Specification.Epoch.html#14682" class="Bound">ls</a>
  <a id="14850" class="Keyword">open</a> <a id="14855" href="Ledger.Core.Specification.Certs.html#4260" class="Module">CertState</a> <a id="14865" href="Ledger.Conway.Specification.Ledger.html#1109" class="Function">certState</a> <a id="14875" class="Keyword">using</a> <a id="14881" class="Symbol">(</a><a id="14882" href="Ledger.Core.Specification.Certs.html#4343" class="Field">pState</a><a id="14888" class="Symbol">;</a> <a id="14890" href="Ledger.Core.Specification.Certs.html#4363" class="Field">gState</a><a id="14896" class="Symbol">)</a>
  <a id="14900" class="Keyword">open</a> <a id="14905" href="Ledger.Core.Specification.Certs.html#4017" class="Module">PState</a> <a id="14912" href="Ledger.Core.Specification.Certs.html#4343" class="Function">pState</a>
  <a id="14921" class="Keyword">open</a> <a id="14926" href="Ledger.Conway.Specification.Epoch.html#13522" class="Module">Governance-Update</a> <a id="14944" href="Ledger.Conway.Specification.Epoch.html#14766" class="Bound">govUpdate</a>


  <a id="Pre-POOLREAPUpdate.utxoSt&#39;"></a><a id="14958" href="Ledger.Conway.Specification.Epoch.html#14958" class="Function">utxoSt&#39;</a> <a id="14966" class="Symbol">:</a> <a id="14968" href="Ledger.Conway.Specification.Utxo.html#1306" class="Record">UTxOState</a>
  <a id="14980" href="Ledger.Conway.Specification.Epoch.html#14958" class="Function">utxoSt&#39;</a> <a id="14988" class="Symbol">=</a> <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.Core.Specification.Transaction.html#2830}{\htmlId{14992}{\htmlClass{Field}{\text{UTxOOf}}}}\, \,\href{Ledger.Conway.Specification.Ledger.html#1056}{\htmlId{14999}{\htmlClass{Function}{\text{utxoSt}}}}\, \\ \,\href{Ledger.Prelude.Base.html#669}{\htmlId{15008}{\htmlClass{Field}{\text{FeesOf}}}}\, \,\href{Ledger.Conway.Specification.Ledger.html#1056}{\htmlId{15015}{\htmlClass{Function}{\text{utxoSt}}}}\, \\ \,\href{Ledger.Core.Specification.Certs.html#885}{\htmlId{15024}{\htmlClass{Field}{\text{DepositsOf}}}}\, \,\href{Ledger.Conway.Specification.Ledger.html#1056}{\htmlId{15035}{\htmlClass{Function}{\text{utxoSt}}}}\, \,\href{Axiom.Set.Map.html#13604}{\htmlId{15042}{\htmlClass{Function Operator}{\text{∣}}}}\, \,\href{abstract-set-theory.FiniteSetTheory.html#519}{\htmlId{15044}{\htmlClass{Function}{\text{mapˢ}}}}\, \,\htmlId{15049}{\htmlClass{Symbol}{\text{(}}}\,\,\href{Data.Product.Base.html#636}{\htmlId{15050}{\htmlClass{Field}{\text{proj₁}}}}\, \,\href{Function.Base.html#1134}{\htmlId{15056}{\htmlClass{Function Operator}{\text{∘}}}}\, \,\href{Data.Product.Base.html#650}{\htmlId{15058}{\htmlClass{Field}{\text{proj₂}}}}\,\,\htmlId{15063}{\htmlClass{Symbol}{\text{)}}}\, \,\href{Ledger.Conway.Specification.Epoch.html#13596}{\htmlId{15065}{\htmlClass{Field}{\text{removedGovActions}}}}\, \,\href{Axiom.Set.Map.html#13604}{\htmlId{15083}{\htmlClass{Function Operator}{\text{ᶜ}}}}\, \\ \,\htmlId{15087}{\htmlClass{Number}{\text{0}}}\, \end{pmatrix}$</a>

  <a id="Pre-POOLREAPUpdate.pState&#39;"></a><a id="15094" href="Ledger.Conway.Specification.Epoch.html#15094" class="Function">pState&#39;</a> <a id="15102" class="Symbol">:</a> <a id="15104" href="Ledger.Core.Specification.Certs.html#4017" class="Record">PState</a>
  <a id="15113" href="Ledger.Conway.Specification.Epoch.html#15094" class="Function">pState&#39;</a> <a id="15121" class="Symbol">=</a> <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.Core.Specification.Certs.html#4071}{\htmlId{15125}{\htmlClass{Function}{\text{fPools}}}}\, \,\href{Axiom.Set.Map.html#7638}{\htmlId{15132}{\htmlClass{Function Operator}{\text{∪ˡ}}}}\, \,\href{Ledger.Core.Specification.Certs.html#4049}{\htmlId{15135}{\htmlClass{Function}{\text{pools}}}}\, \\ \,\href{Class.HasEmptySet.html#287}{\htmlId{15143}{\htmlClass{Field}{\text{∅}}}}\, \\ \,\href{Ledger.Core.Specification.Certs.html#4093}{\htmlId{15147}{\htmlClass{Function}{\text{retiring}}}}\, \end{pmatrix}$</a>

  <a id="Pre-POOLREAPUpdate.gState&#39;"></a><a id="15161" href="Ledger.Conway.Specification.Epoch.html#15161" class="Function">gState&#39;</a> <a id="15169" class="Symbol">:</a> <a id="15171" href="Ledger.Core.Specification.Certs.html#4129" class="Record">GState</a>
  <a id="15180" href="Ledger.Conway.Specification.Epoch.html#15161" class="Function">gState&#39;</a> <a id="15188" class="Symbol">=</a>
    <a class="AgdaKaTeX">$\begin{pmatrix} \,\htmlId{15196}{\htmlClass{Symbol}{\text{(}}}\,\,\href{Class.ToBool.html#342}{\htmlId{15197}{\htmlClass{Function Operator}{\text{if}}}}\, \,\href{Data.List.Base.html#4681}{\htmlId{15200}{\htmlClass{Function}{\text{null}}}}\, \,\href{Ledger.Conway.Specification.Epoch.html#13656}{\htmlId{15205}{\htmlClass{Field}{\text{govSt&#39;}}}}\, \,\href{Class.ToBool.html#342}{\htmlId{15212}{\htmlClass{Function Operator}{\text{then}}}}\, \,\href{Axiom.Set.Map.html#7106}{\htmlId{15217}{\htmlClass{Function}{\text{mapValues}}}}\, \,\href{Ledger.Core.Specification.Epoch.html#1054}{\htmlId{15227}{\htmlClass{Function}{\text{sucᵉ}}}}\, \,\htmlId{15232}{\htmlClass{Symbol}{\text{(}}}\,\,\href{Ledger.Core.Specification.Certs.html#1572}{\htmlId{15233}{\htmlClass{Field}{\text{DRepsOf}}}}\, \,\href{Ledger.Core.Specification.Certs.html#4363}{\htmlId{15241}{\htmlClass{Function}{\text{gState}}}}\,\,\htmlId{15247}{\htmlClass{Symbol}{\text{)}}}\, \,\href{Class.ToBool.html#342}{\htmlId{15249}{\htmlClass{Function Operator}{\text{else}}}}\, \,\href{Ledger.Core.Specification.Certs.html#1572}{\htmlId{15254}{\htmlClass{Field}{\text{DRepsOf}}}}\, \,\href{Ledger.Core.Specification.Certs.html#4363}{\htmlId{15262}{\htmlClass{Function}{\text{gState}}}}\,\,\htmlId{15268}{\htmlClass{Symbol}{\text{)}}}\,
    \\ \,\href{Ledger.Core.Specification.Certs.html#1487}{\htmlId{15276}{\htmlClass{Field}{\text{CCHotKeysOf}}}}\, \,\href{Ledger.Core.Specification.Certs.html#4363}{\htmlId{15288}{\htmlClass{Function}{\text{gState}}}}\, \,\href{Axiom.Set.Map.html#13534}{\htmlId{15295}{\htmlClass{Function Operator}{\text{∣}}}}\, \,\href{Ledger.Conway.Specification.Enact.html#1362}{\htmlId{15297}{\htmlClass{Function}{\text{ccCreds}}}}\, \,\htmlId{15305}{\htmlClass{Symbol}{\text{(}}}\,\,\href{Ledger.Conway.Specification.Enact.html#480}{\htmlId{15306}{\htmlClass{Field}{\text{EnactState.cc}}}}\, \,\href{Ledger.Conway.Specification.Epoch.html#14722}{\htmlId{15320}{\htmlClass{Bound}{\text{es}}}}\,\,\htmlId{15322}{\htmlClass{Symbol}{\text{)}}}\,
    \end{pmatrix}$</a>

  <a id="Pre-POOLREAPUpdate.updates"></a><a id="15333" href="Ledger.Conway.Specification.Epoch.html#15333" class="Function">updates</a> <a id="15341" class="Symbol">:</a> <a id="15343" href="Ledger.Conway.Specification.Epoch.html#14502" class="Record">Pre-POOLREAP-Update</a>
  <a id="15365" href="Ledger.Conway.Specification.Epoch.html#15333" class="Function">updates</a> <a id="15373" class="Symbol">=</a> <a id="15375" href="Ledger.Conway.Specification.Epoch.html#14561" class="InductiveConstructor">Pre-POOLREAPUpdate</a> <a id="15394" href="Ledger.Conway.Specification.Epoch.html#15094" class="Function">pState&#39;</a> <a id="15402" href="Ledger.Conway.Specification.Epoch.html#15161" class="Function">gState&#39;</a> <a id="15410" href="Ledger.Conway.Specification.Epoch.html#14958" class="Function">utxoSt&#39;</a>

<a id="15419" class="Keyword">record</a> <a id="Post-POOLREAP-Update"></a><a id="15426" href="Ledger.Conway.Specification.Epoch.html#15426" class="Record">Post-POOLREAP-Update</a> <a id="15447" class="Symbol">:</a> <a id="15449" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="15454" class="Keyword">where</a>
  <a id="15462" class="Keyword">inductive</a>
  <a id="15474" class="Keyword">constructor</a> <a id="Post-POOLREAPUpdate"></a><a id="15486" href="Ledger.Conway.Specification.Epoch.html#15486" class="InductiveConstructor">Post-POOLREAPUpdate</a>
  <a id="15508" class="Keyword">field</a>
    <a id="Post-POOLREAP-Update.dState&#39;&#39;"></a><a id="15518" href="Ledger.Conway.Specification.Epoch.html#15518" class="Field">dState&#39;&#39;</a>       <a id="15533" class="Symbol">:</a> <a id="15535" href="Ledger.Core.Specification.Certs.html#3866" class="Record">DState</a>
    <a id="Post-POOLREAP-Update.acnt&#39;&#39;"></a><a id="15546" href="Ledger.Conway.Specification.Epoch.html#15546" class="Field">acnt&#39;&#39;</a>         <a id="15561" class="Symbol">:</a> <a id="15563" href="Ledger.Conway.Specification.PParams.html#718" class="Record">Acnt</a>

<a id="15569" class="Keyword">module</a> <a id="Post-POOLREAPUpdate"></a><a id="15576" href="Ledger.Conway.Specification.Epoch.html#15576" class="Module">Post-POOLREAPUpdate</a> <a id="15596" class="Symbol">(</a><a id="15597" href="Ledger.Conway.Specification.Epoch.html#15597" class="Bound">es</a> <a id="15600" class="Symbol">:</a> <a id="15602" href="Ledger.Conway.Specification.Enact.html#444" class="Record">EnactState</a><a id="15612" class="Symbol">)</a>
                           <a id="15641" class="Symbol">(</a><a id="15642" href="Ledger.Conway.Specification.Epoch.html#15642" class="Bound">ls</a> <a id="15645" class="Symbol">:</a> <a id="15647" href="Ledger.Conway.Specification.Ledger.html#997" class="Record">LState</a><a id="15653" class="Symbol">)</a>
                           <a id="15682" class="Symbol">(</a><a id="15683" href="Ledger.Conway.Specification.Epoch.html#15683" class="Bound">dState&#39;</a> <a id="15691" class="Symbol">:</a> <a id="15693" href="Ledger.Core.Specification.Certs.html#3866" class="Record">DState</a><a id="15699" class="Symbol">)</a>
                           <a id="15728" class="Symbol">(</a><a id="15729" href="Ledger.Conway.Specification.Epoch.html#15729" class="Bound">acnt&#39;</a> <a id="15735" class="Symbol">:</a> <a id="15737" href="Ledger.Conway.Specification.PParams.html#718" class="Record">Acnt</a><a id="15741" class="Symbol">)</a>
                           <a id="15770" class="Symbol">(</a><a id="15771" href="Ledger.Conway.Specification.Epoch.html#15771" class="Bound">govUpd</a> <a id="15778" class="Symbol">:</a> <a id="15780" href="Ledger.Conway.Specification.Epoch.html#13522" class="Record">Governance-Update</a><a id="15797" class="Symbol">)</a>
                           <a id="15826" class="Keyword">where</a>


  <a id="15836" class="Keyword">open</a> <a id="15841" href="Ledger.Conway.Specification.Ledger.html#997" class="Module">LState</a>
  <a id="15850" class="Keyword">open</a> <a id="15855" href="Ledger.Conway.Specification.Epoch.html#13522" class="Module">Governance-Update</a> <a id="15873" href="Ledger.Conway.Specification.Epoch.html#15771" class="Bound">govUpd</a>


  <a id="15884" class="Keyword">opaque</a>
    <a id="Post-POOLREAPUpdate.govActionReturns"></a><a id="15895" href="Ledger.Conway.Specification.Epoch.html#15895" class="Function">govActionReturns</a> <a id="15912" class="Symbol">:</a> <a id="15914" href="Ledger.Core.Specification.Address.html#1313" class="Record">RwdAddr</a> <a id="15922" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="15924" href="Ledger.Prelude.Base.html#154" class="Function">Coin</a>
    <a id="15933" href="Ledger.Conway.Specification.Epoch.html#15895" class="Function">govActionReturns</a> <a id="15950" class="Symbol">=</a>
      <a id="15958" href="Axiom.Set.Map.Dec.html#2130" class="Function">aggregate₊</a> <a id="15969" class="Symbol">(</a><a id="15970" href="abstract-set-theory.FiniteSetTheory.html#519" class="Function">mapˢ</a> <a id="15975" class="Symbol">(λ</a> <a id="15978" class="Symbol">(</a><a id="15979" href="Ledger.Conway.Specification.Epoch.html#15979" class="Bound">a</a> <a id="15981" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="15983" class="Symbol">_</a> <a id="15985" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="15987" href="Ledger.Conway.Specification.Epoch.html#15987" class="Bound">d</a><a id="15988" class="Symbol">)</a> <a id="15990" class="Symbol">→</a> <a id="15992" href="Ledger.Conway.Specification.Epoch.html#15979" class="Bound">a</a> <a id="15994" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="15996" href="Ledger.Conway.Specification.Epoch.html#15987" class="Bound">d</a><a id="15997" class="Symbol">)</a> <a id="15999" href="Ledger.Conway.Specification.Epoch.html#13596" class="Field">removedGovActions</a> <a id="16017" href="abstract-set-theory.FiniteSetTheory.html#2860" class="Function Operator">ᶠˢ</a><a id="16019" class="Symbol">)</a>

    <a id="Post-POOLREAPUpdate.payout"></a><a id="16026" href="Ledger.Conway.Specification.Epoch.html#16026" class="Function">payout</a> <a id="16033" class="Symbol">:</a> <a id="16035" href="Ledger.Core.Specification.Address.html#1313" class="Record">RwdAddr</a> <a id="16043" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="16045" href="Ledger.Prelude.Base.html#154" class="Function">Coin</a>
    <a id="16054" href="Ledger.Conway.Specification.Epoch.html#16026" class="Function">payout</a> <a id="16061" class="Symbol">=</a> <a id="16063" href="Ledger.Conway.Specification.Epoch.html#15895" class="Function">govActionReturns</a> <a id="16080" href="Axiom.Set.Map.Dec.html#2052" class="Function Operator">∪⁺</a> <a id="16083" href="Ledger.Core.Specification.Address.html#1688" class="Field">WithdrawalsOf</a> <a id="16097" href="Ledger.Conway.Specification.Epoch.html#15597" class="Bound">es</a>

  <a id="16103" class="Keyword">opaque</a>
    <a id="Post-POOLREAPUpdate.refunds"></a><a id="16114" href="Ledger.Conway.Specification.Epoch.html#16114" class="Function">refunds</a> <a id="16122" class="Symbol">:</a> <a id="16124" href="Ledger.Core.Specification.Address.html#259" class="Datatype">Credential</a> <a id="16135" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="16137" href="Ledger.Prelude.Base.html#154" class="Function">Coin</a>
    <a id="16146" href="Ledger.Conway.Specification.Epoch.html#16114" class="Function">refunds</a> <a id="16154" class="Symbol">=</a> <a id="16156" href="Axiom.Set.Map.html#17516" class="Function">pullbackMap</a> <a id="16168" href="Ledger.Conway.Specification.Epoch.html#16026" class="Function">payout</a> <a id="16175" href="Ledger.Conway.Specification.Epoch.html#5261" class="Function">toRwdAddr</a> <a id="16185" class="Symbol">(</a><a id="16186" href="Class.IsSet.html#916" class="Function">dom</a> <a id="16190" class="Symbol">(</a><a id="16191" href="Ledger.Core.Specification.Certs.html#1814" class="Field">RewardsOf</a> <a id="16201" href="Ledger.Conway.Specification.Epoch.html#15683" class="Bound">dState&#39;</a><a id="16208" class="Symbol">))</a>

  <a id="Post-POOLREAPUpdate.dState&#39;&#39;"></a><a id="16214" href="Ledger.Conway.Specification.Epoch.html#16214" class="Function">dState&#39;&#39;</a> <a id="16223" class="Symbol">:</a> <a id="16225" href="Ledger.Core.Specification.Certs.html#3866" class="Record">DState</a>
  <a id="16234" href="Ledger.Conway.Specification.Epoch.html#16214" class="Function">dState&#39;&#39;</a> <a id="16243" class="Symbol">=</a> <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.Core.Specification.Gov.Actions.html#2805}{\htmlId{16247}{\htmlClass{Field}{\text{VoteDelegsOf}}}}\, \,\href{Ledger.Conway.Specification.Epoch.html#15683}{\htmlId{16260}{\htmlClass{Bound}{\text{dState&#39;}}}}\, \\ \,\href{Ledger.Core.Specification.Certs.html#1979}{\htmlId{16270}{\htmlClass{Field}{\text{StakeDelegsOf}}}}\, \,\href{Ledger.Conway.Specification.Epoch.html#15683}{\htmlId{16284}{\htmlClass{Bound}{\text{dState&#39;}}}}\, \\ \,\href{Ledger.Core.Specification.Certs.html#1814}{\htmlId{16294}{\htmlClass{Field}{\text{RewardsOf}}}}\, \,\href{Ledger.Conway.Specification.Epoch.html#15683}{\htmlId{16304}{\htmlClass{Bound}{\text{dState&#39;}}}}\, \,\href{Axiom.Set.Map.Dec.html#2052}{\htmlId{16312}{\htmlClass{Function Operator}{\text{∪⁺}}}}\, \,\href{Ledger.Conway.Specification.Epoch.html#16114}{\htmlId{16315}{\htmlClass{Function}{\text{refunds}}}}\, \end{pmatrix}$</a>

  <a id="Post-POOLREAPUpdate.unclaimed"></a><a id="16328" href="Ledger.Conway.Specification.Epoch.html#16328" class="Function">unclaimed</a> <a id="16338" class="Symbol">:</a> <a id="16340" href="Ledger.Prelude.Base.html#154" class="Function">Coin</a>
  <a id="16347" href="Ledger.Conway.Specification.Epoch.html#16328" class="Function">unclaimed</a> <a id="16357" class="Symbol">=</a> <a id="16359" href="Ledger.Prelude.HasCoin.html#171" class="Field">getCoin</a> <a id="16367" href="Ledger.Conway.Specification.Epoch.html#16026" class="Function">payout</a> <a id="16374" href="Interface.TypeClasses.HasSubtract.html#223" class="Field Operator">-</a> <a id="16376" href="Ledger.Prelude.HasCoin.html#171" class="Field">getCoin</a> <a id="16384" href="Ledger.Conway.Specification.Epoch.html#16114" class="Function">refunds</a>

  <a id="Post-POOLREAPUpdate.totWithdrawals"></a><a id="16395" href="Ledger.Conway.Specification.Epoch.html#16395" class="Function">totWithdrawals</a> <a id="16410" class="Symbol">:</a> <a id="16412" href="Ledger.Prelude.Base.html#154" class="Function">Coin</a>
  <a id="16419" href="Ledger.Conway.Specification.Epoch.html#16395" class="Function">totWithdrawals</a> <a id="16434" class="Symbol">=</a> <a id="16436" href="abstract-set-theory.FiniteSetTheory.html#4312" class="Function">∑[</a> <a id="16439" href="Ledger.Conway.Specification.Epoch.html#16439" class="Bound">x</a> <a id="16441" href="abstract-set-theory.FiniteSetTheory.html#4312" class="Function">←</a> <a id="16443" href="Ledger.Core.Specification.Address.html#1688" class="Field">WithdrawalsOf</a> <a id="16457" href="Ledger.Conway.Specification.Epoch.html#15597" class="Bound">es</a> <a id="16460" href="abstract-set-theory.FiniteSetTheory.html#4312" class="Function">]</a> <a id="16462" href="Ledger.Conway.Specification.Epoch.html#16439" class="Bound">x</a>

  <a id="Post-POOLREAPUpdate.acnt&#39;&#39;"></a><a id="16467" href="Ledger.Conway.Specification.Epoch.html#16467" class="Function">acnt&#39;&#39;</a> <a id="16474" class="Symbol">:</a> <a id="16476" href="Ledger.Conway.Specification.PParams.html#718" class="Record">Acnt</a>
  <a id="16483" href="Ledger.Conway.Specification.Epoch.html#16467" class="Function">acnt&#39;&#39;</a> <a id="16490" class="Symbol">=</a> <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.Prelude.Base.html#889}{\htmlId{16494}{\htmlClass{Field}{\text{TreasuryOf}}}}\, \,\href{Ledger.Conway.Specification.Epoch.html#15729}{\htmlId{16505}{\htmlClass{Bound}{\text{acnt&#39;}}}}\, \,\href{Data.Nat.Base.html#4462}{\htmlId{16511}{\htmlClass{Primitive Operator}{\text{∸}}}}\, \,\href{Ledger.Conway.Specification.Epoch.html#16395}{\htmlId{16513}{\htmlClass{Function}{\text{totWithdrawals}}}}\, \,\href{Class.HasAdd.Core.html#162}{\htmlId{16528}{\htmlClass{Field Operator}{\text{+}}}}\, \,\href{Ledger.Prelude.Base.html#554}{\htmlId{16530}{\htmlClass{Field}{\text{DonationsOf}}}}\, \,\href{Ledger.Conway.Specification.Epoch.html#15642}{\htmlId{16542}{\htmlClass{Bound}{\text{ls}}}}\, \,\href{Class.HasAdd.Core.html#162}{\htmlId{16545}{\htmlClass{Field Operator}{\text{+}}}}\, \,\href{Ledger.Conway.Specification.Epoch.html#16328}{\htmlId{16547}{\htmlClass{Function}{\text{unclaimed}}}}\, \\ \,\href{Ledger.Prelude.Base.html#773}{\htmlId{16559}{\htmlClass{Field}{\text{ReservesOf}}}}\, \,\href{Ledger.Conway.Specification.Epoch.html#15729}{\htmlId{16570}{\htmlClass{Bound}{\text{acnt&#39;}}}}\, \end{pmatrix}$</a>

  <a id="Post-POOLREAPUpdate.updates"></a><a id="16581" href="Ledger.Conway.Specification.Epoch.html#16581" class="Function">updates</a> <a id="16589" class="Symbol">:</a> <a id="16591" href="Ledger.Conway.Specification.Epoch.html#15426" class="Record">Post-POOLREAP-Update</a>
  <a id="16614" href="Ledger.Conway.Specification.Epoch.html#16581" class="Function">updates</a> <a id="16622" class="Symbol">=</a> <a id="16624" href="Ledger.Conway.Specification.Epoch.html#15486" class="InductiveConstructor">Post-POOLREAPUpdate</a> <a id="16644" href="Ledger.Conway.Specification.Epoch.html#16214" class="Function">dState&#39;&#39;</a> <a id="16653" href="Ledger.Conway.Specification.Epoch.html#16467" class="Function">acnt&#39;&#39;</a>


<a id="16662" class="Keyword">data</a> <a id="_⊢_⇀⦇_,EPOCH⦈_"></a><a id="16667" href="Ledger.Conway.Specification.Epoch.html#16667" class="Datatype Operator">_⊢_⇀⦇_,EPOCH⦈_</a> <a id="16682" class="Symbol">:</a> <a id="16684" href="Agda.Builtin.Unit.html#175" class="Record">⊤</a> <a id="16686" class="Symbol">→</a> <a id="16688" href="Ledger.Conway.Specification.Epoch.html#1833" class="Record">EpochState</a> <a id="16699" class="Symbol">→</a> <a id="16701" href="Ledger.Core.Specification.Epoch.html#646" class="Function">Epoch</a> <a id="16707" class="Symbol">→</a> <a id="16709" href="Ledger.Conway.Specification.Epoch.html#1833" class="Record">EpochState</a> <a id="16720" class="Symbol">→</a> <a id="16722" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="16727" class="Keyword">where</a>


  <a id="_⊢_⇀⦇_,EPOCH⦈_.EPOCH"></a><a id="16737" href="Ledger.Conway.Specification.Epoch.html#16737" class="InductiveConstructor">EPOCH</a> <a id="16743" class="Symbol">:</a>
    <a id="16749" class="Keyword">let</a>
      <a id="16759" href="Ledger.Conway.Specification.Epoch.html#16759" class="Bound">es</a> <a id="16762" class="Symbol">=</a> <a id="16764" href="Ledger.Conway.Specification.Enact.html#787" class="Field">EnactStateOf</a> <a id="16777" href="Ledger.Conway.Specification.Epoch.html#12703" class="Generalizable">fut</a>

      <a id="16788" href="Ledger.Conway.Specification.Epoch.html#16788" class="Bound">govUpd</a> <a id="16795" class="Symbol">:</a> <a id="16797" href="Ledger.Conway.Specification.Epoch.html#13522" class="Record">Governance-Update</a>
      <a id="16821" href="Ledger.Conway.Specification.Epoch.html#16788" class="Bound">govUpd</a> <a id="16828" class="Symbol">=</a> <a id="16830" href="Ledger.Conway.Specification.Epoch.html#14412" class="Function">GovernanceUpdate.updates</a> <a id="16855" href="Ledger.Conway.Specification.Epoch.html#12790" class="Generalizable">ls</a> <a id="16858" href="Ledger.Conway.Specification.Epoch.html#12703" class="Generalizable">fut</a>

      <a id="16869" href="Ledger.Conway.Specification.Epoch.html#14561" class="InductiveConstructor">Pre-POOLREAPUpdate</a> <a id="16888" href="Ledger.Conway.Specification.Epoch.html#16888" class="Bound">pState&#39;</a> <a id="16896" href="Ledger.Conway.Specification.Epoch.html#16896" class="Bound">gState&#39;</a> <a id="16904" href="Ledger.Conway.Specification.Epoch.html#16904" class="Bound">utxoSt&#39;</a> <a id="16912" class="Symbol">=</a> <a id="16914" href="Ledger.Conway.Specification.Epoch.html#15333" class="Function">Pre-POOLREAPUpdate.updates</a> <a id="16941" href="Ledger.Conway.Specification.Epoch.html#12790" class="Generalizable">ls</a> <a id="16944" href="Ledger.Conway.Specification.Epoch.html#16759" class="Bound">es</a> <a id="16947" href="Ledger.Conway.Specification.Epoch.html#16788" class="Bound">govUpd</a>
      <a id="16960" href="Ledger.Conway.Specification.Epoch.html#15486" class="InductiveConstructor">Post-POOLREAPUpdate</a> <a id="16980" href="Ledger.Conway.Specification.Epoch.html#16980" class="Bound">dState&#39;&#39;</a> <a id="16989" href="Ledger.Conway.Specification.Epoch.html#16989" class="Bound">acnt&#39;&#39;</a> <a id="16996" class="Symbol">=</a> <a id="16998" href="Ledger.Conway.Specification.Epoch.html#16581" class="Function">Post-POOLREAPUpdate.updates</a> <a id="17026" href="Ledger.Conway.Specification.Epoch.html#16759" class="Bound">es</a> <a id="17029" href="Ledger.Conway.Specification.Epoch.html#12790" class="Generalizable">ls</a> <a id="17032" href="Ledger.Conway.Specification.Epoch.html#12901" class="Generalizable">dState&#39;</a> <a id="17040" href="Ledger.Conway.Specification.Epoch.html#12925" class="Generalizable">acnt&#39;</a> <a id="17046" href="Ledger.Conway.Specification.Epoch.html#16788" class="Bound">govUpd</a>

      <a id="17060" href="Ledger.Conway.Specification.Epoch.html#17060" class="Bound">es&#39;</a> <a id="17064" class="Symbol">:</a> <a id="17066" href="Ledger.Conway.Specification.Enact.html#444" class="Record">EnactState</a>
      <a id="17083" href="Ledger.Conway.Specification.Epoch.html#17060" class="Bound">es&#39;</a> <a id="17087" class="Symbol">=</a> <a id="17089" class="Keyword">record</a> <a id="17096" href="Ledger.Conway.Specification.Epoch.html#16759" class="Bound">es</a> <a id="17099" class="Symbol">{</a> <a id="17101" href="Ledger.Conway.Specification.Enact.html#696" class="Field">withdrawals</a> <a id="17113" class="Symbol">=</a> <a id="17115" href="Class.HasEmptySet.html#287" class="Field">∅</a> <a id="17117" class="Symbol">}</a>

      <a id="17126" href="Ledger.Conway.Specification.Epoch.html#17126" class="Bound">govSt&#39;</a> <a id="17133" class="Symbol">:</a> <a id="17135" href="Ledger.Conway.Specification.Gov.html#1459" class="Function">GovState</a>
      <a id="17150" href="Ledger.Conway.Specification.Epoch.html#17126" class="Bound">govSt&#39;</a> <a id="17157" class="Symbol">=</a> <a id="17159" href="Ledger.Conway.Specification.Epoch.html#13656" class="Field">Governance-Update.govSt&#39;</a> <a id="17184" href="Ledger.Conway.Specification.Epoch.html#16788" class="Bound">govUpd</a>

      <a id="17198" href="Ledger.Conway.Specification.Epoch.html#17198" class="Bound">stakeDistrs</a> <a id="17210" class="Symbol">:</a> <a id="17212" href="Ledger.Conway.Specification.Ratify.html#3115" class="Record">StakeDistrs</a>
      <a id="17230" href="Ledger.Conway.Specification.Epoch.html#17198" class="Bound">stakeDistrs</a> <a id="17242" class="Symbol">=</a> <a id="17244" href="Ledger.Conway.Specification.Epoch.html#12366" class="Function">mkStakeDistrs</a> <a id="17258" class="Symbol">(</a><a id="17259" href="Ledger.Conway.Specification.Rewards.html#7768" class="Field">Snapshots.mark</a> <a id="17274" href="Ledger.Conway.Specification.Epoch.html#12966" class="Generalizable">ss&#39;</a><a id="17277" class="Symbol">)</a> <a id="17279" href="Ledger.Conway.Specification.Epoch.html#12681" class="Generalizable">e</a> <a id="17281" href="Ledger.Conway.Specification.Epoch.html#16904" class="Bound">utxoSt&#39;</a>
                                  <a id="17323" href="Ledger.Conway.Specification.Epoch.html#17126" class="Bound">govSt&#39;</a> <a id="17330" class="Symbol">(</a><a id="17331" href="Ledger.Core.Specification.Certs.html#4779" class="Field">GStateOf</a> <a id="17340" href="Ledger.Conway.Specification.Epoch.html#12790" class="Generalizable">ls</a><a id="17342" class="Symbol">)</a> <a id="17344" class="Symbol">(</a><a id="17345" href="Ledger.Core.Specification.Certs.html#4563" class="Field">DStateOf</a> <a id="17354" href="Ledger.Conway.Specification.Epoch.html#12790" class="Generalizable">ls</a><a id="17356" class="Symbol">)</a>

      <a id="17365" href="Ledger.Conway.Specification.Epoch.html#17365" class="Bound">Γ</a> <a id="17367" class="Symbol">:</a> <a id="17369" href="Ledger.Conway.Specification.Ratify.html#3234" class="Record">RatifyEnv</a>
      <a id="17385" href="Ledger.Conway.Specification.Epoch.html#17365" class="Bound">Γ</a> <a id="17387" class="Symbol">=</a> <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.Conway.Specification.Epoch.html#17198}{\htmlId{17391}{\htmlClass{Bound}{\text{stakeDistrs}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#12681}{\htmlId{17405}{\htmlClass{Generalizable}{\text{e}}}}\, \\ \,\href{Ledger.Core.Specification.Certs.html#1572}{\htmlId{17409}{\htmlClass{Field}{\text{DRepsOf}}}}\, \,\href{Ledger.Conway.Specification.Epoch.html#12790}{\htmlId{17417}{\htmlClass{Generalizable}{\text{ls}}}}\, \\ \,\href{Ledger.Core.Specification.Certs.html#1487}{\htmlId{17422}{\htmlClass{Field}{\text{CCHotKeysOf}}}}\, \,\href{Ledger.Conway.Specification.Epoch.html#12790}{\htmlId{17434}{\htmlClass{Generalizable}{\text{ls}}}}\, \\ \,\href{Ledger.Prelude.Base.html#889}{\htmlId{17439}{\htmlClass{Field}{\text{TreasuryOf}}}}\, \,\href{Ledger.Conway.Specification.Epoch.html#16989}{\htmlId{17450}{\htmlClass{Bound}{\text{acnt&#39;&#39;}}}}\, \\ \,\href{Ledger.Core.Specification.Certs.html#1649}{\htmlId{17459}{\htmlClass{Field}{\text{PoolsOf}}}}\, \,\href{Ledger.Conway.Specification.Epoch.html#12790}{\htmlId{17467}{\htmlClass{Generalizable}{\text{ls}}}}\, \\ \,\href{Ledger.Core.Specification.Gov.Actions.html#2805}{\htmlId{17472}{\htmlClass{Field}{\text{VoteDelegsOf}}}}\, \,\href{Ledger.Conway.Specification.Epoch.html#12790}{\htmlId{17485}{\htmlClass{Generalizable}{\text{ls}}}}\, \end{pmatrix}$</a>

    <a id="17495" class="Keyword">in</a>
        <a id="17506" href="Ledger.Conway.Specification.Epoch.html#12790" class="Generalizable">ls</a> <a id="17509" href="Ledger.Conway.Specification.Rewards.html#8209" class="Datatype Operator">⊢</a> <a id="17511" href="Ledger.Conway.Specification.Epoch.html#12963" class="Generalizable">ss</a> <a id="17514" href="Ledger.Conway.Specification.Rewards.html#8209" class="Datatype Operator">⇀⦇</a> <a id="17517" href="Agda.Builtin.Unit.html#212" class="InductiveConstructor">tt</a> <a id="17520" href="Ledger.Conway.Specification.Rewards.html#8209" class="Datatype Operator">,SNAP⦈</a> <a id="17527" href="Ledger.Conway.Specification.Epoch.html#12966" class="Generalizable">ss&#39;</a>
      <a id="17537" href="Prelude.InferenceRules.html#56006" class="Function Operator">∙</a> <a id="17539" class="Symbol">_</a>  <a id="17542" href="Ledger.Conway.Specification.PoolReap.html#866" class="Datatype Operator">⊢</a> <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.Conway.Specification.Epoch.html#16904}{\htmlId{17546}{\htmlClass{Bound}{\text{utxoSt&#39;}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#12920}{\htmlId{17556}{\htmlClass{Generalizable}{\text{acnt}}}}\, \\ \,\href{Ledger.Core.Specification.Certs.html#4563}{\htmlId{17563}{\htmlClass{Field}{\text{DStateOf}}}}\, \,\href{Ledger.Conway.Specification.Epoch.html#12790}{\htmlId{17572}{\htmlClass{Generalizable}{\text{ls}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#16888}{\htmlId{17577}{\htmlClass{Bound}{\text{pState&#39;}}}}\, \end{pmatrix}$</a> <a id="17587" href="Ledger.Conway.Specification.PoolReap.html#866" class="Datatype Operator">⇀⦇</a> <a id="17590" href="Ledger.Conway.Specification.Epoch.html#12681" class="Generalizable">e</a> <a id="17592" href="Ledger.Conway.Specification.PoolReap.html#866" class="Datatype Operator">,POOLREAP⦈</a> <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.Conway.Specification.Epoch.html#12940}{\htmlId{17605}{\htmlClass{Generalizable}{\text{utxoSt&#39;&#39;}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#12925}{\htmlId{17616}{\htmlClass{Generalizable}{\text{acnt&#39;}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#12901}{\htmlId{17624}{\htmlClass{Generalizable}{\text{dState&#39;}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#12881}{\htmlId{17634}{\htmlClass{Generalizable}{\text{pState&#39;&#39;}}}}\, \end{pmatrix}$</a>
      <a id="17651" href="Prelude.InferenceRules.html#56006" class="Function Operator">∙</a> <a id="17653" href="Ledger.Conway.Specification.Epoch.html#17365" class="Bound">Γ</a>  <a id="17656" href="Ledger.Conway.Specification.Ratify.html#13443" class="Function Operator">⊢</a> <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.Conway.Specification.Epoch.html#16759}{\htmlId{17660}{\htmlClass{Bound}{\text{es}}}}\, \\ \,\href{Class.HasEmptySet.html#287}{\htmlId{17665}{\htmlClass{Field}{\text{∅}}}}\, \\ \,\href{Agda.Builtin.Bool.html#192}{\htmlId{17669}{\htmlClass{InductiveConstructor}{\text{false}}}}\, \end{pmatrix}$</a> <a id="17677" href="Ledger.Conway.Specification.Ratify.html#13443" class="Function Operator">⇀⦇</a> <a id="17680" href="Ledger.Conway.Specification.Epoch.html#17126" class="Bound">govSt&#39;</a> <a id="17687" href="Ledger.Conway.Specification.Ratify.html#13443" class="Function Operator">,RATIFIES⦈</a> <a id="17698" href="Ledger.Conway.Specification.Epoch.html#12707" class="Generalizable">fut&#39;</a>
      <a id="17709" href="Prelude.InferenceRules.html#13071" class="Function Operator">──────────────────────────────────────────────</a>
      <a id="17762" class="Symbol">_</a> <a id="17764" href="Ledger.Conway.Specification.Epoch.html#16667" class="Datatype Operator">⊢</a> <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.Conway.Specification.Epoch.html#12920}{\htmlId{17768}{\htmlClass{Generalizable}{\text{acnt}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#12963}{\htmlId{17775}{\htmlClass{Generalizable}{\text{ss}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#12790}{\htmlId{17780}{\htmlClass{Generalizable}{\text{ls}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#12804}{\htmlId{17785}{\htmlClass{Generalizable}{\text{es₀}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#12703}{\htmlId{17791}{\htmlClass{Generalizable}{\text{fut}}}}\, \end{pmatrix}$</a> <a id="17797" href="Ledger.Conway.Specification.Epoch.html#16667" class="Datatype Operator">⇀⦇</a> <a id="17800" href="Ledger.Conway.Specification.Epoch.html#12681" class="Generalizable">e</a> <a id="17802" href="Ledger.Conway.Specification.Epoch.html#16667" class="Datatype Operator">,EPOCH⦈</a> <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.Conway.Specification.Epoch.html#16989}{\htmlId{17812}{\htmlClass{Bound}{\text{acnt&#39;&#39;}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#12966}{\htmlId{17821}{\htmlClass{Generalizable}{\text{ss&#39;}}}}\, \\ \begin{pmatrix} \,\href{Ledger.Conway.Specification.Epoch.html#12940}{\htmlId{17829}{\htmlClass{Generalizable}{\text{utxoSt&#39;&#39;}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#17126}{\htmlId{17840}{\htmlClass{Bound}{\text{govSt&#39;}}}}\, \\ \begin{pmatrix} \,\href{Ledger.Conway.Specification.Epoch.html#16980}{\htmlId{17851}{\htmlClass{Bound}{\text{dState&#39;&#39;}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#12881}{\htmlId{17862}{\htmlClass{Generalizable}{\text{pState&#39;&#39;}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#16896}{\htmlId{17873}{\htmlClass{Bound}{\text{gState&#39;}}}}\, \end{pmatrix} \end{pmatrix} \\ \,\href{Ledger.Conway.Specification.Epoch.html#17060}{\htmlId{17889}{\htmlClass{Bound}{\text{es&#39;}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#12707}{\htmlId{17895}{\htmlClass{Generalizable}{\text{fut&#39;}}}}\, \end{pmatrix}$</a>


<a id="17904" class="Keyword">data</a> <a id="_⊢_⇀⦇_,NEWEPOCH⦈_"></a><a id="17909" href="Ledger.Conway.Specification.Epoch.html#17909" class="Datatype Operator">_⊢_⇀⦇_,NEWEPOCH⦈_</a> <a id="17927" class="Symbol">:</a> <a id="17929" href="Agda.Builtin.Unit.html#175" class="Record">⊤</a> <a id="17931" class="Symbol">→</a> <a id="17933" href="Ledger.Conway.Specification.Epoch.html#3360" class="Record">NewEpochState</a> <a id="17947" class="Symbol">→</a> <a id="17949" href="Ledger.Core.Specification.Epoch.html#646" class="Function">Epoch</a> <a id="17955" class="Symbol">→</a> <a id="17957" href="Ledger.Conway.Specification.Epoch.html#3360" class="Record">NewEpochState</a> <a id="17971" class="Symbol">→</a> <a id="17973" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="17978" class="Keyword">where</a>

  <a id="_⊢_⇀⦇_,NEWEPOCH⦈_.NEWEPOCH-New"></a><a id="17987" href="Ledger.Conway.Specification.Epoch.html#17987" class="InductiveConstructor">NEWEPOCH-New</a> <a id="18000" class="Symbol">:</a> <a id="18002" class="Symbol">∀</a> <a id="18004" class="Symbol">{</a><a id="18005" href="Ledger.Conway.Specification.Epoch.html#18005" class="Bound">bprev</a> <a id="18011" href="Ledger.Conway.Specification.Epoch.html#18011" class="Bound">bcur</a> <a id="18016" class="Symbol">:</a> <a id="18018" href="Ledger.Conway.Specification.Rewards.html#4921" class="Function">BlocksMade</a><a id="18028" class="Symbol">}</a> <a id="18030" class="Symbol">→</a>
    <a id="18036" class="Keyword">let</a>
      <a id="18046" href="Ledger.Conway.Specification.Epoch.html#18046" class="Bound">eps&#39;</a> <a id="18051" class="Symbol">=</a> <a id="18053" href="Ledger.Conway.Specification.Epoch.html#8706" class="Function">applyRUpd</a> <a id="18063" href="Ledger.Conway.Specification.Epoch.html#12984" class="Generalizable">ru</a> <a id="18066" href="Ledger.Conway.Specification.Epoch.html#12760" class="Generalizable">eps</a>
      <a id="18076" href="Ledger.Conway.Specification.Epoch.html#18076" class="Bound">ss</a>   <a id="18081" class="Symbol">=</a> <a id="18083" href="Ledger.Conway.Specification.Epoch.html#1923" class="Field">EpochState.ss</a> <a id="18097" href="Ledger.Conway.Specification.Epoch.html#12769" class="Generalizable">eps&#39;&#39;</a>
      <a id="18109" href="Ledger.Conway.Specification.Epoch.html#18109" class="Bound">pd&#39;</a>  <a id="18114" class="Symbol">=</a> <a id="18116" href="Ledger.Conway.Specification.Epoch.html#9774" class="Function">calculatePoolDelegatedStake</a> <a id="18144" class="Symbol">(</a><a id="18145" href="Ledger.Conway.Specification.Rewards.html#7773" class="Field">Snapshots.set</a> <a id="18159" href="Ledger.Conway.Specification.Epoch.html#18076" class="Bound">ss</a><a id="18161" class="Symbol">)</a>
    <a id="18167" class="Keyword">in</a>
      <a id="18176" href="Prelude.InferenceRules.html#56075" class="Function Operator">∙</a> <a id="18178" href="Ledger.Conway.Specification.Epoch.html#12681" class="Generalizable">e</a> <a id="18180" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="18182" href="Ledger.Conway.Specification.Epoch.html#12683" class="Generalizable">lastEpoch</a> <a id="18192" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="18194" class="Number">1</a>
      <a id="18202" href="Prelude.InferenceRules.html#56006" class="Function Operator">∙</a> <a id="18204" class="Symbol">_</a> <a id="18206" href="Ledger.Conway.Specification.Epoch.html#16667" class="Datatype Operator">⊢</a> <a id="18208" href="Ledger.Conway.Specification.Epoch.html#18046" class="Bound">eps&#39;</a> <a id="18213" href="Ledger.Conway.Specification.Epoch.html#16667" class="Datatype Operator">⇀⦇</a> <a id="18216" href="Ledger.Conway.Specification.Epoch.html#12681" class="Generalizable">e</a> <a id="18218" href="Ledger.Conway.Specification.Epoch.html#16667" class="Datatype Operator">,EPOCH⦈</a> <a id="18226" href="Ledger.Conway.Specification.Epoch.html#12769" class="Generalizable">eps&#39;&#39;</a>
      <a id="18238" href="Prelude.InferenceRules.html#13071" class="Function Operator">──────────────────────────────────────────────</a>
      <a id="18291" class="Symbol">_</a> <a id="18293" href="Ledger.Conway.Specification.Epoch.html#17909" class="Datatype Operator">⊢</a> <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.Conway.Specification.Epoch.html#12683}{\htmlId{18297}{\htmlClass{Generalizable}{\text{lastEpoch}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#18005}{\htmlId{18309}{\htmlClass{Bound}{\text{bprev}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#18011}{\htmlId{18317}{\htmlClass{Bound}{\text{bcur}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#12760}{\htmlId{18324}{\htmlClass{Generalizable}{\text{eps}}}}\, \\ \,\href{Agda.Builtin.Maybe.html#173}{\htmlId{18330}{\htmlClass{InductiveConstructor}{\text{just}}}}\, \,\href{Ledger.Conway.Specification.Epoch.html#12984}{\htmlId{18335}{\htmlClass{Generalizable}{\text{ru}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#13031}{\htmlId{18340}{\htmlClass{Generalizable}{\text{pd}}}}\, \end{pmatrix}$</a> <a id="18345" href="Ledger.Conway.Specification.Epoch.html#17909" class="Datatype Operator">⇀⦇</a> <a id="18348" href="Ledger.Conway.Specification.Epoch.html#12681" class="Generalizable">e</a> <a id="18350" href="Ledger.Conway.Specification.Epoch.html#17909" class="Datatype Operator">,NEWEPOCH⦈</a> <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.Conway.Specification.Epoch.html#12681}{\htmlId{18363}{\htmlClass{Generalizable}{\text{e}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#18011}{\htmlId{18367}{\htmlClass{Bound}{\text{bcur}}}}\, \\ \,\href{Axiom.Set.Map.html#2671}{\htmlId{18374}{\htmlClass{Function}{\text{∅ᵐ}}}}\,  \\ \,\href{Ledger.Conway.Specification.Epoch.html#12769}{\htmlId{18380}{\htmlClass{Generalizable}{\text{eps&#39;&#39;}}}}\, \\ \,\href{Agda.Builtin.Maybe.html#194}{\htmlId{18388}{\htmlClass{InductiveConstructor}{\text{nothing}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#18109}{\htmlId{18398}{\htmlClass{Bound}{\text{pd&#39;}}}}\, \end{pmatrix}$</a>

  <a id="_⊢_⇀⦇_,NEWEPOCH⦈_.NEWEPOCH-Not-New"></a><a id="18407" href="Ledger.Conway.Specification.Epoch.html#18407" class="InductiveConstructor">NEWEPOCH-Not-New</a> <a id="18424" class="Symbol">:</a> <a id="18426" class="Symbol">∀</a> <a id="18428" class="Symbol">{</a><a id="18429" href="Ledger.Conway.Specification.Epoch.html#18429" class="Bound">bprev</a> <a id="18435" href="Ledger.Conway.Specification.Epoch.html#18435" class="Bound">bcur</a> <a id="18440" class="Symbol">:</a> <a id="18442" href="Ledger.Conway.Specification.Rewards.html#4921" class="Function">BlocksMade</a><a id="18452" class="Symbol">}</a> <a id="18454" class="Symbol">→</a>
    <a id="18460" href="Prelude.InferenceRules.html#56075" class="Function Operator">∙</a> <a id="18462" href="Ledger.Conway.Specification.Epoch.html#12681" class="Generalizable">e</a> <a id="18464" href="Relation.Binary.PropositionalEquality.Core.html#1000" class="Function Operator">≢</a> <a id="18466" href="Ledger.Conway.Specification.Epoch.html#12683" class="Generalizable">lastEpoch</a> <a id="18476" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="18478" class="Number">1</a>
      <a id="18486" href="Prelude.InferenceRules.html#13071" class="Function Operator">──────────────────────────────────────────────</a>
      <a id="18539" class="Symbol">_</a> <a id="18541" href="Ledger.Conway.Specification.Epoch.html#17909" class="Datatype Operator">⊢</a> <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.Conway.Specification.Epoch.html#12683}{\htmlId{18545}{\htmlClass{Generalizable}{\text{lastEpoch}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#18429}{\htmlId{18557}{\htmlClass{Bound}{\text{bprev}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#18435}{\htmlId{18565}{\htmlClass{Bound}{\text{bcur}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#12760}{\htmlId{18572}{\htmlClass{Generalizable}{\text{eps}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#13004}{\htmlId{18578}{\htmlClass{Generalizable}{\text{mru}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#13031}{\htmlId{18584}{\htmlClass{Generalizable}{\text{pd}}}}\, \end{pmatrix}$</a> <a id="18589" href="Ledger.Conway.Specification.Epoch.html#17909" class="Datatype Operator">⇀⦇</a> <a id="18592" href="Ledger.Conway.Specification.Epoch.html#12681" class="Generalizable">e</a> <a id="18594" href="Ledger.Conway.Specification.Epoch.html#17909" class="Datatype Operator">,NEWEPOCH⦈</a> <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.Conway.Specification.Epoch.html#12683}{\htmlId{18607}{\htmlClass{Generalizable}{\text{lastEpoch}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#18429}{\htmlId{18619}{\htmlClass{Bound}{\text{bprev}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#18435}{\htmlId{18627}{\htmlClass{Bound}{\text{bcur}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#12760}{\htmlId{18634}{\htmlClass{Generalizable}{\text{eps}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#13004}{\htmlId{18640}{\htmlClass{Generalizable}{\text{mru}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#13031}{\htmlId{18646}{\htmlClass{Generalizable}{\text{pd}}}}\, \end{pmatrix}$</a>

  <a id="_⊢_⇀⦇_,NEWEPOCH⦈_.NEWEPOCH-No-Reward-Update"></a><a id="18654" href="Ledger.Conway.Specification.Epoch.html#18654" class="InductiveConstructor">NEWEPOCH-No-Reward-Update</a> <a id="18680" class="Symbol">:</a> <a id="18682" class="Symbol">∀</a> <a id="18684" class="Symbol">{</a><a id="18685" href="Ledger.Conway.Specification.Epoch.html#18685" class="Bound">bprev</a> <a id="18691" href="Ledger.Conway.Specification.Epoch.html#18691" class="Bound">bcur</a> <a id="18696" class="Symbol">:</a> <a id="18698" href="Ledger.Conway.Specification.Rewards.html#4921" class="Function">BlocksMade</a><a id="18708" class="Symbol">}</a> <a id="18710" class="Symbol">→</a>
    <a id="18716" class="Keyword">let</a>
      <a id="18726" href="Ledger.Conway.Specification.Epoch.html#18726" class="Bound">ss</a>  <a id="18730" class="Symbol">=</a> <a id="18732" href="Ledger.Conway.Specification.Epoch.html#1923" class="Field">EpochState.ss</a> <a id="18746" href="Ledger.Conway.Specification.Epoch.html#12764" class="Generalizable">eps&#39;</a>
      <a id="18757" href="Ledger.Conway.Specification.Epoch.html#18757" class="Bound">pd&#39;</a> <a id="18761" class="Symbol">=</a> <a id="18763" href="Ledger.Conway.Specification.Epoch.html#9774" class="Function">calculatePoolDelegatedStake</a> <a id="18791" class="Symbol">(</a><a id="18792" href="Ledger.Conway.Specification.Rewards.html#7773" class="Field">Snapshots.set</a> <a id="18806" href="Ledger.Conway.Specification.Epoch.html#18726" class="Bound">ss</a><a id="18808" class="Symbol">)</a>
    <a id="18814" class="Keyword">in</a>
      <a id="18823" href="Prelude.InferenceRules.html#56075" class="Function Operator">∙</a> <a id="18825" href="Ledger.Conway.Specification.Epoch.html#12681" class="Generalizable">e</a> <a id="18827" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="18829" href="Ledger.Conway.Specification.Epoch.html#12683" class="Generalizable">lastEpoch</a> <a id="18839" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="18841" class="Number">1</a>
      <a id="18849" href="Prelude.InferenceRules.html#56006" class="Function Operator">∙</a> <a id="18851" class="Symbol">_</a> <a id="18853" href="Ledger.Conway.Specification.Epoch.html#16667" class="Datatype Operator">⊢</a> <a id="18855" href="Ledger.Conway.Specification.Epoch.html#12760" class="Generalizable">eps</a> <a id="18859" href="Ledger.Conway.Specification.Epoch.html#16667" class="Datatype Operator">⇀⦇</a> <a id="18862" href="Ledger.Conway.Specification.Epoch.html#12681" class="Generalizable">e</a> <a id="18864" href="Ledger.Conway.Specification.Epoch.html#16667" class="Datatype Operator">,EPOCH⦈</a> <a id="18872" href="Ledger.Conway.Specification.Epoch.html#12764" class="Generalizable">eps&#39;</a>
      <a id="18883" href="Prelude.InferenceRules.html#13071" class="Function Operator">──────────────────────────────────────────────</a>
      <a id="18936" class="Symbol">_</a> <a id="18938" href="Ledger.Conway.Specification.Epoch.html#17909" class="Datatype Operator">⊢</a> <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.Conway.Specification.Epoch.html#12683}{\htmlId{18942}{\htmlClass{Generalizable}{\text{lastEpoch}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#18685}{\htmlId{18954}{\htmlClass{Bound}{\text{bprev}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#18691}{\htmlId{18962}{\htmlClass{Bound}{\text{bcur}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#12760}{\htmlId{18969}{\htmlClass{Generalizable}{\text{eps}}}}\, \\ \,\href{Agda.Builtin.Maybe.html#194}{\htmlId{18975}{\htmlClass{InductiveConstructor}{\text{nothing}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#13031}{\htmlId{18985}{\htmlClass{Generalizable}{\text{pd}}}}\, \end{pmatrix}$</a> <a id="18990" href="Ledger.Conway.Specification.Epoch.html#17909" class="Datatype Operator">⇀⦇</a> <a id="18993" href="Ledger.Conway.Specification.Epoch.html#12681" class="Generalizable">e</a> <a id="18995" href="Ledger.Conway.Specification.Epoch.html#17909" class="Datatype Operator">,NEWEPOCH⦈</a> <a class="AgdaKaTeX">$\begin{pmatrix} \,\href{Ledger.Conway.Specification.Epoch.html#12681}{\htmlId{19008}{\htmlClass{Generalizable}{\text{e}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#18691}{\htmlId{19012}{\htmlClass{Bound}{\text{bcur}}}}\, \\ \,\href{Axiom.Set.Map.html#2671}{\htmlId{19019}{\htmlClass{Function}{\text{∅ᵐ}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#12764}{\htmlId{19024}{\htmlClass{Generalizable}{\text{eps&#39;}}}}\, \\ \,\href{Agda.Builtin.Maybe.html#194}{\htmlId{19031}{\htmlClass{InductiveConstructor}{\text{nothing}}}}\, \\ \,\href{Ledger.Conway.Specification.Epoch.html#18757}{\htmlId{19041}{\htmlClass{Bound}{\text{pd&#39;}}}}\, \end{pmatrix}$</a>

</pre></body></html>