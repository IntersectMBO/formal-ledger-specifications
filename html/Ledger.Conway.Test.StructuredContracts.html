<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>Ledger.Conway.Test.StructuredContracts</title><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.css"><link rel="stylesheet" href="Agda.css"><script src="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.js"></script><script src="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/contrib/auto-render.min.js"></script><script src="AgdaKaTeX.js" defer=""></script></head><body><pre class="Agda">
<a id="2" class="Symbol">{-#</a> <a id="6" class="Keyword">OPTIONS</a> <a id="14" class="Pragma">--safe</a> <a id="21" class="Symbol">#-}</a>

<a id="26" class="Keyword">open</a> <a id="31" class="Keyword">import</a> <a id="38" href="Algebra.html" class="Module">Algebra</a>
<a id="46" class="Keyword">open</a> <a id="51" class="Keyword">import</a> <a id="58" href="Data.Nat.Properties.html" class="Module">Data.Nat.Properties</a> <a id="78" class="Keyword">using</a> <a id="84" class="Symbol">(</a><a id="85" href="Data.Nat.Properties.html#17252" class="Function">+-0-monoid</a><a id="95" class="Symbol">)</a>

<a id="98" class="Keyword">open</a> <a id="103" class="Keyword">import</a> <a id="110" href="Ledger.Prelude.html" class="Module">Ledger.Prelude</a><a id="124" class="Symbol">;</a> <a id="126" class="Keyword">open</a> <a id="131" href="Function.Bundles.html#4752" class="Module">Equivalence</a>
<a id="143" class="Keyword">open</a> <a id="148" class="Keyword">import</a> <a id="155" href="Ledger.Conway.Transaction.html" class="Module">Ledger.Conway.Transaction</a>
<a id="181" class="Keyword">open</a> <a id="186" class="Keyword">import</a> <a id="193" href="Ledger.Conway.Abstract.html" class="Module">Ledger.Conway.Abstract</a>
<a id="216" class="Keyword">open</a> <a id="221" class="Keyword">import</a> <a id="228" href="Ledger.Conway.TokenAlgebra.Base.html" class="Module">Ledger.Conway.TokenAlgebra.Base</a>
<a id="260" class="Keyword">open</a> <a id="265" class="Keyword">import</a> <a id="272" href="Ledger.Conway.TokenAlgebra.ValueSet.html" class="Module">Ledger.Conway.TokenAlgebra.ValueSet</a>


<a id="310" class="Keyword">module</a> <a id="317" href="Ledger.Conway.Test.StructuredContracts.html" class="Module">Ledger.Conway.Test.StructuredContracts</a>
  <a id="358" class="Symbol">(</a><a id="359" href="Ledger.Conway.Test.StructuredContracts.html#359" class="Bound">txs</a> <a id="363" class="Symbol">:</a> <a id="365" class="Symbol">_)</a> <a id="368" class="Symbol">(</a><a id="369" class="Keyword">open</a> <a id="374" href="Ledger.Conway.Transaction.html#872" class="Module">TransactionStructure</a> <a id="395" href="Ledger.Conway.Test.StructuredContracts.html#359" class="Bound">txs</a><a id="398" class="Symbol">)</a>
  <a id="402" class="Symbol">(</a><a id="403" href="Ledger.Conway.Test.StructuredContracts.html#403" class="Bound">abs</a> <a id="407" class="Symbol">:</a> <a id="409" href="Ledger.Conway.Abstract.html#599" class="Record">AbstractFunctions</a> <a id="427" href="Ledger.Conway.Test.StructuredContracts.html#359" class="Bound">txs</a><a id="430" class="Symbol">)</a> <a id="432" class="Symbol">(</a><a id="433" class="Keyword">open</a> <a id="438" href="Ledger.Conway.Abstract.html#599" class="Module">AbstractFunctions</a> <a id="456" href="Ledger.Conway.Test.StructuredContracts.html#403" class="Bound">abs</a><a id="459" class="Symbol">)</a>
  <a id="463" class="Keyword">where</a>

<a id="470" class="Keyword">open</a> <a id="475" class="Keyword">import</a> <a id="482" href="Ledger.Conway.Ledger.html" class="Module">Ledger.Conway.Ledger</a> <a id="503" href="Ledger.Conway.Test.StructuredContracts.html#359" class="Bound">txs</a> <a id="507" href="Ledger.Conway.Test.StructuredContracts.html#403" class="Bound">abs</a>
<a id="511" class="Keyword">open</a> <a id="516" class="Keyword">import</a> <a id="523" href="Ledger.Conway.Script.Validation.html" class="Module">Ledger.Conway.Script.Validation</a> <a id="555" href="Ledger.Conway.Test.StructuredContracts.html#359" class="Bound">txs</a> <a id="559" href="Ledger.Conway.Test.StructuredContracts.html#403" class="Bound">abs</a>
<a id="563" class="Keyword">open</a> <a id="568" class="Keyword">import</a> <a id="575" href="Ledger.Conway.Utxo.html" class="Module">Ledger.Conway.Utxo</a> <a id="594" href="Ledger.Conway.Test.StructuredContracts.html#359" class="Bound">txs</a> <a id="598" href="Ledger.Conway.Test.StructuredContracts.html#403" class="Bound">abs</a>


<a id="SSRel"></a><a id="604" href="Ledger.Conway.Test.StructuredContracts.html#604" class="Function">SSRel</a> <a id="610" class="Symbol">:</a> <a id="612" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="617" class="Symbol">→</a> <a id="619" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="624" class="Symbol">→</a> <a id="626" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="631" class="Symbol">→</a> <a id="633" href="Agda.Primitive.html#388" class="Primitive">Type₁</a>
<a id="639" href="Ledger.Conway.Test.StructuredContracts.html#604" class="Function">SSRel</a> <a id="645" href="Ledger.Conway.Test.StructuredContracts.html#645" class="Bound">Env</a> <a id="649" href="Ledger.Conway.Test.StructuredContracts.html#649" class="Bound">State</a> <a id="655" href="Ledger.Conway.Test.StructuredContracts.html#655" class="Bound">Input</a> <a id="661" class="Symbol">=</a> <a id="663" href="Ledger.Conway.Test.StructuredContracts.html#645" class="Bound">Env</a> <a id="667" class="Symbol">→</a> <a id="669" href="Ledger.Conway.Test.StructuredContracts.html#649" class="Bound">State</a> <a id="675" class="Symbol">→</a> <a id="677" href="Ledger.Conway.Test.StructuredContracts.html#655" class="Bound">Input</a> <a id="683" class="Symbol">→</a> <a id="685" href="Ledger.Conway.Test.StructuredContracts.html#649" class="Bound">State</a> <a id="691" class="Symbol">→</a> <a id="693" href="Agda.Primitive.html#388" class="Primitive">Type</a>

<a id="699" class="Keyword">record</a> <a id="StrucSimulation"></a><a id="706" href="Ledger.Conway.Test.StructuredContracts.html#706" class="Record">StrucSimulation</a> <a id="722" href="Ledger.Conway.Test.StructuredContracts.html#722" class="Bound">S</a> <a id="724" href="Ledger.Conway.Test.StructuredContracts.html#724" class="Bound">I</a> <a id="726" class="Symbol">(</a><a id="727" href="Ledger.Conway.Test.StructuredContracts.html#727" class="Bound Operator">_⊢_⇀⦇_,STRUC⦈_</a> <a id="742" class="Symbol">:</a> <a id="744" href="Ledger.Conway.Test.StructuredContracts.html#604" class="Function">SSRel</a> <a id="750" href="Agda.Builtin.Unit.html#175" class="Record">⊤</a> <a id="752" href="Ledger.Conway.Test.StructuredContracts.html#722" class="Bound">S</a> <a id="754" href="Ledger.Conway.Test.StructuredContracts.html#724" class="Bound">I</a><a id="755" class="Symbol">)</a> <a id="757" class="Symbol">:</a> <a id="759" href="Agda.Primitive.html#388" class="Primitive">Type₁</a> <a id="765" class="Keyword">where</a>
  <a id="773" class="Keyword">field</a>
    <a id="StrucSimulation.πˢ"></a><a id="783" href="Ledger.Conway.Test.StructuredContracts.html#783" class="Field">πˢ</a> <a id="786" class="Symbol">:</a> <a id="788" href="Ledger.Conway.Ledger.html#865" class="Record">LState</a> <a id="795" class="Symbol">→</a> <a id="797" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="803" href="Ledger.Conway.Test.StructuredContracts.html#722" class="Bound">S</a>
    <a id="StrucSimulation.πⁱ"></a><a id="809" href="Ledger.Conway.Test.StructuredContracts.html#809" class="Field">πⁱ</a> <a id="812" class="Symbol">:</a> <a id="814" href="Ledger.Conway.Script.Validation.html#1731" class="Record">TxInfo</a> <a id="821" class="Symbol">→</a> <a id="823" href="Ledger.Conway.Test.StructuredContracts.html#724" class="Bound">I</a>
    <a id="829" class="Comment">-- here, add optional extra assumptions about ledger state, env, and transaction that may be too difficult to prove without reasoning about complete ledger traces</a>
    <a id="996" class="Comment">-- e.g. transaction does not re-add a UTxO entry it spends</a>
    <a id="1059" class="Comment">-- e.g. current Slot is after the validity interval of some previous transaction</a>
    <a id="StrucSimulation.extraAssmp"></a><a id="1144" href="Ledger.Conway.Test.StructuredContracts.html#1144" class="Field">extraAssmp</a> <a id="1155" class="Symbol">:</a> <a id="1157" href="Ledger.Conway.Ledger.html#601" class="Record">LEnv</a> <a id="1162" class="Symbol">→</a> <a id="1164" href="Ledger.Conway.Ledger.html#865" class="Record">LState</a> <a id="1171" class="Symbol">→</a> <a id="1173" href="Ledger.Conway.Transaction.html#4227" class="Record">Tx</a> <a id="1176" class="Symbol">→</a> <a id="1178" href="Agda.Primitive.html#388" class="Primitive">Type</a> 

  <a id="StrucSimulation._~ˢ_"></a><a id="1187" href="Ledger.Conway.Test.StructuredContracts.html#1187" class="Function Operator">_~ˢ_</a> <a id="1192" class="Symbol">:</a> <a id="1194" href="Ledger.Conway.Ledger.html#865" class="Record">LState</a> <a id="1201" class="Symbol">→</a> <a id="1203" href="Ledger.Conway.Test.StructuredContracts.html#722" class="Bound">S</a> <a id="1205" class="Symbol">→</a> <a id="1207" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="1212" class="Comment">-- R</a>
  <a id="1219" href="Ledger.Conway.Test.StructuredContracts.html#1219" class="Bound">u</a> <a id="1221" href="Ledger.Conway.Test.StructuredContracts.html#1187" class="Function Operator">~ˢ</a> <a id="1224" href="Ledger.Conway.Test.StructuredContracts.html#1224" class="Bound">s</a> <a id="1226" class="Symbol">=</a> <a id="1228" href="Ledger.Conway.Test.StructuredContracts.html#783" class="Field">πˢ</a> <a id="1231" href="Ledger.Conway.Test.StructuredContracts.html#1219" class="Bound">u</a> <a id="1233" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="1235" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="1240" href="Ledger.Conway.Test.StructuredContracts.html#1224" class="Bound">s</a>

    <a id="1247" class="Comment">-- only for PlutusV3</a>
  <a id="StrucSimulation._~ᵉ_"></a><a id="1270" href="Ledger.Conway.Test.StructuredContracts.html#1270" class="Function Operator">_~ᵉ_</a> <a id="1275" class="Symbol">:</a> <a id="1277" href="Ledger.Conway.Ledger.html#601" class="Record">LEnv</a> <a id="1282" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="1284" href="Ledger.Conway.Transaction.html#4227" class="Record">Tx</a> <a id="1287" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="1289" href="Ledger.Conway.Ledger.html#865" class="Record">LState</a> <a id="1296" class="Symbol">→</a> <a id="1298" href="Agda.Builtin.Unit.html#175" class="Record">⊤</a> <a id="1300" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="1302" href="Ledger.Conway.Test.StructuredContracts.html#724" class="Bound">I</a> <a id="1304" class="Symbol">→</a> <a id="1306" href="Agda.Primitive.html#388" class="Primitive">Type</a>
  <a id="1313" href="Ledger.Conway.Test.StructuredContracts.html#1270" class="Function Operator">_~ᵉ_</a> <a id="1318" class="Symbol">=</a> <a id="1320" class="Symbol">λ</a> <a id="1322" class="Symbol">(</a><a id="1323" href="Ledger.Conway.Test.StructuredContracts.html#1323" class="Bound">le</a> <a id="1326" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1328" href="Ledger.Conway.Test.StructuredContracts.html#1328" class="Bound">tx</a> <a id="1331" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1333" href="Ledger.Conway.Test.StructuredContracts.html#1333" class="Bound">u</a><a id="1334" class="Symbol">)</a> <a id="1336" class="Symbol">(</a><a id="1337" href="Agda.Builtin.Unit.html#212" class="InductiveConstructor">tt</a> <a id="1340" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1342" href="Ledger.Conway.Test.StructuredContracts.html#1342" class="Bound">i</a><a id="1343" class="Symbol">)</a> <a id="1345" class="Symbol">→</a> <a id="1347" href="Ledger.Conway.Test.StructuredContracts.html#809" class="Field">πⁱ</a> <a id="1350" class="Symbol">(</a><a id="1351" href="Ledger.Conway.Script.Validation.html#2030" class="Function">txInfo</a> <a id="1358" href="Ledger.Conway.Script.Base.html#1029" class="Function">PlutusV3</a> <a id="1367" class="Symbol">(</a><a id="1368" href="Ledger.Conway.PParams.html#3549" class="Field">PParamsOf</a> <a id="1378" href="Ledger.Conway.Test.StructuredContracts.html#1323" class="Bound">le</a><a id="1380" class="Symbol">)</a> <a id="1382" class="Symbol">(</a><a id="1383" href="Ledger.Conway.Transaction.html#2657" class="Field">UTxOOf</a> <a id="1390" href="Ledger.Conway.Test.StructuredContracts.html#1333" class="Bound">u</a><a id="1391" class="Symbol">)</a> <a id="1393" href="Ledger.Conway.Test.StructuredContracts.html#1328" class="Bound">tx</a><a id="1395" class="Symbol">)</a> <a id="1397" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="1399" href="Ledger.Conway.Test.StructuredContracts.html#1342" class="Bound">i</a>

  <a id="1404" class="Keyword">field</a>
    <a id="StrucSimulation.simulates"></a><a id="1414" href="Ledger.Conway.Test.StructuredContracts.html#1414" class="Field">simulates</a> <a id="1424" class="Symbol">:</a> <a id="1426" class="Symbol">∀</a> <a id="1428" href="Ledger.Conway.Test.StructuredContracts.html#1428" class="Bound">Γ</a> <a id="1430" href="Ledger.Conway.Test.StructuredContracts.html#1430" class="Bound">s</a> <a id="1432" href="Ledger.Conway.Test.StructuredContracts.html#1432" class="Bound">u</a> <a id="1434" href="Ledger.Conway.Test.StructuredContracts.html#1434" class="Bound">tx</a> <a id="1437" href="Ledger.Conway.Test.StructuredContracts.html#1437" class="Bound">i′</a> <a id="1440" href="Ledger.Conway.Test.StructuredContracts.html#1440" class="Bound">u′</a> <a id="1443" class="Symbol">→</a> <a id="1445" href="Ledger.Conway.Test.StructuredContracts.html#1144" class="Field">extraAssmp</a> <a id="1456" href="Ledger.Conway.Test.StructuredContracts.html#1428" class="Bound">Γ</a> <a id="1458" href="Ledger.Conway.Test.StructuredContracts.html#1432" class="Bound">u</a> <a id="1460" href="Ledger.Conway.Test.StructuredContracts.html#1434" class="Bound">tx</a> <a id="1463" class="Symbol">→</a>
      <a id="1471" href="Prelude.InferenceRules.html#56074" class="Function Operator">∙</a> <a id="1473" href="Ledger.Conway.Test.StructuredContracts.html#1428" class="Bound">Γ</a> <a id="1475" href="Ledger.Conway.Ledger.html#2637" class="Datatype Operator">⊢</a> <a id="1477" href="Ledger.Conway.Test.StructuredContracts.html#1432" class="Bound">u</a> <a id="1479" href="Ledger.Conway.Ledger.html#2637" class="Datatype Operator">⇀⦇</a> <a id="1482" href="Ledger.Conway.Test.StructuredContracts.html#1434" class="Bound">tx</a> <a id="1485" href="Ledger.Conway.Ledger.html#2637" class="Datatype Operator">,LEDGER⦈</a> <a id="1494" href="Ledger.Conway.Test.StructuredContracts.html#1440" class="Bound">u′</a>
      <a id="1503" href="iog-prelude.Prelude.InferenceRules.html#583" class="Function Operator">∙</a> <a id="1505" class="Symbol">(</a><a id="1506" href="Ledger.Conway.Test.StructuredContracts.html#1428" class="Bound">Γ</a> <a id="1508" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1510" href="Ledger.Conway.Test.StructuredContracts.html#1434" class="Bound">tx</a> <a id="1513" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1515" href="Ledger.Conway.Test.StructuredContracts.html#1432" class="Bound">u</a><a id="1516" class="Symbol">)</a> <a id="1518" href="Ledger.Conway.Test.StructuredContracts.html#1270" class="Function Operator">~ᵉ</a> <a id="1521" class="Symbol">(</a><a id="1522" href="Agda.Builtin.Unit.html#212" class="InductiveConstructor">tt</a> <a id="1525" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1527" href="Ledger.Conway.Test.StructuredContracts.html#1437" class="Bound">i′</a><a id="1529" class="Symbol">)</a>
      <a id="1537" href="iog-prelude.Prelude.InferenceRules.html#583" class="Function Operator">∙</a> <a id="1539" href="Ledger.Conway.Test.StructuredContracts.html#1432" class="Bound">u</a> <a id="1541" href="Ledger.Conway.Test.StructuredContracts.html#1187" class="Function Operator">~ˢ</a> <a id="1544" href="Ledger.Conway.Test.StructuredContracts.html#1430" class="Bound">s</a>
      <a id="1552" href="iog-prelude.Prelude.InferenceRules.html#217" class="Function Operator">────────────────────────────────</a>
        <a id="1593" href="Data.Product.Base.html#1371" class="Function">∃[</a> <a id="1596" href="Ledger.Conway.Test.StructuredContracts.html#1596" class="Bound">s′</a> <a id="1599" href="Data.Product.Base.html#1371" class="Function">]</a> <a id="1601" href="Ledger.Conway.Test.StructuredContracts.html#1440" class="Bound">u′</a> <a id="1604" href="Ledger.Conway.Test.StructuredContracts.html#1187" class="Function Operator">~ˢ</a> <a id="1607" href="Ledger.Conway.Test.StructuredContracts.html#1596" class="Bound">s′</a>
               <a id="1625" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="1627" href="Agda.Builtin.Unit.html#212" class="InductiveConstructor">tt</a> <a id="1630" href="Ledger.Conway.Test.StructuredContracts.html#727" class="Bound Operator">⊢</a> <a id="1632" href="Ledger.Conway.Test.StructuredContracts.html#1430" class="Bound">s</a> <a id="1634" href="Ledger.Conway.Test.StructuredContracts.html#727" class="Bound Operator">⇀⦇</a> <a id="1637" href="Ledger.Conway.Test.StructuredContracts.html#1437" class="Bound">i′</a> <a id="1640" href="Ledger.Conway.Test.StructuredContracts.html#727" class="Bound Operator">,STRUC⦈</a> <a id="1648" href="Ledger.Conway.Test.StructuredContracts.html#1596" class="Bound">s′</a>

</pre></body></html>