<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>Ledger.Conway.Foreign.HSLedger.Rewards</title><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.css"><link rel="stylesheet" href="Agda.css"><script src="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.js"></script><script src="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/contrib/auto-render.min.js"></script><script src="AgdaKaTeX.js" defer=""></script></head><body><pre class="Agda"><a id="1" class="Keyword">module</a> <a id="8" href="Ledger.Conway.Foreign.HSLedger.Rewards.html" class="Module">Ledger.Conway.Foreign.HSLedger.Rewards</a> <a id="47" class="Keyword">where</a>

<a id="54" class="Keyword">import</a> <a id="61" href="Data.Integer.html" class="Module">Data.Integer</a> <a id="74" class="Symbol">as</a> <a id="77" class="Module">ℤ</a>

<a id="80" class="Keyword">open</a> <a id="85" class="Keyword">import</a> <a id="92" href="Ledger.Conway.Foreign.HSLedger.Address.html" class="Module">Ledger.Conway.Foreign.HSLedger.Address</a>
<a id="131" class="Keyword">open</a> <a id="136" class="Keyword">import</a> <a id="143" href="Ledger.Conway.Foreign.HSLedger.BaseTypes.html" class="Module">Ledger.Conway.Foreign.HSLedger.BaseTypes</a>
<a id="184" class="Keyword">open</a> <a id="189" class="Keyword">import</a> <a id="196" href="Ledger.Conway.Foreign.HSLedger.Certs.html" class="Module">Ledger.Conway.Foreign.HSLedger.Certs</a>

<a id="234" class="Keyword">open</a> <a id="239" class="Keyword">import</a> <a id="246" href="Ledger.Conway.Conformance.Rewards.html" class="Module">Ledger.Conway.Conformance.Rewards</a> <a id="280" href="Function.Base.html#4755" class="Function">it</a> <a id="283" href="Function.Base.html#4755" class="Function">it</a>

<a id="287" class="Keyword">instance</a>
  <a id="HsTy-Snapshot"></a><a id="298" href="Ledger.Conway.Foreign.HSLedger.Rewards.html#298" class="Function">HsTy-Snapshot</a> <a id="312" class="Symbol">=</a> <a id="314" href="Foreign.HaskellTypes.Deriving.html#11530" class="Macro Operator">autoHsType</a> <a id="325" href="Ledger.Conway.Specification.Rewards.html#6504" class="Record">Snapshot</a> <a id="334" href="Foreign.HaskellTypes.Deriving.html#11530" class="Macro Operator">⊣</a> <a id="336" href="Foreign.HaskellTypes.Deriving.html#3237" class="Function">withConstructor</a> <a id="352" class="String">&quot;MkSnapshot&quot;</a>
  <a id="Conv-Snapshot"></a><a id="367" href="Ledger.Conway.Foreign.HSLedger.Rewards.html#367" class="Function">Conv-Snapshot</a> <a id="381" class="Symbol">=</a> <a id="383" href="Foreign.Convertible.Deriving.html#6814" class="Macro">autoConvert</a> <a id="395" href="Ledger.Conway.Specification.Rewards.html#6504" class="Record">Snapshot</a>

  <a id="HsTy-Snapshots"></a><a id="407" href="Ledger.Conway.Foreign.HSLedger.Rewards.html#407" class="Function">HsTy-Snapshots</a> <a id="422" class="Symbol">=</a> <a id="424" href="Foreign.HaskellTypes.Deriving.html#11530" class="Macro Operator">autoHsType</a> <a id="435" href="Ledger.Conway.Specification.Rewards.html#7638" class="Record">Snapshots</a> <a id="445" href="Foreign.HaskellTypes.Deriving.html#11530" class="Macro Operator">⊣</a> <a id="447" href="Foreign.HaskellTypes.Deriving.html#3237" class="Function">withConstructor</a> <a id="463" class="String">&quot;MkSnapshots&quot;</a>
  <a id="Conv-Snapshots"></a><a id="479" href="Ledger.Conway.Foreign.HSLedger.Rewards.html#479" class="Function">Conv-Snapshots</a> <a id="494" class="Symbol">=</a> <a id="496" href="Foreign.Convertible.Deriving.html#6814" class="Macro">autoConvert</a> <a id="508" href="Ledger.Conway.Specification.Rewards.html#7638" class="Record">Snapshots</a>

<a id="519" class="Keyword">record</a> <a id="HsRewardUpdate"></a><a id="526" href="Ledger.Conway.Foreign.HSLedger.Rewards.html#526" class="Record">HsRewardUpdate</a> <a id="541" class="Symbol">:</a> <a id="543" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="548" class="Keyword">where</a>
  <a id="556" class="Keyword">field</a> <a id="HsRewardUpdate.Δt"></a><a id="562" href="Ledger.Conway.Foreign.HSLedger.Rewards.html#562" class="Field">Δt</a> <a id="HsRewardUpdate.Δr"></a><a id="565" href="Ledger.Conway.Foreign.HSLedger.Rewards.html#565" class="Field">Δr</a> <a id="HsRewardUpdate.Δf"></a><a id="568" href="Ledger.Conway.Foreign.HSLedger.Rewards.html#568" class="Field">Δf</a> <a id="571" class="Symbol">:</a> <a id="573" href="Agda.Builtin.Int.html#245" class="Datatype">ℤ</a>
        <a id="HsRewardUpdate.rs"></a><a id="583" href="Ledger.Conway.Foreign.HSLedger.Rewards.html#583" class="Field">rs</a> <a id="586" class="Symbol">:</a> <a id="588" href="Foreign.HaskellTypes.html#593" class="Function">HsType</a> <a id="595" class="Symbol">(</a><a id="596" href="Ledger.Core.Specification.Address.html#260" class="Datatype">Credential</a> <a id="607" href="abstract-set-theory.FiniteSetTheory.html#633" class="Function Operator">⇀</a> <a id="609" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a><a id="613" class="Symbol">)</a>
<a id="615" class="Symbol">{-#</a> <a id="619" class="Keyword">FOREIGN</a> <a id="627" class="Pragma">GHC</a>
  <a id="633" class="Pragma">data</a> <a id="638" class="Pragma">HsRewardUpdate</a> <a id="653" class="Pragma">=</a> <a id="655" class="Pragma">MkRewardUpdate</a>
    <a id="674" class="Pragma">{</a> <a id="676" class="Pragma">deltaT</a>  <a id="684" class="Pragma">::</a> <a id="687" class="Pragma">Integer</a>
    <a id="699" class="Pragma">,</a> <a id="701" class="Pragma">deltaR</a>  <a id="709" class="Pragma">::</a> <a id="712" class="Pragma">Integer</a>
    <a id="724" class="Pragma">,</a> <a id="726" class="Pragma">deltaF</a>  <a id="734" class="Pragma">::</a> <a id="737" class="Pragma">Integer</a>
    <a id="749" class="Pragma">,</a> <a id="751" class="Pragma">rs</a>      <a id="759" class="Pragma">::</a>
        <a id="770" class="Pragma">MAlonzo.Code.Ledger.Prelude.Foreign.HSTypes.HSMap</a>
          <a id="830" class="Pragma">MAlonzo.Code.Ledger.Conway.Foreign.HSLedger.Address.Credential</a>
          <a id="903" class="Pragma">Integer</a>
    <a id="915" class="Pragma">}</a>
    <a id="921" class="Pragma">deriving</a> <a id="930" class="Pragma">(Eq,</a> <a id="935" class="Pragma">Show)</a>
<a id="941" class="Symbol">#-}</a>

<a id="946" class="Symbol">{-#</a> <a id="950" class="Keyword">COMPILE</a> <a id="958" class="Keyword">GHC</a> <a id="962" href="Ledger.Conway.Foreign.HSLedger.Rewards.html#526" class="Record">HsRewardUpdate</a> <a id="977" class="Pragma">=</a> <a id="979" class="Pragma">data</a> <a id="984" class="Pragma">HsRewardUpdate</a> <a id="999" class="Pragma">(MkRewardUpdate)</a> <a id="1016" class="Symbol">#-}</a>

<a id="1021" class="Keyword">instance</a>
  <a id="HsTy-RewardUpdate"></a><a id="1032" href="Ledger.Conway.Foreign.HSLedger.Rewards.html#1032" class="Function">HsTy-RewardUpdate</a> <a id="1050" class="Symbol">:</a> <a id="1052" href="Foreign.HaskellTypes.html#532" class="Record">HasHsType</a> <a id="1062" href="Ledger.Conway.Specification.Rewards.html#6281" class="Record">RewardUpdate</a>
  <a id="1077" href="Ledger.Conway.Foreign.HSLedger.Rewards.html#1032" class="Function">HsTy-RewardUpdate</a> <a id="1095" class="Symbol">.</a><a id="1096" href="Foreign.HaskellTypes.html#579" class="Field">HasHsType.HsType</a> <a id="1113" class="Symbol">=</a> <a id="1115" href="Ledger.Conway.Foreign.HSLedger.Rewards.html#526" class="Record">HsRewardUpdate</a>

  <a id="1133" class="Comment">-- manual, since we want to throw an error on non-zero update</a>
  <a id="Conv-RewardUpdate"></a><a id="1197" href="Ledger.Conway.Foreign.HSLedger.Rewards.html#1197" class="Function">Conv-RewardUpdate</a> <a id="1215" class="Symbol">:</a> <a id="1217" href="Foreign.Convertible.html#103" class="Record">Convertible</a> <a id="1229" href="Ledger.Conway.Specification.Rewards.html#6281" class="Record">RewardUpdate</a> <a id="1242" href="Ledger.Conway.Foreign.HSLedger.Rewards.html#526" class="Record">HsRewardUpdate</a>
  <a id="1259" href="Ledger.Conway.Foreign.HSLedger.Rewards.html#1197" class="Function">Conv-RewardUpdate</a> <a id="1277" class="Symbol">.</a><a id="1278" href="Foreign.Convertible.html#149" class="Field">to</a>   <a id="1283" href="Ledger.Conway.Foreign.HSLedger.Rewards.html#1283" class="Bound">ru</a> <a id="1286" class="Symbol">=</a> <a id="1288" class="Keyword">record</a> <a id="1295" class="Symbol">{</a> <a id="1297" href="Ledger.Conway.Foreign.HSLedger.Rewards.html#1297" class="Module">RewardUpdate</a> <a id="1310" href="Ledger.Conway.Foreign.HSLedger.Rewards.html#1283" class="Bound">ru</a><a id="1312" class="Symbol">;</a> <a id="1314" href="Ledger.Conway.Foreign.HSLedger.Rewards.html#583" class="Field">rs</a> <a id="1317" class="Symbol">=</a> <a id="1319" href="Foreign.Convertible.html#149" class="Field">to</a> <a id="1322" class="Symbol">(</a><a id="1323" href="Ledger.Conway.Foreign.HSLedger.Rewards.html#1283" class="Bound">ru</a> <a id="1326" class="Symbol">.</a><a id="1327" href="Ledger.Conway.Specification.Rewards.html#6344" class="Field">RewardUpdate.rs</a><a id="1342" class="Symbol">)</a> <a id="1344" class="Symbol">}</a>
  <a id="1348" href="Ledger.Conway.Foreign.HSLedger.Rewards.html#1197" class="Function">Conv-RewardUpdate</a> <a id="1366" class="Symbol">.</a><a id="1367" href="Foreign.Convertible.html#170" class="Field">from</a> <a id="1372" href="Ledger.Conway.Foreign.HSLedger.Rewards.html#1372" class="Bound">ru</a> <a id="1375" class="Symbol">=</a> <a id="1377" href="Ledger.Conway.Foreign.HSLedger.Rewards.html#1699" class="Function">HsRewardUpdate→RewardUpdate</a>
    <a id="1409" class="Keyword">where</a> 
      <a id="1422" class="Keyword">module</a> <a id="1429" href="Ledger.Conway.Foreign.HSLedger.Rewards.html#1429" class="Module">_</a> <a id="1431" class="Keyword">where</a>
        <a id="1445" class="Keyword">module</a> <a id="1452" href="Ledger.Conway.Foreign.HSLedger.Rewards.html#1452" class="Module">ru</a> <a id="1455" class="Symbol">=</a> <a id="1457" href="Ledger.Conway.Foreign.HSLedger.Rewards.html#526" class="Module">HsRewardUpdate</a> <a id="1472" href="Ledger.Conway.Foreign.HSLedger.Rewards.html#1372" class="Bound">ru</a>
        <a id="1483" class="Keyword">open</a> <a id="1488" href="Ledger.Conway.Foreign.HSLedger.Rewards.html#1452" class="Module">ru</a>

        <a id="1500" href="Ledger.Conway.Foreign.HSLedger.Rewards.html#1500" class="Function">flowConservation?</a> <a id="1518" class="Symbol">=</a> <a id="1520" href="Class.Decidable.Core.html#470" class="Function Operator">¿</a> <a id="1522" href="Ledger.Conway.Foreign.HSLedger.Rewards.html#562" class="Field">Δt</a> <a id="1525" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="1527" href="Ledger.Conway.Foreign.HSLedger.Rewards.html#565" class="Field">Δr</a> <a id="1530" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="1532" href="Ledger.Conway.Foreign.HSLedger.Rewards.html#568" class="Field">Δf</a> <a id="1535" href="Class.HasAdd.Core.html#162" class="Field Operator">+</a> <a id="1537" href="Agda.Builtin.Int.html#263" class="InductiveConstructor Operator">ℤ.+</a> <a id="1541" class="Symbol">(</a><a id="1542" href="abstract-set-theory.FiniteSetTheory.html#3166" class="Function">indexedSumᵛ&#39;</a> <a id="1555" class="Symbol">{</a><a id="1556" class="Argument">A</a> <a id="1558" class="Symbol">=</a> <a id="1560" href="Ledger.Core.Specification.Address.html#260" class="Datatype">Credential</a><a id="1570" class="Symbol">}</a> <a id="1572" class="Symbol">(λ</a> <a id="1575" href="Ledger.Conway.Foreign.HSLedger.Rewards.html#1575" class="Bound">x</a> <a id="1577" class="Symbol">→</a> <a id="1579" href="Ledger.Conway.Foreign.HSLedger.Rewards.html#1575" class="Bound">x</a><a id="1580" class="Symbol">)</a> <a id="1582" class="Symbol">(</a><a id="1583" href="Foreign.Convertible.html#170" class="Field">from</a> <a id="1588" href="Ledger.Conway.Foreign.HSLedger.Rewards.html#583" class="Field">rs</a><a id="1590" class="Symbol">))</a> <a id="1593" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="1595" href="Data.Integer.Base.html#1545" class="Function">ℤ.0ℤ</a> <a id="1600" href="Class.Decidable.Core.html#470" class="Function Operator">¿</a>
        <a id="1610" href="Ledger.Conway.Foreign.HSLedger.Rewards.html#1610" class="Function">Δt-nonnegative?</a>   <a id="1628" class="Symbol">=</a> <a id="1630" href="Class.Decidable.Core.html#470" class="Function Operator">¿</a> <a id="1632" href="Data.Integer.Base.html#1545" class="Function">ℤ.0ℤ</a> <a id="1637" href="Data.Integer.Base.html#1991" class="Datatype Operator">ℤ.≤</a> <a id="1641" href="Ledger.Conway.Foreign.HSLedger.Rewards.html#562" class="Field">Δt</a> <a id="1644" href="Class.Decidable.Core.html#470" class="Function Operator">¿</a>
        <a id="1654" href="Ledger.Conway.Foreign.HSLedger.Rewards.html#1654" class="Function">Δf-nonpositive?</a>   <a id="1672" class="Symbol">=</a> <a id="1674" href="Class.Decidable.Core.html#470" class="Function Operator">¿</a> <a id="1676" href="Ledger.Conway.Foreign.HSLedger.Rewards.html#568" class="Field">Δf</a> <a id="1679" href="Data.Integer.Base.html#1991" class="Datatype Operator">ℤ.≤</a> <a id="1683" href="Data.Integer.Base.html#1545" class="Function">ℤ.0ℤ</a> <a id="1688" href="Class.Decidable.Core.html#470" class="Function Operator">¿</a>

        <a id="1699" href="Ledger.Conway.Foreign.HSLedger.Rewards.html#1699" class="Function">HsRewardUpdate→RewardUpdate</a> <a id="1727" class="Symbol">:</a> <a id="1729" href="Ledger.Conway.Specification.Rewards.html#6281" class="Record">RewardUpdate</a>
        <a id="1750" href="Ledger.Conway.Foreign.HSLedger.Rewards.html#1699" class="Function">HsRewardUpdate→RewardUpdate</a>
          <a id="1788" class="Keyword">with</a> <a id="1793" href="Ledger.Conway.Foreign.HSLedger.Rewards.html#1500" class="Function">flowConservation?</a> <a id="1811" class="Symbol">|</a> <a id="1813" href="Ledger.Conway.Foreign.HSLedger.Rewards.html#1610" class="Function">Δt-nonnegative?</a> <a id="1829" class="Symbol">|</a> <a id="1831" href="Ledger.Conway.Foreign.HSLedger.Rewards.html#1654" class="Function">Δf-nonpositive?</a>
        <a id="1855" href="Ledger.Conway.Foreign.HSLedger.Rewards.html#1699" class="Function">...</a> <a id="1859" class="Symbol">|</a> <a id="1861" href="Relation.Nullary.Decidable.Core.html#2099" class="InductiveConstructor">yes</a> <a id="1865" href="Ledger.Conway.Foreign.HSLedger.Rewards.html#1865" class="Bound">p</a> <a id="1867" class="Symbol">|</a> <a id="1869" href="Relation.Nullary.Decidable.Core.html#2099" class="InductiveConstructor">yes</a> <a id="1873" href="Ledger.Conway.Foreign.HSLedger.Rewards.html#1873" class="Bound">q</a> <a id="1875" class="Symbol">|</a> <a id="1877" href="Relation.Nullary.Decidable.Core.html#2099" class="InductiveConstructor">yes</a> <a id="1881" href="Ledger.Conway.Foreign.HSLedger.Rewards.html#1881" class="Bound">r</a> <a id="1883" class="Symbol">=</a> <a id="1885" class="Keyword">record</a> <a id="1892" class="Symbol">{</a> <a id="1894" href="Ledger.Conway.Foreign.HSLedger.Rewards.html#1452" class="Module">ru</a>
                                             <a id="1942" class="Symbol">;</a> <a id="1944" href="Ledger.Conway.Specification.Rewards.html#6344" class="Field">rs</a> <a id="1947" class="Symbol">=</a> <a id="1949" href="Foreign.Convertible.html#170" class="Field">from</a> <a id="1954" href="Ledger.Conway.Foreign.HSLedger.Rewards.html#583" class="Field">ru.rs</a>
                                             <a id="2005" class="Symbol">;</a> <a id="2007" href="Ledger.Conway.Specification.Rewards.html#6374" class="Field">flowConservation</a> <a id="2024" class="Symbol">=</a> <a id="2026" href="Ledger.Conway.Foreign.HSLedger.Rewards.html#1865" class="Bound">p</a>
                                             <a id="2073" class="Symbol">;</a> <a id="2075" href="Ledger.Conway.Specification.Rewards.html#6437" class="Field">Δt-nonnegative</a>   <a id="2092" class="Symbol">=</a> <a id="2094" href="Ledger.Conway.Foreign.HSLedger.Rewards.html#1873" class="Bound">q</a>
                                             <a id="2141" class="Symbol">;</a> <a id="2143" href="Ledger.Conway.Specification.Rewards.html#6468" class="Field">Δf-nonpositive</a>   <a id="2160" class="Symbol">=</a> <a id="2162" href="Ledger.Conway.Foreign.HSLedger.Rewards.html#1881" class="Bound">r</a>
                                             <a id="2209" class="Symbol">}</a>
        <a id="2219" href="Ledger.Conway.Foreign.HSLedger.Rewards.html#1699" class="CatchallClause Function">...</a><a id="2222" class="CatchallClause"> </a><a id="2223" class="CatchallClause Symbol">|</a><a id="2224" class="CatchallClause"> </a><a id="2225" class="CatchallClause Symbol">_</a><a id="2226" class="CatchallClause"> </a><a id="2227" class="CatchallClause Symbol">|</a><a id="2228" class="CatchallClause"> </a><a id="2229" class="CatchallClause Symbol">_</a><a id="2230" class="CatchallClause"> </a><a id="2231" class="CatchallClause Symbol">|</a><a id="2232" class="CatchallClause"> </a><a id="2233" class="CatchallClause Symbol">_</a> <a id="2235" class="Symbol">=</a> <a id="2237" href="Ledger.Prelude.Foreign.Util.html#83" class="Postulate">error</a> <a id="2243" class="String">&quot;Formal Spec: cannot make a non-zero reward update&quot;</a>
</pre></body></html>