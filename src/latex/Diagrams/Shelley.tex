\begin{figure}[h!]
  \centering
  \begin{tikzpicture} [
    every node/.style={draw, shape=ellipse, minimum size=6mm, inner sep=2pt},
    every edge/.style={draw, ->, >=Latex, semithick},
    dotted edge/.style={draw, ->, >=Latex, dotted, semithick},
    every loop/.style={looseness=5}
  ]

  % LEVEL 0 (TOP)
  \node (CHAIN) {\small CHAIN};

  % LEVEL -1
  \node (BBODY) [below left=1cm and -2mm of CHAIN] {\small BBODY};
  \node (TICKN) [below right=1cm and 0mm of CHAIN] {\small TICKN};

  % LEVEL -2
  \node (LEDGERS) [below left=1cm and 2cm of BBODY] {\small LEDGERS};
  \node (PRTCL) [below left=1cm and 0mm of TICKN] {\small PRTCL};

  % LEVEL -3
  \node (LEDGER) [below=of LEDGERS] {\small LEDGER};
  \node (TICK) [below left=of PRTCL] {\small TICK};
  \node (OVERLAY) [below=of PRTCL] {\small OVERLAY};
  \node (UPDN) [below right=of PRTCL] {\small UPDN};

  % LEVEL -4
  \node (UTXOW) [below left=1cm and 5mm of LEDGER] {\small UTXOW};
  \node (RUPD) [below=of TICK] {\small RUPD};
  \node (OCERT) [below =8mm of OVERLAY] {\small OCERT};

  % LEVEL -5
  \node (UTXO) [below left=1cm and -2mm of UTXOW] {\small UTXO};
  \node (DELEGS) [below right=1cm and -2mm of UTXOW] {\small DELEGS};
  \node (NEWEPOCH) [below=8mm of RUPD] {\small NEWEPOCH};

  % LEVEL -6
  \node (PPUP) [below=of UTXO] {\small PPUP};
  \node (DELPL) [below=of DELEGS] {\small DELPL};
  \node (MIR) [below right=1cm and 0mm of NEWEPOCH] {\small MIR};

  % LEVEL -7
  \node (DELEG) [below left=1cm and 0mm of DELPL] {\small DELEG};
  \node (POOL) [below right=1cm and 0mm of DELPL] {\small POOL};
  \node (EPOCH) [below left=1cm and 0mm of MIR] {\small EPOCH};

  % LEVEL -8
  \node (NEWPP) [below =of EPOCH] {\small NEWPP};

  % LEVEL -9
  \node (SNAP) [below left=1cm and 2mm of NEWPP] {\small SNAP};
  \node (POOLREAP) [below right=1cm and 0mm of NEWPP] {\small POOLREAP};

  % Edges
  \draw
  (CHAIN)    edge                   (BBODY)
  (CHAIN)    edge [bend right = 50] (TICK)
  (CHAIN)    edge                   (PRTCL)
  (CHAIN)    edge                   (TICKN)
  (TICKN)    edge [dotted edge]     (PRTCL)
  (BBODY)    edge                   (LEDGERS)
  (BBODY)    edge [dotted edge]     (TICK)
  (BBODY)    edge [dotted edge]     (PRTCL)
  (LEDGERS)  edge [bend right]      (LEDGER)
  (PRTCL)    edge [dotted edge]     (TICK)
  (PRTCL)    edge                   (OVERLAY)
  (PRTCL)    edge                   (UPDN)
  (LEDGER)   edge [dotted edge, bend right] (LEDGERS)
  (LEDGER)   edge                   (DELEGS)
  (LEDGER)   edge                   (UTXOW)
  (TICK)     edge                   (RUPD)
  (TICK)     edge [bend right=50]   (NEWEPOCH)
  (OVERLAY)  edge                   (OCERT)
  (UTXOW)    edge [dotted edge]     (DELEGS)
  (UTXOW)    edge                   (UTXO)
  (RUPD)     edge [dotted edge]     (NEWEPOCH)
  (UTXO)     edge                   (PPUP)
  (DELEGS)   edge [bend right]      (DELPL)
  (NEWEPOCH) edge                   (MIR)
  (NEWEPOCH) edge [bend right]      (EPOCH)
  (DELPL)    edge [dotted edge, bend right] (DELEGS)
  (DELPL)    edge                   (DELEG)
  (DELPL)    edge                   (POOL)
  (MIR)      edge [dotted edge]     (EPOCH)
  (EPOCH)    edge                   (NEWPP)
  (EPOCH)    edge [bend right]      (SNAP)
  (EPOCH)    edge [bend left]       (POOLREAP)
  (NEWPP)    edge [dotted edge]     (SNAP)
  (NEWPP)    edge [dotted edge]     (POOLREAP)
  (DELEGS)   edge [loop right]      ()
  (LEDGERS)  edge [loop right]      ();

  \end{tikzpicture}
  \caption{All STS rules, the sub-rules they
    use and possible dependencies (circa Shelley era); each node in the graph represents
    one rule, the top rule being CHAIN; a straight arrow from one node to another one
    represents a sub-rule relationship; the two recursive rules, LEDGERS and DELEGS, have
    self loops; a dotted arrow represents a dependency in the sense that the output of
    the target node is an input to the source node, either as part of the source state,
    the environment or the signal.  In most cases these dependencies are between
    sub-rules of a rule.  In the case of recursive rules, the sub-rule can also have a
    dependency on the super-rule.  Those recursively call themselves while traversing the
    input signal sequence until reaching the base case with an empty input sequence.
  }
  \label{fig:shelley-diagram}
\end{figure}

