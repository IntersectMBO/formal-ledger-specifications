<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>Ledger.Transaction</title><link rel="stylesheet" href="Agda.css"></head><body><pre class="Agda"><a id="1" class="Background">\section{Transactions}
\label{sec:transactions}

</a><a id="50" class="Markup">\begin{code}[hide]</a>
<a id="69" class="Symbol">{-#</a> <a id="73" class="Keyword">OPTIONS</a> <a id="81" class="Pragma">--safe</a> <a id="88" class="Symbol">#-}</a>
<a id="92" class="Comment">--------------------------------------------------------------------------------</a>
<a id="173" class="Comment">-- NOTE: Everything in this module is part of TransactionStructure</a>
<a id="240" class="Comment">--------------------------------------------------------------------------------</a>
<a id="321" class="Keyword">module</a> <a id="328" href="Ledger.Transaction.html" class="Module">Ledger.Transaction</a> <a id="347" class="Keyword">where</a>

<a id="354" class="Keyword">import</a> <a id="361" href="Data.Maybe.Base.html" class="Module">Data.Maybe.Base</a> <a id="377" class="Symbol">as</a> <a id="380" class="Module">M</a>

<a id="383" class="Keyword">open</a> <a id="388" class="Keyword">import</a> <a id="395" href="Ledger.Prelude.html" class="Module">Ledger.Prelude</a> <a id="410" class="Keyword">renaming</a> <a id="419" class="Symbol">(</a><a id="420" href="Ledger.Set.Theory.html#2813" class="Function">filterᵐ</a> <a id="428" class="Symbol">to</a> <a id="431" class="Function">filter</a><a id="437" class="Symbol">)</a>

<a id="440" class="Keyword">open</a> <a id="445" class="Keyword">import</a> <a id="452" href="Ledger.Crypto.html" class="Module">Ledger.Crypto</a>
<a id="466" class="Keyword">open</a> <a id="471" class="Keyword">import</a> <a id="478" href="Ledger.Types.Epoch.html" class="Module">Ledger.Types.Epoch</a>
<a id="497" class="Keyword">open</a> <a id="502" class="Keyword">import</a> <a id="509" href="Ledger.Types.GovStructure.html" class="Module">Ledger.Types.GovStructure</a>
<a id="535" class="Keyword">import</a> <a id="542" href="Ledger.PParams.html" class="Module">Ledger.PParams</a>
<a id="557" class="Keyword">import</a> <a id="564" href="Ledger.Script.html" class="Module">Ledger.Script</a>
<a id="578" class="Keyword">import</a> <a id="585" href="Ledger.GovernanceActions.html" class="Module">Ledger.GovernanceActions</a>
<a id="610" class="Keyword">import</a> <a id="617" href="Ledger.Certs.html" class="Module">Ledger.Certs</a>
<a id="630" class="Keyword">import</a> <a id="637" href="Ledger.TokenAlgebra.html" class="Module">Ledger.TokenAlgebra</a>
<a id="657" class="Keyword">import</a> <a id="664" href="Ledger.Address.html" class="Module">Ledger.Address</a>


<a id="681" class="Keyword">open</a> <a id="686" class="Keyword">import</a> <a id="693" href="Tactic.Derive.DecEq.html" class="Module">Tactic.Derive.DecEq</a>
<a id="713" class="Keyword">open</a> <a id="718" class="Keyword">import</a> <a id="725" href="MyDebugOptions.html" class="Module">MyDebugOptions</a>
<a id="740" class="Keyword">open</a> <a id="745" class="Keyword">import</a> <a id="752" href="Relation.Nullary.Decidable.html" class="Module">Relation.Nullary.Decidable</a> <a id="779" class="Keyword">using</a> <a id="785" class="Symbol">(</a><a id="786" href="Relation.Nullary.Decidable.Core.html#3623" class="Function Operator">⌊_⌋</a><a id="789" class="Symbol">)</a>

<a id="792" class="Keyword">data</a> <a id="Tag"></a><a id="797" href="Ledger.Transaction.html#797" class="Datatype">Tag</a> <a id="801" class="Symbol">:</a> <a id="803" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="808" class="Keyword">where</a>
  <a id="Tag.Spend"></a><a id="816" href="Ledger.Transaction.html#816" class="InductiveConstructor">Spend</a> <a id="Tag.Mint"></a><a id="822" href="Ledger.Transaction.html#822" class="InductiveConstructor">Mint</a> <a id="Tag.Cert"></a><a id="827" href="Ledger.Transaction.html#827" class="InductiveConstructor">Cert</a> <a id="Tag.Rewrd"></a><a id="832" href="Ledger.Transaction.html#832" class="InductiveConstructor">Rewrd</a> <a id="Tag.Vote"></a><a id="838" href="Ledger.Transaction.html#838" class="InductiveConstructor">Vote</a> <a id="Tag.Propose"></a><a id="843" href="Ledger.Transaction.html#843" class="InductiveConstructor">Propose</a> <a id="851" class="Symbol">:</a> <a id="853" href="Ledger.Transaction.html#797" class="Datatype">Tag</a>
<a id="857" class="Keyword">unquoteDecl</a> <a id="DecEq-Tag"></a><a id="869" href="Ledger.Transaction.html#869" class="Function">DecEq-Tag</a> <a id="879" class="Symbol">=</a> <a id="881" href="Tactic.Derive.DecEq.html#3506" class="Function">derive-DecEq</a> <a id="894" class="Symbol">((</a><a id="896" class="Keyword">quote</a> <a id="902" href="Ledger.Transaction.html#797" class="Datatype">Tag</a> <a id="906" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="908" href="Ledger.Transaction.html#869" class="Function">DecEq-Tag</a><a id="917" class="Symbol">)</a> <a id="919" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="921" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a><a id="923" class="Symbol">)</a>

<a id="926" class="Keyword">record</a> <a id="TransactionStructure"></a><a id="933" href="Ledger.Transaction.html#933" class="Record">TransactionStructure</a> <a id="954" class="Symbol">:</a> <a id="956" href="Agda.Primitive.html#388" class="Primitive">Type₁</a> <a id="962" class="Keyword">where</a>
  <a id="970" class="Keyword">field</a>
<a id="976" class="Markup">\end{code}</a><a id="986" class="Background">

Transactions are defined in Figure~\ref{fig:defs:transactions}. A
transaction is made up of a transaction body, a collection of
witnesses and some optional auxiliary data.
\begin{NoConway}
Some key ingredients in the transaction body are:
\begin{itemize}
  \item A set \AgdaField{txins} of transaction inputs, each of which identifies an output from a previous transaction.
    A transaction input consists of a transaction id and an index to uniquely identify the output.
  \item An indexed collection \AgdaField{txouts} of transaction outputs.
    The \TxOut type is an address paired with a coin value.
  \item A transaction fee. This value will be added to the fee pot.
  \item The size \AgdaField{txsize} and the hash \AgdaField{txId} of the serialized form of the transaction that was included in the block.
\end{itemize}
\end{NoConway}
\begin{Conway}
Ingredients of the transaction body introduced in the Conway era are the following:
\begin{itemize}
  \item \AgdaField{txvote}, the list of votes for goverance actions;
  \item \AgdaField{txprop}, the list of governance proposals;
  \item \AgdaField{txdonation}, the treasury donation amount;
  \item \AgdaField{curTreasury}, the current value of the treasury.
\end{itemize}
\end{Conway}

\begin{figure*}[h]
\emph{Abstract types}
\begin{AgdaMultiCode}
</a><a id="2298" class="Markup">\begin{code}</a>
        <a id="TransactionStructure.Ix"></a><a id="2319" href="Ledger.Transaction.html#2319" class="Field">Ix</a> <a id="TransactionStructure.TxId"></a><a id="2322" href="Ledger.Transaction.html#2322" class="Field">TxId</a> <a id="TransactionStructure.AuxiliaryData"></a><a id="2327" href="Ledger.Transaction.html#2327" class="Field">AuxiliaryData</a> <a id="2341" class="Symbol">:</a> <a id="2343" href="Agda.Primitive.html#388" class="Primitive">Type</a>
<a id="2348" class="Markup">\end{code}</a><a id="2358" class="Background">
</a><a id="2359" class="Markup">\begin{code}[hide]</a>
        <a id="2386" class="Symbol">⦃</a> <a id="TransactionStructure.DecEq-Ix"></a><a id="2388" href="Ledger.Transaction.html#2388" class="Field">DecEq-Ix</a>   <a id="2399" class="Symbol">⦄</a> <a id="2401" class="Symbol">:</a> <a id="2403" href="Class.DecEq.Core.html#117" class="Record">DecEq</a> <a id="2409" href="Ledger.Transaction.html#2319" class="Field">Ix</a>
        <a id="2420" class="Symbol">⦃</a> <a id="TransactionStructure.DecEq-TxId"></a><a id="2422" href="Ledger.Transaction.html#2422" class="Field">DecEq-TxId</a> <a id="2433" class="Symbol">⦄</a> <a id="2435" class="Symbol">:</a> <a id="2437" href="Class.DecEq.Core.html#117" class="Record">DecEq</a> <a id="2443" href="Ledger.Transaction.html#2322" class="Field">TxId</a>
        <a id="TransactionStructure.adHashingScheme"></a><a id="2456" href="Ledger.Transaction.html#2456" class="Field">adHashingScheme</a> <a id="2472" class="Symbol">:</a> <a id="2474" href="Ledger.Crypto.html#152" class="Record">isHashableSet</a> <a id="2488" href="Ledger.Transaction.html#2327" class="Field">AuxiliaryData</a>
  <a id="2504" class="Keyword">open</a> <a id="2509" href="Ledger.Crypto.html#152" class="Module">isHashableSet</a> <a id="2523" href="Ledger.Transaction.html#2456" class="Field">adHashingScheme</a> <a id="2539" class="Keyword">renaming</a> <a id="2548" class="Symbol">(</a><a id="2549" href="Ledger.Crypto.html#229" class="Field">THash</a> <a id="2555" class="Symbol">to</a> <a id="2558" class="Field">ADHash</a><a id="2564" class="Symbol">)</a> <a id="2566" class="Keyword">public</a>

  <a id="2576" class="Keyword">field</a> <a id="TransactionStructure.globalConstants"></a><a id="2582" href="Ledger.Transaction.html#2582" class="Field">globalConstants</a> <a id="2598" class="Symbol">:</a> <a id="2600" class="Symbol">_</a>
  <a id="2604" class="Keyword">open</a> <a id="2609" href="Ledger.Types.Epoch.html#1666" class="Module">GlobalConstants</a> <a id="2625" href="Ledger.Transaction.html#2582" class="Field">globalConstants</a> <a id="2641" class="Keyword">public</a>

  <a id="2651" class="Keyword">field</a> <a id="TransactionStructure.crypto"></a><a id="2657" href="Ledger.Transaction.html#2657" class="Field">crypto</a> <a id="2664" class="Symbol">:</a> <a id="2666" class="Symbol">_</a>
  <a id="2670" class="Keyword">open</a> <a id="2675" href="Ledger.Crypto.html#1402" class="Module">Crypto</a> <a id="2682" href="Ledger.Transaction.html#2657" class="Field">crypto</a> <a id="2689" class="Keyword">public</a>
  <a id="2698" class="Keyword">open</a> <a id="2703" href="Ledger.TokenAlgebra.html" class="Module">Ledger.TokenAlgebra</a> <a id="2723" href="Ledger.Crypto.html#1525" class="Function">ScriptHash</a> <a id="2734" class="Keyword">public</a>
  <a id="2743" class="Keyword">open</a> <a id="2748" href="Ledger.Address.html" class="Module">Ledger.Address</a> <a id="2763" href="Ledger.Types.Epoch.html#1705" class="Function">Network</a> <a id="2771" href="Ledger.Crypto.html#1629" class="Function">KeyHash</a> <a id="2779" href="Ledger.Crypto.html#1525" class="Function">ScriptHash</a> <a id="2790" class="Symbol">⦃</a> <a id="2792" href="Function.Base.html#4736" class="Function">it</a> <a id="2795" class="Symbol">⦄</a> <a id="2797" class="Symbol">⦃</a> <a id="2799" href="Function.Base.html#4736" class="Function">it</a> <a id="2802" class="Symbol">⦄</a> <a id="2804" class="Symbol">⦃</a> <a id="2806" href="Function.Base.html#4736" class="Function">it</a> <a id="2809" class="Symbol">⦄</a> <a id="2811" class="Keyword">public</a>

  <a id="2821" class="Keyword">field</a> <a id="TransactionStructure.epochStructure"></a><a id="2827" href="Ledger.Transaction.html#2827" class="Field">epochStructure</a> <a id="2842" class="Symbol">:</a> <a id="2844" class="Symbol">_</a>
  <a id="2848" class="Keyword">open</a> <a id="2853" href="Ledger.Types.Epoch.html#267" class="Module">EpochStructure</a> <a id="2868" href="Ledger.Transaction.html#2827" class="Field">epochStructure</a> <a id="2883" class="Keyword">public</a>
  <a id="2892" class="Keyword">open</a> <a id="2897" href="Ledger.Script.html" class="Module">Ledger.Script</a> <a id="2911" href="Ledger.Transaction.html#2657" class="Field">crypto</a> <a id="2918" href="Ledger.Transaction.html#2827" class="Field">epochStructure</a> <a id="2933" class="Keyword">public</a>

  <a id="2943" class="Keyword">field</a> <a id="TransactionStructure.scriptStructure"></a><a id="2949" href="Ledger.Transaction.html#2949" class="Field">scriptStructure</a> <a id="2965" class="Symbol">:</a> <a id="2967" class="Symbol">_</a>
  <a id="2971" class="Keyword">open</a> <a id="2976" href="Ledger.Script.html#5546" class="Module">ScriptStructure</a> <a id="2992" href="Ledger.Transaction.html#2949" class="Field">scriptStructure</a> <a id="3008" class="Keyword">public</a>
  <a id="3017" class="Keyword">open</a> <a id="3022" href="Ledger.PParams.html" class="Module">Ledger.PParams</a> <a id="3037" href="Ledger.Transaction.html#2657" class="Field">crypto</a> <a id="3044" href="Ledger.Transaction.html#2827" class="Field">epochStructure</a> <a id="3059" href="Ledger.Transaction.html#2949" class="Field">scriptStructure</a> <a id="3075" class="Keyword">public</a>

  <a id="3085" class="Keyword">field</a> <a id="TransactionStructure.govParams"></a><a id="3091" href="Ledger.Transaction.html#3091" class="Field">govParams</a> <a id="3101" class="Symbol">:</a> <a id="3103" class="Symbol">_</a>
  <a id="3107" class="Keyword">open</a> <a id="3112" href="Ledger.PParams.html#15283" class="Module">GovParams</a> <a id="3122" href="Ledger.Transaction.html#3091" class="Field">govParams</a> <a id="3132" class="Keyword">public</a>

  <a id="3142" class="Keyword">field</a> <a id="TransactionStructure.tokenAlgebra"></a><a id="3148" href="Ledger.Transaction.html#3148" class="Field">tokenAlgebra</a> <a id="3161" class="Symbol">:</a> <a id="3163" href="Ledger.TokenAlgebra.html#723" class="Record">TokenAlgebra</a>
  <a id="3178" class="Keyword">open</a> <a id="3183" href="Ledger.TokenAlgebra.html#723" class="Module">TokenAlgebra</a> <a id="3196" href="Ledger.Transaction.html#3148" class="Field">tokenAlgebra</a> <a id="3209" class="Keyword">public</a>

  <a id="3219" class="Keyword">field</a> <a id="TransactionStructure.txidBytes"></a><a id="3225" href="Ledger.Transaction.html#3225" class="Field">txidBytes</a> <a id="3235" class="Symbol">:</a> <a id="3237" href="Ledger.Transaction.html#2322" class="Field">TxId</a> <a id="3242" class="Symbol">→</a> <a id="3244" href="Ledger.Crypto.html#740" class="Function">Ser</a>
        <a id="TransactionStructure.networkId"></a><a id="3256" href="Ledger.Transaction.html#3256" class="Field">networkId</a> <a id="3266" class="Symbol">:</a> <a id="3268" href="Ledger.Types.Epoch.html#1705" class="Function">Network</a>

  <a id="TransactionStructure.govStructure"></a><a id="3279" href="Ledger.Transaction.html#3279" class="Function">govStructure</a> <a id="3292" class="Symbol">:</a> <a id="3294" href="Ledger.Types.GovStructure.html#235" class="Record">GovStructure</a>
  <a id="3309" href="Ledger.Transaction.html#3279" class="Function">govStructure</a> <a id="3322" class="Symbol">=</a> <a id="3324" class="Keyword">record</a>
    <a id="3335" class="Comment">-- TODO: figure out what to do with the hash</a>
    <a id="3384" class="Symbol">{</a> <a id="3386" href="Ledger.Types.GovStructure.html#270" class="Field">TxId</a> <a id="3391" class="Symbol">=</a> <a id="3393" href="Ledger.Transaction.html#2322" class="Field">TxId</a><a id="3397" class="Symbol">;</a> <a id="3399" href="Ledger.Types.GovStructure.html#275" class="Field">DocHash</a> <a id="3407" class="Symbol">=</a> <a id="3409" href="Ledger.Transaction.html#2558" class="Function">ADHash</a>
    <a id="3420" class="Symbol">;</a> <a id="3422" href="Ledger.Types.GovStructure.html#335" class="Field">crypto</a> <a id="3429" class="Symbol">=</a> <a id="3431" href="Ledger.Transaction.html#2657" class="Field">crypto</a>
    <a id="3442" class="Symbol">;</a> <a id="3444" href="Ledger.Types.GovStructure.html#383" class="Field">epochStructure</a> <a id="3459" class="Symbol">=</a> <a id="3461" href="Ledger.Transaction.html#2827" class="Field">epochStructure</a>
    <a id="3480" class="Symbol">;</a> <a id="3482" href="Ledger.Types.GovStructure.html#455" class="Field">scriptStructure</a> <a id="3498" class="Symbol">=</a> <a id="3500" href="Ledger.Transaction.html#2949" class="Field">scriptStructure</a>
    <a id="3520" class="Symbol">;</a> <a id="3522" href="Ledger.Types.GovStructure.html#634" class="Field">govParams</a> <a id="3532" class="Symbol">=</a> <a id="3534" href="Ledger.Transaction.html#3091" class="Field">govParams</a>
    <a id="3548" class="Symbol">;</a> <a id="3550" href="Ledger.Types.GovStructure.html#699" class="Field">globalConstants</a> <a id="3566" class="Symbol">=</a> <a id="3568" href="Ledger.Transaction.html#2582" class="Field">globalConstants</a>
    <a id="3588" class="Symbol">}</a>

  <a id="3593" class="Keyword">open</a> <a id="3598" href="Ledger.GovernanceActions.html" class="Module">Ledger.GovernanceActions</a> <a id="3623" href="Ledger.Transaction.html#3279" class="Function">govStructure</a> <a id="3636" class="Keyword">hiding</a> <a id="3643" class="Symbol">(</a><a id="3644" href="Ledger.GovernanceActions.html#8237" class="Datatype">Vote</a><a id="3648" class="Symbol">;</a> <a id="3650" href="Ledger.GovernanceActions.html#8257" class="InductiveConstructor">yes</a><a id="3653" class="Symbol">;</a> <a id="3655" href="Ledger.GovernanceActions.html#8261" class="InductiveConstructor">no</a><a id="3657" class="Symbol">;</a> <a id="3659" href="Ledger.GovernanceActions.html#8264" class="InductiveConstructor">abstain</a><a id="3666" class="Symbol">)</a> <a id="3668" class="Keyword">public</a>
  <a id="3677" class="Keyword">open</a> <a id="3682" href="Ledger.Certs.html" class="Module">Ledger.Certs</a>             <a id="3707" href="Ledger.Transaction.html#3279" class="Function">govStructure</a> <a id="3720" class="Keyword">public</a>
<a id="3727" class="Markup">\end{code}</a><a id="3737" class="Background">
\begin{NoConway}
\emph{Derived types}
</a><a id="3776" class="Markup">\begin{code}</a>
  <a id="TransactionStructure.TxIn"></a><a id="3791" href="Ledger.Transaction.html#3791" class="Function">TxIn</a>     <a id="3800" class="Symbol">=</a> <a id="3802" href="Ledger.Transaction.html#2322" class="Field">TxId</a> <a id="3807" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="3809" href="Ledger.Transaction.html#2319" class="Field">Ix</a>
  <a id="TransactionStructure.TxOut"></a><a id="3814" href="Ledger.Transaction.html#3814" class="Function">TxOut</a>    <a id="3823" class="Symbol">=</a> <a id="3825" href="Ledger.Address.html#2070" class="Function">Addr</a> <a id="3830" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="3832" href="Ledger.TokenAlgebra.html#816" class="Function">Value</a> <a id="3838" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="3840" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="3846" class="Symbol">(</a><a id="3847" href="Ledger.Script.html#1714" class="Function">Datum</a> <a id="3853" href="Data.Sum.Base.html#625" class="Datatype Operator">⊎</a> <a id="3855" href="Ledger.Script.html#1667" class="Function">DataHash</a><a id="3863" class="Symbol">)</a> <a id="3865" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="3867" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="3873" href="Ledger.Script.html#6019" class="Function">Script</a>
  <a id="TransactionStructure.UTxO"></a><a id="3882" href="Ledger.Transaction.html#3882" class="Function">UTxO</a>     <a id="3891" class="Symbol">=</a> <a id="3893" href="Ledger.Transaction.html#3791" class="Function">TxIn</a> <a id="3898" href="Ledger.Set.Theory.html#1515" class="Function Operator">⇀</a> <a id="3900" href="Ledger.Transaction.html#3814" class="Function">TxOut</a>
  <a id="TransactionStructure.Wdrl"></a><a id="3908" href="Ledger.Transaction.html#3908" class="Function">Wdrl</a>     <a id="3917" class="Symbol">=</a> <a id="3919" href="Ledger.Address.html#1583" class="Record">RwdAddr</a> <a id="3927" href="Ledger.Set.Theory.html#1515" class="Function Operator">⇀</a> <a id="3929" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a>
  <a id="TransactionStructure.RdmrPtr"></a><a id="3936" href="Ledger.Transaction.html#3936" class="Function">RdmrPtr</a>  <a id="3945" class="Symbol">=</a> <a id="3947" href="Ledger.Transaction.html#797" class="Datatype">Tag</a> <a id="3951" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="3953" href="Ledger.Transaction.html#2319" class="Field">Ix</a>

  <a id="TransactionStructure.ProposedPPUpdates"></a><a id="3959" href="Ledger.Transaction.html#3959" class="Function">ProposedPPUpdates</a>  <a id="3978" class="Symbol">=</a> <a id="3980" href="Ledger.Crypto.html#1629" class="Function">KeyHash</a> <a id="3988" href="Ledger.Set.Theory.html#1515" class="Function Operator">⇀</a> <a id="3990" href="Ledger.PParams.html#15381" class="Function">PParamsUpdate</a>
  <a id="TransactionStructure.Update"></a><a id="4006" href="Ledger.Transaction.html#4006" class="Function">Update</a>             <a id="4025" class="Symbol">=</a> <a id="4027" href="Ledger.Transaction.html#3959" class="Function">ProposedPPUpdates</a> <a id="4045" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="4047" href="Ledger.Types.Epoch.html#335" class="Function">Epoch</a>
<a id="4053" class="Markup">\end{code}</a><a id="4063" class="Background">
\end{NoConway}
\emph{Transaction types}
</a><a id="4104" class="Markup">\begin{code}</a>
  <a id="4119" class="Keyword">record</a> <a id="TransactionStructure.TxBody"></a><a id="4126" href="Ledger.Transaction.html#4126" class="Record">TxBody</a> <a id="4133" class="Symbol">:</a> <a id="4135" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="4140" class="Keyword">where</a>
<a id="4146" class="Markup">\end{code}</a><a id="4156" class="Background">
</a><a id="4157" class="Markup">\begin{code}[hide]</a>
    <a id="4180" class="Keyword">field</a>
<a id="4186" class="Markup">\end{code}</a><a id="4196" class="Background">
</a><a id="4197" class="Markup">\begin{code}</a>
      <a id="4216" href="Ledger.Transaction.html#4216" class="Field">txins</a>          <a id="4231" class="Symbol">:</a> <a id="4233" href="Ledger.Set.Theory.html#382" class="Function Operator">ℙ</a> <a id="4235" href="Ledger.Transaction.html#3791" class="Function">TxIn</a>
      <a id="4246" href="Ledger.Transaction.html#4246" class="Field">refInputs</a>      <a id="4261" class="Symbol">:</a> <a id="4263" href="Ledger.Set.Theory.html#382" class="Function Operator">ℙ</a> <a id="4265" href="Ledger.Transaction.html#3791" class="Function">TxIn</a>
      <a id="4276" href="Ledger.Transaction.html#4276" class="Field">txouts</a>         <a id="4291" class="Symbol">:</a> <a id="4293" href="Ledger.Transaction.html#2319" class="Field">Ix</a> <a id="4296" href="Ledger.Set.Theory.html#1515" class="Function Operator">⇀</a> <a id="4298" href="Ledger.Transaction.html#3814" class="Function">TxOut</a>
      <a id="4310" href="Ledger.Transaction.html#4310" class="Field">txfee</a>          <a id="4325" class="Symbol">:</a> <a id="4327" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a>
      <a id="4338" href="Ledger.Transaction.html#4338" class="Field">mint</a>           <a id="4353" class="Symbol">:</a> <a id="4355" href="Ledger.TokenAlgebra.html#816" class="Function">Value</a>
      <a id="4367" href="Ledger.Transaction.html#4367" class="Field">txvldt</a>         <a id="4382" class="Symbol">:</a> <a id="4384" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="4390" href="Ledger.Types.Epoch.html#382" class="Function">Slot</a> <a id="4395" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="4397" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="4403" href="Ledger.Types.Epoch.html#382" class="Function">Slot</a>
      <a id="4414" href="Ledger.Transaction.html#4414" class="Field">txcerts</a>        <a id="4429" class="Symbol">:</a> <a id="4431" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="4436" href="Ledger.Certs.html#1056" class="Datatype">DCert</a>
      <a id="4448" href="Ledger.Transaction.html#4448" class="Field">txwdrls</a>        <a id="4463" class="Symbol">:</a> <a id="4465" href="Ledger.Transaction.html#3908" class="Function">Wdrl</a>
      <a id="4476" href="Ledger.Transaction.html#4476" class="Field">txvote</a>         <a id="4491" class="Symbol">:</a> <a id="4493" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="4498" href="Ledger.GovernanceActions.html#8288" class="Record">GovVote</a>
      <a id="4512" href="Ledger.Transaction.html#4512" class="Field">txprop</a>         <a id="4527" class="Symbol">:</a> <a id="4529" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="4534" href="Ledger.GovernanceActions.html#8487" class="Record">GovProposal</a>
      <a id="4552" href="Ledger.Transaction.html#4552" class="Field">txdonation</a>     <a id="4567" class="Symbol">:</a> <a id="4569" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a>
      <a id="4580" href="Ledger.Transaction.html#4580" class="Field">txup</a>           <a id="4595" class="Symbol">:</a> <a id="4597" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="4603" href="Ledger.Transaction.html#4006" class="Function">Update</a>
      <a id="4616" href="Ledger.Transaction.html#4616" class="Field">txADhash</a>       <a id="4631" class="Symbol">:</a> <a id="4633" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="4639" href="Ledger.Transaction.html#2558" class="Function">ADHash</a>
      <a id="4652" href="Ledger.Transaction.html#4652" class="Field">txNetworkId</a>    <a id="4667" class="Symbol">:</a> <a id="4669" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="4675" href="Ledger.Types.Epoch.html#1705" class="Function">Network</a>
      <a id="4689" href="Ledger.Transaction.html#4689" class="Field">curTreasury</a>    <a id="4704" class="Symbol">:</a> <a id="4706" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="4712" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a>
      <a id="4723" href="Ledger.Transaction.html#4723" class="Field">txsize</a>         <a id="4738" class="Symbol">:</a> <a id="4740" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a>
      <a id="4748" href="Ledger.Transaction.html#4748" class="Field">txid</a>           <a id="4763" class="Symbol">:</a> <a id="4765" href="Ledger.Transaction.html#2322" class="Field">TxId</a>
      <a id="4776" href="Ledger.Transaction.html#4776" class="Field">collateral</a>     <a id="4791" class="Symbol">:</a> <a id="4793" href="Ledger.Set.Theory.html#382" class="Function Operator">ℙ</a> <a id="4795" href="Ledger.Transaction.html#3791" class="Function">TxIn</a>
      <a id="4806" href="Ledger.Transaction.html#4806" class="Field">reqSigHash</a>     <a id="4821" class="Symbol">:</a> <a id="4823" href="Ledger.Set.Theory.html#382" class="Function Operator">ℙ</a> <a id="4825" href="Ledger.Crypto.html#1629" class="Function">KeyHash</a>
      <a id="4839" href="Ledger.Transaction.html#4839" class="Field">scriptIntHash</a>  <a id="4854" class="Symbol">:</a> <a id="4856" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="4862" href="Ledger.Crypto.html#1525" class="Function">ScriptHash</a>
<a id="4873" class="Markup">\end{code}</a><a id="4883" class="Background">
\begin{NoConway}
</a><a id="4901" class="Markup">\begin{code}</a>
  <a id="4916" class="Keyword">record</a> <a id="TransactionStructure.TxWitnesses"></a><a id="4923" href="Ledger.Transaction.html#4923" class="Record">TxWitnesses</a> <a id="4935" class="Symbol">:</a> <a id="4937" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="4942" class="Keyword">where</a>
<a id="4948" class="Markup">\end{code}</a><a id="4958" class="Background">
</a><a id="4959" class="Markup">\begin{code}[hide]</a>
    <a id="4982" class="Keyword">field</a>
<a id="4988" class="Markup">\end{code}</a><a id="4998" class="Background">
</a><a id="4999" class="Markup">\begin{code}</a>
      <a id="5018" href="Ledger.Transaction.html#5018" class="Field">vkSigs</a>   <a id="5027" class="Symbol">:</a> <a id="5029" href="Ledger.Crypto.html#731" class="Function">VKey</a> <a id="5034" href="Ledger.Set.Theory.html#1515" class="Function Operator">⇀</a> <a id="5036" href="Ledger.Crypto.html#736" class="Function">Sig</a>
      <a id="5046" href="Ledger.Transaction.html#5046" class="Field">scripts</a>  <a id="5055" class="Symbol">:</a> <a id="5057" href="Ledger.Set.Theory.html#382" class="Function Operator">ℙ</a> <a id="5059" href="Ledger.Script.html#6019" class="Function">Script</a>
      <a id="5072" href="Ledger.Transaction.html#5072" class="Field">txdats</a>   <a id="5081" class="Symbol">:</a> <a id="5083" href="Ledger.Script.html#1667" class="Function">DataHash</a> <a id="5092" href="Ledger.Set.Theory.html#1515" class="Function Operator">⇀</a> <a id="5094" href="Ledger.Script.html#1714" class="Function">Datum</a>
      <a id="5106" href="Ledger.Transaction.html#5106" class="Field">txrdmrs</a>  <a id="5115" class="Symbol">:</a> <a id="5117" href="Ledger.Transaction.html#3936" class="Function">RdmrPtr</a>  <a id="5126" href="Ledger.Set.Theory.html#1515" class="Function Operator">⇀</a> <a id="5128" href="Ledger.Script.html#1732" class="Function">Redeemer</a> <a id="5137" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="5139" href="Ledger.Script.html#1096" class="Function">ExUnits</a>

    <a id="TransactionStructure.TxWitnesses.scriptsP1"></a><a id="5152" href="Ledger.Transaction.html#5152" class="Function">scriptsP1</a> <a id="5162" class="Symbol">:</a> <a id="5164" href="Ledger.Set.Theory.html#382" class="Function Operator">ℙ</a> <a id="5166" href="Ledger.Script.html#720" class="Function">P1Script</a>
    <a id="5179" href="Ledger.Transaction.html#5152" class="Function">scriptsP1</a> <a id="5189" class="Symbol">=</a> <a id="5191" href="Axiom.Set.html#7518" class="Function">mapPartial</a> <a id="5202" href="Data.Sum.html#973" class="Function">isInj₁</a> <a id="5209" href="Ledger.Transaction.html#5046" class="Field">scripts</a>

  <a id="5220" class="Keyword">record</a> <a id="TransactionStructure.Tx"></a><a id="5227" href="Ledger.Transaction.html#5227" class="Record">Tx</a> <a id="5230" class="Symbol">:</a> <a id="5232" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="5237" class="Keyword">where</a>
<a id="5243" class="Markup">\end{code}</a><a id="5253" class="Background">
</a><a id="5254" class="Markup">\begin{code}[hide]</a>
    <a id="5277" class="Keyword">field</a>
<a id="5283" class="Markup">\end{code}</a><a id="5293" class="Background">
</a><a id="5294" class="Markup">\begin{code}</a>
      <a id="5313" href="Ledger.Transaction.html#5313" class="Field">body</a>     <a id="5322" class="Symbol">:</a> <a id="5324" href="Ledger.Transaction.html#4126" class="Record">TxBody</a>
      <a id="5337" href="Ledger.Transaction.html#5337" class="Field">wits</a>     <a id="5346" class="Symbol">:</a> <a id="5348" href="Ledger.Transaction.html#4923" class="Record">TxWitnesses</a>
      <a id="5366" href="Ledger.Transaction.html#5366" class="Field">isValid</a>  <a id="5375" class="Symbol">:</a> <a id="5377" href="Agda.Builtin.Bool.html#173" class="Datatype">Bool</a>
      <a id="5388" href="Ledger.Transaction.html#5388" class="Field">txAD</a>     <a id="5397" class="Symbol">:</a> <a id="5399" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="5405" href="Ledger.Transaction.html#2327" class="Field">AuxiliaryData</a>
<a id="5419" class="Markup">\end{code}</a><a id="5429" class="Background">
\end{NoConway}
\end{AgdaMultiCode}
\caption{Transactions and related types}
\label{fig:defs:transactions}
\end{figure*}

\begin{NoConway}
\begin{figure*}[h]
\begin{AgdaMultiCode}
</a><a id="5609" class="Markup">\begin{code}</a>
  <a id="TransactionStructure.getValue"></a><a id="5624" href="Ledger.Transaction.html#5624" class="Function">getValue</a> <a id="5633" class="Symbol">:</a> <a id="5635" href="Ledger.Transaction.html#3814" class="Function">TxOut</a> <a id="5641" class="Symbol">→</a> <a id="5643" href="Ledger.TokenAlgebra.html#816" class="Function">Value</a>
  <a id="5651" href="Ledger.Transaction.html#5624" class="Function">getValue</a> <a id="5660" class="Symbol">(_</a> <a id="5663" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5665" href="Ledger.Transaction.html#5665" class="Bound">v</a> <a id="5667" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5669" class="Symbol">_)</a> <a id="5672" class="Symbol">=</a> <a id="5674" href="Ledger.Transaction.html#5665" class="Bound">v</a>

  <a id="TransactionStructure.TxOutʰ"></a><a id="5679" href="Ledger.Transaction.html#5679" class="Function">TxOutʰ</a> <a id="5686" class="Symbol">=</a> <a id="5688" href="Ledger.Address.html#2070" class="Function">Addr</a> <a id="5693" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="5695" href="Ledger.TokenAlgebra.html#816" class="Function">Value</a> <a id="5701" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="5703" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="5709" class="Symbol">(</a><a id="5710" href="Ledger.Script.html#1714" class="Function">Datum</a> <a id="5716" href="Data.Sum.Base.html#625" class="Datatype Operator">⊎</a> <a id="5718" href="Ledger.Script.html#1667" class="Function">DataHash</a><a id="5726" class="Symbol">)</a> <a id="5728" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="5730" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="5736" href="Ledger.Crypto.html#1525" class="Function">ScriptHash</a>

  <a id="TransactionStructure.txOutHash"></a><a id="5750" href="Ledger.Transaction.html#5750" class="Function">txOutHash</a> <a id="5760" class="Symbol">:</a> <a id="5762" href="Ledger.Transaction.html#3814" class="Function">TxOut</a> <a id="5768" class="Symbol">→</a> <a id="5770" href="Ledger.Transaction.html#5679" class="Function">TxOutʰ</a>
  <a id="5779" href="Ledger.Transaction.html#5750" class="Function">txOutHash</a> <a id="5789" class="Symbol">(</a><a id="5790" href="Ledger.Transaction.html#5790" class="Bound">a</a> <a id="5792" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5794" href="Ledger.Transaction.html#5794" class="Bound">v</a> <a id="5796" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5798" href="Ledger.Transaction.html#5798" class="Bound">d</a> <a id="5800" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5802" href="Ledger.Transaction.html#5802" class="Bound">s</a><a id="5803" class="Symbol">)</a> <a id="5805" class="Symbol">=</a> <a id="5807" href="Ledger.Transaction.html#5790" class="Bound">a</a> <a id="5809" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5811" class="Symbol">(</a><a id="5812" href="Ledger.Transaction.html#5794" class="Bound">v</a> <a id="5814" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5816" class="Symbol">(</a><a id="5817" href="Ledger.Transaction.html#5798" class="Bound">d</a> <a id="5819" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5821" href="Data.Maybe.Base.html#2049" class="Function">M.map</a> <a id="5827" href="Interface.Hashable.html#256" class="Field">hash</a> <a id="5832" href="Ledger.Transaction.html#5802" class="Bound">s</a><a id="5833" class="Symbol">))</a>

  <a id="TransactionStructure.getValueʰ"></a><a id="5839" href="Ledger.Transaction.html#5839" class="Function">getValueʰ</a> <a id="5849" class="Symbol">:</a> <a id="5851" href="Ledger.Transaction.html#5679" class="Function">TxOutʰ</a> <a id="5858" class="Symbol">→</a> <a id="5860" href="Ledger.TokenAlgebra.html#816" class="Function">Value</a>
  <a id="5868" href="Ledger.Transaction.html#5839" class="Function">getValueʰ</a> <a id="5878" class="Symbol">(_</a> <a id="5881" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5883" href="Ledger.Transaction.html#5883" class="Bound">v</a> <a id="5885" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5887" class="Symbol">_)</a> <a id="5890" class="Symbol">=</a> <a id="5892" href="Ledger.Transaction.html#5883" class="Bound">v</a>

  <a id="TransactionStructure.txinsVKey"></a><a id="5897" href="Ledger.Transaction.html#5897" class="Function">txinsVKey</a> <a id="5907" class="Symbol">:</a> <a id="5909" href="Ledger.Set.Theory.html#382" class="Function Operator">ℙ</a> <a id="5911" href="Ledger.Transaction.html#3791" class="Function">TxIn</a> <a id="5916" class="Symbol">→</a> <a id="5918" href="Ledger.Transaction.html#3882" class="Function">UTxO</a> <a id="5923" class="Symbol">→</a> <a id="5925" href="Ledger.Set.Theory.html#382" class="Function Operator">ℙ</a> <a id="5927" href="Ledger.Transaction.html#3791" class="Function">TxIn</a>
  <a id="5934" href="Ledger.Transaction.html#5897" class="Function">txinsVKey</a> <a id="5944" href="Ledger.Transaction.html#5944" class="Bound">txins</a> <a id="5950" href="Ledger.Transaction.html#5950" class="Bound">utxo</a> <a id="5955" class="Symbol">=</a> <a id="5957" href="Ledger.Transaction.html#5944" class="Bound">txins</a> <a id="5963" href="Axiom.Set.html#9005" class="Function Operator">∩</a> <a id="5965" href="Interface.IsSet.html#934" class="Function">dom</a> <a id="5969" class="Symbol">(</a><a id="5970" href="Ledger.Transaction.html#5950" class="Bound">utxo</a> <a id="5975" href="Ledger.Set.Theory.html#3006" class="Function Operator">∣^&#39;</a> <a id="5979" class="Symbol">(</a><a id="5980" href="Ledger.Address.html#2407" class="Function">isVKeyAddr</a> <a id="5991" href="Function.Base.html#1115" class="Function Operator">∘</a> <a id="5993" href="Data.Product.Base.html#636" class="Field">proj₁</a><a id="5998" class="Symbol">))</a>

  <a id="TransactionStructure.scriptOuts"></a><a id="6004" href="Ledger.Transaction.html#6004" class="Function">scriptOuts</a> <a id="6015" class="Symbol">:</a> <a id="6017" href="Ledger.Transaction.html#3882" class="Function">UTxO</a> <a id="6022" class="Symbol">→</a> <a id="6024" href="Ledger.Transaction.html#3882" class="Function">UTxO</a>
  <a id="6031" href="Ledger.Transaction.html#6004" class="Function">scriptOuts</a> <a id="6042" href="Ledger.Transaction.html#6042" class="Bound">utxo</a> <a id="6047" class="Symbol">=</a> <a id="6049" href="Ledger.Transaction.html#431" class="Function">filter</a> <a id="6056" class="Symbol">(λ</a> <a id="6059" class="Symbol">(_</a> <a id="6062" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="6064" href="Ledger.Transaction.html#6064" class="Bound">addr</a> <a id="6069" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="6071" class="Symbol">_)</a> <a id="6074" class="Symbol">→</a> <a id="6076" href="Ledger.Address.html#2435" class="Function">isScriptAddr</a> <a id="6089" href="Ledger.Transaction.html#6064" class="Bound">addr</a><a id="6093" class="Symbol">)</a> <a id="6095" href="Ledger.Transaction.html#6042" class="Bound">utxo</a>

  <a id="TransactionStructure.txinsScript"></a><a id="6103" href="Ledger.Transaction.html#6103" class="Function">txinsScript</a> <a id="6115" class="Symbol">:</a> <a id="6117" href="Ledger.Set.Theory.html#382" class="Function Operator">ℙ</a> <a id="6119" href="Ledger.Transaction.html#3791" class="Function">TxIn</a> <a id="6124" class="Symbol">→</a> <a id="6126" href="Ledger.Transaction.html#3882" class="Function">UTxO</a> <a id="6131" class="Symbol">→</a> <a id="6133" href="Ledger.Set.Theory.html#382" class="Function Operator">ℙ</a> <a id="6135" href="Ledger.Transaction.html#3791" class="Function">TxIn</a>
  <a id="6142" href="Ledger.Transaction.html#6103" class="Function">txinsScript</a> <a id="6154" href="Ledger.Transaction.html#6154" class="Bound">txins</a> <a id="6160" href="Ledger.Transaction.html#6160" class="Bound">utxo</a> <a id="6165" class="Symbol">=</a> <a id="6167" href="Ledger.Transaction.html#6154" class="Bound">txins</a> <a id="6173" href="Axiom.Set.html#9005" class="Function Operator">∩</a> <a id="6175" href="Interface.IsSet.html#934" class="Function">dom</a> <a id="6179" class="Symbol">(</a><a id="6180" href="Data.Product.Base.html#636" class="Field">proj₁</a> <a id="6186" class="Symbol">(</a><a id="6187" href="Ledger.Transaction.html#6004" class="Function">scriptOuts</a> <a id="6198" href="Ledger.Transaction.html#6160" class="Bound">utxo</a><a id="6202" class="Symbol">))</a>

  <a id="TransactionStructure.refScripts"></a><a id="6208" href="Ledger.Transaction.html#6208" class="Function">refScripts</a> <a id="6219" class="Symbol">:</a> <a id="6221" href="Ledger.Transaction.html#5227" class="Record">Tx</a> <a id="6224" class="Symbol">→</a> <a id="6226" href="Ledger.Transaction.html#3882" class="Function">UTxO</a> <a id="6231" class="Symbol">→</a> <a id="6233" href="Ledger.Set.Theory.html#382" class="Function Operator">ℙ</a> <a id="6235" href="Ledger.Script.html#6019" class="Function">Script</a>
  <a id="6244" href="Ledger.Transaction.html#6208" class="Function">refScripts</a> <a id="6255" href="Ledger.Transaction.html#6255" class="Bound">tx</a> <a id="6258" href="Ledger.Transaction.html#6258" class="Bound">utxo</a> <a id="6263" class="Symbol">=</a>
    <a id="6269" href="Axiom.Set.html#7518" class="Function">mapPartial</a> <a id="6280" class="Symbol">(</a><a id="6281" href="Data.Product.Base.html#650" class="Field">proj₂</a> <a id="6287" href="Function.Base.html#1115" class="Function Operator">∘</a> <a id="6289" href="Data.Product.Base.html#650" class="Field">proj₂</a> <a id="6295" href="Function.Base.html#1115" class="Function Operator">∘</a> <a id="6297" href="Data.Product.Base.html#650" class="Field">proj₂</a><a id="6302" class="Symbol">)</a> <a id="6304" class="Symbol">(</a><a id="6305" href="Interface.IsSet.html#977" class="Function">range</a> <a id="6311" class="Symbol">(</a><a id="6312" href="Ledger.Transaction.html#6258" class="Bound">utxo</a> <a id="6317" href="Axiom.Set.Map.html#10107" class="Function Operator">∣</a> <a id="6319" class="Symbol">(</a><a id="6320" href="Ledger.Transaction.html#4216" class="Function">txins</a> <a id="6326" href="Axiom.Set.html#8665" class="Function Operator">∪</a> <a id="6328" href="Ledger.Transaction.html#4246" class="Function">refInputs</a><a id="6337" class="Symbol">)))</a>
    <a id="6345" class="Keyword">where</a> <a id="6351" class="Keyword">open</a> <a id="6356" href="Ledger.Transaction.html#5227" class="Module">Tx</a><a id="6358" class="Symbol">;</a> <a id="6360" class="Keyword">open</a> <a id="6365" href="Ledger.Transaction.html#4126" class="Module">TxBody</a> <a id="6372" class="Symbol">(</a><a id="6373" href="Ledger.Transaction.html#6255" class="Bound">tx</a> <a id="6376" class="Symbol">.</a><a id="6377" href="Ledger.Transaction.html#5313" class="Field">body</a><a id="6381" class="Symbol">)</a>

  <a id="TransactionStructure.txscripts"></a><a id="6386" href="Ledger.Transaction.html#6386" class="Function">txscripts</a> <a id="6396" class="Symbol">:</a> <a id="6398" href="Ledger.Transaction.html#5227" class="Record">Tx</a> <a id="6401" class="Symbol">→</a> <a id="6403" href="Ledger.Transaction.html#3882" class="Function">UTxO</a> <a id="6408" class="Symbol">→</a> <a id="6410" href="Ledger.Set.Theory.html#382" class="Function Operator">ℙ</a> <a id="6412" href="Ledger.Script.html#6019" class="Function">Script</a>
  <a id="6421" href="Ledger.Transaction.html#6386" class="Function">txscripts</a> <a id="6431" href="Ledger.Transaction.html#6431" class="Bound">tx</a> <a id="6434" href="Ledger.Transaction.html#6434" class="Bound">utxo</a> <a id="6439" class="Symbol">=</a> <a id="6441" href="Ledger.Transaction.html#5046" class="Field">scripts</a> <a id="6449" class="Symbol">(</a><a id="6450" href="Ledger.Transaction.html#6431" class="Bound">tx</a> <a id="6453" class="Symbol">.</a><a id="6454" href="Ledger.Transaction.html#5337" class="Field">wits</a><a id="6458" class="Symbol">)</a> <a id="6460" href="Axiom.Set.html#8665" class="Function Operator">∪</a> <a id="6462" href="Ledger.Transaction.html#6208" class="Function">refScripts</a> <a id="6473" href="Ledger.Transaction.html#6431" class="Bound">tx</a> <a id="6476" href="Ledger.Transaction.html#6434" class="Bound">utxo</a>
    <a id="6485" class="Keyword">where</a> <a id="6491" class="Keyword">open</a> <a id="6496" href="Ledger.Transaction.html#5227" class="Module">Tx</a><a id="6498" class="Symbol">;</a> <a id="6500" class="Keyword">open</a> <a id="6505" href="Ledger.Transaction.html#4923" class="Module">TxWitnesses</a>

  <a id="TransactionStructure.lookupScriptHash"></a><a id="6520" href="Ledger.Transaction.html#6520" class="Function">lookupScriptHash</a> <a id="6537" class="Symbol">:</a> <a id="6539" href="Ledger.Crypto.html#1525" class="Function">ScriptHash</a> <a id="6550" class="Symbol">→</a> <a id="6552" href="Ledger.Transaction.html#5227" class="Record">Tx</a> <a id="6555" class="Symbol">→</a> <a id="6557" href="Ledger.Transaction.html#3882" class="Function">UTxO</a> <a id="6562" class="Symbol">→</a> <a id="6564" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="6570" href="Ledger.Script.html#6019" class="Function">Script</a>
  <a id="6579" href="Ledger.Transaction.html#6520" class="Function">lookupScriptHash</a> <a id="6596" href="Ledger.Transaction.html#6596" class="Bound">sh</a> <a id="6599" href="Ledger.Transaction.html#6599" class="Bound">tx</a> <a id="6602" href="Ledger.Transaction.html#6602" class="Bound">utxo</a> <a id="6607" class="Symbol">=</a>
    <a id="6613" href="Interface.ToBool.html#287" class="Function Operator">if</a> <a id="6616" href="Ledger.Transaction.html#6596" class="Bound">sh</a> <a id="6619" href="Interface.IsSet.html#476" class="Function Operator">∈</a> <a id="6621" href="Ledger.Set.Theory.html#413" class="Function">mapˢ</a> <a id="6626" href="Data.Product.Base.html#636" class="Field">proj₁</a> <a id="6632" class="Symbol">(</a><a id="6633" href="Ledger.Transaction.html#6702" class="Function">m</a> <a id="6635" href="Axiom.Set.Map.html#2282" class="Function Operator">ˢ</a><a id="6636" class="Symbol">)</a> <a id="6638" href="Interface.ToBool.html#287" class="Function Operator">then</a>
      <a id="6649" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="6654" class="Symbol">(</a><a id="6655" href="Axiom.Set.Map.html#12498" class="Function">lookupᵐ</a> <a id="6663" href="Ledger.Transaction.html#6702" class="Function">m</a> <a id="6665" href="Ledger.Transaction.html#6596" class="Bound">sh</a><a id="6667" class="Symbol">)</a>
    <a id="6673" href="Interface.ToBool.html#287" class="Function Operator">else</a>
      <a id="6684" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a>
    <a id="6696" class="Keyword">where</a> <a id="6702" href="Ledger.Transaction.html#6702" class="Function">m</a> <a id="6704" class="Symbol">=</a> <a id="6706" href="Ledger.Set.HashMap.html#295" class="Function">setToHashMap</a> <a id="6719" class="Symbol">(</a><a id="6720" href="Ledger.Transaction.html#6386" class="Function">txscripts</a> <a id="6730" href="Ledger.Transaction.html#6599" class="Bound">tx</a> <a id="6733" href="Ledger.Transaction.html#6602" class="Bound">utxo</a><a id="6737" class="Symbol">)</a>
<a id="6739" class="Markup">\end{code}</a><a id="6749" class="Background">
\end{AgdaMultiCode}
\caption{Functions related to transactions}
\label{fig:defs:transaction-funs}
\end{figure*}
\end{NoConway}

</a><a id="6878" class="Markup">\begin{code}[hide]</a>
  <a id="TransactionStructure.isP2Script"></a><a id="6899" href="Ledger.Transaction.html#6899" class="Function">isP2Script</a> <a id="6910" class="Symbol">:</a> <a id="6912" href="Ledger.Script.html#6019" class="Function">Script</a> <a id="6919" class="Symbol">→</a> <a id="6921" href="Agda.Builtin.Bool.html#173" class="Datatype">Bool</a>
  <a id="6928" href="Ledger.Transaction.html#6899" class="Function">isP2Script</a> <a id="6939" class="Symbol">=</a> <a id="6941" href="Data.Maybe.Base.html#1110" class="Function">is-just</a> <a id="6949" href="Function.Base.html#1115" class="Function Operator">∘</a> <a id="6951" href="Data.Sum.html#1056" class="Function">isInj₂</a>

  <a id="6961" class="Keyword">instance</a>
    <a id="TransactionStructure.HasCoin-TxOut"></a><a id="6974" href="Ledger.Transaction.html#6974" class="Function">HasCoin-TxOut</a> <a id="6988" class="Symbol">:</a> <a id="6990" href="Ledger.Interface.HasCoin.html#124" class="Record">HasCoin</a> <a id="6998" href="Ledger.Transaction.html#3814" class="Function">TxOut</a>
    <a id="7008" href="Ledger.Transaction.html#6974" class="Function">HasCoin-TxOut</a> <a id="7022" class="Symbol">.</a><a id="7023" href="Ledger.Interface.HasCoin.html#172" class="Field">getCoin</a> <a id="7031" class="Symbol">=</a> <a id="7033" href="Ledger.TokenAlgebra.html#1233" class="Function">coin</a> <a id="7038" href="Function.Base.html#1115" class="Function Operator">∘</a> <a id="7040" href="Data.Product.Base.html#636" class="Field">proj₁</a> <a id="7046" href="Function.Base.html#1115" class="Function Operator">∘</a> <a id="7048" href="Data.Product.Base.html#650" class="Field">proj₂</a>

<a id="7055" class="Markup">\end{code}</a><a id="7065" class="Background">
</a></pre></body></html>