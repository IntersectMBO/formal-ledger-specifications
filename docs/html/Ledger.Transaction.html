<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>Ledger.Transaction</title><link rel="stylesheet" href="Agda.css"></head><body><pre class="Agda"><a id="1" class="Background">\section{Transactions}
\label{sec:transactions}

</a><a id="50" class="Markup">\begin{code}[hide]</a>
<a id="69" class="Symbol">{-#</a> <a id="73" class="Keyword">OPTIONS</a> <a id="81" class="Pragma">--safe</a> <a id="88" class="Symbol">#-}</a>
<a id="92" class="Comment">--------------------------------------------------------------------------------</a>
<a id="173" class="Comment">-- NOTE: Everything in this module is part of TransactionStructure</a>
<a id="240" class="Comment">--------------------------------------------------------------------------------</a>
<a id="321" class="Keyword">module</a> <a id="328" href="Ledger.Transaction.html" class="Module">Ledger.Transaction</a> <a id="347" class="Keyword">where</a>

<a id="354" class="Keyword">import</a> <a id="361" href="Data.Maybe.Base.html" class="Module">Data.Maybe.Base</a> <a id="377" class="Symbol">as</a> <a id="380" class="Module">M</a>

<a id="383" class="Keyword">open</a> <a id="388" class="Keyword">import</a> <a id="395" href="Ledger.Prelude.html" class="Module">Ledger.Prelude</a> <a id="410" class="Keyword">renaming</a> <a id="419" class="Symbol">(</a><a id="420" href="Ledger.Set.Theory.html#2813" class="Function">filterᵐ</a> <a id="428" class="Symbol">to</a> <a id="431" class="Function">filter</a><a id="437" class="Symbol">)</a>

<a id="440" class="Keyword">open</a> <a id="445" class="Keyword">import</a> <a id="452" href="Ledger.Crypto.html" class="Module">Ledger.Crypto</a>
<a id="466" class="Keyword">open</a> <a id="471" class="Keyword">import</a> <a id="478" href="Ledger.Types.Epoch.html" class="Module">Ledger.Types.Epoch</a>
<a id="497" class="Keyword">open</a> <a id="502" class="Keyword">import</a> <a id="509" href="Ledger.Types.GovStructure.html" class="Module">Ledger.Types.GovStructure</a>
<a id="535" class="Keyword">import</a> <a id="542" href="Ledger.PParams.html" class="Module">Ledger.PParams</a>
<a id="557" class="Keyword">import</a> <a id="564" href="Ledger.Script.html" class="Module">Ledger.Script</a>
<a id="578" class="Keyword">import</a> <a id="585" href="Ledger.GovernanceActions.html" class="Module">Ledger.GovernanceActions</a>
<a id="610" class="Keyword">import</a> <a id="617" href="Ledger.Certs.html" class="Module">Ledger.Certs</a>
<a id="630" class="Keyword">import</a> <a id="637" href="Ledger.Certs.Haskell.html" class="Module">Ledger.Certs.Haskell</a>
<a id="658" class="Keyword">import</a> <a id="665" href="Ledger.TokenAlgebra.html" class="Module">Ledger.TokenAlgebra</a>
<a id="685" class="Keyword">import</a> <a id="692" href="Ledger.Address.html" class="Module">Ledger.Address</a>


<a id="709" class="Keyword">open</a> <a id="714" class="Keyword">import</a> <a id="721" href="Tactic.Derive.DecEq.html" class="Module">Tactic.Derive.DecEq</a>
<a id="741" class="Keyword">open</a> <a id="746" class="Keyword">import</a> <a id="753" href="MyDebugOptions.html" class="Module">MyDebugOptions</a>
<a id="768" class="Keyword">open</a> <a id="773" class="Keyword">import</a> <a id="780" href="Relation.Nullary.Decidable.html" class="Module">Relation.Nullary.Decidable</a> <a id="807" class="Keyword">using</a> <a id="813" class="Symbol">(</a><a id="814" href="Relation.Nullary.Decidable.Core.html#3623" class="Function Operator">⌊_⌋</a><a id="817" class="Symbol">)</a>

<a id="820" class="Keyword">data</a> <a id="Tag"></a><a id="825" href="Ledger.Transaction.html#825" class="Datatype">Tag</a> <a id="829" class="Symbol">:</a> <a id="831" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="836" class="Keyword">where</a>
  <a id="Tag.Spend"></a><a id="844" href="Ledger.Transaction.html#844" class="InductiveConstructor">Spend</a> <a id="Tag.Mint"></a><a id="850" href="Ledger.Transaction.html#850" class="InductiveConstructor">Mint</a> <a id="Tag.Cert"></a><a id="855" href="Ledger.Transaction.html#855" class="InductiveConstructor">Cert</a> <a id="Tag.Rewrd"></a><a id="860" href="Ledger.Transaction.html#860" class="InductiveConstructor">Rewrd</a> <a id="Tag.Vote"></a><a id="866" href="Ledger.Transaction.html#866" class="InductiveConstructor">Vote</a> <a id="Tag.Propose"></a><a id="871" href="Ledger.Transaction.html#871" class="InductiveConstructor">Propose</a> <a id="879" class="Symbol">:</a> <a id="881" href="Ledger.Transaction.html#825" class="Datatype">Tag</a>
<a id="885" class="Keyword">unquoteDecl</a> <a id="DecEq-Tag"></a><a id="897" href="Ledger.Transaction.html#897" class="Function">DecEq-Tag</a> <a id="907" class="Symbol">=</a> <a id="909" href="Tactic.Derive.DecEq.html#3506" class="Function">derive-DecEq</a> <a id="922" class="Symbol">((</a><a id="924" class="Keyword">quote</a> <a id="930" href="Ledger.Transaction.html#825" class="Datatype">Tag</a> <a id="934" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="936" href="Ledger.Transaction.html#897" class="Function">DecEq-Tag</a><a id="945" class="Symbol">)</a> <a id="947" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="949" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a><a id="951" class="Symbol">)</a>

<a id="954" class="Keyword">record</a> <a id="TransactionStructure"></a><a id="961" href="Ledger.Transaction.html#961" class="Record">TransactionStructure</a> <a id="982" class="Symbol">:</a> <a id="984" href="Agda.Primitive.html#388" class="Primitive">Type₁</a> <a id="990" class="Keyword">where</a>
  <a id="998" class="Keyword">field</a>
<a id="1004" class="Markup">\end{code}</a><a id="1014" class="Background">

Transactions are defined in Figure~\ref{fig:defs:transactions}. A
transaction is made up of a transaction body, a collection of
witnesses and some optional auxiliary data.
\begin{NoConway}
Some key ingredients in the transaction body are:
\begin{itemize}
  \item A set \txins of transaction inputs, each of which identifies an output from a previous transaction.
    A transaction input consists of a transaction id and an index to uniquely identify the output.
  \item An indexed collection \txouts of transaction outputs.
    The \TxOut type is an address paired with a coin value.
  \item A transaction fee. This value will be added to the fee pot.
  \item The size \txsize and the hash \txid of the serialized form of the transaction that was included in the block.
\end{itemize}
\end{NoConway}
\begin{Conway}
Ingredients of the transaction body introduced in the Conway era are the following:
\begin{itemize}
  \item \txvote, the list of votes for goverance actions;
  \item \txprop, the list of governance proposals;
  \item \txdonation, the treasury donation amount;
  \item \curTreasury, the current value of the treasury.
  \item \txsize and \txid, the size and hash of the serialized form of the transaction that was included in the block.
\end{itemize}
\end{Conway}

\begin{figure*}[h]
\emph{Abstract types}
\begin{AgdaMultiCode}
</a><a id="2357" class="Markup">\begin{code}</a>
        <a id="TransactionStructure.Ix"></a><a id="2378" href="Ledger.Transaction.html#2378" class="Field">Ix</a> <a id="TransactionStructure.TxId"></a><a id="2381" href="Ledger.Transaction.html#2381" class="Field">TxId</a> <a id="TransactionStructure.AuxiliaryData"></a><a id="2386" href="Ledger.Transaction.html#2386" class="Field">AuxiliaryData</a> <a id="2400" class="Symbol">:</a> <a id="2402" href="Agda.Primitive.html#388" class="Primitive">Type</a>
<a id="2407" class="Markup">\end{code}</a><a id="2417" class="Background">
</a><a id="2418" class="Markup">\begin{code}[hide]</a>
        <a id="2445" class="Symbol">⦃</a> <a id="TransactionStructure.DecEq-Ix"></a><a id="2447" href="Ledger.Transaction.html#2447" class="Field">DecEq-Ix</a>   <a id="2458" class="Symbol">⦄</a> <a id="2460" class="Symbol">:</a> <a id="2462" href="Class.DecEq.Core.html#117" class="Record">DecEq</a> <a id="2468" href="Ledger.Transaction.html#2378" class="Field">Ix</a>
        <a id="2479" class="Symbol">⦃</a> <a id="TransactionStructure.DecEq-TxId"></a><a id="2481" href="Ledger.Transaction.html#2481" class="Field">DecEq-TxId</a> <a id="2492" class="Symbol">⦄</a> <a id="2494" class="Symbol">:</a> <a id="2496" href="Class.DecEq.Core.html#117" class="Record">DecEq</a> <a id="2502" href="Ledger.Transaction.html#2381" class="Field">TxId</a>
        <a id="TransactionStructure.adHashingScheme"></a><a id="2515" href="Ledger.Transaction.html#2515" class="Field">adHashingScheme</a> <a id="2531" class="Symbol">:</a> <a id="2533" href="Ledger.Crypto.html#152" class="Record">isHashableSet</a> <a id="2547" href="Ledger.Transaction.html#2386" class="Field">AuxiliaryData</a>
  <a id="2563" class="Keyword">open</a> <a id="2568" href="Ledger.Crypto.html#152" class="Module">isHashableSet</a> <a id="2582" href="Ledger.Transaction.html#2515" class="Field">adHashingScheme</a> <a id="2598" class="Keyword">renaming</a> <a id="2607" class="Symbol">(</a><a id="2608" href="Ledger.Crypto.html#229" class="Field">THash</a> <a id="2614" class="Symbol">to</a> <a id="2617" class="Field">ADHash</a><a id="2623" class="Symbol">)</a> <a id="2625" class="Keyword">public</a>

  <a id="2635" class="Keyword">field</a> <a id="TransactionStructure.globalConstants"></a><a id="2641" href="Ledger.Transaction.html#2641" class="Field">globalConstants</a> <a id="2657" class="Symbol">:</a> <a id="2659" class="Symbol">_</a>
  <a id="2663" class="Keyword">open</a> <a id="2668" href="Ledger.Types.Epoch.html#1666" class="Module">GlobalConstants</a> <a id="2684" href="Ledger.Transaction.html#2641" class="Field">globalConstants</a> <a id="2700" class="Keyword">public</a>

  <a id="2710" class="Keyword">field</a> <a id="TransactionStructure.crypto"></a><a id="2716" href="Ledger.Transaction.html#2716" class="Field">crypto</a> <a id="2723" class="Symbol">:</a> <a id="2725" class="Symbol">_</a>
  <a id="2729" class="Keyword">open</a> <a id="2734" href="Ledger.Crypto.html#1402" class="Module">Crypto</a> <a id="2741" href="Ledger.Transaction.html#2716" class="Field">crypto</a> <a id="2748" class="Keyword">public</a>
  <a id="2757" class="Keyword">open</a> <a id="2762" href="Ledger.TokenAlgebra.html" class="Module">Ledger.TokenAlgebra</a> <a id="2782" href="Ledger.Crypto.html#1525" class="Function">ScriptHash</a> <a id="2793" class="Keyword">public</a>
  <a id="2802" class="Keyword">open</a> <a id="2807" href="Ledger.Address.html" class="Module">Ledger.Address</a> <a id="2822" href="Ledger.Types.Epoch.html#1705" class="Function">Network</a> <a id="2830" href="Ledger.Crypto.html#1629" class="Function">KeyHash</a> <a id="2838" href="Ledger.Crypto.html#1525" class="Function">ScriptHash</a> <a id="2849" class="Symbol">⦃</a> <a id="2851" href="Function.Base.html#4736" class="Function">it</a> <a id="2854" class="Symbol">⦄</a> <a id="2856" class="Symbol">⦃</a> <a id="2858" href="Function.Base.html#4736" class="Function">it</a> <a id="2861" class="Symbol">⦄</a> <a id="2863" class="Symbol">⦃</a> <a id="2865" href="Function.Base.html#4736" class="Function">it</a> <a id="2868" class="Symbol">⦄</a> <a id="2870" class="Keyword">public</a>

  <a id="2880" class="Keyword">field</a> <a id="TransactionStructure.epochStructure"></a><a id="2886" href="Ledger.Transaction.html#2886" class="Field">epochStructure</a> <a id="2901" class="Symbol">:</a> <a id="2903" class="Symbol">_</a>
  <a id="2907" class="Keyword">open</a> <a id="2912" href="Ledger.Types.Epoch.html#267" class="Module">EpochStructure</a> <a id="2927" href="Ledger.Transaction.html#2886" class="Field">epochStructure</a> <a id="2942" class="Keyword">public</a>
  <a id="2951" class="Keyword">open</a> <a id="2956" href="Ledger.Script.html" class="Module">Ledger.Script</a> <a id="2970" href="Ledger.Transaction.html#2716" class="Field">crypto</a> <a id="2977" href="Ledger.Transaction.html#2886" class="Field">epochStructure</a> <a id="2992" class="Keyword">public</a>

  <a id="3002" class="Keyword">field</a> <a id="TransactionStructure.scriptStructure"></a><a id="3008" href="Ledger.Transaction.html#3008" class="Field">scriptStructure</a> <a id="3024" class="Symbol">:</a> <a id="3026" class="Symbol">_</a>
  <a id="3030" class="Keyword">open</a> <a id="3035" href="Ledger.Script.html#5546" class="Module">ScriptStructure</a> <a id="3051" href="Ledger.Transaction.html#3008" class="Field">scriptStructure</a> <a id="3067" class="Keyword">public</a>
  <a id="3076" class="Keyword">open</a> <a id="3081" href="Ledger.PParams.html" class="Module">Ledger.PParams</a> <a id="3096" href="Ledger.Transaction.html#2716" class="Field">crypto</a> <a id="3103" href="Ledger.Transaction.html#2886" class="Field">epochStructure</a> <a id="3118" href="Ledger.Transaction.html#3008" class="Field">scriptStructure</a> <a id="3134" class="Keyword">public</a>

  <a id="3144" class="Keyword">field</a> <a id="TransactionStructure.govParams"></a><a id="3150" href="Ledger.Transaction.html#3150" class="Field">govParams</a> <a id="3160" class="Symbol">:</a> <a id="3162" class="Symbol">_</a>
  <a id="3166" class="Keyword">open</a> <a id="3171" href="Ledger.PParams.html#15283" class="Module">GovParams</a> <a id="3181" href="Ledger.Transaction.html#3150" class="Field">govParams</a> <a id="3191" class="Keyword">public</a>

  <a id="3201" class="Keyword">field</a> <a id="TransactionStructure.tokenAlgebra"></a><a id="3207" href="Ledger.Transaction.html#3207" class="Field">tokenAlgebra</a> <a id="3220" class="Symbol">:</a> <a id="3222" href="Ledger.TokenAlgebra.html#723" class="Record">TokenAlgebra</a>
  <a id="3237" class="Keyword">open</a> <a id="3242" href="Ledger.TokenAlgebra.html#723" class="Module">TokenAlgebra</a> <a id="3255" href="Ledger.Transaction.html#3207" class="Field">tokenAlgebra</a> <a id="3268" class="Keyword">public</a>

  <a id="3278" class="Keyword">field</a> <a id="TransactionStructure.txidBytes"></a><a id="3284" href="Ledger.Transaction.html#3284" class="Field">txidBytes</a> <a id="3294" class="Symbol">:</a> <a id="3296" href="Ledger.Transaction.html#2381" class="Field">TxId</a> <a id="3301" class="Symbol">→</a> <a id="3303" href="Ledger.Crypto.html#740" class="Function">Ser</a>
        <a id="TransactionStructure.networkId"></a><a id="3315" href="Ledger.Transaction.html#3315" class="Field">networkId</a> <a id="3325" class="Symbol">:</a> <a id="3327" href="Ledger.Types.Epoch.html#1705" class="Function">Network</a>

  <a id="TransactionStructure.govStructure"></a><a id="3338" href="Ledger.Transaction.html#3338" class="Function">govStructure</a> <a id="3351" class="Symbol">:</a> <a id="3353" href="Ledger.Types.GovStructure.html#235" class="Record">GovStructure</a>
  <a id="3368" href="Ledger.Transaction.html#3338" class="Function">govStructure</a> <a id="3381" class="Symbol">=</a> <a id="3383" class="Keyword">record</a>
    <a id="3394" class="Comment">-- TODO: figure out what to do with the hash</a>
    <a id="3443" class="Symbol">{</a> <a id="3445" href="Ledger.Types.GovStructure.html#270" class="Field">TxId</a> <a id="3450" class="Symbol">=</a> <a id="3452" href="Ledger.Transaction.html#2381" class="Field">TxId</a><a id="3456" class="Symbol">;</a> <a id="3458" href="Ledger.Types.GovStructure.html#275" class="Field">DocHash</a> <a id="3466" class="Symbol">=</a> <a id="3468" href="Ledger.Transaction.html#2617" class="Function">ADHash</a>
    <a id="3479" class="Symbol">;</a> <a id="3481" href="Ledger.Types.GovStructure.html#335" class="Field">crypto</a> <a id="3488" class="Symbol">=</a> <a id="3490" href="Ledger.Transaction.html#2716" class="Field">crypto</a>
    <a id="3501" class="Symbol">;</a> <a id="3503" href="Ledger.Types.GovStructure.html#383" class="Field">epochStructure</a> <a id="3518" class="Symbol">=</a> <a id="3520" href="Ledger.Transaction.html#2886" class="Field">epochStructure</a>
    <a id="3539" class="Symbol">;</a> <a id="3541" href="Ledger.Types.GovStructure.html#455" class="Field">scriptStructure</a> <a id="3557" class="Symbol">=</a> <a id="3559" href="Ledger.Transaction.html#3008" class="Field">scriptStructure</a>
    <a id="3579" class="Symbol">;</a> <a id="3581" href="Ledger.Types.GovStructure.html#634" class="Field">govParams</a> <a id="3591" class="Symbol">=</a> <a id="3593" href="Ledger.Transaction.html#3150" class="Field">govParams</a>
    <a id="3607" class="Symbol">;</a> <a id="3609" href="Ledger.Types.GovStructure.html#699" class="Field">globalConstants</a> <a id="3625" class="Symbol">=</a> <a id="3627" href="Ledger.Transaction.html#2641" class="Field">globalConstants</a>
    <a id="3647" class="Symbol">}</a>

  <a id="3652" class="Keyword">open</a> <a id="3657" href="Ledger.GovernanceActions.html" class="Module">Ledger.GovernanceActions</a> <a id="3682" href="Ledger.Transaction.html#3338" class="Function">govStructure</a> <a id="3695" class="Keyword">hiding</a> <a id="3702" class="Symbol">(</a><a id="3703" href="Ledger.GovernanceActions.html#8237" class="Datatype">Vote</a><a id="3707" class="Symbol">;</a> <a id="3709" href="Ledger.GovernanceActions.html#8257" class="InductiveConstructor">yes</a><a id="3712" class="Symbol">;</a> <a id="3714" href="Ledger.GovernanceActions.html#8261" class="InductiveConstructor">no</a><a id="3716" class="Symbol">;</a> <a id="3718" href="Ledger.GovernanceActions.html#8264" class="InductiveConstructor">abstain</a><a id="3725" class="Symbol">)</a> <a id="3727" class="Keyword">public</a>

  <a id="3737" class="Keyword">open</a> <a id="3742" class="Keyword">import</a> <a id="3749" href="Ledger.Certs.html" class="Module">Ledger.Certs</a> <a id="3762" href="Ledger.Transaction.html#3338" class="Function">govStructure</a> <a id="3775" class="Keyword">public</a>
  <a id="3784" class="Keyword">open</a> <a id="3789" class="Keyword">import</a> <a id="3796" href="Ledger.Certs.Haskell.html" class="Module">Ledger.Certs.Haskell</a> <a id="3817" href="Ledger.Transaction.html#3338" class="Function">govStructure</a> <a id="3830" class="Keyword">public</a>
    <a id="3841" class="Keyword">renaming</a> <a id="3850" class="Symbol">(</a><a id="3851" href="Ledger.Certs.Haskell.html#592" class="Record">DState</a> <a id="3858" class="Symbol">to</a> <a id="3861" class="Record">DState&#39;</a><a id="3868" class="Symbol">;</a> <a id="3870" href="Ledger.Certs.Haskell.html#797" class="Record">GState</a> <a id="3877" class="Symbol">to</a> <a id="3880" class="Record">GState&#39;</a><a id="3887" class="Symbol">)</a> <a id="3889" class="Keyword">using</a> <a id="3895" class="Symbol">()</a>
<a id="3898" class="Markup">\end{code}</a><a id="3908" class="Background">
\begin{NoConway}
\emph{Derived types}
</a><a id="3947" class="Markup">\begin{code}</a>
  <a id="TransactionStructure.TxIn"></a><a id="3962" href="Ledger.Transaction.html#3962" class="Function">TxIn</a>     <a id="3971" class="Symbol">=</a> <a id="3973" href="Ledger.Transaction.html#2381" class="Field">TxId</a> <a id="3978" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="3980" href="Ledger.Transaction.html#2378" class="Field">Ix</a>
  <a id="TransactionStructure.TxOut"></a><a id="3985" href="Ledger.Transaction.html#3985" class="Function">TxOut</a>    <a id="3994" class="Symbol">=</a> <a id="3996" href="Ledger.Address.html#2070" class="Function">Addr</a> <a id="4001" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="4003" href="Ledger.TokenAlgebra.html#816" class="Function">Value</a> <a id="4009" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="4011" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="4017" class="Symbol">(</a><a id="4018" href="Ledger.Script.html#1714" class="Function">Datum</a> <a id="4024" href="Data.Sum.Base.html#625" class="Datatype Operator">⊎</a> <a id="4026" href="Ledger.Script.html#1667" class="Function">DataHash</a><a id="4034" class="Symbol">)</a> <a id="4036" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="4038" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="4044" href="Ledger.Script.html#6019" class="Function">Script</a>
  <a id="TransactionStructure.UTxO"></a><a id="4053" href="Ledger.Transaction.html#4053" class="Function">UTxO</a>     <a id="4062" class="Symbol">=</a> <a id="4064" href="Ledger.Transaction.html#3962" class="Function">TxIn</a> <a id="4069" href="Ledger.Set.Theory.html#1515" class="Function Operator">⇀</a> <a id="4071" href="Ledger.Transaction.html#3985" class="Function">TxOut</a>
  <a id="TransactionStructure.Wdrl"></a><a id="4079" href="Ledger.Transaction.html#4079" class="Function">Wdrl</a>     <a id="4088" class="Symbol">=</a> <a id="4090" href="Ledger.Address.html#1583" class="Record">RwdAddr</a> <a id="4098" href="Ledger.Set.Theory.html#1515" class="Function Operator">⇀</a> <a id="4100" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a>
  <a id="TransactionStructure.RdmrPtr"></a><a id="4107" href="Ledger.Transaction.html#4107" class="Function">RdmrPtr</a>  <a id="4116" class="Symbol">=</a> <a id="4118" href="Ledger.Transaction.html#825" class="Datatype">Tag</a> <a id="4122" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="4124" href="Ledger.Transaction.html#2378" class="Field">Ix</a>

  <a id="TransactionStructure.ProposedPPUpdates"></a><a id="4130" href="Ledger.Transaction.html#4130" class="Function">ProposedPPUpdates</a>  <a id="4149" class="Symbol">=</a> <a id="4151" href="Ledger.Crypto.html#1629" class="Function">KeyHash</a> <a id="4159" href="Ledger.Set.Theory.html#1515" class="Function Operator">⇀</a> <a id="4161" href="Ledger.PParams.html#15381" class="Function">PParamsUpdate</a>
  <a id="TransactionStructure.Update"></a><a id="4177" href="Ledger.Transaction.html#4177" class="Function">Update</a>             <a id="4196" class="Symbol">=</a> <a id="4198" href="Ledger.Transaction.html#4130" class="Function">ProposedPPUpdates</a> <a id="4216" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="4218" href="Ledger.Types.Epoch.html#335" class="Function">Epoch</a>
<a id="4224" class="Markup">\end{code}</a><a id="4234" class="Background">
\end{NoConway}
\emph{Transaction types}
</a><a id="4275" class="Markup">\begin{code}</a>
  <a id="4290" class="Keyword">record</a> <a id="TransactionStructure.TxBody"></a><a id="4297" href="Ledger.Transaction.html#4297" class="Record">TxBody</a> <a id="4304" class="Symbol">:</a> <a id="4306" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="4311" class="Keyword">where</a>
<a id="4317" class="Markup">\end{code}</a><a id="4327" class="Background">
</a><a id="4328" class="Markup">\begin{code}[hide]</a>
    <a id="4351" class="Keyword">field</a>
<a id="4357" class="Markup">\end{code}</a><a id="4367" class="Background">
</a><a id="4368" class="Markup">\begin{code}</a>
      <a id="4387" href="Ledger.Transaction.html#4387" class="Field">txins</a>          <a id="4402" class="Symbol">:</a> <a id="4404" href="Ledger.Set.Theory.html#382" class="Function Operator">ℙ</a> <a id="4406" href="Ledger.Transaction.html#3962" class="Function">TxIn</a>
      <a id="4417" href="Ledger.Transaction.html#4417" class="Field">refInputs</a>      <a id="4432" class="Symbol">:</a> <a id="4434" href="Ledger.Set.Theory.html#382" class="Function Operator">ℙ</a> <a id="4436" href="Ledger.Transaction.html#3962" class="Function">TxIn</a>
      <a id="4447" href="Ledger.Transaction.html#4447" class="Field">txouts</a>         <a id="4462" class="Symbol">:</a> <a id="4464" href="Ledger.Transaction.html#2378" class="Field">Ix</a> <a id="4467" href="Ledger.Set.Theory.html#1515" class="Function Operator">⇀</a> <a id="4469" href="Ledger.Transaction.html#3985" class="Function">TxOut</a>
      <a id="4481" href="Ledger.Transaction.html#4481" class="Field">txfee</a>          <a id="4496" class="Symbol">:</a> <a id="4498" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a>
      <a id="4509" href="Ledger.Transaction.html#4509" class="Field">mint</a>           <a id="4524" class="Symbol">:</a> <a id="4526" href="Ledger.TokenAlgebra.html#816" class="Function">Value</a>
      <a id="4538" href="Ledger.Transaction.html#4538" class="Field">txvldt</a>         <a id="4553" class="Symbol">:</a> <a id="4555" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="4561" href="Ledger.Types.Epoch.html#382" class="Function">Slot</a> <a id="4566" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="4568" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="4574" href="Ledger.Types.Epoch.html#382" class="Function">Slot</a>
      <a id="4585" href="Ledger.Transaction.html#4585" class="Field">txcerts</a>        <a id="4600" class="Symbol">:</a> <a id="4602" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="4607" href="Ledger.Certs.html#1056" class="Datatype">DCert</a>
      <a id="4619" href="Ledger.Transaction.html#4619" class="Field">txwdrls</a>        <a id="4634" class="Symbol">:</a> <a id="4636" href="Ledger.Transaction.html#4079" class="Function">Wdrl</a>
      <a id="4647" href="Ledger.Transaction.html#4647" class="Field">txvote</a>         <a id="4662" class="Symbol">:</a> <a id="4664" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="4669" href="Ledger.GovernanceActions.html#8288" class="Record">GovVote</a>
      <a id="4683" href="Ledger.Transaction.html#4683" class="Field">txprop</a>         <a id="4698" class="Symbol">:</a> <a id="4700" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="4705" href="Ledger.GovernanceActions.html#8487" class="Record">GovProposal</a>
      <a id="4723" href="Ledger.Transaction.html#4723" class="Field">txdonation</a>     <a id="4738" class="Symbol">:</a> <a id="4740" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a>
      <a id="4751" href="Ledger.Transaction.html#4751" class="Field">txup</a>           <a id="4766" class="Symbol">:</a> <a id="4768" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="4774" href="Ledger.Transaction.html#4177" class="Function">Update</a>
      <a id="4787" href="Ledger.Transaction.html#4787" class="Field">txADhash</a>       <a id="4802" class="Symbol">:</a> <a id="4804" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="4810" href="Ledger.Transaction.html#2617" class="Function">ADHash</a>
      <a id="4823" href="Ledger.Transaction.html#4823" class="Field">txNetworkId</a>    <a id="4838" class="Symbol">:</a> <a id="4840" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="4846" href="Ledger.Types.Epoch.html#1705" class="Function">Network</a>
      <a id="4860" href="Ledger.Transaction.html#4860" class="Field">curTreasury</a>    <a id="4875" class="Symbol">:</a> <a id="4877" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="4883" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a>
      <a id="4894" href="Ledger.Transaction.html#4894" class="Field">txsize</a>         <a id="4909" class="Symbol">:</a> <a id="4911" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a>
      <a id="4919" href="Ledger.Transaction.html#4919" class="Field">txid</a>           <a id="4934" class="Symbol">:</a> <a id="4936" href="Ledger.Transaction.html#2381" class="Field">TxId</a>
      <a id="4947" href="Ledger.Transaction.html#4947" class="Field">collateral</a>     <a id="4962" class="Symbol">:</a> <a id="4964" href="Ledger.Set.Theory.html#382" class="Function Operator">ℙ</a> <a id="4966" href="Ledger.Transaction.html#3962" class="Function">TxIn</a>
      <a id="4977" href="Ledger.Transaction.html#4977" class="Field">reqSigHash</a>     <a id="4992" class="Symbol">:</a> <a id="4994" href="Ledger.Set.Theory.html#382" class="Function Operator">ℙ</a> <a id="4996" href="Ledger.Crypto.html#1629" class="Function">KeyHash</a>
      <a id="5010" href="Ledger.Transaction.html#5010" class="Field">scriptIntHash</a>  <a id="5025" class="Symbol">:</a> <a id="5027" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="5033" href="Ledger.Crypto.html#1525" class="Function">ScriptHash</a>
<a id="5044" class="Markup">\end{code}</a><a id="5054" class="Background">
\begin{NoConway}
</a><a id="5072" class="Markup">\begin{code}</a>
  <a id="5087" class="Keyword">record</a> <a id="TransactionStructure.TxWitnesses"></a><a id="5094" href="Ledger.Transaction.html#5094" class="Record">TxWitnesses</a> <a id="5106" class="Symbol">:</a> <a id="5108" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="5113" class="Keyword">where</a>
<a id="5119" class="Markup">\end{code}</a><a id="5129" class="Background">
</a><a id="5130" class="Markup">\begin{code}[hide]</a>
    <a id="5153" class="Keyword">field</a>
<a id="5159" class="Markup">\end{code}</a><a id="5169" class="Background">
</a><a id="5170" class="Markup">\begin{code}</a>
      <a id="5189" href="Ledger.Transaction.html#5189" class="Field">vkSigs</a>   <a id="5198" class="Symbol">:</a> <a id="5200" href="Ledger.Crypto.html#731" class="Function">VKey</a> <a id="5205" href="Ledger.Set.Theory.html#1515" class="Function Operator">⇀</a> <a id="5207" href="Ledger.Crypto.html#736" class="Function">Sig</a>
      <a id="5217" href="Ledger.Transaction.html#5217" class="Field">scripts</a>  <a id="5226" class="Symbol">:</a> <a id="5228" href="Ledger.Set.Theory.html#382" class="Function Operator">ℙ</a> <a id="5230" href="Ledger.Script.html#6019" class="Function">Script</a>
      <a id="5243" href="Ledger.Transaction.html#5243" class="Field">txdats</a>   <a id="5252" class="Symbol">:</a> <a id="5254" href="Ledger.Script.html#1667" class="Function">DataHash</a> <a id="5263" href="Ledger.Set.Theory.html#1515" class="Function Operator">⇀</a> <a id="5265" href="Ledger.Script.html#1714" class="Function">Datum</a>
      <a id="5277" href="Ledger.Transaction.html#5277" class="Field">txrdmrs</a>  <a id="5286" class="Symbol">:</a> <a id="5288" href="Ledger.Transaction.html#4107" class="Function">RdmrPtr</a>  <a id="5297" href="Ledger.Set.Theory.html#1515" class="Function Operator">⇀</a> <a id="5299" href="Ledger.Script.html#1732" class="Function">Redeemer</a> <a id="5308" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="5310" href="Ledger.Script.html#1096" class="Function">ExUnits</a>

    <a id="TransactionStructure.TxWitnesses.scriptsP1"></a><a id="5323" href="Ledger.Transaction.html#5323" class="Function">scriptsP1</a> <a id="5333" class="Symbol">:</a> <a id="5335" href="Ledger.Set.Theory.html#382" class="Function Operator">ℙ</a> <a id="5337" href="Ledger.Script.html#720" class="Function">P1Script</a>
    <a id="5350" href="Ledger.Transaction.html#5323" class="Function">scriptsP1</a> <a id="5360" class="Symbol">=</a> <a id="5362" href="Axiom.Set.html#7518" class="Function">mapPartial</a> <a id="5373" href="Data.Sum.html#973" class="Function">isInj₁</a> <a id="5380" href="Ledger.Transaction.html#5217" class="Field">scripts</a>

  <a id="5391" class="Keyword">record</a> <a id="TransactionStructure.Tx"></a><a id="5398" href="Ledger.Transaction.html#5398" class="Record">Tx</a> <a id="5401" class="Symbol">:</a> <a id="5403" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="5408" class="Keyword">where</a>
<a id="5414" class="Markup">\end{code}</a><a id="5424" class="Background">
</a><a id="5425" class="Markup">\begin{code}[hide]</a>
    <a id="5448" class="Keyword">field</a>
<a id="5454" class="Markup">\end{code}</a><a id="5464" class="Background">
</a><a id="5465" class="Markup">\begin{code}</a>
      <a id="5484" href="Ledger.Transaction.html#5484" class="Field">body</a>     <a id="5493" class="Symbol">:</a> <a id="5495" href="Ledger.Transaction.html#4297" class="Record">TxBody</a>
      <a id="5508" href="Ledger.Transaction.html#5508" class="Field">wits</a>     <a id="5517" class="Symbol">:</a> <a id="5519" href="Ledger.Transaction.html#5094" class="Record">TxWitnesses</a>
      <a id="5537" href="Ledger.Transaction.html#5537" class="Field">isValid</a>  <a id="5546" class="Symbol">:</a> <a id="5548" href="Agda.Builtin.Bool.html#173" class="Datatype">Bool</a>
      <a id="5559" href="Ledger.Transaction.html#5559" class="Field">txAD</a>     <a id="5568" class="Symbol">:</a> <a id="5570" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="5576" href="Ledger.Transaction.html#2386" class="Field">AuxiliaryData</a>
<a id="5590" class="Markup">\end{code}</a><a id="5600" class="Background">
\end{NoConway}
\end{AgdaMultiCode}
\caption{Transactions and related types}
\label{fig:defs:transactions}
\end{figure*}

\begin{NoConway}
\begin{figure*}[h]
\begin{AgdaMultiCode}
</a><a id="5780" class="Markup">\begin{code}</a>
  <a id="TransactionStructure.getValue"></a><a id="5795" href="Ledger.Transaction.html#5795" class="Function">getValue</a> <a id="5804" class="Symbol">:</a> <a id="5806" href="Ledger.Transaction.html#3985" class="Function">TxOut</a> <a id="5812" class="Symbol">→</a> <a id="5814" href="Ledger.TokenAlgebra.html#816" class="Function">Value</a>
  <a id="5822" href="Ledger.Transaction.html#5795" class="Function">getValue</a> <a id="5831" class="Symbol">(_</a> <a id="5834" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5836" href="Ledger.Transaction.html#5836" class="Bound">v</a> <a id="5838" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5840" class="Symbol">_)</a> <a id="5843" class="Symbol">=</a> <a id="5845" href="Ledger.Transaction.html#5836" class="Bound">v</a>

  <a id="TransactionStructure.TxOutʰ"></a><a id="5850" href="Ledger.Transaction.html#5850" class="Function">TxOutʰ</a> <a id="5857" class="Symbol">=</a> <a id="5859" href="Ledger.Address.html#2070" class="Function">Addr</a> <a id="5864" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="5866" href="Ledger.TokenAlgebra.html#816" class="Function">Value</a> <a id="5872" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="5874" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="5880" class="Symbol">(</a><a id="5881" href="Ledger.Script.html#1714" class="Function">Datum</a> <a id="5887" href="Data.Sum.Base.html#625" class="Datatype Operator">⊎</a> <a id="5889" href="Ledger.Script.html#1667" class="Function">DataHash</a><a id="5897" class="Symbol">)</a> <a id="5899" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="5901" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="5907" href="Ledger.Crypto.html#1525" class="Function">ScriptHash</a>

  <a id="TransactionStructure.txOutHash"></a><a id="5921" href="Ledger.Transaction.html#5921" class="Function">txOutHash</a> <a id="5931" class="Symbol">:</a> <a id="5933" href="Ledger.Transaction.html#3985" class="Function">TxOut</a> <a id="5939" class="Symbol">→</a> <a id="5941" href="Ledger.Transaction.html#5850" class="Function">TxOutʰ</a>
  <a id="5950" href="Ledger.Transaction.html#5921" class="Function">txOutHash</a> <a id="5960" class="Symbol">(</a><a id="5961" href="Ledger.Transaction.html#5961" class="Bound">a</a> <a id="5963" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5965" href="Ledger.Transaction.html#5965" class="Bound">v</a> <a id="5967" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5969" href="Ledger.Transaction.html#5969" class="Bound">d</a> <a id="5971" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5973" href="Ledger.Transaction.html#5973" class="Bound">s</a><a id="5974" class="Symbol">)</a> <a id="5976" class="Symbol">=</a> <a id="5978" href="Ledger.Transaction.html#5961" class="Bound">a</a> <a id="5980" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5982" class="Symbol">(</a><a id="5983" href="Ledger.Transaction.html#5965" class="Bound">v</a> <a id="5985" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5987" class="Symbol">(</a><a id="5988" href="Ledger.Transaction.html#5969" class="Bound">d</a> <a id="5990" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5992" href="Data.Maybe.Base.html#2049" class="Function">M.map</a> <a id="5998" href="Interface.Hashable.html#256" class="Field">hash</a> <a id="6003" href="Ledger.Transaction.html#5973" class="Bound">s</a><a id="6004" class="Symbol">))</a>

  <a id="TransactionStructure.getValueʰ"></a><a id="6010" href="Ledger.Transaction.html#6010" class="Function">getValueʰ</a> <a id="6020" class="Symbol">:</a> <a id="6022" href="Ledger.Transaction.html#5850" class="Function">TxOutʰ</a> <a id="6029" class="Symbol">→</a> <a id="6031" href="Ledger.TokenAlgebra.html#816" class="Function">Value</a>
  <a id="6039" href="Ledger.Transaction.html#6010" class="Function">getValueʰ</a> <a id="6049" class="Symbol">(_</a> <a id="6052" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="6054" href="Ledger.Transaction.html#6054" class="Bound">v</a> <a id="6056" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="6058" class="Symbol">_)</a> <a id="6061" class="Symbol">=</a> <a id="6063" href="Ledger.Transaction.html#6054" class="Bound">v</a>

  <a id="TransactionStructure.txinsVKey"></a><a id="6068" href="Ledger.Transaction.html#6068" class="Function">txinsVKey</a> <a id="6078" class="Symbol">:</a> <a id="6080" href="Ledger.Set.Theory.html#382" class="Function Operator">ℙ</a> <a id="6082" href="Ledger.Transaction.html#3962" class="Function">TxIn</a> <a id="6087" class="Symbol">→</a> <a id="6089" href="Ledger.Transaction.html#4053" class="Function">UTxO</a> <a id="6094" class="Symbol">→</a> <a id="6096" href="Ledger.Set.Theory.html#382" class="Function Operator">ℙ</a> <a id="6098" href="Ledger.Transaction.html#3962" class="Function">TxIn</a>
  <a id="6105" href="Ledger.Transaction.html#6068" class="Function">txinsVKey</a> <a id="6115" href="Ledger.Transaction.html#6115" class="Bound">txins</a> <a id="6121" href="Ledger.Transaction.html#6121" class="Bound">utxo</a> <a id="6126" class="Symbol">=</a> <a id="6128" href="Ledger.Transaction.html#6115" class="Bound">txins</a> <a id="6134" href="Axiom.Set.html#9005" class="Function Operator">∩</a> <a id="6136" href="Interface.IsSet.html#934" class="Function">dom</a> <a id="6140" class="Symbol">(</a><a id="6141" href="Ledger.Transaction.html#6121" class="Bound">utxo</a> <a id="6146" href="Ledger.Set.Theory.html#3006" class="Function Operator">∣^&#39;</a> <a id="6150" class="Symbol">(</a><a id="6151" href="Ledger.Address.html#2407" class="Function">isVKeyAddr</a> <a id="6162" href="Function.Base.html#1115" class="Function Operator">∘</a> <a id="6164" href="Data.Product.Base.html#636" class="Field">proj₁</a><a id="6169" class="Symbol">))</a>

  <a id="TransactionStructure.scriptOuts"></a><a id="6175" href="Ledger.Transaction.html#6175" class="Function">scriptOuts</a> <a id="6186" class="Symbol">:</a> <a id="6188" href="Ledger.Transaction.html#4053" class="Function">UTxO</a> <a id="6193" class="Symbol">→</a> <a id="6195" href="Ledger.Transaction.html#4053" class="Function">UTxO</a>
  <a id="6202" href="Ledger.Transaction.html#6175" class="Function">scriptOuts</a> <a id="6213" href="Ledger.Transaction.html#6213" class="Bound">utxo</a> <a id="6218" class="Symbol">=</a> <a id="6220" href="Ledger.Transaction.html#431" class="Function">filter</a> <a id="6227" class="Symbol">(λ</a> <a id="6230" class="Symbol">(_</a> <a id="6233" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="6235" href="Ledger.Transaction.html#6235" class="Bound">addr</a> <a id="6240" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="6242" class="Symbol">_)</a> <a id="6245" class="Symbol">→</a> <a id="6247" href="Ledger.Address.html#2435" class="Function">isScriptAddr</a> <a id="6260" href="Ledger.Transaction.html#6235" class="Bound">addr</a><a id="6264" class="Symbol">)</a> <a id="6266" href="Ledger.Transaction.html#6213" class="Bound">utxo</a>

  <a id="TransactionStructure.txinsScript"></a><a id="6274" href="Ledger.Transaction.html#6274" class="Function">txinsScript</a> <a id="6286" class="Symbol">:</a> <a id="6288" href="Ledger.Set.Theory.html#382" class="Function Operator">ℙ</a> <a id="6290" href="Ledger.Transaction.html#3962" class="Function">TxIn</a> <a id="6295" class="Symbol">→</a> <a id="6297" href="Ledger.Transaction.html#4053" class="Function">UTxO</a> <a id="6302" class="Symbol">→</a> <a id="6304" href="Ledger.Set.Theory.html#382" class="Function Operator">ℙ</a> <a id="6306" href="Ledger.Transaction.html#3962" class="Function">TxIn</a>
  <a id="6313" href="Ledger.Transaction.html#6274" class="Function">txinsScript</a> <a id="6325" href="Ledger.Transaction.html#6325" class="Bound">txins</a> <a id="6331" href="Ledger.Transaction.html#6331" class="Bound">utxo</a> <a id="6336" class="Symbol">=</a> <a id="6338" href="Ledger.Transaction.html#6325" class="Bound">txins</a> <a id="6344" href="Axiom.Set.html#9005" class="Function Operator">∩</a> <a id="6346" href="Interface.IsSet.html#934" class="Function">dom</a> <a id="6350" class="Symbol">(</a><a id="6351" href="Data.Product.Base.html#636" class="Field">proj₁</a> <a id="6357" class="Symbol">(</a><a id="6358" href="Ledger.Transaction.html#6175" class="Function">scriptOuts</a> <a id="6369" href="Ledger.Transaction.html#6331" class="Bound">utxo</a><a id="6373" class="Symbol">))</a>

  <a id="TransactionStructure.refScripts"></a><a id="6379" href="Ledger.Transaction.html#6379" class="Function">refScripts</a> <a id="6390" class="Symbol">:</a> <a id="6392" href="Ledger.Transaction.html#5398" class="Record">Tx</a> <a id="6395" class="Symbol">→</a> <a id="6397" href="Ledger.Transaction.html#4053" class="Function">UTxO</a> <a id="6402" class="Symbol">→</a> <a id="6404" href="Ledger.Set.Theory.html#382" class="Function Operator">ℙ</a> <a id="6406" href="Ledger.Script.html#6019" class="Function">Script</a>
  <a id="6415" href="Ledger.Transaction.html#6379" class="Function">refScripts</a> <a id="6426" href="Ledger.Transaction.html#6426" class="Bound">tx</a> <a id="6429" href="Ledger.Transaction.html#6429" class="Bound">utxo</a> <a id="6434" class="Symbol">=</a>
    <a id="6440" href="Axiom.Set.html#7518" class="Function">mapPartial</a> <a id="6451" class="Symbol">(</a><a id="6452" href="Data.Product.Base.html#650" class="Field">proj₂</a> <a id="6458" href="Function.Base.html#1115" class="Function Operator">∘</a> <a id="6460" href="Data.Product.Base.html#650" class="Field">proj₂</a> <a id="6466" href="Function.Base.html#1115" class="Function Operator">∘</a> <a id="6468" href="Data.Product.Base.html#650" class="Field">proj₂</a><a id="6473" class="Symbol">)</a> <a id="6475" class="Symbol">(</a><a id="6476" href="Interface.IsSet.html#977" class="Function">range</a> <a id="6482" class="Symbol">(</a><a id="6483" href="Ledger.Transaction.html#6429" class="Bound">utxo</a> <a id="6488" href="Axiom.Set.Map.html#10107" class="Function Operator">∣</a> <a id="6490" class="Symbol">(</a><a id="6491" href="Ledger.Transaction.html#4387" class="Function">txins</a> <a id="6497" href="Axiom.Set.html#8665" class="Function Operator">∪</a> <a id="6499" href="Ledger.Transaction.html#4417" class="Function">refInputs</a><a id="6508" class="Symbol">)))</a>
    <a id="6516" class="Keyword">where</a> <a id="6522" class="Keyword">open</a> <a id="6527" href="Ledger.Transaction.html#5398" class="Module">Tx</a><a id="6529" class="Symbol">;</a> <a id="6531" class="Keyword">open</a> <a id="6536" href="Ledger.Transaction.html#4297" class="Module">TxBody</a> <a id="6543" class="Symbol">(</a><a id="6544" href="Ledger.Transaction.html#6426" class="Bound">tx</a> <a id="6547" class="Symbol">.</a><a id="6548" href="Ledger.Transaction.html#5484" class="Field">body</a><a id="6552" class="Symbol">)</a>

  <a id="TransactionStructure.txscripts"></a><a id="6557" href="Ledger.Transaction.html#6557" class="Function">txscripts</a> <a id="6567" class="Symbol">:</a> <a id="6569" href="Ledger.Transaction.html#5398" class="Record">Tx</a> <a id="6572" class="Symbol">→</a> <a id="6574" href="Ledger.Transaction.html#4053" class="Function">UTxO</a> <a id="6579" class="Symbol">→</a> <a id="6581" href="Ledger.Set.Theory.html#382" class="Function Operator">ℙ</a> <a id="6583" href="Ledger.Script.html#6019" class="Function">Script</a>
  <a id="6592" href="Ledger.Transaction.html#6557" class="Function">txscripts</a> <a id="6602" href="Ledger.Transaction.html#6602" class="Bound">tx</a> <a id="6605" href="Ledger.Transaction.html#6605" class="Bound">utxo</a> <a id="6610" class="Symbol">=</a> <a id="6612" href="Ledger.Transaction.html#5217" class="Field">scripts</a> <a id="6620" class="Symbol">(</a><a id="6621" href="Ledger.Transaction.html#6602" class="Bound">tx</a> <a id="6624" class="Symbol">.</a><a id="6625" href="Ledger.Transaction.html#5508" class="Field">wits</a><a id="6629" class="Symbol">)</a> <a id="6631" href="Axiom.Set.html#8665" class="Function Operator">∪</a> <a id="6633" href="Ledger.Transaction.html#6379" class="Function">refScripts</a> <a id="6644" href="Ledger.Transaction.html#6602" class="Bound">tx</a> <a id="6647" href="Ledger.Transaction.html#6605" class="Bound">utxo</a>
    <a id="6656" class="Keyword">where</a> <a id="6662" class="Keyword">open</a> <a id="6667" href="Ledger.Transaction.html#5398" class="Module">Tx</a><a id="6669" class="Symbol">;</a> <a id="6671" class="Keyword">open</a> <a id="6676" href="Ledger.Transaction.html#5094" class="Module">TxWitnesses</a>

  <a id="TransactionStructure.lookupScriptHash"></a><a id="6691" href="Ledger.Transaction.html#6691" class="Function">lookupScriptHash</a> <a id="6708" class="Symbol">:</a> <a id="6710" href="Ledger.Crypto.html#1525" class="Function">ScriptHash</a> <a id="6721" class="Symbol">→</a> <a id="6723" href="Ledger.Transaction.html#5398" class="Record">Tx</a> <a id="6726" class="Symbol">→</a> <a id="6728" href="Ledger.Transaction.html#4053" class="Function">UTxO</a> <a id="6733" class="Symbol">→</a> <a id="6735" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="6741" href="Ledger.Script.html#6019" class="Function">Script</a>
  <a id="6750" href="Ledger.Transaction.html#6691" class="Function">lookupScriptHash</a> <a id="6767" href="Ledger.Transaction.html#6767" class="Bound">sh</a> <a id="6770" href="Ledger.Transaction.html#6770" class="Bound">tx</a> <a id="6773" href="Ledger.Transaction.html#6773" class="Bound">utxo</a> <a id="6778" class="Symbol">=</a>
    <a id="6784" href="Interface.ToBool.html#287" class="Function Operator">if</a> <a id="6787" href="Ledger.Transaction.html#6767" class="Bound">sh</a> <a id="6790" href="Interface.IsSet.html#476" class="Function Operator">∈</a> <a id="6792" href="Ledger.Set.Theory.html#413" class="Function">mapˢ</a> <a id="6797" href="Data.Product.Base.html#636" class="Field">proj₁</a> <a id="6803" class="Symbol">(</a><a id="6804" href="Ledger.Transaction.html#6873" class="Function">m</a> <a id="6806" href="Axiom.Set.Map.html#2282" class="Function Operator">ˢ</a><a id="6807" class="Symbol">)</a> <a id="6809" href="Interface.ToBool.html#287" class="Function Operator">then</a>
      <a id="6820" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="6825" class="Symbol">(</a><a id="6826" href="Axiom.Set.Map.html#12498" class="Function">lookupᵐ</a> <a id="6834" href="Ledger.Transaction.html#6873" class="Function">m</a> <a id="6836" href="Ledger.Transaction.html#6767" class="Bound">sh</a><a id="6838" class="Symbol">)</a>
    <a id="6844" href="Interface.ToBool.html#287" class="Function Operator">else</a>
      <a id="6855" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a>
    <a id="6867" class="Keyword">where</a> <a id="6873" href="Ledger.Transaction.html#6873" class="Function">m</a> <a id="6875" class="Symbol">=</a> <a id="6877" href="Ledger.Set.HashMap.html#295" class="Function">setToHashMap</a> <a id="6890" class="Symbol">(</a><a id="6891" href="Ledger.Transaction.html#6557" class="Function">txscripts</a> <a id="6901" href="Ledger.Transaction.html#6770" class="Bound">tx</a> <a id="6904" href="Ledger.Transaction.html#6773" class="Bound">utxo</a><a id="6908" class="Symbol">)</a>
<a id="6910" class="Markup">\end{code}</a><a id="6920" class="Background">
\end{AgdaMultiCode}
\caption{Functions related to transactions}
\label{fig:defs:transaction-funs}
\end{figure*}
\end{NoConway}

</a><a id="7049" class="Markup">\begin{code}[hide]</a>
  <a id="TransactionStructure.isP2Script"></a><a id="7070" href="Ledger.Transaction.html#7070" class="Function">isP2Script</a> <a id="7081" class="Symbol">:</a> <a id="7083" href="Ledger.Script.html#6019" class="Function">Script</a> <a id="7090" class="Symbol">→</a> <a id="7092" href="Agda.Builtin.Bool.html#173" class="Datatype">Bool</a>
  <a id="7099" href="Ledger.Transaction.html#7070" class="Function">isP2Script</a> <a id="7110" class="Symbol">=</a> <a id="7112" href="Data.Maybe.Base.html#1110" class="Function">is-just</a> <a id="7120" href="Function.Base.html#1115" class="Function Operator">∘</a> <a id="7122" href="Data.Sum.html#1056" class="Function">isInj₂</a>

  <a id="7132" class="Keyword">instance</a>
    <a id="TransactionStructure.HasCoin-TxOut"></a><a id="7145" href="Ledger.Transaction.html#7145" class="Function">HasCoin-TxOut</a> <a id="7159" class="Symbol">:</a> <a id="7161" href="Ledger.Interface.HasCoin.html#124" class="Record">HasCoin</a> <a id="7169" href="Ledger.Transaction.html#3985" class="Function">TxOut</a>
    <a id="7179" href="Ledger.Transaction.html#7145" class="Function">HasCoin-TxOut</a> <a id="7193" class="Symbol">.</a><a id="7194" href="Ledger.Interface.HasCoin.html#172" class="Field">getCoin</a> <a id="7202" class="Symbol">=</a> <a id="7204" href="Ledger.TokenAlgebra.html#1233" class="Function">coin</a> <a id="7209" href="Function.Base.html#1115" class="Function Operator">∘</a> <a id="7211" href="Data.Product.Base.html#636" class="Field">proj₁</a> <a id="7217" href="Function.Base.html#1115" class="Function Operator">∘</a> <a id="7219" href="Data.Product.Base.html#650" class="Field">proj₂</a>

<a id="7226" class="Markup">\end{code}</a><a id="7236" class="Background">
</a></pre></body></html>