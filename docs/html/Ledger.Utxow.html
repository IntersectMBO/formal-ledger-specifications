<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>Ledger.Utxow</title><link rel="stylesheet" href="Agda.css"></head><body><pre class="Agda"><a id="1" class="Background">\subsection{Witnessing}
</a><a id="25" class="Markup">\begin{code}[hide]</a>
<a id="44" class="Symbol">{-#</a> <a id="48" class="Keyword">OPTIONS</a> <a id="56" class="Pragma">--safe</a> <a id="63" class="Symbol">#-}</a>

<a id="68" class="Keyword">open</a> <a id="73" class="Keyword">import</a> <a id="80" href="Ledger.Prelude.html" class="Module">Ledger.Prelude</a> <a id="95" class="Keyword">hiding</a> <a id="102" class="Symbol">(</a><a id="103" href="Function.Base.html#1115" class="Function Operator">_∘_</a><a id="106" class="Symbol">)</a> <a id="108" class="Keyword">renaming</a> <a id="117" class="Symbol">(</a><a id="118" href="Function.Base.html#1303" class="Function Operator">_∘₂_</a> <a id="123" class="Symbol">to</a> <a id="126" class="Function Operator">_∘_</a><a id="129" class="Symbol">)</a>
<a id="131" class="Keyword">open</a> <a id="136" class="Keyword">import</a> <a id="143" href="Ledger.Crypto.html" class="Module">Ledger.Crypto</a>
<a id="157" class="Keyword">open</a> <a id="162" class="Keyword">import</a> <a id="169" href="Ledger.Abstract.html" class="Module">Ledger.Abstract</a>
<a id="185" class="Keyword">open</a> <a id="190" class="Keyword">import</a> <a id="197" href="Ledger.Transaction.html" class="Module">Ledger.Transaction</a>

<a id="217" class="Keyword">module</a> <a id="224" href="Ledger.Utxow.html" class="Module">Ledger.Utxow</a>
  <a id="239" class="Symbol">(</a><a id="240" href="Ledger.Utxow.html#240" class="Bound">txs</a> <a id="244" class="Symbol">:</a> <a id="246" class="Symbol">_)</a> <a id="249" class="Symbol">(</a><a id="250" class="Keyword">open</a> <a id="255" href="Ledger.Transaction.html#933" class="Module">TransactionStructure</a> <a id="276" href="Ledger.Utxow.html#240" class="Bound">txs</a><a id="279" class="Symbol">)</a>
  <a id="283" class="Symbol">(</a><a id="284" href="Ledger.Utxow.html#284" class="Bound">abs</a> <a id="288" class="Symbol">:</a> <a id="290" href="Ledger.Abstract.html#540" class="Record">AbstractFunctions</a> <a id="308" href="Ledger.Utxow.html#240" class="Bound">txs</a><a id="311" class="Symbol">)</a> <a id="313" class="Symbol">(</a><a id="314" class="Keyword">open</a> <a id="319" href="Ledger.Abstract.html#540" class="Module">AbstractFunctions</a> <a id="337" href="Ledger.Utxow.html#284" class="Bound">abs</a><a id="340" class="Symbol">)</a>
  <a id="344" class="Keyword">where</a>
<a id="350" class="Keyword">open</a> <a id="355" class="Keyword">import</a> <a id="362" href="Ledger.Utxo.html" class="Module">Ledger.Utxo</a> <a id="374" href="Ledger.Utxow.html#240" class="Bound">txs</a> <a id="378" href="Ledger.Utxow.html#284" class="Bound">abs</a>
<a id="382" class="Keyword">open</a> <a id="387" class="Keyword">import</a> <a id="394" href="Ledger.ScriptValidation.html" class="Module">Ledger.ScriptValidation</a> <a id="418" href="Ledger.Utxow.html#240" class="Bound">txs</a> <a id="422" href="Ledger.Utxow.html#284" class="Bound">abs</a>
<a id="426" class="Markup">\end{code}</a><a id="436" class="Background">

The purpose of witnessing is make sure the intended action is
authorized by the holder of the signing key.  (For details see
the Formal Ledger Specification for the Shelley Era~\cite[Sec.~8.3]{cardano_shelley_ledger}.)
Figure~\ref{fig:functions:utxow} defines functions used for witnessing.
\witsVKeyNeeded and \scriptsNeeded are now defined by projecting the same information out of
\credsNeeded. Note that the last component of \credsNeeded adds the script in the proposal policy
only if it is present.

\allowedLanguages has additional conditions for new features in
Conway. If a transaction contains any votes, proposals, a treasury
donation or asserts the treasury amount, it is only allowed to contain
Plutus V3 scripts. Additionally, the presence of reference scripts or
inline scripts does not prevent Plutus V1 scripts from being used in a
transaction anymore. Only inline datums are now disallowed from
appearing together with a Plutus V1 script.

\begin{figure*}[h]
\begin{AgdaMultiCode}
</a><a id="1437" class="Markup">\begin{code}[hide]</a>
<a id="1456" class="Keyword">module</a> <a id="1463" href="Ledger.Utxow.html#1463" class="Module">_</a> <a id="1465" class="Symbol">(</a><a id="1466" href="Ledger.Utxow.html#1466" class="Bound">o</a> <a id="1468" class="Symbol">:</a> <a id="1470" href="Ledger.Transaction.html#3814" class="Function">TxOut</a><a id="1475" class="Symbol">)</a> <a id="1477" class="Keyword">where</a>
  <a id="1485" href="Ledger.Utxow.html#1485" class="Function">d</a> <a id="1487" class="Symbol">=</a> <a id="1489" href="Data.Product.Base.html#636" class="Field">proj₁</a> <a id="1495" class="Symbol">(</a><a id="1496" href="Data.Product.Base.html#650" class="Field">proj₂</a> <a id="1502" class="Symbol">(</a><a id="1503" href="Data.Product.Base.html#650" class="Field">proj₂</a> <a id="1509" href="Ledger.Utxow.html#1466" class="Bound">o</a><a id="1510" class="Symbol">))</a>
  <a id="1515" class="Keyword">data</a> <a id="1520" href="Ledger.Utxow.html#1520" class="Datatype">HasInlineDatum</a> <a id="1535" class="Symbol">:</a> <a id="1537" href="Agda.Primitive.html#388" class="Primitive">Set</a> <a id="1541" class="Keyword">where</a>
    <a id="1551" href="Ledger.Utxow.html#1551" class="InductiveConstructor">InlineDatum</a>  <a id="1564" class="Symbol">:</a> <a id="1566" class="Symbol">∀</a> <a id="1568" class="Symbol">{</a><a id="1569" href="Ledger.Utxow.html#1569" class="Bound">d&#39;</a><a id="1571" class="Symbol">}</a> <a id="1573" class="Symbol">→</a> <a id="1575" href="Ledger.Utxow.html#1485" class="Function">d</a> <a id="1577" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="1579" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="1584" class="Symbol">(</a><a id="1585" href="Data.Sum.Base.html#675" class="InductiveConstructor">inj₁</a> <a id="1590" href="Ledger.Utxow.html#1569" class="Bound">d&#39;</a><a id="1592" class="Symbol">)</a> <a id="1594" class="Symbol">→</a> <a id="1596" href="Ledger.Utxow.html#1520" class="Datatype">HasInlineDatum</a>

<a id="1612" class="Keyword">instance</a>
  <a id="Dec-HasInlineDatum"></a><a id="1623" href="Ledger.Utxow.html#1623" class="Function">Dec-HasInlineDatum</a> <a id="1642" class="Symbol">:</a> <a id="1644" class="Symbol">∀</a> <a id="1646" class="Symbol">{</a><a id="1647" href="Ledger.Utxow.html#1647" class="Bound">o</a><a id="1648" class="Symbol">}</a> <a id="1650" class="Symbol">→</a> <a id="1652" href="Ledger.Utxow.html#1520" class="Datatype">HasInlineDatum</a> <a id="1667" href="Ledger.Utxow.html#1647" class="Bound">o</a> <a id="1669" href="Class.Decidable.Core.html#208" class="Record Operator">⁇</a>
  <a id="1673" href="Ledger.Utxow.html#1623" class="Function">Dec-HasInlineDatum</a> <a id="1692" class="Symbol">{_</a> <a id="1695" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1697" class="Symbol">_</a> <a id="1699" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1701" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="1706" class="Symbol">(</a><a id="1707" href="Data.Sum.Base.html#675" class="InductiveConstructor">inj₁</a> <a id="1712" href="Ledger.Utxow.html#1712" class="Bound">x</a><a id="1713" class="Symbol">)</a> <a id="1715" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1717" class="Symbol">_}</a> <a id="1720" class="Symbol">=</a> <a id="1722" href="Class.Decidable.Core.html#253" class="InductiveConstructor Operator">⁇</a> <a id="1724" href="Relation.Nullary.Decidable.Core.html#1618" class="InductiveConstructor">yes</a> <a id="1728" class="Symbol">(</a><a id="1729" href="Ledger.Utxow.html#1551" class="InductiveConstructor">InlineDatum</a> <a id="1741" href="Agda.Builtin.Equality.html#207" class="InductiveConstructor">refl</a><a id="1745" class="Symbol">)</a>
  <a id="1749" href="Ledger.Utxow.html#1623" class="Function">Dec-HasInlineDatum</a> <a id="1768" class="Symbol">{_</a> <a id="1771" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1773" class="Symbol">_</a> <a id="1775" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1777" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="1782" class="Symbol">(</a><a id="1783" href="Data.Sum.Base.html#700" class="InductiveConstructor">inj₂</a> <a id="1788" href="Ledger.Utxow.html#1788" class="Bound">x</a><a id="1789" class="Symbol">)</a> <a id="1791" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1793" class="Symbol">_}</a> <a id="1796" class="Symbol">=</a> <a id="1798" href="Class.Decidable.Core.html#253" class="InductiveConstructor Operator">⁇</a> <a id="1800" href="Relation.Nullary.Decidable.Core.html#1655" class="InductiveConstructor">no</a> <a id="1803" class="Symbol">λ</a> <a id="1805" class="Keyword">where</a>
    <a id="1815" class="Symbol">(</a><a id="1816" href="Ledger.Utxow.html#1551" class="InductiveConstructor">InlineDatum</a> <a id="1828" href="Ledger.Utxow.html#1828" class="Bound">x</a><a id="1829" class="Symbol">)</a> <a id="1831" class="Symbol">→</a> <a id="1833" href="Function.Base.html#4042" class="Function Operator">case</a> <a id="1838" href="Ledger.Utxow.html#1828" class="Bound">x</a> <a id="1840" href="Function.Base.html#4042" class="Function Operator">of</a> <a id="1843" class="Symbol">λ</a> <a id="1845" class="Symbol">()</a>
  <a id="1850" href="Ledger.Utxow.html#1623" class="Function">Dec-HasInlineDatum</a> <a id="1869" class="Symbol">{_</a> <a id="1872" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1874" class="Symbol">_</a> <a id="1876" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1878" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a> <a id="1886" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1888" class="Symbol">_}</a> <a id="1891" class="Symbol">=</a> <a id="1893" href="Class.Decidable.Core.html#253" class="InductiveConstructor Operator">⁇</a> <a id="1895" href="Relation.Nullary.Decidable.Core.html#1655" class="InductiveConstructor">no</a> <a id="1898" class="Symbol">λ</a> <a id="1900" class="Keyword">where</a>
    <a id="1910" class="Symbol">(</a><a id="1911" href="Ledger.Utxow.html#1551" class="InductiveConstructor">InlineDatum</a> <a id="1923" href="Ledger.Utxow.html#1923" class="Bound">x</a><a id="1924" class="Symbol">)</a> <a id="1926" class="Symbol">→</a> <a id="1928" href="Function.Base.html#4042" class="Function Operator">case</a> <a id="1933" href="Ledger.Utxow.html#1923" class="Bound">x</a> <a id="1935" href="Function.Base.html#4042" class="Function Operator">of</a> <a id="1938" class="Symbol">λ</a> <a id="1940" class="Symbol">()</a>

<a id="1944" class="Keyword">module</a> <a id="1951" href="Ledger.Utxow.html#1951" class="Module">_</a> <a id="1953" class="Symbol">(</a><a id="1954" href="Ledger.Utxow.html#1954" class="Bound">txb</a> <a id="1958" class="Symbol">:</a> <a id="1960" href="Ledger.Transaction.html#4126" class="Record">TxBody</a><a id="1966" class="Symbol">)</a> <a id="1968" class="Symbol">(</a><a id="1969" class="Keyword">let</a> <a id="1973" class="Keyword">open</a> <a id="1978" href="Ledger.Transaction.html#4126" class="Module">TxBody</a> <a id="1985" href="Ledger.Utxow.html#1954" class="Bound">txb</a><a id="1988" class="Symbol">)</a> <a id="1990" class="Keyword">where</a>
  <a id="1998" class="Keyword">data</a> <a id="2003" href="Ledger.Utxow.html#2003" class="Datatype">UsesV3Features</a> <a id="2018" class="Symbol">:</a> <a id="2020" href="Agda.Primitive.html#388" class="Primitive">Set</a> <a id="2024" class="Keyword">where</a>
    <a id="2034" href="Ledger.Utxow.html#2034" class="InductiveConstructor">HasVotes</a> <a id="2043" class="Symbol">:</a> <a id="2045" href="Ledger.Transaction.html#4476" class="Field">txvote</a> <a id="2052" href="Relation.Binary.PropositionalEquality.Core.html#858" class="Function Operator">≢</a> <a id="2054" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a> <a id="2057" class="Symbol">→</a> <a id="2059" href="Ledger.Utxow.html#2003" class="Datatype">UsesV3Features</a>
    <a id="2078" href="Ledger.Utxow.html#2078" class="InductiveConstructor">HasProps</a> <a id="2087" class="Symbol">:</a> <a id="2089" href="Ledger.Transaction.html#4512" class="Field">txprop</a> <a id="2096" href="Relation.Binary.PropositionalEquality.Core.html#858" class="Function Operator">≢</a> <a id="2098" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a> <a id="2101" class="Symbol">→</a> <a id="2103" href="Ledger.Utxow.html#2003" class="Datatype">UsesV3Features</a>
    <a id="2122" href="Ledger.Utxow.html#2122" class="InductiveConstructor">HasDonation</a> <a id="2134" class="Symbol">:</a> <a id="2136" href="Ledger.Transaction.html#4552" class="Field">txdonation</a> <a id="2147" href="Relation.Binary.PropositionalEquality.Core.html#858" class="Function Operator">≢</a> <a id="2149" class="Number">0</a> <a id="2151" class="Symbol">→</a> <a id="2153" href="Ledger.Utxow.html#2003" class="Datatype">UsesV3Features</a>
    <a id="2172" href="Ledger.Utxow.html#2172" class="InductiveConstructor">HasTreasury</a> <a id="2184" class="Symbol">:</a> <a id="2186" href="Ledger.Transaction.html#4689" class="Field">curTreasury</a> <a id="2198" href="Relation.Binary.PropositionalEquality.Core.html#858" class="Function Operator">≢</a> <a id="2200" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a> <a id="2208" class="Symbol">→</a> <a id="2210" href="Ledger.Utxow.html#2003" class="Datatype">UsesV3Features</a>

<a id="2226" class="Keyword">instance</a>
  <a id="Dec-UsesV3Features"></a><a id="2237" href="Ledger.Utxow.html#2237" class="Function">Dec-UsesV3Features</a> <a id="2256" class="Symbol">:</a> <a id="2258" class="Symbol">∀</a> <a id="2260" class="Symbol">{</a><a id="2261" href="Ledger.Utxow.html#2261" class="Bound">txb</a><a id="2264" class="Symbol">}</a> <a id="2266" class="Symbol">→</a> <a id="2268" href="Ledger.Utxow.html#2003" class="Datatype">UsesV3Features</a> <a id="2283" href="Ledger.Utxow.html#2261" class="Bound">txb</a> <a id="2287" href="Class.Decidable.Core.html#208" class="Record Operator">⁇</a>
  <a id="2291" href="Ledger.Utxow.html#2237" class="Function">Dec-UsesV3Features</a> <a id="2310" class="Symbol">{</a><a id="2311" class="Keyword">record</a> <a id="2318" class="Symbol">{</a> <a id="2320" href="Ledger.Transaction.html#4476" class="Field">txvote</a> <a id="2327" class="Symbol">=</a> <a id="2329" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a> <a id="2332" class="Symbol">;</a> <a id="2334" href="Ledger.Transaction.html#4512" class="Field">txprop</a> <a id="2341" class="Symbol">=</a> <a id="2343" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a> <a id="2346" class="Symbol">;</a> <a id="2348" href="Ledger.Transaction.html#4552" class="Field">txdonation</a> <a id="2359" class="Symbol">=</a> <a id="2361" href="Agda.Builtin.Nat.html#221" class="InductiveConstructor">zero</a> <a id="2366" class="Symbol">;</a> <a id="2368" href="Ledger.Transaction.html#4689" class="Field">curTreasury</a> <a id="2380" class="Symbol">=</a> <a id="2382" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a> <a id="2390" class="Symbol">}}</a>
    <a id="2397" class="Symbol">=</a> <a id="2399" href="Class.Decidable.Core.html#253" class="InductiveConstructor Operator">⁇</a> <a id="2401" href="Relation.Nullary.Decidable.Core.html#1655" class="InductiveConstructor">no</a> <a id="2404" class="Symbol">λ</a> <a id="2406" class="Keyword">where</a> <a id="2412" class="Symbol">(</a><a id="2413" href="Ledger.Utxow.html#2034" class="InductiveConstructor">HasVotes</a> <a id="2422" href="Ledger.Utxow.html#2422" class="Bound">x</a><a id="2423" class="Symbol">)</a>    <a id="2428" class="Symbol">→</a> <a id="2430" href="Ledger.Utxow.html#2422" class="Bound">x</a> <a id="2432" href="Agda.Builtin.Equality.html#207" class="InductiveConstructor">refl</a>
                   <a id="2456" class="Symbol">(</a><a id="2457" href="Ledger.Utxow.html#2078" class="InductiveConstructor">HasProps</a> <a id="2466" href="Ledger.Utxow.html#2466" class="Bound">x</a><a id="2467" class="Symbol">)</a>    <a id="2472" class="Symbol">→</a> <a id="2474" href="Ledger.Utxow.html#2466" class="Bound">x</a> <a id="2476" href="Agda.Builtin.Equality.html#207" class="InductiveConstructor">refl</a>
                   <a id="2500" class="Symbol">(</a><a id="2501" href="Ledger.Utxow.html#2122" class="InductiveConstructor">HasDonation</a> <a id="2513" href="Ledger.Utxow.html#2513" class="Bound">x</a><a id="2514" class="Symbol">)</a> <a id="2516" class="Symbol">→</a> <a id="2518" href="Ledger.Utxow.html#2513" class="Bound">x</a> <a id="2520" href="Agda.Builtin.Equality.html#207" class="InductiveConstructor">refl</a>
                   <a id="2544" class="Symbol">(</a><a id="2545" href="Ledger.Utxow.html#2172" class="InductiveConstructor">HasTreasury</a> <a id="2557" href="Ledger.Utxow.html#2557" class="Bound">x</a><a id="2558" class="Symbol">)</a> <a id="2560" class="Symbol">→</a> <a id="2562" href="Ledger.Utxow.html#2557" class="Bound">x</a> <a id="2564" href="Agda.Builtin.Equality.html#207" class="InductiveConstructor">refl</a>
  <a id="2571" href="Ledger.Utxow.html#2237" class="Function">Dec-UsesV3Features</a> <a id="2590" class="Symbol">{</a><a id="2591" class="Keyword">record</a> <a id="2598" class="Symbol">{</a> <a id="2600" href="Ledger.Transaction.html#4476" class="Field">txvote</a> <a id="2607" class="Symbol">=</a> <a id="2609" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a> <a id="2612" class="Symbol">;</a> <a id="2614" href="Ledger.Transaction.html#4512" class="Field">txprop</a> <a id="2621" class="Symbol">=</a> <a id="2623" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a> <a id="2626" class="Symbol">;</a> <a id="2628" href="Ledger.Transaction.html#4552" class="Field">txdonation</a> <a id="2639" class="Symbol">=</a> <a id="2641" href="Agda.Builtin.Nat.html#221" class="InductiveConstructor">zero</a> <a id="2646" class="Symbol">;</a> <a id="2648" href="Ledger.Transaction.html#4689" class="Field">curTreasury</a> <a id="2660" class="Symbol">=</a> <a id="2662" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="2667" href="Ledger.Utxow.html#2667" class="Bound">x</a> <a id="2669" class="Symbol">}}</a>
    <a id="2676" class="Symbol">=</a> <a id="2678" href="Class.Decidable.Core.html#253" class="InductiveConstructor Operator">⁇</a> <a id="2680" href="Relation.Nullary.Decidable.Core.html#1618" class="InductiveConstructor">yes</a> <a id="2684" class="Symbol">(</a><a id="2685" href="Ledger.Utxow.html#2172" class="InductiveConstructor">HasTreasury</a> <a id="2697" class="Symbol">(λ</a> <a id="2700" class="Symbol">()))</a>
  <a id="2707" href="Ledger.Utxow.html#2237" class="Function">Dec-UsesV3Features</a> <a id="2726" class="Symbol">{</a><a id="2727" class="Keyword">record</a> <a id="2734" class="Symbol">{</a> <a id="2736" href="Ledger.Transaction.html#4476" class="Field">txvote</a> <a id="2743" class="Symbol">=</a> <a id="2745" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a> <a id="2748" class="Symbol">;</a> <a id="2750" href="Ledger.Transaction.html#4512" class="Field">txprop</a> <a id="2757" class="Symbol">=</a> <a id="2759" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a> <a id="2762" class="Symbol">;</a> <a id="2764" href="Ledger.Transaction.html#4552" class="Field">txdonation</a> <a id="2775" class="Symbol">=</a> <a id="2777" href="Agda.Builtin.Nat.html#234" class="InductiveConstructor">suc</a> <a id="2781" href="Ledger.Utxow.html#2781" class="Bound">txdonation</a> <a id="2792" class="Symbol">}}</a>
    <a id="2799" class="Symbol">=</a> <a id="2801" href="Class.Decidable.Core.html#253" class="InductiveConstructor Operator">⁇</a> <a id="2803" href="Relation.Nullary.Decidable.Core.html#1618" class="InductiveConstructor">yes</a> <a id="2807" class="Symbol">(</a><a id="2808" href="Ledger.Utxow.html#2122" class="InductiveConstructor">HasDonation</a> <a id="2820" class="Symbol">(λ</a> <a id="2823" class="Symbol">()))</a>
  <a id="2830" href="Ledger.Utxow.html#2237" class="Function">Dec-UsesV3Features</a> <a id="2849" class="Symbol">{</a><a id="2850" class="Keyword">record</a> <a id="2857" class="Symbol">{</a> <a id="2859" href="Ledger.Transaction.html#4476" class="Field">txvote</a> <a id="2866" class="Symbol">=</a> <a id="2868" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a> <a id="2871" class="Symbol">;</a> <a id="2873" href="Ledger.Transaction.html#4512" class="Field">txprop</a> <a id="2880" class="Symbol">=</a> <a id="2882" href="Ledger.Utxow.html#2882" class="Bound">x</a> <a id="2884" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="2886" href="Ledger.Utxow.html#2886" class="Bound">txprop</a> <a id="2893" class="Symbol">}}</a> <a id="2896" class="Symbol">=</a> <a id="2898" href="Class.Decidable.Core.html#253" class="InductiveConstructor Operator">⁇</a> <a id="2900" href="Relation.Nullary.Decidable.Core.html#1618" class="InductiveConstructor">yes</a> <a id="2904" class="Symbol">(</a><a id="2905" href="Ledger.Utxow.html#2078" class="InductiveConstructor">HasProps</a> <a id="2914" class="Symbol">(λ</a> <a id="2917" class="Symbol">()))</a>
  <a id="2924" href="Ledger.Utxow.html#2237" class="Function">Dec-UsesV3Features</a> <a id="2943" class="Symbol">{</a><a id="2944" class="Keyword">record</a> <a id="2951" class="Symbol">{</a> <a id="2953" href="Ledger.Transaction.html#4476" class="Field">txvote</a> <a id="2960" class="Symbol">=</a> <a id="2962" href="Ledger.Utxow.html#2962" class="Bound">x</a> <a id="2964" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="2966" href="Ledger.Utxow.html#2966" class="Bound">txvote</a> <a id="2973" class="Symbol">}}</a> <a id="2976" class="Symbol">=</a> <a id="2978" href="Class.Decidable.Core.html#253" class="InductiveConstructor Operator">⁇</a> <a id="2980" href="Relation.Nullary.Decidable.Core.html#1618" class="InductiveConstructor">yes</a> <a id="2984" class="Symbol">(</a><a id="2985" href="Ledger.Utxow.html#2034" class="InductiveConstructor">HasVotes</a> <a id="2994" class="Symbol">(λ</a> <a id="2997" class="Symbol">()))</a>

<a id="languages"></a><a id="3003" href="Ledger.Utxow.html#3003" class="Function">languages</a> <a id="3013" class="Symbol">:</a> <a id="3015" href="Ledger.Transaction.html#5227" class="Record">Tx</a> <a id="3018" class="Symbol">→</a> <a id="3020" href="Ledger.Transaction.html#3882" class="Function">UTxO</a> <a id="3025" class="Symbol">→</a> <a id="3027" href="Ledger.Set.Theory.html#382" class="Function Operator">ℙ</a> <a id="3029" href="Ledger.Script.html#1045" class="Function">Language</a>
<a id="3038" href="Ledger.Utxow.html#3003" class="Function">languages</a> <a id="3048" href="Ledger.Utxow.html#3048" class="Bound">tx</a> <a id="3051" href="Ledger.Utxow.html#3051" class="Bound">utxo</a> <a id="3056" class="Symbol">=</a> <a id="3058" href="Axiom.Set.html#7518" class="Function">mapPartial</a> <a id="3069" href="Ledger.Utxow.html#3113" class="Function">getLanguage</a> <a id="3081" class="Symbol">(</a><a id="3082" href="Ledger.Transaction.html#6386" class="Function">txscripts</a> <a id="3092" href="Ledger.Utxow.html#3048" class="Bound">tx</a> <a id="3095" href="Ledger.Utxow.html#3051" class="Bound">utxo</a><a id="3099" class="Symbol">)</a>
  <a id="3103" class="Keyword">where</a>
    <a id="3113" href="Ledger.Utxow.html#3113" class="Function">getLanguage</a> <a id="3125" class="Symbol">:</a> <a id="3127" href="Ledger.Script.html#6019" class="Function">Script</a> <a id="3134" class="Symbol">→</a> <a id="3136" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="3142" href="Ledger.Script.html#1045" class="Function">Language</a>
    <a id="3155" href="Ledger.Utxow.html#3113" class="Function">getLanguage</a> <a id="3167" class="Symbol">(</a><a id="3168" href="Data.Sum.Base.html#675" class="InductiveConstructor">inj₁</a> <a id="3173" class="Symbol">_)</a> <a id="3176" class="Symbol">=</a> <a id="3178" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a>
    <a id="3190" href="Ledger.Utxow.html#3113" class="Function">getLanguage</a> <a id="3202" class="Symbol">(</a><a id="3203" href="Data.Sum.Base.html#700" class="InductiveConstructor">inj₂</a> <a id="3208" href="Ledger.Utxow.html#3208" class="Bound">s</a><a id="3209" class="Symbol">)</a> <a id="3211" class="Symbol">=</a> <a id="3213" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="3218" class="Symbol">(</a><a id="3219" href="Ledger.Script.html#1908" class="Function">language</a> <a id="3228" href="Ledger.Utxow.html#3208" class="Bound">s</a><a id="3229" class="Symbol">)</a>
<a id="3231" class="Markup">\end{code}</a><a id="3241" class="Background">
</a><a id="3242" class="Markup">\begin{code}</a>
<a id="getVKeys"></a><a id="3255" href="Ledger.Utxow.html#3255" class="Function">getVKeys</a> <a id="3264" class="Symbol">:</a> <a id="3266" href="Ledger.Set.Theory.html#382" class="Function Operator">ℙ</a> <a id="3268" href="Ledger.Address.html#764" class="Datatype">Credential</a> <a id="3279" class="Symbol">→</a> <a id="3281" href="Ledger.Set.Theory.html#382" class="Function Operator">ℙ</a> <a id="3283" href="Ledger.Crypto.html#1629" class="Function">KeyHash</a>
<a id="3291" href="Ledger.Utxow.html#3255" class="Function">getVKeys</a> <a id="3300" class="Symbol">=</a> <a id="3302" href="Axiom.Set.html#7518" class="Function">mapPartial</a> <a id="3313" href="Ledger.Address.html#893" class="Function">isKeyHashObj</a>

<a id="allowedLanguages"></a><a id="3327" href="Ledger.Utxow.html#3327" class="Function">allowedLanguages</a> <a id="3344" class="Symbol">:</a> <a id="3346" href="Ledger.Transaction.html#5227" class="Record">Tx</a> <a id="3349" class="Symbol">→</a> <a id="3351" href="Ledger.Transaction.html#3882" class="Function">UTxO</a> <a id="3356" class="Symbol">→</a> <a id="3358" href="Ledger.Set.Theory.html#382" class="Function Operator">ℙ</a> <a id="3360" href="Ledger.Script.html#1045" class="Function">Language</a>
<a id="3369" href="Ledger.Utxow.html#3327" class="Function">allowedLanguages</a> <a id="3386" href="Ledger.Utxow.html#3386" class="Bound">tx</a> <a id="3389" href="Ledger.Utxow.html#3389" class="Bound">utxo</a> <a id="3394" class="Symbol">=</a>
  <a id="3398" href="Interface.ToBool.html#287" class="Function Operator">if</a> <a id="3401" class="Symbol">(</a><a id="3402" href="Interface.IsSet.html#754" class="Function">∃[</a> <a id="3405" href="Ledger.Utxow.html#3405" class="Bound">o</a> <a id="3407" href="Interface.IsSet.html#754" class="Function">∈</a> <a id="3409" href="Ledger.Utxow.html#3708" class="Function">os</a> <a id="3412" href="Interface.IsSet.html#754" class="Function">]</a> <a id="3414" href="Ledger.Address.html#2959" class="Datatype">isBootstrapAddr</a> <a id="3430" class="Symbol">(</a><a id="3431" href="Data.Product.Base.html#636" class="Field">proj₁</a> <a id="3437" href="Ledger.Utxow.html#3405" class="Bound">o</a><a id="3438" class="Symbol">))</a>
    <a id="3445" href="Interface.ToBool.html#287" class="Function Operator">then</a> <a id="3450" href="Interface.HasEmptySet.html#150" class="Field">∅</a>
  <a id="3454" href="Interface.ToBool.html#287" class="Function Operator">else</a> <a id="3459" href="Interface.ToBool.html#287" class="Function Operator">if</a> <a id="3462" href="Ledger.Utxow.html#2003" class="Datatype">UsesV3Features</a> <a id="3477" href="Ledger.Utxow.html#3669" class="Function">txb</a>
    <a id="3485" href="Interface.ToBool.html#287" class="Function Operator">then</a> <a id="3490" href="Axiom.Set.html#5431" class="Function">fromList</a> <a id="3499" class="Symbol">(</a><a id="3500" href="Ledger.Script.html#1137" class="Function">PlutusV3</a> <a id="3509" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="3511" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a><a id="3513" class="Symbol">)</a>
  <a id="3517" href="Interface.ToBool.html#287" class="Function Operator">else</a> <a id="3522" href="Interface.ToBool.html#287" class="Function Operator">if</a> <a id="3525" href="Interface.IsSet.html#754" class="Function">∃[</a> <a id="3528" href="Ledger.Utxow.html#3528" class="Bound">o</a> <a id="3530" href="Interface.IsSet.html#754" class="Function">∈</a> <a id="3532" href="Ledger.Utxow.html#3708" class="Function">os</a> <a id="3535" href="Interface.IsSet.html#754" class="Function">]</a> <a id="3537" href="Ledger.Utxow.html#1520" class="Datatype">HasInlineDatum</a> <a id="3552" href="Ledger.Utxow.html#3528" class="Bound">o</a>
    <a id="3558" href="Interface.ToBool.html#287" class="Function Operator">then</a> <a id="3563" href="Axiom.Set.html#5431" class="Function">fromList</a> <a id="3572" class="Symbol">(</a><a id="3573" href="Ledger.Script.html#1128" class="Function">PlutusV2</a> <a id="3582" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="3584" href="Ledger.Script.html#1137" class="Function">PlutusV3</a> <a id="3593" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="3595" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a><a id="3597" class="Symbol">)</a>
  <a id="3601" href="Interface.ToBool.html#287" class="Function Operator">else</a>
    <a id="3610" href="Axiom.Set.html#5431" class="Function">fromList</a> <a id="3619" class="Symbol">(</a><a id="3620" href="Ledger.Script.html#1119" class="Function">PlutusV1</a> <a id="3629" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="3631" href="Ledger.Script.html#1128" class="Function">PlutusV2</a> <a id="3640" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="3642" href="Ledger.Script.html#1137" class="Function">PlutusV3</a> <a id="3651" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="3653" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a><a id="3655" class="Symbol">)</a>
  <a id="3659" class="Keyword">where</a>
    <a id="3669" href="Ledger.Utxow.html#3669" class="Function">txb</a> <a id="3673" class="Symbol">=</a> <a id="3675" href="Ledger.Utxow.html#3386" class="Bound">tx</a> <a id="3678" class="Symbol">.</a><a id="3679" href="Ledger.Transaction.html#5313" class="Field">Tx.body</a><a id="3686" class="Symbol">;</a> <a id="3688" class="Keyword">open</a> <a id="3693" href="Ledger.Transaction.html#4126" class="Module">TxBody</a> <a id="3700" href="Ledger.Utxow.html#3669" class="Function">txb</a>
    <a id="3708" href="Ledger.Utxow.html#3708" class="Function">os</a> <a id="3711" class="Symbol">=</a> <a id="3713" href="Interface.IsSet.html#977" class="Function">range</a> <a id="3719" class="Symbol">(</a><a id="3720" href="Ledger.Utxo.html#5869" class="Function">outs</a> <a id="3725" href="Ledger.Utxow.html#3669" class="Function">txb</a><a id="3728" class="Symbol">)</a> <a id="3730" href="Axiom.Set.html#8665" class="Function Operator">∪</a> <a id="3732" href="Interface.IsSet.html#977" class="Function">range</a> <a id="3738" class="Symbol">(</a><a id="3739" href="Ledger.Utxow.html#3389" class="Bound">utxo</a> <a id="3744" href="Axiom.Set.Map.html#10107" class="Function Operator">∣</a> <a id="3746" class="Symbol">(</a><a id="3747" href="Ledger.Transaction.html#4216" class="Function">txins</a> <a id="3753" href="Axiom.Set.html#8665" class="Function Operator">∪</a> <a id="3755" href="Ledger.Transaction.html#4246" class="Function">refInputs</a><a id="3764" class="Symbol">))</a>

<a id="getScripts"></a><a id="3768" href="Ledger.Utxow.html#3768" class="Function">getScripts</a> <a id="3779" class="Symbol">:</a> <a id="3781" href="Ledger.Set.Theory.html#382" class="Function Operator">ℙ</a> <a id="3783" href="Ledger.Address.html#764" class="Datatype">Credential</a> <a id="3794" class="Symbol">→</a> <a id="3796" href="Ledger.Set.Theory.html#382" class="Function Operator">ℙ</a> <a id="3798" href="Ledger.Crypto.html#1525" class="Function">ScriptHash</a>
<a id="3809" href="Ledger.Utxow.html#3768" class="Function">getScripts</a> <a id="3820" class="Symbol">=</a> <a id="3822" href="Axiom.Set.html#7518" class="Function">mapPartial</a> <a id="3833" href="Ledger.Address.html#1011" class="Function">isScriptObj</a>

<a id="credsNeeded"></a><a id="3846" href="Ledger.Utxow.html#3846" class="Function">credsNeeded</a> <a id="3858" class="Symbol">:</a> <a id="3860" href="Ledger.Transaction.html#3882" class="Function">UTxO</a> <a id="3865" class="Symbol">→</a> <a id="3867" href="Ledger.Transaction.html#4126" class="Record">TxBody</a> <a id="3874" class="Symbol">→</a> <a id="3876" href="Ledger.Set.Theory.html#382" class="Function Operator">ℙ</a> <a id="3878" class="Symbol">(</a><a id="3879" href="Ledger.ScriptValidation.html#438" class="Datatype">ScriptPurpose</a> <a id="3893" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="3895" href="Ledger.Address.html#764" class="Datatype">Credential</a><a id="3905" class="Symbol">)</a>
<a id="3907" href="Ledger.Utxow.html#3846" class="Function">credsNeeded</a> <a id="3919" href="Ledger.Utxow.html#3919" class="Bound">utxo</a> <a id="3924" href="Ledger.Utxow.html#3924" class="Bound">txb</a>
  <a id="3930" class="Symbol">=</a>  <a id="3933" href="Ledger.Set.Theory.html#413" class="Function">mapˢ</a> <a id="3938" class="Symbol">(λ</a> <a id="3941" class="Symbol">(</a><a id="3942" href="Ledger.Utxow.html#3942" class="Bound">i</a> <a id="3944" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="3946" href="Ledger.Utxow.html#3946" class="Bound">o</a><a id="3947" class="Symbol">)</a>  <a id="3950" class="Symbol">→</a> <a id="3952" class="Symbol">(</a><a id="3953" href="Ledger.ScriptValidation.html#593" class="InductiveConstructor">Spend</a>  <a id="3960" href="Ledger.Utxow.html#3942" class="Bound">i</a> <a id="3962" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="3964" href="Ledger.Address.html#2302" class="Function">payCred</a> <a id="3972" class="Symbol">(</a><a id="3973" href="Data.Product.Base.html#636" class="Field">proj₁</a> <a id="3979" href="Ledger.Utxow.html#3946" class="Bound">o</a><a id="3980" class="Symbol">)))</a> <a id="3984" class="Symbol">((</a><a id="3986" href="Ledger.Utxow.html#3919" class="Bound">utxo</a> <a id="3991" href="Axiom.Set.Map.html#10107" class="Function Operator">∣</a> <a id="3993" href="Ledger.Transaction.html#4216" class="Field">txins</a><a id="3998" class="Symbol">)</a> <a id="4000" href="Axiom.Set.Map.html#2282" class="Function Operator">ˢ</a><a id="4001" class="Symbol">)</a>
  <a id="4005" href="Axiom.Set.html#8665" class="Function Operator">∪</a>  <a id="4008" href="Ledger.Set.Theory.html#413" class="Function">mapˢ</a> <a id="4013" class="Symbol">(λ</a> <a id="4016" href="Ledger.Utxow.html#4016" class="Bound">a</a>        <a id="4025" class="Symbol">→</a> <a id="4027" class="Symbol">(</a><a id="4028" href="Ledger.ScriptValidation.html#509" class="InductiveConstructor">Rwrd</a>   <a id="4035" href="Ledger.Utxow.html#4016" class="Bound">a</a> <a id="4037" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="4039" href="Ledger.Address.html#1637" class="Field">stake</a> <a id="4045" href="Ledger.Utxow.html#4016" class="Bound">a</a><a id="4046" class="Symbol">))</a> <a id="4049" class="Symbol">(</a><a id="4050" href="Interface.IsSet.html#934" class="Function">dom</a> <a id="4054" class="Symbol">(</a><a id="4055" href="Ledger.Transaction.html#4448" class="Field">txwdrls</a> <a id="4063" class="Symbol">.</a><a id="4064" href="Data.Product.Base.html#636" class="Field">proj₁</a><a id="4069" class="Symbol">))</a>
  <a id="4074" href="Axiom.Set.html#8665" class="Function Operator">∪</a>  <a id="4077" href="Ledger.Set.Theory.html#413" class="Function">mapˢ</a> <a id="4082" class="Symbol">(λ</a> <a id="4085" href="Ledger.Utxow.html#4085" class="Bound">c</a>        <a id="4094" class="Symbol">→</a> <a id="4096" class="Symbol">(</a><a id="4097" href="Ledger.ScriptValidation.html#467" class="InductiveConstructor">Cert</a>   <a id="4104" href="Ledger.Utxow.html#4085" class="Bound">c</a> <a id="4106" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="4108" href="Ledger.Certs.html#1456" class="Function">cwitness</a> <a id="4117" href="Ledger.Utxow.html#4085" class="Bound">c</a><a id="4118" class="Symbol">))</a> <a id="4121" class="Symbol">(</a><a id="4122" href="Axiom.Set.html#5431" class="Function">fromList</a> <a id="4131" href="Ledger.Transaction.html#4414" class="Field">txcerts</a><a id="4138" class="Symbol">)</a>
  <a id="4142" href="Axiom.Set.html#8665" class="Function Operator">∪</a>  <a id="4145" href="Ledger.Set.Theory.html#413" class="Function">mapˢ</a> <a id="4150" class="Symbol">(λ</a> <a id="4153" href="Ledger.Utxow.html#4153" class="Bound">x</a>        <a id="4162" class="Symbol">→</a> <a id="4164" class="Symbol">(</a><a id="4165" href="Ledger.ScriptValidation.html#551" class="InductiveConstructor">Mint</a>   <a id="4172" href="Ledger.Utxow.html#4153" class="Bound">x</a> <a id="4174" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="4176" href="Ledger.Address.html#826" class="InductiveConstructor">ScriptObj</a> <a id="4186" href="Ledger.Utxow.html#4153" class="Bound">x</a><a id="4187" class="Symbol">))</a> <a id="4190" class="Symbol">(</a><a id="4191" href="Ledger.TokenAlgebra.html#1323" class="Function">policies</a> <a id="4200" href="Ledger.Transaction.html#4338" class="Field">mint</a><a id="4204" class="Symbol">)</a>
  <a id="4208" href="Axiom.Set.html#8665" class="Function Operator">∪</a>  <a id="4211" href="Ledger.Set.Theory.html#413" class="Function">mapˢ</a> <a id="4216" class="Symbol">(λ</a> <a id="4219" href="Ledger.Utxow.html#4219" class="Bound">v</a>        <a id="4228" class="Symbol">→</a> <a id="4230" class="Symbol">(</a><a id="4231" href="Ledger.ScriptValidation.html#635" class="InductiveConstructor">Vote</a>   <a id="4238" href="Ledger.Utxow.html#4219" class="Bound">v</a> <a id="4240" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="4242" href="Data.Product.Base.html#650" class="Field">proj₂</a> <a id="4248" href="Ledger.Utxow.html#4219" class="Bound">v</a><a id="4249" class="Symbol">))</a> <a id="4252" class="Symbol">(</a><a id="4253" href="Axiom.Set.html#5431" class="Function">fromList</a> <a id="4262" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="4264" href="Class.Functor.Core.html#263" class="Function">map</a> <a id="4268" href="Ledger.GovernanceActions.html#8405" class="Field">voter</a> <a id="4274" href="Ledger.Transaction.html#4476" class="Field">txvote</a><a id="4280" class="Symbol">)</a>
  <a id="4284" href="Axiom.Set.html#8665" class="Function Operator">∪</a>  <a id="4287" href="Axiom.Set.html#7518" class="Function">mapPartial</a> <a id="4298" class="Symbol">(λ</a> <a id="4301" href="Ledger.Utxow.html#4301" class="Bound">p</a>  <a id="4304" class="Symbol">→</a> <a id="4306" href="Function.Base.html#4042" class="Function Operator">case</a>  <a id="4312" href="Ledger.Utxow.html#4301" class="Bound">p</a> <a id="4314" class="Symbol">.</a><a id="4315" href="Ledger.GovernanceActions.html#8641" class="Field">policy</a> <a id="4322" href="Function.Base.html#4042" class="Function Operator">of</a>
<a id="4325" class="Markup">\end{code}</a><a id="4335" class="Background">
</a><a id="4336" class="Markup">\begin{code}[hide]</a>
    <a id="4359" class="Symbol">λ</a> <a id="4361" class="Keyword">where</a>
<a id="4367" class="Markup">\end{code}</a><a id="4377" class="Background">
</a><a id="4378" class="Markup">\begin{code}</a>
                              <a id="4421" class="Symbol">(</a><a id="4422" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="4427" href="Ledger.Utxow.html#4427" class="Bound">sh</a><a id="4429" class="Symbol">)</a>  <a id="4432" class="Symbol">→</a> <a id="4434" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="4439" class="Symbol">(</a><a id="4440" href="Ledger.ScriptValidation.html#677" class="InductiveConstructor">Propose</a>  <a id="4449" href="Ledger.Utxow.html#4301" class="Bound">p</a> <a id="4451" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="4453" href="Ledger.Address.html#826" class="InductiveConstructor">ScriptObj</a> <a id="4463" href="Ledger.Utxow.html#4427" class="Bound">sh</a><a id="4465" class="Symbol">)</a>
                              <a id="4497" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a>    <a id="4508" class="Symbol">→</a> <a id="4510" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a><a id="4517" class="Symbol">)</a> <a id="4519" class="Symbol">(</a><a id="4520" href="Axiom.Set.html#5431" class="Function">fromList</a> <a id="4529" href="Ledger.Transaction.html#4512" class="Field">txprop</a><a id="4535" class="Symbol">)</a>
<a id="4537" class="Markup">\end{code}</a><a id="4547" class="Background">
</a><a id="4548" class="Markup">\begin{code}[hide]</a>
  <a id="4569" class="Keyword">where</a> <a id="4575" class="Keyword">open</a> <a id="4580" href="Ledger.Transaction.html#4126" class="Module">TxBody</a> <a id="4587" href="Ledger.Utxow.html#3924" class="Bound">txb</a><a id="4590" class="Symbol">;</a> <a id="4592" class="Keyword">open</a> <a id="4597" href="Ledger.GovernanceActions.html#8288" class="Module">GovVote</a><a id="4604" class="Symbol">;</a> <a id="4606" class="Keyword">open</a> <a id="4611" href="Ledger.Address.html#1583" class="Module">RwdAddr</a><a id="4618" class="Symbol">;</a> <a id="4620" class="Keyword">open</a> <a id="4625" href="Ledger.GovernanceActions.html#8487" class="Module">GovProposal</a>
<a id="4637" class="Markup">\end{code}</a><a id="4647" class="Background">
</a><a id="4648" class="Markup">\begin{code}</a>

<a id="witsVKeyNeeded"></a><a id="4662" href="Ledger.Utxow.html#4662" class="Function">witsVKeyNeeded</a> <a id="4677" class="Symbol">:</a> <a id="4679" href="Ledger.Transaction.html#3882" class="Function">UTxO</a> <a id="4684" class="Symbol">→</a> <a id="4686" href="Ledger.Transaction.html#4126" class="Record">TxBody</a> <a id="4693" class="Symbol">→</a> <a id="4695" href="Ledger.Set.Theory.html#382" class="Function Operator">ℙ</a> <a id="4697" href="Ledger.Crypto.html#1629" class="Function">KeyHash</a>
<a id="4705" href="Ledger.Utxow.html#4662" class="Function">witsVKeyNeeded</a> <a id="4720" class="Symbol">=</a> <a id="4722" href="Ledger.Utxow.html#3255" class="Function">getVKeys</a> <a id="4731" href="Ledger.Utxow.html#126" class="Function Operator">∘</a> <a id="4733" href="Ledger.Set.Theory.html#413" class="Function">mapˢ</a> <a id="4738" href="Data.Product.Base.html#650" class="Field">proj₂</a> <a id="4744" href="Ledger.Utxow.html#126" class="Function Operator">∘</a> <a id="4746" href="Ledger.Utxow.html#3846" class="Function">credsNeeded</a>

<a id="scriptsNeeded"></a><a id="4759" href="Ledger.Utxow.html#4759" class="Function">scriptsNeeded</a>  <a id="4774" class="Symbol">:</a> <a id="4776" href="Ledger.Transaction.html#3882" class="Function">UTxO</a> <a id="4781" class="Symbol">→</a> <a id="4783" href="Ledger.Transaction.html#4126" class="Record">TxBody</a> <a id="4790" class="Symbol">→</a> <a id="4792" href="Ledger.Set.Theory.html#382" class="Function Operator">ℙ</a> <a id="4794" href="Ledger.Crypto.html#1525" class="Function">ScriptHash</a>
<a id="4805" href="Ledger.Utxow.html#4759" class="Function">scriptsNeeded</a> <a id="4819" class="Symbol">=</a> <a id="4821" href="Ledger.Utxow.html#3768" class="Function">getScripts</a> <a id="4832" href="Ledger.Utxow.html#126" class="Function Operator">∘</a> <a id="4834" href="Ledger.Set.Theory.html#413" class="Function">mapˢ</a> <a id="4839" href="Data.Product.Base.html#650" class="Field">proj₂</a> <a id="4845" href="Ledger.Utxow.html#126" class="Function Operator">∘</a> <a id="4847" href="Ledger.Utxow.html#3846" class="Function">credsNeeded</a>
<a id="4859" class="Markup">\end{code}</a><a id="4869" class="Background">
\end{AgdaMultiCode}
\caption{Functions used for witnessing}
\label{fig:functions:utxow}
\end{figure*}

\begin{NoConway}
\begin{figure*}[h]
</a><a id="5009" class="Markup">\begin{code}[hide]</a>
<a id="5028" class="Keyword">data</a>
<a id="5033" class="Markup">\end{code}</a><a id="5043" class="Background">
</a><a id="5044" class="Markup">\begin{code}</a>
  <a id="_⊢_⇀⦇_,UTXOW⦈_"></a><a id="5059" href="Ledger.Utxow.html#5059" class="Datatype Operator">_⊢_⇀⦇_,UTXOW⦈_</a> <a id="5074" class="Symbol">:</a> <a id="5076" href="Ledger.Utxo.html#4994" class="Record">UTxOEnv</a> <a id="5084" class="Symbol">→</a> <a id="5086" href="Ledger.Utxo.html#5208" class="Record">UTxOState</a> <a id="5096" class="Symbol">→</a> <a id="5098" href="Ledger.Transaction.html#5227" class="Record">Tx</a> <a id="5101" class="Symbol">→</a> <a id="5103" href="Ledger.Utxo.html#5208" class="Record">UTxOState</a> <a id="5113" class="Symbol">→</a> <a id="5115" href="Agda.Primitive.html#388" class="Primitive">Type</a>
<a id="5120" class="Markup">\end{code}</a><a id="5130" class="Background">
\caption{UTxOW transition-system types}
\label{fig:ts-types:utxow}
\end{figure*}

\begin{figure*}[h]
</a><a id="5232" class="Markup">\begin{code}[hide]</a>
<a id="5251" class="Keyword">private</a> <a id="5259" class="Keyword">variable</a>
  <a id="5270" href="Ledger.Utxow.html#5270" class="Generalizable">Γ</a> <a id="5272" class="Symbol">:</a> <a id="5274" href="Ledger.Utxo.html#4994" class="Record">UTxOEnv</a>
  <a id="5284" href="Ledger.Utxow.html#5284" class="Generalizable">s</a> <a id="5286" href="Ledger.Utxow.html#5286" class="Generalizable">s&#39;</a> <a id="5289" class="Symbol">:</a> <a id="5291" href="Ledger.Utxo.html#5208" class="Record">UTxOState</a>
  <a id="5303" href="Ledger.Utxow.html#5303" class="Generalizable">tx</a> <a id="5306" class="Symbol">:</a> <a id="5308" href="Ledger.Transaction.html#5227" class="Record">Tx</a>

<a id="5312" class="Keyword">data</a> <a id="5317" href="Ledger.Utxow.html#5059" class="Datatype Operator">_⊢_⇀⦇_,UTXOW⦈_</a> <a id="5332" class="Keyword">where</a>
<a id="5338" class="Markup">\end{code}</a><a id="5348" class="Background">
</a><a id="5349" class="Markup">\begin{code}</a>
  <a id="_⊢_⇀⦇_,UTXOW⦈_.UTXOW-inductive"></a><a id="5364" href="Ledger.Utxow.html#5364" class="InductiveConstructor">UTXOW-inductive</a> <a id="5380" class="Symbol">:</a>
    <a id="5386" class="Keyword">let</a> <a id="5390" class="Keyword">open</a> <a id="5395" href="Ledger.Transaction.html#5227" class="Module">Tx</a> <a id="5398" href="Ledger.Utxow.html#5303" class="Generalizable">tx</a> <a id="5401" class="Keyword">renaming</a> <a id="5410" class="Symbol">(</a><a id="5411" href="Ledger.Transaction.html#5313" class="Field">body</a> <a id="5416" class="Symbol">to</a> <a id="5419" class="Field">txb</a><a id="5422" class="Symbol">);</a> <a id="5425" class="Keyword">open</a> <a id="5430" href="Ledger.Transaction.html#4126" class="Module">TxBody</a> <a id="5437" href="Ledger.Utxow.html#5419" class="Function">txb</a><a id="5440" class="Symbol">;</a> <a id="5442" class="Keyword">open</a> <a id="5447" href="Ledger.Transaction.html#4923" class="Module">TxWitnesses</a> <a id="5459" href="Ledger.Transaction.html#5337" class="Function">wits</a>
        <a id="5472" class="Keyword">open</a> <a id="5477" href="Ledger.Utxo.html#5208" class="Module">UTxOState</a> <a id="5487" href="Ledger.Utxow.html#5284" class="Generalizable">s</a>
        <a id="5497" href="Ledger.Utxow.html#5497" class="Bound">witsKeyHashes</a>     <a id="5515" class="Symbol">=</a> <a id="5517" href="Ledger.Set.Theory.html#413" class="Function">mapˢ</a> <a id="5522" href="Interface.Hashable.html#256" class="Field">hash</a> <a id="5527" class="Symbol">(</a><a id="5528" href="Interface.IsSet.html#934" class="Function">dom</a> <a id="5532" href="Ledger.Transaction.html#5018" class="Function">vkSigs</a><a id="5538" class="Symbol">)</a>
        <a id="5548" href="Ledger.Utxow.html#5548" class="Bound">witsScriptHashes</a>  <a id="5566" class="Symbol">=</a> <a id="5568" href="Ledger.Set.Theory.html#413" class="Function">mapˢ</a> <a id="5573" href="Interface.Hashable.html#256" class="Field">hash</a> <a id="5578" href="Ledger.Transaction.html#5046" class="Function">scripts</a>
        <a id="5594" href="Ledger.Utxow.html#5594" class="Bound">inputHashes</a>       <a id="5612" class="Symbol">=</a> <a id="5614" href="Ledger.Utxo.html#1485" class="Function">getInputHashes</a> <a id="5629" href="Ledger.Utxow.html#5303" class="Generalizable">tx</a> <a id="5632" href="Ledger.Utxo.html#5322" class="Function">utxo</a>
        <a id="5645" href="Ledger.Utxow.html#5645" class="Bound">refScriptHashes</a>   <a id="5663" class="Symbol">=</a> <a id="5665" href="Ledger.Set.Theory.html#413" class="Function">mapˢ</a> <a id="5670" href="Interface.Hashable.html#256" class="Field">hash</a> <a id="5675" class="Symbol">(</a><a id="5676" href="Ledger.Transaction.html#6208" class="Function">refScripts</a> <a id="5687" href="Ledger.Utxow.html#5303" class="Generalizable">tx</a> <a id="5690" href="Ledger.Utxo.html#5322" class="Function">utxo</a><a id="5694" class="Symbol">)</a>
        <a id="5704" href="Ledger.Utxow.html#5704" class="Bound">neededHashes</a>      <a id="5722" class="Symbol">=</a> <a id="5724" href="Ledger.Utxow.html#4759" class="Function">scriptsNeeded</a> <a id="5738" href="Ledger.Utxo.html#5322" class="Function">utxo</a> <a id="5743" href="Ledger.Utxow.html#5419" class="Function">txb</a>
        <a id="5755" href="Ledger.Utxow.html#5755" class="Bound">txdatsHashes</a>      <a id="5773" class="Symbol">=</a> <a id="5775" href="Interface.IsSet.html#934" class="Function">dom</a> <a id="5779" href="Ledger.Transaction.html#5072" class="Function">txdats</a>
        <a id="5794" href="Ledger.Utxow.html#5794" class="Bound">allOutHashes</a>      <a id="5812" class="Symbol">=</a> <a id="5814" href="Ledger.Utxo.html#1364" class="Function">getDataHashes</a> <a id="5828" class="Symbol">(</a><a id="5829" href="Interface.IsSet.html#977" class="Function">range</a> <a id="5835" href="Ledger.Transaction.html#4276" class="Function">txouts</a><a id="5841" class="Symbol">)</a>
    <a id="5847" class="Keyword">in</a>
    <a id="5854" href="Interface.STS.html#105" class="Function Operator">∙</a>  <a id="5857" href="Interface.IsSet.html#594" class="Function">∀[</a> <a id="5860" href="Ledger.Utxow.html#5860" class="Bound">(</a><a id="5861" href="Ledger.Utxow.html#5861" class="Bound">vk</a> <a id="5864" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5866" href="Ledger.Utxow.html#5866" class="Bound">σ</a><a id="5867" href="Ledger.Utxow.html#5860" class="Bound">)</a> <a id="5869" href="Interface.IsSet.html#594" class="Function">∈</a> <a id="5871" href="Ledger.Transaction.html#5018" class="Function">vkSigs</a> <a id="5878" href="Interface.IsSet.html#594" class="Function">]</a> <a id="5880" href="Ledger.Crypto.html#808" class="Function">isSigned</a> <a id="5889" href="Ledger.Utxow.html#5861" class="Bound">vk</a> <a id="5892" class="Symbol">(</a><a id="5893" href="Ledger.Transaction.html#3225" class="Field">txidBytes</a> <a id="5903" href="Ledger.Transaction.html#4748" class="Function">txid</a><a id="5907" class="Symbol">)</a> <a id="5909" href="Ledger.Utxow.html#5866" class="Bound">σ</a>
    <a id="5915" href="Interface.STS.html#131" class="Function Operator">∙</a>  <a id="5918" href="Interface.IsSet.html#594" class="Function">∀[</a> <a id="5921" href="Ledger.Utxow.html#5921" class="Bound">s</a> <a id="5923" href="Interface.IsSet.html#594" class="Function">∈</a> <a id="5925" href="Axiom.Set.html#7518" class="Function">mapPartial</a> <a id="5936" href="Data.Sum.html#973" class="Function">isInj₁</a> <a id="5943" class="Symbol">(</a><a id="5944" href="Ledger.Transaction.html#6386" class="Function">txscripts</a> <a id="5954" href="Ledger.Utxow.html#5303" class="Generalizable">tx</a> <a id="5957" href="Ledger.Utxo.html#5322" class="Function">utxo</a><a id="5961" class="Symbol">)</a> <a id="5963" href="Interface.IsSet.html#594" class="Function">]</a> <a id="5965" href="Ledger.Script.html#744" class="Function">validP1Script</a> <a id="5979" href="Ledger.Utxow.html#5497" class="Bound">witsKeyHashes</a> <a id="5993" href="Ledger.Transaction.html#4367" class="Function">txvldt</a> <a id="6000" href="Ledger.Utxow.html#5921" class="Bound">s</a>
    <a id="6006" href="Interface.STS.html#131" class="Function Operator">∙</a>  <a id="6009" href="Ledger.Utxow.html#4662" class="Function">witsVKeyNeeded</a> <a id="6024" href="Ledger.Utxo.html#5322" class="Function">utxo</a> <a id="6029" href="Ledger.Utxow.html#5419" class="Function">txb</a> <a id="6033" href="Axiom.Set.html#1639" class="Function Operator">⊆</a> <a id="6035" href="Ledger.Utxow.html#5497" class="Bound">witsKeyHashes</a>
    <a id="6053" href="Interface.STS.html#131" class="Function Operator">∙</a>  <a id="6056" href="Ledger.Utxow.html#5704" class="Bound">neededHashes</a> <a id="6069" href="Axiom.Set.html#9367" class="Function Operator">＼</a> <a id="6071" href="Ledger.Utxow.html#5645" class="Bound">refScriptHashes</a> <a id="6087" href="Axiom.Set.html#2413" class="Function Operator">≡ᵉ</a> <a id="6090" href="Ledger.Utxow.html#5548" class="Bound">witsScriptHashes</a>
    <a id="6111" href="Interface.STS.html#131" class="Function Operator">∙</a>  <a id="6114" href="Ledger.Utxow.html#5594" class="Bound">inputHashes</a> <a id="6126" href="Axiom.Set.html#1639" class="Function Operator">⊆</a> <a id="6128" href="Ledger.Utxow.html#5755" class="Bound">txdatsHashes</a>
    <a id="6145" href="Interface.STS.html#131" class="Function Operator">∙</a>  <a id="6148" href="Ledger.Utxow.html#5755" class="Bound">txdatsHashes</a> <a id="6161" href="Axiom.Set.html#1639" class="Function Operator">⊆</a> <a id="6163" href="Ledger.Utxow.html#5594" class="Bound">inputHashes</a> <a id="6175" href="Axiom.Set.html#8665" class="Function Operator">∪</a> <a id="6177" href="Ledger.Utxow.html#5794" class="Bound">allOutHashes</a> <a id="6190" href="Axiom.Set.html#8665" class="Function Operator">∪</a> <a id="6192" href="Ledger.Utxo.html#1364" class="Function">getDataHashes</a> <a id="6206" class="Symbol">(</a><a id="6207" href="Interface.IsSet.html#977" class="Function">range</a> <a id="6213" class="Symbol">(</a><a id="6214" href="Ledger.Utxo.html#5322" class="Function">utxo</a> <a id="6219" href="Axiom.Set.Map.html#10107" class="Function Operator">∣</a> <a id="6221" href="Ledger.Transaction.html#4246" class="Function">refInputs</a><a id="6230" class="Symbol">))</a>
    <a id="6237" href="Interface.STS.html#131" class="Function Operator">∙</a>  <a id="6240" href="Ledger.Utxow.html#3003" class="Function">languages</a> <a id="6250" href="Ledger.Utxow.html#5303" class="Generalizable">tx</a> <a id="6253" href="Ledger.Utxo.html#5322" class="Function">utxo</a> <a id="6258" href="Axiom.Set.html#1639" class="Function Operator">⊆</a> <a id="6260" href="Ledger.Utxow.html#3327" class="Function">allowedLanguages</a> <a id="6277" href="Ledger.Utxow.html#5303" class="Generalizable">tx</a> <a id="6280" href="Ledger.Utxo.html#5322" class="Function">utxo</a>
    <a id="6289" href="Interface.STS.html#131" class="Function Operator">∙</a>  <a id="6292" href="Ledger.Transaction.html#4616" class="Function">txADhash</a> <a id="6301" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="6303" href="Class.Functor.Core.html#263" class="Function">map</a> <a id="6307" href="Interface.Hashable.html#256" class="Field">hash</a> <a id="6312" href="Ledger.Transaction.html#5388" class="Function">txAD</a>
    <a id="6321" href="Interface.STS.html#131" class="Function Operator">∙</a>  <a id="6324" href="Ledger.Utxow.html#5270" class="Generalizable">Γ</a> <a id="6326" href="Ledger.Utxo.html#5513" class="Datatype Operator">⊢</a> <a id="6328" href="Ledger.Utxow.html#5284" class="Generalizable">s</a> <a id="6330" href="Ledger.Utxo.html#5513" class="Datatype Operator">⇀⦇</a> <a id="6333" href="Ledger.Utxow.html#5303" class="Generalizable">tx</a> <a id="6336" href="Ledger.Utxo.html#5513" class="Datatype Operator">,UTXO⦈</a> <a id="6343" href="Ledger.Utxow.html#5286" class="Generalizable">s&#39;</a>
       <a id="6353" href="Interface.STS.html#350" class="Function Operator">────────────────────────────────</a>
       <a id="6393" href="Ledger.Utxow.html#5270" class="Generalizable">Γ</a> <a id="6395" href="Ledger.Utxow.html#5059" class="Datatype Operator">⊢</a> <a id="6397" href="Ledger.Utxow.html#5284" class="Generalizable">s</a> <a id="6399" href="Ledger.Utxow.html#5059" class="Datatype Operator">⇀⦇</a> <a id="6402" href="Ledger.Utxow.html#5303" class="Generalizable">tx</a> <a id="6405" href="Ledger.Utxow.html#5059" class="Datatype Operator">,UTXOW⦈</a> <a id="6413" href="Ledger.Utxow.html#5286" class="Generalizable">s&#39;</a>
<a id="6416" class="Markup">\end{code}</a><a id="6426" class="Background">
\caption{UTXOW inference rules}
\label{fig:rules:utxow}
\end{figure*}
</a><a id="6497" class="Markup">\begin{code}[hide]</a>
<a id="6516" class="Keyword">pattern</a> <a id="UTXOW-inductive⋯"></a><a id="6524" href="Ledger.Utxow.html#6524" class="InductiveConstructor">UTXOW-inductive⋯</a> <a id="6541" href="Ledger.Utxow.html#6592" class="Bound">p₁</a> <a id="6544" href="Ledger.Utxow.html#6597" class="Bound">p₂</a> <a id="6547" href="Ledger.Utxow.html#6602" class="Bound">p₃</a> <a id="6550" href="Ledger.Utxow.html#6607" class="Bound">p₄</a> <a id="6553" href="Ledger.Utxow.html#6612" class="Bound">p₅</a> <a id="6556" href="Ledger.Utxow.html#6617" class="Bound">p₆</a> <a id="6559" href="Ledger.Utxow.html#6622" class="Bound">p₇</a> <a id="6562" href="Ledger.Utxow.html#6627" class="Bound">p₈</a> <a id="6565" href="Ledger.Utxow.html#6632" class="Bound">h</a>
      <a id="6573" class="Symbol">=</a> <a id="6575" href="Ledger.Utxow.html#5364" class="InductiveConstructor">UTXOW-inductive</a> <a id="6591" class="Symbol">(</a><a id="6592" href="Ledger.Utxow.html#6592" class="Bound">p₁</a> <a id="6595" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="6597" href="Ledger.Utxow.html#6597" class="Bound">p₂</a> <a id="6600" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="6602" href="Ledger.Utxow.html#6602" class="Bound">p₃</a> <a id="6605" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="6607" href="Ledger.Utxow.html#6607" class="Bound">p₄</a> <a id="6610" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="6612" href="Ledger.Utxow.html#6612" class="Bound">p₅</a> <a id="6615" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="6617" href="Ledger.Utxow.html#6617" class="Bound">p₆</a> <a id="6620" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="6622" href="Ledger.Utxow.html#6622" class="Bound">p₇</a> <a id="6625" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="6627" href="Ledger.Utxow.html#6627" class="Bound">p₈</a> <a id="6630" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="6632" href="Ledger.Utxow.html#6632" class="Bound">h</a><a id="6633" class="Symbol">)</a>
<a id="6635" class="Keyword">pattern</a> <a id="UTXOW⇒UTXO"></a><a id="6643" href="Ledger.Utxow.html#6643" class="InductiveConstructor">UTXOW⇒UTXO</a> <a id="6654" href="Ledger.Utxow.html#6691" class="Bound">x</a> <a id="6656" class="Symbol">=</a> <a id="6658" href="Ledger.Utxow.html#6524" class="InductiveConstructor">UTXOW-inductive⋯</a> <a id="6675" class="Symbol">_</a> <a id="6677" class="Symbol">_</a> <a id="6679" class="Symbol">_</a> <a id="6681" class="Symbol">_</a> <a id="6683" class="Symbol">_</a> <a id="6685" class="Symbol">_</a> <a id="6687" class="Symbol">_</a> <a id="6689" class="Symbol">_</a> <a id="6691" href="Ledger.Utxow.html#6691" class="Bound">x</a>

<a id="6694" class="Keyword">unquoteDecl</a> <a id="UTXOW-inductive-premises"></a><a id="6706" href="Ledger.Utxow.html#6706" class="Function">UTXOW-inductive-premises</a> <a id="6731" class="Symbol">=</a>
  <a id="6735" href="Tactic.Premises.html#1543" class="Function">genPremises</a> <a id="6747" href="Ledger.Utxow.html#6706" class="Function">UTXOW-inductive-premises</a> <a id="6772" class="Symbol">(</a><a id="6773" class="Keyword">quote</a> <a id="6779" href="Ledger.Utxow.html#5364" class="InductiveConstructor">UTXOW-inductive</a><a id="6794" class="Symbol">)</a>
<a id="6796" class="Markup">\end{code}</a><a id="6806" class="Background">
\end{NoConway}
</a></pre></body></html>