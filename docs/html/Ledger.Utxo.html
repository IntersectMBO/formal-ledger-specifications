<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>Ledger.Utxo</title><link rel="stylesheet" href="Agda.css"></head><body><pre class="Agda"><a id="1" class="Background">\section{UTxO}
\label{sec:utxo}

\subsection{Accounting}

</a><a id="59" class="Markup">\begin{code}[hide]</a>
<a id="78" class="Symbol">{-#</a> <a id="82" class="Keyword">OPTIONS</a> <a id="90" class="Pragma">--safe</a> <a id="97" class="Symbol">#-}</a>

<a id="102" class="Keyword">open</a> <a id="107" class="Keyword">import</a> <a id="114" href="Algebra.html" class="Module">Algebra</a>              <a id="135" class="Keyword">using</a> <a id="141" class="Symbol">(</a><a id="142" href="Algebra.Bundles.html#6622" class="Record">CommutativeMonoid</a><a id="159" class="Symbol">)</a>
<a id="161" class="Keyword">open</a> <a id="166" class="Keyword">import</a> <a id="173" href="Data.Integer.Ext.html" class="Module">Data.Integer.Ext</a>     <a id="194" class="Keyword">using</a> <a id="200" class="Symbol">(</a><a id="201" href="Data.Integer.Ext.html#349" class="Function">posPart</a><a id="208" class="Symbol">;</a> <a id="210" href="Data.Integer.Ext.html#440" class="Function">negPart</a><a id="217" class="Symbol">)</a>
<a id="219" class="Keyword">open</a> <a id="224" class="Keyword">import</a> <a id="231" href="Data.Nat.Properties.html" class="Module">Data.Nat.Properties</a>  <a id="252" class="Keyword">using</a> <a id="258" class="Symbol">(</a><a id="259" href="Data.Nat.Properties.html#16493" class="Function">+-0-monoid</a><a id="269" class="Symbol">)</a>
<a id="271" class="Keyword">import</a> <a id="278" href="Data.Maybe.html" class="Module">Data.Maybe</a> <a id="289" class="Symbol">as</a> <a id="292" class="Module">M</a>
<a id="294" class="Keyword">import</a> <a id="301" href="Data.Sum.Relation.Unary.All.html" class="Module">Data.Sum.Relation.Unary.All</a> <a id="329" class="Symbol">as</a> <a id="332" class="Module">Sum</a>

<a id="337" class="Keyword">import</a> <a id="344" href="Data.Integer.html" class="Module">Data.Integer</a> <a id="357" class="Symbol">as</a> <a id="360" class="Module">ℤ</a>
<a id="362" class="Keyword">import</a> <a id="369" href="Data.Rational.html" class="Module">Data.Rational</a> <a id="383" class="Symbol">as</a> <a id="386" class="Module">ℚ</a>

<a id="389" class="Keyword">open</a> <a id="394" class="Keyword">import</a> <a id="401" href="Tactic.Derive.DecEq.html" class="Module">Tactic.Derive.DecEq</a>

<a id="422" class="Keyword">open</a> <a id="427" class="Keyword">import</a> <a id="434" href="Ledger.Prelude.html" class="Module">Ledger.Prelude</a>
<a id="449" class="Keyword">open</a> <a id="454" class="Keyword">import</a> <a id="461" href="Ledger.Abstract.html" class="Module">Ledger.Abstract</a>
<a id="477" class="Keyword">open</a> <a id="482" class="Keyword">import</a> <a id="489" href="Ledger.Transaction.html" class="Module">Ledger.Transaction</a>

<a id="509" class="Keyword">module</a> <a id="516" href="Ledger.Utxo.html" class="Module">Ledger.Utxo</a>
  <a id="530" class="Symbol">(</a><a id="531" href="Ledger.Utxo.html#531" class="Bound">txs</a> <a id="535" class="Symbol">:</a> <a id="537" class="Symbol">_)</a> <a id="540" class="Symbol">(</a><a id="541" class="Keyword">open</a> <a id="546" href="Ledger.Transaction.html#933" class="Module">TransactionStructure</a> <a id="567" href="Ledger.Utxo.html#531" class="Bound">txs</a><a id="570" class="Symbol">)</a>
  <a id="574" class="Symbol">(</a><a id="575" href="Ledger.Utxo.html#575" class="Bound">abs</a> <a id="579" class="Symbol">:</a> <a id="581" href="Ledger.Abstract.html#540" class="Record">AbstractFunctions</a> <a id="599" href="Ledger.Utxo.html#531" class="Bound">txs</a><a id="602" class="Symbol">)</a> <a id="604" class="Symbol">(</a><a id="605" class="Keyword">open</a> <a id="610" href="Ledger.Abstract.html#540" class="Module">AbstractFunctions</a> <a id="628" href="Ledger.Utxo.html#575" class="Bound">abs</a><a id="631" class="Symbol">)</a>
  <a id="635" class="Keyword">where</a>

<a id="642" class="Keyword">open</a> <a id="647" class="Keyword">import</a> <a id="654" href="Ledger.ScriptValidation.html" class="Module">Ledger.ScriptValidation</a> <a id="678" href="Ledger.Utxo.html#531" class="Bound">txs</a> <a id="682" href="Ledger.Utxo.html#575" class="Bound">abs</a>

<a id="687" class="Keyword">instance</a>
  <a id="698" href="Ledger.Utxo.html#698" class="Function">_</a> <a id="700" class="Symbol">=</a> <a id="702" href="Data.Nat.Properties.html#16493" class="Function">+-0-monoid</a>

  <a id="HasCoin-Map"></a><a id="716" href="Ledger.Utxo.html#716" class="Function">HasCoin-Map</a> <a id="728" class="Symbol">:</a> <a id="730" class="Symbol">∀</a> <a id="732" class="Symbol">{</a><a id="733" href="Ledger.Utxo.html#733" class="Bound">A</a><a id="734" class="Symbol">}</a> <a id="736" class="Symbol">→</a> <a id="738" class="Symbol">⦃</a> <a id="740" href="Class.DecEq.Core.html#117" class="Record">DecEq</a> <a id="746" href="Ledger.Utxo.html#733" class="Bound">A</a> <a id="748" class="Symbol">⦄</a> <a id="750" class="Symbol">→</a> <a id="752" href="Ledger.Interface.HasCoin.html#124" class="Record">HasCoin</a> <a id="760" class="Symbol">(</a><a id="761" href="Ledger.Utxo.html#733" class="Bound">A</a> <a id="763" href="Ledger.Set.Theory.html#1515" class="Function Operator">⇀</a> <a id="765" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a><a id="769" class="Symbol">)</a>
  <a id="773" href="Ledger.Utxo.html#716" class="Function">HasCoin-Map</a> <a id="785" class="Symbol">.</a><a id="786" href="Ledger.Interface.HasCoin.html#172" class="Field">getCoin</a> <a id="794" href="Ledger.Utxo.html#794" class="Bound">s</a> <a id="796" class="Symbol">=</a> <a id="798" href="Ledger.Set.Theory.html#3127" class="Function">∑[</a> <a id="801" href="Ledger.Utxo.html#801" class="Bound">x</a> <a id="803" href="Ledger.Set.Theory.html#3127" class="Function">←</a> <a id="805" href="Ledger.Utxo.html#794" class="Bound">s</a> <a id="807" href="Ledger.Set.Theory.html#3127" class="Function">]</a> <a id="809" href="Ledger.Utxo.html#801" class="Bound">x</a>

<a id="812" class="Keyword">infixl</a> <a id="819" class="Number">7</a> <a id="821" href="Ledger.Utxo.html#917" class="Function Operator">_*↓_</a>

<a id="827" class="Comment">-- multiply a natural number with a fraction, rounding down and taking the absolute value</a>
<a id="_*↓_"></a><a id="917" href="Ledger.Utxo.html#917" class="Function Operator">_*↓_</a> <a id="922" class="Symbol">:</a> <a id="924" href="Data.Rational.Base.html#1342" class="Record">ℚ.ℚ</a> <a id="928" class="Symbol">→</a> <a id="930" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a> <a id="932" class="Symbol">→</a> <a id="934" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a>
<a id="936" href="Ledger.Utxo.html#936" class="Bound">q</a> <a id="938" href="Ledger.Utxo.html#917" class="Function Operator">*↓</a> <a id="941" href="Ledger.Utxo.html#941" class="Bound">n</a> <a id="943" class="Symbol">=</a> <a id="945" href="Data.Integer.Base.html#1715" class="Function Operator">ℤ.∣</a> <a id="949" href="Data.Rational.Base.html#7116" class="Function">ℚ.⌊</a> <a id="953" href="Ledger.Utxo.html#936" class="Bound">q</a> <a id="955" href="Data.Rational.Base.html#6315" class="Function Operator">ℚ.*</a> <a id="959" class="Symbol">(</a><a id="960" href="Agda.Builtin.Int.html#263" class="InductiveConstructor Operator">ℤ.+</a> <a id="964" href="Ledger.Utxo.html#941" class="Bound">n</a> <a id="966" href="Data.Rational.Base.html#3884" class="Function Operator">ℚ./</a> <a id="970" class="Number">1</a><a id="971" class="Symbol">)</a> <a id="973" href="Data.Rational.Base.html#7116" class="Function">⌋</a> <a id="975" href="Data.Integer.Base.html#1715" class="Function Operator">∣</a>
<a id="977" class="Markup">\end{code}</a><a id="987" class="Background">

\begin{NoConway}
\begin{figure*}[h]
</a><a id="1025" class="Markup">\begin{code}</a>
<a id="isTwoPhaseScriptAddress"></a><a id="1038" href="Ledger.Utxo.html#1038" class="Function">isTwoPhaseScriptAddress</a> <a id="1062" class="Symbol">:</a> <a id="1064" href="Ledger.Transaction.html#5227" class="Record">Tx</a> <a id="1067" class="Symbol">→</a> <a id="1069" href="Ledger.Transaction.html#3882" class="Function">UTxO</a> <a id="1074" class="Symbol">→</a> <a id="1076" href="Ledger.Address.html#2070" class="Function">Addr</a> <a id="1081" class="Symbol">→</a> <a id="1083" href="Agda.Builtin.Bool.html#173" class="Datatype">Bool</a>
<a id="1088" href="Ledger.Utxo.html#1038" class="Function">isTwoPhaseScriptAddress</a> <a id="1112" href="Ledger.Utxo.html#1112" class="Bound">tx</a> <a id="1115" href="Ledger.Utxo.html#1115" class="Bound">utxo</a> <a id="1120" href="Ledger.Utxo.html#1120" class="Bound">a</a> <a id="1122" class="Symbol">=</a>
  <a id="1126" href="Interface.ToBool.html#287" class="Function Operator">if</a> <a id="1129" href="Ledger.Address.html#2435" class="Function">isScriptAddr</a> <a id="1142" href="Ledger.Utxo.html#1120" class="Bound">a</a> <a id="1144" href="Interface.ToBool.html#287" class="Function Operator">then</a>
    <a id="1153" class="Symbol">(λ</a> <a id="1156" class="Symbol">{</a><a id="1157" href="Ledger.Utxo.html#1157" class="Bound">p</a><a id="1158" class="Symbol">}</a> <a id="1160" class="Symbol">→</a> <a id="1162" href="Interface.ToBool.html#287" class="Function Operator">if</a> <a id="1165" href="Ledger.Transaction.html#6520" class="Function">lookupScriptHash</a> <a id="1182" class="Symbol">(</a><a id="1183" href="Ledger.Address.html#3689" class="Function">getScriptHash</a> <a id="1197" href="Ledger.Utxo.html#1120" class="Bound">a</a> <a id="1199" href="Ledger.Utxo.html#1157" class="Bound">p</a><a id="1200" class="Symbol">)</a> <a id="1202" href="Ledger.Utxo.html#1112" class="Bound">tx</a> <a id="1205" href="Ledger.Utxo.html#1115" class="Bound">utxo</a>
                 <a id="1227" href="Interface.ToBool.html#287" class="Function Operator">then</a> <a id="1232" class="Symbol">(λ</a> <a id="1235" class="Symbol">{</a><a id="1236" href="Ledger.Utxo.html#1236" class="Bound">s</a><a id="1237" class="Symbol">}</a> <a id="1239" class="Symbol">→</a> <a id="1241" href="Ledger.Transaction.html#6899" class="Function">isP2Script</a> <a id="1252" href="Ledger.Utxo.html#1236" class="Bound">s</a><a id="1253" class="Symbol">)</a>
                 <a id="1272" href="Interface.ToBool.html#287" class="Function Operator">else</a> <a id="1277" href="Agda.Builtin.Bool.html#192" class="InductiveConstructor">false</a><a id="1282" class="Symbol">)</a>
  <a id="1286" href="Interface.ToBool.html#287" class="Function Operator">else</a>
    <a id="1295" href="Agda.Builtin.Bool.html#192" class="InductiveConstructor">false</a>
<a id="1301" class="Markup">\end{code}</a><a id="1311" class="Background">
</a><a id="1312" class="Markup">\begin{code}[hide]</a>
<a id="1331" class="Keyword">opaque</a>
<a id="1338" class="Markup">\end{code}</a><a id="1348" class="Background">
</a><a id="1349" class="Markup">\begin{code}</a>
  <a id="getDataHashes"></a><a id="1364" href="Ledger.Utxo.html#1364" class="Function">getDataHashes</a> <a id="1378" class="Symbol">:</a> <a id="1380" href="Ledger.Set.Theory.html#382" class="Function Operator">ℙ</a> <a id="1382" href="Ledger.Transaction.html#3814" class="Function">TxOut</a> <a id="1388" class="Symbol">→</a> <a id="1390" href="Ledger.Set.Theory.html#382" class="Function Operator">ℙ</a> <a id="1392" href="Ledger.Script.html#1667" class="Function">DataHash</a>
  <a id="1403" href="Ledger.Utxo.html#1364" class="Function">getDataHashes</a> <a id="1417" href="Ledger.Utxo.html#1417" class="Bound">txo</a> <a id="1421" class="Symbol">=</a> <a id="1423" href="Axiom.Set.html#7518" class="Function">mapPartial</a> <a id="1434" href="Data.Sum.html#1056" class="Function">isInj₂</a> <a id="1441" class="Symbol">(</a><a id="1442" href="Axiom.Set.html#7518" class="Function">mapPartial</a> <a id="1453" class="Symbol">(</a><a id="1454" href="Data.Product.Base.html#636" class="Field">proj₁</a> <a id="1460" href="Function.Base.html#1115" class="Function Operator">∘</a> <a id="1462" href="Data.Product.Base.html#650" class="Field">proj₂</a> <a id="1468" href="Function.Base.html#1115" class="Function Operator">∘</a> <a id="1470" href="Data.Product.Base.html#650" class="Field">proj₂</a><a id="1475" class="Symbol">)</a> <a id="1477" href="Ledger.Utxo.html#1417" class="Bound">txo</a><a id="1480" class="Symbol">)</a>

  <a id="getInputHashes"></a><a id="1485" href="Ledger.Utxo.html#1485" class="Function">getInputHashes</a> <a id="1500" class="Symbol">:</a> <a id="1502" href="Ledger.Transaction.html#5227" class="Record">Tx</a> <a id="1505" class="Symbol">→</a> <a id="1507" href="Ledger.Transaction.html#3882" class="Function">UTxO</a> <a id="1512" class="Symbol">→</a> <a id="1514" href="Ledger.Set.Theory.html#382" class="Function Operator">ℙ</a> <a id="1516" href="Ledger.Script.html#1667" class="Function">DataHash</a>
  <a id="1527" href="Ledger.Utxo.html#1485" class="Function">getInputHashes</a> <a id="1542" href="Ledger.Utxo.html#1542" class="Bound">tx</a> <a id="1545" href="Ledger.Utxo.html#1545" class="Bound">utxo</a> <a id="1550" class="Symbol">=</a> <a id="1552" href="Ledger.Utxo.html#1364" class="Function">getDataHashes</a>
    <a id="1570" class="Symbol">(</a><a id="1571" href="Ledger.Set.Theory.html#2731" class="Function">filterˢ</a> <a id="1579" class="Symbol">(λ</a> <a id="1582" class="Symbol">(</a><a id="1583" href="Ledger.Utxo.html#1583" class="Bound">a</a> <a id="1585" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1587" class="Symbol">_</a> <a id="1589" class="Symbol">)</a> <a id="1591" class="Symbol">→</a> <a id="1593" href="Ledger.Utxo.html#1038" class="Function">isTwoPhaseScriptAddress</a> <a id="1617" href="Ledger.Utxo.html#1542" class="Bound">tx</a> <a id="1620" href="Ledger.Utxo.html#1545" class="Bound">utxo</a> <a id="1625" href="Ledger.Utxo.html#1583" class="Bound">a</a> <a id="1627" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="1629" href="Agda.Builtin.Bool.html#198" class="InductiveConstructor">true</a><a id="1633" class="Symbol">)</a>
            <a id="1647" class="Symbol">(</a><a id="1648" href="Interface.IsSet.html#977" class="Function">range</a> <a id="1654" class="Symbol">(</a><a id="1655" href="Ledger.Utxo.html#1545" class="Bound">utxo</a> <a id="1660" href="Axiom.Set.Map.html#10107" class="Function Operator">∣</a> <a id="1662" href="Ledger.Transaction.html#4216" class="Function">txins</a><a id="1667" class="Symbol">)))</a>
    <a id="1675" class="Keyword">where</a> <a id="1681" class="Keyword">open</a> <a id="1686" href="Ledger.Transaction.html#5227" class="Module">Tx</a><a id="1688" class="Symbol">;</a> <a id="1690" class="Keyword">open</a> <a id="1695" href="Ledger.Transaction.html#4126" class="Module">TxBody</a> <a id="1702" class="Symbol">(</a><a id="1703" href="Ledger.Utxo.html#1542" class="Bound">tx</a> <a id="1706" class="Symbol">.</a><a id="1707" href="Ledger.Transaction.html#5313" class="Field">body</a><a id="1711" class="Symbol">)</a>

<a id="totExUnits"></a><a id="1714" href="Ledger.Utxo.html#1714" class="Function">totExUnits</a> <a id="1725" class="Symbol">:</a> <a id="1727" href="Ledger.Transaction.html#5227" class="Record">Tx</a> <a id="1730" class="Symbol">→</a> <a id="1732" href="Ledger.Script.html#1096" class="Function">ExUnits</a>
<a id="1740" href="Ledger.Utxo.html#1714" class="Function">totExUnits</a> <a id="1751" href="Ledger.Utxo.html#1751" class="Bound">tx</a> <a id="1754" class="Symbol">=</a> <a id="1756" href="Ledger.Set.Theory.html#3127" class="Function">∑[</a> <a id="1759" href="Ledger.Utxo.html#1759" class="Bound">(_</a> <a id="1762" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1764" href="Ledger.Utxo.html#1764" class="Bound">eu</a><a id="1766" href="Ledger.Utxo.html#1759" class="Bound">)</a> <a id="1768" href="Ledger.Set.Theory.html#3127" class="Function">←</a> <a id="1770" href="Ledger.Utxo.html#1751" class="Bound">tx</a> <a id="1773" class="Symbol">.</a><a id="1774" href="Ledger.Transaction.html#5337" class="Field">wits</a> <a id="1779" class="Symbol">.</a><a id="1780" href="Ledger.Transaction.html#5106" class="Field">txrdmrs</a> <a id="1788" href="Ledger.Set.Theory.html#3127" class="Function">]</a> <a id="1790" href="Ledger.Utxo.html#1764" class="Bound">eu</a>
  <a id="1795" class="Keyword">where</a> <a id="1801" class="Keyword">open</a> <a id="1806" href="Ledger.Transaction.html#5227" class="Module">Tx</a><a id="1808" class="Symbol">;</a> <a id="1810" class="Keyword">open</a> <a id="1815" href="Ledger.Transaction.html#4923" class="Module">TxWitnesses</a>
<a id="1827" class="Markup">\end{code}</a><a id="1837" class="Background">
\caption{Functions supporting UTxO rules}
\label{fig:supportfunctions:utxo}
\end{figure*}

</a><a id="1929" class="Markup">\begin{code}[hide]</a>
<a id="1948" class="Comment">-- utxoEntrySizeWithoutVal = 27 words (8 bytes)</a>
<a id="utxoEntrySizeWithoutVal"></a><a id="1996" href="Ledger.Utxo.html#1996" class="Function">utxoEntrySizeWithoutVal</a> <a id="2020" class="Symbol">:</a> <a id="2022" href="Ledger.TokenAlgebra.html#605" class="Function">MemoryEstimate</a>
<a id="2037" href="Ledger.Utxo.html#1996" class="Function">utxoEntrySizeWithoutVal</a> <a id="2061" class="Symbol">=</a> <a id="2063" class="Number">8</a>

<a id="utxoEntrySize"></a><a id="2066" href="Ledger.Utxo.html#2066" class="Function">utxoEntrySize</a> <a id="2080" class="Symbol">:</a> <a id="2082" href="Ledger.Transaction.html#5679" class="Function">TxOutʰ</a> <a id="2089" class="Symbol">→</a> <a id="2091" href="Ledger.TokenAlgebra.html#605" class="Function">MemoryEstimate</a>
<a id="2106" href="Ledger.Utxo.html#2066" class="Function">utxoEntrySize</a> <a id="2120" href="Ledger.Utxo.html#2120" class="Bound">o</a> <a id="2122" class="Symbol">=</a> <a id="2124" href="Ledger.Utxo.html#1996" class="Function">utxoEntrySizeWithoutVal</a> <a id="2148" href="Interface.HasAdd.html#135" class="Field Operator">+</a> <a id="2150" href="Ledger.TokenAlgebra.html#1374" class="Function">size</a> <a id="2155" class="Symbol">(</a><a id="2156" href="Ledger.Transaction.html#5839" class="Function">getValueʰ</a> <a id="2166" href="Ledger.Utxo.html#2120" class="Bound">o</a><a id="2167" class="Symbol">)</a>


<a id="2171" class="Keyword">open</a> <a id="2176" href="Ledger.PParams.html#2073" class="Module">PParams</a>
<a id="2184" class="Markup">\end{code}</a><a id="2194" class="Background">

Figures~\ref{fig:supportfunctions:utxo},~\ref{fig:functions:utxo},
and~\ref{fig:functions:utxo2} define functions needed for the UTxO transition system.
\end{NoConway}
%
\begin{Conway}
Figures~\ref{fig:ts-types:utxo}--\ref{fig:functions:utxo-conway}
define types and functions needed for the UTxO transition system.
\end{Conway}
%
\ Note the special multiplication symbol \AgdaFunction{*↓} used in
Figure~\ref{fig:functions:utxo}: it means multiply and take the absolute value of the
result, rounded down to the nearest integer.

\begin{NoConway}
Figure~\ref{fig:ts-types:utxo} defines the types needed for the UTxO transition system.
The UTxO transition system is given in Figure~\ref{fig:rules:utxo-shelley}.

\begin{itemize}

  \item
    The function $\fun{outs}$ creates the unspent outputs generated by a transaction.
    It maps the transaction id and output index to the output.

  \item
    The $\fun{balance}$ function calculates sum total of all the coin in a given UTxO.
\end{itemize}
\end{NoConway}

The deposits have been reworked since the original Shelley design. We
now track the amount of every deposit individually. This fixes an
issue in the original design: An increase in deposit amounts would
allow an attacker to make lots of deposits before that change and
refund them after the change. The additional funds necessary would
have been provided by the treasury. Since changes to protocol
parameters were (and still are) known publicly and guaranteed before
they are enacted, this comes at zero risk for an attacker. This means
the deposit amounts could realistically never be increased. This issue
is gone with the new design.

Similar to \ScriptPurpose, \DepositPurpose carries the information
what the deposit is being made for. The deposits are stored in the
\deposits field of \UTxOState. \updateDeposits is responsible for
updating this map, which is split into \updateCertDeposits and
\updateProposalDeposits, responsible for certificates and proposals
respectively. Both of these functions iterate over the relevant fields
of the transaction body and insert or remove deposits depending on the
information seen. Note that some deposits can only be refunded at the
epoch boundary and are not removed by these functions.

There are two equivalent ways to introduce this tracking of the
deposits. One option would be to populate the \deposits field of
\UTxOState with the correct keys and values that can be extracted from
the state of the previous era at the transition into the Conway
era. Alternatively, this logic can be implemented in older eras and
replaying the chain with that implementation, effectively treating it
as an erratum to the Shelley specification.

\begin{figure*}[h]
\begin{AgdaMultiCode}
\begin{NoConway}
\emph{UTxO environment}
</a><a id="4974" class="Markup">\begin{code}</a>
<a id="4987" class="Keyword">record</a> <a id="UTxOEnv"></a><a id="4994" href="Ledger.Utxo.html#4994" class="Record">UTxOEnv</a> <a id="5002" class="Symbol">:</a> <a id="5004" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="5009" class="Keyword">where</a>
<a id="5015" class="Markup">\end{code}</a><a id="5025" class="Background">
</a><a id="5026" class="Markup">\begin{code}[hide]</a>
  <a id="5047" class="Keyword">field</a>
<a id="5053" class="Markup">\end{code}</a><a id="5063" class="Background">
</a><a id="5064" class="Markup">\begin{code}</a>
    <a id="UTxOEnv.slot"></a><a id="5081" href="Ledger.Utxo.html#5081" class="Field">slot</a>      <a id="5091" class="Symbol">:</a> <a id="5093" href="Ledger.Types.Epoch.html#382" class="Function">Slot</a>
    <a id="UTxOEnv.pparams"></a><a id="5102" href="Ledger.Utxo.html#5102" class="Field">pparams</a>   <a id="5112" class="Symbol">:</a> <a id="5114" href="Ledger.PParams.html#2073" class="Record">PParams</a>
    <a id="UTxOEnv.treasury"></a><a id="5126" href="Ledger.Utxo.html#5126" class="Field">treasury</a>  <a id="5136" class="Symbol">:</a> <a id="5138" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a>
<a id="5143" class="Markup">\end{code}</a><a id="5153" class="Background">
\end{NoConway}
\emph{UTxO states}
</a><a id="5188" class="Markup">\begin{code}</a>
<a id="5201" class="Keyword">record</a> <a id="UTxOState"></a><a id="5208" href="Ledger.Utxo.html#5208" class="Record">UTxOState</a> <a id="5218" class="Symbol">:</a> <a id="5220" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="5225" class="Keyword">where</a>
<a id="5231" class="Markup">\end{code}</a><a id="5241" class="Background">
</a><a id="5242" class="Markup">\begin{code}[hide]</a>
  <a id="5263" class="Keyword">constructor</a> <a id="⟦_,_,_,_⟧ᵘ"></a><a id="5275" href="Ledger.Utxo.html#5275" class="InductiveConstructor Operator">⟦_,_,_,_⟧ᵘ</a>
  <a id="5288" class="Keyword">field</a>
<a id="5294" class="Markup">\end{code}</a><a id="5304" class="Background">
</a><a id="5305" class="Markup">\begin{code}</a>
    <a id="UTxOState.utxo"></a><a id="5322" href="Ledger.Utxo.html#5322" class="Field">utxo</a>       <a id="5333" class="Symbol">:</a> <a id="5335" href="Ledger.Transaction.html#3882" class="Function">UTxO</a>
    <a id="UTxOState.fees"></a><a id="5344" href="Ledger.Utxo.html#5344" class="Field">fees</a>       <a id="5355" class="Symbol">:</a> <a id="5357" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a>
    <a id="UTxOState.deposits"></a><a id="5366" href="Ledger.Utxo.html#5366" class="Field">deposits</a>   <a id="5377" class="Symbol">:</a> <a id="5379" href="Ledger.Certs.html#590" class="Function">Deposits</a>
    <a id="UTxOState.donations"></a><a id="5392" href="Ledger.Utxo.html#5392" class="Field">donations</a>  <a id="5403" class="Symbol">:</a> <a id="5405" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a>
<a id="5410" class="Markup">\end{code}</a><a id="5420" class="Background">
\begin{NoConway}
\emph{UTxO transitions}

</a><a id="5463" class="Markup">\begin{code}[hide]</a>
<a id="5482" class="Keyword">data</a>
<a id="5487" class="Markup">\end{code}</a><a id="5497" class="Background">
</a><a id="5498" class="Markup">\begin{code}</a>
  <a id="_⊢_⇀⦇_,UTXO⦈_"></a><a id="5513" href="Ledger.Utxo.html#5513" class="Datatype Operator">_⊢_⇀⦇_,UTXO⦈_</a> <a id="5527" class="Symbol">:</a> <a id="5529" href="Ledger.Utxo.html#4994" class="Record">UTxOEnv</a> <a id="5537" class="Symbol">→</a> <a id="5539" href="Ledger.Utxo.html#5208" class="Record">UTxOState</a> <a id="5549" class="Symbol">→</a> <a id="5551" href="Ledger.Transaction.html#5227" class="Record">Tx</a> <a id="5554" class="Symbol">→</a> <a id="5556" href="Ledger.Utxo.html#5208" class="Record">UTxOState</a> <a id="5566" class="Symbol">→</a> <a id="5568" href="Agda.Primitive.html#388" class="Primitive">Type</a>
<a id="5573" class="Markup">\end{code}</a><a id="5583" class="Background">
\end{NoConway}
\end{AgdaMultiCode}
\caption{UTxO transition-system types}
\label{fig:ts-types:utxo}
\end{figure*}

\begin{figure*}[h]
</a><a id="5718" class="Markup">\begin{code}[hide]</a>
<a id="5737" class="Keyword">module</a> <a id="5744" href="Ledger.Utxo.html#5744" class="Module">_</a> <a id="5746" class="Symbol">(</a><a id="5747" class="Keyword">let</a> <a id="5751" class="Keyword">open</a> <a id="5756" href="Ledger.Transaction.html#5227" class="Module">Tx</a><a id="5758" class="Symbol">;</a> <a id="5760" class="Keyword">open</a> <a id="5765" href="Ledger.Transaction.html#4126" class="Module">TxBody</a><a id="5771" class="Symbol">;</a> <a id="5773" class="Keyword">open</a> <a id="5778" href="Ledger.Transaction.html#4923" class="Module">TxWitnesses</a><a id="5789" class="Symbol">)</a> <a id="5791" class="Keyword">where</a> <a id="5797" class="Keyword">opaque</a>
<a id="5804" class="Markup">\end{code}</a><a id="5814" class="Background">
\begin{AgdaMultiCode}
\begin{NoConway}
</a><a id="5854" class="Markup">\begin{code}</a>
  <a id="5869" href="Ledger.Utxo.html#5869" class="Function">outs</a> <a id="5874" class="Symbol">:</a> <a id="5876" href="Ledger.Transaction.html#4126" class="Record">TxBody</a> <a id="5883" class="Symbol">→</a> <a id="5885" href="Ledger.Transaction.html#3882" class="Function">UTxO</a>
  <a id="5892" href="Ledger.Utxo.html#5869" class="Function">outs</a> <a id="5897" href="Ledger.Utxo.html#5897" class="Bound">tx</a> <a id="5900" class="Symbol">=</a> <a id="5902" href="Axiom.Set.Map.html#5966" class="Function">mapKeys</a> <a id="5910" class="Symbol">(</a><a id="5911" href="Ledger.Utxo.html#5897" class="Bound">tx</a> <a id="5914" class="Symbol">.</a><a id="5915" href="Ledger.Transaction.html#4748" class="Field">txid</a> <a id="5920" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,_</a><a id="5922" class="Symbol">)</a> <a id="5924" class="Symbol">(</a><a id="5925" href="Ledger.Utxo.html#5897" class="Bound">tx</a> <a id="5928" class="Symbol">.</a><a id="5929" href="Ledger.Transaction.html#4276" class="Field">txouts</a><a id="5935" class="Symbol">)</a>

  <a id="5940" href="Ledger.Utxo.html#5940" class="Function">balance</a> <a id="5948" class="Symbol">:</a> <a id="5950" href="Ledger.Transaction.html#3882" class="Function">UTxO</a> <a id="5955" class="Symbol">→</a> <a id="5957" href="Ledger.TokenAlgebra.html#816" class="Function">Value</a>
  <a id="5965" href="Ledger.Utxo.html#5940" class="Function">balance</a> <a id="5973" href="Ledger.Utxo.html#5973" class="Bound">utxo</a> <a id="5978" class="Symbol">=</a> <a id="5980" href="Ledger.Set.Theory.html#3127" class="Function">∑[</a> <a id="5983" href="Ledger.Utxo.html#5983" class="Bound">x</a> <a id="5985" href="Ledger.Set.Theory.html#3127" class="Function">←</a> <a id="5987" href="Axiom.Set.Map.html#6138" class="Function">mapValues</a> <a id="5997" href="Ledger.Transaction.html#5750" class="Function">txOutHash</a> <a id="6007" href="Ledger.Utxo.html#5973" class="Bound">utxo</a> <a id="6012" href="Ledger.Set.Theory.html#3127" class="Function">]</a> <a id="6014" href="Ledger.Transaction.html#5839" class="Function">getValueʰ</a> <a id="6024" href="Ledger.Utxo.html#5983" class="Bound">x</a>

  <a id="6029" href="Ledger.Utxo.html#6029" class="Function">cbalance</a> <a id="6038" class="Symbol">:</a> <a id="6040" href="Ledger.Transaction.html#3882" class="Function">UTxO</a> <a id="6045" class="Symbol">→</a> <a id="6047" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a>
  <a id="6054" href="Ledger.Utxo.html#6029" class="Function">cbalance</a> <a id="6063" href="Ledger.Utxo.html#6063" class="Bound">utxo</a> <a id="6068" class="Symbol">=</a> <a id="6070" href="Ledger.TokenAlgebra.html#1233" class="Function">coin</a> <a id="6075" class="Symbol">(</a><a id="6076" href="Ledger.Utxo.html#5940" class="Function">balance</a> <a id="6084" href="Ledger.Utxo.html#6063" class="Bound">utxo</a><a id="6088" class="Symbol">)</a>
<a id="6090" class="Markup">\end{code}</a><a id="6100" class="Background">
\end{NoConway}
</a><a id="6116" class="Markup">\begin{code}</a>
  <a id="6131" href="Ledger.Utxo.html#6131" class="Function">minfee</a> <a id="6138" class="Symbol">:</a> <a id="6140" href="Ledger.PParams.html#2073" class="Record">PParams</a> <a id="6148" class="Symbol">→</a> <a id="6150" href="Ledger.Transaction.html#3882" class="Function">UTxO</a> <a id="6155" class="Symbol">→</a> <a id="6157" href="Ledger.Transaction.html#5227" class="Record">Tx</a> <a id="6160" class="Symbol">→</a> <a id="6162" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a>
  <a id="6169" href="Ledger.Utxo.html#6131" class="Function">minfee</a> <a id="6176" href="Ledger.Utxo.html#6176" class="Bound">pp</a> <a id="6179" href="Ledger.Utxo.html#6179" class="Bound">utxo</a> <a id="6184" href="Ledger.Utxo.html#6184" class="Bound">tx</a>  <a id="6188" class="Symbol">=</a>
    <a id="6194" href="Ledger.Utxo.html#6176" class="Bound">pp</a> <a id="6197" class="Symbol">.</a><a id="6198" href="Ledger.PParams.html#2640" class="Field">a</a> <a id="6200" href="Agda.Builtin.Nat.html#539" class="Primitive Operator">*</a> <a id="6202" href="Ledger.Utxo.html#6184" class="Bound">tx</a> <a id="6205" class="Symbol">.</a><a id="6206" href="Ledger.Transaction.html#5313" class="Field">body</a> <a id="6211" class="Symbol">.</a><a id="6212" href="Ledger.Transaction.html#4723" class="Field">txsize</a> <a id="6219" href="Interface.HasAdd.html#135" class="Field Operator">+</a> <a id="6221" href="Ledger.Utxo.html#6176" class="Bound">pp</a> <a id="6224" class="Symbol">.</a><a id="6225" href="Ledger.PParams.html#2682" class="Field">b</a>
    <a id="6231" href="Interface.HasAdd.html#135" class="Field Operator">+</a> <a id="6233" href="Ledger.Abstract.html#579" class="Field">txscriptfee</a> <a id="6245" class="Symbol">(</a><a id="6246" href="Ledger.Utxo.html#6176" class="Bound">pp</a> <a id="6249" class="Symbol">.</a><a id="6250" href="Ledger.PParams.html#2859" class="Field">prices</a><a id="6256" class="Symbol">)</a> <a id="6258" class="Symbol">(</a><a id="6259" href="Ledger.Utxo.html#1714" class="Function">totExUnits</a> <a id="6270" href="Ledger.Utxo.html#6184" class="Bound">tx</a><a id="6272" class="Symbol">)</a>
    <a id="6278" href="Interface.HasAdd.html#135" class="Field Operator">+</a> <a id="6280" href="Ledger.Utxo.html#6176" class="Bound">pp</a> <a id="6283" class="Symbol">.</a><a id="6284" href="Ledger.PParams.html#2906" class="Field">minFeeRefScriptCoinsPerByte</a>
    <a id="6316" href="Ledger.Utxo.html#917" class="Function Operator">*↓</a> <a id="6319" href="Ledger.Set.Theory.html#3127" class="Function">∑[</a> <a id="6322" href="Ledger.Utxo.html#6322" class="Bound">x</a> <a id="6324" href="Ledger.Set.Theory.html#3127" class="Function">←</a> <a id="6326" href="Axiom.Set.Map.html#6138" class="Function">mapValues</a> <a id="6336" href="Ledger.Abstract.html#776" class="Field">scriptSize</a> <a id="6347" class="Symbol">(</a><a id="6348" href="Ledger.Set.HashMap.html#295" class="Function">setToHashMap</a> <a id="6361" class="Symbol">(</a><a id="6362" href="Ledger.Transaction.html#6208" class="Function">refScripts</a> <a id="6373" href="Ledger.Utxo.html#6184" class="Bound">tx</a> <a id="6376" href="Ledger.Utxo.html#6179" class="Bound">utxo</a><a id="6380" class="Symbol">))</a> <a id="6383" href="Ledger.Set.Theory.html#3127" class="Function">]</a> <a id="6385" href="Ledger.Utxo.html#6322" class="Bound">x</a>

<a id="6388" class="Markup">\end{code}</a><a id="6398" class="Background">
</a><a id="6399" class="Markup">\begin{code}[hide]</a>
<a id="6418" class="Keyword">instance</a>
  <a id="HasCoin-UTxO"></a><a id="6429" href="Ledger.Utxo.html#6429" class="Function">HasCoin-UTxO</a> <a id="6442" class="Symbol">:</a> <a id="6444" href="Ledger.Interface.HasCoin.html#124" class="Record">HasCoin</a> <a id="6452" href="Ledger.Transaction.html#3882" class="Function">UTxO</a>
  <a id="6459" href="Ledger.Utxo.html#6429" class="Function">HasCoin-UTxO</a> <a id="6472" class="Symbol">.</a><a id="6473" href="Ledger.Interface.HasCoin.html#172" class="Field">getCoin</a> <a id="6481" class="Symbol">=</a> <a id="6483" href="Ledger.Utxo.html#6029" class="Function">cbalance</a>
<a id="6492" class="Markup">\end{code}</a><a id="6502" class="Background">
</a><a id="6503" class="Markup">\begin{code}</a>
<a id="certDeposit"></a><a id="6516" href="Ledger.Utxo.html#6516" class="Function">certDeposit</a> <a id="6528" class="Symbol">:</a> <a id="6530" href="Ledger.Certs.html#1056" class="Datatype">DCert</a> <a id="6536" class="Symbol">→</a> <a id="6538" href="Ledger.PParams.html#2073" class="Record">PParams</a> <a id="6546" class="Symbol">→</a> <a id="6548" href="Ledger.Certs.html#349" class="Datatype">DepositPurpose</a> <a id="6563" href="Ledger.Set.Theory.html#1515" class="Function Operator">⇀</a> <a id="6565" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a>
<a id="6570" href="Ledger.Utxo.html#6516" class="Function">certDeposit</a> <a id="6582" class="Symbol">(</a><a id="6583" href="Ledger.Certs.html#1077" class="InductiveConstructor">delegate</a> <a id="6592" href="Ledger.Utxo.html#6592" class="Bound">c</a> <a id="6594" class="Symbol">_</a> <a id="6596" class="Symbol">_</a> <a id="6598" href="Ledger.Utxo.html#6598" class="Bound">v</a><a id="6599" class="Symbol">)</a> <a id="6601" class="Symbol">_</a>   <a id="6605" class="Symbol">=</a> <a id="6607" href="Interface.HasSingleton.html#348" class="Field Operator">❴</a> <a id="6609" href="Ledger.Certs.html#379" class="InductiveConstructor">CredentialDeposit</a> <a id="6627" href="Ledger.Utxo.html#6592" class="Bound">c</a> <a id="6629" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="6631" href="Ledger.Utxo.html#6598" class="Bound">v</a> <a id="6633" href="Interface.HasSingleton.html#348" class="Field Operator">❵</a>
<a id="6635" href="Ledger.Utxo.html#6516" class="Function">certDeposit</a> <a id="6647" class="Symbol">(</a><a id="6648" href="Ledger.Certs.html#1192" class="InductiveConstructor">regpool</a> <a id="6656" href="Ledger.Utxo.html#6656" class="Bound">kh</a> <a id="6659" class="Symbol">_)</a>     <a id="6666" href="Ledger.Utxo.html#6666" class="Bound">pp</a>  <a id="6670" class="Symbol">=</a> <a id="6672" href="Interface.HasSingleton.html#348" class="Field Operator">❴</a> <a id="6674" href="Ledger.Certs.html#432" class="InductiveConstructor">PoolDeposit</a> <a id="6686" href="Ledger.Utxo.html#6656" class="Bound">kh</a> <a id="6689" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="6691" href="Ledger.Utxo.html#6666" class="Bound">pp</a> <a id="6694" class="Symbol">.</a><a id="6695" href="Ledger.PParams.html#2769" class="Field">poolDeposit</a> <a id="6707" href="Interface.HasSingleton.html#348" class="Field Operator">❵</a>
<a id="6709" href="Ledger.Utxo.html#6516" class="Function">certDeposit</a> <a id="6721" class="Symbol">(</a><a id="6722" href="Ledger.Certs.html#1277" class="InductiveConstructor">regdrep</a> <a id="6730" href="Ledger.Utxo.html#6730" class="Bound">c</a> <a id="6732" href="Ledger.Utxo.html#6732" class="Bound">v</a> <a id="6734" class="Symbol">_)</a>    <a id="6740" class="Symbol">_</a>   <a id="6744" class="Symbol">=</a> <a id="6746" href="Interface.HasSingleton.html#348" class="Field Operator">❴</a> <a id="6748" href="Ledger.Certs.html#485" class="InductiveConstructor">DRepDeposit</a> <a id="6760" href="Ledger.Utxo.html#6730" class="Bound">c</a> <a id="6762" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="6764" href="Ledger.Utxo.html#6732" class="Bound">v</a> <a id="6766" href="Interface.HasSingleton.html#348" class="Field Operator">❵</a>
<a id="6768" href="Ledger.Utxo.html#6516" class="CatchallClause Function">certDeposit</a><a id="6779" class="CatchallClause"> </a><a id="6780" class="CatchallClause Symbol">_</a><a id="6781" class="CatchallClause">                  </a><a id="6799" class="CatchallClause Symbol">_</a>   <a id="6803" class="Symbol">=</a> <a id="6805" href="Interface.HasEmptySet.html#150" class="Field">∅</a>

<a id="certRefund"></a><a id="6808" href="Ledger.Utxo.html#6808" class="Function">certRefund</a> <a id="6819" class="Symbol">:</a> <a id="6821" href="Ledger.Certs.html#1056" class="Datatype">DCert</a> <a id="6827" class="Symbol">→</a> <a id="6829" href="Ledger.Set.Theory.html#382" class="Function Operator">ℙ</a> <a id="6831" href="Ledger.Certs.html#349" class="Datatype">DepositPurpose</a>
<a id="6846" href="Ledger.Utxo.html#6808" class="Function">certRefund</a> <a id="6857" class="Symbol">(</a><a id="6858" href="Ledger.Certs.html#1150" class="InductiveConstructor">dereg</a> <a id="6864" href="Ledger.Utxo.html#6864" class="Bound">c</a> <a id="6866" class="Symbol">_)</a>    <a id="6872" class="Symbol">=</a> <a id="6874" href="Interface.HasSingleton.html#348" class="Field Operator">❴</a> <a id="6876" href="Ledger.Certs.html#379" class="InductiveConstructor">CredentialDeposit</a> <a id="6894" href="Ledger.Utxo.html#6864" class="Bound">c</a> <a id="6896" href="Interface.HasSingleton.html#348" class="Field Operator">❵</a>
<a id="6898" href="Ledger.Utxo.html#6808" class="Function">certRefund</a> <a id="6909" class="Symbol">(</a><a id="6910" href="Ledger.Certs.html#1328" class="InductiveConstructor">deregdrep</a> <a id="6920" href="Ledger.Utxo.html#6920" class="Bound">c</a><a id="6921" class="Symbol">)</a>  <a id="6924" class="Symbol">=</a> <a id="6926" href="Interface.HasSingleton.html#348" class="Field Operator">❴</a> <a id="6928" href="Ledger.Certs.html#485" class="InductiveConstructor">DRepDeposit</a> <a id="6940" href="Ledger.Utxo.html#6920" class="Bound">c</a> <a id="6942" href="Interface.HasSingleton.html#348" class="Field Operator">❵</a>
<a id="6944" href="Ledger.Utxo.html#6808" class="CatchallClause Function">certRefund</a><a id="6954" class="CatchallClause"> </a><a id="6955" class="CatchallClause Symbol">_</a>              <a id="6970" class="Symbol">=</a> <a id="6972" href="Interface.HasEmptySet.html#150" class="Field">∅</a>

<a id="updateCertDeposits"></a><a id="6975" href="Ledger.Utxo.html#6975" class="Function">updateCertDeposits</a>  <a id="6995" class="Symbol">:</a> <a id="6997" href="Ledger.PParams.html#2073" class="Record">PParams</a> <a id="7005" class="Symbol">→</a> <a id="7007" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="7012" href="Ledger.Certs.html#1056" class="Datatype">DCert</a> <a id="7018" class="Symbol">→</a> <a id="7020" class="Symbol">(</a><a id="7021" href="Ledger.Certs.html#349" class="Datatype">DepositPurpose</a> <a id="7036" href="Ledger.Set.Theory.html#1515" class="Function Operator">⇀</a> <a id="7038" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a><a id="7042" class="Symbol">)</a>
                    <a id="7064" class="Symbol">→</a> <a id="7066" href="Ledger.Certs.html#349" class="Datatype">DepositPurpose</a> <a id="7081" href="Ledger.Set.Theory.html#1515" class="Function Operator">⇀</a> <a id="7083" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a>
<a id="7088" href="Ledger.Utxo.html#6975" class="Function">updateCertDeposits</a> <a id="7107" class="Symbol">_</a>   <a id="7111" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a>              <a id="7127" href="Ledger.Utxo.html#7127" class="Bound">deposits</a> <a id="7136" class="Symbol">=</a> <a id="7138" href="Ledger.Utxo.html#7127" class="Bound">deposits</a>
<a id="7147" href="Ledger.Utxo.html#6975" class="Function">updateCertDeposits</a> <a id="7166" href="Ledger.Utxo.html#7166" class="Bound">pp</a>  <a id="7170" class="Symbol">(</a><a id="7171" href="Ledger.Utxo.html#7171" class="Bound">cert</a> <a id="7176" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="7178" href="Ledger.Utxo.html#7178" class="Bound">certs</a><a id="7183" class="Symbol">)</a>  <a id="7186" href="Ledger.Utxo.html#7186" class="Bound">deposits</a>
  <a id="7197" class="Symbol">=</a> <a id="7199" class="Symbol">(</a><a id="7200" href="Ledger.Utxo.html#6975" class="Function">updateCertDeposits</a> <a id="7219" href="Ledger.Utxo.html#7166" class="Bound">pp</a> <a id="7222" href="Ledger.Utxo.html#7178" class="Bound">certs</a> <a id="7228" href="Ledger.Utxo.html#7186" class="Bound">deposits</a> <a id="7237" href="Axiom.Set.Map.Dec.html#1956" class="Function Operator">∪⁺</a> <a id="7240" href="Ledger.Utxo.html#6516" class="Function">certDeposit</a> <a id="7252" href="Ledger.Utxo.html#7171" class="Bound">cert</a> <a id="7257" href="Ledger.Utxo.html#7166" class="Bound">pp</a><a id="7259" class="Symbol">)</a> <a id="7261" href="Axiom.Set.Map.html#10177" class="Function Operator">∣</a> <a id="7263" href="Ledger.Utxo.html#6808" class="Function">certRefund</a> <a id="7274" href="Ledger.Utxo.html#7171" class="Bound">cert</a> <a id="7279" href="Axiom.Set.Map.html#10177" class="Function Operator">ᶜ</a>

<a id="updateProposalDeposits"></a><a id="7282" href="Ledger.Utxo.html#7282" class="Function">updateProposalDeposits</a> <a id="7305" class="Symbol">:</a> <a id="7307" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="7312" href="Ledger.GovernanceActions.html#8487" class="Record">GovProposal</a> <a id="7324" class="Symbol">→</a> <a id="7326" href="Ledger.Transaction.html#2322" class="Field">TxId</a> <a id="7331" class="Symbol">→</a> <a id="7333" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a> <a id="7338" class="Symbol">→</a> <a id="7340" href="Ledger.Certs.html#590" class="Function">Deposits</a> <a id="7349" class="Symbol">→</a> <a id="7351" href="Ledger.Certs.html#590" class="Function">Deposits</a>
<a id="7360" href="Ledger.Utxo.html#7282" class="Function">updateProposalDeposits</a> <a id="7383" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a>        <a id="7393" class="Symbol">_</a>     <a id="7399" class="Symbol">_</a>      <a id="7406" href="Ledger.Utxo.html#7406" class="Bound">deposits</a>  <a id="7416" class="Symbol">=</a> <a id="7418" href="Ledger.Utxo.html#7406" class="Bound">deposits</a>
<a id="7427" href="Ledger.Utxo.html#7282" class="Function">updateProposalDeposits</a> <a id="7450" class="Symbol">(_</a> <a id="7453" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="7455" href="Ledger.Utxo.html#7455" class="Bound">ps</a><a id="7457" class="Symbol">)</a>  <a id="7460" href="Ledger.Utxo.html#7460" class="Bound">txid</a>  <a id="7466" href="Ledger.Utxo.html#7466" class="Bound">gaDep</a>  <a id="7473" href="Ledger.Utxo.html#7473" class="Bound">deposits</a>  <a id="7483" class="Symbol">=</a>
  <a id="7487" href="Ledger.Utxo.html#7282" class="Function">updateProposalDeposits</a> <a id="7510" href="Ledger.Utxo.html#7455" class="Bound">ps</a> <a id="7513" href="Ledger.Utxo.html#7460" class="Bound">txid</a> <a id="7518" href="Ledger.Utxo.html#7466" class="Bound">gaDep</a> <a id="7524" href="Ledger.Utxo.html#7473" class="Bound">deposits</a>
  <a id="7535" href="Axiom.Set.Map.Dec.html#1956" class="Function Operator">∪⁺</a> <a id="7538" href="Interface.HasSingleton.html#348" class="Field Operator">❴</a> <a id="7540" href="Ledger.Certs.html#538" class="InductiveConstructor">GovActionDeposit</a> <a id="7557" class="Symbol">(</a><a id="7558" href="Ledger.Utxo.html#7460" class="Bound">txid</a> <a id="7563" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="7565" href="Data.List.Base.html#5083" class="Function">length</a> <a id="7572" href="Ledger.Utxo.html#7455" class="Bound">ps</a><a id="7574" class="Symbol">)</a> <a id="7576" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="7578" href="Ledger.Utxo.html#7466" class="Bound">gaDep</a> <a id="7584" href="Interface.HasSingleton.html#348" class="Field Operator">❵</a>

<a id="updateDeposits"></a><a id="7587" href="Ledger.Utxo.html#7587" class="Function">updateDeposits</a> <a id="7602" class="Symbol">:</a> <a id="7604" href="Ledger.PParams.html#2073" class="Record">PParams</a> <a id="7612" class="Symbol">→</a> <a id="7614" href="Ledger.Transaction.html#4126" class="Record">TxBody</a> <a id="7621" class="Symbol">→</a> <a id="7623" href="Ledger.Certs.html#590" class="Function">Deposits</a> <a id="7632" class="Symbol">→</a> <a id="7634" href="Ledger.Certs.html#590" class="Function">Deposits</a>
<a id="7643" href="Ledger.Utxo.html#7587" class="Function">updateDeposits</a> <a id="7658" href="Ledger.Utxo.html#7658" class="Bound">pp</a> <a id="7661" href="Ledger.Utxo.html#7661" class="Bound">txb</a> <a id="7665" class="Symbol">=</a> <a id="7667" href="Ledger.Utxo.html#6975" class="Function">updateCertDeposits</a> <a id="7686" href="Ledger.Utxo.html#7658" class="Bound">pp</a> <a id="7689" href="Ledger.Transaction.html#4414" class="Field">txcerts</a>
                        <a id="7721" href="Function.Base.html#1115" class="Function Operator">∘</a> <a id="7723" href="Ledger.Utxo.html#7282" class="Function">updateProposalDeposits</a> <a id="7746" href="Ledger.Transaction.html#4512" class="Field">txprop</a> <a id="7753" href="Ledger.Transaction.html#4748" class="Field">txid</a> <a id="7758" class="Symbol">(</a><a id="7759" href="Ledger.Utxo.html#7658" class="Bound">pp</a> <a id="7762" class="Symbol">.</a><a id="7763" href="Ledger.PParams.html#3745" class="Field">govActionDeposit</a><a id="7779" class="Symbol">)</a>
<a id="7781" class="Markup">\end{code}</a><a id="7791" class="Background">
</a><a id="7792" class="Markup">\begin{code}[hide]</a>
  <a id="7813" class="Keyword">where</a> <a id="7819" class="Keyword">open</a> <a id="7824" href="Ledger.Transaction.html#4126" class="Module">TxBody</a> <a id="7831" href="Ledger.Utxo.html#7661" class="Bound">txb</a>

<a id="proposalDepositsΔ"></a><a id="7836" href="Ledger.Utxo.html#7836" class="Function">proposalDepositsΔ</a> <a id="7854" class="Symbol">:</a> <a id="7856" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="7861" href="Ledger.GovernanceActions.html#8487" class="Record">GovProposal</a> <a id="7873" class="Symbol">→</a> <a id="7875" href="Ledger.PParams.html#2073" class="Record">PParams</a> <a id="7883" class="Symbol">→</a> <a id="7885" href="Ledger.Transaction.html#4126" class="Record">TxBody</a> <a id="7892" class="Symbol">→</a> <a id="7894" href="Ledger.Certs.html#349" class="Datatype">DepositPurpose</a> <a id="7909" href="Ledger.Set.Theory.html#1515" class="Function Operator">⇀</a> <a id="7911" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a>
<a id="7916" href="Ledger.Utxo.html#7836" class="Function">proposalDepositsΔ</a> <a id="7934" href="Ledger.Utxo.html#7934" class="Bound">props</a> <a id="7940" href="Ledger.Utxo.html#7940" class="Bound">pp</a> <a id="7943" href="Ledger.Utxo.html#7943" class="Bound">txb</a> <a id="7947" class="Symbol">=</a> <a id="7949" href="Ledger.Utxo.html#7282" class="Function">updateProposalDeposits</a> <a id="7972" href="Ledger.Utxo.html#7934" class="Bound">props</a> <a id="7978" href="Ledger.Transaction.html#4748" class="Field">txid</a> <a id="7983" class="Symbol">(</a><a id="7984" href="Ledger.Utxo.html#7940" class="Bound">pp</a> <a id="7987" class="Symbol">.</a><a id="7988" href="Ledger.PParams.html#3745" class="Field">govActionDeposit</a><a id="8004" class="Symbol">)</a> <a id="8006" href="Interface.HasEmptySet.html#150" class="Field">∅</a>
  <a id="8010" class="Keyword">where</a> <a id="8016" class="Keyword">open</a> <a id="8021" href="Ledger.Transaction.html#4126" class="Module">TxBody</a> <a id="8028" href="Ledger.Utxo.html#7943" class="Bound">txb</a>
<a id="8032" class="Markup">\end{code}</a><a id="8042" class="Background">
</a><a id="8043" class="Markup">\begin{code}</a>

<a id="depositsChange"></a><a id="8057" href="Ledger.Utxo.html#8057" class="Function">depositsChange</a> <a id="8072" class="Symbol">:</a> <a id="8074" href="Ledger.PParams.html#2073" class="Record">PParams</a> <a id="8082" class="Symbol">→</a> <a id="8084" href="Ledger.Transaction.html#4126" class="Record">TxBody</a> <a id="8091" class="Symbol">→</a> <a id="8093" href="Ledger.Certs.html#590" class="Function">Deposits</a> <a id="8102" class="Symbol">→</a> <a id="8104" href="Agda.Builtin.Int.html#245" class="Datatype">ℤ</a>
<a id="8106" href="Ledger.Utxo.html#8057" class="Function">depositsChange</a> <a id="8121" href="Ledger.Utxo.html#8121" class="Bound">pp</a> <a id="8124" href="Ledger.Utxo.html#8124" class="Bound">txb</a> <a id="8128" href="Ledger.Utxo.html#8128" class="Bound">deposits</a> <a id="8137" class="Symbol">=</a>
  <a id="8141" href="Ledger.Interface.HasCoin.html#172" class="Field">getCoin</a> <a id="8149" class="Symbol">(</a><a id="8150" href="Ledger.Utxo.html#7587" class="Function">updateDeposits</a> <a id="8165" href="Ledger.Utxo.html#8121" class="Bound">pp</a> <a id="8168" href="Ledger.Utxo.html#8124" class="Bound">txb</a> <a id="8172" href="Ledger.Utxo.html#8128" class="Bound">deposits</a><a id="8180" class="Symbol">)</a> <a id="8182" href="Interface.HasSubtract.html#209" class="Field Operator">-</a> <a id="8184" href="Ledger.Interface.HasCoin.html#172" class="Field">getCoin</a> <a id="8192" href="Ledger.Utxo.html#8128" class="Bound">deposits</a>
<a id="8201" class="Markup">\end{code}</a><a id="8211" class="Background">
\end{AgdaMultiCode}
\caption{Functions used in UTxO rules}
\label{fig:functions:utxo}
\end{figure*}

\begin{NoConway}
\begin{figure*}
\begin{AgdaMultiCode}
</a><a id="8368" class="Markup">\begin{code}</a>
<a id="8381" class="Keyword">data</a> <a id="inInterval"></a><a id="8386" href="Ledger.Utxo.html#8386" class="Datatype">inInterval</a> <a id="8397" class="Symbol">(</a><a id="8398" href="Ledger.Utxo.html#8398" class="Bound">slot</a> <a id="8403" class="Symbol">:</a> <a id="8405" href="Ledger.Types.Epoch.html#382" class="Function">Slot</a><a id="8409" class="Symbol">)</a> <a id="8411" class="Symbol">:</a> <a id="8413" class="Symbol">(</a><a id="8414" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="8420" href="Ledger.Types.Epoch.html#382" class="Function">Slot</a> <a id="8425" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="8427" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="8433" href="Ledger.Types.Epoch.html#382" class="Function">Slot</a><a id="8437" class="Symbol">)</a> <a id="8439" class="Symbol">→</a> <a id="8441" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="8446" class="Keyword">where</a>
  <a id="inInterval.both"></a><a id="8454" href="Ledger.Utxo.html#8454" class="InductiveConstructor">both</a>   <a id="8461" class="Symbol">:</a> <a id="8463" class="Symbol">∀</a> <a id="8465" class="Symbol">{</a><a id="8466" href="Ledger.Utxo.html#8466" class="Bound">l</a> <a id="8468" href="Ledger.Utxo.html#8468" class="Bound">r</a><a id="8469" class="Symbol">}</a>  <a id="8472" class="Symbol">→</a> <a id="8474" href="Ledger.Utxo.html#8466" class="Bound">l</a> <a id="8476" href="Interface.HasOrder.html#301" class="Field Operator">≤</a> <a id="8478" href="Ledger.Utxo.html#8398" class="Bound">slot</a> <a id="8483" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="8485" href="Ledger.Utxo.html#8398" class="Bound">slot</a> <a id="8490" href="Interface.HasOrder.html#301" class="Field Operator">≤</a> <a id="8492" href="Ledger.Utxo.html#8468" class="Bound">r</a>  <a id="8495" class="Symbol">→</a>  <a id="8498" href="Ledger.Utxo.html#8386" class="Datatype">inInterval</a> <a id="8509" href="Ledger.Utxo.html#8398" class="Bound">slot</a> <a id="8514" class="Symbol">(</a><a id="8515" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="8520" href="Ledger.Utxo.html#8466" class="Bound">l</a>   <a id="8524" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="8526" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="8531" href="Ledger.Utxo.html#8468" class="Bound">r</a><a id="8532" class="Symbol">)</a>
  <a id="inInterval.lower"></a><a id="8536" href="Ledger.Utxo.html#8536" class="InductiveConstructor">lower</a>  <a id="8543" class="Symbol">:</a> <a id="8545" class="Symbol">∀</a> <a id="8547" class="Symbol">{</a><a id="8548" href="Ledger.Utxo.html#8548" class="Bound">l</a><a id="8549" class="Symbol">}</a>    <a id="8554" class="Symbol">→</a> <a id="8556" href="Ledger.Utxo.html#8548" class="Bound">l</a> <a id="8558" href="Interface.HasOrder.html#301" class="Field Operator">≤</a> <a id="8560" href="Ledger.Utxo.html#8398" class="Bound">slot</a>             <a id="8577" class="Symbol">→</a>  <a id="8580" href="Ledger.Utxo.html#8386" class="Datatype">inInterval</a> <a id="8591" href="Ledger.Utxo.html#8398" class="Bound">slot</a> <a id="8596" class="Symbol">(</a><a id="8597" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="8602" href="Ledger.Utxo.html#8548" class="Bound">l</a>   <a id="8606" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="8608" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a><a id="8615" class="Symbol">)</a>
  <a id="inInterval.upper"></a><a id="8619" href="Ledger.Utxo.html#8619" class="InductiveConstructor">upper</a>  <a id="8626" class="Symbol">:</a> <a id="8628" class="Symbol">∀</a> <a id="8630" class="Symbol">{</a><a id="8631" href="Ledger.Utxo.html#8631" class="Bound">r</a><a id="8632" class="Symbol">}</a>    <a id="8637" class="Symbol">→</a> <a id="8639" href="Ledger.Utxo.html#8398" class="Bound">slot</a> <a id="8644" href="Interface.HasOrder.html#301" class="Field Operator">≤</a> <a id="8646" href="Ledger.Utxo.html#8631" class="Bound">r</a>             <a id="8660" class="Symbol">→</a>  <a id="8663" href="Ledger.Utxo.html#8386" class="Datatype">inInterval</a> <a id="8674" href="Ledger.Utxo.html#8398" class="Bound">slot</a> <a id="8679" class="Symbol">(</a><a id="8680" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a>  <a id="8689" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="8691" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="8696" href="Ledger.Utxo.html#8631" class="Bound">r</a><a id="8697" class="Symbol">)</a>
  <a id="inInterval.none"></a><a id="8701" href="Ledger.Utxo.html#8701" class="InductiveConstructor">none</a>   <a id="8708" class="Symbol">:</a>                                    <a id="8745" href="Ledger.Utxo.html#8386" class="Datatype">inInterval</a> <a id="8756" href="Ledger.Utxo.html#8398" class="Bound">slot</a> <a id="8761" class="Symbol">(</a><a id="8762" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a>  <a id="8771" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="8773" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a><a id="8780" class="Symbol">)</a>
<a id="8782" class="Markup">\end{code}</a><a id="8792" class="Background">
</a><a id="8793" class="Markup">\begin{code}[hide]</a>
<a id="8812" class="Comment">-- Note: inInterval has to be a type definition for inference to work</a>
<a id="8882" class="Keyword">instance</a>
  <a id="Dec-inInterval"></a><a id="8893" href="Ledger.Utxo.html#8893" class="Function">Dec-inInterval</a> <a id="8908" class="Symbol">:</a> <a id="8910" href="Ledger.Utxo.html#8386" class="Datatype">inInterval</a> <a id="8921" href="Class.Decidable.Core.html#773" class="Function Operator">⁇²</a>
  <a id="8926" href="Ledger.Utxo.html#8893" class="Function">Dec-inInterval</a> <a id="8941" class="Symbol">{</a><a id="8942" href="Ledger.Utxo.html#8942" class="Bound">slot</a><a id="8946" class="Symbol">}</a> <a id="8948" class="Symbol">{</a><a id="8949" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="8954" href="Ledger.Utxo.html#8954" class="Bound">x</a>  <a id="8957" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="8959" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="8964" href="Ledger.Utxo.html#8964" class="Bound">y</a> <a id="8966" class="Symbol">}</a> <a id="8968" class="Symbol">.</a><a id="8969" href="Class.Decidable.Core.html#264" class="Field">dec</a> <a id="8973" class="Keyword">with</a> <a id="8978" href="Ledger.Utxo.html#8954" class="Bound">x</a> <a id="8980" href="Interface.HasOrder.html#667" class="Function Operator">≤?</a> <a id="8983" href="Ledger.Utxo.html#8942" class="Bound">slot</a> <a id="8988" class="Symbol">|</a> <a id="8990" href="Ledger.Utxo.html#8942" class="Bound">slot</a> <a id="8995" href="Interface.HasOrder.html#667" class="Function Operator">≤?</a> <a id="8998" href="Ledger.Utxo.html#8964" class="Bound">y</a>
  <a id="9002" class="Symbol">...</a> <a id="9006" class="Symbol">|</a> <a id="9008" href="Relation.Nullary.Decidable.Core.html#1655" class="InductiveConstructor">no</a> <a id="9011" href="Ledger.Utxo.html#9011" class="Bound">¬p₁</a> <a id="9015" class="Symbol">|</a> <a id="9017" class="Symbol">_</a>      <a id="9024" class="Symbol">=</a> <a id="9026" href="Relation.Nullary.Decidable.Core.html#1655" class="InductiveConstructor">no</a> <a id="9029" class="Symbol">λ</a> <a id="9031" class="Keyword">where</a> <a id="9037" class="Symbol">(</a><a id="9038" href="Ledger.Utxo.html#8454" class="InductiveConstructor">both</a> <a id="9043" class="Symbol">(</a><a id="9044" href="Ledger.Utxo.html#9044" class="Bound">h₁</a> <a id="9047" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="9049" href="Ledger.Utxo.html#9049" class="Bound">h₂</a><a id="9051" class="Symbol">))</a> <a id="9054" class="Symbol">→</a> <a id="9056" href="Ledger.Utxo.html#9011" class="Bound">¬p₁</a> <a id="9060" href="Ledger.Utxo.html#9044" class="Bound">h₁</a>
  <a id="9065" class="Symbol">...</a> <a id="9069" class="Symbol">|</a> <a id="9071" href="Relation.Nullary.Decidable.Core.html#1618" class="InductiveConstructor">yes</a> <a id="9075" href="Ledger.Utxo.html#9075" class="Bound">p₁</a> <a id="9078" class="Symbol">|</a> <a id="9080" href="Relation.Nullary.Decidable.Core.html#1655" class="InductiveConstructor">no</a> <a id="9083" href="Ledger.Utxo.html#9083" class="Bound">¬p₂</a> <a id="9087" class="Symbol">=</a> <a id="9089" href="Relation.Nullary.Decidable.Core.html#1655" class="InductiveConstructor">no</a> <a id="9092" class="Symbol">λ</a> <a id="9094" class="Keyword">where</a> <a id="9100" class="Symbol">(</a><a id="9101" href="Ledger.Utxo.html#8454" class="InductiveConstructor">both</a> <a id="9106" class="Symbol">(</a><a id="9107" href="Ledger.Utxo.html#9107" class="Bound">h₁</a> <a id="9110" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="9112" href="Ledger.Utxo.html#9112" class="Bound">h₂</a><a id="9114" class="Symbol">))</a> <a id="9117" class="Symbol">→</a> <a id="9119" href="Ledger.Utxo.html#9083" class="Bound">¬p₂</a> <a id="9123" href="Ledger.Utxo.html#9112" class="Bound">h₂</a>
  <a id="9128" class="Symbol">...</a> <a id="9132" class="Symbol">|</a> <a id="9134" href="Relation.Nullary.Decidable.Core.html#1618" class="InductiveConstructor">yes</a> <a id="9138" href="Ledger.Utxo.html#9138" class="Bound">p₁</a> <a id="9141" class="Symbol">|</a> <a id="9143" href="Relation.Nullary.Decidable.Core.html#1618" class="InductiveConstructor">yes</a> <a id="9147" href="Ledger.Utxo.html#9147" class="Bound">p₂</a> <a id="9150" class="Symbol">=</a> <a id="9152" href="Relation.Nullary.Decidable.Core.html#1618" class="InductiveConstructor">yes</a> <a id="9156" class="Symbol">(</a><a id="9157" href="Ledger.Utxo.html#8454" class="InductiveConstructor">both</a> <a id="9162" class="Symbol">(</a><a id="9163" href="Ledger.Utxo.html#9138" class="Bound">p₁</a> <a id="9166" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="9168" href="Ledger.Utxo.html#9147" class="Bound">p₂</a><a id="9170" class="Symbol">))</a>
  <a id="9175" href="Ledger.Utxo.html#8893" class="Function">Dec-inInterval</a> <a id="9190" class="Symbol">{</a><a id="9191" href="Ledger.Utxo.html#9191" class="Bound">slot</a><a id="9195" class="Symbol">}</a> <a id="9197" class="Symbol">{</a><a id="9198" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="9203" href="Ledger.Utxo.html#9203" class="Bound">x</a>  <a id="9206" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="9208" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a><a id="9215" class="Symbol">}</a> <a id="9217" class="Symbol">.</a><a id="9218" href="Class.Decidable.Core.html#264" class="Field">dec</a> <a id="9222" class="Keyword">with</a> <a id="9227" href="Ledger.Utxo.html#9203" class="Bound">x</a> <a id="9229" href="Interface.HasOrder.html#667" class="Function Operator">≤?</a> <a id="9232" href="Ledger.Utxo.html#9191" class="Bound">slot</a>
  <a id="9239" class="Symbol">...</a> <a id="9243" class="Symbol">|</a> <a id="9245" href="Relation.Nullary.Decidable.Core.html#1655" class="InductiveConstructor">no</a> <a id="9248" href="Ledger.Utxo.html#9248" class="Bound">¬p</a> <a id="9251" class="Symbol">=</a> <a id="9253" href="Relation.Nullary.Decidable.Core.html#1655" class="InductiveConstructor">no</a>  <a id="9257" class="Symbol">(λ</a> <a id="9260" class="Keyword">where</a> <a id="9266" class="Symbol">(</a><a id="9267" href="Ledger.Utxo.html#8536" class="InductiveConstructor">lower</a> <a id="9273" href="Ledger.Utxo.html#9273" class="Bound">h</a><a id="9274" class="Symbol">)</a> <a id="9276" class="Symbol">→</a> <a id="9278" href="Ledger.Utxo.html#9248" class="Bound">¬p</a> <a id="9281" href="Ledger.Utxo.html#9273" class="Bound">h</a><a id="9282" class="Symbol">)</a>
  <a id="9286" class="Symbol">...</a> <a id="9290" class="Symbol">|</a> <a id="9292" href="Relation.Nullary.Decidable.Core.html#1618" class="InductiveConstructor">yes</a> <a id="9296" href="Ledger.Utxo.html#9296" class="Bound">p</a> <a id="9298" class="Symbol">=</a> <a id="9300" href="Relation.Nullary.Decidable.Core.html#1618" class="InductiveConstructor">yes</a> <a id="9304" class="Symbol">(</a><a id="9305" href="Ledger.Utxo.html#8536" class="InductiveConstructor">lower</a> <a id="9311" href="Ledger.Utxo.html#9296" class="Bound">p</a><a id="9312" class="Symbol">)</a>
  <a id="9316" href="Ledger.Utxo.html#8893" class="Function">Dec-inInterval</a> <a id="9331" class="Symbol">{</a><a id="9332" href="Ledger.Utxo.html#9332" class="Bound">slot</a><a id="9336" class="Symbol">}</a> <a id="9338" class="Symbol">{</a><a id="9339" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a> <a id="9347" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="9349" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="9354" href="Ledger.Utxo.html#9354" class="Bound">x</a> <a id="9356" class="Symbol">}</a> <a id="9358" class="Symbol">.</a><a id="9359" href="Class.Decidable.Core.html#264" class="Field">dec</a> <a id="9363" class="Keyword">with</a> <a id="9368" href="Ledger.Utxo.html#9332" class="Bound">slot</a> <a id="9373" href="Interface.HasOrder.html#667" class="Function Operator">≤?</a> <a id="9376" href="Ledger.Utxo.html#9354" class="Bound">x</a>
  <a id="9380" class="Symbol">...</a> <a id="9384" class="Symbol">|</a> <a id="9386" href="Relation.Nullary.Decidable.Core.html#1655" class="InductiveConstructor">no</a> <a id="9389" href="Ledger.Utxo.html#9389" class="Bound">¬p</a> <a id="9392" class="Symbol">=</a> <a id="9394" href="Relation.Nullary.Decidable.Core.html#1655" class="InductiveConstructor">no</a>  <a id="9398" class="Symbol">(λ</a> <a id="9401" class="Keyword">where</a> <a id="9407" class="Symbol">(</a><a id="9408" href="Ledger.Utxo.html#8619" class="InductiveConstructor">upper</a> <a id="9414" href="Ledger.Utxo.html#9414" class="Bound">h</a><a id="9415" class="Symbol">)</a> <a id="9417" class="Symbol">→</a> <a id="9419" href="Ledger.Utxo.html#9389" class="Bound">¬p</a> <a id="9422" href="Ledger.Utxo.html#9414" class="Bound">h</a><a id="9423" class="Symbol">)</a>
  <a id="9427" class="Symbol">...</a> <a id="9431" class="Symbol">|</a> <a id="9433" href="Relation.Nullary.Decidable.Core.html#1618" class="InductiveConstructor">yes</a> <a id="9437" href="Ledger.Utxo.html#9437" class="Bound">p</a> <a id="9439" class="Symbol">=</a> <a id="9441" href="Relation.Nullary.Decidable.Core.html#1618" class="InductiveConstructor">yes</a> <a id="9445" class="Symbol">(</a><a id="9446" href="Ledger.Utxo.html#8619" class="InductiveConstructor">upper</a> <a id="9452" href="Ledger.Utxo.html#9437" class="Bound">p</a><a id="9453" class="Symbol">)</a>
  <a id="9457" href="Ledger.Utxo.html#8893" class="Function">Dec-inInterval</a> <a id="9472" class="Symbol">{</a><a id="9473" href="Ledger.Utxo.html#9473" class="Bound">slot</a><a id="9477" class="Symbol">}</a> <a id="9479" class="Symbol">{</a><a id="9480" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a> <a id="9488" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="9490" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a><a id="9497" class="Symbol">}</a> <a id="9499" class="Symbol">.</a><a id="9500" href="Class.Decidable.Core.html#264" class="Field">dec</a> <a id="9504" class="Symbol">=</a> <a id="9506" href="Relation.Nullary.Decidable.Core.html#1618" class="InductiveConstructor">yes</a> <a id="9510" href="Ledger.Utxo.html#8701" class="InductiveConstructor">none</a>

  <a id="HasCoin-UTxOState"></a><a id="9518" href="Ledger.Utxo.html#9518" class="Function">HasCoin-UTxOState</a> <a id="9536" class="Symbol">:</a> <a id="9538" href="Ledger.Interface.HasCoin.html#124" class="Record">HasCoin</a> <a id="9546" href="Ledger.Utxo.html#5208" class="Record">UTxOState</a>
  <a id="9558" href="Ledger.Utxo.html#9518" class="Function">HasCoin-UTxOState</a> <a id="9576" class="Symbol">.</a><a id="9577" href="Ledger.Interface.HasCoin.html#172" class="Field">getCoin</a> <a id="9585" href="Ledger.Utxo.html#9585" class="Bound">s</a> <a id="9587" class="Symbol">=</a> <a id="9589" href="Ledger.Interface.HasCoin.html#172" class="Field">getCoin</a> <a id="9597" class="Symbol">(</a><a id="9598" href="Ledger.Utxo.html#5322" class="Field">UTxOState.utxo</a> <a id="9613" href="Ledger.Utxo.html#9585" class="Bound">s</a><a id="9614" class="Symbol">)</a>
                               <a id="9647" href="Interface.HasAdd.html#135" class="Field Operator">+</a> <a id="9649" class="Symbol">(</a><a id="9650" href="Ledger.Utxo.html#5344" class="Field">UTxOState.fees</a> <a id="9665" href="Ledger.Utxo.html#9585" class="Bound">s</a><a id="9666" class="Symbol">)</a>
                               <a id="9699" href="Interface.HasAdd.html#135" class="Field Operator">+</a> <a id="9701" href="Ledger.Interface.HasCoin.html#172" class="Field">getCoin</a> <a id="9709" class="Symbol">(</a><a id="9710" href="Ledger.Utxo.html#5366" class="Field">UTxOState.deposits</a> <a id="9729" href="Ledger.Utxo.html#9585" class="Bound">s</a><a id="9730" class="Symbol">)</a>
                               <a id="9763" href="Interface.HasAdd.html#135" class="Field Operator">+</a> <a id="9765" href="Ledger.Utxo.html#5392" class="Field">UTxOState.donations</a> <a id="9785" href="Ledger.Utxo.html#9585" class="Bound">s</a>

<a id="9788" class="Comment">-- Boolean implication</a>
<a id="_=&gt;ᵇ_"></a><a id="9811" href="Ledger.Utxo.html#9811" class="Function Operator">_=&gt;ᵇ_</a> <a id="9817" class="Symbol">:</a> <a id="9819" href="Agda.Builtin.Bool.html#173" class="Datatype">Bool</a> <a id="9824" class="Symbol">→</a> <a id="9826" href="Agda.Builtin.Bool.html#173" class="Datatype">Bool</a> <a id="9831" class="Symbol">→</a> <a id="9833" href="Agda.Builtin.Bool.html#173" class="Datatype">Bool</a>
<a id="9838" href="Ledger.Utxo.html#9838" class="Bound">a</a> <a id="9840" href="Ledger.Utxo.html#9811" class="Function Operator">=&gt;ᵇ</a> <a id="9844" href="Ledger.Utxo.html#9844" class="Bound">b</a> <a id="9846" class="Symbol">=</a> <a id="9848" href="Interface.ToBool.html#287" class="Function Operator">if</a> <a id="9851" href="Ledger.Utxo.html#9838" class="Bound">a</a> <a id="9853" href="Interface.ToBool.html#287" class="Function Operator">then</a> <a id="9858" href="Ledger.Utxo.html#9844" class="Bound">b</a> <a id="9860" href="Interface.ToBool.html#287" class="Function Operator">else</a> <a id="9865" href="Agda.Builtin.Bool.html#198" class="InductiveConstructor">true</a>

<a id="9871" class="Comment">-- Boolean-valued inequalities on natural numbers</a>
<a id="_≤ᵇ_"></a><a id="9921" href="Ledger.Utxo.html#9921" class="Function Operator">_≤ᵇ_</a> <a id="_≥ᵇ_"></a><a id="9926" href="Ledger.Utxo.html#9926" class="Function Operator">_≥ᵇ_</a> <a id="9931" class="Symbol">:</a> <a id="9933" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a> <a id="9935" class="Symbol">→</a> <a id="9937" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a> <a id="9939" class="Symbol">→</a> <a id="9941" href="Agda.Builtin.Bool.html#173" class="Datatype">Bool</a>
<a id="9946" href="Ledger.Utxo.html#9946" class="Bound">m</a> <a id="9948" href="Ledger.Utxo.html#9921" class="Function Operator">≤ᵇ</a> <a id="9951" href="Ledger.Utxo.html#9951" class="Bound">n</a> <a id="9953" class="Symbol">=</a> <a id="9955" href="Class.Decidable.Core.html#513" class="Function Operator">¿</a> <a id="9957" href="Ledger.Utxo.html#9946" class="Bound">m</a> <a id="9959" href="Interface.HasOrder.html#301" class="Field Operator">≤</a> <a id="9961" href="Ledger.Utxo.html#9951" class="Bound">n</a> <a id="9963" href="Class.Decidable.Core.html#513" class="Function Operator">¿ᵇ</a>
<a id="9966" href="Ledger.Utxo.html#9926" class="Function Operator">_≥ᵇ_</a> <a id="9971" class="Symbol">=</a> <a id="9973" href="Function.Base.html#1638" class="Function">flip</a> <a id="9978" href="Ledger.Utxo.html#9921" class="Function Operator">_≤ᵇ_</a>

<a id="≟-∅ᵇ"></a><a id="9984" href="Ledger.Utxo.html#9984" class="Function">≟-∅ᵇ</a> <a id="9989" class="Symbol">:</a> <a id="9991" class="Symbol">{</a><a id="9992" href="Ledger.Utxo.html#9992" class="Bound">A</a> <a id="9994" class="Symbol">:</a> <a id="9996" href="Agda.Primitive.html#388" class="Primitive">Type</a><a id="10000" class="Symbol">}</a> <a id="10002" class="Symbol">⦃</a> <a id="10004" href="Ledger.Utxo.html#10004" class="Bound">_</a> <a id="10006" class="Symbol">:</a> <a id="10008" href="Class.DecEq.Core.html#117" class="Record">DecEq</a> <a id="10014" href="Ledger.Utxo.html#9992" class="Bound">A</a> <a id="10016" class="Symbol">⦄</a> <a id="10018" class="Symbol">→</a> <a id="10020" class="Symbol">(</a><a id="10021" href="Ledger.Utxo.html#10021" class="Bound">X</a> <a id="10023" class="Symbol">:</a> <a id="10025" href="Ledger.Set.Theory.html#382" class="Function Operator">ℙ</a> <a id="10027" href="Ledger.Utxo.html#9992" class="Bound">A</a><a id="10028" class="Symbol">)</a> <a id="10030" class="Symbol">→</a> <a id="10032" href="Agda.Builtin.Bool.html#173" class="Datatype">Bool</a>
<a id="10037" href="Ledger.Utxo.html#9984" class="Function">≟-∅ᵇ</a> <a id="10042" href="Ledger.Utxo.html#10042" class="Bound">X</a> <a id="10044" class="Symbol">=</a> <a id="10046" href="Class.Decidable.Core.html#513" class="Function Operator">¿</a> <a id="10048" href="Ledger.Utxo.html#10042" class="Bound">X</a> <a id="10050" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="10052" href="Interface.HasEmptySet.html#150" class="Field">∅</a> <a id="10054" href="Class.Decidable.Core.html#513" class="Function Operator">¿ᵇ</a>

<a id="coinPolicies"></a><a id="10058" href="Ledger.Utxo.html#10058" class="Function">coinPolicies</a> <a id="10071" class="Symbol">:</a> <a id="10073" href="Ledger.Set.Theory.html#382" class="Function Operator">ℙ</a> <a id="10075" href="Ledger.Crypto.html#1525" class="Function">ScriptHash</a>
<a id="10086" href="Ledger.Utxo.html#10058" class="Function">coinPolicies</a> <a id="10099" class="Symbol">=</a> <a id="10101" href="Ledger.TokenAlgebra.html#1323" class="Function">policies</a> <a id="10110" class="Symbol">(</a><a id="10111" href="Ledger.TokenAlgebra.html#1278" class="Function">inject</a> <a id="10118" class="Number">1</a><a id="10119" class="Symbol">)</a>

<a id="isAdaOnlyᵇ"></a><a id="10122" href="Ledger.Utxo.html#10122" class="Function">isAdaOnlyᵇ</a> <a id="10133" class="Symbol">:</a> <a id="10135" href="Ledger.TokenAlgebra.html#816" class="Function">Value</a> <a id="10141" class="Symbol">→</a> <a id="10143" href="Agda.Builtin.Bool.html#173" class="Datatype">Bool</a>
<a id="10148" href="Ledger.Utxo.html#10122" class="Function">isAdaOnlyᵇ</a> <a id="10159" href="Ledger.Utxo.html#10159" class="Bound">v</a> <a id="10161" class="Symbol">=</a> <a id="10163" href="Interface.ToBool.html#456" class="Function">toBool</a> <a id="10170" class="Symbol">(</a><a id="10171" href="Ledger.TokenAlgebra.html#1323" class="Function">policies</a> <a id="10180" href="Ledger.Utxo.html#10159" class="Bound">v</a> <a id="10182" href="Axiom.Set.html#2413" class="Function Operator">≡ᵉ</a> <a id="10185" href="Ledger.Utxo.html#10058" class="Function">coinPolicies</a><a id="10197" class="Symbol">)</a>

<a id="10200" class="Comment">-- TODO: this could be a regular property</a>
<a id="10242" class="Comment">-- TODO: using this in UTxO rule below</a>
<a id="10281" class="Markup">\end{code}</a><a id="10291" class="Background">
</a><a id="10292" class="Markup">\begin{code}</a>

<a id="feesOK"></a><a id="10306" href="Ledger.Utxo.html#10306" class="Function">feesOK</a> <a id="10313" class="Symbol">:</a> <a id="10315" href="Ledger.PParams.html#2073" class="Record">PParams</a> <a id="10323" class="Symbol">→</a> <a id="10325" href="Ledger.Transaction.html#5227" class="Record">Tx</a> <a id="10328" class="Symbol">→</a> <a id="10330" href="Ledger.Transaction.html#3882" class="Function">UTxO</a> <a id="10335" class="Symbol">→</a> <a id="10337" href="Agda.Builtin.Bool.html#173" class="Datatype">Bool</a>
<a id="10342" href="Ledger.Utxo.html#10306" class="Function">feesOK</a> <a id="10349" href="Ledger.Utxo.html#10349" class="Bound">pp</a> <a id="10352" href="Ledger.Utxo.html#10352" class="Bound">tx</a> <a id="10355" href="Ledger.Utxo.html#10355" class="Bound">utxo</a> <a id="10360" class="Symbol">=</a> <a id="10362" href="Ledger.Utxo.html#6131" class="Function">minfee</a> <a id="10369" href="Ledger.Utxo.html#10349" class="Bound">pp</a> <a id="10372" href="Ledger.Utxo.html#10355" class="Bound">utxo</a> <a id="10377" href="Ledger.Utxo.html#10352" class="Bound">tx</a> <a id="10380" href="Ledger.Utxo.html#9921" class="Function Operator">≤ᵇ</a> <a id="10383" href="Ledger.Transaction.html#4310" class="Function">txfee</a>
                  <a id="10407" href="Data.Bool.Base.html#995" class="Function Operator">∧</a> <a id="10409" href="Data.Bool.Base.html#941" class="Function">not</a> <a id="10413" class="Symbol">(</a><a id="10414" href="Ledger.Utxo.html#9984" class="Function">≟-∅ᵇ</a> <a id="10419" class="Symbol">(</a><a id="10420" href="Ledger.Transaction.html#5106" class="Function">txrdmrs</a> <a id="10428" href="Axiom.Set.Map.html#2282" class="Function Operator">ˢ</a><a id="10429" class="Symbol">))</a>
                  <a id="10450" href="Ledger.Utxo.html#9811" class="Function Operator">=&gt;ᵇ</a> <a id="10454" class="Symbol">(</a> <a id="10456" href="Axiom.Set.html#10778" class="Function">allᵇ</a> <a id="10461" class="Symbol">(λ</a> <a id="10464" class="Symbol">(</a><a id="10465" href="Ledger.Utxo.html#10465" class="Bound">addr</a> <a id="10470" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="10472" class="Symbol">_)</a> <a id="10475" class="Symbol">→</a> <a id="10477" href="Class.Decidable.Core.html#461" class="Function Operator">¿</a> <a id="10479" href="Ledger.Address.html#2407" class="Function">isVKeyAddr</a> <a id="10490" href="Ledger.Utxo.html#10465" class="Bound">addr</a> <a id="10495" href="Class.Decidable.Core.html#461" class="Function Operator">¿</a><a id="10496" class="Symbol">)</a> <a id="10498" href="Ledger.Utxo.html#10787" class="Function">collateralRange</a>
                      <a id="10536" href="Data.Bool.Base.html#995" class="Function Operator">∧</a> <a id="10538" href="Ledger.Utxo.html#10122" class="Function">isAdaOnlyᵇ</a> <a id="10549" href="Ledger.Utxo.html#10861" class="Function">bal</a>
                      <a id="10575" href="Data.Bool.Base.html#995" class="Function Operator">∧</a> <a id="10577" class="Symbol">(</a><a id="10578" href="Ledger.TokenAlgebra.html#1233" class="Function">coin</a> <a id="10583" href="Ledger.Utxo.html#10861" class="Function">bal</a> <a id="10587" href="Agda.Builtin.Nat.html#539" class="Primitive Operator">*</a> <a id="10589" class="Number">100</a><a id="10592" class="Symbol">)</a> <a id="10594" href="Ledger.Utxo.html#9926" class="Function Operator">≥ᵇ</a> <a id="10597" class="Symbol">(</a><a id="10598" href="Ledger.Transaction.html#4310" class="Function">txfee</a> <a id="10604" href="Agda.Builtin.Nat.html#539" class="Primitive Operator">*</a> <a id="10606" href="Ledger.Utxo.html#10349" class="Bound">pp</a> <a id="10609" class="Symbol">.</a><a id="10610" href="Ledger.PParams.html#3225" class="Field">collateralPercentage</a><a id="10630" class="Symbol">)</a>
                      <a id="10654" href="Data.Bool.Base.html#995" class="Function Operator">∧</a> <a id="10656" href="Data.Bool.Base.html#941" class="Function">not</a> <a id="10660" class="Symbol">(</a><a id="10661" href="Ledger.Utxo.html#9984" class="Function">≟-∅ᵇ</a> <a id="10666" href="Ledger.Transaction.html#4776" class="Function">collateral</a><a id="10676" class="Symbol">)</a>
                      <a id="10700" class="Symbol">)</a>
  <a id="10704" class="Keyword">where</a>
    <a id="10714" class="Keyword">open</a> <a id="10719" href="Ledger.Transaction.html#5227" class="Module">Tx</a> <a id="10722" href="Ledger.Utxo.html#10352" class="Bound">tx</a><a id="10724" class="Symbol">;</a> <a id="10726" class="Keyword">open</a> <a id="10731" href="Ledger.Transaction.html#4126" class="Module">TxBody</a> <a id="10738" href="Ledger.Transaction.html#5313" class="Function">body</a><a id="10742" class="Symbol">;</a> <a id="10744" class="Keyword">open</a> <a id="10749" href="Ledger.Transaction.html#4923" class="Module">TxWitnesses</a> <a id="10761" href="Ledger.Transaction.html#5337" class="Function">wits</a><a id="10765" class="Symbol">;</a> <a id="10767" class="Keyword">open</a> <a id="10772" href="Ledger.PParams.html#2073" class="Module">PParams</a> <a id="10780" href="Ledger.Utxo.html#10349" class="Bound">pp</a>
    <a id="10787" href="Ledger.Utxo.html#10787" class="Function">collateralRange</a>  <a id="10804" class="Symbol">=</a> <a id="10806" href="Interface.IsSet.html#977" class="Function">range</a>    <a id="10815" class="Symbol">((</a><a id="10817" href="Axiom.Set.Map.html#6138" class="Function">mapValues</a> <a id="10827" href="Ledger.Transaction.html#5750" class="Function">txOutHash</a> <a id="10837" href="Ledger.Utxo.html#10355" class="Bound">utxo</a><a id="10841" class="Symbol">)</a> <a id="10843" href="Axiom.Set.Map.html#10107" class="Function Operator">∣</a> <a id="10845" href="Ledger.Transaction.html#4776" class="Function">collateral</a><a id="10855" class="Symbol">)</a>
    <a id="10861" href="Ledger.Utxo.html#10861" class="Function">bal</a>              <a id="10878" class="Symbol">=</a> <a id="10880" href="Ledger.Utxo.html#5940" class="Function">balance</a>  <a id="10889" class="Symbol">(</a><a id="10890" href="Ledger.Utxo.html#10355" class="Bound">utxo</a> <a id="10895" href="Axiom.Set.Map.html#10107" class="Function Operator">∣</a> <a id="10897" href="Ledger.Transaction.html#4776" class="Function">collateral</a><a id="10907" class="Symbol">)</a>
<a id="10909" class="Markup">\end{code}</a><a id="10919" class="Background">
\end{AgdaMultiCode}
\caption{Functions used in UTxO rules, continued}
\label{fig:functions:utxo2}
\end{figure*}
\end{NoConway}

\begin{figure*}
</a><a id="11064" class="Markup">\begin{code}[hide]</a>
<a id="11083" class="Keyword">module</a> <a id="11090" href="Ledger.Utxo.html#11090" class="Module">_</a> <a id="11092" class="Symbol">(</a><a id="11093" class="Keyword">let</a> <a id="11097" class="Keyword">open</a> <a id="11102" href="Ledger.Utxo.html#5208" class="Module">UTxOState</a><a id="11111" class="Symbol">;</a> <a id="11113" class="Keyword">open</a> <a id="11118" href="Ledger.Transaction.html#4126" class="Module">TxBody</a><a id="11124" class="Symbol">)</a> <a id="11126" class="Keyword">where</a>
<a id="11132" class="Markup">\end{code}</a><a id="11142" class="Background">
</a><a id="11143" class="Markup">\begin{code}</a>
  <a id="11158" href="Ledger.Utxo.html#11158" class="Function">depositRefunds</a> <a id="11173" class="Symbol">:</a> <a id="11175" href="Ledger.PParams.html#2073" class="Record">PParams</a> <a id="11183" class="Symbol">→</a> <a id="11185" href="Ledger.Utxo.html#5208" class="Record">UTxOState</a> <a id="11195" class="Symbol">→</a> <a id="11197" href="Ledger.Transaction.html#4126" class="Record">TxBody</a> <a id="11204" class="Symbol">→</a> <a id="11206" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a>
  <a id="11213" href="Ledger.Utxo.html#11158" class="Function">depositRefunds</a> <a id="11228" href="Ledger.Utxo.html#11228" class="Bound">pp</a> <a id="11231" href="Ledger.Utxo.html#11231" class="Bound">st</a> <a id="11234" href="Ledger.Utxo.html#11234" class="Bound">txb</a> <a id="11238" class="Symbol">=</a> <a id="11240" href="Data.Integer.Ext.html#440" class="Function">negPart</a> <a id="11248" class="Symbol">(</a><a id="11249" href="Ledger.Utxo.html#8057" class="Function">depositsChange</a> <a id="11264" href="Ledger.Utxo.html#11228" class="Bound">pp</a> <a id="11267" href="Ledger.Utxo.html#11234" class="Bound">txb</a> <a id="11271" class="Symbol">(</a><a id="11272" href="Ledger.Utxo.html#11231" class="Bound">st</a> <a id="11275" class="Symbol">.</a><a id="11276" href="Ledger.Utxo.html#5366" class="Field">deposits</a><a id="11284" class="Symbol">))</a>

  <a id="11290" href="Ledger.Utxo.html#11290" class="Function">newDeposits</a> <a id="11302" class="Symbol">:</a> <a id="11304" href="Ledger.PParams.html#2073" class="Record">PParams</a> <a id="11312" class="Symbol">→</a> <a id="11314" href="Ledger.Utxo.html#5208" class="Record">UTxOState</a> <a id="11324" class="Symbol">→</a> <a id="11326" href="Ledger.Transaction.html#4126" class="Record">TxBody</a> <a id="11333" class="Symbol">→</a> <a id="11335" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a>
  <a id="11342" href="Ledger.Utxo.html#11290" class="Function">newDeposits</a> <a id="11354" href="Ledger.Utxo.html#11354" class="Bound">pp</a> <a id="11357" href="Ledger.Utxo.html#11357" class="Bound">st</a> <a id="11360" href="Ledger.Utxo.html#11360" class="Bound">txb</a> <a id="11364" class="Symbol">=</a> <a id="11366" href="Data.Integer.Ext.html#349" class="Function">posPart</a> <a id="11374" class="Symbol">(</a><a id="11375" href="Ledger.Utxo.html#8057" class="Function">depositsChange</a> <a id="11390" href="Ledger.Utxo.html#11354" class="Bound">pp</a> <a id="11393" href="Ledger.Utxo.html#11360" class="Bound">txb</a> <a id="11397" class="Symbol">(</a><a id="11398" href="Ledger.Utxo.html#11357" class="Bound">st</a> <a id="11401" class="Symbol">.</a><a id="11402" href="Ledger.Utxo.html#5366" class="Field">deposits</a><a id="11410" class="Symbol">))</a>

  <a id="11416" href="Ledger.Utxo.html#11416" class="Function">consumed</a> <a id="11425" class="Symbol">:</a> <a id="11427" href="Ledger.PParams.html#2073" class="Record">PParams</a> <a id="11435" class="Symbol">→</a> <a id="11437" href="Ledger.Utxo.html#5208" class="Record">UTxOState</a> <a id="11447" class="Symbol">→</a> <a id="11449" href="Ledger.Transaction.html#4126" class="Record">TxBody</a> <a id="11456" class="Symbol">→</a> <a id="11458" href="Ledger.TokenAlgebra.html#816" class="Function">Value</a>
  <a id="11466" href="Ledger.Utxo.html#11416" class="Function">consumed</a> <a id="11475" href="Ledger.Utxo.html#11475" class="Bound">pp</a> <a id="11478" href="Ledger.Utxo.html#11478" class="Bound">st</a> <a id="11481" href="Ledger.Utxo.html#11481" class="Bound">txb</a>
    <a id="11489" class="Symbol">=</a>  <a id="11492" href="Ledger.Utxo.html#5940" class="Function">balance</a> <a id="11500" class="Symbol">(</a><a id="11501" href="Ledger.Utxo.html#11478" class="Bound">st</a> <a id="11504" class="Symbol">.</a><a id="11505" href="Ledger.Utxo.html#5322" class="Field">utxo</a> <a id="11510" href="Axiom.Set.Map.html#10107" class="Function Operator">∣</a> <a id="11512" href="Ledger.Utxo.html#11481" class="Bound">txb</a> <a id="11516" class="Symbol">.</a><a id="11517" href="Ledger.Transaction.html#4216" class="Field">txins</a><a id="11522" class="Symbol">)</a>
    <a id="11528" href="Interface.HasAdd.html#135" class="Field Operator">+</a>  <a id="11531" href="Ledger.Utxo.html#11481" class="Bound">txb</a> <a id="11535" class="Symbol">.</a><a id="11536" href="Ledger.Transaction.html#4338" class="Field">mint</a>
    <a id="11545" href="Interface.HasAdd.html#135" class="Field Operator">+</a>  <a id="11548" href="Ledger.TokenAlgebra.html#1278" class="Function">inject</a> <a id="11555" class="Symbol">(</a><a id="11556" href="Ledger.Utxo.html#11158" class="Function">depositRefunds</a> <a id="11571" href="Ledger.Utxo.html#11475" class="Bound">pp</a> <a id="11574" href="Ledger.Utxo.html#11478" class="Bound">st</a> <a id="11577" href="Ledger.Utxo.html#11481" class="Bound">txb</a><a id="11580" class="Symbol">)</a>

  <a id="11585" href="Ledger.Utxo.html#11585" class="Function">produced</a> <a id="11594" class="Symbol">:</a> <a id="11596" href="Ledger.PParams.html#2073" class="Record">PParams</a> <a id="11604" class="Symbol">→</a> <a id="11606" href="Ledger.Utxo.html#5208" class="Record">UTxOState</a> <a id="11616" class="Symbol">→</a> <a id="11618" href="Ledger.Transaction.html#4126" class="Record">TxBody</a> <a id="11625" class="Symbol">→</a> <a id="11627" href="Ledger.TokenAlgebra.html#816" class="Function">Value</a>
  <a id="11635" href="Ledger.Utxo.html#11585" class="Function">produced</a> <a id="11644" href="Ledger.Utxo.html#11644" class="Bound">pp</a> <a id="11647" href="Ledger.Utxo.html#11647" class="Bound">st</a> <a id="11650" href="Ledger.Utxo.html#11650" class="Bound">txb</a>
    <a id="11658" class="Symbol">=</a>  <a id="11661" href="Ledger.Utxo.html#5940" class="Function">balance</a> <a id="11669" class="Symbol">(</a><a id="11670" href="Ledger.Utxo.html#5869" class="Function">outs</a> <a id="11675" href="Ledger.Utxo.html#11650" class="Bound">txb</a><a id="11678" class="Symbol">)</a>
    <a id="11684" href="Interface.HasAdd.html#135" class="Field Operator">+</a>  <a id="11687" href="Ledger.TokenAlgebra.html#1278" class="Function">inject</a> <a id="11694" class="Symbol">(</a><a id="11695" href="Ledger.Utxo.html#11650" class="Bound">txb</a> <a id="11699" class="Symbol">.</a><a id="11700" href="Ledger.Transaction.html#4310" class="Field">txfee</a><a id="11705" class="Symbol">)</a>
    <a id="11711" href="Interface.HasAdd.html#135" class="Field Operator">+</a>  <a id="11714" href="Ledger.TokenAlgebra.html#1278" class="Function">inject</a> <a id="11721" class="Symbol">(</a><a id="11722" href="Ledger.Utxo.html#11290" class="Function">newDeposits</a> <a id="11734" href="Ledger.Utxo.html#11644" class="Bound">pp</a> <a id="11737" href="Ledger.Utxo.html#11647" class="Bound">st</a> <a id="11740" href="Ledger.Utxo.html#11650" class="Bound">txb</a><a id="11743" class="Symbol">)</a>
    <a id="11749" href="Interface.HasAdd.html#135" class="Field Operator">+</a>  <a id="11752" href="Ledger.TokenAlgebra.html#1278" class="Function">inject</a> <a id="11759" class="Symbol">(</a><a id="11760" href="Ledger.Utxo.html#11650" class="Bound">txb</a> <a id="11764" class="Symbol">.</a><a id="11765" href="Ledger.Transaction.html#4552" class="Field">txdonation</a><a id="11775" class="Symbol">)</a>
<a id="11777" class="Markup">\end{code}</a><a id="11787" class="Background">
\caption{Functions used in UTxO rules, continued}
\label{fig:functions:utxo-conway}
\end{figure*}

As seen in Figures~\ref{fig:functions:utxo} and~\ref{fig:functions:utxo-conway},
we redefine \depositRefunds and \newDeposits via \depositsChange,
which computes the difference between the total deposits before and
after their application. This simplifies their definitions and some
correctness proofs. We then add the absolute value of \depositsChange
to \consumed or \produced depending on its sign. This is done via
\negPart and \posPart, which satisfy the key property that their
difference is the identity function.

</a><a id="12409" class="Markup">\begin{code}[hide]</a>
<a id="12428" class="Keyword">open</a> <a id="12433" href="Ledger.PParams.html#2073" class="Module">PParams</a>
<a id="12441" class="Keyword">data</a>
  <a id="_⊢_⇀⦇_,UTXOS⦈_"></a><a id="12448" href="Ledger.Utxo.html#12448" class="Datatype Operator">_⊢_⇀⦇_,UTXOS⦈_</a> <a id="12463" class="Symbol">:</a> <a id="12465" href="Ledger.Utxo.html#4994" class="Record">UTxOEnv</a> <a id="12473" class="Symbol">→</a> <a id="12475" href="Ledger.Utxo.html#5208" class="Record">UTxOState</a> <a id="12485" class="Symbol">→</a> <a id="12487" href="Ledger.Transaction.html#5227" class="Record">Tx</a> <a id="12490" class="Symbol">→</a> <a id="12492" href="Ledger.Utxo.html#5208" class="Record">UTxOState</a> <a id="12502" class="Symbol">→</a> <a id="12504" href="Agda.Primitive.html#388" class="Primitive">Type</a>

<a id="12510" class="Keyword">data</a> <a id="12515" href="Ledger.Utxo.html#12448" class="Datatype Operator">_⊢_⇀⦇_,UTXOS⦈_</a> <a id="12530" class="Keyword">where</a>
  <a id="_⊢_⇀⦇_,UTXOS⦈_.Scripts-Yes"></a><a id="12538" href="Ledger.Utxo.html#12538" class="InductiveConstructor">Scripts-Yes</a> <a id="12550" class="Symbol">:</a>
    <a id="12556" class="Symbol">∀</a> <a id="12558" class="Symbol">{</a><a id="12559" href="Ledger.Utxo.html#12559" class="Bound">Γ</a><a id="12560" class="Symbol">}</a> <a id="12562" class="Symbol">{</a><a id="12563" href="Ledger.Utxo.html#12563" class="Bound">s</a><a id="12564" class="Symbol">}</a> <a id="12566" class="Symbol">{</a><a id="12567" href="Ledger.Utxo.html#12567" class="Bound">tx</a><a id="12569" class="Symbol">}</a>
    <a id="12575" class="Symbol">→</a> <a id="12577" class="Keyword">let</a> <a id="12581" class="Keyword">open</a> <a id="12586" href="Ledger.Transaction.html#5227" class="Module">Tx</a> <a id="12589" href="Ledger.Utxo.html#12567" class="Bound">tx</a> <a id="12592" class="Keyword">renaming</a> <a id="12601" class="Symbol">(</a><a id="12602" href="Ledger.Transaction.html#5313" class="Field">body</a> <a id="12607" class="Symbol">to</a> <a id="12610" class="Field">txb</a><a id="12613" class="Symbol">);</a> <a id="12616" class="Keyword">open</a> <a id="12621" href="Ledger.Transaction.html#4126" class="Module">TxBody</a> <a id="12628" href="Ledger.Utxo.html#12610" class="Field">txb</a>
          <a id="12642" class="Keyword">open</a> <a id="12647" href="Ledger.Utxo.html#4994" class="Module">UTxOEnv</a> <a id="12655" href="Ledger.Utxo.html#12559" class="Bound">Γ</a> <a id="12657" class="Keyword">renaming</a> <a id="12666" class="Symbol">(</a><a id="12667" href="Ledger.Utxo.html#5102" class="Field">pparams</a> <a id="12675" class="Symbol">to</a> <a id="12678" class="Field">pp</a><a id="12680" class="Symbol">)</a>
          <a id="12692" class="Keyword">open</a> <a id="12697" href="Ledger.Utxo.html#5208" class="Module">UTxOState</a> <a id="12707" href="Ledger.Utxo.html#12563" class="Bound">s</a>
          <a id="12719" href="Ledger.Utxo.html#12719" class="Bound">sLst</a> <a id="12724" class="Symbol">=</a> <a id="12726" href="Ledger.ScriptValidation.html#5563" class="Function">collectPhaseTwoScriptInputs</a> <a id="12754" href="Ledger.Utxo.html#12678" class="Function">pp</a> <a id="12757" href="Ledger.Utxo.html#12567" class="Bound">tx</a> <a id="12760" href="Ledger.Utxo.html#5322" class="Function">utxo</a>
      <a id="12771" class="Keyword">in</a>
        <a id="12782" href="Interface.STS.html#105" class="Function Operator">∙</a> <a id="12784" href="Ledger.ScriptValidation.html#5951" class="Function">evalScripts</a> <a id="12796" href="Ledger.Utxo.html#12567" class="Bound">tx</a> <a id="12799" href="Ledger.Utxo.html#12719" class="Bound">sLst</a> <a id="12804" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="12806" href="Ledger.Transaction.html#5366" class="Field">isValid</a>
        <a id="12822" href="Interface.STS.html#131" class="Function Operator">∙</a> <a id="12824" href="Ledger.Transaction.html#5366" class="Field">isValid</a> <a id="12832" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="12834" href="Agda.Builtin.Bool.html#198" class="InductiveConstructor">true</a>
          <a id="12849" href="Interface.STS.html#350" class="Function Operator">────────────────────────────────</a>
          <a id="12892" href="Ledger.Utxo.html#12559" class="Bound">Γ</a> <a id="12894" href="Ledger.Utxo.html#12448" class="Datatype Operator">⊢</a> <a id="12896" href="Ledger.Utxo.html#12563" class="Bound">s</a> <a id="12898" href="Ledger.Utxo.html#12448" class="Datatype Operator">⇀⦇</a> <a id="12901" href="Ledger.Utxo.html#12567" class="Bound">tx</a> <a id="12904" href="Ledger.Utxo.html#12448" class="Datatype Operator">,UTXOS⦈</a>  <a id="12913" href="Ledger.Utxo.html#5275" class="InductiveConstructor Operator">⟦</a> <a id="12915" class="Symbol">(</a><a id="12916" href="Ledger.Utxo.html#5322" class="Function">utxo</a> <a id="12921" href="Axiom.Set.Map.html#10177" class="Function Operator">∣</a> <a id="12923" href="Ledger.Transaction.html#4216" class="Function">txins</a> <a id="12929" href="Axiom.Set.Map.html#10177" class="Function Operator">ᶜ</a><a id="12930" class="Symbol">)</a> <a id="12932" href="Axiom.Set.Map.html#6390" class="Function Operator">∪ˡ</a> <a id="12935" class="Symbol">(</a><a id="12936" href="Ledger.Utxo.html#5869" class="Function">outs</a> <a id="12941" href="Ledger.Utxo.html#12610" class="Field">txb</a><a id="12944" class="Symbol">)</a>
                              <a id="12976" href="Ledger.Utxo.html#5275" class="InductiveConstructor Operator">,</a> <a id="12978" href="Ledger.Utxo.html#5344" class="Function">fees</a> <a id="12983" href="Interface.HasAdd.html#135" class="Field Operator">+</a> <a id="12985" href="Ledger.Transaction.html#4310" class="Function">txfee</a>
                              <a id="13021" href="Ledger.Utxo.html#5275" class="InductiveConstructor Operator">,</a> <a id="13023" href="Ledger.Utxo.html#7587" class="Function">updateDeposits</a> <a id="13038" href="Ledger.Utxo.html#12678" class="Function">pp</a> <a id="13041" href="Ledger.Utxo.html#12610" class="Field">txb</a> <a id="13045" href="Ledger.Utxo.html#5366" class="Function">deposits</a>
                              <a id="13084" href="Ledger.Utxo.html#5275" class="InductiveConstructor Operator">,</a> <a id="13086" href="Ledger.Utxo.html#5392" class="Function">donations</a> <a id="13096" href="Interface.HasAdd.html#135" class="Field Operator">+</a> <a id="13098" href="Ledger.Transaction.html#4552" class="Function">txdonation</a>
                              <a id="13139" href="Ledger.Utxo.html#5275" class="InductiveConstructor Operator">⟧ᵘ</a>

  <a id="_⊢_⇀⦇_,UTXOS⦈_.Scripts-No"></a><a id="13145" href="Ledger.Utxo.html#13145" class="InductiveConstructor">Scripts-No</a> <a id="13156" class="Symbol">:</a>
    <a id="13162" class="Symbol">∀</a> <a id="13164" class="Symbol">{</a><a id="13165" href="Ledger.Utxo.html#13165" class="Bound">Γ</a><a id="13166" class="Symbol">}</a> <a id="13168" class="Symbol">{</a><a id="13169" href="Ledger.Utxo.html#13169" class="Bound">s</a><a id="13170" class="Symbol">}</a> <a id="13172" class="Symbol">{</a><a id="13173" href="Ledger.Utxo.html#13173" class="Bound">tx</a><a id="13175" class="Symbol">}</a>
    <a id="13181" class="Symbol">→</a> <a id="13183" class="Keyword">let</a> <a id="13187" class="Keyword">open</a> <a id="13192" href="Ledger.Transaction.html#5227" class="Module">Tx</a> <a id="13195" href="Ledger.Utxo.html#13173" class="Bound">tx</a> <a id="13198" class="Keyword">renaming</a> <a id="13207" class="Symbol">(</a><a id="13208" href="Ledger.Transaction.html#5313" class="Field">body</a> <a id="13213" class="Symbol">to</a> <a id="13216" class="Field">txb</a><a id="13219" class="Symbol">);</a> <a id="13222" class="Keyword">open</a> <a id="13227" href="Ledger.Transaction.html#4126" class="Module">TxBody</a> <a id="13234" href="Ledger.Utxo.html#13216" class="Field">txb</a>
          <a id="13248" class="Keyword">open</a> <a id="13253" href="Ledger.Utxo.html#4994" class="Module">UTxOEnv</a> <a id="13261" href="Ledger.Utxo.html#13165" class="Bound">Γ</a> <a id="13263" class="Keyword">renaming</a> <a id="13272" class="Symbol">(</a><a id="13273" href="Ledger.Utxo.html#5102" class="Field">pparams</a> <a id="13281" class="Symbol">to</a> <a id="13284" class="Field">pp</a><a id="13286" class="Symbol">)</a>
          <a id="13298" class="Keyword">open</a> <a id="13303" href="Ledger.Utxo.html#5208" class="Module">UTxOState</a> <a id="13313" href="Ledger.Utxo.html#13169" class="Bound">s</a>
          <a id="13325" href="Ledger.Utxo.html#13325" class="Bound">sLst</a> <a id="13330" class="Symbol">=</a> <a id="13332" href="Ledger.ScriptValidation.html#5563" class="Function">collectPhaseTwoScriptInputs</a> <a id="13360" href="Ledger.Utxo.html#13284" class="Function">pp</a> <a id="13363" href="Ledger.Utxo.html#13173" class="Bound">tx</a> <a id="13366" href="Ledger.Utxo.html#5322" class="Function">utxo</a>
      <a id="13377" class="Keyword">in</a>
        <a id="13388" href="Interface.STS.html#105" class="Function Operator">∙</a> <a id="13390" href="Ledger.ScriptValidation.html#5951" class="Function">evalScripts</a> <a id="13402" href="Ledger.Utxo.html#13173" class="Bound">tx</a> <a id="13405" href="Ledger.Utxo.html#13325" class="Bound">sLst</a> <a id="13410" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="13412" href="Ledger.Transaction.html#5366" class="Field">isValid</a>
        <a id="13428" href="Interface.STS.html#131" class="Function Operator">∙</a> <a id="13430" href="Ledger.Transaction.html#5366" class="Field">isValid</a> <a id="13438" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="13440" href="Agda.Builtin.Bool.html#192" class="InductiveConstructor">false</a>
          <a id="13456" href="Interface.STS.html#350" class="Function Operator">────────────────────────────────</a>
          <a id="13499" href="Ledger.Utxo.html#13165" class="Bound">Γ</a> <a id="13501" href="Ledger.Utxo.html#12448" class="Datatype Operator">⊢</a> <a id="13503" href="Ledger.Utxo.html#13169" class="Bound">s</a> <a id="13505" href="Ledger.Utxo.html#12448" class="Datatype Operator">⇀⦇</a> <a id="13508" href="Ledger.Utxo.html#13173" class="Bound">tx</a> <a id="13511" href="Ledger.Utxo.html#12448" class="Datatype Operator">,UTXOS⦈</a>  <a id="13520" href="Ledger.Utxo.html#5275" class="InductiveConstructor Operator">⟦</a> <a id="13522" href="Ledger.Utxo.html#5322" class="Function">utxo</a> <a id="13527" href="Axiom.Set.Map.html#10177" class="Function Operator">∣</a> <a id="13529" href="Ledger.Transaction.html#4776" class="Function">collateral</a> <a id="13540" href="Axiom.Set.Map.html#10177" class="Function Operator">ᶜ</a>
                              <a id="13572" href="Ledger.Utxo.html#5275" class="InductiveConstructor Operator">,</a> <a id="13574" href="Ledger.Utxo.html#5344" class="Function">fees</a> <a id="13579" href="Interface.HasAdd.html#135" class="Field Operator">+</a> <a id="13581" href="Ledger.Utxo.html#6029" class="Function">cbalance</a> <a id="13590" class="Symbol">(</a><a id="13591" href="Ledger.Utxo.html#5322" class="Function">utxo</a> <a id="13596" href="Axiom.Set.Map.html#10107" class="Function Operator">∣</a> <a id="13598" href="Ledger.Transaction.html#4776" class="Function">collateral</a><a id="13608" class="Symbol">)</a>
                              <a id="13640" href="Ledger.Utxo.html#5275" class="InductiveConstructor Operator">,</a> <a id="13642" href="Ledger.Utxo.html#5366" class="Function">deposits</a>
                              <a id="13681" href="Ledger.Utxo.html#5275" class="InductiveConstructor Operator">,</a> <a id="13683" href="Ledger.Utxo.html#5392" class="Function">donations</a>
                              <a id="13723" href="Ledger.Utxo.html#5275" class="InductiveConstructor Operator">⟧ᵘ</a>

<a id="13727" class="Keyword">unquoteDecl</a> <a id="Scripts-Yes-premises"></a><a id="13739" href="Ledger.Utxo.html#13739" class="Function">Scripts-Yes-premises</a> <a id="13760" class="Symbol">=</a> <a id="13762" href="Tactic.Premises.html#1543" class="Function">genPremises</a> <a id="13774" href="Ledger.Utxo.html#13739" class="Function">Scripts-Yes-premises</a> <a id="13795" class="Symbol">(</a><a id="13796" class="Keyword">quote</a> <a id="13802" href="Ledger.Utxo.html#12538" class="InductiveConstructor">Scripts-Yes</a><a id="13813" class="Symbol">)</a>
<a id="13815" class="Keyword">unquoteDecl</a> <a id="Scripts-No-premises"></a><a id="13827" href="Ledger.Utxo.html#13827" class="Function">Scripts-No-premises</a>  <a id="13848" class="Symbol">=</a> <a id="13850" href="Tactic.Premises.html#1543" class="Function">genPremises</a> <a id="13862" href="Ledger.Utxo.html#13827" class="Function">Scripts-No-premises</a>  <a id="13883" class="Symbol">(</a><a id="13884" class="Keyword">quote</a> <a id="13890" href="Ledger.Utxo.html#13145" class="InductiveConstructor">Scripts-No</a><a id="13900" class="Symbol">)</a>

<a id="13903" class="Keyword">private</a> <a id="13911" class="Keyword">variable</a>
  <a id="13922" href="Ledger.Utxo.html#13922" class="Generalizable">Γ</a> <a id="13924" class="Symbol">:</a> <a id="13926" href="Ledger.Utxo.html#4994" class="Record">UTxOEnv</a>
  <a id="13936" href="Ledger.Utxo.html#13936" class="Generalizable">s</a> <a id="13938" href="Ledger.Utxo.html#13938" class="Generalizable">s&#39;</a> <a id="13941" class="Symbol">:</a> <a id="13943" href="Ledger.Utxo.html#5208" class="Record">UTxOState</a>
  <a id="13955" href="Ledger.Utxo.html#13955" class="Generalizable">tx</a> <a id="13958" class="Symbol">:</a> <a id="13960" href="Ledger.Transaction.html#5227" class="Record">Tx</a>

<a id="13964" class="Keyword">data</a> <a id="_≡?_"></a><a id="13969" href="Ledger.Utxo.html#13969" class="Datatype Operator">_≡?_</a> <a id="13974" class="Symbol">{</a><a id="13975" href="Ledger.Utxo.html#13975" class="Bound">A</a> <a id="13977" class="Symbol">:</a> <a id="13979" href="Agda.Primitive.html#388" class="Primitive">Type</a><a id="13983" class="Symbol">}</a> <a id="13985" class="Symbol">:</a> <a id="13987" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="13993" href="Ledger.Utxo.html#13975" class="Bound">A</a> <a id="13995" class="Symbol">→</a> <a id="13997" href="Ledger.Utxo.html#13975" class="Bound">A</a> <a id="13999" class="Symbol">→</a> <a id="14001" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="14006" class="Keyword">where</a>
  <a id="_≡?_.≡?-nothing"></a><a id="14014" href="Ledger.Utxo.html#14014" class="InductiveConstructor">≡?-nothing</a> <a id="14025" class="Symbol">:</a> <a id="14027" class="Symbol">∀</a> <a id="14029" class="Symbol">{</a><a id="14030" href="Ledger.Utxo.html#14030" class="Bound">x</a> <a id="14032" class="Symbol">:</a> <a id="14034" href="Ledger.Utxo.html#13975" class="Bound">A</a><a id="14035" class="Symbol">}</a> <a id="14037" class="Symbol">→</a> <a id="14039" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a>  <a id="14048" href="Ledger.Utxo.html#13969" class="Datatype Operator">≡?</a> <a id="14051" href="Ledger.Utxo.html#14030" class="Bound">x</a>
  <a id="_≡?_.≡?-just"></a><a id="14055" href="Ledger.Utxo.html#14055" class="InductiveConstructor">≡?-just</a>    <a id="14066" class="Symbol">:</a> <a id="14068" class="Symbol">∀</a> <a id="14070" class="Symbol">{</a><a id="14071" href="Ledger.Utxo.html#14071" class="Bound">x</a> <a id="14073" class="Symbol">:</a> <a id="14075" href="Ledger.Utxo.html#13975" class="Bound">A</a><a id="14076" class="Symbol">}</a> <a id="14078" class="Symbol">→</a> <a id="14080" class="Symbol">(</a><a id="14081" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="14086" href="Ledger.Utxo.html#14071" class="Bound">x</a><a id="14087" class="Symbol">)</a> <a id="14089" href="Ledger.Utxo.html#13969" class="Datatype Operator">≡?</a> <a id="14092" href="Ledger.Utxo.html#14071" class="Bound">x</a>

<a id="14095" class="Keyword">instance</a>
  <a id="≟?"></a><a id="14106" href="Ledger.Utxo.html#14106" class="Function">≟?</a> <a id="14109" class="Symbol">:</a> <a id="14111" class="Symbol">{</a><a id="14112" href="Ledger.Utxo.html#14112" class="Bound">A</a> <a id="14114" class="Symbol">:</a> <a id="14116" href="Agda.Primitive.html#388" class="Primitive">Type</a><a id="14120" class="Symbol">}</a> <a id="14122" class="Symbol">{</a><a id="14123" href="Ledger.Utxo.html#14123" class="Bound">x</a> <a id="14125" class="Symbol">:</a> <a id="14127" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="14133" href="Ledger.Utxo.html#14112" class="Bound">A</a><a id="14134" class="Symbol">}</a> <a id="14136" class="Symbol">{</a><a id="14137" href="Ledger.Utxo.html#14137" class="Bound">y</a> <a id="14139" class="Symbol">:</a> <a id="14141" href="Ledger.Utxo.html#14112" class="Bound">A</a><a id="14142" class="Symbol">}</a> <a id="14144" class="Symbol">→</a> <a id="14146" class="Symbol">⦃</a> <a id="14148" href="Class.DecEq.Core.html#117" class="Record">DecEq</a> <a id="14154" href="Ledger.Utxo.html#14112" class="Bound">A</a> <a id="14156" class="Symbol">⦄</a> <a id="14158" class="Symbol">→</a> <a id="14160" class="Symbol">(</a><a id="14161" href="Ledger.Utxo.html#14123" class="Bound">x</a> <a id="14163" href="Ledger.Utxo.html#13969" class="Datatype Operator">≡?</a> <a id="14166" href="Ledger.Utxo.html#14137" class="Bound">y</a><a id="14167" class="Symbol">)</a> <a id="14169" href="Class.Decidable.Core.html#208" class="Record Operator">⁇</a>
  <a id="14173" href="Ledger.Utxo.html#14106" class="Function">≟?</a> <a id="14176" class="Symbol">{</a><a id="14177" class="Argument">x</a> <a id="14179" class="Symbol">=</a> <a id="14181" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="14186" href="Ledger.Utxo.html#14186" class="Bound">x</a><a id="14187" class="Symbol">}</a> <a id="14189" class="Symbol">{</a><a id="14190" href="Ledger.Utxo.html#14190" class="Bound">y</a><a id="14191" class="Symbol">}</a> <a id="14193" class="Keyword">with</a> <a id="14198" href="Ledger.Utxo.html#14186" class="Bound">x</a> <a id="14200" href="Class.DecEq.Core.html#159" class="Field Operator">≟</a> <a id="14202" href="Ledger.Utxo.html#14190" class="Bound">y</a>
  <a id="14206" class="Symbol">...</a> <a id="14210" class="Symbol">|</a> <a id="14212" href="Relation.Nullary.Decidable.Core.html#1618" class="InductiveConstructor">yes</a> <a id="14216" href="Agda.Builtin.Equality.html#207" class="InductiveConstructor">refl</a> <a id="14221" class="Symbol">=</a> <a id="14223" href="Class.Decidable.Core.html#253" class="InductiveConstructor Operator">⁇</a> <a id="14225" href="Relation.Nullary.Decidable.Core.html#1618" class="InductiveConstructor">yes</a> <a id="14229" href="Ledger.Utxo.html#14055" class="InductiveConstructor">≡?-just</a>
  <a id="14239" class="Symbol">...</a> <a id="14243" class="Symbol">|</a> <a id="14245" href="Relation.Nullary.Decidable.Core.html#1655" class="InductiveConstructor">no</a> <a id="14248" href="Ledger.Utxo.html#14248" class="Bound">¬p</a>    <a id="14254" class="Symbol">=</a> <a id="14256" href="Class.Decidable.Core.html#253" class="InductiveConstructor Operator">⁇</a> <a id="14258" href="Relation.Nullary.Decidable.Core.html#1655" class="InductiveConstructor">no</a> <a id="14261" class="Symbol">λ</a> <a id="14263" class="Keyword">where</a> <a id="14269" href="Ledger.Utxo.html#14055" class="InductiveConstructor">≡?-just</a> <a id="14277" class="Symbol">→</a> <a id="14279" href="Ledger.Utxo.html#14248" class="Bound">¬p</a> <a id="14282" href="Agda.Builtin.Equality.html#207" class="InductiveConstructor">refl</a>
  <a id="14289" href="Ledger.Utxo.html#14106" class="Function">≟?</a> <a id="14292" class="Symbol">{</a><a id="14293" class="Argument">x</a> <a id="14295" class="Symbol">=</a> <a id="14297" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a><a id="14304" class="Symbol">}</a> <a id="14306" class="Symbol">=</a> <a id="14308" href="Class.Decidable.Core.html#253" class="InductiveConstructor Operator">⁇</a> <a id="14310" href="Relation.Nullary.Decidable.Core.html#1618" class="InductiveConstructor">yes</a> <a id="14314" href="Ledger.Utxo.html#14014" class="InductiveConstructor">≡?-nothing</a>

<a id="14326" class="Keyword">data</a> <a id="14331" href="Ledger.Utxo.html#5513" class="Datatype Operator">_⊢_⇀⦇_,UTXO⦈_</a> <a id="14345" class="Keyword">where</a>
<a id="14351" class="Markup">\end{code}</a><a id="14361" class="Background">

\begin{NoConway}
We write \maybeEq to mean that two potentially optional values are
equal if they are both present.

\begin{figure*}[h]
</a><a id="14499" class="Markup">\begin{code}</a>
  <a id="_⊢_⇀⦇_,UTXO⦈_.UTXO-inductive"></a><a id="14514" href="Ledger.Utxo.html#14514" class="InductiveConstructor">UTXO-inductive</a> <a id="14529" class="Symbol">:</a>
    <a id="14535" class="Keyword">let</a> <a id="14539" class="Keyword">open</a> <a id="14544" href="Ledger.Transaction.html#5227" class="Module">Tx</a> <a id="14547" href="Ledger.Utxo.html#13955" class="Generalizable">tx</a> <a id="14550" class="Keyword">renaming</a> <a id="14559" class="Symbol">(</a><a id="14560" href="Ledger.Transaction.html#5313" class="Field">body</a> <a id="14565" class="Symbol">to</a> <a id="14568" class="Field">txb</a><a id="14571" class="Symbol">);</a> <a id="14574" class="Keyword">open</a> <a id="14579" href="Ledger.Transaction.html#4126" class="Module">TxBody</a> <a id="14586" href="Ledger.Utxo.html#14568" class="Function">txb</a>
        <a id="14598" class="Keyword">open</a> <a id="14603" href="Ledger.Utxo.html#4994" class="Module">UTxOEnv</a> <a id="14611" href="Ledger.Utxo.html#13922" class="Generalizable">Γ</a> <a id="14613" class="Keyword">renaming</a> <a id="14622" class="Symbol">(</a><a id="14623" href="Ledger.Utxo.html#5102" class="Field">pparams</a> <a id="14631" class="Symbol">to</a> <a id="14634" class="Field">pp</a><a id="14636" class="Symbol">)</a>
        <a id="14646" class="Keyword">open</a> <a id="14651" href="Ledger.Utxo.html#5208" class="Module">UTxOState</a> <a id="14661" href="Ledger.Utxo.html#13936" class="Generalizable">s</a>
        <a id="14671" href="Ledger.Utxo.html#14671" class="Bound">txoutsʰ</a> <a id="14679" class="Symbol">=</a> <a id="14681" class="Symbol">(</a><a id="14682" href="Axiom.Set.Map.html#6138" class="Function">mapValues</a> <a id="14692" href="Ledger.Transaction.html#5750" class="Function">txOutHash</a> <a id="14702" href="Ledger.Transaction.html#4276" class="Function">txouts</a><a id="14708" class="Symbol">)</a>
    <a id="14714" class="Keyword">in</a>
    <a id="14721" href="Interface.STS.html#105" class="Function Operator">∙</a> <a id="14723" href="Ledger.Transaction.html#4216" class="Function">txins</a> <a id="14729" href="Relation.Binary.PropositionalEquality.Core.html#858" class="Function Operator">≢</a> <a id="14731" href="Interface.HasEmptySet.html#150" class="Field">∅</a>                              <a id="14762" href="Interface.STS.html#131" class="Function Operator">∙</a> <a id="14764" href="Ledger.Transaction.html#4216" class="Function">txins</a> <a id="14770" href="Axiom.Set.html#8665" class="Function Operator">∪</a> <a id="14772" href="Ledger.Transaction.html#4246" class="Function">refInputs</a> <a id="14782" href="Axiom.Set.html#1639" class="Function Operator">⊆</a> <a id="14784" href="Interface.IsSet.html#934" class="Function">dom</a> <a id="14788" href="Ledger.Utxo.html#5322" class="Function">utxo</a>
    <a id="14797" href="Interface.STS.html#131" class="Function Operator">∙</a> <a id="14799" href="Ledger.Transaction.html#4216" class="Function">txins</a> <a id="14805" href="Axiom.Set.html#9005" class="Function Operator">∩</a> <a id="14807" href="Ledger.Transaction.html#4246" class="Function">refInputs</a> <a id="14817" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="14819" href="Interface.HasEmptySet.html#150" class="Field">∅</a>                  <a id="14838" href="Interface.STS.html#131" class="Function Operator">∙</a> <a id="14840" href="Ledger.Utxo.html#8386" class="Datatype">inInterval</a> <a id="14851" href="Ledger.Utxo.html#5081" class="Function">slot</a> <a id="14856" href="Ledger.Transaction.html#4367" class="Function">txvldt</a>
    <a id="14867" href="Interface.STS.html#131" class="Function Operator">∙</a> <a id="14869" href="Ledger.Utxo.html#10306" class="Function">feesOK</a> <a id="14876" href="Ledger.Utxo.html#14634" class="Function">pp</a> <a id="14879" href="Ledger.Utxo.html#13955" class="Generalizable">tx</a> <a id="14882" href="Ledger.Utxo.html#5322" class="Function">utxo</a> <a id="14887" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="14889" href="Agda.Builtin.Bool.html#198" class="InductiveConstructor">true</a>               <a id="14908" href="Interface.STS.html#131" class="Function Operator">∙</a> <a id="14910" href="Ledger.Utxo.html#11416" class="Function">consumed</a> <a id="14919" href="Ledger.Utxo.html#14634" class="Function">pp</a> <a id="14922" href="Ledger.Utxo.html#13936" class="Generalizable">s</a> <a id="14924" href="Ledger.Utxo.html#14568" class="Function">txb</a> <a id="14928" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="14930" href="Ledger.Utxo.html#11585" class="Function">produced</a> <a id="14939" href="Ledger.Utxo.html#14634" class="Function">pp</a> <a id="14942" href="Ledger.Utxo.html#13936" class="Generalizable">s</a> <a id="14944" href="Ledger.Utxo.html#14568" class="Function">txb</a>
    <a id="14952" href="Interface.STS.html#131" class="Function Operator">∙</a> <a id="14954" href="Ledger.TokenAlgebra.html#1233" class="Function">coin</a> <a id="14959" href="Ledger.Transaction.html#4338" class="Function">mint</a> <a id="14964" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="14966" class="Number">0</a>                          <a id="14993" href="Interface.STS.html#131" class="Function Operator">∙</a> <a id="14995" href="Ledger.Transaction.html#4723" class="Function">txsize</a> <a id="15002" href="Interface.HasOrder.html#301" class="Field Operator">≤</a> <a id="15004" href="Ledger.PParams.html#2227" class="Field">maxTxSize</a> <a id="15014" href="Ledger.Utxo.html#14634" class="Function">pp</a>

    <a id="15022" href="Interface.STS.html#131" class="Function Operator">∙</a> <a id="15024" href="Interface.IsSet.html#594" class="Function">∀[</a> <a id="15027" href="Ledger.Utxo.html#15027" class="Bound">(_</a> <a id="15030" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="15032" href="Ledger.Utxo.html#15032" class="Bound">txout</a><a id="15037" href="Ledger.Utxo.html#15027" class="Bound">)</a> <a id="15039" href="Interface.IsSet.html#594" class="Function">∈</a> <a id="15041" href="Ledger.Utxo.html#14671" class="Bound">txoutsʰ</a> <a id="15049" class="Symbol">.</a><a id="15050" href="Data.Product.Base.html#636" class="Field">proj₁</a> <a id="15056" href="Interface.IsSet.html#594" class="Function">]</a>
        <a id="15066" href="Ledger.TokenAlgebra.html#1278" class="Function">inject</a> <a id="15073" class="Symbol">(</a><a id="15074" href="Ledger.Utxo.html#2066" class="Function">utxoEntrySize</a> <a id="15088" href="Ledger.Utxo.html#15032" class="Bound">txout</a> <a id="15094" href="Agda.Builtin.Nat.html#539" class="Primitive Operator">*</a> <a id="15096" href="Ledger.PParams.html#2978" class="Field">minUTxOValue</a> <a id="15109" href="Ledger.Utxo.html#14634" class="Function">pp</a><a id="15111" class="Symbol">)</a> <a id="15113" href="Ledger.TokenAlgebra.html#1429" class="Function Operator">≤ᵗ</a> <a id="15116" href="Ledger.Transaction.html#5839" class="Function">getValueʰ</a> <a id="15126" href="Ledger.Utxo.html#15032" class="Bound">txout</a>
    <a id="15136" href="Interface.STS.html#131" class="Function Operator">∙</a> <a id="15138" href="Interface.IsSet.html#594" class="Function">∀[</a> <a id="15141" href="Ledger.Utxo.html#15141" class="Bound">(_</a> <a id="15144" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="15146" href="Ledger.Utxo.html#15146" class="Bound">txout</a><a id="15151" href="Ledger.Utxo.html#15141" class="Bound">)</a> <a id="15153" href="Interface.IsSet.html#594" class="Function">∈</a> <a id="15155" href="Ledger.Utxo.html#14671" class="Bound">txoutsʰ</a> <a id="15163" class="Symbol">.</a><a id="15164" href="Data.Product.Base.html#636" class="Field">proj₁</a> <a id="15170" href="Interface.IsSet.html#594" class="Function">]</a>
        <a id="15180" href="Ledger.Abstract.html#626" class="Field">serSize</a> <a id="15188" class="Symbol">(</a><a id="15189" href="Ledger.Transaction.html#5839" class="Function">getValueʰ</a> <a id="15199" href="Ledger.Utxo.html#15146" class="Bound">txout</a><a id="15204" class="Symbol">)</a> <a id="15206" href="Interface.HasOrder.html#301" class="Field Operator">≤</a> <a id="15208" href="Ledger.PParams.html#2407" class="Field">maxValSize</a> <a id="15219" href="Ledger.Utxo.html#14634" class="Function">pp</a>
    <a id="15226" href="Interface.STS.html#131" class="Function Operator">∙</a> <a id="15228" href="Interface.IsSet.html#594" class="Function">∀[</a> <a id="15231" href="Ledger.Utxo.html#15231" class="Bound">(</a><a id="15232" href="Ledger.Utxo.html#15232" class="Bound">a</a> <a id="15234" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="15236" href="Ledger.Utxo.html#15231" class="Bound">_)</a> <a id="15239" href="Interface.IsSet.html#594" class="Function">∈</a> <a id="15241" href="Interface.IsSet.html#977" class="Function">range</a> <a id="15247" href="Ledger.Utxo.html#14671" class="Bound">txoutsʰ</a> <a id="15255" href="Interface.IsSet.html#594" class="Function">]</a>
        <a id="15265" href="Data.Sum.Relation.Unary.All.html#626" class="Datatype">Sum.All</a> <a id="15273" class="Symbol">(</a><a id="15274" href="Function.Base.html#725" class="Function">const</a> <a id="15280" href="Agda.Builtin.Unit.html#175" class="Record">⊤</a><a id="15281" class="Symbol">)</a> <a id="15283" class="Symbol">(λ</a> <a id="15286" href="Ledger.Utxo.html#15286" class="Bound">a</a> <a id="15288" class="Symbol">→</a> <a id="15290" href="Ledger.Utxo.html#15286" class="Bound">a</a> <a id="15292" class="Symbol">.</a><a id="15293" href="Ledger.Address.html#1560" class="Field">BootstrapAddr.attrsSize</a> <a id="15317" href="Interface.HasOrder.html#301" class="Field Operator">≤</a> <a id="15319" class="Number">64</a><a id="15321" class="Symbol">)</a> <a id="15323" href="Ledger.Utxo.html#15232" class="Bound">a</a>
    <a id="15329" href="Interface.STS.html#131" class="Function Operator">∙</a> <a id="15331" href="Interface.IsSet.html#594" class="Function">∀[</a> <a id="15334" href="Ledger.Utxo.html#15334" class="Bound">(</a><a id="15335" href="Ledger.Utxo.html#15335" class="Bound">a</a> <a id="15337" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="15339" href="Ledger.Utxo.html#15334" class="Bound">_)</a> <a id="15342" href="Interface.IsSet.html#594" class="Function">∈</a> <a id="15344" href="Interface.IsSet.html#977" class="Function">range</a> <a id="15350" href="Ledger.Utxo.html#14671" class="Bound">txoutsʰ</a> <a id="15358" href="Interface.IsSet.html#594" class="Function">]</a>  <a id="15361" href="Ledger.Address.html#2376" class="Function">netId</a> <a id="15367" href="Ledger.Utxo.html#15335" class="Bound">a</a>         <a id="15377" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="15379" href="Ledger.Transaction.html#3256" class="Field">networkId</a>
    <a id="15393" href="Interface.STS.html#131" class="Function Operator">∙</a> <a id="15395" href="Interface.IsSet.html#594" class="Function">∀[</a> <a id="15398" href="Ledger.Utxo.html#15398" class="Bound">a</a> <a id="15400" href="Interface.IsSet.html#594" class="Function">∈</a> <a id="15402" href="Interface.IsSet.html#934" class="Function">dom</a> <a id="15406" href="Ledger.Transaction.html#4448" class="Function">txwdrls</a> <a id="15414" href="Interface.IsSet.html#594" class="Function">]</a>          <a id="15425" href="Ledger.Utxo.html#15398" class="Bound">a</a> <a id="15427" class="Symbol">.</a><a id="15428" href="Ledger.Address.html#1612" class="Field">RwdAddr.net</a>  <a id="15441" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="15443" href="Ledger.Transaction.html#3256" class="Field">networkId</a>
    <a id="15457" href="Interface.STS.html#131" class="Function Operator">∙</a> <a id="15459" href="Ledger.Transaction.html#4652" class="Function">txNetworkId</a> <a id="15471" href="Ledger.Utxo.html#13969" class="Datatype Operator">≡?</a> <a id="15474" href="Ledger.Transaction.html#3256" class="Field">networkId</a>
    <a id="15488" href="Interface.STS.html#131" class="Function Operator">∙</a> <a id="15490" href="Ledger.Transaction.html#4689" class="Function">curTreasury</a> <a id="15502" href="Ledger.Utxo.html#13969" class="Datatype Operator">≡?</a> <a id="15505" href="Ledger.Utxo.html#5126" class="Function">treasury</a>
    <a id="15518" href="Interface.STS.html#131" class="Function Operator">∙</a> <a id="15520" href="Ledger.Utxo.html#13922" class="Generalizable">Γ</a> <a id="15522" href="Ledger.Utxo.html#12448" class="Datatype Operator">⊢</a> <a id="15524" href="Ledger.Utxo.html#13936" class="Generalizable">s</a> <a id="15526" href="Ledger.Utxo.html#12448" class="Datatype Operator">⇀⦇</a> <a id="15529" href="Ledger.Utxo.html#13955" class="Generalizable">tx</a> <a id="15532" href="Ledger.Utxo.html#12448" class="Datatype Operator">,UTXOS⦈</a> <a id="15540" href="Ledger.Utxo.html#13938" class="Generalizable">s&#39;</a>
      <a id="15549" href="Interface.STS.html#350" class="Function Operator">────────────────────────────────</a>
      <a id="15588" href="Ledger.Utxo.html#13922" class="Generalizable">Γ</a> <a id="15590" href="Ledger.Utxo.html#5513" class="Datatype Operator">⊢</a> <a id="15592" href="Ledger.Utxo.html#13936" class="Generalizable">s</a> <a id="15594" href="Ledger.Utxo.html#5513" class="Datatype Operator">⇀⦇</a> <a id="15597" href="Ledger.Utxo.html#13955" class="Generalizable">tx</a> <a id="15600" href="Ledger.Utxo.html#5513" class="Datatype Operator">,UTXO⦈</a> <a id="15607" href="Ledger.Utxo.html#13938" class="Generalizable">s&#39;</a>
<a id="15610" class="Markup">\end{code}</a><a id="15620" class="Background">
</a><a id="15621" class="Markup">\begin{code}[hide]</a>
<a id="15640" class="Keyword">pattern</a> <a id="UTXO-inductive⋯"></a><a id="15648" href="Ledger.Utxo.html#15648" class="InductiveConstructor">UTXO-inductive⋯</a> <a id="15664" href="Ledger.Utxo.html#15727" class="Bound">tx</a> <a id="15667" href="Ledger.Utxo.html#15731" class="Bound">Γ</a> <a id="15669" href="Ledger.Utxo.html#15734" class="Bound">s</a> <a id="15671" href="Ledger.Utxo.html#15738" class="Bound">x</a> <a id="15673" href="Ledger.Utxo.html#15742" class="Bound">y</a> <a id="15675" href="Ledger.Utxo.html#15746" class="Bound">z</a> <a id="15677" href="Ledger.Utxo.html#15750" class="Bound">w</a> <a id="15679" href="Ledger.Utxo.html#15754" class="Bound">k</a> <a id="15681" href="Ledger.Utxo.html#15758" class="Bound">l</a> <a id="15683" href="Ledger.Utxo.html#15762" class="Bound">m</a> <a id="15685" href="Ledger.Utxo.html#15766" class="Bound">v</a> <a id="15687" href="Ledger.Utxo.html#15770" class="Bound">n</a> <a id="15689" href="Ledger.Utxo.html#15774" class="Bound">o</a> <a id="15691" href="Ledger.Utxo.html#15778" class="Bound">p</a> <a id="15693" href="Ledger.Utxo.html#15782" class="Bound">q</a> <a id="15695" href="Ledger.Utxo.html#15786" class="Bound">r</a> <a id="15697" href="Ledger.Utxo.html#15790" class="Bound">t</a> <a id="15699" href="Ledger.Utxo.html#15794" class="Bound">u</a> <a id="15701" href="Ledger.Utxo.html#15798" class="Bound">h</a>
      <a id="15709" class="Symbol">=</a> <a id="15711" href="Ledger.Utxo.html#14514" class="InductiveConstructor">UTXO-inductive</a> <a id="15726" class="Symbol">{</a><a id="15727" href="Ledger.Utxo.html#15727" class="Bound">tx</a><a id="15729" class="Symbol">}{</a><a id="15731" href="Ledger.Utxo.html#15731" class="Bound">Γ</a><a id="15732" class="Symbol">}{</a><a id="15734" href="Ledger.Utxo.html#15734" class="Bound">s</a><a id="15735" class="Symbol">}</a> <a id="15737" class="Symbol">(</a><a id="15738" href="Ledger.Utxo.html#15738" class="Bound">x</a> <a id="15740" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="15742" href="Ledger.Utxo.html#15742" class="Bound">y</a> <a id="15744" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="15746" href="Ledger.Utxo.html#15746" class="Bound">z</a> <a id="15748" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="15750" href="Ledger.Utxo.html#15750" class="Bound">w</a> <a id="15752" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="15754" href="Ledger.Utxo.html#15754" class="Bound">k</a> <a id="15756" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="15758" href="Ledger.Utxo.html#15758" class="Bound">l</a> <a id="15760" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="15762" href="Ledger.Utxo.html#15762" class="Bound">m</a> <a id="15764" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="15766" href="Ledger.Utxo.html#15766" class="Bound">v</a> <a id="15768" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="15770" href="Ledger.Utxo.html#15770" class="Bound">n</a> <a id="15772" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="15774" href="Ledger.Utxo.html#15774" class="Bound">o</a> <a id="15776" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="15778" href="Ledger.Utxo.html#15778" class="Bound">p</a> <a id="15780" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="15782" href="Ledger.Utxo.html#15782" class="Bound">q</a> <a id="15784" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="15786" href="Ledger.Utxo.html#15786" class="Bound">r</a> <a id="15788" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="15790" href="Ledger.Utxo.html#15790" class="Bound">t</a> <a id="15792" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="15794" href="Ledger.Utxo.html#15794" class="Bound">u</a> <a id="15796" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="15798" href="Ledger.Utxo.html#15798" class="Bound">h</a><a id="15799" class="Symbol">)</a>
<a id="15801" class="Keyword">unquoteDecl</a> <a id="UTXO-premises"></a><a id="15813" href="Ledger.Utxo.html#15813" class="Function">UTXO-premises</a> <a id="15827" class="Symbol">=</a> <a id="15829" href="Tactic.Premises.html#1543" class="Function">genPremises</a> <a id="15841" href="Ledger.Utxo.html#15813" class="Function">UTXO-premises</a> <a id="15855" class="Symbol">(</a><a id="15856" class="Keyword">quote</a> <a id="15862" href="Ledger.Utxo.html#14514" class="InductiveConstructor">UTXO-inductive</a><a id="15876" class="Symbol">)</a>
<a id="15878" class="Markup">\end{code}</a><a id="15888" class="Background">
\caption{UTXO inference rules}
\label{fig:rules:utxo-shelley}
\end{figure*}
\end{NoConway}
</a></pre></body></html>