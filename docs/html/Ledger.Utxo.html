<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>Ledger.Utxo</title><link rel="stylesheet" href="Agda.css"></head><body><pre class="Agda"><a id="1" class="Background">\section{UTxO}
\label{sec:utxo}

\subsection{Accounting}

</a><a id="59" class="Markup">\begin{code}[hide]</a>
<a id="78" class="Symbol">{-#</a> <a id="82" class="Keyword">OPTIONS</a> <a id="90" class="Pragma">--safe</a> <a id="97" class="Symbol">#-}</a>

<a id="102" class="Keyword">open</a> <a id="107" class="Keyword">import</a> <a id="114" href="Algebra.html" class="Module">Algebra</a>              <a id="135" class="Keyword">using</a> <a id="141" class="Symbol">(</a><a id="142" href="Algebra.Bundles.html#6622" class="Record">CommutativeMonoid</a><a id="159" class="Symbol">)</a>
<a id="161" class="Keyword">open</a> <a id="166" class="Keyword">import</a> <a id="173" href="Data.Integer.Ext.html" class="Module">Data.Integer.Ext</a>     <a id="194" class="Keyword">using</a> <a id="200" class="Symbol">(</a><a id="201" href="Data.Integer.Ext.html#349" class="Function">posPart</a><a id="208" class="Symbol">;</a> <a id="210" href="Data.Integer.Ext.html#440" class="Function">negPart</a><a id="217" class="Symbol">)</a>
<a id="219" class="Keyword">open</a> <a id="224" class="Keyword">import</a> <a id="231" href="Data.Nat.Properties.html" class="Module">Data.Nat.Properties</a>  <a id="252" class="Keyword">using</a> <a id="258" class="Symbol">(</a><a id="259" href="Data.Nat.Properties.html#16493" class="Function">+-0-monoid</a><a id="269" class="Symbol">)</a>
<a id="271" class="Keyword">import</a> <a id="278" href="Data.Maybe.html" class="Module">Data.Maybe</a> <a id="289" class="Symbol">as</a> <a id="292" class="Module">M</a>
<a id="294" class="Keyword">import</a> <a id="301" href="Data.Sum.Relation.Unary.All.html" class="Module">Data.Sum.Relation.Unary.All</a> <a id="329" class="Symbol">as</a> <a id="332" class="Module">Sum</a>

<a id="337" class="Keyword">import</a> <a id="344" href="Data.Integer.html" class="Module">Data.Integer</a> <a id="357" class="Symbol">as</a> <a id="360" class="Module">ℤ</a>
<a id="362" class="Keyword">import</a> <a id="369" href="Data.Rational.html" class="Module">Data.Rational</a> <a id="383" class="Symbol">as</a> <a id="386" class="Module">ℚ</a>

<a id="389" class="Keyword">open</a> <a id="394" class="Keyword">import</a> <a id="401" href="Tactic.Derive.DecEq.html" class="Module">Tactic.Derive.DecEq</a>

<a id="422" class="Keyword">open</a> <a id="427" class="Keyword">import</a> <a id="434" href="Ledger.Prelude.html" class="Module">Ledger.Prelude</a>
<a id="449" class="Keyword">open</a> <a id="454" class="Keyword">import</a> <a id="461" href="Ledger.Abstract.html" class="Module">Ledger.Abstract</a>
<a id="477" class="Keyword">open</a> <a id="482" class="Keyword">import</a> <a id="489" href="Ledger.Transaction.html" class="Module">Ledger.Transaction</a>

<a id="509" class="Keyword">module</a> <a id="516" href="Ledger.Utxo.html" class="Module">Ledger.Utxo</a>
  <a id="530" class="Symbol">(</a><a id="531" href="Ledger.Utxo.html#531" class="Bound">txs</a> <a id="535" class="Symbol">:</a> <a id="537" class="Symbol">_)</a> <a id="540" class="Symbol">(</a><a id="541" class="Keyword">open</a> <a id="546" href="Ledger.Transaction.html#933" class="Module">TransactionStructure</a> <a id="567" href="Ledger.Utxo.html#531" class="Bound">txs</a><a id="570" class="Symbol">)</a>
  <a id="574" class="Symbol">(</a><a id="575" href="Ledger.Utxo.html#575" class="Bound">abs</a> <a id="579" class="Symbol">:</a> <a id="581" href="Ledger.Abstract.html#540" class="Record">AbstractFunctions</a> <a id="599" href="Ledger.Utxo.html#531" class="Bound">txs</a><a id="602" class="Symbol">)</a> <a id="604" class="Symbol">(</a><a id="605" class="Keyword">open</a> <a id="610" href="Ledger.Abstract.html#540" class="Module">AbstractFunctions</a> <a id="628" href="Ledger.Utxo.html#575" class="Bound">abs</a><a id="631" class="Symbol">)</a>
  <a id="635" class="Keyword">where</a>

<a id="642" class="Keyword">open</a> <a id="647" class="Keyword">import</a> <a id="654" href="Ledger.ScriptValidation.html" class="Module">Ledger.ScriptValidation</a> <a id="678" href="Ledger.Utxo.html#531" class="Bound">txs</a> <a id="682" href="Ledger.Utxo.html#575" class="Bound">abs</a>

<a id="687" class="Keyword">instance</a>
  <a id="698" href="Ledger.Utxo.html#698" class="Function">_</a> <a id="700" class="Symbol">=</a> <a id="702" href="Data.Nat.Properties.html#16493" class="Function">+-0-monoid</a>

  <a id="HasCoin-Map"></a><a id="716" href="Ledger.Utxo.html#716" class="Function">HasCoin-Map</a> <a id="728" class="Symbol">:</a> <a id="730" class="Symbol">∀</a> <a id="732" class="Symbol">{</a><a id="733" href="Ledger.Utxo.html#733" class="Bound">A</a><a id="734" class="Symbol">}</a> <a id="736" class="Symbol">→</a> <a id="738" class="Symbol">⦃</a> <a id="740" href="Class.DecEq.Core.html#117" class="Record">DecEq</a> <a id="746" href="Ledger.Utxo.html#733" class="Bound">A</a> <a id="748" class="Symbol">⦄</a> <a id="750" class="Symbol">→</a> <a id="752" href="Ledger.Interface.HasCoin.html#124" class="Record">HasCoin</a> <a id="760" class="Symbol">(</a><a id="761" href="Ledger.Utxo.html#733" class="Bound">A</a> <a id="763" href="Ledger.Set.Theory.html#1515" class="Function Operator">⇀</a> <a id="765" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a><a id="769" class="Symbol">)</a>
  <a id="773" href="Ledger.Utxo.html#716" class="Function">HasCoin-Map</a> <a id="785" class="Symbol">.</a><a id="786" href="Ledger.Interface.HasCoin.html#172" class="Field">getCoin</a> <a id="794" href="Ledger.Utxo.html#794" class="Bound">s</a> <a id="796" class="Symbol">=</a> <a id="798" href="Ledger.Set.Theory.html#3127" class="Function">∑[</a> <a id="801" href="Ledger.Utxo.html#801" class="Bound">x</a> <a id="803" href="Ledger.Set.Theory.html#3127" class="Function">←</a> <a id="805" href="Ledger.Utxo.html#794" class="Bound">s</a> <a id="807" href="Ledger.Set.Theory.html#3127" class="Function">]</a> <a id="809" href="Ledger.Utxo.html#801" class="Bound">x</a>

<a id="812" class="Keyword">infixl</a> <a id="819" class="Number">7</a> <a id="821" href="Ledger.Utxo.html#917" class="Function Operator">_*↓_</a>

<a id="827" class="Comment">-- multiply a natural number with a fraction, rounding down and taking the absolute value</a>
<a id="_*↓_"></a><a id="917" href="Ledger.Utxo.html#917" class="Function Operator">_*↓_</a> <a id="922" class="Symbol">:</a> <a id="924" href="Data.Rational.Base.html#1342" class="Record">ℚ.ℚ</a> <a id="928" class="Symbol">→</a> <a id="930" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a> <a id="932" class="Symbol">→</a> <a id="934" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a>
<a id="936" href="Ledger.Utxo.html#936" class="Bound">q</a> <a id="938" href="Ledger.Utxo.html#917" class="Function Operator">*↓</a> <a id="941" href="Ledger.Utxo.html#941" class="Bound">n</a> <a id="943" class="Symbol">=</a> <a id="945" href="Data.Integer.Base.html#1715" class="Function Operator">ℤ.∣</a> <a id="949" href="Data.Rational.Base.html#7116" class="Function">ℚ.⌊</a> <a id="953" href="Ledger.Utxo.html#936" class="Bound">q</a> <a id="955" href="Data.Rational.Base.html#6315" class="Function Operator">ℚ.*</a> <a id="959" class="Symbol">(</a><a id="960" href="Agda.Builtin.Int.html#263" class="InductiveConstructor Operator">ℤ.+</a> <a id="964" href="Ledger.Utxo.html#941" class="Bound">n</a> <a id="966" href="Data.Rational.Base.html#3884" class="Function Operator">ℚ./</a> <a id="970" class="Number">1</a><a id="971" class="Symbol">)</a> <a id="973" href="Data.Rational.Base.html#7116" class="Function">⌋</a> <a id="975" href="Data.Integer.Base.html#1715" class="Function Operator">∣</a>
<a id="977" class="Markup">\end{code}</a><a id="987" class="Background">

\begin{NoConway}
\begin{figure*}[h]
</a><a id="1025" class="Markup">\begin{code}</a>
<a id="isTwoPhaseScriptAddress"></a><a id="1038" href="Ledger.Utxo.html#1038" class="Function">isTwoPhaseScriptAddress</a> <a id="1062" class="Symbol">:</a> <a id="1064" href="Ledger.Transaction.html#5258" class="Record">Tx</a> <a id="1067" class="Symbol">→</a> <a id="1069" href="Ledger.Transaction.html#3913" class="Function">UTxO</a> <a id="1074" class="Symbol">→</a> <a id="1076" href="Ledger.Address.html#2070" class="Function">Addr</a> <a id="1081" class="Symbol">→</a> <a id="1083" href="Agda.Builtin.Bool.html#173" class="Datatype">Bool</a>
<a id="1088" href="Ledger.Utxo.html#1038" class="Function">isTwoPhaseScriptAddress</a> <a id="1112" href="Ledger.Utxo.html#1112" class="Bound">tx</a> <a id="1115" href="Ledger.Utxo.html#1115" class="Bound">utxo</a> <a id="1120" href="Ledger.Utxo.html#1120" class="Bound">a</a> <a id="1122" class="Symbol">=</a>
  <a id="1126" href="Interface.ToBool.html#287" class="Function Operator">if</a> <a id="1129" href="Ledger.Address.html#2435" class="Function">isScriptAddr</a> <a id="1142" href="Ledger.Utxo.html#1120" class="Bound">a</a> <a id="1144" href="Interface.ToBool.html#287" class="Function Operator">then</a>
    <a id="1153" class="Symbol">(λ</a> <a id="1156" class="Symbol">{</a><a id="1157" href="Ledger.Utxo.html#1157" class="Bound">p</a><a id="1158" class="Symbol">}</a> <a id="1160" class="Symbol">→</a> <a id="1162" href="Interface.ToBool.html#287" class="Function Operator">if</a> <a id="1165" href="Ledger.Transaction.html#6551" class="Function">lookupScriptHash</a> <a id="1182" class="Symbol">(</a><a id="1183" href="Ledger.Address.html#3689" class="Function">getScriptHash</a> <a id="1197" href="Ledger.Utxo.html#1120" class="Bound">a</a> <a id="1199" href="Ledger.Utxo.html#1157" class="Bound">p</a><a id="1200" class="Symbol">)</a> <a id="1202" href="Ledger.Utxo.html#1112" class="Bound">tx</a> <a id="1205" href="Ledger.Utxo.html#1115" class="Bound">utxo</a>
                 <a id="1227" href="Interface.ToBool.html#287" class="Function Operator">then</a> <a id="1232" class="Symbol">(λ</a> <a id="1235" class="Symbol">{</a><a id="1236" href="Ledger.Utxo.html#1236" class="Bound">s</a><a id="1237" class="Symbol">}</a> <a id="1239" class="Symbol">→</a> <a id="1241" href="Ledger.Transaction.html#6930" class="Function">isP2Script</a> <a id="1252" href="Ledger.Utxo.html#1236" class="Bound">s</a><a id="1253" class="Symbol">)</a>
                 <a id="1272" href="Interface.ToBool.html#287" class="Function Operator">else</a> <a id="1277" href="Agda.Builtin.Bool.html#192" class="InductiveConstructor">false</a><a id="1282" class="Symbol">)</a>
  <a id="1286" href="Interface.ToBool.html#287" class="Function Operator">else</a>
    <a id="1295" href="Agda.Builtin.Bool.html#192" class="InductiveConstructor">false</a>
<a id="1301" class="Markup">\end{code}</a><a id="1311" class="Background">
</a><a id="1312" class="Markup">\begin{code}[hide]</a>
<a id="1331" class="Keyword">opaque</a>
<a id="1338" class="Markup">\end{code}</a><a id="1348" class="Background">
</a><a id="1349" class="Markup">\begin{code}</a>
  <a id="getDataHashes"></a><a id="1364" href="Ledger.Utxo.html#1364" class="Function">getDataHashes</a> <a id="1378" class="Symbol">:</a> <a id="1380" href="Ledger.Set.Theory.html#382" class="Function Operator">ℙ</a> <a id="1382" href="Ledger.Transaction.html#3845" class="Function">TxOut</a> <a id="1388" class="Symbol">→</a> <a id="1390" href="Ledger.Set.Theory.html#382" class="Function Operator">ℙ</a> <a id="1392" href="Ledger.Script.html#1667" class="Function">DataHash</a>
  <a id="1403" href="Ledger.Utxo.html#1364" class="Function">getDataHashes</a> <a id="1417" href="Ledger.Utxo.html#1417" class="Bound">txo</a> <a id="1421" class="Symbol">=</a> <a id="1423" href="Axiom.Set.html#7518" class="Function">mapPartial</a> <a id="1434" href="Data.Sum.html#1056" class="Function">isInj₂</a> <a id="1441" class="Symbol">(</a><a id="1442" href="Axiom.Set.html#7518" class="Function">mapPartial</a> <a id="1453" class="Symbol">(</a><a id="1454" href="Data.Product.Base.html#636" class="Field">proj₁</a> <a id="1460" href="Function.Base.html#1115" class="Function Operator">∘</a> <a id="1462" href="Data.Product.Base.html#650" class="Field">proj₂</a> <a id="1468" href="Function.Base.html#1115" class="Function Operator">∘</a> <a id="1470" href="Data.Product.Base.html#650" class="Field">proj₂</a><a id="1475" class="Symbol">)</a> <a id="1477" href="Ledger.Utxo.html#1417" class="Bound">txo</a><a id="1480" class="Symbol">)</a>

  <a id="getInputHashes"></a><a id="1485" href="Ledger.Utxo.html#1485" class="Function">getInputHashes</a> <a id="1500" class="Symbol">:</a> <a id="1502" href="Ledger.Transaction.html#5258" class="Record">Tx</a> <a id="1505" class="Symbol">→</a> <a id="1507" href="Ledger.Transaction.html#3913" class="Function">UTxO</a> <a id="1512" class="Symbol">→</a> <a id="1514" href="Ledger.Set.Theory.html#382" class="Function Operator">ℙ</a> <a id="1516" href="Ledger.Script.html#1667" class="Function">DataHash</a>
  <a id="1527" href="Ledger.Utxo.html#1485" class="Function">getInputHashes</a> <a id="1542" href="Ledger.Utxo.html#1542" class="Bound">tx</a> <a id="1545" href="Ledger.Utxo.html#1545" class="Bound">utxo</a> <a id="1550" class="Symbol">=</a> <a id="1552" href="Ledger.Utxo.html#1364" class="Function">getDataHashes</a>
    <a id="1570" class="Symbol">(</a><a id="1571" href="Ledger.Set.Theory.html#2731" class="Function">filterˢ</a> <a id="1579" class="Symbol">(λ</a> <a id="1582" class="Symbol">(</a><a id="1583" href="Ledger.Utxo.html#1583" class="Bound">a</a> <a id="1585" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1587" class="Symbol">_</a> <a id="1589" class="Symbol">)</a> <a id="1591" class="Symbol">→</a> <a id="1593" href="Ledger.Utxo.html#1038" class="Function">isTwoPhaseScriptAddress</a> <a id="1617" href="Ledger.Utxo.html#1542" class="Bound">tx</a> <a id="1620" href="Ledger.Utxo.html#1545" class="Bound">utxo</a> <a id="1625" href="Ledger.Utxo.html#1583" class="Bound">a</a> <a id="1627" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="1629" href="Agda.Builtin.Bool.html#198" class="InductiveConstructor">true</a><a id="1633" class="Symbol">)</a>
            <a id="1647" class="Symbol">(</a><a id="1648" href="Interface.IsSet.html#977" class="Function">range</a> <a id="1654" class="Symbol">(</a><a id="1655" href="Ledger.Utxo.html#1545" class="Bound">utxo</a> <a id="1660" href="Axiom.Set.Map.html#10107" class="Function Operator">∣</a> <a id="1662" href="Ledger.Transaction.html#4247" class="Function">txins</a><a id="1667" class="Symbol">)))</a>
    <a id="1675" class="Keyword">where</a> <a id="1681" class="Keyword">open</a> <a id="1686" href="Ledger.Transaction.html#5258" class="Module">Tx</a><a id="1688" class="Symbol">;</a> <a id="1690" class="Keyword">open</a> <a id="1695" href="Ledger.Transaction.html#4157" class="Module">TxBody</a> <a id="1702" class="Symbol">(</a><a id="1703" href="Ledger.Utxo.html#1542" class="Bound">tx</a> <a id="1706" class="Symbol">.</a><a id="1707" href="Ledger.Transaction.html#5344" class="Field">body</a><a id="1711" class="Symbol">)</a>

<a id="totExUnits"></a><a id="1714" href="Ledger.Utxo.html#1714" class="Function">totExUnits</a> <a id="1725" class="Symbol">:</a> <a id="1727" href="Ledger.Transaction.html#5258" class="Record">Tx</a> <a id="1730" class="Symbol">→</a> <a id="1732" href="Ledger.Script.html#1096" class="Function">ExUnits</a>
<a id="1740" href="Ledger.Utxo.html#1714" class="Function">totExUnits</a> <a id="1751" href="Ledger.Utxo.html#1751" class="Bound">tx</a> <a id="1754" class="Symbol">=</a> <a id="1756" href="Ledger.Set.Theory.html#3127" class="Function">∑[</a> <a id="1759" href="Ledger.Utxo.html#1759" class="Bound">(_</a> <a id="1762" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1764" href="Ledger.Utxo.html#1764" class="Bound">eu</a><a id="1766" href="Ledger.Utxo.html#1759" class="Bound">)</a> <a id="1768" href="Ledger.Set.Theory.html#3127" class="Function">←</a> <a id="1770" href="Ledger.Utxo.html#1751" class="Bound">tx</a> <a id="1773" class="Symbol">.</a><a id="1774" href="Ledger.Transaction.html#5368" class="Field">wits</a> <a id="1779" class="Symbol">.</a><a id="1780" href="Ledger.Transaction.html#5137" class="Field">txrdmrs</a> <a id="1788" href="Ledger.Set.Theory.html#3127" class="Function">]</a> <a id="1790" href="Ledger.Utxo.html#1764" class="Bound">eu</a>
  <a id="1795" class="Keyword">where</a> <a id="1801" class="Keyword">open</a> <a id="1806" href="Ledger.Transaction.html#5258" class="Module">Tx</a><a id="1808" class="Symbol">;</a> <a id="1810" class="Keyword">open</a> <a id="1815" href="Ledger.Transaction.html#4954" class="Module">TxWitnesses</a>
<a id="1827" class="Markup">\end{code}</a><a id="1837" class="Background">
\caption{Functions supporting UTxO rules}
\label{fig:supportfunctions:utxo}
\end{figure*}

</a><a id="1929" class="Markup">\begin{code}[hide]</a>
<a id="1948" class="Comment">-- utxoEntrySizeWithoutVal = 27 words (8 bytes)</a>
<a id="utxoEntrySizeWithoutVal"></a><a id="1996" href="Ledger.Utxo.html#1996" class="Function">utxoEntrySizeWithoutVal</a> <a id="2020" class="Symbol">:</a> <a id="2022" href="Ledger.TokenAlgebra.html#605" class="Function">MemoryEstimate</a>
<a id="2037" href="Ledger.Utxo.html#1996" class="Function">utxoEntrySizeWithoutVal</a> <a id="2061" class="Symbol">=</a> <a id="2063" class="Number">8</a>

<a id="utxoEntrySize"></a><a id="2066" href="Ledger.Utxo.html#2066" class="Function">utxoEntrySize</a> <a id="2080" class="Symbol">:</a> <a id="2082" href="Ledger.Transaction.html#5710" class="Function">TxOutʰ</a> <a id="2089" class="Symbol">→</a> <a id="2091" href="Ledger.TokenAlgebra.html#605" class="Function">MemoryEstimate</a>
<a id="2106" href="Ledger.Utxo.html#2066" class="Function">utxoEntrySize</a> <a id="2120" href="Ledger.Utxo.html#2120" class="Bound">o</a> <a id="2122" class="Symbol">=</a> <a id="2124" href="Ledger.Utxo.html#1996" class="Function">utxoEntrySizeWithoutVal</a> <a id="2148" href="Interface.HasAdd.html#135" class="Field Operator">+</a> <a id="2150" href="Ledger.TokenAlgebra.html#1374" class="Function">size</a> <a id="2155" class="Symbol">(</a><a id="2156" href="Ledger.Transaction.html#5870" class="Function">getValueʰ</a> <a id="2166" href="Ledger.Utxo.html#2120" class="Bound">o</a><a id="2167" class="Symbol">)</a>


<a id="2171" class="Keyword">open</a> <a id="2176" href="Ledger.PParams.html#2073" class="Module">PParams</a>
<a id="2184" class="Markup">\end{code}</a><a id="2194" class="Background">

Figures~\ref{fig:supportfunctions:utxo},~\ref{fig:functions:utxo},
and~\ref{fig:functions:utxo2} define functions needed for the UTxO transition system.
\end{NoConway}
%
\begin{Conway}
Figures~\ref{fig:ts-types:utxo}--\ref{fig:functions:utxo-conway}
define types and functions needed for the UTxO transition system.
\end{Conway}
%
\ Note the special multiplication symbol \AgdaFunction{*↓} used in
Figure~\ref{fig:functions:utxo}: it means multiply and take the absolute value of the
result, rounded down to the nearest integer.

\begin{NoConway}
Figure~\ref{fig:ts-types:utxo} defines the types needed for the UTxO transition system.
The UTxO transition system is given in Figure~\ref{fig:rules:utxo-shelley}.

\begin{itemize}

  \item
    The function $\fun{outs}$ creates the unspent outputs generated by a transaction.
    It maps the transaction id and output index to the output.

  \item
    The $\fun{balance}$ function calculates sum total of all the coin in a given UTxO.
\end{itemize}
\end{NoConway}

The deposits have been reworked since the original Shelley design. We
now track the amount of every deposit individually. This fixes an
issue in the original design: An increase in deposit amounts would
allow an attacker to make lots of deposits before that change and
refund them after the change. The additional funds necessary would
have been provided by the treasury. Since changes to protocol
parameters were (and still are) known publicly and guaranteed before
they are enacted, this comes at zero risk for an attacker. This means
the deposit amounts could realistically never be increased. This issue
is gone with the new design.

Similar to \ScriptPurpose, \DepositPurpose carries the information
what the deposit is being made for. The deposits are stored in the
\deposits field of \UTxOState. \updateDeposits is responsible for
updating this map, which is split into \updateCertDeposits and
\updateProposalDeposits, responsible for certificates and proposals
respectively. Both of these functions iterate over the relevant fields
of the transaction body and insert or remove deposits depending on the
information seen. Note that some deposits can only be refunded at the
epoch boundary and are not removed by these functions.

There are two equivalent ways to introduce this tracking of the
deposits. One option would be to populate the \deposits field of
\UTxOState with the correct keys and values that can be extracted from
the state of the previous era at the transition into the Conway era.
Alternatively, we can effectively treat the old handling of deposits
as an erratum in the Shelley specification, which we fix by implementing
the new deposits logic in older eras and then replaying the chain.

\begin{figure*}[h]
\begin{AgdaMultiCode}
\begin{NoConway}
\emph{UTxO environment}
</a><a id="5006" class="Markup">\begin{code}</a>
<a id="5019" class="Keyword">record</a> <a id="UTxOEnv"></a><a id="5026" href="Ledger.Utxo.html#5026" class="Record">UTxOEnv</a> <a id="5034" class="Symbol">:</a> <a id="5036" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="5041" class="Keyword">where</a>
<a id="5047" class="Markup">\end{code}</a><a id="5057" class="Background">
</a><a id="5058" class="Markup">\begin{code}[hide]</a>
  <a id="5079" class="Keyword">field</a>
<a id="5085" class="Markup">\end{code}</a><a id="5095" class="Background">
</a><a id="5096" class="Markup">\begin{code}</a>
    <a id="UTxOEnv.slot"></a><a id="5113" href="Ledger.Utxo.html#5113" class="Field">slot</a>      <a id="5123" class="Symbol">:</a> <a id="5125" href="Ledger.Types.Epoch.html#382" class="Function">Slot</a>
    <a id="UTxOEnv.pparams"></a><a id="5134" href="Ledger.Utxo.html#5134" class="Field">pparams</a>   <a id="5144" class="Symbol">:</a> <a id="5146" href="Ledger.PParams.html#2073" class="Record">PParams</a>
    <a id="UTxOEnv.treasury"></a><a id="5158" href="Ledger.Utxo.html#5158" class="Field">treasury</a>  <a id="5168" class="Symbol">:</a> <a id="5170" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a>
<a id="5175" class="Markup">\end{code}</a><a id="5185" class="Background">
\end{NoConway}
\emph{UTxO states}
</a><a id="5220" class="Markup">\begin{code}</a>
<a id="5233" class="Keyword">record</a> <a id="UTxOState"></a><a id="5240" href="Ledger.Utxo.html#5240" class="Record">UTxOState</a> <a id="5250" class="Symbol">:</a> <a id="5252" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="5257" class="Keyword">where</a>
<a id="5263" class="Markup">\end{code}</a><a id="5273" class="Background">
</a><a id="5274" class="Markup">\begin{code}[hide]</a>
  <a id="5295" class="Keyword">constructor</a> <a id="⟦_,_,_,_⟧ᵘ"></a><a id="5307" href="Ledger.Utxo.html#5307" class="InductiveConstructor Operator">⟦_,_,_,_⟧ᵘ</a>
  <a id="5320" class="Keyword">field</a>
<a id="5326" class="Markup">\end{code}</a><a id="5336" class="Background">
</a><a id="5337" class="Markup">\begin{code}</a>
    <a id="UTxOState.utxo"></a><a id="5354" href="Ledger.Utxo.html#5354" class="Field">utxo</a>       <a id="5365" class="Symbol">:</a> <a id="5367" href="Ledger.Transaction.html#3913" class="Function">UTxO</a>
    <a id="UTxOState.fees"></a><a id="5376" href="Ledger.Utxo.html#5376" class="Field">fees</a>       <a id="5387" class="Symbol">:</a> <a id="5389" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a>
    <a id="UTxOState.deposits"></a><a id="5398" href="Ledger.Utxo.html#5398" class="Field">deposits</a>   <a id="5409" class="Symbol">:</a> <a id="5411" href="Ledger.Certs.html#590" class="Function">Deposits</a>
    <a id="UTxOState.donations"></a><a id="5424" href="Ledger.Utxo.html#5424" class="Field">donations</a>  <a id="5435" class="Symbol">:</a> <a id="5437" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a>
<a id="5442" class="Markup">\end{code}</a><a id="5452" class="Background">
\begin{NoConway}
\emph{UTxO transitions}

</a><a id="5495" class="Markup">\begin{code}[hide]</a>
<a id="5514" class="Keyword">data</a>
<a id="5519" class="Markup">\end{code}</a><a id="5529" class="Background">
</a><a id="5530" class="Markup">\begin{code}</a>
  <a id="_⊢_⇀⦇_,UTXO⦈_"></a><a id="5545" href="Ledger.Utxo.html#5545" class="Datatype Operator">_⊢_⇀⦇_,UTXO⦈_</a> <a id="5559" class="Symbol">:</a> <a id="5561" href="Ledger.Utxo.html#5026" class="Record">UTxOEnv</a> <a id="5569" class="Symbol">→</a> <a id="5571" href="Ledger.Utxo.html#5240" class="Record">UTxOState</a> <a id="5581" class="Symbol">→</a> <a id="5583" href="Ledger.Transaction.html#5258" class="Record">Tx</a> <a id="5586" class="Symbol">→</a> <a id="5588" href="Ledger.Utxo.html#5240" class="Record">UTxOState</a> <a id="5598" class="Symbol">→</a> <a id="5600" href="Agda.Primitive.html#388" class="Primitive">Type</a>
<a id="5605" class="Markup">\end{code}</a><a id="5615" class="Background">
\end{NoConway}
\end{AgdaMultiCode}
\caption{UTxO transition-system types}
\label{fig:ts-types:utxo}
\end{figure*}

\begin{figure*}[h]
</a><a id="5750" class="Markup">\begin{code}[hide]</a>
<a id="5769" class="Keyword">module</a> <a id="5776" href="Ledger.Utxo.html#5776" class="Module">_</a> <a id="5778" class="Symbol">(</a><a id="5779" class="Keyword">let</a> <a id="5783" class="Keyword">open</a> <a id="5788" href="Ledger.Transaction.html#5258" class="Module">Tx</a><a id="5790" class="Symbol">;</a> <a id="5792" class="Keyword">open</a> <a id="5797" href="Ledger.Transaction.html#4157" class="Module">TxBody</a><a id="5803" class="Symbol">;</a> <a id="5805" class="Keyword">open</a> <a id="5810" href="Ledger.Transaction.html#4954" class="Module">TxWitnesses</a><a id="5821" class="Symbol">)</a> <a id="5823" class="Keyword">where</a> <a id="5829" class="Keyword">opaque</a>
<a id="5836" class="Markup">\end{code}</a><a id="5846" class="Background">
\begin{AgdaMultiCode}
\begin{NoConway}
</a><a id="5886" class="Markup">\begin{code}</a>
  <a id="5901" href="Ledger.Utxo.html#5901" class="Function">outs</a> <a id="5906" class="Symbol">:</a> <a id="5908" href="Ledger.Transaction.html#4157" class="Record">TxBody</a> <a id="5915" class="Symbol">→</a> <a id="5917" href="Ledger.Transaction.html#3913" class="Function">UTxO</a>
  <a id="5924" href="Ledger.Utxo.html#5901" class="Function">outs</a> <a id="5929" href="Ledger.Utxo.html#5929" class="Bound">tx</a> <a id="5932" class="Symbol">=</a> <a id="5934" href="Axiom.Set.Map.html#5966" class="Function">mapKeys</a> <a id="5942" class="Symbol">(</a><a id="5943" href="Ledger.Utxo.html#5929" class="Bound">tx</a> <a id="5946" class="Symbol">.</a><a id="5947" href="Ledger.Transaction.html#4779" class="Field">txid</a> <a id="5952" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,_</a><a id="5954" class="Symbol">)</a> <a id="5956" class="Symbol">(</a><a id="5957" href="Ledger.Utxo.html#5929" class="Bound">tx</a> <a id="5960" class="Symbol">.</a><a id="5961" href="Ledger.Transaction.html#4307" class="Field">txouts</a><a id="5967" class="Symbol">)</a>

  <a id="5972" href="Ledger.Utxo.html#5972" class="Function">balance</a> <a id="5980" class="Symbol">:</a> <a id="5982" href="Ledger.Transaction.html#3913" class="Function">UTxO</a> <a id="5987" class="Symbol">→</a> <a id="5989" href="Ledger.TokenAlgebra.html#816" class="Function">Value</a>
  <a id="5997" href="Ledger.Utxo.html#5972" class="Function">balance</a> <a id="6005" href="Ledger.Utxo.html#6005" class="Bound">utxo</a> <a id="6010" class="Symbol">=</a> <a id="6012" href="Ledger.Set.Theory.html#3127" class="Function">∑[</a> <a id="6015" href="Ledger.Utxo.html#6015" class="Bound">x</a> <a id="6017" href="Ledger.Set.Theory.html#3127" class="Function">←</a> <a id="6019" href="Axiom.Set.Map.html#6138" class="Function">mapValues</a> <a id="6029" href="Ledger.Transaction.html#5781" class="Function">txOutHash</a> <a id="6039" href="Ledger.Utxo.html#6005" class="Bound">utxo</a> <a id="6044" href="Ledger.Set.Theory.html#3127" class="Function">]</a> <a id="6046" href="Ledger.Transaction.html#5870" class="Function">getValueʰ</a> <a id="6056" href="Ledger.Utxo.html#6015" class="Bound">x</a>

  <a id="6061" href="Ledger.Utxo.html#6061" class="Function">cbalance</a> <a id="6070" class="Symbol">:</a> <a id="6072" href="Ledger.Transaction.html#3913" class="Function">UTxO</a> <a id="6077" class="Symbol">→</a> <a id="6079" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a>
  <a id="6086" href="Ledger.Utxo.html#6061" class="Function">cbalance</a> <a id="6095" href="Ledger.Utxo.html#6095" class="Bound">utxo</a> <a id="6100" class="Symbol">=</a> <a id="6102" href="Ledger.TokenAlgebra.html#1233" class="Function">coin</a> <a id="6107" class="Symbol">(</a><a id="6108" href="Ledger.Utxo.html#5972" class="Function">balance</a> <a id="6116" href="Ledger.Utxo.html#6095" class="Bound">utxo</a><a id="6120" class="Symbol">)</a>
<a id="6122" class="Markup">\end{code}</a><a id="6132" class="Background">
\end{NoConway}
</a><a id="6148" class="Markup">\begin{code}</a>
  <a id="6163" href="Ledger.Utxo.html#6163" class="Function">minfee</a> <a id="6170" class="Symbol">:</a> <a id="6172" href="Ledger.PParams.html#2073" class="Record">PParams</a> <a id="6180" class="Symbol">→</a> <a id="6182" href="Ledger.Transaction.html#3913" class="Function">UTxO</a> <a id="6187" class="Symbol">→</a> <a id="6189" href="Ledger.Transaction.html#5258" class="Record">Tx</a> <a id="6192" class="Symbol">→</a> <a id="6194" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a>
  <a id="6201" href="Ledger.Utxo.html#6163" class="Function">minfee</a> <a id="6208" href="Ledger.Utxo.html#6208" class="Bound">pp</a> <a id="6211" href="Ledger.Utxo.html#6211" class="Bound">utxo</a> <a id="6216" href="Ledger.Utxo.html#6216" class="Bound">tx</a>  <a id="6220" class="Symbol">=</a>
    <a id="6226" href="Ledger.Utxo.html#6208" class="Bound">pp</a> <a id="6229" class="Symbol">.</a><a id="6230" href="Ledger.PParams.html#2640" class="Field">a</a> <a id="6232" href="Agda.Builtin.Nat.html#539" class="Primitive Operator">*</a> <a id="6234" href="Ledger.Utxo.html#6216" class="Bound">tx</a> <a id="6237" class="Symbol">.</a><a id="6238" href="Ledger.Transaction.html#5344" class="Field">body</a> <a id="6243" class="Symbol">.</a><a id="6244" href="Ledger.Transaction.html#4754" class="Field">txsize</a> <a id="6251" href="Interface.HasAdd.html#135" class="Field Operator">+</a> <a id="6253" href="Ledger.Utxo.html#6208" class="Bound">pp</a> <a id="6256" class="Symbol">.</a><a id="6257" href="Ledger.PParams.html#2682" class="Field">b</a>
    <a id="6263" href="Interface.HasAdd.html#135" class="Field Operator">+</a> <a id="6265" href="Ledger.Abstract.html#579" class="Field">txscriptfee</a> <a id="6277" class="Symbol">(</a><a id="6278" href="Ledger.Utxo.html#6208" class="Bound">pp</a> <a id="6281" class="Symbol">.</a><a id="6282" href="Ledger.PParams.html#2859" class="Field">prices</a><a id="6288" class="Symbol">)</a> <a id="6290" class="Symbol">(</a><a id="6291" href="Ledger.Utxo.html#1714" class="Function">totExUnits</a> <a id="6302" href="Ledger.Utxo.html#6216" class="Bound">tx</a><a id="6304" class="Symbol">)</a>
    <a id="6310" href="Interface.HasAdd.html#135" class="Field Operator">+</a> <a id="6312" href="Ledger.Utxo.html#6208" class="Bound">pp</a> <a id="6315" class="Symbol">.</a><a id="6316" href="Ledger.PParams.html#2906" class="Field">minFeeRefScriptCoinsPerByte</a>
    <a id="6348" href="Ledger.Utxo.html#917" class="Function Operator">*↓</a> <a id="6351" href="Ledger.Set.Theory.html#3127" class="Function">∑[</a> <a id="6354" href="Ledger.Utxo.html#6354" class="Bound">x</a> <a id="6356" href="Ledger.Set.Theory.html#3127" class="Function">←</a> <a id="6358" href="Axiom.Set.Map.html#6138" class="Function">mapValues</a> <a id="6368" href="Ledger.Abstract.html#776" class="Field">scriptSize</a> <a id="6379" class="Symbol">(</a><a id="6380" href="Ledger.Set.HashMap.html#295" class="Function">setToHashMap</a> <a id="6393" class="Symbol">(</a><a id="6394" href="Ledger.Transaction.html#6239" class="Function">refScripts</a> <a id="6405" href="Ledger.Utxo.html#6216" class="Bound">tx</a> <a id="6408" href="Ledger.Utxo.html#6211" class="Bound">utxo</a><a id="6412" class="Symbol">))</a> <a id="6415" href="Ledger.Set.Theory.html#3127" class="Function">]</a> <a id="6417" href="Ledger.Utxo.html#6354" class="Bound">x</a>

<a id="6420" class="Markup">\end{code}</a><a id="6430" class="Background">
</a><a id="6431" class="Markup">\begin{code}[hide]</a>
<a id="6450" class="Keyword">instance</a>
  <a id="HasCoin-UTxO"></a><a id="6461" href="Ledger.Utxo.html#6461" class="Function">HasCoin-UTxO</a> <a id="6474" class="Symbol">:</a> <a id="6476" href="Ledger.Interface.HasCoin.html#124" class="Record">HasCoin</a> <a id="6484" href="Ledger.Transaction.html#3913" class="Function">UTxO</a>
  <a id="6491" href="Ledger.Utxo.html#6461" class="Function">HasCoin-UTxO</a> <a id="6504" class="Symbol">.</a><a id="6505" href="Ledger.Interface.HasCoin.html#172" class="Field">getCoin</a> <a id="6513" class="Symbol">=</a> <a id="6515" href="Ledger.Utxo.html#6061" class="Function">cbalance</a>
<a id="6524" class="Markup">\end{code}</a><a id="6534" class="Background">
</a><a id="6535" class="Markup">\begin{code}</a>
<a id="certDeposit"></a><a id="6548" href="Ledger.Utxo.html#6548" class="Function">certDeposit</a> <a id="6560" class="Symbol">:</a> <a id="6562" href="Ledger.Certs.html#1056" class="Datatype">DCert</a> <a id="6568" class="Symbol">→</a> <a id="6570" href="Ledger.PParams.html#2073" class="Record">PParams</a> <a id="6578" class="Symbol">→</a> <a id="6580" href="Ledger.Certs.html#349" class="Datatype">DepositPurpose</a> <a id="6595" href="Ledger.Set.Theory.html#1515" class="Function Operator">⇀</a> <a id="6597" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a>
<a id="6602" href="Ledger.Utxo.html#6548" class="Function">certDeposit</a> <a id="6614" class="Symbol">(</a><a id="6615" href="Ledger.Certs.html#1077" class="InductiveConstructor">delegate</a> <a id="6624" href="Ledger.Utxo.html#6624" class="Bound">c</a> <a id="6626" class="Symbol">_</a> <a id="6628" class="Symbol">_</a> <a id="6630" href="Ledger.Utxo.html#6630" class="Bound">v</a><a id="6631" class="Symbol">)</a> <a id="6633" class="Symbol">_</a>   <a id="6637" class="Symbol">=</a> <a id="6639" href="Interface.HasSingleton.html#348" class="Field Operator">❴</a> <a id="6641" href="Ledger.Certs.html#379" class="InductiveConstructor">CredentialDeposit</a> <a id="6659" href="Ledger.Utxo.html#6624" class="Bound">c</a> <a id="6661" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="6663" href="Ledger.Utxo.html#6630" class="Bound">v</a> <a id="6665" href="Interface.HasSingleton.html#348" class="Field Operator">❵</a>
<a id="6667" href="Ledger.Utxo.html#6548" class="Function">certDeposit</a> <a id="6679" class="Symbol">(</a><a id="6680" href="Ledger.Certs.html#1192" class="InductiveConstructor">regpool</a> <a id="6688" href="Ledger.Utxo.html#6688" class="Bound">kh</a> <a id="6691" class="Symbol">_)</a>     <a id="6698" href="Ledger.Utxo.html#6698" class="Bound">pp</a>  <a id="6702" class="Symbol">=</a> <a id="6704" href="Interface.HasSingleton.html#348" class="Field Operator">❴</a> <a id="6706" href="Ledger.Certs.html#432" class="InductiveConstructor">PoolDeposit</a> <a id="6718" href="Ledger.Utxo.html#6688" class="Bound">kh</a> <a id="6721" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="6723" href="Ledger.Utxo.html#6698" class="Bound">pp</a> <a id="6726" class="Symbol">.</a><a id="6727" href="Ledger.PParams.html#2769" class="Field">poolDeposit</a> <a id="6739" href="Interface.HasSingleton.html#348" class="Field Operator">❵</a>
<a id="6741" href="Ledger.Utxo.html#6548" class="Function">certDeposit</a> <a id="6753" class="Symbol">(</a><a id="6754" href="Ledger.Certs.html#1277" class="InductiveConstructor">regdrep</a> <a id="6762" href="Ledger.Utxo.html#6762" class="Bound">c</a> <a id="6764" href="Ledger.Utxo.html#6764" class="Bound">v</a> <a id="6766" class="Symbol">_)</a>    <a id="6772" class="Symbol">_</a>   <a id="6776" class="Symbol">=</a> <a id="6778" href="Interface.HasSingleton.html#348" class="Field Operator">❴</a> <a id="6780" href="Ledger.Certs.html#485" class="InductiveConstructor">DRepDeposit</a> <a id="6792" href="Ledger.Utxo.html#6762" class="Bound">c</a> <a id="6794" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="6796" href="Ledger.Utxo.html#6764" class="Bound">v</a> <a id="6798" href="Interface.HasSingleton.html#348" class="Field Operator">❵</a>
<a id="6800" href="Ledger.Utxo.html#6548" class="CatchallClause Function">certDeposit</a><a id="6811" class="CatchallClause"> </a><a id="6812" class="CatchallClause Symbol">_</a><a id="6813" class="CatchallClause">                  </a><a id="6831" class="CatchallClause Symbol">_</a>   <a id="6835" class="Symbol">=</a> <a id="6837" href="Interface.HasEmptySet.html#150" class="Field">∅</a>

<a id="certRefund"></a><a id="6840" href="Ledger.Utxo.html#6840" class="Function">certRefund</a> <a id="6851" class="Symbol">:</a> <a id="6853" href="Ledger.Certs.html#1056" class="Datatype">DCert</a> <a id="6859" class="Symbol">→</a> <a id="6861" href="Ledger.Set.Theory.html#382" class="Function Operator">ℙ</a> <a id="6863" href="Ledger.Certs.html#349" class="Datatype">DepositPurpose</a>
<a id="6878" href="Ledger.Utxo.html#6840" class="Function">certRefund</a> <a id="6889" class="Symbol">(</a><a id="6890" href="Ledger.Certs.html#1150" class="InductiveConstructor">dereg</a> <a id="6896" href="Ledger.Utxo.html#6896" class="Bound">c</a> <a id="6898" class="Symbol">_)</a>    <a id="6904" class="Symbol">=</a> <a id="6906" href="Interface.HasSingleton.html#348" class="Field Operator">❴</a> <a id="6908" href="Ledger.Certs.html#379" class="InductiveConstructor">CredentialDeposit</a> <a id="6926" href="Ledger.Utxo.html#6896" class="Bound">c</a> <a id="6928" href="Interface.HasSingleton.html#348" class="Field Operator">❵</a>
<a id="6930" href="Ledger.Utxo.html#6840" class="Function">certRefund</a> <a id="6941" class="Symbol">(</a><a id="6942" href="Ledger.Certs.html#1328" class="InductiveConstructor">deregdrep</a> <a id="6952" href="Ledger.Utxo.html#6952" class="Bound">c</a><a id="6953" class="Symbol">)</a>  <a id="6956" class="Symbol">=</a> <a id="6958" href="Interface.HasSingleton.html#348" class="Field Operator">❴</a> <a id="6960" href="Ledger.Certs.html#485" class="InductiveConstructor">DRepDeposit</a> <a id="6972" href="Ledger.Utxo.html#6952" class="Bound">c</a> <a id="6974" href="Interface.HasSingleton.html#348" class="Field Operator">❵</a>
<a id="6976" href="Ledger.Utxo.html#6840" class="CatchallClause Function">certRefund</a><a id="6986" class="CatchallClause"> </a><a id="6987" class="CatchallClause Symbol">_</a>              <a id="7002" class="Symbol">=</a> <a id="7004" href="Interface.HasEmptySet.html#150" class="Field">∅</a>

<a id="updateCertDeposits"></a><a id="7007" href="Ledger.Utxo.html#7007" class="Function">updateCertDeposits</a>  <a id="7027" class="Symbol">:</a> <a id="7029" href="Ledger.PParams.html#2073" class="Record">PParams</a> <a id="7037" class="Symbol">→</a> <a id="7039" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="7044" href="Ledger.Certs.html#1056" class="Datatype">DCert</a> <a id="7050" class="Symbol">→</a> <a id="7052" class="Symbol">(</a><a id="7053" href="Ledger.Certs.html#349" class="Datatype">DepositPurpose</a> <a id="7068" href="Ledger.Set.Theory.html#1515" class="Function Operator">⇀</a> <a id="7070" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a><a id="7074" class="Symbol">)</a>
                    <a id="7096" class="Symbol">→</a> <a id="7098" href="Ledger.Certs.html#349" class="Datatype">DepositPurpose</a> <a id="7113" href="Ledger.Set.Theory.html#1515" class="Function Operator">⇀</a> <a id="7115" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a>
<a id="7120" href="Ledger.Utxo.html#7007" class="Function">updateCertDeposits</a> <a id="7139" class="Symbol">_</a>   <a id="7143" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a>              <a id="7159" href="Ledger.Utxo.html#7159" class="Bound">deposits</a> <a id="7168" class="Symbol">=</a> <a id="7170" href="Ledger.Utxo.html#7159" class="Bound">deposits</a>
<a id="7179" href="Ledger.Utxo.html#7007" class="Function">updateCertDeposits</a> <a id="7198" href="Ledger.Utxo.html#7198" class="Bound">pp</a>  <a id="7202" class="Symbol">(</a><a id="7203" href="Ledger.Utxo.html#7203" class="Bound">cert</a> <a id="7208" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="7210" href="Ledger.Utxo.html#7210" class="Bound">certs</a><a id="7215" class="Symbol">)</a>  <a id="7218" href="Ledger.Utxo.html#7218" class="Bound">deposits</a>
  <a id="7229" class="Symbol">=</a> <a id="7231" class="Symbol">(</a><a id="7232" href="Ledger.Utxo.html#7007" class="Function">updateCertDeposits</a> <a id="7251" href="Ledger.Utxo.html#7198" class="Bound">pp</a> <a id="7254" href="Ledger.Utxo.html#7210" class="Bound">certs</a> <a id="7260" href="Ledger.Utxo.html#7218" class="Bound">deposits</a> <a id="7269" href="Axiom.Set.Map.Dec.html#1956" class="Function Operator">∪⁺</a> <a id="7272" href="Ledger.Utxo.html#6548" class="Function">certDeposit</a> <a id="7284" href="Ledger.Utxo.html#7203" class="Bound">cert</a> <a id="7289" href="Ledger.Utxo.html#7198" class="Bound">pp</a><a id="7291" class="Symbol">)</a> <a id="7293" href="Axiom.Set.Map.html#10177" class="Function Operator">∣</a> <a id="7295" href="Ledger.Utxo.html#6840" class="Function">certRefund</a> <a id="7306" href="Ledger.Utxo.html#7203" class="Bound">cert</a> <a id="7311" href="Axiom.Set.Map.html#10177" class="Function Operator">ᶜ</a>

<a id="updateProposalDeposits"></a><a id="7314" href="Ledger.Utxo.html#7314" class="Function">updateProposalDeposits</a> <a id="7337" class="Symbol">:</a> <a id="7339" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="7344" href="Ledger.GovernanceActions.html#8487" class="Record">GovProposal</a> <a id="7356" class="Symbol">→</a> <a id="7358" href="Ledger.Transaction.html#2353" class="Field">TxId</a> <a id="7363" class="Symbol">→</a> <a id="7365" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a> <a id="7370" class="Symbol">→</a> <a id="7372" href="Ledger.Certs.html#590" class="Function">Deposits</a> <a id="7381" class="Symbol">→</a> <a id="7383" href="Ledger.Certs.html#590" class="Function">Deposits</a>
<a id="7392" href="Ledger.Utxo.html#7314" class="Function">updateProposalDeposits</a> <a id="7415" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a>        <a id="7425" class="Symbol">_</a>     <a id="7431" class="Symbol">_</a>      <a id="7438" href="Ledger.Utxo.html#7438" class="Bound">deposits</a>  <a id="7448" class="Symbol">=</a> <a id="7450" href="Ledger.Utxo.html#7438" class="Bound">deposits</a>
<a id="7459" href="Ledger.Utxo.html#7314" class="Function">updateProposalDeposits</a> <a id="7482" class="Symbol">(_</a> <a id="7485" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="7487" href="Ledger.Utxo.html#7487" class="Bound">ps</a><a id="7489" class="Symbol">)</a>  <a id="7492" href="Ledger.Utxo.html#7492" class="Bound">txid</a>  <a id="7498" href="Ledger.Utxo.html#7498" class="Bound">gaDep</a>  <a id="7505" href="Ledger.Utxo.html#7505" class="Bound">deposits</a>  <a id="7515" class="Symbol">=</a>
  <a id="7519" href="Ledger.Utxo.html#7314" class="Function">updateProposalDeposits</a> <a id="7542" href="Ledger.Utxo.html#7487" class="Bound">ps</a> <a id="7545" href="Ledger.Utxo.html#7492" class="Bound">txid</a> <a id="7550" href="Ledger.Utxo.html#7498" class="Bound">gaDep</a> <a id="7556" href="Ledger.Utxo.html#7505" class="Bound">deposits</a>
  <a id="7567" href="Axiom.Set.Map.Dec.html#1956" class="Function Operator">∪⁺</a> <a id="7570" href="Interface.HasSingleton.html#348" class="Field Operator">❴</a> <a id="7572" href="Ledger.Certs.html#538" class="InductiveConstructor">GovActionDeposit</a> <a id="7589" class="Symbol">(</a><a id="7590" href="Ledger.Utxo.html#7492" class="Bound">txid</a> <a id="7595" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="7597" href="Data.List.Base.html#5083" class="Function">length</a> <a id="7604" href="Ledger.Utxo.html#7487" class="Bound">ps</a><a id="7606" class="Symbol">)</a> <a id="7608" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="7610" href="Ledger.Utxo.html#7498" class="Bound">gaDep</a> <a id="7616" href="Interface.HasSingleton.html#348" class="Field Operator">❵</a>

<a id="updateDeposits"></a><a id="7619" href="Ledger.Utxo.html#7619" class="Function">updateDeposits</a> <a id="7634" class="Symbol">:</a> <a id="7636" href="Ledger.PParams.html#2073" class="Record">PParams</a> <a id="7644" class="Symbol">→</a> <a id="7646" href="Ledger.Transaction.html#4157" class="Record">TxBody</a> <a id="7653" class="Symbol">→</a> <a id="7655" href="Ledger.Certs.html#590" class="Function">Deposits</a> <a id="7664" class="Symbol">→</a> <a id="7666" href="Ledger.Certs.html#590" class="Function">Deposits</a>
<a id="7675" href="Ledger.Utxo.html#7619" class="Function">updateDeposits</a> <a id="7690" href="Ledger.Utxo.html#7690" class="Bound">pp</a> <a id="7693" href="Ledger.Utxo.html#7693" class="Bound">txb</a> <a id="7697" class="Symbol">=</a> <a id="7699" href="Ledger.Utxo.html#7007" class="Function">updateCertDeposits</a> <a id="7718" href="Ledger.Utxo.html#7690" class="Bound">pp</a> <a id="7721" href="Ledger.Transaction.html#4445" class="Field">txcerts</a>
                        <a id="7753" href="Function.Base.html#1115" class="Function Operator">∘</a> <a id="7755" href="Ledger.Utxo.html#7314" class="Function">updateProposalDeposits</a> <a id="7778" href="Ledger.Transaction.html#4543" class="Field">txprop</a> <a id="7785" href="Ledger.Transaction.html#4779" class="Field">txid</a> <a id="7790" class="Symbol">(</a><a id="7791" href="Ledger.Utxo.html#7690" class="Bound">pp</a> <a id="7794" class="Symbol">.</a><a id="7795" href="Ledger.PParams.html#3745" class="Field">govActionDeposit</a><a id="7811" class="Symbol">)</a>
<a id="7813" class="Markup">\end{code}</a><a id="7823" class="Background">
</a><a id="7824" class="Markup">\begin{code}[hide]</a>
  <a id="7845" class="Keyword">where</a> <a id="7851" class="Keyword">open</a> <a id="7856" href="Ledger.Transaction.html#4157" class="Module">TxBody</a> <a id="7863" href="Ledger.Utxo.html#7693" class="Bound">txb</a>

<a id="proposalDepositsΔ"></a><a id="7868" href="Ledger.Utxo.html#7868" class="Function">proposalDepositsΔ</a> <a id="7886" class="Symbol">:</a> <a id="7888" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="7893" href="Ledger.GovernanceActions.html#8487" class="Record">GovProposal</a> <a id="7905" class="Symbol">→</a> <a id="7907" href="Ledger.PParams.html#2073" class="Record">PParams</a> <a id="7915" class="Symbol">→</a> <a id="7917" href="Ledger.Transaction.html#4157" class="Record">TxBody</a> <a id="7924" class="Symbol">→</a> <a id="7926" href="Ledger.Certs.html#349" class="Datatype">DepositPurpose</a> <a id="7941" href="Ledger.Set.Theory.html#1515" class="Function Operator">⇀</a> <a id="7943" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a>
<a id="7948" href="Ledger.Utxo.html#7868" class="Function">proposalDepositsΔ</a> <a id="7966" href="Ledger.Utxo.html#7966" class="Bound">props</a> <a id="7972" href="Ledger.Utxo.html#7972" class="Bound">pp</a> <a id="7975" href="Ledger.Utxo.html#7975" class="Bound">txb</a> <a id="7979" class="Symbol">=</a> <a id="7981" href="Ledger.Utxo.html#7314" class="Function">updateProposalDeposits</a> <a id="8004" href="Ledger.Utxo.html#7966" class="Bound">props</a> <a id="8010" href="Ledger.Transaction.html#4779" class="Field">txid</a> <a id="8015" class="Symbol">(</a><a id="8016" href="Ledger.Utxo.html#7972" class="Bound">pp</a> <a id="8019" class="Symbol">.</a><a id="8020" href="Ledger.PParams.html#3745" class="Field">govActionDeposit</a><a id="8036" class="Symbol">)</a> <a id="8038" href="Interface.HasEmptySet.html#150" class="Field">∅</a>
  <a id="8042" class="Keyword">where</a> <a id="8048" class="Keyword">open</a> <a id="8053" href="Ledger.Transaction.html#4157" class="Module">TxBody</a> <a id="8060" href="Ledger.Utxo.html#7975" class="Bound">txb</a>
<a id="8064" class="Markup">\end{code}</a><a id="8074" class="Background">
</a><a id="8075" class="Markup">\begin{code}</a>

<a id="depositsChange"></a><a id="8089" href="Ledger.Utxo.html#8089" class="Function">depositsChange</a> <a id="8104" class="Symbol">:</a> <a id="8106" href="Ledger.PParams.html#2073" class="Record">PParams</a> <a id="8114" class="Symbol">→</a> <a id="8116" href="Ledger.Transaction.html#4157" class="Record">TxBody</a> <a id="8123" class="Symbol">→</a> <a id="8125" href="Ledger.Certs.html#590" class="Function">Deposits</a> <a id="8134" class="Symbol">→</a> <a id="8136" href="Agda.Builtin.Int.html#245" class="Datatype">ℤ</a>
<a id="8138" href="Ledger.Utxo.html#8089" class="Function">depositsChange</a> <a id="8153" href="Ledger.Utxo.html#8153" class="Bound">pp</a> <a id="8156" href="Ledger.Utxo.html#8156" class="Bound">txb</a> <a id="8160" href="Ledger.Utxo.html#8160" class="Bound">deposits</a> <a id="8169" class="Symbol">=</a>
  <a id="8173" href="Ledger.Interface.HasCoin.html#172" class="Field">getCoin</a> <a id="8181" class="Symbol">(</a><a id="8182" href="Ledger.Utxo.html#7619" class="Function">updateDeposits</a> <a id="8197" href="Ledger.Utxo.html#8153" class="Bound">pp</a> <a id="8200" href="Ledger.Utxo.html#8156" class="Bound">txb</a> <a id="8204" href="Ledger.Utxo.html#8160" class="Bound">deposits</a><a id="8212" class="Symbol">)</a> <a id="8214" href="Interface.HasSubtract.html#209" class="Field Operator">-</a> <a id="8216" href="Ledger.Interface.HasCoin.html#172" class="Field">getCoin</a> <a id="8224" href="Ledger.Utxo.html#8160" class="Bound">deposits</a>
<a id="8233" class="Markup">\end{code}</a><a id="8243" class="Background">
\end{AgdaMultiCode}
\caption{Functions used in UTxO rules}
\label{fig:functions:utxo}
\end{figure*}

\begin{NoConway}
\begin{figure*}
\begin{AgdaMultiCode}
</a><a id="8400" class="Markup">\begin{code}</a>
<a id="8413" class="Keyword">data</a> <a id="inInterval"></a><a id="8418" href="Ledger.Utxo.html#8418" class="Datatype">inInterval</a> <a id="8429" class="Symbol">(</a><a id="8430" href="Ledger.Utxo.html#8430" class="Bound">slot</a> <a id="8435" class="Symbol">:</a> <a id="8437" href="Ledger.Types.Epoch.html#382" class="Function">Slot</a><a id="8441" class="Symbol">)</a> <a id="8443" class="Symbol">:</a> <a id="8445" class="Symbol">(</a><a id="8446" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="8452" href="Ledger.Types.Epoch.html#382" class="Function">Slot</a> <a id="8457" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="8459" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="8465" href="Ledger.Types.Epoch.html#382" class="Function">Slot</a><a id="8469" class="Symbol">)</a> <a id="8471" class="Symbol">→</a> <a id="8473" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="8478" class="Keyword">where</a>
  <a id="inInterval.both"></a><a id="8486" href="Ledger.Utxo.html#8486" class="InductiveConstructor">both</a>   <a id="8493" class="Symbol">:</a> <a id="8495" class="Symbol">∀</a> <a id="8497" class="Symbol">{</a><a id="8498" href="Ledger.Utxo.html#8498" class="Bound">l</a> <a id="8500" href="Ledger.Utxo.html#8500" class="Bound">r</a><a id="8501" class="Symbol">}</a>  <a id="8504" class="Symbol">→</a> <a id="8506" href="Ledger.Utxo.html#8498" class="Bound">l</a> <a id="8508" href="Interface.HasOrder.html#301" class="Field Operator">≤</a> <a id="8510" href="Ledger.Utxo.html#8430" class="Bound">slot</a> <a id="8515" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="8517" href="Ledger.Utxo.html#8430" class="Bound">slot</a> <a id="8522" href="Interface.HasOrder.html#301" class="Field Operator">≤</a> <a id="8524" href="Ledger.Utxo.html#8500" class="Bound">r</a>  <a id="8527" class="Symbol">→</a>  <a id="8530" href="Ledger.Utxo.html#8418" class="Datatype">inInterval</a> <a id="8541" href="Ledger.Utxo.html#8430" class="Bound">slot</a> <a id="8546" class="Symbol">(</a><a id="8547" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="8552" href="Ledger.Utxo.html#8498" class="Bound">l</a>   <a id="8556" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="8558" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="8563" href="Ledger.Utxo.html#8500" class="Bound">r</a><a id="8564" class="Symbol">)</a>
  <a id="inInterval.lower"></a><a id="8568" href="Ledger.Utxo.html#8568" class="InductiveConstructor">lower</a>  <a id="8575" class="Symbol">:</a> <a id="8577" class="Symbol">∀</a> <a id="8579" class="Symbol">{</a><a id="8580" href="Ledger.Utxo.html#8580" class="Bound">l</a><a id="8581" class="Symbol">}</a>    <a id="8586" class="Symbol">→</a> <a id="8588" href="Ledger.Utxo.html#8580" class="Bound">l</a> <a id="8590" href="Interface.HasOrder.html#301" class="Field Operator">≤</a> <a id="8592" href="Ledger.Utxo.html#8430" class="Bound">slot</a>             <a id="8609" class="Symbol">→</a>  <a id="8612" href="Ledger.Utxo.html#8418" class="Datatype">inInterval</a> <a id="8623" href="Ledger.Utxo.html#8430" class="Bound">slot</a> <a id="8628" class="Symbol">(</a><a id="8629" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="8634" href="Ledger.Utxo.html#8580" class="Bound">l</a>   <a id="8638" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="8640" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a><a id="8647" class="Symbol">)</a>
  <a id="inInterval.upper"></a><a id="8651" href="Ledger.Utxo.html#8651" class="InductiveConstructor">upper</a>  <a id="8658" class="Symbol">:</a> <a id="8660" class="Symbol">∀</a> <a id="8662" class="Symbol">{</a><a id="8663" href="Ledger.Utxo.html#8663" class="Bound">r</a><a id="8664" class="Symbol">}</a>    <a id="8669" class="Symbol">→</a> <a id="8671" href="Ledger.Utxo.html#8430" class="Bound">slot</a> <a id="8676" href="Interface.HasOrder.html#301" class="Field Operator">≤</a> <a id="8678" href="Ledger.Utxo.html#8663" class="Bound">r</a>             <a id="8692" class="Symbol">→</a>  <a id="8695" href="Ledger.Utxo.html#8418" class="Datatype">inInterval</a> <a id="8706" href="Ledger.Utxo.html#8430" class="Bound">slot</a> <a id="8711" class="Symbol">(</a><a id="8712" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a>  <a id="8721" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="8723" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="8728" href="Ledger.Utxo.html#8663" class="Bound">r</a><a id="8729" class="Symbol">)</a>
  <a id="inInterval.none"></a><a id="8733" href="Ledger.Utxo.html#8733" class="InductiveConstructor">none</a>   <a id="8740" class="Symbol">:</a>                                    <a id="8777" href="Ledger.Utxo.html#8418" class="Datatype">inInterval</a> <a id="8788" href="Ledger.Utxo.html#8430" class="Bound">slot</a> <a id="8793" class="Symbol">(</a><a id="8794" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a>  <a id="8803" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="8805" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a><a id="8812" class="Symbol">)</a>
<a id="8814" class="Markup">\end{code}</a><a id="8824" class="Background">
</a><a id="8825" class="Markup">\begin{code}[hide]</a>
<a id="8844" class="Comment">-- Note: inInterval has to be a type definition for inference to work</a>
<a id="8914" class="Keyword">instance</a>
  <a id="Dec-inInterval"></a><a id="8925" href="Ledger.Utxo.html#8925" class="Function">Dec-inInterval</a> <a id="8940" class="Symbol">:</a> <a id="8942" href="Ledger.Utxo.html#8418" class="Datatype">inInterval</a> <a id="8953" href="Class.Decidable.Core.html#773" class="Function Operator">⁇²</a>
  <a id="8958" href="Ledger.Utxo.html#8925" class="Function">Dec-inInterval</a> <a id="8973" class="Symbol">{</a><a id="8974" href="Ledger.Utxo.html#8974" class="Bound">slot</a><a id="8978" class="Symbol">}</a> <a id="8980" class="Symbol">{</a><a id="8981" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="8986" href="Ledger.Utxo.html#8986" class="Bound">x</a>  <a id="8989" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="8991" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="8996" href="Ledger.Utxo.html#8996" class="Bound">y</a> <a id="8998" class="Symbol">}</a> <a id="9000" class="Symbol">.</a><a id="9001" href="Class.Decidable.Core.html#264" class="Field">dec</a> <a id="9005" class="Keyword">with</a> <a id="9010" href="Ledger.Utxo.html#8986" class="Bound">x</a> <a id="9012" href="Interface.HasOrder.html#667" class="Function Operator">≤?</a> <a id="9015" href="Ledger.Utxo.html#8974" class="Bound">slot</a> <a id="9020" class="Symbol">|</a> <a id="9022" href="Ledger.Utxo.html#8974" class="Bound">slot</a> <a id="9027" href="Interface.HasOrder.html#667" class="Function Operator">≤?</a> <a id="9030" href="Ledger.Utxo.html#8996" class="Bound">y</a>
  <a id="9034" class="Symbol">...</a> <a id="9038" class="Symbol">|</a> <a id="9040" href="Relation.Nullary.Decidable.Core.html#1655" class="InductiveConstructor">no</a> <a id="9043" href="Ledger.Utxo.html#9043" class="Bound">¬p₁</a> <a id="9047" class="Symbol">|</a> <a id="9049" class="Symbol">_</a>      <a id="9056" class="Symbol">=</a> <a id="9058" href="Relation.Nullary.Decidable.Core.html#1655" class="InductiveConstructor">no</a> <a id="9061" class="Symbol">λ</a> <a id="9063" class="Keyword">where</a> <a id="9069" class="Symbol">(</a><a id="9070" href="Ledger.Utxo.html#8486" class="InductiveConstructor">both</a> <a id="9075" class="Symbol">(</a><a id="9076" href="Ledger.Utxo.html#9076" class="Bound">h₁</a> <a id="9079" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="9081" href="Ledger.Utxo.html#9081" class="Bound">h₂</a><a id="9083" class="Symbol">))</a> <a id="9086" class="Symbol">→</a> <a id="9088" href="Ledger.Utxo.html#9043" class="Bound">¬p₁</a> <a id="9092" href="Ledger.Utxo.html#9076" class="Bound">h₁</a>
  <a id="9097" class="Symbol">...</a> <a id="9101" class="Symbol">|</a> <a id="9103" href="Relation.Nullary.Decidable.Core.html#1618" class="InductiveConstructor">yes</a> <a id="9107" href="Ledger.Utxo.html#9107" class="Bound">p₁</a> <a id="9110" class="Symbol">|</a> <a id="9112" href="Relation.Nullary.Decidable.Core.html#1655" class="InductiveConstructor">no</a> <a id="9115" href="Ledger.Utxo.html#9115" class="Bound">¬p₂</a> <a id="9119" class="Symbol">=</a> <a id="9121" href="Relation.Nullary.Decidable.Core.html#1655" class="InductiveConstructor">no</a> <a id="9124" class="Symbol">λ</a> <a id="9126" class="Keyword">where</a> <a id="9132" class="Symbol">(</a><a id="9133" href="Ledger.Utxo.html#8486" class="InductiveConstructor">both</a> <a id="9138" class="Symbol">(</a><a id="9139" href="Ledger.Utxo.html#9139" class="Bound">h₁</a> <a id="9142" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="9144" href="Ledger.Utxo.html#9144" class="Bound">h₂</a><a id="9146" class="Symbol">))</a> <a id="9149" class="Symbol">→</a> <a id="9151" href="Ledger.Utxo.html#9115" class="Bound">¬p₂</a> <a id="9155" href="Ledger.Utxo.html#9144" class="Bound">h₂</a>
  <a id="9160" class="Symbol">...</a> <a id="9164" class="Symbol">|</a> <a id="9166" href="Relation.Nullary.Decidable.Core.html#1618" class="InductiveConstructor">yes</a> <a id="9170" href="Ledger.Utxo.html#9170" class="Bound">p₁</a> <a id="9173" class="Symbol">|</a> <a id="9175" href="Relation.Nullary.Decidable.Core.html#1618" class="InductiveConstructor">yes</a> <a id="9179" href="Ledger.Utxo.html#9179" class="Bound">p₂</a> <a id="9182" class="Symbol">=</a> <a id="9184" href="Relation.Nullary.Decidable.Core.html#1618" class="InductiveConstructor">yes</a> <a id="9188" class="Symbol">(</a><a id="9189" href="Ledger.Utxo.html#8486" class="InductiveConstructor">both</a> <a id="9194" class="Symbol">(</a><a id="9195" href="Ledger.Utxo.html#9170" class="Bound">p₁</a> <a id="9198" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="9200" href="Ledger.Utxo.html#9179" class="Bound">p₂</a><a id="9202" class="Symbol">))</a>
  <a id="9207" href="Ledger.Utxo.html#8925" class="Function">Dec-inInterval</a> <a id="9222" class="Symbol">{</a><a id="9223" href="Ledger.Utxo.html#9223" class="Bound">slot</a><a id="9227" class="Symbol">}</a> <a id="9229" class="Symbol">{</a><a id="9230" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="9235" href="Ledger.Utxo.html#9235" class="Bound">x</a>  <a id="9238" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="9240" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a><a id="9247" class="Symbol">}</a> <a id="9249" class="Symbol">.</a><a id="9250" href="Class.Decidable.Core.html#264" class="Field">dec</a> <a id="9254" class="Keyword">with</a> <a id="9259" href="Ledger.Utxo.html#9235" class="Bound">x</a> <a id="9261" href="Interface.HasOrder.html#667" class="Function Operator">≤?</a> <a id="9264" href="Ledger.Utxo.html#9223" class="Bound">slot</a>
  <a id="9271" class="Symbol">...</a> <a id="9275" class="Symbol">|</a> <a id="9277" href="Relation.Nullary.Decidable.Core.html#1655" class="InductiveConstructor">no</a> <a id="9280" href="Ledger.Utxo.html#9280" class="Bound">¬p</a> <a id="9283" class="Symbol">=</a> <a id="9285" href="Relation.Nullary.Decidable.Core.html#1655" class="InductiveConstructor">no</a>  <a id="9289" class="Symbol">(λ</a> <a id="9292" class="Keyword">where</a> <a id="9298" class="Symbol">(</a><a id="9299" href="Ledger.Utxo.html#8568" class="InductiveConstructor">lower</a> <a id="9305" href="Ledger.Utxo.html#9305" class="Bound">h</a><a id="9306" class="Symbol">)</a> <a id="9308" class="Symbol">→</a> <a id="9310" href="Ledger.Utxo.html#9280" class="Bound">¬p</a> <a id="9313" href="Ledger.Utxo.html#9305" class="Bound">h</a><a id="9314" class="Symbol">)</a>
  <a id="9318" class="Symbol">...</a> <a id="9322" class="Symbol">|</a> <a id="9324" href="Relation.Nullary.Decidable.Core.html#1618" class="InductiveConstructor">yes</a> <a id="9328" href="Ledger.Utxo.html#9328" class="Bound">p</a> <a id="9330" class="Symbol">=</a> <a id="9332" href="Relation.Nullary.Decidable.Core.html#1618" class="InductiveConstructor">yes</a> <a id="9336" class="Symbol">(</a><a id="9337" href="Ledger.Utxo.html#8568" class="InductiveConstructor">lower</a> <a id="9343" href="Ledger.Utxo.html#9328" class="Bound">p</a><a id="9344" class="Symbol">)</a>
  <a id="9348" href="Ledger.Utxo.html#8925" class="Function">Dec-inInterval</a> <a id="9363" class="Symbol">{</a><a id="9364" href="Ledger.Utxo.html#9364" class="Bound">slot</a><a id="9368" class="Symbol">}</a> <a id="9370" class="Symbol">{</a><a id="9371" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a> <a id="9379" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="9381" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="9386" href="Ledger.Utxo.html#9386" class="Bound">x</a> <a id="9388" class="Symbol">}</a> <a id="9390" class="Symbol">.</a><a id="9391" href="Class.Decidable.Core.html#264" class="Field">dec</a> <a id="9395" class="Keyword">with</a> <a id="9400" href="Ledger.Utxo.html#9364" class="Bound">slot</a> <a id="9405" href="Interface.HasOrder.html#667" class="Function Operator">≤?</a> <a id="9408" href="Ledger.Utxo.html#9386" class="Bound">x</a>
  <a id="9412" class="Symbol">...</a> <a id="9416" class="Symbol">|</a> <a id="9418" href="Relation.Nullary.Decidable.Core.html#1655" class="InductiveConstructor">no</a> <a id="9421" href="Ledger.Utxo.html#9421" class="Bound">¬p</a> <a id="9424" class="Symbol">=</a> <a id="9426" href="Relation.Nullary.Decidable.Core.html#1655" class="InductiveConstructor">no</a>  <a id="9430" class="Symbol">(λ</a> <a id="9433" class="Keyword">where</a> <a id="9439" class="Symbol">(</a><a id="9440" href="Ledger.Utxo.html#8651" class="InductiveConstructor">upper</a> <a id="9446" href="Ledger.Utxo.html#9446" class="Bound">h</a><a id="9447" class="Symbol">)</a> <a id="9449" class="Symbol">→</a> <a id="9451" href="Ledger.Utxo.html#9421" class="Bound">¬p</a> <a id="9454" href="Ledger.Utxo.html#9446" class="Bound">h</a><a id="9455" class="Symbol">)</a>
  <a id="9459" class="Symbol">...</a> <a id="9463" class="Symbol">|</a> <a id="9465" href="Relation.Nullary.Decidable.Core.html#1618" class="InductiveConstructor">yes</a> <a id="9469" href="Ledger.Utxo.html#9469" class="Bound">p</a> <a id="9471" class="Symbol">=</a> <a id="9473" href="Relation.Nullary.Decidable.Core.html#1618" class="InductiveConstructor">yes</a> <a id="9477" class="Symbol">(</a><a id="9478" href="Ledger.Utxo.html#8651" class="InductiveConstructor">upper</a> <a id="9484" href="Ledger.Utxo.html#9469" class="Bound">p</a><a id="9485" class="Symbol">)</a>
  <a id="9489" href="Ledger.Utxo.html#8925" class="Function">Dec-inInterval</a> <a id="9504" class="Symbol">{</a><a id="9505" href="Ledger.Utxo.html#9505" class="Bound">slot</a><a id="9509" class="Symbol">}</a> <a id="9511" class="Symbol">{</a><a id="9512" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a> <a id="9520" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="9522" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a><a id="9529" class="Symbol">}</a> <a id="9531" class="Symbol">.</a><a id="9532" href="Class.Decidable.Core.html#264" class="Field">dec</a> <a id="9536" class="Symbol">=</a> <a id="9538" href="Relation.Nullary.Decidable.Core.html#1618" class="InductiveConstructor">yes</a> <a id="9542" href="Ledger.Utxo.html#8733" class="InductiveConstructor">none</a>

  <a id="HasCoin-UTxOState"></a><a id="9550" href="Ledger.Utxo.html#9550" class="Function">HasCoin-UTxOState</a> <a id="9568" class="Symbol">:</a> <a id="9570" href="Ledger.Interface.HasCoin.html#124" class="Record">HasCoin</a> <a id="9578" href="Ledger.Utxo.html#5240" class="Record">UTxOState</a>
  <a id="9590" href="Ledger.Utxo.html#9550" class="Function">HasCoin-UTxOState</a> <a id="9608" class="Symbol">.</a><a id="9609" href="Ledger.Interface.HasCoin.html#172" class="Field">getCoin</a> <a id="9617" href="Ledger.Utxo.html#9617" class="Bound">s</a> <a id="9619" class="Symbol">=</a> <a id="9621" href="Ledger.Interface.HasCoin.html#172" class="Field">getCoin</a> <a id="9629" class="Symbol">(</a><a id="9630" href="Ledger.Utxo.html#5354" class="Field">UTxOState.utxo</a> <a id="9645" href="Ledger.Utxo.html#9617" class="Bound">s</a><a id="9646" class="Symbol">)</a>
                               <a id="9679" href="Interface.HasAdd.html#135" class="Field Operator">+</a> <a id="9681" class="Symbol">(</a><a id="9682" href="Ledger.Utxo.html#5376" class="Field">UTxOState.fees</a> <a id="9697" href="Ledger.Utxo.html#9617" class="Bound">s</a><a id="9698" class="Symbol">)</a>
                               <a id="9731" href="Interface.HasAdd.html#135" class="Field Operator">+</a> <a id="9733" href="Ledger.Interface.HasCoin.html#172" class="Field">getCoin</a> <a id="9741" class="Symbol">(</a><a id="9742" href="Ledger.Utxo.html#5398" class="Field">UTxOState.deposits</a> <a id="9761" href="Ledger.Utxo.html#9617" class="Bound">s</a><a id="9762" class="Symbol">)</a>
                               <a id="9795" href="Interface.HasAdd.html#135" class="Field Operator">+</a> <a id="9797" href="Ledger.Utxo.html#5424" class="Field">UTxOState.donations</a> <a id="9817" href="Ledger.Utxo.html#9617" class="Bound">s</a>

<a id="9820" class="Comment">-- Boolean implication</a>
<a id="_=&gt;ᵇ_"></a><a id="9843" href="Ledger.Utxo.html#9843" class="Function Operator">_=&gt;ᵇ_</a> <a id="9849" class="Symbol">:</a> <a id="9851" href="Agda.Builtin.Bool.html#173" class="Datatype">Bool</a> <a id="9856" class="Symbol">→</a> <a id="9858" href="Agda.Builtin.Bool.html#173" class="Datatype">Bool</a> <a id="9863" class="Symbol">→</a> <a id="9865" href="Agda.Builtin.Bool.html#173" class="Datatype">Bool</a>
<a id="9870" href="Ledger.Utxo.html#9870" class="Bound">a</a> <a id="9872" href="Ledger.Utxo.html#9843" class="Function Operator">=&gt;ᵇ</a> <a id="9876" href="Ledger.Utxo.html#9876" class="Bound">b</a> <a id="9878" class="Symbol">=</a> <a id="9880" href="Interface.ToBool.html#287" class="Function Operator">if</a> <a id="9883" href="Ledger.Utxo.html#9870" class="Bound">a</a> <a id="9885" href="Interface.ToBool.html#287" class="Function Operator">then</a> <a id="9890" href="Ledger.Utxo.html#9876" class="Bound">b</a> <a id="9892" href="Interface.ToBool.html#287" class="Function Operator">else</a> <a id="9897" href="Agda.Builtin.Bool.html#198" class="InductiveConstructor">true</a>

<a id="9903" class="Comment">-- Boolean-valued inequalities on natural numbers</a>
<a id="_≤ᵇ_"></a><a id="9953" href="Ledger.Utxo.html#9953" class="Function Operator">_≤ᵇ_</a> <a id="_≥ᵇ_"></a><a id="9958" href="Ledger.Utxo.html#9958" class="Function Operator">_≥ᵇ_</a> <a id="9963" class="Symbol">:</a> <a id="9965" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a> <a id="9967" class="Symbol">→</a> <a id="9969" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a> <a id="9971" class="Symbol">→</a> <a id="9973" href="Agda.Builtin.Bool.html#173" class="Datatype">Bool</a>
<a id="9978" href="Ledger.Utxo.html#9978" class="Bound">m</a> <a id="9980" href="Ledger.Utxo.html#9953" class="Function Operator">≤ᵇ</a> <a id="9983" href="Ledger.Utxo.html#9983" class="Bound">n</a> <a id="9985" class="Symbol">=</a> <a id="9987" href="Class.Decidable.Core.html#513" class="Function Operator">¿</a> <a id="9989" href="Ledger.Utxo.html#9978" class="Bound">m</a> <a id="9991" href="Interface.HasOrder.html#301" class="Field Operator">≤</a> <a id="9993" href="Ledger.Utxo.html#9983" class="Bound">n</a> <a id="9995" href="Class.Decidable.Core.html#513" class="Function Operator">¿ᵇ</a>
<a id="9998" href="Ledger.Utxo.html#9958" class="Function Operator">_≥ᵇ_</a> <a id="10003" class="Symbol">=</a> <a id="10005" href="Function.Base.html#1638" class="Function">flip</a> <a id="10010" href="Ledger.Utxo.html#9953" class="Function Operator">_≤ᵇ_</a>

<a id="≟-∅ᵇ"></a><a id="10016" href="Ledger.Utxo.html#10016" class="Function">≟-∅ᵇ</a> <a id="10021" class="Symbol">:</a> <a id="10023" class="Symbol">{</a><a id="10024" href="Ledger.Utxo.html#10024" class="Bound">A</a> <a id="10026" class="Symbol">:</a> <a id="10028" href="Agda.Primitive.html#388" class="Primitive">Type</a><a id="10032" class="Symbol">}</a> <a id="10034" class="Symbol">⦃</a> <a id="10036" href="Ledger.Utxo.html#10036" class="Bound">_</a> <a id="10038" class="Symbol">:</a> <a id="10040" href="Class.DecEq.Core.html#117" class="Record">DecEq</a> <a id="10046" href="Ledger.Utxo.html#10024" class="Bound">A</a> <a id="10048" class="Symbol">⦄</a> <a id="10050" class="Symbol">→</a> <a id="10052" class="Symbol">(</a><a id="10053" href="Ledger.Utxo.html#10053" class="Bound">X</a> <a id="10055" class="Symbol">:</a> <a id="10057" href="Ledger.Set.Theory.html#382" class="Function Operator">ℙ</a> <a id="10059" href="Ledger.Utxo.html#10024" class="Bound">A</a><a id="10060" class="Symbol">)</a> <a id="10062" class="Symbol">→</a> <a id="10064" href="Agda.Builtin.Bool.html#173" class="Datatype">Bool</a>
<a id="10069" href="Ledger.Utxo.html#10016" class="Function">≟-∅ᵇ</a> <a id="10074" href="Ledger.Utxo.html#10074" class="Bound">X</a> <a id="10076" class="Symbol">=</a> <a id="10078" href="Class.Decidable.Core.html#513" class="Function Operator">¿</a> <a id="10080" href="Ledger.Utxo.html#10074" class="Bound">X</a> <a id="10082" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="10084" href="Interface.HasEmptySet.html#150" class="Field">∅</a> <a id="10086" href="Class.Decidable.Core.html#513" class="Function Operator">¿ᵇ</a>

<a id="coinPolicies"></a><a id="10090" href="Ledger.Utxo.html#10090" class="Function">coinPolicies</a> <a id="10103" class="Symbol">:</a> <a id="10105" href="Ledger.Set.Theory.html#382" class="Function Operator">ℙ</a> <a id="10107" href="Ledger.Crypto.html#1525" class="Function">ScriptHash</a>
<a id="10118" href="Ledger.Utxo.html#10090" class="Function">coinPolicies</a> <a id="10131" class="Symbol">=</a> <a id="10133" href="Ledger.TokenAlgebra.html#1323" class="Function">policies</a> <a id="10142" class="Symbol">(</a><a id="10143" href="Ledger.TokenAlgebra.html#1278" class="Function">inject</a> <a id="10150" class="Number">1</a><a id="10151" class="Symbol">)</a>

<a id="isAdaOnlyᵇ"></a><a id="10154" href="Ledger.Utxo.html#10154" class="Function">isAdaOnlyᵇ</a> <a id="10165" class="Symbol">:</a> <a id="10167" href="Ledger.TokenAlgebra.html#816" class="Function">Value</a> <a id="10173" class="Symbol">→</a> <a id="10175" href="Agda.Builtin.Bool.html#173" class="Datatype">Bool</a>
<a id="10180" href="Ledger.Utxo.html#10154" class="Function">isAdaOnlyᵇ</a> <a id="10191" href="Ledger.Utxo.html#10191" class="Bound">v</a> <a id="10193" class="Symbol">=</a> <a id="10195" href="Interface.ToBool.html#456" class="Function">toBool</a> <a id="10202" class="Symbol">(</a><a id="10203" href="Ledger.TokenAlgebra.html#1323" class="Function">policies</a> <a id="10212" href="Ledger.Utxo.html#10191" class="Bound">v</a> <a id="10214" href="Axiom.Set.html#2413" class="Function Operator">≡ᵉ</a> <a id="10217" href="Ledger.Utxo.html#10090" class="Function">coinPolicies</a><a id="10229" class="Symbol">)</a>

<a id="10232" class="Comment">-- TODO: this could be a regular property</a>
<a id="10274" class="Comment">-- TODO: using this in UTxO rule below</a>
<a id="10313" class="Markup">\end{code}</a><a id="10323" class="Background">
</a><a id="10324" class="Markup">\begin{code}</a>

<a id="feesOK"></a><a id="10338" href="Ledger.Utxo.html#10338" class="Function">feesOK</a> <a id="10345" class="Symbol">:</a> <a id="10347" href="Ledger.PParams.html#2073" class="Record">PParams</a> <a id="10355" class="Symbol">→</a> <a id="10357" href="Ledger.Transaction.html#5258" class="Record">Tx</a> <a id="10360" class="Symbol">→</a> <a id="10362" href="Ledger.Transaction.html#3913" class="Function">UTxO</a> <a id="10367" class="Symbol">→</a> <a id="10369" href="Agda.Builtin.Bool.html#173" class="Datatype">Bool</a>
<a id="10374" href="Ledger.Utxo.html#10338" class="Function">feesOK</a> <a id="10381" href="Ledger.Utxo.html#10381" class="Bound">pp</a> <a id="10384" href="Ledger.Utxo.html#10384" class="Bound">tx</a> <a id="10387" href="Ledger.Utxo.html#10387" class="Bound">utxo</a> <a id="10392" class="Symbol">=</a> <a id="10394" href="Ledger.Utxo.html#6163" class="Function">minfee</a> <a id="10401" href="Ledger.Utxo.html#10381" class="Bound">pp</a> <a id="10404" href="Ledger.Utxo.html#10387" class="Bound">utxo</a> <a id="10409" href="Ledger.Utxo.html#10384" class="Bound">tx</a> <a id="10412" href="Ledger.Utxo.html#9953" class="Function Operator">≤ᵇ</a> <a id="10415" href="Ledger.Transaction.html#4341" class="Function">txfee</a>
                  <a id="10439" href="Data.Bool.Base.html#995" class="Function Operator">∧</a> <a id="10441" href="Data.Bool.Base.html#941" class="Function">not</a> <a id="10445" class="Symbol">(</a><a id="10446" href="Ledger.Utxo.html#10016" class="Function">≟-∅ᵇ</a> <a id="10451" class="Symbol">(</a><a id="10452" href="Ledger.Transaction.html#5137" class="Function">txrdmrs</a> <a id="10460" href="Axiom.Set.Map.html#2282" class="Function Operator">ˢ</a><a id="10461" class="Symbol">))</a>
                  <a id="10482" href="Ledger.Utxo.html#9843" class="Function Operator">=&gt;ᵇ</a> <a id="10486" class="Symbol">(</a> <a id="10488" href="Axiom.Set.html#10778" class="Function">allᵇ</a> <a id="10493" class="Symbol">(λ</a> <a id="10496" class="Symbol">(</a><a id="10497" href="Ledger.Utxo.html#10497" class="Bound">addr</a> <a id="10502" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="10504" class="Symbol">_)</a> <a id="10507" class="Symbol">→</a> <a id="10509" href="Class.Decidable.Core.html#461" class="Function Operator">¿</a> <a id="10511" href="Ledger.Address.html#2407" class="Function">isVKeyAddr</a> <a id="10522" href="Ledger.Utxo.html#10497" class="Bound">addr</a> <a id="10527" href="Class.Decidable.Core.html#461" class="Function Operator">¿</a><a id="10528" class="Symbol">)</a> <a id="10530" href="Ledger.Utxo.html#10819" class="Function">collateralRange</a>
                      <a id="10568" href="Data.Bool.Base.html#995" class="Function Operator">∧</a> <a id="10570" href="Ledger.Utxo.html#10154" class="Function">isAdaOnlyᵇ</a> <a id="10581" href="Ledger.Utxo.html#10893" class="Function">bal</a>
                      <a id="10607" href="Data.Bool.Base.html#995" class="Function Operator">∧</a> <a id="10609" class="Symbol">(</a><a id="10610" href="Ledger.TokenAlgebra.html#1233" class="Function">coin</a> <a id="10615" href="Ledger.Utxo.html#10893" class="Function">bal</a> <a id="10619" href="Agda.Builtin.Nat.html#539" class="Primitive Operator">*</a> <a id="10621" class="Number">100</a><a id="10624" class="Symbol">)</a> <a id="10626" href="Ledger.Utxo.html#9958" class="Function Operator">≥ᵇ</a> <a id="10629" class="Symbol">(</a><a id="10630" href="Ledger.Transaction.html#4341" class="Function">txfee</a> <a id="10636" href="Agda.Builtin.Nat.html#539" class="Primitive Operator">*</a> <a id="10638" href="Ledger.Utxo.html#10381" class="Bound">pp</a> <a id="10641" class="Symbol">.</a><a id="10642" href="Ledger.PParams.html#3225" class="Field">collateralPercentage</a><a id="10662" class="Symbol">)</a>
                      <a id="10686" href="Data.Bool.Base.html#995" class="Function Operator">∧</a> <a id="10688" href="Data.Bool.Base.html#941" class="Function">not</a> <a id="10692" class="Symbol">(</a><a id="10693" href="Ledger.Utxo.html#10016" class="Function">≟-∅ᵇ</a> <a id="10698" href="Ledger.Transaction.html#4807" class="Function">collateral</a><a id="10708" class="Symbol">)</a>
                      <a id="10732" class="Symbol">)</a>
  <a id="10736" class="Keyword">where</a>
    <a id="10746" class="Keyword">open</a> <a id="10751" href="Ledger.Transaction.html#5258" class="Module">Tx</a> <a id="10754" href="Ledger.Utxo.html#10384" class="Bound">tx</a><a id="10756" class="Symbol">;</a> <a id="10758" class="Keyword">open</a> <a id="10763" href="Ledger.Transaction.html#4157" class="Module">TxBody</a> <a id="10770" href="Ledger.Transaction.html#5344" class="Function">body</a><a id="10774" class="Symbol">;</a> <a id="10776" class="Keyword">open</a> <a id="10781" href="Ledger.Transaction.html#4954" class="Module">TxWitnesses</a> <a id="10793" href="Ledger.Transaction.html#5368" class="Function">wits</a><a id="10797" class="Symbol">;</a> <a id="10799" class="Keyword">open</a> <a id="10804" href="Ledger.PParams.html#2073" class="Module">PParams</a> <a id="10812" href="Ledger.Utxo.html#10381" class="Bound">pp</a>
    <a id="10819" href="Ledger.Utxo.html#10819" class="Function">collateralRange</a>  <a id="10836" class="Symbol">=</a> <a id="10838" href="Interface.IsSet.html#977" class="Function">range</a>    <a id="10847" class="Symbol">((</a><a id="10849" href="Axiom.Set.Map.html#6138" class="Function">mapValues</a> <a id="10859" href="Ledger.Transaction.html#5781" class="Function">txOutHash</a> <a id="10869" href="Ledger.Utxo.html#10387" class="Bound">utxo</a><a id="10873" class="Symbol">)</a> <a id="10875" href="Axiom.Set.Map.html#10107" class="Function Operator">∣</a> <a id="10877" href="Ledger.Transaction.html#4807" class="Function">collateral</a><a id="10887" class="Symbol">)</a>
    <a id="10893" href="Ledger.Utxo.html#10893" class="Function">bal</a>              <a id="10910" class="Symbol">=</a> <a id="10912" href="Ledger.Utxo.html#5972" class="Function">balance</a>  <a id="10921" class="Symbol">(</a><a id="10922" href="Ledger.Utxo.html#10387" class="Bound">utxo</a> <a id="10927" href="Axiom.Set.Map.html#10107" class="Function Operator">∣</a> <a id="10929" href="Ledger.Transaction.html#4807" class="Function">collateral</a><a id="10939" class="Symbol">)</a>
<a id="10941" class="Markup">\end{code}</a><a id="10951" class="Background">
\end{AgdaMultiCode}
\caption{Functions used in UTxO rules, continued}
\label{fig:functions:utxo2}
\end{figure*}
\end{NoConway}

\begin{figure*}
</a><a id="11096" class="Markup">\begin{code}[hide]</a>
<a id="11115" class="Keyword">module</a> <a id="11122" href="Ledger.Utxo.html#11122" class="Module">_</a> <a id="11124" class="Symbol">(</a><a id="11125" class="Keyword">let</a> <a id="11129" class="Keyword">open</a> <a id="11134" href="Ledger.Utxo.html#5240" class="Module">UTxOState</a><a id="11143" class="Symbol">;</a> <a id="11145" class="Keyword">open</a> <a id="11150" href="Ledger.Transaction.html#4157" class="Module">TxBody</a><a id="11156" class="Symbol">)</a> <a id="11158" class="Keyword">where</a>
<a id="11164" class="Markup">\end{code}</a><a id="11174" class="Background">
</a><a id="11175" class="Markup">\begin{code}</a>
  <a id="11190" href="Ledger.Utxo.html#11190" class="Function">depositRefunds</a> <a id="11205" class="Symbol">:</a> <a id="11207" href="Ledger.PParams.html#2073" class="Record">PParams</a> <a id="11215" class="Symbol">→</a> <a id="11217" href="Ledger.Utxo.html#5240" class="Record">UTxOState</a> <a id="11227" class="Symbol">→</a> <a id="11229" href="Ledger.Transaction.html#4157" class="Record">TxBody</a> <a id="11236" class="Symbol">→</a> <a id="11238" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a>
  <a id="11245" href="Ledger.Utxo.html#11190" class="Function">depositRefunds</a> <a id="11260" href="Ledger.Utxo.html#11260" class="Bound">pp</a> <a id="11263" href="Ledger.Utxo.html#11263" class="Bound">st</a> <a id="11266" href="Ledger.Utxo.html#11266" class="Bound">txb</a> <a id="11270" class="Symbol">=</a> <a id="11272" href="Data.Integer.Ext.html#440" class="Function">negPart</a> <a id="11280" class="Symbol">(</a><a id="11281" href="Ledger.Utxo.html#8089" class="Function">depositsChange</a> <a id="11296" href="Ledger.Utxo.html#11260" class="Bound">pp</a> <a id="11299" href="Ledger.Utxo.html#11266" class="Bound">txb</a> <a id="11303" class="Symbol">(</a><a id="11304" href="Ledger.Utxo.html#11263" class="Bound">st</a> <a id="11307" class="Symbol">.</a><a id="11308" href="Ledger.Utxo.html#5398" class="Field">deposits</a><a id="11316" class="Symbol">))</a>

  <a id="11322" href="Ledger.Utxo.html#11322" class="Function">newDeposits</a> <a id="11334" class="Symbol">:</a> <a id="11336" href="Ledger.PParams.html#2073" class="Record">PParams</a> <a id="11344" class="Symbol">→</a> <a id="11346" href="Ledger.Utxo.html#5240" class="Record">UTxOState</a> <a id="11356" class="Symbol">→</a> <a id="11358" href="Ledger.Transaction.html#4157" class="Record">TxBody</a> <a id="11365" class="Symbol">→</a> <a id="11367" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a>
  <a id="11374" href="Ledger.Utxo.html#11322" class="Function">newDeposits</a> <a id="11386" href="Ledger.Utxo.html#11386" class="Bound">pp</a> <a id="11389" href="Ledger.Utxo.html#11389" class="Bound">st</a> <a id="11392" href="Ledger.Utxo.html#11392" class="Bound">txb</a> <a id="11396" class="Symbol">=</a> <a id="11398" href="Data.Integer.Ext.html#349" class="Function">posPart</a> <a id="11406" class="Symbol">(</a><a id="11407" href="Ledger.Utxo.html#8089" class="Function">depositsChange</a> <a id="11422" href="Ledger.Utxo.html#11386" class="Bound">pp</a> <a id="11425" href="Ledger.Utxo.html#11392" class="Bound">txb</a> <a id="11429" class="Symbol">(</a><a id="11430" href="Ledger.Utxo.html#11389" class="Bound">st</a> <a id="11433" class="Symbol">.</a><a id="11434" href="Ledger.Utxo.html#5398" class="Field">deposits</a><a id="11442" class="Symbol">))</a>

  <a id="11448" href="Ledger.Utxo.html#11448" class="Function">consumed</a> <a id="11457" class="Symbol">:</a> <a id="11459" href="Ledger.PParams.html#2073" class="Record">PParams</a> <a id="11467" class="Symbol">→</a> <a id="11469" href="Ledger.Utxo.html#5240" class="Record">UTxOState</a> <a id="11479" class="Symbol">→</a> <a id="11481" href="Ledger.Transaction.html#4157" class="Record">TxBody</a> <a id="11488" class="Symbol">→</a> <a id="11490" href="Ledger.TokenAlgebra.html#816" class="Function">Value</a>
  <a id="11498" href="Ledger.Utxo.html#11448" class="Function">consumed</a> <a id="11507" href="Ledger.Utxo.html#11507" class="Bound">pp</a> <a id="11510" href="Ledger.Utxo.html#11510" class="Bound">st</a> <a id="11513" href="Ledger.Utxo.html#11513" class="Bound">txb</a>
    <a id="11521" class="Symbol">=</a>  <a id="11524" href="Ledger.Utxo.html#5972" class="Function">balance</a> <a id="11532" class="Symbol">(</a><a id="11533" href="Ledger.Utxo.html#11510" class="Bound">st</a> <a id="11536" class="Symbol">.</a><a id="11537" href="Ledger.Utxo.html#5354" class="Field">utxo</a> <a id="11542" href="Axiom.Set.Map.html#10107" class="Function Operator">∣</a> <a id="11544" href="Ledger.Utxo.html#11513" class="Bound">txb</a> <a id="11548" class="Symbol">.</a><a id="11549" href="Ledger.Transaction.html#4247" class="Field">txins</a><a id="11554" class="Symbol">)</a>
    <a id="11560" href="Interface.HasAdd.html#135" class="Field Operator">+</a>  <a id="11563" href="Ledger.Utxo.html#11513" class="Bound">txb</a> <a id="11567" class="Symbol">.</a><a id="11568" href="Ledger.Transaction.html#4369" class="Field">mint</a>
    <a id="11577" href="Interface.HasAdd.html#135" class="Field Operator">+</a>  <a id="11580" href="Ledger.TokenAlgebra.html#1278" class="Function">inject</a> <a id="11587" class="Symbol">(</a><a id="11588" href="Ledger.Utxo.html#11190" class="Function">depositRefunds</a> <a id="11603" href="Ledger.Utxo.html#11507" class="Bound">pp</a> <a id="11606" href="Ledger.Utxo.html#11510" class="Bound">st</a> <a id="11609" href="Ledger.Utxo.html#11513" class="Bound">txb</a><a id="11612" class="Symbol">)</a>

  <a id="11617" href="Ledger.Utxo.html#11617" class="Function">produced</a> <a id="11626" class="Symbol">:</a> <a id="11628" href="Ledger.PParams.html#2073" class="Record">PParams</a> <a id="11636" class="Symbol">→</a> <a id="11638" href="Ledger.Utxo.html#5240" class="Record">UTxOState</a> <a id="11648" class="Symbol">→</a> <a id="11650" href="Ledger.Transaction.html#4157" class="Record">TxBody</a> <a id="11657" class="Symbol">→</a> <a id="11659" href="Ledger.TokenAlgebra.html#816" class="Function">Value</a>
  <a id="11667" href="Ledger.Utxo.html#11617" class="Function">produced</a> <a id="11676" href="Ledger.Utxo.html#11676" class="Bound">pp</a> <a id="11679" href="Ledger.Utxo.html#11679" class="Bound">st</a> <a id="11682" href="Ledger.Utxo.html#11682" class="Bound">txb</a>
    <a id="11690" class="Symbol">=</a>  <a id="11693" href="Ledger.Utxo.html#5972" class="Function">balance</a> <a id="11701" class="Symbol">(</a><a id="11702" href="Ledger.Utxo.html#5901" class="Function">outs</a> <a id="11707" href="Ledger.Utxo.html#11682" class="Bound">txb</a><a id="11710" class="Symbol">)</a>
    <a id="11716" href="Interface.HasAdd.html#135" class="Field Operator">+</a>  <a id="11719" href="Ledger.TokenAlgebra.html#1278" class="Function">inject</a> <a id="11726" class="Symbol">(</a><a id="11727" href="Ledger.Utxo.html#11682" class="Bound">txb</a> <a id="11731" class="Symbol">.</a><a id="11732" href="Ledger.Transaction.html#4341" class="Field">txfee</a><a id="11737" class="Symbol">)</a>
    <a id="11743" href="Interface.HasAdd.html#135" class="Field Operator">+</a>  <a id="11746" href="Ledger.TokenAlgebra.html#1278" class="Function">inject</a> <a id="11753" class="Symbol">(</a><a id="11754" href="Ledger.Utxo.html#11322" class="Function">newDeposits</a> <a id="11766" href="Ledger.Utxo.html#11676" class="Bound">pp</a> <a id="11769" href="Ledger.Utxo.html#11679" class="Bound">st</a> <a id="11772" href="Ledger.Utxo.html#11682" class="Bound">txb</a><a id="11775" class="Symbol">)</a>
    <a id="11781" href="Interface.HasAdd.html#135" class="Field Operator">+</a>  <a id="11784" href="Ledger.TokenAlgebra.html#1278" class="Function">inject</a> <a id="11791" class="Symbol">(</a><a id="11792" href="Ledger.Utxo.html#11682" class="Bound">txb</a> <a id="11796" class="Symbol">.</a><a id="11797" href="Ledger.Transaction.html#4583" class="Field">txdonation</a><a id="11807" class="Symbol">)</a>
<a id="11809" class="Markup">\end{code}</a><a id="11819" class="Background">
\caption{Functions used in UTxO rules, continued}
\label{fig:functions:utxo-conway}
\end{figure*}

As seen in Figures~\ref{fig:functions:utxo} and~\ref{fig:functions:utxo-conway},
we redefine \depositRefunds and \newDeposits via \depositsChange,
which computes the difference between the total deposits before and
after their application. This simplifies their definitions and some
correctness proofs. We then add the absolute value of \depositsChange
to \consumed or \produced depending on its sign. This is done via
\negPart and \posPart, which satisfy the key property that their
difference is the identity function.

</a><a id="12441" class="Markup">\begin{code}[hide]</a>
<a id="12460" class="Keyword">open</a> <a id="12465" href="Ledger.PParams.html#2073" class="Module">PParams</a>
<a id="12473" class="Keyword">data</a>
  <a id="_⊢_⇀⦇_,UTXOS⦈_"></a><a id="12480" href="Ledger.Utxo.html#12480" class="Datatype Operator">_⊢_⇀⦇_,UTXOS⦈_</a> <a id="12495" class="Symbol">:</a> <a id="12497" href="Ledger.Utxo.html#5026" class="Record">UTxOEnv</a> <a id="12505" class="Symbol">→</a> <a id="12507" href="Ledger.Utxo.html#5240" class="Record">UTxOState</a> <a id="12517" class="Symbol">→</a> <a id="12519" href="Ledger.Transaction.html#5258" class="Record">Tx</a> <a id="12522" class="Symbol">→</a> <a id="12524" href="Ledger.Utxo.html#5240" class="Record">UTxOState</a> <a id="12534" class="Symbol">→</a> <a id="12536" href="Agda.Primitive.html#388" class="Primitive">Type</a>

<a id="12542" class="Keyword">data</a> <a id="12547" href="Ledger.Utxo.html#12480" class="Datatype Operator">_⊢_⇀⦇_,UTXOS⦈_</a> <a id="12562" class="Keyword">where</a>
  <a id="_⊢_⇀⦇_,UTXOS⦈_.Scripts-Yes"></a><a id="12570" href="Ledger.Utxo.html#12570" class="InductiveConstructor">Scripts-Yes</a> <a id="12582" class="Symbol">:</a>
    <a id="12588" class="Symbol">∀</a> <a id="12590" class="Symbol">{</a><a id="12591" href="Ledger.Utxo.html#12591" class="Bound">Γ</a><a id="12592" class="Symbol">}</a> <a id="12594" class="Symbol">{</a><a id="12595" href="Ledger.Utxo.html#12595" class="Bound">s</a><a id="12596" class="Symbol">}</a> <a id="12598" class="Symbol">{</a><a id="12599" href="Ledger.Utxo.html#12599" class="Bound">tx</a><a id="12601" class="Symbol">}</a>
    <a id="12607" class="Symbol">→</a> <a id="12609" class="Keyword">let</a> <a id="12613" class="Keyword">open</a> <a id="12618" href="Ledger.Transaction.html#5258" class="Module">Tx</a> <a id="12621" href="Ledger.Utxo.html#12599" class="Bound">tx</a> <a id="12624" class="Keyword">renaming</a> <a id="12633" class="Symbol">(</a><a id="12634" href="Ledger.Transaction.html#5344" class="Field">body</a> <a id="12639" class="Symbol">to</a> <a id="12642" class="Field">txb</a><a id="12645" class="Symbol">);</a> <a id="12648" class="Keyword">open</a> <a id="12653" href="Ledger.Transaction.html#4157" class="Module">TxBody</a> <a id="12660" href="Ledger.Utxo.html#12642" class="Field">txb</a>
          <a id="12674" class="Keyword">open</a> <a id="12679" href="Ledger.Utxo.html#5026" class="Module">UTxOEnv</a> <a id="12687" href="Ledger.Utxo.html#12591" class="Bound">Γ</a> <a id="12689" class="Keyword">renaming</a> <a id="12698" class="Symbol">(</a><a id="12699" href="Ledger.Utxo.html#5134" class="Field">pparams</a> <a id="12707" class="Symbol">to</a> <a id="12710" class="Field">pp</a><a id="12712" class="Symbol">)</a>
          <a id="12724" class="Keyword">open</a> <a id="12729" href="Ledger.Utxo.html#5240" class="Module">UTxOState</a> <a id="12739" href="Ledger.Utxo.html#12595" class="Bound">s</a>
          <a id="12751" href="Ledger.Utxo.html#12751" class="Bound">sLst</a> <a id="12756" class="Symbol">=</a> <a id="12758" href="Ledger.ScriptValidation.html#5563" class="Function">collectPhaseTwoScriptInputs</a> <a id="12786" href="Ledger.Utxo.html#12710" class="Function">pp</a> <a id="12789" href="Ledger.Utxo.html#12599" class="Bound">tx</a> <a id="12792" href="Ledger.Utxo.html#5354" class="Function">utxo</a>
      <a id="12803" class="Keyword">in</a>
        <a id="12814" href="Interface.STS.html#105" class="Function Operator">∙</a> <a id="12816" href="Ledger.ScriptValidation.html#5951" class="Function">evalScripts</a> <a id="12828" href="Ledger.Utxo.html#12599" class="Bound">tx</a> <a id="12831" href="Ledger.Utxo.html#12751" class="Bound">sLst</a> <a id="12836" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="12838" href="Ledger.Transaction.html#5397" class="Field">isValid</a>
        <a id="12854" href="Interface.STS.html#131" class="Function Operator">∙</a> <a id="12856" href="Ledger.Transaction.html#5397" class="Field">isValid</a> <a id="12864" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="12866" href="Agda.Builtin.Bool.html#198" class="InductiveConstructor">true</a>
          <a id="12881" href="Interface.STS.html#350" class="Function Operator">────────────────────────────────</a>
          <a id="12924" href="Ledger.Utxo.html#12591" class="Bound">Γ</a> <a id="12926" href="Ledger.Utxo.html#12480" class="Datatype Operator">⊢</a> <a id="12928" href="Ledger.Utxo.html#12595" class="Bound">s</a> <a id="12930" href="Ledger.Utxo.html#12480" class="Datatype Operator">⇀⦇</a> <a id="12933" href="Ledger.Utxo.html#12599" class="Bound">tx</a> <a id="12936" href="Ledger.Utxo.html#12480" class="Datatype Operator">,UTXOS⦈</a>  <a id="12945" href="Ledger.Utxo.html#5307" class="InductiveConstructor Operator">⟦</a> <a id="12947" class="Symbol">(</a><a id="12948" href="Ledger.Utxo.html#5354" class="Function">utxo</a> <a id="12953" href="Axiom.Set.Map.html#10177" class="Function Operator">∣</a> <a id="12955" href="Ledger.Transaction.html#4247" class="Function">txins</a> <a id="12961" href="Axiom.Set.Map.html#10177" class="Function Operator">ᶜ</a><a id="12962" class="Symbol">)</a> <a id="12964" href="Axiom.Set.Map.html#6390" class="Function Operator">∪ˡ</a> <a id="12967" class="Symbol">(</a><a id="12968" href="Ledger.Utxo.html#5901" class="Function">outs</a> <a id="12973" href="Ledger.Utxo.html#12642" class="Field">txb</a><a id="12976" class="Symbol">)</a>
                              <a id="13008" href="Ledger.Utxo.html#5307" class="InductiveConstructor Operator">,</a> <a id="13010" href="Ledger.Utxo.html#5376" class="Function">fees</a> <a id="13015" href="Interface.HasAdd.html#135" class="Field Operator">+</a> <a id="13017" href="Ledger.Transaction.html#4341" class="Function">txfee</a>
                              <a id="13053" href="Ledger.Utxo.html#5307" class="InductiveConstructor Operator">,</a> <a id="13055" href="Ledger.Utxo.html#7619" class="Function">updateDeposits</a> <a id="13070" href="Ledger.Utxo.html#12710" class="Function">pp</a> <a id="13073" href="Ledger.Utxo.html#12642" class="Field">txb</a> <a id="13077" href="Ledger.Utxo.html#5398" class="Function">deposits</a>
                              <a id="13116" href="Ledger.Utxo.html#5307" class="InductiveConstructor Operator">,</a> <a id="13118" href="Ledger.Utxo.html#5424" class="Function">donations</a> <a id="13128" href="Interface.HasAdd.html#135" class="Field Operator">+</a> <a id="13130" href="Ledger.Transaction.html#4583" class="Function">txdonation</a>
                              <a id="13171" href="Ledger.Utxo.html#5307" class="InductiveConstructor Operator">⟧ᵘ</a>

  <a id="_⊢_⇀⦇_,UTXOS⦈_.Scripts-No"></a><a id="13177" href="Ledger.Utxo.html#13177" class="InductiveConstructor">Scripts-No</a> <a id="13188" class="Symbol">:</a>
    <a id="13194" class="Symbol">∀</a> <a id="13196" class="Symbol">{</a><a id="13197" href="Ledger.Utxo.html#13197" class="Bound">Γ</a><a id="13198" class="Symbol">}</a> <a id="13200" class="Symbol">{</a><a id="13201" href="Ledger.Utxo.html#13201" class="Bound">s</a><a id="13202" class="Symbol">}</a> <a id="13204" class="Symbol">{</a><a id="13205" href="Ledger.Utxo.html#13205" class="Bound">tx</a><a id="13207" class="Symbol">}</a>
    <a id="13213" class="Symbol">→</a> <a id="13215" class="Keyword">let</a> <a id="13219" class="Keyword">open</a> <a id="13224" href="Ledger.Transaction.html#5258" class="Module">Tx</a> <a id="13227" href="Ledger.Utxo.html#13205" class="Bound">tx</a> <a id="13230" class="Keyword">renaming</a> <a id="13239" class="Symbol">(</a><a id="13240" href="Ledger.Transaction.html#5344" class="Field">body</a> <a id="13245" class="Symbol">to</a> <a id="13248" class="Field">txb</a><a id="13251" class="Symbol">);</a> <a id="13254" class="Keyword">open</a> <a id="13259" href="Ledger.Transaction.html#4157" class="Module">TxBody</a> <a id="13266" href="Ledger.Utxo.html#13248" class="Field">txb</a>
          <a id="13280" class="Keyword">open</a> <a id="13285" href="Ledger.Utxo.html#5026" class="Module">UTxOEnv</a> <a id="13293" href="Ledger.Utxo.html#13197" class="Bound">Γ</a> <a id="13295" class="Keyword">renaming</a> <a id="13304" class="Symbol">(</a><a id="13305" href="Ledger.Utxo.html#5134" class="Field">pparams</a> <a id="13313" class="Symbol">to</a> <a id="13316" class="Field">pp</a><a id="13318" class="Symbol">)</a>
          <a id="13330" class="Keyword">open</a> <a id="13335" href="Ledger.Utxo.html#5240" class="Module">UTxOState</a> <a id="13345" href="Ledger.Utxo.html#13201" class="Bound">s</a>
          <a id="13357" href="Ledger.Utxo.html#13357" class="Bound">sLst</a> <a id="13362" class="Symbol">=</a> <a id="13364" href="Ledger.ScriptValidation.html#5563" class="Function">collectPhaseTwoScriptInputs</a> <a id="13392" href="Ledger.Utxo.html#13316" class="Function">pp</a> <a id="13395" href="Ledger.Utxo.html#13205" class="Bound">tx</a> <a id="13398" href="Ledger.Utxo.html#5354" class="Function">utxo</a>
      <a id="13409" class="Keyword">in</a>
        <a id="13420" href="Interface.STS.html#105" class="Function Operator">∙</a> <a id="13422" href="Ledger.ScriptValidation.html#5951" class="Function">evalScripts</a> <a id="13434" href="Ledger.Utxo.html#13205" class="Bound">tx</a> <a id="13437" href="Ledger.Utxo.html#13357" class="Bound">sLst</a> <a id="13442" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="13444" href="Ledger.Transaction.html#5397" class="Field">isValid</a>
        <a id="13460" href="Interface.STS.html#131" class="Function Operator">∙</a> <a id="13462" href="Ledger.Transaction.html#5397" class="Field">isValid</a> <a id="13470" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="13472" href="Agda.Builtin.Bool.html#192" class="InductiveConstructor">false</a>
          <a id="13488" href="Interface.STS.html#350" class="Function Operator">────────────────────────────────</a>
          <a id="13531" href="Ledger.Utxo.html#13197" class="Bound">Γ</a> <a id="13533" href="Ledger.Utxo.html#12480" class="Datatype Operator">⊢</a> <a id="13535" href="Ledger.Utxo.html#13201" class="Bound">s</a> <a id="13537" href="Ledger.Utxo.html#12480" class="Datatype Operator">⇀⦇</a> <a id="13540" href="Ledger.Utxo.html#13205" class="Bound">tx</a> <a id="13543" href="Ledger.Utxo.html#12480" class="Datatype Operator">,UTXOS⦈</a>  <a id="13552" href="Ledger.Utxo.html#5307" class="InductiveConstructor Operator">⟦</a> <a id="13554" href="Ledger.Utxo.html#5354" class="Function">utxo</a> <a id="13559" href="Axiom.Set.Map.html#10177" class="Function Operator">∣</a> <a id="13561" href="Ledger.Transaction.html#4807" class="Function">collateral</a> <a id="13572" href="Axiom.Set.Map.html#10177" class="Function Operator">ᶜ</a>
                              <a id="13604" href="Ledger.Utxo.html#5307" class="InductiveConstructor Operator">,</a> <a id="13606" href="Ledger.Utxo.html#5376" class="Function">fees</a> <a id="13611" href="Interface.HasAdd.html#135" class="Field Operator">+</a> <a id="13613" href="Ledger.Utxo.html#6061" class="Function">cbalance</a> <a id="13622" class="Symbol">(</a><a id="13623" href="Ledger.Utxo.html#5354" class="Function">utxo</a> <a id="13628" href="Axiom.Set.Map.html#10107" class="Function Operator">∣</a> <a id="13630" href="Ledger.Transaction.html#4807" class="Function">collateral</a><a id="13640" class="Symbol">)</a>
                              <a id="13672" href="Ledger.Utxo.html#5307" class="InductiveConstructor Operator">,</a> <a id="13674" href="Ledger.Utxo.html#5398" class="Function">deposits</a>
                              <a id="13713" href="Ledger.Utxo.html#5307" class="InductiveConstructor Operator">,</a> <a id="13715" href="Ledger.Utxo.html#5424" class="Function">donations</a>
                              <a id="13755" href="Ledger.Utxo.html#5307" class="InductiveConstructor Operator">⟧ᵘ</a>

<a id="13759" class="Keyword">unquoteDecl</a> <a id="Scripts-Yes-premises"></a><a id="13771" href="Ledger.Utxo.html#13771" class="Function">Scripts-Yes-premises</a> <a id="13792" class="Symbol">=</a> <a id="13794" href="Tactic.Premises.html#1543" class="Function">genPremises</a> <a id="13806" href="Ledger.Utxo.html#13771" class="Function">Scripts-Yes-premises</a> <a id="13827" class="Symbol">(</a><a id="13828" class="Keyword">quote</a> <a id="13834" href="Ledger.Utxo.html#12570" class="InductiveConstructor">Scripts-Yes</a><a id="13845" class="Symbol">)</a>
<a id="13847" class="Keyword">unquoteDecl</a> <a id="Scripts-No-premises"></a><a id="13859" href="Ledger.Utxo.html#13859" class="Function">Scripts-No-premises</a>  <a id="13880" class="Symbol">=</a> <a id="13882" href="Tactic.Premises.html#1543" class="Function">genPremises</a> <a id="13894" href="Ledger.Utxo.html#13859" class="Function">Scripts-No-premises</a>  <a id="13915" class="Symbol">(</a><a id="13916" class="Keyword">quote</a> <a id="13922" href="Ledger.Utxo.html#13177" class="InductiveConstructor">Scripts-No</a><a id="13932" class="Symbol">)</a>

<a id="13935" class="Keyword">private</a> <a id="13943" class="Keyword">variable</a>
  <a id="13954" href="Ledger.Utxo.html#13954" class="Generalizable">Γ</a> <a id="13956" class="Symbol">:</a> <a id="13958" href="Ledger.Utxo.html#5026" class="Record">UTxOEnv</a>
  <a id="13968" href="Ledger.Utxo.html#13968" class="Generalizable">s</a> <a id="13970" href="Ledger.Utxo.html#13970" class="Generalizable">s&#39;</a> <a id="13973" class="Symbol">:</a> <a id="13975" href="Ledger.Utxo.html#5240" class="Record">UTxOState</a>
  <a id="13987" href="Ledger.Utxo.html#13987" class="Generalizable">tx</a> <a id="13990" class="Symbol">:</a> <a id="13992" href="Ledger.Transaction.html#5258" class="Record">Tx</a>

<a id="13996" class="Keyword">data</a> <a id="_≡?_"></a><a id="14001" href="Ledger.Utxo.html#14001" class="Datatype Operator">_≡?_</a> <a id="14006" class="Symbol">{</a><a id="14007" href="Ledger.Utxo.html#14007" class="Bound">A</a> <a id="14009" class="Symbol">:</a> <a id="14011" href="Agda.Primitive.html#388" class="Primitive">Type</a><a id="14015" class="Symbol">}</a> <a id="14017" class="Symbol">:</a> <a id="14019" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="14025" href="Ledger.Utxo.html#14007" class="Bound">A</a> <a id="14027" class="Symbol">→</a> <a id="14029" href="Ledger.Utxo.html#14007" class="Bound">A</a> <a id="14031" class="Symbol">→</a> <a id="14033" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="14038" class="Keyword">where</a>
  <a id="_≡?_.≡?-nothing"></a><a id="14046" href="Ledger.Utxo.html#14046" class="InductiveConstructor">≡?-nothing</a> <a id="14057" class="Symbol">:</a> <a id="14059" class="Symbol">∀</a> <a id="14061" class="Symbol">{</a><a id="14062" href="Ledger.Utxo.html#14062" class="Bound">x</a> <a id="14064" class="Symbol">:</a> <a id="14066" href="Ledger.Utxo.html#14007" class="Bound">A</a><a id="14067" class="Symbol">}</a> <a id="14069" class="Symbol">→</a> <a id="14071" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a>  <a id="14080" href="Ledger.Utxo.html#14001" class="Datatype Operator">≡?</a> <a id="14083" href="Ledger.Utxo.html#14062" class="Bound">x</a>
  <a id="_≡?_.≡?-just"></a><a id="14087" href="Ledger.Utxo.html#14087" class="InductiveConstructor">≡?-just</a>    <a id="14098" class="Symbol">:</a> <a id="14100" class="Symbol">∀</a> <a id="14102" class="Symbol">{</a><a id="14103" href="Ledger.Utxo.html#14103" class="Bound">x</a> <a id="14105" class="Symbol">:</a> <a id="14107" href="Ledger.Utxo.html#14007" class="Bound">A</a><a id="14108" class="Symbol">}</a> <a id="14110" class="Symbol">→</a> <a id="14112" class="Symbol">(</a><a id="14113" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="14118" href="Ledger.Utxo.html#14103" class="Bound">x</a><a id="14119" class="Symbol">)</a> <a id="14121" href="Ledger.Utxo.html#14001" class="Datatype Operator">≡?</a> <a id="14124" href="Ledger.Utxo.html#14103" class="Bound">x</a>

<a id="14127" class="Keyword">instance</a>
  <a id="≟?"></a><a id="14138" href="Ledger.Utxo.html#14138" class="Function">≟?</a> <a id="14141" class="Symbol">:</a> <a id="14143" class="Symbol">{</a><a id="14144" href="Ledger.Utxo.html#14144" class="Bound">A</a> <a id="14146" class="Symbol">:</a> <a id="14148" href="Agda.Primitive.html#388" class="Primitive">Type</a><a id="14152" class="Symbol">}</a> <a id="14154" class="Symbol">{</a><a id="14155" href="Ledger.Utxo.html#14155" class="Bound">x</a> <a id="14157" class="Symbol">:</a> <a id="14159" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="14165" href="Ledger.Utxo.html#14144" class="Bound">A</a><a id="14166" class="Symbol">}</a> <a id="14168" class="Symbol">{</a><a id="14169" href="Ledger.Utxo.html#14169" class="Bound">y</a> <a id="14171" class="Symbol">:</a> <a id="14173" href="Ledger.Utxo.html#14144" class="Bound">A</a><a id="14174" class="Symbol">}</a> <a id="14176" class="Symbol">→</a> <a id="14178" class="Symbol">⦃</a> <a id="14180" href="Class.DecEq.Core.html#117" class="Record">DecEq</a> <a id="14186" href="Ledger.Utxo.html#14144" class="Bound">A</a> <a id="14188" class="Symbol">⦄</a> <a id="14190" class="Symbol">→</a> <a id="14192" class="Symbol">(</a><a id="14193" href="Ledger.Utxo.html#14155" class="Bound">x</a> <a id="14195" href="Ledger.Utxo.html#14001" class="Datatype Operator">≡?</a> <a id="14198" href="Ledger.Utxo.html#14169" class="Bound">y</a><a id="14199" class="Symbol">)</a> <a id="14201" href="Class.Decidable.Core.html#208" class="Record Operator">⁇</a>
  <a id="14205" href="Ledger.Utxo.html#14138" class="Function">≟?</a> <a id="14208" class="Symbol">{</a><a id="14209" class="Argument">x</a> <a id="14211" class="Symbol">=</a> <a id="14213" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="14218" href="Ledger.Utxo.html#14218" class="Bound">x</a><a id="14219" class="Symbol">}</a> <a id="14221" class="Symbol">{</a><a id="14222" href="Ledger.Utxo.html#14222" class="Bound">y</a><a id="14223" class="Symbol">}</a> <a id="14225" class="Keyword">with</a> <a id="14230" href="Ledger.Utxo.html#14218" class="Bound">x</a> <a id="14232" href="Class.DecEq.Core.html#159" class="Field Operator">≟</a> <a id="14234" href="Ledger.Utxo.html#14222" class="Bound">y</a>
  <a id="14238" class="Symbol">...</a> <a id="14242" class="Symbol">|</a> <a id="14244" href="Relation.Nullary.Decidable.Core.html#1618" class="InductiveConstructor">yes</a> <a id="14248" href="Agda.Builtin.Equality.html#207" class="InductiveConstructor">refl</a> <a id="14253" class="Symbol">=</a> <a id="14255" href="Class.Decidable.Core.html#253" class="InductiveConstructor Operator">⁇</a> <a id="14257" href="Relation.Nullary.Decidable.Core.html#1618" class="InductiveConstructor">yes</a> <a id="14261" href="Ledger.Utxo.html#14087" class="InductiveConstructor">≡?-just</a>
  <a id="14271" class="Symbol">...</a> <a id="14275" class="Symbol">|</a> <a id="14277" href="Relation.Nullary.Decidable.Core.html#1655" class="InductiveConstructor">no</a> <a id="14280" href="Ledger.Utxo.html#14280" class="Bound">¬p</a>    <a id="14286" class="Symbol">=</a> <a id="14288" href="Class.Decidable.Core.html#253" class="InductiveConstructor Operator">⁇</a> <a id="14290" href="Relation.Nullary.Decidable.Core.html#1655" class="InductiveConstructor">no</a> <a id="14293" class="Symbol">λ</a> <a id="14295" class="Keyword">where</a> <a id="14301" href="Ledger.Utxo.html#14087" class="InductiveConstructor">≡?-just</a> <a id="14309" class="Symbol">→</a> <a id="14311" href="Ledger.Utxo.html#14280" class="Bound">¬p</a> <a id="14314" href="Agda.Builtin.Equality.html#207" class="InductiveConstructor">refl</a>
  <a id="14321" href="Ledger.Utxo.html#14138" class="Function">≟?</a> <a id="14324" class="Symbol">{</a><a id="14325" class="Argument">x</a> <a id="14327" class="Symbol">=</a> <a id="14329" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a><a id="14336" class="Symbol">}</a> <a id="14338" class="Symbol">=</a> <a id="14340" href="Class.Decidable.Core.html#253" class="InductiveConstructor Operator">⁇</a> <a id="14342" href="Relation.Nullary.Decidable.Core.html#1618" class="InductiveConstructor">yes</a> <a id="14346" href="Ledger.Utxo.html#14046" class="InductiveConstructor">≡?-nothing</a>

<a id="14358" class="Keyword">data</a> <a id="14363" href="Ledger.Utxo.html#5545" class="Datatype Operator">_⊢_⇀⦇_,UTXO⦈_</a> <a id="14377" class="Keyword">where</a>
<a id="14383" class="Markup">\end{code}</a><a id="14393" class="Background">

\begin{NoConway}
We write \maybeEq to mean that two potentially optional values are
equal if they are both present.

\begin{figure*}[h]
</a><a id="14531" class="Markup">\begin{code}</a>
  <a id="_⊢_⇀⦇_,UTXO⦈_.UTXO-inductive"></a><a id="14546" href="Ledger.Utxo.html#14546" class="InductiveConstructor">UTXO-inductive</a> <a id="14561" class="Symbol">:</a>
    <a id="14567" class="Keyword">let</a> <a id="14571" class="Keyword">open</a> <a id="14576" href="Ledger.Transaction.html#5258" class="Module">Tx</a> <a id="14579" href="Ledger.Utxo.html#13987" class="Generalizable">tx</a> <a id="14582" class="Keyword">renaming</a> <a id="14591" class="Symbol">(</a><a id="14592" href="Ledger.Transaction.html#5344" class="Field">body</a> <a id="14597" class="Symbol">to</a> <a id="14600" class="Field">txb</a><a id="14603" class="Symbol">);</a> <a id="14606" class="Keyword">open</a> <a id="14611" href="Ledger.Transaction.html#4157" class="Module">TxBody</a> <a id="14618" href="Ledger.Utxo.html#14600" class="Function">txb</a>
        <a id="14630" class="Keyword">open</a> <a id="14635" href="Ledger.Utxo.html#5026" class="Module">UTxOEnv</a> <a id="14643" href="Ledger.Utxo.html#13954" class="Generalizable">Γ</a> <a id="14645" class="Keyword">renaming</a> <a id="14654" class="Symbol">(</a><a id="14655" href="Ledger.Utxo.html#5134" class="Field">pparams</a> <a id="14663" class="Symbol">to</a> <a id="14666" class="Field">pp</a><a id="14668" class="Symbol">)</a>
        <a id="14678" class="Keyword">open</a> <a id="14683" href="Ledger.Utxo.html#5240" class="Module">UTxOState</a> <a id="14693" href="Ledger.Utxo.html#13968" class="Generalizable">s</a>
        <a id="14703" href="Ledger.Utxo.html#14703" class="Bound">txoutsʰ</a> <a id="14711" class="Symbol">=</a> <a id="14713" class="Symbol">(</a><a id="14714" href="Axiom.Set.Map.html#6138" class="Function">mapValues</a> <a id="14724" href="Ledger.Transaction.html#5781" class="Function">txOutHash</a> <a id="14734" href="Ledger.Transaction.html#4307" class="Function">txouts</a><a id="14740" class="Symbol">)</a>
    <a id="14746" class="Keyword">in</a>
    <a id="14753" href="Interface.STS.html#105" class="Function Operator">∙</a> <a id="14755" href="Ledger.Transaction.html#4247" class="Function">txins</a> <a id="14761" href="Relation.Binary.PropositionalEquality.Core.html#858" class="Function Operator">≢</a> <a id="14763" href="Interface.HasEmptySet.html#150" class="Field">∅</a>                              <a id="14794" href="Interface.STS.html#131" class="Function Operator">∙</a> <a id="14796" href="Ledger.Transaction.html#4247" class="Function">txins</a> <a id="14802" href="Axiom.Set.html#8665" class="Function Operator">∪</a> <a id="14804" href="Ledger.Transaction.html#4277" class="Function">refInputs</a> <a id="14814" href="Axiom.Set.html#1639" class="Function Operator">⊆</a> <a id="14816" href="Interface.IsSet.html#934" class="Function">dom</a> <a id="14820" href="Ledger.Utxo.html#5354" class="Function">utxo</a>
    <a id="14829" href="Interface.STS.html#131" class="Function Operator">∙</a> <a id="14831" href="Ledger.Transaction.html#4247" class="Function">txins</a> <a id="14837" href="Axiom.Set.html#9005" class="Function Operator">∩</a> <a id="14839" href="Ledger.Transaction.html#4277" class="Function">refInputs</a> <a id="14849" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="14851" href="Interface.HasEmptySet.html#150" class="Field">∅</a>                  <a id="14870" href="Interface.STS.html#131" class="Function Operator">∙</a> <a id="14872" href="Ledger.Utxo.html#8418" class="Datatype">inInterval</a> <a id="14883" href="Ledger.Utxo.html#5113" class="Function">slot</a> <a id="14888" href="Ledger.Transaction.html#4398" class="Function">txvldt</a>
    <a id="14899" href="Interface.STS.html#131" class="Function Operator">∙</a> <a id="14901" href="Ledger.Utxo.html#10338" class="Function">feesOK</a> <a id="14908" href="Ledger.Utxo.html#14666" class="Function">pp</a> <a id="14911" href="Ledger.Utxo.html#13987" class="Generalizable">tx</a> <a id="14914" href="Ledger.Utxo.html#5354" class="Function">utxo</a> <a id="14919" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="14921" href="Agda.Builtin.Bool.html#198" class="InductiveConstructor">true</a>               <a id="14940" href="Interface.STS.html#131" class="Function Operator">∙</a> <a id="14942" href="Ledger.Utxo.html#11448" class="Function">consumed</a> <a id="14951" href="Ledger.Utxo.html#14666" class="Function">pp</a> <a id="14954" href="Ledger.Utxo.html#13968" class="Generalizable">s</a> <a id="14956" href="Ledger.Utxo.html#14600" class="Function">txb</a> <a id="14960" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="14962" href="Ledger.Utxo.html#11617" class="Function">produced</a> <a id="14971" href="Ledger.Utxo.html#14666" class="Function">pp</a> <a id="14974" href="Ledger.Utxo.html#13968" class="Generalizable">s</a> <a id="14976" href="Ledger.Utxo.html#14600" class="Function">txb</a>
    <a id="14984" href="Interface.STS.html#131" class="Function Operator">∙</a> <a id="14986" href="Ledger.TokenAlgebra.html#1233" class="Function">coin</a> <a id="14991" href="Ledger.Transaction.html#4369" class="Function">mint</a> <a id="14996" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="14998" class="Number">0</a>                          <a id="15025" href="Interface.STS.html#131" class="Function Operator">∙</a> <a id="15027" href="Ledger.Transaction.html#4754" class="Function">txsize</a> <a id="15034" href="Interface.HasOrder.html#301" class="Field Operator">≤</a> <a id="15036" href="Ledger.PParams.html#2227" class="Field">maxTxSize</a> <a id="15046" href="Ledger.Utxo.html#14666" class="Function">pp</a>

    <a id="15054" href="Interface.STS.html#131" class="Function Operator">∙</a> <a id="15056" href="Interface.IsSet.html#594" class="Function">∀[</a> <a id="15059" href="Ledger.Utxo.html#15059" class="Bound">(_</a> <a id="15062" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="15064" href="Ledger.Utxo.html#15064" class="Bound">txout</a><a id="15069" href="Ledger.Utxo.html#15059" class="Bound">)</a> <a id="15071" href="Interface.IsSet.html#594" class="Function">∈</a> <a id="15073" href="Ledger.Utxo.html#14703" class="Bound">txoutsʰ</a> <a id="15081" class="Symbol">.</a><a id="15082" href="Data.Product.Base.html#636" class="Field">proj₁</a> <a id="15088" href="Interface.IsSet.html#594" class="Function">]</a>
        <a id="15098" href="Ledger.TokenAlgebra.html#1278" class="Function">inject</a> <a id="15105" class="Symbol">(</a><a id="15106" href="Ledger.Utxo.html#2066" class="Function">utxoEntrySize</a> <a id="15120" href="Ledger.Utxo.html#15064" class="Bound">txout</a> <a id="15126" href="Agda.Builtin.Nat.html#539" class="Primitive Operator">*</a> <a id="15128" href="Ledger.PParams.html#2978" class="Field">minUTxOValue</a> <a id="15141" href="Ledger.Utxo.html#14666" class="Function">pp</a><a id="15143" class="Symbol">)</a> <a id="15145" href="Ledger.TokenAlgebra.html#1429" class="Function Operator">≤ᵗ</a> <a id="15148" href="Ledger.Transaction.html#5870" class="Function">getValueʰ</a> <a id="15158" href="Ledger.Utxo.html#15064" class="Bound">txout</a>
    <a id="15168" href="Interface.STS.html#131" class="Function Operator">∙</a> <a id="15170" href="Interface.IsSet.html#594" class="Function">∀[</a> <a id="15173" href="Ledger.Utxo.html#15173" class="Bound">(_</a> <a id="15176" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="15178" href="Ledger.Utxo.html#15178" class="Bound">txout</a><a id="15183" href="Ledger.Utxo.html#15173" class="Bound">)</a> <a id="15185" href="Interface.IsSet.html#594" class="Function">∈</a> <a id="15187" href="Ledger.Utxo.html#14703" class="Bound">txoutsʰ</a> <a id="15195" class="Symbol">.</a><a id="15196" href="Data.Product.Base.html#636" class="Field">proj₁</a> <a id="15202" href="Interface.IsSet.html#594" class="Function">]</a>
        <a id="15212" href="Ledger.Abstract.html#626" class="Field">serSize</a> <a id="15220" class="Symbol">(</a><a id="15221" href="Ledger.Transaction.html#5870" class="Function">getValueʰ</a> <a id="15231" href="Ledger.Utxo.html#15178" class="Bound">txout</a><a id="15236" class="Symbol">)</a> <a id="15238" href="Interface.HasOrder.html#301" class="Field Operator">≤</a> <a id="15240" href="Ledger.PParams.html#2407" class="Field">maxValSize</a> <a id="15251" href="Ledger.Utxo.html#14666" class="Function">pp</a>
    <a id="15258" href="Interface.STS.html#131" class="Function Operator">∙</a> <a id="15260" href="Interface.IsSet.html#594" class="Function">∀[</a> <a id="15263" href="Ledger.Utxo.html#15263" class="Bound">(</a><a id="15264" href="Ledger.Utxo.html#15264" class="Bound">a</a> <a id="15266" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="15268" href="Ledger.Utxo.html#15263" class="Bound">_)</a> <a id="15271" href="Interface.IsSet.html#594" class="Function">∈</a> <a id="15273" href="Interface.IsSet.html#977" class="Function">range</a> <a id="15279" href="Ledger.Utxo.html#14703" class="Bound">txoutsʰ</a> <a id="15287" href="Interface.IsSet.html#594" class="Function">]</a>
        <a id="15297" href="Data.Sum.Relation.Unary.All.html#626" class="Datatype">Sum.All</a> <a id="15305" class="Symbol">(</a><a id="15306" href="Function.Base.html#725" class="Function">const</a> <a id="15312" href="Agda.Builtin.Unit.html#175" class="Record">⊤</a><a id="15313" class="Symbol">)</a> <a id="15315" class="Symbol">(λ</a> <a id="15318" href="Ledger.Utxo.html#15318" class="Bound">a</a> <a id="15320" class="Symbol">→</a> <a id="15322" href="Ledger.Utxo.html#15318" class="Bound">a</a> <a id="15324" class="Symbol">.</a><a id="15325" href="Ledger.Address.html#1560" class="Field">BootstrapAddr.attrsSize</a> <a id="15349" href="Interface.HasOrder.html#301" class="Field Operator">≤</a> <a id="15351" class="Number">64</a><a id="15353" class="Symbol">)</a> <a id="15355" href="Ledger.Utxo.html#15264" class="Bound">a</a>
    <a id="15361" href="Interface.STS.html#131" class="Function Operator">∙</a> <a id="15363" href="Interface.IsSet.html#594" class="Function">∀[</a> <a id="15366" href="Ledger.Utxo.html#15366" class="Bound">(</a><a id="15367" href="Ledger.Utxo.html#15367" class="Bound">a</a> <a id="15369" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="15371" href="Ledger.Utxo.html#15366" class="Bound">_)</a> <a id="15374" href="Interface.IsSet.html#594" class="Function">∈</a> <a id="15376" href="Interface.IsSet.html#977" class="Function">range</a> <a id="15382" href="Ledger.Utxo.html#14703" class="Bound">txoutsʰ</a> <a id="15390" href="Interface.IsSet.html#594" class="Function">]</a>  <a id="15393" href="Ledger.Address.html#2376" class="Function">netId</a> <a id="15399" href="Ledger.Utxo.html#15367" class="Bound">a</a>         <a id="15409" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="15411" href="Ledger.Transaction.html#3287" class="Field">networkId</a>
    <a id="15425" href="Interface.STS.html#131" class="Function Operator">∙</a> <a id="15427" href="Interface.IsSet.html#594" class="Function">∀[</a> <a id="15430" href="Ledger.Utxo.html#15430" class="Bound">a</a> <a id="15432" href="Interface.IsSet.html#594" class="Function">∈</a> <a id="15434" href="Interface.IsSet.html#934" class="Function">dom</a> <a id="15438" href="Ledger.Transaction.html#4479" class="Function">txwdrls</a> <a id="15446" href="Interface.IsSet.html#594" class="Function">]</a>          <a id="15457" href="Ledger.Utxo.html#15430" class="Bound">a</a> <a id="15459" class="Symbol">.</a><a id="15460" href="Ledger.Address.html#1612" class="Field">RwdAddr.net</a>  <a id="15473" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="15475" href="Ledger.Transaction.html#3287" class="Field">networkId</a>
    <a id="15489" href="Interface.STS.html#131" class="Function Operator">∙</a> <a id="15491" href="Ledger.Transaction.html#4683" class="Function">txNetworkId</a> <a id="15503" href="Ledger.Utxo.html#14001" class="Datatype Operator">≡?</a> <a id="15506" href="Ledger.Transaction.html#3287" class="Field">networkId</a>
    <a id="15520" href="Interface.STS.html#131" class="Function Operator">∙</a> <a id="15522" href="Ledger.Transaction.html#4720" class="Function">curTreasury</a> <a id="15534" href="Ledger.Utxo.html#14001" class="Datatype Operator">≡?</a> <a id="15537" href="Ledger.Utxo.html#5158" class="Function">treasury</a>
    <a id="15550" href="Interface.STS.html#131" class="Function Operator">∙</a> <a id="15552" href="Ledger.Utxo.html#13954" class="Generalizable">Γ</a> <a id="15554" href="Ledger.Utxo.html#12480" class="Datatype Operator">⊢</a> <a id="15556" href="Ledger.Utxo.html#13968" class="Generalizable">s</a> <a id="15558" href="Ledger.Utxo.html#12480" class="Datatype Operator">⇀⦇</a> <a id="15561" href="Ledger.Utxo.html#13987" class="Generalizable">tx</a> <a id="15564" href="Ledger.Utxo.html#12480" class="Datatype Operator">,UTXOS⦈</a> <a id="15572" href="Ledger.Utxo.html#13970" class="Generalizable">s&#39;</a>
      <a id="15581" href="Interface.STS.html#350" class="Function Operator">────────────────────────────────</a>
      <a id="15620" href="Ledger.Utxo.html#13954" class="Generalizable">Γ</a> <a id="15622" href="Ledger.Utxo.html#5545" class="Datatype Operator">⊢</a> <a id="15624" href="Ledger.Utxo.html#13968" class="Generalizable">s</a> <a id="15626" href="Ledger.Utxo.html#5545" class="Datatype Operator">⇀⦇</a> <a id="15629" href="Ledger.Utxo.html#13987" class="Generalizable">tx</a> <a id="15632" href="Ledger.Utxo.html#5545" class="Datatype Operator">,UTXO⦈</a> <a id="15639" href="Ledger.Utxo.html#13970" class="Generalizable">s&#39;</a>
<a id="15642" class="Markup">\end{code}</a><a id="15652" class="Background">
</a><a id="15653" class="Markup">\begin{code}[hide]</a>
<a id="15672" class="Keyword">pattern</a> <a id="UTXO-inductive⋯"></a><a id="15680" href="Ledger.Utxo.html#15680" class="InductiveConstructor">UTXO-inductive⋯</a> <a id="15696" href="Ledger.Utxo.html#15759" class="Bound">tx</a> <a id="15699" href="Ledger.Utxo.html#15763" class="Bound">Γ</a> <a id="15701" href="Ledger.Utxo.html#15766" class="Bound">s</a> <a id="15703" href="Ledger.Utxo.html#15770" class="Bound">x</a> <a id="15705" href="Ledger.Utxo.html#15774" class="Bound">y</a> <a id="15707" href="Ledger.Utxo.html#15778" class="Bound">z</a> <a id="15709" href="Ledger.Utxo.html#15782" class="Bound">w</a> <a id="15711" href="Ledger.Utxo.html#15786" class="Bound">k</a> <a id="15713" href="Ledger.Utxo.html#15790" class="Bound">l</a> <a id="15715" href="Ledger.Utxo.html#15794" class="Bound">m</a> <a id="15717" href="Ledger.Utxo.html#15798" class="Bound">v</a> <a id="15719" href="Ledger.Utxo.html#15802" class="Bound">n</a> <a id="15721" href="Ledger.Utxo.html#15806" class="Bound">o</a> <a id="15723" href="Ledger.Utxo.html#15810" class="Bound">p</a> <a id="15725" href="Ledger.Utxo.html#15814" class="Bound">q</a> <a id="15727" href="Ledger.Utxo.html#15818" class="Bound">r</a> <a id="15729" href="Ledger.Utxo.html#15822" class="Bound">t</a> <a id="15731" href="Ledger.Utxo.html#15826" class="Bound">u</a> <a id="15733" href="Ledger.Utxo.html#15830" class="Bound">h</a>
      <a id="15741" class="Symbol">=</a> <a id="15743" href="Ledger.Utxo.html#14546" class="InductiveConstructor">UTXO-inductive</a> <a id="15758" class="Symbol">{</a><a id="15759" href="Ledger.Utxo.html#15759" class="Bound">tx</a><a id="15761" class="Symbol">}{</a><a id="15763" href="Ledger.Utxo.html#15763" class="Bound">Γ</a><a id="15764" class="Symbol">}{</a><a id="15766" href="Ledger.Utxo.html#15766" class="Bound">s</a><a id="15767" class="Symbol">}</a> <a id="15769" class="Symbol">(</a><a id="15770" href="Ledger.Utxo.html#15770" class="Bound">x</a> <a id="15772" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="15774" href="Ledger.Utxo.html#15774" class="Bound">y</a> <a id="15776" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="15778" href="Ledger.Utxo.html#15778" class="Bound">z</a> <a id="15780" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="15782" href="Ledger.Utxo.html#15782" class="Bound">w</a> <a id="15784" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="15786" href="Ledger.Utxo.html#15786" class="Bound">k</a> <a id="15788" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="15790" href="Ledger.Utxo.html#15790" class="Bound">l</a> <a id="15792" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="15794" href="Ledger.Utxo.html#15794" class="Bound">m</a> <a id="15796" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="15798" href="Ledger.Utxo.html#15798" class="Bound">v</a> <a id="15800" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="15802" href="Ledger.Utxo.html#15802" class="Bound">n</a> <a id="15804" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="15806" href="Ledger.Utxo.html#15806" class="Bound">o</a> <a id="15808" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="15810" href="Ledger.Utxo.html#15810" class="Bound">p</a> <a id="15812" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="15814" href="Ledger.Utxo.html#15814" class="Bound">q</a> <a id="15816" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="15818" href="Ledger.Utxo.html#15818" class="Bound">r</a> <a id="15820" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="15822" href="Ledger.Utxo.html#15822" class="Bound">t</a> <a id="15824" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="15826" href="Ledger.Utxo.html#15826" class="Bound">u</a> <a id="15828" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="15830" href="Ledger.Utxo.html#15830" class="Bound">h</a><a id="15831" class="Symbol">)</a>
<a id="15833" class="Keyword">unquoteDecl</a> <a id="UTXO-premises"></a><a id="15845" href="Ledger.Utxo.html#15845" class="Function">UTXO-premises</a> <a id="15859" class="Symbol">=</a> <a id="15861" href="Tactic.Premises.html#1543" class="Function">genPremises</a> <a id="15873" href="Ledger.Utxo.html#15845" class="Function">UTXO-premises</a> <a id="15887" class="Symbol">(</a><a id="15888" class="Keyword">quote</a> <a id="15894" href="Ledger.Utxo.html#14546" class="InductiveConstructor">UTXO-inductive</a><a id="15908" class="Symbol">)</a>
<a id="15910" class="Markup">\end{code}</a><a id="15920" class="Background">
\caption{UTXO inference rules}
\label{fig:rules:utxo-shelley}
\end{figure*}
\end{NoConway}
</a></pre></body></html>