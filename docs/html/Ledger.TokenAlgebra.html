<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>Ledger.TokenAlgebra</title><link rel="stylesheet" href="Agda.css"></head><body><pre class="Agda"><a id="1" class="Background">\section{Token Algebras}
\label{sec:token-algebra}
\begin{figure*}[h]
\begin{AgdaMultiCode}
</a><a id="93" class="Markup">\begin{code}[hide]</a>
<a id="112" class="Symbol">{-#</a> <a id="116" class="Keyword">OPTIONS</a> <a id="124" class="Pragma">--safe</a> <a id="131" class="Symbol">#-}</a>
<a id="135" class="Keyword">open</a> <a id="140" class="Keyword">import</a> <a id="147" href="Prelude.html" class="Module">Prelude</a> <a id="155" class="Keyword">using</a> <a id="161" class="Symbol">(</a><a id="162" href="Agda.Primitive.html#388" class="Primitive">Type</a><a id="166" class="Symbol">)</a>
<a id="168" class="Keyword">module</a> <a id="175" href="Ledger.TokenAlgebra.html" class="Module">Ledger.TokenAlgebra</a> <a id="195" class="Symbol">(</a>
<a id="197" class="Markup">\end{code}</a><a id="207" class="Background">
\emph{Abstract types}
</a><a id="230" class="Markup">\begin{code}</a>
  <a id="245" href="Ledger.TokenAlgebra.html#245" class="Bound">PolicyId</a>
<a id="254" class="Markup">\end{code}</a><a id="264" class="Background">
</a><a id="265" class="Markup">\begin{code}[hide]</a>
  <a id="286" class="Symbol">:</a> <a id="288" href="Agda.Primitive.html#388" class="Primitive">Type</a><a id="292" class="Symbol">)</a> <a id="294" class="Keyword">where</a>
<a id="300" class="Keyword">open</a> <a id="305" class="Keyword">import</a> <a id="312" href="Ledger.Prelude.html" class="Module">Ledger.Prelude</a>

<a id="328" class="Keyword">open</a> <a id="333" class="Keyword">import</a> <a id="340" href="Algebra.html" class="Module">Algebra</a>              <a id="361" class="Keyword">using</a> <a id="367" class="Symbol">(</a><a id="368" href="Algebra.Bundles.html#6622" class="Record">CommutativeMonoid</a> <a id="386" class="Symbol">;</a> <a id="388" href="Algebra.Bundles.html#6051" class="Record">Monoid</a><a id="394" class="Symbol">)</a>
<a id="396" class="Keyword">open</a> <a id="401" class="Keyword">import</a> <a id="408" href="Algebra.Morphism.html" class="Module">Algebra.Morphism</a>     <a id="429" class="Keyword">using</a> <a id="435" class="Symbol">(</a><a id="436" class="Keyword">module</a> <a id="443" href="Algebra.Morphism.Structures.html#2353" class="Module">MonoidMorphisms</a> <a id="459" class="Symbol">)</a>
<a id="461" class="Keyword">open</a> <a id="466" class="Keyword">import</a> <a id="473" href="Data.Nat.Properties.html" class="Module">Data.Nat.Properties</a>  <a id="494" class="Keyword">using</a> <a id="500" class="Symbol">(</a><a id="501" href="Data.Nat.Properties.html#16493" class="Function">+-0-monoid</a><a id="511" class="Symbol">)</a>
<a id="513" class="Keyword">open</a> <a id="518" class="Keyword">import</a> <a id="525" href="Relation.Binary.html" class="Module">Relation.Binary</a>      <a id="546" class="Keyword">using</a> <a id="552" class="Symbol">(</a><a id="553" href="Relation.Binary.Core.html#896" class="Function">Rel</a><a id="556" class="Symbol">)</a>
<a id="558" class="Keyword">open</a> <a id="563" class="Keyword">import</a> <a id="570" href="Relation.Unary.html" class="Module">Relation.Unary</a>       <a id="591" class="Keyword">using</a> <a id="597" class="Symbol">(</a><a id="598" href="Relation.Unary.html#1232" class="Function">Pred</a><a id="602" class="Symbol">)</a>

<a id="MemoryEstimate"></a><a id="605" href="Ledger.TokenAlgebra.html#605" class="Function">MemoryEstimate</a> <a id="620" class="Symbol">:</a> <a id="622" href="Agda.Primitive.html#388" class="Primitive">Set</a>
<a id="626" href="Ledger.TokenAlgebra.html#605" class="Function">MemoryEstimate</a> <a id="641" class="Symbol">=</a> <a id="643" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a>
<a id="645" class="Markup">\end{code}</a><a id="655" class="Background">
\emph{Derived types}
\AgdaTarget{TokenAlgebra}
</a><a id="703" class="Markup">\begin{code}</a>
<a id="716" class="Keyword">record</a> <a id="TokenAlgebra"></a><a id="723" href="Ledger.TokenAlgebra.html#723" class="Record">TokenAlgebra</a> <a id="736" class="Symbol">:</a> <a id="738" href="Agda.Primitive.html#388" class="Primitive">Type₁</a> <a id="744" class="Keyword">where</a>
<a id="750" class="Markup">\end{code}</a><a id="760" class="Background">
</a><a id="761" class="Markup">\begin{code}[hide]</a>
  <a id="782" class="Keyword">field</a>
<a id="788" class="Markup">\end{code}</a><a id="798" class="Background">
</a><a id="799" class="Markup">\begin{code}</a>
    <a id="TokenAlgebra.Value"></a><a id="816" href="Ledger.TokenAlgebra.html#816" class="Field">Value</a> <a id="822" class="Symbol">:</a> <a id="824" href="Agda.Primitive.html#388" class="Primitive">Set</a>
    <a id="832" class="Symbol">⦃</a> <a id="TokenAlgebra.Value-IsCommutativeMonoid&#39;"></a><a id="834" href="Ledger.TokenAlgebra.html#834" class="Field">Value-IsCommutativeMonoid&#39;</a> <a id="861" class="Symbol">⦄</a> <a id="863" class="Symbol">:</a> <a id="865" href="Interface.IsCommutativeMonoid.html#164" class="Record">IsCommutativeMonoid&#39;</a> <a id="886" href="Level.html#521" class="Function">0ℓ</a> <a id="889" href="Level.html#521" class="Function">0ℓ</a> <a id="892" href="Ledger.TokenAlgebra.html#816" class="Field">Value</a>

<a id="899" class="Markup">\end{code}</a><a id="909" class="Background">
</a><a id="910" class="Markup">\begin{code}[hide]</a>
  <a id="TokenAlgebra.Value-CommutativeMonoid"></a><a id="931" href="Ledger.TokenAlgebra.html#931" class="Function">Value-CommutativeMonoid</a> <a id="955" class="Symbol">=</a> <a id="957" href="Interface.IsCommutativeMonoid.html#448" class="Function">fromCommMonoid&#39;</a> <a id="973" href="Ledger.TokenAlgebra.html#834" class="Field">Value-IsCommutativeMonoid&#39;</a>
  <a id="1002" class="Keyword">open</a> <a id="1007" href="Algebra.Bundles.html#6622" class="Module">CommutativeMonoid</a> <a id="1025" href="Ledger.TokenAlgebra.html#931" class="Function">Value-CommutativeMonoid</a> <a id="1049" class="Keyword">public</a>
    <a id="1060" class="Keyword">using</a> <a id="1066" class="Symbol">(</a><a id="1067" href="Algebra.Bundles.html#6744" class="Field Operator">_≈_</a> <a id="1071" class="Symbol">;</a> <a id="1073" href="Algebra.Bundles.html#6822" class="Field">ε</a> <a id="1075" class="Symbol">;</a> <a id="1077" href="Algebra.Bundles.html#6966" class="Function">monoid</a> <a id="1084" class="Symbol">;</a> <a id="1086" href="Algebra.Bundles.html#6444" class="Function">rawMonoid</a><a id="1095" class="Symbol">)</a>
    <a id="1101" class="Keyword">renaming</a> <a id="1110" class="Symbol">(</a><a id="1111" href="Algebra.Bundles.html#6784" class="Field Operator">_∙_</a> <a id="1115" class="Symbol">to</a> <a id="1118" class="Field Operator">_+ᵛ_</a><a id="1122" class="Symbol">)</a>

  <a id="1127" class="Keyword">open</a> <a id="1132" href="Algebra.Morphism.Structures.html#2353" class="Module">MonoidMorphisms</a> <a id="1148" class="Symbol">(</a><a id="1149" href="Algebra.Bundles.html#6444" class="Function">rawMonoid</a><a id="1158" class="Symbol">)</a> <a id="1160" class="Symbol">(</a><a id="1161" href="Algebra.Bundles.html#6444" class="Function">Monoid.rawMonoid</a> <a id="1178" href="Data.Nat.Properties.html#16493" class="Function">+-0-monoid</a><a id="1188" class="Symbol">)</a> <a id="1190" class="Keyword">public</a>
  <a id="1199" class="Keyword">field</a>
<a id="1205" class="Markup">\end{code}</a><a id="1215" class="Background">
</a><a id="1216" class="Markup">\begin{code}</a>
    <a id="TokenAlgebra.coin"></a><a id="1233" href="Ledger.TokenAlgebra.html#1233" class="Field">coin</a>                      <a id="1259" class="Symbol">:</a> <a id="1261" href="Ledger.TokenAlgebra.html#816" class="Field">Value</a> <a id="1267" class="Symbol">→</a> <a id="1269" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a>
    <a id="TokenAlgebra.inject"></a><a id="1278" href="Ledger.TokenAlgebra.html#1278" class="Field">inject</a>                    <a id="1304" class="Symbol">:</a> <a id="1306" href="Ledger.Prelude.Base.html#81" class="Function">Coin</a> <a id="1311" class="Symbol">→</a> <a id="1313" href="Ledger.TokenAlgebra.html#816" class="Field">Value</a>
    <a id="TokenAlgebra.policies"></a><a id="1323" href="Ledger.TokenAlgebra.html#1323" class="Field">policies</a>                  <a id="1349" class="Symbol">:</a> <a id="1351" href="Ledger.TokenAlgebra.html#816" class="Field">Value</a> <a id="1357" class="Symbol">→</a> <a id="1359" href="Ledger.Set.Theory.html#382" class="Function Operator">ℙ</a> <a id="1361" href="Ledger.TokenAlgebra.html#245" class="Bound">PolicyId</a>
    <a id="TokenAlgebra.size"></a><a id="1374" href="Ledger.TokenAlgebra.html#1374" class="Field">size</a>                      <a id="1400" class="Symbol">:</a> <a id="1402" href="Ledger.TokenAlgebra.html#816" class="Field">Value</a> <a id="1408" class="Symbol">→</a> <a id="1410" href="Ledger.TokenAlgebra.html#605" class="Function">MemoryEstimate</a>
    <a id="TokenAlgebra._≤ᵗ_"></a><a id="1429" href="Ledger.TokenAlgebra.html#1429" class="Field Operator">_≤ᵗ_</a>                      <a id="1455" class="Symbol">:</a> <a id="1457" href="Ledger.TokenAlgebra.html#816" class="Field">Value</a> <a id="1463" class="Symbol">→</a> <a id="1465" href="Ledger.TokenAlgebra.html#816" class="Field">Value</a> <a id="1471" class="Symbol">→</a> <a id="1473" href="Agda.Primitive.html#388" class="Primitive">Type</a>
    <a id="TokenAlgebra.AssetName"></a><a id="1482" href="Ledger.TokenAlgebra.html#1482" class="Field">AssetName</a>                 <a id="1508" class="Symbol">:</a> <a id="1510" href="Agda.Primitive.html#388" class="Primitive">Set</a>
    <a id="TokenAlgebra.specialAsset"></a><a id="1518" href="Ledger.TokenAlgebra.html#1518" class="Field">specialAsset</a>              <a id="1544" class="Symbol">:</a> <a id="1546" href="Ledger.TokenAlgebra.html#1482" class="Field">AssetName</a>
    <a id="TokenAlgebra.property"></a><a id="1560" href="Ledger.TokenAlgebra.html#1560" class="Field">property</a>                  <a id="1586" class="Symbol">:</a> <a id="1588" href="Ledger.TokenAlgebra.html#1233" class="Field">coin</a> <a id="1593" href="Function.Base.html#1115" class="Function Operator">∘</a> <a id="1595" href="Ledger.TokenAlgebra.html#1278" class="Field">inject</a> <a id="1602" href="Relation.Binary.PropositionalEquality.html#1557" class="Function Operator">≗</a> <a id="1604" href="Function.Base.html#704" class="Function">id</a> <a id="1607" class="Comment">-- FIXME: rename!</a>
    <a id="TokenAlgebra.coinIsMonoidHomomorphism"></a><a id="1629" href="Ledger.TokenAlgebra.html#1629" class="Field">coinIsMonoidHomomorphism</a>  <a id="1655" class="Symbol">:</a> <a id="1657" href="Algebra.Morphism.Structures.html#2693" class="Record">IsMonoidHomomorphism</a> <a id="1678" href="Ledger.TokenAlgebra.html#1233" class="Field">coin</a>
<a id="1683" class="Markup">\end{code}</a><a id="1693" class="Background">
</a><a id="1694" class="Markup">\begin{code}[hide]</a>
    <a id="1717" class="Symbol">⦃</a> <a id="TokenAlgebra.DecEq-Value"></a><a id="1719" href="Ledger.TokenAlgebra.html#1719" class="Field">DecEq-Value</a> <a id="1731" class="Symbol">⦄</a> <a id="1733" class="Symbol">:</a> <a id="1735" href="Class.DecEq.Core.html#117" class="Record">DecEq</a> <a id="1741" href="Ledger.TokenAlgebra.html#816" class="Field">Value</a>
    <a id="1751" class="Symbol">⦃</a> <a id="TokenAlgebra.Dec-≤ᵗ"></a><a id="1753" href="Ledger.TokenAlgebra.html#1753" class="Field">Dec-≤ᵗ</a> <a id="1760" class="Symbol">⦄</a>      <a id="1767" class="Symbol">:</a> <a id="1769" href="Ledger.TokenAlgebra.html#1429" class="Field Operator">_≤ᵗ_</a> <a id="1774" href="Class.Decidable.Core.html#773" class="Function Operator">⁇²</a>

  <a id="1780" class="Keyword">instance</a>
    <a id="TokenAlgebra.addValue"></a><a id="1793" href="Ledger.TokenAlgebra.html#1793" class="Function">addValue</a> <a id="1802" class="Symbol">:</a> <a id="1804" href="Interface.HasAdd.html#83" class="Record">HasAdd</a> <a id="1811" href="Ledger.TokenAlgebra.html#816" class="Field">Value</a>
    <a id="1821" href="Ledger.TokenAlgebra.html#1793" class="Function">addValue</a> <a id="1830" class="Symbol">=</a> <a id="1832" class="Keyword">record</a> <a id="1839" class="Symbol">{</a> <a id="1841" href="Interface.HasAdd.html#135" class="Field Operator">_+_</a> <a id="1845" class="Symbol">=</a> <a id="1847" href="Ledger.TokenAlgebra.html#1118" class="Function Operator">_+ᵛ_</a> <a id="1852" class="Symbol">}</a>

  <a id="TokenAlgebra.coin-inject-lemma"></a><a id="1857" href="Ledger.TokenAlgebra.html#1857" class="Function">coin-inject-lemma</a> <a id="1875" class="Symbol">:</a> <a id="1877" class="Symbol">∀</a> <a id="1879" class="Symbol">{</a><a id="1880" href="Ledger.TokenAlgebra.html#1880" class="Bound">val</a><a id="1883" class="Symbol">}</a> <a id="1885" class="Symbol">{</a><a id="1886" href="Ledger.TokenAlgebra.html#1886" class="Bound">c</a><a id="1887" class="Symbol">}</a> <a id="1889" class="Symbol">→</a> <a id="1891" href="Ledger.TokenAlgebra.html#1233" class="Field">coin</a> <a id="1896" class="Symbol">(</a><a id="1897" href="Ledger.TokenAlgebra.html#1880" class="Bound">val</a> <a id="1901" href="Interface.HasAdd.html#135" class="Field Operator">+</a> <a id="1903" href="Ledger.TokenAlgebra.html#1278" class="Field">inject</a> <a id="1910" href="Ledger.TokenAlgebra.html#1886" class="Bound">c</a><a id="1911" class="Symbol">)</a> <a id="1913" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="1915" href="Ledger.TokenAlgebra.html#1233" class="Field">coin</a> <a id="1920" href="Ledger.TokenAlgebra.html#1880" class="Bound">val</a> <a id="1924" href="Interface.HasAdd.html#135" class="Field Operator">+</a> <a id="1926" href="Ledger.TokenAlgebra.html#1886" class="Bound">c</a>
  <a id="1930" href="Ledger.TokenAlgebra.html#1857" class="Function">coin-inject-lemma</a> <a id="1948" class="Symbol">{</a><a id="1949" href="Ledger.TokenAlgebra.html#1949" class="Bound">val</a><a id="1952" class="Symbol">}</a> <a id="1954" class="Symbol">{</a><a id="1955" href="Ledger.TokenAlgebra.html#1955" class="Bound">c</a><a id="1956" class="Symbol">}</a> <a id="1958" class="Symbol">=</a> <a id="1960" href="Relation.Binary.Reasoning.Syntax.html#1510" class="Function Operator">begin</a>
    <a id="1970" href="Ledger.TokenAlgebra.html#1233" class="Field">coin</a> <a id="1975" class="Symbol">(</a><a id="1976" href="Ledger.TokenAlgebra.html#1949" class="Bound">val</a> <a id="1980" href="Interface.HasAdd.html#135" class="Field Operator">+</a> <a id="1982" href="Ledger.TokenAlgebra.html#1278" class="Field">inject</a> <a id="1989" href="Ledger.TokenAlgebra.html#1955" class="Bound">c</a><a id="1990" class="Symbol">)</a>         <a id="2000" href="Relation.Binary.Reasoning.Syntax.html#10986" class="Function">≡⟨</a> <a id="2003" href="Algebra.Morphism.Structures.html#1191" class="Function">homo</a> <a id="2008" href="Ledger.TokenAlgebra.html#1629" class="Field">coinIsMonoidHomomorphism</a> <a id="2033" href="Ledger.TokenAlgebra.html#1949" class="Bound">val</a> <a id="2037" class="Symbol">(</a><a id="2038" href="Ledger.TokenAlgebra.html#1278" class="Field">inject</a> <a id="2045" href="Ledger.TokenAlgebra.html#1955" class="Bound">c</a><a id="2046" class="Symbol">)</a> <a id="2048" href="Relation.Binary.Reasoning.Syntax.html#10986" class="Function">⟩</a>
    <a id="2054" href="Ledger.TokenAlgebra.html#1233" class="Field">coin</a> <a id="2059" href="Ledger.TokenAlgebra.html#1949" class="Bound">val</a> <a id="2063" href="Interface.HasAdd.html#135" class="Field Operator">+</a> <a id="2065" class="Symbol">(</a><a id="2066" href="Ledger.TokenAlgebra.html#1233" class="Field">coin</a> <a id="2071" href="Function.Base.html#1115" class="Function Operator">∘</a> <a id="2073" href="Ledger.TokenAlgebra.html#1278" class="Field">inject</a><a id="2079" class="Symbol">)</a> <a id="2081" href="Ledger.TokenAlgebra.html#1955" class="Bound">c</a>  <a id="2084" href="Relation.Binary.Reasoning.Syntax.html#10986" class="Function">≡⟨</a> <a id="2087" href="Relation.Binary.PropositionalEquality.Core.html#1158" class="Function">cong</a> <a id="2092" class="Symbol">(</a><a id="2093" href="Ledger.TokenAlgebra.html#1233" class="Field">coin</a> <a id="2098" href="Ledger.TokenAlgebra.html#1949" class="Bound">val</a> <a id="2102" href="Interface.HasAdd.html#135" class="Field Operator">+_</a><a id="2104" class="Symbol">)</a> <a id="2106" class="Symbol">(</a><a id="2107" href="Ledger.TokenAlgebra.html#1560" class="Field">property</a> <a id="2116" href="Ledger.TokenAlgebra.html#1955" class="Bound">c</a><a id="2117" class="Symbol">)</a> <a id="2119" href="Relation.Binary.Reasoning.Syntax.html#10986" class="Function">⟩</a>
    <a id="2125" href="Ledger.TokenAlgebra.html#1233" class="Field">coin</a> <a id="2130" href="Ledger.TokenAlgebra.html#1949" class="Bound">val</a> <a id="2134" href="Interface.HasAdd.html#135" class="Field Operator">+</a> <a id="2136" href="Ledger.TokenAlgebra.html#1955" class="Bound">c</a>                  <a id="2155" href="Relation.Binary.Reasoning.Syntax.html#12283" class="Function Operator">∎</a>
    <a id="2161" class="Keyword">where</a>
    <a id="2171" class="Keyword">open</a> <a id="2176" href="Relation.Binary.PropositionalEquality.Properties.html#6744" class="Module">≡-Reasoning</a>
    <a id="2192" class="Keyword">open</a> <a id="2197" href="Algebra.Morphism.Structures.html#2693" class="Module">MonoidMorphisms.IsMonoidHomomorphism</a>
<a id="2234" class="Markup">\end{code}</a><a id="2244" class="Background">
\emph{Helper functions}
\AgdaTarget{sumᵛ}
</a><a id="2287" class="Markup">\begin{code}</a>
  <a id="TokenAlgebra.sumᵛ"></a><a id="2302" href="Ledger.TokenAlgebra.html#2302" class="Function">sumᵛ</a> <a id="2307" class="Symbol">:</a> <a id="2309" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="2314" href="Ledger.TokenAlgebra.html#816" class="Field">Value</a> <a id="2320" class="Symbol">→</a> <a id="2322" href="Ledger.TokenAlgebra.html#816" class="Field">Value</a>
  <a id="2330" href="Ledger.TokenAlgebra.html#2302" class="Function">sumᵛ</a> <a id="2335" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a> <a id="2338" class="Symbol">=</a> <a id="2340" href="Ledger.TokenAlgebra.html#1278" class="Field">inject</a> <a id="2347" class="Number">0</a>
  <a id="2351" href="Ledger.TokenAlgebra.html#2302" class="Function">sumᵛ</a> <a id="2356" class="Symbol">(</a><a id="2357" href="Ledger.TokenAlgebra.html#2357" class="Bound">x</a> <a id="2359" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="2361" href="Ledger.TokenAlgebra.html#2361" class="Bound">l</a><a id="2362" class="Symbol">)</a> <a id="2364" class="Symbol">=</a> <a id="2366" href="Ledger.TokenAlgebra.html#2357" class="Bound">x</a> <a id="2368" href="Interface.HasAdd.html#135" class="Field Operator">+</a> <a id="2370" href="Ledger.TokenAlgebra.html#2302" class="Function">sumᵛ</a> <a id="2375" href="Ledger.TokenAlgebra.html#2361" class="Bound">l</a>
<a id="2377" class="Markup">\end{code}</a><a id="2387" class="Background">
\end{AgdaMultiCode}
\caption{Token algebras, used for multi-assets}
\end{figure*}
</a></pre></body></html>